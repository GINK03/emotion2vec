{"context": " More than 1 year has passed since last update.\n\n\u4f1d\u3048\u305f\u3044\u4e8b\nR\u8a00\u8a9e\u306b\u304a\u3051\u308bmagrittr\u305d\u3057\u3066dplyr\u306b\u3088\u308b\u30c7\u30fc\u30bf\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306f\u3068\u3066\u3082\u5fc3\u5730\u304c\u826f\u3044\u3067\u3059\uff0e\n\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u304c\u5b9f\u306b\u7f8e\u3057\u3044\u3067\u3059\uff0e\n\u4e00\u65b9\uff0c\u3044\u308d\u3093\u306a\u65b9\u304c\u66f8\u3044\u305fpandas\u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u3044\u308b\u3068\ndf = df[df.a >0]\ndf = ...\n\n\n\u3068\u518d\u5e30\u4ee3\u5165\u3092\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3057\u3066\u3044\u3066\u7f8e\u3057\u304f\u306a\u3044\uff0e\u3084\u3084\u3053\u3057\u3044\u3053\u3068\u3092\u3044\u3046\u3068\u53c2\u7167\u900f\u904e\u6027\u3092\u640d\u3046\uff0e\n\u3067\u3082\uff01\uff01\u305d\u3093\u306a\u518d\u5e30\u4ee3\u5165\u3092\u7e70\u308a\u8fd4\u3055\u306a\u304f\u3066\u3082\u3044\u3044\uff0cpandas\u3067\u3082\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3067\u30c7\u30fc\u30bf\u51e6\u7406\u304c\u3067\u304d\u308b\u3063\u3066\u306e\u304c\u4eca\u65e5\u4f1d\u3048\u305f\u3044\u3053\u3068\u3067\u3059\uff0e\n\u3068\u304f\u306b\u305c\u3072\u7686\u3055\u3093\u306b\u4f7f\u3063\u3066\u6b32\u3057\u3044method\u305f\u3061\n\npipe\nassign\nreset_index\nset_index\ngroup_by\npivot\nstack\n\n\u3053\u308c\u3089\u3092\u982d\u306b\u53e9\u304d\u8fbc\u3093\u3067\u4f7f\u3063\u3066\u3082\u3089\u3046\u3079\u304f\u7d39\u4ecb\u3059\u308b\u3063\u3066\u306e\u304c\u3053\u306e\u8a18\u4e8b\u306e\u8da3\u65e8\u3067\u3059\uff0enotebook\u304b\u3089\u306emarkdown\u5410\u304d\u51fa\u3057\u306a\u306e\u3067\u591a\u5c11\u306e\u5d29\u308c\u306f\u3054\u5bb9\u8d66\u304f\u3060\u3055\u3044\uff0e\nimport numpy as np\nimport pandas as pd\n\n\n\u4eca\u56de\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u306e\u751f\u6210\n\u4e71\u6570\u3067\u751f\u6210\u3057\u305f\u3053\u306e\u30c7\u30fc\u30bf\u304c\u4eca\u65e5\u306e\u76f8\u68d2\u3067\u3059\uff0e\ndf = pd.DataFrame(np.random.randn(20,5), columns=list('ABCDE'))\ndf\n\n\n\n\n\n\nA\nB\nC\nD\nE\n\n\n\n\n0\n-0.489997\n0.169059\n1.743541\n-0.432755\n-0.595007\n\n\n1\n-1.530363\n0.711810\n-0.382714\n-0.139916\n-1.734980\n\n\n2\n-0.334975\n1.045337\n0.757287\n1.351123\n0.557953\n\n\n3\n0.744929\n0.484988\n0.429293\n-3.272832\n0.261902\n\n\n4\n0.407953\n0.403938\n0.265210\n0.818324\n-0.657293\n\n\n5\n-0.208507\n-0.144381\n-0.553875\n-3.878549\n-0.480763\n\n\n6\n0.019297\n1.503824\n0.680546\n1.415549\n-1.554857\n\n\n7\n1.544483\n-0.209555\n-0.446111\n-0.785419\n0.220515\n\n\n8\n-1.312732\n1.321994\n0.320443\n-2.245312\n-0.409711\n\n\n9\n-0.699864\n0.050989\n-0.189841\n0.269374\n-1.098471\n\n\n10\n1.120992\n0.856170\n0.223470\n-0.822884\n-0.140143\n\n\n11\n-1.173929\n0.155096\n-0.589718\n0.049350\n-0.001723\n\n\n12\n-0.295916\n1.322868\n-0.731492\n-1.995471\n-0.991209\n\n\n13\n1.804382\n0.626075\n-0.383017\n1.078767\n1.487689\n\n\n14\n-0.345145\n-0.318551\n-1.244325\n0.541235\n-0.261979\n\n\n15\n-1.335849\n0.355642\n2.910935\n0.734953\n-0.342311\n\n\n16\n1.148712\n-0.285870\n0.162114\n-0.547444\n2.438300\n\n\n17\n0.073855\n-0.402590\n-1.529420\n-1.099915\n-0.197386\n\n\n18\n-0.445434\n0.468738\n0.097532\n1.569179\n-0.393965\n\n\n19\n-1.885451\n1.426260\n-1.775148\n0.993585\n0.834851\n\n\n\n\n\nlambda\u5f0f\npython\u306b\u306f\u7c21\u6613\u306a\u95a2\u6570\u30ea\u30c6\u30e9\u30eb\u304c\u3042\u308a\u307e\u3059\uff0e\u4f7f\u3044\u65b9\u306f\nlambda \u4eee\u5f15\u6570: \u8fd4\u308a\u5024\n\n\u3067\u3059\uff0e\n\n\u4f8b\uff1a\nfunc = lambda x: x**2\nfunc(2)\n\n4\n\nfunc(3)\n\n9\n\n\napply\n\u5404\u5217\uff08axis=0)\u307e\u305f\u306f\u5404\u884c\uff08axis=1\uff09\u306b\u5bfe\u3057\u3066\u95a2\u6570\u3092\u9069\u7528\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3059.\u8fd4\u308a\u5024\u306fpandas.Series\n\n\u4f8b\uff1a\ndf.apply(lambda x: sum(x), axis=1)\n\n0     0.394842\n1    -3.076163\n2     3.376725\n3    -1.351720\n4     1.238132\n5    -5.266074\n6     2.064360\n7     0.323913\n8    -2.325318\n9    -1.667813\n10    1.237605\n11   -1.560923\n12   -2.691220\n13    4.613897\n14   -1.628766\n15    2.323369\n16    2.915812\n17   -3.155455\n18    1.296050\n19   -0.405903\ndtype: float64\n\n\nassign\n\u65b0\u305f\u306a\u5217\u3092\u4f5c\u6210\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3059\uff0e\n\u8fd4\u308a\u5024\u306f\u540c\u3058\u304fpandas.DataFrame\n\u4e0e\u3048\u308b\u95a2\u6570\u306fpandas.DataFrame\u3092\u3046\u3051\u3068\u3063\u3066pandas.Series\u3092\u8fd4\u3059\u3082\u306e\u3067\u3042\u308c\u3070\u81ea\u7531\u3067\u3059\uff0e\n\n\u4f8b\uff1a\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)\n\n\n\n\n\n\nA\nB\nC\nD\nE\nround_A\nround_B\ntotal\n\n\n\n\n0\n-0.489997\n0.169059\n1.743541\n-0.432755\n-0.595007\n-0\n0\n0.394842\n\n\n1\n-1.530363\n0.711810\n-0.382714\n-0.139916\n-1.734980\n-2\n1\n-3.076163\n\n\n2\n-0.334975\n1.045337\n0.757287\n1.351123\n0.557953\n-0\n1\n3.376725\n\n\n3\n0.744929\n0.484988\n0.429293\n-3.272832\n0.261902\n1\n0\n-1.351720\n\n\n4\n0.407953\n0.403938\n0.265210\n0.818324\n-0.657293\n0\n0\n1.238132\n\n\n5\n-0.208507\n-0.144381\n-0.553875\n-3.878549\n-0.480763\n-0\n-0\n-5.266074\n\n\n6\n0.019297\n1.503824\n0.680546\n1.415549\n-1.554857\n0\n2\n2.064360\n\n\n7\n1.544483\n-0.209555\n-0.446111\n-0.785419\n0.220515\n2\n-0\n0.323913\n\n\n8\n-1.312732\n1.321994\n0.320443\n-2.245312\n-0.409711\n-1\n1\n-2.325318\n\n\n9\n-0.699864\n0.050989\n-0.189841\n0.269374\n-1.098471\n-1\n0\n-1.667813\n\n\n10\n1.120992\n0.856170\n0.223470\n-0.822884\n-0.140143\n1\n1\n1.237605\n\n\n11\n-1.173929\n0.155096\n-0.589718\n0.049350\n-0.001723\n-1\n0\n-1.560923\n\n\n12\n-0.295916\n1.322868\n-0.731492\n-1.995471\n-0.991209\n-0\n1\n-2.691220\n\n\n13\n1.804382\n0.626075\n-0.383017\n1.078767\n1.487689\n2\n1\n4.613897\n\n\n14\n-0.345145\n-0.318551\n-1.244325\n0.541235\n-0.261979\n-0\n-0\n-1.628766\n\n\n15\n-1.335849\n0.355642\n2.910935\n0.734953\n-0.342311\n-1\n0\n2.323369\n\n\n16\n1.148712\n-0.285870\n0.162114\n-0.547444\n2.438300\n1\n-0\n2.915812\n\n\n17\n0.073855\n-0.402590\n-1.529420\n-1.099915\n-0.197386\n0\n-0\n-3.155455\n\n\n18\n-0.445434\n0.468738\n0.097532\n1.569179\n-0.393965\n-0\n0\n1.296050\n\n\n19\n-1.885451\n1.426260\n-1.775148\n0.993585\n0.834851\n-2\n1\n-0.405903\n\n\n\n\n\n\u5217\u306e\u9078\u629e\nsql\u3067\u8a00\u3046\u3068\u3053\u308d\u306eSelect\u306f\npython\ndf[['A', 'B']]\n\n\u3067\u5b9f\u73fe\u3067\u304d\u307e\u3059\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']]\n\n\n\n\n\n\nround_A\nround_B\ntotal\n\n\n\n\n0\n-0\n0\n0.394842\n\n\n1\n-2\n1\n-3.076163\n\n\n2\n-0\n1\n3.376725\n\n\n3\n1\n0\n-1.351720\n\n\n4\n0\n0\n1.238132\n\n\n5\n-0\n-0\n-5.266074\n\n\n6\n0\n2\n2.064360\n\n\n7\n2\n-0\n0.323913\n\n\n8\n-1\n1\n-2.325318\n\n\n9\n-1\n0\n-1.667813\n\n\n10\n1\n1\n1.237605\n\n\n11\n-1\n0\n-1.560923\n\n\n12\n-0\n1\n-2.691220\n\n\n13\n2\n1\n4.613897\n\n\n14\n-0\n-0\n-1.628766\n\n\n15\n-1\n0\n2.323369\n\n\n16\n1\n-0\n2.915812\n\n\n17\n0\n-0\n-3.155455\n\n\n18\n-0\n0\n1.296050\n\n\n19\n-2\n1\n-0.405903\n\n\n\n\n\nrename\n\u5217\u306e\u540d\u524d\u3092\u66f8\u304d\u63db\u3048\u305f\u3044\u3068\u304d\u306frename\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n})\n\n\n\n\n\n\nid\nkey\nvalue\n\n\n\n\n0\n-0\n0\n0.394842\n\n\n1\n-2\n1\n-3.076163\n\n\n2\n-0\n1\n3.376725\n\n\n3\n1\n0\n-1.351720\n\n\n4\n0\n0\n1.238132\n\n\n5\n-0\n-0\n-5.266074\n\n\n6\n0\n2\n2.064360\n\n\n7\n2\n-0\n0.323913\n\n\n8\n-1\n1\n-2.325318\n\n\n9\n-1\n0\n-1.667813\n\n\n10\n1\n1\n1.237605\n\n\n11\n-1\n0\n-1.560923\n\n\n12\n-0\n1\n-2.691220\n\n\n13\n2\n1\n4.613897\n\n\n14\n-0\n-0\n-1.628766\n\n\n15\n-1\n0\n2.323369\n\n\n16\n1\n-0\n2.915812\n\n\n17\n0\n-0\n-3.155455\n\n\n18\n-0\n0\n1.296050\n\n\n19\n-2\n1\n-0.405903\n\n\n\n\n\ngroupby().\u96c6\u8a08\u95a2\u6570()\nmax\u4ee5\u5916\u306b\u3082avg\u3084sum\u306a\u3069\u57fa\u672c\u7684\u306a\u96c6\u8a08\u95a2\u6570\u304c\u6a19\u6e96\u3067\u5099\u3048\u4ed8\u3051\u3089\u308c\u3066\u3044\u307e\u3059\uff0e\n\u8fd4\u308a\u5024\u306b\u306f\u968e\u5c64\u7684\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u6301\u3064DataFrame\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3059\u304c\u3053\u308c\u304c\u5b9f\u306fpandas\u306e\u30cf\u30de\u308a\u3069\u3053\u3060\u3063\u305f\u308a\u3057\u307e\u3059\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max()\n\n\n\n\n\n\n\nvalue\n\n\nid\nkey\n\n\n\n\n\n-2\n1\n-0.405903\n\n\n-1\n0\n2.323369\n\n\n1\n-2.325318\n\n\n-0\n0\n1.296050\n\n\n1\n3.376725\n\n\n2\n2.064360\n\n\n1\n0\n2.915812\n\n\n1\n1.237605\n\n\n2\n0\n0.323913\n\n\n1\n4.613897\n\n\n\n\n\nreset_index\u3068set_index\nindex\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u30c7\u30fc\u30bf\u3068\u3057\u3066\u6271\u3044\u76f4\u3057\u307e\u3059\uff0e\u65b0\u3057\u3044index\u306b\u306f\u518d\u5ea6\u901a\u756a\u304c\u632f\u3089\u308c\u307e\u3059\nset_index\u306f\u6307\u5b9a\u3057\u305f\u5217\u3067index\u3092\u4e0a\u66f8\u304d\u3057\u307e\u3059\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index()\n\n\n\n\n\n\nid\nkey\nvalue\n\n\n\n\n0\n-2\n1\n-0.405903\n\n\n1\n-1\n0\n2.323369\n\n\n2\n-1\n1\n-2.325318\n\n\n3\n-0\n0\n1.296050\n\n\n4\n-0\n1\n3.376725\n\n\n5\n-0\n2\n2.064360\n\n\n6\n1\n0\n2.915812\n\n\n7\n1\n1\n1.237605\n\n\n8\n2\n0\n0.323913\n\n\n9\n2\n1\n4.613897\n\n\n\n\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id')\n\n\n\n\n\n\nkey\nvalue\n\n\nid\n\n\n\n\n\n\n-2\n1\n-0.405903\n\n\n-1\n0\n2.323369\n\n\n-1\n1\n-2.325318\n\n\n-0\n0\n1.296050\n\n\n-0\n1\n3.376725\n\n\n-0\n2\n2.064360\n\n\n1\n0\n2.915812\n\n\n1\n1\n1.237605\n\n\n2\n0\n0.323913\n\n\n2\n1\n4.613897\n\n\n\n\n\npipe\n\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u5168\u4f53\u306b\u5bfe\u3059\u308b\u95a2\u6570\u306e\u9069\u7528\u3067\u3059\uff0e\u3068\u304f\u306b\npython\ndf.pipe(lambda df: df[df.f1 > 0])\n\n\u307f\u305f\u3044\u306a\u3044\u308f\u3086\u308bselect-where\u69cb\u6587\u3089\u3057\u304d\u3042\u306f\u983b\u51fa\u306e\u30a4\u30c7\u30a3\u30aa\u30e0\u3067\u3059\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n)\n\n\n\n\n\n\nkey\nvalue\n\n\nid\n\n\n\n\n\n\n-2\n1\n-0.405903\n\n\n-1\n0\n2.323369\n\n\n-0\n0\n1.296050\n\n\n-0\n1\n3.376725\n\n\n-0\n2\n2.064360\n\n\n1\n0\n2.915812\n\n\n1\n1\n1.237605\n\n\n2\n0\n0.323913\n\n\n2\n1\n4.613897\n\n\n\n\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r')) # suffix\u3092\u8ffd\u52a0\u3057\u3066\u81ea\u5206\u3068\u7d50\u5408\n)\n\n\n\n\n\n\nkey_l\nvalue_l\nkey_r\nvalue_r\n\n\nid\n\n\n\n\n\n\n\n\n-2\n1\n-0.405903\n1\n-0.405903\n\n\n-1\n0\n2.323369\n0\n2.323369\n\n\n-0\n0\n1.296050\n0\n1.296050\n\n\n-0\n0\n1.296050\n1\n3.376725\n\n\n-0\n0\n1.296050\n2\n2.064360\n\n\n-0\n1\n3.376725\n0\n1.296050\n\n\n-0\n1\n3.376725\n1\n3.376725\n\n\n-0\n1\n3.376725\n2\n2.064360\n\n\n-0\n2\n2.064360\n0\n1.296050\n\n\n-0\n2\n2.064360\n1\n3.376725\n\n\n-0\n2\n2.064360\n2\n2.064360\n\n\n1\n0\n2.915812\n0\n2.915812\n\n\n1\n0\n2.915812\n1\n1.237605\n\n\n1\n1\n1.237605\n0\n2.915812\n\n\n1\n1\n1.237605\n1\n1.237605\n\n\n2\n0\n0.323913\n0\n0.323913\n\n\n2\n0\n0.323913\n1\n4.613897\n\n\n2\n1\n4.613897\n0\n0.323913\n\n\n2\n1\n4.613897\n1\n4.613897\n\n\n\n\n\n\u4e00\u65e6\u3044\u308d\u3044\u308d\u6574\u7406\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']]\n\n\n\n\n\n\nkey\nvalue\n\n\n\n\n0\nlabel-4\n-0.405903\n\n\n1\nlabel23\n2.323369\n\n\n2\nlabel39\n6.737135\n\n\n3\nlabel101\n6.737135\n\n\n4\nlabel62\n6.737135\n\n\n5\nlabel58\n4.153417\n\n\n6\nlabel25\n4.153417\n\n\n7\nlabel6\n4.937809\n\n\n8\nlabel92\n4.937809\n\n\n\n\n\npivot\n\u3044\u308f\u3086\u308b'\u7e26\u6301\u3061'\u304b\u3089'\u6a2a\u6301\u3061'\u3078\u306e\u5909\u63db\u3067\u3059\uff0e\n\u3061\u306a\u307f\u306b\u7121\u540d\u306eindex\u306b\u5bfe\u3057\u3066reset_index()\u3092\u4f7f\u3046\u3068\u65b0\u305f\u306bindex\u3068\u3044\u3046\u5217\u304c\u51fa\u6765\u308b\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index()\n\n\n\n\n\n\nindex\nkey\nvalue\n\n\n\n\n0\n0\nlabel-4\n-0.405903\n\n\n1\n1\nlabel23\n2.323369\n\n\n2\n2\nlabel39\n6.737135\n\n\n3\n3\nlabel101\n6.737135\n\n\n4\n4\nlabel62\n6.737135\n\n\n5\n5\nlabel58\n4.153417\n\n\n6\n6\nlabel25\n4.153417\n\n\n7\n7\nlabel6\n4.937809\n\n\n8\n8\nlabel92\n4.937809\n\n\n\n\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n)\n\n\n\n\n\nkey\nlabel-4\nlabel101\nlabel23\nlabel25\nlabel39\nlabel58\nlabel6\nlabel62\nlabel92\n\n\nindex\n\n\n\n\n\n\n\n\n\n\n\n\n\n0\n-0.405903\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n1\nNaN\nNaN\n2.323369\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n2\nNaN\nNaN\nNaN\nNaN\n6.737135\nNaN\nNaN\nNaN\nNaN\n\n\n3\nNaN\n6.737135\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n4\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n6.737135\nNaN\n\n\n5\nNaN\nNaN\nNaN\nNaN\nNaN\n4.153417\nNaN\nNaN\nNaN\n\n\n6\nNaN\nNaN\nNaN\n4.153417\nNaN\nNaN\nNaN\nNaN\nNaN\n\n\n7\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n4.937809\nNaN\nNaN\n\n\n8\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\nNaN\n4.937809\n\n\n\n\n\nfillna\n\u3044\u308f\u3086\u308bnull\u5024\u3092\u57cb\u3081\u308b\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0)\n\n\n\n\n\nkey\nlabel-4\nlabel101\nlabel23\nlabel25\nlabel39\nlabel58\nlabel6\nlabel62\nlabel92\n\n\nindex\n\n\n\n\n\n\n\n\n\n\n\n\n\n0\n-0.405903\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n\n\n1\n0.000000\n0.000000\n2.323369\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n\n\n2\n0.000000\n0.000000\n0.000000\n0.000000\n6.737135\n0.000000\n0.000000\n0.000000\n0.000000\n\n\n3\n0.000000\n6.737135\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n\n\n4\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n6.737135\n0.000000\n\n\n5\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n4.153417\n0.000000\n0.000000\n0.000000\n\n\n6\n0.000000\n0.000000\n0.000000\n4.153417\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n\n\n7\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n4.937809\n0.000000\n0.000000\n\n\n8\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n0.000000\n4.937809\n\n\n\n\n\nastype\n\u30c7\u30fc\u30bf\u578b\u306e\u30ad\u30e3\u30b9\u30c8\uff0ecsv\u306b\u66f8\u304d\u3060\u3057\u305f\u3068\u304d 0.0000000....\u3063\u3066\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff0e\n\u672c\u5f53\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u8907\u96d1\u3067\u3059\u304c\u304d\u307b\u3093\u306f\u3053\u308c\u3067\u3059\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8)\n\n\n\n\n\nkey\nlabel-4\nlabel101\nlabel23\nlabel25\nlabel39\nlabel58\nlabel6\nlabel62\nlabel92\n\n\nindex\n\n\n\n\n\n\n\n\n\n\n\n\n\n0\n0\n0\n0\n0\n0\n0\n0\n0\n0\n\n\n1\n0\n0\n2\n0\n0\n0\n0\n0\n0\n\n\n2\n0\n0\n0\n0\n6\n0\n0\n0\n0\n\n\n3\n0\n6\n0\n0\n0\n0\n0\n0\n0\n\n\n4\n0\n0\n0\n0\n0\n0\n0\n6\n0\n\n\n5\n0\n0\n0\n0\n0\n4\n0\n0\n0\n\n\n6\n0\n0\n0\n4\n0\n0\n0\n0\n0\n\n\n7\n0\n0\n0\n0\n0\n0\n4\n0\n0\n\n\n8\n0\n0\n0\n0\n0\n0\n0\n0\n4\n\n\n\n\n\nstack\n\u3044\u308f\u3086\u308b\u6a2a\u6301\u3061\u304b\u3089\u7e26\u6301\u3061\u3078\u306e\u5909\u63db\uff0e\n\u968e\u5c64\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6301\u3061\u306eSeries\u304c\u5e30\u308a\u307e\u3059\uff0e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306e\u4e16\u754c\u3067\u8f1d\u304d\u7d9a\u3051\u308b\u306b\u306fpipe\u3068\u4e00\u7dd2\u306b\u4f7f\u3044\u307e\u3059\uff0e\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).stack()\n\nindex  key     \n0      label-4     0\n       label101    0\n       label23     0\n       label25     0\n       label39     0\n       label58     0\n       label6      0\n       label62     0\n       label92     0\n1      label-4     0\n       label101    0\n       label23     2\n       label25     0\n       label39     0\n       label58     0\n       label6      0\n       label62     0\n       label92     0\n2      label-4     0\n       label101    0\n       label23     0\n       label25     0\n       label39     6\n       label58     0\n       label6      0\n       label62     0\n       label92     0\n3      label-4     0\n       label101    6\n       label23     0\n                  ..\n5      label6      0\n       label62     0\n       label92     0\n6      label-4     0\n       label101    0\n       label23     0\n       label25     4\n       label39     0\n       label58     0\n       label6      0\n       label62     0\n       label92     0\n7      label-4     0\n       label101    0\n       label23     0\n       label25     0\n       label39     0\n       label58     0\n       label6      4\n       label62     0\n       label92     0\n8      label-4     0\n       label101    0\n       label23     0\n       label25     0\n       label39     0\n       label58     0\n       label6      0\n       label62     0\n       label92     4\ndtype: int8\n\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).pipe(\n    lambda df: pd.DataFrame({'value':df.stack()})\n)\n\n\n\n\n\n\n\nvalue\n\n\nindex\nkey\n\n\n\n\n\n0\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n0\n\n\nlabel25\n0\n\n\nlabel39\n0\n\n\nlabel58\n0\n\n\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n1\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n2\n\n\nlabel25\n0\n\n\nlabel39\n0\n\n\nlabel58\n0\n\n\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n2\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n0\n\n\nlabel25\n0\n\n\nlabel39\n6\n\n\nlabel58\n0\n\n\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n3\nlabel-4\n0\n\n\nlabel101\n6\n\n\nlabel23\n0\n\n\n...\n...\n...\n\n\n5\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n6\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n0\n\n\nlabel25\n4\n\n\nlabel39\n0\n\n\nlabel58\n0\n\n\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n7\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n0\n\n\nlabel25\n0\n\n\nlabel39\n0\n\n\nlabel58\n0\n\n\nlabel6\n4\n\n\nlabel62\n0\n\n\nlabel92\n0\n\n\n8\nlabel-4\n0\n\n\nlabel101\n0\n\n\nlabel23\n0\n\n\nlabel25\n0\n\n\nlabel39\n0\n\n\nlabel58\n0\n\n\nlabel6\n0\n\n\nlabel62\n0\n\n\nlabel92\n4\n\n\n\n81 rows \u00d7 1 columns\n\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).pipe(\n    lambda df: pd.DataFrame({'value':df.stack()})\n).pipe(\n    lambda df: df[df.value != 0]\n)\n\n\n\n\n\n\n\nvalue\n\n\nindex\nkey\n\n\n\n\n\n1\nlabel23\n2\n\n\n2\nlabel39\n6\n\n\n3\nlabel101\n6\n\n\n4\nlabel62\n6\n\n\n5\nlabel58\n4\n\n\n6\nlabel25\n4\n\n\n7\nlabel6\n4\n\n\n8\nlabel92\n4\n\n\n\n\n\n\u3055\u3044\u3054\u306b\n\u307b\u3089\u306d\uff1f\u518d\u5e30\u4ee3\u5165\u306a\u3093\u3066\u3082\u3046\u3084\u3081\u3088\u307f\u3093\u306a\uff01\uff01\n\n\n\n# \u4f1d\u3048\u305f\u3044\u4e8b\n\nR\u8a00\u8a9e\u306b\u304a\u3051\u308b`magrittr`\u305d\u3057\u3066`dplyr`\u306b\u3088\u308b\u30c7\u30fc\u30bf\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306f\u3068\u3066\u3082\u5fc3\u5730\u304c\u826f\u3044\u3067\u3059\uff0e\n\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u304c\u5b9f\u306b\u7f8e\u3057\u3044\u3067\u3059\uff0e\n\n\u4e00\u65b9\uff0c\u3044\u308d\u3093\u306a\u65b9\u304c\u66f8\u3044\u305f`pandas`\u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u306e\u30b3\u30fc\u30c9\u3092\u898b\u3066\u3044\u308b\u3068\n\n```python\ndf = df[df.a >0]\ndf = ...\n\n```\n\u3068\u518d\u5e30\u4ee3\u5165\u3092\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3057\u3066\u3044\u3066\u7f8e\u3057\u304f\u306a\u3044\uff0e\u3084\u3084\u3053\u3057\u3044\u3053\u3068\u3092\u3044\u3046\u3068\u53c2\u7167\u900f\u904e\u6027\u3092\u640d\u3046\uff0e\n\n\u3067\u3082\uff01\uff01\u305d\u3093\u306a\u518d\u5e30\u4ee3\u5165\u3092\u7e70\u308a\u8fd4\u3055\u306a\u304f\u3066\u3082\u3044\u3044\uff0cpandas\u3067\u3082\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3067\u30c7\u30fc\u30bf\u51e6\u7406\u304c\u3067\u304d\u308b\u3063\u3066\u306e\u304c\u4eca\u65e5\u4f1d\u3048\u305f\u3044\u3053\u3068\u3067\u3059\uff0e\n\n\u3068\u304f\u306b\u305c\u3072\u7686\u3055\u3093\u306b\u4f7f\u3063\u3066\u6b32\u3057\u3044method\u305f\u3061\n\n* `pipe`\n* `assign`\n* `reset_index`\n* `set_index`\n* `group_by`\n* `pivot`\n* `stack`\n\n\u3053\u308c\u3089\u3092\u982d\u306b\u53e9\u304d\u8fbc\u3093\u3067\u4f7f\u3063\u3066\u3082\u3089\u3046\u3079\u304f\u7d39\u4ecb\u3059\u308b\u3063\u3066\u306e\u304c\u3053\u306e\u8a18\u4e8b\u306e\u8da3\u65e8\u3067\u3059\uff0enotebook\u304b\u3089\u306emarkdown\u5410\u304d\u51fa\u3057\u306a\u306e\u3067\u591a\u5c11\u306e\u5d29\u308c\u306f\u3054\u5bb9\u8d66\u304f\u3060\u3055\u3044\uff0e\n\n```python\nimport numpy as np\nimport pandas as pd\n```\n\n# \u4eca\u56de\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u306e\u751f\u6210\n\n\u4e71\u6570\u3067\u751f\u6210\u3057\u305f\u3053\u306e\u30c7\u30fc\u30bf\u304c\u4eca\u65e5\u306e\u76f8\u68d2\u3067\u3059\uff0e\n\n\n```python\ndf = pd.DataFrame(np.random.randn(20,5), columns=list('ABCDE'))\ndf\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>A</th>\n      <th>B</th>\n      <th>C</th>\n      <th>D</th>\n      <th>E</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0.489997</td>\n      <td>0.169059</td>\n      <td>1.743541</td>\n      <td>-0.432755</td>\n      <td>-0.595007</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-1.530363</td>\n      <td>0.711810</td>\n      <td>-0.382714</td>\n      <td>-0.139916</td>\n      <td>-1.734980</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-0.334975</td>\n      <td>1.045337</td>\n      <td>0.757287</td>\n      <td>1.351123</td>\n      <td>0.557953</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.744929</td>\n      <td>0.484988</td>\n      <td>0.429293</td>\n      <td>-3.272832</td>\n      <td>0.261902</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.407953</td>\n      <td>0.403938</td>\n      <td>0.265210</td>\n      <td>0.818324</td>\n      <td>-0.657293</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-0.208507</td>\n      <td>-0.144381</td>\n      <td>-0.553875</td>\n      <td>-3.878549</td>\n      <td>-0.480763</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0.019297</td>\n      <td>1.503824</td>\n      <td>0.680546</td>\n      <td>1.415549</td>\n      <td>-1.554857</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1.544483</td>\n      <td>-0.209555</td>\n      <td>-0.446111</td>\n      <td>-0.785419</td>\n      <td>0.220515</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>-1.312732</td>\n      <td>1.321994</td>\n      <td>0.320443</td>\n      <td>-2.245312</td>\n      <td>-0.409711</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>-0.699864</td>\n      <td>0.050989</td>\n      <td>-0.189841</td>\n      <td>0.269374</td>\n      <td>-1.098471</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>1.120992</td>\n      <td>0.856170</td>\n      <td>0.223470</td>\n      <td>-0.822884</td>\n      <td>-0.140143</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>-1.173929</td>\n      <td>0.155096</td>\n      <td>-0.589718</td>\n      <td>0.049350</td>\n      <td>-0.001723</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>-0.295916</td>\n      <td>1.322868</td>\n      <td>-0.731492</td>\n      <td>-1.995471</td>\n      <td>-0.991209</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>1.804382</td>\n      <td>0.626075</td>\n      <td>-0.383017</td>\n      <td>1.078767</td>\n      <td>1.487689</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-0.345145</td>\n      <td>-0.318551</td>\n      <td>-1.244325</td>\n      <td>0.541235</td>\n      <td>-0.261979</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-1.335849</td>\n      <td>0.355642</td>\n      <td>2.910935</td>\n      <td>0.734953</td>\n      <td>-0.342311</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>1.148712</td>\n      <td>-0.285870</td>\n      <td>0.162114</td>\n      <td>-0.547444</td>\n      <td>2.438300</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0.073855</td>\n      <td>-0.402590</td>\n      <td>-1.529420</td>\n      <td>-1.099915</td>\n      <td>-0.197386</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>-0.445434</td>\n      <td>0.468738</td>\n      <td>0.097532</td>\n      <td>1.569179</td>\n      <td>-0.393965</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-1.885451</td>\n      <td>1.426260</td>\n      <td>-1.775148</td>\n      <td>0.993585</td>\n      <td>0.834851</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# lambda\u5f0f\n\npython\u306b\u306f\u7c21\u6613\u306a\u95a2\u6570\u30ea\u30c6\u30e9\u30eb\u304c\u3042\u308a\u307e\u3059\uff0e\u4f7f\u3044\u65b9\u306f\n\n```python\nlambda \u4eee\u5f15\u6570: \u8fd4\u308a\u5024\n```\n\u3067\u3059\uff0e\n\n## \u4f8b\uff1a\n\n\n```python\nfunc = lambda x: x**2\nfunc(2)\n```\n\n\n\n\n    4\n\n\n\n\n```python\nfunc(3)\n```\n\n\n\n\n    9\n\n\n\n# apply\n\n\u5404\u5217\uff08`axis=0`)\u307e\u305f\u306f\u5404\u884c\uff08`axis=1`\uff09\u306b\u5bfe\u3057\u3066\u95a2\u6570\u3092\u9069\u7528\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3059.\u8fd4\u308a\u5024\u306f`pandas.Series`\n\n## \u4f8b\uff1a\n\n\n```python\ndf.apply(lambda x: sum(x), axis=1)\n```\n\n\n\n\n    0     0.394842\n    1    -3.076163\n    2     3.376725\n    3    -1.351720\n    4     1.238132\n    5    -5.266074\n    6     2.064360\n    7     0.323913\n    8    -2.325318\n    9    -1.667813\n    10    1.237605\n    11   -1.560923\n    12   -2.691220\n    13    4.613897\n    14   -1.628766\n    15    2.323369\n    16    2.915812\n    17   -3.155455\n    18    1.296050\n    19   -0.405903\n    dtype: float64\n\n\n\n# assign\n\n\u65b0\u305f\u306a\u5217\u3092\u4f5c\u6210\u3059\u308b\u30e1\u30bd\u30c3\u30c9\u3067\u3059\uff0e\n\n\u8fd4\u308a\u5024\u306f\u540c\u3058\u304f`pandas.DataFrame`\n\u4e0e\u3048\u308b\u95a2\u6570\u306f`pandas.DataFrame`\u3092\u3046\u3051\u3068\u3063\u3066`pandas.Series`\u3092\u8fd4\u3059\u3082\u306e\u3067\u3042\u308c\u3070\u81ea\u7531\u3067\u3059\uff0e\n\n\n## \u4f8b\uff1a\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>A</th>\n      <th>B</th>\n      <th>C</th>\n      <th>D</th>\n      <th>E</th>\n      <th>round_A</th>\n      <th>round_B</th>\n      <th>total</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0.489997</td>\n      <td>0.169059</td>\n      <td>1.743541</td>\n      <td>-0.432755</td>\n      <td>-0.595007</td>\n      <td>-0</td>\n      <td>0</td>\n      <td>0.394842</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-1.530363</td>\n      <td>0.711810</td>\n      <td>-0.382714</td>\n      <td>-0.139916</td>\n      <td>-1.734980</td>\n      <td>-2</td>\n      <td>1</td>\n      <td>-3.076163</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-0.334975</td>\n      <td>1.045337</td>\n      <td>0.757287</td>\n      <td>1.351123</td>\n      <td>0.557953</td>\n      <td>-0</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.744929</td>\n      <td>0.484988</td>\n      <td>0.429293</td>\n      <td>-3.272832</td>\n      <td>0.261902</td>\n      <td>1</td>\n      <td>0</td>\n      <td>-1.351720</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.407953</td>\n      <td>0.403938</td>\n      <td>0.265210</td>\n      <td>0.818324</td>\n      <td>-0.657293</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1.238132</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-0.208507</td>\n      <td>-0.144381</td>\n      <td>-0.553875</td>\n      <td>-3.878549</td>\n      <td>-0.480763</td>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-5.266074</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0.019297</td>\n      <td>1.503824</td>\n      <td>0.680546</td>\n      <td>1.415549</td>\n      <td>-1.554857</td>\n      <td>0</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1.544483</td>\n      <td>-0.209555</td>\n      <td>-0.446111</td>\n      <td>-0.785419</td>\n      <td>0.220515</td>\n      <td>2</td>\n      <td>-0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>-1.312732</td>\n      <td>1.321994</td>\n      <td>0.320443</td>\n      <td>-2.245312</td>\n      <td>-0.409711</td>\n      <td>-1</td>\n      <td>1</td>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>-0.699864</td>\n      <td>0.050989</td>\n      <td>-0.189841</td>\n      <td>0.269374</td>\n      <td>-1.098471</td>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.667813</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>1.120992</td>\n      <td>0.856170</td>\n      <td>0.223470</td>\n      <td>-0.822884</td>\n      <td>-0.140143</td>\n      <td>1</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>-1.173929</td>\n      <td>0.155096</td>\n      <td>-0.589718</td>\n      <td>0.049350</td>\n      <td>-0.001723</td>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.560923</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>-0.295916</td>\n      <td>1.322868</td>\n      <td>-0.731492</td>\n      <td>-1.995471</td>\n      <td>-0.991209</td>\n      <td>-0</td>\n      <td>1</td>\n      <td>-2.691220</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>1.804382</td>\n      <td>0.626075</td>\n      <td>-0.383017</td>\n      <td>1.078767</td>\n      <td>1.487689</td>\n      <td>2</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-0.345145</td>\n      <td>-0.318551</td>\n      <td>-1.244325</td>\n      <td>0.541235</td>\n      <td>-0.261979</td>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-1.628766</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-1.335849</td>\n      <td>0.355642</td>\n      <td>2.910935</td>\n      <td>0.734953</td>\n      <td>-0.342311</td>\n      <td>-1</td>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>1.148712</td>\n      <td>-0.285870</td>\n      <td>0.162114</td>\n      <td>-0.547444</td>\n      <td>2.438300</td>\n      <td>1</td>\n      <td>-0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0.073855</td>\n      <td>-0.402590</td>\n      <td>-1.529420</td>\n      <td>-1.099915</td>\n      <td>-0.197386</td>\n      <td>0</td>\n      <td>-0</td>\n      <td>-3.155455</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>-0.445434</td>\n      <td>0.468738</td>\n      <td>0.097532</td>\n      <td>1.569179</td>\n      <td>-0.393965</td>\n      <td>-0</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-1.885451</td>\n      <td>1.426260</td>\n      <td>-1.775148</td>\n      <td>0.993585</td>\n      <td>0.834851</td>\n      <td>-2</td>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# \u5217\u306e\u9078\u629e\n\nsql\u3067\u8a00\u3046\u3068\u3053\u308d\u306eSelect\u306f\n```python\ndf[['A', 'B']]\n```\n\u3067\u5b9f\u73fe\u3067\u304d\u307e\u3059\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']]\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>round_A</th>\n      <th>round_B</th>\n      <th>total</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0</td>\n      <td>0</td>\n      <td>0.394842</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-2</td>\n      <td>1</td>\n      <td>-3.076163</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-0</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>0</td>\n      <td>-1.351720</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1.238132</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-5.266074</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>2</td>\n      <td>-0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>-1</td>\n      <td>1</td>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.667813</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.560923</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>-0</td>\n      <td>1</td>\n      <td>-2.691220</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>2</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-1.628766</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>1</td>\n      <td>-0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0</td>\n      <td>-0</td>\n      <td>-3.155455</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>-0</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-2</td>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# rename\n\n\u5217\u306e\u540d\u524d\u3092\u66f8\u304d\u63db\u3048\u305f\u3044\u3068\u304d\u306f`rename`\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3044\u307e\u3059\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n})\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0</td>\n      <td>0</td>\n      <td>0.394842</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-2</td>\n      <td>1</td>\n      <td>-3.076163</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-0</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>0</td>\n      <td>-1.351720</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>0</td>\n      <td>1.238132</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-5.266074</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>2</td>\n      <td>-0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>-1</td>\n      <td>1</td>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.667813</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>-1.560923</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>-0</td>\n      <td>1</td>\n      <td>-2.691220</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>2</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-0</td>\n      <td>-0</td>\n      <td>-1.628766</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>1</td>\n      <td>-0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>0</td>\n      <td>-0</td>\n      <td>-3.155455</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>-0</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-2</td>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# groupby().`\u96c6\u8a08\u95a2\u6570`()\n\n`max`\u4ee5\u5916\u306b\u3082`avg`\u3084`sum`\u306a\u3069\u57fa\u672c\u7684\u306a\u96c6\u8a08\u95a2\u6570\u304c\u6a19\u6e96\u3067\u5099\u3048\u4ed8\u3051\u3089\u308c\u3066\u3044\u307e\u3059\uff0e\n\n\u8fd4\u308a\u5024\u306b\u306f\u968e\u5c64\u7684\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u6301\u3064DataFrame\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3059\u304c\u3053\u308c\u304c\u5b9f\u306fpandas\u306e\u30cf\u30de\u308a\u3069\u3053\u3060\u3063\u305f\u308a\u3057\u307e\u3059\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max()\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>id</th>\n      <th>key</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>-2</th>\n      <th>1</th>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">-1</th>\n      <th>0</th>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th rowspan=\"3\" valign=\"top\">-0</th>\n      <th>0</th>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">1</th>\n      <th>0</th>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">2</th>\n      <th>0</th>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>4.613897</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# reset_index\u3068set_index\n\nindex\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u3066\u30c7\u30fc\u30bf\u3068\u3057\u3066\u6271\u3044\u76f4\u3057\u307e\u3059\uff0e\u65b0\u3057\u3044index\u306b\u306f\u518d\u5ea6\u901a\u756a\u304c\u632f\u3089\u308c\u307e\u3059\nset_index\u306f\u6307\u5b9a\u3057\u305f\u5217\u3067index\u3092\u4e0a\u66f8\u304d\u3057\u307e\u3059\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index()\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-2</td>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-1</td>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-1</td>\n      <td>1</td>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>-0</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>-0</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-0</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>1</td>\n      <td>0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>2</td>\n      <td>0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>2</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id')\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>id</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>-2</th>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>-1</th>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>-1</th>\n      <td>1</td>\n      <td>-2.325318</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# pipe\n\n\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u5168\u4f53\u306b\u5bfe\u3059\u308b\u95a2\u6570\u306e\u9069\u7528\u3067\u3059\uff0e\u3068\u304f\u306b\n```python\ndf.pipe(lambda df: df[df.f1 > 0])\n```\n\u307f\u305f\u3044\u306a\u3044\u308f\u3086\u308bselect-where\u69cb\u6587\u3089\u3057\u304d\u3042\u306f\u983b\u51fa\u306e\u30a4\u30c7\u30a3\u30aa\u30e0\u3067\u3059\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>id</th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>-2</th>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>-1</th>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r')) # suffix\u3092\u8ffd\u52a0\u3057\u3066\u81ea\u5206\u3068\u7d50\u5408\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>key_l</th>\n      <th>value_l</th>\n      <th>key_r</th>\n      <th>value_r</th>\n    </tr>\n    <tr>\n      <th>id</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>-2</th>\n      <td>1</td>\n      <td>-0.405903</td>\n      <td>1</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>-1</th>\n      <td>0</td>\n      <td>2.323369</td>\n      <td>0</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>0</td>\n      <td>1.296050</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>0</td>\n      <td>1.296050</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>0</td>\n      <td>1.296050</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>1</td>\n      <td>3.376725</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>1</td>\n      <td>3.376725</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>1</td>\n      <td>3.376725</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>2</td>\n      <td>2.064360</td>\n      <td>0</td>\n      <td>1.296050</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>2</td>\n      <td>2.064360</td>\n      <td>1</td>\n      <td>3.376725</td>\n    </tr>\n    <tr>\n      <th>-0</th>\n      <td>2</td>\n      <td>2.064360</td>\n      <td>2</td>\n      <td>2.064360</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>2.915812</td>\n      <td>0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>2.915812</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1.237605</td>\n      <td>0</td>\n      <td>2.915812</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1.237605</td>\n      <td>1</td>\n      <td>1.237605</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.323913</td>\n      <td>0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0.323913</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>4.613897</td>\n      <td>0</td>\n      <td>0.323913</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>4.613897</td>\n      <td>1</td>\n      <td>4.613897</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# \u4e00\u65e6\u3044\u308d\u3044\u308d\u6574\u7406\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']]\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>label-4</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>label23</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>label39</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>label101</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>label62</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>label58</td>\n      <td>4.153417</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>label25</td>\n      <td>4.153417</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>label6</td>\n      <td>4.937809</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>label92</td>\n      <td>4.937809</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# pivot\n\u3044\u308f\u3086\u308b'\u7e26\u6301\u3061'\u304b\u3089'\u6a2a\u6301\u3061'\u3078\u306e\u5909\u63db\u3067\u3059\uff0e\n\n\u3061\u306a\u307f\u306b\u7121\u540d\u306eindex\u306b\u5bfe\u3057\u3066`reset_index()`\u3092\u4f7f\u3046\u3068\u65b0\u305f\u306b`index`\u3068\u3044\u3046\u5217\u304c\u51fa\u6765\u308b\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index()\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>index</th>\n      <th>key</th>\n      <th>value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>label-4</td>\n      <td>-0.405903</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>label23</td>\n      <td>2.323369</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2</td>\n      <td>label39</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>3</td>\n      <td>label101</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>4</td>\n      <td>label62</td>\n      <td>6.737135</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>5</td>\n      <td>label58</td>\n      <td>4.153417</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>6</td>\n      <td>label25</td>\n      <td>4.153417</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>7</td>\n      <td>label6</td>\n      <td>4.937809</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>8</td>\n      <td>label92</td>\n      <td>4.937809</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>key</th>\n      <th>label-4</th>\n      <th>label101</th>\n      <th>label23</th>\n      <th>label25</th>\n      <th>label39</th>\n      <th>label58</th>\n      <th>label6</th>\n      <th>label62</th>\n      <th>label92</th>\n    </tr>\n    <tr>\n      <th>index</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0.405903</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>2.323369</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>6.737135</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>NaN</td>\n      <td>6.737135</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>6.737135</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>4.153417</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>4.153417</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>4.937809</td>\n      <td>NaN</td>\n      <td>NaN</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>4.937809</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# fillna\n\n\u3044\u308f\u3086\u308bnull\u5024\u3092\u57cb\u3081\u308b\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>key</th>\n      <th>label-4</th>\n      <th>label101</th>\n      <th>label23</th>\n      <th>label25</th>\n      <th>label39</th>\n      <th>label58</th>\n      <th>label6</th>\n      <th>label62</th>\n      <th>label92</th>\n    </tr>\n    <tr>\n      <th>index</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-0.405903</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>2.323369</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>6.737135</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0.000000</td>\n      <td>6.737135</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>6.737135</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>4.153417</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>4.153417</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>4.937809</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>0.000000</td>\n      <td>4.937809</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# astype\n\u30c7\u30fc\u30bf\u578b\u306e\u30ad\u30e3\u30b9\u30c8\uff0ecsv\u306b\u66f8\u304d\u3060\u3057\u305f\u3068\u304d `0.0000000....`\u3063\u3066\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff0e\n\u672c\u5f53\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u8907\u96d1\u3067\u3059\u304c\u304d\u307b\u3093\u306f\u3053\u308c\u3067\u3059\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th>key</th>\n      <th>label-4</th>\n      <th>label101</th>\n      <th>label23</th>\n      <th>label25</th>\n      <th>label39</th>\n      <th>label58</th>\n      <th>label6</th>\n      <th>label62</th>\n      <th>label92</th>\n    </tr>\n    <tr>\n      <th>index</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0</td>\n      <td>0</td>\n      <td>2</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>6</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>0</td>\n      <td>6</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>6</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>4</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>4</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>4</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>4</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# stack\n\n\u3044\u308f\u3086\u308b\u6a2a\u6301\u3061\u304b\u3089\u7e26\u6301\u3061\u3078\u306e\u5909\u63db\uff0e\n\n\u968e\u5c64\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u6301\u3061\u306eSeries\u304c\u5e30\u308a\u307e\u3059\uff0e\u30c7\u30fc\u30bf\u30d5\u30ec\u30fc\u30e0\u306e\u4e16\u754c\u3067\u8f1d\u304d\u7d9a\u3051\u308b\u306b\u306fpipe\u3068\u4e00\u7dd2\u306b\u4f7f\u3044\u307e\u3059\uff0e\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).stack()\n```\n\n\n\n\n    index  key     \n    0      label-4     0\n           label101    0\n           label23     0\n           label25     0\n           label39     0\n           label58     0\n           label6      0\n           label62     0\n           label92     0\n    1      label-4     0\n           label101    0\n           label23     2\n           label25     0\n           label39     0\n           label58     0\n           label6      0\n           label62     0\n           label92     0\n    2      label-4     0\n           label101    0\n           label23     0\n           label25     0\n           label39     6\n           label58     0\n           label6      0\n           label62     0\n           label92     0\n    3      label-4     0\n           label101    6\n           label23     0\n                      ..\n    5      label6      0\n           label62     0\n           label92     0\n    6      label-4     0\n           label101    0\n           label23     0\n           label25     4\n           label39     0\n           label58     0\n           label6      0\n           label62     0\n           label92     0\n    7      label-4     0\n           label101    0\n           label23     0\n           label25     0\n           label39     0\n           label58     0\n           label6      4\n           label62     0\n           label92     0\n    8      label-4     0\n           label101    0\n           label23     0\n           label25     0\n           label39     0\n           label58     0\n           label6      0\n           label62     0\n           label92     4\n    dtype: int8\n\n\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).pipe(\n    lambda df: pd.DataFrame({'value':df.stack()})\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>index</th>\n      <th>key</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">0</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">1</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">2</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"3\" valign=\"top\">3</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <th>...</th>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th rowspan=\"3\" valign=\"top\">5</th>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">6</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">7</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th rowspan=\"9\" valign=\"top\">8</th>\n      <th>label-4</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label101</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label23</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label25</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label39</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label58</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label6</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label62</th>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>label92</th>\n      <td>4</td>\n    </tr>\n  </tbody>\n</table>\n<p>81 rows \u00d7 1 columns</p>\n</div>\n\n\n\n\n```python\ndf.assign(\n    round_A=lambda df: df.A.round(), # \u56db\u6368\u4e94\u5165\n    round_B=lambda df: df.B.round(), # \u56db\u6368\u4e94\u5165\n    total=lambda df: df.apply(lambda row: sum(row), axis=1) # A-E\u306e\u548c\n)[['round_A', 'round_B', 'total']].rename(columns={\n        'round_A': 'id',\n        'round_B': 'key',\n        'total': 'value'\n}).groupby(['id', 'key']).max().reset_index().set_index('id').pipe(\n    lambda df: df[df.value > -2]\n).pipe(\n    lambda df: df.add_suffix('_l').join(df.add_suffix('_r'))\n).reset_index().groupby(['id', 'key_l']).sum().reset_index().assign(\n    key=lambda df: df.value_l.map(lambda x: x*10).round().map(lambda x: 'label' + str(int(x)))\n).rename(columns={\n        'value_r': 'value'\n})[['key', 'value']].reset_index().pivot(\n    'index',\n    'key',\n    'value'\n).fillna(0).astype(np.int8).pipe(\n    lambda df: pd.DataFrame({'value':df.stack()})\n).pipe(\n    lambda df: df[df.value != 0]\n)\n```\n\n\n\n\n<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>value</th>\n    </tr>\n    <tr>\n      <th>index</th>\n      <th>key</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <th>label23</th>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <th>label39</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <th>label101</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <th>label62</th>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <th>label58</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <th>label25</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <th>label6</th>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <th>label92</th>\n      <td>4</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n\n\n\n# \u3055\u3044\u3054\u306b\n\n\u307b\u3089\u306d\uff1f\u518d\u5e30\u4ee3\u5165\u306a\u3093\u3066\u3082\u3046\u3084\u3081\u3088\u307f\u3093\u306a\uff01\uff01\n\n\n```python\n\n```\n", "tags": ["Python", "pandas", "R", "\u30c7\u30fc\u30bf\u5206\u6790", "\u6a5f\u68b0\u5b66\u7fd2"]}