{"context": " More than 1 year has passed since last update.\u7ba1\u7406\u3082\u697d\u3067\u3042\u308b\u3070\u304b\u308a\u304b\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u308b\u306e\u3067\u3001dovecot, postfix, MySQL, postfixAdmin \u3092\u4f7f\u3063\u305f\u904b\u7528\u306b\u3057\u307e\u3059\u3002\n2014\u5e7412\u670820\u65e5\u73fe\u5728\u3001\u305d\u308c\u305e\u308c\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\u53c2\u8003\u6587\u732e\u306b\u306fPostfix \u306f\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3068\u66f8\u3044\u3066\u3042\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001yum\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u554f\u984c\u306a\u304f\u52d5\u4f5c\u78ba\u8a8d\u3067\u304d\u305f\u306e\u3067\u3001yum \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\ndovecot.x86_64 1:2.0.9-8.el6_6.1\npostfix.x86_64 2:2.6.6-6.el6_5\ndovecot-mysql.x86_64 1:2.0.9-8.el6_6.1\ncyrus-sasl.x86_64 2.1.23-15.el6_6.1\npostfix admin 2.92\n\n\u3067\u306f\u3001\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3 example.com \u3092\u5229\u7528\u3057\u3066\u81ea\u524d\u306e\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u6700\u4f4e\u9650\u306e\u69cb\u6210\u3059\u308b\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002http, mysql-server \u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067\u3042\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u9032\u3081\u3066\u307e\u3044\u308a\u307e\u3059\u3002SSL \u3084 \u30b9\u30d1\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3053\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3060\u3051\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002iptables \u306e\u8a2d\u5b9a\u3082\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306eFAQ\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u7701\u7565\u3002\n\u3059\u304f\u306a\u304f\u3068\u3082 vi \u3063\u3066\u4f55\uff1f\u3068\u304b\u3001\u30ed\u30b0\u3063\u3066\u3069\u30fc\u3084\u3063\u3066\u78ba\u8a8d\u3059\u308b\u306e\uff1f\u3068\u3044\u3046\u4eba\u306f\u3068\u3066\u3082\u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u306a\u3093\u3066\u3067\u304d\u307e\u305b\u3093\u3057\u3001\u30b9\u30d1\u30e0\u696d\u8005\u3084\u67b6\u7a7a\u8acb\u6c42\u30e1\u30fc\u30eb\u306e\u914d\u4fe1\u5143\u306b\u4e57\u3063\u53d6\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u304c\u30aa\u30c1\u3067\u3059\u3002\u7d20\u76f4\u306b\u30d7\u30ed\u306b\u983c\u307f\u307e\u3057\u3087\u3046\u3002\n\u3053\u3053\u307e\u3067\u8a00\u308f\u308c\u3066\u3082\u4f5c\u696d\u3092\u9032\u3081\u305f\u3044\u65b9\u306f\u3069\u3046\u305e\u3002\n\u307e\u305a\u306f\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\n$ sudo yum -y install postfix dovecot dovecot-mysql cyrus-sasl\n\npostfix admin \u306b\u5fc5\u8981\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u3082\u3002\n$ sudo yum -y install php-imap\n\n\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u53d7\u3051\u305f\u30e1\u30fc\u30eb\u3092\u51e6\u7406\u3059\u308b\u30e6\u30fc\u30b6\u306e\u8a2d\u5b9a\n$ sudo groupadd -g 10000 vuser\n$ sudo useradd -g vuser -u 10000 vuser\n$ sudo mkdir /mail\n$ sudo chown vuser:vuser /mail\n$ sudo chmod 771 /mail\n\n$ mysql -u root -p\n----------------------------------------------------\nSELECT host,user,password FROM mysql.user;\nDELETE FROM mysql.user WHERE user=\"\";\nSELECT host,user,password FROM mysql.user;\nCREATE DATABASE postfix;\nCREATE USER 'postfix'@'localhost' IDENTIFIED BY 'MySQL\u30d1\u30b9\u30ef\u30fc\u30c9';\nGRANT ALL PRIVILEGES ON `postfix` . * TO 'postfix'@'localhost';\nexit\n----------------------------------------------------\n\n$ cd /etc/postfix/\n\n$ sudo cat <<EOF > mysql_virtual_alias_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = alias\nselect_field = goto\nwhere_field = address\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_domains_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = domain\nselect_field = domain\nwhere_field = domain\nadditional_conditions = and active = '1'\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_mailbox_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = maildir\nwhere_field = username\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_mailbox_limit_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = quota\nwhere_field = username\nEOF\n\n$ sudo chown root:postfix mysql_virtual_*\n$ sudo chmod 640 mysql_virtual_*\n\n\npostfix\uff08\u9001\u4fe1\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a\n\nmain.cf\n$ sudo vi /etc/postfix/main.cf\n\n-------------------------------------------------------------------------------\nmyhostname = mail.example.com\nmydomain = example.com\nmyorigin = $mydomain\ninet_interfaces = all\nrelay_domains = $mydestination\nhome_mailbox = Maildir/\nsmtpd_banner = $myhostname ESMTP unknown\n\nlocal_transport = local\nvirtual_transport = virtual\nvirtual_mailbox_base = /mail\nvirtual_alias_maps = mysql:/etc/postfix/mysql_virtual_alias_maps.cf\nvirtual_alias_domains = $virtual_alias_maps\nvirtual_mailbox_domains = mysql:/etc/postfix/mysql_virtual_domains_maps.cf\nvirtual_mailbox_maps = mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf\nvirtual_minimum_uid = 10000\nvirtual_uid_maps = static:10000\nvirtual_gid_maps = static:10000\n\nmaximal_backoff_time = 800s\nminimal_backoff_time = 100s\nbounce_queue_lifetime = 60m\nmaximal_queue_lifetime = 60m\n\nmessage_size_limit = 20480000\n\nvirtual_mailbox_limit_maps = mysql:/etc/postfix/mysql_virtual_mailbox_limit_maps.cf\nvirtual_mailbox_limit_override = yes\nvirtual_overquota_bounce = yes\nvirtual_mailbox_limit_inbox = yes\n\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_local_domain = $myhostname\nsmtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination\n\n\n$ sudo vi /etc/postfix/master.cf\n\n-------------------------------------------------------------------------------\nsmtp      inet  n       -       n       -       -       smtpd\nsubmission inet n       -       n       -       -       smtpd\n-------------------------------------------------------------------------------\n\n\ndovecot\uff08\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a\nsudo cp /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.org\nsudo vi /etc/dovecot/dovecot.conf\n-------------------------------------------------------------------------------\n#protocols = imap imaps pop3 pop3s\nprotocols = pop3 imap\n\nmail_location = maildir:/mail/%d/%u\n\nfirst_valid_uid = 10000\nfirst_valid_gid = 10000\n\n  #passdb pam {\n\n  #}\n\n  passdb sql {\n    args = /etc/dovecot-mysql.conf\n  }\n\n  #userdb passwd {\n  #}\n\n  userdb sql {\n   args = /etc/dovecot-mysql.conf\n  }\n\n  #mechanisms = plain\n  mechanisms = plain login digest-md5 cram-md5\n\n\nprotocol pop3 {\n  pop3_uidl_format = %08Xu%08Xv\n}\n\n  socket listen {\n    client {\n      path = /var/spool/postfix/private/auth\n      mode = 0660\n      user = postfix\n      group = postfix\n    }\n  }\n-------------------------------------------------------------------------------\n\nsudo cat < /etc/dovecot-mysql.conf\ndriver = mysql\ndefault_pass_scheme = PLAIN\nconnect = dbname=postfix user=postfix host=/var/lib/mysql/mysql.sock password=MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\npassword_query = SELECT password FROM mailbox WHERE username = '%u' AND active = '1'\nuser_query = SELECT concat('/mail/', maildir) as home, 10000 as uid, 10000 as gid FROM mailbox WHERE username = '%u' AND active = '1'\nEOF\n\n\npostfix admin \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncd /usr/local/src\nsudo wget http://downloads.sourceforge.net/project/postfixadmin/postfixadmin/postfixadmin-2.92/postfixadmin-2.92.tar.gz\nsudo tar zxvf postfixadmin-2.92.tar.gz\nsudo mv postfixadmin-2.92/ /var/www/postfixadmin\n\nsudo cd /var/www/postfixadmin\nsudo vi config.inc.php\n----------------------------------------------------\n//$CONF['configured'] = false;\n$CONF['configured'] = true;\n\n//$CONF['default_language'] = 'en';\n$CONF['default_language'] = 'ja';\n\n$CONF['database_type'] = 'mysql';\n$CONF['database_host'] = 'localhost';\n$CONF['database_user'] = 'postfix';\n$CONF['database_password'] = 'MySQL\u30d1\u30b9\u30ef\u30fc\u30c9';\n$CONF['database_name'] = 'postfix';\n$CONF['database_prefix'] = '';\n\n//$CONF['encrypt'] = 'md5crypt';\n$CONF['encrypt'] = 'cleartext';\n\n$CONF['page_size'] = '100';\n\n//$CONF['domain_path'] = 'NO';\n$CONF['domain_path'] = 'YES';\n\n// Default Domain Values\n// Specify your default values below. Quota in MB.\n$CONF['aliases'] = '100';\n$CONF['mailboxes'] = '100';\n$CONF['maxquota'] = '300';\n\n// Quota\n// When you want to enforce quota for your mailbox users set this to 'YES'.\n$CONF['quota'] = 'NO';\n\n$CONF['backup'] = 'NO';\n\n$CONF['sendmail'] = 'NO';\n\n$CONF['fetchmail'] = 'NO';\n\n$CONF['footer_text'] = 'Postfix Admin Top';\n$CONF['footer_link'] = 'http://example.com/postfixadmin/';\n\n$CONF['emailcheck_resolve_domain']='NO';\n----------------------------------------------------\n\n\napache \u306e\u8a2d\u5b9a\nsudo vi /etc/httpd/conf.d/postfixadmin.conf\n----------------------------------------------------\nAlias /postfixadmin \"/var/www/postfixadmin\"\n\n<Directory \"/var/www/postfixadmin\">\n    Order allow,deny\n    Allow from all\n</Directory>\n----------------------------------------------------\napachectl -t\napachectl restart\n\nhttp://example.com/postfixadmin/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3002\u7ba1\u7406\u8005\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3069\u8a2d\u5b9a\u3002\nsudo rm -f /var/www/postfixadmin/setup.php\nsudo rm -f /var/www/postfixadmin/motd*\n\n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nPostfix\u306b\u3088\u308b\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u69cb\u7bc9 (Postfix+MySQL+Dovecot+postfixadmin)\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9 SMTP\u30b5\u30fc\u30d0\u30fc Postfix\n\n\n\u7ba1\u7406\u3082\u697d\u3067\u3042\u308b\u3070\u304b\u308a\u304b\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306b\u3082\u5bfe\u5fdc\u3067\u304d\u308b\u306e\u3067\u3001dovecot, postfix, MySQL, postfixAdmin \u3092\u4f7f\u3063\u305f\u904b\u7528\u306b\u3057\u307e\u3059\u3002\n2014\u5e7412\u670820\u65e5\u73fe\u5728\u3001\u305d\u308c\u305e\u308c\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u53c2\u8003\u6587\u732e\u306b\u306fPostfix \u306f\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u3068\u66f8\u3044\u3066\u3042\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001yum\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3082\u554f\u984c\u306a\u304f\u52d5\u4f5c\u78ba\u8a8d\u3067\u304d\u305f\u306e\u3067\u3001yum \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n* dovecot.x86_64 1:2.0.9-8.el6_6.1\n* postfix.x86_64 2:2.6.6-6.el6_5\n* dovecot-mysql.x86_64 1:2.0.9-8.el6_6.1\n* cyrus-sasl.x86_64 2.1.23-15.el6_6.1\n* postfix admin 2.92\n\n\u3067\u306f\u3001\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3 example.com \u3092\u5229\u7528\u3057\u3066\u81ea\u524d\u306e\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u6700\u4f4e\u9650\u306e\u69cb\u6210\u3059\u308b\u624b\u9806\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002http, mysql-server \u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067\u3042\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u9032\u3081\u3066\u307e\u3044\u308a\u307e\u3059\u3002SSL \u3084 \u30b9\u30d1\u30e0\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u3066\u3044\u308b\u306e\u3067\u3001__\u3053\u3053\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u65b9\u6cd5\u3060\u3051\u3067\u306f\u4e0d\u5341\u5206__\u3067\u3059\u3002[iptables \u306e\u8a2d\u5b9a](https://help.sakura.ad.jp/app/answers/detail/a_id/2423/)\u3082\u3055\u304f\u3089\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306eFAQ\u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u7701\u7565\u3002\n\n\u3059\u304f\u306a\u304f\u3068\u3082 vi \u3063\u3066\u4f55\uff1f\u3068\u304b\u3001\u30ed\u30b0\u3063\u3066\u3069\u30fc\u3084\u3063\u3066\u78ba\u8a8d\u3059\u308b\u306e\uff1f\u3068\u3044\u3046\u4eba\u306f\u3068\u3066\u3082\u30b5\u30fc\u30d0\u30fc\u7ba1\u7406\u306a\u3093\u3066\u3067\u304d\u307e\u305b\u3093\u3057\u3001\u30b9\u30d1\u30e0\u696d\u8005\u3084\u67b6\u7a7a\u8acb\u6c42\u30e1\u30fc\u30eb\u306e\u914d\u4fe1\u5143\u306b\u4e57\u3063\u53d6\u3089\u308c\u3066\u3057\u307e\u3046\u306e\u304c\u30aa\u30c1\u3067\u3059\u3002\u7d20\u76f4\u306b\u30d7\u30ed\u306b\u983c\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u3053\u307e\u3067\u8a00\u308f\u308c\u3066\u3082\u4f5c\u696d\u3092\u9032\u3081\u305f\u3044\u65b9\u306f\u3069\u3046\u305e\u3002\n\n\u307e\u305a\u306f\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\n\n```bash\n$ sudo yum -y install postfix dovecot dovecot-mysql cyrus-sasl\n```\n\npostfix admin \u306b\u5fc5\u8981\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u3082\u3002\n\n```bash\n$ sudo yum -y install php-imap\n```\n\n### \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u53d7\u3051\u305f\u30e1\u30fc\u30eb\u3092\u51e6\u7406\u3059\u308b\u30e6\u30fc\u30b6\u306e\u8a2d\u5b9a\n\n```bash\n$ sudo groupadd -g 10000 vuser\n$ sudo useradd -g vuser -u 10000 vuser\n$ sudo mkdir /mail\n$ sudo chown vuser:vuser /mail\n$ sudo chmod 771 /mail\n```\n\n```bash\n$ mysql -u root -p\n----------------------------------------------------\nSELECT host,user,password FROM mysql.user;\nDELETE FROM mysql.user WHERE user=\"\";\nSELECT host,user,password FROM mysql.user;\nCREATE DATABASE postfix;\nCREATE USER 'postfix'@'localhost' IDENTIFIED BY 'MySQL\u30d1\u30b9\u30ef\u30fc\u30c9';\nGRANT ALL PRIVILEGES ON `postfix` . * TO 'postfix'@'localhost';\nexit\n----------------------------------------------------\n```\n\n```bash\n$ cd /etc/postfix/\n\n$ sudo cat <<EOF > mysql_virtual_alias_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = alias\nselect_field = goto\nwhere_field = address\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_domains_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = domain\nselect_field = domain\nwhere_field = domain\nadditional_conditions = and active = '1'\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_mailbox_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = maildir\nwhere_field = username\nEOF\n\n$ sudo cat <<EOF > mysql_virtual_mailbox_limit_maps.cf\nuser = postfix\npassword = MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = quota\nwhere_field = username\nEOF\n\n$ sudo chown root:postfix mysql_virtual_*\n$ sudo chmod 640 mysql_virtual_*\n```\n\n### postfix\uff08\u9001\u4fe1\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a\n\n```bash:main.cf\n$ sudo vi /etc/postfix/main.cf\n\n-------------------------------------------------------------------------------\nmyhostname = mail.example.com\nmydomain = example.com\nmyorigin = $mydomain\ninet_interfaces = all\nrelay_domains = $mydestination\nhome_mailbox = Maildir/\nsmtpd_banner = $myhostname ESMTP unknown\n\nlocal_transport = local\nvirtual_transport = virtual\nvirtual_mailbox_base = /mail\nvirtual_alias_maps = mysql:/etc/postfix/mysql_virtual_alias_maps.cf\nvirtual_alias_domains = $virtual_alias_maps\nvirtual_mailbox_domains = mysql:/etc/postfix/mysql_virtual_domains_maps.cf\nvirtual_mailbox_maps = mysql:/etc/postfix/mysql_virtual_mailbox_maps.cf\nvirtual_minimum_uid = 10000\nvirtual_uid_maps = static:10000\nvirtual_gid_maps = static:10000\n\nmaximal_backoff_time = 800s\nminimal_backoff_time = 100s\nbounce_queue_lifetime = 60m\nmaximal_queue_lifetime = 60m\n\nmessage_size_limit = 20480000\n\nvirtual_mailbox_limit_maps = mysql:/etc/postfix/mysql_virtual_mailbox_limit_maps.cf\nvirtual_mailbox_limit_override = yes\nvirtual_overquota_bounce = yes\nvirtual_mailbox_limit_inbox = yes\n\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_sasl_local_domain = $myhostname\nsmtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination\n```\n\n```bash\n$ sudo vi /etc/postfix/master.cf\n\n-------------------------------------------------------------------------------\nsmtp      inet  n       -       n       -       -       smtpd\nsubmission inet n       -       n       -       -       smtpd\n-------------------------------------------------------------------------------\n```\n\n### dovecot\uff08\u53d7\u4fe1\u30b5\u30fc\u30d0\u30fc\uff09\u306e\u8a2d\u5b9a\n\n```bash\nsudo cp /etc/dovecot/dovecot.conf /etc/dovecot/dovecot.conf.org\nsudo vi /etc/dovecot/dovecot.conf\n-------------------------------------------------------------------------------\n#protocols = imap imaps pop3 pop3s\nprotocols = pop3 imap\n\nmail_location = maildir:/mail/%d/%u\n\nfirst_valid_uid = 10000\nfirst_valid_gid = 10000\n\n  #passdb pam {\n\n  #}\n\n  passdb sql {\n    args = /etc/dovecot-mysql.conf\n  }\n\n  #userdb passwd {\n  #}\n\n  userdb sql {\n   args = /etc/dovecot-mysql.conf\n  }\n\n  #mechanisms = plain\n  mechanisms = plain login digest-md5 cram-md5\n\n\nprotocol pop3 {\n  pop3_uidl_format = %08Xu%08Xv\n}\n\n  socket listen {\n    client {\n      path = /var/spool/postfix/private/auth\n      mode = 0660\n      user = postfix\n      group = postfix\n    }\n  }\n-------------------------------------------------------------------------------\n```\n\n```bash\nsudo cat < /etc/dovecot-mysql.conf\ndriver = mysql\ndefault_pass_scheme = PLAIN\nconnect = dbname=postfix user=postfix host=/var/lib/mysql/mysql.sock password=MySQL\u30d1\u30b9\u30ef\u30fc\u30c9\npassword_query = SELECT password FROM mailbox WHERE username = '%u' AND active = '1'\nuser_query = SELECT concat('/mail/', maildir) as home, 10000 as uid, 10000 as gid FROM mailbox WHERE username = '%u' AND active = '1'\nEOF\n```\n\n### postfix admin \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\ncd /usr/local/src\nsudo wget http://downloads.sourceforge.net/project/postfixadmin/postfixadmin/postfixadmin-2.92/postfixadmin-2.92.tar.gz\nsudo tar zxvf postfixadmin-2.92.tar.gz\nsudo mv postfixadmin-2.92/ /var/www/postfixadmin\n\nsudo cd /var/www/postfixadmin\nsudo vi config.inc.php\n----------------------------------------------------\n//$CONF['configured'] = false;\n$CONF['configured'] = true;\n\n//$CONF['default_language'] = 'en';\n$CONF['default_language'] = 'ja';\n\n$CONF['database_type'] = 'mysql';\n$CONF['database_host'] = 'localhost';\n$CONF['database_user'] = 'postfix';\n$CONF['database_password'] = 'MySQL\u30d1\u30b9\u30ef\u30fc\u30c9';\n$CONF['database_name'] = 'postfix';\n$CONF['database_prefix'] = '';\n\n//$CONF['encrypt'] = 'md5crypt';\n$CONF['encrypt'] = 'cleartext';\n\n$CONF['page_size'] = '100';\n\n//$CONF['domain_path'] = 'NO';\n$CONF['domain_path'] = 'YES';\n\n// Default Domain Values\n// Specify your default values below. Quota in MB.\n$CONF['aliases'] = '100';\n$CONF['mailboxes'] = '100';\n$CONF['maxquota'] = '300';\n\n// Quota\n// When you want to enforce quota for your mailbox users set this to 'YES'.\n$CONF['quota'] = 'NO';\n\n$CONF['backup'] = 'NO';\n\n$CONF['sendmail'] = 'NO';\n\n$CONF['fetchmail'] = 'NO';\n\n$CONF['footer_text'] = 'Postfix Admin Top';\n$CONF['footer_link'] = 'http://example.com/postfixadmin/';\n\n$CONF['emailcheck_resolve_domain']='NO';\n----------------------------------------------------\n```\n\n### apache \u306e\u8a2d\u5b9a\n\n```bash\nsudo vi /etc/httpd/conf.d/postfixadmin.conf\n----------------------------------------------------\nAlias /postfixadmin \"/var/www/postfixadmin\"\n\n<Directory \"/var/www/postfixadmin\">\n    Order allow,deny\n    Allow from all\n</Directory>\n----------------------------------------------------\napachectl -t\napachectl restart\n```\n\nhttp://example.com/postfixadmin/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u78ba\u8a8d\u3002\u7ba1\u7406\u8005\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3069\u8a2d\u5b9a\u3002\n\n```bash\nsudo rm -f /var/www/postfixadmin/setup.php\nsudo rm -f /var/www/postfixadmin/motd*\n```\n\n### \u53c2\u8003\u30ea\u30f3\u30af\n\n* [Postfix\u306b\u3088\u308b\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u69cb\u7bc9 (Postfix+MySQL+Dovecot+postfixadmin)\n](http://centos.bungu-do.jp/archives/000327.html)\n* [\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9 SMTP\u30b5\u30fc\u30d0\u30fc Postfix](http://www.system-act.com/mail/postfix.html)\n\n", "tags": ["MySQL", "dovecot", "postfix", "\u3055\u304f\u3089VPS"]}