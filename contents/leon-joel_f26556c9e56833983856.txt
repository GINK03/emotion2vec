{"context": "\u8aac\u660e\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u5404\u30c6\u30fc\u30d6\u30eb\u306f blogs \u2190 entries \u2190 comments \u3068\u3044\u3046\u611f\u3058\u306bFK\u53c2\u7167\u3057\u3066\u308b\u3002DDL\u306f\u6700\u5f8c\u306e\u65b9\u306b\u8a18\u8f09\u3002\n\n\u3044\u304d\u306a\u308a\u307e\u3068\u3081\n\npreload\nSELECT\u8907\u6570\u56de\uff08\u89aa\u5b50\u30671\u56de\u305a\u3064\uff09\n\u5b50\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u306f\u4e0d\u53ef\neager_load\nLEFT OUTER JOIN\n\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u3082\u53ef\u80fd\ninclude\npreload\u3068eager_load\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\n\n\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u306a\u3057 OR \u89aa\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u7d5e\u308a\u8fbc\u307f\u306e\u307f\u306e\u5834\u5408 => preload\n\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408 => eager_load\n\n\njoins \u203b\u3053\u308c\u3060\u3051\u5c11\u3057\u6bdb\u8272\u304c\u7570\u306a\u308b\nINNER JOIN\n\u7d50\u679c\u304c\u30d9\u30bf\u306b\uff08\uff1d1\u884c1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\uff09\u8fd4\u3063\u3066\u304f\u308b\n\n\npreload: 2\u6bb5\u968eSELECT\uff08\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u8aad\u307f\uff09\n\n\u89aa\u30c6\u30fc\u30d6\u30eb/\u5b50\u30c6\u30fc\u30d6\u30eb\u30671\u56de\u305a\u3064SELECT\u304c\u8d70\u308b\n\u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u306f\u7d5e\u308a\u8fbc\u3081\u306a\u3044\n\n# \u5b50\u30c6\u30fc\u30d6\u30eb(?)\u5074\u306e\u5148\u8aad\u307f\n# SELECT * FROM blogs WHERE id IN (1, 2)\n# SELECT * FROM entries WHERE blog_id IN (1, 2)\nr = Blog.preload(:entries).where(id: [1, 2])\n\nr.each do |b|\n  p b\n  p b.entries\nend\n\n# \u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u306f\u7d5e\u308a\u8fbc\u3081\u306a\u3044\nr = Blog.preload(:entries).where(entrires: { id: [1, 2] } )\n# => ActiveRecord::StatementInvalid\n\n\neager_load: LEFT OUTER JOIN\n# SELECT *\n#   FROM entries E LEFT OUTER JOIN comments C ON C.entry_id = E.id\n#  WHERE E.id IN (3, 4, 5)\nr = Entry.eager_load(:comments).where(id: [*3..5])\n\nr.each do |b|\n  p b\n  b.comments.each do |c|\n    puts \"=======\"\n    p c\n  end\nend\n\n2\u6bb5\u968e\u306b\uff08\u5b6b\u30c6\u30fc\u30d6\u30eb\u3082\uff09LEFT OUTER JOIN + \u5b50\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\n\nruby\nr = Blog.eager_load(entries: :comments).where(entries: {id: [1, 2]})\n\n\n\nSQL\nSELECT * \n  FROM blogs B \n       LEFT OUTER JOIN entries E ON E.blog_id = B.id \n       LEFT OUTER JOIN comments C ON C.entry_id = E.id \n WHERE E.id IN (1, 2)\n\n\n\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u306e\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u30cf\u30c3\u30b7\u30e5\u3067\u6e21\u305b\u306a\u3044\u5834\u5408\u3067\u3082 references \u3092\u304b\u307e\u3055\u306a\u304f\u3066\u826f\u3044\uff08includes\u3068\u306f\u9055\u3046\u70b9\uff09\n\nruby\nr = Blog.eager_load(entries: :comments).where(\"comments.id <= ?\", 2)\n\n\n\nincludes: preload \u3068 eager_load \u3092\u81ea\u52d5\u5207\u308a\u66ff\u3048\n\u7d5e\u308a\u8fbc\u307f\u306a\u3057 or \u89aa\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u306e\u307f \u306e\u5834\u5408\u306f preload\uff08\u89aa/\u5b50\u30c6\u30fc\u30d6\u30eb\u30671\u56de\u305a\u3064SELECT\u304c\u8d70\u308b\uff09\n\u5b50\u30c6\u30fc\u30d6\u30eb/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u7d5e\u308a\u8fbc\u3093\u3060\u5834\u5408\u306f eager_load\uff08LEFT OUTER JOIN\uff09\n\u3067\u306f\u307e\u305a\u3001\u666e\u901a\u306b\u5b50\u30c6\u30fc\u30d6\u30eb\u307e\u3067\u5148\u8aad\u307f\u3057\u305f\u4f8b\u3002\u7d5e\u308a\u8fbc\u307f\u306f\u89aa\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306e\u307f\u3002\n# \u4ee5\u4e0b2\u3064\u306eSELECT\u304c\u5b9f\u884c\u3055\u308c\u308b\n# SELECT * FROM entries WHERE id = 1\n# SELECT * FROM comments WHERE entry_id IN (1)\nr = Entry.includes(:comments)\n         .where(id: 1)\n\nr.each do |e|\n  # \u89aa\u30c6\u30fc\u30d6\u30eb\u5074\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n  p e\n  # \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\n  p e.comments\nend\n\n2\u6bb5\u968e\u306b\uff08\u5b6b\u30c6\u30fc\u30d6\u30eb\u307e\u3067\uff09\u5148\u8aad\u307f\u3059\u308b\u4f8b\u3002\n\u3053\u3061\u3089\u3082\u7d5e\u308a\u8fbc\u307f\u306f\u89aa\u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3002\n# SELECT\u304c3\u56de\u8d70\u308b\n# SELECT * FROM blogs WHERE (2 <= id)\n# SELECT * FROM entries WHERE blog_id IN (2, 3)\n# SELECT * FROM comments WHERE entry_id IN (1, 2)\nr = Blog.includes(entries: :comments).where(\"? <= id\", 2)\n\nr.each do |b|\n  puts \"###### Blog #{b.id}\"\n  p b\n  b.entries.each do |e|\n    puts \"  ====== Entry #{e.id}\"\n    p e\n\n    e.comments.each do |c|\n      puts \"    -------\"\n      p c\n    end\n  end\nend\n\n\u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u7d5e\u308a\u8fbc\u3080\u3068 LEFT OUTER JOIN \u306b\u3002\n\nruby\nr = Blog.includes(entries: :comments).where(entries: { id: 1 })\n\n\n\nSQL\nSELECT *\n  FROM blogs B\n       LEFT OUTER JOIN entries E ON E.blog_id = B.id -- \u2190OUTER\u3092\u4f7f\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u3053\u306fINNER\u3067\u3082\u7d50\u679c\u306f\u540c\u3058\n       LEFT OUTER JOIN comments C ON C.entry_id = E.id\n WHERE E.id = 1 --\u2190\u5b50\u30c6\u30fc\u30d6\u30ebentries\u306eid\u3067\u7d5e\u308a\u8fbc\u3093\u3067\u3044\u308b\n\n\n\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u30cf\u30c3\u30b7\u30e5\u3067\u6e21\u305b\u306a\u3044\u3068\u304d\u306f references \u3092\u304b\u307e\u3059\u5fc5\u8981\u304c\u3042\u308b\u3063\u307d\u3044\u3002\u751f\u6210\u3055\u308c\u308bSQL\u306fWHERE\u53e5\u4ee5\u5916\u306f\u4e0a\u306e\u3068\u540c\u3058\u3002\n\nruby\nr = Blog.includes(entries: :comments).references(:entries).where(\"entries.id < ?\", 2)\n\n\n\n\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u7d5e\u308a\u8fbc\u3080 \u21d2\u3084\u3063\u3071\u308aLEFT OUTER JOIN\n\nruby\nr = Blog.includes(entries: :comments).where(comments: { id: [*1..3] })\n\n\n\nSQL\nSELECT *\n  FROM blogs B\n       LEFT OUTER JOIN entries E ON E.blog_id = B.id\n       LEFT OUTER JOIN comments C ON C.entry_id = E.id\n WHERE C.id IN (1, 2, 3) -- \u5b6b\u30c6\u30fc\u30d6\u30ebcomments\u306eid\u3067\u7d5e\u308a\u8fbc\u3093\u3067\u3044\u308b\n\n\n\njoins: \u5358\u306a\u308b INNER JOIN\n\u3053\u3044\u3064\u3060\u3051\u4ed6\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u306f\u6bdb\u8272\u304c\u3061\u3087\u3063\u3068\u9055\u3046\u3002\n\n\u5148\u8aad\u307f\u3067\u306f\u306a\u304f\u3001\u7d50\u679c\u304c\u30d9\u30bf\u306b\uff08\uff1d1\u30ec\u30b3\u30fc\u30c91\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\uff09\u8fd4\u3063\u3066\u304f\u308b\nJOIN\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u30ab\u30e9\u30e0\u306f select \u3067\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3044\u3068\u898b\u3048\u306a\u3044\n\n# SELECT blogs.*, entries.title AS entry_title, entries.body\n#   FROM blogs\n#        INNER JOIN entries\n#        ON entries.blog_id = blogs.id\n#  WHERE blogs.id = 1\n#\nr = Blog.joins(:entries)\n        .where(id: 1)\n        .select(\"blogs.*, entries.title AS entry_title, entries.body\")\n\nr.each do |e|\n  p e             # Blog\u306e\u5c5e\u6027\u3057\u304b\u898b\u3048\u306a\u3044\n  p e.attributes  # Blog\u4ee5\u5916\u306e\u5c5e\u6027\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b\n\n  # blogs\u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u3082\u3001entries\u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u3082\u8aad\u3081\u308b\n  puts \"blog title: #{e.title}, entry title: #{e.entry_title}\"\nend\n\n2\u6bb5\u968e\uff08\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3078\u306e\uff09INNER JOIN\u3082\u3044\u3051\u308b\u3002\n\nruby\nr = Blog.joins(entries: :comments)\n        .where(id: 1)\n        .select(\"blogs.*, entries.title AS entry_title, entries.body, comments.body AS comment_body\")\n\n\n\n\u53c2\u8003: \u8aac\u660e\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u69cb\u6210\n\nDDL\n-- \u30d6\u30ed\u30b0\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE blogs\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    title VARCHAR(255),\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL\n);\n\n-- \u30a8\u30f3\u30c8\u30ea\u30fc\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE entries\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    title VARCHAR(255),\n    body TEXT,\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    blog_id INT(11),\n    CONSTRAINT fk_rails_1c7d1d2722 FOREIGN KEY (blog_id) REFERENCES blogs (id)\n);\nCREATE INDEX index_entries_on_blog_id ON entries (blog_id);\n\n-- \u30b3\u30e1\u30f3\u30c8\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE comments\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    body TEXT,\n    status VARCHAR(255),\n    entry_id INT(11),\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    CONSTRAINT fk_rails_24508b7aa5 FOREIGN KEY (entry_id) REFERENCES entries (id)\n);\nCREATE INDEX index_comments_on_entry_id ON comments (entry_id);\n\n\n\n\u74b0\u5883\n\n\n\n\nVersion\n\n\n\n\nOS\nWindows7 x64\n\n\nruby\n2.2\n\n\nActiveRecord\n4.2.6\n\n\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\nActiveRecord\u306ejoins\u3068preload\u3068includes\u3068eager_load\u306e\u9055\u3044\n\u4f3c\u3066\u3044\u308b\u3088\u3046\u3067\u5168\u7136\u9055\u3046!?Activerecord\u306b\u304a\u3051\u308bincludes\u3068joins\u306e\u632f\u308b\u821e\u3044\u307e\u3068\u3081\nRails \u3068 \u30c6\u30fc\u30d6\u30eb\u7d50\u5408 \u203bSQL\u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u65b9\u5f0f\u304c\u79c1\u3068\uff08\u307b\u307c\uff09\u540c\u3058\u3067\u5b09\u3057\u3044\nRails Guides - Active Record \u30af\u30a8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\n\u8aac\u660e\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u5404\u30c6\u30fc\u30d6\u30eb\u306f blogs \u2190 entries \u2190 comments \u3068\u3044\u3046\u611f\u3058\u306bFK\u53c2\u7167\u3057\u3066\u308b\u3002[DDL\u306f\u6700\u5f8c\u306e\u65b9\u306b\u8a18\u8f09](http://qiita.com/leon-joel/items/f26556c9e56833983856#%E3%83%86%E3%83%BC%E3%83%96%E3%83%AB%E6%A7%8B%E6%88%90)\u3002\n\n# \u3044\u304d\u306a\u308a\u307e\u3068\u3081\n\n<dl>\n<dt>preload</dt>\n  <dd>SELECT\u8907\u6570\u56de\uff08\u89aa\u5b50\u30671\u56de\u305a\u3064\uff09</dd>\n  <dd>\u5b50\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u306f\u4e0d\u53ef</dd>\n\n<dt>eager_load</dt>\n  <dd>LEFT OUTER JOIN</dd>\n  <dd>\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u3082\u53ef\u80fd</dd>\n\n<dt>include</dt>\n  <dd>preload\u3068eager_load\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9</dd>\n  <dd>\n    <strong>\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u306a\u3057 OR \u89aa\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u7d5e\u308a\u8fbc\u307f\u306e\u307f\u306e\u5834\u5408 => preload</strong><br>\n    <strong>\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408 => eager_load</strong>\n  </dd>\n<br>\n<dt>joins \u203b\u3053\u308c\u3060\u3051\u5c11\u3057\u6bdb\u8272\u304c\u7570\u306a\u308b</dt>\n  <dd>INNER JOIN</dd>\n  <dd>\u7d50\u679c\u304c\u30d9\u30bf\u306b\uff08\uff1d1\u884c1\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\uff09\u8fd4\u3063\u3066\u304f\u308b</dd>\n</dl>\n\n\n# preload: 2\u6bb5\u968eSELECT\uff08\u5b50\u30c6\u30fc\u30d6\u30eb\u306e\u5148\u8aad\u307f\uff09\n\n - \u89aa\u30c6\u30fc\u30d6\u30eb/\u5b50\u30c6\u30fc\u30d6\u30eb\u30671\u56de\u305a\u3064SELECT\u304c\u8d70\u308b\n - \u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u306f\u7d5e\u308a\u8fbc\u3081\u306a\u3044\n\n```rb\n# \u5b50\u30c6\u30fc\u30d6\u30eb(?)\u5074\u306e\u5148\u8aad\u307f\n# SELECT * FROM blogs WHERE id IN (1, 2)\n# SELECT * FROM entries WHERE blog_id IN (1, 2)\nr = Blog.preload(:entries).where(id: [1, 2])\n\nr.each do |b|\n  p b\n  p b.entries\nend\n\n# \u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u306f\u7d5e\u308a\u8fbc\u3081\u306a\u3044\nr = Blog.preload(:entries).where(entrires: { id: [1, 2] } )\n# => ActiveRecord::StatementInvalid\n```\n\n# eager_load: LEFT OUTER JOIN\n\n```rb\n# SELECT *\n#   FROM entries E LEFT OUTER JOIN comments C ON C.entry_id = E.id\n#  WHERE E.id IN (3, 4, 5)\nr = Entry.eager_load(:comments).where(id: [*3..5])\n\nr.each do |b|\n  p b\n  b.comments.each do |c|\n    puts \"=======\"\n    p c\n  end\nend\n```\n\n2\u6bb5\u968e\u306b\uff08\u5b6b\u30c6\u30fc\u30d6\u30eb\u3082\uff09LEFT OUTER JOIN + \u5b50\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\n\n```rb:ruby\nr = Blog.eager_load(entries: :comments).where(entries: {id: [1, 2]})\n```\n\n```sql:SQL\nSELECT * \n  FROM blogs B \n       LEFT OUTER JOIN entries E ON E.blog_id = B.id \n       LEFT OUTER JOIN comments C ON C.entry_id = E.id \n WHERE E.id IN (1, 2)\n```\n\n\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u306e\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u30cf\u30c3\u30b7\u30e5\u3067\u6e21\u305b\u306a\u3044\u5834\u5408\u3067\u3082 references \u3092\u304b\u307e\u3055\u306a\u304f\u3066\u826f\u3044\uff08includes\u3068\u306f\u9055\u3046\u70b9\uff09\n\n```rb:ruby\nr = Blog.eager_load(entries: :comments).where(\"comments.id <= ?\", 2)\n```\n\n# includes: `preload` \u3068 `eager_load` \u3092\u81ea\u52d5\u5207\u308a\u66ff\u3048\n\n\u7d5e\u308a\u8fbc\u307f\u306a\u3057 or \u89aa\u30c6\u30fc\u30d6\u30eb\u3067\u306e\u7d5e\u308a\u8fbc\u307f\u306e\u307f \u306e\u5834\u5408\u306f `preload`\uff08\u89aa/\u5b50\u30c6\u30fc\u30d6\u30eb\u30671\u56de\u305a\u3064SELECT\u304c\u8d70\u308b\uff09\n\n\u5b50\u30c6\u30fc\u30d6\u30eb/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u7d5e\u308a\u8fbc\u3093\u3060\u5834\u5408\u306f `eager_load`\uff08LEFT OUTER JOIN\uff09\n\n\u3067\u306f\u307e\u305a\u3001\u666e\u901a\u306b\u5b50\u30c6\u30fc\u30d6\u30eb\u307e\u3067\u5148\u8aad\u307f\u3057\u305f\u4f8b\u3002\u7d5e\u308a\u8fbc\u307f\u306f\u89aa\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u306e\u307f\u3002\n\n```rb\n# \u4ee5\u4e0b2\u3064\u306eSELECT\u304c\u5b9f\u884c\u3055\u308c\u308b\n# SELECT * FROM entries WHERE id = 1\n# SELECT * FROM comments WHERE entry_id IN (1)\nr = Entry.includes(:comments)\n         .where(id: 1)\n\nr.each do |e|\n  # \u89aa\u30c6\u30fc\u30d6\u30eb\u5074\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n  p e\n  # \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3068\u3057\u3066\u4fdd\u6301\u3055\u308c\u3066\u3044\u308b\n  p e.comments\nend\n```\n\n2\u6bb5\u968e\u306b\uff08\u5b6b\u30c6\u30fc\u30d6\u30eb\u307e\u3067\uff09\u5148\u8aad\u307f\u3059\u308b\u4f8b\u3002\n\u3053\u3061\u3089\u3082\u7d5e\u308a\u8fbc\u307f\u306f\u89aa\u30c6\u30fc\u30d6\u30eb\u306e\u307f\u3002\n\n```rb\n# SELECT\u304c3\u56de\u8d70\u308b\n# SELECT * FROM blogs WHERE (2 <= id)\n# SELECT * FROM entries WHERE blog_id IN (2, 3)\n# SELECT * FROM comments WHERE entry_id IN (1, 2)\nr = Blog.includes(entries: :comments).where(\"? <= id\", 2)\n\nr.each do |b|\n  puts \"###### Blog #{b.id}\"\n  p b\n  b.entries.each do |e|\n    puts \"  ====== Entry #{e.id}\"\n    p e\n\n    e.comments.each do |c|\n      puts \"    -------\"\n      p c\n    end\n  end\nend\n```\n\n\u5b50\u30c6\u30fc\u30d6\u30eb\u5074\u3067\u7d5e\u308a\u8fbc\u3080\u3068 LEFT OUTER JOIN \u306b\u3002\n\n```rb:ruby\nr = Blog.includes(entries: :comments).where(entries: { id: 1 })\n```\n\n```sql:SQL\nSELECT *\n  FROM blogs B\n       LEFT OUTER JOIN entries E ON E.blog_id = B.id -- \u2190OUTER\u3092\u4f7f\u3063\u3066\u3044\u308b\u304c\u3001\u3053\u3053\u306fINNER\u3067\u3082\u7d50\u679c\u306f\u540c\u3058\n       LEFT OUTER JOIN comments C ON C.entry_id = E.id\n WHERE E.id = 1 --\u2190\u5b50\u30c6\u30fc\u30d6\u30ebentries\u306eid\u3067\u7d5e\u308a\u8fbc\u3093\u3067\u3044\u308b\n```\n\n\u7d5e\u308a\u8fbc\u307f\u6761\u4ef6\u3092\u30cf\u30c3\u30b7\u30e5\u3067\u6e21\u305b\u306a\u3044\u3068\u304d\u306f `references` \u3092\u304b\u307e\u3059\u5fc5\u8981\u304c\u3042\u308b\u3063\u307d\u3044\u3002\u751f\u6210\u3055\u308c\u308bSQL\u306fWHERE\u53e5\u4ee5\u5916\u306f\u4e0a\u306e\u3068\u540c\u3058\u3002\n\n```rb:ruby\nr = Blog.includes(entries: :comments).references(:entries).where(\"entries.id < ?\", 2)\n\n```\n\n\u5b6b\u30c6\u30fc\u30d6\u30eb\u3067\u7d5e\u308a\u8fbc\u3080 \u21d2\u3084\u3063\u3071\u308aLEFT OUTER JOIN\n\n```rb:ruby\nr = Blog.includes(entries: :comments).where(comments: { id: [*1..3] })\n```\n\n```sql:SQL\nSELECT *\n  FROM blogs B\n       LEFT OUTER JOIN entries E ON E.blog_id = B.id\n       LEFT OUTER JOIN comments C ON C.entry_id = E.id\n WHERE C.id IN (1, 2, 3) -- \u5b6b\u30c6\u30fc\u30d6\u30ebcomments\u306eid\u3067\u7d5e\u308a\u8fbc\u3093\u3067\u3044\u308b\n```\n# joins: \u5358\u306a\u308b INNER JOIN\n\u3053\u3044\u3064\u3060\u3051\u4ed6\u306e\u30e1\u30bd\u30c3\u30c9\u3068\u306f\u6bdb\u8272\u304c\u3061\u3087\u3063\u3068\u9055\u3046\u3002\n\n - \u5148\u8aad\u307f\u3067\u306f\u306a\u304f\u3001\u7d50\u679c\u304c\u30d9\u30bf\u306b\uff08\uff1d1\u30ec\u30b3\u30fc\u30c91\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\uff09\u8fd4\u3063\u3066\u304f\u308b\n - JOIN\u3057\u305f\u30c6\u30fc\u30d6\u30eb\u306e\u30ab\u30e9\u30e0\u306f `select` \u3067\u660e\u793a\u7684\u306b\u6307\u5b9a\u3057\u306a\u3044\u3068\u898b\u3048\u306a\u3044\n\n```rb\n# SELECT blogs.*, entries.title AS entry_title, entries.body\n#   FROM blogs\n#        INNER JOIN entries\n#        ON entries.blog_id = blogs.id\n#  WHERE blogs.id = 1\n#\nr = Blog.joins(:entries)\n        .where(id: 1)\n        .select(\"blogs.*, entries.title AS entry_title, entries.body\")\n\nr.each do |e|\n  p e             # Blog\u306e\u5c5e\u6027\u3057\u304b\u898b\u3048\u306a\u3044\n  p e.attributes  # Blog\u4ee5\u5916\u306e\u5c5e\u6027\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b\n\n  # blogs\u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u3082\u3001entries\u30c6\u30fc\u30d6\u30eb\u306e\u5c5e\u6027\u3082\u8aad\u3081\u308b\n  puts \"blog title: #{e.title}, entry title: #{e.entry_title}\"\nend\n```\n\n2\u6bb5\u968e\uff08\u5b50/\u5b6b\u30c6\u30fc\u30d6\u30eb\u3078\u306e\uff09INNER JOIN\u3082\u3044\u3051\u308b\u3002\n\n```rb:ruby\nr = Blog.joins(entries: :comments)\n        .where(id: 1)\n        .select(\"blogs.*, entries.title AS entry_title, entries.body, comments.body AS comment_body\")\n```\n\n# \u53c2\u8003: \u8aac\u660e\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u306e\u69cb\u6210\n\n```sql:DDL\n-- \u30d6\u30ed\u30b0\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE blogs\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    title VARCHAR(255),\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL\n);\n\n-- \u30a8\u30f3\u30c8\u30ea\u30fc\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE entries\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    title VARCHAR(255),\n    body TEXT,\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    blog_id INT(11),\n    CONSTRAINT fk_rails_1c7d1d2722 FOREIGN KEY (blog_id) REFERENCES blogs (id)\n);\nCREATE INDEX index_entries_on_blog_id ON entries (blog_id);\n\n-- \u30b3\u30e1\u30f3\u30c8\u30c6\u30fc\u30d6\u30eb\nCREATE TABLE comments\n(\n    id INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,\n    body TEXT,\n    status VARCHAR(255),\n    entry_id INT(11),\n    created_at DATETIME NOT NULL,\n    updated_at DATETIME NOT NULL,\n    CONSTRAINT fk_rails_24508b7aa5 FOREIGN KEY (entry_id) REFERENCES entries (id)\n);\nCREATE INDEX index_comments_on_entry_id ON comments (entry_id);\n```\n\n\n# \u74b0\u5883\n\n|  | Version |\n|:-:|:-:|\n|OS| Windows7 x64|\n|ruby   | 2.2  |\n|ActiveRecord   |4.2.6   |\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\n[ActiveRecord\u306ejoins\u3068preload\u3068includes\u3068eager_load\u306e\u9055\u3044](http://qiita.com/k0kubun/items/80c5a5494f53bb88dc58)\n[\u4f3c\u3066\u3044\u308b\u3088\u3046\u3067\u5168\u7136\u9055\u3046!?Activerecord\u306b\u304a\u3051\u308bincludes\u3068joins\u306e\u632f\u308b\u821e\u3044\u307e\u3068\u3081](http://qiita.com/south37/items/b2c81932756d2cd84d7d)\n[Rails \u3068 \u30c6\u30fc\u30d6\u30eb\u7d50\u5408](http://qiita.com/merrill/items/de6eb7e899753ad3361a) \u203bSQL\u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u65b9\u5f0f\u304c\u79c1\u3068\uff08\u307b\u307c\uff09\u540c\u3058\u3067\u5b09\u3057\u3044:smile:\n[Rails Guides - Active Record \u30af\u30a8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9](http://railsguides.jp/active_record_querying.html)\n\n", "tags": ["ActiveRecord"]}