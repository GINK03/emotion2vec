{"context": " More than 1 year has passed since last update.Apache Camel\u3067\u81ea\u5206\u306e\u7d30\u304b\u3044\u4f5c\u696d\u3092\u81ea\u52d5\u5316\u3057\u3088\u3046\u3068\u3057\u305f\u6642\u306e\u30e1\u30e2\u3002\n\u4ee5\u524d\u306b\u3082\u540c\u3058\u76ee\u7684\u3067\u5b9f\u88c5\u65b9\u6cd5\u304c\u9055\u3046\u306e\u3092Apache Camel\u3067\u4f5c\u3063\u305f\u3051\u3069\u4eca\u56de\u306e\u304c\u591a\u5206\u4e00\u756a\u30de\u30b7\u3060\u3068\u601d\u3046\u3002\n\u5165\u308a\u53e3\u306fdirect:report\u3067Body\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092reports/report.tsv\u306b\u51fa\u529b\u3059\u308b\u3002\nDateTimeAPI\u3058\u3083\u306a\u304f\u3066JodaTime\u4f7f\u3063\u3066\u308b\u306e\u306f\u305f\u3060\u306e\u6c17\u307e\u3050\u308c\u3002\n\u307e\u305a\u306fpom.xml\u3002\n\npom.xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n    xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n    <modelVersion>4.0.0</modelVersion>\n    <groupId>net.camel.client</groupId>\n    <artifactId>camel-client</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n\n    <properties>\n        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n        <java.version>1.8</java.version>\n        <camel.version>2.13.2</camel.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.apache.camel</groupId>\n            <artifactId>camel-core</artifactId>\n            <version>${camel.version}</version>\n            <exclusions>\n                <exclusion>\n                    <groupId>org.slf4j</groupId>\n                    <artifactId>slf4j-api</artifactId>\n                </exclusion>\n            </exclusions>\n        </dependency>\n        <dependency>\n            <groupId>org.slf4j</groupId>\n            <artifactId>slf4j-simple</artifactId>\n            <version>1.7.7</version>\n        </dependency>\n        <dependency>\n            <groupId>com.google.guava</groupId>\n            <artifactId>guava</artifactId>\n            <version>17.0</version>\n        </dependency>\n        <dependency>\n            <groupId>joda-time</groupId>\n            <artifactId>joda-time</artifactId>\n            <version>2.4</version>\n        </dependency>\n    </dependencies>\n</project>\n\n\n\u305d\u3057\u3066main\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3068\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\u30af\u30e9\u30b9\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u304b\u3089TSV\u306e\u6587\u5b57\u5217\u3092\u4f5c\u6210\u3059\u308b\u30af\u30e9\u30b9\u3002\nprocess\u30e1\u30bd\u30c3\u30c9\u306b\u81ea\u4f5c\u306eProcessor\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u3060\u3051\u3002\n\nApplication.java\npackage net.camel.client;\n\nimport net.camel.client.processor.FileListProcessor;\nimport net.camel.client.processor.FileListToTsvStringProcessor;\n\nimport org.apache.camel.CamelContext;\nimport org.apache.camel.builder.RouteBuilder;\nimport org.apache.camel.impl.DefaultCamelContext;\n\npublic class Application {\n\n    public static void main(String[] args) throws Exception {\n        CamelContext context = new DefaultCamelContext();\n\n        context.addRoutes(new RouteBuilder() {\n\n            @Override\n            public void configure() throws Exception {\n                // \u6307\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u51fa\u529b\n                from(\"direct:report\")\n                        .process(new FileListProcessor())\n                        .process(new FileListToTsvStringProcessor())\n                        .to(\"file:reports/?fileName=report.tsv\");\n            }\n        });\n\n        context.start();\n\n        context.createProducerTemplate().sendBody(\"direct:report\", \"e:\\\\\");\n\n        Runtime.getRuntime().addShutdownHook(new Thread(() -> {\n            try {\n                context.stop();\n            } catch (Exception e) {\n            }\n        }));\n\n        while (true) {\n        }\n    }\n}\n\n\n\nFileListProcessor.java\npackage net.camel.client.processor;\n\nimport java.io.File;\nimport java.util.List;\nimport java.util.stream.Stream;\n\nimport org.apache.camel.Exchange;\nimport org.apache.camel.Processor;\n\nimport com.google.common.collect.Lists;\n\npublic class FileListProcessor implements Processor {\n\n    @Override\n    public void process(Exchange exchange) throws Exception {\n        List<File> files = getFiles(exchange.getIn().getBody(String.class));\n        exchange.getIn().setBody(files);\n    }\n\n    private List<File> getFiles(String path) {\n        File directory = new File(path);\n        List<File> files = Lists.newArrayList();\n        Stream<File> stream = Stream.of(directory.listFiles((dir, name) -> {\n            return !(name.contains(\"RECYCLE.BIN\")\n                || name.contains(\"System Volume Information\"));\n        }));\n        stream.forEach(file -> {\n            if (file.isDirectory()) {\n                files.addAll(getFiles(file.getAbsolutePath()));\n            } else {\n                files.add(file);\n            }\n        });\n        return files;\n    }\n}\n\n\n\nFileListToTsvStringProcessor.java\npackage net.camel.client.processor;\n\nimport java.io.File;\nimport java.util.List;\n\nimport org.apache.camel.Exchange;\nimport org.apache.camel.Processor;\nimport org.joda.time.format.DateTimeFormat;\nimport org.joda.time.format.DateTimeFormatter;\n\npublic class FileListToTsvStringProcessor implements Processor {\n\n    @SuppressWarnings(\"unchecked\")\n    @Override\n    public void process(Exchange exchange) throws Exception {\n        List<File> files = exchange.getIn().getBody(List.class);\n        StringBuilder tsv = new StringBuilder();\n        DateTimeFormatter formatter = DateTimeFormat.forPattern(\"yyyy/MM/dd HH:mm:ss\");\n        files.forEach(file -> {\n            tsv.append(file.getAbsolutePath());\n            tsv.append(\"\\t\");\n            tsv.append(formatter.print(file.lastModified()));\n            tsv.append(\"\\n\");\n        });\n        exchange.getIn().setBody(tsv.toString());\n    }\n}\n\n\nApache Camel\u3067\u81ea\u5206\u306e\u7d30\u304b\u3044\u4f5c\u696d\u3092\u81ea\u52d5\u5316\u3057\u3088\u3046\u3068\u3057\u305f\u6642\u306e\u30e1\u30e2\u3002\n\u4ee5\u524d\u306b\u3082\u540c\u3058\u76ee\u7684\u3067\u5b9f\u88c5\u65b9\u6cd5\u304c\u9055\u3046\u306e\u3092Apache Camel\u3067\u4f5c\u3063\u305f\u3051\u3069\u4eca\u56de\u306e\u304c\u591a\u5206\u4e00\u756a\u30de\u30b7\u3060\u3068\u601d\u3046\u3002\n\n\u5165\u308a\u53e3\u306f`direct:report`\u3067Body\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092`reports/report.tsv`\u306b\u51fa\u529b\u3059\u308b\u3002\n\nDateTimeAPI\u3058\u3083\u306a\u304f\u3066JodaTime\u4f7f\u3063\u3066\u308b\u306e\u306f\u305f\u3060\u306e\u6c17\u307e\u3050\u308c\u3002\n\n\u307e\u305a\u306fpom.xml\u3002\n\n```xml:pom.xml\n<project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n\txsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n\t<modelVersion>4.0.0</modelVersion>\n\t<groupId>net.camel.client</groupId>\n\t<artifactId>camel-client</artifactId>\n\t<version>0.0.1-SNAPSHOT</version>\n\n\t<properties>\n\t\t<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>\n\t\t<java.version>1.8</java.version>\n\t\t<camel.version>2.13.2</camel.version>\n\t</properties>\n\n\t<dependencies>\n\t\t<dependency>\n\t\t\t<groupId>org.apache.camel</groupId>\n\t\t\t<artifactId>camel-core</artifactId>\n\t\t\t<version>${camel.version}</version>\n\t\t\t<exclusions>\n\t\t\t\t<exclusion>\n\t\t\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t\t\t<artifactId>slf4j-api</artifactId>\n\t\t\t\t</exclusion>\n\t\t\t</exclusions>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>org.slf4j</groupId>\n\t\t\t<artifactId>slf4j-simple</artifactId>\n\t\t\t<version>1.7.7</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>com.google.guava</groupId>\n\t\t\t<artifactId>guava</artifactId>\n\t\t\t<version>17.0</version>\n\t\t</dependency>\n\t\t<dependency>\n\t\t\t<groupId>joda-time</groupId>\n\t\t\t<artifactId>joda-time</artifactId>\n\t\t\t<version>2.4</version>\n\t\t</dependency>\n\t</dependencies>\n</project>\n```\n\n\u305d\u3057\u3066main\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3068\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u3092\u53d6\u5f97\u3059\u308b\u30af\u30e9\u30b9\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u30ea\u30b9\u30c8\u304b\u3089TSV\u306e\u6587\u5b57\u5217\u3092\u4f5c\u6210\u3059\u308b\u30af\u30e9\u30b9\u3002\nprocess\u30e1\u30bd\u30c3\u30c9\u306b\u81ea\u4f5c\u306eProcessor\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u3060\u3051\u3002\n\n```java:Application.java\npackage net.camel.client;\n\nimport net.camel.client.processor.FileListProcessor;\nimport net.camel.client.processor.FileListToTsvStringProcessor;\n\nimport org.apache.camel.CamelContext;\nimport org.apache.camel.builder.RouteBuilder;\nimport org.apache.camel.impl.DefaultCamelContext;\n\npublic class Application {\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tCamelContext context = new DefaultCamelContext();\n\n\t\tcontext.addRoutes(new RouteBuilder() {\n\n\t\t\t@Override\n\t\t\tpublic void configure() throws Exception {\n\t\t\t\t// \u6307\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u51fa\u529b\n\t\t\t\tfrom(\"direct:report\")\n\t\t\t\t\t\t.process(new FileListProcessor())\n\t\t\t\t\t\t.process(new FileListToTsvStringProcessor())\n\t\t\t\t\t\t.to(\"file:reports/?fileName=report.tsv\");\n\t\t\t}\n\t\t});\n\n\t\tcontext.start();\n\n\t\tcontext.createProducerTemplate().sendBody(\"direct:report\", \"e:\\\\\");\n\n\t\tRuntime.getRuntime().addShutdownHook(new Thread(() -> {\n\t\t\ttry {\n\t\t\t\tcontext.stop();\n\t\t\t} catch (Exception e) {\n\t\t\t}\n\t\t}));\n\n\t\twhile (true) {\n\t\t}\n\t}\n}\n```\n\n```java:FileListProcessor.java\npackage net.camel.client.processor;\n\nimport java.io.File;\nimport java.util.List;\nimport java.util.stream.Stream;\n\nimport org.apache.camel.Exchange;\nimport org.apache.camel.Processor;\n\nimport com.google.common.collect.Lists;\n\npublic class FileListProcessor implements Processor {\n\n\t@Override\n\tpublic void process(Exchange exchange) throws Exception {\n\t\tList<File> files = getFiles(exchange.getIn().getBody(String.class));\n\t\texchange.getIn().setBody(files);\n\t}\n\n\tprivate List<File> getFiles(String path) {\n\t\tFile directory = new File(path);\n\t\tList<File> files = Lists.newArrayList();\n\t\tStream<File> stream = Stream.of(directory.listFiles((dir, name) -> {\n\t\t\treturn !(name.contains(\"RECYCLE.BIN\")\n\t\t\t\t|| name.contains(\"System Volume Information\"));\n\t\t}));\n\t\tstream.forEach(file -> {\n\t\t\tif (file.isDirectory()) {\n\t\t\t\tfiles.addAll(getFiles(file.getAbsolutePath()));\n\t\t\t} else {\n\t\t\t\tfiles.add(file);\n\t\t\t}\n\t\t});\n\t\treturn files;\n\t}\n}\n```\n\n```java:FileListToTsvStringProcessor.java\npackage net.camel.client.processor;\n\nimport java.io.File;\nimport java.util.List;\n\nimport org.apache.camel.Exchange;\nimport org.apache.camel.Processor;\nimport org.joda.time.format.DateTimeFormat;\nimport org.joda.time.format.DateTimeFormatter;\n\npublic class FileListToTsvStringProcessor implements Processor {\n\n\t@SuppressWarnings(\"unchecked\")\n\t@Override\n\tpublic void process(Exchange exchange) throws Exception {\n\t\tList<File> files = exchange.getIn().getBody(List.class);\n\t\tStringBuilder tsv = new StringBuilder();\n\t\tDateTimeFormatter formatter = DateTimeFormat.forPattern(\"yyyy/MM/dd HH:mm:ss\");\n\t\tfiles.forEach(file -> {\n\t\t\ttsv.append(file.getAbsolutePath());\n\t\t\ttsv.append(\"\\t\");\n\t\t\ttsv.append(formatter.print(file.lastModified()));\n\t\t\ttsv.append(\"\\n\");\n\t\t});\n\t\texchange.getIn().setBody(tsv.toString());\n\t}\n}\n```\n", "tags": ["Java1.8.0_05", "apache-camel"]}