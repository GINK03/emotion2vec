{"tags": ["Android", "DataBinding", "Espresso"], "context": "Data binding \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u3044\u308b Android \u30a2\u30d7\u30ea\u3092 Espresso \u3068\u7d44\u307f\u5408\u308f\u305b\u3066 (?) instrumented tests (./gradlew connectedAndroidTest) \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4f8b\u5916\u3067\u30c6\u30b9\u30c8\u306b\u5931\u6557\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\njava.lang.ClassCastException: java.lang.String cannot be cast to <our.app.DataBindingType>\n\n\n\u767a\u751f\u3059\u308b\u554f\u984c\n\u79c1\u304c\u5b9f\u969b\u306b\u906d\u9047\u3057\u305f\u306e\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3002\nyour.app.package.id.TargetActivityTest > yourTestMethodName[Nexus 5 - 6.0.1] FAILED\n        java.lang.RuntimeException: Unable to start activity ComponentInfo{your.app.package.id/your.app.package.id.TargetActivity}: java.lang.ClassCastException: java.lang.String cannot be cast to your.app.package.id.databinding.ActivityTargetBinding\n        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2416)\n\nTests on Nexus 5 - 6.0.1 failed: Instrumentation run failed due to 'java.lang.ClassCastException'\n:app:connectedDebugAndroidTest FAILED\n\n\n\u5831\u544a\n\u4ee5\u4e0b\u3067\u5831\u544a\u3055\u308c\u3066\u3044\u308b\u3002\n\nIssue 182715: Data Binding & Espresso: IllegalAccessError: Class ref in pre-verified class resolved to unexpected implementation - Android Open Source Project - Issue Tracker - Google Project Hosting\nEspresso test fails with java.lang.String cannot be cast to com.abc.events.databinding.SponsorDetailBinding\n\n\u79c1\u306f\u906d\u9047\u3057\u3066\u3044\u306a\u3044\u306e\u3060\u3051\u308c\u3069\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u3082\u3042\u308b\u6a21\u69d8\u3002\njava.lang.IllegalAccessError: Class ref in pre-verified class resolved to unexpected implementation\n    at android.databinding.DataBindingUtil.<clinit>(DataBindingUtil.java:31)\n    at com.espresso.databinding.MainActivity.onCreate(MainActivity.java:15)\n\n\n\u5bfe\u5fdc\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306b workaround \u304c\u66f8\u304b\u308c\u3066\u3044\u305f\u3002 \u3069\u3046\u3084\u3089 Data Binding \u306e\u305f\u3081\u306e\u30bf\u30b9\u30af\u304c androidTest \u5411\u3051\u306b\u3082\u52d5\u3044\u3066\u3044\u3066\u3001\u305d\u308c\u304c\u539f\u56e0\u3067\u304a\u304b\u3057\u304f\u306a\u3063\u3066\u308b\u307d\u3044\u3002\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306e workaround \u3092\u3082\u3068\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092 build.gradle \u306b\u66f8\u3044\u3066\u3068\u308a\u3042\u3048\u305a\u56de\u907f\u3057\u305f\u3002\nproject.afterEvaluate {\n    def targetTasks = tasks.findAll({ it.name ==~ /\\AdataBindingExportBuildInfo.*AndroidTest\\z/ }).each {\n        it.deleteAllActions()\n    }\n    // \u5c06\u6765\u4e88\u671f\u305b\u305a\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308b\u306a\u3069\u3057\u305f\u3068\u304d\u306e\u305f\u3081\u306b\u4f8b\u5916\u3092\u6295\u3052\u308b\u3002\n    if (targetTasks.empty) throw new RuntimeException('\u5bfe\u8c61\u3068\u306a\u308b\u30bf\u30b9\u30af\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ' +\n            'Data binding \u3068 Espresso \u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u305f\u3081\u306e workaround \u304c\u4e0d\u8981\u306b\u306a\u3063\u305f\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 ' +\n            '\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002')\n}\n\ndataBindingExportBuildInfoDebugAndroidTest \u3084 dataBindingExportBuildInfoReleaseAndroidTest \u3068\u3044\u3063\u305f\u30bf\u30b9\u30af\u306e\u51e6\u7406\u3092\u5168\u90e8\u7121\u304f\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u3082\u306e\u3002\n\u5c06\u6765\u30bf\u30b9\u30af\u540d\u304c\u5909\u66f4\u3055\u308c\u305f\u308a\u3057\u3066 workaround \u306e\u30b3\u30fc\u30c9\u304c\u52d5\u304b\u306a\u304f\u306a\u3063\u305f\u3068\u304d\u306b\u6c17\u4ed8\u304f\u3088\u3046\u306b\u4f8b\u5916\u3092\u6295\u3052\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3044\u305f\u3002\n[Data binding \u30e9\u30a4\u30d6\u30e9\u30ea](http://developer.android.com/intl/ja/tools/data-binding/guide.html)\u3092\u4f7f\u3063\u3066\u3044\u308b Android \u30a2\u30d7\u30ea\u3092 [Espresso](http://developer.android.com/intl/ja/tools/testing-support-library/index.html#Espresso) \u3068\u7d44\u307f\u5408\u308f\u305b\u3066 (?) instrumented tests (`./gradlew connectedAndroidTest`) \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4f8b\u5916\u3067\u30c6\u30b9\u30c8\u306b\u5931\u6557\u3059\u308b\u3053\u3068\u304c\u3042\u308b\u3002\n\n> java.lang.ClassCastException: java.lang.String cannot be cast to &lt;our.app.DataBindingType>\n\n## \u767a\u751f\u3059\u308b\u554f\u984c\n\n\u79c1\u304c\u5b9f\u969b\u306b\u906d\u9047\u3057\u305f\u306e\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3002\n\n```\nyour.app.package.id.TargetActivityTest > yourTestMethodName[Nexus 5 - 6.0.1] FAILED\n        java.lang.RuntimeException: Unable to start activity ComponentInfo{your.app.package.id/your.app.package.id.TargetActivity}: java.lang.ClassCastException: java.lang.String cannot be cast to your.app.package.id.databinding.ActivityTargetBinding\n        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2416)\n\nTests on Nexus 5 - 6.0.1 failed: Instrumentation run failed due to 'java.lang.ClassCastException'\n:app:connectedDebugAndroidTest FAILED\n```\n\n## \u5831\u544a\n\n\u4ee5\u4e0b\u3067\u5831\u544a\u3055\u308c\u3066\u3044\u308b\u3002\n\n- [Issue 182715: Data Binding & Espresso: IllegalAccessError: Class ref in pre-verified class resolved to unexpected implementation - Android Open Source Project - Issue Tracker - Google Project Hosting](https://code.google.com/p/android/issues/detail?id=182715)\n- [Espresso test fails with java.lang.String cannot be cast to com.abc.events.databinding.SponsorDetailBinding](http://stackoverflow.com/questions/33890393/espresso-test-fails-with-java-lang-string-cannot-be-cast-to-com-abc-events-datab - Stack Overflow)\n\n\u79c1\u306f\u906d\u9047\u3057\u3066\u3044\u306a\u3044\u306e\u3060\u3051\u308c\u3069\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3053\u3068\u3082\u3042\u308b\u6a21\u69d8\u3002\n\n```\njava.lang.IllegalAccessError: Class ref in pre-verified class resolved to unexpected implementation\n    at android.databinding.DataBindingUtil.<clinit>(DataBindingUtil.java:31)\n    at com.espresso.databinding.MainActivity.onCreate(MainActivity.java:15)\n```\n\n## \u5bfe\u5fdc\n\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306b workaround \u304c\u66f8\u304b\u308c\u3066\u3044\u305f\u3002 \u3069\u3046\u3084\u3089 Data Binding \u306e\u305f\u3081\u306e\u30bf\u30b9\u30af\u304c `androidTest` \u5411\u3051\u306b\u3082\u52d5\u3044\u3066\u3044\u3066\u3001\u305d\u308c\u304c\u539f\u56e0\u3067\u304a\u304b\u3057\u304f\u306a\u3063\u3066\u308b\u307d\u3044\u3002\n\n\u4e0a\u8a18\u30da\u30fc\u30b8\u306e workaround \u3092\u3082\u3068\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092 build.gradle \u306b\u66f8\u3044\u3066\u3068\u308a\u3042\u3048\u305a\u56de\u907f\u3057\u305f\u3002\n\n```groovy\nproject.afterEvaluate {\n    def targetTasks = tasks.findAll({ it.name ==~ /\\AdataBindingExportBuildInfo.*AndroidTest\\z/ }).each {\n        it.deleteAllActions()\n    }\n    // \u5c06\u6765\u4e88\u671f\u305b\u305a\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308b\u306a\u3069\u3057\u305f\u3068\u304d\u306e\u305f\u3081\u306b\u4f8b\u5916\u3092\u6295\u3052\u308b\u3002\n    if (targetTasks.empty) throw new RuntimeException('\u5bfe\u8c61\u3068\u306a\u308b\u30bf\u30b9\u30af\u304c\u5b58\u5728\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u3002 ' +\n            'Data binding \u3068 Espresso \u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u305f\u3081\u306e workaround \u304c\u4e0d\u8981\u306b\u306a\u3063\u305f\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 ' +\n            '\u30d3\u30eb\u30c9\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u898b\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002')\n}\n```\n\n`dataBindingExportBuildInfoDebugAndroidTest` \u3084 `dataBindingExportBuildInfoReleaseAndroidTest` \u3068\u3044\u3063\u305f\u30bf\u30b9\u30af\u306e\u51e6\u7406\u3092\u5168\u90e8\u7121\u304f\u3057\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u3082\u306e\u3002\n\n\u5c06\u6765\u30bf\u30b9\u30af\u540d\u304c\u5909\u66f4\u3055\u308c\u305f\u308a\u3057\u3066 workaround \u306e\u30b3\u30fc\u30c9\u304c\u52d5\u304b\u306a\u304f\u306a\u3063\u305f\u3068\u304d\u306b\u6c17\u4ed8\u304f\u3088\u3046\u306b\u4f8b\u5916\u3092\u6295\u3052\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3044\u305f\u3002\n"}