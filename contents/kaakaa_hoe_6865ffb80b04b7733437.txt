{"context": "LINE BOT\u3092\u59cb\u3081Bot\u754c\u9688\u304c\u76db\u308a\u4e0a\u304c\u3063\u3066\u304d\u3066\u307e\u3059\u304c\u3001BotKit\u516c\u958b\u3055\u308c\u3066\u3082\u4f55\u3059\u308c\u3070\u826f\u3044\u304b\u5206\u304b\u3089\u306a\u3044\u4eba\u9593\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305aifttt\u3078\u306e\u30d1\u30b9\u4f5c\u3063\u3068\u3051\u3070\u5922\u306f\u5e83\u304c\u308b\u3060\u308d\u3046\u3068\u3044\u3046\u30a2\u30ec\u3067\u3059\u3002\n\u4e0b\u8a18\u306e\u60c5\u5831\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3067\u304d\u307e\u3057\u305f\u3002\nLINE BOT \u3092\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067 Heroku \u3067\u52d5\u304b\u3059 - Qiita\nAWS Lambda\u3068IFTTT\u3067\u304a\u624b\u8efd\u306bpush\u901a\u77e5\u3092\u5b9f\u73fe\u3059\u308b - Qiita\n\n\u52d5\u304b\u3059\u306b\u306f\u4e0b\u8a18\u304c\u5fc5\u8981\n* LINE BOT API \u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\n* ifttt\u306eMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306eSecretKey\n\n\u6d41\u308c\u3068\u3057\u3066\u306fLINE BOT\u304b\u3089Heroku\u3078Callback\u3057\u3001Heroku\u304b\u3089ifttt\u306eMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3057\u3066\u307e\u3059\u3002\nConnect Maker to hundreds of apps - IFTTT\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3059\u3068Congratulations! You've \uff5e \u3068\u3044\u3046\u5b9a\u578b\u6587\u304c\u8fd4\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u307e\u305fLINE\u3078\u3064\u3076\u3084\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u304cifttt\u3078\u5c4a\u3044\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3001\u30ec\u30b7\u30d4\u304c\u30a8\u30e9\u30fc\u3068\u306a\u3063\u305f\u304b\u3069\u3046\u304b\u306f\u5224\u5225\u3067\u304d\u306a\u305d\u3046\u3067\u3059\uff09\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306fifttt\u306e\u30ec\u30b7\u30d4\u6bce\u306bEventName\u3092\u6307\u5b9a\u3067\u304d\u308b\u305f\u3081\u3001LINE\u3067\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5148\u982d\u3067\u305d\u306eEventName\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u308a\u3001Heroku\u306b\u30a2\u30d7\u30ea\u4e00\u3064\u7acb\u3066\u3066\u304a\u304f\u3060\u3051\u3067\u3001ifttt\u306e\u8907\u6570\u306e\u30ec\u30b7\u30d4\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\nLINE\u4e0a\u3067ifttt-test hogehoge\u3068\u3064\u3076\u3084\u3051\u3070\u3001EventName\u304cifttt-test\u306e\u30ec\u30b7\u30d4\u304c\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\napp.rb\n# Mostly taken from http://qiita.com/masuidrive/items/1042d93740a7a72242a3\n# And https://github.com/yuya-takeyama/line-echo\n\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\n\nclass App < Sinatra::Base\n  SECRET_KEY = ENV['MAKER_SECRET_KEY'] # Maker channel's secret key\n  EVENT_NAME_DEFAULT = ENV['MAKER_EVENT_NAME_DEFAULT'] # Maker channel's default event name\n\n  post '/linebot/callback' do\n    params = JSON.parse(request.body.read)\n\n    RestClient.proxy = ENV['FIXIE_URL'] if ENV['FIXIE_URL']\n    params['result'].each do |msg|\n      event, message = msg['content']['text'].split(' ', 2)\n      response = request_to_ifttt(event, message)\n\n      request_to_line([msg['content']['from']], response)\n    end\n\n    \"OK\"\n  end\n\n  helpers do\n    def request_to_ifttt(event = EVENT_NAME, message)\n      # Maker channel's extra data\n      request_content = {\n        value1: message,\n        value2: 'from',\n        value3: 'Line Bot'\n      }\n\n      endpoint_uri = \"https://maker.ifttt.com/trigger/#{event}/with/key/#{SECRET_KEY}\"\n      content_json = request_content.to_json\n\n      response = RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'Content-Length' => content_json.length\n      })\n    end\n\n    def request_to_line(send_to, message)\n      request_content = {\n        to: send_to,\n        toChannel: 1383378250, # Fixed  value\n        eventType: \"138311608800106203\", # Fixed value\n        content: { \n            \"contentType\": 1,  # Text type message\n            \"toType\": 1,\n            \"text\": message\n        }\n      }\n\n      endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n      content_json = request_content.to_json\n\n      RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'X-Line-ChannelID' => ENV[\"LINE_CHANNEL_ID\"],\n        'X-Line-ChannelSecret' => ENV[\"LINE_CHANNEL_SECRET\"],\n        'X-Line-Trusted-User-With-ACL' => ENV[\"LINE_CHANNEL_MID\"],\n      })\n    end  \n  end\nend\n\n\n\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\uff13\u3064\uff08Value1, Value2, Value3\uff09\u307e\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\nEventName\u306f\u305d\u306e\u307e\u307e\u306e\u610f\u5473\u3001OccurredAt\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u305f\u65e5\u6642\u306b\u306a\u308a\u307e\u3059\u3002\nifttt\u4e0a\u3067\u6307\u5b9a\u3059\u308b\u5834\u5408\u306fValue1\u306e\u3088\u3046\u306b\u5148\u982d\u3092\u5927\u6587\u5b57\u306eV\u306b\u3057\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u306f\u5148\u982d\u5c0f\u6587\u5b57\u306evalue1\u3067\u306a\u3044\u3068\u30c0\u30e1\u307f\u305f\u3044\u3067\u3059\u3002\n      # Maker channel's extra data\n      request_content = {\n        value1: message,\n        value2: 'from',\n        value3: 'Line Bot'\n      }\n\n\n\u30bd\u30fc\u30b9\u306f\u4e0b\u8a18\u306b\u7f6e\u3044\u3066\u307e\u3059\u3002 (masuidrive \u3055\u3093\u306b\u6012\u3089\u308c\u305f\u3089\u6d88\u3059)\nkaakaa/line-ifttt\n\u3068\u308a\u3042\u3048\u305a\u4f5c\u3063\u305f\u3082\u306e\u306e\u3084\u308a\u305f\u3044\u3053\u3068\u304c\u306a\u3044\u3002\nLINE BOT\u3092\u59cb\u3081Bot\u754c\u9688\u304c\u76db\u308a\u4e0a\u304c\u3063\u3066\u304d\u3066\u307e\u3059\u304c\u3001BotKit\u516c\u958b\u3055\u308c\u3066\u3082\u4f55\u3059\u308c\u3070\u826f\u3044\u304b\u5206\u304b\u3089\u306a\u3044\u4eba\u9593\u306a\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305aifttt\u3078\u306e\u30d1\u30b9\u4f5c\u3063\u3068\u3051\u3070\u5922\u306f\u5e83\u304c\u308b\u3060\u308d\u3046\u3068\u3044\u3046\u30a2\u30ec\u3067\u3059\u3002\n\n\u4e0b\u8a18\u306e\u60c5\u5831\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3067\u304d\u307e\u3057\u305f\u3002\n\n[LINE BOT \u3092\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067 Heroku \u3067\u52d5\u304b\u3059 - Qiita](http://qiita.com/yuya_takeyama/items/0660a59d13e2cd0b2516)\n[AWS Lambda\u3068IFTTT\u3067\u304a\u624b\u8efd\u306bpush\u901a\u77e5\u3092\u5b9f\u73fe\u3059\u308b - Qiita](http://qiita.com/kawahiro311/items/41dca04fe899d4d142d9)\n\n[![Deploy](https://www.herokucdn.com/deploy/button.svg)](https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2Fkaakaa%2Fline-ifttt&template=https%3A%2F%2Fgithub.com%2Fkaakaa%2Fline-ifttt)\n\n\u52d5\u304b\u3059\u306b\u306f\u4e0b\u8a18\u304c\u5fc5\u8981\n* [LINE BOT API \u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3](https://business.line.me/services/products/4/introduction)\n* [ifttt\u306eMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306eSecretKey](https://ifttt.com/maker)\n\n\n* * *\n\n\u6d41\u308c\u3068\u3057\u3066\u306fLINE BOT\u304b\u3089Heroku\u3078Callback\u3057\u3001Heroku\u304b\u3089ifttt\u306eMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3057\u3066\u307e\u3059\u3002\n[Connect Maker to hundreds of apps - IFTTT](https://ifttt.com/maker)\n\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u3078\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3059\u3068`Congratulations! You've \uff5e` \u3068\u3044\u3046\u5b9a\u578b\u6587\u304c\u8fd4\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u307e\u305fLINE\u3078\u3064\u3076\u3084\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u304cifttt\u3078\u5c4a\u3044\u305f\u3053\u3068\u3092\u8868\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3001\u30ec\u30b7\u30d4\u304c\u30a8\u30e9\u30fc\u3068\u306a\u3063\u305f\u304b\u3069\u3046\u304b\u306f\u5224\u5225\u3067\u304d\u306a\u305d\u3046\u3067\u3059\uff09\n\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306fifttt\u306e\u30ec\u30b7\u30d4\u6bce\u306b`EventName`\u3092\u6307\u5b9a\u3067\u304d\u308b\u305f\u3081\u3001LINE\u3067\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5148\u982d\u3067\u305d\u306e`EventName`\u3092\u6307\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u308a\u3001Heroku\u306b\u30a2\u30d7\u30ea\u4e00\u3064\u7acb\u3066\u3066\u304a\u304f\u3060\u3051\u3067\u3001ifttt\u306e\u8907\u6570\u306e\u30ec\u30b7\u30d4\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\n![line-ifttt-7.png](https://qiita-image-store.s3.amazonaws.com/0/9891/20b58a7c-f787-9d79-6a0c-c3d07da018b5.png)\n\n\nLINE\u4e0a\u3067`ifttt-test hogehoge`\u3068\u3064\u3076\u3084\u3051\u3070\u3001`EventName`\u304c`ifttt-test`\u306e\u30ec\u30b7\u30d4\u304c\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n```rb:app.rb\n# Mostly taken from http://qiita.com/masuidrive/items/1042d93740a7a72242a3\n# And https://github.com/yuya-takeyama/line-echo\n\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\n\nclass App < Sinatra::Base\n  SECRET_KEY = ENV['MAKER_SECRET_KEY'] # Maker channel's secret key\n  EVENT_NAME_DEFAULT = ENV['MAKER_EVENT_NAME_DEFAULT'] # Maker channel's default event name\n  \n  post '/linebot/callback' do\n    params = JSON.parse(request.body.read)\n    \n    RestClient.proxy = ENV['FIXIE_URL'] if ENV['FIXIE_URL']\n    params['result'].each do |msg|\n      event, message = msg['content']['text'].split(' ', 2)\n      response = request_to_ifttt(event, message)\n      \n      request_to_line([msg['content']['from']], response)\n    end\n\n    \"OK\"\n  end\n\n  helpers do\n    def request_to_ifttt(event = EVENT_NAME, message)\n      # Maker channel's extra data\n      request_content = {\n        value1: message,\n        value2: 'from',\n        value3: 'Line Bot'\n      }\n\n      endpoint_uri = \"https://maker.ifttt.com/trigger/#{event}/with/key/#{SECRET_KEY}\"\n      content_json = request_content.to_json\n      \n      response = RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'Content-Length' => content_json.length\n      })\n    end\n\n    def request_to_line(send_to, message)\n      request_content = {\n        to: send_to,\n        toChannel: 1383378250, # Fixed  value\n        eventType: \"138311608800106203\", # Fixed value\n        content: { \n            \"contentType\": 1,  # Text type message\n            \"toType\": 1,\n            \"text\": message\n        }\n      }\n\n      endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n      content_json = request_content.to_json\n\n      RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'X-Line-ChannelID' => ENV[\"LINE_CHANNEL_ID\"],\n        'X-Line-ChannelSecret' => ENV[\"LINE_CHANNEL_SECRET\"],\n        'X-Line-Trusted-User-With-ACL' => ENV[\"LINE_CHANNEL_MID\"],\n      })\n    end  \n  end\nend\n```\n\n* * *\n\nMaker\u30c1\u30e3\u30f3\u30cd\u30eb\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\uff13\u3064\uff08`Value1`, `Value2`, `Value3`\uff09\u307e\u3067\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n![line-ifttt-8.png](https://qiita-image-store.s3.amazonaws.com/0/9891/a3e22ceb-38d6-506b-f897-0ed1c6de704e.png)\n`EventName`\u306f\u305d\u306e\u307e\u307e\u306e\u610f\u5473\u3001`OccurredAt`\u306f\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u53d7\u3051\u4ed8\u3051\u305f\u65e5\u6642\u306b\u306a\u308a\u307e\u3059\u3002\n\n\nifttt\u4e0a\u3067\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f`Value1`\u306e\u3088\u3046\u306b\u5148\u982d\u3092\u5927\u6587\u5b57\u306e`V`\u306b\u3057\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u306f\u5148\u982d\u5c0f\u6587\u5b57\u306e`value1`\u3067\u306a\u3044\u3068\u30c0\u30e1\u307f\u305f\u3044\u3067\u3059\u3002\n\n```rb\n      # Maker channel's extra data\n      request_content = {\n        value1: message,\n        value2: 'from',\n        value3: 'Line Bot'\n      }\n```\n\n* * *\n\n\u30bd\u30fc\u30b9\u306f\u4e0b\u8a18\u306b\u7f6e\u3044\u3066\u307e\u3059\u3002 (masuidrive \u3055\u3093\u306b\u6012\u3089\u308c\u305f\u3089\u6d88\u3059)\n[kaakaa/line-ifttt](https://github.com/kaakaa/line-ifttt)\n\n\n\u3068\u308a\u3042\u3048\u305a\u4f5c\u3063\u305f\u3082\u306e\u306e\u3084\u308a\u305f\u3044\u3053\u3068\u304c\u306a\u3044\u3002\n", "tags": ["Line", "linebot", "Heroku", "ifttt"]}