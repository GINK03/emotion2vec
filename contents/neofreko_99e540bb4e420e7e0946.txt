{"context": " More than 1 year has passed since last update.No, aws doesn't expose port when running docker. But it uses port information from the container to create an upstream on nginx config.\n\n/etc/nginx/conf.d/elasticbeanstalk-nginx-docker-upstream.conf\nupstream docker {\n    server 172.17.0.33:24224;\n    keepalive 256;\n}\n\n\nThen another file to do reverse-proxy\n\n/etc/nginx/sites-enabled/elasticbeanstalk-nginx-docker-proxy.conf\nmap $http_upgrade $connection_upgrade {\n    default     \"upgrade\";\n    \"\"          \"\";\n}\n\nserver {\n    listen 24224;\n\n    location / {\n        proxy_pass          http://docker;\n        proxy_http_version  1.1;\n\n        proxy_set_header    Connection          $connection_upgrade;\n        proxy_set_header    Upgrade             $http_upgrade;\n        proxy_set_header    Host                $host;\n        proxy_set_header    X-Real-IP           $remote_addr;\n        proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;\n    }\n}\n\n\nI think we need to remove http from that proxy_pass line.\nI'll post an update when it works.\nPS:\nLet me know if trying to run fluentd on EB is not a futile effort.\nUpdate:\nI managed to make it works!\n\nNo, aws doesn't expose port when running docker. But it uses port information from the container to create an upstream on nginx config.\n\n```shell:/etc/nginx/conf.d/elasticbeanstalk-nginx-docker-upstream.conf \nupstream docker {\n\tserver 172.17.0.33:24224;\n\tkeepalive 256;\n}\n```\n\nThen another file to do reverse-proxy\n\n```shell:/etc/nginx/sites-enabled/elasticbeanstalk-nginx-docker-proxy.conf \nmap $http_upgrade $connection_upgrade {\n\tdefault\t\t\"upgrade\";\n\t\"\"\t\t\t\"\";\n}\n\nserver {\n\tlisten 24224;\n\n\tlocation / {\n\t\tproxy_pass\t\t\thttp://docker;\n\t\tproxy_http_version\t1.1;\n\n\t\tproxy_set_header\tConnection\t\t\t$connection_upgrade;\n\t\tproxy_set_header\tUpgrade\t\t\t\t$http_upgrade;\n\t\tproxy_set_header\tHost\t\t\t\t$host;\n\t\tproxy_set_header\tX-Real-IP\t\t\t$remote_addr;\n\t\tproxy_set_header\tX-Forwarded-For\t\t$proxy_add_x_forwarded_for;\n\t}\n}\n```\n\nI think we need to remove ```http``` from that ```proxy_pass``` line.\n\nI'll post an update when it works.\n\nPS:\nLet me know if trying to run fluentd on EB is not a futile effort.\n\n**Update:**\nI managed to make it [works](http://qiita.com/neofreko/items/2cca6951c9a6cfd92245)!\n", "tags": ["docker", "ElasticBeanstalk"]}