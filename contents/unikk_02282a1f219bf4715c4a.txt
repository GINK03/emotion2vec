{"context": " More than 1 year has passed since last update.\n\n\u6700\u521d\u306b\nAWS SDK for Go\u4f7f\u3044\u307e\u3059\u3002\n\u6301\u3063\u3066\u306a\u3044\u4eba\u306f\u3053\u3061\u3089\nGo\u3092\u4f7f\u3063\u3066\u306eAWS S3\u304b\u3089\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u8a18\u4e8b\u3092\u3055\u3063\u3071\u308a\u898b\u306a\u3044\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u8a18\u4e8b\u306f\u3061\u3089\u307b\u3089\u898b\u304b\u3051\u308b\u306e\u306b...\n\n\u3084\u308a\u305f\u3044\u3053\u3068\nAWS\u306eS3\u304b\u3089\u4f55\u304b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3072\u3068\u3064\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3088\u3002\nSDK\u306eS3Manager\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3068\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u7c21\u5358\u306b\u51fa\u6765\u308b\u3089\u3057\u3044\u3002\n\n\u30b3\u30fc\u30c9\n\u9577\u304f\u306a\u3063\u305f...\n\nmain.go\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n\n    \"github.com/aws/aws-sdk-go/aws/credentials\"\n    \"github.com/aws/aws-sdk-go/aws/defaults\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\n//\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u69cb\u9020\u4f53\ntype downloader struct {\n    *s3manager.Downloader\n    bucket string\n    file   string\n    dir    string\n}\n\nfunc main() {\n    ACCESSKEY_ID := \"AWS\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\"\n    SECLET_ACCESSKEY := \"AWS\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\"\n    REGION := \"AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\"\n\n    //AWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\n    defaults.DefaultConfig.Credentials = credentials.NewStaticCredentials(ACCESSKEY_ID, SECLET_ACCESSKEY, \"\")\n    defaults.DefaultConfig.Region = &REGION\n\n    bucketName := \"\u30d0\u30b1\u30c3\u30c8\u540d\"\n    key := \"\u30d5\u30a1\u30a4\u30eb\u540d\"\n    localDir := \"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4fdd\u5b58\u5148\u306e\u30ed\u30fc\u30ab\u30eb\u30d1\u30b9\"\n\n    //S3\u306b\u63a5\u7d9a\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n    if err := Download(bucketName, key, localDir); err != nil {\n        fmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5931\u6557\uff01\uff01\u3000%s\", err)\n    }\n\n}\n\nfunc Download(bucketName string, key string, dir string) error {\n    client := s3.New(nil)\n\n    params := &s3.ListObjectsInput{Bucket: &bucketName, Prefix: &key}\n\n    //resp\u306b\u306fkey\u306b\u90e8\u5206\u4e00\u81f4\u3057\u305fS3\u306e\u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5165\u308b\n    resp, connectErr := client.ListObjects(params)\n    if connectErr != nil {\n        return connectErr\n    }\n\n    //resp\u306e\u4e2d\u8eab\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u304b\u3092\u30c1\u30a7\u30c3\u30af\n    if !exists(key, resp) {\n        return fmt.Errorf(\"\u30d0\u30b1\u30c3\u30c8\u5185\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\")\n    }\n\n    manager := s3manager.NewDownloader(nil)\n    d := downloader{bucket: bucketName, file: key, dir: dir, Downloader: manager}\n    if file, err := d.downlowdFile(key); err != nil {\n        if err := os.Remove(file); err != nil {\n            fmt.Println(err)\n        }\n        return err\n    }\n    return nil\n}\n\nfunc exists(downloadFile string, resp *s3.ListObjectsOutput) bool {\n    for _, content := range resp.Contents {\n        if *content.Key == downloadFile {\n            return true\n        }\n    }\n    return false\n}\n\nfunc (d *downloader) downlowdFile(key string) (string, error) {\n    buffKeys := strings.Split(key, \"/\")\n\n    fileName := buffKeys[len(buffKeys)-1]\n    file := filepath.Join(d.dir, fileName)\n\n    //\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4fdd\u5b58\u5148\u306b\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n    fs, err := os.Create(file)\n    if err != nil {\n        return file, err\n    }\n    defer fs.Close()\n\n    fmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d.. s3://%s/%s to %s...\\n\", d.bucket, key, file)\n    params := &s3.GetObjectInput{Bucket: &d.bucket, Key: &key}\n\n    //\u5b9f\u969b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u308b\u306e\u306f\u3053\u306eDownload\u95a2\u6570\n    if _, err := d.Download(fs, params); err != nil {\n        return file, err\n    }\n\n    fmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\uff01 %s\", file)\n\n    return file, nil\n}\n\n\n\nAWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u90e8\u5206\u306f\u3001SDK\u306edefault\u30d1\u30c3\u30b1\u30fc\u30b8\u3068credentials\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u307e\u3059\u3002\n\u3067\u3082\u3001\u3042\u307e\u308a\u63a8\u5968\u3055\u308c\u306a\u3044\u65b9\u6cd5\u306a\u306e\u3067\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u304b\u3001\u5c02\u7528\u306e\u8a8d\u8a3c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306e\u304c\u666e\u901a\u307f\u305f\u3044\u3067\u3059\u3002(\u3053\u3053\u306b\u66f8\u3044\u3066\u3042\u3063\u305f)\n\u5b9f\u969b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u884c\u3046d.Download\u306f\u3001SDK\u306e*s3manager.Downloader\u306e\u95a2\u6570\u3067\u3059\u3002\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u898b\u305f\u611f\u3058\u3060\u3068\u3001\u5148\u306b\u30ed\u30fc\u30ab\u30eb\u306e\u4fdd\u5b58\u5148\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304b\u3089\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u30dd\u30a4\u30f3\u30bf\u3092\u6e21\u3057\u3066\u5185\u5bb9\u3092\u66f8\u304d\u8fbc\u3093\u3067\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\u9055\u3063\u305f\u3089\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n\n\u7d42\u308f\u308a\n\u30b3\u30fc\u30c9\u306b\u7121\u99c4\u306a\u90e8\u5206\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u3044\u305f\u304b\u3089\u826f\u3057\u3002\n# \u6700\u521d\u306b\nAWS SDK for Go\u4f7f\u3044\u307e\u3059\u3002\n\u6301\u3063\u3066\u306a\u3044\u4eba\u306f[\u3053\u3061\u3089](https://github.com/aws/aws-sdk-go/wiki/Getting-Started-Using-the-SDK)\n\nGo\u3092\u4f7f\u3063\u3066\u306eAWS S3\u304b\u3089\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u8a18\u4e8b\u3092\u3055\u3063\u3071\u308a\u898b\u306a\u3044\u3002\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306e\u8a18\u4e8b\u306f\u3061\u3089\u307b\u3089\u898b\u304b\u3051\u308b\u306e\u306b...\n\n# \u3084\u308a\u305f\u3044\u3053\u3068\nAWS\u306eS3\u304b\u3089\u4f55\u304b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3072\u3068\u3064\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3088\u3002\nSDK\u306eS3Manager\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3046\u3068\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u7c21\u5358\u306b\u51fa\u6765\u308b\u3089\u3057\u3044\u3002\n\n# \u30b3\u30fc\u30c9\n\u9577\u304f\u306a\u3063\u305f...\n\n```lang:main.go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\t\"path/filepath\"\n\t\"strings\"\n\n\t\"github.com/aws/aws-sdk-go/aws/credentials\"\n\t\"github.com/aws/aws-sdk-go/aws/defaults\"\n\t\"github.com/aws/aws-sdk-go/service/s3\"\n\t\"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\n//\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u69cb\u9020\u4f53\ntype downloader struct {\n\t*s3manager.Downloader\n\tbucket string\n\tfile   string\n\tdir    string\n}\n\nfunc main() {\n\tACCESSKEY_ID := \"AWS\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\"\n\tSECLET_ACCESSKEY := \"AWS\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\"\n\tREGION := \"AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u60c5\u5831\"\n\n\t//AWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\n\tdefaults.DefaultConfig.Credentials = credentials.NewStaticCredentials(ACCESSKEY_ID, SECLET_ACCESSKEY, \"\")\n\tdefaults.DefaultConfig.Region = &REGION\n\n\tbucketName := \"\u30d0\u30b1\u30c3\u30c8\u540d\"\n\tkey := \"\u30d5\u30a1\u30a4\u30eb\u540d\"\n\tlocalDir := \"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4fdd\u5b58\u5148\u306e\u30ed\u30fc\u30ab\u30eb\u30d1\u30b9\"\n\n\t//S3\u306b\u63a5\u7d9a\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\tif err := Download(bucketName, key, localDir); err != nil {\n\t\tfmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5931\u6557\uff01\uff01\u3000%s\", err)\n\t}\n\n}\n\nfunc Download(bucketName string, key string, dir string) error {\n\tclient := s3.New(nil)\n\n\tparams := &s3.ListObjectsInput{Bucket: &bucketName, Prefix: &key}\n\n\t//resp\u306b\u306fkey\u306b\u90e8\u5206\u4e00\u81f4\u3057\u305fS3\u306e\u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5165\u308b\n\tresp, connectErr := client.ListObjects(params)\n\tif connectErr != nil {\n\t\treturn connectErr\n\t}\n\n\t//resp\u306e\u4e2d\u8eab\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308b\u306e\u304b\u3092\u30c1\u30a7\u30c3\u30af\n\tif !exists(key, resp) {\n\t\treturn fmt.Errorf(\"\u30d0\u30b1\u30c3\u30c8\u5185\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\")\n\t}\n\n\tmanager := s3manager.NewDownloader(nil)\n\td := downloader{bucket: bucketName, file: key, dir: dir, Downloader: manager}\n\tif file, err := d.downlowdFile(key); err != nil {\n\t\tif err := os.Remove(file); err != nil {\n\t\t\tfmt.Println(err)\n\t\t}\n\t\treturn err\n\t}\n\treturn nil\n}\n\nfunc exists(downloadFile string, resp *s3.ListObjectsOutput) bool {\n\tfor _, content := range resp.Contents {\n\t\tif *content.Key == downloadFile {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n\nfunc (d *downloader) downlowdFile(key string) (string, error) {\n\tbuffKeys := strings.Split(key, \"/\")\n\n\tfileName := buffKeys[len(buffKeys)-1]\n\tfile := filepath.Join(d.dir, fileName)\n\n\t//\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4fdd\u5b58\u5148\u306b\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\tfs, err := os.Create(file)\n\tif err != nil {\n\t\treturn file, err\n\t}\n\tdefer fs.Close()\n\n\tfmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d.. s3://%s/%s to %s...\\n\", d.bucket, key, file)\n\tparams := &s3.GetObjectInput{Bucket: &d.bucket, Key: &key}\n\n\t//\u5b9f\u969b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u308b\u306e\u306f\u3053\u306eDownload\u95a2\u6570\n\tif _, err := d.Download(fs, params); err != nil {\n\t\treturn file, err\n\t}\n\n\tfmt.Printf(\"\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\uff01 %s\", file)\n\n\treturn file, nil\n}\n\n```\n\nAWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u90e8\u5206\u306f\u3001SDK\u306edefault\u30d1\u30c3\u30b1\u30fc\u30b8\u3068credentials\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u4f7f\u3063\u3066\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3057\u3066\u307e\u3059\u3002\n\u3067\u3082\u3001\u3042\u307e\u308a\u63a8\u5968\u3055\u308c\u306a\u3044\u65b9\u6cd5\u306a\u306e\u3067\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u304b\u3001\u5c02\u7528\u306e\u8a8d\u8a3c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u306e\u304c\u666e\u901a\u307f\u305f\u3044\u3067\u3059\u3002([\u3053\u3053](https://github.com/aws/aws-sdk-go/wiki/Getting-Started-Credentials)\u306b\u66f8\u3044\u3066\u3042\u3063\u305f)\n\n\u5b9f\u969b\u306b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3092\u884c\u3046d.Download\u306f\u3001SDK\u306e*s3manager.Downloader\u306e\u95a2\u6570\u3067\u3059\u3002\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u898b\u305f\u611f\u3058\u3060\u3068\u3001\u5148\u306b\u30ed\u30fc\u30ab\u30eb\u306e\u4fdd\u5b58\u5148\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304b\u3089\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u30dd\u30a4\u30f3\u30bf\u3092\u6e21\u3057\u3066\u5185\u5bb9\u3092\u66f8\u304d\u8fbc\u3093\u3067\u308b\u3088\u3046\u306b\u898b\u3048\u307e\u3059\u3002\u9055\u3063\u305f\u3089\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n\n# \u7d42\u308f\u308a\n\u30b3\u30fc\u30c9\u306b\u7121\u99c4\u306a\u90e8\u5206\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u306a\u3044\u3051\u3069\u3001\u3068\u308a\u3042\u3048\u305a\u52d5\u3044\u305f\u304b\u3089\u826f\u3057\u3002\n\n\n\n\n", "tags": ["Go", "AWS", "AWS_SDK", "awsS3"]}