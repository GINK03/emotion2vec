{"context": "\u5927\u597d\u304d\u306aPython3\u3068Django\u3067\u958b\u767a\u3057\u3088\u3046\u3068\u8003\u3048\u3001Docker\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u307e\u3057\u305f\u3002\u304a\u304a\u3088\u305d1\u30f6\u6708(\u30cf\u30de\u308a\u307e\u3057\u305forz)\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\u305d\u3093\u306a\u60e8\u4e8b\u3092\u7e70\u308a\u8fd4\u3055\u306a\u3044\u305f\u3081\u306b\u8a18\u9332\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u9577\u304f\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u3001docker-compose.yml\u30d5\u30a1\u30a4\u30eb\u3092\u9664\u304f\u521d\u671f\u8a2d\u5b9a\u307e\u3067\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u6b21\u56de\u306f\u3001docker-compose.yml\u3092\u4e3b\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u4e0b\u8a18\u306e\u30ea\u30f3\u30af\u306b\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\nDockerize Django Environment\n\n\n\n\n\n\u74b0\u5883\u306e\u8a73\u7d30\n\nOS\n\n\nUbuntu16.04LTS\n\n\n\u4eee\u60f3\u5316\u30c4\u30fc\u30eb\n\n\nDocker1.12.3\n\n\n\u8a00\u8a9e\n\n\nPython3.6\n\n\n\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\n\n\nDjango1.10\n\n\nWSGI\n\n\nGunicorn\n\n\nWeb\u30b5\u30fc\u30d0\n\n\nNginx\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\n\n\nPostgreSQL\n\n\n\n\n\n\u521d\u671f\u8a2d\u5b9a\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\u305d\u306e\u4e2d\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u6642\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\ndocker-django/\n\u2523nginx\n\u2503    \u2517nginx.conf \n\u2503\n\u2523web\n\u2503  \u2517Dockerfile\n\u2503  \u2517requirements.txt\n\u2517docker-compose.yml\n\n\n\nDjango\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306bDockerfile\u3092\u4f5c\u6210\u3059\u308b\u3002 \n\nDockerfile\nFROM python:3.6\nENV PYTHONUNBUFFERED 1\nRUN mkdir -p /usr/src/app\nRUN mkdir -p /usr/src/app/static\nWORKDIR /usr/src/app\nADD requirements.txt /usr/src/app/\nRUN pip install -r requirements.txt\nADD . /usr/src/app/\n\n\n\n\n\n\nDjango\u306f\u3001Python\u306e\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nENV PYTHONUNBUFFERED 1\u306f\u3001python\u74b0\u5883\u5909\u6570\u306e\uff11\u3064\u3067\u3059\u3002\n\n\n\u30d0\u30a4\u30ca\u30ea\u30ec\u30a4\u30e4\u4e0b\u3067\u306e\u6a19\u6e96\u51fa\u529b\u3068\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u6291\u5236\u3057\u307e\u3059\u3002\uff08PYTHONUNBUFFERED\uff09\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/usr/src/app)\u3068\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08/usr/src/app/static\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nWORKDIR /usr/src/app\u3067\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4ee5\u964d\u306e\u51e6\u7406\u306f\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\nADD requirements.txt /usr/src/app/\u3067requirements.txt\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u3001requirements.txt \u306b\u8a18\u8f09\u3057\u3001\u305d\u308c\u3089\u3092RUN pip install -r requirements.txt\u3092\u5b9f\u884c\u3057\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nrequirements.txt\nDjango1.10\npsycopg2\n\n\n\n\npsycopg2 \u306f\u3001PostgreSQL\u7528\u30c9\u30e9\u30a4\u30d0\u3067\u3059\u3002\n\n\n\n3.Nginx.conf\u3092\u7de8\u96c6\u3059\u308b\u3002\n\nnginx.conf\nworker_processes 1;\n\nuser nobody nogroup;\npid /tmp/nginx.pid;\nerror_log /tmp/nginx.error.log;\n\nevents {\n    worker_connections 1024;\n    accept_mutex off;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n    access_log /tmp/nginx.access.log combined;\n    sendfile on;\n\n    upstream app_server {\n        server web:8000 fail_timeout=0;\n    }\n\n    server {\n        listen 80 default;\n        client_max_body_size 4G;\n        server_name localhost;\n\n        keepalive_timeout 5;\n\n        location /static/ {\n               alias /usr/src/app/static/;\n        }\n\n        location / {\n          try_files $uri @proxy_to_app;\n        }\n\n        location @proxy_to_app {\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_redirect off;\n            proxy_pass http://app_server;\n        }\n\n\u3000\u3000\u3000\u3000\u3000# \u30a8\u30e9\u30fc\u7528\u306e\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u9069\u5b9c\u5909\u66f4\u3059\u308b\u3002\n        error_page 500 502 503 504 /500.html;\n        location = /500.html {\n            root /path/to/app/current/public;\n        }\n    }\n}\n\n\n\n\nmime.types\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3046\u3002\n\n\nmime.types\n   types {\n      text/html                             html htm shtml;\n      text/css                              css;\n      text/xml                              xml rss;\n      image/gif                             gif;\n      image/jpeg                            jpeg jpg;\n      application/x-javascript              js;\n      text/plain                            txt;\n\n      ===== \u4ee5\u4e0b\u3001\u7701\u7565 =====\n   }\n\n\n\n\nupstream\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u30a2\u30af\u30bb\u30b9\u3092\u632f\u308a\u5206\u3051\u308b\u30b5\u30fc\u30d0\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n\nlocation /static\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n\nlocation @proxy_to_app\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30f6\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\u6b21\u56de\u306f\u3001docker-compose.yml\u3092\u4e3b\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\u5927\u597d\u304d\u306a`Python3`\u3068`Django`\u3067\u958b\u767a\u3057\u3088\u3046\u3068\u8003\u3048\u3001`Docker`\u3092\u4f7f\u3063\u3066\u74b0\u5883\u69cb\u7bc9\u3092\u3057\u307e\u3057\u305f\u3002\u304a\u304a\u3088\u305d**1\u30f6\u6708(\u30cf\u30de\u308a\u307e\u3057\u305forz)**\u307b\u3069\u304b\u304b\u308a\u307e\u3057\u305f\u3002\u305d\u3093\u306a\u60e8\u4e8b\u3092\u7e70\u308a\u8fd4\u3055\u306a\u3044\u305f\u3081\u306b\u8a18\u9332\u3057\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u9577\u304f\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u3001`docker-compose.yml`\u30d5\u30a1\u30a4\u30eb\u3092\u9664\u304f\u521d\u671f\u8a2d\u5b9a\u307e\u3067\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\u6b21\u56de\u306f\u3001`docker-compose.yml`\u3092\u4e3b\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n* \u4e0b\u8a18\u306e\u30ea\u30f3\u30af\u306b\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002    \n    - [Dockerize Django Environment](https://github.com/amazipangu/docker-django)\n\n------\n\n## \u74b0\u5883\u306e\u8a73\u7d30\n\n* OS\n    * `Ubuntu16.04LTS`\n* \u4eee\u60f3\u5316\u30c4\u30fc\u30eb\n    * `Docker1.12.3`\n* \u8a00\u8a9e\n    * `Python3.6`\n* \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\n    * `Django1.10`\n* WSGI\n    * `Gunicorn`\n* Web\u30b5\u30fc\u30d0\n    * `Nginx`\n* \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\n    * `PostgreSQL`\n\n------\n\n## \u521d\u671f\u8a2d\u5b9a\n\n1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u3001\u305d\u306e\u4e2d\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u521d\u671f\u8a2d\u5b9a\u6642\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3067\u3059\u3002\n\n    ```sh\n    docker-django/\n    \u2523nginx\n    \u2503    \u2517nginx.conf \n    \u2503\n    \u2523web\n    \u2503  \u2517Dockerfile\n    \u2503  \u2517requirements.txt\n    \u2517docker-compose.yml\n    ```\n\n1. `Django`\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306b`Dockerfile`\u3092\u4f5c\u6210\u3059\u308b\u3002 \n\n    ```Dockerfile:Dockerfile\n    FROM python:3.6\n    ENV PYTHONUNBUFFERED 1\n    RUN mkdir -p /usr/src/app\n    RUN mkdir -p /usr/src/app/static\n    WORKDIR /usr/src/app\n    ADD requirements.txt /usr/src/app/\n    RUN pip install -r requirements.txt\n    ADD . /usr/src/app/\n   ```\n  \n  * `Django`\u306f\u3001`Python`\u306e\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u4f5c\u6210\u3057\u307e\u3059\u3002\n  * `ENV PYTHONUNBUFFERED 1`\u306f\u3001python\u74b0\u5883\u5909\u6570\u306e\uff11\u3064\u3067\u3059\u3002\n    * \u30d0\u30a4\u30ca\u30ea\u30ec\u30a4\u30e4\u4e0b\u3067\u306e\u6a19\u6e96\u51fa\u529b\u3068\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u6291\u5236\u3057\u307e\u3059\u3002\uff08[PYTHONUNBUFFERED](https://docs.python.org/3.5/using/cmdline.html#envvar-PYTHONUNBUFFERED)\uff09\n  * \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(`/usr/src/app`)\u3068\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u7528\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08`/usr/src/app/static`\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n  * `WORKDIR /usr/src/app`\u3067\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u4ee5\u964d\u306e\u51e6\u7406\u306f\u6307\u5b9a\u3055\u308c\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e0b\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n  * `ADD requirements.txt /usr/src/app/`\u3067`requirements.txt`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n  * \u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u306f\u3001`requirements.txt` \u306b\u8a18\u8f09\u3057\u3001\u305d\u308c\u3089\u3092`RUN pip install -r requirements.txt`\u3092\u5b9f\u884c\u3057\u3066\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n    ```txt:requirements.txt\n    Django1.10\n    psycopg2\n    ```\n    \n    * `psycopg2` \u306f\u3001[PostgreSQL\u7528\u30c9\u30e9\u30a4\u30d0](http://initd.org/psycopg/docs/)\u3067\u3059\u3002\n\n\n3.`Nginx.conf`\u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```txt:nginx.conf\nworker_processes 1;\n\nuser nobody nogroup;\npid /tmp/nginx.pid;\nerror_log /tmp/nginx.error.log;\n\nevents {\n    worker_connections 1024;\n    accept_mutex off;\n}\n\nhttp {\n    include /etc/nginx/mime.types;\n    default_type application/octet-stream;\n    access_log /tmp/nginx.access.log combined;\n    sendfile on;\n\n    upstream app_server {\n        server web:8000 fail_timeout=0;\n    }\n\n    server {\n        listen 80 default;\n        client_max_body_size 4G;\n        server_name localhost;\n\n        keepalive_timeout 5;\n\n        location /static/ {\n               alias /usr/src/app/static/;\n        }\n\n        location / {\n          try_files $uri @proxy_to_app;\n        }\n\n        location @proxy_to_app {\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_redirect off;\n            proxy_pass http://app_server;\n        }\n\n\u3000\u3000\u3000\u3000\u3000# \u30a8\u30e9\u30fc\u7528\u306e\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u9069\u5b9c\u5909\u66f4\u3059\u308b\u3002\n        error_page 500 502 503 504 /500.html;\n        location = /500.html {\n            root /path/to/app/current/public;\n        }\n    }\n}\n```\n\n* `mime.types`\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\u3092\u884c\u3046\u3002\n\n   ```txt:mime.types\n   types {\n      text/html                             html htm shtml;\n      text/css                              css;\n      text/xml                              xml rss;\n      image/gif                             gif;\n      image/jpeg                            jpeg jpg;\n      application/x-javascript              js;\n      text/plain                            txt;\n\n      ===== \u4ee5\u4e0b\u3001\u7701\u7565 =====\n   }\n   ```\n* `upstream`\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u30a2\u30af\u30bb\u30b9\u3092\u632f\u308a\u5206\u3051\u308b\u30b5\u30fc\u30d0\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n* `location /static`\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u5b9a\u7fa9\u3059\u308b\u3002\n* `location @proxy_to_app`\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306b\u3066\u3001\u63a5\u7d9a\u3059\u308b\u30a2\u30d7\u30ea\u30f6\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\n\u6b21\u56de\u306f\u3001`docker-compose.yml`\u3092\u4e3b\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n", "tags": ["Django", "python3", "docker", "nginx"]}