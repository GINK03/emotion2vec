{"tags": ["Gentoo", "Linux", "lvm2"], "context": " More than 1 year has passed since last update.LVM\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30dc\u30ea\u30e5\u30fc\u30e0\u3092XFS\u304b\u3089JFS\u306b\u5909\u66f4\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u5909\u66f4\u5bfe\u8c61\u306brootfs\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u306e\u3067CD\u30d6\u30fc\u30c8\u3057\u3066\u65b0\u3057\u3044LV\u3092\u4f5c\u308a\u30c7\u30fc\u30bf\u3092\u79fb\u884c\u3057\u307e\u3059\u3002\n\n\u3053\u3093\u306a\u611f\u3058\u3067rootfs\u542b\u3081\u3066XFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fLV\u3092\u4f7f\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001LXC\u3092\u4f7f\u3046\u306b\u3042\u305f\u308aJFS\u306b\u5909\u3048\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\nlocalhost ~ # mount | grep mapper\n/dev/mapper/VG00-Gentoo on / type xfs (rw,noatime,attr2,inode64,noquota)\n/dev/mapper/VG00-Var on /var type xfs (rw,noatime)\n/dev/mapper/VG00-Portage on /usr/portage type xfs (rw,noatime)\n\n3.12\u3088\u308a\u524d\u306ekernel\u3067\u306fXFS\u3068User Namespace\u3092\u4e21\u65b9\u3068\u3082\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n(\u307e\u3041\u8272\u3005\u3084\u308a\u3088\u3046\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c)\n\n\u53c2\u8003\u60c5\u5831\n\nXFS directory recursion scalability, namespace support\nenable building user namespace with xfs\n\nrootfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067CD\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\nCD\u30d6\u30fc\u30c8\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067 dolvm \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nVG\u3068LV\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nlivecd ~ # vgdisplay \n  --- Volume group ---\n  VG Name               VG00\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  18\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                4\n  Open LV               0\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               148.55 GiB\n  PE Size               4.00 MiB\n  Total PE              38028\n  Alloc PE / Size       5376 / 21.00 GiB\n  Free  PE / Size       32652 / 127.55 GiB\n  VG UUID               FwMMaK-zMYd-ZL0H-HWSj-fo6w-X8uf-JJv6zl\n\nlivecd ~ # lvdisplay -c\n  /dev/VG00/Portage:VG00:3:1:-1:0:16777216:2048:-1:0:-1:253:0\n  /dev/VG00/Gentoo:VG00:3:1:-1:0:16777216:2048:-1:0:-1:253:1\n  /dev/VG00/SWAP00:VG00:3:1:-1:0:2097152:256:-1:0:-1:253:2\n  /dev/VG00/Var:VG00:3:1:-1:0:8388608:1024:-1:0:-1:253:3\n\n\u7a7a\u304d\u5bb9\u91cf\u306f\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u306e\u3067\u3001\u4eca\u3042\u308bXFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fLV\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u307e\u3059\u3002\nlivecd ~ # lvrename VG00 Gentoo Gentoo.XFS     \n  Renamed \"Gentoo\" to \"Gentoo.XFS\" in volume group \"VG00\"\nlivecd ~ # lvrename VG00 Var Var.XFS\n  Renamed \"Var\" to \"Var.XFS\" in volume group \"VG00\"\nlivecd ~ # lvrename VG00 Portage Portage.XFS\n  Renamed \"Portage\" to \"Portage.XFS\" in volume group \"VG00\"\n\n\u65b0\u3057\u304fJFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308bLV\u3092\u4f5c\u308a\u307e\u3059\u3002\nlivecd ~ # lvcreate -n Gentoo  -L8G VG00\n  Logical volume \"Gentoo\" created\nlivecd ~ # lvcreate -n Var  -L8G VG00\n  Logical volume \"Var\" created\nlivecd ~ # lvcreate -n Portage  -L8G VG00\n  Logical volume \"Portage\" created\n\nJFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\nlivecd ~ # mkfs.jfs /dev/VG00/Gentoo\nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Gentoo will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\nlivecd ~ # mkfs.jfs /dev/VG00/Var   \nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Var will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\nlivecd ~ # mkfs.jfs /dev/VG00/Portage\nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Portage will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\n\n\u65b0\u65e7\u4e21\u65b9\u306erootfs\u3092mount\u3057\u307e\u3059\u3002\n\u65b0rootfs\u306f /mnt/gentoo \u306b\u3001\u65e7rootfs\u306f /mnt/gentoo.old \u306bmount\u3057\u307e\u3057\u305f\u3002\n\u79fb\u884c\u5bfe\u8c61\u3067\u3042\u308b /var \u3068 /usr/portage \u3082\u305d\u308c\u305e\u308cmount\u3057\u307e\u3059\u3002\nlivecd ~ # mount /dev/VG00/Gentoo /mnt/gentoo/\nlivecd ~ # mkdir -p /mnt/gentoo.old\nlivecd ~ # mount /dev/VG00/Gentoo.XFS /mnt/gentoo.old/\nlivecd ~ # mkdir -p /mnt/gentoo/var /mnt/gentoo/usr/portage /mnt/gentoo/boot\nlivecd ~ # mount /dev/VG00/Var.XFS /mnt/gentoo.old/var/\nlivecd ~ # mount /dev/VG00/Portage.XFS /mnt/gentoo.old/usr/portage/\nlivecd ~ # mount /dev/VG00/Var /mnt/gentoo/var/\nlivecd ~ # mount /dev/VG00/Portage /mnt/gentoo/usr/portage/\n\nmount\u3057\u305f\u7d50\u679c\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nlivecd ~ # mount\nrootfs on / type rootfs (rw)\nproc on /proc type proc (rw,nosuid,nodev,noexec,relatime)\nudev on /dev type devtmpfs (rw,nosuid,relatime,size=10240k,nr_inodes=255261,mode=755)\ndevpts on /dev/pts type devpts (rw,relatime,gid=5,mode=620)\nsysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)\ntmpfs on / type tmpfs (rw,relatime)\n/dev/sr0 on /mnt/cdrom type iso9660 (ro,relatime)\n/dev/loop0 on /mnt/livecd type squashfs (ro,relatime)\n/dev/sr0 on /mnt/cdrom type iso9660 (ro,relatime)\ntmpfs on /run type tmpfs (rw,nosuid,nodev,relatime,size=204936k,mode=755)\nshm on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime)\nfusectl on /sys/fs/fuse/connections type fusectl (rw,nosuid,nodev,noexec,relatime)\ntmpfs on /mnt/livecd/lib64/firmware type tmpfs (rw)\ntmpfs on /mnt/livecd/usr/portage type tmpfs (rw)\n/dev/mapper/VG00-Gentoo on /mnt/gentoo type jfs (rw)\n/dev/mapper/VG00-Gentoo.XFS on /mnt/gentoo.old type xfs (rw)\n/dev/mapper/VG00-Var.XFS on /mnt/gentoo.old/var type xfs (rw)\n/dev/mapper/VG00-Portage.XFS on /mnt/gentoo.old/usr/portage type xfs (rw)\n/dev/mapper/VG00-Var on /mnt/gentoo/var type jfs (rw)\n/dev/mapper/VG00-Portage on /mnt/gentoo/usr/portage type jfs (rw)\n\ntar \u3067\u65e7rootfs\u4ee5\u4e0b\u3092\u65b0rootfs\u306b\u8907\u88fd\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u5c55\u958b\u6642\u306b p \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nlivecd ~ # cd /mnt/gentoo\nlivecd gentoo # tar cf - -C /mnt/gentoo.old . | tar xfp -\nlivecd gentoo # ls -al \ntotal 226964\ndrwxr-xr-x 20 root root      4096 Dec 12 04:29 .\ndrwxr-xr-x  7 root root       160 Jan 11 15:29 ..\ndrwxr-xr-x  2 root root      4096 Dec 26 00:20 bin\ndrwxr-xr-x  2 root root         1 Dec 15 15:48 boot\ndrwxr-xr-x  3 root root      4096 Dec 12 01:31 dev\ndrwxr-xr-x 36 root root      4096 Jan 11 13:15 etc\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 home\nlrwxrwxrwx  1 root root         5 Dec 12 04:29 lib -> lib64\ndrwxr-xr-x  3 root root      4096 Dec 15 16:07 lib32\ndrwxr-xr-x 13 root root      4096 Dec 26 01:10 lib64\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 media\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 mnt\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 opt\n-rw-r--r--  1 root root  59183700 Dec 15 15:56 portage-latest.tar.xz\ndrwxr-xr-x  2 root root         1 Dec 12 01:24 proc\ndrwx------  3 root root        32 Dec 29 10:40 root\ndrwxr-xr-x  2 root root         8 Dec 16 02:54 run\ndrwxr-xr-x  2 root root      4096 Dec 26 00:12 sbin\n-rw-r--r--  1 root root 173132242 Dec 15 15:53 stage3-amd64-20131212.tar.bz2\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 sys\ndrwxrwxrwt  4 root root        16 Jan 11 13:12 tmp\ndrwxr-xr-x 13 root root      4096 Dec 12 04:48 usr\ndrwxr-xr-x  9 root root        88 Dec 12 01:31 var\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u3063\u3066\u5fae\u5999\u306b\u4f7f\u7528\u9818\u57df\u304c\u5909\u308f\u308b\u3088\u3046\u3067\u3059\u3002\nlivecd gentoo # df -k\nFilesystem                   1K-blocks    Used Available Use% Mounted on\nrootfs                         1024672  291872    732800  29% /\nudev                             10240       4     10236   1% /dev\ntmpfs                          1024672  291872    732800  29% /\n/dev/sr0                        264176  264176         0 100% /mnt/cdrom\n/dev/loop0                      236672  236672         0 100% /mnt/livecd\ntmpfs                           204936     492    204444   1% /run\nshm                            1024672       0   1024672   0% /dev/shm\ntmpfs                          1024672       0   1024672   0% /mnt/livecd/lib64/firmware\ntmpfs                          1024672       0   1024672   0% /mnt/livecd/usr/portage\n/dev/mapper/VG00-Gentoo        8355380 2444984   5910396  30% /mnt/gentoo\n/dev/mapper/VG00-Gentoo.XFS    8378368 2404780   5973588  29% /mnt/gentoo.old\n/dev/mapper/VG00-Var.XFS       4184064   92592   4091472   3% /mnt/gentoo.old/var\n/dev/mapper/VG00-Portage.XFS   8378368 1257756   7120612  16% /mnt/gentoo.old/usr/portage\n/dev/mapper/VG00-Var           8355380   64152   8291228   1% /mnt/gentoo/var\n/dev/mapper/VG00-Portage       8355380 1311752   7043628  16% /mnt/gentoo/usr/portage\n\n\u65b0rootfs\u306e /etc/fstab \u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\nlivecd gentoo # busybox diff /mnt/gentoo.old/etc/fstab /mnt/gentoo/etc/fstab \n--- /mnt/gentoo.old/etc/fstab\n+++ /mnt/gentoo/etc/fstab\n@@ -15,9 +15,9 @@\n\n # NOTE: If your BOOT partition is ReiserFS, add the notail option to opts.\n /dev/sda1      /boot       ext2        noatime     1 2\n-/dev/VG00/Gentoo   /       xfs     noatime     0 1\n-/dev/VG00/Var      /var        xfs     noatime     0 1\n-/dev/VG00/Portage  /usr/portage    xfs     noatime     0 1\n+/dev/VG00/Gentoo   /       jfs     noatime     0 1\n+/dev/VG00/Var      /var        jfs     noatime     0 1\n+/dev/VG00/Portage  /usr/portage    jfs     noatime     0 1\n /dev/VG00/SWAP00   none        swap        sw      0 0\n /dev/cdrom     /mnt/cdrom  auto        noauto,ro   0 0\n /dev/fd0       /mnt/floppy auto        noauto      0 0\n\n\u518d\u8d77\u52d5\u3057\u3066\u3001\nlivecd gentoo # reboot && exit\nlogout\n\n\u7121\u4e8bmount\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\uff01\nlocalhost ~ # mount | grep mapper\n/dev/mapper/VG00-Gentoo on / type jfs (rw,noatime)\n/dev/mapper/VG00-Var on /var type jfs (rw,noatime)\n/dev/mapper/VG00-Portage on /usr/portage type jfs (rw,noatime)\n\nLVM\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30dc\u30ea\u30e5\u30fc\u30e0\u3092XFS\u304b\u3089JFS\u306b\u5909\u66f4\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u5909\u66f4\u5bfe\u8c61\u306brootfs\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u306e\u3067CD\u30d6\u30fc\u30c8\u3057\u3066\u65b0\u3057\u3044LV\u3092\u4f5c\u308a\u30c7\u30fc\u30bf\u3092\u79fb\u884c\u3057\u307e\u3059\u3002\n\n----\n\n\u3053\u3093\u306a\u611f\u3058\u3067rootfs\u542b\u3081\u3066XFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fLV\u3092\u4f7f\u3063\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001LXC\u3092\u4f7f\u3046\u306b\u3042\u305f\u308aJFS\u306b\u5909\u3048\u305f\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n\n```shell-session\nlocalhost ~ # mount | grep mapper\n/dev/mapper/VG00-Gentoo on / type xfs (rw,noatime,attr2,inode64,noquota)\n/dev/mapper/VG00-Var on /var type xfs (rw,noatime)\n/dev/mapper/VG00-Portage on /usr/portage type xfs (rw,noatime)\n```\n\n3.12\u3088\u308a\u524d\u306ekernel\u3067\u306fXFS\u3068User Namespace\u3092\u4e21\u65b9\u3068\u3082\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u304b\u3089\u3067\u3059\u3002\n(\u307e\u3041\u8272\u3005\u3084\u308a\u3088\u3046\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c)\n\n### \u53c2\u8003\u60c5\u5831\n\n* [XFS directory recursion scalability, namespace support](http://kernelnewbies.org/LinuxChanges#head-bb6c29190925527611aa8780813d4e753448055d)\n* [enable building user namespace with xfs](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=d6970d4b726cea6d7a9bc4120814f95c09571fc3)\n\nrootfs\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067CD\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\n[CD\u30d6\u30fc\u30c8\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067 `dolvm` \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002](http://www.gentoo.org/doc/ja/handbook/handbook-amd64.xml?full=1#book_part1_chap2)\n\nVG\u3068LV\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # vgdisplay \n  --- Volume group ---\n  VG Name               VG00\n  System ID             \n  Format                lvm2\n  Metadata Areas        1\n  Metadata Sequence No  18\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                4\n  Open LV               0\n  Max PV                0\n  Cur PV                1\n  Act PV                1\n  VG Size               148.55 GiB\n  PE Size               4.00 MiB\n  Total PE              38028\n  Alloc PE / Size       5376 / 21.00 GiB\n  Free  PE / Size       32652 / 127.55 GiB\n  VG UUID               FwMMaK-zMYd-ZL0H-HWSj-fo6w-X8uf-JJv6zl\n   \nlivecd ~ # lvdisplay -c\n  /dev/VG00/Portage:VG00:3:1:-1:0:16777216:2048:-1:0:-1:253:0\n  /dev/VG00/Gentoo:VG00:3:1:-1:0:16777216:2048:-1:0:-1:253:1\n  /dev/VG00/SWAP00:VG00:3:1:-1:0:2097152:256:-1:0:-1:253:2\n  /dev/VG00/Var:VG00:3:1:-1:0:8388608:1024:-1:0:-1:253:3\n```\n\n\u7a7a\u304d\u5bb9\u91cf\u306f\u554f\u984c\u306a\u3055\u305d\u3046\u306a\u306e\u3067\u3001\u4eca\u3042\u308bXFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fLV\u3092\u30ea\u30cd\u30fc\u30e0\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # lvrename VG00 Gentoo Gentoo.XFS     \n  Renamed \"Gentoo\" to \"Gentoo.XFS\" in volume group \"VG00\"\nlivecd ~ # lvrename VG00 Var Var.XFS\n  Renamed \"Var\" to \"Var.XFS\" in volume group \"VG00\"\nlivecd ~ # lvrename VG00 Portage Portage.XFS\n  Renamed \"Portage\" to \"Portage.XFS\" in volume group \"VG00\"\n```\n\n\u65b0\u3057\u304fJFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3059\u308bLV\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # lvcreate -n Gentoo  -L8G VG00\n  Logical volume \"Gentoo\" created\nlivecd ~ # lvcreate -n Var  -L8G VG00\n  Logical volume \"Var\" created\nlivecd ~ # lvcreate -n Portage  -L8G VG00\n  Logical volume \"Portage\" created\n```\n\nJFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # mkfs.jfs /dev/VG00/Gentoo\nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Gentoo will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\nlivecd ~ # mkfs.jfs /dev/VG00/Var   \nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Var will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\nlivecd ~ # mkfs.jfs /dev/VG00/Portage\nmkfs.jfs version 1.1.15, 04-Mar-2011\nWarning!  All data on device /dev/VG00/Portage will be lost!\n\nContinue? (Y/N) y\n   \\\n\nFormat completed successfully.\n\n8388608 kilobytes total disk space.\n```\n\n\u65b0\u65e7\u4e21\u65b9\u306erootfs\u3092mount\u3057\u307e\u3059\u3002\n\u65b0rootfs\u306f `/mnt/gentoo` \u306b\u3001\u65e7rootfs\u306f `/mnt/gentoo.old` \u306bmount\u3057\u307e\u3057\u305f\u3002\n\u79fb\u884c\u5bfe\u8c61\u3067\u3042\u308b `/var` \u3068 `/usr/portage` \u3082\u305d\u308c\u305e\u308cmount\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # mount /dev/VG00/Gentoo /mnt/gentoo/\nlivecd ~ # mkdir -p /mnt/gentoo.old\nlivecd ~ # mount /dev/VG00/Gentoo.XFS /mnt/gentoo.old/\nlivecd ~ # mkdir -p /mnt/gentoo/var /mnt/gentoo/usr/portage /mnt/gentoo/boot\nlivecd ~ # mount /dev/VG00/Var.XFS /mnt/gentoo.old/var/\nlivecd ~ # mount /dev/VG00/Portage.XFS /mnt/gentoo.old/usr/portage/\nlivecd ~ # mount /dev/VG00/Var /mnt/gentoo/var/\nlivecd ~ # mount /dev/VG00/Portage /mnt/gentoo/usr/portage/\n```\n\nmount\u3057\u305f\u7d50\u679c\u306f\u3053\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```shell-session\nlivecd ~ # mount\nrootfs on / type rootfs (rw)\nproc on /proc type proc (rw,nosuid,nodev,noexec,relatime)\nudev on /dev type devtmpfs (rw,nosuid,relatime,size=10240k,nr_inodes=255261,mode=755)\ndevpts on /dev/pts type devpts (rw,relatime,gid=5,mode=620)\nsysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)\ntmpfs on / type tmpfs (rw,relatime)\n/dev/sr0 on /mnt/cdrom type iso9660 (ro,relatime)\n/dev/loop0 on /mnt/livecd type squashfs (ro,relatime)\n/dev/sr0 on /mnt/cdrom type iso9660 (ro,relatime)\ntmpfs on /run type tmpfs (rw,nosuid,nodev,relatime,size=204936k,mode=755)\nshm on /dev/shm type tmpfs (rw,nosuid,nodev,noexec,relatime)\nfusectl on /sys/fs/fuse/connections type fusectl (rw,nosuid,nodev,noexec,relatime)\ntmpfs on /mnt/livecd/lib64/firmware type tmpfs (rw)\ntmpfs on /mnt/livecd/usr/portage type tmpfs (rw)\n/dev/mapper/VG00-Gentoo on /mnt/gentoo type jfs (rw)\n/dev/mapper/VG00-Gentoo.XFS on /mnt/gentoo.old type xfs (rw)\n/dev/mapper/VG00-Var.XFS on /mnt/gentoo.old/var type xfs (rw)\n/dev/mapper/VG00-Portage.XFS on /mnt/gentoo.old/usr/portage type xfs (rw)\n/dev/mapper/VG00-Var on /mnt/gentoo/var type jfs (rw)\n/dev/mapper/VG00-Portage on /mnt/gentoo/usr/portage type jfs (rw)\n```\n\n`tar` \u3067\u65e7rootfs\u4ee5\u4e0b\u3092\u65b0rootfs\u306b\u8907\u88fd\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u4fdd\u6301\u3059\u308b\u305f\u3081\u5c55\u958b\u6642\u306b `p` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd ~ # cd /mnt/gentoo\nlivecd gentoo # tar cf - -C /mnt/gentoo.old . | tar xfp -\nlivecd gentoo # ls -al \ntotal 226964\ndrwxr-xr-x 20 root root      4096 Dec 12 04:29 .\ndrwxr-xr-x  7 root root       160 Jan 11 15:29 ..\ndrwxr-xr-x  2 root root      4096 Dec 26 00:20 bin\ndrwxr-xr-x  2 root root         1 Dec 15 15:48 boot\ndrwxr-xr-x  3 root root      4096 Dec 12 01:31 dev\ndrwxr-xr-x 36 root root      4096 Jan 11 13:15 etc\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 home\nlrwxrwxrwx  1 root root         5 Dec 12 04:29 lib -> lib64\ndrwxr-xr-x  3 root root      4096 Dec 15 16:07 lib32\ndrwxr-xr-x 13 root root      4096 Dec 26 01:10 lib64\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 media\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 mnt\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 opt\n-rw-r--r--  1 root root  59183700 Dec 15 15:56 portage-latest.tar.xz\ndrwxr-xr-x  2 root root         1 Dec 12 01:24 proc\ndrwx------  3 root root        32 Dec 29 10:40 root\ndrwxr-xr-x  2 root root         8 Dec 16 02:54 run\ndrwxr-xr-x  2 root root      4096 Dec 26 00:12 sbin\n-rw-r--r--  1 root root 173132242 Dec 15 15:53 stage3-amd64-20131212.tar.bz2\ndrwxr-xr-x  2 root root         8 Dec 12 01:31 sys\ndrwxrwxrwt  4 root root        16 Jan 11 13:12 tmp\ndrwxr-xr-x 13 root root      4096 Dec 12 04:48 usr\ndrwxr-xr-x  9 root root        88 Dec 12 01:31 var\n```\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u3063\u3066\u5fae\u5999\u306b\u4f7f\u7528\u9818\u57df\u304c\u5909\u308f\u308b\u3088\u3046\u3067\u3059\u3002\n\n```shell-session\nlivecd gentoo # df -k\nFilesystem                   1K-blocks    Used Available Use% Mounted on\nrootfs                         1024672  291872    732800  29% /\nudev                             10240       4     10236   1% /dev\ntmpfs                          1024672  291872    732800  29% /\n/dev/sr0                        264176  264176         0 100% /mnt/cdrom\n/dev/loop0                      236672  236672         0 100% /mnt/livecd\ntmpfs                           204936     492    204444   1% /run\nshm                            1024672       0   1024672   0% /dev/shm\ntmpfs                          1024672       0   1024672   0% /mnt/livecd/lib64/firmware\ntmpfs                          1024672       0   1024672   0% /mnt/livecd/usr/portage\n/dev/mapper/VG00-Gentoo        8355380 2444984   5910396  30% /mnt/gentoo\n/dev/mapper/VG00-Gentoo.XFS    8378368 2404780   5973588  29% /mnt/gentoo.old\n/dev/mapper/VG00-Var.XFS       4184064   92592   4091472   3% /mnt/gentoo.old/var\n/dev/mapper/VG00-Portage.XFS   8378368 1257756   7120612  16% /mnt/gentoo.old/usr/portage\n/dev/mapper/VG00-Var           8355380   64152   8291228   1% /mnt/gentoo/var\n/dev/mapper/VG00-Portage       8355380 1311752   7043628  16% /mnt/gentoo/usr/portage\n```\n\n\u65b0rootfs\u306e `/etc/fstab` \u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```shell-session\nlivecd gentoo # busybox diff /mnt/gentoo.old/etc/fstab /mnt/gentoo/etc/fstab \n--- /mnt/gentoo.old/etc/fstab\n+++ /mnt/gentoo/etc/fstab\n@@ -15,9 +15,9 @@\n \n # NOTE: If your BOOT partition is ReiserFS, add the notail option to opts.\n /dev/sda1\t\t/boot\t\text2\t\tnoatime\t\t1 2\n-/dev/VG00/Gentoo\t/\t\txfs\t\tnoatime\t\t0 1\n-/dev/VG00/Var\t\t/var\t\txfs\t\tnoatime\t\t0 1\n-/dev/VG00/Portage\t/usr/portage\txfs\t\tnoatime\t\t0 1\n+/dev/VG00/Gentoo\t/\t\tjfs\t\tnoatime\t\t0 1\n+/dev/VG00/Var\t\t/var\t\tjfs\t\tnoatime\t\t0 1\n+/dev/VG00/Portage\t/usr/portage\tjfs\t\tnoatime\t\t0 1\n /dev/VG00/SWAP00\tnone\t\tswap\t\tsw\t\t0 0\n /dev/cdrom\t\t/mnt/cdrom\tauto\t\tnoauto,ro\t0 0\n /dev/fd0\t\t/mnt/floppy\tauto\t\tnoauto\t\t0 0\n```\n\n\u518d\u8d77\u52d5\u3057\u3066\u3001\n\n```shell-session\nlivecd gentoo # reboot && exit\nlogout\n```\n\n\u7121\u4e8bmount\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\uff01\n\n```shell-session\nlocalhost ~ # mount | grep mapper\n/dev/mapper/VG00-Gentoo on / type jfs (rw,noatime)\n/dev/mapper/VG00-Var on /var type jfs (rw,noatime)\n/dev/mapper/VG00-Portage on /usr/portage type jfs (rw,noatime)\n```"}