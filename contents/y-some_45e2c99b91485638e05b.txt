{"context": "\n\n\u306f\u3058\u3081\u306b\nWatson\u306e\u9854\u8a8d\u8b58API\u3092\u4f7f\u3063\u3066\u3001iOS\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u300cVisual Recognition\u300d\uff08\u4ee5\u4e0bVR\uff09\u3068\u3044\u3046\u753b\u50cf\u89e3\u6790\u6a5f\u80fd\u306e\u300cDetect faces\u300d\u3068\u3044\u3046API\u3067\u3059\u3002\n\u9854\u304c\u542b\u307e\u308c\u308b\u753b\u50cf\u3092\u89e3\u6790\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u60c5\u5831\u3092\u8fd4\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u691c\u51fa\u3055\u308c\u305f\u9854\u306e\u5ea7\u6a19\n\u6027\u5225\u3068\u78ba\u7387\n\u5e74\u9f62\u3068\u78ba\u7387\n\u6709\u540d\u4eba\u306e\u5834\u5408\u306f\u540d\u524d\u304a\u3088\u3073\u30bf\u30b0\u60c5\u5831\n\n\u3053\u306eAPI\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u306e\u72b6\u614b\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nVR\u306b\u306f\u4ed6\u306b\u3001\u5229\u7528\u8005\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u753b\u50cf\u3092\u96c6\u3081\u3066Watson\u306b\u5b66\u7fd2\u3055\u305b\u308b\u30bf\u30a4\u30d7\u306eAPI\u3082\u3042\u308a\u307e\u3059\u3002\n\u79c1\u306f\u3053\u306eAPI\u304c\u300cAlchemy Vision\u300d\u3068\u3044\u3046\u6a5f\u80fd\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u305f\u9803\u306b\u9854\u89e3\u6790\u306eiOS\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\n\nAlchemy Vision\u304cVR\u306b\u7d71\u5408\u3055\u308c\u305f\n\u305d\u306e\u6642\u306fSwift 2\u3060\u3063\u305f\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001VR\u3068Swift 3\u3067\u4f5c\u308a\u76f4\u3057\u307e\u3057\u305f\u3002\n\nVR\u3092\u5229\u7528\u3059\u308b\u624b\u9806\n\u4e8b\u524d\u306b\u3001IBM Bluemix\u306bVR\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u624b\u9806\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u306b\u8a73\u7d30\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nBluemix\u3067Watson API \u306eVisual Recognition \u3092\u4f7f\u3046 by curl\n\u30b5\u30fc\u30d3\u30b9\u4f5c\u6210\u5f8c\u306b\u767a\u884c\u3055\u308c\u308bAPI Key\u3092iOS\u30a2\u30d7\u30ea\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\uff08\u5f8c\u8ff0\uff09\nVR\u306b\u306f\u7121\u6599\u30d7\u30e9\u30f3\u304c\u3042\u308a\u307e\u3059\u3002\n\nDetect faces API\u306e\u4ed5\u69d8\n\n\u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\nPOST\u30e1\u30bd\u30c3\u30c9\u3067\u753b\u50cf\u3092\u9001\u308a\u307e\u3059\u3002\nContent-Type\u306f\"application/x-www-form-urlencoded\"\u3067\u3059\u3002\n\u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u4e0a\u8a18\u300cVR\u3092\u5229\u7528\u3059\u308b\u624b\u9806\u300d\u3067\u63a7\u3048\u3066\u304a\u3044\u305fAPI Key\u3092\u30bb\u30c3\u30c8\u3057\u3001Body\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u30a8\u30f3\u30b3\u30fc\u30c9\u305b\u305a\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\u8a73\u7d30\u306fDetect faces\u306eAPI Reference\u3092\u53c2\u7167\u3002\n\u30b5\u30f3\u30d7\u30eb\u306f\u4e0b\u8a18\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u3002\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf\u306e\u30b5\u30f3\u30d7\u30eb\nJSON\u3067\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u89e3\u6790\u3055\u308c\u305f\u9854\u304c\u914d\u5217\u3068\u3057\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n{\n  \"images_processed\" : 1,\n  \"images\" : [\n    {\n      \"faces\" : [\n        {\n          \"age\" : {\n            \"max\" : 54,\n            \"min\" : 45,\n            \"score\" : 0.405922\n          },\n          \"face_location\" : {\n            \"top\" : 401,\n            \"height\" : 105,\n            \"left\" : 1117,\n            \"width\" : 96\n          },\n          \"gender\" : {\n            \"score\" : 0.9933070000000001,\n            \"gender\" : \"MALE\"\n          },\n          \"identity\" : {\n            \"name\" : \"Barack Obama\",\n            \"score\" : 0.989013,\n            \"type_hierarchy\" : \"\\/people\\/politicians\\/democrats\\/barack obama\"\n          }\n        },\n        {\n          \"age\" : {\n            \"max\" : 64,\n            \"min\" : 55,\n            \"score\" : 0.617719\n          },\n          \"face_location\" : {\n            \"top\" : 366,\n            \"height\" : 125,\n            \"left\" : 607,\n            \"width\" : 81\n          },\n          \"gender\" : {\n            \"score\" : 0.9933070000000001,\n            \"gender\" : \"MALE\"\n          },\n          \"identity\" : {\n            \"name\" : \"Shinz\u014d Abe\",\n            \"score\" : 0.731059\n          }\n        },\n        {\n          \"age\" : {\n            \"min\" : 65,\n            \"score\" : 0.416757\n          },\n          \"face_location\" : {\n            \"top\" : 285,\n            \"height\" : 107,\n            \"left\" : 1339,\n            \"width\" : 99\n          },\n          \"gender\" : {\n            \"score\" : 0.0474259,\n            \"gender\" : \"FEMALE\"\n          }\n        },\n        {\n          \"age\" : {\n            \"max\" : 44,\n            \"min\" : 35,\n            \"score\" : 0.403753\n          },\n          \"face_location\" : {\n            \"top\" : 311,\n            \"height\" : 121,\n            \"left\" : 228,\n            \"width\" : 142\n          },\n          \"gender\" : {\n            \"score\" : 0.970688,\n            \"gender\" : \"MALE\"\n          }\n        }\n      ]\n    }\n  ]\n}\n\n\"age\": \"max\"\u306f\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\"identity\"\u306f\u30aa\u30d0\u30de\u3055\u3093\u3068\u5b89\u500d\u3055\u3093\u3060\u3051\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u958b\u767a\u74b0\u5883\n\n\n\nItems\nVersion\n\n\n\n\nXcode\n8.2\n\n\nSwift\n3.0.2\n\n\n\n\n\u4f7f\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\n\nSwiftyJSON\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u3068\u3057\u3066Carthage\u3092\u5229\u7528\n\n\n\u30b9\u30c8\u30fc\u30ea\u30fc\u30dc\u30fc\u30c9\n\n\nUINavigationController\n\u521d\u671f\u753b\u9762\u3068\u89e3\u6790\u7d50\u679c\u753b\u9762\u3092\u884c\u304d\u6765\u3059\u308b\u305f\u3081\u306b\u3001UINavigationController\u3092\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\nMainViewController: UIViewController\n\u521d\u671f\u753b\u9762\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eUI\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u64cd\u4f5c\u30ac\u30a4\u30c9\u306eUILabel\n\u9078\u629e\u3055\u308c\u305f\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUIImageView\n\u30ab\u30e1\u30e9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306eUIButton\n\u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306eUIButton\n\u89e3\u6790\uff08API\u9023\u643a\uff09\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306eUIButton\n\u89e3\u6790\u5f85\u3061\u7528UIActivityIndicatorView\nSegue: Identifier=\"ShowResult\"\n\n\nSubTableViewController: UITableViewController\n\u89e3\u6790\u7d50\u679c\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\u305f\u3081\u306eUITableView\u3067\u3059\u3002\n\nResultTableViewCell: UITableViewCell\n\u89e3\u6790\u7d50\u679c\u7528\u306e\u30bb\u30eb\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eUI\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUIImageView\n\u6027\u5225\u3001\u6027\u5225\u78ba\u4fe1\u5ea6\u3001\u5e74\u9f62\uff08Min-Max\uff09\u3001\u5e74\u9f62\u78ba\u4fe1\u5ea6\u3001\u540d\u524d\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUILabel\n\n\n\u30b3\u30fc\u30c9\n\nAppDelegate.swift\nimport UIKit\n\n// \u89e3\u6790\u7d50\u679c\u3092\u683c\u7d0d\u3059\u308b\u30af\u30e9\u30b9\nclass AnalyzedFace {\n    var image: UIImage?\n    var gender: String?\n    var genderScore: String?\n    var ageMin: String?\n    var ageMax: String?\n    var ageScore: String?\n    var identity: String?\n}\n\n@UIApplicationMain\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n\n    var window: UIWindow?\n\n    //ViewController\u9593\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u6e21\u3057\u3059\u308b\u305f\u3081\u306e\u5909\u6570\n    var analyzedFaces: Array<AnalyzedFace> = []\n\n//(\u4ee5\u4e0b\u7565)\n\n\n\nMainViewController.swift\nimport UIKit\nimport SwiftyJSON\nimport Photos\n\nclass MainViewController: UIViewController, UIImagePickerControllerDelegate, UINavigationControllerDelegate {\n\n    // \u30ac\u30a4\u30c9\u6587\u8a00Label\n    @IBOutlet weak var guideLabel: UILabel!\n    // \u9078\u629e\u3055\u308c\u305f\u753b\u50cf\n    @IBOutlet weak var selectedImageView: UIImageView!\n    // \u89e3\u6790\u4e2d\u306e\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\n    @IBOutlet weak var activityIndicator: UIActivityIndicatorView!\n\n    // MARK: UIViewController - Event\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n    }\n\n    // MARK: IBAction\n\n    /**\n     \u30ab\u30e1\u30e9\u8d77\u52d5\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func launchCameraButtonTapped(_ sender: Any) {\n        if UIImagePickerController.isSourceTypeAvailable(.camera) {\n            self.launchImagePicker(type: .camera)\n        }\n    }\n\n    /**\n     \u5199\u771f\u9078\u629e\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func launchPhotoButtonTapped(_ sender: Any) {\n        if UIImagePickerController.isSourceTypeAvailable(.photoLibrary) {\n            self.launchImagePicker(type: .photoLibrary)\n        }\n    }\n\n    /**\n     \u89e3\u6790\u958b\u59cb\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func analyzeButtonTapped(_ sender: Any) {\n        guard let selectedImage = self.selectedImageView.image else {\n            return\n        }\n        // API\u4ed5\u69d8\u306e\u753b\u50cf\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u306a\u3044\u3088\u3046\u306b\u30ea\u30b5\u30a4\u30ba\u3057\u3066\u304b\u3089API\u30b3\u30fc\u30eb\u3059\u308b\n        guard let resizedImage = self.resizeJpeg(image: selectedImage) else {\n            return\n        }\n        self.callApi(image: resizedImage)\n    }\n\n    // MARK: Delegate\n\n    /**\n     UIImagePickerControllerDelegate\uff1a\u753b\u50cf\u9078\u629e\u6642\n     */\n    func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any]) {\n        picker.dismiss(animated: true, completion: nil)\n        guard let image = info[UIImagePickerControllerOriginalImage] else {\n            return\n        }\n        // \u9078\u629e\u753b\u50cf\u3092ImageView\u306b\u8868\u793a\n        self.selectedImageView.image = image as? UIImage\n        // \u30ac\u30a4\u30c9Label\u3092\u975e\u8868\u793a\u306b\n        self.guideLabel.isHidden = true\n    }\n\n    // MARK: Method\n\n    /**\n     \u30ab\u30e1\u30e9/\u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8d77\u52d5\n     - parameter type: \u30ab\u30e1\u30e9/\u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\n     */\n    func launchImagePicker(type: UIImagePickerControllerSourceType) {\n        let controller = UIImagePickerController()\n        controller.delegate = self\n        controller.sourceType = type\n        self.present(controller, animated: true, completion: nil)\n    }\n\n    /**\n     \u753b\u50cf\u5727\u7e2e\u51e6\u7406\n     - WatsonVR detect_faces API\u306e\u4ed5\u69d8\u306b\u3088\u308a\u753b\u50cf\u30b5\u30a4\u30ba\u306f\u6700\u59272MG\uff082016\u5e7412\u6708\u73fe\u5728\uff09\n     - \u30b5\u30a4\u30ba\u304c\u53ce\u307e\u308b\u307e\u3067\u518d\u5e30\u7684\u306b\u30b5\u30a4\u30ba\u3092\u7e2e\u5c0f\u3059\u308b\n     - parameter image: \u30bd\u30fc\u30b9\u753b\u50cf\n     - returns: UIImage\n     */\n    func resizeJpeg(image: UIImage) -> UIImage? {\n        let maxSize: Int = 1480000  // \u3053\u306e\u3050\u3089\u3044\u306e\u30d4\u30af\u30bb\u30eb\u6570\u3060\u30682MB\u3092\u8d85\u3048\u306a\u3044\u3088\u3046\u3060(\u5b9f\u9a13\u5024)\n        if Int(image.size.width * image.size.height) <= maxSize {\n            return image\n        }\n        // \u5727\u7e2e\n        let size: CGSize = CGSize(width: (image.size.width * 0.8), height: (image.size.height * 0.8))\n        UIGraphicsBeginImageContext(size)\n        image.draw(in: CGRect(x: 0, y: 0, width: size.width, height: size.height))\n        guard let resizeImage = UIGraphicsGetImageFromCurrentImageContext() else {\n            return nil\n        }\n        UIGraphicsEndImageContext()\n        // \u518d\u5e30\u51e6\u7406\n        return self.resizeJpeg(image: resizeImage)\n    }\n\n    /**\n     API\u9023\u643a\n     - parameter image: \u89e3\u6790\u5bfe\u8c61\u753b\u50cf\u30a4\u30e1\u30fc\u30b8\n     */\n    func callApi(image: UIImage) {\n        // \u89e3\u6790\u7d50\u679c\u306fAppDelegate\u306e\u5909\u6570\u3092\u7d4c\u7531\u3057\u3066SubView\u306b\u6e21\u3059\n        let appDelegate: AppDelegate = UIApplication.shared.delegate as! AppDelegate\n\n        // API\u547c\u3073\u51fa\u3057\u6e96\u5099\n        let APIKey = \"(API Key)\" // APIKey\u3092\u53d6\u5f97\u3057\u3066\u3053\u3053\u306b\u8a18\u8ff0\n        let url = \"https://gateway-a.watsonplatform.net/visual-recognition/api/v3/detect_faces?api_key=\" + APIKey + \"&version=2016-05-20\"\n        guard let destURL = URL(string: url) else {\n            print (\"url is NG: \" + url) // debug\n            return\n        }\n        var request = URLRequest(url: destURL)\n        request.httpMethod = \"POST\"\n        request.setValue(\"application/x-www-form-urlencoded\", forHTTPHeaderField: \"Content-Type\")\n        request.httpBody = UIImageJPEGRepresentation(image, 1)\n\n        // activityIndicator\u59cb\u52d5\n        self.activityIndicator.startAnimating()\n\n        // WatsonAPI\u30b3\u30fc\u30eb\n        let task = URLSession.shared.dataTask(with: request) {\n            data, response, error in\n\n            if error == nil {\n                // API\u30ec\u30b9\u30dd\u30f3\u30b9\uff1a\u6b63\u5e38\n                let json = JSON(data: data!)\n                print(json) // debug\n\n                appDelegate.analyzedFaces = self.interpretJson(image: image, json: json)\n\n                // \u30ea\u30af\u30a8\u30b9\u30c8\u306f\u975e\u540c\u671f\u306e\u305f\u3081\u753b\u9762\u9077\u79fb\u3092mainQueue\u3067\u884c\u308f\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\n                OperationQueue.main.addOperation(\n                    {\n                        //\u3000activityIndicator\u505c\u6b62\n                        self.activityIndicator.stopAnimating()\n                        if appDelegate.analyzedFaces.count > 0 {\n                            // \u9854\u89e3\u6790\u7d50\u679c\u3042\u308a\n                            self.performSegue(withIdentifier: \"ShowResult\", sender: self)\n                        } else {\n                            // \u9854\u89e3\u6790\u7d50\u679c\u306a\u3057\n                            let actionSheet = UIAlertController(title:\"\u30a8\u30e9\u30fc\", message: \"\u9854\u691c\u51fa\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\", preferredStyle: .alert)\n                            let actionCancel = UIAlertAction(title: \"\u30ad\u30e3\u30f3\u30bb\u30eb\", style: .cancel, handler: {action in\n                            })\n                            actionSheet.addAction(actionCancel)\n                            self.present(actionSheet, animated: true, completion: nil)\n                        }\n                    }\n                )\n            } else {\n                // API\u30ec\u30b9\u30dd\u30f3\u30b9\uff1a\u30a8\u30e9\u30fc\n                print(error.debugDescription)   // debug\n            }\n            //\u3000activityIndicator\u505c\u6b62\n            if self.activityIndicator.isAnimating {\n                self.activityIndicator.stopAnimating()\n            }\n        }\n\n        task.resume()\n    }\n\n    /**\n     \u89e3\u6790\u7d50\u679c\u306eJSON\u3092\u89e3\u91c8\u3057\u3066AnalyzedFace\u578b\u306e\u914d\u5217\u3067\u8fd4\u3059\n     - parameter image: \u5143\u753b\u50cf\n     - parameter json: JSON\u30c7\u30fc\u30bf\n     - returns: AnalyzedFace\u578b\u306e\u914d\u5217\n     */\n    func interpretJson(image: UIImage, json: JSON) -> Array<AnalyzedFace> {\n        var analyzedFaces: Array<AnalyzedFace> = []\n        let facesJson = json[\"images\"][0][\"faces\"].arrayValue\n        // \u30ec\u30b9\u30dd\u30f3\u30b9\u306eimageFaces\u8981\u7d20\u306f\u914d\u5217\u3068\u306a\u3063\u3066\u3044\u308b\uff08\u8907\u6570\u4eba\u304c\u6620\u3063\u305f\u753b\u50cf\u306e\u89e3\u6790\u304c\u53ef\u80fd\uff09\n        for faceJson in facesJson {\n            let face = AnalyzedFace()\n            // \u6027\u5225\u304a\u3088\u3073\u30b9\u30b3\u30a2\n            guard let gender = faceJson[\"gender\"][\"gender\"].string else {\n                continue\n            }\n            if gender == \"MALE\" {\n                face.gender = \"\u7537\u6027\"\n            } else {\n                face.gender = \"\u5973\u6027\"\n            }\n            guard let genderScore = faceJson[\"gender\"][\"score\"].double else {\n                continue\n            }\n            face.genderScore = String(floor(genderScore * 1000) / 10)\n            // \u5e74\u9f62\u304a\u3088\u3073\u30b9\u30b3\u30a2\n            if let ageMin = faceJson[\"age\"][\"min\"].int {\n                face.ageMin = String(ageMin)\n            }\n            if let ageMax = faceJson[\"age\"][\"max\"].int {\n                face.ageMax = String(ageMax)\n            }\n            guard let ageScore = faceJson[\"age\"][\"score\"].double else {\n                continue\n            }\n            face.ageScore = String(floor(ageScore * 1000) / 10)\n            // Identity\n            if let identity = faceJson[\"identity\"][\"name\"].string {\n                face.identity = identity\n            }\n            // \u691c\u51fa\u3055\u308c\u305f\u9854\u306e\u77e9\u5f62\n            guard let left = faceJson[\"face_location\"][\"left\"].int else {\n                continue\n            }\n            guard let top = faceJson[\"face_location\"][\"top\"].int else {\n                continue\n            }\n            guard let width = faceJson[\"face_location\"][\"width\"].int else {\n                continue\n            }\n            guard let height = faceJson[\"face_location\"][\"height\"].int else {\n                continue\n            }\n            // \u5143\u753b\u50cf\u304b\u3089\u5207\u308a\u629c\u3044\u3066\u5909\u6570\u306b\u30bb\u30c3\u30c8\n            face.image = self.cropping(image: image, left: CGFloat(left), top: CGFloat(top), width: CGFloat(width), height: CGFloat(height))\n            // \u62bd\u51fa\u5b8c\u4e86\n            analyzedFaces.append(face)\n        }\n        return analyzedFaces\n    }\n\n    /**\n     \u5143\u753b\u50cf\u304b\u3089\u77e9\u5f62\u3092\u5207\u308a\u629c\u304f\n     - parameter image: \u5143\u753b\u50cf\n     - parameter left: x\u5ea7\u6a19\n     - parameter top: y\u5ea7\u6a19\n     - parameter width: \u5e45\n     - parameter height: \u9ad8\u3055\n     - returns: UIImage\n     */\n    func cropping(image: UIImage, left: CGFloat, top: CGFloat, width: CGFloat, height: CGFloat) -> UIImage? {\n        let imgRef = image.cgImage?.cropping(to: CGRect(x: left, y: top, width: width, height: height))\n        return UIImage(cgImage: imgRef!, scale: image.scale, orientation: image.imageOrientation)\n    }\n\n}\n\n\n\nSubTableViewController.swift\nimport UIKit\n\nclass SubTableViewController: UITableViewController {\n\n    // \u89e3\u6790\u7d50\u679c\u306fAppDelegate\u306e\u5909\u6570\u306b\u5165\u3063\u3066\u3044\u308b\n    private let appDelegate: AppDelegate = UIApplication.shared.delegate as! AppDelegate\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n    }\n\n    // MARK: - Table view data source\n\n    /**\n     \u30bb\u30eb\u306e\u6570\u3092\u8fd4\u3059\n     */\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {\n        return self.appDelegate.analyzedFaces.count\n    }\n\n    /**\n     \u30bb\u30eb\u306e\u9805\u76ee\u3092\u30bb\u30c3\u30c8\n     */\n    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n        let result = self.appDelegate.analyzedFaces[indexPath.row]\n        let cell = tableView.dequeueReusableCell(withIdentifier: \"ResultCell\", for: indexPath) as! ResultTableViewCell\n        cell.setData(data: result)\n        return cell\n    }\n}\n\n\n\nResultTableViewCell\nimport UIKit\n\nclass ResultTableViewCell: UITableViewCell {\n\n    @IBOutlet weak var faceImageView: UIImageView!\n    @IBOutlet weak var genderNameLabel: UILabel!\n    @IBOutlet weak var genderScoreLabel: UILabel!\n    @IBOutlet weak var ageRangeLabel: UILabel!\n    @IBOutlet weak var ageScoreLabel: UILabel!\n    @IBOutlet weak var identityLabel: UILabel!\n\n    /**\n     \u30bb\u30eb\u306e\u5185\u5bb9\u3092\u30bb\u30c3\u30c8\n     - parameter data: \u89e3\u6790\u7d50\u679c\n     */\n    func setData(data: AnalyzedFace) {\n        self.faceImageView.image = data.image\n        if let gender = data.gender {\n            self.genderNameLabel.text = \"\u6027\u5225\uff1a\" + gender\n        }\n        if let genderScore = data.genderScore {\n            self.genderScoreLabel.text = \"\u3000\u3000\u3000\u78ba\u4fe1\u5ea6\uff1a\" + genderScore + \"%\"\n        }\n        var ageRangeText = \"\u5e74\u9f62\uff1a\"\n        if let ageMin = data.ageMin {\n            ageRangeText += ageMin + \"\u624d\u4ee5\u4e0a \"\n        }\n        if let ageMax = data.ageMax {\n            ageRangeText += ageMax + \"\u624d\u4ee5\u4e0b\"\n        }\n        self.ageRangeLabel.text = ageRangeText\n        if let ageScore = data.ageScore {\n            self.ageScoreLabel.text = \"\u3000\u3000\u3000\u78ba\u4fe1\u5ea6\uff1a\" + ageScore + \"%\"\n        }\n        self.identityLabel.text = data.identity\n    }\n\n}\n\n\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\nhttps://github.com/y-some/WatsonVR-DetectFaces\n![WatsonVR.gif](https://qiita-image-store.s3.amazonaws.com/0/122917/de4719f5-916f-dce2-8ab3-3777f04dab16.gif)\n\n# \u306f\u3058\u3081\u306b\n\nWatson\u306e\u9854\u8a8d\u8b58API\u3092\u4f7f\u3063\u3066\u3001iOS\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\u300cVisual Recognition\u300d\uff08\u4ee5\u4e0bVR\uff09\u3068\u3044\u3046\u753b\u50cf\u89e3\u6790\u6a5f\u80fd\u306e\u300cDetect faces\u300d\u3068\u3044\u3046API\u3067\u3059\u3002\n\u9854\u304c\u542b\u307e\u308c\u308b\u753b\u50cf\u3092\u89e3\u6790\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u60c5\u5831\u3092\u8fd4\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n- \u691c\u51fa\u3055\u308c\u305f\u9854\u306e\u5ea7\u6a19\n- \u6027\u5225\u3068\u78ba\u7387\n- \u5e74\u9f62\u3068\u78ba\u7387\n- \u6709\u540d\u4eba\u306e\u5834\u5408\u306f\u540d\u524d\u304a\u3088\u3073\u30bf\u30b0\u60c5\u5831\n\n\u3053\u306eAPI\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u306e\u72b6\u614b\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nVR\u306b\u306f\u4ed6\u306b\u3001\u5229\u7528\u8005\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u753b\u50cf\u3092\u96c6\u3081\u3066Watson\u306b\u5b66\u7fd2\u3055\u305b\u308b\u30bf\u30a4\u30d7\u306eAPI\u3082\u3042\u308a\u307e\u3059\u3002\n\n\u79c1\u306f\u3053\u306eAPI\u304c\u300cAlchemy Vision\u300d\u3068\u3044\u3046\u6a5f\u80fd\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u305f\u9803\u306b[\u9854\u89e3\u6790\u306eiOS\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u305f](http://qiita.com/y-some/items/8f2cec7a7aac70368202)\u306e\u3067\u3059\u304c\u3001\n\n- Alchemy Vision\u304cVR\u306b\u7d71\u5408\u3055\u308c\u305f\n- \u305d\u306e\u6642\u306fSwift 2\u3060\u3063\u305f\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001VR\u3068Swift 3\u3067\u4f5c\u308a\u76f4\u3057\u307e\u3057\u305f\u3002\n\n# VR\u3092\u5229\u7528\u3059\u308b\u624b\u9806\n\n\u4e8b\u524d\u306b\u3001IBM Bluemix\u306bVR\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u624b\u9806\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u306b\u8a73\u7d30\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n[Bluemix\u3067Watson API \u306eVisual Recognition \u3092\u4f7f\u3046 by curl]((http://qiita.com/MoriKen/items/6403cf5f6775bb8aa4c4))\n\n\u30b5\u30fc\u30d3\u30b9\u4f5c\u6210\u5f8c\u306b\u767a\u884c\u3055\u308c\u308bAPI Key\u3092iOS\u30a2\u30d7\u30ea\u304b\u3089\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\uff08\u5f8c\u8ff0\uff09\n\nVR\u306b\u306f\u7121\u6599\u30d7\u30e9\u30f3\u304c\u3042\u308a\u307e\u3059\u3002\n\n# Detect faces API\u306e\u4ed5\u69d8\n\n## \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30e9\u30e1\u30fc\u30bf\n\nPOST\u30e1\u30bd\u30c3\u30c9\u3067\u753b\u50cf\u3092\u9001\u308a\u307e\u3059\u3002\nContent-Type\u306f\"application/x-www-form-urlencoded\"\u3067\u3059\u3002\n\u30af\u30a8\u30ea\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u4e0a\u8a18\u300cVR\u3092\u5229\u7528\u3059\u308b\u624b\u9806\u300d\u3067\u63a7\u3048\u3066\u304a\u3044\u305fAPI Key\u3092\u30bb\u30c3\u30c8\u3057\u3001Body\u306b\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u30a8\u30f3\u30b3\u30fc\u30c9\u305b\u305a\u30bb\u30c3\u30c8\u3057\u307e\u3059\u3002\n\n\u8a73\u7d30\u306f[Detect faces\u306eAPI Reference](https://www.ibm.com/watson/developercloud/visual-recognition/api/v3/#detect_faces)\u3092\u53c2\u7167\u3002\n\u30b5\u30f3\u30d7\u30eb\u306f\u4e0b\u8a18\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53c2\u7167\u3002\n\n## \u30ec\u30b9\u30dd\u30f3\u30b9\u30c7\u30fc\u30bf\u306e\u30b5\u30f3\u30d7\u30eb\n\nJSON\u3067\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u901a\u308a\u3001\u89e3\u6790\u3055\u308c\u305f\u9854\u304c\u914d\u5217\u3068\u3057\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\n{\n  \"images_processed\" : 1,\n  \"images\" : [\n    {\n      \"faces\" : [\n        {\n          \"age\" : {\n            \"max\" : 54,\n            \"min\" : 45,\n            \"score\" : 0.405922\n          },\n          \"face_location\" : {\n            \"top\" : 401,\n            \"height\" : 105,\n            \"left\" : 1117,\n            \"width\" : 96\n          },\n          \"gender\" : {\n            \"score\" : 0.9933070000000001,\n            \"gender\" : \"MALE\"\n          },\n          \"identity\" : {\n            \"name\" : \"Barack Obama\",\n            \"score\" : 0.989013,\n            \"type_hierarchy\" : \"\\/people\\/politicians\\/democrats\\/barack obama\"\n          }\n        },\n        {\n          \"age\" : {\n            \"max\" : 64,\n            \"min\" : 55,\n            \"score\" : 0.617719\n          },\n          \"face_location\" : {\n            \"top\" : 366,\n            \"height\" : 125,\n            \"left\" : 607,\n            \"width\" : 81\n          },\n          \"gender\" : {\n            \"score\" : 0.9933070000000001,\n            \"gender\" : \"MALE\"\n          },\n          \"identity\" : {\n            \"name\" : \"Shinz\u014d Abe\",\n            \"score\" : 0.731059\n          }\n        },\n        {\n          \"age\" : {\n            \"min\" : 65,\n            \"score\" : 0.416757\n          },\n          \"face_location\" : {\n            \"top\" : 285,\n            \"height\" : 107,\n            \"left\" : 1339,\n            \"width\" : 99\n          },\n          \"gender\" : {\n            \"score\" : 0.0474259,\n            \"gender\" : \"FEMALE\"\n          }\n        },\n        {\n          \"age\" : {\n            \"max\" : 44,\n            \"min\" : 35,\n            \"score\" : 0.403753\n          },\n          \"face_location\" : {\n            \"top\" : 311,\n            \"height\" : 121,\n            \"left\" : 228,\n            \"width\" : 142\n          },\n          \"gender\" : {\n            \"score\" : 0.970688,\n            \"gender\" : \"MALE\"\n          }\n        }\n      ]\n    }\n  ]\n}\n```\n\n\"age\": \"max\"\u306f\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\"identity\"\u306f\u30aa\u30d0\u30de\u3055\u3093\u3068\u5b89\u500d\u3055\u3093\u3060\u3051\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# \u958b\u767a\u74b0\u5883\n\n| Items | Version |\n|:--    |:--      |\n| Xcode | 8.2     |\n| Swift | 3.0.2   |\n\n# \u4f7f\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\n\n- [SwiftyJSON](https://github.com/SwiftyJSON/SwiftyJSON)\n- \u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u3068\u3057\u3066[Carthage](https://github.com/Carthage/Carthage)\u3092\u5229\u7528\n\n\n# \u30b9\u30c8\u30fc\u30ea\u30fc\u30dc\u30fc\u30c9\n\n<img width=\"1342\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-20 22.03.11.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/122917/125e9b06-ac71-00b3-3892-6cae0653724d.png\">\n\n## UINavigationController\n\n\u521d\u671f\u753b\u9762\u3068\u89e3\u6790\u7d50\u679c\u753b\u9762\u3092\u884c\u304d\u6765\u3059\u308b\u305f\u3081\u306b\u3001UINavigationController\u3092\u7d44\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n## MainViewController: UIViewController\n\n\u521d\u671f\u753b\u9762\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eUI\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n- \u64cd\u4f5c\u30ac\u30a4\u30c9\u306eUILabel\n- \u9078\u629e\u3055\u308c\u305f\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUIImageView\n- \u30ab\u30e1\u30e9\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306eUIButton\n- \u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306eUIButton\n- \u89e3\u6790\uff08API\u9023\u643a\uff09\u3092\u958b\u59cb\u3059\u308b\u305f\u3081\u306eUIButton\n- \u89e3\u6790\u5f85\u3061\u7528UIActivityIndicatorView\n- Segue: Identifier=\"ShowResult\"\n\n## SubTableViewController: UITableViewController\n\n\u89e3\u6790\u7d50\u679c\u3092\u4e00\u89a7\u8868\u793a\u3059\u308b\u305f\u3081\u306eUITableView\u3067\u3059\u3002\n\n## ResultTableViewCell: UITableViewCell\n\n\u89e3\u6790\u7d50\u679c\u7528\u306e\u30bb\u30eb\u3067\u3059\u3002\n\u4ee5\u4e0b\u306eUI\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n- \u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUIImageView\n- \u6027\u5225\u3001\u6027\u5225\u78ba\u4fe1\u5ea6\u3001\u5e74\u9f62\uff08Min-Max\uff09\u3001\u5e74\u9f62\u78ba\u4fe1\u5ea6\u3001\u540d\u524d\u3092\u8868\u793a\u3059\u308b\u305f\u3081\u306eUILabel\n\n# \u30b3\u30fc\u30c9\n\n```Swift:AppDelegate.swift\nimport UIKit\n\n// \u89e3\u6790\u7d50\u679c\u3092\u683c\u7d0d\u3059\u308b\u30af\u30e9\u30b9\nclass AnalyzedFace {\n    var image: UIImage?\n    var gender: String?\n    var genderScore: String?\n    var ageMin: String?\n    var ageMax: String?\n    var ageScore: String?\n    var identity: String?\n}\n\n@UIApplicationMain\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n\n    var window: UIWindow?\n\n    //ViewController\u9593\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u6e21\u3057\u3059\u308b\u305f\u3081\u306e\u5909\u6570\n    var analyzedFaces: Array<AnalyzedFace> = []\n\n//(\u4ee5\u4e0b\u7565)\n```\n\n```Swift:MainViewController.swift\nimport UIKit\nimport SwiftyJSON\nimport Photos\n\nclass MainViewController: UIViewController, UIImagePickerControllerDelegate, UINavigationControllerDelegate {\n\n    // \u30ac\u30a4\u30c9\u6587\u8a00Label\n    @IBOutlet weak var guideLabel: UILabel!\n    // \u9078\u629e\u3055\u308c\u305f\u753b\u50cf\n    @IBOutlet weak var selectedImageView: UIImageView!\n    // \u89e3\u6790\u4e2d\u306e\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\n    @IBOutlet weak var activityIndicator: UIActivityIndicatorView!\n    \n    // MARK: UIViewController - Event\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n    }\n\n    // MARK: IBAction\n    \n    /**\n     \u30ab\u30e1\u30e9\u8d77\u52d5\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func launchCameraButtonTapped(_ sender: Any) {\n        if UIImagePickerController.isSourceTypeAvailable(.camera) {\n            self.launchImagePicker(type: .camera)\n        }\n    }\n    \n    /**\n     \u5199\u771f\u9078\u629e\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func launchPhotoButtonTapped(_ sender: Any) {\n        if UIImagePickerController.isSourceTypeAvailable(.photoLibrary) {\n            self.launchImagePicker(type: .photoLibrary)\n        }\n    }\n    \n    /**\n     \u89e3\u6790\u958b\u59cb\u30dc\u30bf\u30f3Tap\n     */\n    @IBAction func analyzeButtonTapped(_ sender: Any) {\n        guard let selectedImage = self.selectedImageView.image else {\n            return\n        }\n        // API\u4ed5\u69d8\u306e\u753b\u50cf\u30b5\u30a4\u30ba\u3092\u8d85\u3048\u306a\u3044\u3088\u3046\u306b\u30ea\u30b5\u30a4\u30ba\u3057\u3066\u304b\u3089API\u30b3\u30fc\u30eb\u3059\u308b\n        guard let resizedImage = self.resizeJpeg(image: selectedImage) else {\n            return\n        }\n        self.callApi(image: resizedImage)\n    }\n    \n    // MARK: Delegate\n    \n    /**\n     UIImagePickerControllerDelegate\uff1a\u753b\u50cf\u9078\u629e\u6642\n     */\n    func imagePickerController(_ picker: UIImagePickerController, didFinishPickingMediaWithInfo info: [String : Any]) {\n        picker.dismiss(animated: true, completion: nil)\n        guard let image = info[UIImagePickerControllerOriginalImage] else {\n            return\n        }\n        // \u9078\u629e\u753b\u50cf\u3092ImageView\u306b\u8868\u793a\n        self.selectedImageView.image = image as? UIImage\n        // \u30ac\u30a4\u30c9Label\u3092\u975e\u8868\u793a\u306b\n        self.guideLabel.isHidden = true\n    }\n\n    // MARK: Method\n\n    /**\n     \u30ab\u30e1\u30e9/\u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8d77\u52d5\n     - parameter type: \u30ab\u30e1\u30e9/\u30d5\u30a9\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\n     */\n    func launchImagePicker(type: UIImagePickerControllerSourceType) {\n        let controller = UIImagePickerController()\n        controller.delegate = self\n        controller.sourceType = type\n        self.present(controller, animated: true, completion: nil)\n    }\n    \n    /**\n     \u753b\u50cf\u5727\u7e2e\u51e6\u7406\n     - WatsonVR detect_faces API\u306e\u4ed5\u69d8\u306b\u3088\u308a\u753b\u50cf\u30b5\u30a4\u30ba\u306f\u6700\u59272MG\uff082016\u5e7412\u6708\u73fe\u5728\uff09\n     - \u30b5\u30a4\u30ba\u304c\u53ce\u307e\u308b\u307e\u3067\u518d\u5e30\u7684\u306b\u30b5\u30a4\u30ba\u3092\u7e2e\u5c0f\u3059\u308b\n     - parameter image: \u30bd\u30fc\u30b9\u753b\u50cf\n     - returns: UIImage\n     */\n    func resizeJpeg(image: UIImage) -> UIImage? {\n        let maxSize: Int = 1480000  // \u3053\u306e\u3050\u3089\u3044\u306e\u30d4\u30af\u30bb\u30eb\u6570\u3060\u30682MB\u3092\u8d85\u3048\u306a\u3044\u3088\u3046\u3060(\u5b9f\u9a13\u5024)\n        if Int(image.size.width * image.size.height) <= maxSize {\n            return image\n        }\n        // \u5727\u7e2e\n        let size: CGSize = CGSize(width: (image.size.width * 0.8), height: (image.size.height * 0.8))\n        UIGraphicsBeginImageContext(size)\n        image.draw(in: CGRect(x: 0, y: 0, width: size.width, height: size.height))\n        guard let resizeImage = UIGraphicsGetImageFromCurrentImageContext() else {\n            return nil\n        }\n        UIGraphicsEndImageContext()\n        // \u518d\u5e30\u51e6\u7406\n        return self.resizeJpeg(image: resizeImage)\n    }\n    \n    /**\n     API\u9023\u643a\n     - parameter image: \u89e3\u6790\u5bfe\u8c61\u753b\u50cf\u30a4\u30e1\u30fc\u30b8\n     */\n    func callApi(image: UIImage) {\n        // \u89e3\u6790\u7d50\u679c\u306fAppDelegate\u306e\u5909\u6570\u3092\u7d4c\u7531\u3057\u3066SubView\u306b\u6e21\u3059\n        let appDelegate: AppDelegate = UIApplication.shared.delegate as! AppDelegate\n\n        // API\u547c\u3073\u51fa\u3057\u6e96\u5099\n        let APIKey = \"(API Key)\" // APIKey\u3092\u53d6\u5f97\u3057\u3066\u3053\u3053\u306b\u8a18\u8ff0\n        let url = \"https://gateway-a.watsonplatform.net/visual-recognition/api/v3/detect_faces?api_key=\" + APIKey + \"&version=2016-05-20\"\n        guard let destURL = URL(string: url) else {\n            print (\"url is NG: \" + url) // debug\n            return\n        }\n        var request = URLRequest(url: destURL)\n        request.httpMethod = \"POST\"\n        request.setValue(\"application/x-www-form-urlencoded\", forHTTPHeaderField: \"Content-Type\")\n        request.httpBody = UIImageJPEGRepresentation(image, 1)\n        \n        // activityIndicator\u59cb\u52d5\n        self.activityIndicator.startAnimating()\n        \n        // WatsonAPI\u30b3\u30fc\u30eb\n        let task = URLSession.shared.dataTask(with: request) {\n            data, response, error in\n            \n            if error == nil {\n                // API\u30ec\u30b9\u30dd\u30f3\u30b9\uff1a\u6b63\u5e38\n                let json = JSON(data: data!)\n                print(json) // debug\n                \n                appDelegate.analyzedFaces = self.interpretJson(image: image, json: json)\n\n                // \u30ea\u30af\u30a8\u30b9\u30c8\u306f\u975e\u540c\u671f\u306e\u305f\u3081\u753b\u9762\u9077\u79fb\u3092mainQueue\u3067\u884c\u308f\u306a\u3044\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\n                OperationQueue.main.addOperation(\n                    {\n                        //\u3000activityIndicator\u505c\u6b62\n                        self.activityIndicator.stopAnimating()\n                        if appDelegate.analyzedFaces.count > 0 {\n                            // \u9854\u89e3\u6790\u7d50\u679c\u3042\u308a\n                            self.performSegue(withIdentifier: \"ShowResult\", sender: self)\n                        } else {\n                            // \u9854\u89e3\u6790\u7d50\u679c\u306a\u3057\n                            let actionSheet = UIAlertController(title:\"\u30a8\u30e9\u30fc\", message: \"\u9854\u691c\u51fa\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\", preferredStyle: .alert)\n                            let actionCancel = UIAlertAction(title: \"\u30ad\u30e3\u30f3\u30bb\u30eb\", style: .cancel, handler: {action in\n                            })\n                            actionSheet.addAction(actionCancel)\n                            self.present(actionSheet, animated: true, completion: nil)\n                        }\n                    }\n                )\n            } else {\n                // API\u30ec\u30b9\u30dd\u30f3\u30b9\uff1a\u30a8\u30e9\u30fc\n                print(error.debugDescription)   // debug\n            }\n            //\u3000activityIndicator\u505c\u6b62\n            if self.activityIndicator.isAnimating {\n                self.activityIndicator.stopAnimating()\n            }\n        }\n        \n        task.resume()\n    }\n    \n    /**\n     \u89e3\u6790\u7d50\u679c\u306eJSON\u3092\u89e3\u91c8\u3057\u3066AnalyzedFace\u578b\u306e\u914d\u5217\u3067\u8fd4\u3059\n     - parameter image: \u5143\u753b\u50cf\n     - parameter json: JSON\u30c7\u30fc\u30bf\n     - returns: AnalyzedFace\u578b\u306e\u914d\u5217\n     */\n    func interpretJson(image: UIImage, json: JSON) -> Array<AnalyzedFace> {\n        var analyzedFaces: Array<AnalyzedFace> = []\n        let facesJson = json[\"images\"][0][\"faces\"].arrayValue\n        // \u30ec\u30b9\u30dd\u30f3\u30b9\u306eimageFaces\u8981\u7d20\u306f\u914d\u5217\u3068\u306a\u3063\u3066\u3044\u308b\uff08\u8907\u6570\u4eba\u304c\u6620\u3063\u305f\u753b\u50cf\u306e\u89e3\u6790\u304c\u53ef\u80fd\uff09\n        for faceJson in facesJson {\n            let face = AnalyzedFace()\n            // \u6027\u5225\u304a\u3088\u3073\u30b9\u30b3\u30a2\n            guard let gender = faceJson[\"gender\"][\"gender\"].string else {\n                continue\n            }\n            if gender == \"MALE\" {\n                face.gender = \"\u7537\u6027\"\n            } else {\n                face.gender = \"\u5973\u6027\"\n            }\n            guard let genderScore = faceJson[\"gender\"][\"score\"].double else {\n                continue\n            }\n            face.genderScore = String(floor(genderScore * 1000) / 10)\n            // \u5e74\u9f62\u304a\u3088\u3073\u30b9\u30b3\u30a2\n            if let ageMin = faceJson[\"age\"][\"min\"].int {\n                face.ageMin = String(ageMin)\n            }\n            if let ageMax = faceJson[\"age\"][\"max\"].int {\n                face.ageMax = String(ageMax)\n            }\n            guard let ageScore = faceJson[\"age\"][\"score\"].double else {\n                continue\n            }\n            face.ageScore = String(floor(ageScore * 1000) / 10)\n            // Identity\n            if let identity = faceJson[\"identity\"][\"name\"].string {\n                face.identity = identity\n            }\n            // \u691c\u51fa\u3055\u308c\u305f\u9854\u306e\u77e9\u5f62\n            guard let left = faceJson[\"face_location\"][\"left\"].int else {\n                continue\n            }\n            guard let top = faceJson[\"face_location\"][\"top\"].int else {\n                continue\n            }\n            guard let width = faceJson[\"face_location\"][\"width\"].int else {\n                continue\n            }\n            guard let height = faceJson[\"face_location\"][\"height\"].int else {\n                continue\n            }\n            // \u5143\u753b\u50cf\u304b\u3089\u5207\u308a\u629c\u3044\u3066\u5909\u6570\u306b\u30bb\u30c3\u30c8\n            face.image = self.cropping(image: image, left: CGFloat(left), top: CGFloat(top), width: CGFloat(width), height: CGFloat(height))\n            // \u62bd\u51fa\u5b8c\u4e86\n            analyzedFaces.append(face)\n        }\n        return analyzedFaces\n    }\n    \n    /**\n     \u5143\u753b\u50cf\u304b\u3089\u77e9\u5f62\u3092\u5207\u308a\u629c\u304f\n     - parameter image: \u5143\u753b\u50cf\n     - parameter left: x\u5ea7\u6a19\n     - parameter top: y\u5ea7\u6a19\n     - parameter width: \u5e45\n     - parameter height: \u9ad8\u3055\n     - returns: UIImage\n     */\n    func cropping(image: UIImage, left: CGFloat, top: CGFloat, width: CGFloat, height: CGFloat) -> UIImage? {\n        let imgRef = image.cgImage?.cropping(to: CGRect(x: left, y: top, width: width, height: height))\n        return UIImage(cgImage: imgRef!, scale: image.scale, orientation: image.imageOrientation)\n    }\n    \n}\n```\n\n```Swift:SubTableViewController.swift\nimport UIKit\n\nclass SubTableViewController: UITableViewController {\n\n    // \u89e3\u6790\u7d50\u679c\u306fAppDelegate\u306e\u5909\u6570\u306b\u5165\u3063\u3066\u3044\u308b\n    private let appDelegate: AppDelegate = UIApplication.shared.delegate as! AppDelegate\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n\n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n    }\n\n    // MARK: - Table view data source\n\n    /**\n     \u30bb\u30eb\u306e\u6570\u3092\u8fd4\u3059\n     */\n    override func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {\n        return self.appDelegate.analyzedFaces.count\n    }\n\n    /**\n     \u30bb\u30eb\u306e\u9805\u76ee\u3092\u30bb\u30c3\u30c8\n     */\n    override func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n        let result = self.appDelegate.analyzedFaces[indexPath.row]\n        let cell = tableView.dequeueReusableCell(withIdentifier: \"ResultCell\", for: indexPath) as! ResultTableViewCell\n        cell.setData(data: result)\n        return cell\n    }\n}\n```\n\n```Swift:ResultTableViewCell\nimport UIKit\n\nclass ResultTableViewCell: UITableViewCell {\n\n    @IBOutlet weak var faceImageView: UIImageView!\n    @IBOutlet weak var genderNameLabel: UILabel!\n    @IBOutlet weak var genderScoreLabel: UILabel!\n    @IBOutlet weak var ageRangeLabel: UILabel!\n    @IBOutlet weak var ageScoreLabel: UILabel!\n    @IBOutlet weak var identityLabel: UILabel!\n\n    /**\n     \u30bb\u30eb\u306e\u5185\u5bb9\u3092\u30bb\u30c3\u30c8\n     - parameter data: \u89e3\u6790\u7d50\u679c\n     */\n    func setData(data: AnalyzedFace) {\n        self.faceImageView.image = data.image\n        if let gender = data.gender {\n            self.genderNameLabel.text = \"\u6027\u5225\uff1a\" + gender\n        }\n        if let genderScore = data.genderScore {\n            self.genderScoreLabel.text = \"\u3000\u3000\u3000\u78ba\u4fe1\u5ea6\uff1a\" + genderScore + \"%\"\n        }\n        var ageRangeText = \"\u5e74\u9f62\uff1a\"\n        if let ageMin = data.ageMin {\n            ageRangeText += ageMin + \"\u624d\u4ee5\u4e0a \"\n        }\n        if let ageMax = data.ageMax {\n            ageRangeText += ageMax + \"\u624d\u4ee5\u4e0b\"\n        }\n        self.ageRangeLabel.text = ageRangeText\n        if let ageScore = data.ageScore {\n            self.ageScoreLabel.text = \"\u3000\u3000\u3000\u78ba\u4fe1\u5ea6\uff1a\" + ageScore + \"%\"\n        }\n        self.identityLabel.text = data.identity\n    }\n    \n}\n```\n\n# \u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\n\nhttps://github.com/y-some/WatsonVR-DetectFaces\n", "tags": ["Swift", "iOS", "Watson", "\u4eba\u5de5\u77e5\u80fd", "\u753b\u50cf\u8a8d\u8b58"]}