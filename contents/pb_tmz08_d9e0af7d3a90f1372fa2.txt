{"context": " More than 1 year has passed since last update.\n\nSmarty\u3068\u306f\nPHP\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002 \n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3044\u3048\u3070\u3001\nMVC\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306eView\u3092\u62c5\u5f53\u3057\u3066\u3044\u3066\n\u300cHTML\u3092\u51fa\u529b\u3059\u308b\u3082\u306e\u300d \u307f\u305f\u3044\u306a\u30a4\u30e1\u30fc\u30b8\u304c\u5f37\u3044\u3067\u3059\u304c\n\u300c\u6761\u4ef6\u306b\u5fdc\u3058\u305f\u30c6\u30ad\u30b9\u30c8\u3092\u5410\u304d\u51fa\u3059\u4fbf\u5229\u30c4\u30fc\u30eb\u300d \u3068\u3057\u3066\u6349\u3048\u305f\u3068\u304d\n\u300cPHP\u5185\u90e8\u3067\u8a18\u8ff0\u3057\u3066\u308bSQL\u3082\u5206\u96e2\u3067\u304d\u308b\u3093\u3058\u3083\u306d\uff1f\u300d \u3068\u601d\u3044\u7acb\u3061\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001\u81ea\u4f5c\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u304a\u3044\u3066SQL\u3092\u5206\u96e2\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u3001smarty\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u306bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\u3002\n\nControllerBase.class.php\n<?php\nabstract class ControllerBase\n{\n    /* \u4e00\u90e8\u629c\u7c8b */\n    protected $_smarty;\n\n    private function _initializeTemplateEngine()\n    {\n        $this->_smarty = new Smarty();\n        $this->_smarty->template_dir = array(\n            SMARTY_TEMPLETE.DS.'sql',\n            SMARTY_TEMPLETE.DS.'common',\n            SMARTY_TEMPLETE.DS.$this->_controller.DS.$this->_action,\n        );\n        $this->_smarty->compile_dir = SMARTY_COMPILE.DS ;\n        $this->_smarty->cache_dir   = SMARTY_CACHE.DS ;\n        $this->_smarty->config_dir  = SMARTY_CONFIGS.DS ;\n    }\n\n    private function _setCollection()\n    {\n        $tables = Database::getTables(USE_DB);\n\n        foreach ($tables as $v) {\n            $this->_collection[$v] = CreateInstance::createModelInstance($v);\n\n            /* \uff08\u4e2d\u7565\uff09 */\n\n            // \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3092\u5229\u7528\u3059\u308b\n            if (method_exists($this->_collection[$v], 'setTemplateEngine')) {\n                $this->_collection[$v]->setTemplateEngine($this->_smarty);\n            }\n        }\n    }\n\n}\n\n\n_initializeTemplateEngine() \u3067Smarty\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3001\u5404\u7a2e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n_setCollection() \u3067\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3064\u3064\u3001_smarty \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30e2\u30c7\u30eb\u3067\u3082\u5171\u6709\u3059\u308b\u3002\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306f\u3001ModelBase \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\uff08\u81ea\u4f5c\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5185\u306e\u524d\u63d0\uff09\u306e\u3067\nModelBase \u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066 setTemplateEngine \u3092\u5b9a\u7fa9\u3059\u308b\u3002\n\nModelBase.class.php\n<?php\nabstract class ModelBase extends ModelCore\n{\n    /* \u4e00\u90e8\u629c\u7c8b */\n\n    protected $_smarty;\n    protected $_sqlParams;\n\n    public function __construct()\n    {\n        $this->_sqlParams = array();\n        parent::__construct();\n    }\n\n    /* \uff08\u4e2d\u7565\uff09 */\n\n    public function setTemplateEngine($_obj)\n    {\n        $this->_smarty = $_obj;\n    }\n\n    protected function _makeQuery($_class, $_function)\n    {\n        $this->_smarty->assign('_sqlParams', $this->_sqlParams);\n        return $this->_smarty->fetch($_class.DS.$_function.'.sql');\n    }\n}\n\n\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u30e1\u30bd\u30c3\u30c9 getData() \u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3002\n\nHogeFuga.class.php\n<?php\nclass HogeFuga extends ModelBase\n{\n    public function getData($id)\n    {\n        // \u30b3\u30e1\u30f3\u30c8\u304b\u3089\u306e\u3054\u6307\u6458 [#comment-d4c53ddaaa31e43d4ae8]\n        // \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u3001\u9069\u5207\u306a\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\n        $this->_sqlParams['id'] = $id;\n        $query = $this->_makeQuery(__CLASS__, __FUNCTION__);\n        $row = $this->_result($query); // ModelCore \u5185\u3067\u5b9a\u7fa9\n        return $this->_formingResultRows($row); // ModelCore \u5185\u3067\u5b9a\u7fa9\n    }\n}\n\n\n\u6700\u5f8c\u306b\u3001SQL\u30d5\u30a1\u30a4\u30eb\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3002\n\nSMARTY_TEMPLETE.DS.'sql'.DS.'HogeFuga'.DS.'getData.sql'\nSELECT * FROM {$_sqlParams._table} WHERE id={$_sqlParams.id}\n\n\n\u3053\u306e\u65b9\u6cd5\u306b\u3088\u308a\u3001PHP\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u90e8\u304b\u3089SQL\u6587\u304c\u5b8c\u5168\u306b\u5206\u96e2\u3067\u304d\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u898b\u901a\u3057\u304c\u304b\u306a\u308a\u30b9\u30c3\u30ad\u30ea\u3057\u307e\u3057\u305f\u3002\n\u7d30\u304b\u3044\u8abf\u6574\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u304c\n\u540c\u4e00\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u8907\u6570\u306e\u30af\u30a8\u30ea\u3092\u767a\u884c\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306f\u3001\nsmarty \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u90e8\u3067{if}{/if} \u306a\u3069\u3067\u5206\u5c90\u3057\u3066\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\uff08\u500b\u4eba\u7684\u306a\u76ee\u6a19\u306f1\u30e1\u30bd\u30c3\u30c91\u30af\u30a8\u30ea\u30fc\uff09\n\u4ee5\u4e0a\u3001\u3056\u3056\u3063\u3068\u66f8\u3044\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u306a\u306b\u304b\u306e\u304a\u5f79\u306b\u7acb\u3066\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\u8ffd\u8a18\nSQL\u30a8\u30b9\u30b1\u30fc\u30d7\u306b\u3064\u3044\u3066\u3001\u4e0b\u8a18\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nPHP\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3059\u308b\u3068\u304d\u306e\u307e\u3068\u3081\nPHP\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89e3\u8aac\u66f812\u7a2e\u985e\u3092\u8aad\u3093\u3067SQL\u30a8\u30b9\u30b1\u30fc\u30d7\u306e\u89e3\u8aac\u72b6\u6cc1\u3092\u8abf\u3079\u3066\u307f\u305f\n\n## [Smarty](http://www.smarty.net/)\u3068\u306f\nPHP\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002 \n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3068\u3044\u3048\u3070\u3001\nMVC\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306eView\u3092\u62c5\u5f53\u3057\u3066\u3044\u3066\n**\u300cHTML\u3092\u51fa\u529b\u3059\u308b\u3082\u306e\u300d** \u307f\u305f\u3044\u306a\u30a4\u30e1\u30fc\u30b8\u304c\u5f37\u3044\u3067\u3059\u304c\n**\u300c\u6761\u4ef6\u306b\u5fdc\u3058\u305f\u30c6\u30ad\u30b9\u30c8\u3092\u5410\u304d\u51fa\u3059\u4fbf\u5229\u30c4\u30fc\u30eb\u300d** \u3068\u3057\u3066\u6349\u3048\u305f\u3068\u304d\n**\u300cPHP\u5185\u90e8\u3067\u8a18\u8ff0\u3057\u3066\u308bSQL\u3082\u5206\u96e2\u3067\u304d\u308b\u3093\u3058\u3083\u306d\uff1f\u300d** \u3068\u601d\u3044\u7acb\u3061\u307e\u3057\u305f\u3002\n\n\u305d\u3053\u3067\u3001\u81ea\u4f5c\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u304a\u3044\u3066SQL\u3092\u5206\u96e2\u3055\u305b\u3066\u307f\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u3001smarty\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u306bSQL\u30d5\u30a1\u30a4\u30eb\u3092\u7ba1\u7406\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\u3002\n\n```php:ControllerBase.class.php\n<?php\nabstract class ControllerBase\n{\n    /* \u4e00\u90e8\u629c\u7c8b */\n    protected $_smarty;\n\n    private function _initializeTemplateEngine()\n    {\n        $this->_smarty = new Smarty();\n        $this->_smarty->template_dir = array(\n            SMARTY_TEMPLETE.DS.'sql',\n            SMARTY_TEMPLETE.DS.'common',\n            SMARTY_TEMPLETE.DS.$this->_controller.DS.$this->_action,\n        );\n        $this->_smarty->compile_dir = SMARTY_COMPILE.DS ;\n        $this->_smarty->cache_dir   = SMARTY_CACHE.DS ;\n        $this->_smarty->config_dir  = SMARTY_CONFIGS.DS ;\n    }\n\n    private function _setCollection()\n    {\n        $tables = Database::getTables(USE_DB);\n\n        foreach ($tables as $v) {\n            $this->_collection[$v] = CreateInstance::createModelInstance($v);\n\n            /* \uff08\u4e2d\u7565\uff09 */\n\n            // \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u3092\u5229\u7528\u3059\u308b\n            if (method_exists($this->_collection[$v], 'setTemplateEngine')) {\n                $this->_collection[$v]->setTemplateEngine($this->_smarty);\n            }\n        }\n    }\n\n}\n```\n\n`` _initializeTemplateEngine() `` \u3067Smarty\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3001\u5404\u7a2e\u8a2d\u5b9a\u3092\u884c\u3046\u3002\n\n`` _setCollection() `` \u3067\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3064\u3064\u3001_smarty \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30e2\u30c7\u30eb\u3067\u3082\u5171\u6709\u3059\u308b\u3002\n\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u306f\u3001ModelBase \u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u3066\u3044\u308b\uff08\u81ea\u4f5c\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5185\u306e\u524d\u63d0\uff09\u306e\u3067\nModelBase \u30af\u30e9\u30b9\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066 setTemplateEngine \u3092\u5b9a\u7fa9\u3059\u308b\u3002\n\n```php:ModelBase.class.php\n<?php\nabstract class ModelBase extends ModelCore\n{\n    /* \u4e00\u90e8\u629c\u7c8b */\n\n    protected $_smarty;\n    protected $_sqlParams;\n\n    public function __construct()\n    {\n        $this->_sqlParams = array();\n        parent::__construct();\n    }\n\n    /* \uff08\u4e2d\u7565\uff09 */\n\n    public function setTemplateEngine($_obj)\n    {\n        $this->_smarty = $_obj;\n    }\n\n    protected function _makeQuery($_class, $_function)\n    {\n        $this->_smarty->assign('_sqlParams', $this->_sqlParams);\n        return $this->_smarty->fetch($_class.DS.$_function.'.sql');\n    }\n}\n```\n\n\u5404\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u30e1\u30bd\u30c3\u30c9 `` getData() `` \u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3002\n\n```php:HogeFuga.class.php\n<?php\nclass HogeFuga extends ModelBase\n{\n    public function getData($id)\n    {\n        // \u30b3\u30e1\u30f3\u30c8\u304b\u3089\u306e\u3054\u6307\u6458 [#comment-d4c53ddaaa31e43d4ae8]\n        // \u5165\u529b\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u306f\u3001\u9069\u5207\u306a\u30a8\u30b9\u30b1\u30fc\u30d7\u51e6\u7406\u3092\u884c\u3046\u3053\u3068\n        $this->_sqlParams['id'] = $id;\n        $query = $this->_makeQuery(__CLASS__, __FUNCTION__);\n        $row = $this->_result($query); // ModelCore \u5185\u3067\u5b9a\u7fa9\n        return $this->_formingResultRows($row); // ModelCore \u5185\u3067\u5b9a\u7fa9\n    }\n}\n```\n\n\u6700\u5f8c\u306b\u3001SQL\u30d5\u30a1\u30a4\u30eb\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3002\n\n```sql:SMARTY_TEMPLETE.DS.'sql'.DS.'HogeFuga'.DS.'getData.sql'\nSELECT * FROM {$_sqlParams._table} WHERE id={$_sqlParams.id}\n```\n\n\u3053\u306e\u65b9\u6cd5\u306b\u3088\u308a\u3001PHP\u30b9\u30af\u30ea\u30d7\u30c8\u5185\u90e8\u304b\u3089SQL\u6587\u304c\u5b8c\u5168\u306b\u5206\u96e2\u3067\u304d\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u898b\u901a\u3057\u304c\u304b\u306a\u308a\u30b9\u30c3\u30ad\u30ea\u3057\u307e\u3057\u305f\u3002\n\n\u7d30\u304b\u3044\u8abf\u6574\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u304c\n\u540c\u4e00\u30e1\u30bd\u30c3\u30c9\u5185\u3067\u8907\u6570\u306e\u30af\u30a8\u30ea\u3092\u767a\u884c\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306f\u3001\nsmarty \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u90e8\u3067`` {if}{/if} `` \u306a\u3069\u3067\u5206\u5c90\u3057\u3066\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\uff08\u500b\u4eba\u7684\u306a\u76ee\u6a19\u306f1\u30e1\u30bd\u30c3\u30c91\u30af\u30a8\u30ea\u30fc\uff09\n\n\u4ee5\u4e0a\u3001\u3056\u3056\u3063\u3068\u66f8\u3044\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u306a\u306b\u304b\u306e\u304a\u5f79\u306b\u7acb\u3066\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\n\n## \u8ffd\u8a18\nSQL\u30a8\u30b9\u30b1\u30fc\u30d7\u306b\u3064\u3044\u3066\u3001\u4e0b\u8a18\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n* [PHP\u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3059\u308b\u3068\u304d\u306e\u307e\u3068\u3081](http://qiita.com/mpyw/items/b00b72c5c95aac573b71)\n* [PHP\u3068\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89e3\u8aac\u66f812\u7a2e\u985e\u3092\u8aad\u3093\u3067SQL\u30a8\u30b9\u30b1\u30fc\u30d7\u306e\u89e3\u8aac\u72b6\u6cc1\u3092\u8abf\u3079\u3066\u307f\u305f](http://blog.tokumaru.org/2013/12/php12sql.html)\n", "tags": ["PHP5.x", "Smarty3.1.x"]}