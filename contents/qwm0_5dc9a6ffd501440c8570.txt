{"tags": ["curl", "openssl"], "context": "\n\n\u52d5\u6a5f\n\u6697\u53f7\u5316\u65b9\u5f0f\uff1aECDHE-RSA-AES256-SHA384 \u306a\u3069\u306b\u5bfe\u5fdc\u3057\u305fHTTPS\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066cipher\u3092\u6307\u5b9a\u3057\u3066curl\u3092\u53e9\u3044\u305f\u3089OS\u304c\u53e4\u304b\u3063\u305f(CentOS release 5.11 (Final))\u306e\u3067\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n$ curl -V\ncurl 7.15.5 (x86_64-redhat-linux-gnu) libcurl/7.15.5 OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5\nProtocols: tftp ftp telnet dict ldap http file https ftps \nFeatures: GSS-Negotiate IDN IPv6 Largefile NTLM SSL libz \n$ curl -v -L --ciphers ECDHE-RSA-AES256-SHA384 <URL>\n* About to connect() to <domain>(<ipaddr>) port 443\n*   Trying <ipaddr>... connected\n* Connected to <domain> port 443\n* failed setting cipher list\n* Closing connection #0\ncurl: (59) failed setting cipher list\n\n\u3068\u3044\u3046\u304bOpenSSL\u306e\u5229\u7528\u53ef\u80fd\u306aciphers\u306b\u305d\u3082\u305d\u3082ECDHE\u7cfb\u304c\u3042\u308a\u307e\u305b\u3093\u2026\n$ /usr/bin/openssl version\nOpenSSL 0.9.8e-fips-rhel5 01 Jul 2008\n$ /usr/bin/openssl  ciphers -v | grep ECDHE | wc -l\n0\n\n\u8af8\u822c\u306e\u4e8b\u60c5\u306b\u3088\u308aOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u305f\u3081\u306e\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4e0d\u53ef\u3002\u3053\u306e\u305f\u3081tarball\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u3084\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u624b\u9806\nOpenSSL\u3092make\u3057\u3066install \u21d2 curl\u3092make\u3057\u3066install\u3057\u307e\u3059\u3002\n\u6ce8\u610f\u3059\u308b\u70b9\u3068\u3057\u3066\u6700\u8fd1\u306eOpenSSL\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89b3\u70b9\u304b\u3089SSL2\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e00\u65b9\u3001\u3053\u308c\u3092\u6709\u52b9\u5316\u3057\u3066\u3084\u3089\u306a\u3044\u3068curl\u304c\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u305b\u3093\u3002\n\u53c2\u7167\uff1ahttps://www.openssl.org/news/openssl-1.0.2-notes.html\nMajor changes between OpenSSL 1.0.2f and OpenSSL 1.0.2g [1 Mar 2016]\n\nDisable SSLv2 default build, default negotiation and weak ciphers (CVE-2016-0800)\n\n\u4f55\u3082\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fOpenSSL\u3092\u5229\u7528\u3059\u308b\u3068curl\u306emake\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3092\u5410\u304d\u307e\u3059\u3002\n../lib/.libs/libcurl.so: undefined reference to `SSLv2_client_method\u2019 \n\n\nOpenSSL-1.0.2j\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3068\u3044\u3046\u3053\u3068\u3067OpenSSL\u3092tarball\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ tar xzvf openssl-1.0.2j.tar.gz \n$ cd openssl-1.0.2j/\n$ ./config shared enable-ssl2 enable-ssl3 --prefix=<prefixdir> --openssldir=<prefixdir>\n$ make depend\n$ make\n$ make install\n\n\ncurl-7.51.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3064\u3065\u3044\u3066curl\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002--with-ssl\u3067\u5148\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fopenssl\u306elib\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ tar xzvf curl-7.51.0.tar.bz2 \n$ cd curl-7.51.0/\n$ ./configure  --enable-libcurl-option --with-ssl=<openssl\u306edir> --prefix=<curl\u306eprefixdir>\n$ make\n$ make install\n\n\n\u3067\u304d\u307e\u3057\u305f\n\u7121\u4e8bOpenSSL\u304c1.0.2j\u3068\u306a\u308a\u307e\u3057\u305f\u3002\n$ LD_LIBRARY_PATH=<openssl_libdir> <compiled_curl_dir>/curl -V\ncurl 7.51.0 (x86_64-pc-linux-gnu) libcurl/7.51.0 OpenSSL/1.0.2j zlib/1.2.3\nProtocols: dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp \nFeatures: Largefile NTLM NTLM_WB SSL libz TLS-SRP UnixSockets \n\nOpenSSL\u81ea\u4f53\u3082ECDHE\u7cfb\u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n# <compiled_openssl_dir>/bin/openssl  ciphers -v | grep ECDHE\nECDHE-RSA-AES256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AESGCM(256) Mac=AEAD\nECDHE-ECDSA-AES256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(256) Mac=AEAD\nECDHE-RSA-AES256-SHA384 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AES(256)  Mac=SHA384\nECDHE-ECDSA-AES256-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA384\nECDHE-RSA-AES256-SHA    SSLv3 Kx=ECDH     Au=RSA  Enc=AES(256)  Mac=SHA1\nECDHE-ECDSA-AES256-SHA  SSLv3 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA1\nECDHE-RSA-AES128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AESGCM(128) Mac=AEAD\nECDHE-ECDSA-AES128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(128) Mac=AEAD\nECDHE-RSA-AES128-SHA256 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AES(128)  Mac=SHA256\nECDHE-ECDSA-AES128-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA256\nECDHE-RSA-AES128-SHA    SSLv3 Kx=ECDH     Au=RSA  Enc=AES(128)  Mac=SHA1\nECDHE-ECDSA-AES128-SHA  SSLv3 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA1\nECDHE-RSA-RC4-SHA       SSLv3 Kx=ECDH     Au=RSA  Enc=RC4(128)  Mac=SHA1\nECDHE-ECDSA-RC4-SHA     SSLv3 Kx=ECDH     Au=ECDSA Enc=RC4(128)  Mac=SHA1\nECDHE-RSA-DES-CBC3-SHA  SSLv3 Kx=ECDH     Au=RSA  Enc=3DES(168) Mac=SHA1\nECDHE-ECDSA-DES-CBC3-SHA SSLv3 Kx=ECDH     Au=ECDSA Enc=3DES(168) Mac=SHA1\n\n\u305d\u3057\u3066\u7121\u4e8b\u63a5\u7d9a\u3067\u304d\u307e\u3057\u305f\u3002\n$ LD_LIBRARY_PATH=<openssl_libdir> <compiled_curl_dir>/curl -v -L --ciphers ECDHE-RSA-AES256-SHA384 https://<domain>/\n*   Trying <ipaddr>...\n* TCP_NODELAY set\n* Connected to <domain> (<ipaddr>) port 443 (#0)\n* ALPN, offering http/1.1\n* Cipher selection: ECDHE-RSA-AES256-SHA384\n* successfully set certificate verify locations:\n*   CAfile: /etc/pki/tls/certs/ca-bundle.crt\n  CApath: none\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\n* TLSv1.2 (OUT), TLS handshake, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n* TLSv1.2 (OUT), TLS change cipher, Client hello (1):\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\n* TLSv1.2 (IN), TLS change cipher, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Finished (20):\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-SHA384\n* ALPN, server accepted to use http/1.1\n* Server certificate:\n...\n*  SSL certificate verify ok.\n> GET / HTTP/1.1\n> Host: <domain>\n> User-Agent: curl/7.51.0\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n...\n\n\u4ee5\u4e0a\n# \u52d5\u6a5f\n\n\u6697\u53f7\u5316\u65b9\u5f0f\uff1aECDHE-RSA-AES256-SHA384 \u306a\u3069\u306b\u5bfe\u5fdc\u3057\u305fHTTPS\u30b5\u30fc\u30d0\u306b\u5bfe\u3057\u3066cipher\u3092\u6307\u5b9a\u3057\u3066curl\u3092\u53e9\u3044\u305f\u3089OS\u304c\u53e4\u304b\u3063\u305f(CentOS release 5.11 (Final))\u306e\u3067\u52d5\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\n$ curl -V\ncurl 7.15.5 (x86_64-redhat-linux-gnu) libcurl/7.15.5 OpenSSL/0.9.8b zlib/1.2.3 libidn/0.6.5\nProtocols: tftp ftp telnet dict ldap http file https ftps \nFeatures: GSS-Negotiate IDN IPv6 Largefile NTLM SSL libz \n$ curl -v -L --ciphers ECDHE-RSA-AES256-SHA384 <URL>\n* About to connect() to <domain>(<ipaddr>) port 443\n*   Trying <ipaddr>... connected\n* Connected to <domain> port 443\n* failed setting cipher list\n* Closing connection #0\ncurl: (59) failed setting cipher list\n```\n\n\u3068\u3044\u3046\u304bOpenSSL\u306e\u5229\u7528\u53ef\u80fd\u306aciphers\u306b\u305d\u3082\u305d\u3082ECDHE\u7cfb\u304c\u3042\u308a\u307e\u305b\u3093\u2026\n\n```\n$ /usr/bin/openssl version\nOpenSSL 0.9.8e-fips-rhel5 01 Jul 2008\n$ /usr/bin/openssl  ciphers -v | grep ECDHE | wc -l\n0\n```\n \n\u8af8\u822c\u306e\u4e8b\u60c5\u306b\u3088\u308aOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u306e\u305f\u3081\u306e\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u4e0d\u53ef\u3002\u3053\u306e\u305f\u3081tarball\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u3084\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u624b\u9806\nOpenSSL\u3092make\u3057\u3066install \u21d2 curl\u3092make\u3057\u3066install\u3057\u307e\u3059\u3002\n\n\u6ce8\u610f\u3059\u308b\u70b9\u3068\u3057\u3066\u6700\u8fd1\u306eOpenSSL\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89b3\u70b9\u304b\u3089SSL2\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u4e00\u65b9\u3001\u3053\u308c\u3092\u6709\u52b9\u5316\u3057\u3066\u3084\u3089\u306a\u3044\u3068curl\u304c\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u305b\u3093\u3002\n\u53c2\u7167\uff1ahttps://www.openssl.org/news/openssl-1.0.2-notes.html\n\n```\nMajor changes between OpenSSL 1.0.2f and OpenSSL 1.0.2g [1 Mar 2016]\n\nDisable SSLv2 default build, default negotiation and weak ciphers (CVE-2016-0800)\n```\n\n\u4f55\u3082\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u306a\u3044\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fOpenSSL\u3092\u5229\u7528\u3059\u308b\u3068curl\u306emake\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u3092\u5410\u304d\u307e\u3059\u3002\n\n```\n../lib/.libs/libcurl.so: undefined reference to `SSLv2_client_method\u2019 \n```\n\n## OpenSSL-1.0.2j\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3068\u3044\u3046\u3053\u3068\u3067OpenSSL\u3092tarball\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ tar xzvf openssl-1.0.2j.tar.gz \n$ cd openssl-1.0.2j/\n$ ./config shared enable-ssl2 enable-ssl3 --prefix=<prefixdir> --openssldir=<prefixdir>\n$ make depend\n$ make\n$ make install\n```\n\n## curl-7.51.0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u3064\u3065\u3044\u3066curl\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002--with-ssl\u3067\u5148\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fopenssl\u306elib\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n$ tar xzvf curl-7.51.0.tar.bz2 \n$ cd curl-7.51.0/\n$ ./configure  --enable-libcurl-option --with-ssl=<openssl\u306edir> --prefix=<curl\u306eprefixdir>\n$ make\n$ make install\n```\n# \u3067\u304d\u307e\u3057\u305f\n\n\u7121\u4e8bOpenSSL\u304c1.0.2j\u3068\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\n$ LD_LIBRARY_PATH=<openssl_libdir> <compiled_curl_dir>/curl -V\ncurl 7.51.0 (x86_64-pc-linux-gnu) libcurl/7.51.0 OpenSSL/1.0.2j zlib/1.2.3\nProtocols: dict file ftp ftps gopher http https imap imaps pop3 pop3s rtsp smb smbs smtp smtps telnet tftp \nFeatures: Largefile NTLM NTLM_WB SSL libz TLS-SRP UnixSockets \n```\n\nOpenSSL\u81ea\u4f53\u3082ECDHE\u7cfb\u304c\u5229\u7528\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\n# <compiled_openssl_dir>/bin/openssl  ciphers -v | grep ECDHE\nECDHE-RSA-AES256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AESGCM(256) Mac=AEAD\nECDHE-ECDSA-AES256-GCM-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(256) Mac=AEAD\nECDHE-RSA-AES256-SHA384 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AES(256)  Mac=SHA384\nECDHE-ECDSA-AES256-SHA384 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA384\nECDHE-RSA-AES256-SHA    SSLv3 Kx=ECDH     Au=RSA  Enc=AES(256)  Mac=SHA1\nECDHE-ECDSA-AES256-SHA  SSLv3 Kx=ECDH     Au=ECDSA Enc=AES(256)  Mac=SHA1\nECDHE-RSA-AES128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AESGCM(128) Mac=AEAD\nECDHE-ECDSA-AES128-GCM-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AESGCM(128) Mac=AEAD\nECDHE-RSA-AES128-SHA256 TLSv1.2 Kx=ECDH     Au=RSA  Enc=AES(128)  Mac=SHA256\nECDHE-ECDSA-AES128-SHA256 TLSv1.2 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA256\nECDHE-RSA-AES128-SHA    SSLv3 Kx=ECDH     Au=RSA  Enc=AES(128)  Mac=SHA1\nECDHE-ECDSA-AES128-SHA  SSLv3 Kx=ECDH     Au=ECDSA Enc=AES(128)  Mac=SHA1\nECDHE-RSA-RC4-SHA       SSLv3 Kx=ECDH     Au=RSA  Enc=RC4(128)  Mac=SHA1\nECDHE-ECDSA-RC4-SHA     SSLv3 Kx=ECDH     Au=ECDSA Enc=RC4(128)  Mac=SHA1\nECDHE-RSA-DES-CBC3-SHA  SSLv3 Kx=ECDH     Au=RSA  Enc=3DES(168) Mac=SHA1\nECDHE-ECDSA-DES-CBC3-SHA SSLv3 Kx=ECDH     Au=ECDSA Enc=3DES(168) Mac=SHA1\n```\n\n\u305d\u3057\u3066\u7121\u4e8b\u63a5\u7d9a\u3067\u304d\u307e\u3057\u305f\u3002\n\n```\n$ LD_LIBRARY_PATH=<openssl_libdir> <compiled_curl_dir>/curl -v -L --ciphers ECDHE-RSA-AES256-SHA384 https://<domain>/\n*   Trying <ipaddr>...\n* TCP_NODELAY set\n* Connected to <domain> (<ipaddr>) port 443 (#0)\n* ALPN, offering http/1.1\n* Cipher selection: ECDHE-RSA-AES256-SHA384\n* successfully set certificate verify locations:\n*   CAfile: /etc/pki/tls/certs/ca-bundle.crt\n  CApath: none\n* TLSv1.2 (OUT), TLS header, Certificate Status (22):\n* TLSv1.2 (OUT), TLS handshake, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Server hello (2):\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\n* TLSv1.2 (OUT), TLS change cipher, Client hello (1):\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\n* TLSv1.2 (IN), TLS change cipher, Client hello (1):\n* TLSv1.2 (IN), TLS handshake, Finished (20):\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES256-SHA384\n* ALPN, server accepted to use http/1.1\n* Server certificate:\n...\n*  SSL certificate verify ok.\n> GET / HTTP/1.1\n> Host: <domain>\n> User-Agent: curl/7.51.0\n> Accept: */*\n> \n< HTTP/1.1 200 OK\n...\n```\n\n\u4ee5\u4e0a\n"}