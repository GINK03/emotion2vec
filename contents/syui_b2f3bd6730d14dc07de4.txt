{"tags": ["jQuery", "GitHub", "HTML", "Ajax", "GitLab"], "context": "cal-heatmap\u306f\u3001GitLab\u306b\u3082\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001GitLab\u30e6\u30fc\u30b6\u30fc\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3092JSON\u3067\u53d6\u5f97\u3057\u3001\u30b5\u30a4\u30c8\u306b\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n$ bower install cal-heatmap\n\n\nindex.html\n<script src=\"/bower_components/d3/d3.min.js\" charset=\"utf-8\"></script>\n<script src=\"/bower_components/cal-heatmap/cal-heatmap.min.js\"></script>\n<link rel=\"stylesheet\" href=\"/bower_components/cal-heatmap/cal-heatmap.css\" />\n\n<h3>GitLab Calendar Activities</h3>\n<div id=\"cal-heatmap\"></div>\n<div id=\"example-heatmap\"></div>\n<script type=\"text/javascript\">\nvar cal = new CalHeatMap();\ncal.init({\n    itemSelector: \"#example-heatmap\",\n    domain: \"month\",\n    data: \"/json/datas.json\",\n    start: new Date(2016, 0),\n    cellSize: 11,\n    range: 9,\n    previousSelector: \"#example-b-PreviousDomain-selector\",\n    nextSelector: \"#example-b-NextDomain-selector\",\n\n    legend: [1, 3, 5, 7],\n    legendColors: {\n        min: \"#efefef\",\n        max: \"steelblue\",\n        empty: \"#efefef\"\n    },\n    tooltip: true\n});\n</script>\n\n\n\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u306fitemSelector, data\u3067\u3059\u3002\n\u8868\u793a\u3059\u308b\u5834\u6240\u306fitemSelector:\u3067HTML\u8981\u7d20\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002data\u3067\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3067\u3059\u306d\u3002\n\u305d\u306e\u4ed6\u3001\u4f8b\u3048\u3070\u3001legend\u3067\u6700\u5c0f\u3001\u6700\u5927\u306e\u30b3\u30df\u30c3\u30c8\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u6b21\u306b\u3001legendColors\u306f\u30b3\u30df\u30c3\u30c8\u6570\u3068\u95a2\u9023\u3057\u305f\u30ab\u30e9\u30fc\u306e\u8a2d\u5b9a\u3067\u3059\u306d\u3002\nGitLab\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3092JSON\u3067\u53d6\u5f97\u3057\u307e\u3059\u3002\n$ curl -sL gitlab.com/u/$USER/calendar\n\n# jq\n$ export x=`curl -sL gitlab.com/u/$USER/calendar|grep '{\"'`\n$ echo ${x%,}|jq .\n$ echo ${x%,}|jq . >> json/datas.json\n\n# example\n$ curl -sLO http://cal-heatmap.com/datas-years.json\n$ cat !$:t | jq .\n\n# preview\n$ jekyll server\n\n\u4f8b\u3048\u3070\u3001\u3053\u308c\u3092jQuery, Ajax\u3067\u66f8\u3044\u3066\u307f\u307e\u3059\u3002GitLab\u304b\u3089\u60c5\u5831\u3092\u53d6\u308b\u305f\u3081\u306bjquery.xdomainajax.js\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001GitLab\u304c\u63d0\u4f9b\u3059\u308b\u51fa\u529b\u306fHTML\u3067\u3059\u306e\u3067\u3001\u3053\u308c\u3092\u52a0\u5de5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5fc5\u8981\u306aJSON\u306f<script>\u5185\u306b\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u3001xdomainajax.js\u306f<script>\u304c\u7a7a\u306b\u3055\u308c\u308b\u305f\u3081\u3001\u4e00\u90e8\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u3066\u4f7f\u3044\u307e\u3059\u3002\n\njs/jquery.xdomainajax.js\n// https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js#L62\n- .replace(/<script[^>]+?\\/>|<script(.|\\s)*?\\/script>/gi, '')\n+ //.replace(/<script[^>]+?\\/>|<script(.|\\s)*?\\/script>/gi, '')\n\n\n\u3061\u306a\u307f\u306b\u3001\u3053\u306ejs\u30d5\u30a1\u30a4\u30eb\u306f\u624b\u5143\u306b\u304a\u3044\u3066\u8aad\u307f\u8fbc\u3093\u3067\u304f\u3060\u3055\u3044\u3002http\u7d4c\u7531\u3067\u8aad\u307f\u8fbc\u307e\u306a\u3044\u3088\u3046\u306b\u3002\n\nt/foo.html\n<script src=\"http://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"></script>\n<script src=\"../static/js/jquery.xdomainajax.js\"></script> \n<script src=\"../static/bower_components/d3/d3.min.js\" charset=\"utf-8\"></script>\n<script src=\"../static/bower_components/cal-heatmap/cal-heatmap.min.js\"></script>\n<link rel=\"stylesheet\" href=\"../static/bower_components/cal-heatmap/cal-heatmap.css\" />\n<!--<script src=\"https://raw.githubusercontent.com/syui/jquery.fn/master/cross-domain-ajax/jquery.xdomainajax.js\"></script>-->\n<!--diff : https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js#L62 -->\n<h3>Calendar Activities</h3>\n<div id=\"cal-heatmap\"></div>\n<div id=\"example-heatmap\"></div>\n\n<script>\njQuery(function ($) {\n    var json;\n        $.ajax({\n        type: 'GET',\n        url: 'https://gitlab.com/u/syui/calendar',\n        dataType: 'html',\n        async: false,\n        cache: false,\n        success: function(data) {\n        var content = $(data.responseText).find('script').html();\n        var tmp = content.replace(\"<![CDATA[\", \"\").replace(\"]]>\", \"\");\n        var s = tmp.indexOf( \"{\" );\n        var e = tmp.indexOf( \"}\" );\n        json = tmp.substring( s, e+1 );\n        $('#gitlab-calendar-activities').text(json);\n        }\n    });\n    setTimeout( $('#example-heatmap').each(function () {\n    //setTimeout( function() {\n        if( json != null ){\n        var obj = $.parseJSON(json);\n        var now = new Date();\n        new CalHeatMap().init({\n          data: obj,\n          domain: 'month',\n          domainLabelFormat: '%Y-%m',\n          itemSelector: '#example-heatmap',\n          legend: [1, 3, 5, 7],\n          legendColors: {\n            min: \"#efefef\",\n            max: \"steelblue\",\n            empty: \"#efefef\"\n          },\n              tooltip: true,\n          start: new Date(now.getFullYear(), now.getMonth() - 9)\n        });\n        } else {\n            setTimeout( arguments.callee, 100 );\n        }\n    }));\n});\n</script>\n\n<div id=\"gitlab-calendar-activities\" style=\"display:none;\"></div>\n\n\n# \u4e00\u5fdc\u3001Hugo\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u60f3\u5b9a\n$ tree -L 2 -d .\n    - t/foo.html\n    - static/\n        - bower_compotnent/{d3,cal-heatmap}\n        - js/jquery.xdomainajax.js\n$ open t/foo.html\n\n\u3053\u308c\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u3001Console\u304b\u3089\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u306a\u304c\u3089\u4fee\u6b63\u3057\u3066\u3044\u304f\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002console.log(json)\n\u3046\u307e\u304f\u3044\u304f\u3068\u6700\u7d42\u7684\u306b\u53d6\u308c\u308bJSON\u304c#gitlab-calendar-activities\u306b\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u305f\u3060\u3057\u3001display:none\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8868\u793a\u3057\u305f\u3044\u5834\u5408\u306f\u6d88\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5225\u306b\u3053\u308c\u3092\u4f7f\u3063\u3066\u3082\u4f7f\u308f\u306a\u304f\u3066\u3082\u3069\u3063\u3061\u3067\u3082\u826f\u3044\u3067\u3059\u3002\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u5f53\u8a72\u7b87\u6240\u3092\u30b3\u30fc\u30c9\u304b\u3089\u524a\u9664\u3057\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u3053\u3067\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u4f7f\u3063\u3066\u307e\u3059\u306e\u3067\u30ab\u30ec\u30f3\u30c0\u30fc\u3078\u306e\u5f71\u97ff\u306f\u306a\u3044\u3067\u3059\u3002\nJSON\u306f\u3053\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u53d6\u5f97\u3057\u3001\u30ab\u30ec\u30f3\u30c0\u30fc\u306b\u8868\u793a\u3057\u3066\u3082\u3088\u3044\u3067\u3059\u304c\u3001\u30b5\u30a4\u30c8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9(\u9045\u5ef6)\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\u3057\u305f\u304c\u3063\u3066\u3001\u304a\u3059\u3059\u3081\u306fdata: \"/json/datas.json\"\u3068\u3057\u3066\u30011\u65e51\u56de\u30b5\u30a4\u30c8\u4e0a\u306b\u304a\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30b5\u30fc\u30d0\u30fc\u3084\u30dc\u30c3\u30c8\u306a\u3069\u3092\u4f7f\u3063\u3066\u81ea\u52d5\u66f4\u65b0\u3059\u308b\u3053\u3068\u3067\u3059\u304b\u306d\u3002\n\n[cal-heatmap](https://github.com/wa0x6e/cal-heatmap)\u306f\u3001GitLab\u306b\u3082\u4f7f\u308f\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001GitLab\u30e6\u30fc\u30b6\u30fc\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3092JSON\u3067\u53d6\u5f97\u3057\u3001\u30b5\u30a4\u30c8\u306b\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n![](https://raw.githubusercontent.com/mba-hack/images/master/cal-heatmap-sample.png)\n\n```bash:\n$ bower install cal-heatmap\n```\n\n```html:index.html\n<script src=\"/bower_components/d3/d3.min.js\" charset=\"utf-8\"></script>\n<script src=\"/bower_components/cal-heatmap/cal-heatmap.min.js\"></script>\n<link rel=\"stylesheet\" href=\"/bower_components/cal-heatmap/cal-heatmap.css\" />\n\n<h3>GitLab Calendar Activities</h3>\n<div id=\"cal-heatmap\"></div>\n<div id=\"example-heatmap\"></div>\n<script type=\"text/javascript\">\nvar cal = new CalHeatMap();\ncal.init({\n\titemSelector: \"#example-heatmap\",\n\tdomain: \"month\",\n\tdata: \"/json/datas.json\",\n\tstart: new Date(2016, 0),\n\tcellSize: 11,\n\trange: 9,\n\tpreviousSelector: \"#example-b-PreviousDomain-selector\",\n\tnextSelector: \"#example-b-NextDomain-selector\",\n\n\tlegend: [1, 3, 5, 7],\n\tlegendColors: {\n\t\tmin: \"#efefef\",\n\t\tmax: \"steelblue\",\n\t\tempty: \"#efefef\"\n\t},\n\ttooltip: true\n});\n</script>\n```\n\n\n\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u306f`itemSelector, data`\u3067\u3059\u3002\n\n\u8868\u793a\u3059\u308b\u5834\u6240\u306f`itemSelector:`\u3067HTML\u8981\u7d20\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002`data`\u3067\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3067\u3059\u306d\u3002\n\n\u305d\u306e\u4ed6\u3001\u4f8b\u3048\u3070\u3001`legend`\u3067\u6700\u5c0f\u3001\u6700\u5927\u306e\u30b3\u30df\u30c3\u30c8\u6570\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u6b21\u306b\u3001`legendColors`\u306f\u30b3\u30df\u30c3\u30c8\u6570\u3068\u95a2\u9023\u3057\u305f\u30ab\u30e9\u30fc\u306e\u8a2d\u5b9a\u3067\u3059\u306d\u3002\n\nGitLab\u306e\u30ab\u30ec\u30f3\u30c0\u30fc\u60c5\u5831\u3092JSON\u3067\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:\n$ curl -sL gitlab.com/u/$USER/calendar\n\n# jq\n$ export x=`curl -sL gitlab.com/u/$USER/calendar|grep '{\"'`\n$ echo ${x%,}|jq .\n$ echo ${x%,}|jq . >> json/datas.json\n\n# example\n$ curl -sLO http://cal-heatmap.com/datas-years.json\n$ cat !$:t | jq .\n\n# preview\n$ jekyll server\n```\n\n\u4f8b\u3048\u3070\u3001\u3053\u308c\u3092jQuery, Ajax\u3067\u66f8\u3044\u3066\u307f\u307e\u3059\u3002GitLab\u304b\u3089\u60c5\u5831\u3092\u53d6\u308b\u305f\u3081\u306b[jquery.xdomainajax.js](https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js)\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001GitLab\u304c\u63d0\u4f9b\u3059\u308b\u51fa\u529b\u306fHTML\u3067\u3059\u306e\u3067\u3001\u3053\u308c\u3092\u52a0\u5de5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5fc5\u8981\u306aJSON\u306f`<script>`\u5185\u306b\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u3001`xdomainajax.js`\u306f`<script>`\u304c\u7a7a\u306b\u3055\u308c\u308b\u305f\u3081\u3001\u4e00\u90e8\u30b3\u30fc\u30c9\u3092[\u66f8\u304d\u63db\u3048\u3066](https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js#L62)\u4f7f\u3044\u307e\u3059\u3002\n\n```js:js/jquery.xdomainajax.js\n// https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js#L62\n- .replace(/<script[^>]+?\\/>|<script(.|\\s)*?\\/script>/gi, '')\n+ //.replace(/<script[^>]+?\\/>|<script(.|\\s)*?\\/script>/gi, '')\n```\n\n\u3061\u306a\u307f\u306b\u3001\u3053\u306ejs\u30d5\u30a1\u30a4\u30eb\u306f\u624b\u5143\u306b\u304a\u3044\u3066\u8aad\u307f\u8fbc\u3093\u3067\u304f\u3060\u3055\u3044\u3002http\u7d4c\u7531\u3067\u8aad\u307f\u8fbc\u307e\u306a\u3044\u3088\u3046\u306b\u3002\n\n```html:t/foo.html\n<script src=\"http://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js\"></script>\n<script src=\"../static/js/jquery.xdomainajax.js\"></script> \n<script src=\"../static/bower_components/d3/d3.min.js\" charset=\"utf-8\"></script>\n<script src=\"../static/bower_components/cal-heatmap/cal-heatmap.min.js\"></script>\n<link rel=\"stylesheet\" href=\"../static/bower_components/cal-heatmap/cal-heatmap.css\" />\n<!--<script src=\"https://raw.githubusercontent.com/syui/jquery.fn/master/cross-domain-ajax/jquery.xdomainajax.js\"></script>-->\n<!--diff : https://github.com/padolsey-archive/jquery.fn/blob/master/cross-domain-ajax/jquery.xdomainajax.js#L62 -->\n<h3>Calendar Activities</h3>\n<div id=\"cal-heatmap\"></div>\n<div id=\"example-heatmap\"></div>\n\n<script>\njQuery(function ($) {\n\tvar json;\n    \t$.ajax({\n        type: 'GET',\n        url: 'https://gitlab.com/u/syui/calendar',\n        dataType: 'html',\n    \tasync: false,\n    \tcache: false,\n    \tsuccess: function(data) {\n\t\tvar content = $(data.responseText).find('script').html();\n\t\tvar tmp = content.replace(\"<![CDATA[\", \"\").replace(\"]]>\", \"\");\n\t\tvar s = tmp.indexOf( \"{\" );\n\t\tvar e = tmp.indexOf( \"}\" );\n\t\tjson = tmp.substring( s, e+1 );\n\t\t$('#gitlab-calendar-activities').text(json);\n    \t}\n\t});\n\tsetTimeout( $('#example-heatmap').each(function () {\n\t//setTimeout( function() {\n\t    if( json != null ){\n\t\tvar obj = $.parseJSON(json);\n  \t\tvar now = new Date();\n  \t\tnew CalHeatMap().init({\n  \t\t  data: obj,\n  \t\t  domain: 'month',\n  \t\t  domainLabelFormat: '%Y-%m',\n  \t\t  itemSelector: '#example-heatmap',\n  \t\t  legend: [1, 3, 5, 7],\n  \t\t  legendColors: {\n  \t\t  \tmin: \"#efefef\",\n  \t\t  \tmax: \"steelblue\",\n  \t\t  \tempty: \"#efefef\"\n  \t\t  },\n        \t  tooltip: true,\n  \t\t  start: new Date(now.getFullYear(), now.getMonth() - 9)\n  \t\t});\n\t    } else {\n\t        setTimeout( arguments.callee, 100 );\n\t    }\n\t}));\n});\n</script>\n\n<div id=\"gitlab-calendar-activities\" style=\"display:none;\"></div>\n```\n\n```bash:\n# \u4e00\u5fdc\u3001Hugo\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u9020\u3092\u60f3\u5b9a\n$ tree -L 2 -d .\n\t- t/foo.html\n\t- static/\n\t\t- bower_compotnent/{d3,cal-heatmap}\n\t\t- js/jquery.xdomainajax.js\n$ open t/foo.html\n```\n\n\u3053\u308c\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304d\u3001Console\u304b\u3089\u30ed\u30b0\u3092\u78ba\u8a8d\u3057\u306a\u304c\u3089\u4fee\u6b63\u3057\u3066\u3044\u304f\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002`console.log(json)`\n\n\u3046\u307e\u304f\u3044\u304f\u3068\u6700\u7d42\u7684\u306b\u53d6\u308c\u308bJSON\u304c`#gitlab-calendar-activities`\u306b\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\u305f\u3060\u3057\u3001`display:none`\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u8868\u793a\u3057\u305f\u3044\u5834\u5408\u306f\u6d88\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u5225\u306b\u3053\u308c\u3092\u4f7f\u3063\u3066\u3082\u4f7f\u308f\u306a\u304f\u3066\u3082\u3069\u3063\u3061\u3067\u3082\u826f\u3044\u3067\u3059\u3002\u4f7f\u308f\u306a\u3044\u5834\u5408\u306f\u5f53\u8a72\u7b87\u6240\u3092\u30b3\u30fc\u30c9\u304b\u3089\u524a\u9664\u3057\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u3053\u3067\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3092\u4f7f\u3063\u3066\u307e\u3059\u306e\u3067\u30ab\u30ec\u30f3\u30c0\u30fc\u3078\u306e\u5f71\u97ff\u306f\u306a\u3044\u3067\u3059\u3002\n\nJSON\u306f\u3053\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u53d6\u5f97\u3057\u3001\u30ab\u30ec\u30f3\u30c0\u30fc\u306b\u8868\u793a\u3057\u3066\u3082\u3088\u3044\u3067\u3059\u304c\u3001\u30b5\u30a4\u30c8\u306e\u30ec\u30b9\u30dd\u30f3\u30b9(\u9045\u5ef6)\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3057\u305f\u304c\u3063\u3066\u3001\u304a\u3059\u3059\u3081\u306f`data: \"/json/datas.json\"`\u3068\u3057\u3066\u30011\u65e51\u56de\u30b5\u30a4\u30c8\u4e0a\u306b\u304a\u3044\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30b5\u30fc\u30d0\u30fc\u3084\u30dc\u30c3\u30c8\u306a\u3069\u3092\u4f7f\u3063\u3066\u81ea\u52d5\u66f4\u65b0\u3059\u308b\u3053\u3068\u3067\u3059\u304b\u306d\u3002\n"}