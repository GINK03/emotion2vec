{"context": " More than 1 year has passed since last update.\u3069\u3046\u3082SecurityVoter\u306e\u8a71\u3067\u3059\u3002\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u307f\u305f\u3044\u306a\u5206\u304b\u308a\u304d\u3063\u305f\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u304f\u306e\u304c\u597d\u304d\u3067\u306a\u3044\u306e\u3067\u524d\u304b\u3089\u597d\u3093\u3067\u4f7f\u3063\u3066\u308b\u306e\u3067\u3059\u304c\u3001\u3042\u307e\u308a\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044(\u79c1\u306e\u5468\u308a\u3060\u3051\u304b\u3082)\u69d8\u5b50\u306a\u306e\u3067\u5e03\u6559\u304c\u3066\u3089\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\nSecurityVoter\u3068\u306f\n\u3042\u308b\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u3001\u5c5e\u6027\u306e\u6a29\u9650\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\nACL\u306f\u30ea\u30c3\u30c1\u3059\u304e\u307e\u3059\u308f\u30fc\u7684\u306a\u5834\u5408\u306f\u30de\u30c3\u30c1\u3059\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u3067\u3082\u3042\u308b\u3068\u4fbf\u5229\u3067\u3059\u3088\u3002\n\n\u3055\u3063\u305d\u304f\u4f5c\u3063\u3066\u307f\u308b\n\u30d6\u30ed\u30b0\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u3088\u304f\u3042\u308b\u6295\u7a3f\u3068\u305d\u306e\u8457\u8005\u304c\u3042\u308b\u30d1\u30bf\u30fc\u30f3\n\n\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\n\nuse Symfony\\Component\\Security\\Core\\User\\UserInterface;\n\nclass Post\n{\n    /**\n     * @User\n     */\n    private $author;\n\n    /**\n     * @return User\n     */\n    public function getAuthor()\n    {\n        return $this->author;\n    }\n}\n\nclass User implements UserInterface\n{\n}\n\n\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u3092\u66f8\u304d\u307e\u3059\u3002\n\nPostSecurityVoter\nuse Symfony\\Component\\Security\\Core\\Authorization\\Voter\\VoterInterface;\n\nclass PostSecurityVoter implements VoterInterface\n{\n    // \u30b5\u30dd\u30fc\u30c8\u3059\u308b\u5c5e\u6027\n    public function supportsAttribute($attribute)\n    {\n        return in_array($attribute, ['READ', 'UPDATE'], true);\n    }\n\n    // \u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30af\u30e9\u30b9\n    public function supportsClass($class)\n    {\n        return 'User' === $class;\n    }\n\n    // \u6a29\u9650\u30c1\u30a7\u30c3\u30af\n    public function vote(TokenInterface $token, $object, array $attributes)\n    {\n        if (!$this->supportsClass(get_class($object)) {\n            return VoterInterface::ACCESS_ABSTAIN;\n        }\n\n        $user = $token->getUser();\n\n        $result = VoterInterface::ACCESS_ABSTAIN;\n        foreach ($attributes as $attribute) {\n            if (!$this->supportsAttribute($attribute)) {\n                continue;\n            }\n\n            $result = VoterInterface::ACCESS_DENIED;\n            if ('READ' === $attribute) {\n                // \u8ab0\u3067\u3082\u89b3\u308c\u308b\n                return VoterInterface::ACCESS_GRANTED;\n            }\n\n            if ('UPDATE' === $attribute && $user === $object->getAuthor()) {\n                // \u4f5c\u8005\u3060\u3051\u7de8\u96c6\u3067\u304d\u308b\n                return VoterInterface::ACCESS_GRANTED;\n            }\n        }\n\n        return $result;\n    }\n}\n\n\n\u6ce8\u610f\u70b9\u306fVoterInterface::supportsAttribute() \u3068 VoterInterface::supportsClass() \u304c \u3044\u3044\u611f\u3058\u306b\u5916\u90e8\u304b\u3089\u30b3\u30fc\u30eb\u3055\u308c\u3001\u30d5\u30a3\u30eb\u30bf\u3055\u308c\u305d\u3046\u306a\u96f0\u56f2\u6c17\u3092\u91b8\u3057\u3064\u3064\u3082\u305d\u3046\u3067\u306f\u306a\u3044\u70b9 \u3067\u3059\u3002\n\u3053\u3046\u306a\u3063\u3066\u3044\u308b\u610f\u56f3\u306f\u77e5\u308a\u307e\u305b\u3093\u304c VoterInterface::vote() \u306e\u4e2d\u3067\u81ea\u3089\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u5c5e\u6027/\u30af\u30e9\u30b9\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nsymfony 2.6\u4ee5\u964d\u306fAbstractVoter\u304c\u767b\u5834\u3057\u305f\u306e\u3067\u3001\u81ea\u3089\u30c1\u30a7\u30c3\u30af\u3059\u308b\u5fc5\u8981\u306f\u7121\u304f\u306a\u308a\u307e\u3057\u305f\u3002\nhttp://symfony.com/blog/new-in-symfony-2-6-simpler-security-voters\n\n\u3061\u3087\u3063\u3068\u9577\u3044\u3067\u3059\u304c\u5b9f\u88c5\u5185\u5bb9\u306f\u7c21\u5358\u3067\u3001\u5c5e\u6027\u306b\u5bfe\u3059\u308b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u7d50\u679c\uff08DENIED/GRANTED\uff09\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\n\u95a2\u4fc2\u306a\u3044\u5834\u5408\u306fABSTAIN\u3092\u8fd4\u3057\u3001\u4ed6\u306eSecurityVoter\u306b\u59d4\u306d\u307e\u3059\u3002\n\n\u88dc\u8db3\uff1a\u30af\u30e9\u30b9\u3084\u5c5e\u6027\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u306f\u7279\u306b\u306a\u304f\u3001\u4f8b\u3048\u3070IP\u306b\u3088\u308b\u30a2\u30af\u30bb\u30b9\u5236\u9650(\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8)\u7b49\u3082\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n\n\u4f7f\u3063\u3066\u307f\u308b\nSecurityVoter\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u4f55\u306e\u5f79\u306b\u3082\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u6709\u308a\u307e\u3059\nacme_demo.security_voter.post:\n  class: PostSeurityVoter\n  public: false\n  tags:\n    - { name: security.voter }\n\n\u3055\u3063\u305d\u304f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306e\u5909\u8c8c\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046...\n\nPostController_\u30d3\u30d5\u30a9\u30fc\n\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\ParamConverter;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Route;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\View;\n\nclass PostController\n{\n    /**\n     * @Route(\"/post/{id}/edit\")\n     * @ParamConverter(\"post\")\n     * @View()\n     */\n    public fucntion editAction(Post $post)\n    {\n        if ($post->getAuthor() === $this->getUser()) {\n            throw $this->createNotFoundException();\n        }\n\n        return $post;\n    }\n}\n\n\n\nPostController_\u30a2\u30d5\u30bf\u30fc\n\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\ParamConverter;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Security;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Route;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\View;\n\nclass PostController\n{\n    /**\n     * @Route(\"/post/{id}/edit\")\n     * @ParamConverter(\"post\")\n     * @Security(\"is_granted('UPDATE', post)\")\n     * @View()\n     */\n    public fucntion editAction(Post $post)\n    {\n        return $post;\n    }\n}\n\n\n\u5272\u3068\u5143\u304b\u3089\u30b9\u30c3\u30ad\u30ea\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u66f4\u306b\u30b9\u30c3\u30ad\u30ea\u3057\u307e\u3057\u305f\uff01\nSecurityVoter\u306b\u3088\u308b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\u306f\u3001SecurityContext\u7b49\u304b\u3089\u884c\u3048\u308b\u306e\u3067\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u4ee5\u5916\u306b\u3082twig\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067\u3082\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u304a\u307e\u3051\u3064\u304d\u3067\u3059\u3002\n\u7de8\u96c6/\u524a\u9664 \u30dc\u30bf\u30f3\u306e\u8868\u793a\u3068\u304b\u4f55\u6c17\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n\u3069\u3046\u3082SecurityVoter\u306e\u8a71\u3067\u3059\u3002\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u307f\u305f\u3044\u306a\u5206\u304b\u308a\u304d\u3063\u305f\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u304f\u306e\u304c\u597d\u304d\u3067\u306a\u3044\u306e\u3067\u524d\u304b\u3089\u597d\u3093\u3067\u4f7f\u3063\u3066\u308b\u306e\u3067\u3059\u304c\u3001\u3042\u307e\u308a\u4f7f\u308f\u308c\u3066\u3044\u306a\u3044(\u79c1\u306e\u5468\u308a\u3060\u3051\u304b\u3082)\u69d8\u5b50\u306a\u306e\u3067\u5e03\u6559\u304c\u3066\u3089\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\n## SecurityVoter\u3068\u306f\n\n\u3042\u308b\u30c7\u30fc\u30bf\u306b\u5bfe\u3057\u3066\u3001\u5c5e\u6027\u306e\u6a29\u9650\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\n\nACL\u306f\u30ea\u30c3\u30c1\u3059\u304e\u307e\u3059\u308f\u30fc\u7684\u306a\u5834\u5408\u306f\u30de\u30c3\u30c1\u3059\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3046\u3067\u306a\u3044\u5834\u5408\u3067\u3082\u3042\u308b\u3068\u4fbf\u5229\u3067\u3059\u3088\u3002\n\n## \u3055\u3063\u305d\u304f\u4f5c\u3063\u3066\u307f\u308b\n\n\u30d6\u30ed\u30b0\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067\u3088\u304f\u3042\u308b`\u6295\u7a3f`\u3068\u305d\u306e`\u8457\u8005`\u304c\u3042\u308b\u30d1\u30bf\u30fc\u30f3\n\n```php:\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\n\nuse Symfony\\Component\\Security\\Core\\User\\UserInterface;\n\nclass Post\n{\n    /**\n     * @User\n     */\n    private $author;\n\n    /**\n     * @return User\n     */\n    public function getAuthor()\n    {\n        return $this->author;\n    }\n}\n\nclass User implements UserInterface\n{\n}\n```\n\n\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u3092\u66f8\u304d\u307e\u3059\u3002\n\n\n```php:PostSecurityVoter\nuse Symfony\\Component\\Security\\Core\\Authorization\\Voter\\VoterInterface;\n\nclass PostSecurityVoter implements VoterInterface\n{\n    // \u30b5\u30dd\u30fc\u30c8\u3059\u308b\u5c5e\u6027\n    public function supportsAttribute($attribute)\n    {\n        return in_array($attribute, ['READ', 'UPDATE'], true);\n    }\n\n    // \u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30af\u30e9\u30b9\n    public function supportsClass($class)\n    {\n        return 'User' === $class;\n    }\n\n    // \u6a29\u9650\u30c1\u30a7\u30c3\u30af\n    public function vote(TokenInterface $token, $object, array $attributes)\n    {\n        if (!$this->supportsClass(get_class($object)) {\n            return VoterInterface::ACCESS_ABSTAIN;\n        }\n\n        $user = $token->getUser();\n\n        $result = VoterInterface::ACCESS_ABSTAIN;\n        foreach ($attributes as $attribute) {\n            if (!$this->supportsAttribute($attribute)) {\n                continue;\n            }\n\n            $result = VoterInterface::ACCESS_DENIED;\n            if ('READ' === $attribute) {\n                // \u8ab0\u3067\u3082\u89b3\u308c\u308b\n                return VoterInterface::ACCESS_GRANTED;\n            }\n\n            if ('UPDATE' === $attribute && $user === $object->getAuthor()) {\n                // \u4f5c\u8005\u3060\u3051\u7de8\u96c6\u3067\u304d\u308b\n                return VoterInterface::ACCESS_GRANTED;\n            }\n        }\n\n        return $result;\n    }\n}\n```\n\n\u6ce8\u610f\u70b9\u306f`VoterInterface::supportsAttribute()` \u3068 `VoterInterface::supportsClass()` \u304c __\u3044\u3044\u611f\u3058\u306b\u5916\u90e8\u304b\u3089\u30b3\u30fc\u30eb\u3055\u308c\u3001\u30d5\u30a3\u30eb\u30bf\u3055\u308c\u305d\u3046\u306a\u96f0\u56f2\u6c17\u3092\u91b8\u3057\u3064\u3064\u3082\u305d\u3046\u3067\u306f\u306a\u3044\u70b9__ \u3067\u3059\u3002\n\u3053\u3046\u306a\u3063\u3066\u3044\u308b\u610f\u56f3\u306f\u77e5\u308a\u307e\u305b\u3093\u304c `VoterInterface::vote()` \u306e\u4e2d\u3067\u81ea\u3089\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u5c5e\u6027/\u30af\u30e9\u30b9\u306e\u30c1\u30a7\u30c3\u30af\u3092\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n> symfony 2.6\u4ee5\u964d\u306fAbstractVoter\u304c\u767b\u5834\u3057\u305f\u306e\u3067\u3001\u81ea\u3089\u30c1\u30a7\u30c3\u30af\u3059\u308b\u5fc5\u8981\u306f\u7121\u304f\u306a\u308a\u307e\u3057\u305f\u3002\n> http://symfony.com/blog/new-in-symfony-2-6-simpler-security-voters\n\n\u3061\u3087\u3063\u3068\u9577\u3044\u3067\u3059\u304c\u5b9f\u88c5\u5185\u5bb9\u306f\u7c21\u5358\u3067\u3001\u5c5e\u6027\u306b\u5bfe\u3059\u308b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u30c1\u30a7\u30c3\u30af\u7d50\u679c\uff08`DENIED`/`GRANTED`\uff09\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\n\u95a2\u4fc2\u306a\u3044\u5834\u5408\u306f`ABSTAIN`\u3092\u8fd4\u3057\u3001\u4ed6\u306eSecurityVoter\u306b\u59d4\u306d\u307e\u3059\u3002\n\n> \u88dc\u8db3\uff1a\u30af\u30e9\u30b9\u3084\u5c5e\u6027\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u306f\u7279\u306b\u306a\u304f\u3001\u4f8b\u3048\u3070[IP\u306b\u3088\u308b\u30a2\u30af\u30bb\u30b9\u5236\u9650(\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8)](http://symfony.com/doc/current/cookbook/security/voters.html)\u7b49\u3082\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n### \u4f7f\u3063\u3066\u307f\u308b\n\nSecurityVoter\u306f\u305d\u306e\u307e\u307e\u3067\u306f\u4f55\u306e\u5f79\u306b\u3082\u7acb\u305f\u306a\u3044\u306e\u3067\u3001\u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u6709\u308a\u307e\u3059\n\n```yml:\nacme_demo.security_voter.post:\n  class: PostSeurityVoter\n  public: false\n  tags:\n    - { name: security.voter }\n```\n\n\u3055\u3063\u305d\u304f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306e\u5909\u8c8c\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046...\n\n```php:PostController_\u30d3\u30d5\u30a9\u30fc\n\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\ParamConverter;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Route;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\View;\n\nclass PostController\n{\n    /**\n     * @Route(\"/post/{id}/edit\")\n     * @ParamConverter(\"post\")\n     * @View()\n     */\n    public fucntion editAction(Post $post)\n    {\n        if ($post->getAuthor() === $this->getUser()) {\n            throw $this->createNotFoundException();\n        }\n\n        return $post;\n    }\n}\n```\n\n```php:PostController_\u30a2\u30d5\u30bf\u30fc\n\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\ParamConverter;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Security;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\Route;\nuse Sensio\\Bundle\\FrameworkExtraBundle\\Configuration\\View;\n\nclass PostController\n{\n    /**\n     * @Route(\"/post/{id}/edit\")\n     * @ParamConverter(\"post\")\n     * @Security(\"is_granted('UPDATE', post)\")\n     * @View()\n     */\n    public fucntion editAction(Post $post)\n    {\n        return $post;\n    }\n}\n```\n\n\u5272\u3068\u5143\u304b\u3089\u30b9\u30c3\u30ad\u30ea\u3057\u3066\u307e\u3057\u305f\u304c\u3001\u66f4\u306b\u30b9\u30c3\u30ad\u30ea\u3057\u307e\u3057\u305f\uff01\n\n`SecurityVoter`\u306b\u3088\u308b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u30c1\u30a7\u30c3\u30af\u306f\u3001`SecurityContext`\u7b49\u304b\u3089\u884c\u3048\u308b\u306e\u3067\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u4ee5\u5916\u306b\u3082[twig\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5185\u3067\u3082\u6a29\u9650\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b](http://symfony.com/doc/current/book/security.html#access-control-in-templates)\u3088\u3046\u306b\u306a\u308b\u304a\u307e\u3051\u3064\u304d\u3067\u3059\u3002\n\u7de8\u96c6/\u524a\u9664 \u30dc\u30bf\u30f3\u306e\u8868\u793a\u3068\u304b\u4f55\u6c17\u306b\u4fbf\u5229\u3067\u3059\u3002\n", "tags": ["Symfony2"]}