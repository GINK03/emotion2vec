{"context": " More than 1 year has passed since last update.\n\nDelaunay\u4e09\u89d2\u5206\u5272\u6cd5\u3068\u306f\uff1f\nDelaunay\u4e09\u89d2\u5206\u5272\u6cd5\u3068\u306f\u3001\u4efb\u610f\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u7bc0\u70b9\u7fa4\u3092\u5bfe\u8c61\u306b\u3001\u5bfe\u8c61\u9818\u57df\u3092\u4e09\u89d2\u5f62\u306b\u5206\u5272\u3059\u308b\u65b9\u6cd5\u306e\u4e00\u3064\u3067\u3059\u3002\n\u5168\u3066\u306e\u4e09\u89d2\u8981\u7d20\u306b\u3064\u3044\u3066\u3001\u305d\u306e\u5916\u63a5\u5186\u5185\u306b\u4ed6\u306e\u4e09\u89d2\u8981\u7d20\u306e\u7bc0\u70b9\u3092\u542b\u307e\u306a\u3044\u3068\u3044\u3046\u5e7e\u4f55\u5b66\u7684\u7279\u5fb4\u3092\u6709\u3059\u308b\u305f\u3081\u3001\u6709\u9650\u8981\u7d20\u6cd5\u7b49\u306e\u8981\u7d20\u5206\u5272\u306b\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4e09\u89d2\u8981\u7d20\u7fa4\u306f\u3001\u6570\u5024\u89e3\u6790\u3084\u5730\u5f62\u56f3CG\u3001\u30b3\u30f3\u30bf\u30fc\u56f3\u751f\u6210\u306b\u5229\u7528\u3067\u304d\u308b\u306a\u3069\u3001\u975e\u5e38\u306b\u4fbf\u5229\u306a\u306e\u3067\u3001\u6614\u3001Java\u3067\u5b9f\u88c5\u3057\u3066\u3044\u305f\u3082\u306e\u3092\u3001JavaScript\u306b\u79fb\u690d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u5b9f\u884c\u30b5\u30f3\u30d7\u30eb\u3001\u53c2\u8003\u6587\u732e\u7b49\u306f\u3001\u306f\u3066\u306a\u30d6\u30ed\u30b0\u3067\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\n\u30ed\u30fc\u30bd\u30f3\u6cd5\u3068\u547c\u3070\u308c\u308b\u65b9\u6cd5\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n1.\u7bc0\u70b9\u3092\u542b\u3080\u8981\u7d20\u3092\u63a2\u67fb\u3059\u308b\uff08\u56f31\uff5e4\uff09\u3002\n2.\u63a2\u67fb\u3057\u305f\u8981\u7d20\u3092\uff13\u5206\u5272\u3059\u308b\uff08\u56f35\uff09\u3002\n3.\u5206\u5272\u3055\u308c\u305f\u5404\u8981\u7d20\u306b\u3064\u3044\u3066\u3001\u5916\u63a5\u5186\u5185\u306b\u4ed6\u306e\u8981\u7d20\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u3001\u305d\u306e\u8981\u7d20\u306e\u8fba\u3092\u4ed8\u3051\u66ff\u3048\u308b\uff08\u56f36,7\uff09\n4.\u5206\u5272\u30fb\u8fba\u4ed8\u3051\u66ff\u3048\u3092\u884c\u3063\u305f\u8981\u7d20\u5168\u3066\u306b\u3064\u3044\u3066\u4e0a\u8a18\u306e\u51e6\u7406\u3092\u884c\u3046\u3002\n5.\u4e0a\u8a18\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u5206\u5272\u51e6\u7406\u5b8c\u4e86\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\u2192\u3053\u3061\u3089\u3067\u3082\u914d\u5e03\u3057\u3066\u307e\u3059\u3002\n\u306a\u304a\u30012010\u5e74\u9803\u306bActionScript\u7248\u3092Wonderfl\u306b\u6295\u7a3f\u3057\u3066\u3044\u307e\u3059\u3002\u2192\u3053\u3061\u3089(\u3082\u3046\u52d5\u304b\u306a\u3044\u304b\u3082\uff09\n\ntermat.delaunay.0.1.js\n/*  JavaScript Delaunay triangulation Class  , version 0.1\n *\n *  Copyright (c) 2015 t.matsuoka\n *  Released under the MIT license\n *  https://github.com/YukinobuKurata/YouTubeMagicBuyButton/blob/master/MIT-LICENSE.txt\n *\n *  web site: http://termat.hatenablog.com/\n *\n/*--------------------------------------------------------------------------*/\nvar termat=termat||{};\n\ntermat.Delaunay=function(minX,minY,width,height){\n\n    var Delaunay2D=function(minX,minY,width,height){\n    this.EPS=1e-16;\n    this.minX=minX;\n    this.minY=minY;\n    this.width=width;\n    this.height=height;\n    this.data=[];\n    this.node=[];\n    this.elem=[];\n    this.map=[];\n    this.stack=[];\n    this.boundary=[];\n    this.boundaryID=[];\n    this.node.push({x:-1.23,y:-0.5,z:0});\n    this.node.push({x:2.23,y:-0.5,z:0});\n    this.node.push({x:0.5,y:2.5,z:0});\n    this.elem.push(new Array(0,1,2));\n    this.map.push(new Array(-1,-1,-1));\n    this.ids=0;\n    this.bs=1;\n    };\n\n    Delaunay2D.prototype.clear=function(){\n    this.data=[];\n    this.node=[];\n    this.elem=[];\n    this.map=[];\n    this.stack=[];\n    this.boundary=[];\n    this.boundaryID=[];\n    this.node.push({x:-1.23,y:-0.5,z:0});\n    this.node.push({x:2.23,y:-0.5,z:0});\n    this.node.push({x:0.5,y:2.5,z:0});\n    this.elem.push(new Array(0,1,2));\n    this.map.push(new Array(-1,-1,-1));\n    this.ids=0;\n    this.bs=1;\n    };\n\n    Delaunay2D.prototype.getTriangleById=function(){\n    var et=[];\n    var id=0;\n    for(var i=0;i<this.elem.length;i++){\n        if(!this.checkBounds(i)){\n            et.push(-1);\n        }else if(!this.checkBoundaryState(i)){\n            et.push(-1);\n        }else{\n            et.push(id++);\n        }\n    }\n    var ee=[];\n    for(var i=0;i<et.length;i++){\n        var e=this.elem[i];\n        if(et[i]!==-1){\n            ee.push(new Array(e[0]-3,e[1]-3,e[2]-3));\n        }\n    }\n    return ee;\n    };\n\n    Delaunay2D.prototype.getTriangleMapById=function(){\n    var et=[];\n    var id=0;\n    for(var i=0;i<this.elem.length;i++){\n        if(!this.checkBounds(i)){\n            et.push(-1);\n        }else if(!this.checkBoundaryState(i)){\n            et.push(-1);\n        }else{\n            et.push(id++);\n        }\n    }\n    var ee=[];\n    var tp=[];\n    for(var i=0;i<et.length;i++){\n        var e=this.map[i];\n        if(et[i]!==-1){\n            for(var j=0;j<e.length;j++){\n                if(e[j]===-1){\n                    tp[j]=-1;\n                }else{\n                    tp[j]=et[e[j]];\n                }\n            }\n            ee.push(new Array(tp[0],tp[1],tp[2]));\n        }\n    }\n    return ee;\n    };\n\n    Delaunay2D.prototype.getTriangle=function(){\n    var et=[];\n    var id=0;\n    for(var i=0;i<this.elem.length;i++){\n        if(!this.checkBounds(i)){\n            et.push(-1);\n        }else if(!this.checkBoundaryState(i)){\n            et.push(-1);\n        }else{\n            et.push(id++);\n        }\n    }\n    var ee=[];\n    for(var i=0;i<et.length;i++){\n        var e=this.elem[i];\n        if(et[i]!==-1){\n            var p0=this.data[e[0]-3];\n            var p1=this.data[e[1]-3];\n            var p2=this.data[e[2]-3];\n            ee.push(new Array(p0,p1,p2));\n        }\n    }\n    return ee;\n    };\n\n    Delaunay2D.prototype.isLeft=function(a,b,p){\n    var v0=(a.y-p.y)*(b.x-p.x);\n    var v1=(a.x-p.x)*(b.y-p.y);\n    if(Math.abs(v1-v0)<this.EPS){\n        return 0;\n    }else{\n        return (v1-v0);\n    }\n    };\n\n    Delaunay2D.prototype.getLocation=function(id,p){\n    var e=this.elem[id];\n    for(var i=0;i<e.length;i++){\n        var a=this.node[e[i]];\n        var b=this.node[e[(i+1)%3]];\n        if(this.isLeft(a,b,p)<0){\n            var n=this.map[id][i];\n            if(n===-1){\n                return -1;\n            }\n            return this.getLocation(n,p);\n        }\n    }\n    return id;\n    };\n\n    Delaunay2D.prototype.checkBoundaryState=function(id){\n    if(this.bs>1){\n        if(!this.checkBounds(id))return false;\n    }\n    var e=this.elem[id];\n    for(var i=0;i<e.length;i++){\n        var b0=this.boundaryID[e[i]];\n        var b1=this.boundaryID[e[(i+1)%3]];\n        if(b0-b1===0){\n            var v0=this.boundary[e[(i+1)%3]];\n            if(v0===e[i]){\n                return false;\n            }\n        }\n    }\n    return true;\n    };\n\n    Delaunay2D.prototype.isBoundary=function(nodeId0,nodeId1){\n    var p=this.boundary[nodeId0];\n    if(p===nodeId1)return true;\n    var p=this.boundary[nodeId1];\n    if(p===nodeId0){\n        return true;\n    }else{\n        return false;\n    }\n    };\n\n    Delaunay2D.prototype.edge=function(elemId,targetId,mp){\n    var j=mp[elemId];\n    for(var i=0;i<j.length;i++){\n        if(j[i]===targetId)return i;\n    }\n    return -1;\n    };\n\n    Delaunay2D.prototype.isSwap=function(aId,bId,cId,pId){\n    var x13=this.node[aId].x-this.node[cId].x;\n    var y13=this.node[aId].y-this.node[cId].y;\n    var x23=this.node[bId].x-this.node[cId].x;\n    var y23=this.node[bId].y-this.node[cId].y;\n    var x1p=this.node[aId].x-this.node[pId].x;\n    var y1p=this.node[aId].y-this.node[pId].y;\n    var x2p=this.node[bId].x-this.node[pId].x;\n    var y2p=this.node[bId].y-this.node[pId].y;\n    var cosa=x13*x23+y13*y23;\n    var cosb=x2p*x1p+y1p*y2p;\n    if(cosa>=0&&cosb>=0){\n        return false;\n    }else if(cosa<0&&cosb<0){\n        return true;\n    }else{\n        var sina=x13*y23-x23*y13;\n        var sinb=x2p*y1p-x1p*y2p;\n        if((sina*cosb+sinb*cosa)<0){\n            return true;\n        }else{\n            return false;\n        }\n    }\n    };\n\n    Delaunay2D.prototype.normalize=function(x,y,z){\n    var xx=(x-this.minX)/this.width;\n    var yy=(y-this.minY)/this.height;\n    return {x:xx,y:yy,z:z};\n    };\n\n    Delaunay2D.prototype.checkBounds=function(id){\n    var e=this.elem[id];\n    if(e[0]<3||e[1]<3||e[2]<3){\n        return false;\n    }else{\n        return true;\n    }\n    };\n\n    Delaunay2D.prototype.insert=function(pos){\n    var p=this.normalize(pos.x,pos.y,pos.z);\n    this.ids=this.getLocation(this.ids,p);\n    if(this.ids===-1){\n        this.ids=0;\n        return false;\n    }else{\n        if(this.checkBoundaryState(this.ids)){\n            this.data.push(pos);\n            this.node.push(p);\n            this.process(this.ids,this.node.length-1);\n            return true;\n        }else{\n            return false;\n        }\n    }\n    };\n\n    Delaunay2D.prototype.addBoundary=function(arg,isClose){\n    var sz=this.node.length;\n    for(var i=0;i<arg.length;i++){\n        var p=this.normalize(arg[i].x,arg[i].y);\n        this.ids=this.getLocation(this.ids,p);\n        if(this.ids===-1){\n            this.ids=0;\n            continue;\n        }\n        if(this.checkBoundaryState(this.ids)){\n            this.data.push(arg[i]);\n            this.node.push(p);\n            if(i>0){\n                this.boundary[sz+i-1]=sz+i;\n                this.boundaryID[sz+i-1]=this.bs;\n            }\n            this.process(this.ids,this.node.length-1);\n        }\n    }\n    if(isClose){\n        this.boundary[this.node.length-1]=sz;\n        this.boundaryID[this.node.length-1]=this.bs;\n    }\n    this.bs++;\n    };\n\n    Delaunay2D.prototype.process=function(elemId,nodeId){\n    var nn=this.elem.length;\n    var em=this.elem[elemId];\n    var te=new Array(em[0],em[1],em[2]);\n    var e0=new Array(nodeId,em[0],em[1]);\n    var e1=new Array(nodeId,em[1],em[2]);\n    var e2=new Array(nodeId,em[2],em[0]);\n    em[0]=e0[0];em[1]=e0[1];em[2]=e0[2];\n    this.elem.push(e1);\n    this.elem.push(e2);\n    var jm=this.map[elemId];\n    var tmp=new Array(jm[0],jm[1],jm[2]);\n    var j0=new Array(nn+1,jm[0],nn);\n    var j1=new Array(elemId,jm[1],nn+1);\n    var j2=new Array(nn,jm[2],elemId);\n    jm[0]=j0[0];jm[1]=j0[1];jm[2]=j0[2];\n    this.map.push(j1);\n    this.map.push(j2);\n    if(tmp[0]!==-1){\n        if(!this.isBoundary(te[0],te[1]))this.stack.push(elemId);\n    }\n    if(tmp[1]!==-1){\n        var ix=this.edge(tmp[1],elemId,this.map);\n        this.map[tmp[1]][ix]=nn;\n        if(!this.isBoundary(te[1],te[2]))this.stack.push(nn);\n    }\n    if(tmp[2]!==-1){\n        var ix=this.edge(tmp[2],elemId,this.map);\n        this.map[tmp[2]][ix]=nn+1;\n        if(!this.isBoundary(te[2],te[0]))this.stack.push(nn+1);\n    }\n    while(this.stack.length>0){\n        var il=this.stack.pop();\n        var ir=this.map[il][1];\n        var ierl=this.edge(ir,il,this.map);\n        var iera=(ierl+1)%3;\n        var ierb=(iera+1)%3;\n        var iv1=this.elem[ir][ierl];\n        var iv2=this.elem[ir][iera];\n        var iv3=this.elem[ir][ierb];\n        if(this.isSwap(iv1,iv2,iv3,nodeId)){\n            var ja=this.map[ir][iera];\n            var jb=this.map[ir][ierb];\n            var jc=this.map[il][2];\n            this.elem[il][2]=iv3;\n            this.map[il][1]=ja;\n            this.map[il][2]=ir;\n            var picElem=this.elem[ir];\n            picElem[0]=nodeId;picElem[1]=iv3;picElem[2]=iv1;\n            picElem=this.map[ir];\n            picElem[0]=il;picElem[1]=jb;picElem[2]=jc;\n            if(ja!==-1){\n                var ix=this.edge(ja,ir,this.map);\n                this.map[ja][ix]=il;\n                if(!this.isBoundary(iv2,iv3))this.stack.push(il);\n            }\n            if(jb!==-1){\n                if(!this.isBoundary(iv3,iv1))this.stack.push(ir);\n            }\n            if(jc!==-1){\n                var ix=this.edge(jc,il,this.map);\n                this.map[jc][ix]=ir;\n            }\n        }\n    }\n    };\n\n    var del=new Delaunay2D(minX,minY,width,height);\n    this.clear=function(){del.clear();};\n    this.insert=function(pos){return del.insert(pos);};\n    this.getTriangleById=function(){return del.getTriangleById();};\n    this.getTriangleMapById=function(){return del.getTriangleMapById();};\n    this.getTriangle=function(){return del.getTriangle();};\n    this.addBoundary=function(arg,isClose){\n    return del.addBoundary(arg,isClose);\n    };\n    this.getContourObject=function(){\n        var ret=termat.Contour(del.node,del.elem);\n        return ret;\n    };\n};\n\n\n##Delaunay\u4e09\u89d2\u5206\u5272\u6cd5\u3068\u306f\uff1f\nDelaunay\u4e09\u89d2\u5206\u5272\u6cd5\u3068\u306f\u3001\u4efb\u610f\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u7bc0\u70b9\u7fa4\u3092\u5bfe\u8c61\u306b\u3001\u5bfe\u8c61\u9818\u57df\u3092\u4e09\u89d2\u5f62\u306b\u5206\u5272\u3059\u308b\u65b9\u6cd5\u306e\u4e00\u3064\u3067\u3059\u3002\n\u5168\u3066\u306e\u4e09\u89d2\u8981\u7d20\u306b\u3064\u3044\u3066\u3001\u305d\u306e\u5916\u63a5\u5186\u5185\u306b\u4ed6\u306e\u4e09\u89d2\u8981\u7d20\u306e\u7bc0\u70b9\u3092\u542b\u307e\u306a\u3044\u3068\u3044\u3046\u5e7e\u4f55\u5b66\u7684\u7279\u5fb4\u3092\u6709\u3059\u308b\u305f\u3081\u3001\u6709\u9650\u8981\u7d20\u6cd5\u7b49\u306e\u8981\u7d20\u5206\u5272\u306b\u5229\u7528\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4e09\u89d2\u8981\u7d20\u7fa4\u306f\u3001\u6570\u5024\u89e3\u6790\u3084\u5730\u5f62\u56f3CG\u3001\u30b3\u30f3\u30bf\u30fc\u56f3\u751f\u6210\u306b\u5229\u7528\u3067\u304d\u308b\u306a\u3069\u3001\u975e\u5e38\u306b\u4fbf\u5229\u306a\u306e\u3067\u3001\u6614\u3001Java\u3067\u5b9f\u88c5\u3057\u3066\u3044\u305f\u3082\u306e\u3092\u3001JavaScript\u306b\u79fb\u690d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\u30b5\u30f3\u30d7\u30eb\u3001\u53c2\u8003\u6587\u732e\u7b49\u306f\u3001[\u306f\u3066\u306a\u30d6\u30ed\u30b0](http://termat.hatenablog.com/entry/2015/11/08/JavaScript%E3%81%A7Delaunay%E4%B8%89%E8%A7%92%E5%BD%A2%E5%88%86%E5%89%B2%E3%82%AF%E3%83%A9%E3%82%B9%E3%82%92%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B%E3%80%82)\u3067\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\n##\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\n\u30ed\u30fc\u30bd\u30f3\u6cd5\u3068\u547c\u3070\u308c\u308b\u65b9\u6cd5\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\n\n1.\u7bc0\u70b9\u3092\u542b\u3080\u8981\u7d20\u3092\u63a2\u67fb\u3059\u308b\uff08\u56f31\uff5e4\uff09\u3002\n2.\u63a2\u67fb\u3057\u305f\u8981\u7d20\u3092\uff13\u5206\u5272\u3059\u308b\uff08\u56f35\uff09\u3002\n3.\u5206\u5272\u3055\u308c\u305f\u5404\u8981\u7d20\u306b\u3064\u3044\u3066\u3001\u5916\u63a5\u5186\u5185\u306b\u4ed6\u306e\u8981\u7d20\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u3001\u305d\u306e\u8981\u7d20\u306e\u8fba\u3092\u4ed8\u3051\u66ff\u3048\u308b\uff08\u56f36,7\uff09\n4.\u5206\u5272\u30fb\u8fba\u4ed8\u3051\u66ff\u3048\u3092\u884c\u3063\u305f\u8981\u7d20\u5168\u3066\u306b\u3064\u3044\u3066\u4e0a\u8a18\u306e\u51e6\u7406\u3092\u884c\u3046\u3002\n5.\u4e0a\u8a18\u306e\u51e6\u7406\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\u5206\u5272\u51e6\u7406\u5b8c\u4e86\u3002\n\n<img width=\"500px\" src=\"https://qiita-image-store.s3.amazonaws.com/0/55735/4f6bcee6-b65a-50fd-e956-c9b4f21532bf.png\" />\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002\u2192[\u3053\u3061\u3089](http://www.termat.net/wordpress/wp-content/uploads/2015/11/termat.delaunay.0.1.js)\u3067\u3082\u914d\u5e03\u3057\u3066\u307e\u3059\u3002\n\u306a\u304a\u30012010\u5e74\u9803\u306bActionScript\u7248\u3092[Wonderfl](http://wonderfl.net/)\u306b\u6295\u7a3f\u3057\u3066\u3044\u307e\u3059\u3002\u2192[\u3053\u3061\u3089](http://wonderfl.net/c/vuDK)(\u3082\u3046\u52d5\u304b\u306a\u3044\u304b\u3082\uff09\n\n```javascript:termat.delaunay.0.1.js\n/*  JavaScript Delaunay triangulation Class  , version 0.1\n *\n *  Copyright (c) 2015 t.matsuoka\n *  Released under the MIT license\n *  https://github.com/YukinobuKurata/YouTubeMagicBuyButton/blob/master/MIT-LICENSE.txt\n *\n *  web site: http://termat.hatenablog.com/\n *\n/*--------------------------------------------------------------------------*/\nvar termat=termat||{};\n\ntermat.Delaunay=function(minX,minY,width,height){\n\n    var Delaunay2D=function(minX,minY,width,height){\n\tthis.EPS=1e-16;\n\tthis.minX=minX;\n\tthis.minY=minY;\n\tthis.width=width;\n\tthis.height=height;\n\tthis.data=[];\n\tthis.node=[];\n\tthis.elem=[];\n\tthis.map=[];\n\tthis.stack=[];\n\tthis.boundary=[];\n\tthis.boundaryID=[];\n\tthis.node.push({x:-1.23,y:-0.5,z:0});\n\tthis.node.push({x:2.23,y:-0.5,z:0});\n\tthis.node.push({x:0.5,y:2.5,z:0});\n\tthis.elem.push(new Array(0,1,2));\n\tthis.map.push(new Array(-1,-1,-1));\n\tthis.ids=0;\n\tthis.bs=1;\n    };\n\n    Delaunay2D.prototype.clear=function(){\n\tthis.data=[];\n\tthis.node=[];\n\tthis.elem=[];\n\tthis.map=[];\n\tthis.stack=[];\n\tthis.boundary=[];\n\tthis.boundaryID=[];\n\tthis.node.push({x:-1.23,y:-0.5,z:0});\n\tthis.node.push({x:2.23,y:-0.5,z:0});\n\tthis.node.push({x:0.5,y:2.5,z:0});\n\tthis.elem.push(new Array(0,1,2));\n\tthis.map.push(new Array(-1,-1,-1));\n\tthis.ids=0;\n\tthis.bs=1;\n    };\n\n    Delaunay2D.prototype.getTriangleById=function(){\n\tvar et=[];\n\tvar id=0;\n\tfor(var i=0;i<this.elem.length;i++){\n\t\tif(!this.checkBounds(i)){\n\t\t\tet.push(-1);\n\t\t}else if(!this.checkBoundaryState(i)){\n\t\t\tet.push(-1);\n\t\t}else{\n\t\t\tet.push(id++);\n\t\t}\n\t}\n\tvar ee=[];\n\tfor(var i=0;i<et.length;i++){\n\t\tvar e=this.elem[i];\n\t\tif(et[i]!==-1){\n\t\t\tee.push(new Array(e[0]-3,e[1]-3,e[2]-3));\n\t\t}\n\t}\n\treturn ee;\n    };\n\n    Delaunay2D.prototype.getTriangleMapById=function(){\n\tvar et=[];\n\tvar id=0;\n\tfor(var i=0;i<this.elem.length;i++){\n\t\tif(!this.checkBounds(i)){\n\t\t\tet.push(-1);\n\t\t}else if(!this.checkBoundaryState(i)){\n\t\t\tet.push(-1);\n\t\t}else{\n\t\t\tet.push(id++);\n\t\t}\n\t}\n\tvar ee=[];\n\tvar tp=[];\n\tfor(var i=0;i<et.length;i++){\n\t\tvar e=this.map[i];\n\t\tif(et[i]!==-1){\n\t\t\tfor(var j=0;j<e.length;j++){\n\t\t\t\tif(e[j]===-1){\n\t\t\t\t\ttp[j]=-1;\n\t\t\t\t}else{\n\t\t\t\t\ttp[j]=et[e[j]];\n\t\t\t\t}\n\t\t\t}\n\t\t\tee.push(new Array(tp[0],tp[1],tp[2]));\n\t\t}\n\t}\n\treturn ee;\n    };\n\n    Delaunay2D.prototype.getTriangle=function(){\n\tvar et=[];\n\tvar id=0;\n\tfor(var i=0;i<this.elem.length;i++){\n\t\tif(!this.checkBounds(i)){\n\t\t\tet.push(-1);\n\t\t}else if(!this.checkBoundaryState(i)){\n\t\t\tet.push(-1);\n\t\t}else{\n\t\t\tet.push(id++);\n\t\t}\n\t}\n\tvar ee=[];\n\tfor(var i=0;i<et.length;i++){\n\t\tvar e=this.elem[i];\n\t\tif(et[i]!==-1){\n\t\t\tvar p0=this.data[e[0]-3];\n\t\t\tvar p1=this.data[e[1]-3];\n\t\t\tvar p2=this.data[e[2]-3];\n\t\t\tee.push(new Array(p0,p1,p2));\n\t\t}\n\t}\n\treturn ee;\n    };\n\n    Delaunay2D.prototype.isLeft=function(a,b,p){\n\tvar v0=(a.y-p.y)*(b.x-p.x);\n\tvar v1=(a.x-p.x)*(b.y-p.y);\n\tif(Math.abs(v1-v0)<this.EPS){\n\t\treturn 0;\n\t}else{\n\t\treturn (v1-v0);\n\t}\n    };\n\n    Delaunay2D.prototype.getLocation=function(id,p){\n\tvar e=this.elem[id];\n\tfor(var i=0;i<e.length;i++){\n\t\tvar a=this.node[e[i]];\n\t\tvar b=this.node[e[(i+1)%3]];\n\t\tif(this.isLeft(a,b,p)<0){\n\t\t\tvar n=this.map[id][i];\n\t\t\tif(n===-1){\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\treturn this.getLocation(n,p);\n\t\t}\n\t}\n\treturn id;\n    };\n\n    Delaunay2D.prototype.checkBoundaryState=function(id){\n\tif(this.bs>1){\n\t\tif(!this.checkBounds(id))return false;\n\t}\n\tvar e=this.elem[id];\n\tfor(var i=0;i<e.length;i++){\n\t\tvar b0=this.boundaryID[e[i]];\n\t\tvar b1=this.boundaryID[e[(i+1)%3]];\n\t\tif(b0-b1===0){\n\t\t\tvar v0=this.boundary[e[(i+1)%3]];\n\t\t\tif(v0===e[i]){\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\treturn true;\n    };\n\n    Delaunay2D.prototype.isBoundary=function(nodeId0,nodeId1){\n\tvar p=this.boundary[nodeId0];\n\tif(p===nodeId1)return true;\n\tvar p=this.boundary[nodeId1];\n\tif(p===nodeId0){\n\t\treturn true;\n\t}else{\n\t\treturn false;\n\t}\n    };\n\n    Delaunay2D.prototype.edge=function(elemId,targetId,mp){\n\tvar j=mp[elemId];\n\tfor(var i=0;i<j.length;i++){\n\t\tif(j[i]===targetId)return i;\n\t}\n\treturn -1;\n    };\n\n    Delaunay2D.prototype.isSwap=function(aId,bId,cId,pId){\n\tvar x13=this.node[aId].x-this.node[cId].x;\n\tvar y13=this.node[aId].y-this.node[cId].y;\n\tvar x23=this.node[bId].x-this.node[cId].x;\n\tvar y23=this.node[bId].y-this.node[cId].y;\n\tvar x1p=this.node[aId].x-this.node[pId].x;\n\tvar y1p=this.node[aId].y-this.node[pId].y;\n\tvar x2p=this.node[bId].x-this.node[pId].x;\n\tvar y2p=this.node[bId].y-this.node[pId].y;\n\tvar cosa=x13*x23+y13*y23;\n\tvar cosb=x2p*x1p+y1p*y2p;\n\tif(cosa>=0&&cosb>=0){\n\t\treturn false;\n\t}else if(cosa<0&&cosb<0){\n\t\treturn true;\n\t}else{\n\t\tvar sina=x13*y23-x23*y13;\n\t\tvar sinb=x2p*y1p-x1p*y2p;\n\t\tif((sina*cosb+sinb*cosa)<0){\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n    };\n\n    Delaunay2D.prototype.normalize=function(x,y,z){\n\tvar xx=(x-this.minX)/this.width;\n\tvar yy=(y-this.minY)/this.height;\n\treturn {x:xx,y:yy,z:z};\n    };\n\n    Delaunay2D.prototype.checkBounds=function(id){\n\tvar e=this.elem[id];\n\tif(e[0]<3||e[1]<3||e[2]<3){\n\t\treturn false;\n\t}else{\n\t\treturn true;\n\t}\n    };\n\n    Delaunay2D.prototype.insert=function(pos){\n\tvar p=this.normalize(pos.x,pos.y,pos.z);\n\tthis.ids=this.getLocation(this.ids,p);\n\tif(this.ids===-1){\n\t\tthis.ids=0;\n\t\treturn false;\n\t}else{\n\t\tif(this.checkBoundaryState(this.ids)){\n\t\t\tthis.data.push(pos);\n\t\t\tthis.node.push(p);\n\t\t\tthis.process(this.ids,this.node.length-1);\n\t\t\treturn true;\n\t\t}else{\n\t\t\treturn false;\n\t\t}\n\t}\n    };\n\n    Delaunay2D.prototype.addBoundary=function(arg,isClose){\n\tvar sz=this.node.length;\n\tfor(var i=0;i<arg.length;i++){\n\t\tvar p=this.normalize(arg[i].x,arg[i].y);\n\t\tthis.ids=this.getLocation(this.ids,p);\n\t\tif(this.ids===-1){\n\t\t\tthis.ids=0;\n\t\t\tcontinue;\n\t\t}\n\t\tif(this.checkBoundaryState(this.ids)){\n\t\t\tthis.data.push(arg[i]);\n\t\t\tthis.node.push(p);\n\t\t\tif(i>0){\n\t\t\t\tthis.boundary[sz+i-1]=sz+i;\n\t\t\t\tthis.boundaryID[sz+i-1]=this.bs;\n\t\t\t}\n\t\t\tthis.process(this.ids,this.node.length-1);\n\t\t}\n\t}\n\tif(isClose){\n\t\tthis.boundary[this.node.length-1]=sz;\n\t\tthis.boundaryID[this.node.length-1]=this.bs;\n\t}\n\tthis.bs++;\n    };\n\n    Delaunay2D.prototype.process=function(elemId,nodeId){\n\tvar nn=this.elem.length;\n\tvar em=this.elem[elemId];\n\tvar te=new Array(em[0],em[1],em[2]);\n\tvar e0=new Array(nodeId,em[0],em[1]);\n\tvar e1=new Array(nodeId,em[1],em[2]);\n\tvar e2=new Array(nodeId,em[2],em[0]);\n\tem[0]=e0[0];em[1]=e0[1];em[2]=e0[2];\n\tthis.elem.push(e1);\n\tthis.elem.push(e2);\n\tvar jm=this.map[elemId];\n\tvar tmp=new Array(jm[0],jm[1],jm[2]);\n\tvar j0=new Array(nn+1,jm[0],nn);\n\tvar j1=new Array(elemId,jm[1],nn+1);\n\tvar j2=new Array(nn,jm[2],elemId);\n\tjm[0]=j0[0];jm[1]=j0[1];jm[2]=j0[2];\n\tthis.map.push(j1);\n\tthis.map.push(j2);\n\tif(tmp[0]!==-1){\n\t\tif(!this.isBoundary(te[0],te[1]))this.stack.push(elemId);\n\t}\n\tif(tmp[1]!==-1){\n\t\tvar ix=this.edge(tmp[1],elemId,this.map);\n\t\tthis.map[tmp[1]][ix]=nn;\n\t\tif(!this.isBoundary(te[1],te[2]))this.stack.push(nn);\n\t}\n\tif(tmp[2]!==-1){\n\t\tvar ix=this.edge(tmp[2],elemId,this.map);\n\t\tthis.map[tmp[2]][ix]=nn+1;\n\t\tif(!this.isBoundary(te[2],te[0]))this.stack.push(nn+1);\n\t}\n\twhile(this.stack.length>0){\n\t\tvar il=this.stack.pop();\n\t\tvar ir=this.map[il][1];\n\t\tvar ierl=this.edge(ir,il,this.map);\n\t\tvar iera=(ierl+1)%3;\n\t\tvar ierb=(iera+1)%3;\n\t\tvar iv1=this.elem[ir][ierl];\n\t\tvar iv2=this.elem[ir][iera];\n\t\tvar iv3=this.elem[ir][ierb];\n\t\tif(this.isSwap(iv1,iv2,iv3,nodeId)){\n\t\t\tvar ja=this.map[ir][iera];\n\t\t\tvar jb=this.map[ir][ierb];\n\t\t\tvar jc=this.map[il][2];\n\t\t\tthis.elem[il][2]=iv3;\n\t\t\tthis.map[il][1]=ja;\n\t\t\tthis.map[il][2]=ir;\n\t\t\tvar picElem=this.elem[ir];\n\t\t\tpicElem[0]=nodeId;picElem[1]=iv3;picElem[2]=iv1;\n\t\t\tpicElem=this.map[ir];\n\t\t\tpicElem[0]=il;picElem[1]=jb;picElem[2]=jc;\n\t\t\tif(ja!==-1){\n\t\t\t\tvar ix=this.edge(ja,ir,this.map);\n\t\t\t\tthis.map[ja][ix]=il;\n\t\t\t\tif(!this.isBoundary(iv2,iv3))this.stack.push(il);\n\t\t\t}\n\t\t\tif(jb!==-1){\n\t\t\t\tif(!this.isBoundary(iv3,iv1))this.stack.push(ir);\n\t\t\t}\n\t\t\tif(jc!==-1){\n\t\t\t\tvar ix=this.edge(jc,il,this.map);\n\t\t\t\tthis.map[jc][ix]=ir;\n\t\t\t}\n\t\t}\n\t}\n    };\n\n    var del=new Delaunay2D(minX,minY,width,height);\n    this.clear=function(){del.clear();};\n    this.insert=function(pos){return del.insert(pos);};\n    this.getTriangleById=function(){return del.getTriangleById();};\n    this.getTriangleMapById=function(){return del.getTriangleMapById();};\n    this.getTriangle=function(){return del.getTriangle();};\n    this.addBoundary=function(arg,isClose){\n\treturn del.addBoundary(arg,isClose);\n    };\n    this.getContourObject=function(){\n        var ret=termat.Contour(del.node,del.elem);\n        return ret;\n    };\n};\n", "tags": ["JavaScript", "\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0"]}