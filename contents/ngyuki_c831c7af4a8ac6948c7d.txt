{"context": " More than 1 year has passed since last update.\u5c11\u3057\u524d\u306b\u4e0b\u8a18\u306e ParaTest \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u8a18\u4e8b\u3092\u8aad\u307f\u307e\u3057\u3066\u3001\n\nPHPUnit \u4e26\u5217\u5b9f\u884c\u306b\u6311\u6226\u4e2d - jwata's diary\n\n\n\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3068\u3057\u3066\u306f\u3001\u30d7\u30ed\u30bb\u30b9\u6bce\u306bDB/KVS\u306e\u30a2\u30af\u30bb\u30b9\u3092\u5206\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u3088\u3046\u3002\n\n\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b Docker \u30b3\u30f3\u30c6\u30ca\u3067 DB \u3092\u7acb\u3066\u3066 PHPUnit \u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3051\u308b\u304b\u3082\uff1f \u3068\u601d\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u8a66\u307f\u3068\u3057\u3066\u306f\u6210\u529f\u3067\u3082\u76ee\u7684\u3068\u3057\u3066\u306f\u5931\u6557\u3067\u3059\u3002\n\n\u30a2\u30d7\u30ea\u5074\u306e\u6e96\u5099\nParaTest \u3092 composer \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ composer require --dev brianium/paratest:dev-master\n\n\u304c\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u4e0a\u624b\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u53c2\u8003\u8a18\u4e8b\u306b\u3042\u3063\u305f\u4e0b\u8a18\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u4f7f\u308f\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\nComparing brianium:master...Jwata:feature/test_fix \u00b7 Jwata/paratest\n\n$ cd vendor/brianium/paratest\n$ git remote add jwata https://github.com/Jwata/paratest.git\n$ git fetch jwata\n$ git checkout -t jwata/feature/test_fix\n\n\u3053\u308c\u3060\u3051\u3060\u3068 composer install \u3067\u5143\u306b\u623b\u308b\u306e\u3067\u3001\u30ad\u30c1\u30f3\u3068\u3084\u308b\u306a\u3089 conposer.json \u306b repository \u3092\u66f8\u3044\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\u3002\n\u6b21\u306b PHPUnit \u3092 Docker \u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ntests/phpunit-docker\n#!/bin/bash\n\nPHPUNIT_DOCKER_IMAGE=sample\nPHPUNIT_DOCKER_DIR=$(cd \"$(dirname \"$0\")\"/..;pwd)\n\ndocker run --rm \\\n  -v /tmp:/tmp:rw \\\n  -v \"$PHPUNIT_DOCKER_DIR:$PHPUNIT_DOCKER_DIR:ro\" \\\n  -w \"$PHPUNIT_DOCKER_DIR\" \"$PHPUNIT_DOCKER_IMAGE\" \\\n  bash -c '\n    service mysqld start\n    vendor/bin/phpunit \"$@\"\n  ' -- \"$@\"\n\nPHPUNIT_DOCKER_IMAGE \u306f\u3053\u306e\u5f8c\u3067\u4f5c\u6210\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nPHPUNIT_DOCKER_DIR \u306f\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u76f8\u5bfe\u3067\u6307\u5b9a\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\nPHPUNIT_DOCKER_CONTAINER \u306f\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u540d\u524d\u3067\u3059\u3002\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u5f8c\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3057\u306a\u3044\u3068\u30b4\u30df\u304c\u6b8b\u308b\u306e\u3067\u540d\u524d\u3092\u4ed8\u3051\u3066 trap \u3067\u524a\u9664\u3057\u307e\u3059\u3002\u4e00\u610f\u306a\u540d\u524d\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u30a4\u30e1\u30fc\u30b8\u306e\u540d\u524d\u306b\u30db\u30b9\u30c8\u5074\u30d7\u30ed\u30bb\u30b9\u306e pid \u4ed8\u3051\u305f\u540d\u524d\u306b\u3057\u3066\u3044\u307e\u3059\u3002 \u2192 \u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u306a\u3089 --rm \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u505c\u6b62\u6642\u306b\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n/tmp \u3092\u30db\u30b9\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f ParaTest \u304b\u3089\u5b9f\u884c\u3055\u308c\u308b PHPUnit \u304c /tmp \u306b junit \u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3057\u3001ParaTest \u304c\u305d\u308c\u3092\u8aad\u3093\u3067\u30c6\u30b9\u30c8\u7d50\u679c\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\uff08phpunit \u30b3\u30de\u30f3\u30c9\u306b --log-junit /tmp/XXX \u306e\u3088\u3046\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\uff09\u3002\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Dockerfile \u306e\u5185\u5bb9\u306f\u6b21\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002mysql \u3084 php \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u7a7a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nDockerfile\nFROM centos:centos6\nMAINTAINER ore\n\nRUN yum -y install epel-release rootfiles\nRUN rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\nRUN yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum -y install mysql-community-server\n\nRUN yum -y install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nRUN yum -y --enablerepo=remi-php55 install php php-cli php-opcache \\\n  php-process php-mysqlnd php-pdo php-mbstring php-xml \\\n  php-pecl-xdebug php-pecl-zip  php-pecl-yaml php-pecl-jsonc\n\nRUN echo -e \"[mysqld]\\ntmpdir = /var/tmp\\n\" > /etc/my.cnf\nRUN touch /etc/sysconfig/network\nRUN mysql_install_db --user=mysql\n\nRUN service mysqld start && mysql -ve \" \\\n  CREATE DATABASE sample_test DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin; \\\n  GRANT ALL ON sample_test.* TO sample@'localhost'; \\\n  GRANT ALL ON sample_test.* TO sample@'%'; \\\n\" ; service mysqld stop\n\n\u6700\u521d\u306e\u65b9\u3067 rootfiles \u3092 yum \u3067\u5165\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u591a\u5206\u7121\u304f\u3066\u3082\u3044\u3044\u3067\u3059\u3002\u306a\u3093\u3067\u5165\u308c\u305f\u306e\u3060\u3063\u305f\u304b\u306a\u30fb\u30fb\u30fb\u5fd8\u308c\u307e\u3057\u305f\u3002\n\u5f8c\u306f\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u8a2d\u5b9a\u3057\u305f\u308a mysql \u3092\u5165\u308c\u305f\u308a php \u3092\u5165\u308c\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\n\u524d\u8ff0\u306e\u901a\u308a /tmp \u3092\u30db\u30b9\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3059\u308b\u306e\u3067\u3001MySQL \u306e\u8a2d\u5b9a\u3067 tmpdir \u3092\u5225\u306e\u5834\u6240\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002/tmp \u306e\u307e\u307e\u3060\u3068\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u306e MySQL \u304c\u540c\u3058\u540d\u524d\u306e\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308d\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u304c\u983b\u767a\u3057\u307e\u3057\u305f\u3002\nPDOException: SQLSTATE[HY000]: General error: 1 Can't create/write to file '/tmp/#sql_100_0.MYI' (Errcode: 17 - File exists)\n\nservice mysqld start \u3067 mysqld \u3092\u8d77\u52d5\u3057\u3066\u307e\u3059\u3002\u3053\u308c\u306f CentOS6 \u306e mysqld \u306e\u8d77\u52d5\u304c sysvinit \u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3060\u304b\u3089\u53ef\u80fd\u306a\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002systemd \u3068\u304b\u306a\u3089\u3053\u308c\u3060\u3051\u3067\u306f\u7121\u7406\u3060\u308d\u3046\u306e\u3067\u3001mysqld \u3084 mysqld_safe \u3092\u76f4\u63a5\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002mysqld \u306e\u8d77\u52d5\u3092\u5f85\u3063\u305f\u308a\u7d42\u4e86\u3092\u5f85\u3063\u305f\u308a\u3059\u308b\u306e\u304c\u3068\u3066\u3082\u9762\u5012\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3002\n\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n$ docker build -t sample:base .\n\n\n\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3044\u307e\u3059\u3002\n/path/to/sample \u306f\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3059\u3002./build.sh \u306f\u3044\u308f\u3086\u308b\u79d8\u4f1d\u306e\u30bf\u30ec\u3067\u3059\u3002\n$ docker run --name=tmp -v /path/to/sample:/path/to/sample:ro sample:base /bin/bash -c '\n  service mysqld start\n  cd /path/to/sample\n  ./build.sh migrate --test\n  service mysqld stop\n'\n\n\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ docker commit tmp sample\n\n\u30a4\u30e1\u30fc\u30b8\u3067\u304d\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u306f\u3082\u3046\u5fc5\u8981\u306a\u3044\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\n$ docker rm tmp\n\n\nDocker \u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\u3053\u306e\u6642\u70b9\u3067 tests/phpunit-docker \u3092\u5b9f\u884c\u3059\u308c\u3070 Docker \u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u304c\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n$ cd /path/to/sample\n$ tests/phpunit-docker\n\n\u6b21\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nStarting mysqld:  [  OK  ]\nPHPUnit 3.7.37 by Sebastian Bergmann.\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 720 (  8%)\n............................................................... 126 / 720 ( 17%)\n............................................................... 189 / 720 ( 26%)\n............................................................... 252 / 720 ( 35%)\n............................................................... 315 / 720 ( 43%)\n............................................................... 378 / 720 ( 52%)\n............................................................... 441 / 720 ( 61%)\n............................................................... 504 / 720 ( 70%)\n............................................................... 567 / 720 ( 78%)\n............................................................... 630 / 720 ( 87%)\n............................................................... 693 / 720 ( 96%)\n.........................\n\nTime: 1.57 minutes, Memory: 111.50Mb\n\nOK (718 tests, 2726 assertions)\n\n\uff11\u884c\u76ee\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u901a\u308a\u3001\u30c6\u30b9\u30c8\u306e\u958b\u59cb\u6642\u306b MySQL \u304c\u958b\u59cb\u3057\u3066\u3044\u307e\u3059\u3002\n\nParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\nParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002-p \u3067\u4e26\u5217\u6570\u3092\u6307\u5b9a\u3057\u3001--phpunit \u3067 tests/phpunit-docker \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ cd /path/to/sample\n$ vendor/bin/paratest -p 4 --phpunit=tests/phpunit-docker\n\n\u6b21\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30c6\u30b9\u30c8\u6570\u306e\u5206\u6bcd\u304c\u30aa\u30ab\u30b7\u30a4\u3067\u3059\u304c\u898b\u306a\u304b\u3063\u305f\u3053\u3068\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nRunning phpunit in 4 processes with tests/phpunit-docker\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n............................................................... 504 / 644 ( 78%)\n..........................................................E.... 567 / 644 ( 88%)\n..F............................................................ 630 / 644 ( 97%)\n...........................................................E... 693 / 644 (107%)\n......FF.................\n\nTime: 12.22 minutes, Memory: 36.50Mb\n\nThere were 2 errors:\n\n(\u4e2d\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2717, Failures: 3, Errors: 2.\n\n\u5e7e\u3064\u304b\u306e\u30c6\u30b9\u30c8\u304c\u30b3\u30b1\u307e\u3057\u305f\u3002\u305f\u3076\u3093\u5143\u3005\u4e0d\u5b89\u5b9a\u306a\u30c6\u30b9\u30c8\u306a\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u6050\u3089\u304f\u3042\u308b\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u5225\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u5b9f\u884c\u3092\u524d\u63d0\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u3002\u8981\u4fee\u6b63\u3067\u3059\u304c\u3001\u5f53\u521d\u306e\u76ee\u7684\u3067\u3042\u308b MySQL \u3092\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067\u8d77\u52d5\u3057\u3064\u3064\u306e\u30c6\u30b9\u30c8\u306f\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u305f\u3060\u3057\u3001\u3054\u89a7\u306e\u901a\u308a\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u3068\u304d\u3068\u6bd4\u3079\u3066\u6570\u500d\u306e\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u7d50\u679c\n\u3053\u306e\u65b9\u6cd5\u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308c\u3070 MySQL \u306f\u305d\u308c\u305e\u308c\u5225\u306e Docker \u30b3\u30f3\u30c6\u30ca\u306b\u306a\u308b\u306e\u3067\u5f71\u97ff\u3057\u3042\u3046\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u300c\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u300d\u3068\u300cParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u300d\u3092\u81ea\u52d5\u5316\u3059\u308c\u3070 Jenkins \u3067\u30c6\u30b9\u30c8\u3092\u307e\u308f\u3059\u3053\u3068\u3082\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\u304c\u3001\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u306e\u3088\u308a\u3082\u306f\u308b\u304b\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\nDocker \u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u306e\u30aa\u30fc\u30d0\u30d8\u30c3\u30c9\nParaTest \u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001phpunit \u30b3\u30de\u30f3\u30c9\u304c\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\uff08*Test.php\uff09\u3054\u3068\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u3053\u306e\u4ed5\u7d44\u3060\u3068\u30c6\u30b9\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u6570\u3060\u3051 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u2192\u524a\u9664\u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002/var/log/docker \u3092 tail -f \u3059\u308b\u3068\u8d77\u52d5\u2192\u524a\u9664\u304c\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u3088\u304f\u308f\u304b\u308a\u307e\u3059\u3002\n\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306f 200 \u3050\u3089\u3044\u3042\u3063\u305f\u306e\u3067\u3001\u3055\u3059\u304c\u306b 200 \u56de\u3082\u8d77\u52d5\u2192\u524a\u9664\u3092\u7e70\u308a\u8fd4\u305b\u3070\u6642\u9593\u3082\u304b\u304b\u308b\u3067\u3057\u3087\u3046\u30fb\u30fb\u30fbMySQL \u306e\u8d77\u52d5\u306b\u3082\u6570\u79d2\u304b\u3089\u5341\u6570\u79d2\u3050\u3089\u3044\u306e\u6642\u9593\u306f\u304b\u304b\u308a\u307e\u3059\u3057\u3002\n\n\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306f\u30c7\u30a3\u30b9\u30af\u3060\u3063\u305f\n\u305d\u3082\u305d\u3082\u30c6\u30b9\u30c8\u304c\u9045\u3044\u539f\u56e0\u306f\u30c7\u30a3\u30b9\u30af\u306e I/O \u3067\u3057\u305f\u3002\u306a\u306e\u3067\u4e26\u5217\u306b\u5b9f\u884c\u3057\u305f\u3068\u3053\u308d\u3067\u3042\u307e\u308a\u65e9\u304f\u306a\u308a\u307e\u305b\u3093\u3002\n\n\u30b5\u30fc\u30d0\u306e\u6027\u80fd\u304c\u30b7\u30e7\u30dc\u3059\u304e\u305f\n\u30e1\u30e2\u30ea 1G \u3067 1 \u30b3\u30a2\u306e\u4eee\u60f3\u74b0\u5883\u3067\u8a66\u3057\u307e\u3057\u305f\u3002\u4e26\u5217\u6570\u3092 20 \u3068\u304b\u306b\u3059\u308b\u3068\u30b9\u30ef\u30c3\u30d7\u3057\u307e\u304f\u3063\u3066\u30c6\u30b9\u30c8\u304c\u7d42\u308f\u308b\u6c17\u914d\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u307e\u3068\u3081\n\u5f53\u521d\u306e\u76ee\u7684\u3067\u3042\u308b Docker \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 MySQL \u3092\u8d77\u52d5\u3057\u3066 PHPUnit \u3092\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u5168\u7136\u65e9\u304f\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u6b21\u306e\u3088\u3046\u306a\u70b9\u3092\u6539\u5584\u3059\u308c\u3070\u3082\u3046\u5c11\u3057\u30de\u30b7\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nParaTest \u3092\u5f04\u3063\u3066 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u4e26\u5217\u6570\u3060\u3051\u3057\u304b\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n\n\n\u6700\u521d\u306b\u4e26\u5217\u6570\u306e\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 nsenter \u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066 phpunit \u3092\u5b9f\u884c\u3059\u308b\u3068\u304b\n\n\nRAID0 \u3068\u304b\u3067\u30c7\u30a3\u30b9\u30af\u306e I/O \u3092\u826f\u304f\u3059\u308b\n\n\n\u3042\u308b\u3044\u306f SSD \u3068\u304b AWS \u306e Instance Store \u3068\u304b\n\n\n\u3082\u3046\u5c11\u3057\u30de\u30b7\u306a\u6027\u80fd\u306e\u30b5\u30fc\u30d0\u3067\u3084\u308b\n\nMySQL \u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 tmpfs \u306b\u3059\u308b\u306e\u304c\u4e00\u756a\u624b\u3063\u53d6\u308a\u65e9\u3044\u3067\u3059\u304c\u306d\u3002\n\u5c11\u3057\u524d\u306b\u4e0b\u8a18\u306e ParaTest \u3067 PHPUnit \u3092\u4e26\u5217\u5b9f\u884c\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u308b\u8a18\u4e8b\u3092\u8aad\u307f\u307e\u3057\u3066\u3001\n\n - [PHPUnit \u4e26\u5217\u5b9f\u884c\u306b\u6311\u6226\u4e2d - jwata's diary](http://jwata.hatenablog.com/entry/2014/04/28/020832 \"PHPUnit \u4e26\u5217\u5b9f\u884c\u306b\u6311\u6226\u4e2d - jwata's diary\")\n\n> \u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u3068\u3057\u3066\u306f\u3001\u30d7\u30ed\u30bb\u30b9\u6bce\u306bDB/KVS\u306e\u30a2\u30af\u30bb\u30b9\u3092\u5206\u3051\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u3088\u3046\u3002\n\n\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u3054\u3068\u306b Docker \u30b3\u30f3\u30c6\u30ca\u3067 DB \u3092\u7acb\u3066\u3066 PHPUnit \u3092\u5b9f\u884c\u3059\u308c\u3070\u3044\u3051\u308b\u304b\u3082\uff1f \u3068\u601d\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u8a66\u307f\u3068\u3057\u3066\u306f\u6210\u529f\u3067\u3082\u76ee\u7684\u3068\u3057\u3066\u306f\u5931\u6557\u3067\u3059\u3002\n\n# \u30a2\u30d7\u30ea\u5074\u306e\u6e96\u5099\n\nParaTest \u3092 composer \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ composer require --dev brianium/paratest:dev-master\n```\n\n\u304c\u3001\u3053\u306e\u307e\u307e\u3060\u3068\u4e0a\u624b\u304f\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u306e\u3067\u53c2\u8003\u8a18\u4e8b\u306b\u3042\u3063\u305f\u4e0b\u8a18\u306e\u30d6\u30e9\u30f3\u30c1\u3092\u4f7f\u308f\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\n - [Comparing brianium:master...Jwata:feature/test_fix \u00b7 Jwata/paratest](https://github.com/Jwata/paratest/compare/feature/test_fix \"Comparing brianium:master...Jwata:feature/test_fix \u00b7 Jwata/paratest\")\n\n```\n$ cd vendor/brianium/paratest\n$ git remote add jwata https://github.com/Jwata/paratest.git\n$ git fetch jwata\n$ git checkout -t jwata/feature/test_fix\n```\n\n\u3053\u308c\u3060\u3051\u3060\u3068 composer install \u3067\u5143\u306b\u623b\u308b\u306e\u3067\u3001\u30ad\u30c1\u30f3\u3068\u3084\u308b\u306a\u3089 conposer.json \u306b repository \u3092\u66f8\u3044\u305f\u65b9\u304c\u826f\u3044\u3067\u3059\u3002\n\n\u6b21\u306b PHPUnit \u3092 Docker \u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n*tests/phpunit-docker*\n\n```sh\n#!/bin/bash\n\nPHPUNIT_DOCKER_IMAGE=sample\nPHPUNIT_DOCKER_DIR=$(cd \"$(dirname \"$0\")\"/..;pwd)\n\ndocker run --rm \\\n  -v /tmp:/tmp:rw \\\n  -v \"$PHPUNIT_DOCKER_DIR:$PHPUNIT_DOCKER_DIR:ro\" \\\n  -w \"$PHPUNIT_DOCKER_DIR\" \"$PHPUNIT_DOCKER_IMAGE\" \\\n  bash -c '\n    service mysqld start\n    vendor/bin/phpunit \"$@\"\n  ' -- \"$@\"\n```\n\n`PHPUNIT_DOCKER_IMAGE` \u306f\u3053\u306e\u5f8c\u3067\u4f5c\u6210\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n`PHPUNIT_DOCKER_DIR` \u306f\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u304b\u3089\u306e\u76f8\u5bfe\u3067\u6307\u5b9a\u3059\u308b\u3068\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n<del>`PHPUNIT_DOCKER_CONTAINER` \u306f\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u540d\u524d\u3067\u3059\u3002\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u5f8c\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3057\u306a\u3044\u3068\u30b4\u30df\u304c\u6b8b\u308b\u306e\u3067\u540d\u524d\u3092\u4ed8\u3051\u3066 trap \u3067\u524a\u9664\u3057\u307e\u3059\u3002\u4e00\u610f\u306a\u540d\u524d\u3067\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u306e\u3067\u30a4\u30e1\u30fc\u30b8\u306e\u540d\u524d\u306b\u30db\u30b9\u30c8\u5074\u30d7\u30ed\u30bb\u30b9\u306e pid \u4ed8\u3051\u305f\u540d\u524d\u306b\u3057\u3066\u3044\u307e\u3059\u3002</del> \u2192 \u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u306a\u3089 `--rm` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u505c\u6b62\u6642\u306b\u81ea\u52d5\u7684\u306b\u524a\u9664\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n`/tmp` \u3092\u30db\u30b9\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u306f ParaTest \u304b\u3089\u5b9f\u884c\u3055\u308c\u308b PHPUnit \u304c /tmp \u306b junit \u5f62\u5f0f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u51fa\u529b\u3057\u3001ParaTest \u304c\u305d\u308c\u3092\u8aad\u3093\u3067\u30c6\u30b9\u30c8\u7d50\u679c\u3092\u53d6\u5f97\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\uff08phpunit \u30b3\u30de\u30f3\u30c9\u306b --log-junit /tmp/XXX \u306e\u3088\u3046\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\uff09\u3002\n\n# \u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\n\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Dockerfile \u306e\u5185\u5bb9\u306f\u6b21\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002mysql \u3084 php \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u7a7a\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n*Dockerfile*\n\n```\nFROM centos:centos6\nMAINTAINER ore\n\nRUN yum -y install epel-release rootfiles\nRUN rm -f /etc/localtime && cp -p /usr/share/zoneinfo/Japan /etc/localtime\n\nRUN yum -y install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum -y install mysql-community-server\n\nRUN yum -y install http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nRUN yum -y --enablerepo=remi-php55 install php php-cli php-opcache \\\n  php-process php-mysqlnd php-pdo php-mbstring php-xml \\\n  php-pecl-xdebug php-pecl-zip  php-pecl-yaml php-pecl-jsonc\n\nRUN echo -e \"[mysqld]\\ntmpdir = /var/tmp\\n\" > /etc/my.cnf\nRUN touch /etc/sysconfig/network\nRUN mysql_install_db --user=mysql\n\nRUN service mysqld start && mysql -ve \" \\\n  CREATE DATABASE sample_test DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin; \\\n  GRANT ALL ON sample_test.* TO sample@'localhost'; \\\n  GRANT ALL ON sample_test.* TO sample@'%'; \\\n\" ; service mysqld stop\n```\n\n\u6700\u521d\u306e\u65b9\u3067 rootfiles \u3092 yum \u3067\u5165\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u591a\u5206\u7121\u304f\u3066\u3082\u3044\u3044\u3067\u3059\u3002\u306a\u3093\u3067\u5165\u308c\u305f\u306e\u3060\u3063\u305f\u304b\u306a\u30fb\u30fb\u30fb\u5fd8\u308c\u307e\u3057\u305f\u3002\n\n\u5f8c\u306f\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u8a2d\u5b9a\u3057\u305f\u308a mysql \u3092\u5165\u308c\u305f\u308a php \u3092\u5165\u308c\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u524d\u8ff0\u306e\u901a\u308a /tmp \u3092\u30db\u30b9\u30c8\u3068\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3059\u308b\u306e\u3067\u3001MySQL \u306e\u8a2d\u5b9a\u3067 tmpdir \u3092\u5225\u306e\u5834\u6240\u306b\u5909\u66f4\u3057\u3066\u3044\u307e\u3059\u3002/tmp \u306e\u307e\u307e\u3060\u3068\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u306e MySQL \u304c\u540c\u3058\u540d\u524d\u306e\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308d\u3046\u3068\u3057\u3066\u30a8\u30e9\u30fc\u304c\u983b\u767a\u3057\u307e\u3057\u305f\u3002\n\n```\nPDOException: SQLSTATE[HY000]: General error: 1 Can't create/write to file '/tmp/#sql_100_0.MYI' (Errcode: 17 - File exists)\n```\n\n`service mysqld start` \u3067 mysqld \u3092\u8d77\u52d5\u3057\u3066\u307e\u3059\u3002\u3053\u308c\u306f CentOS6 \u306e mysqld \u306e\u8d77\u52d5\u304c sysvinit \u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3060\u304b\u3089\u53ef\u80fd\u306a\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002systemd \u3068\u304b\u306a\u3089\u3053\u308c\u3060\u3051\u3067\u306f\u7121\u7406\u3060\u308d\u3046\u306e\u3067\u3001mysqld \u3084 mysqld_safe \u3092\u76f4\u63a5\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002mysqld \u306e\u8d77\u52d5\u3092\u5f85\u3063\u305f\u308a\u7d42\u4e86\u3092\u5f85\u3063\u305f\u308a\u3059\u308b\u306e\u304c\u3068\u3066\u3082\u9762\u5012\u3060\u3068\u601d\u3044\u307e\u3059\u304c\u3002\n\n\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```\n$ docker build -t sample:base .\n```\n\n# \u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\n\n\u30d9\u30fc\u30b9\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u884c\u3044\u307e\u3059\u3002\n\n`/path/to/sample` \u306f\u30a2\u30d7\u30ea\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u3059\u3002`./build.sh` \u306f\u3044\u308f\u3086\u308b\u79d8\u4f1d\u306e\u30bf\u30ec\u3067\u3059\u3002\n\n```\n$ docker run --name=tmp -v /path/to/sample:/path/to/sample:ro sample:base /bin/bash -c '\n  service mysqld start\n  cd /path/to/sample\n  ./build.sh migrate --test\n  service mysqld stop\n'\n```\n\n\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ docker commit tmp sample\n```\n\n\u30a4\u30e1\u30fc\u30b8\u3067\u304d\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u306f\u3082\u3046\u5fc5\u8981\u306a\u3044\u306e\u3067\u524a\u9664\u3057\u307e\u3059\u3002\n\n```\n$ docker rm tmp\n```\n\n# Docker \u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n\u3053\u306e\u6642\u70b9\u3067 `tests/phpunit-docker` \u3092\u5b9f\u884c\u3059\u308c\u3070 Docker \u30b3\u30f3\u30c6\u30ca\u3067\u30c6\u30b9\u30c8\u304c\u5b9f\u884c\u3055\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n```\n$ cd /path/to/sample\n$ tests/phpunit-docker\n```\n\n\u6b21\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```\nStarting mysqld:  [  OK  ]\nPHPUnit 3.7.37 by Sebastian Bergmann.\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 720 (  8%)\n............................................................... 126 / 720 ( 17%)\n............................................................... 189 / 720 ( 26%)\n............................................................... 252 / 720 ( 35%)\n............................................................... 315 / 720 ( 43%)\n............................................................... 378 / 720 ( 52%)\n............................................................... 441 / 720 ( 61%)\n............................................................... 504 / 720 ( 70%)\n............................................................... 567 / 720 ( 78%)\n............................................................... 630 / 720 ( 87%)\n............................................................... 693 / 720 ( 96%)\n.........................\n\nTime: 1.57 minutes, Memory: 111.50Mb\n\nOK (718 tests, 2726 assertions)\n```\n\n\uff11\u884c\u76ee\u306b\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u901a\u308a\u3001\u30c6\u30b9\u30c8\u306e\u958b\u59cb\u6642\u306b MySQL \u304c\u958b\u59cb\u3057\u3066\u3044\u307e\u3059\u3002\n\n# ParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\nParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002`-p` \u3067\u4e26\u5217\u6570\u3092\u6307\u5b9a\u3057\u3001`--phpunit` \u3067 `tests/phpunit-docker` \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n$ cd /path/to/sample\n$ vendor/bin/paratest -p 4 --phpunit=tests/phpunit-docker\n```\n\n\u6b21\u306e\u3088\u3046\u306a\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30c6\u30b9\u30c8\u6570\u306e\u5206\u6bcd\u304c\u30aa\u30ab\u30b7\u30a4\u3067\u3059\u304c\u898b\u306a\u304b\u3063\u305f\u3053\u3068\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\nRunning phpunit in 4 processes with tests/phpunit-docker\n\nConfiguration read from /path/to/sample/phpunit.xml.dist\n\n...............................................................  63 / 644 (  9%)\n............................................................... 126 / 644 ( 19%)\n............................................................... 189 / 644 ( 29%)\n............................................................... 252 / 644 ( 39%)\n............................................................... 315 / 644 ( 48%)\n............................................................... 378 / 644 ( 58%)\n............................................................... 441 / 644 ( 68%)\n............................................................... 504 / 644 ( 78%)\n..........................................................E.... 567 / 644 ( 88%)\n..F............................................................ 630 / 644 ( 97%)\n...........................................................E... 693 / 644 (107%)\n......FF.................\n\nTime: 12.22 minutes, Memory: 36.50Mb\n\nThere were 2 errors:\n\n(\u4e2d\u7565)\n\nFAILURES!\nTests: 718, Assertions: 2717, Failures: 3, Errors: 2.\n```\n\n\u5e7e\u3064\u304b\u306e\u30c6\u30b9\u30c8\u304c\u30b3\u30b1\u307e\u3057\u305f\u3002\u305f\u3076\u3093\u5143\u3005\u4e0d\u5b89\u5b9a\u306a\u30c6\u30b9\u30c8\u306a\u306e\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u6050\u3089\u304f\u3042\u308b\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u304c\u5225\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u306e\u5b9f\u884c\u3092\u524d\u63d0\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u3002\u8981\u4fee\u6b63\u3067\u3059\u304c\u3001\u5f53\u521d\u306e\u76ee\u7684\u3067\u3042\u308b MySQL \u3092\u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067\u8d77\u52d5\u3057\u3064\u3064\u306e\u30c6\u30b9\u30c8\u306f\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\n\u305f\u3060\u3057\u3001\u3054\u89a7\u306e\u901a\u308a\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u3068\u304d\u3068\u6bd4\u3079\u3066\u6570\u500d\u306e\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002\n\n# \u7d50\u679c\n\n\u3053\u306e\u65b9\u6cd5\u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308c\u3070 MySQL \u306f\u305d\u308c\u305e\u308c\u5225\u306e Docker \u30b3\u30f3\u30c6\u30ca\u306b\u306a\u308b\u306e\u3067\u5f71\u97ff\u3057\u3042\u3046\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u300c\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306e\u4f5c\u6210\u300d\u3068\u300cParaTest \u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u300d\u3092\u81ea\u52d5\u5316\u3059\u308c\u3070 Jenkins \u3067\u30c6\u30b9\u30c8\u3092\u307e\u308f\u3059\u3053\u3068\u3082\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\n\u304c\u3001\uff11\u30d7\u30ed\u30bb\u30b9\u3067\u5b9f\u884c\u3059\u308b\u306e\u3088\u308a\u3082\u306f\u308b\u304b\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n## Docker \u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u3068\u524a\u9664\u306e\u30aa\u30fc\u30d0\u30d8\u30c3\u30c9\n\nParaTest \u3067\u4e26\u5217\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001phpunit \u30b3\u30de\u30f3\u30c9\u304c\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\uff08`*Test.php`\uff09\u3054\u3068\u306b\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u3053\u306e\u4ed5\u7d44\u3060\u3068\u30c6\u30b9\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u6570\u3060\u3051 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u2192\u524a\u9664\u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002/var/log/docker \u3092 `tail -f` \u3059\u308b\u3068\u8d77\u52d5\u2192\u524a\u9664\u304c\u4f55\u5ea6\u3082\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u3088\u304f\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u30c6\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306f 200 \u3050\u3089\u3044\u3042\u3063\u305f\u306e\u3067\u3001\u3055\u3059\u304c\u306b 200 \u56de\u3082\u8d77\u52d5\u2192\u524a\u9664\u3092\u7e70\u308a\u8fd4\u305b\u3070\u6642\u9593\u3082\u304b\u304b\u308b\u3067\u3057\u3087\u3046\u30fb\u30fb\u30fbMySQL \u306e\u8d77\u52d5\u306b\u3082\u6570\u79d2\u304b\u3089\u5341\u6570\u79d2\u3050\u3089\u3044\u306e\u6642\u9593\u306f\u304b\u304b\u308a\u307e\u3059\u3057\u3002\n\n## \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306f\u30c7\u30a3\u30b9\u30af\u3060\u3063\u305f\n\n\u305d\u3082\u305d\u3082\u30c6\u30b9\u30c8\u304c\u9045\u3044\u539f\u56e0\u306f\u30c7\u30a3\u30b9\u30af\u306e I/O \u3067\u3057\u305f\u3002\u306a\u306e\u3067\u4e26\u5217\u306b\u5b9f\u884c\u3057\u305f\u3068\u3053\u308d\u3067\u3042\u307e\u308a\u65e9\u304f\u306a\u308a\u307e\u305b\u3093\u3002\n\n## \u30b5\u30fc\u30d0\u306e\u6027\u80fd\u304c\u30b7\u30e7\u30dc\u3059\u304e\u305f\n\n\u30e1\u30e2\u30ea 1G \u3067 1 \u30b3\u30a2\u306e\u4eee\u60f3\u74b0\u5883\u3067\u8a66\u3057\u307e\u3057\u305f\u3002\u4e26\u5217\u6570\u3092 20 \u3068\u304b\u306b\u3059\u308b\u3068\u30b9\u30ef\u30c3\u30d7\u3057\u307e\u304f\u3063\u3066\u30c6\u30b9\u30c8\u304c\u7d42\u308f\u308b\u6c17\u914d\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n# \u307e\u3068\u3081\n\n\u5f53\u521d\u306e\u76ee\u7684\u3067\u3042\u308b Docker \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u3067 MySQL \u3092\u8d77\u52d5\u3057\u3066 PHPUnit \u3092\u4e26\u5217\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u5168\u7136\u65e9\u304f\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u6b21\u306e\u3088\u3046\u306a\u70b9\u3092\u6539\u5584\u3059\u308c\u3070\u3082\u3046\u5c11\u3057\u30de\u30b7\u306b\u306a\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n - ParaTest \u3092\u5f04\u3063\u3066 Docker \u30b3\u30f3\u30c6\u30ca\u304c\u4e26\u5217\u6570\u3060\u3051\u3057\u304b\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\n    - \u6700\u521d\u306b\u4e26\u5217\u6570\u306e\u6570\u3060\u3051\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066 nsenter \u3067\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u3063\u3066 phpunit \u3092\u5b9f\u884c\u3059\u308b\u3068\u304b\n - RAID0 \u3068\u304b\u3067\u30c7\u30a3\u30b9\u30af\u306e I/O \u3092\u826f\u304f\u3059\u308b\n    - \u3042\u308b\u3044\u306f SSD \u3068\u304b AWS \u306e Instance Store \u3068\u304b\n - \u3082\u3046\u5c11\u3057\u30de\u30b7\u306a\u6027\u80fd\u306e\u30b5\u30fc\u30d0\u3067\u3084\u308b\n\nMySQL \u306e\u30c7\u30fc\u30bf\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 tmpfs \u306b\u3059\u308b\u306e\u304c\u4e00\u756a\u624b\u3063\u53d6\u308a\u65e9\u3044\u3067\u3059\u304c\u306d\u3002\n", "tags": ["PHP", "PHPUnit", "docker"]}