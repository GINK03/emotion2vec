{"tags": ["Conoha", "\u8a2d\u5b9a", "SSH", "ssh\u516c\u958b\u9375\u8a8d\u8a3c", "\u521d\u671f\u8a2d\u5b9a"], "context": "\n\nConohaVPS\u306e\u8a2d\u5b9a SSH\u63a5\u7d9a\u3000\u30dd\u30fc\u30c8\u5909\u66f4\u306a\u3069\n\nConoha VPS \u306e\u30ec\u30f3\u30bf\u30eb\n\u4eca\u56de\u306f\nConoha VPS \u30e1\u30e2\u30ea 4G SSD 50G CentOS 7.2(x64)\n\u3092\u9078\u5b9a\u3057\u307e\u3057\u305f\n\nConoha\u306e\u30b5\u30fc\u30d0\u30fc\u8ffd\u52a0\u753b\u9762\u306b\u3066\u3001\u6761\u4ef6\u3092\u8a2d\u5b9a\u3057\u53f3\u4e0b\u306e\u8ffd\u52a0\u30dc\u30bf\u30f3\u3067\u7c21\u5358\u306b\u30ec\u30f3\u30bf\u30eb\u3067\u304d\u308b\n\nIP\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\n\u30ec\u30f3\u30bf\u30eb\u3057\u305fVPS\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u3066root\u306b\u30ed\u30b0\u30a4\u30f3\n\u3055\u304d\u307b\u3069\u78ba\u8a8d\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3002\n111.222.333.444\u3060\u3063\u305f\u3089root@111.222.333.444\n$ ssh root@111.222.333.444 -p 22\nroot@111.222.333's password: # \u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n\n[root@111.222.333.444 ~]# \n\n\n\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\nvpsuser\u3068\u3044\u3046\u65b0\u3057\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n# \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n$ adduser vpsuser \n\n# vpsuser\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n$ passwd vpsuser\n\n# wheel\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n$ gpasswd -a vpsuser wheel\n\n# \u4f5c\u6210\u3057\u305f vpsuser \u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u78ba\u8a8d\n$ su vpsuser\n\n\n\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u304b\u3089sudo\u3084su\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u78ba\u8a8d\nConoha\u306e\u521d\u671f\u8a2d\u5b9a\u3067\u3059\u3067\u306bwheel\u30b0\u30eb\u30fc\u30d7\u306b\u7279\u6a29\u304c\u4ed8\u3044\u3066\u3044\u308b\u306f\u305a\u3002\n$ sudo echo \"aaa\"\n[sudo] password for vpsuser: \naaa\n\n$ su      # root\u306b\u306a\u308b\n\u30d1\u30b9\u30ef\u30fc\u30c9: # root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n\n$ su vpsuser # vpsuser\u306b\u623b\u308b\n\n\nSSH\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\u3059\u308b\n$ sudo vim /etc/ssh/sshd_config \n\n\u4ee5\u4e0b\u306e3\u3064\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002vim\u306e\u4f7f\u3044\u65b9\u306f\u3053\u3061\u3089\u304b\u3089\nRSAAuthentication yes\n\nPubkeyAuthentication yes\n\nAuthorizedKeysFile      .ssh/authorized_keys\n\nsshd\u3092\u518d\u8d77\u52d5\n$ sudo systemctl restart sshd.service\n\n\nSSH\u9375\u3092\u4f5c\u6210\n\u30db\u30b9\u30c8\u5074\u3067\u9375\u3092\u4f5c\u6210\n# ~/.ssh \u304c\u306a\u3051\u308c\u3070\u4f5c\u6210\n$ cd ~/\n$ mkdir .ssh\n$ chmod 700 .ssh\n\n# \u9375\u3092\u4f5c\u6210\n$ cd ~/.ssh\n$ ssh-keygen -t rsa -b 2048\nEnter file in which to save the key: conohavps # \u30d5\u30a1\u30a4\u30eb\u540d\u306fconohavps(\u597d\u304d\u306a\u3082\u306e\u3067)\nEnter passphrase:                           # \u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u8a2d\u5b9a\u3000\uff08\u306a\u3057\u3067\u3082\u53ef\uff09\nEnter same passphrase again:                # \u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u3082\u3046\u4e00\u5ea6\n\n# AuthorizedKeysFile\u3067\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u540d\u524d\u5909\u66f4\n$ mv conohavps.pub authorized_keys\n$ chmod 600 authorized_keys\n\n\n\u30ed\u30fc\u30ab\u30ebPC\u306b\u79d8\u5bc6\u9375\u3092\u30b3\u30d4\u30fc\nVPS\u5074\u3067\u9375\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n$ cat conohavps\n\n\u5148\u307b\u3069cat conoha\u3067\u78ba\u8a8d\u3057\u305f\u5185\u5bb9\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u8ffd\u52a0\n$ cd ~/.ssh\n$ vim conohavps\n$ chmod 600 conohavps\n\n\n~/.ssh/ssh_config\u306e\u8a2d\u5b9a\n#ConoHaVPS\nHost conohavps\n  HostName 111.222.333.444\n  User vpsuser\n  Port 22\n  IdentityFile ~/.ssh/conoha\n\n\n\u4f5c\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u3067SSH\u30ea\u30e2\u30fc\u30c8\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\n\u30ed\u30fc\u30ab\u30ebPC\u304b\u3089\u30b3\u30de\u30f3\u30c9\u5165\u529b\n$ ssh conohavps\n\n[vpsuser@111.222.333.444 ~]# \n\n\nroot\u304b\u3089\u306e\u30ed\u30b0\u30a4\u30f3\u3092\u7981\u6b62\n$ sudo vim /etc/ssh/sshd_config \n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092no\u306b\u5909\u66f4\u3059\u308b\nPermitRootLogin no \n\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u3092\u7981\u6b62\n$ sudo vim /etc/ssh/sshd_config \n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092no\u306b\u5909\u66f4\u3059\u308b\nPasswordAuthentication no \n\n\nSSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\nsshd \u3060\u3051\u3067\u306a\u304f firewalld \u306b\u3082\u8a2d\u5b9a\u5909\u66f4\u304c\u5fc5\u8981\u306a\u306e\u3067\u6ce8\u610f\u3002\n\nsshd \u306e\u8a2d\u5b9a\u5909\u66f4\n$ sudo vim /etc/ssh/sshd_config\n\n\u4e0b\u8a18\u8a2d\u5b9a\u3092\u8ffd\u52a0\n#Port 22\nPort 1022 # \u3053\u3061\u3089\u3092\u8ffd\u52a0(\u4eca\u56de\u306f1022\u756a\u306b\u5909\u66f4)\n\nsshd\u3092\u518d\u8d77\u52d5\u3059\u308b\n$ sudo systemctl restart sshd.service\n\n\nfirewalld\u306e\u8a2d\u5b9a\u5909\u66f4\n$sudo vim /etc/firewalld/zone/public.xml\n\n\u4ee5\u4e0b\u8a2d\u5b9a\u306b\u5909\u66f4\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<zone>\n  <short>Public</short>\n  <description>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</description>\n  <service name=\"dhcpv6-client\"/>\n  <service name=\"ssh\"/>\n  <service name=\"mysql\"/>\n  <port protocol=\"tcp\" port=\"1022\"/> # \u30b3\u30b3\u3092\u8ffd\u52a0\n</zone>\n\nfirewalld\u3092\u518d\u8d77\u52d5\u3059\u308b\n$sudo systemctl restart firewalld.service\n\n\n~/.ssh/ssh_config\u306e\u8a2d\u5b9a\n#ConoHaVPS\nHost conohavps\n  HostName 111.222.333.444\n  User vpsuser\n  #Port 22      #\u3053\u3061\u3089\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\n  Port 1022 \u3000\u3000#\u3053\u3061\u3089\u3092\u8ffd\u52a0\n  IdentityFile ~/.ssh/conoha\n\n# ConohaVPS\u306e\u8a2d\u5b9a SSH\u63a5\u7d9a\u3000\u30dd\u30fc\u30c8\u5909\u66f4\u306a\u3069\n\n## Conoha VPS \u306e\u30ec\u30f3\u30bf\u30eb\n\n\u4eca\u56de\u306f\n*Conoha VPS \u30e1\u30e2\u30ea 4G SSD 50G CentOS 7.2(x64)*\n\u3092\u9078\u5b9a\u3057\u307e\u3057\u305f\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-30 10.15.36.png](https://qiita-image-store.s3.amazonaws.com/0/80793/b96689a8-1eb3-7828-04ae-5c2b8de3b46f.png)\n\nConoha\u306e\u30b5\u30fc\u30d0\u30fc\u8ffd\u52a0\u753b\u9762\u306b\u3066\u3001\u6761\u4ef6\u3092\u8a2d\u5b9a\u3057\u53f3\u4e0b\u306e\u8ffd\u52a0\u30dc\u30bf\u30f3\u3067\u7c21\u5358\u306b\u30ec\u30f3\u30bf\u30eb\u3067\u304d\u308b\n\n## IP\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\n\u30ec\u30f3\u30bf\u30eb\u3057\u305fVPS\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-09-30 10.19.32.png](https://qiita-image-store.s3.amazonaws.com/0/80793/31634a16-610a-a235-c3a6-06ade51d8b98.png)\n\n## \u30d1\u30b9\u30ef\u30fc\u30c9\u8a8d\u8a3c\u306b\u3066root\u306b\u30ed\u30b0\u30a4\u30f3\n\u3055\u304d\u307b\u3069\u78ba\u8a8d\u3057\u305fIP\u30a2\u30c9\u30ec\u30b9\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3002\n`111.222.333.444`\u3060\u3063\u305f\u3089`root@111.222.333.444`\n\n```\n$ ssh root@111.222.333.444 -p 22\nroot@111.222.333's password: # \u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\n\n[root@111.222.333.444 ~]# \n```\n\n## \u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n`vpsuser`\u3068\u3044\u3046\u65b0\u3057\u3044\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```\n\n# \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n$ adduser vpsuser \n\n# vpsuser\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u8a2d\u5b9a\n$ passwd vpsuser\n\n# wheel\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n$ gpasswd -a vpsuser wheel\n\n# \u4f5c\u6210\u3057\u305f vpsuser \u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u78ba\u8a8d\n$ su vpsuser\n```\n\n## \u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u304b\u3089sudo\u3084su\u304c\u51fa\u6765\u308b\u3053\u3068\u3092\u78ba\u8a8d\nConoha\u306e\u521d\u671f\u8a2d\u5b9a\u3067\u3059\u3067\u306bwheel\u30b0\u30eb\u30fc\u30d7\u306b\u7279\u6a29\u304c\u4ed8\u3044\u3066\u3044\u308b\u306f\u305a\u3002\n\n```\n$ sudo echo \"aaa\"\n[sudo] password for vpsuser: \naaa\n\n$ su      # root\u306b\u306a\u308b\n\u30d1\u30b9\u30ef\u30fc\u30c9: # root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\n\n$ su vpsuser # vpsuser\u306b\u623b\u308b\n```\n\n## SSH\u30ed\u30b0\u30a4\u30f3\u3092\u8a31\u53ef\u3059\u308b\n\n```\n$ sudo vim /etc/ssh/sshd_config \n```\n\n\u4ee5\u4e0b\u306e3\u3064\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002vim\u306e\u4f7f\u3044\u65b9\u306f[\u3053\u3061\u3089\u304b\u3089](http://qiita.com/honeniq/items/201156650310c4968c3a)\n\n```\nRSAAuthentication yes\n\nPubkeyAuthentication yes\n\nAuthorizedKeysFile      .ssh/authorized_keys\n```\n\nsshd\u3092\u518d\u8d77\u52d5\n\n```\n$ sudo systemctl restart sshd.service\n```\n\n## SSH\u9375\u3092\u4f5c\u6210\n\u30db\u30b9\u30c8\u5074\u3067\u9375\u3092\u4f5c\u6210\n\n```\n# ~/.ssh \u304c\u306a\u3051\u308c\u3070\u4f5c\u6210\n$ cd ~/\n$ mkdir .ssh\n$ chmod 700 .ssh\n\n# \u9375\u3092\u4f5c\u6210\n$ cd ~/.ssh\n$ ssh-keygen -t rsa -b 2048\nEnter file in which to save the key: conohavps # \u30d5\u30a1\u30a4\u30eb\u540d\u306fconohavps(\u597d\u304d\u306a\u3082\u306e\u3067)\nEnter passphrase:                           # \u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u8a2d\u5b9a\u3000\uff08\u306a\u3057\u3067\u3082\u53ef\uff09\nEnter same passphrase again:                # \u30d1\u30b9\u30d5\u30ec\u30fc\u30ba\u3092\u3082\u3046\u4e00\u5ea6\n\n# AuthorizedKeysFile\u3067\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u306b\u540d\u524d\u5909\u66f4\n$ mv conohavps.pub authorized_keys\n$ chmod 600 authorized_keys\n```\n\n## \u30ed\u30fc\u30ab\u30ebPC\u306b\u79d8\u5bc6\u9375\u3092\u30b3\u30d4\u30fc\nVPS\u5074\u3067\u9375\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n\n```\n$ cat conohavps\n```\n\n\u5148\u307b\u3069cat conoha\u3067\u78ba\u8a8d\u3057\u305f\u5185\u5bb9\u3092\u30ed\u30fc\u30ab\u30eb\u306b\u8ffd\u52a0\n\n```\n$ cd ~/.ssh\n$ vim conohavps\n$ chmod 600 conohavps\n```\n\n\n## ~/.ssh/ssh_config\u306e\u8a2d\u5b9a\n\n```\n#ConoHaVPS\nHost conohavps\n  HostName 111.222.333.444\n  User vpsuser\n  Port 22\n  IdentityFile ~/.ssh/conoha\n```\n\n## \u4f5c\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u3067SSH\u30ea\u30e2\u30fc\u30c8\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\n\u30ed\u30fc\u30ab\u30ebPC\u304b\u3089\u30b3\u30de\u30f3\u30c9\u5165\u529b\n\n```\n$ ssh conohavps\n\n[vpsuser@111.222.333.444 ~]# \n```\n\n## root\u304b\u3089\u306e\u30ed\u30b0\u30a4\u30f3\u3092\u7981\u6b62\n\n```\n$ sudo vim /etc/ssh/sshd_config \n````\n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092`no`\u306b\u5909\u66f4\u3059\u308b\n\n```\nPermitRootLogin no \n```\n\n## \u30d1\u30b9\u30ef\u30fc\u30c9\u306b\u3088\u308b\u30ed\u30b0\u30a4\u30f3\u3092\u7981\u6b62\n\n```\n$ sudo vim /etc/ssh/sshd_config \n````\n\n\u4ee5\u4e0b\u306e\u9805\u76ee\u3092`no`\u306b\u5909\u66f4\u3059\u308b\n\n```\nPasswordAuthentication no \n```\n\n## SSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\n\nsshd \u3060\u3051\u3067\u306a\u304f firewalld \u306b\u3082\u8a2d\u5b9a\u5909\u66f4\u304c\u5fc5\u8981\u306a\u306e\u3067\u6ce8\u610f\u3002\n\n### sshd \u306e\u8a2d\u5b9a\u5909\u66f4\n\n```\n$ sudo vim /etc/ssh/sshd_config\n```\n\n\u4e0b\u8a18\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n```\n#Port 22\nPort 1022 # \u3053\u3061\u3089\u3092\u8ffd\u52a0(\u4eca\u56de\u306f1022\u756a\u306b\u5909\u66f4)\n```\n\nsshd\u3092\u518d\u8d77\u52d5\u3059\u308b\n\n```\n$ sudo systemctl restart sshd.service\n```\n\n\n### firewalld\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\n```\n$sudo vim /etc/firewalld/zone/public.xml\n```\n\n\u4ee5\u4e0b\u8a2d\u5b9a\u306b\u5909\u66f4\n\n```\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<zone>\n  <short>Public</short>\n  <description>For use in public areas. You do not trust the other computers on networks to not harm your computer. Only selected incoming connections are accepted.</description>\n  <service name=\"dhcpv6-client\"/>\n  <service name=\"ssh\"/>\n  <service name=\"mysql\"/>\n  <port protocol=\"tcp\" port=\"1022\"/> # \u30b3\u30b3\u3092\u8ffd\u52a0\n</zone>\n```\n\nfirewalld\u3092\u518d\u8d77\u52d5\u3059\u308b\n\n```\n$sudo systemctl restart firewalld.service\n```\n\n### ~/.ssh/ssh_config\u306e\u8a2d\u5b9a\n\n```\n#ConoHaVPS\nHost conohavps\n  HostName 111.222.333.444\n  User vpsuser\n  #Port 22      #\u3053\u3061\u3089\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3066\n  Port 1022 \u3000\u3000#\u3053\u3061\u3089\u3092\u8ffd\u52a0\n  IdentityFile ~/.ssh/conoha\n```\n"}