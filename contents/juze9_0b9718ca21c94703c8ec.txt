{"context": "\n\n\u3084\u308b\u3053\u3068\n\nUbuntu 16.04\uff08\u56fa\u5b9aIP\uff09\n\n\nKVM\uff08\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\uff09\nLXD\uff08\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u30fb\u56fa\u5b9aIP\uff09\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUEFI\u306e\u5834\u5408\u3001\u4e8b\u524d\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u308b\u3002KVM\u4e0a\u3067\u8a66\u3059\u3068\u304d\u306bUEFI\u306e\u5834\u5408\u306fEFI/ubuntu/grubx64.efi\u3092EFI/BOOT/BOOTX64.EFI\u3078\u30b3\u30d4\u30fc\u3002\n\u30db\u30b9\u30c8\u540d\u306f\u6700\u521d\u304b\u3089\u8a2d\u5b9a\u3057\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u3068\u308a\u3042\u3048\u305atest\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u82f1\u8a9e\u5316\n$ LANG=C xdg-user-dirs-gtk-update\n\n\nNetworkManager\u3092\u7121\u52b9\u5316\n# NetworkManager\u304c\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n$ sudo nano /etc/init/network-manager.conf\n\n#start on (local-filesystems\n#          and started dbus\n#          and static-network-up)\n\n\nIP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\n\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n# \u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u540d\u3092\u8abf\u3079\u308b\uff08\u4e0b\u8a18\u306e<xxx>\uff09\n$ ip a\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\n$ sudo nano /etc/network/interfaces\nauto lo\niface lo inet loopback\n\nauto <xxx>\niface <xxx> inet static\n  address 192.168.1.<nnn>\n  netmask 255.255.255.0\n  gateway 192.168.1.1\n  dns-nameservers 192.168.1.1\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n\n\n\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\n# \u4eee\u60f3\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u308b\u305f\u3081\u306bbridge-utils\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y bridge-utils\n\n# \u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u540d\u3092\u8abf\u3079\u308b\uff08\u4e0b\u8a18\u306e<xxx>\uff09\n$ ip a\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\n$ sudo nano /etc/network/interfaces\nauto lo br0\niface lo inet loopback\n\niface <xxx> inet manual\n\niface br0 inet static\n    address 192.168.1.<nnn>\n    netmask 255.255.255.0\n    gateway 192.168.1.1\n    dns-nameservers 192.168.1.1\n    bridge_ports xxx\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n\n\nNetworkManager\u3092\u524a\u9664\n$ sudo apt-get purge -y network-manager\n\n\nKVM\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u5404\u7a2e\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y qemu-kvm libvirt-bin virt-manager ovmf\n\n# \u64cd\u4f5c\u3057\u305f\u3044\u30e6\u30fc\u30b6\u30fc\u3092libvirtd\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n$ sudo gpasswd -a <user> libvirtd\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n\n# libvirt-bin\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\n$ sudo /etc/init.d/libvirt-bin status\n\n\nKVM\u3092\u7ba1\u7406\n# \u57fa\u672c\u7684\u306bvirt-manager\uff08\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\uff09\u3067\u64cd\u4f5c\u3059\u308b\u304cUUID\u3092\u5909\u3048\u305f\u3044\u5834\u5408\n# \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\n$ sudo virsh list --all\n\n# \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8a2d\u5b9a(XML)\u3092\u30c0\u30f3\u30d7\n$ sudo virsh dumpxml xxx > domain.xml\n\n# \u4eee\u60f3\u30de\u30b7\u30f3\u3092\u7ba1\u7406\u5bfe\u8c61\u304b\u3089\u5916\u3059\n$ sudo virsh undefine xxx\n\n# XML\u3092\u76f4\u63a5\u7de8\u96c6\u3057\u3066UUID\u3092\u5909\u66f4\n$ sudo nano domain.xml\n\n# XML\u3092\u767b\u9332\n$ sudo virsh define domain.xml\n\n\nLXD\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u30d0\u30c3\u30af\u30dd\u30fc\u30c8\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y -t xenial-backports lxd\n\n# \u521d\u671f\u8a2d\u5b9a\n$ sudo lxd init\n\n# \u30d6\u30ea\u30c3\u30b8\u3092\u69cb\u6210\n$ sudo lxc profile device set default eth0 parent br0\n\n\nLXD\u3092\u7ba1\u7406\n# \u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\n$ sudo lxc init ubuntu:16.04 <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\n$ sudo lxc start <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\n$ sudo lxc list\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\n$ sudo lxc exec <container> -- sh -c 'echo \"network: {config: disabled}\" > /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg'\n$ sudo lxc exec <container> -- cat /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg\nnetwork: {config: disabled}\n\n$ address='192.168.1.<nnn>' &&\n$ netmask='255.255.255.0' &&\n$ gateway='192.168.1.1' &&\n$ dns_nameservers='192.168.1.1' &&\n$ cfg=\"auto lo\\niface lo inet loopback\\n\\nauto eth0\\niface eth0 inet static\\n\\taddress $address\\n\\tnetmask $netmask\\n\\tgateway $gateway\\n\\tdns-nameservers $dns_nameservers\" &&\n$ sudo lxc exec <container> -- sh -c \"echo '$cfg' > /etc/network/interfaces.d/50-cloud-init.cfg\"\n$ sudo lxc exec <container> -- cat /etc/network/interfaces.d/50-cloud-init.cfg\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\n    address 192.168.1.<nnn>\n    netmask 255.255.255.0\n    gateway 192.168.1.1\n    dns-nameservers 192.168.1.1\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308b\n$ sudo lxc exec <container> bash\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u304b\u3089\u51fa\u308b\n# exit\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\n$ sudo lxc stop <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\n$ sudo lxc delete <container>\n\n# \u3084\u308b\u3053\u3068\n* Ubuntu 16.04\uff08\u56fa\u5b9aIP\uff09\n    * KVM\uff08\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\uff09\n    * LXD\uff08\u30d6\u30ea\u30c3\u30b8\u63a5\u7d9a\u30fb\u56fa\u5b9aIP\uff09\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUEFI\u306e\u5834\u5408\u3001\u4e8b\u524d\u306b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u308b\u3002KVM\u4e0a\u3067\u8a66\u3059\u3068\u304d\u306bUEFI\u306e\u5834\u5408\u306fEFI/ubuntu/grubx64.efi\u3092EFI/BOOT/BOOTX64.EFI\u3078\u30b3\u30d4\u30fc\u3002\n\n\u30db\u30b9\u30c8\u540d\u306f\u6700\u521d\u304b\u3089\u8a2d\u5b9a\u3057\u3001\u30e6\u30fc\u30b6\u30fc\u306f\u3068\u308a\u3042\u3048\u305atest\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\u3002\n\n## \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u82f1\u8a9e\u5316\n```\n$ LANG=C xdg-user-dirs-gtk-update\n```\n\n## NetworkManager\u3092\u7121\u52b9\u5316\n```\n# NetworkManager\u304c\u8d77\u52d5\u3057\u306a\u3044\u3088\u3046\u306b\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\n$ sudo nano /etc/init/network-manager.conf\n\n#start on (local-filesystems\n#          and started dbus\n#          and static-network-up)\n```\n\n## IP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\n\u3053\u306e\u624b\u9806\u3092\u98db\u3070\u3057\u3066\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\n```\n# \u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u540d\u3092\u8abf\u3079\u308b\uff08\u4e0b\u8a18\u306e<xxx>\uff09\n$ ip a\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\n$ sudo nano /etc/network/interfaces\nauto lo\niface lo inet loopback\n\nauto <xxx>\niface <xxx> inet static\n  address 192.168.1.<nnn>\n  netmask 255.255.255.0\n  gateway 192.168.1.1\n  dns-nameservers 192.168.1.1\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n```\n\n## \u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u6210\n```\n# \u4eee\u60f3\u30d6\u30ea\u30c3\u30b8\u3092\u4f5c\u308b\u305f\u3081\u306bbridge-utils\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y bridge-utils\n\n# \u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30c7\u30d0\u30a4\u30b9\u540d\u3092\u8abf\u3079\u308b\uff08\u4e0b\u8a18\u306e<xxx>\uff09\n$ ip a\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u5909\u66f4\n$ sudo nano /etc/network/interfaces\nauto lo br0\niface lo inet loopback\n\niface <xxx> inet manual\n\niface br0 inet static\n\taddress 192.168.1.<nnn>\n\tnetmask 255.255.255.0\n\tgateway 192.168.1.1\n\tdns-nameservers 192.168.1.1\n\tbridge_ports xxx\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n```\n\n## NetworkManager\u3092\u524a\u9664\n```\n$ sudo apt-get purge -y network-manager\n```\n\n# KVM\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n# \u5404\u7a2e\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y qemu-kvm libvirt-bin virt-manager ovmf\n\n# \u64cd\u4f5c\u3057\u305f\u3044\u30e6\u30fc\u30b6\u30fc\u3092libvirtd\u30b0\u30eb\u30fc\u30d7\u306b\u8ffd\u52a0\n$ sudo gpasswd -a <user> libvirtd\n\n# \u518d\u8d77\u52d5\n$ sudo shutdown -r now\n\n# libvirt-bin\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\n$ sudo /etc/init.d/libvirt-bin status\n```\n\n# KVM\u3092\u7ba1\u7406\n```\n# \u57fa\u672c\u7684\u306bvirt-manager\uff08\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\uff09\u3067\u64cd\u4f5c\u3059\u308b\u304cUUID\u3092\u5909\u3048\u305f\u3044\u5834\u5408\n# \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\n$ sudo virsh list --all\n\n# \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8a2d\u5b9a(XML)\u3092\u30c0\u30f3\u30d7\n$ sudo virsh dumpxml xxx > domain.xml\n\n# \u4eee\u60f3\u30de\u30b7\u30f3\u3092\u7ba1\u7406\u5bfe\u8c61\u304b\u3089\u5916\u3059\n$ sudo virsh undefine xxx\n\n# XML\u3092\u76f4\u63a5\u7de8\u96c6\u3057\u3066UUID\u3092\u5909\u66f4\n$ sudo nano domain.xml\n\n# XML\u3092\u767b\u9332\n$ sudo virsh define domain.xml\n```\n\n# LXD\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n# \u30d0\u30c3\u30af\u30dd\u30fc\u30c8\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install -y -t xenial-backports lxd\n\n# \u521d\u671f\u8a2d\u5b9a\n$ sudo lxd init\n\n# \u30d6\u30ea\u30c3\u30b8\u3092\u69cb\u6210\n$ sudo lxc profile device set default eth0 parent br0\n```\n\n# LXD\u3092\u7ba1\u7406\n```\n# \u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\n$ sudo lxc init ubuntu:16.04 <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\n$ sudo lxc start <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\n$ sudo lxc list\n\n# IP\u30a2\u30c9\u30ec\u30b9\u3092\u56fa\u5b9a\n$ sudo lxc exec <container> -- sh -c 'echo \"network: {config: disabled}\" > /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg'\n$ sudo lxc exec <container> -- cat /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg\nnetwork: {config: disabled}\n\n$ address='192.168.1.<nnn>' &&\n$ netmask='255.255.255.0' &&\n$ gateway='192.168.1.1' &&\n$ dns_nameservers='192.168.1.1' &&\n$ cfg=\"auto lo\\niface lo inet loopback\\n\\nauto eth0\\niface eth0 inet static\\n\\taddress $address\\n\\tnetmask $netmask\\n\\tgateway $gateway\\n\\tdns-nameservers $dns_nameservers\" &&\n$ sudo lxc exec <container> -- sh -c \"echo '$cfg' > /etc/network/interfaces.d/50-cloud-init.cfg\"\n$ sudo lxc exec <container> -- cat /etc/network/interfaces.d/50-cloud-init.cfg\nauto lo\niface lo inet loopback\n\nauto eth0\niface eth0 inet static\n\taddress 192.168.1.<nnn>\n\tnetmask 255.255.255.0\n\tgateway 192.168.1.1\n\tdns-nameservers 192.168.1.1\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u306b\u5165\u308b\n$ sudo lxc exec <container> bash\n\n# \u30b3\u30f3\u30c6\u30ca\u306e\u4e2d\u304b\u3089\u51fa\u308b\n# exit\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\n$ sudo lxc stop <container>\n\n# \u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\n$ sudo lxc delete <container>\n```\n", "tags": ["Ubuntu", "KVM", "lxd"]}