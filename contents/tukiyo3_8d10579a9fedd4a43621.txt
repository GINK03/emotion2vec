{"context": " More than 1 year has passed since last update.\n\n\u53c2\u8003\n\nActiveRecord\u5165\u9580 - Qiita\n\n\n\u521d\u671fdatabase\u4f5c\u6210\n\nimport.sql\ncreate table posts(\n    id integer primary key,\n    title text,\n    body text, \n    created_at,\n    updated_at\n);\n\n\n\n\u6295\u5165\nsqlite3 blog.db \".read import.sql\"\n\n\n\n\u78ba\u8a8d\nsqlite3 blog.db \".schema posts\"\n\n\n\ndatabase\u306b\u66f8\u304d\u8fbc\u307f\n\nmain.rb\nrequire 'active_record'\nActiveRecord::Base.establish_connection(\n    \"adapter\" =>\"sqlite3\",\n    \"database\" => \"./blog.db\"\n)\nclass Post < ActiveRecord::Base\nend\n\npost = Post.new(:title => \"title1\",:body => \"hello\" )\npost.save\np Post.all\n\n\n\nblog.db\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\nsqlite3 blog.db \"select * from posts\"\n\n\n\n\u691c\u7d22\n\nfind\np Post.all  #\u5168\u53d6\u5f97\np Post.first  #\u5148\u982d\u306e\u30ec\u30b3\u30fc\u30c9\np Post.last.title  #\u6700\u5f8c\u306e\u30ec\u30b3\u30fc\u30c9\u306etitle\u5024\np Post.find(2)  #id=2\np Post.find_by_title(\"title2\") #title\u691c\u7d22\u3002\u6700\u521d\u306b\u30d2\u30c3\u30c8\u3057\u305f\u3082\u306e\u3067\u8fd4\u3059\np Post.find_by_title_and_id(\"title2\",2) #title\u3068id\u3067\u691c\u7d22\n\n\n\nwhere\np Post.where(:title => \"title1\", :id => 1)\np Post.where(\":title = ? and id = ?\", \"title1\",1)\np Post.where(\":title = :title and id = :id\",{:title => \"title1\",:id => 1})\np Post.where(\"body like ?\", \"hello%\")\np Post.where(:id => 1..3) #1\u304b\u30893\u3092\u53d6\u5f97\np Post.where(:id => [1,3]) #1\u30683\u3092\u53d6\u5f97\n\n\n\nwhere\u3067scope\u3092\u4f7f\u3046\nclass Post < ActiveRecord::Base\n    scope :top3,->{order(\"created_at\").limit(3)}\nend\np Post.top3\np Post.order(\"id desc\").limit(3)\n\n\n\nsql\u3092\u8868\u793a\nclass Post < ActiveRecord::Base\nend\nPost.logger = Logger.new(STDOUT) #\u6a19\u6e96\u51fa\u529b\nPost.logger = Logger.new(\"query.log\") #\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\np Post.order(\"id desc\").limit(3)\n\n\n\nfirst_or_create(\u62bd\u51fa\u7d50\u679c\u304c\u306a\u304b\u3063\u305f\u3089\u30ec\u30b3\u30fc\u30c9\u306e\u65b0\u898f\u4f5c\u6210)\np Post.where(:title => \"title4\").first_or_create\nPost.where(:title => \"title6\").first_or_create do |p|\n    p.body = \"hello6\"\nend\n\n\nupdate\npost = Post.find(1)\npost.update_attribute(:title,\"(new2)title\")\npost.update_attributes(:title=>\"(new2)title\",:body=>\"\")\n\nPost.where(:id => 1..2).update_all(:title =>\"\",:body => \"\")\n\n\ndelete\nPost.where(:id =>1..2).delete_all\nPost.find(3).destroy\n\n\nsave\u6642\u306bvalidation\nclass Post < ActiveRecord::Base\n    validates :title, :presence => true #\u5fc5\u9808\n    validates :body, :length => {:minimum => 5} #5\u6587\u5b57\u4ee5\u4e0a\nend\n\npost = Post.new(:title => \"title\",:body => \"abc\" )\npost.save\n\nif !post.save\n  p post.errors.messages\nend\n\n\n\u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3(\u95a2\u9023\u3059\u308b\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u3066\u6271\u3046)\n\nimport.sql\ncreate table posts( \n    id integer primary key,\n    title text,\n    body text,\n    created_at,\n    updated_at\n);\ninsert into posts(id,title,body) values (1,\"title1\",\"\u672c\u65871\");\ninsert into posts(id,title,body) values (2,\"title2\",\"\u672c\u65872\");\ninsert into posts(id,title,body) values (3,\"title3\",\"\u672c\u65873\");\n\n\ndrop table if exists comments;\ncreate table comments( \n    id integer primary key,\n    post_id integer,\n    title text,\n    body text,\n    created_at,\n    updated_at\n);\ninsert into comments(id,post_id,body) values (1,1,\"\u30b3\u30e1\u30f3\u30c81\");\ninsert into comments(id,post_id,body) values (2,1,\"\u30b3\u30e1\u30f3\u30c82\");\ninsert into comments(id,post_id,body) values (3,2,\"\u30b3\u30e1\u30f3\u30c83\");\ninsert into comments(id,post_id,body) values (4,2,\"\u30b3\u30e1\u30f3\u30c84\");\ninsert into comments(id,post_id,body) values (5,3,\"\u30b3\u30e1\u30f3\u30c85\");\ninsert into comments(id,post_id,body) values (6,3,\"\u30b3\u30e1\u30f3\u30c86\");\n\n\n\nblog.db\u3092\u4f5c\u6210\nsqlite3 blog.db \".read import.sql\"\n\n\n\nmain.rb\nrequire 'active_record'\nActiveRecord::Base.establish_connection(\n    \"adapter\" =>\"sqlite3\",\n    \"database\" => \"./blog.db\"\n)\n#post\u3068comments\u306e\u95a2\u4fc2\u304c\u4e00\u5bfe\u591a\nclass Post < ActiveRecord::Base \n    has_many :comment\nend\nclass Comment < ActiveRecord::Base \n    belongs_to :post\nend\n\npost = Post.find(1)\npost.comment.each do |comment|\n    p comment.body\nend\n\n\n\n\u5b9f\u884c\n$ ruby main.rb \n\"\u30b3\u30e1\u30f3\u30c81\"\n\"\u30b3\u30e1\u30f3\u30c82\"\n\n\n\npost\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u524a\u9664\u3059\u308b\u3068comment\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3082\u524a\u9664\n\nmain.rb\n  class Post < ActiveRecord::Base\n-   has_many :comment\n+   has_many :comment, :dependent => :destroy\n  end\n  class Comment < ActiveRecord::Base\n    belongs_to :post\n  end\n\n  p Post.find(1)\n+ Post.find(1).destroy\n\n\n\nid=1,2\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u6d88\u3048\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ sqlite3 blog.db \"select * from comments\"\n3|2||\u30b3\u30e1\u30f3\u30c83||\n4|2||\u30b3\u30e1\u30f3\u30c84||\n5|3||\u30b3\u30e1\u30f3\u30c85||\n6|3||\u30b3\u30e1\u30f3\u30c86||\n\n\n## \u53c2\u8003\n\n* [ActiveRecord\u5165\u9580 - Qiita](http://qiita.com/kimioka0/items/8c10e01def23fdbf3aa6)\n\n## \u521d\u671fdatabase\u4f5c\u6210\n\n```sql:import.sql \ncreate table posts(\n    id integer primary key,\n    title text,\n    body text, \n    created_at,\n    updated_at\n);\n```\n\n```bash:\u6295\u5165\nsqlite3 blog.db \".read import.sql\"\n```\n\n```bash:\u78ba\u8a8d\nsqlite3 blog.db \".schema posts\"\n```\n\n## database\u306b\u66f8\u304d\u8fbc\u307f\n\n```rb:main.rb\nrequire 'active_record'\nActiveRecord::Base.establish_connection(\n    \"adapter\" =>\"sqlite3\",\n    \"database\" => \"./blog.db\"\n)\nclass Post < ActiveRecord::Base\nend\n\npost = Post.new(:title => \"title1\",:body => \"hello\" )\npost.save\np Post.all\n```\n\n```bash:blog.db\u306e\u4e2d\u8eab\u3092\u78ba\u8a8d\nsqlite3 blog.db \"select * from posts\"\n```\n\n## \u691c\u7d22\n\n```rb:find\np Post.all  #\u5168\u53d6\u5f97\np Post.first  #\u5148\u982d\u306e\u30ec\u30b3\u30fc\u30c9\np Post.last.title  #\u6700\u5f8c\u306e\u30ec\u30b3\u30fc\u30c9\u306etitle\u5024\np Post.find(2)  #id=2\np Post.find_by_title(\"title2\") #title\u691c\u7d22\u3002\u6700\u521d\u306b\u30d2\u30c3\u30c8\u3057\u305f\u3082\u306e\u3067\u8fd4\u3059\np Post.find_by_title_and_id(\"title2\",2) #title\u3068id\u3067\u691c\u7d22\n```\n\n```rb:where\np Post.where(:title => \"title1\", :id => 1)\np Post.where(\":title = ? and id = ?\", \"title1\",1)\np Post.where(\":title = :title and id = :id\",{:title => \"title1\",:id => 1})\np Post.where(\"body like ?\", \"hello%\")\np Post.where(:id => 1..3) #1\u304b\u30893\u3092\u53d6\u5f97\np Post.where(:id => [1,3]) #1\u30683\u3092\u53d6\u5f97\n```\n\n```rb:where\u3067scope\u3092\u4f7f\u3046\nclass Post < ActiveRecord::Base\n    scope :top3,->{order(\"created_at\").limit(3)}\nend\np Post.top3\np Post.order(\"id desc\").limit(3)\n```\n\n```rb:sql\u3092\u8868\u793a\nclass Post < ActiveRecord::Base\nend\nPost.logger = Logger.new(STDOUT) #\u6a19\u6e96\u51fa\u529b\nPost.logger = Logger.new(\"query.log\") #\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\np Post.order(\"id desc\").limit(3)\n```\n\n## first_or_create(\u62bd\u51fa\u7d50\u679c\u304c\u306a\u304b\u3063\u305f\u3089\u30ec\u30b3\u30fc\u30c9\u306e\u65b0\u898f\u4f5c\u6210)\n\n```rb:\np Post.where(:title => \"title4\").first_or_create\nPost.where(:title => \"title6\").first_or_create do |p|\n    p.body = \"hello6\"\nend\n```\n\n## update\n\n```rb:\npost = Post.find(1)\npost.update_attribute(:title,\"(new2)title\")\npost.update_attributes(:title=>\"(new2)title\",:body=>\"\")\n\nPost.where(:id => 1..2).update_all(:title =>\"\",:body => \"\")\n```\n\n## delete\n\n```rb:\nPost.where(:id =>1..2).delete_all\nPost.find(3).destroy\n```\n\n## save\u6642\u306bvalidation\n\n```rb:\nclass Post < ActiveRecord::Base\n    validates :title, :presence => true #\u5fc5\u9808\n    validates :body, :length => {:minimum => 5} #5\u6587\u5b57\u4ee5\u4e0a\nend\n\npost = Post.new(:title => \"title\",:body => \"abc\" )\npost.save\n\nif !post.save\n  p post.errors.messages\nend\n```\n\n## \u30a2\u30bd\u30b7\u30a8\u30fc\u30b7\u30e7\u30f3(\u95a2\u9023\u3059\u308b\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u3066\u6271\u3046)\n\n```sql:import.sql\ncreate table posts( \n    id integer primary key,\n    title text,\n    body text,\n    created_at,\n    updated_at\n);\ninsert into posts(id,title,body) values (1,\"title1\",\"\u672c\u65871\");\ninsert into posts(id,title,body) values (2,\"title2\",\"\u672c\u65872\");\ninsert into posts(id,title,body) values (3,\"title3\",\"\u672c\u65873\");\n\n\ndrop table if exists comments;\ncreate table comments( \n    id integer primary key,\n    post_id integer,\n    title text,\n    body text,\n    created_at,\n    updated_at\n);\ninsert into comments(id,post_id,body) values (1,1,\"\u30b3\u30e1\u30f3\u30c81\");\ninsert into comments(id,post_id,body) values (2,1,\"\u30b3\u30e1\u30f3\u30c82\");\ninsert into comments(id,post_id,body) values (3,2,\"\u30b3\u30e1\u30f3\u30c83\");\ninsert into comments(id,post_id,body) values (4,2,\"\u30b3\u30e1\u30f3\u30c84\");\ninsert into comments(id,post_id,body) values (5,3,\"\u30b3\u30e1\u30f3\u30c85\");\ninsert into comments(id,post_id,body) values (6,3,\"\u30b3\u30e1\u30f3\u30c86\");\n```\n\n```bash:blog.db\u3092\u4f5c\u6210\nsqlite3 blog.db \".read import.sql\"\n```\n\n```rb:main.rb\nrequire 'active_record'\nActiveRecord::Base.establish_connection(\n    \"adapter\" =>\"sqlite3\",\n    \"database\" => \"./blog.db\"\n)\n#post\u3068comments\u306e\u95a2\u4fc2\u304c\u4e00\u5bfe\u591a\nclass Post < ActiveRecord::Base \n    has_many :comment\nend\nclass Comment < ActiveRecord::Base \n    belongs_to :post\nend\n\npost = Post.find(1)\npost.comment.each do |comment|\n    p comment.body\nend\n```\n\n```bash:\u5b9f\u884c\n$ ruby main.rb \n\"\u30b3\u30e1\u30f3\u30c81\"\n\"\u30b3\u30e1\u30f3\u30c82\"\n```\n\n### post\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u524a\u9664\u3059\u308b\u3068comment\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3082\u524a\u9664\n\n```diff:main.rb\n  class Post < ActiveRecord::Base\n-   has_many :comment\n+   has_many :comment, :dependent => :destroy\n  end\n  class Comment < ActiveRecord::Base\n    belongs_to :post\n  end\n\n  p Post.find(1)\n+ Post.find(1).destroy\n```\n\n```sh:id=1,2\u306e\u30ec\u30b3\u30fc\u30c9\u304c\u6d88\u3048\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ sqlite3 blog.db \"select * from comments\"\n3|2||\u30b3\u30e1\u30f3\u30c83||\n4|2||\u30b3\u30e1\u30f3\u30c84||\n5|3||\u30b3\u30e1\u30f3\u30c85||\n6|3||\u30b3\u30e1\u30f3\u30c86||\n```\n", "tags": ["ActiveRecord"]}