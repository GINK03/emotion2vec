{"context": "\n\n\u524d\u63d0\u6761\u4ef6\n\nEC2\u3078\u306e\u6a29\u9650\nEC2\u3001ECS\u3001AWS Batch \u306a\u3069\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n0. \u6e96\u5099\n\n0.1. AWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.11.36\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n aws-cli/1.11.36 Python/2.7.5 Darwin/13.4.0 botocore/1.4.93\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo -H pip install -U awscli\n\n\n\n0.2. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\nJAWS-UG CLI \u652f\u90e8\u3067\u306f\u300cUS-EAST-1\u300d\u306f\u975e\u63a8\u5968\u3067\u3059\u304c\u30012017 \u5e74 1 \u6708\u73fe\u5728\u3001AWS Batch \u304c GA \u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u3053\u3053\u3060\u3051\u306a\u306e\u3067\u3001\u4eca\u65e5\u3060\u3051\u3001\u4eca\u65e5\u3060\u3051\u3001\u3068\u5ff5\u3058\u3066\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='us-east-1'\n\n\n\n0.3. \u8cc7\u683c\u60c5\u5831\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                  default           manual    --profile\naccess_key     ****************XXXX shared-credentials-file    \nsecret_key     ****************XXXX shared-credentials-file    \n    region                us-east-1              env    AWS_DEFAULT_REGION\n\n\n\n0.4. AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u5c5e\u6027\nEC2-Classic \u304c\u898b\u3048\u306a\u3044 AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u3042\u308b\u3053\u3068\u3002\n\n\u30b3\u30de\u30f3\u30c9\nAWS_SUPPORT_PLATFORMS=$( \\\n         aws ec2 describe-account-attributes \\\n           --query 'AccountAttributes[?AttributeName == `supported-platforms`].AttributeValues[].AttributeValue' \\\n           --output text \\\n) && echo ${AWS_SUPPORT_PLATFORMS}\n\n\n\n\u7d50\u679c\n VPC\n\n\n\u6ce8\u91c8: VPC \u306e\u4ed6\u306b EC2 \u304c\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u3001\u5225\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n0.5. VPC / IAM \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\nCloudFormation \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\n\n\u30b3\u30de\u30f3\u30c9\nCFN_STACK_NAME=\"aws-batch-`date +%s`\"\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\ncurl --location --output ${CFN_STACK_NAME}.yaml \\\n  https://raw.githubusercontent.com/supinf/aws-batch-refarch/master/cloudformation/base.yaml\n\n\nCloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws cloudformation create-stack \\\n  --stack-name ${CFN_STACK_NAME} \\\n  --template-body file://${CFN_STACK_NAME}.yaml \\\n  --capabilities CAPABILITY_IAM\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"StackId\": \"arn:aws:cloudformation:us-east-1:xxxxxxxxxxxx:stack/aws-batch-xxxxxxxxxx/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n\n\n\u3053\u306e\u30b9\u30bf\u30c3\u30af\u306b\u3088\u308a\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\nAWS Batch \u7528 VPC\nAWS Batch \u7528\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\nSpotFleet \u7528\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\n\n0.6. EC2 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u53c2\u8003\u306b\u30ad\u30fc\u30da\u30a2\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u305f\u3060\u3057 AWS_DEFAULT_REGION \u306f us-east-1 \u306e\u307e\u307e\u3067\u30fb\u30fb\n[JAWS-UG CLI] EC2:#1 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210 (\u65b0\u898f)\n\u30ad\u30fc\u30da\u30a2\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n  --key-names ${EC2_KEY_NAME}\n\n\n\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u30da\u30a2\u306e\u60c5\u5831\u304c\u8fd4\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"KeyPairs\": [\n        {\n            \"KeyName\": \"your-keypair-name\", \n            \"KeyFingerprint\": \"xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx\"\n        }\n    ]\n}\n\n\n\n0.7. jq \u3084 jsonlint \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u65b0\u306e aws-cli \u306b\u306f jp.py \u304c\u5165\u3063\u3066\u3044\u306a\u3044\u6c17\u304c\u3057\u307e\u3059\u30fb\u30fb\n\u3068\u3044\u3046\u308f\u3051\u3067 jq \u3068 jsonlint \u3092\u305d\u308c\u305e\u308c\u5165\u308c\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n1. \u30af\u30e9\u30b9\u30bf\u8d77\u52d5\n\n1.1. \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u540d\u306e\u6307\u5b9a\n\u74b0\u5883\u540d\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nCOMPUTE_ENV_NAME=\"aws-batch-unmanaged-`date +%s`\"\n\n\n\u540c\u540d\u306e\u74b0\u5883\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws batch describe-compute-environments \\\n  --compute-environments ${COMPUTE_ENV_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"computeEnvironments\": []\n}\n\n\n\n1.2. \u5229\u7528\u3059\u308b VPC / IAM \u306e\u5909\u6570\u5b9a\u7fa9\n\u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\u3092\u5f85\u6a5f\n\n\u30b3\u30de\u30f3\u30c9\naws cloudformation wait stack-create-complete \\\n  --stack-name ${CFN_STACK_NAME}\n\n\n\n\u7d50\u679c\n\u8fd4\u308a\u5024\u306a\u3057\n\n\n\u751f\u6210\u7d50\u679c\u3092\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nCFN_STACK_RESULT=$( aws cloudformation describe-stacks \\\n  --stack-name ${CFN_STACK_NAME} \\\n) && echo ${CFN_STACK_RESULT} | jq .\n\n\n\u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\u7d50\u679c\uff08Output\uff09\u304b\u3089\u3001\u5f8c\u304b\u3089\u5fc5\u8981\u306b\u306a\u308b\u5909\u6570\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nBATCH_SERVICE_ROLE=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"AWSBatchServiceRole\").OutputValue' )\n\nEC2_INSTANCE_PROFILE=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"BatchInstanceProfile\").OutputValue' )\n\nVPC_SUBNET_1=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"PublicSubnet1\").OutputValue' )\n\nVPC_SUBNET_2=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"PublicSubnet2\").OutputValue' )\n\nVPC_SECURITY_GROUP=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"SecurityGroup\").OutputValue' )\n\n\n\n\n1.3. \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u306e\u4f5c\u6210\nAWS Batch \u3067\u306f\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u3068\u3057\u3066 MANAGED \u307e\u305f\u306f UNMANAGED \u304c\u9078\u629e\u3067\u304d\u307e\u3059\u3002\nMANAGED \u3092\u9078\u629e\u3059\u308b\u3068\u3001ECS \u30af\u30e9\u30b9\u30bf\u3082\u8d77\u52d5\u3057\u3066\u304f\u308c\u308b\u30bf\u30a4\u30d7\u3001\nUNMANAGED \u306f\u81ea\u5206\u3067 ECS \u30af\u30e9\u30b9\u30bf\u3092\u7528\u610f\u3059\u308b\u30bf\u30a4\u30d7\u3067\u3059\u3002\n\u4eca\u56de\u306f UNMANAGED \u306a\u74b0\u5883\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws batch create-compute-environment \\\n  --compute-environment-name ${COMPUTE_ENV_NAME} \\\n  --type UNMANAGED \\\n  --service-role ${BATCH_SERVICE_ROLE}\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"computeEnvironmentName\": \"aws-batch-unmanaged-xxxxxxxxxx\", \n    \"computeEnvironmentArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-refarch\"\n}\n\n\n\n1.4. ECS \u30af\u30e9\u30b9\u30bf ARN \u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u74b0\u5883\u306e status \u304c VALID\u3001\nstate \u304c ENABLED \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\nstatus \u304c CREATING \u3067\u3042\u308b\u5834\u5408 VALID \u306b\u306a\u308b\u307e\u3067\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u30fb\u30fb\n\n\u30b3\u30de\u30f3\u30c9\nCOMPUTE_ENV=$( aws batch describe-compute-environments \\\n  --compute-environments ${COMPUTE_ENV_NAME} \\\n) && echo ${COMPUTE_ENV} | jq .\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n  \"computeEnvironments\": [\n    {\n      \"status\": \"VALID\",\n      \"serviceRole\": \"arn:aws:iam::xxxxxxxxxxxx:role/service-role/aws-batch-xxxxxxxxxx-AWSBatchServiceRole-xxxxxxxxxxxx\", \n      \"computeEnvironmentArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-unmanaged-xxxxxxxxxx\",\n      \"statusReason\": \"ComputeEnvironment Healthy\",\n      \"ecsClusterArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/aws-batch-unmanaged-xxxxxxxxxx_Batch_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\", \n      \"state\": \"ENABLED\",\n      \"computeEnvironmentName\": \"aws-batch-unmanaged-xxxxxxxxxx\",\n      \"type\": \"UNMANAGED\"\n    }\n  ]\n}\n\n\n\n2. ECS \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n\n2.1. \u30af\u30e9\u30b9\u30bf\u306e\u305f\u3081\u306e\u5909\u6570\u78ba\u8a8d\nECS \u30af\u30e9\u30b9\u30bf ARN \u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\nECS_ARN=$( echo ${COMPUTE_ENV} | jq -r \\\n  '.computeEnvironments[0].ecsClusterArn' )\n\n\n\u3053\u306e\u30af\u30e9\u30b9\u30bf\u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u5909\u6570\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    VPC_SUBNET_1:         ${VPC_SUBNET_1}\n    VPC_SUBNET_2:         ${VPC_SUBNET_2}\n    EC2_INSTANCE_PROFILE: ${EC2_INSTANCE_PROFILE}\n    EC2_KEY_NAME:         ${EC2_KEY_NAME}\n    VPC_SECURITY_GROUP:   ${VPC_SECURITY_GROUP}\n    ECS_ARN:              ${ECS_ARN}\n\nETX\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n\n    VPC_SUBNET_1:         subnet-xxxxxxxx\n    VPC_SUBNET_2:         subnet-xxxxxxxx\n    EC2_INSTANCE_PROFILE: arn:aws:iam::xxxxxxxxxxxx:instance-profile/aws-batch-xxxxxxxxxx-BatchInstanceProfile-xxxxxxxxxxxx\n    EC2_KEY_NAME:         your-key-name\n    VPC_SECURITY_GROUP:   sg-xxxxxxxx\n    ECS_ARN:              arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/aws-batch-unmanaged_Batch_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n\n\n\n\n2.2. CloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u53d6\u5f97\n\n\u30b3\u30de\u30f3\u30c9\ncurl --location --output ${CFN_STACK_NAME}-ecs.yaml \\\n  https://raw.githubusercontent.com/supinf/aws-batch-refarch/master/cloudformation/unmanaged-ecs.yaml\n\n\nCloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws cloudformation create-stack \\\n  --stack-name ${CFN_STACK_NAME}-ecs \\\n  --template-body file://${CFN_STACK_NAME}-ecs.yaml \\\n  --parameters ParameterKey=Subnet1,ParameterValue=${VPC_SUBNET_1} \\\n               ParameterKey=Subnet2,ParameterValue=${VPC_SUBNET_2} \\\n               ParameterKey=InstanceType,ParameterValue=t2.micro \\\n               ParameterKey=InstanceProfile,ParameterValue=${EC2_INSTANCE_PROFILE} \\\n               ParameterKey=KeyName,ParameterValue=${EC2_KEY_NAME} \\\n               ParameterKey=SecurityGroup,ParameterValue=${VPC_SECURITY_GROUP} \\\n               ParameterKey=ECSCluster,ParameterValue=${ECS_ARN}\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"StackId\": \"arn:aws:cloudformation:us-east-1:xxxxxxxxxxxx:stack/aws-batch-xxxxxxxxxx-ecs/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n\n\n\u3053\u306e\u30b9\u30bf\u30c3\u30af\u306b\u3088\u308a\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\nAutoScalingGroup\nEC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n\n2.3. \u30b9\u30bf\u30c3\u30af\u751f\u6210\u3092\u5f85\u6a5f\n\n\u30b3\u30de\u30f3\u30c9\naws cloudformation wait stack-create-complete \\\n  --stack-name ${CFN_STACK_NAME}-ecs\n\n\n\n\u7d50\u679c\n\u8fd4\u308a\u5024\u306a\u3057\n\n\n\n3. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n\n3.1. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u540d\u306e\u6307\u5b9a\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u540d\u306e\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nJOB_QUEUE_NAME=\"aws-batch-job-queue-`date +%s`\"\n\n\n\u540c\u540d\u306e\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws batch describe-job-queues \\\n  --job-queues ${JOB_QUEUE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"jobQueues\": []\n}\n\n\n\n3.2. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u512a\u5148\u9806\u4f4d\u306f 1 \u301c 10 \u3067\u6307\u5b9a\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306f 5 \u306b\u3057\u307e\u3059\n\n\u30b3\u30de\u30f3\u30c9\nJOB_QUEUE_PRIORITY=5\n\n\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306b\u306f 3 \u3064\u307e\u3067\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u3092\u95a2\u9023\u3065\u3051\u3089\u308c\u307e\u3059\u304c\n\u4eca\u56de\u306f\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u74b0\u5883\u3067\u306e\u307f\u5b9f\u884c\u53ef\u80fd\u306a\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws batch create-job-queue \\\n  --job-queue-name ${JOB_QUEUE_NAME} \\\n  --priority ${JOB_QUEUE_PRIORITY} \\\n  --compute-environment-order \\\n  order=1,computeEnvironment=${COMPUTE_ENV_NAME}\n\n\n\n\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"jobQueueArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:job-queue/aws-batch-job-queue-xxxxxxxxxx\", \n    \"jobQueueName\": \"aws-batch-job-queue-xxxxxxxxxx\"\n}\n\n\n\n3.3. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e status \u304c VALID\u3001\nstate \u304c ENABLED \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws batch describe-job-queues \\\n  --job-queues ${JOB_QUEUE_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"jobQueues\": [\n        {\n            \"status\": \"VALID\", \n            \"jobQueueArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:job-queue/aws-batch-job-queue-xxxxxxxxxx\", \n            \"computeEnvironmentOrder\": [\n                {\n                    \"computeEnvironment\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-refarch\", \n                    \"order\": 1\n                }\n            ], \n            \"statusReason\": \"JobQueue Healthy\", \n            \"priority\": 5, \n            \"state\": \"ENABLED\", \n            \"jobQueueName\": \"aws-batch-job-queue-xxxxxxxxxx\"\n        }\n    ]\n}\n\n\n\n\u5b8c\u4e86\n\u74b0\u5883\u69cb\u7bc9\u306f\u4ee5\u4e0a\u3067\u3059\u3002\nAWS Batch #2 \u30b8\u30e7\u30d6\u306e\u4f5c\u6210\u3068\u5b9f\u884c\u3078\n# \u524d\u63d0\u6761\u4ef6\n\n## EC2\u3078\u306e\u6a29\u9650\n\nEC2\u3001ECS\u3001AWS Batch \u306a\u3069\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n# 0. \u6e96\u5099\n\n## 0.1. AWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n* AWS CLI 1.11.36\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n aws-cli/1.11.36 Python/2.7.5 Darwin/13.4.0 botocore/1.4.93\n```\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\nsudo -H pip install -U awscli\n```\n\n## 0.2. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\nJAWS-UG CLI \u652f\u90e8\u3067\u306f\u300cUS-EAST-1\u300d\u306f\u975e\u63a8\u5968\u3067\u3059\u304c\u30012017 \u5e74 1 \u6708\u73fe\u5728\u3001[AWS Batch \u304c GA \u306b\u306a\u3063\u3066\u3044\u308b](https://aws.amazon.com/jp/about-aws/whats-new/2017/01/aws-batch-now-generally-available/)\u306e\u306f\u3053\u3053\u3060\u3051\u306a\u306e\u3067\u3001\u4eca\u65e5\u3060\u3051\u3001\u4eca\u65e5\u3060\u3051\u3001\u3068\u5ff5\u3058\u3066\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```sh:\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='us-east-1'\n```\n\n## 0.3. \u8cc7\u683c\u60c5\u5831\u306e\u78ba\u8a8d\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```sh:\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                  default           manual    --profile\naccess_key     ****************XXXX shared-credentials-file    \nsecret_key     ****************XXXX shared-credentials-file    \n    region                us-east-1              env    AWS_DEFAULT_REGION\n```\n\n## 0.4. AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u5c5e\u6027\n\nEC2-Classic \u304c\u898b\u3048\u306a\u3044 AWS \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u3042\u308b\u3053\u3068\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\nAWS_SUPPORT_PLATFORMS=$( \\\n         aws ec2 describe-account-attributes \\\n           --query 'AccountAttributes[?AttributeName == `supported-platforms`].AttributeValues[].AttributeValue' \\\n           --output text \\\n) && echo ${AWS_SUPPORT_PLATFORMS}\n```\n\n```sh:\u7d50\u679c\n VPC\n```\n\n\u6ce8\u91c8: `VPC` \u306e\u4ed6\u306b `EC2` \u304c\u8868\u793a\u3055\u308c\u308b\u5834\u5408\u3001\u5225\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## 0.5. VPC / IAM \u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\nCloudFormation \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u5b9a\u7fa9\n\n```sh:\u30b3\u30de\u30f3\u30c9\nCFN_STACK_NAME=\"aws-batch-`date +%s`\"\n```\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u53d6\u5f97\n\n```sh:\u30b3\u30de\u30f3\u30c9\ncurl --location --output ${CFN_STACK_NAME}.yaml \\\n  https://raw.githubusercontent.com/supinf/aws-batch-refarch/master/cloudformation/base.yaml\n```\n\nCloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws cloudformation create-stack \\\n  --stack-name ${CFN_STACK_NAME} \\\n  --template-body file://${CFN_STACK_NAME}.yaml \\\n  --capabilities CAPABILITY_IAM\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"StackId\": \"arn:aws:cloudformation:us-east-1:xxxxxxxxxxxx:stack/aws-batch-xxxxxxxxxx/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n```\n\n\u3053\u306e\u30b9\u30bf\u30c3\u30af\u306b\u3088\u308a\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\n* AWS Batch \u7528 VPC\n* AWS Batch \u7528\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n* SpotFleet \u7528\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n* EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb\n* EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\n## 0.6. EC2 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u3092\u53c2\u8003\u306b\u30ad\u30fc\u30da\u30a2\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u305f\u3060\u3057 `AWS_DEFAULT_REGION` \u306f `us-east-1` \u306e\u307e\u307e\u3067\u30fb\u30fb\n\n[[JAWS-UG CLI] EC2:#1 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210 (\u65b0\u898f)](http://qiita.com/tcsh/items/59303d9506ca7d13f744)\n\n\u30ad\u30fc\u30da\u30a2\u306e\u78ba\u8a8d\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-key-pairs \\\n  --key-names ${EC2_KEY_NAME}\n```\n\n\u6307\u5b9a\u3057\u305f\u30ad\u30fc\u30da\u30a2\u306e\u60c5\u5831\u304c\u8fd4\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"KeyPairs\": [\n        {\n            \"KeyName\": \"your-keypair-name\", \n            \"KeyFingerprint\": \"xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx:xx\"\n        }\n    ]\n}\n```\n\n## 0.7. jq \u3084 jsonlint \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6700\u65b0\u306e aws-cli \u306b\u306f `jp.py` \u304c\u5165\u3063\u3066\u3044\u306a\u3044\u6c17\u304c\u3057\u307e\u3059\u30fb\u30fb\n\u3068\u3044\u3046\u308f\u3051\u3067 [`jq`](https://stedolan.github.io/jq/download/) \u3068 [`jsonlint`](https://github.com/zaach/jsonlint) \u3092\u305d\u308c\u305e\u308c\u5165\u308c\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n# 1. \u30af\u30e9\u30b9\u30bf\u8d77\u52d5\n\n## 1.1. \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u540d\u306e\u6307\u5b9a\n\n\u74b0\u5883\u540d\u306e\u6307\u5b9a\n\n```sh:\u30b3\u30de\u30f3\u30c9\nCOMPUTE_ENV_NAME=\"aws-batch-unmanaged-`date +%s`\"\n```\n\n\u540c\u540d\u306e\u74b0\u5883\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws batch describe-compute-environments \\\n  --compute-environments ${COMPUTE_ENV_NAME}\n```\n\n```sh:\u7d50\u679c\n{\n    \"computeEnvironments\": []\n}\n```\n\n## 1.2. \u5229\u7528\u3059\u308b VPC / IAM \u306e\u5909\u6570\u5b9a\u7fa9\n\n\u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\u3092\u5f85\u6a5f\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws cloudformation wait stack-create-complete \\\n  --stack-name ${CFN_STACK_NAME}\n```\n\n```sh:\u7d50\u679c\n\u8fd4\u308a\u5024\u306a\u3057\n```\n\n\u751f\u6210\u7d50\u679c\u3092\u53d6\u5f97\n\n```sh:\u30b3\u30de\u30f3\u30c9\nCFN_STACK_RESULT=$( aws cloudformation describe-stacks \\\n  --stack-name ${CFN_STACK_NAME} \\\n) && echo ${CFN_STACK_RESULT} | jq .\n```\n\n\u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\u7d50\u679c\uff08Output\uff09\u304b\u3089\u3001\u5f8c\u304b\u3089\u5fc5\u8981\u306b\u306a\u308b\u5909\u6570\u3092\u629c\u304d\u51fa\u3057\u307e\u3059\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\nBATCH_SERVICE_ROLE=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"AWSBatchServiceRole\").OutputValue' )\n\nEC2_INSTANCE_PROFILE=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"BatchInstanceProfile\").OutputValue' )\n\nVPC_SUBNET_1=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"PublicSubnet1\").OutputValue' )\n\nVPC_SUBNET_2=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"PublicSubnet2\").OutputValue' )\n\nVPC_SECURITY_GROUP=$( echo ${CFN_STACK_RESULT} \\\n  | jq '.Stacks[].Outputs[]' \\\n  | jq -r 'select(.OutputKey==\"SecurityGroup\").OutputValue' )\n\n```\n\n## 1.3. \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u306e\u4f5c\u6210\n\nAWS Batch \u3067\u306f\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u3068\u3057\u3066 [`MANAGED` \u307e\u305f\u306f `UNMANAGED`](http://qiita.com/pottava/items/d9886b2e8835c5c0d30f#%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0%E7%92%B0%E5%A2%83) \u304c\u9078\u629e\u3067\u304d\u307e\u3059\u3002\n`MANAGED` \u3092\u9078\u629e\u3059\u308b\u3068\u3001ECS \u30af\u30e9\u30b9\u30bf\u3082\u8d77\u52d5\u3057\u3066\u304f\u308c\u308b\u30bf\u30a4\u30d7\u3001\n`UNMANAGED` \u306f\u81ea\u5206\u3067 ECS \u30af\u30e9\u30b9\u30bf\u3092\u7528\u610f\u3059\u308b\u30bf\u30a4\u30d7\u3067\u3059\u3002\n\n\u4eca\u56de\u306f `UNMANAGED` \u306a\u74b0\u5883\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws batch create-compute-environment \\\n  --compute-environment-name ${COMPUTE_ENV_NAME} \\\n  --type UNMANAGED \\\n  --service-role ${BATCH_SERVICE_ROLE}\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"computeEnvironmentName\": \"aws-batch-unmanaged-xxxxxxxxxx\", \n    \"computeEnvironmentArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-refarch\"\n}\n```\n\n## 1.4. ECS \u30af\u30e9\u30b9\u30bf ARN \u306e\u78ba\u8a8d\n\n\u4f5c\u6210\u3057\u305f\u74b0\u5883\u306e status \u304c `VALID`\u3001\nstate \u304c `ENABLED` \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\nstatus \u304c `CREATING` \u3067\u3042\u308b\u5834\u5408 `VALID` \u306b\u306a\u308b\u307e\u3067\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u30fb\u30fb\n\n```sh:\u30b3\u30de\u30f3\u30c9\nCOMPUTE_ENV=$( aws batch describe-compute-environments \\\n  --compute-environments ${COMPUTE_ENV_NAME} \\\n) && echo ${COMPUTE_ENV} | jq .\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n  \"computeEnvironments\": [\n    {\n      \"status\": \"VALID\",\n      \"serviceRole\": \"arn:aws:iam::xxxxxxxxxxxx:role/service-role/aws-batch-xxxxxxxxxx-AWSBatchServiceRole-xxxxxxxxxxxx\", \n      \"computeEnvironmentArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-unmanaged-xxxxxxxxxx\",\n      \"statusReason\": \"ComputeEnvironment Healthy\",\n      \"ecsClusterArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/aws-batch-unmanaged-xxxxxxxxxx_Batch_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\", \n      \"state\": \"ENABLED\",\n      \"computeEnvironmentName\": \"aws-batch-unmanaged-xxxxxxxxxx\",\n      \"type\": \"UNMANAGED\"\n    }\n  ]\n}\n```\n\n# 2. ECS \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\n\n## 2.1. \u30af\u30e9\u30b9\u30bf\u306e\u305f\u3081\u306e\u5909\u6570\u78ba\u8a8d\n\nECS \u30af\u30e9\u30b9\u30bf ARN \u306e\u53d6\u5f97\n\n```sh:\u30b3\u30de\u30f3\u30c9\nECS_ARN=$( echo ${COMPUTE_ENV} | jq -r \\\n  '.computeEnvironments[0].ecsClusterArn' )\n```\n\n\u3053\u306e\u30af\u30e9\u30b9\u30bf\u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u5909\u6570\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n```sh:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    VPC_SUBNET_1:         ${VPC_SUBNET_1}\n    VPC_SUBNET_2:         ${VPC_SUBNET_2}\n    EC2_INSTANCE_PROFILE: ${EC2_INSTANCE_PROFILE}\n    EC2_KEY_NAME:         ${EC2_KEY_NAME}\n    VPC_SECURITY_GROUP:   ${VPC_SECURITY_GROUP}\n    ECS_ARN:              ${ECS_ARN}\n\nETX\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n\n    VPC_SUBNET_1:         subnet-xxxxxxxx\n    VPC_SUBNET_2:         subnet-xxxxxxxx\n    EC2_INSTANCE_PROFILE: arn:aws:iam::xxxxxxxxxxxx:instance-profile/aws-batch-xxxxxxxxxx-BatchInstanceProfile-xxxxxxxxxxxx\n    EC2_KEY_NAME:         your-key-name\n    VPC_SECURITY_GROUP:   sg-xxxxxxxx\n    ECS_ARN:              arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/aws-batch-unmanaged_Batch_xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\n\n```\n\n## 2.2. CloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u53d6\u5f97\n\n```sh:\u30b3\u30de\u30f3\u30c9\ncurl --location --output ${CFN_STACK_NAME}-ecs.yaml \\\n  https://raw.githubusercontent.com/supinf/aws-batch-refarch/master/cloudformation/unmanaged-ecs.yaml\n```\n\nCloudFormation \u30b9\u30bf\u30c3\u30af\u306e\u751f\u6210\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws cloudformation create-stack \\\n  --stack-name ${CFN_STACK_NAME}-ecs \\\n  --template-body file://${CFN_STACK_NAME}-ecs.yaml \\\n  --parameters ParameterKey=Subnet1,ParameterValue=${VPC_SUBNET_1} \\\n               ParameterKey=Subnet2,ParameterValue=${VPC_SUBNET_2} \\\n               ParameterKey=InstanceType,ParameterValue=t2.micro \\\n               ParameterKey=InstanceProfile,ParameterValue=${EC2_INSTANCE_PROFILE} \\\n               ParameterKey=KeyName,ParameterValue=${EC2_KEY_NAME} \\\n               ParameterKey=SecurityGroup,ParameterValue=${VPC_SECURITY_GROUP} \\\n               ParameterKey=ECSCluster,ParameterValue=${ECS_ARN}\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"StackId\": \"arn:aws:cloudformation:us-east-1:xxxxxxxxxxxx:stack/aws-batch-xxxxxxxxxx-ecs/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx\"\n}\n```\n\n\u3053\u306e\u30b9\u30bf\u30c3\u30af\u306b\u3088\u308a\u4ee5\u4e0b\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\n\n* AutoScalingGroup\n* EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n## 2.3. \u30b9\u30bf\u30c3\u30af\u751f\u6210\u3092\u5f85\u6a5f\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws cloudformation wait stack-create-complete \\\n  --stack-name ${CFN_STACK_NAME}-ecs\n```\n\n```sh:\u7d50\u679c\n\u8fd4\u308a\u5024\u306a\u3057\n```\n\n# 3. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n\n## 3.1. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u540d\u306e\u6307\u5b9a\n\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u540d\u306e\u6307\u5b9a\n\n```sh:\u30b3\u30de\u30f3\u30c9\nJOB_QUEUE_NAME=\"aws-batch-job-queue-`date +%s`\"\n```\n\n\u540c\u540d\u306e\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u304c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws batch describe-job-queues \\\n  --job-queues ${JOB_QUEUE_NAME}\n```\n\n```sh:\u7d50\u679c\n{\n    \"jobQueues\": []\n}\n```\n\n## 3.2. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u512a\u5148\u9806\u4f4d\u306f 1 \u301c 10 \u3067\u6307\u5b9a\u3057\u307e\u3059\u304c\u3001\u4eca\u56de\u306f 5 \u306b\u3057\u307e\u3059\n\n```sh:\u30b3\u30de\u30f3\u30c9\nJOB_QUEUE_PRIORITY=5\n```\n\n\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306b\u306f 3 \u3064\u307e\u3067\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u74b0\u5883\u3092\u95a2\u9023\u3065\u3051\u3089\u308c\u307e\u3059\u304c\n\u4eca\u56de\u306f\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u74b0\u5883\u3067\u306e\u307f\u5b9f\u884c\u53ef\u80fd\u306a\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws batch create-job-queue \\\n  --job-queue-name ${JOB_QUEUE_NAME} \\\n  --priority ${JOB_QUEUE_PRIORITY} \\\n  --compute-environment-order \\\n  order=1,computeEnvironment=${COMPUTE_ENV_NAME}\n```\n\n```sh:\u7d50\u679c\uff08\u4f8b\uff09\n{\n    \"jobQueueArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:job-queue/aws-batch-job-queue-xxxxxxxxxx\", \n    \"jobQueueName\": \"aws-batch-job-queue-xxxxxxxxxx\"\n}\n```\n\n## 3.3. \u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e\u78ba\u8a8d\n\n\u4f5c\u6210\u3057\u305f\u30b8\u30e7\u30d6\u30ad\u30e5\u30fc\u306e status \u304c `VALID`\u3001\nstate \u304c `ENABLED` \u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sh:\u30b3\u30de\u30f3\u30c9\naws batch describe-job-queues \\\n  --job-queues ${JOB_QUEUE_NAME}\n```\n\n```sh:\u7d50\u679c\n{\n    \"jobQueues\": [\n        {\n            \"status\": \"VALID\", \n            \"jobQueueArn\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:job-queue/aws-batch-job-queue-xxxxxxxxxx\", \n            \"computeEnvironmentOrder\": [\n                {\n                    \"computeEnvironment\": \"arn:aws:batch:us-east-1:xxxxxxxxxxxx:compute-environment/aws-batch-refarch\", \n                    \"order\": 1\n                }\n            ], \n            \"statusReason\": \"JobQueue Healthy\", \n            \"priority\": 5, \n            \"state\": \"ENABLED\", \n            \"jobQueueName\": \"aws-batch-job-queue-xxxxxxxxxx\"\n        }\n    ]\n}\n```\n\n# \u5b8c\u4e86\n\n\u74b0\u5883\u69cb\u7bc9\u306f\u4ee5\u4e0a\u3067\u3059\u3002\n[AWS Batch #2 \u30b8\u30e7\u30d6\u306e\u4f5c\u6210\u3068\u5b9f\u884c](http://qiita.com/pottava/items/4151fcb9b14c51f50e9c)\u3078\n", "tags": ["AWS", "aws-cli", "AWS-Batch"]}