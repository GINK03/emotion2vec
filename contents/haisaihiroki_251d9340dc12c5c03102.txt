{"context": " More than 1 year has passed since last update.\n\n\u3084\u308b\u3053\u3068&\u3084\u308a\u65b9\nRaspberry Pi\u30671\u756a\u6709\u540d\u306aOS\u3067\u3042\u308b\u3001Raspbian\u3067fsprotect\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u306baufs\u306e\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u3066\u30d3\u30eb\u30c9\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\nRaspberry Pi\u81ea\u8eab\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u304b\u3051\u308b\u3068\u3001\u3042\u307e\u308a\u306b\u3082\u6642\u9593\u304c\u304b\u304b\u308a\u5f85\u3066\u306a\u3044\u306e\u3067\u3001x64\u30de\u30b7\u30f3\u3067\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u304b\u3051\u3066\u3001\u30ab\u30fc\u30cd\u30eb\u3060\u3051\u3092Raspberry Pi\u306b\u6301\u3063\u3066\u3044\u304f\u3068\u3044\u3046\u3084\u308a\u65b9\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u30d3\u30eb\u30c9\u74b0\u5883\nOS : Ubuntu 14.10 64bit\nworkspace : ~/raspberrypi_work/\n\n\u4f5c\u696d\u624b\u9806\n\n\u4e8b\u524d\u6e96\u5099\nRaspberry Pi\u4e0a\u3067\u3001\u30ab\u30fc\u30cd\u30eb\u4ed6\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n$ sudo apt-get update\n$ sudo apt-get upgrade\n\n\n\u74b0\u5883\u69cb\u7bc9\n\u3053\u3053\u304b\u3089\u306e\u4f5c\u696d\u306fUbuntu\u4e0a\u3067\u884c\u3044\u307e\u3059\u3002\n\u307e\u305a\u3001\u4f5c\u696d\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ sudo apt-get install lib32ncurses5 lib32z1 libncurses5-dev gcc-arm-linux-gnueabi make libncurses5-dev git\n\nRaspberry Pi\u7528\u306e\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u6700\u65b0\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\n\u3082\u3057\u3001\u5225\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6b32\u3057\u3044\u3068\u304d\u306f\u3001checkout\u3059\u308b\u30d6\u30e9\u30f3\u30c1\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n~/raspberrypi_work$ git clone git://github.com/raspberrypi/linux.git\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n~/raspberrypi_work$ git clone git://github.com/raspberrypi/tools.git\n\n\naufs\u306e\u30d1\u30c3\u30c1\u3092\u9069\u7528\u3059\u308b\naufs\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n~/raspberrypi_work/linux$ git clone git://git.code.sf.net/p/aufs/aufs3-standalone aufs-aufs3-standalone\n~/raspberrypi_work/linux/aufs-aufs3-standal$ git checkout aufs3.18.1+\n\n\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u30b3\u30d4\u30fc\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp fs/ ../\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp Documentation/ ../\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp include/uapi/linux/aufs_type.h ../include/uapi/linux/\n\n\u30ab\u30fc\u30cd\u30eb\u306b\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u308b\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-kbuild.patch\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-base.patch\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-mmap.patch\n\n\n\u30d3\u30eb\u30c9\n\u74b0\u5883\u5909\u6570\u306b\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n$ export MYCC=${HOME}/raspberrypi_work/tools/arm-bcm2708/arm-bcm2708hardfp-linux-gnueabi/bin/arm-bcm2708hardfp-linux-gnueabi-\n\n\u5b9f\u884c\u4e2d\u306eRaspberry Pi\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\n~/raspberrypi_work/linux$ scp pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:/proc/config.gz ./\n~/raspberrypi_work/linux$ zcat config.gz > .config\n\nmenuconfig\u3067aufs\u3092\u6709\u52b9\u5316\u3059\u308b\u3002\nFile systems > Miscellaneous filesystems > Aufs (Advanced multi layered unification filesystem) support \u3092<*>\u306b\u3059\u308b\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC menuconfig\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4fee\u6b63\u3059\u308b\u3002\n\"EXTRAVERSION\"\u306b\u5185\u5bb9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n~/raspberrypi_work/linux$ vi Makefile\n\nEXTRAVERSION = -aufs\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d3\u30eb\u30c9\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC modules\n\n\nRaspberry Pi\u306b\u30c7\u30fc\u30bf\u306e\u30b3\u30d4\u30fc\nRaspberry Pi\u306b\u30ab\u30fc\u30cd\u30eb\u3068\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u6301\u3063\u3066\u3044\u304f\u305f\u3081\u306e\u6e96\u5099\u3092\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u51fa\u529b\u3057\u3001tar.gz\u3067\u56fa\u3081\u308b\u3002\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC INSTALL_MOD_PATH=../tmp/rpimod modules_install\n~/raspberrypi_work/tmp/rpimod$ tar zcvf rpimod.tar.gz ./lib/modules\n\nRaspberry Pi\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n~/raspberrypi_work$ scp linux/arch/arm/boot/Image pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:/boot/kernel_new.img\n~/raspberrypi_work$ scp tmp/rpimod/rpimod.tar.gz pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:~/rpimod.tar.gz\n\n\nRaspberry Pi\u306b\u9069\u7528\u3059\u308b\n\u3053\u3053\u304b\u3089\u306f\u3001Raspberry Pi\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u30ab\u30fc\u30cd\u30eb\u3092\u7f6e\u304d\u63db\u3048\u308b\u3002\n~# mv /boot/kernel.img /boot/kernel.img_orz\n~# mv /home/pi/kernel_new.img /boot/kernel.img\n\n\u6b21\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\u3002\n~# tar zxvf /home/pi/rpimod.tar.gz\n~# cp -R lib/modules/3.18.6-aufs+ /lib/modules/\n\n\u6700\u5f8c\u306b\u3001\u518d\u8d77\u52d5\u3057\u3066\u7f6e\u304d\u63db\u3048\u305f\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3055\u305b\u308b\u3002\n~# reboot\n\n\n\u78ba\u8a8d\n\u7f6e\u304d\u63db\u3048\u305f\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3057\u305f\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n~$ uname -a\n3.18.6-aufs+\n\n# \u3084\u308b\u3053\u3068&\u3084\u308a\u65b9\nRaspberry Pi\u30671\u756a\u6709\u540d\u306aOS\u3067\u3042\u308b\u3001Raspbian\u3067fsprotect\u3092\u4f7f\u3046\u305f\u3081\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u306baufs\u306e\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u3066\u30d3\u30eb\u30c9\u3057\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\n\nRaspberry Pi\u81ea\u8eab\u3067\u30ab\u30fc\u30cd\u30eb\u3092\u30d3\u30eb\u30c9\u304b\u3051\u308b\u3068\u3001\u3042\u307e\u308a\u306b\u3082\u6642\u9593\u304c\u304b\u304b\u308a\u5f85\u3066\u306a\u3044\u306e\u3067\u3001x64\u30de\u30b7\u30f3\u3067\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u304b\u3051\u3066\u3001\u30ab\u30fc\u30cd\u30eb\u3060\u3051\u3092Raspberry Pi\u306b\u6301\u3063\u3066\u3044\u304f\u3068\u3044\u3046\u3084\u308a\u65b9\u3092\u884c\u3044\u307e\u3059\u3002\n\n# \u30d3\u30eb\u30c9\u74b0\u5883\n\nOS : Ubuntu 14.10 64bit\nworkspace : `~/raspberrypi_work/`\n\n\n\n# \u4f5c\u696d\u624b\u9806\n\n## \u4e8b\u524d\u6e96\u5099\n\nRaspberry Pi\u4e0a\u3067\u3001\u30ab\u30fc\u30cd\u30eb\u4ed6\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u3002\n\n```shell-session\n$ sudo apt-get update\n$ sudo apt-get upgrade\n```\n\n## \u74b0\u5883\u69cb\u7bc9\n\n\u3053\u3053\u304b\u3089\u306e\u4f5c\u696d\u306fUbuntu\u4e0a\u3067\u884c\u3044\u307e\u3059\u3002\n\u307e\u305a\u3001\u4f5c\u696d\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```shell-session\n$ sudo apt-get install lib32ncurses5 lib32z1 libncurses5-dev gcc-arm-linux-gnueabi make libncurses5-dev git\n```\n\nRaspberry Pi\u7528\u306e\u30ab\u30fc\u30cd\u30eb\u30bd\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\n\u3053\u306e\u72b6\u614b\u3067\u3001\u6700\u65b0\u306e\u30ab\u30fc\u30cd\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002\n\u3082\u3057\u3001\u5225\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u6b32\u3057\u3044\u3068\u304d\u306f\u3001checkout\u3059\u308b\u30d6\u30e9\u30f3\u30c1\u3092\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```shell-session\n~/raspberrypi_work$ git clone git://github.com/raspberrypi/linux.git\n```\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u5fc5\u8981\u306a\u30c4\u30fc\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```shell-session\n~/raspberrypi_work$ git clone git://github.com/raspberrypi/tools.git\n```\n\n## aufs\u306e\u30d1\u30c3\u30c1\u3092\u9069\u7528\u3059\u308b\n\naufs\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```shell-session\n~/raspberrypi_work/linux$ git clone git://git.code.sf.net/p/aufs/aufs3-standalone aufs-aufs3-standalone\n~/raspberrypi_work/linux/aufs-aufs3-standal$ git checkout aufs3.18.1+\n```\n\n\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u30b3\u30d4\u30fc\n\n```shell-session\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp fs/ ../\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp Documentation/ ../\n~/raspberrypi_work/linux/aufs-aufs3-standalone$ cp -rp include/uapi/linux/aufs_type.h ../include/uapi/linux/\n```\n\n\u30ab\u30fc\u30cd\u30eb\u306b\u30d1\u30c3\u30c1\u3092\u5f53\u3066\u308b\n\n```shell-session\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-kbuild.patch\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-base.patch\n~/raspberrypi_work/linux$ patch -p1 < aufs-aufs3-standalone/aufs3-mmap.patch\n```\n\n##  \u30d3\u30eb\u30c9\n\n\u74b0\u5883\u5909\u6570\u306b\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n```shell-session\n$ export MYCC=${HOME}/raspberrypi_work/tools/arm-bcm2708/arm-bcm2708hardfp-linux-gnueabi/bin/arm-bcm2708hardfp-linux-gnueabi-\n```\n\n\u5b9f\u884c\u4e2d\u306eRaspberry Pi\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\n\n```shell-session\n~/raspberrypi_work/linux$ scp pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:/proc/config.gz ./\n~/raspberrypi_work/linux$ zcat config.gz > .config\n```\n\nmenuconfig\u3067aufs\u3092\u6709\u52b9\u5316\u3059\u308b\u3002\nFile systems > Miscellaneous filesystems > Aufs (Advanced multi layered unification filesystem) support \u3092<*>\u306b\u3059\u308b\n\n```shell-session\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC menuconfig\n```\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4fee\u6b63\u3059\u308b\u3002\n\"EXTRAVERSION\"\u306b\u5185\u5bb9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```shell-session\n~/raspberrypi_work/linux$ vi Makefile\n\nEXTRAVERSION = -aufs\n```\n\n\u30ab\u30fc\u30cd\u30eb\u306e\u30d3\u30eb\u30c9\n\n```shell-session\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC\n```\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30d3\u30eb\u30c9\n\n```shell-session\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC modules\n```\n\n## Raspberry Pi\u306b\u30c7\u30fc\u30bf\u306e\u30b3\u30d4\u30fc\n\nRaspberry Pi\u306b\u30ab\u30fc\u30cd\u30eb\u3068\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u6301\u3063\u3066\u3044\u304f\u305f\u3081\u306e\u6e96\u5099\u3092\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u51fa\u529b\u3057\u3001tar.gz\u3067\u56fa\u3081\u308b\u3002\n\n```shell-session\n~/raspberrypi_work/linux$ make ARCH=arm CROSS_COMPILE=$MYCC INSTALL_MOD_PATH=../tmp/rpimod modules_install\n~/raspberrypi_work/tmp/rpimod$ tar zcvf rpimod.tar.gz ./lib/modules\n```\n\nRaspberry Pi\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```shell-session\n~/raspberrypi_work$ scp linux/arch/arm/boot/Image pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:/boot/kernel_new.img\n~/raspberrypi_work$ scp tmp/rpimod/rpimod.tar.gz pi@RaspberryPi\u306eIP\u30a2\u30c9\u30ec\u30b9:~/rpimod.tar.gz\n```\n\n## Raspberry Pi\u306b\u9069\u7528\u3059\u308b\n\n\u3053\u3053\u304b\u3089\u306f\u3001Raspberry Pi\u3067\u4f5c\u696d\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001\u30ab\u30fc\u30cd\u30eb\u3092\u7f6e\u304d\u63db\u3048\u308b\u3002\n\n```shell-session\n~# mv /boot/kernel.img /boot/kernel.img_orz\n~# mv /home/pi/kernel_new.img /boot/kernel.img\n```\n\n\u6b21\u306b\u3001\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\u3002\n\n```shell-session\n~# tar zxvf /home/pi/rpimod.tar.gz\n~# cp -R lib/modules/3.18.6-aufs+ /lib/modules/\n```\n\n\u6700\u5f8c\u306b\u3001\u518d\u8d77\u52d5\u3057\u3066\u7f6e\u304d\u63db\u3048\u305f\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3055\u305b\u308b\u3002\n\n```shell-session\n~# reboot\n```\n\n## \u78ba\u8a8d\n\n\u7f6e\u304d\u63db\u3048\u305f\u30ab\u30fc\u30cd\u30eb\u3067\u8d77\u52d5\u3057\u305f\u304b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```shell-session\n~$ uname -a\n3.18.6-aufs+\n```\n", "tags": ["RaspberryPi", "raspbian", "kernel", "aufs", "fsprotect"]}