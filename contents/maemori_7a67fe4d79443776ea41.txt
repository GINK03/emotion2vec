{"context": " More than 1 year has passed since last update.CentOS7\u306bPHP7\u306eLAMP\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306eDockerfile\u3067\u3059\u3002\n\u5229\u7528\u65b9\u6cd5\u3001Dockerfile\u4e00\u5f0f\u306f\u5f8c\u65e5\u516c\u958b\u3057\u307e\u3059\u3002\n\nDockerfile\n#------------------------------------------------------------\n#\n#  \u7528\u9014: \u958b\u767a\u74b0\u5883\u306e\u57fa\u790e\u69cb\u6210\n#  \u69cb\u6210: CentOS7 + Apache + PHP7(Xdebug) + Redis + mysql\n#\n# @version    0.0\n# @author     Maemori Fumihiro\n#\n\n#------------------------------------------------------------\n# FROM\nFROM centos:7\n\n#------------------------------------------------------------\nMAINTAINER Maemori Fumihiro\n\n#------------------------------------------------------------\n# Update\nRUN yum update -y\n\n#------------------------------------------------------------\n# \u57fa\u672c\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\nRUN yum install -y tar gcc gcc-c++ libaio libaio-devel passwd wget ntp openssl  mod_ssl openssh-server openssl-devel libssl-dev\n\n#------------------------------------------------------------\n# \u65e5\u672c\u8a9e\u5316\nRUN yum -y groupinstall \"Japanese Support\"\nRUN echo \"LANG=\\\"ja_JP.UTF-8\\\"\" > /etc/sysconfig/i18n\nRUN source /etc/sysconfig/i18n\n\n#------------------------------------------------------------\n# Httpd\nRUN yum install -y httpd\n\n#------------------------------------------------------------\n# Redis\n## Install file\nENV REDIS=\"redis-2.8.12\"\n## Radis install\nRUN cd /usr/local/src && wget http://download.redis.io/releases/$REDIS.tar.gz\nRUN cd /usr/local/src && tar xzf $REDIS.tar.gz\nRUN cd /usr/local/src/$REDIS && make && make install\nRUN cd /usr/local/src/$REDIS/utils && ./install_server.sh\n\n#------------------------------------------------------------\n# MySQL\n## Install\nRUN yum install -y http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum install -y mysql-client mysql-server mysql-devel\n## Configuration\nADD conf/my.cnf /etc/my.cnf\nRUN touch /etc/sysconfig/network #This file is needed in /etc/init.d/mysqld\nRUN mysql_install_db\nRUN chown -R mysql:mysql /var/lib/mysql\nRUN chmod 664 /etc/my.cnf\nRUN mkdir /var/log/mysql\nRUN chown -R mysql:mysql /var/log/mysql\nRUN chmod 664 /var/log/mysql\n\n#------------------------------------------------------------\n# Ntp\nRUN cp -p /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\n#------------------------------------------------------------\n# Server certs\nRUN mkdir -p /etc/httpd/certs\nRUN openssl genrsa -out /etc/httpd/certs/server.key 4096\nRUN openssl req -new -batch -key /etc/httpd/certs/server.key -out /etc/httpd/certs/server.csr\nRUN openssl x509 -req -days 3650 -in /etc/httpd/certs/server.csr -signkey /etc/httpd/certs/server.key -out /etc/httpd/certs/server.crt\n\n#------------------------------------------------------------\n# PHP7\n## make install\nRUN yum -y install httpd-devel gd-devel t1lib-devel\nRUN yum -y install bzip2-devel curl-devel gmp-devel aspell-devel recode-devel\nRUN yum -y install icu libicu-devel\nRUN yum -y install tokyocabinet-devel\nRUN yum -y install enchant-devel libc-client-devel firebird-devel unixODBC-devel freetds-devel postgresql-devel libedit-devel net-snmp-devel libtidy-devel\nRUN yum -y install libxml2-devel libxslt-devel\n### libmcrypt install\nRUN cd /usr/local/src && wget http://dl.fedoraproject.org/pub/epel/6/x86_64/libmcrypt-2.5.8-9.el6.x86_64.rpm\nRUN cd /usr/local/src && wget http://dl.fedoraproject.org/pub/epel/6/x86_64/libmcrypt-devel-2.5.8-9.el6.x86_64.rpm\nRUN cd /usr/local/src && yum localinstall -y libmcrypt-2.5.8-9.el6.x86_64.rpm libmcrypt-devel-2.5.8-9.el6.x86_64.rpm\n### bison install\nRUN cd /usr/local/src && wget http://ftp.gnu.org/gnu/bison/bison-2.7.tar.gz\nRUN cd /usr/local/src && tar zxvf bison-2.7.tar.gz\nRUN cd /usr/local/src/bison-2.7 && ./configure && make && make install\n### re2c install\nRUN cd /usr/local/src && wget https://github.com/skvadrik/re2c/releases/download/0.14.3/re2c-0.14.3.tar.gz\nRUN cd /usr/local/src && tar zxvf re2c-0.14.3.tar.gz\nRUN cd /usr/local/src/re2c-0.14.3 && ./configure && make && make install\n### php7 install\nENV PHP7=\"php-7.0.0\"\nRUN wget http://jp2.php.net/get/$PHP7.tar.gz/from/this/mirror -O /usr/local/src/$PHP7.tar.gz\nRUN cd /usr/local/src && tar zxvf $PHP7.tar.gz\nRUN cd /usr/local/src/$PHP7 && ./buildconf --force\nRUN cd /usr/local/src/$PHP7 && ./configure \\\n    --prefix=/usr \\\n    --with-libdir=lib64 \\\n    --sysconfdir=/etc \\\n    --with-config-file-path=/etc \\\n    --with-config-file-scan-dir=/etc/php.d \\\n    --enable-mbstring \\\n    --enable-zip \\\n    --enable-bcmath \\\n    --enable-pcntl \\\n    --enable-ftp \\\n    --enable-exif \\\n    --enable-sysvmsg \\\n    --enable-sysvsem \\\n    --enable-sysvshm \\\n    --enable-gd-native-ttf \\\n    --enable-gd-jis-conv \\\n    --enable-sockets \\\n    --enable-mysqlnd \\\n    --enable-soap \\\n    --enable-shmop \\\n    --enable-intl \\\n    --with-curl \\\n    --with-mcrypt \\\n    --with-iconv \\\n    --with-gmp \\\n    --with-pspell \\\n    --with-gd \\\n    --with-jpeg-dir=/usr \\\n    --with-png-dir=/usr \\\n    --with-zlib-dir=/usr \\\n    --with-xpm-dir=/usr \\\n    --with-freetype-dir=/usr \\\n    --with-openssl \\\n    --with-mysqli=shared,mysqlnd \\\n    --with-mysql-sock=/var/lib/mysql/mysql.sock \\\n    --with-pdo-mysql=shared,mysqlnd \\\n    --with-gettext=/usr \\\n    --with-zlib=/usr \\\n    --with-bz2=/usr \\\n    --with-kerberos \\\n    --with-libxml-dir=/usr \\\n    --with-mhash=/usr \\\n    --with-imap=shared \\\n    --with-imap-ssl \\\n    --with-xmlrpc=shared \\\n    --with-snmp=shared,/usr \\\n    --with-xsl=shared,/usr \\\n    --with-libedit \\\n    --with-tidy=shared,/usr \\\n    --with-icu-dir=/usr \\\n    --with-apxs2=/usr/sbin/apxs\nRUN cd /usr/local/src/$PHP7 && make && make test && make install\n### xdebug install\nRUN cd /usr/local/src && wget http://xdebug.org/files/xdebug-2.4.0rc2.tgz\nRUN cd /usr/local/src && tar zxvf xdebug-2.4.0rc2.tgz\nRUN cd /usr/local/src/xdebug-2.4.0RC2 && phpize\nRUN cd /usr/local/src/xdebug-2.4.0RC2 && ./configure && make && make install\n### redis install\nRUN cd /usr/local/src && git clone -b php7 --depth 1 https://github.com/phpredis/phpredis\nRUN cd /usr/local/src/phpredis && phpize\nRUN cd /usr/local/src/phpredis && ./configure && make && make install\n\n#------------------------------------------------------------\n# \u5f8c\u51e6\u7406\n## \u4e0d\u8981\u306a\u30ab\u30fc\u30cd\u30eb\u306e\u524a\u9664\nRUN yum install -y yum-utils\nRUN package-cleanup --oldkernels --count=1\n\n#------------------------------------------------------------\n# COMMON Configuration\nRUN mkdir /develop\n## httpd\nADD conf/httpd.conf /etc/httpd/conf/httpd.conf\nADD conf/php.conf /etc/httpd/conf.d/php.conf\n## php\nADD conf/php.ini /etc/php.ini\nADD conf/xdebug.ini /etc/php.d/xdebug.ini\nADD conf/opcache.ini /etc/php.d/opcache.ini\nADD conf/pdo_mysqlnd.ini /etc/php.d/pdo_mysqlnd.ini\nADD conf/redis.ini /etc/php.d/redis.ini\nADD module/phpinfo.php /var/www/html/phpinfo.php\nRUN ls -la /etc/php.d/\n## MySQL\nRUN sed -i -e \"s/sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES/# sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES/\" /usr/my.cnf\n\n#------------------------------------------------------------\n# \u8d77\u52d5\u7528\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\nADD script/run.sh /etc/service/run\nRUN chmod +x /etc/service/run\n\n#------------------------------------------------------------\n# \u8d77\u52d5\nCMD [\"/etc/service/run\"]\n\n\n\nCentOS7\u306bPHP7\u306eLAMP\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306eDockerfile\u3067\u3059\u3002\n\u5229\u7528\u65b9\u6cd5\u3001Dockerfile\u4e00\u5f0f\u306f\u5f8c\u65e5\u516c\u958b\u3057\u307e\u3059\u3002\n\n```:Dockerfile\n#------------------------------------------------------------\n#\n#  \u7528\u9014: \u958b\u767a\u74b0\u5883\u306e\u57fa\u790e\u69cb\u6210\n#  \u69cb\u6210: CentOS7 + Apache + PHP7(Xdebug) + Redis + mysql\n#\n# @version    0.0\n# @author     Maemori Fumihiro\n#\n\n#------------------------------------------------------------\n# FROM\nFROM centos:7\n\n#------------------------------------------------------------\nMAINTAINER Maemori Fumihiro\n\n#------------------------------------------------------------\n# Update\nRUN yum update -y\n\n#------------------------------------------------------------\n# \u57fa\u672c\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\nRUN yum install -y tar gcc gcc-c++ libaio libaio-devel passwd wget ntp openssl  mod_ssl openssh-server openssl-devel libssl-dev\n\n#------------------------------------------------------------\n# \u65e5\u672c\u8a9e\u5316\nRUN yum -y groupinstall \"Japanese Support\"\nRUN echo \"LANG=\\\"ja_JP.UTF-8\\\"\" > /etc/sysconfig/i18n\nRUN source /etc/sysconfig/i18n\n\n#------------------------------------------------------------\n# Httpd\nRUN yum install -y httpd\n\n#------------------------------------------------------------\n# Redis\n## Install file\nENV REDIS=\"redis-2.8.12\"\n## Radis install\nRUN cd /usr/local/src && wget http://download.redis.io/releases/$REDIS.tar.gz\nRUN cd /usr/local/src && tar xzf $REDIS.tar.gz\nRUN cd /usr/local/src/$REDIS && make && make install\nRUN cd /usr/local/src/$REDIS/utils && ./install_server.sh\n\n#------------------------------------------------------------\n# MySQL\n## Install\nRUN yum install -y http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\nRUN yum install -y mysql-client mysql-server mysql-devel\n## Configuration\nADD conf/my.cnf /etc/my.cnf\nRUN touch /etc/sysconfig/network #This file is needed in /etc/init.d/mysqld\nRUN mysql_install_db\nRUN chown -R mysql:mysql /var/lib/mysql\nRUN chmod 664 /etc/my.cnf\nRUN mkdir /var/log/mysql\nRUN chown -R mysql:mysql /var/log/mysql\nRUN chmod 664 /var/log/mysql\n\n#------------------------------------------------------------\n# Ntp\nRUN cp -p /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n\n#------------------------------------------------------------\n# Server certs\nRUN mkdir -p /etc/httpd/certs\nRUN openssl genrsa -out /etc/httpd/certs/server.key 4096\nRUN openssl req -new -batch -key /etc/httpd/certs/server.key -out /etc/httpd/certs/server.csr\nRUN openssl x509 -req -days 3650 -in /etc/httpd/certs/server.csr -signkey /etc/httpd/certs/server.key -out /etc/httpd/certs/server.crt\n\n#------------------------------------------------------------\n# PHP7\n## make install\nRUN yum -y install httpd-devel gd-devel t1lib-devel\nRUN yum -y install bzip2-devel curl-devel gmp-devel aspell-devel recode-devel\nRUN yum -y install icu libicu-devel\nRUN yum -y install tokyocabinet-devel\nRUN yum -y install enchant-devel libc-client-devel firebird-devel unixODBC-devel freetds-devel postgresql-devel libedit-devel net-snmp-devel libtidy-devel\nRUN yum -y install libxml2-devel libxslt-devel\n### libmcrypt install\nRUN cd /usr/local/src && wget http://dl.fedoraproject.org/pub/epel/6/x86_64/libmcrypt-2.5.8-9.el6.x86_64.rpm\nRUN cd /usr/local/src && wget http://dl.fedoraproject.org/pub/epel/6/x86_64/libmcrypt-devel-2.5.8-9.el6.x86_64.rpm\nRUN cd /usr/local/src && yum localinstall -y libmcrypt-2.5.8-9.el6.x86_64.rpm libmcrypt-devel-2.5.8-9.el6.x86_64.rpm\n### bison install\nRUN cd /usr/local/src && wget http://ftp.gnu.org/gnu/bison/bison-2.7.tar.gz\nRUN cd /usr/local/src && tar zxvf bison-2.7.tar.gz\nRUN cd /usr/local/src/bison-2.7 && ./configure && make && make install\n### re2c install\nRUN cd /usr/local/src && wget https://github.com/skvadrik/re2c/releases/download/0.14.3/re2c-0.14.3.tar.gz\nRUN cd /usr/local/src && tar zxvf re2c-0.14.3.tar.gz\nRUN cd /usr/local/src/re2c-0.14.3 && ./configure && make && make install\n### php7 install\nENV PHP7=\"php-7.0.0\"\nRUN wget http://jp2.php.net/get/$PHP7.tar.gz/from/this/mirror -O /usr/local/src/$PHP7.tar.gz\nRUN cd /usr/local/src && tar zxvf $PHP7.tar.gz\nRUN cd /usr/local/src/$PHP7 && ./buildconf --force\nRUN cd /usr/local/src/$PHP7 && ./configure \\\n    --prefix=/usr \\\n    --with-libdir=lib64 \\\n    --sysconfdir=/etc \\\n    --with-config-file-path=/etc \\\n    --with-config-file-scan-dir=/etc/php.d \\\n    --enable-mbstring \\\n    --enable-zip \\\n    --enable-bcmath \\\n    --enable-pcntl \\\n    --enable-ftp \\\n    --enable-exif \\\n    --enable-sysvmsg \\\n    --enable-sysvsem \\\n    --enable-sysvshm \\\n    --enable-gd-native-ttf \\\n    --enable-gd-jis-conv \\\n    --enable-sockets \\\n    --enable-mysqlnd \\\n    --enable-soap \\\n    --enable-shmop \\\n    --enable-intl \\\n    --with-curl \\\n    --with-mcrypt \\\n    --with-iconv \\\n    --with-gmp \\\n    --with-pspell \\\n    --with-gd \\\n    --with-jpeg-dir=/usr \\\n    --with-png-dir=/usr \\\n    --with-zlib-dir=/usr \\\n    --with-xpm-dir=/usr \\\n    --with-freetype-dir=/usr \\\n    --with-openssl \\\n    --with-mysqli=shared,mysqlnd \\\n    --with-mysql-sock=/var/lib/mysql/mysql.sock \\\n    --with-pdo-mysql=shared,mysqlnd \\\n    --with-gettext=/usr \\\n    --with-zlib=/usr \\\n    --with-bz2=/usr \\\n    --with-kerberos \\\n    --with-libxml-dir=/usr \\\n    --with-mhash=/usr \\\n    --with-imap=shared \\\n    --with-imap-ssl \\\n    --with-xmlrpc=shared \\\n    --with-snmp=shared,/usr \\\n    --with-xsl=shared,/usr \\\n    --with-libedit \\\n    --with-tidy=shared,/usr \\\n    --with-icu-dir=/usr \\\n    --with-apxs2=/usr/sbin/apxs\nRUN cd /usr/local/src/$PHP7 && make && make test && make install\n### xdebug install\nRUN cd /usr/local/src && wget http://xdebug.org/files/xdebug-2.4.0rc2.tgz\nRUN cd /usr/local/src && tar zxvf xdebug-2.4.0rc2.tgz\nRUN cd /usr/local/src/xdebug-2.4.0RC2 && phpize\nRUN cd /usr/local/src/xdebug-2.4.0RC2 && ./configure && make && make install\n### redis install\nRUN cd /usr/local/src && git clone -b php7 --depth 1 https://github.com/phpredis/phpredis\nRUN cd /usr/local/src/phpredis && phpize\nRUN cd /usr/local/src/phpredis && ./configure && make && make install\n\n#------------------------------------------------------------\n# \u5f8c\u51e6\u7406\n## \u4e0d\u8981\u306a\u30ab\u30fc\u30cd\u30eb\u306e\u524a\u9664\nRUN yum install -y yum-utils\nRUN package-cleanup --oldkernels --count=1\n\n#------------------------------------------------------------\n# COMMON Configuration\nRUN mkdir /develop\n## httpd\nADD conf/httpd.conf /etc/httpd/conf/httpd.conf\nADD conf/php.conf /etc/httpd/conf.d/php.conf\n## php\nADD conf/php.ini /etc/php.ini\nADD conf/xdebug.ini /etc/php.d/xdebug.ini\nADD conf/opcache.ini /etc/php.d/opcache.ini\nADD conf/pdo_mysqlnd.ini /etc/php.d/pdo_mysqlnd.ini\nADD conf/redis.ini /etc/php.d/redis.ini\nADD module/phpinfo.php /var/www/html/phpinfo.php\nRUN ls -la /etc/php.d/\n## MySQL\nRUN sed -i -e \"s/sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES/# sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES/\" /usr/my.cnf\n\n#------------------------------------------------------------\n# \u8d77\u52d5\u7528\u30d5\u30a1\u30a4\u30eb\u306e\u8a2d\u7f6e\nADD script/run.sh /etc/service/run\nRUN chmod +x /etc/service/run\n\n#------------------------------------------------------------\n# \u8d77\u52d5\nCMD [\"/etc/service/run\"]\n\n```\n", "tags": ["docker", "PHP7", "centos7", "dockerfile", "lamp"]}