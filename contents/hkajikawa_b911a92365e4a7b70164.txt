{"context": " More than 1 year has passed since last update.\n\nDRBD\u306b\u3064\u3044\u3066\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u305f\nDRBD\u3092\u4f7f\u3046\u4e0a\u3067\u5fc5\u8981\u305d\u3046\u306a\u90e8\u5206\u3092\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u3067\u3059\u3002\n\u3082\u3057\u304b\u3059\u308b\u3068\u3001\u901a\u77e5\u95a2\u9023\u3092\u8abf\u3079\u3066\u5f8c\u65e5\u8f09\u305b\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u524d\u63d0\n\nCentOS 7 + ELRepo\u306eDRBD\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nPrimary Node\u3068Secondary Node\u306fIP Reachable\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n/dev/sdb\u3092\u540c\u671f\u3059\u308b\u8a2d\u5b9a\u3068\u3057\u3066\u3044\u307e\u3059\u3002(/dev/sda\u306fOS\u304c\u5229\u7528\u3002)\nDRBD 8.4\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3002\n\n\u3053\u3053\u3067\u306f\u3001CentOS 7(+ yum update)\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067IP Reachable\u306a\u74b0\u5883\u304c\u3059\u3067\u306b\u5b58\u5728\u3059\u308b\u6240\u304b\u3089\u8aac\u660e\u3057\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306fIDCF Cloud\u306b\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308bCentOS 7\u3078\u30c7\u30fc\u30bf\u30c7\u30a3\u30b9\u30af\u30921\u53f0\u63a5\u7d9a\u3057\u3001\u8ffd\u52a0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5229\u7528\u3057\u3066DRBD\u306e\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u3068\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u4f59\u8ac7\u3067\u3059\u304c\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b3\u30cd\u30af\u30c8\u3092\u5229\u7528\u3057\u3001\u30be\u30fc\u30f3\u9593\u3084\u30ea\u30fc\u30b8\u30e7\u30f3\u9593\u3067\u3082\u554f\u984c\u306a\u304fDRBD\u306e\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\nELRepo\u3092\u6709\u52b9\u306b\nELRepo\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306bGet started\u304c\u3042\u308b\u305f\u3081\u3001\u7279\u306b\u8ff7\u3046\u3053\u3068\u306f\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u7c21\u5358\u306b\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u30ec\u30dd\u30b8\u30c8\u30ea\u306erpm\u3092\u3044\u308c\u308c\u3070\u6709\u52b9\u306b\u3067\u304d\u307e\u3059\u3002\n\nELRepo\u306erpm\u3092\u5165\u308c\u308b\u3002\n# yum -y install http://elrepo.org/linux/elrepo/el7/x86_64/RPMS/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\n\n\n\u6700\u65b0\u7248\u306f\u306erpm\u306f\u3053\u306e\u8fba\u304b\u3089\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\nDRBD\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nDRBD\u3092\u5165\u308c\u308b\n# yum -y install drbd84-utils kmod-drbd84\n\n\n\nDRBD\u306e\u8a2d\u5b9a\n\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u306f/etc/drbd.d/global_common.conf\u3068/etc/drbd.d/*.res\u3068\u306a\u308a\u307e\u3059\u3002*.res\u306f\u5404\u30ea\u30bd\u30fc\u30b9\u306e\u8a2d\u5b9a(\u8981\u3059\u308b\u306bsync\u3055\u305b\u305f\u3044\u30c7\u30a3\u30b9\u30af\u306e\u8a2d\u5b9a)\u3068\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f*.res\u306fr1.res\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n/etc/drbd.d/global_common.conf\u306b\u3064\u3044\u3066\u306f\u57fa\u672c\u7684\u306b\u306f\u5909\u66f4\u4e0d\u8981\u3067\u3059\u3002\nglobal_common.conf\u306eglobal\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u3042\u308busage-count\u306fDRBD\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304cDRBD\u306e\u5229\u7528\u72b6\u6cc1\u306b\u3064\u3044\u3066\u306e\u7d71\u8a08\u3092\u53d6\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3042\u308a\u3001DRBD\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u305f\u3073\u306bHTTP\u63a5\u7d9a\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u60c5\u5831\u53d6\u5f97\u3068HTTP\u63a5\u7d9a\u3092\u6c17\u306b\u3055\u308c\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001\u8a2d\u5b9a\u3067no\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n/etc/drbd.d/global_common.conf\nglobal {\n        usage-count no;\n        # minor-count dialog-refresh disable-ip-verification\n        # cmd-timeout-short 5; cmd-timeout-medium 121; cmd-timeout-long 600;\n}\n\n\n\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a\u306f\u3001\u4eca\u56de/etc/drbd.d/r1.res\u3078\u8a18\u8f09\u3057\u307e\u3059\u3002\u8272\u3005\u3068\u78ba\u8a8d\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u73fe\u72b6\u3067\u306f\u4e0b\u8a18\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u304c\u30d9\u30b9\u30c8\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n/etc/drbd.d/r1.res\nresource r1 {\n    floating ipv4 192.168.15.xxx:7788 {\n        volume 0 {\n            device       /dev/drbd0 minor 0;\n            disk         /dev/sdb;\n            meta-disk    internal;\n        }\n    }\n    floating ipv4 192.168.15.xxx:7788 {\n        volume 0 {\n            device       /dev/drbd0 minor 0;\n            disk         /dev/sdb;\n            meta-disk    internal;\n        }\n    }\n    net {\n        protocol           C;\n        max-buffers      8000;\n        max-epoch-size   8000;\n    }\n    disk {\n        al-extents       3389;\n        disk-barrier      no;\n        disk-flushes      no;\n    }\n}\n\n\n\n\n\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u5024\u3092\u8272\u3005\u5909\u3048\u3066\u307f\u307e\u3057\u305f\u304c\u3001MySQL\u3067sysbench\u304b\u3051\u308b\u7a0b\u5ea6\u3067\u306f\u5dee\u304c\u307b\u3068\u3093\u3069\u7121\u304b\u3063\u305f\u3067\u3059\u3002\n\n\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e2\u30fc\u30c9\u306eProtocol C\u306f\u5b8c\u5168\u540c\u671f\u30e2\u30fc\u30c9\u3067\u3001B\u3084A\u306f\u6e96\u540c\u671f\u3001\u975e\u540c\u671f\u3060\u304c\u3001B,A\u3067\u3082\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f\u4e0a\u304c\u3089\u306a\u304b\u3063\u305f\u3067\u3059\u3002(\u540c\u69d8\u306bMySQL\u3067sysbench\u7a0b\u5ea6\u3067\u306f\u3002)\n\n\u8a2d\u5b9a\u4f8b\u306a\u3069\u3067\u306f\u3001on hostname { address ... }\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001hostname\u306a\u3069\u66f8\u304d\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067floating\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u7570\u8ad6\u306f\u3042\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3068\u8d77\u52d5\n\u3053\u306e\u624b\u9806\u306f\u521d\u3081\u3066DRBD\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u3060\u3051\u5fc5\u8981\u306a\u64cd\u4f5c\u3067\u3059\u3002\n\u3053\u306e\u64cd\u4f5c\u306fPrimary/Seconday\u4e21\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\n# drbdadm create-md r1\nNew drbd meta data block successfully created.\n\n\n\nDRBD\u306e\u8d77\u52d5\n# drbdadm up r1\n\n\nr1\u306fr1.res\u3067\u5b9a\u7fa9\u3057\u305f\u7269\u3067\u3059\u3002\n\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u30c7\u30a3\u30b9\u30af\u306e\u672b\u5c3e\u306e\u9818\u57df\u306b\u78ba\u4fdd\u3055\u308c\u307e\u3059\u3002\ndrbd\u306e\u72b6\u614b\u306f/proc/drbd\u3092\u898b\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n/proc/drbd\n# cat /proc/drbd\nversion: 8.4.6 (api:1/proto:86-101)\nGIT-hash: 833d830e0152d1e457fa7856e71e11248ccf3f70 build by phil@Build64R7, 2015-04-10 05:13:52\n 0: cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent C r-----\n    ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:41941724\n\n\n\u4e21\u30ce\u30fc\u30c9\u3067drbdadm up r1\u307e\u3067\u5b9f\u884c\u3059\u308b\u3068\u3001cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u30b7\u30f3\u30af\ncs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent\u3053\u3053\u307e\u3067\u6765\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u306e\u30ce\u30fc\u30c9\u3092Primary\u3068\u3057\u3066\u30c7\u30fc\u30bf\u3092\u540c\u671f\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u7a7a\u3063\u307d\u306e\u30c7\u30a3\u30b9\u30af\u3092\u540c\u671f\u3057\u3066\u3082\u6642\u9593\u306e\u7121\u99c4\u306a\u306e\u3067\u3001\u521d\u671f\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n\u521d\u671f\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\n# drbdadm new-current-uuid --clear-bitmap r1/0\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:21879057 dw:21879057 dr:0 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\nr1/0\u306fr1.res\u3067\u5b9a\u7fa9\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u540d\u3068\u30dc\u30ea\u30e5\u30fc\u30e0\u756a\u53f7\u3067\u3059\u3002\nds:UpToDate/UpToDate\u306b\u306a\u308c\u3070\u540c\u671f\u5b8c\u4e86\u306e\u610f\u5473\u3067\u3059\u3002\n\u3053\u308c\u3067\u3001\u540c\u671f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u72b6\u614b\u3068\u306a\u308b\u306e\u3067\u3001\u5229\u7528\u3059\u308b\u5074\u3092Primary\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nPrimary\u306b\u3059\u308b\n# drbdadm primary r1\n\n# cat /proc/drbd\nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:0 dw:0 dr:912 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\nro:Secondary/Secondary\u304b\u3089ro:Primary/Secondary\u306b\u5909\u308f\u308a\u307e\u3057\u305f\u3002\u306a\u304a\u3001Secondary\u5074\u3067\u5b9f\u884c\u3059\u308b\u3068ro:Secondary/Primary\u3068\u306a\u308a\u307e\u3059\u3002\u81ea\u30ce\u30fc\u30c9\u304c\u5148\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u81ea\u5206\u304cPrimary\u306a\u306e\u304bSecondary\u306a\u306e\u304b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u306a\u304a\u3001\u30d5\u30eb\u540c\u671f\u3059\u308b\u5834\u5408\u306f\u3001Primary\u5074\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u30d5\u30eb\u540c\u671f\n# drbdadm --force primary resource1\n\n\n\u3053\u3061\u3089\u306f\u5f37\u5236\u7684\u306bPrimary\u306b\u306a\u308a\u3001Secondary\u5074\u306f\u30c7\u30fc\u30bf\u540c\u671f\u304c\u81ea\u52d5\u7684\u306b\u59cb\u307e\u308a\u307e\u3059\u3002\n\u540c\u671f\u9032\u884c\u4e2d\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u540c\u671f\u9032\u884c\u4e2d\n# cat /proc/drbd\nversion: 8.4.6 (api:1/proto:86-101)\nGIT-hash: 833d830e0152d1e457fa7856e71e11248ccf3f70 build by phil@Build64R7, 2015-04-10 05:13:52\n 0: cs:SyncSource ro:Primary/Secondary ds:UpToDate/Inconsistent C r-----\n    ns:794524 nr:0 dw:0 dr:795436 al:0 bm:0 lo:0 pe:1 ua:0 ap:0 ep:1 wo:f oos:41147712\n        [>....................] sync'ed:  2.0% (40180/40956)M\n        finish: 0:37:18 speed: 18,372 (14,980) K/sec\n\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u4f7f\u3046\ndrbd\u3092\u8d77\u52d5\u3057\u3066\u3069\u3061\u3089\u304b\u3092Primary\u3068\u3059\u308b\u3068\u3001Primary\u5074\u3067/dev/drbd0\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002/dev/drbd0\u306f\u901a\u5e38\u306e\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002Secondary\u5074\u306f/dev/drbd0\u304c\u4f5c\u6210\u3055\u308c\u306a\u3044\u305f\u3081\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u666e\u901a\u306e\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u4f55\u3082\u5909\u308f\u3089\u306a\u3044\u305f\u3081\u3001LVM\u3057\u305f\u308a\u3001\u305d\u306e\u307e\u307e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u305f\u308a\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u524d\u63d0\u306b\u66f8\u3044\u305f\u901a\u308aIDCF Cloud\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002IDCF Cloud\u3067\u306f\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba\u304c\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002\u305d\u3057\u3066\u3001DRBD\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30c7\u30a3\u30b9\u30af\u62e1\u5f35\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u3068\u3044\u3053\u3068\u3067\u3001LVM\u305b\u305a\u306b\u30aa\u30f3\u30e9\u30a4\u30f3\u62e1\u5f35\u3092\u3084\u308a\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002(\u30c7\u30a3\u30b9\u30af\u3092\u675f\u306d\u305f\u308a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u308b\u306e\u3067\u3042\u308c\u3070LVM\u3057\u307e\u3057\u3087\u3046\u3002)\n\u66f8\u304f\u307e\u3067\u3082\u306a\u3044\u3067\u3059\u304c\u3001\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\u666e\u901a\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n# mkfs.xfs -b size=1024 /dev/drbd0\n\n\n\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5358\u7d14\u306bMySQL\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u306b1024\u306e\u65b9\u304c\u65e9\u304b\u3063\u305f\u304b\u3089\u3067\u3059\u3002\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u90e8\u5206\u3067\u3059\u306d\u3002\n\u3053\u308c\u3082\u66f8\u304f\u307e\u3067\u3082\u306a\u3044\u3067\u3059\u304c\u3001\u30de\u30a6\u30f3\u30c8\u3067\u3059\u3002\n\n\u30de\u30a6\u30f3\u30c8\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u9069\u5f53\u3067\u3059\u3002\u306a\u3093\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n\nDRBD\u306e\u8d77\u52d5\u3068\u505c\u6b62\u3068Primary\n\n\u8d77\u52d5\n# drbdadm up r1\n\n\n\n\u505c\u6b62\n# drbdadm down r1\n\n\n\nPrimary\n# drbdadm primary r1\n\n\n\u8d77\u52d5\u3057\u305f\u3060\u3051\u3067\u306fro:Secondary/Secondary\u306b\u306a\u308b\u306e\u3067\u3001\u3069\u3061\u3089\u304b\u3092Primary\u3068\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u306a\u304a\u3001Primary\u3067\u65e2\u306b\u5229\u7528\u4e2d\u306e\u5834\u5408(\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u5834\u5408)\u306fdown\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u306a\u306e\u3067\u3001Primary\u306b\u3059\u308b\u5074\u3067drbdadm primary r1\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30c7\u30a3\u30b9\u30af\u62e1\u5f35\n\u4e00\u3064\u524d\u306b\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001IDCF Cloud\u3067\u306f\u3001\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba\u304c\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002\u305d\u3057\u3066\u3001DRBD\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30c7\u30a3\u30b9\u30af\u62e1\u5f35\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nIDCF Cloud\u5074\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba\nCloud\u30b3\u30f3\u30bd\u30fc\u30eb(\u3082\u3057\u304f\u306fAPI)\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u5bfe\u8c61\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u9078\u629e\u3057\u3001\u30ea\u30b5\u30a4\u30ba\u3092\u5b9f\u884c\u3057\u305f\u304f\u3060\u3055\u3044\u3002Primary/Secondary\u53cc\u65b9\u3067\u5b9f\u884c\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u9078\u629e => \u30dc\u30ea\u30e5\u30fc\u30e0 => \u30dc\u30ea\u30e5\u30fc\u30e0\u64cd\u4f5c\u3078\u3001\u306e\u65b9\u304c\u305f\u3069\u308a\u3084\u3059\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nOS\u306b\u8a8d\u8b58\u3055\u305b\u308b\n\u30c7\u30a3\u30b9\u30af\u304c\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092OS\u5074\u306b\u8a8d\u8b58\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nCentOS 7\u3067\u306fblockdev\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\nblockdev\u3067\u8a8d\u8b58\u3055\u305b\u308b\n# fdisk -l /dev/sdb\n\nDisk /dev/sdb: 53.7 GB, 53687091200 bytes, 104857600 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O \u30b5\u30a4\u30ba (\u6700\u5c0f / \u63a8\u5968): 512 \u30d0\u30a4\u30c8 / 512 \u30d0\u30a4\u30c8\n\n# blockdev --rereadpt /dev/sdb\n\n# fdisk -l /dev/sdb\n\nDisk /dev/sdb: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O \u30b5\u30a4\u30ba (\u6700\u5c0f / \u63a8\u5968): 512 \u30d0\u30a4\u30c8 / 512 \u30d0\u30a4\u30c8\n\n\n53.7GB\u304b\u308964.4GB\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u306a\u304a\u3001\u4ee5\u4e0b\u3067\u3082\u540c\u69d8\u306bOS\u306b\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u5225\u306e\u3084\u308a\u65b9\n# echo 1 > /sys/class/scsi_device/<device>/device/rescan\n\n\n\u6ce8\u610f: \u306a\u304a\u3001\u3053\u306e\u6bb5\u968e\u3067drbdadm down r1\u306a\u3069\u3068down\u3055\u305b\u3066\u3057\u307e\u3046\u3068\u30e1\u30bf\u30c7\u30fc\u30bf\u304c\u767a\u898b\u3067\u304d\u306a\u304f\u306a\u308a(\u30e1\u30bf\u30c7\u30fc\u30bf\u304c\u30c7\u30a3\u30b9\u30af\u306e\u672b\u5c3e\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3002\u62e1\u5f35\u3055\u308c\u3066\u672b\u5c3e\u304c\u5909\u308f\u3063\u305f\u304b\u3089\u3002)drbdadm up r1\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u3082\u3061\u308d\u30931\u56de\u30cf\u30de\u3063\u305f\u3002)\n\ndrbd\u5074\u3092\u62e1\u5f35\nPrimary\u5074\u3067\u4e0b\u8a18\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3053\u306e\u3084\u308a\u65b9\u306f\u8ffd\u52a0\u3057\u305f\u9818\u57df\u306e\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\u3055\u305b\u308b\u3084\u308a\u65b9\u3067\u3059\u3002\u521d\u671f\u540c\u671f\u3068\u540c\u69d8\u306b\u7a7a\u306e\u90e8\u5206\u3092\u540c\u671f\u3057\u3066\u3082\u4ed5\u65b9\u306a\u3044\u70ba\u3067\u3059\u3002\n\ndrbd\u5074\u3067\u62e1\u5f35&\u540c\u671f\u30b9\u30ad\u30c3\u30d7\n# drbdadm -- --assume-clean resize r1\n\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u79fb\u52d5\u306a\u3069\u3082\u3059\u3079\u3066\u81ea\u52d5\u3067\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\n\u4eca\u56de\u306fXFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001xfs_growfs\u3067\u62e1\u5f35\u3057\u307e\u3059\u3002\u3053\u308c\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002ext4\u3067\u3042\u308c\u3070\u3001resize2fs\u3067\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\n\n\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\n# xfs_growfs /var/lib/mysql/\nmeta-data=/dev/drbd0             isize=256    agcount=4, agsize=2621351 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=1024   blocks=10485404, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal               bsize=1024   blocks=10240, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 10485404 to 47184444\n\n\n\n\u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\u6642\u306e\u5bfe\u5fdc\u3068\u58ca\u308c\u305f\u3068\u304d\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\nCloud\u306e\u5834\u5408\u3001\u30c7\u30a3\u30b9\u30af\u3060\u3051\u58ca\u308c\u308b\u4e8b\u306f\u307b\u3068\u3093\u3069\u7121\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u30c7\u30a3\u30b9\u30af\u306e\u53d6\u308a\u5916\u3057\u306a\u3069\u3082\u5bb9\u6613\u306b\u8a66\u305b\u308b\u306e\u3067\u3001\u5b9f\u9a13\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305f\u3001DRBD\u306f\u30c7\u30a3\u30b9\u30af\u304c\u6545\u969c\u3057\u305f\u6642\u306b\u6545\u969c\u3057\u305f\u3053\u3068\u3092\u4e0a\u4f4d\u30ec\u30a4\u30e4\u30fc(\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0)\u306b\u901a\u77e5\u3057\u306a\u3044\u3001\u3068\u884c\u3063\u305f\u8a2d\u5b9a\u304c\u53ef\u80fd(\u30c7\u30d5\u30a9\u30eb\u30c8)\u3067\u3001\u305d\u3046\u3059\u308b\u3068\u3069\u3046\u306a\u308b\u304b\u3068\u3044\u3046\u3068\u3001Secondary\u5074\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u3063\u3066\u304d\u3066\u30c7\u30a3\u30b9\u30af\u306f\u751f\u304d\u3066\u3044\u308b\u304b\u306e\u3088\u3046\u306b\u632f\u821e\u3063\u3066\u304f\u308c\u307e\u3059\u3002\u3064\u307e\u308a\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306f\u7d99\u7d9a\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u51c4\u3044\u3067\u3059\u306d\uff01\n\n\u30c7\u30a3\u30b9\u30af(\u30dc\u30ea\u30e5\u30fc\u30e0)\u3092\u53d6\u308a\u5916\u3059\nIDCF Cloud\u306eCloud\u30b3\u30f3\u30bd\u30fc\u30eb(\u3082\u3057\u304f\u306fAPI)\u304b\u3089\u5bfe\u8c61\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u9078\u629e\u3057\u30c7\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30c7\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\nOS\u304b\u3089\u898b\u308b\u3068\u3001\u3044\u304d\u306a\u308aSCSI Disk\u304c\u7121\u304f\u306a\u3063\u305f\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\ndetachVolume\u3059\u308b\u524d\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0\n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda\n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb\n\n# cat /proc/drbd\nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:0 dw:0 dr:912 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# df -h /var/lib/mysql\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/drbd0        45G  3.7G   42G    9% /var/lib/mysql\n\n# echo \"ABC\" > /var/lib/mysql/write_ok.txt\n# sync\n# ls -la /var/lib/mysql/write_ok.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 11:58 /var/lib/mysql/write_ok.txt\n\n\n\ndetachVolume\u306e\u5f8c\n# lsscsi \n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:Diskless/UpToDate C r-----\n    ns:2076 nr:24580 dw:26624 dr:3720 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# df -h /var/lib/mysql\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/drbd0        45G  3.7G   42G    9% /var/lib/mysql\n\n# echo \"ABC\" > /var/lib/mysql/write_ok2.txt\n# ls -la /var/lib/mysql/write_ok2.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 13:46 /var/lib/mysql/write_ok2.txt\n\n\n\u8868\u9762\u4e0a\u306f\u4f55\u4e8b\u3082\u306a\u304f\u5229\u7528\u3067\u304d\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n/proc/drbd\u3067ds:Diskless/UpToDate\u3068Diskless\u3068\u8a00\u3046\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u4ee3\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u3050\u3089\u3044\u3067\u3059\u3002\n\nOS\u4e0a\u306e\u30ed\u30b0\n# # dmesg | tail -n 20\n[172736.739903] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.739916] sd 2:0:1:0: [sdb] CDB: Read(10) 28 00 00 00 00 02 00 00 01 00\n[172736.739921] blk_update_request: I/O error, dev sdb, sector 2\n[172736.739964] block drbd0: local READ IO error sector 2+1 on sdb\n[172736.739971] block drbd0: disk( UpToDate -> Failed ) \n[172736.739987] block drbd0: Local IO failed in __req_mod. Detaching...\n[172736.740103] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.740106] sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f f4 78 00 00 08 00\n[172736.740108] blk_update_request: I/O error, dev sdb, sector 94368888\n[172736.740131] block drbd0: IO ERROR -5 on bitmap page idx 0\n[172736.740162] block drbd0: bitmap WRITE of 1 pages took 0 jiffies\n[172736.740163] block drbd0: we had at least one MD IO ERROR during bitmap IO\n[172736.740186] block drbd0: 4 KB (1 bits) marked out-of-sync by on disk bit-map.\n[172736.740211] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.740213] sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f ff f8 00 00 08 00\n[172736.740214] blk_update_request: I/O error, dev sdb, sector 94371832\n[172736.740361] block drbd0: drbd_md_sync_page_io(,94371832s,WRITE) failed with error -5\n[172736.740396] block drbd0: meta data update failed!\n[172736.740414] block drbd0: disk( Failed -> Diskless ) \n[172736.742766] block drbd0: receiver updated UUIDs to effective data uuid: 757734BAC87B2EC0\n\n# tail -n 22 /var/log/messages\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Read(10) 28 00 00 00 00 02 00 00 01 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 2\nMar 10 13:43:36 localhost kernel: block drbd0: local READ IO error sector 2+1 on sdb\nMar 10 13:43:36 localhost kernel: block drbd0: disk( UpToDate -> Failed ) \nMar 10 13:43:36 localhost kernel: block drbd0: Local IO failed in __req_mod. Detaching...\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f f4 78 00 00 08 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 94368888\nMar 10 13:43:36 localhost kernel: block drbd0: IO ERROR -5 on bitmap page idx 0\nMar 10 13:43:36 localhost kernel: block drbd0: bitmap WRITE of 1 pages took 0 jiffies\nMar 10 13:43:36 localhost kernel: block drbd0: we had at least one MD IO ERROR during bitmap IO\nMar 10 13:43:36 localhost kernel: block drbd0: 4 KB (1 bits) marked out-of-sync by on disk bit-map.\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f ff f8 00 00 08 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 94371832\nMar 10 13:43:36 localhost kernel: block drbd0: drbd_md_sync_page_io(,94371832s,WRITE) failed with error -5\nMar 10 13:43:36 localhost kernel: block drbd0: meta data update failed!\nMar 10 13:43:36 localhost kernel: block drbd0: disk( Failed -> Diskless ) \nMar 10 13:43:36 localhost kernel: block drbd0: receiver updated UUIDs to effective data uuid: 757734BAC87B2EC0\n\n\n\u6d41\u77f3\u306bOS\u306e\u30ed\u30b0\u306b\u306f\u305d\u3053\u305d\u3053\u8272\u3005\u51fa\u3066\u3044\u307e\u3059\u306d\u3002DRBD\u306eStatus\u306fUptoDate -> Failed -> Diskless\u3068\u5909\u308f\u3063\u3066\u884c\u3063\u305f\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\n\u4e00\u3064\u524d\u3067detachVolume\u3057\u3066\u3057\u307e\u3063\u305f\u30c7\u30a3\u30b9\u30af\u306f\u6368\u3066\u3066\u3001\u65b0\u898f\u306b\u30c7\u30a3\u30b9\u30af\u3092\u63a5\u7d9a\u3057Primary\u306e\u30c7\u30a3\u30b9\u30af\u3092\u5fa9\u5143\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092OS\u304b\u3089\u5207\u308a\u96e2\u3059\ndetachVolume\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u65e2\u306b\u63a5\u7d9a\u306f\u3055\u308c\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001OS\u306f\u307e\u3060\u3042\u308b\u3082\u306e\u3068\u3057\u3066\u51e6\u7406\u3057\u3066\u3044\u307e\u3059\u3002\u307e\u305a\u3001\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092OS\u304b\u3089\u5207\u308a\u96e2\u3057\u307e\u3059\u3002\nSCSI Disk\u306fecho 1 > /sys/block/sdb/device/delete\u3067\u5207\u308a\u96e2\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30c7\u30a3\u30b9\u30af\u306e\u5207\u308a\u96e2\u3057\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n\n# echo 1 > /sys/block/sdb/device/delete \n\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n\n\n\u3053\u308c\u3067/dev/sdb\u3092\u5207\u308a\u96e2\u305b\u307e\u3057\u305f\u3002\n\n\u30c7\u30a3\u30b9\u30af(\u30dc\u30ea\u30e5\u30fc\u30e0)\u306e\u8ffd\u52a0\nIDCF Cloud\u306eCloud\u30b3\u30f3\u30bd\u30fc\u30eb(\u3082\u3057\u304f\u306fAPI)\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210(Secondary\u5074\u3068\u540c\u30b5\u30a4\u30ba)\u3057\u3066Primary Node\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3078\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002(\u30dc\u30ea\u30e5\u30fc\u30e0 => \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210 => \u3067\u304d\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u9078\u629e => \u30a2\u30bf\u30c3\u30c1)\n\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30a2\u30bf\u30c3\u30c1\u3092\u884c\u3044\u307e\u3059\u3002\n\nOS\u306b\u8ffd\u52a0\u3057\u305f\u30c7\u30a3\u30b9\u30af\u3092\u8a8d\u8b58\u3055\u305b\u308b\nSCSI\u306fecho \"- - -\" > /sys/class/scsi_host/host?/scan\u3068\u3059\u308b\u3053\u3068\u3067\u3001SCSI Bus\u306erescan\u304c\u3067\u304d\u307e\u3059\u3002rescan\u3059\u308b\u3053\u3068\u3067\u3001\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30c7\u30a3\u30b9\u30af\u3092\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\nDisk\u3092\u8a8d\u8b58\u3055\u305b\u308b\n# echo \"- - -\" > /sys/class/scsi_host/host0/scan\n# echo \"- - -\" > /sys/class/scsi_host/host1/scan\n# echo \"- - -\" > /sys/class/scsi_host/host2/scan\n# echo \"- - -\" > /sys/class/scsi_host/host3/scan\n# echo \"- - -\" > /sys/class/scsi_host/host4/scan\n# echo \"- - -\" > /sys/class/scsi_host/host5/scan\n# echo \"- - -\" > /sys/class/scsi_host/host6/scan\n\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n\n\nIDCF Cloud\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u306a\u305c\u304bSCSI Card\u304c4\u679a\u3082\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u3089\u3057\u304f\u3001ATA\u3068\u5408\u308f\u305b\u308b\u3068SCSI Card\u304c6\u679a\u3082\u3042\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u5927\u62b5\u306fhost2\u3078\u30c7\u30a3\u30b9\u30af\u304c\u63a5\u7d9a\u3055\u308c\u308b\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u826f\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067SCSI Card\u5206rescan\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002(rescan\u3057\u3066\u3082\u7279\u306b\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002)\n\nDRBD\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u518d\u4f5c\u6210\n\u57fa\u672c\u7684\u306b\u306f\u65b0\u898f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u540c\u3058\u3067\u3059\u3002\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u4f5c\u6210\n# drbdadm create-md r1\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\nsuccess\n\n\n\nDRBD\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\n\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\u3059\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:Diskless/UpToDate C r-----\n    ns:2095 nr:24580 dw:26624 dr:3720 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# drbdadm attach r1 \n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:SyncTarget ro:Primary/Secondary ds:Inconsistent/UpToDate C r-----\n    ns:0 nr:3740 dw:3304 dr:20 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:47181140\n    [>....................] sync'ed:  0.1% (46072/46076)M\n    finish: 7:16:51 speed: 1,652 (1,652) want: 2,160 K/sec\n\n# echo \"ABC\" > /var/lib/mysql/write_ok3.txt\n\n# ls -la /var/lib/mysql/write_ok3.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 14:33 /var/lib/mysql/write_ok3.txt\n\n\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u306a\u304f\u3066\u3082\u3001\u554f\u984c\u306a\u304f\u5229\u7528\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001ds:UpToDate/UpToDate\u306b\u306a\u308a\u307e\u3059\u3002\n\u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\u3060\u3051\u3067\u3042\u308c\u3070\u3001\u518d\u69cb\u7bc9\u307e\u3067\u3059\u3079\u3066\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u5b8c\u7d50\u3057\u3001\u6b62\u307e\u308b\u3053\u3068\u3082\u306a\u3044\u306e\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u7d99\u7d9a\u6027\u3082\u5931\u308f\u308c\u307e\u305b\u3093\u3002(\u9045\u304f\u306f\u306a\u308a\u307e\u3059\u304c\u3002\u3068\u306f\u8a00\u3048\u3001IDCF Cloud\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3082\u30c7\u30a3\u30b9\u30af\u3082\u901f\u3044\u306e\u3067\u3001\u3088\u3063\u307d\u3069\u30c7\u30a3\u30b9\u30af\u30a2\u30af\u30bb\u30b9\u304c\u306a\u3044\u9650\u308a\u306f\u7d50\u69cb\u4f7f\u3048\u308b\u3068\u601d\u3044\u307e\u3059\u3002)\n\nPrimary/Secondary\u306e\u5207\u308a\u66ff\u3048\n\n\u3069\u3061\u3089\u304b\u4e00\u65b9\u304c\u65e2\u306bPrimary\u306e\u5834\u5408\u306f\u3001\u5207\u308a\u63db\u3048\u3089\u308c\u307e\u305b\u3093\u3002\n\u5229\u7528\u4e2d\u306e\u5834\u5408\u306fdown\u3057\u305fSecondary\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n\nprimary\u304c\u3044\u305f\u3089primary\u306b\u306f\u306a\u308c\u306a\u3044\n# drbdadm primary r1\n0: State change failed: (-1) Multiple primaries not allowed by config\nCommand 'drbdsetup-84 primary 0' terminated with exit code 11\n\n\n\n\u5229\u7528\u4e2d\u306f\u30c0\u30e1\n# drbdadm secondary r1\n0: State change failed: (-12) Device is held open by someone\nCommand 'drbdsetup-84 secondary 0' terminated with exit code 11\n\n\n\nmount\u3057\u3066\u306a\u3051\u308c\u3070OK\n# unmount /var/lib/mysql\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:34 nr:47184880 dw:47184478 dr:20 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u304c\u6b63\u3057\u3044\u9806\u756a\u306b\u306a\u308a\u307e\u3059\u3002\n1. \u30b5\u30fc\u30d3\u30b9\u505c\u6b62 (ex:systemctl stop mysqld)\n2. unmount (ex: unmount /dev/drbd0)\n3. primary\u5074\u3067 drbdadm secondary r1\n4. secondary\u5074\u3067\u3001drbdadm primary r1\n\nPrimary\u5074\u304cOS\u3054\u3068\u6b7b\u3093\u3060\u6642\n\u3053\u306e\u5834\u5408\u3001\u307e\u305a\u306f\u30b5\u30fc\u30d3\u30b9\u5fa9\u65e7\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001Secondary\u3092Primary\u306b\u6607\u683c\u3057\u3001\u30de\u30a6\u30f3\u30c8\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u65e2\u306bPrimary\u304c\u6b7b\u3093\u3067\u3044\u308b\u306e\u3067\u666e\u901a\u306bPrimary\u306b\u6607\u683c\u3057\u3066\u3057\u307e\u3063\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\nPrimary\u306b\u6607\u683c\u3057\u3066\u30de\u30a6\u30f3\u30c8\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:47212713 nr:8448 dw:8448 dr:47212713 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Primary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:47212713 nr:8448 dw:8448 dr:47213625 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n\n\n\u3053\u306e\u5f8c\u306f\u3001\u58ca\u308c\u305f\u5143Primary\u3092\u5fa9\u65e7\u3059\u308b\u308f\u3051\u3067\u3059\u304c\u3001\u3053\u308c\u306f\u65b0\u898f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u540c\u69d8\u306b\u9032\u3081\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002drbdadb up r1\u3057\u305f\u6642\u70b9\u3067\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\u4e00\u3064\u554f\u984c\u304c\u3042\u308b\u3068\u3059\u308b\u3068\u3001IP\u30a2\u30c9\u30ec\u30b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002DRBD\u3067\u306f\u5f8c\u304b\u3089IP\u3092\u5909\u66f4\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002(\u3068\u601d\u3046\u3002\u65b9\u6cd5\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3002)IDCF Cloud\u306e\u5834\u5408\u7279\u306b\u4f55\u3082\u8003\u3048\u306a\u3044\u3068DHCP\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002IDCF Cloud\u306fIP\u3092static\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u306eIP\u306fstatic\u306b\u7ba1\u7406\u3057\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306b\u3064\u3044\u3066\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3068\u306f\u4e21\u65b9\u306e\u30ce\u30fc\u30c9\u304cPrimay\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u72b6\u614b\u306e\u3053\u3068\u3092\u8a00\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3069\u3061\u3089\u3082\u66f8\u304d\u8fbc\u307f\u304c\u3067\u304d\u3066\u3057\u307e\u3046\u5927\u5909\u5371\u967a\u306a\u72b6\u614b\u3067\u3059\u3002\n\u4eca\u307e\u3067\u306e\u8aac\u660e\u3067\u3082\u308f\u304b\u308b\u3088\u3046\u306b\u3001\u52dd\u624b\u306bPrimary/Primary\u306e\u72b6\u614b\u306b\u306f\u306a\u308a\u307e\u305b\u3093\u3002\u4eba\u70ba\u7684\u30df\u30b9\u3084\u30af\u30e9\u30b9\u30bf\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30df\u30b9\u306b\u3088\u308a\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5206\u65ad\u304c\u767a\u751f\u3057\u3066\u3001\u4e21\u30ce\u30fc\u30c9\u304c\u304a\u4e92\u3044\u3092\u8a8d\u8b58\u3067\u304d\u306a\u3044\u72b6\u614b\u306e\u6642\u3001Secondary\u5074\u3067drbdadm primary r1\u306a\u3069\u3059\u308b\u3068\u767a\u751f\u3057\u307e\u3059\u3002\n\u969c\u5bb3\u304c\u767a\u751f\u3057\u3066Secondary Node\u3067drbdadm primary r1\u3059\u308b\u6642\u306f\u3001\u5fc5\u305a\u5143Primary\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u304b\u3089\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u3082\u3057\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u72b6\u614b\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u7247\u65b9\u306e\u30c7\u30fc\u30bf\u3092\u8ae6\u3081\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306e\u5b9f\u9a13\n\u3053\u3053\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u3092\u518d\u73fe\u3057\u3066\u3001\u5b9f\u9a13\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u505c\u6b62\n\u5358\u7d14\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u3057\u3066\u518d\u73fe\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fPrimary\u5074\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30c0\u30a6\u30f3\u3055\u305b\u307e\u3059\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5206\u65ad\n# nmcli connection down f773ed44-f459-490e-acef-568376f1126b\nConnection 'eno33557248' successfully deactivated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/0)\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u6642\u306eDRBD\u306e\u72b6\u614b\n\nPrimary\u5074\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:2056 nr:0 dw:0 dr:3880 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u304c\u767a\u751f\u3059\u308b\u3068cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown\u3068\u306a\u308a\u3001StandAlone\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002StandAlone\u306f\u30ea\u30bd\u30fc\u30b9\u304cdisconnect\u72b6\u614b\u306a\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u306f\u4f7f\u3048\u3066\u3044\u308b\u304c\u3001drbd\u304b\u3089\u306f\u5207\u308a\u96e2\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002(\u6b63\u78ba\u3067\u306f\u306a\u3044\u304b\u3082\u3002)\n\u3053\u306e\u6642\u3001Secondary\u5074\u3092\u898b\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nSecondary\u5074\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:2056 dw:4106 dr:13380 al:4 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\nSecondary\u5074\u306fStandAlone\u30e2\u30fc\u30c9\u306b\u306f\u306a\u3089\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\nSecondary\u5074\u3092Primary\u306b\u6607\u683c\n\u3053\u306e\u72b6\u614b\u306e\u5834\u5408\u3001Secondary\u306fPrimary\u304c\u5c45\u306a\u3044\u306e\u3067Primary\u306b\u6607\u683c\u3067\u304d\u307e\u3059\u3002\n\nPrimary\u306b\u6607\u683c\u3055\u305b\u308b\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Primary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:2056 dw:4106 dr:14292 al:4 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n\n\n\u3053\u308c\u3067\u4e21\u65b9\u304c\u300c\u81ea\u5206\u306fPrimary\u3060\u300d\u3068\u8a00\u3063\u3066\u3044\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3069\u3063\u3061\u3089\u306b\u3082\u66f8\u304d\u8fbc\u3081\u3066\u3057\u307e\u3046\u5384\u4ecb\u306a\u72b6\u614b\u3067\u3059\u3002\u4e21\u65b9\u306b\u66f8\u304d\u8fbc\u3080\u3068\u30c7\u30fc\u30bf\u304c\u5206\u65ad\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u306d\u3002\n\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306e\u89e3\u6d88\n\u3053\u3046\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u306e\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\u6b8b\u3059\u65b9\u3092\u6c7a\u3081\u3066\u3001\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u65b9\u304b\u3089\u53d6\u308a\u51fa\u3057\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3092\u89e3\u6d88\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u505c\u6b62\u3057\u305f\u3001\u6700\u521d\u304b\u3089Primary\u306e\u65b9\u306e\u30c7\u30fc\u30bf\u3092\u6b8b\u3059\u5f62\u3067\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3092\u89e3\u6d88\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4e21\u30ce\u30fc\u30c9\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\n\u52d5\u304d\u3092\u78ba\u8a8d\u3057\u305f\u3044\u306e\u3067\u3001\u4e21\u30ce\u30fc\u30c9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\n\u5143\u304b\u3089Primary\u306b\u66f8\u304d\u8fbc\u307f\n# echo \"ABC\" > /var/lib/mysql/write_ok_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 17:55 /var/lib/mysql/write_ok_primary.txt\n\n\n\n\u5143\u306fSecondary\u306b\u66f8\u304d\u8fbc\u307f\n# echo \"ABC\" > /var/lib/mysql/write_ok_new_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_new_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 17:54 /var/lib/mysql/write_ok_new_primary.txt\n\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5fa9\u65e7\n\u5148\u305a\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30c0\u30a6\u30f3\u3057\u305f\u5143\u3005Primary\u5074\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5fa9\u65e7\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5fa9\u65e7\n# nmcli connection up f773ed44-f459-490e-acef-568376f1126b \n\u63a5\u7d9a\u304c\u6b63\u5e38\u306b\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f (D-Bus \u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30b9: /org/freedesktop/NetworkManager/ActiveConnection/3)\n\n\n\n\u5143Secondary\u3092StandAlone\u3078\u5207\u308a\u66ff\u3048\n\u6b21\u306b\u5143Secondary\u3092StandAlone\u306e\u63a5\u7d9a\u72b6\u614b\u3078\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u30ce\u30fc\u30c9\u306fStandAlone\u72b6\u614b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nStandAlone\u3078\u79fb\u884c\n# drbdadm disconnect r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:0 nr:2056 dw:8268 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n\n\n\n\u5143Secondary\u3092Secondary\u306b\u623b\u3059\n\u6b21\u306b\u5143Secondary\u3092Secondary\u306b\u623b\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u3068secondary\u306b\u3067\u304d\u306a\u3044\u305f\u3081\u3001unmount\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nSecondary\u306b\u5909\u66f4\u3059\u308b\n# umount /var/lib/mysql/\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Secondary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:0 nr:2056 dw:8271 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n\n\n\n\u5143Secondary\u306eStandAlone\u306e\u56de\u5fa9\u3068\u30c7\u30fc\u30bf\u7834\u68c4\n\u6b21\u306bStandAlone\u304b\u3089\u306e\u56de\u5fa9\u3068\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u304c\u8d77\u304d\u3066\u304b\u3089\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u7834\u68c4\u3057\u307e\u3059\u3002\n\n\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u7834\u68c4\n# drbdadm connect --discard-my-data r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:0 dw:8271 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n\n\n\n\u5143\u3005Primary\u306e\u65b9\u3092StandAlone\u304b\u3089\u56de\u5fa9\n\u5143\u3005Primary\u306e\u65b9\u304c\u307e\u3060StandAlone\u72b6\u614b\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u56de\u5fa9\u3057\u307e\u3059\u3002\n\n\u5143\u3005Primary\u3092StandAlone\u304b\u3089\u56de\u5fa9\n# drbdadm connect r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:2096 nr:0 dw:0 dr:5976 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\n\u5143\u3005Primary\u306e\u65b9\u306b\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u304cSecondary\u306b\u540c\u671f\u3055\u308c\u3001ds:UpToDate/UpToDate\u306b\u306a\u308c\u3070\u3001\u5fa9\u65e7\u5b8c\u4e86\u3067\u3059\u3002\n\nSecondary\u306e\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\nSecondary\u306e\u30c7\u30fc\u30bf\u304c\u7834\u68c4\u3055\u308c\u3066\u3001\u5143\u3005Primary\u3068\u540c\u3058\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\nPrimary\u306e\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\n# ls -la /var/lib/mysql/write_ok_primary.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 18:23 /var/lib/mysql/write_ok_primary.txt\n\n\n\nPrimary\u3092Secondary\u306b\u964d\u683c\n# umount /var/lib/mysql/\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:2090 nr:0 dw:2082 dr:10876 al:5 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\n\n\u5143\u3005Secondary\u3092Primary\u306b\u6607\u683c\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:2090 dw:16587 dr:23609 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n\n\n\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n\n# ls -la /var/lib/mysql/write_ok_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 18:23 /var/lib/mysql/write_ok_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_new_primary.txt\nls: /var/lib/mysql/write_ok_new_primary.txt \u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093: \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093\n\n\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u6642\u306b\u66f8\u304d\u8fbc\u3093\u3060write_ok_new_primary.txt\u304c\u7121\u304f\u3001write_ok_primary.txt\u304c\u540c\u671f\u3067\u304d\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u30af\u30e9\u30b9\u30bf\u30bd\u30d5\u30c8\nDRBD\u3060\u3051\u3067\u306fPrimary\u30ce\u30fc\u30c9\u306e\u969c\u5bb3\u6642\u306b\u969c\u5bb3\u3092\u691c\u77e5\u3057\u3066\u3001Secondary\u30ce\u30fc\u30c9\u3092Primary\u3078\u6607\u683c\u306a\u3069\u3068\u3044\u3063\u305f\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3053\u308c\u3089\u306f\u5225\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nDRBD\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306fPacemaker\u3001Red Hat Cluster Suite\u3068\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4eca\u306e\u3068\u3053\u308d\u81ea\u5206\u306f\u3053\u306e\u90e8\u5206\u306b\u8208\u5473\u304c\u306a\u3044\u306e\u3067\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u898b\u3066\u9811\u5f35\u3063\u3066\u304f\u3060\u3055\u3044\uff01\n# DRBD\u306b\u3064\u3044\u3066\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u305f\nDRBD\u3092\u4f7f\u3046\u4e0a\u3067\u5fc5\u8981\u305d\u3046\u306a\u90e8\u5206\u3092\u8abf\u3079\u305f\u306e\u3067\u307e\u3068\u3081\u3067\u3059\u3002\n\u3082\u3057\u304b\u3059\u308b\u3068\u3001\u901a\u77e5\u95a2\u9023\u3092\u8abf\u3079\u3066\u5f8c\u65e5\u8f09\u305b\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n## \u524d\u63d0\n* CentOS 7 + [ELRepo](http://elrepo.org/)\u306eDRBD\u3092\u60f3\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n* Primary Node\u3068Secondary Node\u306fIP Reachable\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n* /dev/sdb\u3092\u540c\u671f\u3059\u308b\u8a2d\u5b9a\u3068\u3057\u3066\u3044\u307e\u3059\u3002(/dev/sda\u306fOS\u304c\u5229\u7528\u3002)\n* DRBD 8.4\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f[\u3053\u3061\u3089](https://blog.3ware.co.jp/drbd-users-guide-8.4/drbd-users-guide.html)\u3002\n\n\u3053\u3053\u3067\u306f\u3001CentOS 7(+ yum update)\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3067IP Reachable\u306a\u74b0\u5883\u304c\u3059\u3067\u306b\u5b58\u5728\u3059\u308b\u6240\u304b\u3089\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u5177\u4f53\u7684\u306b\u306f[IDCF Cloud](http://www.idcf.jp/cloud/)\u306b[\u6a19\u6e96\u3067\u7528\u610f\u3055\u308c\u3066\u3044\u308bCentOS 7](http://www.idcf.jp/cloud/spec/os.html)\u3078[\u30c7\u30fc\u30bf\u30c7\u30a3\u30b9\u30af](http://www.idcf.jp/cloud/spec/disk.html)\u30921\u53f0\u63a5\u7d9a\u3057\u3001[\u8ffd\u52a0\u30cd\u30c3\u30c8\u30ef\u30fc\u30af](http://www.idcf.jp/cloud/spec/vlan.html#SEC02)\u3092\u5229\u7528\u3057\u3066DRBD\u306e\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u3068\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u4f59\u8ac7\u3067\u3059\u304c[\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b3\u30cd\u30af\u30c8](http://www.idcf.jp/cloud/connect/)\u3092\u5229\u7528\u3057\u3001[\u30be\u30fc\u30f3\u9593\u3084\u30ea\u30fc\u30b8\u30e7\u30f3\u9593](http://www.idcf.jp/cloud/spec/region_zone.html)\u3067\u3082\u554f\u984c\u306a\u304fDRBD\u306e\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n## ELRepo\u3092\u6709\u52b9\u306b\n[ELRepo](http://elrepo.org/)\u306e\u30c8\u30c3\u30d7\u30da\u30fc\u30b8\u306b**Get started**\u304c\u3042\u308b\u305f\u3081\u3001\u7279\u306b\u8ff7\u3046\u3053\u3068\u306f\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u7c21\u5358\u306b\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u57fa\u672c\u7684\u306b\u306f\u30ec\u30dd\u30b8\u30c8\u30ea\u306erpm\u3092\u3044\u308c\u308c\u3070\u6709\u52b9\u306b\u3067\u304d\u307e\u3059\u3002\n\n```:ELRepo\u306erpm\u3092\u5165\u308c\u308b\u3002\n# yum -y install http://elrepo.org/linux/elrepo/el7/x86_64/RPMS/elrepo-release-7.0-2.el7.elrepo.noarch.rpm\n```\n\n\u6700\u65b0\u7248\u306f\u306erpm\u306f[\u3053\u306e\u8fba](http://elrepo.org/linux/elrepo/el7/x86_64/RPMS/)\u304b\u3089\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n## DRBD\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```:DRBD\u3092\u5165\u308c\u308b\n# yum -y install drbd84-utils kmod-drbd84\n```\n\n## DRBD\u306e\u8a2d\u5b9a\n\u30b3\u30f3\u30d5\u30a3\u30b0\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u306f`/etc/drbd.d/global_common.conf`\u3068`/etc/drbd.d/*.res`\u3068\u306a\u308a\u307e\u3059\u3002`*.res`\u306f\u5404\u30ea\u30bd\u30fc\u30b9\u306e\u8a2d\u5b9a(\u8981\u3059\u308b\u306bsync\u3055\u305b\u305f\u3044\u30c7\u30a3\u30b9\u30af\u306e\u8a2d\u5b9a)\u3068\u306a\u308a\u307e\u3059\u3002\u4eca\u56de\u306f`*.res`\u306f`r1.res`\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n`/etc/drbd.d/global_common.conf`\u306b\u3064\u3044\u3066\u306f\u57fa\u672c\u7684\u306b\u306f\u5909\u66f4\u4e0d\u8981\u3067\u3059\u3002\n`global_common.conf`\u306e**global\u30bb\u30af\u30b7\u30e7\u30f3**\u306b\u3042\u308b**usage-count**\u306fDRBD\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u304cDRBD\u306e\u5229\u7528\u72b6\u6cc1\u306b\u3064\u3044\u3066\u306e\u7d71\u8a08\u3092\u53d6\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3042\u308a\u3001DRBD\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u305f\u3073\u306bHTTP\u63a5\u7d9a\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u60c5\u5831\u53d6\u5f97\u3068HTTP\u63a5\u7d9a\u3092\u6c17\u306b\u3055\u308c\u308b\u3088\u3046\u3067\u3042\u308c\u3070\u3001\u8a2d\u5b9a\u3067`no`\u306b\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```:/etc/drbd.d/global_common.conf\nglobal {\n        usage-count no;\n        # minor-count dialog-refresh disable-ip-verification\n        # cmd-timeout-short 5; cmd-timeout-medium 121; cmd-timeout-long 600;\n}\n```\n\n\u30ea\u30bd\u30fc\u30b9\u8a2d\u5b9a\u306f\u3001\u4eca\u56de`/etc/drbd.d/r1.res`\u3078\u8a18\u8f09\u3057\u307e\u3059\u3002\u8272\u3005\u3068\u78ba\u8a8d\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u73fe\u72b6\u3067\u306f\u4e0b\u8a18\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u304c\u30d9\u30b9\u30c8\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n```:/etc/drbd.d/r1.res\nresource r1 {\n    floating ipv4 192.168.15.xxx:7788 {\n        volume 0 {\n            device       /dev/drbd0 minor 0;\n            disk         /dev/sdb;\n            meta-disk    internal;\n        }\n    }\n    floating ipv4 192.168.15.xxx:7788 {\n        volume 0 {\n            device       /dev/drbd0 minor 0;\n            disk         /dev/sdb;\n            meta-disk    internal;\n        }\n    }\n    net {\n        protocol           C;\n        max-buffers      8000;\n        max-epoch-size   8000;\n    }\n    disk {\n        al-extents       3389;\n        disk-barrier      no;\n        disk-flushes      no;\n    }\n}\n```\n\n* [\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u30ac\u30a4\u30c9](https://blog.3ware.co.jp/drbd-users-guide-8.4/ch-throughput.html#s-throughput-tuning)\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u5024\u3092\u8272\u3005\u5909\u3048\u3066\u307f\u307e\u3057\u305f\u304c\u3001MySQL\u3067sysbench\u304b\u3051\u308b\u7a0b\u5ea6\u3067\u306f\u5dee\u304c\u307b\u3068\u3093\u3069\u7121\u304b\u3063\u305f\u3067\u3059\u3002\n* [\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30e2\u30fc\u30c9](https://blog.3ware.co.jp/drbd-users-guide-8.4/ch-features.html#s-replication-protocols)\u306eProtocol C\u306f\u5b8c\u5168\u540c\u671f\u30e2\u30fc\u30c9\u3067\u3001B\u3084A\u306f\u6e96\u540c\u671f\u3001\u975e\u540c\u671f\u3060\u304c\u3001B,A\u3067\u3082\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f\u4e0a\u304c\u3089\u306a\u304b\u3063\u305f\u3067\u3059\u3002(\u540c\u69d8\u306bMySQL\u3067sysbench\u7a0b\u5ea6\u3067\u306f\u3002)\n* [\u8a2d\u5b9a\u4f8b](https://blog.3ware.co.jp/drbd-users-guide-8.4/ch-configure.html#s-drbdconf-example)\u306a\u3069\u3067\u306f\u3001`on hostname { address ... }`\u3068\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001_hostname_\u306a\u3069\u66f8\u304d\u305f\u304f\u306a\u304b\u3063\u305f\u306e\u3067`floating`\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n* \u7570\u8ad6\u306f\u3042\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n## \u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3068\u8d77\u52d5\n\u3053\u306e\u624b\u9806\u306f\u521d\u3081\u3066DRBD\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306b\u3060\u3051\u5fc5\u8981\u306a\u64cd\u4f5c\u3067\u3059\u3002\n\u3053\u306e\u64cd\u4f5c\u306fPrimary/Seconday\u4e21\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```:\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\n# drbdadm create-md r1\nNew drbd meta data block successfully created.\n```\n\n```:DRBD\u306e\u8d77\u52d5\n# drbdadm up r1\n```\n\n`r1`\u306fr1.res\u3067\u5b9a\u7fa9\u3057\u305f\u7269\u3067\u3059\u3002\n\u30e1\u30bf\u30c7\u30fc\u30bf\u306f\u30c7\u30a3\u30b9\u30af\u306e\u672b\u5c3e\u306e\u9818\u57df\u306b\u78ba\u4fdd\u3055\u308c\u307e\u3059\u3002\n\ndrbd\u306e\u72b6\u614b\u306f`/proc/drbd`\u3092\u898b\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```:/proc/drbd\n# cat /proc/drbd\nversion: 8.4.6 (api:1/proto:86-101)\nGIT-hash: 833d830e0152d1e457fa7856e71e11248ccf3f70 build by phil@Build64R7, 2015-04-10 05:13:52\n 0: cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent C r-----\n    ns:0 nr:0 dw:0 dr:0 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:f oos:41941724\n```\n\n\u4e21\u30ce\u30fc\u30c9\u3067`drbdadm up r1`\u307e\u3067\u5b9f\u884c\u3059\u308b\u3068\u3001`cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent`\u306b\u306a\u308a\u307e\u3059\u3002\n\n## \u30c7\u30fc\u30bf\u30b7\u30f3\u30af\n`cs:Connected ro:Secondary/Secondary ds:Inconsistent/Inconsistent`\u3053\u3053\u307e\u3067\u6765\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u306e\u30ce\u30fc\u30c9\u3092Primary\u3068\u3057\u3066\u30c7\u30fc\u30bf\u3092\u540c\u671f\u3059\u308b\u306e\u3067\u3059\u304c\u3001\u7a7a\u3063\u307d\u306e\u30c7\u30a3\u30b9\u30af\u3092\u540c\u671f\u3057\u3066\u3082\u6642\u9593\u306e\u7121\u99c4\u306a\u306e\u3067\u3001\u521d\u671f\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n```:\u521d\u671f\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\n# drbdadm new-current-uuid --clear-bitmap r1/0\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:21879057 dw:21879057 dr:0 al:8 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n`r1/0`\u306f`r1.res`\u3067\u5b9a\u7fa9\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u540d\u3068\u30dc\u30ea\u30e5\u30fc\u30e0\u756a\u53f7\u3067\u3059\u3002\nds:UpToDate/UpToDate\u306b\u306a\u308c\u3070\u540c\u671f\u5b8c\u4e86\u306e\u610f\u5473\u3067\u3059\u3002\n\u3053\u308c\u3067\u3001\u540c\u671f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u72b6\u614b\u3068\u306a\u308b\u306e\u3067\u3001\u5229\u7528\u3059\u308b\u5074\u3092Primary\u3068\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```:Primary\u306b\u3059\u308b\n# drbdadm primary r1\n\n# cat /proc/drbd\nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:0 dw:0 dr:912 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n`ro:Secondary/Secondary`\u304b\u3089`ro:Primary/Secondary`\u306b\u5909\u308f\u308a\u307e\u3057\u305f\u3002\u306a\u304a\u3001Secondary\u5074\u3067\u5b9f\u884c\u3059\u308b\u3068`ro:Secondary/Primary`\u3068\u306a\u308a\u307e\u3059\u3002\u81ea\u30ce\u30fc\u30c9\u304c\u5148\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u81ea\u5206\u304cPrimary\u306a\u306e\u304bSecondary\u306a\u306e\u304b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u30d5\u30eb\u540c\u671f\u3059\u308b\u5834\u5408\u306f\u3001Primary\u5074\u3067\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```:\u30d5\u30eb\u540c\u671f\n# drbdadm --force primary resource1\n```\n\n\u3053\u3061\u3089\u306f\u5f37\u5236\u7684\u306bPrimary\u306b\u306a\u308a\u3001Secondary\u5074\u306f\u30c7\u30fc\u30bf\u540c\u671f\u304c\u81ea\u52d5\u7684\u306b\u59cb\u307e\u308a\u307e\u3059\u3002\n\u540c\u671f\u9032\u884c\u4e2d\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```:\u540c\u671f\u9032\u884c\u4e2d\n# cat /proc/drbd\nversion: 8.4.6 (api:1/proto:86-101)\nGIT-hash: 833d830e0152d1e457fa7856e71e11248ccf3f70 build by phil@Build64R7, 2015-04-10 05:13:52\n 0: cs:SyncSource ro:Primary/Secondary ds:UpToDate/Inconsistent C r-----\n    ns:794524 nr:0 dw:0 dr:795436 al:0 bm:0 lo:0 pe:1 ua:0 ap:0 ep:1 wo:f oos:41147712\n        [>....................] sync'ed:  2.0% (40180/40956)M\n        finish: 0:37:18 speed: 18,372 (14,980) K/sec\n```\n\n## \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u4f7f\u3046\ndrbd\u3092\u8d77\u52d5\u3057\u3066\u3069\u3061\u3089\u304b\u3092Primary\u3068\u3059\u308b\u3068\u3001Primary\u5074\u3067`/dev/drbd0`\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002`/dev/drbd0`\u306f\u901a\u5e38\u306e\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002Secondary\u5074\u306f`/dev/drbd0`\u304c\u4f5c\u6210\u3055\u308c\u306a\u3044\u305f\u3081\u5229\u7528\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u666e\u901a\u306e\u30d6\u30ed\u30c3\u30af\u30c7\u30d0\u30a4\u30b9\u3068\u4f55\u3082\u5909\u308f\u3089\u306a\u3044\u305f\u3081\u3001LVM\u3057\u305f\u308a\u3001\u305d\u306e\u307e\u307e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u305f\u308a\u3057\u3066\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u524d\u63d0\u306b\u66f8\u3044\u305f\u901a\u308a[IDCF Cloud](http://www.idcf.jp/cloud/)\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002[IDCF Cloud](http://www.idcf.jp/cloud/)\u3067\u306f\u3001[\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba](https://www.faq.idcf.jp/app/answers/detail/a_id/120/c/15/related/1/session/L2F2LzEvdGltZS8xNDU3NTE2NDY0L3NpZC8xRDNKTSpLbQ%3D%3D)\u304c\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002\u305d\u3057\u3066\u3001DRBD\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30c7\u30a3\u30b9\u30af\u62e1\u5f35\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u3068\u3044\u3053\u3068\u3067\u3001LVM\u305b\u305a\u306b\u30aa\u30f3\u30e9\u30a4\u30f3\u62e1\u5f35\u3092\u3084\u308a\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002(\u30c7\u30a3\u30b9\u30af\u3092\u675f\u306d\u305f\u308a\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u5207\u308b\u306e\u3067\u3042\u308c\u3070LVM\u3057\u307e\u3057\u3087\u3046\u3002)\n\n\u66f8\u304f\u307e\u3067\u3082\u306a\u3044\u3067\u3059\u304c\u3001\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n```:\u666e\u901a\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n# mkfs.xfs -b size=1024 /dev/drbd0\n```\n\n\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u5358\u7d14\u306bMySQL\u3067\u5229\u7528\u3059\u308b\u5834\u5408\u306b1024\u306e\u65b9\u304c\u65e9\u304b\u3063\u305f\u304b\u3089\u3067\u3059\u3002\u74b0\u5883\u306b\u4f9d\u5b58\u3059\u308b\u90e8\u5206\u3067\u3059\u306d\u3002\n\n\u3053\u308c\u3082\u66f8\u304f\u307e\u3067\u3082\u306a\u3044\u3067\u3059\u304c\u3001\u30de\u30a6\u30f3\u30c8\u3067\u3059\u3002\n\n```:\u30de\u30a6\u30f3\u30c8\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n```\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u3082\u9069\u5f53\u3067\u3059\u3002\u306a\u3093\u3067\u3082\u4f7f\u3048\u307e\u3059\u3002\n\n## DRBD\u306e\u8d77\u52d5\u3068\u505c\u6b62\u3068Primary\n\n```:\u8d77\u52d5\n# drbdadm up r1\n```\n\n```:\u505c\u6b62\n# drbdadm down r1\n```\n\n```:Primary\n# drbdadm primary r1\n```\n\n\u8d77\u52d5\u3057\u305f\u3060\u3051\u3067\u306f`ro:Secondary/Secondary`\u306b\u306a\u308b\u306e\u3067\u3001\u3069\u3061\u3089\u304b\u3092Primary\u3068\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u306a\u304a\u3001Primary\u3067\u65e2\u306b\u5229\u7528\u4e2d\u306e\u5834\u5408(\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u5834\u5408)\u306fdown\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u306a\u306e\u3067\u3001Primary\u306b\u3059\u308b\u5074\u3067`drbdadm primary r1`\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n# \u30c7\u30a3\u30b9\u30af\u62e1\u5f35\n\u4e00\u3064\u524d\u306b\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001[IDCF Cloud](http://www.idcf.jp/cloud/)\u3067\u306f\u3001[\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba](https://www.faq.idcf.jp/app/answers/detail/a_id/120/c/15/related/1/session/L2F2LzEvdGltZS8xNDU3NTE2NDY0L3NpZC8xRDNKTSpLbQ%3D%3D)\u304c\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002\u305d\u3057\u3066\u3001DRBD\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30c7\u30a3\u30b9\u30af\u62e1\u5f35\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## IDCF Cloud\u5074\u3067\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30ea\u30b5\u30a4\u30ba\n[Cloud\u30b3\u30f3\u30bd\u30fc\u30eb](https://idcfcloud.com/)([\u3082\u3057\u304f\u306fAPI](http://www.idcf.jp/cloud/spec/api.html))\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u5bfe\u8c61\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u9078\u629e\u3057\u3001\u30ea\u30b5\u30a4\u30ba\u3092\u5b9f\u884c\u3057\u305f\u304f\u3060\u3055\u3044\u3002Primary/Secondary\u53cc\u65b9\u3067\u5b9f\u884c\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u9078\u629e => \u30dc\u30ea\u30e5\u30fc\u30e0 => \u30dc\u30ea\u30e5\u30fc\u30e0\u64cd\u4f5c\u3078\u3001\u306e\u65b9\u304c\u305f\u3069\u308a\u3084\u3059\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## OS\u306b\u8a8d\u8b58\u3055\u305b\u308b\n\u30c7\u30a3\u30b9\u30af\u304c\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092OS\u5074\u306b\u8a8d\u8b58\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nCentOS 7\u3067\u306fblockdev\u3092\u4f7f\u3063\u3066\u7c21\u5358\u306b\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```:blockdev\u3067\u8a8d\u8b58\u3055\u305b\u308b\n# fdisk -l /dev/sdb\n\nDisk /dev/sdb: 53.7 GB, 53687091200 bytes, 104857600 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O \u30b5\u30a4\u30ba (\u6700\u5c0f / \u63a8\u5968): 512 \u30d0\u30a4\u30c8 / 512 \u30d0\u30a4\u30c8\n\n# blockdev --rereadpt /dev/sdb\n\n# fdisk -l /dev/sdb\n\nDisk /dev/sdb: 64.4 GB, 64424509440 bytes, 125829120 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O \u30b5\u30a4\u30ba (\u6700\u5c0f / \u63a8\u5968): 512 \u30d0\u30a4\u30c8 / 512 \u30d0\u30a4\u30c8\n```\n\n53.7GB\u304b\u308964.4GB\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\u306a\u304a\u3001\u4ee5\u4e0b\u3067\u3082\u540c\u69d8\u306bOS\u306b\u62e1\u5f35\u3055\u308c\u305f\u3053\u3068\u3092\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```:\u5225\u306e\u3084\u308a\u65b9\n# echo 1 > /sys/class/scsi_device/<device>/device/rescan\n```\n\n**\u6ce8\u610f:** \u306a\u304a\u3001\u3053\u306e\u6bb5\u968e\u3067`drbdadm down r1`\u306a\u3069\u3068down\u3055\u305b\u3066\u3057\u307e\u3046\u3068\u30e1\u30bf\u30c7\u30fc\u30bf\u304c\u767a\u898b\u3067\u304d\u306a\u304f\u306a\u308a(\u30e1\u30bf\u30c7\u30fc\u30bf\u304c\u30c7\u30a3\u30b9\u30af\u306e\u672b\u5c3e\u306b\u5b58\u5728\u3059\u308b\u305f\u3081\u3002\u62e1\u5f35\u3055\u308c\u3066\u672b\u5c3e\u304c\u5909\u308f\u3063\u305f\u304b\u3089\u3002)`drbdadm up r1`\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u306e\u3067\u3001\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002(\u3082\u3061\u308d\u30931\u56de\u30cf\u30de\u3063\u305f\u3002)\n\n## drbd\u5074\u3092\u62e1\u5f35\nPrimary\u5074\u3067\u4e0b\u8a18\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3053\u306e\u3084\u308a\u65b9\u306f\u8ffd\u52a0\u3057\u305f\u9818\u57df\u306e\u540c\u671f\u3092\u30b9\u30ad\u30c3\u30d7\u3055\u305b\u308b\u3084\u308a\u65b9\u3067\u3059\u3002\u521d\u671f\u540c\u671f\u3068\u540c\u69d8\u306b\u7a7a\u306e\u90e8\u5206\u3092\u540c\u671f\u3057\u3066\u3082\u4ed5\u65b9\u306a\u3044\u70ba\u3067\u3059\u3002\n\n```:drbd\u5074\u3067\u62e1\u5f35&\u540c\u671f\u30b9\u30ad\u30c3\u30d7\n# drbdadm -- --assume-clean resize r1\n```\n\n\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u79fb\u52d5\u306a\u3069\u3082\u3059\u3079\u3066\u81ea\u52d5\u3067\u884c\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\n## \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\n\u4eca\u56de\u306fXFS\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001xfs_growfs\u3067\u62e1\u5f35\u3057\u307e\u3059\u3002\u3053\u308c\u3082\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u53ef\u80fd\u3067\u3059\u3002ext4\u3067\u3042\u308c\u3070\u3001resize2fs\u3067\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\n\n```:\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u62e1\u5f35\n# xfs_growfs /var/lib/mysql/\nmeta-data=/dev/drbd0             isize=256    agcount=4, agsize=2621351 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=0        finobt=0\ndata     =                       bsize=1024   blocks=10485404, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=0\nlog      =internal               bsize=1024   blocks=10240, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 10485404 to 47184444\n```\n\n# \u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\u6642\u306e\u5bfe\u5fdc\u3068\u58ca\u308c\u305f\u3068\u304d\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\nCloud\u306e\u5834\u5408\u3001\u30c7\u30a3\u30b9\u30af\u3060\u3051\u58ca\u308c\u308b\u4e8b\u306f\u307b\u3068\u3093\u3069\u7121\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u30c7\u30a3\u30b9\u30af\u306e\u53d6\u308a\u5916\u3057\u306a\u3069\u3082\u5bb9\u6613\u306b\u8a66\u305b\u308b\u306e\u3067\u3001\u5b9f\u9a13\u3057\u3066\u307f\u307e\u3059\u3002\n\u307e\u305f\u3001DRBD\u306f\u30c7\u30a3\u30b9\u30af\u304c\u6545\u969c\u3057\u305f\u6642\u306b\u6545\u969c\u3057\u305f\u3053\u3068\u3092\u4e0a\u4f4d\u30ec\u30a4\u30e4\u30fc(\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0)\u306b\u901a\u77e5\u3057\u306a\u3044\u3001\u3068\u884c\u3063\u305f\u8a2d\u5b9a\u304c\u53ef\u80fd(\u30c7\u30d5\u30a9\u30eb\u30c8)\u3067\u3001\u305d\u3046\u3059\u308b\u3068\u3069\u3046\u306a\u308b\u304b\u3068\u3044\u3046\u3068\u3001Secondary\u5074\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u3063\u3066\u304d\u3066\u30c7\u30a3\u30b9\u30af\u306f\u751f\u304d\u3066\u3044\u308b\u304b\u306e\u3088\u3046\u306b\u632f\u821e\u3063\u3066\u304f\u308c\u307e\u3059\u3002\u3064\u307e\u308a\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\u306f\u7d99\u7d9a\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u51c4\u3044\u3067\u3059\u306d\uff01\n\n## \u30c7\u30a3\u30b9\u30af(\u30dc\u30ea\u30e5\u30fc\u30e0)\u3092\u53d6\u308a\u5916\u3059\n[IDCF Cloud](http://www.idcf.jp/cloud/)\u306e[Cloud\u30b3\u30f3\u30bd\u30fc\u30eb](https://idcfcloud.com/)([\u3082\u3057\u304f\u306fAPI](http://www.idcf.jp/cloud/spec/api.html))\u304b\u3089\u5bfe\u8c61\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u9078\u629e\u3057\u30c7\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\u3053\u306e\u6642\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30c7\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002\nOS\u304b\u3089\u898b\u308b\u3068\u3001\u3044\u304d\u306a\u308aSCSI Disk\u304c\u7121\u304f\u306a\u3063\u305f\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\n```:detachVolume\u3059\u308b\u524d\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0\n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda\n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb\n\n# cat /proc/drbd\nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:0 dw:0 dr:912 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# df -h /var/lib/mysql\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/drbd0        45G  3.7G   42G    9% /var/lib/mysql\n\n# echo \"ABC\" > /var/lib/mysql/write_ok.txt\n# sync\n# ls -la /var/lib/mysql/write_ok.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 11:58 /var/lib/mysql/write_ok.txt\n```\n\n```:detachVolume\u306e\u5f8c\n# lsscsi \n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:Diskless/UpToDate C r-----\n    ns:2076 nr:24580 dw:26624 dr:3720 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# df -h /var/lib/mysql\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9   \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/drbd0        45G  3.7G   42G    9% /var/lib/mysql\n\n# echo \"ABC\" > /var/lib/mysql/write_ok2.txt\n# ls -la /var/lib/mysql/write_ok2.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 13:46 /var/lib/mysql/write_ok2.txt\n```\n\n\u8868\u9762\u4e0a\u306f\u4f55\u4e8b\u3082\u306a\u304f\u5229\u7528\u3067\u304d\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n`/proc/drbd`\u3067`ds:Diskless/UpToDate`\u3068Diskless\u3068\u8a00\u3046\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u4ee3\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u3050\u3089\u3044\u3067\u3059\u3002\n\n```:OS\u4e0a\u306e\u30ed\u30b0\n# # dmesg | tail -n 20\n[172736.739903] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.739916] sd 2:0:1:0: [sdb] CDB: Read(10) 28 00 00 00 00 02 00 00 01 00\n[172736.739921] blk_update_request: I/O error, dev sdb, sector 2\n[172736.739964] block drbd0: local READ IO error sector 2+1 on sdb\n[172736.739971] block drbd0: disk( UpToDate -> Failed ) \n[172736.739987] block drbd0: Local IO failed in __req_mod. Detaching...\n[172736.740103] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.740106] sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f f4 78 00 00 08 00\n[172736.740108] blk_update_request: I/O error, dev sdb, sector 94368888\n[172736.740131] block drbd0: IO ERROR -5 on bitmap page idx 0\n[172736.740162] block drbd0: bitmap WRITE of 1 pages took 0 jiffies\n[172736.740163] block drbd0: we had at least one MD IO ERROR during bitmap IO\n[172736.740186] block drbd0: 4 KB (1 bits) marked out-of-sync by on disk bit-map.\n[172736.740211] sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\n[172736.740213] sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f ff f8 00 00 08 00\n[172736.740214] blk_update_request: I/O error, dev sdb, sector 94371832\n[172736.740361] block drbd0: drbd_md_sync_page_io(,94371832s,WRITE) failed with error -5\n[172736.740396] block drbd0: meta data update failed!\n[172736.740414] block drbd0: disk( Failed -> Diskless ) \n[172736.742766] block drbd0: receiver updated UUIDs to effective data uuid: 757734BAC87B2EC0\n\n# tail -n 22 /var/log/messages\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Read(10) 28 00 00 00 00 02 00 00 01 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 2\nMar 10 13:43:36 localhost kernel: block drbd0: local READ IO error sector 2+1 on sdb\nMar 10 13:43:36 localhost kernel: block drbd0: disk( UpToDate -> Failed ) \nMar 10 13:43:36 localhost kernel: block drbd0: Local IO failed in __req_mod. Detaching...\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f f4 78 00 00 08 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 94368888\nMar 10 13:43:36 localhost kernel: block drbd0: IO ERROR -5 on bitmap page idx 0\nMar 10 13:43:36 localhost kernel: block drbd0: bitmap WRITE of 1 pages took 0 jiffies\nMar 10 13:43:36 localhost kernel: block drbd0: we had at least one MD IO ERROR during bitmap IO\nMar 10 13:43:36 localhost kernel: block drbd0: 4 KB (1 bits) marked out-of-sync by on disk bit-map.\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] FAILED Result: hostbyte=DID_NO_CONNECT driverbyte=DRIVER_OK\nMar 10 13:43:36 localhost kernel: sd 2:0:1:0: [sdb] CDB: Write(10) 2a 00 05 9f ff f8 00 00 08 00\nMar 10 13:43:36 localhost kernel: blk_update_request: I/O error, dev sdb, sector 94371832\nMar 10 13:43:36 localhost kernel: block drbd0: drbd_md_sync_page_io(,94371832s,WRITE) failed with error -5\nMar 10 13:43:36 localhost kernel: block drbd0: meta data update failed!\nMar 10 13:43:36 localhost kernel: block drbd0: disk( Failed -> Diskless ) \nMar 10 13:43:36 localhost kernel: block drbd0: receiver updated UUIDs to effective data uuid: 757734BAC87B2EC0\n```\n\n\u6d41\u77f3\u306bOS\u306e\u30ed\u30b0\u306b\u306f\u305d\u3053\u305d\u3053\u8272\u3005\u51fa\u3066\u3044\u307e\u3059\u306d\u3002DRBD\u306eStatus\u306fUptoDate -> Failed -> Diskless\u3068\u5909\u308f\u3063\u3066\u884c\u3063\u305f\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092\u4ea4\u63db\n\u4e00\u3064\u524d\u3067detachVolume\u3057\u3066\u3057\u307e\u3063\u305f\u30c7\u30a3\u30b9\u30af\u306f\u6368\u3066\u3066\u3001\u65b0\u898f\u306b\u30c7\u30a3\u30b9\u30af\u3092\u63a5\u7d9a\u3057Primary\u306e\u30c7\u30a3\u30b9\u30af\u3092\u5fa9\u5143\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092OS\u304b\u3089\u5207\u308a\u96e2\u3059\ndetachVolume\u3057\u3066\u3057\u307e\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u65e2\u306b\u63a5\u7d9a\u306f\u3055\u308c\u3044\u306a\u3044\u306e\u3067\u3059\u304c\u3001OS\u306f\u307e\u3060\u3042\u308b\u3082\u306e\u3068\u3057\u3066\u51e6\u7406\u3057\u3066\u3044\u307e\u3059\u3002\u307e\u305a\u3001\u58ca\u308c\u305f\u30c7\u30a3\u30b9\u30af\u3092OS\u304b\u3089\u5207\u308a\u96e2\u3057\u307e\u3059\u3002\nSCSI Disk\u306f`echo 1 > /sys/block/sdb/device/delete`\u3067\u5207\u308a\u96e2\u3059\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```:\u30c7\u30a3\u30b9\u30af\u306e\u5207\u308a\u96e2\u3057\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n\n# echo 1 > /sys/block/sdb/device/delete \n\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n```\n\n\u3053\u308c\u3067`/dev/sdb`\u3092\u5207\u308a\u96e2\u305b\u307e\u3057\u305f\u3002\n\n## \u30c7\u30a3\u30b9\u30af(\u30dc\u30ea\u30e5\u30fc\u30e0)\u306e\u8ffd\u52a0\n[IDCF Cloud](http://www.idcf.jp/cloud/)\u306e[Cloud\u30b3\u30f3\u30bd\u30fc\u30eb](https://idcfcloud.com/)([\u3082\u3057\u304f\u306fAPI](http://www.idcf.jp/cloud/spec/api.html))\u304b\u3089\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u4f5c\u6210(Secondary\u5074\u3068\u540c\u30b5\u30a4\u30ba)\u3057\u3066Primary Node\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3078\u30a2\u30bf\u30c3\u30c1\u3057\u307e\u3059\u3002(\u30dc\u30ea\u30e5\u30fc\u30e0 => \u30dc\u30ea\u30e5\u30fc\u30e0\u4f5c\u6210 => \u3067\u304d\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u9078\u629e => \u30a2\u30bf\u30c3\u30c1)\n\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u30a2\u30bf\u30c3\u30c1\u3092\u884c\u3044\u307e\u3059\u3002\n\n## OS\u306b\u8ffd\u52a0\u3057\u305f\u30c7\u30a3\u30b9\u30af\u3092\u8a8d\u8b58\u3055\u305b\u308b\nSCSI\u306f`echo \"- - -\" > /sys/class/scsi_host/host?/scan`\u3068\u3059\u308b\u3053\u3068\u3067\u3001SCSI Bus\u306erescan\u304c\u3067\u304d\u307e\u3059\u3002rescan\u3059\u308b\u3053\u3068\u3067\u3001\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u30c7\u30a3\u30b9\u30af\u3092\u8a8d\u8b58\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```:Disk\u3092\u8a8d\u8b58\u3055\u305b\u308b\n# echo \"- - -\" > /sys/class/scsi_host/host0/scan\n# echo \"- - -\" > /sys/class/scsi_host/host1/scan\n# echo \"- - -\" > /sys/class/scsi_host/host2/scan\n# echo \"- - -\" > /sys/class/scsi_host/host3/scan\n# echo \"- - -\" > /sys/class/scsi_host/host4/scan\n# echo \"- - -\" > /sys/class/scsi_host/host5/scan\n# echo \"- - -\" > /sys/class/scsi_host/host6/scan\n\n# lsscsi\n[0:0:0:0]    cd/dvd  NECVMWar VMware IDE CDR00 1.00  /dev/sr0 \n[2:0:0:0]    disk    VMware   Virtual disk     1.0   /dev/sda \n[2:0:1:0]    disk    VMware   Virtual disk     1.0   /dev/sdb \n```\n\n[IDCF Cloud](http://www.idcf.jp/cloud/)\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306f\u306a\u305c\u304bSCSI Card\u304c4\u679a\u3082\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u3089\u3057\u304f\u3001ATA\u3068\u5408\u308f\u305b\u308b\u3068SCSI Card\u304c6\u679a\u3082\u3042\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u5927\u62b5\u306fhost2\u3078\u30c7\u30a3\u30b9\u30af\u304c\u63a5\u7d9a\u3055\u308c\u308b\u3088\u3046\u306a\u306e\u3067\u3059\u304c\u3001\u826f\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067SCSI Card\u5206rescan\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u3087\u3046\u3002(rescan\u3057\u3066\u3082\u7279\u306b\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002)\n\n## DRBD\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u518d\u4f5c\u6210\n\u57fa\u672c\u7684\u306b\u306f\u65b0\u898f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u540c\u3058\u3067\u3059\u3002\n\n```:\u30e1\u30bf\u30c7\u30fc\u30bf\u4f5c\u6210\n# drbdadm create-md r1\ninitializing activity log\nNOT initializing bitmap\nWriting meta data...\nNew drbd meta data block successfully created.\nsuccess\n```\n\n## DRBD\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\n\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\u3059\u308c\u3070\u5b8c\u4e86\u3067\u3059\u3002\n\n```:\u30ea\u30bd\u30fc\u30b9\u3092\u518d\u63a5\u7d9a\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:Diskless/UpToDate C r-----\n    ns:2095 nr:24580 dw:26624 dr:3720 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# drbdadm attach r1 \n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:SyncTarget ro:Primary/Secondary ds:Inconsistent/UpToDate C r-----\n    ns:0 nr:3740 dw:3304 dr:20 al:3 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:47181140\n\t[>....................] sync'ed:  0.1% (46072/46076)M\n\tfinish: 7:16:51 speed: 1,652 (1,652) want: 2,160 K/sec\n\n# echo \"ABC\" > /var/lib/mysql/write_ok3.txt\n\n# ls -la /var/lib/mysql/write_ok3.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 14:33 /var/lib/mysql/write_ok3.txt\n\n```\n\n\u540c\u671f\u304c\u5b8c\u4e86\u3057\u3066\u3044\u306a\u304f\u3066\u3082\u3001\u554f\u984c\u306a\u304f\u5229\u7528\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\u540c\u671f\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001`ds:UpToDate/UpToDate`\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30c7\u30a3\u30b9\u30af\u304c\u58ca\u308c\u305f\u3060\u3051\u3067\u3042\u308c\u3070\u3001\u518d\u69cb\u7bc9\u307e\u3067\u3059\u3079\u3066\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u5b8c\u7d50\u3057\u3001\u6b62\u307e\u308b\u3053\u3068\u3082\u306a\u3044\u306e\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u7d99\u7d9a\u6027\u3082\u5931\u308f\u308c\u307e\u305b\u3093\u3002(\u9045\u304f\u306f\u306a\u308a\u307e\u3059\u304c\u3002\u3068\u306f\u8a00\u3048\u3001[IDCF Cloud](http://www.idcf.jp/cloud/)\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3082\u30c7\u30a3\u30b9\u30af\u3082\u901f\u3044\u306e\u3067\u3001\u3088\u3063\u307d\u3069\u30c7\u30a3\u30b9\u30af\u30a2\u30af\u30bb\u30b9\u304c\u306a\u3044\u9650\u308a\u306f\u7d50\u69cb\u4f7f\u3048\u308b\u3068\u601d\u3044\u307e\u3059\u3002)\n\n# Primary/Secondary\u306e\u5207\u308a\u66ff\u3048\n* \u3069\u3061\u3089\u304b\u4e00\u65b9\u304c\u65e2\u306bPrimary\u306e\u5834\u5408\u306f\u3001\u5207\u308a\u63db\u3048\u3089\u308c\u307e\u305b\u3093\u3002\n* \u5229\u7528\u4e2d\u306e\u5834\u5408\u306fdown\u3057\u305fSecondary\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\n```:primary\u304c\u3044\u305f\u3089primary\u306b\u306f\u306a\u308c\u306a\u3044\n# drbdadm primary r1\n0: State change failed: (-1) Multiple primaries not allowed by config\nCommand 'drbdsetup-84 primary 0' terminated with exit code 11\n```\n\n```:\u5229\u7528\u4e2d\u306f\u30c0\u30e1\n# drbdadm secondary r1\n0: State change failed: (-12) Device is held open by someone\nCommand 'drbdsetup-84 secondary 0' terminated with exit code 11\n```\n\n```:mount\u3057\u3066\u306a\u3051\u308c\u3070OK\n# unmount /var/lib/mysql\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:34 nr:47184880 dw:47184478 dr:20 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u304c\u6b63\u3057\u3044\u9806\u756a\u306b\u306a\u308a\u307e\u3059\u3002\n1. \u30b5\u30fc\u30d3\u30b9\u505c\u6b62 (ex:systemctl stop mysqld)\n2. unmount (ex: unmount /dev/drbd0)\n3. primary\u5074\u3067 `drbdadm secondary r1`\n4. secondary\u5074\u3067\u3001`drbdadm primary r1 `\n\n\n# Primary\u5074\u304cOS\u3054\u3068\u6b7b\u3093\u3060\u6642\n\u3053\u306e\u5834\u5408\u3001\u307e\u305a\u306f\u30b5\u30fc\u30d3\u30b9\u5fa9\u65e7\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001Secondary\u3092Primary\u306b\u6607\u683c\u3057\u3001\u30de\u30a6\u30f3\u30c8\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u3053\u308c\u306f\u65e2\u306bPrimary\u304c\u6b7b\u3093\u3067\u3044\u308b\u306e\u3067\u666e\u901a\u306bPrimary\u306b\u6607\u683c\u3057\u3066\u3057\u307e\u3063\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002\n\n```:Primary\u306b\u6607\u683c\u3057\u3066\u30de\u30a6\u30f3\u30c8\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:47212713 nr:8448 dw:8448 dr:47212713 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Primary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:47212713 nr:8448 dw:8448 dr:47213625 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n```\n\n\u3053\u306e\u5f8c\u306f\u3001\u58ca\u308c\u305f\u5143Primary\u3092\u5fa9\u65e7\u3059\u308b\u308f\u3051\u3067\u3059\u304c\u3001\u3053\u308c\u306f\u65b0\u898f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u540c\u69d8\u306b\u9032\u3081\u3066\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u3002`drbdadb up r1`\u3057\u305f\u6642\u70b9\u3067\u540c\u671f\u304c\u958b\u59cb\u3055\u308c\u307e\u3059\u3002\n\n\u4e00\u3064\u554f\u984c\u304c\u3042\u308b\u3068\u3059\u308b\u3068\u3001IP\u30a2\u30c9\u30ec\u30b9\u3060\u3068\u601d\u3044\u307e\u3059\u3002DRBD\u3067\u306f\u5f8c\u304b\u3089IP\u3092\u5909\u66f4\u3059\u308b\u4e8b\u304c\u3067\u304d\u307e\u305b\u3093\u3002(\u3068\u601d\u3046\u3002\u65b9\u6cd5\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3002)[IDCF Cloud](http://www.idcf.jp/cloud/)\u306e\u5834\u5408\u7279\u306b\u4f55\u3082\u8003\u3048\u306a\u3044\u3068DHCP\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002[IDCF Cloud](http://www.idcf.jp/cloud/)\u306fIP\u3092static\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u540c\u671f\u30bb\u30b0\u30e1\u30f3\u30c8\u306eIP\u306fstatic\u306b\u7ba1\u7406\u3057\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306b\u3064\u3044\u3066\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3068\u306f\u4e21\u65b9\u306e\u30ce\u30fc\u30c9\u304cPrimay\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u72b6\u614b\u306e\u3053\u3068\u3092\u8a00\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3069\u3061\u3089\u3082\u66f8\u304d\u8fbc\u307f\u304c\u3067\u304d\u3066\u3057\u307e\u3046\u5927\u5909\u5371\u967a\u306a\u72b6\u614b\u3067\u3059\u3002\n\u4eca\u307e\u3067\u306e\u8aac\u660e\u3067\u3082\u308f\u304b\u308b\u3088\u3046\u306b\u3001\u52dd\u624b\u306bPrimary/Primary\u306e\u72b6\u614b\u306b\u306f\u306a\u308a\u307e\u305b\u3093\u3002\u4eba\u70ba\u7684\u30df\u30b9\u3084\u30af\u30e9\u30b9\u30bf\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30df\u30b9\u306b\u3088\u308a\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5206\u65ad\u304c\u767a\u751f\u3057\u3066\u3001\u4e21\u30ce\u30fc\u30c9\u304c\u304a\u4e92\u3044\u3092\u8a8d\u8b58\u3067\u304d\u306a\u3044\u72b6\u614b\u306e\u6642\u3001Secondary\u5074\u3067`drbdadm primary r1`\u306a\u3069\u3059\u308b\u3068\u767a\u751f\u3057\u307e\u3059\u3002\n\n\u969c\u5bb3\u304c\u767a\u751f\u3057\u3066Secondary Node\u3067`drbdadm primary r1`\u3059\u308b\u6642\u306f\u3001\u5fc5\u305a\u5143Primary\u3092\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3057\u3066\u304b\u3089\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u3082\u3057\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u72b6\u614b\u306b\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u7247\u65b9\u306e\u30c7\u30fc\u30bf\u3092\u8ae6\u3081\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\n## \u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306e\u5b9f\u9a13\n\u3053\u3053\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u3092\u518d\u73fe\u3057\u3066\u3001\u5b9f\u9a13\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n### \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u505c\u6b62\n\u5358\u7d14\u306b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u3057\u3066\u518d\u73fe\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fPrimary\u5074\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30c0\u30a6\u30f3\u3055\u305b\u307e\u3059\u3002\n\n```:\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5206\u65ad\n# nmcli connection down f773ed44-f459-490e-acef-568376f1126b\nConnection 'eno33557248' successfully deactivated (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/0)\n```\n\n### \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u6642\u306eDRBD\u306e\u72b6\u614b\n\n```:Primary\u5074\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:2056 nr:0 dw:0 dr:3880 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5206\u65ad\u304c\u767a\u751f\u3059\u308b\u3068`cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown`\u3068\u306a\u308a\u3001StandAlone\u3068\u306a\u308b\u3088\u3046\u3067\u3059\u3002StandAlone\u306f\u30ea\u30bd\u30fc\u30b9\u304cdisconnect\u72b6\u614b\u306a\u306e\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u306f\u4f7f\u3048\u3066\u3044\u308b\u304c\u3001drbd\u304b\u3089\u306f\u5207\u308a\u96e2\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306a\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002(\u6b63\u78ba\u3067\u306f\u306a\u3044\u304b\u3082\u3002)\n\n\u3053\u306e\u6642\u3001Secondary\u5074\u3092\u898b\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```:Secondary\u5074\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:2056 dw:4106 dr:13380 al:4 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\nSecondary\u5074\u306fStandAlone\u30e2\u30fc\u30c9\u306b\u306f\u306a\u3089\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n### Secondary\u5074\u3092Primary\u306b\u6607\u683c\n\u3053\u306e\u72b6\u614b\u306e\u5834\u5408\u3001Secondary\u306fPrimary\u304c\u5c45\u306a\u3044\u306e\u3067Primary\u306b\u6607\u683c\u3067\u304d\u307e\u3059\u3002\n\n```:Primary\u306b\u6607\u683c\u3055\u305b\u308b\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Primary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:2056 dw:4106 dr:14292 al:4 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n```\n\n\u3053\u308c\u3067\u4e21\u65b9\u304c\u300c\u81ea\u5206\u306fPrimary\u3060\u300d\u3068\u8a00\u3063\u3066\u3044\u308b\u72b6\u614b\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3069\u3063\u3061\u3089\u306b\u3082\u66f8\u304d\u8fbc\u3081\u3066\u3057\u307e\u3046\u5384\u4ecb\u306a\u72b6\u614b\u3067\u3059\u3002\u4e21\u65b9\u306b\u66f8\u304d\u8fbc\u3080\u3068\u30c7\u30fc\u30bf\u304c\u5206\u65ad\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u306d\u3002\n\n## \u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u306e\u89e3\u6d88\n\u3053\u3046\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001\u3069\u3061\u3089\u304b\u306e\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\u6b8b\u3059\u65b9\u3092\u6c7a\u3081\u3066\u3001\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u65b9\u304b\u3089\u53d6\u308a\u51fa\u3057\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3092\u89e3\u6d88\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u505c\u6b62\u3057\u305f\u3001\u6700\u521d\u304b\u3089Primary\u306e\u65b9\u306e\u30c7\u30fc\u30bf\u3092\u6b8b\u3059\u5f62\u3067\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u3092\u89e3\u6d88\u3057\u3066\u307f\u307e\u3059\u3002\n\n## \u4e21\u30ce\u30fc\u30c9\u306b\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3080\n\u52d5\u304d\u3092\u78ba\u8a8d\u3057\u305f\u3044\u306e\u3067\u3001\u4e21\u30ce\u30fc\u30c9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u66f8\u304d\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\n```:\u5143\u304b\u3089Primary\u306b\u66f8\u304d\u8fbc\u307f\n# echo \"ABC\" > /var/lib/mysql/write_ok_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 17:55 /var/lib/mysql/write_ok_primary.txt\n```\n\n```:\u5143\u306fSecondary\u306b\u66f8\u304d\u8fbc\u307f\n# echo \"ABC\" > /var/lib/mysql/write_ok_new_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_new_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 17:54 /var/lib/mysql/write_ok_new_primary.txt\n```\n\n### \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u5fa9\u65e7\n\u5148\u305a\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u30c0\u30a6\u30f3\u3057\u305f\u5143\u3005Primary\u5074\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5fa9\u65e7\u3057\u307e\u3057\u3087\u3046\u3002\n\n```:\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u5fa9\u65e7\n# nmcli connection up f773ed44-f459-490e-acef-568376f1126b \n\u63a5\u7d9a\u304c\u6b63\u5e38\u306b\u30a2\u30af\u30c6\u30a3\u30d9\u30fc\u30c8\u3055\u308c\u307e\u3057\u305f (D-Bus \u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30b9: /org/freedesktop/NetworkManager/ActiveConnection/3)\n```\n\n### \u5143Secondary\u3092StandAlone\u3078\u5207\u308a\u66ff\u3048\n\u6b21\u306b\u5143Secondary\u3092StandAlone\u306e\u63a5\u7d9a\u72b6\u614b\u3078\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\u30c7\u30fc\u30bf\u3092\u6368\u3066\u308b\u30ce\u30fc\u30c9\u306fStandAlone\u72b6\u614b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```:StandAlone\u3078\u79fb\u884c\n# drbdadm disconnect r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Primary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:0 nr:2056 dw:8268 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n```\n\n### \u5143Secondary\u3092Secondary\u306b\u623b\u3059\n\u6b21\u306b\u5143Secondary\u3092Secondary\u306b\u623b\u3057\u307e\u3059\u3002\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u308b\u3068secondary\u306b\u3067\u304d\u306a\u3044\u305f\u3081\u3001unmount\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```:Secondary\u306b\u5909\u66f4\u3059\u308b\n# umount /var/lib/mysql/\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:StandAlone ro:Secondary/Unknown ds:UpToDate/DUnknown   r-----\n    ns:0 nr:2056 dw:8271 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n```\n\n### \u5143Secondary\u306eStandAlone\u306e\u56de\u5fa9\u3068\u30c7\u30fc\u30bf\u7834\u68c4\n\u6b21\u306bStandAlone\u304b\u3089\u306e\u56de\u5fa9\u3068\u3001\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u304c\u8d77\u304d\u3066\u304b\u3089\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u7834\u68c4\u3057\u307e\u3059\u3002\n\n```:\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u3092\u7834\u68c4\n# drbdadm connect --discard-my-data r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:WFConnection ro:Secondary/Unknown ds:UpToDate/DUnknown C r-----\n    ns:0 nr:0 dw:8271 dr:19428 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:2096\n```\n\n### \u5143\u3005Primary\u306e\u65b9\u3092StandAlone\u304b\u3089\u56de\u5fa9\n\u5143\u3005Primary\u306e\u65b9\u304c\u307e\u3060StandAlone\u72b6\u614b\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u56de\u5fa9\u3057\u307e\u3059\u3002\n\n```:\u5143\u3005Primary\u3092StandAlone\u304b\u3089\u56de\u5fa9\n# drbdadm connect r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:2096 nr:0 dw:0 dr:5976 al:0 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n\u5143\u3005Primary\u306e\u65b9\u306b\u66f8\u304d\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u304cSecondary\u306b\u540c\u671f\u3055\u308c\u3001`ds:UpToDate/UpToDate`\u306b\u306a\u308c\u3070\u3001\u5fa9\u65e7\u5b8c\u4e86\u3067\u3059\u3002\n\n### Secondary\u306e\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\nSecondary\u306e\u30c7\u30fc\u30bf\u304c\u7834\u68c4\u3055\u308c\u3066\u3001\u5143\u3005Primary\u3068\u540c\u3058\u72b6\u614b\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```:Primary\u306e\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\n# ls -la /var/lib/mysql/write_ok_primary.txt \n-rw-r--r-- 1 root root 4  3\u6708 10 18:23 /var/lib/mysql/write_ok_primary.txt\n```\n\n```:Primary\u3092Secondary\u306b\u964d\u683c\n# umount /var/lib/mysql/\n\n# drbdadm secondary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Secondary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:2090 nr:0 dw:2082 dr:10876 al:5 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n```:\u5143\u3005Secondary\u3092Primary\u306b\u6607\u683c\n# drbdadm primary r1\n\n# cat /proc/drbd \nversion: 8.4.7-1 (api:1/proto:86-101)\nGIT-hash: 3a6a769340ef93b1ba2792c6461250790795db49 build by phil@Build64R7, 2016-01-12 14:29:40\n 0: cs:Connected ro:Primary/Secondary ds:UpToDate/UpToDate C r-----\n    ns:0 nr:2090 dw:16587 dr:23609 al:6 bm:0 lo:0 pe:0 ua:0 ap:0 ep:1 wo:d oos:0\n```\n\n```:\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\n# mount -t xfs -o noatime,nodiratime,nobarrier /dev/drbd0 /var/lib/mysql/\n\n# ls -la /var/lib/mysql/write_ok_primary.txt\n-rw-r--r-- 1 root root 4  3\u6708 10 18:23 /var/lib/mysql/write_ok_primary.txt\n\n# ls -la /var/lib/mysql/write_ok_new_primary.txt\nls: /var/lib/mysql/write_ok_new_primary.txt \u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093: \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093\n```\n\n\u30b9\u30d7\u30ea\u30c3\u30c8\u30d6\u30ec\u30a4\u30f3\u6642\u306b\u66f8\u304d\u8fbc\u3093\u3060`write_ok_new_primary.txt`\u304c\u7121\u304f\u3001`write_ok_primary.txt`\u304c\u540c\u671f\u3067\u304d\u3066\u3044\u308b\u4e8b\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u30af\u30e9\u30b9\u30bf\u30bd\u30d5\u30c8\nDRBD\u3060\u3051\u3067\u306fPrimary\u30ce\u30fc\u30c9\u306e\u969c\u5bb3\u6642\u306b\u969c\u5bb3\u3092\u691c\u77e5\u3057\u3066\u3001Secondary\u30ce\u30fc\u30c9\u3092Primary\u3078\u6607\u683c\u306a\u3069\u3068\u3044\u3063\u305f\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\n\u3053\u308c\u3089\u306f\u5225\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5229\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nDRBD\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306fPacemaker\u3001Red Hat Cluster Suite\u3068\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u4eca\u306e\u3068\u3053\u308d\u81ea\u5206\u306f\u3053\u306e\u90e8\u5206\u306b\u8208\u5473\u304c\u306a\u3044\u306e\u3067\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u898b\u3066\u9811\u5f35\u3063\u3066\u304f\u3060\u3055\u3044\uff01\n", "tags": ["drbd", "CentOS", "centos7", "IDCF\u30af\u30e9\u30a6\u30c9"]}