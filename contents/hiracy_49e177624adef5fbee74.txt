{"context": " More than 1 year has passed since last update.\n\nserverspec-runner\u3068\u306f\uff1f\n\u30a4\u30f3\u30d5\u30e9\u306e\u72b6\u614b\u3092\u30c6\u30b9\u30c8\u3059\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30afserverspec\u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u5bfe\u3057\u6c17\u8efd\u306b\u4f7f\u3048\u3066\u3001\u308f\u304b\u308a\u3084\u3059\u3044\u7d50\u679c\u3092\u8868\u793a\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u8a73\u3057\u304f\u306f\u2193\u3053\u3061\u3089\n\nserverspec-runner\u3092\u4f7f\u3063\u3066\u8907\u6570\u306e\u30db\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u30ec\u30dd\u30fc\u30c8\u3092\u4f5c\u308b\n\n\nserverspec-runner@github.com\n\n\n\u72ec\u81ea\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3046\u7406\u7531\nserverspec-runner\u306fserverspec.org\u306e\u30ea\u30bd\u30fc\u30b9\u306b\u6e96\u62e0\u3057\u3066\u3044\u307e\u3059\u3002\nserverspec\u3092\u4f7f\u3044\u8fbc\u3093\u3067\u304f\u308b\u3068\u3001\u3069\u3046\u3057\u3066\u3082\u7d44\u307f\u8fbc\u307f\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u306f\u8db3\u308a\u305a\u3001\u305d\u306e\u5834\u5408\u306fcommand\u30ea\u30bd\u30fc\u30b9\u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3084\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528\u6027\u3084\u53ef\u8aad\u6027\u304c\u4e0b\u304c\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u72ec\u81ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u305f\u65b9\u304c\u826f\u3044\u30b1\u30fc\u30b9\u304c\u51fa\u3066\u304f\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nserverspec\u306e\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35\u306b\u3064\u3044\u3066\nserverspec\u306e\u62e1\u5f35\u65b9\u6cd5\u306f\u4f5c\u8005\u306emizzy\u6c0f\u81ea\u3089O'Reilly Japan\u306e\u300cServerspec\u300d\u306b\u30661\u7ae0\u3092\u4f7f\u3063\u3066\u4e01\u5be7\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u304a\u308a\u307e\u3059\u3002\nserverspec-runner\u3067\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35\u3059\u308b\u969b\u3082\u3053\u3053\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u5185\u5bb9\u306e\u901a\u308a\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u5c1a\u3001\u3053\u306e\u6280\u8853\u66f8\u306b\u3066\u8a73\u7d30\u304c\u66f8\u304b\u308c\u3066\u304a\u308a\u307e\u3059\u306e\u3067serverspec\u81ea\u4f53\u306e\u62e1\u5f35\u306b\u95a2\u3057\u3066\u306f\u3053\u3053\u3067\u306f\u3042\u307e\u308a\u89e6\u308c\u307e\u305b\u3093\u3002\u3054\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u4e00\u8aad\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\uff01\n\n\u4e8b\u524d\u6e96\u5099\nruby\u304c\u4f7f\u7528\u3067\u304d\u308b\u74b0\u5883\u306b\u3066serverspec-runner\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u30b9\u30b1\u30eb\u30c8\u30f3\u3092\u751f\u6210\u3057\u307e\u3059\u3002\ngem install serverspec-runner\n\n\u30c6\u30b9\u30c8\u3067\u4f7f\u7528\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/tmp/testroot \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4ee5\u964d\u300cspec_root\u300d\u3068\u547c\u3076\u4e8b\u306b\u3057\u307e\u3059\u3002\n\nserverspec-runner -r /tmp/testroot\nwant to create spec-tree to /tmp/testroot? (y/n): y\n\ncd /tmp/testroot\n\n\nspec_root\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nls\u30b3\u30de\u30f3\u30c9\u3067\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u30fb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nscenario.yml\n\n\n\u5b9f\u884c\u6642\u30b7\u30ca\u30ea\u30aa\n\n\nssh_options_default.yml\n\n\n\u5b9f\u884c\u6642\u306enet-ssh\u30c7\u30d5\u30a9\u30eb\u30c8\u30aa\u30d7\u30b7\u30e7\u30f3\n\n\nspec\n\n\nserverspec\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u5834\u6240\n\n\nlib\n\n\nserverspec-runner\u62e1\u5f35\u30ea\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5834\u6240\n\n\n\n\n\u30b5\u30f3\u30d7\u30eb1: \u65e2\u5b58\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\n\u5b9f\u7528\u6027\u3084\u30c6\u30b9\u30c8\u5185\u5bb9\u306e\u59a5\u5f53\u6027\u306f\u3068\u308a\u3042\u3048\u305a\u7f6e\u3044\u3068\u3044\u3066\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304b\u3092\u5224\u5225\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n$spec_root/lib/extension/serverspec/type/file.rb\nmodule Serverspec::Type\n  class File < Base\n    def text?\n      @runner.check_file_is_text(@name)\n    end\n  end\nend\n\n\n\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u5224\u5225\u306ffile\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u3092grep\u3059\u308b\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n$spec_root/lib/extension/specinfra/command/base/file.rb\nclass Specinfra::Command::Base::File < Specinfra::Command::Base\n  class << self\n    def check_is_text(file)\n      \"file #{escape(file)} | egrep ' text$'\"\n    end\n  end\nend\n\n\n\u62e1\u5f35\u90e8\u5206\u306f\u4ee5\u4e0a\u3067\u3059\u3002\n\u4eca\u5ea6\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u307b\u3046\u304b\u3089\u3001\u672c\u5bb6\u306efile\u30ea\u30bd\u30fc\u30b9\u306b\u306f\u7121\u3044be_text\u3092\u4f7f\u7528\u3057\u3066\u307f\u307e\u3059\u3002\n\n$spec_root/spec/example/default.rb\nrequire 'spec_helper'\n\ndescribe file('/tmp/anyfile') do\n  it { should be_text }\nend\n\n\n\u30c6\u30b9\u30c8\u3092\u6210\u529f\u3055\u305b\u308b\u305f\u3081\u306b/tmp/anyfile \u3092\u4f5c\u308a\u307e\u3059\u3002\necho '\u3042\u3044\u3046\u3048\u304a' > /tmp/anyfile\n\n\u305d\u308c\u3067\u306f\u7d50\u679c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u5c1a\u3001\u4eca\u56de\u306f\u751f\u6210\u6642\u30c7\u30d5\u30a9\u30eb\u30c8\u306escenario.yml\u306b\u3088\u308b\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u3067\u3059\u304c\u3001\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306b\u5b9f\u884c\u3059\u308b\u306b\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\nserverspec-runner\n\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  File \"/tmp/anyfile\"         |        |\n|                              |   OK   |\n+---------------------------------------+\n\n\u4eca\u5ea6\u306f\u5931\u6557\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\ndd if=/dev/zero of=/tmp/anyfile count=10 bs=1\nserverspec-runner\n\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  File \"/tmp/anyfile\"         |        |\n|                              |   NG   |\n+---------------------------------------+\n\n\n\u30b5\u30f3\u30d7\u30eb2: \u65b0\u305f\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\n\u4eca\u5ea6\u306fmysql\u3068\u3044\u3046\u5168\u304f\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u6b63\u5e38\u306b\u3067\u304d\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u69cb\u6587\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\nbe_replicated.from(<\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9>)\n  .with_user(<mysql\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6>)\n  .with_password(<mysql\u7528\u30ed\u30b0\u30a4\u30f3\u30d1\u30b9\u30ef\u30fc\u30c9>)\n  .with_port(<mysql\u30ed\u30b0\u30a4\u30f3\u7528\u30dd\u30fc\u30c8>)\n\nServerspec::Type\u53ca\u3073Specinfra::Command \u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n$spec_root/lib/extension/serverspec/type/mysql.rb\nmodule Serverspec::Type\n  class Mysql < Base\n    def replicated?(master=nil, user=nil, password=nil, port=nil)\n      @runner.check_mysql_is_replicated(master, user, password, port)\n    end\n  end\nend\n\n\n\n$spec_root/lib/extension/specinfra/command/linux/base/mysql.rb\nclass Specinfra::Command::Linux::Base::Mysql < Specinfra::Command::Base\n  class << self\n    def check_is_replicated(master=nil, user=nil, password=nil, port=nil)\n      opt_user     = \"--user=#{user} \" || ''\n      opt_password = \"--password=#{password} \" || ''\n      opt_port     = \"--port=#{port} \" || ''\n\n      cmd = ''\n      cmd += \"echo 'show slave status \\\\G;' | mysql #{opt_user} #{opt_password} #{opt_port} | \"\n      cmd += \"grep -e 'Slave_IO_Running: Yes' -e 'Slave_SQL_Running: Yes' -e 'Master_Host: #{master}' | \"\n      cmd += \"wc -l | grep -w 3\"\n      cmd\n    end\n  end\nend\n\n\nbe_replicated\u3068\u3044\u3046\u65b0\u3057\u3044\u69cb\u6587\u306fRSpec\u306e\u30de\u30c3\u30c1\u30e3\u306b\u51e6\u7406\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u81ea\u524d\u3067\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n$spec_root/lib/extension/serverspec/matcher/be_replicated.rb\nRSpec::Matchers.define :be_replicated do\n  match do |host|\n    host.replicated?(@master, @user, @password, @port)\n  end\n\n  chain :from do |master|\n    @master = master\n  end\n\n  chain :with_user do |user|\n    @user = user\n  end\n\n  chain :with_password  do |password|\n    @password = password\n  end\n\n  chain :with_port do |port|\n    @port = port\n  end\nend\n\n\n\u6700\u5f8c\u306b\u3001serverspec\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304cServerspec::Helper::Type\u306b\u3066\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u3068\u540c\u3058\u3088\u3046\u306b\u3001\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3092\u8a8d\u8b58\u3055\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n$spec_root/lib/extension/serverspec/helper/type.rb\nmodule Serverspec\n  module Helper\n    module Type\n      types = %w(\n        mysql\n      )\n\n      types.each {|type| require \"extension/serverspec/type/#{type}\" }\n\n      types.each do |type|\n        define_method type do |*args|\n          name = args.first\n          eval \"Serverspec::Type::#{type.to_camel_case}.new(name)\"\n        end\n      end\n    end\n  end\nend\n\n\n\u4ee5\u4e0a\u304c\u62e1\u5f35\u90e8\u5206\u3067\u3059\u3002\u6b21\u306b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002\n\n$spec_root/spec/example/default.rb\nrequire 'spec_helper'\n\ndescribe mysql(\"replication test\") do\n  it { should be_replicated.from('192.168.10.10')\n         .with_user('repluser')\n         .with_password('replpasswd')\n         .with_port('3306') }\nend\n\n\n\u305d\u308c\u3067\u306f\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n(\u4e88\u3081\u4e0b\u8a18\u30db\u30b9\u30c8\u9593\u306b\u3066\u30ea\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u6b63\u5e38\u306b\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059)\nserverspec-runner\n\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  Mysql \"replication test\"    |        |\n|                              |   OK   |\n+---------------------------------------+\n\n\n\u6700\u5f8c\u306b\nO'Reilly Japan\u306e\u300cServerspec\u300d\u3068github.com\u306eserverspec/specinfra\u30da\u30fc\u30b8\u3092\u898b\u3066serverspec-runner\u5074\u304b\u3089\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\u3059\u308b\u65b9\u6cd5\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nserverspec\u305d\u306e\u3082\u306e\u306e\u62e1\u5f35\u306b\u5bfe\u3057\u3066\u306e\u9593\u9055\u3044\u3084\u3082\u3063\u3068\u30b9\u30de\u30fc\u30c8\u306a\u5b9f\u88c5\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u306b\u3067\u3082\u3053\u3063\u305d\u308a\u6559\u3048\u3066\u9802\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\n![foa6fq.png](https://qiita-image-store.s3.amazonaws.com/0/14093/163bc897-64ea-3877-675b-0002dfa0493d.png)\n\n# serverspec-runner\u3068\u306f\uff1f\n\u30a4\u30f3\u30d5\u30e9\u306e\u72b6\u614b\u3092\u30c6\u30b9\u30c8\u3059\u308b\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af[serverspec](http://serverspec.org/)\u3092\u8907\u6570\u306e\u30db\u30b9\u30c8\u306b\u5bfe\u3057\u6c17\u8efd\u306b\u4f7f\u3048\u3066\u3001\u308f\u304b\u308a\u3084\u3059\u3044\u7d50\u679c\u3092\u8868\u793a\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u8a73\u3057\u304f\u306f\u2193\u3053\u3061\u3089\n\n#### [serverspec-runner\u3092\u4f7f\u3063\u3066\u8907\u6570\u306e\u30db\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u30ec\u30dd\u30fc\u30c8\u3092\u4f5c\u308b](http://qiita.com/y05_net/items/1ebc7b82f1a6ffa69ed0)\n\n#### [serverspec-runner@github.com](https://github.com/hiracy/serverspec-runner)\n\n# \u72ec\u81ea\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3046\u7406\u7531\nserverspec-runner\u306f[serverspec.org\u306e\u30ea\u30bd\u30fc\u30b9](http://serverspec.org/resource_types.html)\u306b\u6e96\u62e0\u3057\u3066\u3044\u307e\u3059\u3002\nserverspec\u3092\u4f7f\u3044\u8fbc\u3093\u3067\u304f\u308b\u3068\u3001\u3069\u3046\u3057\u3066\u3082\u7d44\u307f\u8fbc\u307f\u306e\u30ea\u30bd\u30fc\u30b9\u3067\u306f\u8db3\u308a\u305a\u3001\u305d\u306e\u5834\u5408\u306fcommand\u30ea\u30bd\u30fc\u30b9\u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3084\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\u306b\u306a\u3063\u3066\u3057\u307e\u3044\u3001\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528\u6027\u3084\u53ef\u8aad\u6027\u304c\u4e0b\u304c\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u72ec\u81ea\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u305f\u65b9\u304c\u826f\u3044\u30b1\u30fc\u30b9\u304c\u51fa\u3066\u304f\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n# serverspec\u306e\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35\u306b\u3064\u3044\u3066\nserverspec\u306e\u62e1\u5f35\u65b9\u6cd5\u306f\u4f5c\u8005\u306emizzy\u6c0f\u81ea\u3089[O'Reilly Japan\u306e\u300cServerspec\u300d](http://www.oreilly.co.jp/books/9784873117096/)\u306b\u30661\u7ae0\u3092\u4f7f\u3063\u3066\u4e01\u5be7\u306b\u8a73\u3057\u304f\u66f8\u304b\u308c\u3066\u304a\u308a\u307e\u3059\u3002\nserverspec-runner\u3067\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35\u3059\u308b\u969b\u3082\u3053\u3053\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u5185\u5bb9\u306e\u901a\u308a\u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u5c1a\u3001\u3053\u306e\u6280\u8853\u66f8\u306b\u3066\u8a73\u7d30\u304c\u66f8\u304b\u308c\u3066\u304a\u308a\u307e\u3059\u306e\u3067**serverspec\u81ea\u4f53\u306e\u62e1\u5f35\u306b\u95a2\u3057\u3066\u306f\u3053\u3053\u3067\u306f\u3042\u307e\u308a\u89e6\u308c\u307e\u305b\u3093**\u3002\u3054\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u4e00\u8aad\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\uff01\n\n# \u4e8b\u524d\u6e96\u5099\nruby\u304c\u4f7f\u7528\u3067\u304d\u308b\u74b0\u5883\u306b\u3066serverspec-runner\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u30b9\u30b1\u30eb\u30c8\u30f3\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n```\ngem install serverspec-runner\n```\n\u30c6\u30b9\u30c8\u3067\u4f7f\u7528\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea/tmp/testroot \u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4ee5\u964d\u300c**spec_root**\u300d\u3068\u547c\u3076\u4e8b\u306b\u3057\u307e\u3059\u3002\n```\nserverspec-runner -r /tmp/testroot\nwant to create spec-tree to /tmp/testroot? (y/n): y\n```\n\n```\ncd /tmp/testroot\n```\n\n# spec_root\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nls\u30b3\u30de\u30f3\u30c9\u3067\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u30fb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n - scenario.yml\n    - [\u5b9f\u884c\u6642\u30b7\u30ca\u30ea\u30aa](http://qiita.com/y05_net/items/1ebc7b82f1a6ffa69ed0#scenarioyml%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9)\n - ssh_options_default.yml\n    - [\u5b9f\u884c\u6642\u306enet-ssh\u30c7\u30d5\u30a9\u30eb\u30c8\u30aa\u30d7\u30b7\u30e7\u30f3](http://net-ssh.github.io/ssh/v2/api/classes/Net/SSH/Config.html)\n - spec\n    - serverspec\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u5834\u6240\n - lib\n    - **serverspec-runner\u62e1\u5f35\u30ea\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5834\u6240**\n\n# \u30b5\u30f3\u30d7\u30eb1: \u65e2\u5b58\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\n\u5b9f\u7528\u6027\u3084\u30c6\u30b9\u30c8\u5185\u5bb9\u306e\u59a5\u5f53\u6027\u306f\u3068\u308a\u3042\u3048\u305a\u7f6e\u3044\u3068\u3044\u3066\u3001**\u30d5\u30a1\u30a4\u30eb\u304c\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u304b\u3092\u5224\u5225\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u62e1\u5f35**\u3092\u3057\u3066\u307f\u307e\u3059\u3002\n\n```$spec_root/lib/extension/serverspec/type/file.rb\nmodule Serverspec::Type\n  class File < Base\n    def text?\n      @runner.check_file_is_text(@name)\n    end\n  end\nend\n```\n\n\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u5224\u5225\u306ffile\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u3092grep\u3059\u308b\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```$spec_root/lib/extension/specinfra/command/base/file.rb\nclass Specinfra::Command::Base::File < Specinfra::Command::Base\n  class << self\n    def check_is_text(file)\n      \"file #{escape(file)} | egrep ' text$'\"\n    end\n  end\nend\n```\n\n\u62e1\u5f35\u90e8\u5206\u306f\u4ee5\u4e0a\u3067\u3059\u3002\n\u4eca\u5ea6\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306e\u307b\u3046\u304b\u3089\u3001\u672c\u5bb6\u306efile\u30ea\u30bd\u30fc\u30b9\u306b\u306f\u7121\u3044**be_text**\u3092\u4f7f\u7528\u3057\u3066\u307f\u307e\u3059\u3002\n\n```$spec_root/spec/example/default.rb\nrequire 'spec_helper'\n\ndescribe file('/tmp/anyfile') do\n  it { should be_text }\nend\n```\n\n\u30c6\u30b9\u30c8\u3092\u6210\u529f\u3055\u305b\u308b\u305f\u3081\u306b/tmp/anyfile \u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```\necho '\u3042\u3044\u3046\u3048\u304a' > /tmp/anyfile\n```\n\n\u305d\u308c\u3067\u306f\u7d50\u679c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u5c1a\u3001\u4eca\u56de\u306f\u751f\u6210\u6642\u30c7\u30d5\u30a9\u30eb\u30c8\u306escenario.yml\u306b\u3088\u308b\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306e\u30c6\u30b9\u30c8\u3067\u3059\u304c\u3001\u30ea\u30e2\u30fc\u30c8\u30db\u30b9\u30c8\u306b\u5b9f\u884c\u3059\u308b\u306b\u306f[\u3053\u3061\u3089](http://qiita.com/y05_net/items/1ebc7b82f1a6ffa69ed0#scenarioyml%E3%81%AE%E4%BD%9C%E3%82%8A%E6%96%B9)\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```\nserverspec-runner\n```\n\n```\u51fa\u529b\u7d50\u679c\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  File \"/tmp/anyfile\"         |        |\n|                              |   OK   |\n+---------------------------------------+\n```\n\n\u4eca\u5ea6\u306f\u5931\u6557\u3059\u308b\u30b1\u30fc\u30b9\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\ndd if=/dev/zero of=/tmp/anyfile count=10 bs=1\nserverspec-runner\n```\n\n```\u51fa\u529b\u7d50\u679c\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  File \"/tmp/anyfile\"         |        |\n|                              |   NG   |\n+---------------------------------------+\n```\n\n# \u30b5\u30f3\u30d7\u30eb2: \u65b0\u305f\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\n\u4eca\u5ea6\u306f**mysql**\u3068\u3044\u3046\u5168\u304f\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u6b63\u5e38\u306b\u3067\u304d\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002\u69cb\u6587\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n```\nbe_replicated.from(<\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9>)\n  .with_user(<mysql\u30ed\u30b0\u30a4\u30f3\u7528\u30e6\u30fc\u30b6>)\n  .with_password(<mysql\u7528\u30ed\u30b0\u30a4\u30f3\u30d1\u30b9\u30ef\u30fc\u30c9>)\n  .with_port(<mysql\u30ed\u30b0\u30a4\u30f3\u7528\u30dd\u30fc\u30c8>)\n```\n\nServerspec::Type\u53ca\u3073Specinfra::Command \u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```$spec_root/lib/extension/serverspec/type/mysql.rb\nmodule Serverspec::Type\n  class Mysql < Base\n    def replicated?(master=nil, user=nil, password=nil, port=nil)\n      @runner.check_mysql_is_replicated(master, user, password, port)\n    end\n  end\nend\n```\n\n```$spec_root/lib/extension/specinfra/command/linux/base/mysql.rb\nclass Specinfra::Command::Linux::Base::Mysql < Specinfra::Command::Base\n  class << self\n    def check_is_replicated(master=nil, user=nil, password=nil, port=nil)\n      opt_user     = \"--user=#{user} \" || ''\n      opt_password = \"--password=#{password} \" || ''\n      opt_port     = \"--port=#{port} \" || ''\n\n      cmd = ''\n      cmd += \"echo 'show slave status \\\\G;' | mysql #{opt_user} #{opt_password} #{opt_port} | \"\n      cmd += \"grep -e 'Slave_IO_Running: Yes' -e 'Slave_SQL_Running: Yes' -e 'Master_Host: #{master}' | \"\n      cmd += \"wc -l | grep -w 3\"\n      cmd\n    end\n  end\nend\n```\n\nbe_replicated\u3068\u3044\u3046\u65b0\u3057\u3044\u69cb\u6587\u306fRSpec\u306e\u30de\u30c3\u30c1\u30e3\u306b\u51e6\u7406\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u81ea\u524d\u3067\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```$spec_root/lib/extension/serverspec/matcher/be_replicated.rb\nRSpec::Matchers.define :be_replicated do\n  match do |host|\n    host.replicated?(@master, @user, @password, @port)\n  end\n\n  chain :from do |master|\n    @master = master\n  end\n\n  chain :with_user do |user|\n    @user = user\n  end\n\n  chain :with_password  do |password|\n    @password = password\n  end\n\n  chain :with_port do |port|\n    @port = port\n  end\nend\n```\n\n\u6700\u5f8c\u306b\u3001serverspec\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c[Serverspec::Helper::Type](https://github.com/serverspec/serverspec/blob/master/lib/serverspec/helper/type.rb)\u306b\u3066\u3084\u3063\u3066\u3044\u308b\u3053\u3068\u3068\u540c\u3058\u3088\u3046\u306b\u3001\u65b0\u3057\u3044\u30ea\u30bd\u30fc\u30b9\u30bf\u30a4\u30d7\u3092\u8a8d\u8b58\u3055\u305b\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```$spec_root/lib/extension/serverspec/helper/type.rb\nmodule Serverspec\n  module Helper\n    module Type\n      types = %w(\n        mysql\n      )\n\n      types.each {|type| require \"extension/serverspec/type/#{type}\" }\n\n      types.each do |type|\n        define_method type do |*args|\n          name = args.first\n          eval \"Serverspec::Type::#{type.to_camel_case}.new(name)\"\n        end\n      end\n    end\n  end\nend\n```\n\n\u4ee5\u4e0a\u304c\u62e1\u5f35\u90e8\u5206\u3067\u3059\u3002\u6b21\u306b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```$spec_root/spec/example/default.rb\nrequire 'spec_helper'\n\ndescribe mysql(\"replication test\") do\n  it { should be_replicated.from('192.168.10.10')\n         .with_user('repluser')\n         .with_password('replpasswd')\n         .with_port('3306') }\nend\n```\n\n\u305d\u308c\u3067\u306f\u8a66\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n(\u4e88\u3081\u4e0b\u8a18\u30db\u30b9\u30c8\u9593\u306b\u3066\u30ea\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f\u6b63\u5e38\u306b\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u307e\u3059)\n\n```\nserverspec-runner\n```\n\n```\u51fa\u529b\u7d50\u679c\n+---------------------------------------+\n|description                   | result |\n+---------------------------------------+\n|example@anyhost-01(127.0.0.1) |        |\n|  Mysql \"replication test\"    |        |\n|                              |   OK   |\n+---------------------------------------+\n```\n\n# \u6700\u5f8c\u306b\n[O'Reilly Japan\u306e\u300cServerspec\u300d](http://www.oreilly.co.jp/books/9784873117096/)\u3068[github.com\u306eserverspec/specinfra\u30da\u30fc\u30b8](https://github.com/serverspec)\u3092\u898b\u3066serverspec-runner\u5074\u304b\u3089\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\u3059\u308b\u65b9\u6cd5\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nserverspec\u305d\u306e\u3082\u306e\u306e\u62e1\u5f35\u306b\u5bfe\u3057\u3066\u306e\u9593\u9055\u3044\u3084\u3082\u3063\u3068\u30b9\u30de\u30fc\u30c8\u306a\u5b9f\u88c5\u304c\u3042\u308a\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u306b\u3067\u3082\u3053\u3063\u305d\u308a\u6559\u3048\u3066\u9802\u3051\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\n", "tags": ["serverspec"]}