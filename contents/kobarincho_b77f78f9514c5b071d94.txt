{"context": "\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\nhttps://developers.google.com/analytics/devguides/reporting/core/v4/quickstart/installed-py\n\u30b5\u30f3\u30d7\u30ebclass\nclass GoogleAnalyticsUtility(object):\n    SCOPES = ['https://www.googleapis.com/auth/analytics.readonly']\n    DISCOVERY_URI = ('https://analyticsreporting.googleapis.com/$discovery/rest')\n    VIEW_ID = 'xxxx'\n\n    def __init__(self, target_date):\n        self.target_date = target_date\n\n    def get_report(self):\n        parser = argparse.ArgumentParser(\n                formatter_class=argparse.RawDescriptionHelpFormatter,\n                parents=[tools.argparser])\n        flags = parser.parse_args(['--noauth_local_webserver'])\n        CLIENT_SECRETS_PATH = os.path.join(settings.BASE_DIR, '../etc/googleapi/client_id.json')\n        flow = client.flow_from_clientsecrets(\n                CLIENT_SECRETS_PATH, scope=self.SCOPES,\n                message=tools.message_if_missing(CLIENT_SECRETS_PATH))\n\n        storage = file.Storage(os.path.join(settings.BASE_DIR, '../etc/googleapi/analyticsreporting.dat'))\n        credentials = storage.get()\n        if credentials is None or credentials.invalid:\n            credentials = tools.run_flow(flow, storage, flags)\n        http = credentials.authorize(http=httplib2.Http())\n        analytics = build('analytics', 'v4', http=http, discoveryServiceUrl=self.DISCOVERY_URI)\n        reports = analytics.reports()\n        return reports.batchGet(\n                body={\n                    'reportRequests': [\n                        {\n                            'viewId': self.VIEW_ID,\n                            'dateRanges': [{'startDate': self.target_date, 'endDate': 'today'}],\n                            \"dimensions\": [\n                                {\n                                    \"name\": \"ga:productSku\",  # \u8ca9\u58f2\u3057\u305f\u54c1\u76ee\u306e\u5546\u54c1\u30b3\u30fc\u30c9\u3067\u3059\u3002\n                                }],\n                            'metrics': [\n                                {'expression': 'ga:itemQuantity'}  # e \u30b3\u30de\u30fc\u30b9 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3067\u58f2\u308c\u305f\u5546\u54c1\u306e\u6570\u3067\u3059\u3002\n                            ],\n                            'pageSize': 50000,\n                            'pageToken': \"nextpage\",\n                            \"orderBys\":\n                                [\n                                    {\"fieldName\": \"ga:itemQuantity\", \"sortOrder\": \"DESCENDING\"},\n                                ]\n                        }]\n                }\n        ).execute()\n\ntarget_date = date.today() - timedelta(days=7)\nga = GoogleAnalyticsUtility(target_date.strftime('%Y-%m-%d'))\nga.get_report()\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u53e9\u3044\u305f\u5834\u5408,\u30ea\u30f3\u30af\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3053\u308c\u3092\u30b3\u30d4\u30da\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u8cbc\u308a\u4ed8\u3051\u308c\u3070\u8a8d\u8a3c\u5b8c\u4e86\nhttps://accounts.google.com/o/oauth2/auth?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics.readonly&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2F&response_type=code&client_id=xxxxx-gd5j31ge4jdobhlg9a3jqnveae34cag1.apps.googleusercontent.com&access_type=offline\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\nhttps://developers.google.com/analytics/devguides/reporting/core/v4/quickstart/installed-py\n\n\u30b5\u30f3\u30d7\u30ebclass\n\n```\nclass GoogleAnalyticsUtility(object):\n    SCOPES = ['https://www.googleapis.com/auth/analytics.readonly']\n    DISCOVERY_URI = ('https://analyticsreporting.googleapis.com/$discovery/rest')\n    VIEW_ID = 'xxxx'\n\n    def __init__(self, target_date):\n        self.target_date = target_date\n\n    def get_report(self):\n        parser = argparse.ArgumentParser(\n                formatter_class=argparse.RawDescriptionHelpFormatter,\n                parents=[tools.argparser])\n        flags = parser.parse_args(['--noauth_local_webserver'])\n        CLIENT_SECRETS_PATH = os.path.join(settings.BASE_DIR, '../etc/googleapi/client_id.json')\n        flow = client.flow_from_clientsecrets(\n                CLIENT_SECRETS_PATH, scope=self.SCOPES,\n                message=tools.message_if_missing(CLIENT_SECRETS_PATH))\n\n        storage = file.Storage(os.path.join(settings.BASE_DIR, '../etc/googleapi/analyticsreporting.dat'))\n        credentials = storage.get()\n        if credentials is None or credentials.invalid:\n            credentials = tools.run_flow(flow, storage, flags)\n        http = credentials.authorize(http=httplib2.Http())\n        analytics = build('analytics', 'v4', http=http, discoveryServiceUrl=self.DISCOVERY_URI)\n        reports = analytics.reports()\n        return reports.batchGet(\n                body={\n                    'reportRequests': [\n                        {\n                            'viewId': self.VIEW_ID,\n                            'dateRanges': [{'startDate': self.target_date, 'endDate': 'today'}],\n                            \"dimensions\": [\n                                {\n                                    \"name\": \"ga:productSku\",  # \u8ca9\u58f2\u3057\u305f\u54c1\u76ee\u306e\u5546\u54c1\u30b3\u30fc\u30c9\u3067\u3059\u3002\n                                }],\n                            'metrics': [\n                                {'expression': 'ga:itemQuantity'}  # e \u30b3\u30de\u30fc\u30b9 \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3067\u58f2\u308c\u305f\u5546\u54c1\u306e\u6570\u3067\u3059\u3002\n                            ],\n                            'pageSize': 50000,\n                            'pageToken': \"nextpage\",\n                            \"orderBys\":\n                                [\n                                    {\"fieldName\": \"ga:itemQuantity\", \"sortOrder\": \"DESCENDING\"},\n                                ]\n                        }]\n                }\n        ).execute()\n\ntarget_date = date.today() - timedelta(days=7)\nga = GoogleAnalyticsUtility(target_date.strftime('%Y-%m-%d'))\nga.get_report()\n```\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u53e9\u3044\u305f\u5834\u5408,\u30ea\u30f3\u30af\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3053\u308c\u3092\u30b3\u30d4\u30da\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u8cbc\u308a\u4ed8\u3051\u308c\u3070\u8a8d\u8a3c\u5b8c\u4e86\n\n`https://accounts.google.com/o/oauth2/auth?scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fanalytics.readonly&redirect_uri=http%3A%2F%2Flocalhost%3A8080%2F&response_type=code&client_id=xxxxx-gd5j31ge4jdobhlg9a3jqnveae34cag1.apps.googleusercontent.com&access_type=offline`\n", "tags": ["Python", "google-api-python-client", "googleapi", "cli"]}