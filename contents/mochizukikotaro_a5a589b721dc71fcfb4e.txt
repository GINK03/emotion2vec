{"context": "\n\n\u30c7\u30d7\u30ed\u30a4\u306e\u6d41\u308c\n\nStep0. \u4e0b\u3054\u3057\u3089\u3048\n\nS3 \u306b\u30d0\u30b1\u30c3\u30c8\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u4ee5\u964d\u30d0\u30b1\u30c3\u30c8\u540d\u3092 bucket_name \u3068\u3057\u3066\u9032\u3081\u307e\u3059\uff09\n\nbrew awscli \u306a\u3069\u3067\u3001aws \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u7528\u610f\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u306b\u306f\u3001index.js \u3092 zip \u3057\u305f\u3088\u3046\u306a\uff08\u3088\u304f\u308f\u304b\u3089\u306a\u3044\uff09\u3082\u306e\u304c\u3001\u30a2\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\nStep1. \u7528\u610f\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\uff12\u3064\u3067\u3059\u3002\n\nindex.js\ntemplate.yml\n\nindex.js \u306b Lambda \u306e\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u3044\u3066\u3001template.yml \u306b\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u5f8c\u8ff0\u3002\n\nStep2. \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f2\u3064\u3067\u3059\u3002\n\npackage\n$ aws cloudformation package \\\n --template-file template.yml \\\n --output-template-file new_template.yml \\\n --s3-bucket {bucket_name}\n\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001new_template.yml \u304c\u751f\u6210\u3055\u308c\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\ndeploy\n$ aws cloudformation deploy \\\n --template-file new_template.yml \\\n --stack-name {my-stack-name} \\\n --capabilities CAPABILITY_IAM\n\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3001Lambda + API Gateway \u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5b8c\u4e86\u3057\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\n\nindex.js\n'use strict';\nconsole.log('Loading function');\n\nconst createResponse = (statusCode, body) => {\n  return {\n    \"statusCode\": statusCode,\n    \"body\": body || \"\"\n  }\n};\n\nexports.handler = (event, context, callback) => {\n  const response = createResponse(200, \"Hello SAM.\");\n  callback(null, response);\n};\n\n\n\ntemplate.yml\nAWSTemplateFormatVersion : '2010-09-09'\nTransform: AWS::Serverless-2016-10-31\nDescription: Send data to Pardot from ferretone's form.\nResources:\n  HelloWorldFunction:\n    Type: AWS::Serverless::Function\n    Properties:\n      Handler: index.handler\n      Runtime: nodejs4.3\n      Events:\n        GetResource:\n          Type: Api\n          Properties:\n            Path: /\n            Method: get\n\n\n\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\nindex.js \u5185\u306e\u3001 response \u306e\u5f62\u5f0f\u3092\u4e0a\u8ff0\u306e\u3088\u3046\u306b\u3057\u306a\u3044\u3068\u3001Lambda \u5358\u4f53\u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u3089\u306a\u3044\u3051\u3069\u3001API Gateway \u306e\u30c6\u30b9\u30c8\u3067\u306f\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\u307b\u304b\u306b\u3082\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u3001\u3084\u308a\u3088\u3046\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u306a\u4f8b\u3068\u3057\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n# \u30c7\u30d7\u30ed\u30a4\u306e\u6d41\u308c\n\n## Step0. \u4e0b\u3054\u3057\u3089\u3048\n\n- S3 \u306b\u30d0\u30b1\u30c3\u30c8\u3092\u7528\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u4ee5\u964d\u30d0\u30b1\u30c3\u30c8\u540d\u3092 bucket_name \u3068\u3057\u3066\u9032\u3081\u307e\u3059\uff09\n- `brew awscli` \u306a\u3069\u3067\u3001`aws` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u7528\u610f\u3057\u305f\u30d0\u30b1\u30c3\u30c8\u306b\u306f\u3001`index.js` \u3092 zip \u3057\u305f\u3088\u3046\u306a\uff08\u3088\u304f\u308f\u304b\u3089\u306a\u3044\uff09\u3082\u306e\u304c\u3001\u30a2\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\n\n## Step1. \u7528\u610f\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f\uff12\u3064\u3067\u3059\u3002\n\n- index.js\n- template.yml\n\n`index.js` \u306b Lambda \u306e\u30ed\u30b8\u30c3\u30af\u3092\u66f8\u3044\u3066\u3001`template.yml` \u306b\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u306f\u5f8c\u8ff0\u3002\n\n\n## Step2. \u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u306f2\u3064\u3067\u3059\u3002\n\n```zsh:package\n$ aws cloudformation package \\\n --template-file template.yml \\\n --output-template-file new_template.yml \\\n --s3-bucket {bucket_name}\n```\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3001`new_template.yml` \u304c\u751f\u6210\u3055\u308c\u3001S3\u30d0\u30b1\u30c3\u30c8\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u30a2\u30c3\u30d7\u3055\u308c\u307e\u3059\u3002\n\n```zsh:deploy\n$ aws cloudformation deploy \\\n --template-file new_template.yml \\\n --stack-name {my-stack-name} \\\n --capabilities CAPABILITY_IAM\n```\n\n\u4e0a\u306e\u30b3\u30de\u30f3\u30c9\u3001Lambda + API Gateway \u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5b8c\u4e86\u3057\u307e\u3059\u3002\n\n# \u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\n\n```js:index.js\n'use strict';\nconsole.log('Loading function');\n\nconst createResponse = (statusCode, body) => {\n  return {\n    \"statusCode\": statusCode,\n    \"body\": body || \"\"\n  }\n};\n\nexports.handler = (event, context, callback) => {\n  const response = createResponse(200, \"Hello SAM.\");\n  callback(null, response);\n};\n```\n\n```yaml:template.yml\nAWSTemplateFormatVersion : '2010-09-09'\nTransform: AWS::Serverless-2016-10-31\nDescription: Send data to Pardot from ferretone's form.\nResources:\n  HelloWorldFunction:\n    Type: AWS::Serverless::Function\n    Properties:\n      Handler: index.handler\n      Runtime: nodejs4.3\n      Events:\n        GetResource:\n          Type: Api\n          Properties:\n            Path: /\n            Method: get\n```\n\n\n\n\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\n\n`index.js` \u5185\u306e\u3001 response \u306e\u5f62\u5f0f\u3092\u4e0a\u8ff0\u306e\u3088\u3046\u306b\u3057\u306a\u3044\u3068\u3001Lambda \u5358\u4f53\u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u3089\u306a\u3044\u3051\u3069\u3001API Gateway \u306e\u30c6\u30b9\u30c8\u3067\u306f\u3001\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\n\n\u307b\u304b\u306b\u3082\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u3001\u3084\u308a\u3088\u3046\u306f\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u306a\u4f8b\u3068\u3057\u3066\u307e\u3068\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\n", "tags": ["lambda", "APIGateway"]}