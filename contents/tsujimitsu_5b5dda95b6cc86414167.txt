{"context": " More than 1 year has passed since last update.\noutlook\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3055\u308c\u3066\u3044\u308bzip\u30d5\u30a1\u30a4\u30eb\u3092\u4efb\u610f\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u683c\u7d0d\u3059\u308b\u3002\n\u683c\u7d0d\u3057\u305fzip\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3059\u308b\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u4ed8\u306e\u5834\u5408\u306f\u4e88\u3081\u6c7a\u3081\u3089\u308c\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u3046\uff09\nzip\u30d5\u30a1\u30a4\u30eb\u89e3\u51cd\u306b\u306f7zip\u306edll\u3092\u7528\u3044\u308b\u3002\n\n\n\u4e8b\u524d\u6e96\u5099\n\n64bit OS (Windows8\u7b49\uff09\n\n\nhttp://www.madobe.net/archiver/index.html \u304b\u30897-ZIP32.DLL \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u300c7-zip32.dll\u300d\u3092\u300cC:\\Windows\\SysWOW64\u300d\u306b\u683c\u7d0d\u3059\u308b\u3002\n\n\n32bit OS (Windows XX)\n\n\nhttp://www.madobe.net/archiver/index.html \u304b\u30897-ZIP32.DLL \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u300c7-zip32.dll\u300d\u3092\u300cC:\\Windows\\System32\u300d\u306b\u683c\u7d0d\u3059\u308b\u3002\n\n\n\u30b3\u30fc\u30c9\n\nsaveZip.vba\n\nOption Explicit\n\nPrivate Declare Function SevenZip Lib \"7-zip32.DLL\" ( _\n    ByVal hWnd As Long, _\n    ByVal szCmdLine As String, _\n    ByVal szOutput As String, _\n    ByVal dwSize As Long) As Long\n\nConst SAVE_PATH = \"C:\\mail_attach\\\"\n\nPublic Sub CustomRule_SaveFile(Item As Outlook.MailItem)\n    Dim SaveStatus\n\n    SaveStatus = SaveAttachFile(Item.Attachments)\n\nEnd Sub\n\nFunction SaveAttachFile(Attachments As Outlook.Attachments)\n    Dim UnzipStatus\n    Dim sh As Object\n    Dim ItemNumber, i As Long\n    ItemNumber = Attachments.Count\n\n\n    For i = 1 To ItemNumber\n        Attachments.Item(i).SaveAsFile (SAVE_PATH & Attachments.Item(i).DisplayName)\n        UnzipStatus = ExtractZIP(SAVE_PATH, SAVE_PATH & Attachments.Item(i).DisplayName, \"test\")\n\n\n    Next i\n\n    SaveAttachFile = True\n\nEnd Function\n\n\n'ZIP\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\n'\u5f15\u6570 sDstPath\uff1a\u89e3\u51cd\u5148\u306e\u30d5\u30a9\u30eb\u30c0\u30fc\u306e\u30d1\u30b9\n'     sZIPFile\uff1aZIP\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n'     sPassWord\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u3000\u7701\u7565\u53ef\n'\u8fd4\u308a\u5024\u3000\u6210\u529f\u3057\u305f\u3089 True\u3001\u5931\u6557\u3057\u305f\u3089False\nPublic Function ExtractZIP(sDstPath As String, sZIPFile As String, Optional sPassWord As String = \"\") As Boolean\n    Dim sCmd As String\n    sCmd = \"X -hide -aoa \"\n    If sPassWord <> \"\" Then sCmd = sCmd & \"-P\" & sPassWord & \" \"\n    sCmd = sCmd & Q2(sZIPFile) & \" -o\" & Q2(sDstPath)\n\n    Debug.Print (sCmd)\n\n    ExtractZIP = DoSevenZip(sCmd) = 0\nEnd Function\n\nPrivate Function DoSevenZip(sCmd As String) As Long\n    Dim sRet As String * 1024\n    DoSevenZip = SevenZip(0, sCmd, sRet, 1024)\n    If DoSevenZip <> 0 Then MsgBox (Left(sRet, InStr(sRet, vbNullChar) - 1))\nEnd Function\n\nPublic Function Q2(ByVal Text As String) As String\n    Q2 = \"\"\"\" & Replace(Text, \"\"\"\", \"\"\"\"\"\") & \"\"\"\"\nEnd Function\n\n\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\nhttp://hatenachips.blog34.fc2.com/blog-entry-376.html\nhttps://gist.github.com/hatena19/6052894\n\n\n* outlook\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u306b\u6dfb\u4ed8\u3055\u308c\u3066\u3044\u308bzip\u30d5\u30a1\u30a4\u30eb\u3092\u4efb\u610f\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u683c\u7d0d\u3059\u308b\u3002\n* \u683c\u7d0d\u3057\u305fzip\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\u3059\u308b\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u4ed8\u306e\u5834\u5408\u306f\u4e88\u3081\u6c7a\u3081\u3089\u308c\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u3046\uff09\n* zip\u30d5\u30a1\u30a4\u30eb\u89e3\u51cd\u306b\u306f7zip\u306edll\u3092\u7528\u3044\u308b\u3002\n\n# \u4e8b\u524d\u6e96\u5099\n## 64bit OS (Windows8\u7b49\uff09\n* http://www.madobe.net/archiver/index.html \u304b\u30897-ZIP32.DLL \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n* \u300c7-zip32.dll\u300d\u3092\u300cC:\\Windows\\SysWOW64\u300d\u306b\u683c\u7d0d\u3059\u308b\u3002\n\n## 32bit OS (Windows XX)\n* http://www.madobe.net/archiver/index.html \u304b\u30897-ZIP32.DLL \u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n* \u300c7-zip32.dll\u300d\u3092\u300cC:\\Windows\\System32\u300d\u306b\u683c\u7d0d\u3059\u308b\u3002\n\n# \u30b3\u30fc\u30c9\n\n``` saveZip.vba\n\nOption Explicit\n\nPrivate Declare Function SevenZip Lib \"7-zip32.DLL\" ( _\n    ByVal hWnd As Long, _\n    ByVal szCmdLine As String, _\n    ByVal szOutput As String, _\n    ByVal dwSize As Long) As Long\n \nConst SAVE_PATH = \"C:\\mail_attach\\\"\n\nPublic Sub CustomRule_SaveFile(Item As Outlook.MailItem)\n    Dim SaveStatus\n\n    SaveStatus = SaveAttachFile(Item.Attachments)\n\nEnd Sub\n\nFunction SaveAttachFile(Attachments As Outlook.Attachments)\n    Dim UnzipStatus\n    Dim sh As Object\n    Dim ItemNumber, i As Long\n    ItemNumber = Attachments.Count\n\n\n    For i = 1 To ItemNumber\n        Attachments.Item(i).SaveAsFile (SAVE_PATH & Attachments.Item(i).DisplayName)\n        UnzipStatus = ExtractZIP(SAVE_PATH, SAVE_PATH & Attachments.Item(i).DisplayName, \"test\")\n        \n        \n    Next i\n    \n    SaveAttachFile = True\n    \nEnd Function\n\n\n'ZIP\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u51cd\n'\u5f15\u6570 sDstPath\uff1a\u89e3\u51cd\u5148\u306e\u30d5\u30a9\u30eb\u30c0\u30fc\u306e\u30d1\u30b9\n'     sZIPFile\uff1aZIP\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n'     sPassWord\uff1a\u30d1\u30b9\u30ef\u30fc\u30c9\u3000\u7701\u7565\u53ef\n'\u8fd4\u308a\u5024\u3000\u6210\u529f\u3057\u305f\u3089 True\u3001\u5931\u6557\u3057\u305f\u3089False\nPublic Function ExtractZIP(sDstPath As String, sZIPFile As String, Optional sPassWord As String = \"\") As Boolean\n    Dim sCmd As String\n    sCmd = \"X -hide -aoa \"\n    If sPassWord <> \"\" Then sCmd = sCmd & \"-P\" & sPassWord & \" \"\n    sCmd = sCmd & Q2(sZIPFile) & \" -o\" & Q2(sDstPath)\n    \n    Debug.Print (sCmd)\n    \n    ExtractZIP = DoSevenZip(sCmd) = 0\nEnd Function\n \nPrivate Function DoSevenZip(sCmd As String) As Long\n    Dim sRet As String * 1024\n    DoSevenZip = SevenZip(0, sCmd, sRet, 1024)\n    If DoSevenZip <> 0 Then MsgBox (Left(sRet, InStr(sRet, vbNullChar) - 1))\nEnd Function\n \nPublic Function Q2(ByVal Text As String) As String\n    Q2 = \"\"\"\" & Replace(Text, \"\"\"\", \"\"\"\"\"\") & \"\"\"\"\nEnd Function\n\n```\n\n\n# \u53c2\u8003\u30b5\u30a4\u30c8\n* http://hatenachips.blog34.fc2.com/blog-entry-376.html\n* https://gist.github.com/hatena19/6052894\n", "tags": ["VBA", "Outlook"]}