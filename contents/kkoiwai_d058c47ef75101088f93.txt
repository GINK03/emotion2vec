{"context": "1\u65e5\u76ee \u3067\u306f\u3001IBM Bluemix\u306bNode-RED\u3092\u5c0e\u5165\u3057\u3001WebSocket\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u3066\u3001Ambient\u3068\u3044\u3046\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d3\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u9032\u307f\u307e\u3057\u305f\u3002\n2\u65e5\u76ee\u3067\u306f\u3001\u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092NoSQL DB(Cloudant)\u306b\u3068\u308a\u3042\u3048\u305a\u4fdd\u5b58\u3059\u308b\u306e\u3068\u3001Web\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u3053\u308d\u307e\u3067\u884c\u304d\u307e\u3057\u305f\u3002\n3\u65e5\u76ee\u3067\u3001\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u3081\u308b\u5f62\u306b\u3057\u3066\u3001\u5229\u7528\u7387\u3092\u8a08\u7b97\u3057\u307e\u3057\u305f\u3002\n\u6642\u9593\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u3055\u304f\u3089IoT Platform\u304c\u7121\u4e8b\u5c4a\u304d\u307e\u3057\u305f\u306e\u3067\u3001Arduio\u3092\u4f7f\u3063\u3066\u3001\u5b9f\u969b\u306b\u63a5\u7d9a\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u7d50\u679c\u304b\u3089\u8a00\u3046\u3068\u3001Node-RED\u90e8\u5206\u306f\uff08\u307b\u307c\uff09\u60f3\u5b9a\u901a\u308a\u52d5\u304d\u307e\u3057\u305f\uff01\uff01\n\n\u76ee\u6b21\n\nArduino\u3068\u306e\u5408\u4f53\nArduino\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\nNode-RED\u3068\u306e\u63a5\u7d9a\n\n\n\u4e0d\u8981\u306akeepalive\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\n\n\n\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u63a5\u7d9a\n\n\n\nArduino\u3068\u306e\u5408\u4f53\n\u3053\u3053\u306f\u3001\u3055\u304f\u3089\u306eIoT Platform \u03b2\u3092Arduino\u3068\u7e4b\u3052\u3066WebSocket\u30b5\u30fc\u30d3\u30b9\u306b\u9023\u643a\u3059\u308b\u307e\u3067\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n\u6700\u5f8c\u306e\u624b\u9806\u306b\u3042\u308b\u3068\u304a\u308a\u3001Arduino\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3001\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u305b\u3093\u3002\n\n\nArduino\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\n\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u307b\u3068\u3093\u3069\u305d\u306e\u307e\u307e\u4f7f\u308f\u305b\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002GitHub\u306f\u3053\u3061\u3089\u3002\nhttps://github.com/kkoiwai/SakuraIoT_DoorSensor\nIoT Platform\u306b\u306f\u3001128\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u304c\u3042\u308a\u3001\u305d\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u305d\u308c\u305e\u308c\u306b\u30018\u30d0\u30a4\u30c8\uff08\u30aa\u30af\u30c6\u30c3\u30c8\uff09\u306e\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u5f53\u793e\u306e\u4f1a\u8b70\u5ba4\u306f\u3001\u5229\u7528\u4e2d\u4ee5\u5916\u306f\u30c9\u30a2\u3092\u958b\u3051\u3066\u304a\u304f\u30eb\u30fc\u30eb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001Arduino\u306b\u30c9\u30a2\u30bb\u30f3\u30b5\uff08\u3053\u3093\u306a\u306e\uff09\u3092\u63a5\u7d9a\u3057\u3066\u3001\u4e00\u3064\u306e\u90e8\u5c4b\u306b\u3072\u3068\u3064\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u5272\u308a\u5f53\u3066\u3001\u30c9\u30a2\u304c\u958b\u3044\u3066\u3044\u308c\u3070\u30bc\u30ed\u3001\u30c9\u30a2\u304c\u9589\u307e\u3063\u3066\u3044\u308c\u3070\u30a4\u30c1\u3092\u9001\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001\u306a\u308b\u3079\u304f\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u30015\u79d2\u304a\u304d\u306b\u30eb\u30fc\u30d7\u3092\u56de\u3059\u3053\u3068\u306b\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u6bce\u56de\u901a\u4fe1\u3057\u3066\u3044\u305f\u3089\u305d\u308c\u306a\u308a\u306b\u901a\u4fe1\u91cf\u304c\u304b\u3055\u3093\u3067\u3057\u307e\u3046\u306e\u3067\u3001\u72b6\u614b\u304c\u5909\u308f\u3063\u305f\u3068\u304d\u306b\u3060\u3051\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n#include <SakuraIO.h>\n\nSakuraIO_I2C sakuraio;\n\n// \u63a5\u7d9a\u3059\u308b\u30bb\u30f3\u30b5\u306e\u6570\nconst int numSensors = 3;\n\n// \u30c9\u30a2\u30bb\u30f3\u30b5\u3092\u63a5\u7d9a\u3059\u308bArduino\u4e0a\u306e\u30d4\u30f3\nconst int connectedPins[] = {2,3,4};\n\n// \u4e0a\u8a18sensorPin\u306b\u8a72\u5f53\u3059\u308b\u30c1\u30e3\u30f3\u30cd\u30eb\nconst int dataChannels[] = {0,1,2};\n\n// \u4e0a\u8a18sensorPin\u306e\u524d\u56de\u306e\u5024 (0:\u30c9\u30a2\u958b\u653e 1:\u30c9\u30a2\u9589\u6249\uff09\nint prevStatus[numSensors];\n\nvoid setup() {\n\n  // \u3055\u304f\u3089IoT\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n  Serial.begin(9600);\n  Serial.print(\"Waiting to come online\");\n  for(;;){\n    if( (sakuraio.getConnectionStatus() & 0x80) == 0x80 ) break;\n    Serial.print(\".\");\n    delay(1000);\n  }\n  Serial.println(\"\");\n\n\n  uint8_t request[33] = {};\n  uint8_t response[33] = {};\n\n\n  // ProductID\n  uint16_t pid = sakuraio.getProductID();\n  Serial.print(\"PID \");\n  Serial.println(pid);\n\n  // UniqueID\n  sakuraio.getUniqueID((char *)response);\n  Serial.print(\"UID \");\n  Serial.println((char *)response);\n\n  // Version\n  sakuraio.getFirmwareVersion((char *)response);\n  Serial.print(\"Ver \");\n  Serial.println((char *)response);\n\n  // Connection Status\n  uint8_t connectionStatus = sakuraio.getConnectionStatus();\n  Serial.print(\"Status \");\n  Serial.println(connectionStatus);\n\n  //getSignalQuarity\n  uint8_t signalQuarity = sakuraio.getSignalQuarity();\n  Serial.print(\"Quality \");\n  Serial.println(signalQuarity);\n\n\n  // \u30bb\u30f3\u30b5\u30fc\u30d4\u30f3\u306e\u8a2d\u5b9a\n  // Pullup\u62b5\u6297\u3092\u63a5\u7d9a\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u3001INPUT\u3067\u306f\u306a\u304fINPUT_PULLUP\u3092\u8a2d\u5b9a\u3002\n  // \u305f\u3060\u3057On/Off\u3068HIGH/LOW\u304c\u9006\u306b\u306a\u308b\u70b9\u306b\u6ce8\u610f\u3002\n\n  for(int i =0; i < numSensors; i++){\n    pinMode(connectedPins[i], INPUT_PULLUP);\n  }\n\n}\n\n\nvoid loop() {\n\n  // Unixtime\n  uint32_t unixtime = (uint32_t)(sakuraio.getUnixtime()/1000UL);\n  Serial.print(\"Unixtime \");\n  Serial.println(unixtime);\n\n  // Tx Queue\n  uint8_t ret;\n\n int currentPinStatus;\n\nfor(int i =0; i < numSensors; i++){\n    // \u73fe\u6642\u70b9\u306e\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u72b6\u614b\u3092\u53d6\u5f97\n    // INPUT_PULLUP\u306a\u306e\u3067\u3001HIGH=off(0), LOW=on(1)\n    if( digitalRead(connectedPins[i])== HIGH) {\n      currentPinStatus = 0;\n    }else{\n      currentPinStatus = 1;\n    }\n\n    // \u3082\u3057\u524d\u56de\u306e\u5024\u3068\u7570\u306a\u3063\u3066\u3044\u305f\u3089\u3001queue\u306b\u767b\u9332\n    if( prevStatus[i] != currentPinStatus) {\n      prevStatus[i] = currentPinStatus;\n      Serial.print(\"Enqueue (Pin\");\n      Serial.print(connectedPins[i]);\n      Serial.print(\") \");\n      Serial.println(currentPinStatus);\n\n      ret = sakuraio.enqueueTx((uint8_t)dataChannels[i], (int32_t)currentPinStatus);\n      Serial.println(ret);\n    }\n  }\n\n  uint8_t avail;\n  uint8_t queued;\n  sakuraio.getTxQueueLength(&avail, &queued);\n  Serial.print(\"Tx Available=\");\n  Serial.print(avail);\n  Serial.print(\" Queued=\");\n  Serial.println(queued);\n\n  // queue \u306b\u6e9c\u307e\u3063\u3066\u3044\u305f\u3089\u9001\u4fe1\n  if(queued > 0){\n    ret = sakuraio.send();\n    Serial.print(\"Send \");\n    Serial.println(ret);\n  }\n\n  delay(5000);\n}\n\n\n\nNode-RED\u3068\u306e\u63a5\u7d9a\n\u306a\u3093\u3066\u3053\u3068\u7121\u3044\u30011\u65e5\u76ee\u306b\u4f5c\u3063\u305fWebSocket\u53d7\u4fe1\u30ce\u30fc\u30c9\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n\n\n\n\n\u4e0d\u8981\u306a\u60c5\u5831\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\n\u5b9f\u969b\u306b\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3068\u3001\u6570\u79d2\u304a\u304d\u306b\u3001keepalive\u304c\u98db\u3093\u3067\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u7121\u8996\u3059\u308b\u3088\u3046\u306b\u3001\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\n\n\u300c\u66f4\u65b0\u60c5\u5831\u306e\u307f\u4fdd\u5b58\u300d\u306e\u4e2d\u8eab\nif( msg.payload.type ==\"channels\" ){\n    return msg;\n}else{\n    msg.payload = null;\n    return null;\n}\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u5168\u4f53\n[{\"id\":\"99a2e322.3dbee\",\"type\":\"websocket in\",\"z\":\"396465eb.1d8e22\",\"name\":\"WebSocket (sakura)\",\"server\":\"\",\"client\":\"df973c4.18d10c\",\"x\":114,\"y\":2071,\"wires\":[[\"1dc0a90b.5a5a7f\",\"79fb8120.0b87c\"]]},{\"id\":\"1dc0a90b.5a5a7f\",\"type\":\"debug\",\"z\":\"396465eb.1d8e22\",\"name\":\"WebSocket\u53d7\u4fe1\u30c7\u30fc\u30bf\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":169.03572409493586,\"y\":2142.2857789993286,\"wires\":[]},{\"id\":\"52487252.24dfdc\",\"type\":\"function\",\"z\":\"396465eb.1d8e22\",\"name\":\"Global\u5909\u6570\u306e\u66f4\u65b0\",\"func\":\" msg.payload.payload.channels.forEach(function(v) {\\n     context.global.data[v.channel] = v.value;\\n\\n});\\n\\nmsg.payload = JSON.stringify(context.global.data);\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":439.46428244454523,\"y\":2141.2142763137817,\"wires\":[[\"a45c41fa.5c5e5\"]]},{\"id\":\"a45c41fa.5c5e5\",\"type\":\"debug\",\"z\":\"396465eb.1d8e22\",\"name\":\"Global\u5909\u6570\u306b\u4fdd\u5b58\u3055\u308c\u305f\u5024\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":675.4642824445452,\"y\":2140.7142763137817,\"wires\":[]},{\"id\":\"79fb8120.0b87c\",\"type\":\"json\",\"z\":\"396465eb.1d8e22\",\"name\":\"\",\"x\":319.58928244454523,\"y\":2072.2142763137817,\"wires\":[[\"bff12351.e8cac8\"]]},{\"id\":\"3350a9c9.c1dafe\",\"type\":\"cloudant out\",\"z\":\"396465eb.1d8e22\",\"name\":\"Cloudant\u3078\u4fdd\u5b58\",\"cloudant\":\"\",\"database\":\"iot_data\",\"service\":\"IOT\u30c6\u30b9\u30c8-cloudantNoSQLDB\",\"payonly\":true,\"operation\":\"insert\",\"x\":712.2142824445452,\"y\":2072.7142763137817,\"wires\":[]},{\"id\":\"bff12351.e8cac8\",\"type\":\"function\",\"z\":\"396465eb.1d8e22\",\"name\":\"\u66f4\u65b0\u60c5\u5831\u306e\u307f\u4fdd\u5b58\",\"func\":\"if( msg.payload.type ==\\\"channels\\\" ){\\n    return msg;\\n}else{\\n    msg.payload = null;\\n    return null;\\n}\",\"outputs\":1,\"noerr\":0,\"x\":491.71428244454523,\"y\":2071.7142763137817,\"wires\":[[\"3350a9c9.c1dafe\",\"52487252.24dfdc\"]]},{\"id\":\"a545b0a9.1ad358\",\"type\":\"comment\",\"z\":\"396465eb.1d8e22\",\"name\":\"\u3055\u304f\u3089IoT Platform \u304b\u3089\u53d7\u4fe1\",\"info\":\"\",\"x\":147.57143729073664,\"y\":2021,\"wires\":[]},{\"id\":\"df973c4.18d10c\",\"type\":\"websocket-client\",\"z\":\"\",\"path\":\"wss://api.sakura.io/ws/v1/xxxxxxxxxxxxxxx\",\"wholemsg\":\"false\"}]\n\n\n\n\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u63a5\u7d9a\narduino\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u30012,3,4 \u30d4\u30f3\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u308c\u3089\u306e\u30d4\u30f3\u3068\u3001GND\u306e\u30d4\u30f3\u3092\u3001\u305d\u308c\u305e\u308c\u30c9\u30a2\u30bb\u30f3\u30b5\u3092\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u30ea\u30fc\u30c9\u7dda\u306b\u306f\u3001\u3053\u3061\u3089\u306e\u3000TJC8\u30b3\u30cd\u30af\u30bf\u3092\u534a\u7530\u4ed8\u3051\u3057\u307e\u3057\u305f\u3002\n\n\u8a66\u3057\u306b\u30012\u30d4\u30f3\u3092GND\u3068\u30b7\u30e7\u30fc\u30c8\u3055\u305b\u308b\u3068\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u7a7a\u304d\u72b6\u6cc1\u304c\u5206\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n\u623b\u308b\n1\u65e5\u76ee - IBM Bluemix\u306bNode-RED\u3092\u5c0e\u5165\u3057\u3001WebSocket\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u3066\u3001Ambient\u3068\u3044\u3046\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d3\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3059\u308b\u3068\u3053\u308d\u307e\u3067\n2\u65e5\u76ee - \u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092NoSQL DB(Cloudant)\u306b\u3068\u308a\u3042\u3048\u305a\u4fdd\u5b58\u3059\u308b\u306e\u3068\u3001Web\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u3053\u308d\u307e\u3067\n3\u65e5\u76ee - \u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u3081\u308b\u5f62\u306b\u3057\u3066\u3001\u5229\u7528\u7387\u3092\u8a08\u7b97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\n[1\u65e5\u76ee](http://qiita.com/kkoiwai/items/196cf8136c5a633493c0) \u3067\u306f\u3001IBM Bluemix\u306bNode-RED\u3092\u5c0e\u5165\u3057\u3001WebSocket\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u3066\u3001Ambient\u3068\u3044\u3046\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d3\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u9032\u307f\u307e\u3057\u305f\u3002\n[2\u65e5\u76ee](http://qiita.com/kkoiwai/items/7b311708c42dbdae6aca)\u3067\u306f\u3001\u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092NoSQL DB(Cloudant)\u306b\u3068\u308a\u3042\u3048\u305a\u4fdd\u5b58\u3059\u308b\u306e\u3068\u3001Web\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u3053\u308d\u307e\u3067\u884c\u304d\u307e\u3057\u305f\u3002\n[3\u65e5\u76ee](http://qiita.com/kkoiwai/items/3b0f2acaadd81128ae7a)\u3067\u3001\u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u3081\u308b\u5f62\u306b\u3057\u3066\u3001\u5229\u7528\u7387\u3092\u8a08\u7b97\u3057\u307e\u3057\u305f\u3002\n\u6642\u9593\u304c\u524d\u5f8c\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u304c\u3001\u3055\u304f\u3089IoT Platform\u304c\u7121\u4e8b\u5c4a\u304d\u307e\u3057\u305f\u306e\u3067\u3001Arduio\u3092\u4f7f\u3063\u3066\u3001\u5b9f\u969b\u306b\u63a5\u7d9a\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u7d50\u679c\u304b\u3089\u8a00\u3046\u3068\u3001Node-RED\u90e8\u5206\u306f\uff08\u307b\u307c\uff09\u60f3\u5b9a\u901a\u308a\u52d5\u304d\u307e\u3057\u305f\uff01\uff01\n\n---\n\n\u76ee\u6b21\n\n- Arduino\u3068\u306e\u5408\u4f53\n- Arduino\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\n- Node-RED\u3068\u306e\u63a5\u7d9a\n - \u4e0d\u8981\u306akeepalive\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\n- \u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u63a5\u7d9a\n\n---\n\n## Arduino\u3068\u306e\u5408\u4f53\n\n\u3053\u3053\u306f\u3001[\u3055\u304f\u3089\u306eIoT Platform \u03b2\u3092Arduino\u3068\u7e4b\u3052\u3066WebSocket\u30b5\u30fc\u30d3\u30b9\u306b\u9023\u643a\u3059\u308b\u307e\u3067](http://qiita.com/Lupin3/items/96e6e0ddfda8147ff035)\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\n[\u6700\u5f8c\u306e\u624b\u9806](http://qiita.com/Lupin3/items/96e6e0ddfda8147ff035#5arduino%E3%81%AB%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0%E3%82%92%E6%9B%B8%E3%81%8D%E8%BE%BC%E3%82%80)\u306b\u3042\u308b\u3068\u304a\u308a\u3001Arduino\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u3001[\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0](https://github.com/sakura-internet/SakuraIOArduino/blob/master/examples/Standard/Standard.ino)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u3067\u304d\u307e\u305b\u3093\u3002\n\n<img width=\"712\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-15 15.08.19.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/7bc67a20-bff8-10fe-66f1-93aded893ffc.png\">\n\n\n## Arduino\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\n\n[\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0](https://github.com/sakura-internet/SakuraIOArduino/blob/master/examples/Standard/Standard.ino)\u3092\u307b\u3068\u3093\u3069\u305d\u306e\u307e\u307e\u4f7f\u308f\u305b\u3066\u3082\u3089\u3044\u307e\u3057\u305f\u3002GitHub\u306f\u3053\u3061\u3089\u3002\n\nhttps://github.com/kkoiwai/SakuraIoT_DoorSensor\n\nIoT Platform\u306b\u306f\u3001128\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u304c\u3042\u308a\u3001\u305d\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u305d\u308c\u305e\u308c\u306b\u30018\u30d0\u30a4\u30c8\uff08\u30aa\u30af\u30c6\u30c3\u30c8\uff09\u306e\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u5f53\u793e\u306e\u4f1a\u8b70\u5ba4\u306f\u3001\u5229\u7528\u4e2d\u4ee5\u5916\u306f\u30c9\u30a2\u3092\u958b\u3051\u3066\u304a\u304f\u30eb\u30fc\u30eb\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u306a\u306e\u3067\u3001Arduino\u306b\u30c9\u30a2\u30bb\u30f3\u30b5\uff08[\u3053\u3093\u306a\u306e](http://akizukidenshi.com/catalog/g/gP-04025/)\uff09\u3092\u63a5\u7d9a\u3057\u3066\u3001\u4e00\u3064\u306e\u90e8\u5c4b\u306b\u3072\u3068\u3064\u306e\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u5272\u308a\u5f53\u3066\u3001\u30c9\u30a2\u304c\u958b\u3044\u3066\u3044\u308c\u3070\u30bc\u30ed\u3001\u30c9\u30a2\u304c\u9589\u307e\u3063\u3066\u3044\u308c\u3070\u30a4\u30c1\u3092\u9001\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u307e\u305f\u3001\u306a\u308b\u3079\u304f\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u30015\u79d2\u304a\u304d\u306b\u30eb\u30fc\u30d7\u3092\u56de\u3059\u3053\u3068\u306b\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u6bce\u56de\u901a\u4fe1\u3057\u3066\u3044\u305f\u3089\u305d\u308c\u306a\u308a\u306b\u901a\u4fe1\u91cf\u304c\u304b\u3055\u3093\u3067\u3057\u307e\u3046\u306e\u3067\u3001\u72b6\u614b\u304c\u5909\u308f\u3063\u305f\u3068\u304d\u306b\u3060\u3051\u30c7\u30fc\u30bf\u3092\u9001\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n---\n\n```c\n#include <SakuraIO.h>\n\nSakuraIO_I2C sakuraio;\n\n// \u63a5\u7d9a\u3059\u308b\u30bb\u30f3\u30b5\u306e\u6570\nconst int numSensors = 3;\n\n// \u30c9\u30a2\u30bb\u30f3\u30b5\u3092\u63a5\u7d9a\u3059\u308bArduino\u4e0a\u306e\u30d4\u30f3\nconst int connectedPins[] = {2,3,4};\n\n// \u4e0a\u8a18sensorPin\u306b\u8a72\u5f53\u3059\u308b\u30c1\u30e3\u30f3\u30cd\u30eb\nconst int dataChannels[] = {0,1,2};\n\n// \u4e0a\u8a18sensorPin\u306e\u524d\u56de\u306e\u5024 (0:\u30c9\u30a2\u958b\u653e 1:\u30c9\u30a2\u9589\u6249\uff09\nint prevStatus[numSensors];\n\nvoid setup() {\n\n  // \u3055\u304f\u3089IoT\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n  Serial.begin(9600);\n  Serial.print(\"Waiting to come online\");\n  for(;;){\n    if( (sakuraio.getConnectionStatus() & 0x80) == 0x80 ) break;\n    Serial.print(\".\");\n    delay(1000);\n  }\n  Serial.println(\"\");\n\n  \n  uint8_t request[33] = {};\n  uint8_t response[33] = {};\n\n\n  // ProductID\n  uint16_t pid = sakuraio.getProductID();\n  Serial.print(\"PID \");\n  Serial.println(pid);\n\n  // UniqueID\n  sakuraio.getUniqueID((char *)response);\n  Serial.print(\"UID \");\n  Serial.println((char *)response);\n\n  // Version\n  sakuraio.getFirmwareVersion((char *)response);\n  Serial.print(\"Ver \");\n  Serial.println((char *)response);\n\n  // Connection Status\n  uint8_t connectionStatus = sakuraio.getConnectionStatus();\n  Serial.print(\"Status \");\n  Serial.println(connectionStatus);\n\n  //getSignalQuarity\n  uint8_t signalQuarity = sakuraio.getSignalQuarity();\n  Serial.print(\"Quality \");\n  Serial.println(signalQuarity);\n\n\n  // \u30bb\u30f3\u30b5\u30fc\u30d4\u30f3\u306e\u8a2d\u5b9a\n  // Pullup\u62b5\u6297\u3092\u63a5\u7d9a\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u3001INPUT\u3067\u306f\u306a\u304fINPUT_PULLUP\u3092\u8a2d\u5b9a\u3002\n  // \u305f\u3060\u3057On/Off\u3068HIGH/LOW\u304c\u9006\u306b\u306a\u308b\u70b9\u306b\u6ce8\u610f\u3002\n  \n  for(int i =0; i < numSensors; i++){\n    pinMode(connectedPins[i], INPUT_PULLUP);\n  }\n  \n}\n\n\nvoid loop() {\n\n  // Unixtime\n  uint32_t unixtime = (uint32_t)(sakuraio.getUnixtime()/1000UL);\n  Serial.print(\"Unixtime \");\n  Serial.println(unixtime);\n\n  // Tx Queue\n  uint8_t ret;\n  \n int currentPinStatus;\n\nfor(int i =0; i < numSensors; i++){\n    // \u73fe\u6642\u70b9\u306e\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u72b6\u614b\u3092\u53d6\u5f97\n    // INPUT_PULLUP\u306a\u306e\u3067\u3001HIGH=off(0), LOW=on(1)\n    if( digitalRead(connectedPins[i])== HIGH) {\n      currentPinStatus = 0;\n    }else{\n      currentPinStatus = 1;\n    }\n\n    // \u3082\u3057\u524d\u56de\u306e\u5024\u3068\u7570\u306a\u3063\u3066\u3044\u305f\u3089\u3001queue\u306b\u767b\u9332\n    if( prevStatus[i] != currentPinStatus) {\n      prevStatus[i] = currentPinStatus;\n      Serial.print(\"Enqueue (Pin\");\n      Serial.print(connectedPins[i]);\n      Serial.print(\") \");\n      Serial.println(currentPinStatus);\n      \n      ret = sakuraio.enqueueTx((uint8_t)dataChannels[i], (int32_t)currentPinStatus);\n      Serial.println(ret);\n    }\n  }\n\n  uint8_t avail;\n  uint8_t queued;\n  sakuraio.getTxQueueLength(&avail, &queued);\n  Serial.print(\"Tx Available=\");\n  Serial.print(avail);\n  Serial.print(\" Queued=\");\n  Serial.println(queued);\n\n  // queue \u306b\u6e9c\u307e\u3063\u3066\u3044\u305f\u3089\u9001\u4fe1\n  if(queued > 0){\n    ret = sakuraio.send();\n    Serial.print(\"Send \");\n    Serial.println(ret);\n  }\n\n  delay(5000);\n}\n```\n---\n\n## Node-RED\u3068\u306e\u63a5\u7d9a\n\n\u306a\u3093\u3066\u3053\u3068\u7121\u3044\u30011\u65e5\u76ee\u306b\u4f5c\u3063\u305fWebSocket\u53d7\u4fe1\u30ce\u30fc\u30c9\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n<img width=\"205\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 17.58.34.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/3fabef91-4b06-73de-fa37-199e23760bbb.png\">\n\n<img width=\"446\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 17.57.24.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/9a139400-9c04-ff21-70a5-20adc4d10a72.png\">\n\n\n<img width=\"830\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 18.07.59.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/8eaf2b9a-4574-e335-1806-712ca82224a1.png\">\n\n---\n\n###\u4e0d\u8981\u306a\u60c5\u5831\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\n\n\u5b9f\u969b\u306b\u63a5\u7d9a\u3057\u3066\u307f\u308b\u3068\u3001\u6570\u79d2\u304a\u304d\u306b\u3001keepalive\u304c\u98db\u3093\u3067\u304f\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u7121\u8996\u3059\u308b\u3088\u3046\u306b\u3001\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\n<img width=\"398\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 18.08.59.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/f350a8e6-a17b-c33f-4b2d-1039c7588fbc.png\">\n\n<img width=\"830\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 18.07.59.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/6f2cc91f-f12c-e356-4130-5ffe4f89c6b9.png\">\n\n\u300c\u66f4\u65b0\u60c5\u5831\u306e\u307f\u4fdd\u5b58\u300d\u306e\u4e2d\u8eab\n\n```js\nif( msg.payload.type ==\"channels\" ){\n    return msg;\n}else{\n    msg.payload = null;\n    return null;\n}\n```\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u5168\u4f53\n\n```js\n[{\"id\":\"99a2e322.3dbee\",\"type\":\"websocket in\",\"z\":\"396465eb.1d8e22\",\"name\":\"WebSocket (sakura)\",\"server\":\"\",\"client\":\"df973c4.18d10c\",\"x\":114,\"y\":2071,\"wires\":[[\"1dc0a90b.5a5a7f\",\"79fb8120.0b87c\"]]},{\"id\":\"1dc0a90b.5a5a7f\",\"type\":\"debug\",\"z\":\"396465eb.1d8e22\",\"name\":\"WebSocket\u53d7\u4fe1\u30c7\u30fc\u30bf\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":169.03572409493586,\"y\":2142.2857789993286,\"wires\":[]},{\"id\":\"52487252.24dfdc\",\"type\":\"function\",\"z\":\"396465eb.1d8e22\",\"name\":\"Global\u5909\u6570\u306e\u66f4\u65b0\",\"func\":\" msg.payload.payload.channels.forEach(function(v) {\\n     context.global.data[v.channel] = v.value;\\n\\n});\\n\\nmsg.payload = JSON.stringify(context.global.data);\\n\\nreturn msg;\",\"outputs\":1,\"noerr\":0,\"x\":439.46428244454523,\"y\":2141.2142763137817,\"wires\":[[\"a45c41fa.5c5e5\"]]},{\"id\":\"a45c41fa.5c5e5\",\"type\":\"debug\",\"z\":\"396465eb.1d8e22\",\"name\":\"Global\u5909\u6570\u306b\u4fdd\u5b58\u3055\u308c\u305f\u5024\",\"active\":true,\"console\":\"false\",\"complete\":\"payload\",\"x\":675.4642824445452,\"y\":2140.7142763137817,\"wires\":[]},{\"id\":\"79fb8120.0b87c\",\"type\":\"json\",\"z\":\"396465eb.1d8e22\",\"name\":\"\",\"x\":319.58928244454523,\"y\":2072.2142763137817,\"wires\":[[\"bff12351.e8cac8\"]]},{\"id\":\"3350a9c9.c1dafe\",\"type\":\"cloudant out\",\"z\":\"396465eb.1d8e22\",\"name\":\"Cloudant\u3078\u4fdd\u5b58\",\"cloudant\":\"\",\"database\":\"iot_data\",\"service\":\"IOT\u30c6\u30b9\u30c8-cloudantNoSQLDB\",\"payonly\":true,\"operation\":\"insert\",\"x\":712.2142824445452,\"y\":2072.7142763137817,\"wires\":[]},{\"id\":\"bff12351.e8cac8\",\"type\":\"function\",\"z\":\"396465eb.1d8e22\",\"name\":\"\u66f4\u65b0\u60c5\u5831\u306e\u307f\u4fdd\u5b58\",\"func\":\"if( msg.payload.type ==\\\"channels\\\" ){\\n    return msg;\\n}else{\\n    msg.payload = null;\\n    return null;\\n}\",\"outputs\":1,\"noerr\":0,\"x\":491.71428244454523,\"y\":2071.7142763137817,\"wires\":[[\"3350a9c9.c1dafe\",\"52487252.24dfdc\"]]},{\"id\":\"a545b0a9.1ad358\",\"type\":\"comment\",\"z\":\"396465eb.1d8e22\",\"name\":\"\u3055\u304f\u3089IoT Platform \u304b\u3089\u53d7\u4fe1\",\"info\":\"\",\"x\":147.57143729073664,\"y\":2021,\"wires\":[]},{\"id\":\"df973c4.18d10c\",\"type\":\"websocket-client\",\"z\":\"\",\"path\":\"wss://api.sakura.io/ws/v1/xxxxxxxxxxxxxxx\",\"wholemsg\":\"false\"}]\n```\n\n---\n\n##\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u63a5\u7d9a\n\narduino\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u30012,3,4 \u30d4\u30f3\u3092\u4f7f\u3046\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u305d\u308c\u3089\u306e\u30d4\u30f3\u3068\u3001GND\u306e\u30d4\u30f3\u3092\u3001\u305d\u308c\u305e\u308c\u30c9\u30a2\u30bb\u30f3\u30b5\u3092\u63a5\u7d9a\u3057\u307e\u3059\u3002\n<img width=\"597\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 18.26.30.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/b1ef52e2-f35e-e6fa-f1ba-7957202b5451.png\">\n\n\u30c9\u30a2\u30bb\u30f3\u30b5\u306e\u30ea\u30fc\u30c9\u7dda\u306b\u306f\u3001\u3053\u3061\u3089\u306e\u3000[TJC8\u30b3\u30cd\u30af\u30bf](http://akizukidenshi.com/catalog/g/gC-09247/)\u3092\u534a\u7530\u4ed8\u3051\u3057\u307e\u3057\u305f\u3002\n\n![File_000.jpg](https://qiita-image-store.s3.amazonaws.com/0/135431/5f9d309e-ae3d-f833-9c15-9b3e73c43322.jpeg)\n\n\n\n\n\u8a66\u3057\u306b\u30012\u30d4\u30f3\u3092GND\u3068\u30b7\u30e7\u30fc\u30c8\u3055\u305b\u308b\u3068\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u3001\u7a7a\u304d\u72b6\u6cc1\u304c\u5206\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n<img width=\"475\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-14 18.28.50.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/135431/6386e93e-63f9-ce9d-586c-72b11b4f9bfb.png\">\n\n\n## \u623b\u308b\n\n[1\u65e5\u76ee](http://qiita.com/kkoiwai/items/196cf8136c5a633493c0) - IBM Bluemix\u306bNode-RED\u3092\u5c0e\u5165\u3057\u3001WebSocket\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u3066\u3001Ambient\u3068\u3044\u3046\u30b0\u30e9\u30d5\u8868\u793a\u30b5\u30fc\u30d3\u30b9\u306b\u30c7\u30fc\u30bf\u3092\u9023\u643a\u3059\u308b\u3068\u3053\u308d\u307e\u3067\n[2\u65e5\u76ee](http://qiita.com/kkoiwai/items/7b311708c42dbdae6aca) - \u53d7\u4fe1\u3057\u305f\u30c7\u30fc\u30bf\u3092NoSQL DB(Cloudant)\u306b\u3068\u308a\u3042\u3048\u305a\u4fdd\u5b58\u3059\u308b\u306e\u3068\u3001Web\u30b5\u30a4\u30c8\u3092\u4f5c\u308b\u3068\u3053\u308d\u307e\u3067\n[3\u65e5\u76ee](http://qiita.com/kkoiwai/items/3b0f2acaadd81128ae7a) - \u4fdd\u5b58\u3057\u305f\u30c7\u30fc\u30bf\u3092\u8aad\u3081\u308b\u5f62\u306b\u3057\u3066\u3001\u5229\u7528\u7387\u3092\u8a08\u7b97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\n", "tags": ["IoT", "node-red", "Arduino", "\u3055\u304f\u3089\u306eIoT"]}