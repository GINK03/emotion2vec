{"context": "\n\npacemaker_remote\u3068\u306f\nPacemaker1.1\u7cfb\u3067\u76db\u308a\u8fbc\u307e\u308c\u3066\u3044\u308b\u6a5f\u80fd\u3067Pacemaker\u672c\u4f53\u3067\u3001\u4ed6\u30ce\u30fc\u30c9(\u5b9f\u30de\u30b7\u30f3\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\uff09\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5236\u5fa1\u3059\u308b\u6a5f\u80fd\u3067\u3059\u3002\n\u4ed6\u30ce\u30fc\u30c9\u5074\u306b\u306f\u3001Pacemaker\u672c\u4f53\u30d7\u30ed\u30bb\u30b9\u306f\u5fc5\u8981\u306a\u304f\u3001pacemaker_remote\u30d7\u30ed\u30bb\u30b9\u3068resource-agent\u306e\u307f\u304c(\u5f53\u7136\u3001\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u672c\u4f53\u306f\u5fc5\u8981:apache\u3084\u3001postgresSQL)\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u73fe\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u307e\u3060\u4e0d\u5b89\u5b9a\u306a\u90e8\u5206\u3082\u6709\u308a\u4e0d\u5177\u5408\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u8d77\u52d5\u30fb\u76e3\u8996\u30fb\u505c\u6b62\u306e\u4e00\u9023\u306e\u52d5\u4f5c\u306f\u5236\u9650\u4ed8\u304d\u3067\u3059\u304c\u3001\u53ef\u80fd\u3067\u3059\u3002\n(\u30ea\u30ea\u30fc\u30b9\u7248\u306f\u304b\u306a\u308a\u4e0d\u5b89\u5b9a\u3067\u3042\u308a\u3001\u554f\u984c\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u308b\u7a0b\u5ea6\u52d5\u4f5c\u53ef\u80fd\u306a\u306e\u306f\u3001Pacemaker\u306e\u958b\u767a\u4e2d\u306e\u30c8\u30c3\u30d7\u306e\u6700\u65b0\u7248\u3067\u3059)\n\n\u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u306epacemaker_remote\u3067\u306e\u30af\u30e9\u30b9\u30bf\u69cb\u6210\n\u5b9f\u74b0\u5883\u5185\u3067\u8d77\u52d5\u3057\u305fpacemaker_remote\u3068\u901a\u4fe1\u3092\u884c\u3063\u3066\u3001Pacemaker\u3092\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u304b\u3089\u306e\u6307\u793a\u306b\u5f93\u3063\u3066\u5b9f\u74b0\u5883\u5185\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u8d77\u52d5\u3059\u308b\u69cb\u6210\u3067\u3059\u3002\n\u3053\u306e\u5834\u5408\u3082\u5148\u306b\u66f8\u3044\u305f\u901a\u308a\u3001\u5b9f\u74b0\u5883\u5185\u306b\u5fc5\u8981\u306a\u306e\u306f\u3001pacemaker_remote\u3068resource-agent(\u5f53\u7136\u3001\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u672c\u4f53\u306f\u5fc5\u8981:apache\u3084\u3001postgresSQL)\u3067\u3059\u3002\n\u672c\u6765\u306f\u3001\u30db\u30b9\u30c8\u8907\u6570\u53f0\u3067Pacemaker\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3059\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u307e\u305a\u306f\u3001pacemaker\u30db\u30b9\u30c8\uff11\u53f0(cent7-host)\u3068\u30d9\u30a2\u30e1\u30bf\u30eb\u30ce\u30fc\u30c9\uff12\u53f0(cent7-remote1,cent7-remote2)\u3092\u60f3\u5b9a\u3057\u3066\u3001\u4eee\u60f3\u30de\u30b7\u30f3\uff13\u53f0\u3067\u69cb\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\u30ea\u30bd\u30fc\u30b9\u306f\u7c21\u6613\u306bDummy\u306e\u307f\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u306fstonith\u7121\u306e\u4f8b\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306fstonith\u69cb\u6210\u3092\u7d44\u3080\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001pacemaker\u30db\u30b9\u30c8\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u8d77\u52d5\u3057\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u308b\u70ba\u3001\u4ee5\u4e0b\u3067\u8aac\u660e\u3057\u3066\u3044\u308bdiscovery\u8a2d\u5b9a\u3082\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n * http://qiita.com/HideoYamauchi/items/bf97069072a8ffcf807e\nproperty no-quorum-policy=\"ignore\" \\\n  stonith-enabled=\"false\" \\\n  startup-fencing=\"false\"\n\nrsc_defaults resource-stickiness=\"INFINITY\" \\\n  migration-threshold=\"INFINITY\"\n\nprimitive remote1 ocf:pacemaker:remote \\\n  params \\\n        server=\"cent7-remote1\" \\\n  op monitor interval=3 timeout=15\n\nprimitive remote2 ocf:pacemaker:remote \\\n  params \\\n        server=\"cent7-remote2\" \\\n  op monitor interval=3 timeout=15\n\nprimitive dummy-remote Dummy \\\n  op start interval=0s timeout=60s \\\n  op monitor interval=30s timeout=60s \\\n  op stop interval=0s timeout=60s\n\nlocation loc1 dummy-remote \\\n rule 300: #uname eq remote1 \\\n rule 200: #uname eq remote2\n\nlocation loc2 dummy-remote resource-discovery=\"never\" \\\n rule -inf: #uname eq cent7-host\n\n\n\n\u52d5\u4f5c\u306b\u3064\u3044\u3066\npacemaker_remote\u306f\u3001Pacemaker\u304b\u3089\u306e\u63a5\u7d9a\u30db\u30b9\u30c8\u306e\u5f62\u3067\u52d5\u4f5c\u3057\u3001Pacemaker\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001pacemaker_remote\u81ea\u4f53\u306f\u3001Pacemaker\u672c\u4f53\u306elrmd\u30d7\u30ed\u30bb\u30b9\u306e\u62e1\u5f35\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u5358\u4f53\u3067\u52d5\u4f5c\u3059\u308blrmd\u30d7\u30ed\u30bb\u30b9\u3068\u3044\u3046\u8a8d\u8b58\u3067\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\npacemaker_remote\u306e\u52d5\u4f5c\u3059\u308b\u30ce\u30fc\u30c9\u5074(\u5b9f\u30de\u30b7\u30f3\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\uff09\u3067\u3082\u3001crm_mon\u306a\u3069\u306e\u30b3\u30de\u30f3\u30c9\u306f\u5b9f\u884c\u53ef\u80fd\u3067\u3001\u3053\u308c\u306f\u3001Proxy\u6a5f\u80fd\u3092\u7d4c\u7531\u3057\u3066\u3001Pacemaker\u30ce\u30fc\u30c9\u306b\u8981\u6c42\u304c\u9001\u3089\u308c\u3066\u51e6\u7406\u3055\u308c\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n1) Paemaker/corosync\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\n\u672c\u6765remote\u3067\u63a5\u7d9a\u3059\u308b\u30ce\u30fc\u30c9\u306b\u306fcrosoync\u306a\u3069\u306f\u4e0d\u8981\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u7dba\u9e97\u306b\u3044\u308c\u3066\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u73fe\u6642\u70b9\u306e\u6700\u65b0\u7248Pacemake:pacemaker-4e6f6d6e62d9418ce590a6f7471e96479cb0fdc8\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u3082\u7c21\u6613\u306a\u69cb\u6210\u306e\u70ba\u3001firewalld\u306f\u505c\u6b62\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n2) \u30db\u30b9\u30c8\u5074\u3067\u30ad\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002(/etc/pacemaker\u304c\u7121\u3044\u5834\u5408\u306fmkdir\u3057\u3066\u304f\u3060\u3055\u3044\uff09\ndd if=/dev/urandom of=/etc/pacemaker/authkey bs=4096 count=1\n3) \u4f5c\u6210\u3057\u305f\u30ad\u30fc\u3092\u30ea\u30e2\u30fc\u30c8\u3078\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002(/etc/pacemaker\u304c\u7121\u3044\u5834\u5408\u306fmkdir\u3057\u3066\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n4) remote\u30ce\u30fc\u30c9\u3067\u5148\u306bpacemaker_remote\u3092\u8d77\u52d5\u3057\u3066\u3001host\u30ce\u30fc\u30c9\u3067pacemaker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n[root@cent7-remote1 ~]# systemctl start pacemaker_remote\n\n[root@cent7-remote2 ~]# systemctl start pacemaker_remote\n\n[root@cent7-host ~]# systemctl start pacemaker\n\n\n5) CLI\u30d5\u30a1\u30a4\u30eb\u3092\u6295\u5165\u3057\u307e\u3059\n[root@cent7-host ~]# crm configure load update bare.crm \nWARNING: loc1: referenced node remote1 does not exist\nWARNING: loc1: referenced node remote2 does not exist\nWARNING: remote1: default timeout 20s for start is smaller than the advised 60\nWARNING: remote1: default timeout 20s for stop is smaller than the advised 60\nWARNING: remote1: specified timeout 15 for monitor is smaller than the advised 30\nWARNING: remote2: default timeout 20s for start is smaller than the advised 60\nWARNING: remote2: default timeout 20s for stop is smaller than the advised 60\nWARNING: remote2: specified timeout 15 for monitor is smaller than the advised 30\n\n\n\n6) crm_mon\u3067remote\u3067\u30ea\u30bd\u30fc\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n[root@cent7-host ~]# crm_mon -1 -Af\n..\nStack: corosync\nCurrent DC: cent7-host (version 1.1.13-4e6f6d6) - partition WITHOUT quorum\n3 nodes and 3 resources configured\n\nOnline: [ cent7-host ]\nRemoteOnline: [ remote1 remote2 ]\n\n dummy-remote   (ocf::heartbeat:Dummy): Started remote1\n remote1        (ocf::pacemaker:remote):        Started cent7-host\n remote2        (ocf::pacemaker:remote):        Started cent7-host\n\nNode Attributes:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\nMigration Summary:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\n7)\u5ff5\u306e\u70ba\u3001\u5404\u30ce\u30fc\u30c9\u3067\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u306f\u3001pacemaker_remoted\u306e\u307f\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n[root@cent7-host ~]# ps -ef |grep pace\nroot     15839     1  0 20:46 ?        00:00:00 /usr/sbin/pacemakerd -f\nhaclust+ 15840 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/cib\nroot     15841 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/stonithd\nroot     15842 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/lrmd\nhaclust+ 15843 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/attrd\nhaclust+ 15844 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/pengine\nhaclust+ 15845 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/crmd\nroot     15907 12074  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-host ~]# ps -ef |grep coro\nroot     14494     1  1 20:09 ?        00:00:24 corosync\nroot     15909 12074  0 20:48 pts/0    00:00:00 grep --color=auto coro\n\n[root@cent7-remote1 ~]# ps -ef |grep pace\nroot      2248     1  0 20:46 ?        00:00:00 /usr/sbin/pacemaker_remoted\nroot      2304  2190  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-remote1 ~]# ps -ef |grep coro\nroot      2306  2190  0 20:48 pts/0    00:00:00 grep --color=auto coro\n[root@cent7-remote2 ~]# ps -ef |grep pace\nroot      7037     1  0 20:46 ?        00:00:00 /usr/sbin/pacemaker_remoted\nroot      7063  1088  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-remote2 ~]# ps -ef |grep coro\nroot      7065  1088  0 20:48 pts/0    00:00:00 grep --color=auto coro\n\n8)\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u79fb\u52d5\u3055\u305b\u3066\u307f\u307e\u3059\n[root@cent7-host ~]# crm_resource -M -r  dummy-remote -N remote2 -f\nWARNING: Creating rsc_location constraint 'cli-ban-dummy-remote-on-remote1' with a score of -INFINITY for resource dummy-remote on remote1.\n        This will prevent dummy-remote from running on remote1 until the constraint is removed using the 'crm_resource --clear' command or manually with cibadmin\n        This will be the case even if remote1 is the last node in the cluster\n        This message can be disabled with --quiet\n\n[root@cent7-host ~]# crm_mon -1 -Af\n....\nStack: corosync\nCurrent DC: cent7-host (version 1.1.13-4e6f6d6) - partition WITHOUT quorum\n3 nodes and 3 resources configured\n\nOnline: [ cent7-host ]\nRemoteOnline: [ remote1 remote2 ]\n\n dummy-remote   (ocf::heartbeat:Dummy): Started remote2\n remote1        (ocf::pacemaker:remote):        Started cent7-host\n remote2        (ocf::pacemaker:remote):        Started cent7-host\n\nNode Attributes:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\nMigration Summary:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\n\n\n\u6ce8\u610f\u70b9\npacemaker_remote\u3068Pacemaker\u672c\u4f53\u306e\u540c\u5c45\u306f\u51fa\u6765\u304d\u307e\u305b\u3093\u3002\n * pacemakre_remote\u3092\u8d77\u52d5\u3057\u3066\u3001Pacemaker\u672c\u4f53\u306e\u8d77\u52d5\u306f\u51fa\u6765\u306a\u3044\u3068\u3044\u3046\u610f\u5473\u3002\n\n\u30ea\u30f3\u30af\uff08\u8a73\u7d30\u304c\u672c\u5bb6\u306e\u30ea\u30f3\u30af\u5148\u306b\u8a18\u8f09\u3057\u3066\u3042\u308a\u307e\u3059\uff09\n\nhttp://clusterlabs.org/doc/en-US/Pacemaker/1.1/html-single/Pacemaker_Remote/\n\n# pacemaker_remote\u3068\u306f\nPacemaker1.1\u7cfb\u3067\u76db\u308a\u8fbc\u307e\u308c\u3066\u3044\u308b\u6a5f\u80fd\u3067Pacemaker\u672c\u4f53\u3067\u3001\u4ed6\u30ce\u30fc\u30c9(\u5b9f\u30de\u30b7\u30f3\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\uff09\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5236\u5fa1\u3059\u308b\u6a5f\u80fd\u3067\u3059\u3002\n\u4ed6\u30ce\u30fc\u30c9\u5074\u306b\u306f\u3001Pacemaker\u672c\u4f53\u30d7\u30ed\u30bb\u30b9\u306f\u5fc5\u8981\u306a\u304f\u3001pacemaker_remote\u30d7\u30ed\u30bb\u30b9\u3068resource-agent\u306e\u307f\u304c(\u5f53\u7136\u3001\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u672c\u4f53\u306f\u5fc5\u8981:apache\u3084\u3001postgresSQL)\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u73fe\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u307e\u3060\u4e0d\u5b89\u5b9a\u306a\u90e8\u5206\u3082\u6709\u308a\u4e0d\u5177\u5408\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u8d77\u52d5\u30fb\u76e3\u8996\u30fb\u505c\u6b62\u306e\u4e00\u9023\u306e\u52d5\u4f5c\u306f\u5236\u9650\u4ed8\u304d\u3067\u3059\u304c\u3001\u53ef\u80fd\u3067\u3059\u3002\n(\u30ea\u30ea\u30fc\u30b9\u7248\u306f\u304b\u306a\u308a\u4e0d\u5b89\u5b9a\u3067\u3042\u308a\u3001\u554f\u984c\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u3042\u308b\u7a0b\u5ea6\u52d5\u4f5c\u53ef\u80fd\u306a\u306e\u306f\u3001Pacemaker\u306e\u958b\u767a\u4e2d\u306e\u30c8\u30c3\u30d7\u306e\u6700\u65b0\u7248\u3067\u3059)\n\n## \u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u306epacemaker_remote\u3067\u306e\u30af\u30e9\u30b9\u30bf\u69cb\u6210\n\u5b9f\u74b0\u5883\u5185\u3067\u8d77\u52d5\u3057\u305fpacemaker_remote\u3068\u901a\u4fe1\u3092\u884c\u3063\u3066\u3001Pacemaker\u3092\u8d77\u52d5\u3059\u308b\u30ce\u30fc\u30c9\u304b\u3089\u306e\u6307\u793a\u306b\u5f93\u3063\u3066\u5b9f\u74b0\u5883\u5185\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u8d77\u52d5\u3059\u308b\u69cb\u6210\u3067\u3059\u3002\n\u3053\u306e\u5834\u5408\u3082\u5148\u306b\u66f8\u3044\u305f\u901a\u308a\u3001\u5b9f\u74b0\u5883\u5185\u306b\u5fc5\u8981\u306a\u306e\u306f\u3001pacemaker_remote\u3068resource-agent(\u5f53\u7136\u3001\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u306e\u672c\u4f53\u306f\u5fc5\u8981:apache\u3084\u3001postgresSQL)\u3067\u3059\u3002\n\u672c\u6765\u306f\u3001\u30db\u30b9\u30c8\u8907\u6570\u53f0\u3067Pacemaker\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u6210\u3059\u308b\u4e8b\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\u307e\u305a\u306f\u3001pacemaker\u30db\u30b9\u30c8\uff11\u53f0(cent7-host)\u3068\u30d9\u30a2\u30e1\u30bf\u30eb\u30ce\u30fc\u30c9\uff12\u53f0(cent7-remote1,cent7-remote2)\u3092\u60f3\u5b9a\u3057\u3066\u3001\u4eee\u60f3\u30de\u30b7\u30f3\uff13\u53f0\u3067\u69cb\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\u30ea\u30bd\u30fc\u30b9\u306f\u7c21\u6613\u306bDummy\u306e\u307f\u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u306fstonith\u7121\u306e\u4f8b\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306fstonith\u69cb\u6210\u3092\u7d44\u3080\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001pacemaker\u30db\u30b9\u30c8\u3067\u306f\u3001\u30ea\u30bd\u30fc\u30b9\u3092\u8d77\u52d5\u3057\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u308b\u70ba\u3001\u4ee5\u4e0b\u3067\u8aac\u660e\u3057\u3066\u3044\u308bdiscovery\u8a2d\u5b9a\u3082\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n * http://qiita.com/HideoYamauchi/items/bf97069072a8ffcf807e\n\n```crm\nproperty no-quorum-policy=\"ignore\" \\\n  stonith-enabled=\"false\" \\\n  startup-fencing=\"false\"\n\nrsc_defaults resource-stickiness=\"INFINITY\" \\\n  migration-threshold=\"INFINITY\"\n\nprimitive remote1 ocf:pacemaker:remote \\\n  params \\\n        server=\"cent7-remote1\" \\\n  op monitor interval=3 timeout=15\n\nprimitive remote2 ocf:pacemaker:remote \\\n  params \\\n        server=\"cent7-remote2\" \\\n  op monitor interval=3 timeout=15\n\nprimitive dummy-remote Dummy \\\n  op start interval=0s timeout=60s \\\n  op monitor interval=30s timeout=60s \\\n  op stop interval=0s timeout=60s\n\nlocation loc1 dummy-remote \\\n rule 300: #uname eq remote1 \\\n rule 200: #uname eq remote2\n\nlocation loc2 dummy-remote resource-discovery=\"never\" \\\n rule -inf: #uname eq cent7-host\n                                                                          \n```\n\n### \u52d5\u4f5c\u306b\u3064\u3044\u3066\npacemaker_remote\u306f\u3001Pacemaker\u304b\u3089\u306e\u63a5\u7d9a\u30db\u30b9\u30c8\u306e\u5f62\u3067\u52d5\u4f5c\u3057\u3001Pacemaker\u304b\u3089\u63a5\u7d9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001pacemaker_remote\u81ea\u4f53\u306f\u3001Pacemaker\u672c\u4f53\u306elrmd\u30d7\u30ed\u30bb\u30b9\u306e\u62e1\u5f35\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u5358\u4f53\u3067\u52d5\u4f5c\u3059\u308blrmd\u30d7\u30ed\u30bb\u30b9\u3068\u3044\u3046\u8a8d\u8b58\u3067\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\npacemaker_remote\u306e\u52d5\u4f5c\u3059\u308b\u30ce\u30fc\u30c9\u5074(\u5b9f\u30de\u30b7\u30f3\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u3001\u30b3\u30f3\u30c6\u30ca\uff09\u3067\u3082\u3001crm_mon\u306a\u3069\u306e\u30b3\u30de\u30f3\u30c9\u306f\u5b9f\u884c\u53ef\u80fd\u3067\u3001\u3053\u308c\u306f\u3001Proxy\u6a5f\u80fd\u3092\u7d4c\u7531\u3057\u3066\u3001Pacemaker\u30ce\u30fc\u30c9\u306b\u8981\u6c42\u304c\u9001\u3089\u308c\u3066\u51e6\u7406\u3055\u308c\u308b\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n![remote\u69cb\u6210.png](https://qiita-image-store.s3.amazonaws.com/0/80018/01a1e91e-5b46-8935-5eee-54b00c7874fd.png)\n\n\n1) Paemaker/corosync\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\n - \u672c\u6765remote\u3067\u63a5\u7d9a\u3059\u308b\u30ce\u30fc\u30c9\u306b\u306fcrosoync\u306a\u3069\u306f\u4e0d\u8981\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u7dba\u9e97\u306b\u3044\u308c\u3066\u3042\u308a\u307e\u3059\u3002\n - \u307e\u305f\u3001\u73fe\u6642\u70b9\u306e\u6700\u65b0\u7248Pacemake:pacemaker-4e6f6d6e62d9418ce590a6f7471e96479cb0fdc8\u3092\u5165\u308c\u3066\u3044\u307e\u3059\u3002\n - \u4eca\u56de\u3082\u7c21\u6613\u306a\u69cb\u6210\u306e\u70ba\u3001firewalld\u306f\u505c\u6b62\u3057\u3066\u3042\u308a\u307e\u3059\u3002\n\n2) \u30db\u30b9\u30c8\u5074\u3067\u30ad\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002(/etc/pacemaker\u304c\u7121\u3044\u5834\u5408\u306fmkdir\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n\ndd if=/dev/urandom of=/etc/pacemaker/authkey bs=4096 count=1\n\n3) \u4f5c\u6210\u3057\u305f\u30ad\u30fc\u3092\u30ea\u30e2\u30fc\u30c8\u3078\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002(/etc/pacemaker\u304c\u7121\u3044\u5834\u5408\u306fmkdir\u3057\u3066\u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n\n4) remote\u30ce\u30fc\u30c9\u3067\u5148\u306bpacemaker_remote\u3092\u8d77\u52d5\u3057\u3066\u3001host\u30ce\u30fc\u30c9\u3067pacemaker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n[root@cent7-remote1 ~]# systemctl start pacemaker_remote\n\n[root@cent7-remote2 ~]# systemctl start pacemaker_remote\n\n[root@cent7-host ~]# systemctl start pacemaker\n\n```\n\n5) CLI\u30d5\u30a1\u30a4\u30eb\u3092\u6295\u5165\u3057\u307e\u3059\n\n```\n[root@cent7-host ~]# crm configure load update bare.crm \nWARNING: loc1: referenced node remote1 does not exist\nWARNING: loc1: referenced node remote2 does not exist\nWARNING: remote1: default timeout 20s for start is smaller than the advised 60\nWARNING: remote1: default timeout 20s for stop is smaller than the advised 60\nWARNING: remote1: specified timeout 15 for monitor is smaller than the advised 30\nWARNING: remote2: default timeout 20s for start is smaller than the advised 60\nWARNING: remote2: default timeout 20s for stop is smaller than the advised 60\nWARNING: remote2: specified timeout 15 for monitor is smaller than the advised 30\n\n\n```\n\n6) crm_mon\u3067remote\u3067\u30ea\u30bd\u30fc\u30b9\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n```\n[root@cent7-host ~]# crm_mon -1 -Af\n..\nStack: corosync\nCurrent DC: cent7-host (version 1.1.13-4e6f6d6) - partition WITHOUT quorum\n3 nodes and 3 resources configured\n\nOnline: [ cent7-host ]\nRemoteOnline: [ remote1 remote2 ]\n\n dummy-remote   (ocf::heartbeat:Dummy): Started remote1\n remote1        (ocf::pacemaker:remote):        Started cent7-host\n remote2        (ocf::pacemaker:remote):        Started cent7-host\n\nNode Attributes:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\nMigration Summary:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n```\n\n7)\u5ff5\u306e\u70ba\u3001\u5404\u30ce\u30fc\u30c9\u3067\u30d7\u30ed\u30bb\u30b9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u306f\u3001pacemaker_remoted\u306e\u307f\u304c\u52d5\u3044\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\n[root@cent7-host ~]# ps -ef |grep pace\nroot     15839     1  0 20:46 ?        00:00:00 /usr/sbin/pacemakerd -f\nhaclust+ 15840 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/cib\nroot     15841 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/stonithd\nroot     15842 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/lrmd\nhaclust+ 15843 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/attrd\nhaclust+ 15844 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/pengine\nhaclust+ 15845 15839  0 20:46 ?        00:00:00 /usr/libexec/pacemaker/crmd\nroot     15907 12074  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-host ~]# ps -ef |grep coro\nroot     14494     1  1 20:09 ?        00:00:24 corosync\nroot     15909 12074  0 20:48 pts/0    00:00:00 grep --color=auto coro\n\n[root@cent7-remote1 ~]# ps -ef |grep pace\nroot      2248     1  0 20:46 ?        00:00:00 /usr/sbin/pacemaker_remoted\nroot      2304  2190  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-remote1 ~]# ps -ef |grep coro\nroot      2306  2190  0 20:48 pts/0    00:00:00 grep --color=auto coro\n[root@cent7-remote2 ~]# ps -ef |grep pace\nroot      7037     1  0 20:46 ?        00:00:00 /usr/sbin/pacemaker_remoted\nroot      7063  1088  0 20:48 pts/0    00:00:00 grep --color=auto pace\n[root@cent7-remote2 ~]# ps -ef |grep coro\nroot      7065  1088  0 20:48 pts/0    00:00:00 grep --color=auto coro\n```\n\n8)\u30ea\u30e2\u30fc\u30c8\u30ce\u30fc\u30c9\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u79fb\u52d5\u3055\u305b\u3066\u307f\u307e\u3059\n\n```\n[root@cent7-host ~]# crm_resource -M -r  dummy-remote -N remote2 -f\nWARNING: Creating rsc_location constraint 'cli-ban-dummy-remote-on-remote1' with a score of -INFINITY for resource dummy-remote on remote1.\n        This will prevent dummy-remote from running on remote1 until the constraint is removed using the 'crm_resource --clear' command or manually with cibadmin\n        This will be the case even if remote1 is the last node in the cluster\n        This message can be disabled with --quiet\n\n[root@cent7-host ~]# crm_mon -1 -Af\n....\nStack: corosync\nCurrent DC: cent7-host (version 1.1.13-4e6f6d6) - partition WITHOUT quorum\n3 nodes and 3 resources configured\n\nOnline: [ cent7-host ]\nRemoteOnline: [ remote1 remote2 ]\n\n dummy-remote   (ocf::heartbeat:Dummy): Started remote2\n remote1        (ocf::pacemaker:remote):        Started cent7-host\n remote2        (ocf::pacemaker:remote):        Started cent7-host\n\nNode Attributes:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\nMigration Summary:\n* Node cent7-host:\n* Node remote1:\n* Node remote2:\n\n```\n\n### \u6ce8\u610f\u70b9\npacemaker_remote\u3068Pacemaker\u672c\u4f53\u306e\u540c\u5c45\u306f\u51fa\u6765\u304d\u307e\u305b\u3093\u3002\n * pacemakre_remote\u3092\u8d77\u52d5\u3057\u3066\u3001Pacemaker\u672c\u4f53\u306e\u8d77\u52d5\u306f\u51fa\u6765\u306a\u3044\u3068\u3044\u3046\u610f\u5473\u3002\n\n### \u30ea\u30f3\u30af\uff08\u8a73\u7d30\u304c\u672c\u5bb6\u306e\u30ea\u30f3\u30af\u5148\u306b\u8a18\u8f09\u3057\u3066\u3042\u308a\u307e\u3059\uff09\n * http://clusterlabs.org/doc/en-US/Pacemaker/1.1/html-single/Pacemaker_Remote/\n\n\n\n", "tags": ["pacemaker"]}