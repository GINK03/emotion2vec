{"context": "[\u8ffd\u8a18 5/24]\n\u4f4d\u7f6e\u60c5\u5831\u4ee5\u5916\u3092\u9001\u308b\u3068\u8fd1\u8fba\u4ee5\u5916\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u304c10\u4ef6\u3067\u305f\u3089\u3081\u306b\u8fd4\u3063\u3066\u304d\u305f\u306e\u3067\u3001\u30e6\u30fc\u30b6\u304c\u9001\u4fe1\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\u304c\u4f4d\u7f6e\u60c5\u5831\u4ee5\u5916\u306e\u5834\u5408\u306f\u4f7f\u3044\u65b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n[\u8ffd\u8a18 5/25]\n\u30fb\u691c\u7d22\u7d50\u679c\u306b\u3001\u300cPowered by \u3050\u308b\u306a\u3073\u300d\u306e\u30c6\u30ad\u30b9\u30c8\u8868\u793a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\u3050\u308b\u306a\u3073API - \u30af\u30ec\u30b8\u30c3\u30c8\u8868\u793a\u306b\u3064\u3044\u3066\n\u30fbBOT\u8ffd\u52a0\u6642\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u304c\u3001\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002\u672c\u5f53\u306b\u6700\u521d\u306e1\u56de\u306e\u307f\u3057\u304bopType\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\u306e\u3060\u308d\u3046\u304b\uff1f\u305f\u3060\u3044\u307e\u3001\u8abf\u67fb\u4e2d\u3067\u3059\u3002\n\u30fb\u4e00\u90e8\u91cd\u8907\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3092\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3057\u305f\u3002\n\u30fbQiita\u306e\u30bf\u30a4\u30c8\u30eb\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n(\u4fee\u6b63\u524d)\nLINE BOT API\u3092\u5229\u7528\u3057\u3066XSERVER + PHP + \u3050\u308b\u306a\u3073API\u3067\u30e9\u30fc\u30e1\u30f3\u5c4bBOT\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\n(\u4fee\u6b63\u5f8c)\n\u3010LINE BOT API\u3011\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3068\u8fd1\u304f\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3092\u6559\u3048\u3066\u304f\u308c\u308bBOT\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\n\n\u6982\u8981\n\u9154\u3063\u6255\u3063\u305f\u5f8c\u3001\u7121\u6027\u306b\u30e9\u30fc\u30e1\u30f3\u304c\u98df\u3079\u305f\u304f\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u305d\u3093\u306a\u6642\u306f\u30b9\u30de\u30db\u3092\u4f7f\u3063\u3066\u624b\u5165\u529b\u306b\u3088\u308b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306e\u691c\u7d22\u304c\u5371\u3046\u3044\u7a0b\u9154\u3063\u6255\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3059(\u7b11)\n\u30e9\u30fc\u30e1\u30f3\u5c4bBOT\u306f\u3001\u305d\u3093\u306a\u9154\u3063\u6255\u3044\u306b\u512a\u3057\u3044BOT\u3067\u3057\u3066\u3001LINE\u3067\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3068\u8fd1\u8fba\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u304c\u6700\u592710\u4ef6\u30ea\u30b9\u30c8\u306b\u306a\u3063\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u305f\u3060\u3057\u3001\u3050\u308b\u306a\u3073API\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3050\u308b\u306a\u3073\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306f\u8fd4\u3063\u3066\u304d\u307e\u305b\u3093(\u7b11)\n\u5f53\u521d\u306f\u98df\u3079\u30ed\u30b0API\u3092\u4f7f\u3063\u3066\u30e9\u30f3\u30ad\u30f3\u30b0\u9806\u306b\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u3068\u98df\u3079\u30ed\u30b0API\u306f\u30b5\u30fc\u30d3\u30b9\u7d42\u4e86\uff01\uff01\nRetty\u306eAPI\u304c\u516c\u958b\u3055\u308c\u306a\u3044\u304b\u306a\u3042\uff08\u7b11)\n\n\u74b0\u5883\u3068\u4f7f\u3063\u305f\u6280\u8853\u306a\u3069\nXSERVER\nPHP5.6.18\nSSL\u306fXSERVER\u306e\u5171\u6709SSL\u3092\u5229\u7528\n\u3050\u308b\u306a\u3073API\n\n\u306f\u307e\u3063\u305f\u70b9\n\u79c1\u304c\u5229\u7528\u3057\u3066\u3044\u308bXSERVER\u306ePHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30015.3.3\u3060\u3063\u305f\u305f\u3081\u4ed6\u306e\u65b9\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u914d\u5217\u306e\u521d\u671f\u5316array = []\u304c\u4f7f\u3048\u306a\u304f\u30a8\u30e9\u30fc\u3068\u306a\u3063\u3066\u3044\u305f\u304c\u898b\u3064\u3051\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002(\u79c1\u306e\u77e5\u8b58\u4e0d\u8db3)\nPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001XSERVER\u306e\u30b5\u30fc\u30d0\u30fc\u30d1\u30cd\u30eb\u304b\u3089PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048\u30675.6.18\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u52d5\u304d\u307e\u3057\u305f\u3002\n\u6700\u521dLine\u306bcallback\u3067\u6307\u5b9a\u3057\u305furl\u304c\u307e\u3060\u53cd\u6620\u3055\u308c\u308b\u306e\u306f\u6642\u9593\u304c\u304b\u304b\u308b\u3068\u3044\u3046\u3053\u3068\u304c\u66f8\u3044\u3066\u3042\u308b\u8a18\u4e8b\u304c\u8907\u6570\u3042\u3063\u305f\u305f\u3081\u3001\u305d\u308c\u304c\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u3068\u52d8\u9055\u3044\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u6570\u65e5\u5f85\u3063\u3066\u3082\u30a8\u30e9\u30fc\u304c\u89e3\u6d88\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u554f\u984c\u306f\u30b3\u30fc\u30c9\u306e\u3069\u3053\u304b\u306b\u539f\u56e0\u304c\u3042\u308b\u306e\u3067\u306f\u3068\u601d\u3044\u539f\u56e0\u8abf\u67fb\u3002\nPHP\u306e\u77e5\u8b58\u3082\u3042\u307e\u308a\u7121\u304f\u3001\u539f\u56e0\u304c\u5224\u660e\u3059\u308b\u306e\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n\u4f7f\u3044\u65b9\n\u305f\u3060\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3060\u3051\u3067\u3059\u3002\nLINE\u304b\u3089\u9001\u3063\u305f\u4f4d\u7f6e\u60c5\u5831\u304b\u3089\u73fe\u5728\u5730\u306e\u7def\u5ea6\u3068\u7d4c\u5ea6\u53d6\u5f97\u3057\u3001\u7def\u5ea6\u3068\u7d4c\u5ea6\u3092\u3050\u308b\u306a\u3073API\u306b\u9001\u308a\u3001API\u3088\u308a\u8fd1\u304f\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3092\u6700\u592710\u4ef6\u8fd4\u3057\u3066\u3082\u3089\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\u5b9f\u88c5\n\u5b9f\u88c5\u306b\u5f53\u305f\u3063\u3066\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u5927\u5909\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f(^_^)\nLine bot trial \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u3054\u53c2\u8003\u306b\u3002\nLINE BOT API Trial\u3067\u3067\u304d\u308b\u5168\u3066\u306e\u4e8b\u3092\u8a66\u3057\u3066\u307f\u305f\nLINE BOT API\u3092\u5229\u7528\u3057\u305f\u5730\u7344\u306e\u30df\u30b5\u30efBOT\u306e\u4f5c\u308a\u65b9\n\u3010LINE Bot\u3011Heroku+PHP+\u3050\u308b\u306a\u3073API\u3067\u854e\u9ea6\u63a2\u3057Bot\u4f5c\u3063\u3066\u307f\u305f\n\u30a8\u30c3\u30af\u30b9\u30b5\u30fc\u30d0\u30fc\u3068PHP\u3092\u4f7f\u3063\u3066LINE BOT\u3092\u4f5c\u308b\u65b9\u6cd5\u3002\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7df4\u7fd2\u306b\u6700\u9069\u3060\u305e\uff01\n\nline_callback.php\n<?php\n// \u3050\u308b\u306a\u3073\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\nconst GNAVI_ACCESS_KEY = \"input your gnavi access key\";\nconst LINE_CHANNEL_ID = \"input your channel id\";\nconst LINE_CHANNEL_SECRET = \"input your channel secret\";\nconst LINE_MID = \"input your mid\";\n\n$request = file_get_contents('php://input');\n$jsonObj = json_decode($request);\n$to = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"from\"};\n$contentType = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"contentType\"};\n$opType = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"opType\"};\n\n// \u53cb\u9054\u8ffd\u52a0\u6642\u306b\u9001\u4fe1\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\nif ($opType !== null && $opType === 4) {\n    $response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u3054\u767b\u9332\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\"];\n    send_message_to_user($to,$response_format_text);\n    return;\n}\n\nif ($contentType !== 7) {\n    $response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u3063\u3066\u4e0b\u3055\u3044\u306d\u301c\"];\n    send_message_to_user($to,$response_format_text);\n} else {\n    $ramen_info = get_ramen_info($jsonObj);\n    $response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>$ramen_info];\n    send_message_to_user($to,$response_format_text);    \n}\n\nfunction send_message_to_user($to,$response_format_text){\n    $post_data = [\"to\"=>[$to],\"toChannel\"=>\"1383378250\",\"eventType\"=>\"138311608800106203\",\"content\"=>$response_format_text];\n    $ch = curl_init(\"https://trialbot-api.line.me/v1/events\");\n    curl_setopt($ch, CURLOPT_POST,true);\n    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($post_data));\n    curl_setopt($ch, CURLOPT_HTTPHEADER, create_http_header());\n    $result = curl_exec($ch);\n    curl_close($ch);\n}\n\nfunction create_http_header(){\n    $content_type = 'Content-Type: application/json; charser=UTF-8';\n    $channel_id = 'X-Line-ChannelID: '.LINE_CHANNEL_ID;\n    $channel_secret = 'X-Line-ChannelSecret: '.LINE_CHANNEL_SECRET;\n    $mid = 'X-Line-Trusted-User-With-ACL: '.LINE_MID;\n    return array($content_type,$channel_id,$channel_secret,$mid);\n}\n\n// \u3050\u308b\u306a\u3073Web\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u305f\u691c\u7d22\nfunction get_ramen_info($jsonObj){\n    // \u3050\u308b\u306a\u3073Web\u30b5\u30fc\u30d3\u30b9\u5229\u7528\u3059\u308b\u305f\u3081\u306eURL\u306e\u7d44\u307f\u7acb\u3066\n    $url = build_url($jsonObj);\n    // API\u5b9f\u884c\n    $json = file_get_contents($url);\n    return parse($json);\n}\n\n\nfunction build_url($jsonObj){\n\n    //\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n    $uri = \"http://api.gnavi.co.jp/RestSearchAPI/20150630/\";\n\n    //API\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306f\u3001\u3050\u308b\u306a\u3073\u3067\u53d6\u5f97\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n    $acckey = GNAVI_ACCESS_KEY;\n\n    //\u8fd4\u5374\u5024\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u6570\u306b\u5165\u308c\u308b\n    $format= \"json\";\n\n    //\u7def\u5ea6\u30fb\u7d4c\u5ea6\u3001\u7bc4\u56f2\u3001\u53ca\u3073\u30ab\u30c6\u30b4\u30ea\u30fc\u306b\u30e9\u30fc\u30e1\u30f3\u3092\u8a2d\u5b9a\n    $location = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"location\"};\n    $lat   = $location->latitude;\n    $lon   = $location->longitude;\n    $range = 3;\n    // \u696d\u614b\u304c\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3092\u610f\u5473\u3059\u308b\u3050\u308b\u306a\u3073\u306e\u30b3\u30fc\u30c9(\u5927\u696d\u614b\u30de\u30b9\u30bf\u53d6\u5f97API\u3092\u30b3\u30fc\u30eb\u3057\u3066\u8abf\u67fb)\n    $category_s = \"RSFST08008\";\n\n    //URL\u7d44\u307f\u7acb\u3066\n    $url  = sprintf(\"%s%s%s%s%s%s%s%s%s%s%s%s%s\", $uri, \"?format=\", $format, \"&keyid=\", $acckey, \"&latitude=\", $lat,\"&longitude=\",$lon,\"&range=\",$range,\"&category_s=\",$category_s);\n\n    return $url;\n}\n\nfunction parse($json){\n\n    $obj  = json_decode($json);\n\n    $result = \"\";\n\n    $total_hit_count = $obj->{'total_hit_count'};\n\n    if ($total_hit_count === null) {\n        $result .= \"\u8fd1\u304f\u306b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306f\u3042\u308a\u307e\u305b\u3093\u3002\";\n    }else{\n        $result .= \"\u8fd1\u304f\u306b\u3042\u308b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3067\u3059\u3002\\n\\n\";\n        foreach($obj->{'rest'} as $val){\n\n            if (checkString($val->{'name'})) {\n                $result .= $val->{'name'}.\"\\n\";\n            }\n\n            if (checkString($val->{'address'})) {\n                $address = get_address_without_postal_code($val->{'address'});\n                $result .= $address.\"\\n\";\n            }\n\n            if (checkString($val->{'url'})) {\n                $result .= $val->{'url'}.\"\\n\";\n            }\n\n            $result.=\"\\n\".\"\\n\";\n        }\n        $result.=\"Powered by \u3050\u308b\u306a\u3073\";\n    }\n    return $result;\n}\n\nfunction get_address_without_postal_code($address){\n    return mb_substr($address,11);\n}\n\n//\u6587\u5b57\u5217\u3067\u3042\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\nfunction checkString($input)\n{\n    if(isset($input) && is_string($input)) {\n        return true;\n    }else{\n        return false;\n    }\n}\n\n\n\n\u4eca\u5f8c\u8ffd\u52a0\u3057\u305f\u3044\u6a5f\u80fd\n1.\u73fe\u6642\u70b9\u3067\u3050\u308b\u306a\u3073\u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u30e9\u30fc\u30e1\u30f3\u5c4b\u30ea\u30b9\u30c8\u3092\u305d\u306e\u307e\u307e\u8868\u793a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f4d\u7f6e\u60c5\u5831\u304b\u3089\u4e00\u756a\u8fd1\u3044\u9806\u306b\u4e26\u3073\u66ff\u3048\u3066\u8868\u793a\u3068\u304b\u3055\u305b\u305f\u3044\u3067\u3059\u3002\n2.\u304a\u5e97\u306eURL\u304c\u9577\u3044\u306e\u3067\u30b7\u30e7\u30fc\u30c8URL\u306b\u3057\u3088\u3046\u304b\u306a\u3068\u3002\n\n\u611f\u60f3\n\u4f5c\u3063\u3066\u3044\u308b\u3046\u3061\u306b\u4ed6\u306b\u3082\u8272\u3005\u30a2\u30a4\u30c7\u30a2\u304c\u6d6e\u304b\u3093\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u73fe\u6642\u70b9\u3067\uff11\u30a2\u30ab\u30a6\u30f3\u30c81\u30dc\u30c3\u30c8\u306a\u306e\u304c\u60b2\u3057\u3044\uff01\n\u65e9\u304f\u8907\u6570\u30dc\u30c3\u30c8\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u305f\u3044\u3067\u3059\u3002\n\u305d\u3057\u3066\u3001\u5358\u7d14\u306b\u4f5c\u3063\u3066\u3044\u3066\u697d\u3057\u304b\u3063\u305f\u3067\u3059\uff01\uff01\n\n\u6700\u5f8c\u306b\n\u5b9c\u3057\u3051\u308c\u3070\u304a\u4f7f\u3044\u4e0b\u3055\u3044\u3002\n\u305f\u3060\u3057\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u306a\u306e\u306750\u4eba\u307e\u3067\u3057\u304b\u4f7f\u3048\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n\u307e\u305f\u88cf\u3067\u8272\u3005\u3068\u30bd\u30fc\u30b9\u3092\u3044\u3058\u3063\u3066\u3044\u308b\u306e\u3067\u4f7f\u3048\u306a\u3044\u6642\u304c\u3042\u308b\u304b\u3082\u3067\u3059(\u7b11)\n\n[\u8ffd\u8a18 5/24]\n\u4f4d\u7f6e\u60c5\u5831\u4ee5\u5916\u3092\u9001\u308b\u3068\u8fd1\u8fba\u4ee5\u5916\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u304c10\u4ef6\u3067\u305f\u3089\u3081\u306b\u8fd4\u3063\u3066\u304d\u305f\u306e\u3067\u3001\u30e6\u30fc\u30b6\u304c\u9001\u4fe1\u3057\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\u3092\u53d6\u5f97\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u30bf\u30a4\u30d7\u304c\u4f4d\u7f6e\u60c5\u5831\u4ee5\u5916\u306e\u5834\u5408\u306f\u4f7f\u3044\u65b9\u3092\u8fd4\u3059\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\n[\u8ffd\u8a18 5/25]\n\u30fb\u691c\u7d22\u7d50\u679c\u306b\u3001\u300cPowered by \u3050\u308b\u306a\u3073\u300d\u306e\u30c6\u30ad\u30b9\u30c8\u8868\u793a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n  [\u3050\u308b\u306a\u3073API - \u30af\u30ec\u30b8\u30c3\u30c8\u8868\u793a\u306b\u3064\u3044\u3066](http://api.gnavi.co.jp/api/guide/)\n\u30fbBOT\u8ffd\u52a0\u6642\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u307e\u3057\u305f\u304c\u3001\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u3002\u672c\u5f53\u306b\u6700\u521d\u306e1\u56de\u306e\u307f\u3057\u304bopType\u306f\u53d6\u5f97\u3067\u304d\u306a\u3044\u306e\u3060\u308d\u3046\u304b\uff1f\u305f\u3060\u3044\u307e\u3001\u8abf\u67fb\u4e2d\u3067\u3059\u3002\n\u30fb\u4e00\u90e8\u91cd\u8907\u3057\u3066\u3044\u308b\u30b3\u30fc\u30c9\u3092\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3057\u305f\u3002\n\u30fbQiita\u306e\u30bf\u30a4\u30c8\u30eb\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\n(\u4fee\u6b63\u524d)\nLINE BOT API\u3092\u5229\u7528\u3057\u3066XSERVER + PHP + \u3050\u308b\u306a\u3073API\u3067\u30e9\u30fc\u30e1\u30f3\u5c4bBOT\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\n(\u4fee\u6b63\u5f8c)\n\u3010LINE BOT API\u3011\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3068\u8fd1\u304f\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3092\u6559\u3048\u3066\u304f\u308c\u308bBOT\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\n\n# \u6982\u8981\n\u9154\u3063\u6255\u3063\u305f\u5f8c\u3001\u7121\u6027\u306b\u30e9\u30fc\u30e1\u30f3\u304c\u98df\u3079\u305f\u304f\u306a\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u305d\u3093\u306a\u6642\u306f\u30b9\u30de\u30db\u3092\u4f7f\u3063\u3066\u624b\u5165\u529b\u306b\u3088\u308b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306e\u691c\u7d22\u304c\u5371\u3046\u3044\u7a0b\u9154\u3063\u6255\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3059(\u7b11)\n\n\u30e9\u30fc\u30e1\u30f3\u5c4bBOT\u306f\u3001\u305d\u3093\u306a\u9154\u3063\u6255\u3044\u306b\u512a\u3057\u3044BOT\u3067\u3057\u3066\u3001LINE\u3067\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3068\u8fd1\u8fba\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u304c\u6700\u592710\u4ef6\u30ea\u30b9\u30c8\u306b\u306a\u3063\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n\u305f\u3060\u3057\u3001\u3050\u308b\u306a\u3073API\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3050\u308b\u306a\u3073\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u306a\u3044\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306f\u8fd4\u3063\u3066\u304d\u307e\u305b\u3093(\u7b11)\n\n\u5f53\u521d\u306f\u98df\u3079\u30ed\u30b0API\u3092\u4f7f\u3063\u3066\u30e9\u30f3\u30ad\u30f3\u30b0\u9806\u306b\u8868\u793a\u3057\u305f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u306a\u3093\u3068\u98df\u3079\u30ed\u30b0API\u306f\u30b5\u30fc\u30d3\u30b9\u7d42\u4e86\uff01\uff01\n\nRetty\u306eAPI\u304c\u516c\u958b\u3055\u308c\u306a\u3044\u304b\u306a\u3042\uff08\u7b11)\n\n# \u74b0\u5883\u3068\u4f7f\u3063\u305f\u6280\u8853\u306a\u3069\nXSERVER\nPHP5.6.18\nSSL\u306fXSERVER\u306e[\u5171\u6709SSL](https://www.xserver.ne.jp/manual/man_server_ssl.php)\u3092\u5229\u7528\n[\u3050\u308b\u306a\u3073API](http://api.gnavi.co.jp/api/)\n\n# \u306f\u307e\u3063\u305f\u70b9\n\u79c1\u304c\u5229\u7528\u3057\u3066\u3044\u308bXSERVER\u306ePHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u30015.3.3\u3060\u3063\u305f\u305f\u3081\u4ed6\u306e\u65b9\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u66f8\u3044\u3066\u3042\u3063\u305f\u914d\u5217\u306e\u521d\u671f\u5316array = []\u304c\u4f7f\u3048\u306a\u304f\u30a8\u30e9\u30fc\u3068\u306a\u3063\u3066\u3044\u305f\u304c\u898b\u3064\u3051\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3057\u305f\u3002(\u79c1\u306e\u77e5\u8b58\u4e0d\u8db3)\n\nPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001XSERVER\u306e\u30b5\u30fc\u30d0\u30fc\u30d1\u30cd\u30eb\u304b\u3089[PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048](https://www.xserver.ne.jp/manual/man_program_php_ver.php)\u30675.6.18\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u52d5\u304d\u307e\u3057\u305f\u3002\n\n\u6700\u521dLine\u306bcallback\u3067\u6307\u5b9a\u3057\u305furl\u304c\u307e\u3060\u53cd\u6620\u3055\u308c\u308b\u306e\u306f\u6642\u9593\u304c\u304b\u304b\u308b\u3068\u3044\u3046\u3053\u3068\u304c\u66f8\u3044\u3066\u3042\u308b\u8a18\u4e8b\u304c\u8907\u6570\u3042\u3063\u305f\u305f\u3081\u3001\u305d\u308c\u304c\u30a8\u30e9\u30fc\u306e\u539f\u56e0\u3068\u52d8\u9055\u3044\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u6570\u65e5\u5f85\u3063\u3066\u3082\u30a8\u30e9\u30fc\u304c\u89e3\u6d88\u3055\u308c\u306a\u3044\u306e\u3067\u3001\u554f\u984c\u306f\u30b3\u30fc\u30c9\u306e\u3069\u3053\u304b\u306b\u539f\u56e0\u304c\u3042\u308b\u306e\u3067\u306f\u3068\u601d\u3044\u539f\u56e0\u8abf\u67fb\u3002\n\nPHP\u306e\u77e5\u8b58\u3082\u3042\u307e\u308a\u7121\u304f\u3001\u539f\u56e0\u304c\u5224\u660e\u3059\u308b\u306e\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n# \u4f7f\u3044\u65b9\n\u305f\u3060\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u308b\u3060\u3051\u3067\u3059\u3002\nLINE\u304b\u3089\u9001\u3063\u305f\u4f4d\u7f6e\u60c5\u5831\u304b\u3089\u73fe\u5728\u5730\u306e\u7def\u5ea6\u3068\u7d4c\u5ea6\u53d6\u5f97\u3057\u3001\u7def\u5ea6\u3068\u7d4c\u5ea6\u3092\u3050\u308b\u306a\u3073API\u306b\u9001\u308a\u3001API\u3088\u308a\u8fd1\u304f\u306e\u30e9\u30fc\u30e1\u30f3\u5c4b\u3092\u6700\u592710\u4ef6\u8fd4\u3057\u3066\u3082\u3089\u3063\u3066\u3044\u307e\u3059\u3002\n\n![Screenshot_2016-05-21-21-08-22.jpg](https://qiita-image-store.s3.amazonaws.com/0/44053/08047da0-837c-91a8-0fb9-addd7ff646d4.jpeg \"Screenshot_2016-05-21-21-08-22.jpg\")\n\n\n# \u5b9f\u88c5\n\u5b9f\u88c5\u306b\u5f53\u305f\u3063\u3066\u4ee5\u4e0b\u306e\u8a18\u4e8b\u304c\u5927\u5909\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f(^_^)\n\nLine bot trial \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u53d6\u5f97\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3092\u3054\u53c2\u8003\u306b\u3002\n\n\n[LINE BOT API Trial\u3067\u3067\u304d\u308b\u5168\u3066\u306e\u4e8b\u3092\u8a66\u3057\u3066\u307f\u305f](http://qiita.com/betchi/items/8e5417dbf20a62f2239d)\n[LINE BOT API\u3092\u5229\u7528\u3057\u305f\u5730\u7344\u306e\u30df\u30b5\u30efBOT\u306e\u4f5c\u308a\u65b9](http://qiita.com/srea/items/58ba0f7d870a6ee3da2a)\n[\u3010LINE Bot\u3011Heroku+PHP+\u3050\u308b\u306a\u3073API\u3067\u854e\u9ea6\u63a2\u3057Bot\u4f5c\u3063\u3066\u307f\u305f](http://qiita.com/shanonim/items/50ce041df01565262ba0)\n[\u30a8\u30c3\u30af\u30b9\u30b5\u30fc\u30d0\u30fc\u3068PHP\u3092\u4f7f\u3063\u3066LINE BOT\u3092\u4f5c\u308b\u65b9\u6cd5\u3002\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7df4\u7fd2\u306b\u6700\u9069\u3060\u305e\uff01](http://hawk-a.com/line-bot-xserver-php-2/)\n\n\n```line_callback.php\n<?php\n// \u3050\u308b\u306a\u3073\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\nconst GNAVI_ACCESS_KEY = \"input your gnavi access key\";\nconst LINE_CHANNEL_ID = \"input your channel id\";\nconst LINE_CHANNEL_SECRET = \"input your channel secret\";\nconst LINE_MID = \"input your mid\";\n\n$request = file_get_contents('php://input');\n$jsonObj = json_decode($request);\n$to = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"from\"};\n$contentType = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"contentType\"};\n$opType = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"opType\"};\n\n// \u53cb\u9054\u8ffd\u52a0\u6642\u306b\u9001\u4fe1\u3059\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\nif ($opType !== null && $opType === 4) {\n\t$response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u3054\u767b\u9332\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\"];\n\tsend_message_to_user($to,$response_format_text);\n\treturn;\n}\n\nif ($contentType !== 7) {\n\t$response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u3063\u3066\u4e0b\u3055\u3044\u306d\u301c\"];\n\tsend_message_to_user($to,$response_format_text);\n} else {\n\t$ramen_info = get_ramen_info($jsonObj);\n\t$response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>$ramen_info];\n\tsend_message_to_user($to,$response_format_text);\t\n}\n\nfunction send_message_to_user($to,$response_format_text){\n\t$post_data = [\"to\"=>[$to],\"toChannel\"=>\"1383378250\",\"eventType\"=>\"138311608800106203\",\"content\"=>$response_format_text];\n\t$ch = curl_init(\"https://trialbot-api.line.me/v1/events\");\n\tcurl_setopt($ch, CURLOPT_POST,true);\n\tcurl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'POST');\n\tcurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n\tcurl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($post_data));\n\tcurl_setopt($ch, CURLOPT_HTTPHEADER, create_http_header());\n\t$result = curl_exec($ch);\n\tcurl_close($ch);\n}\n\nfunction create_http_header(){\n\t$content_type = 'Content-Type: application/json; charser=UTF-8';\n\t$channel_id = 'X-Line-ChannelID: '.LINE_CHANNEL_ID;\n\t$channel_secret = 'X-Line-ChannelSecret: '.LINE_CHANNEL_SECRET;\n\t$mid = 'X-Line-Trusted-User-With-ACL: '.LINE_MID;\n\treturn array($content_type,$channel_id,$channel_secret,$mid);\n}\n\n// \u3050\u308b\u306a\u3073Web\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u305f\u691c\u7d22\nfunction get_ramen_info($jsonObj){\n\t// \u3050\u308b\u306a\u3073Web\u30b5\u30fc\u30d3\u30b9\u5229\u7528\u3059\u308b\u305f\u3081\u306eURL\u306e\u7d44\u307f\u7acb\u3066\n\t$url = build_url($jsonObj);\n\t// API\u5b9f\u884c\n\t$json = file_get_contents($url);\n\treturn parse($json);\n}\n\n\nfunction build_url($jsonObj){\n\t\n\t//\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n\t$uri = \"http://api.gnavi.co.jp/RestSearchAPI/20150630/\";\n\t\n\t//API\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306f\u3001\u3050\u308b\u306a\u3073\u3067\u53d6\u5f97\u3057\u3066\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\t$acckey = GNAVI_ACCESS_KEY;\n\t\n\t//\u8fd4\u5374\u5024\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u6570\u306b\u5165\u308c\u308b\n\t$format= \"json\";\n\t\n\t//\u7def\u5ea6\u30fb\u7d4c\u5ea6\u3001\u7bc4\u56f2\u3001\u53ca\u3073\u30ab\u30c6\u30b4\u30ea\u30fc\u306b\u30e9\u30fc\u30e1\u30f3\u3092\u8a2d\u5b9a\n\t$location = $jsonObj->{\"result\"}[0]->{\"content\"}->{\"location\"};\n\t$lat   = $location->latitude;\n\t$lon   = $location->longitude;\n\t$range = 3;\n\t// \u696d\u614b\u304c\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3092\u610f\u5473\u3059\u308b\u3050\u308b\u306a\u3073\u306e\u30b3\u30fc\u30c9(\u5927\u696d\u614b\u30de\u30b9\u30bf\u53d6\u5f97API\u3092\u30b3\u30fc\u30eb\u3057\u3066\u8abf\u67fb)\n\t$category_s = \"RSFST08008\";\n\t\t\n\t//URL\u7d44\u307f\u7acb\u3066\n\t$url  = sprintf(\"%s%s%s%s%s%s%s%s%s%s%s%s%s\", $uri, \"?format=\", $format, \"&keyid=\", $acckey, \"&latitude=\", $lat,\"&longitude=\",$lon,\"&range=\",$range,\"&category_s=\",$category_s);\n\n\treturn $url;\n}\n\nfunction parse($json){\n\n\t$obj  = json_decode($json);\n\n\t$result = \"\";\n\n\t$total_hit_count = $obj->{'total_hit_count'};\n\t\n\tif ($total_hit_count === null) {\n\t\t$result .= \"\u8fd1\u304f\u306b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u306f\u3042\u308a\u307e\u305b\u3093\u3002\";\n\t}else{\n\t\t$result .= \"\u8fd1\u304f\u306b\u3042\u308b\u30e9\u30fc\u30e1\u30f3\u5c4b\u3055\u3093\u3067\u3059\u3002\\n\\n\";\n\t \tforeach($obj->{'rest'} as $val){\n\n        \tif (checkString($val->{'name'})) {\n        \t\t$result .= $val->{'name'}.\"\\n\";\n        \t}\n\n        \tif (checkString($val->{'address'})) {\n        \t\t$address = get_address_without_postal_code($val->{'address'});\n        \t\t$result .= $address.\"\\n\";\n        \t}\n\n        \tif (checkString($val->{'url'})) {\n        \t\t$result .= $val->{'url'}.\"\\n\";\n        \t}\n\n        \t$result.=\"\\n\".\"\\n\";\n        }\n        $result.=\"Powered by \u3050\u308b\u306a\u3073\";\n\t}\n\treturn $result;\n}\n\nfunction get_address_without_postal_code($address){\n\treturn mb_substr($address,11);\n}\n\n//\u6587\u5b57\u5217\u3067\u3042\u308b\u304b\u3092\u30c1\u30a7\u30c3\u30af\nfunction checkString($input)\n{\n    if(isset($input) && is_string($input)) {\n        return true;\n    }else{\n        return false;\n    }\n}\n```\n\n\n# \u4eca\u5f8c\u8ffd\u52a0\u3057\u305f\u3044\u6a5f\u80fd\n1.\u73fe\u6642\u70b9\u3067\u3050\u308b\u306a\u3073\u304b\u3089\u8fd4\u3063\u3066\u304d\u305f\u30e9\u30fc\u30e1\u30f3\u5c4b\u30ea\u30b9\u30c8\u3092\u305d\u306e\u307e\u307e\u8868\u793a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f4d\u7f6e\u60c5\u5831\u304b\u3089\u4e00\u756a\u8fd1\u3044\u9806\u306b\u4e26\u3073\u66ff\u3048\u3066\u8868\u793a\u3068\u304b\u3055\u305b\u305f\u3044\u3067\u3059\u3002\n2.\u304a\u5e97\u306eURL\u304c\u9577\u3044\u306e\u3067\u30b7\u30e7\u30fc\u30c8URL\u306b\u3057\u3088\u3046\u304b\u306a\u3068\u3002\n\n# \u611f\u60f3\n\u4f5c\u3063\u3066\u3044\u308b\u3046\u3061\u306b\u4ed6\u306b\u3082\u8272\u3005\u30a2\u30a4\u30c7\u30a2\u304c\u6d6e\u304b\u3093\u3067\u304d\u307e\u3057\u305f\u304c\u3001\u73fe\u6642\u70b9\u3067\uff11\u30a2\u30ab\u30a6\u30f3\u30c81\u30dc\u30c3\u30c8\u306a\u306e\u304c\u60b2\u3057\u3044\uff01\n\n\u65e9\u304f\u8907\u6570\u30dc\u30c3\u30c8\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u305f\u3044\u3067\u3059\u3002\n\n\u305d\u3057\u3066\u3001\u5358\u7d14\u306b\u4f5c\u3063\u3066\u3044\u3066\u697d\u3057\u304b\u3063\u305f\u3067\u3059\uff01\uff01\n\n# \u6700\u5f8c\u306b\n\u5b9c\u3057\u3051\u308c\u3070\u304a\u4f7f\u3044\u4e0b\u3055\u3044\u3002\n\u305f\u3060\u3057\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u306a\u306e\u306750\u4eba\u307e\u3067\u3057\u304b\u4f7f\u3048\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n\u307e\u305f\u88cf\u3067\u8272\u3005\u3068\u30bd\u30fc\u30b9\u3092\u3044\u3058\u3063\u3066\u3044\u308b\u306e\u3067\u4f7f\u3048\u306a\u3044\u6642\u304c\u3042\u308b\u304b\u3082\u3067\u3059(\u7b11)\n![13249521_965957006833237_1020733240_n (1).png](https://qiita-image-store.s3.amazonaws.com/0/44053/d54d28fa-c1d2-9b0a-1f6c-c5d59428e858.png \"13249521_965957006833237_1020733240_n (1).png\")\n\n", "tags": ["bot", "linebot", "PHP", "api"]}