{"context": "\n\n\u524d\u66f8\u304d\ns3fs \u3092\u4f7f\u3063\u3066 s3 \u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001s3fs \u3088\u308a\u9ad8\u901f\u306a\u5df7\u3067\u8a71\u984c\u306e goofys \u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u516c\u5f0f\u30da\u30fc\u30b8\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u898b\u3066\u5206\u304b\u308b\u901a\u308a s3fs \u3068\u306e\u901f\u5ea6\u5dee\u306f\u6b74\u7136\u3067\u3059\u3002\n\n\nOS \u74b0\u5883\n\n/etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.4 LTS\"\n\n\n\n\u30dd\u30b1\u30e2\u30f3Go\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUbuntu \u00b7 golang/go Wiki\n$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable\n$ sudo apt-get update\n$ sudo apt-get install golang\n\n\n\u78ba\u8a8d\n$ go version\ngo version go1.6 linux/amd64\n\n\nPATH \u306e\u8a2d\u5b9a\n$ [ ! -e ~/go/ ] && mkdir ~/go\n$ export GOPATH=$HOME/go\n$ export PATH=\"$PATH:$GOPATH/bin\"\n\n\u8d77\u52d5\u6642\u306b PATH \u3092\u901a\u3057\u305f\u3044\u5834\u5408\u306f ~/.profile \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n~/.profile\n...\nif [ -d \"$HOME/go\" ] ; then\n    GOPATH=\"$HOME/go\"\nfi\nif [ -d \"$GOPATH/bin\" ] ; then\n    PATH=\"$PATH:$GOPATH/bin\"\nfi\n\n\n\n\u78ba\u8a8d\n$ echo $GOPATH\n/home/vagrant/go\n$ echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/vagrant/go/bin\n\n\ngit\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo apt-get install git\n\n\n\u78ba\u8a8d\n$ git --version\ngit version 1.9.1\n\n\ngoofys\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ go get github.com/kahing/goofys\n$ go install github.com/kahing/goofys\n\n\n\u78ba\u8a8d\n$ goofys -h\nError: goofys takes exactly two arguments.\n\nNAME:\n   goofys - Mount an S3 bucket locally\n\nUSAGE:\n   goofys [global options] bucket[:prefix] mountpoint\n\nVERSION:\n   0.0.6\n\nGLOBAL OPTIONS:\n   --help, -h              Print this help text and exit successfuly.\n   -o value                Additional system-specific mount options. Be careful!\n   --dir-mode value        Permissions bits for directories. (default: 0755) (default: 493)\n   --file-mode value       Permission bits for files (default: 0644) (default: 420)\n   --uid value             UID owner of all inodes. (default: 1000)\n   --gid value             GID owner of all inodes. (default: 1000)\n   --endpoint value        The non-AWS endpoint to connect to. Possible values: http://127.0.0.1:8081/\n   --region value          The non-AWS endpoint to connect to. Possible values: us-east-1, us-west-1, us-west-2, eu-west-1, eu-central-1, ap-southeast-1, ap-southeast-2, ap-northeast-1, sa-east-1, cn-north-1 (default: \"us-west-2\")\n   --storage-class value   The type of storage to use when writing objects. Possible values: REDUCED_REDUNDANCY, STANDARD, STANDARD_IA. (default: \"STANDARD\")\n   --use-path-request      Use a path-style request instead of virtual host-style. (deprecated, always on)\n   --profile value         Use a named profile from $HOME/.aws/credentials instead of \"default\"\n   --use-content-type      Set Content-Type according to file extension and /etc/mime.types (default: off)\n   --stat-cache-ttl value  How long to cache StatObject results and inode attributes. (default: 1m0s)\n   --type-cache-ttl value  How long to cache name -> file/dir mappings in directory inodes. (default: 1m0s)\n   --debug_fuse            Enable fuse-related debugging output.\n   --debug_s3              Enable S3-related debugging output.\n   -f                      Run goofys in foreground.\n   --version, -v           print the version\n\n\nAWS CLI\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\napt-get \u3067 AWS CLI \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4f4e\u3044\u305f\u3081\u3001 aws configure \u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3057\u3066\u3082 ~/.aws/credentials \u306f\u4f5c\u6210\u3055\u308c\u305a ~/.aws/config \u306e\u4e00\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u8a18\u8f09\u901a\u308a\u3001 Go \u306e AWS SDK \u306f ~/.aws/credentials \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001 ~/.aws/config \u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u4eca\u56de\u306f pip \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\naws/aws-sdk-go: AWS SDK for the Go programming language.\n\nAWS CLI config file (~/.aws/config)\nThe AWS SDK for Go does not support the AWS CLI's config file. The SDK will not use any contents from this file. The SDK only supports the shared credentials file (~/.aws/credentials). #384 tracks this feature request discussion.\n\n$ sudo apt-get install python-pip\n$ sudo pip install awscli\n\n\n\u78ba\u8a8d\n$ aws --version\naws-cli/1.10.50 Python/2.7.6 Linux/3.13.0-43-generic botocore/1.4.40\n\n\n\u8a2d\u5b9a\n$ aws configure\nAWS Access Key ID [None]:\nAWS Secret Access Key [None]:\nDefault region name [None]:\nDefault output format [None]:\n\n\ns3 \u306e\u30de\u30a6\u30f3\u30c8\u3068\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n\n\u30de\u30a6\u30f3\u30c8\n$ goofys bucket /mnt/mountpoint\n\n-f \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u30d5\u30a9\u30a2\u30b0\u30e9\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n--debug_fuse --debug_s3 \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u30c7\u30d0\u30c3\u30b0\u3092\u884c\u3046\u969b\u306f -f \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ goofys -f bucket /mnt/mountpoint\n\n\n\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n$ sudo umount /mnt/mountpoint\n\n\n\u78ba\u8a8d\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\nudev            240M   12K  240M   1% /dev\ntmpfs            49M  352K   49M   1% /run\n/dev/sda1        40G  2.0G   36G   6% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nnone            5.0M     0  5.0M   0% /run/lock\nnone            245M     0  245M   0% /run/shm\nnone            100M     0  100M   0% /run/user\nvagrant         233G  211G   22G  91% /vagrant\nbucket          1.0P     0  1.0P   0% /mnt/mountpoint\n\n\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\n\nAWS CLI \u306e\u8a2d\u5b9a\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306f root \u3067\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u308b\u3081\u3001 root \u306e AWS CLI \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n$ sudo su \n\n# aws configure\nAWS Access Key ID [None]:\nAWS Secret Access Key [None]:\nDefault region name [None]:\nDefault output format [None]:\n\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e 2 \u901a\u308a\u3067\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\n2 \u901a\u308a\u306e\u8a2d\u5b9a\n\n/etc/fstab \u3092\u8a2d\u5b9a\n\n\u8a2d\u5b9a\n\n/etc/fstab\n/home/vagrant/go/bin/goofys#goofysbucket /mnt/mountpoint fuse _netdev,allow_other,--file-mode=0666,--uid=0,--gid=0 0 0\n\n\ngoofys\u3092\u4f7f\u3063\u3066Amazon Linux\u306bS3\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3002 - Qiita\n\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\n\u8aac\u660e\n\n\n\n\n_netdev\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u6709\u52b9\u306b\u306a\u308b\u307e\u3067\u30de\u30a6\u30f3\u30c8\u3092\u5f85\u3064\u305f\u3081\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u8d77\u52d5\u6642\u306b\u30de\u30a6\u30f3\u30c8\u3055\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u6307\u5b9a\u3059\u308b\u3002\n\n\nallow_other\n\u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\n--file-mode\n\u30de\u30a6\u30f3\u30c8\u3059\u308b\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u6a29\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n\n--uid\n\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u30fcID\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n--gid\n\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30b0\u30eb\u30fc\u30d7ID\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067 id \u306e\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\n\ncurrent-user\n$ id\nuid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant)\n\n\n\nroot\n$ id root\nuid=0(root) gid=0(root) groups=0(root)\n\n\n\nwww-data\n$ id www-data\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n\n\n\n\u78ba\u8a8d\n$ sudo mount -a\n\n\n\u6ce8\u610f\u70b9\n\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u6642\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u30de\u30a6\u30f3\u30c8\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n$ mountpoint /mnt/mountpoint\nmountpoint: /mnt/mountpoint: Transport endpoint is not connected\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3057\u3001\u518d\u5ea6\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3059\u3002\n/etc/rc.local \u306b\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8f09\u3059\u308b\u3053\u3068\u3067\u518d\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u30ea\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059\u3002\n$ sudo umount /mnt/mountpoint\n$ goofys bucket /mnt/mountpoint\n\n\n/etc/rc.local \u3092\u8a2d\u5b9a\n\n\u8a2d\u5b9a\n/etc/rc.local \u306b\u8a18\u8f09\u3057\u305f\u30b3\u30de\u30f3\u30c9\u304c\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n/etc/rc.local\n...\nMOUNT_POINT=/mnt/mountpoint\nBUCKET=bucket\nOPTION=\"-o allow_other --file-mode=0666 --uid=0 --gid=0\"\n\n/bin/umount ${MOUNT_POINT}\n/home/vagrant/go/bin/goofys ${OPTION} ${BUCKET} ${MOUNT_POINT}\n\n\n\n\u78ba\u8a8d\n$ sh /etc/rc.local\n\n\n\u518d\u8d77\u52d5\n\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3051\u308c\u3070\u3001\u30b5\u30fc\u30d0\u30fc\u3092\u518d\u8d77\u52d5\u3057\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n$ sudo reboot\n\n\n\u4e88\u671f\u305b\u305a\u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u305f\u969b\u306e\u5bfe\u7b56\n\nShellScript \u3092\u4f5c\u6210\n[s3fs] s3fs\u304c\u4e88\u671f\u305b\u305a\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u5834\u5408\u3078\u306e\u5bfe\u7b56\n\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u4ee5\u4e0b\u306e ShellScript \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u305d\u306e\u72b6\u614b\u3092\u4fdd\u6301\u3057\u3001\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u518d\u5ea6\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\u56e0\u307f\u306b\u7b46\u8005\u306f\u3001 /etc/rc.local \u3067\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u547c\u3073\u51fa\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n/usr/local/bin/remount-goofys\n#!/bin/sh\n# check mount s3 via goofys and remount if mount is broken\n\n# need for english error message\nLANG=C\n\nMOUNT_POINT=/mnt/mountpoint\nBUCKET=goofysbucket\nOPTION=\"-o allow_other --file-mode=0666 --uid=0 --gid=0\"\n\n# check, whether a mount point is mounted\n/bin/mountpoint ${MOUNT_POINT}\nif [ 0 = $? ]\nthen\n    echo `date --rfc-2822` \": keeping mount s3 via goofys\"\n    return 0\nelse\n    echo `date --rfc-2822` \": unexpected umount s3\" 1>&2\n\n    # try re-mount\n    echo \"try remount goofys...\" 1>&2\n    /bin/umount ${MOUNT_POINT}\n    /home/vagrant/go/bin/goofys ${OPTION} ${BUCKET} ${MOUNT_POINT}\n    if [ 0 = $? ]\n    then\n      echo \"success remount goofys\" 1>&2\n    else\n      echo \"failed remount goofys\" 1>&2\n    fi\n    return 1\nfi\n\n\n\u5b9f\u884c\u6a29\u9650\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3092\u5fd8\u308c\u306a\u3044\u3067\u4e0b\u3055\u3044\u3002\n$ sudo chmod 755 /usr/local/bin/remount-goofys\n\n\n\u30c7\u30e2\n\n\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n$ sudo remount-goofys\n/mnt/mountpoint is a mountpoint\nWed, 27 Jul 2016 09:01:33 +0000 : keeping mount s3 via goofys\n\n\n\u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u3066\u3044\u308b\u5834\u5408\n$ sudo remount-goofys\nmountpoint: /mnt/mountpoint: Transport endpoint is not connected\nWed, 27 Jul 2016 09:00:38 +0000 : unexpected umount s3\ntry re-mount goofys...\nsuccess remount goofys\n\n\n\u5bfe\u7b56\nZabbix \u7b49\u306e\u76e3\u8996\u30c4\u30fc\u30eb\u3067\u30de\u30a6\u30f3\u30c8\u72b6\u614b\u3092\u76e3\u8996\u3057\u3001\u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u305f\u969b\u306b\u30c8\u30ea\u30ac\u30fc\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306e\u304c\u30d9\u30b9\u30c8\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n\u203b \u691c\u8a3c\u3057\u3066\u3044\u306a\u3044\u70ba\u3001\u51fa\u6765\u308b\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u2026\u3002\ncron \u3067\u5b9a\u671f\u7684\u306b\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u308a\u3068\u5bfe\u7b56\u65b9\u6cd5\u306f\u6ca2\u5c71\u3042\u308a\u305d\u3046\u3067\u3059\u3002\u30aa\u30b9\u30b9\u30e1\u306e\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u4e0b\u3055\u3044\uff01\n\n## \u524d\u66f8\u304d\n\n[s3fs](https://github.com/s3fs-fuse/s3fs-fuse \"s3fs-fuse/s3fs-fuse: FUSE-based file system backed by Amazon S3\") \u3092\u4f7f\u3063\u3066 s3 \u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001s3fs \u3088\u308a\u9ad8\u901f\u306a\u5df7\u3067\u8a71\u984c\u306e [goofys](https://github.com/kahing/goofys \"kahing/goofys: a Filey System for Amazon S3 written in Go\") \u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u516c\u5f0f\u30da\u30fc\u30b8\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u898b\u3066\u5206\u304b\u308b\u901a\u308a s3fs \u3068\u306e\u901f\u5ea6\u5dee\u306f\u6b74\u7136\u3067\u3059\u3002\n\n![Benchmark](https://raw.githubusercontent.com/kahing/goofys/master/bench/bench.png \"Benchmark\")\n\n## OS \u74b0\u5883\n\n```file:/etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.4 LTS\"\n```\n\n## ~~\u30dd\u30b1\u30e2\u30f3~~Go\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[Ubuntu \u00b7 golang/go Wiki](https://github.com/golang/go/wiki/Ubuntu \"Ubuntu \u00b7 golang/go Wiki\")\n\n```sh\n$ sudo add-apt-repository ppa:ubuntu-lxc/lxd-stable\n$ sudo apt-get update\n$ sudo apt-get install golang\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ go version\ngo version go1.6 linux/amd64\n```\n\n### PATH \u306e\u8a2d\u5b9a\n\n```sh\n$ [ ! -e ~/go/ ] && mkdir ~/go\n$ export GOPATH=$HOME/go\n$ export PATH=\"$PATH:$GOPATH/bin\"\n```\n\n\u8d77\u52d5\u6642\u306b PATH \u3092\u901a\u3057\u305f\u3044\u5834\u5408\u306f `~/.profile` \u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```sh:~/.profile\n...\nif [ -d \"$HOME/go\" ] ; then\n    GOPATH=\"$HOME/go\"\nfi\nif [ -d \"$GOPATH/bin\" ] ; then\n    PATH=\"$PATH:$GOPATH/bin\"\nfi\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ echo $GOPATH\n/home/vagrant/go\n$ echo $PATH\n/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/home/vagrant/go/bin\n```\n\n## git\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```sh\n$ sudo apt-get install git\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ git --version\ngit version 1.9.1\n```\n\n## goofys\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```sh\n$ go get github.com/kahing/goofys\n$ go install github.com/kahing/goofys\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ goofys -h\nError: goofys takes exactly two arguments.\n\nNAME:\n   goofys - Mount an S3 bucket locally\n\nUSAGE:\n   goofys [global options] bucket[:prefix] mountpoint\n\nVERSION:\n   0.0.6\n\nGLOBAL OPTIONS:\n   --help, -h              Print this help text and exit successfuly.\n   -o value                Additional system-specific mount options. Be careful!\n   --dir-mode value        Permissions bits for directories. (default: 0755) (default: 493)\n   --file-mode value       Permission bits for files (default: 0644) (default: 420)\n   --uid value             UID owner of all inodes. (default: 1000)\n   --gid value             GID owner of all inodes. (default: 1000)\n   --endpoint value        The non-AWS endpoint to connect to. Possible values: http://127.0.0.1:8081/\n   --region value          The non-AWS endpoint to connect to. Possible values: us-east-1, us-west-1, us-west-2, eu-west-1, eu-central-1, ap-southeast-1, ap-southeast-2, ap-northeast-1, sa-east-1, cn-north-1 (default: \"us-west-2\")\n   --storage-class value   The type of storage to use when writing objects. Possible values: REDUCED_REDUNDANCY, STANDARD, STANDARD_IA. (default: \"STANDARD\")\n   --use-path-request      Use a path-style request instead of virtual host-style. (deprecated, always on)\n   --profile value         Use a named profile from $HOME/.aws/credentials instead of \"default\"\n   --use-content-type      Set Content-Type according to file extension and /etc/mime.types (default: off)\n   --stat-cache-ttl value  How long to cache StatObject results and inode attributes. (default: 1m0s)\n   --type-cache-ttl value  How long to cache name -> file/dir mappings in directory inodes. (default: 1m0s)\n   --debug_fuse            Enable fuse-related debugging output.\n   --debug_s3              Enable S3-related debugging output.\n   -f                      Run goofys in foreground.\n   --version, -v           print the version\n```\n\n## AWS CLI\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\napt-get \u3067 AWS CLI \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u4f4e\u3044\u305f\u3081\u3001 `aws configure` \u30b3\u30de\u30f3\u30c9\u3067\u8a2d\u5b9a\u3057\u3066\u3082 `~/.aws/credentials` \u306f\u4f5c\u6210\u3055\u308c\u305a `~/.aws/config` \u306e\u4e00\u30d5\u30a1\u30a4\u30eb\u306e\u307f\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u8a18\u8f09\u901a\u308a\u3001 Go \u306e AWS SDK \u306f `~/.aws/credentials` \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001 `~/.aws/config` \u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u4eca\u56de\u306f pip \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n[aws/aws-sdk-go: AWS SDK for the Go programming language.](https://github.com/aws/aws-sdk-go#configuring-credentials \"aws/aws-sdk-go: AWS SDK for the Go programming language.\")\n\n> **AWS CLI config file (`~/.aws/config`)**\n> The AWS SDK for Go does not support the AWS CLI's config file. The SDK will not use any contents from this file. The SDK only supports the shared credentials file (`~/.aws/credentials`). #384 tracks this feature request discussion.\n\n```sh\n$ sudo apt-get install python-pip\n$ sudo pip install awscli\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ aws --version\naws-cli/1.10.50 Python/2.7.6 Linux/3.13.0-43-generic botocore/1.4.40\n```\n\n### \u8a2d\u5b9a\n\n```sh\n$ aws configure\nAWS Access Key ID [None]:\nAWS Secret Access Key [None]:\nDefault region name [None]:\nDefault output format [None]:\n```\n\n## s3 \u306e\u30de\u30a6\u30f3\u30c8\u3068\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n\n### \u30de\u30a6\u30f3\u30c8\n\n```sh\n$ goofys bucket /mnt/mountpoint\n```\n\n`-f` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u30d5\u30a9\u30a2\u30b0\u30e9\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n`--debug_fuse` `--debug_s3` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u30c7\u30d0\u30c3\u30b0\u3092\u884c\u3046\u969b\u306f `-f` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```sh\n$ goofys -f bucket /mnt/mountpoint\n```\n\n### \u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n\n```sh\n$ sudo umount /mnt/mountpoint\n```\n\n### \u78ba\u8a8d\n\n```sh\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\nudev            240M   12K  240M   1% /dev\ntmpfs            49M  352K   49M   1% /run\n/dev/sda1        40G  2.0G   36G   6% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nnone            5.0M     0  5.0M   0% /run/lock\nnone            245M     0  245M   0% /run/shm\nnone            100M     0  100M   0% /run/user\nvagrant         233G  211G   22G  91% /vagrant\nbucket          1.0P     0  1.0P   0% /mnt/mountpoint\n```\n\n## \u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\n\n### AWS CLI \u306e\u8a2d\u5b9a\n\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306f root \u3067\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u308b\u3081\u3001 root \u306e AWS CLI \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```sh\n$ sudo su \n```\n\n```sh\n# aws configure\nAWS Access Key ID [None]:\nAWS Secret Access Key [None]:\nDefault region name [None]:\nDefault output format [None]:\n```\n\n\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e 2 \u901a\u308a\u3067\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\n### 2 \u901a\u308a\u306e\u8a2d\u5b9a\n\n#### `/etc/fstab` \u3092\u8a2d\u5b9a\n\n##### \u8a2d\u5b9a\n\n```file:/etc/fstab\n/home/vagrant/go/bin/goofys#goofysbucket /mnt/mountpoint fuse _netdev,allow_other,--file-mode=0666,--uid=0,--gid=0 0 0\n```\n\n[goofys\u3092\u4f7f\u3063\u3066Amazon Linux\u306bS3\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3002 - Qiita](http://qiita.com/kooohei/items/a14f22cb0381342d1861 \"goofys\u3092\u4f7f\u3063\u3066Amazon Linux\u306bS3\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3002 - Qiita\")\n\n| \u30aa\u30d7\u30b7\u30e7\u30f3 | \u8aac\u660e |\n|:-----------|:------------|\n| _netdev | \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u6709\u52b9\u306b\u306a\u308b\u307e\u3067\u30de\u30a6\u30f3\u30c8\u3092\u5f85\u3064\u305f\u3081\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u306e\u30c7\u30d0\u30a4\u30b9\u3092\u8d77\u52d5\u6642\u306b\u30de\u30a6\u30f3\u30c8\u3055\u305b\u305f\u3044\u5834\u5408\u306a\u3069\u306b\u6307\u5b9a\u3059\u308b\u3002 |\n| allow_other | \u4ed6\u306e\u30e6\u30fc\u30b6\u30fc\u3067\u3082\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002 |\n| --file-mode | \u30de\u30a6\u30f3\u30c8\u3059\u308b\u969b\u306e\u30d5\u30a1\u30a4\u30eb\u6a29\u9650\u3092\u8a2d\u5b9a\u3059\u308b\u3002 |\n| --uid | \u30de\u30a6\u30f3\u30c8\u3059\u308b\u30e6\u30fc\u30b6\u30fcID\u3092\u6307\u5b9a\u3059\u308b\u3002 |\n| --gid | \u30de\u30a6\u30f3\u30c8\u3059\u308b\u30b0\u30eb\u30fc\u30d7ID\u3092\u6307\u5b9a\u3059\u308b\u3002 |\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067 id \u306e\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n```sh:current-user\n$ id\nuid=1000(vagrant) gid=1000(vagrant) groups=1000(vagrant)\n```\n\n```sh:root\n$ id root\nuid=0(root) gid=0(root) groups=0(root)\n```\n\n```sh:www-data\n$ id www-data\nuid=33(www-data) gid=33(www-data) groups=33(www-data)\n```\n\n##### \u78ba\u8a8d\n\n```sh\n$ sudo mount -a\n```\n\n##### \u6ce8\u610f\u70b9\n\n\u30b5\u30fc\u30d0\u30fc\u518d\u8d77\u52d5\u6642\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u30de\u30a6\u30f3\u30c8\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n```sh\n$ mountpoint /mnt/mountpoint\nmountpoint: /mnt/mountpoint: Transport endpoint is not connected\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3057\u3001\u518d\u5ea6\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3057\u307e\u3059\u3002\n`/etc/rc.local` \u306b\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u8a18\u8f09\u3059\u308b\u3053\u3068\u3067\u518d\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u30ea\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059\u3002\n\n```sh\n$ sudo umount /mnt/mountpoint\n$ goofys bucket /mnt/mountpoint\n```\n\n#### `/etc/rc.local` \u3092\u8a2d\u5b9a\n\n##### \u8a2d\u5b9a\n\n`/etc/rc.local` \u306b\u8a18\u8f09\u3057\u305f\u30b3\u30de\u30f3\u30c9\u304c\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n```file:/etc/rc.local\n...\nMOUNT_POINT=/mnt/mountpoint\nBUCKET=bucket\nOPTION=\"-o allow_other --file-mode=0666 --uid=0 --gid=0\"\n\n/bin/umount ${MOUNT_POINT}\n/home/vagrant/go/bin/goofys ${OPTION} ${BUCKET} ${MOUNT_POINT}\n```\n\n##### \u78ba\u8a8d\n\n```sh\n$ sh /etc/rc.local\n```\n\n### \u518d\u8d77\u52d5\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3051\u308c\u3070\u3001\u30b5\u30fc\u30d0\u30fc\u3092\u518d\u8d77\u52d5\u3057\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n```sh\n$ sudo reboot\n```\n\n## \u4e88\u671f\u305b\u305a\u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u305f\u969b\u306e\u5bfe\u7b56\n\n### ShellScript \u3092\u4f5c\u6210\n\n[[s3fs] s3fs\u304c\u4e88\u671f\u305b\u305a\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u5834\u5408\u3078\u306e\u5bfe\u7b56](http://www.mori-soft.com/2008-08-15-01-36-37/os/216-s3fs-s3fs \"[s3fs] s3fs\u304c\u4e88\u671f\u305b\u305a\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3055\u308c\u305f\u5834\u5408\u3078\u306e\u5bfe\u7b56\")\n\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u4ee5\u4e0b\u306e ShellScript \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u305d\u306e\u72b6\u614b\u3092\u4fdd\u6301\u3057\u3001\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u518d\u5ea6\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\u56e0\u307f\u306b\u7b46\u8005\u306f\u3001 `/etc/rc.local` \u3067\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u547c\u3073\u51fa\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306e\u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n```sh:/usr/local/bin/remount-goofys\n#!/bin/sh\n# check mount s3 via goofys and remount if mount is broken\n \n# need for english error message\nLANG=C\n\nMOUNT_POINT=/mnt/mountpoint\nBUCKET=goofysbucket\nOPTION=\"-o allow_other --file-mode=0666 --uid=0 --gid=0\"\n \n# check, whether a mount point is mounted\n/bin/mountpoint ${MOUNT_POINT}\nif [ 0 = $? ]\nthen\n    echo `date --rfc-2822` \": keeping mount s3 via goofys\"\n    return 0\nelse\n    echo `date --rfc-2822` \": unexpected umount s3\" 1>&2\n \n    # try re-mount\n    echo \"try remount goofys...\" 1>&2\n    /bin/umount ${MOUNT_POINT}\n    /home/vagrant/go/bin/goofys ${OPTION} ${BUCKET} ${MOUNT_POINT}\n    if [ 0 = $? ]\n    then\n      echo \"success remount goofys\" 1>&2\n    else\n      echo \"failed remount goofys\" 1>&2\n    fi\n    return 1\nfi\n```\n\n\u5b9f\u884c\u6a29\u9650\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3092\u5fd8\u308c\u306a\u3044\u3067\u4e0b\u3055\u3044\u3002\n\n```sh\n$ sudo chmod 755 /usr/local/bin/remount-goofys\n```\n\n### \u30c7\u30e2\n\n#### \u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5834\u5408\n\n```sh\n$ sudo remount-goofys\n/mnt/mountpoint is a mountpoint\nWed, 27 Jul 2016 09:01:33 +0000 : keeping mount s3 via goofys\n```\n\n#### \u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u3066\u3044\u308b\u5834\u5408\n\n```sh\n$ sudo remount-goofys\nmountpoint: /mnt/mountpoint: Transport endpoint is not connected\nWed, 27 Jul 2016 09:00:38 +0000 : unexpected umount s3\ntry re-mount goofys...\nsuccess remount goofys\n```\n\n### \u5bfe\u7b56\n\nZabbix \u7b49\u306e\u76e3\u8996\u30c4\u30fc\u30eb\u3067\u30de\u30a6\u30f3\u30c8\u72b6\u614b\u3092\u76e3\u8996\u3057\u3001\u30de\u30a6\u30f3\u30c8\u304c\u5916\u308c\u305f\u969b\u306b\u30c8\u30ea\u30ac\u30fc\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u306e\u304c\u30d9\u30b9\u30c8\u3060\u3068\u601d\u3044\u307e\u3059\u3002  \n\u203b \u691c\u8a3c\u3057\u3066\u3044\u306a\u3044\u70ba\u3001\u51fa\u6765\u308b\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u2026\u3002  \ncron \u3067\u5b9a\u671f\u7684\u306b\u4f5c\u6210\u3057\u305f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u305f\u308a\u3068\u5bfe\u7b56\u65b9\u6cd5\u306f\u6ca2\u5c71\u3042\u308a\u305d\u3046\u3067\u3059\u3002\u30aa\u30b9\u30b9\u30e1\u306e\u65b9\u6cd5\u304c\u3042\u308c\u3070\u6559\u3048\u3066\u4e0b\u3055\u3044\uff01\n", "tags": ["AWS", "S3", "goofys", "Ubuntu"]}