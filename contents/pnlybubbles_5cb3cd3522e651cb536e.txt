{"tags": ["CG"], "context": "qiita\u3067\u306f\u6570\u5f0f\u3092\u3072\u3068\u3064\u306e\u8a18\u4e8b\u306b\u305f\u304f\u3055\u3093\u5165\u308c\u308b\u3068\u91cd\u304f\u3066\u30e0\u30ea\u3060\u3063\u305f\u306e\u3067\u3001\uff12\u3064\u306b\u5206\u3051\u307e\u3057\u305f\u3002\n\u524d\u534a\u306f\u3053\u3061\u3089\n\u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b01\n\n\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u81ea\u5206\u306e\u7406\u89e3\u306e\u305f\u3081\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\u57fa\u672c\u7684\u306b\u7406\u8ad6\u7684\u306a\u90e8\u5206\u3092\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\n\u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30e9edupt\u89e3\u8aac - http://www.slideshare.net/h013/edupt-kaisetsu-22852235\n\u53cc\u65b9\u5411\u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\u30ec\u30f3\u30c0\u30e9edubpt\u89e3\u8aac - http://www.slideshare.net/h013/edubpt-v100\nMonte Carlo Ray Tracing - http://www.cs.rutgers.edu/~decarlo/readings/mcrt-sg03c.pdf\nBi-directional Reflectance Distribution Function (BRDF) - Ruigang Yang - http://www.vis.uky.edu/~ryang/Teaching/CS684-fall05/lectures/lec10-BRDF.pdf\n\n\u5b9f\u88c5\u306f\u3053\u3061\u3089\u3002rust\u3084\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u306a\u3093\u3068\u306a\u304frust\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\u307e\u3060\u304a\u305d\u3044\u3002\nhttps://github.com/pnlybubbles/path-trace\n\n\u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u3092\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3059\u308b\u3053\u3068\u304c\u76ee\u7684\u3002\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3067\u518d\u5e30\u3059\u308b\u305f\u3073\u306b\u8a08\u7b97\u91cf\u304c\u6307\u6570\u95a2\u6570\u7684\u306b\u5897\u52a0\u3057\u3066\u3057\u307e\u3046\u3002\u305d\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\u3067\u306f\u53cd\u5c04\u306e\u6642\u306b1\u65b9\u5411\u306e\u307f\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3059\u308b\u3002\n\u5fc5\u8981\u306a\u3082\u306e\u306f\n\nPDFPDF - \u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3059\u308b\u3068\u304d\u306e\u78ba\u7387\u5206\u5e03\u95a2\u6570\nd\\boldsymbol{d} - \u5358\u4f4d\u534a\u7403\u9762\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb(\u4e0a\u306ePDF\u306b\u6e96\u3058\u305f\u3082\u306e)\npRRp_{RR} - \u518d\u5e30\u6253\u3061\u5207\u308a\u7528\u306e\u30ed\u30b7\u30a2\u30f3\u30eb\u30fc\u30ec\u30c3\u30c8\u306e\u4e71\u6570\u3068\u78ba\u7387\nfrf_r - BRDF\n\n\u3053\u308c\u3089\u3092\u8a08\u7b97\u3057\u3001\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u4ee3\u5165\u3057\u3066\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u9069\u7528\u3059\u308b\u3002\n\u5fae\u5c0f\u7acb\u4f53\u89d2\u306b\u95a2\u3057\u3066\u95a2\u6570\u3092\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u7528\u3044\u3066\u7a4d\u5206\u3059\u308b\u3002\n\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u884c\u3046\u3068\u304d\u306b\u306f\u3001\u4f55\u3089\u304b\u306e\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570P\u03c3P_\\sigma\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u304c\u5fc5\u8981\n\u3053\u306e\u6642\u3001P\u03c3(\u03a9)=1P_\\sigma(\\Omega) = 1\u3092\u6e80\u305f\u305b\u3070\u826f\u3044\u3002\n\n\u03a9\\Omega - \u5358\u4f4d\u534a\u7403\u9762\nf(\u03c9)f(\\boldsymbol{\\omega}) - \u5358\u4f4d\u534a\u7403\u9762\u306b\u5b9a\u7fa9\u3055\u308c\u305f\u4efb\u610f\u306e\u95a2\u6570\n\n\n\u4e00\u69d8\u5206\u5e03\u306b\u3088\u308b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\n\u30b5\u30f3\u30d7\u30eb\u304c\u4e00\u69d8\u5206\u5e03\u306e\u5834\u5408\u3001\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306f\u5b9a\u6570\u306b\u306a\u308b\nP_\\sigma(\\boldsymbol{\\omega}) = C\nP\u03c3(\u03c9)=C{P_\\sigma(\\boldsymbol{\\omega}) = C\n}\n\\int_\\Omega P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 1\n\u222b\u03a9P\u03c3(\u03c9)d\u03c3(\u03c9)=1{\\int_\\Omega P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 1\n}\n\u3053\u308c\u3092\u6e80\u305f\u305b\u3070\u826f\u3044\u3002\u5358\u4f4d\u534a\u7403\u9762\u306e\u7acb\u4f53\u89d2\u306f2\u03c02 \\pi\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = \\int_{\\Omega} C {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 2 \\pi C = 1\n\u222b\u03a9P\u03c3(\u03c9)d\u03c3(\u03c9)=\u222b\u03a9Cd\u03c3(\u03c9)=2\u03c0C=1{\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = \\int_{\\Omega} C {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 2 \\pi C = 1\n}\nC = \\frac{1}{2 \\pi}\nC=12\u03c0{C = \\frac{1}{2 \\pi}\n}\nP_\\sigma(\\boldsymbol{\\omega}) = \\frac{1}{2 \\pi}\nP\u03c3(\u03c9)=12\u03c0{P_\\sigma(\\boldsymbol{\\omega}) = \\frac{1}{2 \\pi}\n}\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\nP_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{1}{2 \\pi}\nP\u03c3(\u03c9)=PDF(\u03b8,\u03d5)=12\u03c0{P_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{1}{2 \\pi}\n}\n\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\n\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{2 \\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos} \\theta)\n\\end{array}\nF(\u03b8,\u03d5)=\u222bP\u03c3(\u03c9)d\u03c9=12\u03c0\u222b\u03d50\u222b\u03b80sin\u03b8d\u03b8d\u03d5=\u03d52\u03c0\u222b\u03b80sin\u03b8d\u03b8=\u03d52\u03c0(1\u2212cos\u03b8){\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{2 \\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos} \\theta)\n\\end{array}\n}\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5206\u96e2\u3059\u308b\u3068\nF(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos} \\theta\nF(\u03d5)=\u03d52\u03c0F(\u03b8)=1\u2212cos\u03b8{F(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos} \\theta\n}\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\u306e\u9006\u95a2\u6570\u3092\u8003\u3048\u308b\n\nu_1u_1, u_2u_2 - (0, 1](0, 1]\u306e\u7bc4\u56f2\u306e\u4e71\u6570\n\n\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (u_2)\n{\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (u_2)\n}{\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (u_2)\n}\n\u3053\u308c\u3092\u7528\u3044\u3066\u5358\u4f4d\u534a\u7403\u9762\u4e0a\u3067\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u8003\u3048\u3001\u30b5\u30f3\u30d7\u30eb\u70b9\u306e\u30d9\u30af\u30c8\u30eb\u3092\u6c42\u3081\u308b\u3002\n\n\\boldsymbol{d}\\boldsymbol{d} - \u30b5\u30f3\u30d7\u30eb\u70b9\n\\boldsymbol{u}, \\boldsymbol{v}, \\boldsymbol{w}\\boldsymbol{u}, \\boldsymbol{v}, \\boldsymbol{w} - \u6b63\u898f\u76f4\u4ea4\u57fa\u5e95\n\n\\boldsymbol{d} = \\boldsymbol{d_u} + \\boldsymbol{d_v} + \\boldsymbol{d_w}\n{\\boldsymbol{d} = \\boldsymbol{d_u} + \\boldsymbol{d_v} + \\boldsymbol{d_w}\n}{\\boldsymbol{d} = \\boldsymbol{d_u} + \\boldsymbol{d_v} + \\boldsymbol{d_w}\n}\n\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{1- u_2^2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{1- u_2^2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{1- u_2^2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n}\n\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{1 - u_2^2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{1 - u_2^2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{1 - u_2^2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n}\n\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (u_2)) \\boldsymbol{w} \\\\\n&=& u_2 \\boldsymbol{w}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (u_2)) \\boldsymbol{w} \\\\\n&=& u_2 \\boldsymbol{w}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (u_2)) \\boldsymbol{w} \\\\\n&=& u_2 \\boldsymbol{w}\n \\end{array}\n}\n\u3053\u308c\u3089\u3092\u30ec\u30f3\u30bf\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u5f53\u3066\u306f\u3081\u308b\u3002\nL_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n{L_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n}{L_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n}\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u9069\u7528\u3057\u3066\u3001\u63a8\u5b9a\u5024\u3092\u6c42\u3081\u308b\u3002\u3053\u306e\u3068\u304d\\hat L_o\\hat L_o\u306f\u30b5\u30f3\u30d7\u30eb\u3059\u308b\u65b9\u5411\u30921\u65b9\u5411\u306e\u307f\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u518d\u5e30\u304c\u6df1\u304f\u306a\u3063\u3066\u3082\u8a08\u7b97\u91cf\u306f\u6307\u6570\u95a2\u6570\u7684\u306b\u5897\u52a0\u3057\u306a\u3044\u3002\u3053\u306e\\hat L_o\\hat L_o\u3092\u4f55\u5ea6\u3082\u8a55\u4fa1\u3059\u308b\u3053\u3068\u3067\u771f\u5024L_oL_o\u306b\u8fd1\u3065\u304f\u3002\nL_o = \\frac{1}{N} \\sum_{i = 1}^N {\\hat L_o}\n{L_o = \\frac{1}{N} \\sum_{i = 1}^N {\\hat L_o}\n}{L_o = \\frac{1}{N} \\sum_{i = 1}^N {\\hat L_o}\n}\n\u4eca\u56de\u3001BRDF\u9805(f_rf_r)\u306f\u5b8c\u5168\u62e1\u6563\u9762\u3092\u8003\u3048\u308b\u305f\u3081\nf_r = \\frac{\\rho}{\\pi}\n{f_r = \\frac{\\rho}{\\pi}\n}{f_r = \\frac{\\rho}{\\pi}\n}\n\u3053\u308c\u3089\u3092\u4ee3\u5165\u3059\u308b\u3068\n\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{1/ 2 \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta\n\\end{array}\n{\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{1/ 2 \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta\n\\end{array}\n}{\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{1/ 2 \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta\n\\end{array}\n}\n\u518d\u5e30\u7684\u306a\u95a2\u6570\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u5b9f\u88c5\u3067\u306f\u30ed\u30b7\u30a2\u30f3\u30eb\u30fc\u30ec\u30c3\u30c8\u3067\u518d\u5e30\u306e\u4e2d\u65ad\u3092\u884c\u3046\u3002\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n{{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n}{{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n}\n\n\u4f59\u5f26\u306b\u3088\u308b\u30a4\u30f3\u30dd\u30fc\u30bf\u30f3\u30b9\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306ecos\u9805\u306b\u6ce8\u76ee\u3059\u308b\u3068\u3001\u771f\u4e0a\u304b\u3089\u306e\u5bc4\u4e0e\u3092\u5927\u304d\u304f\u4f59\u5f26\u306b\u3057\u305f\u304c\u3063\u3066\u53d6\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u5206\u6563\u3092\u6291\u3048\u3089\u308c\u308b(\u30e9\u30f3\u30d0\u30fc\u30c8\u306e\u4f59\u5f26\u5247)\u3002\n{\\rm cos} \\theta{\\rm cos} \\theta\u306b\u3057\u305f\u304c\u3063\u3066\u91cd\u70b9\u7684\u306b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u305f\u3044\u5834\u5408\u3001\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u3092\u6b21\u306e\u3088\u3046\u306b\u3057\u3066\u6c42\u3081\u308b\u3002\nP_\\sigma(\\boldsymbol{\\omega}) = C {\\rm cos} \\theta\n{P_\\sigma(\\boldsymbol{\\omega}) = C {\\rm cos} \\theta\n}{P_\\sigma(\\boldsymbol{\\omega}) = C {\\rm cos} \\theta\n}\n\\begin{array}{l}\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) &=& \\int_{\\Omega} C {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega}) \\\\\n&=& C \\int^{2 \\pi}_0 \\int^{\\pi/2}_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\pi C \\int^{\\pi / 2}_0 {\\rm sin} 2 \\theta {\\rm d} \\theta \\\\\n&=& \\pi C\n\\end{array}\n{\\begin{array}{l}\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) &=& \\int_{\\Omega} C {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega}) \\\\\n&=& C \\int^{2 \\pi}_0 \\int^{\\pi/2}_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\pi C \\int^{\\pi / 2}_0 {\\rm sin} 2 \\theta {\\rm d} \\theta \\\\\n&=& \\pi C\n\\end{array}\n}{\\begin{array}{l}\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) &=& \\int_{\\Omega} C {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega}) \\\\\n&=& C \\int^{2 \\pi}_0 \\int^{\\pi/2}_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\pi C \\int^{\\pi / 2}_0 {\\rm sin} 2 \\theta {\\rm d} \\theta \\\\\n&=& \\pi C\n\\end{array}\n}\nC = \\frac{1}{\\pi}\n{C = \\frac{1}{\\pi}\n}{C = \\frac{1}{\\pi}\n}\nP_\\sigma(\\boldsymbol{\\omega}) = \\frac{{\\rm cos} \\theta}{\\pi}\n{P_\\sigma(\\boldsymbol{\\omega}) = \\frac{{\\rm cos} \\theta}{\\pi}\n}{P_\\sigma(\\boldsymbol{\\omega}) = \\frac{{\\rm cos} \\theta}{\\pi}\n}\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\nP_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{{\\rm cos} \\theta}{\\pi}\n{P_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{{\\rm cos} \\theta}{\\pi}\n}{P_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{{\\rm cos} \\theta}{\\pi}\n}\n\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\n\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int {\\rm cos} \\theta {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} (2 \\theta) {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{4 \\pi}(1 - {\\rm cos} (2 \\theta)) \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos^2} \\theta)\n\\end{array}\n{\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int {\\rm cos} \\theta {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} (2 \\theta) {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{4 \\pi}(1 - {\\rm cos} (2 \\theta)) \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos^2} \\theta)\n\\end{array}\n}{\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int {\\rm cos} \\theta {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} (2 \\theta) {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{4 \\pi}(1 - {\\rm cos} (2 \\theta)) \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos^2} \\theta)\n\\end{array}\n}\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5206\u96e2\u3059\u308b\u3068\nF(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos^2} \\theta\n{F(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos^2} \\theta\n}{F(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos^2} \\theta\n}\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\u306e\u9006\u95a2\u6570\u3092\u8003\u3048\u308b\n\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (\\sqrt{1 - u_2})\n{\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (\\sqrt{1 - u_2})\n}{\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (\\sqrt{1 - u_2})\n}\n\u3053\u308c\u3092\u7528\u3044\u3066\u5358\u4f4d\u534a\u7403\u9762\u4e0a\u3067\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u8003\u3048\u308b\u3068\u30d9\u30af\u30c8\u30eb\u306e\u5404\u6210\u5206\u306f\n\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{u_2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{u_2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{u_2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n}\n\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{u_2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{u_2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{u_2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n}\n\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (\\sqrt{1 - u_2})) \\boldsymbol{w} \\\\\n&=& \\sqrt{1 - u_2} \\boldsymbol{w}\n \\end{array}\n{\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (\\sqrt{1 - u_2})) \\boldsymbol{w} \\\\\n&=& \\sqrt{1 - u_2} \\boldsymbol{w}\n \\end{array}\n}{\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (\\sqrt{1 - u_2})) \\boldsymbol{w} \\\\\n&=& \\sqrt{1 - u_2} \\boldsymbol{w}\n \\end{array}\n}\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u9069\u7528\u3057\u3066\u3001\u63a8\u5b9a\u5024\u3092\u6c42\u3081\u308b\u3002\nL_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n{L_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n}{L_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n}\n\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{{\\rm cos} \\theta / \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime})\n\\end{array}\n{\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{{\\rm cos} \\theta / \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime})\n\\end{array}\n}{\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{{\\rm cos} \\theta / \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime})\n\\end{array}\n}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n{{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n}{{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n}\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\n512x512\u3067\u4e00\u69d8\u30b5\u30f3\u30d7\u30eb\u3068cos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u5de6\u304c\u4e00\u69d8\u30b5\u30f3\u30d7\u30eb\u3001\u53f3\u304ccos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n16 sample\n\n64 sample\n\n256 sample\n\n1024 sample\n\n\u30b5\u30f3\u30d7\u30eb\u6570\u3092\u591a\u304f\u3059\u308b\u3068\u3060\u3093\u3060\u3093\u3068\u53ce\u675f\u3057\u3001cos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u306e\u65b9\u304c\u5206\u6563\u304c\u5c0f\u3055\u3044\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nqiita\u3067\u306f\u6570\u5f0f\u3092\u3072\u3068\u3064\u306e\u8a18\u4e8b\u306b\u305f\u304f\u3055\u3093\u5165\u308c\u308b\u3068\u91cd\u304f\u3066\u30e0\u30ea\u3060\u3063\u305f\u306e\u3067\u3001\uff12\u3064\u306b\u5206\u3051\u307e\u3057\u305f\u3002\n\n\u524d\u534a\u306f\u3053\u3061\u3089\n\n[\u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b01](http://qiita.com/pnlybubbles/items/416a3273cd245d1a1c04)\n\n---\n\n\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u81ea\u5206\u306e\u7406\u89e3\u306e\u305f\u3081\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\u57fa\u672c\u7684\u306b\u7406\u8ad6\u7684\u306a\u90e8\u5206\u3092\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\n* \u7269\u7406\u30d9\u30fc\u30b9\u30ec\u30f3\u30c0\u30e9edupt\u89e3\u8aac - http://www.slideshare.net/h013/edupt-kaisetsu-22852235\n\n* \u53cc\u65b9\u5411\u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\u30ec\u30f3\u30c0\u30e9edubpt\u89e3\u8aac - http://www.slideshare.net/h013/edubpt-v100\n\n* Monte Carlo Ray Tracing - http://www.cs.rutgers.edu/~decarlo/readings/mcrt-sg03c.pdf\n\n* Bi-directional Reflectance Distribution Function (BRDF) - Ruigang Yang - http://www.vis.uky.edu/~ryang/Teaching/CS684-fall05/lectures/lec10-BRDF.pdf\n\n\u5b9f\u88c5\u306f\u3053\u3061\u3089\u3002rust\u3084\u3063\u3066\u307f\u305f\u304b\u3063\u305f\u306e\u3067\u306a\u3093\u3068\u306a\u304frust\u3067\u66f8\u304d\u307e\u3057\u305f\u3002\u307e\u3060\u304a\u305d\u3044\u3002\n\nhttps://github.com/pnlybubbles/path-trace\n\n## \u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u3092\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3059\u308b\u3053\u3068\u304c\u76ee\u7684\u3002\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3067\u518d\u5e30\u3059\u308b\u305f\u3073\u306b\u8a08\u7b97\u91cf\u304c\u6307\u6570\u95a2\u6570\u7684\u306b\u5897\u52a0\u3057\u3066\u3057\u307e\u3046\u3002\u305d\u308c\u3092\u9632\u3050\u305f\u3081\u306b\u30d1\u30b9\u30c8\u30ec\u30fc\u30b7\u30f3\u30b0\u3067\u306f\u53cd\u5c04\u306e\u6642\u306b1\u65b9\u5411\u306e\u307f\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u3067\u89e3\u6c7a\u3059\u308b\u3002\n\n\u5fc5\u8981\u306a\u3082\u306e\u306f\n\n* $PDF$ - \u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3059\u308b\u3068\u304d\u306e\u78ba\u7387\u5206\u5e03\u95a2\u6570\n* $\\boldsymbol{d}$ - \u5358\u4f4d\u534a\u7403\u9762\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb(\u4e0a\u306ePDF\u306b\u6e96\u3058\u305f\u3082\u306e)\n* $p_{RR}$ - \u518d\u5e30\u6253\u3061\u5207\u308a\u7528\u306e\u30ed\u30b7\u30a2\u30f3\u30eb\u30fc\u30ec\u30c3\u30c8\u306e\u4e71\u6570\u3068\u78ba\u7387\n* $f_r$ - BRDF\n\n\u3053\u308c\u3089\u3092\u8a08\u7b97\u3057\u3001\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u4ee3\u5165\u3057\u3066\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u9069\u7528\u3059\u308b\u3002\n\n\u5fae\u5c0f\u7acb\u4f53\u89d2\u306b\u95a2\u3057\u3066\u95a2\u6570\u3092\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u6cd5\u3092\u7528\u3044\u3066\u7a4d\u5206\u3059\u308b\u3002\n\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u884c\u3046\u3068\u304d\u306b\u306f\u3001\u4f55\u3089\u304b\u306e\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570$P_\\sigma$\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u304c\u5fc5\u8981\n\u3053\u306e\u6642\u3001$P_\\sigma(\\Omega) = 1$\u3092\u6e80\u305f\u305b\u3070\u826f\u3044\u3002\n\n* $\\Omega$ - \u5358\u4f4d\u534a\u7403\u9762\n* $f(\\boldsymbol{\\omega})$ - \u5358\u4f4d\u534a\u7403\u9762\u306b\u5b9a\u7fa9\u3055\u308c\u305f\u4efb\u610f\u306e\u95a2\u6570\n\n#### \u4e00\u69d8\u5206\u5e03\u306b\u3088\u308b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\n\n\u30b5\u30f3\u30d7\u30eb\u304c\u4e00\u69d8\u5206\u5e03\u306e\u5834\u5408\u3001\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306f\u5b9a\u6570\u306b\u306a\u308b\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = C\n```\n\n```math\n\\int_\\Omega P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 1\n```\n\n\u3053\u308c\u3092\u6e80\u305f\u305b\u3070\u826f\u3044\u3002\u5358\u4f4d\u534a\u7403\u9762\u306e\u7acb\u4f53\u89d2\u306f$2 \\pi$\n\n```math\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) = \\int_{\\Omega} C {\\rm d} \\sigma(\\boldsymbol{\\omega}) = 2 \\pi C = 1\n```\n\n```math\nC = \\frac{1}{2 \\pi}\n```\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = \\frac{1}{2 \\pi}\n```\n\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{1}{2 \\pi}\n```\n\n\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\n\n```math\n\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{2 \\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} \\theta {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos} \\theta)\n\\end{array}\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5206\u96e2\u3059\u308b\u3068\n\n```math\nF(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos} \\theta\n```\n\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\u306e\u9006\u95a2\u6570\u3092\u8003\u3048\u308b\n\n* $u_1$, $u_2$ - $(0, 1]$\u306e\u7bc4\u56f2\u306e\u4e71\u6570\n\n```math\n\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (u_2)\n```\n\n\u3053\u308c\u3092\u7528\u3044\u3066\u5358\u4f4d\u534a\u7403\u9762\u4e0a\u3067\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u8003\u3048\u3001\u30b5\u30f3\u30d7\u30eb\u70b9\u306e\u30d9\u30af\u30c8\u30eb\u3092\u6c42\u3081\u308b\u3002\n\n* $\\boldsymbol{d}$ - \u30b5\u30f3\u30d7\u30eb\u70b9\n* $\\boldsymbol{u}, \\boldsymbol{v}, \\boldsymbol{w}$ - \u6b63\u898f\u76f4\u4ea4\u57fa\u5e95\n\n```math\n\\boldsymbol{d} = \\boldsymbol{d_u} + \\boldsymbol{d_v} + \\boldsymbol{d_w}\n```\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{1- u_2^2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n```\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (u_2)) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{1 - u_2^2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n```\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (u_2)) \\boldsymbol{w} \\\\\n&=& u_2 \\boldsymbol{w}\n \\end{array}\n```\n\n\u3053\u308c\u3089\u3092\u30ec\u30f3\u30bf\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u5f53\u3066\u306f\u3081\u308b\u3002\n\n```math\nL_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n```\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u9069\u7528\u3057\u3066\u3001\u63a8\u5b9a\u5024\u3092\u6c42\u3081\u308b\u3002\u3053\u306e\u3068\u304d$\\hat L_o$\u306f\u30b5\u30f3\u30d7\u30eb\u3059\u308b\u65b9\u5411\u30921\u65b9\u5411\u306e\u307f\u3068\u3059\u308b\u3053\u3068\u3067\u3001\u518d\u5e30\u304c\u6df1\u304f\u306a\u3063\u3066\u3082\u8a08\u7b97\u91cf\u306f\u6307\u6570\u95a2\u6570\u7684\u306b\u5897\u52a0\u3057\u306a\u3044\u3002\u3053\u306e$\\hat L_o$\u3092\u4f55\u5ea6\u3082\u8a55\u4fa1\u3059\u308b\u3053\u3068\u3067\u771f\u5024$L_o$\u306b\u8fd1\u3065\u304f\u3002\n\n```math\nL_o = \\frac{1}{N} \\sum_{i = 1}^N {\\hat L_o}\n```\n\n\u4eca\u56de\u3001BRDF\u9805($f_r$)\u306f\u5b8c\u5168\u62e1\u6563\u9762\u3092\u8003\u3048\u308b\u305f\u3081\n\n```math\nf_r = \\frac{\\rho}{\\pi}\n```\n\n\u3053\u308c\u3089\u3092\u4ee3\u5165\u3059\u308b\u3068\n\n```math\n\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{1/ 2 \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta\n\\end{array}\n```\n\n\u518d\u5e30\u7684\u306a\u95a2\u6570\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u5b9f\u88c5\u3067\u306f\u30ed\u30b7\u30a2\u30f3\u30eb\u30fc\u30ec\u30c3\u30c8\u3067\u518d\u5e30\u306e\u4e2d\u65ad\u3092\u884c\u3046\u3002\n\n```math\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + 2 \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n```\n\n#### \u4f59\u5f26\u306b\u3088\u308b\u30a4\u30f3\u30dd\u30fc\u30bf\u30f3\u30b9\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306ecos\u9805\u306b\u6ce8\u76ee\u3059\u308b\u3068\u3001\u771f\u4e0a\u304b\u3089\u306e\u5bc4\u4e0e\u3092\u5927\u304d\u304f\u4f59\u5f26\u306b\u3057\u305f\u304c\u3063\u3066\u53d6\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u5206\u6563\u3092\u6291\u3048\u3089\u308c\u308b(\u30e9\u30f3\u30d0\u30fc\u30c8\u306e\u4f59\u5f26\u5247)\u3002\n\n${\\rm cos} \\theta$\u306b\u3057\u305f\u304c\u3063\u3066\u91cd\u70b9\u7684\u306b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u305f\u3044\u5834\u5408\u3001\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u3092\u6b21\u306e\u3088\u3046\u306b\u3057\u3066\u6c42\u3081\u308b\u3002\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = C {\\rm cos} \\theta\n```\n\n```math\n\\begin{array}{l}\n\\int_{\\Omega} P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\sigma(\\boldsymbol{\\omega}) &=& \\int_{\\Omega} C {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega}) \\\\\n&=& C \\int^{2 \\pi}_0 \\int^{\\pi/2}_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\pi C \\int^{\\pi / 2}_0 {\\rm sin} 2 \\theta {\\rm d} \\theta \\\\\n&=& \\pi C\n\\end{array}\n```\n\n```math\nC = \\frac{1}{\\pi}\n```\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = \\frac{{\\rm cos} \\theta}{\\pi}\n```\n\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\n\n```math\nP_\\sigma(\\boldsymbol{\\omega}) = PDF(\\theta, \\phi) = \\frac{{\\rm cos} \\theta}{\\pi}\n```\n\n\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\n\n```math\n\\begin{array}{l}\nF(\\theta, \\phi) &=& \\int P_\\sigma(\\boldsymbol{\\omega}) {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int {\\rm cos} \\theta {\\rm d} \\boldsymbol{\\omega} \\\\\n&=& \\frac{1}{\\pi} \\int^\\phi_0 \\int^\\theta_0 {\\rm cos} \\theta {\\rm sin} \\theta {\\rm d} \\theta {\\rm d} \\phi \\\\\n&=& \\frac{\\phi}{2 \\pi} \\int^\\theta_0 {\\rm sin} (2 \\theta) {\\rm d} \\theta \\\\\n&=& \\frac{\\phi}{4 \\pi}(1 - {\\rm cos} (2 \\theta)) \\\\\n&=& \\frac{\\phi}{2 \\pi}(1 - {\\rm cos^2} \\theta)\n\\end{array}\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5206\u96e2\u3059\u308b\u3068\n\n```math\nF(\\phi) = \\frac{\\phi}{2 \\pi} \\\\\nF(\\theta) = 1 - {\\rm cos^2} \\theta\n```\n\n\u78ba\u7387\u5bc6\u5ea6\u95a2\u6570\u306b\u57fa\u3065\u3044\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u3001\u7d2f\u7a4d\u5206\u5e03\u95a2\u6570\u306e\u9006\u95a2\u6570\u3092\u8003\u3048\u308b\n\n```math\n\\phi_i = 2 \\pi u_1 \\\\\n\\theta_i = {\\rm arccos} (\\sqrt{1 - u_2})\n```\n\n\u3053\u308c\u3092\u7528\u3044\u3066\u5358\u4f4d\u534a\u7403\u9762\u4e0a\u3067\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u8003\u3048\u308b\u3068\u30d9\u30af\u30c8\u30eb\u306e\u5404\u6210\u5206\u306f\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_u} &=& {\\rm sin} \\theta_i {\\rm cos} \\phi_i \\boldsymbol{u} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm cos}(2 \\pi u_1) \\boldsymbol{u} \\\\\n&=& \\sqrt{u_2} {\\rm cos}(2 \\pi u_1) \\boldsymbol{u}\n \\end{array}\n```\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_v} &=& {\\rm sin} \\theta_i {\\rm sin} \\phi_i \\boldsymbol{v} \\\\\n&=& {\\rm sin}({\\rm arccos} (\\sqrt{1 - u_2})) {\\rm sin}(2 \\pi u_1) \\boldsymbol{v} \\\\\n&=& \\sqrt{u_2} {\\rm sin}(2 \\pi u_1) \\boldsymbol{v}\n \\end{array}\n```\n\n```math\n\\begin{array}{l}\n \\boldsymbol{d_w} &=& {\\rm cos} \\theta_i \\boldsymbol{w} \\\\\n&=& {\\rm cos}({\\rm arccos} (\\sqrt{1 - u_2})) \\boldsymbol{w} \\\\\n&=& \\sqrt{1 - u_2} \\boldsymbol{w}\n \\end{array}\n```\n\n\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u65b9\u7a0b\u5f0f\u306b\u30e2\u30f3\u30c6\u30ab\u30eb\u30ed\u7a4d\u5206\u3092\u9069\u7528\u3057\u3066\u3001\u63a8\u5b9a\u5024\u3092\u6c42\u3081\u308b\u3002\n\n```math\nL_o(\\boldsymbol{x}, \\boldsymbol{\\omega}) = L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\int_{\\Omega_x} f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta {\\rm d} \\sigma(\\boldsymbol{\\omega^\\prime})\n```\n\n```math\n\\begin{array}{l}\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) &=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_i(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime_i}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{f_r(\\boldsymbol{x}, \\boldsymbol{\\omega}, \\boldsymbol{\\omega^\\prime_i}) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{PDF(\\boldsymbol{\\omega^\\prime_i})} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\frac{(\\rho / \\pi) L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) {\\rm cos} \\theta}{{\\rm cos} \\theta / \\pi} \\\\\n&=& L_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime})\n\\end{array}\n```\n\n```math\n{\\hat L_o(\\boldsymbol{x}}, \\boldsymbol{\\omega}) =\n\\begin{cases}\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) + \\rho L_o(\\boldsymbol{r}(\\boldsymbol{x}, \\boldsymbol{\\omega^\\prime}), - \\boldsymbol{\\omega^\\prime}) \\frac{1}{p_{RR}}  & (r_{RR} \\lt p_{RR}) \\\\\nL_e(\\boldsymbol{x}, \\boldsymbol{\\omega}) & (r_{RR} \\geq p_{RR})\n\\end{cases}\n```\n\n## \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\n\n512x512\u3067\u4e00\u69d8\u30b5\u30f3\u30d7\u30eb\u3068cos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u5de6\u304c\u4e00\u69d8\u30b5\u30f3\u30d7\u30eb\u3001\u53f3\u304ccos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n16 sample\n![image_16.png](https://qiita-image-store.s3.amazonaws.com/0/14939/e3a0e152-ccf6-91e3-f3f8-d571b9fe3e66.png)\n\n64 sample\n![image_64.png](https://qiita-image-store.s3.amazonaws.com/0/14939/e9126f09-5165-15ab-28ce-2cbe5c39e904.png)\n\n256 sample\n![image_256.png](https://qiita-image-store.s3.amazonaws.com/0/14939/9022504e-a961-ffbe-b669-6545636a9301.png)\n\n1024 sample\n![image_1024.png](https://qiita-image-store.s3.amazonaws.com/0/14939/1641991f-5c9a-c122-e4b6-4667175f36e4.png)\n\n\u30b5\u30f3\u30d7\u30eb\u6570\u3092\u591a\u304f\u3059\u308b\u3068\u3060\u3093\u3060\u3093\u3068\u53ce\u675f\u3057\u3001cos\u91cd\u70b9\u7684\u30b5\u30f3\u30d7\u30eb\u306e\u65b9\u304c\u5206\u6563\u304c\u5c0f\u3055\u3044\u306e\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n"}