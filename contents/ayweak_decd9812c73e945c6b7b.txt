{"tags": ["passenger5.0.21", "CentOS7"], "context": " More than 1 year has passed since last update.\u77e5\u3089\u306a\u304b\u3063\u305f\u3002\n\nCentOS Linux release 7.1.1503 (Core)\nPassenger 5.0.21\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b passenger-status \u3092\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\n~# passenger-status \nERROR: Phusion Passenger doesn't seem to be running. If you are sure that it is running,\nthen the causes of this problem could be:\n\n1. You customized the instance registry directory using Apache's PassengerInstanceRegistryDir option,\nNginx's passenger_instance_registry_dir option, or Phusion Passenger Standalone's --instance-registry-dir\ncommand line argument. If so, please set the environment variable PASSENGER_INSTANCE_REGISTRY_DIR to that\ndirectory and run passenger-status again.\n2. The instance directory has been removed by an operating system background service. Please set a different\ninstance registry directory using Apache's PassengerInstanceRegistryDir option, Nginx's\npassenger_instance_registry_dir option, or Phusion Passenger Standalone's --instance-registry-dir\ncommand line argument.\n\n\u7279\u306b\u8a2d\u5b9a\u3092\u3044\u3058\u3063\u305f\u308a\u3057\u3066\u3044\u306a\u3044\u3002Passenger \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\nhttps://www.phusionpassenger.com/library/config/apache/reference/#passengerinstanceregistrydir\n\nThe default value for this option is as follows:\n\nIf you are on Red Hat and CentOS, and installed Passenger through the RPMs provided by Phusion, then the default value is /var/run/passenger-instreg.\nOtherwise, the default value is the value of the $TMPDIR environment variable. Or, if $TMPDIR is not set, /tmp.\n\n\ngem install passenger \u3057\u305f\u3082\u306e\u306a\u306e\u3067\u4e0a\u8a18\u306e\u5f8c\u8005\u3002\n\u63a2\u3057\u3066\u307f\u308b\u304c\u95a2\u4fc2\u3057\u3066\u3044\u305d\u3046\u306a\u3082\u306e\u304c\u7121\u3044\u3002\n~# echo $TMPDIR\n\n~# ls /tmp\nks-script-tlgcPw  systemd-private-mBNl7v  yum.log\n\n\u3053\u3053\u3067\u5f37\u5f15\u306b\u63a2\u3057\u3066\u307f\u308b\u3002\u305d\u308c\u3089\u3057\u304d\u3082\u306e\u304c\u898b\u3064\u304b\u308b\u3002\n~# find / -iname '*passenger*'\n... \u7701\u7565 ...\n/tmp/systemd-private-mBNl7v/tmp/passenger.aFePViS\n... \u7701\u7565 ...\n\n\u6307\u5b9a\u3057\u3066\u307f\u308b\u3068 passenger-status \u304c\u52d5\u304f\u3002\n~# PASSENGER_INSTANCE_REGISTRY_DIR=/tmp/systemd-private-mBNl7v/tmp passenger-status \nVersion : 5.0.21\nDate    : 2015-11-30 23:36:48 +0900\nInstance: 2Wqc3QMb (Apache/2.4.6 (CentOS) Phusion_Passenger/5.0.21)\n\n----------- General information -----------\nMax pool size : 6\nApp groups    : 1\nProcesses     : 1\nRequests in top-level queue : 0\n\n----------- Application groups -----------\n/var/lib/redmine:\n  App root: /var/lib/redmine\n  Requests in queue: 0\n  * PID: 2473    Sessions: 0       Processed: 1       Uptime: 5m 22s\n    CPU: 0%      Memory  : 125M    Last used: 5m 22s ago\n\n\u3067\u306f systemd-private-xxxxxx \u3068\u306f\u4f55\u304b\u3002\u30b0\u30b0\u308b\u3002\nhttp://stackoverflow.com/questions/30444914/php-has-its-own-tmp-in-tmp-systemd-private-nabcde-tmp-when-accessed-through-ng\n\nBecause systemd is configured to give nginx a private /tmp. If you must use the system /tmp instead for some reason then you will need to modify the .service file to read \"PrivateTmp=no\".\n\nhttp://0pointer.de/blog/projects/security.html\n\nAnother very simple but powerful configuration switch is PrivateTmp=:\n\nhttp://0pointer.de/public/systemd-man/systemd.exec.html#PrivateTmp=\n\nIf true, sets up a new file system namespace for the executed processes and mounts private /tmp and /var/tmp directories inside it that is not shared by processes outside of the namespace.\n\nPassenger \u306f Apache HTTP Server (yum \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3084\u3064) \u304c\u4f7f\u3063\u3066\u3044\u308b\u3002\nApache \u306e PrivateTmp \u306e\u8a2d\u5b9a\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4e0b\u8a18\u3067\u5206\u304b\u3063\u305f\u3002\n~# systemctl status httpd\nhttpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled)\n... \u7701\u7565 ...\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306b true \u3060\u3063\u305f\u3002\n~# cat /usr/lib/systemd/system/httpd.service \n... \u7701\u7565 ...\nPrivateTmp=true\n... \u7701\u7565 ...\n\n\u6b63\u76f4\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3002\n\u77e5\u3089\u306a\u304b\u3063\u305f\u3002\n\n* CentOS Linux release 7.1.1503 (Core)\n* Passenger 5.0.21\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b `passenger-status` \u3092\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\n\n```\n~# passenger-status \nERROR: Phusion Passenger doesn't seem to be running. If you are sure that it is running,\nthen the causes of this problem could be:\n\n1. You customized the instance registry directory using Apache's PassengerInstanceRegistryDir option,\nNginx's passenger_instance_registry_dir option, or Phusion Passenger Standalone's --instance-registry-dir\ncommand line argument. If so, please set the environment variable PASSENGER_INSTANCE_REGISTRY_DIR to that\ndirectory and run passenger-status again.\n2. The instance directory has been removed by an operating system background service. Please set a different\ninstance registry directory using Apache's PassengerInstanceRegistryDir option, Nginx's\npassenger_instance_registry_dir option, or Phusion Passenger Standalone's --instance-registry-dir\ncommand line argument.\n```\n\n\u7279\u306b\u8a2d\u5b9a\u3092\u3044\u3058\u3063\u305f\u308a\u3057\u3066\u3044\u306a\u3044\u3002Passenger \u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nhttps://www.phusionpassenger.com/library/config/apache/reference/#passengerinstanceregistrydir\n\n> The default value for this option is as follows:\n> \n> * If you are on Red Hat and CentOS, and installed Passenger through the RPMs provided by Phusion, then the default value is /var/run/passenger-instreg.\n> * Otherwise, the default value is the value of the \\$TMPDIR environment variable. Or, if \\$TMPDIR is not set, /tmp.\n\n`gem install passenger` \u3057\u305f\u3082\u306e\u306a\u306e\u3067\u4e0a\u8a18\u306e\u5f8c\u8005\u3002\n\u63a2\u3057\u3066\u307f\u308b\u304c\u95a2\u4fc2\u3057\u3066\u3044\u305d\u3046\u306a\u3082\u306e\u304c\u7121\u3044\u3002\n\n```\n~# echo $TMPDIR\n\n~# ls /tmp\nks-script-tlgcPw  systemd-private-mBNl7v  yum.log\n```\n\n\u3053\u3053\u3067\u5f37\u5f15\u306b\u63a2\u3057\u3066\u307f\u308b\u3002\u305d\u308c\u3089\u3057\u304d\u3082\u306e\u304c\u898b\u3064\u304b\u308b\u3002\n\n```\n~# find / -iname '*passenger*'\n... \u7701\u7565 ...\n/tmp/systemd-private-mBNl7v/tmp/passenger.aFePViS\n... \u7701\u7565 ...\n```\n\n\u6307\u5b9a\u3057\u3066\u307f\u308b\u3068 `passenger-status` \u304c\u52d5\u304f\u3002\n\n```\n~# PASSENGER_INSTANCE_REGISTRY_DIR=/tmp/systemd-private-mBNl7v/tmp passenger-status \nVersion : 5.0.21\nDate    : 2015-11-30 23:36:48 +0900\nInstance: 2Wqc3QMb (Apache/2.4.6 (CentOS) Phusion_Passenger/5.0.21)\n\n----------- General information -----------\nMax pool size : 6\nApp groups    : 1\nProcesses     : 1\nRequests in top-level queue : 0\n\n----------- Application groups -----------\n/var/lib/redmine:\n  App root: /var/lib/redmine\n  Requests in queue: 0\n  * PID: 2473    Sessions: 0       Processed: 1       Uptime: 5m 22s\n    CPU: 0%      Memory  : 125M    Last used: 5m 22s ago\n```\n\n\u3067\u306f systemd-private-xxxxxx \u3068\u306f\u4f55\u304b\u3002\u30b0\u30b0\u308b\u3002\n\nhttp://stackoverflow.com/questions/30444914/php-has-its-own-tmp-in-tmp-systemd-private-nabcde-tmp-when-accessed-through-ng\n\n> Because systemd is configured to give nginx a private /tmp. If you must use the system /tmp instead for some reason then you will need to modify the .service file to read \"PrivateTmp=no\".\n\nhttp://0pointer.de/blog/projects/security.html\n\n> Another very simple but powerful configuration switch is PrivateTmp=:\n\nhttp://0pointer.de/public/systemd-man/systemd.exec.html#PrivateTmp=\n\n> If true, sets up a new file system namespace for the executed processes and mounts private /tmp and /var/tmp directories inside it that is not shared by processes outside of the namespace.\n\nPassenger \u306f Apache HTTP Server (`yum` \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3084\u3064) \u304c\u4f7f\u3063\u3066\u3044\u308b\u3002\nApache \u306e `PrivateTmp` \u306e\u8a2d\u5b9a\u5024\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u4e0b\u8a18\u3067\u5206\u304b\u3063\u305f\u3002\n\n```\n~# systemctl status httpd\nhttpd.service - The Apache HTTP Server\n   Loaded: loaded (/usr/lib/systemd/system/httpd.service; enabled)\n... \u7701\u7565 ...\n```\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306b `true` \u3060\u3063\u305f\u3002\n\n```\n~# cat /usr/lib/systemd/system/httpd.service \n... \u7701\u7565 ...\nPrivateTmp=true\n... \u7701\u7565 ...\n```\n\n\u6b63\u76f4\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u3002\n"}