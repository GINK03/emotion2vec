{"tags": ["nginx", "HHVM", "MySQL", "laravel"], "context": " More than 1 year has passed since last update.\u30bf\u30a4\u30c8\u30eb\u901a\u308a\n\u30e1\u30e2\u7528\u306b\u3055\u304f\u3063\u3068\n\u5168\u90e8root\u6a29\u9650\u3067\u3084\u3063\u3066\u307e\u3059\u3002\n\nNginx(1.6)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nnginx\nrpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n\nyum -y install nginx\n\n#\u2193\u30b3\u30f3\u30d5\u30a3\u30b0\u8a2d\u5b9a\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092/var/www/html/laravel/public\u306b\u3057\u3066\u3044\u307e\u3059\uff09\nsed -i -e '9s/\\/usr\\/share\\/nginx\\/html/\\/var\\/www\\/html\\/laravel\\/public/' /etc/nginx/conf.d/default.conf\n\n#\uff11\uff10\u884c\u76ee\u306bindex.php\u3092\u8ffd\u52a0\n\n#\u2191\u3068\u540c\u3058default.conf\u306e location / { \u306e\u30cd\u30b9\u30c8\u306e\u4e2d\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\uff08\u5f8c\u3067\u8ffd\u52a0\u3057\u305f\u306e\u3067\u4f55\u884c\u304b\u306f\u899a\u3048\u3066\u3044\u306a\u3044\uff09\n#\u30cd\u30c3\u30c8\u3067\u3000try_files \\$uri \\$uri/ /index.php?\\$query_string;\n#\u306e\u3088\u3046\u306a\u5f62\u3067\u66f8\u3044\u3066\u3044\u308b\u30b5\u30a4\u30c8\u304c\u3042\u308b\u304c\u305d\u308c\u3060\u3068 laravel\u4f7f\u7528\u6642\u306epublic\u53c2\u7167\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\uff01\ntry_files $uri $uri/ /index.php?$query_string;\n\n\n#\u2193\u30c9\u30e1\u30a4\u30f3\u5909\u66f4+\u30dd\u30fc\u30c8\u89e3\u653e(\u516c\u958b\u30b5\u30fc\u30d0\u30fc\u306e\u307f)\n#sed -i -e '3s/localhost/[\u30c9\u30e1\u30a4\u30f3\u540d]/' /etc/nginx/conf.d/default.conf\n\niptables -I INPUT 5 -m state --state NEW -p tcp --dport 80 -j ACCEPT\nservice iptables save\nservice iptables restart\n\nchkconfig nginx on\n\n\n\n\nhhvm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08hop5\uff09\n\nhhvm\nrpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\ncd /etc/yum.repos.d/\nwget http://www.hop5.in/yum/el6/hop5.repo\n\n#\u2193remove\u3057\u3066\u308b\u306e\u3067\u4f9d\u5b58\u95a2\u4fc2\u306f\u614e\u91cd\u306b\nyum -y remove boost-filesystem-1.41.0-18.el6.x86_64\nyum -y install hhvm\nwget http://pkgrepo.linuxtech.net/el6/release/x86_64/liblcms2-2.4-1.el6.x86_64.rpm\nyum -y install liblcms2-2.4-1.el6.x86_64.rpm\n\n#\u2193nginx\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306bfastcgi\u306e\u9805\u76ee\u3092\u8ffd\u52a0\nsed -i -e \"38i location \\~ \\\\.php$ {\\nfastcgi_pass   127.0.0.1:9000;\\nfastcgi_index  index.php;\\nfastcgi_param  SCRIPT_FILENAME  \\$document_root\\$fastcgi_script_name;\\ninclude        fastcgi_params;\\n}\"  /etc/nginx/conf.d/default.conf\n\n#logfile\u306b\u66f8\u304d\u8fbc\u3080\u8a2d\u5b9a\nsed -i -e \"5i UseLogFile = true\\nFile = /var/log/hhvm/error.log\"  /etc/hhvm/config.hdf \n\n#\u2193\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306bhhvm\u8d77\u52d5\nsed -i -e '$ahhvm --mode daemon -vServer.Type=fastcgi -vServer.Port=9000' /etc/rc.d/rc.local \n\nhhvm --mode daemon -vServer.Type=fastcgi -vServer.Port=9000\n\n\n\nmysql\uff085.5\uff09\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nmysql\nrpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nyum install -y perl-DBD-MySQL libaio libaio-devel openssl-devel\nyum --enablerepo=remi --disablerepo=updates,base install -y mysql mysql-server mysql-devel\n\n#\u30ed\u30b0\u95a2\u9023(\u4eba\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u3001\u305d\u306e\u90fd\u5ea6\u5909\u3048\u308b\u3053\u3068)\nsed -i -e \"4i log-warnings=1\" -e \"4i slow-query-log=myerrorslow.log\" -e \"4i long-query-time=30\" -e \"4i log-queries-not-using-indexes\" -e \"4i log-slow-admin-statements\" -e \"4i log-bin=mysql-trans-log\" -e \"4i log-bin-index=mybin.index\" -e \"4i max-binlog-size=1G\" -e \"4i expire-logs-days=30\" -e \"4i binlog-do-db=ui\"  /etc/my.cnf\n#\u305d\u306e\u4ed6(\u4eba\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u3001\u305d\u306e\u90fd\u5ea6\u5909\u3048\u308b\u3053\u3068)\nsed -i -e \"4i character-set-server = utf8\" -e \"4i collation-server = utf8_general_ci\" -e \"4i port = 3306\"  -e \"4i query_cache_size = 16M\" -e \"4i thread_cache_size = 4\" -e \"4i query_cache_limit = 16M\" -e \"4i tmp_table_size = 16M\" -e \"4i max_heap_table_size = 16M\" -e \"4i thread_cache_size = 4\" -e \"4i innodb_buffer_pool_size = 512M\"  -e \"4i innodb_log_file_size = 64M\"  -e \"4i open_files_limit = 1024\" -e \"4i max_connections = 100\" /etc/my.cnf\nsed -i -e '$a\\n\\[mysql\\]\\ndefault-character-set = utf8\\n\\n\\[client\\]\\nport = 3306\\n\\n\\[mysqldump\\]' /etc/my.cnf\n\nrm /var/lib/mysql/ib_logfile0\nrm /var/lib/mysql/ib_logfile1\n\n#\u2193\u30d1\u30b9\u30ef\u30fc\u30c9\u521d\u671f\u8a2d\u5b9a\u3068\u304b\n#mysql_secure_installation\n\nchkconfig mysqld \n\n\n\n\nlaravel(4.2)+(Sentry2.1)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nlaravel\n\n#\u2193\u4f9d\u5b58\u95a2\u4fc2\uff0bcomposer\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install php php-mcrypt php-mbstring libmcrypt libmcrypt-devel libxml2 libxml2-devel openssl openssl-devel httpd httpd-devel\ncurl -sS https://getcomposer.org/installer | php -- --install-dir=/bin\n\n#\u2193php5.4\u4ee5\u4e0a\u304c\u5fc5\u8981\u306a\u306e\u3067php\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum remove php*\nrpm -ivh  http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/5/x86_64/epel-release-5-4.noarch.rpm\nyum install --enablerepo=remi --enablerepo=remi-php55 php php-devel php-mbstring php-mcrypt php-mysql php-phpunit-PHPUnit php-pecl-xdebug php-cli\n\n#\u2193laravel\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\ncd /var/www/html\ncomposer.phar create-project laravel/laravel laravel\n\ncd laravel\nchmod 777 -R app/storage/\n\n#\u2193/laravel/app/config/app.php\u3092\u5909\u66f4\uff08\uff09\nsed -i -e '42s/UTC/Asia\\/Tokyo/' /var/www/html/laravel/app/config/app.php\nsed -i -e '55s/en/ja/' /var/www/html/laravel/app/config/app.php\n#\u2193\u516c\u958b\u30b5\u30fc\u30d0\u30fc\u306e\u307f\n#sed -i -e '29s/localhost/[\u30c9\u30e1\u30a4\u30f3]/' /var/www/html/laravel/app/config/app.php\n\n#\u2193/laravel/app/config/database.php\u3092\u5909\u66f4\uff08mysql\u3067\u8a2d\u5b9a\u3057\u305fuser\u306a\u3069\uff09\n#sed -i -e '58s/forge/[db]/' /var/www/html/laravel/app/config/database.php\n#sed -i -e '59s/forge/[user]/' /var/www/html/laravel/app/config/database.php\n#sed -i -e '60s/\\'\\'/[pass]/' /var/www/html/laravel/app/config/database.php\n\n#\u2193sentry\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0\u3092\u5909\u66f4\nsed -i -e '7s/$/,/g' /var/www/html/laravel/composer.json\nsed -i -e \"8i \\\"cartalyst/sentry\\\": \\\"2.0.*\\\"\" /var/www/html/laravel/composer.json\n\ncd /var/www/html/laravel/\ncomposer.phar update\n\nsed -i -e \"124i \\'Cartalyst\\\\\\Sentry\\\\\\SentryServiceProvider\\',\" /var/www/html/laravel/app/config/app.php\nsed -i -e \"192i \\'Sentry\\'          => \\'Cartalyst\\\\\\Sentry\\\\\\Facades\\\\\\Laravel\\\\\\Sentry\\',\" /var/www/html/laravel/app/config/app.php\n\n\n\n\n\u30bf\u30a4\u30c8\u30eb\u901a\u308a\n\u30e1\u30e2\u7528\u306b\u3055\u304f\u3063\u3068\n\u5168\u90e8root\u6a29\u9650\u3067\u3084\u3063\u3066\u307e\u3059\u3002\n\n\n###Nginx(1.6)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```nginx:nginx\nrpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n\nyum -y install nginx\n\n#\u2193\u30b3\u30f3\u30d5\u30a3\u30b0\u8a2d\u5b9a\uff08\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u3092/var/www/html/laravel/public\u306b\u3057\u3066\u3044\u307e\u3059\uff09\nsed -i -e '9s/\\/usr\\/share\\/nginx\\/html/\\/var\\/www\\/html\\/laravel\\/public/' /etc/nginx/conf.d/default.conf\n\n#\uff11\uff10\u884c\u76ee\u306bindex.php\u3092\u8ffd\u52a0\n\n#\u2191\u3068\u540c\u3058default.conf\u306e location / { \u306e\u30cd\u30b9\u30c8\u306e\u4e2d\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\uff08\u5f8c\u3067\u8ffd\u52a0\u3057\u305f\u306e\u3067\u4f55\u884c\u304b\u306f\u899a\u3048\u3066\u3044\u306a\u3044\uff09\n#\u30cd\u30c3\u30c8\u3067\u3000try_files \\$uri \\$uri/ /index.php?\\$query_string;\n#\u306e\u3088\u3046\u306a\u5f62\u3067\u66f8\u3044\u3066\u3044\u308b\u30b5\u30a4\u30c8\u304c\u3042\u308b\u304c\u305d\u308c\u3060\u3068 laravel\u4f7f\u7528\u6642\u306epublic\u53c2\u7167\u306b\u554f\u984c\u304c\u3042\u308b\u306e\u3067\u6ce8\u610f\uff01\ntry_files $uri $uri/ /index.php?$query_string;\n\n\n#\u2193\u30c9\u30e1\u30a4\u30f3\u5909\u66f4+\u30dd\u30fc\u30c8\u89e3\u653e(\u516c\u958b\u30b5\u30fc\u30d0\u30fc\u306e\u307f)\n#sed -i -e '3s/localhost/[\u30c9\u30e1\u30a4\u30f3\u540d]/' /etc/nginx/conf.d/default.conf\n\niptables -I INPUT 5 -m state --state NEW -p tcp --dport 80 -j ACCEPT\nservice iptables save\nservice iptables restart\n\nchkconfig nginx on\n\n```\n\n###hhvm\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08hop5\uff09\n```hhvm:hhvm\nrpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\ncd /etc/yum.repos.d/\nwget http://www.hop5.in/yum/el6/hop5.repo\n\n#\u2193remove\u3057\u3066\u308b\u306e\u3067\u4f9d\u5b58\u95a2\u4fc2\u306f\u614e\u91cd\u306b\nyum -y remove boost-filesystem-1.41.0-18.el6.x86_64\nyum -y install hhvm\nwget http://pkgrepo.linuxtech.net/el6/release/x86_64/liblcms2-2.4-1.el6.x86_64.rpm\nyum -y install liblcms2-2.4-1.el6.x86_64.rpm\n\n#\u2193nginx\u306e\u30b3\u30f3\u30d5\u30a3\u30b0\u306bfastcgi\u306e\u9805\u76ee\u3092\u8ffd\u52a0\nsed -i -e \"38i location \\~ \\\\.php$ {\\nfastcgi_pass   127.0.0.1:9000;\\nfastcgi_index  index.php;\\nfastcgi_param  SCRIPT_FILENAME  \\$document_root\\$fastcgi_script_name;\\ninclude        fastcgi_params;\\n}\"  /etc/nginx/conf.d/default.conf\n\n#logfile\u306b\u66f8\u304d\u8fbc\u3080\u8a2d\u5b9a\nsed -i -e \"5i UseLogFile = true\\nFile = /var/log/hhvm/error.log\"  /etc/hhvm/config.hdf \n\n#\u2193\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\u6642\u306bhhvm\u8d77\u52d5\nsed -i -e '$ahhvm --mode daemon -vServer.Type=fastcgi -vServer.Port=9000' /etc/rc.d/rc.local \n\nhhvm --mode daemon -vServer.Type=fastcgi -vServer.Port=9000\n```\n\n###mysql\uff085.5\uff09\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```mysql:mysql\nrpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nyum install -y perl-DBD-MySQL libaio libaio-devel openssl-devel\nyum --enablerepo=remi --disablerepo=updates,base install -y mysql mysql-server mysql-devel\n\n#\u30ed\u30b0\u95a2\u9023(\u4eba\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u3001\u305d\u306e\u90fd\u5ea6\u5909\u3048\u308b\u3053\u3068)\nsed -i -e \"4i log-warnings=1\" -e \"4i slow-query-log=myerrorslow.log\" -e \"4i long-query-time=30\" -e \"4i log-queries-not-using-indexes\" -e \"4i log-slow-admin-statements\" -e \"4i log-bin=mysql-trans-log\" -e \"4i log-bin-index=mybin.index\" -e \"4i max-binlog-size=1G\" -e \"4i expire-logs-days=30\" -e \"4i binlog-do-db=ui\"  /etc/my.cnf\n#\u305d\u306e\u4ed6(\u4eba\u305d\u308c\u305e\u308c\u306a\u306e\u3067\u3001\u305d\u306e\u90fd\u5ea6\u5909\u3048\u308b\u3053\u3068)\nsed -i -e \"4i character-set-server = utf8\" -e \"4i collation-server = utf8_general_ci\" -e \"4i port = 3306\"  -e \"4i query_cache_size = 16M\" -e \"4i thread_cache_size = 4\" -e \"4i query_cache_limit = 16M\" -e \"4i tmp_table_size = 16M\" -e \"4i max_heap_table_size = 16M\" -e \"4i thread_cache_size = 4\" -e \"4i innodb_buffer_pool_size = 512M\"  -e \"4i innodb_log_file_size = 64M\"  -e \"4i open_files_limit = 1024\" -e \"4i max_connections = 100\" /etc/my.cnf\nsed -i -e '$a\\n\\[mysql\\]\\ndefault-character-set = utf8\\n\\n\\[client\\]\\nport = 3306\\n\\n\\[mysqldump\\]' /etc/my.cnf\n\nrm /var/lib/mysql/ib_logfile0\nrm /var/lib/mysql/ib_logfile1\n\n#\u2193\u30d1\u30b9\u30ef\u30fc\u30c9\u521d\u671f\u8a2d\u5b9a\u3068\u304b\n#mysql_secure_installation\n\nchkconfig mysqld \n\n```\n\n###laravel(4.2)+(Sentry2.1)\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```laravel:laravel\n\n#\u2193\u4f9d\u5b58\u95a2\u4fc2\uff0bcomposer\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install php php-mcrypt php-mbstring libmcrypt libmcrypt-devel libxml2 libxml2-devel openssl openssl-devel httpd httpd-devel\ncurl -sS https://getcomposer.org/installer | php -- --install-dir=/bin\n\n#\u2193php5.4\u4ee5\u4e0a\u304c\u5fc5\u8981\u306a\u306e\u3067php\u518d\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum remove php*\nrpm -ivh  http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/5/x86_64/epel-release-5-4.noarch.rpm\nyum install --enablerepo=remi --enablerepo=remi-php55 php php-devel php-mbstring php-mcrypt php-mysql php-phpunit-PHPUnit php-pecl-xdebug php-cli\n\n#\u2193laravel\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\ncd /var/www/html\ncomposer.phar create-project laravel/laravel laravel\n\ncd laravel\nchmod 777 -R app/storage/\n\n#\u2193/laravel/app/config/app.php\u3092\u5909\u66f4\uff08\uff09\nsed -i -e '42s/UTC/Asia\\/Tokyo/' /var/www/html/laravel/app/config/app.php\nsed -i -e '55s/en/ja/' /var/www/html/laravel/app/config/app.php\n#\u2193\u516c\u958b\u30b5\u30fc\u30d0\u30fc\u306e\u307f\n#sed -i -e '29s/localhost/[\u30c9\u30e1\u30a4\u30f3]/' /var/www/html/laravel/app/config/app.php\n\n#\u2193/laravel/app/config/database.php\u3092\u5909\u66f4\uff08mysql\u3067\u8a2d\u5b9a\u3057\u305fuser\u306a\u3069\uff09\n#sed -i -e '58s/forge/[db]/' /var/www/html/laravel/app/config/database.php\n#sed -i -e '59s/forge/[user]/' /var/www/html/laravel/app/config/database.php\n#sed -i -e '60s/\\'\\'/[pass]/' /var/www/html/laravel/app/config/database.php\n\n#\u2193sentry\u306e\u8a18\u8ff0\u3092\u8ffd\u52a0\u3092\u5909\u66f4\nsed -i -e '7s/$/,/g' /var/www/html/laravel/composer.json\nsed -i -e \"8i \\\"cartalyst/sentry\\\": \\\"2.0.*\\\"\" /var/www/html/laravel/composer.json\n\ncd /var/www/html/laravel/\ncomposer.phar update\n\nsed -i -e \"124i \\'Cartalyst\\\\\\Sentry\\\\\\SentryServiceProvider\\',\" /var/www/html/laravel/app/config/app.php\nsed -i -e \"192i \\'Sentry\\'          => \\'Cartalyst\\\\\\Sentry\\\\\\Facades\\\\\\Laravel\\\\\\Sentry\\',\" /var/www/html/laravel/app/config/app.php\n\n\n```\n\n"}