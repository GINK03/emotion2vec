{"context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\n\n\u3081\u3063\u3055\u91cd\u3044\u51e6\u7406\u3092Rails \u3067\u66f8\u3044\u305f\u3089\u3081\u3063\u3055\u6012\u3089\u308c\u305f\n\n\u3081\u3063\u3055\u91cd\u3044\u51e6\u7406 \u3063\u3066\u611f\u899a\u7684\u306b\u306f\u5206\u304b\u308b\u3051\u3069\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u7b49\u304b\u3089\u3061\u3083\u3093\u3068 \u3081\u3063\u3055\u91cd\u3044\u51e6\u7406 \u3068\u306f\u306a\u3093\u306a\u306e\u304b\u3092\u5b9a\u7fa9\u3057\u305f\u3044\n\u3042\u308f\u3088\u304f\u3070Rails \u306b\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3044\n\n\n\u74b0\u5883\nRails 4.2\nNginx 1.6.2\nunicorn 4.8.3\n\n\u8a2d\u5b9a\n\nunicorn.rb\n\n\u301c\u7565\u301c\nnum_unicorn_workers = ENV['UNICORN_WORKERS'].to_i\nworker_processes((num_unicorn_workers > 0 ? num_unicorn_workers : nil) || (ENV['RAILS_ENV'] == 'production' ? 4 : 2))\ntimeout           30\n\u301c\u7565\u301c\n\n\n/etc/nignx/conf.d/gessy0129.conf\n\n\u301c\u7565\u301c\nproxy_connect_timeout 300; # unicorn \u63a5\u7d9a\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_send_timeout    300; # unicorn \u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_read_timeout    300; # unicorn \u304b\u3089\u306e\u5fdc\u7b54\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header Host $http_host;\nproxy_pass http://gessy0129;\n\u301c\u7565\u301c\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\nRails \u3067\u306e\u91cd\u3044\u51e6\u7406\u3092\u66f8\u304f\n\n502 Bad Gateway\n\n\nunicorn \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 > nginx \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\n\nproxy_read_timeout \u4ee5\u5916\u3092 3\u306b\u3059\u308b\n\n\n200 OK\n\n\nproxy_read_timeout \u3092 3\u306b\u3059\u308b\n\n\n504 Gateway Timeout\n\n\nunicorn \u3092\u843d\u3068\u3059\n\n\n502 Bad Gateway\n\n\n\n\nRails\u5074\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306a\u3089\u30fb\u30fb\n\nnignx.conf \u306eproxy_read_timeout \u306b\u8a2d\u5b9a\u3057\u305f\u79d2\u6570\u4ee5\u5185\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u305b\u308b\u304b\uff1f\nunicorn.rb \u306b\u8a2d\u5b9a\u3057\u305f\u79d2\u6570\u4ee5\u5185\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u305b\u308b\u304b\uff1f\n\n\n\u9069\u5f53\u306a\u30c6\u30b9\u30c8\u6982\u8981\n\nFile.exists\u3057\u3066\u3001\nFile\u8aad\u307f\u8fbc\u3093\u3067\u3001\ntimeout \u3068\u304bproxy_read_timeout \u306e\u5024\u3092\u53d6\u5f97\u3057\u3066\u3001\nrspec \u3067\u610f\u56f3\u7684\u306b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u8d77\u3053\u3057\u3001\n\u30a8\u30e9\u30fc\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u3059\u308b\n\n\n\u3053\u306e\u30c6\u30b9\u30c8\u306e\u61f8\u5ff5\n\nJenkins \u3067\u3069\u3046\u3084\u308b\u3093\u3060\u30fb\u30fb\n\u771f\u9762\u76ee\u306btimeout \u3092\u5f85\u3063\u3066\u3044\u305f\u3089\u305d\u306e\u90e8\u5206\u306e\u30c6\u30b9\u30c8\u304c\u3081\u3063\u3061\u3083\u9045\u304f\u306a\u3063\u3066\u52b9\u7387\u60aa\u304f\u306a\u308b\u306e\u3067\u9069\u5f53\u306b\u5024\u3092\u7de8\u96c6\u3057\u3066\u3042\u3052\u306a\u3044\u3068\n\n## \u76ee\u7684\n\n+ \u3081\u3063\u3055\u91cd\u3044\u51e6\u7406\u3092Rails \u3067\u66f8\u3044\u305f\u3089\u3081\u3063\u3055\u6012\u3089\u308c\u305f\n+ **\u3081\u3063\u3055\u91cd\u3044\u51e6\u7406** \u3063\u3066\u611f\u899a\u7684\u306b\u306f\u5206\u304b\u308b\u3051\u3069\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\u7b49\u304b\u3089\u3061\u3083\u3093\u3068 **\u3081\u3063\u3055\u91cd\u3044\u51e6\u7406** \u3068\u306f\u306a\u3093\u306a\u306e\u304b\u3092\u5b9a\u7fa9\u3057\u305f\u3044\n+ \u3042\u308f\u3088\u304f\u3070Rails \u306b\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3044\n\n## \u74b0\u5883\n\nRails 4.2\nNginx 1.6.2\nunicorn 4.8.3\n\n## \u8a2d\u5b9a\n\n+ unicorn.rb\n \n```\n\u301c\u7565\u301c\nnum_unicorn_workers = ENV['UNICORN_WORKERS'].to_i\nworker_processes((num_unicorn_workers > 0 ? num_unicorn_workers : nil) || (ENV['RAILS_ENV'] == 'production' ? 4 : 2))\ntimeout           30\n\u301c\u7565\u301c\n```\n\n+ /etc/nignx/conf.d/gessy0129.conf\n\n```\n\u301c\u7565\u301c\nproxy_connect_timeout 300; # unicorn \u63a5\u7d9a\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_send_timeout    300; # unicorn \u3078\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u9001\u4fe1\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_read_timeout    300; # unicorn \u304b\u3089\u306e\u5fdc\u7b54\u3092\u5f85\u3064\u3053\u3068\u304c\u51fa\u6765\u308b\u6642\u9593\nproxy_set_header X-Real-IP $remote_addr;\nproxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\nproxy_set_header Host $http_host;\nproxy_pass http://gessy0129;\n\u301c\u7565\u301c\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n### Rails \u3067\u306e\u91cd\u3044\u51e6\u7406\u3092\u66f8\u304f\n\n+ 502 Bad Gateway\n\n### unicorn \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 > nginx \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8 \n\n+ proxy_read_timeout \u4ee5\u5916\u3092 3\u306b\u3059\u308b\n    + 200 OK\n+ proxy_read_timeout \u3092 3\u306b\u3059\u308b\n    + 504 Gateway Timeout\n+ unicorn \u3092\u843d\u3068\u3059\n    + 502 Bad Gateway\n\n## Rails\u5074\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306a\u3089\u30fb\u30fb\n\n+ nignx.conf \u306eproxy_read_timeout \u306b\u8a2d\u5b9a\u3057\u305f\u79d2\u6570\u4ee5\u5185\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u305b\u308b\u304b\uff1f\n+ unicorn.rb \u306b\u8a2d\u5b9a\u3057\u305f\u79d2\u6570\u4ee5\u5185\u306b\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u305b\u308b\u304b\uff1f\n\n### \u9069\u5f53\u306a\u30c6\u30b9\u30c8\u6982\u8981\n\n1. File.exists\u3057\u3066\u3001\n2. File\u8aad\u307f\u8fbc\u3093\u3067\u3001\n3. timeout \u3068\u304bproxy_read_timeout \u306e\u5024\u3092\u53d6\u5f97\u3057\u3066\u3001\n4. rspec \u3067\u610f\u56f3\u7684\u306b\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u8d77\u3053\u3057\u3001\n5. \u30a8\u30e9\u30fc\u30da\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3092\u78ba\u8a8d\u3059\u308b\n\n### \u3053\u306e\u30c6\u30b9\u30c8\u306e\u61f8\u5ff5\n\n+ Jenkins \u3067\u3069\u3046\u3084\u308b\u3093\u3060\u30fb\u30fb\n+ \u771f\u9762\u76ee\u306btimeout \u3092\u5f85\u3063\u3066\u3044\u305f\u3089\u305d\u306e\u90e8\u5206\u306e\u30c6\u30b9\u30c8\u304c\u3081\u3063\u3061\u3083\u9045\u304f\u306a\u3063\u3066\u52b9\u7387\u60aa\u304f\u306a\u308b\u306e\u3067\u9069\u5f53\u306b\u5024\u3092\u7de8\u96c6\u3057\u3066\u3042\u3052\u306a\u3044\u3068\n", "tags": ["Rails4", "nginx", "unicorn", "RSpec"]}