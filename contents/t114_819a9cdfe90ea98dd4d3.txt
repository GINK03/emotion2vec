{"context": "FeliCa\u306eIDm\u8aad\u307f\u53d6\u308a\u306b\u5f53\u521d\u306fnfcpy\u306e\u4f7f\u7528\u3092\u8003\u3048\u3066\u3044\u305f\u304c\u3001\u624b\u6301\u3061\u306epasori RC-S320\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u5224\u660e\u3057\u305f\u305f\u3081\u3001\u4ee3\u308f\u308a\u306blibpafe\u3092\u4f7f\u7528\u3057\u305f\u3002\n2016/10/16\u8ffd\u8a18\uff1a\npasori RC-S380\u3067IDm\u3092\u8aad\u307f\u8fbc\u307f\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\n\n\u74b0\u5883\n\u30cf\u30fc\u30c9\uff1araspberrypi3\nOS\uff1araspbian\n\u30ea\u30fc\u30c0\uff1apasori RC-S320\n\n\u6e96\u5099\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n\n$ mkdir pasori\n$ cd pasori\n\n\nraspberrypi3\u306eUSB\u306bpasori\u3092\u63a5\u7d9a\u3059\u308b\u3002\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n$ lsusb\nBus 001 Device 004: ID 054c:01bb Sony Corp. FeliCa S320 [PaSoRi]\nBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter\nBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n\n\nlibusb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo apt-get install libusb-dev\n\n\nlibpafe\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u30b3\u30f3\u30d1\u30a4\u30eb\n\n$ git clone https://github.com/rfujita/libpafe.git \n$ cd libpafe\n$ ./configure\n$ make\n$ sudo make install\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d50\u679c\u78ba\u8a8d\nlibpafe.so.0.0.8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n$ cd /usr/local/lib\n$ ls\nlibpafe.a   libpafe.so    libpafe.so.0.0.8  python2.7  site_ruby\nlibpafe.la  libpafe.so.0  pypy2.7           python3.4\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n$ cd ~/pasori/libpafe-0.0.8\n$ sudo ./tests/pasori_test\nPaSoRi (RC-S320)\n firmware version 1.40\nEcho test... success\nEPROM test... success\nRAM test... success\nCPU test... success\nPolling test... success\n\n\nudev\u306e\u8a2d\u5b9a\n\n60-libpafe.rules\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\n\n$ sudo nano /lib/udev/rules.d/60-libpafe.rules\n\n\n60-libpafe.rules\u7de8\u96c6\u5185\u5bb9\n\n\n60-libpafe.rules\nACTION!=\"add\", GOTO=\"pasori_rules_end\"\nSUBSYSTEM==\"usb_device\", GOTO=\"pasori_rules_start\"\nSUBSYSTEM!=\"usb\", GOTO=\"pasori_rules_end\"\nLABEL=\"pasori_rules_start\"\n\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"006c\", MODE=\"0664\", GROUP=\"plugdev\"\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"01bb\", MODE=\"0664\", GROUP=\"plugdev\"\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"02e1\", MODE=\"0664\", GROUP=\"plugdev\"\n\nLABEL=\"pasori_rules_end\"\n\n\n$ udevadm control --reload-rules\nroot privileges required\n$ sudo udevadm control --reload-rules\n$ reboot\n\n\nreboot\u5f8csudo\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n$ ./pasori/libpafe-0.0.8/tests/pasori_test\n\n\nFeliCa\u306eIDm\u3092\u8aad\u3080Python\u30b9\u30af\u30ea\u30d7\u30c8\n\u30b5\u30f3\u30d7\u30eb\u306f\u3053\u3061\u3089\u304b\u3089\u5f15\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u3002\n\u5f15\u7528\u5143\u306e\u307e\u307e\u3060\u3068IDm\u304c\u4e0b\uff14\u6841\u3057\u304b\u8868\u793a\u3055\u308c\u306a\u3044\u305f\u3081\uff11\uff16\u6841\u8868\u793a\u3055\u305b\u308b\u305f\u3081\u4e00\u90e8\u624b\u3092\u5165\u308c\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u3002\n# -*- coding: utf-8 -*-\n\nfrom __future__ import print_function\nfrom ctypes import *\n\n# libpafe.h\u306e77\u884c\u76ee\u3067\u5b9a\u7fa9\nFELICA_POLLING_ANY = 0xffff\n\nif __name__ == '__main__':\n\n    libpafe = cdll.LoadLibrary(\"/usr/local/lib/libpafe.so\")\n\n    libpafe.pasori_open.restype = c_void_p\n    pasori = libpafe.pasori_open()\n\n    libpafe.pasori_init(pasori)\n\n    libpafe.felica_polling.restype = c_void_p\n    felica = libpafe.felica_polling(pasori, FELICA_POLLING_ANY, 0, 0)\n\n    idm = c_ulonglong() #\u219016\u6841\u53d7\u3051\u3068\u308b\u305f\u3081\u306b\u5909\u66f4\n    libpafe.felica_get_idm.restype = c_void_p\n    libpafe.felica_get_idm(felica, byref(idm))\n\n    # IDm\u306f16\u9032\u8868\u8a18\n    print(\"%016X\" % idm.value) #\u219016\u6841\u8868\u793a\u3055\u305b\u308b\u305f\u3081\u306b\u5909\u66f4\n\n    # README\u3088\u308a\u3001felica_polling()\u4f7f\u7528\u5f8c\u306ffree()\u3092\u4f7f\u3046\n    # \u306a\u304a\u3001free\u306f\u81ea\u52d5\u7684\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u5165\u3063\u3066\u3044\u308b\u3082\u3088\u3046\n    libpafe.free(felica)\n\n    libpafe.pasori_close(pasori)\n\n\n\u53c2\u8003\nRaspberry Pi + libpafe + Python + ctypes\u3067\u3001FeliCa\u306eIDm\u3092\u8aad\u3080\nFeliCa\u306eIDm\u8aad\u307f\u53d6\u308a\u306b\u5f53\u521d\u306fnfcpy\u306e\u4f7f\u7528\u3092\u8003\u3048\u3066\u3044\u305f\u304c\u3001\u624b\u6301\u3061\u306epasori RC-S320\u3067\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u5224\u660e\u3057\u305f\u305f\u3081\u3001\u4ee3\u308f\u308a\u306blibpafe\u3092\u4f7f\u7528\u3057\u305f\u3002\n\n2016/10/16\u8ffd\u8a18\uff1a\npasori RC-S380\u3067IDm\u3092\u8aad\u307f\u8fbc\u307f\u305f\u3044\u5834\u5408\u306f[\u3053\u3061\u3089](http://qiita.com/t114/items/f735b900ad8a8c52597e)\n\n# \u74b0\u5883\n\u30cf\u30fc\u30c9\uff1araspberrypi3\nOS\uff1araspbian\n\u30ea\u30fc\u30c0\uff1apasori RC-S320\n\n# \u6e96\u5099\n  - \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n\n```\n$ mkdir pasori\n$ cd pasori\n```\n\n  - raspberrypi3\u306eUSB\u306bpasori\u3092\u63a5\u7d9a\u3059\u308b\u3002\n  - \u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u8a8d\u8b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ lsusb\nBus 001 Device 004: ID 054c:01bb Sony Corp. FeliCa S320 [PaSoRi]\nBus 001 Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter\nBus 001 Device 002: ID 0424:9514 Standard Microsystems Corp.\nBus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub\n```\n\n  - libusb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo apt-get install libusb-dev\n```\n\n# libpafe\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n  - \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068\u30b3\u30f3\u30d1\u30a4\u30eb\n\n```\n$ git clone https://github.com/rfujita/libpafe.git \n$ cd libpafe\n$ ./configure\n$ make\n$ sudo make install\n```\n\n  - \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d50\u679c\u78ba\u8a8d  \n    libpafe.so.0.0.8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ cd /usr/local/lib\n$ ls\nlibpafe.a   libpafe.so    libpafe.so.0.0.8  python2.7  site_ruby\nlibpafe.la  libpafe.so.0  pypy2.7           python3.4\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n```\n$ cd ~/pasori/libpafe-0.0.8\n$ sudo ./tests/pasori_test\nPaSoRi (RC-S320)\n firmware version 1.40\nEcho test... success\nEPROM test... success\nRAM test... success\nCPU test... success\nPolling test... success\n```\n\n# udev\u306e\u8a2d\u5b9a\n\n - 60-libpafe.rules\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\n\n```\n$ sudo nano /lib/udev/rules.d/60-libpafe.rules\n```\n\n  - 60-libpafe.rules\u7de8\u96c6\u5185\u5bb9\n\n```:60-libpafe.rules\nACTION!=\"add\", GOTO=\"pasori_rules_end\"\nSUBSYSTEM==\"usb_device\", GOTO=\"pasori_rules_start\"\nSUBSYSTEM!=\"usb\", GOTO=\"pasori_rules_end\"\nLABEL=\"pasori_rules_start\"\n\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"006c\", MODE=\"0664\", GROUP=\"plugdev\"\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"01bb\", MODE=\"0664\", GROUP=\"plugdev\"\nATTRS{idVendor}==\"054c\", ATTRS{idProduct}==\"02e1\", MODE=\"0664\", GROUP=\"plugdev\"\n\nLABEL=\"pasori_rules_end\"\n```\n\n```\n$ udevadm control --reload-rules\nroot privileges required\n$ sudo udevadm control --reload-rules\n$ reboot\n```\n  - reboot\u5f8csudo\u306a\u3057\u3067\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```\n$ ./pasori/libpafe-0.0.8/tests/pasori_test\n```\n\n\n# FeliCa\u306eIDm\u3092\u8aad\u3080Python\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u30b5\u30f3\u30d7\u30eb\u306f[\u3053\u3061\u3089](http://thinkami.hatenablog.com/entry/2015/06/16/212600)\u304b\u3089\u5f15\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u3002\n\u5f15\u7528\u5143\u306e\u307e\u307e\u3060\u3068IDm\u304c\u4e0b\uff14\u6841\u3057\u304b\u8868\u793a\u3055\u308c\u306a\u3044\u305f\u3081\uff11\uff16\u6841\u8868\u793a\u3055\u305b\u308b\u305f\u3081\u4e00\u90e8\u624b\u3092\u5165\u308c\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u3002\n\n```py\n# -*- coding: utf-8 -*-\n\nfrom __future__ import print_function\nfrom ctypes import *\n\n# libpafe.h\u306e77\u884c\u76ee\u3067\u5b9a\u7fa9\nFELICA_POLLING_ANY = 0xffff\n\nif __name__ == '__main__':\n\n    libpafe = cdll.LoadLibrary(\"/usr/local/lib/libpafe.so\")\n\n    libpafe.pasori_open.restype = c_void_p\n    pasori = libpafe.pasori_open()\n    \n    libpafe.pasori_init(pasori)\n\n    libpafe.felica_polling.restype = c_void_p\n    felica = libpafe.felica_polling(pasori, FELICA_POLLING_ANY, 0, 0)\n\n    idm = c_ulonglong() #\u219016\u6841\u53d7\u3051\u3068\u308b\u305f\u3081\u306b\u5909\u66f4\n    libpafe.felica_get_idm.restype = c_void_p\n    libpafe.felica_get_idm(felica, byref(idm))\n\n    # IDm\u306f16\u9032\u8868\u8a18\n    print(\"%016X\" % idm.value) #\u219016\u6841\u8868\u793a\u3055\u305b\u308b\u305f\u3081\u306b\u5909\u66f4\n\n    # README\u3088\u308a\u3001felica_polling()\u4f7f\u7528\u5f8c\u306ffree()\u3092\u4f7f\u3046\n    # \u306a\u304a\u3001free\u306f\u81ea\u52d5\u7684\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u5165\u3063\u3066\u3044\u308b\u3082\u3088\u3046\n    libpafe.free(felica)\n\n    libpafe.pasori_close(pasori)\n```\n\n\n\n# \u53c2\u8003\n[Raspberry Pi + libpafe + Python + ctypes\u3067\u3001FeliCa\u306eIDm\u3092\u8aad\u3080](http://thinkami.hatenablog.com/entry/2015/06/16/212600)\n\n", "tags": ["RaspberryPi", "raspbian", "FeliCa", "libpafe", "Python"]}