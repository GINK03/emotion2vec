{"context": "\n\n\u524d\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(3) Web\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\n\nMariaDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\u4eca\u56de\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306fMariaDB\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nMariaDB\u3068\u306f\u3001MySQL\u306e\u30aa\u30ea\u30b8\u30ca\u30eb\u30b3\u30fc\u30c9\u4f5c\u8005\u3067\u3042\u308bMichael \"Monty\" Widenius\u6c0f\u304c\u7acb\u3061\u4e0a\u3052\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u3066\u3044\u308bMySQL\u3068\u4e92\u63db\u6027\u3092\u3082\u3064\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306a\u95a2\u4fc2\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0(RDBMS)\u3067\u3059\u3002\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u624b\u52d5\u3067yum\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nrpm --import https://yum.mariadb.org/RPM-GPG-KEY-MariaDB && \\\nvi /etc/yum.repos.d/mariadb.repo\n\n\n/etc/yum.repos.d/mariadb.repo\n+ [mariadb]\n+ name = MariaDB\n+ baseurl = http://yum.mariadb.org/10.1.6/centos6-amd64\n+ enabled=0\n+ gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\n+ gpgcheck=1\n\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u8ffd\u52a0\u3067\u304d\u305f\u3089\u3001yum\u30b3\u30de\u30f3\u30c9\u3067MariaDB\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nyum install --enablerepo=mariadb MariaDB-devel MariaDB-client MariaDB-server\n\n\nMariaDB\u306e\u521d\u671f\u8a2d\u5b9a\nMariaDB\u3092\u4e00\u65e6\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nservice mysql start\n\n\n\u5b9f\u884c\u7d50\u679c\nStarting MySQL. SUCCESS!\n\n\nMariaDB\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nmysql_secure_installation\n\n\n\u5b9f\u884c\u7d50\u679c\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\n      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user.  If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\n\nEnter current password for root (enter for none): <- \u7a7aEnter\nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\n\nSet root password? [Y/n] <- \u7a7aEnter\nNew password: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\nRe-enter new password: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\nPassword updated successfully!\nReloading privilege tables..\n ... Success!\n\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem.  This is intended only for testing, and to make the installation\ngo a bit smoother.  You should remove them before moving into a\nproduction environment.\n\nRemove anonymous users? [Y/n] <- \u7a7aEnter\n ... Success!\n\nNormally, root should only be allowed to connect from 'localhost'.  This\nensures that someone cannot guess at the root password from the network.\n\nDisallow root login remotely? [Y/n] <- \u7a7aEnter\n ... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess.  This is also intended only for testing, and should be removed\nbefore moving into a production environment.\n\nRemove test database and access to it? [Y/n] <- \u7a7aEnter\n - Dropping test database...\n ... Success!\n - Removing privileges on test database...\n ... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\n\nReload privilege tables now? [Y/n] <- \u7a7aEnter\n ... Success!\n\nCleaning up...\n\nAll done!  If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\n\nThanks for using MariaDB!\n\n\nMariaDB\u3092\u4e00\u65e6\u505c\u6b62\u3057\u307e\u3059\u3002\n\nservice mysql stop\n\n\n\u5b9f\u884c\u7d50\u679c\nShutting down MySQL... SUCCESS! \n\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\u3068\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n\u4e2d\u898f\u6a21\u306e\u30d9\u30fc\u30b9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30ebmy-medium.cnf\u3092my.cnf\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\ncp /usr/share/mysql/my-medium.cnf /etc/my.cnf.d/my.cnf\n\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306eserver.cnf\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3001\u65b0\u898f\u3067server.cnf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nmv /etc/my.cnf.d/server.cnf /etc/my.cnf.d/server.cnf.orig && \\\nvi /etc/my.cnf.d/server.cnf\n\n\n/etc/my.cnf.d/server.cnf\n+ [mysqld]\n+ datadir=/var/lib/mysql\n+ character-set-server=utf8\n+ symbolic-links=0\n+ innodb_buffer_pool_size=64M\n+ innodb_log_file_size=16M\n+ innodb_flush_method=O_DIRECT\n+ query_cache_size=128M\n+ query_cache_limit=2M\n+ query_cache_min_res_unit=4k\n+ query_cache_type=1\n+ tmp_table_size=128M\n+ max_heap_table_size=128M\n+ table_open_cache=1024\n+ max_allowed_packet=1M\n+ sort_buffer=256K\n+ read_buffer_size=256K\n+ read_rnd_buffer_size=256K\n+ join_buffer_size=256K\n+ key_buffer_size=16M\n+ max_connections=256\n+ thread_cache=256\n+ wait_timeout=60\n+ plugin-load = handlersocket.so\n\n\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089MariaDB\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nservice mysql start\n\nMariaDB\u304c\u8d77\u52d5\u3057\u305f\u3089\u3001MySQL Tuner\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3092\u3057\u307e\u3059\u3002\nmysqltuner.pl\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u5b9f\u884c\u3057\u307e\u3059\u3002\nROOT_PASSWORD\u306f\u3001\u521d\u671f\u8a2d\u5b9a\u3067\u8a2d\u5b9a\u3057\u305froot\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ncd ~/ && \\\nwget https://raw.github.com/rackerhacker/MySQLTuner-perl/master/mysqltuner.pl && \\\nchmod +x mysqltuner.pl && \\\n./mysqltuner.pl -user root -pass ROOT_PASSWORD\n\n\nPHP\u306e\u30d3\u30eb\u30c9\u3068\u8a2d\u5b9a\nPHP\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u3059\u3050\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3001phpenv\u3067\u7ba1\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u307e\u305fphpenv\u3092\u4f7f\u3046\u306b\u3042\u305f\u3063\u3066\u3001\u4ed6\u306e\\*env\u7cfb\u3068\u30d0\u30c3\u30c6\u30a3\u30f3\u30b0\u3057\u306a\u3044\u3088\u3046anyenv\u3092\u901a\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nanyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGitHub\u304b\u3089\u30af\u30ed\u30fc\u30f3\u3057\u3066\u304d\u307e\u3059\u3002\n\ngit clone https://github.com/riywo/anyenv ~/.anyenv\n\n\n\u5b9f\u884c\u7d50\u679c\nInitialized empty Git repository in /root/.anyenv/.git/\nremote: Counting objects: 172, done.\nremote: Total 172 (delta 0), reused 0 (delta 0), pack-reused 172\nReceiving objects: 100% (172/172), 26.63 KiB, done.\nResolving deltas: 100% (57/57), done.\n\n\nanyenv\u306ePATH\u3092\u901a\u3057\u307e\u3059\u3002\n\nvi ~/.bashrc\n\n\n~/.bashrc\n+ # anyenv\n+ if [ -d ~/.anyenv ]; then\n+     export PATH=$PATH:$HOME/.anyenv/bin\n+     eval \"$(anyenv init -)\"\n+ fi\n\n\n\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092source\u30b3\u30de\u30f3\u30c9\u3067\u4e00\u5ea6\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nsource ~/.bashrc\n\n\nphpenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nanyenv\u306ePATH\u304c\u901a\u3063\u305f\u3089\u3001anyenv\u304b\u3089phpenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nanyenv\u304b\u3089phpenv\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3001PHP\u306e\u30d3\u30eb\u30c9\u7528\u30d7\u30e9\u30b0\u30a4\u30f3php-build\u304c\u81ea\u52d5\u7684\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\nanyenv install phpenv\n\n\n\u5b9f\u884c\u7d50\u679c\n/tmp/phpenv.20150831090000.1979 ~\nCloning https://github.com/laprasdrum/phpenv.git...\nInitialized empty Git repository in /tmp/phpenv.20150831090000.1979/phpenv/.git/\nremote: Counting objects: 92, done.\nremote: Compressing objects: 100% (61/61), done.\nremote: Total 92 (delta 27), reused 92 (delta 27), pack-reused 0\nUnpacking objects: 100% (92/92), done.\n~\n~/.anyenv/envs/phpenv/plugins ~\nCloning https://github.com/CHH/php-build.git...\nInitialized empty Git repository in /root/.anyenv/envs/phpenv/plugins/php-build/.git/\nremote: Counting objects: 3417, done.\nremote: Total 3417 (delta 0), reused 0 (delta 0), pack-reused 3417\nReceiving objects: 100% (3417/3417), 500.39 KiB | 267 KiB/s, done.\nResolving deltas: 100% (2012/2012), done.\n~\n\nInstall phpenv succeeded!\nPlease reload your profile (exec $SHELL -l) or open a new session.\n\n\nphpenv\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u901a\u308a\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nexec $SHELL -l\n\nphpenv\u304c\u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\nphpenv: command not found\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\nanyenv version\n\n\n\u5b9f\u884c\u7d50\u679c\nphpenv: system (set by /root/.anyenv/envs/phpenv/version)\n\n\n\nPHP\u306e\u30d3\u30eb\u30c9\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nPHP\u306e\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nyum --enablerepo=epel install re2c libmcrypt libmcrypt-devel && \\\nyum install libxml2-devel bison bison-devel openssl-devel curl-devel libjpeg-devel libpng-devel libmcrypt-devel readline-devel libtidy-devel libxslt-devel enchant-devel libXpm libXpm-devel freetype-devel t1lib t1lib-devel gmp-devel libc-client-devel libicu-devel oniguruma-devel net-snmp net-snmp-devel bzip2-devel\n\n\nImageMagick\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n2016\u5e745\u67083\u65e5\u9803\u516c\u958b\u3055\u308c\u305fImageMagick\u306e\u8106\u5f31\u6027(CVE-2016-3714\u4ed6)\u306e\u5bfe\u5fdc\u3068\u3057\u3066\u3001\u6700\u65b0\u7248\u306eImageMagick\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nrpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\nyum install --enablerepo=remi,epel ImageMagick-last ImageMagick-last-devel ImageMagick-last-libs\n\n\n\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5909\u66f4\n\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u3092default_configure_options\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\nPECL\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001--without-pear\u3092--with-pear\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u5404\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u8272\u3005\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nvi ~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n\n\n~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n- --without-pear\n+ --with-pear\n:\n+ --with-apxs2=/usr/bin/apxs\n+ --enable-fileinfo\n+ --enable-hash\n+ --enable-json\n+ --enable-sysvmsg\n+ --with-bz2\n+ --enable-ctype\n+ --with-iconv\n+ --enable-ftp\n+ --with-gettext\n+ --enable-mbstring\n+ --with-onig=/usr\n+ --with-pcre-regex\n+ --with-mysql-sock=/var/lib/mysql/mysql.sock\n+ --enable-phar\n+ --enable-shmop\n+ --enable-sockets\n+ --enable-simplexml\n+ --enable-dom\n+ --with-libxml-dir=/usr\n+ --enable-tokenizer\n+ --with-kerberos=/usr\n+ --with-openssl=/usr\n+ --enable-zip\n+ --with-mhash=yes\n+ --without-mm\n+ --with-enchant=/usr\n+ --enable-gd-native-ttf\n+ --with-gmp=/usr\n+ --with-xpm-dir=/usr/X11R6\n+ --with-freetype-dir=/usr\n+ --with-imap=/usr\n+ --with-imap-ssl\n+ --enable-intl\n+ --with-t1lib=/usr\n+ --with-snmp=/usr\n\n\n\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u306fphpenv install\u6642\u306bCONFIGURE_OPTS\u3067\u305d\u306e\u5834\u9650\u308a\u306e\u8ffd\u52a0\u6307\u5b9a\u3092\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u5b9f\u884c\u4f8b\nCONFIGURE_OPTS=\"--with-pear --disable-fpm --with-apxs2=/usr/bin/apxs\" phpenv install 5.x.x\n\n\n\u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u306e\u78ba\u8a8d\n\u73fe\u5728\u306ephp-build\u3067\u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u4e00\u89a7\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\nphpenv install -l\n\n\n\u5b9f\u884c\u7d50\u679c\nAvailable versions:\n  5.2.17\n  5.3.2\n  5.3.3\n  : (\u7701\u7565)\n  7.0.5\n  7.0snapshot\n  master\n\n\n\n\u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u3092\u66f4\u65b0\nphp-build\u306e\u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\ncd ~/.anyenv/envs/phpenv/plugins/php-build/ && \\\ngit pull\n\n\nPHP\u306e\u30d3\u30eb\u30c9\nPHP\u306e\u30d3\u30eb\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u57f7\u7b46\u5f53\u6642\u306e5.6\u306e\u6700\u65b0\u72485.6.20\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nphpenv install 5.6.20\n\n\n\u5b9f\u884c\u7d50\u679c\n[Info]: Loaded extension plugin\n[Info]: Loaded apc Plugin.\n : (\u7701\u7565)\n[Success]: Built 5.6.20 successfully.\n\n\n\u30d3\u30eb\u30c9\u306e\u5b8c\u4e86\u5f8c\u3001\u751f\u6210\u3055\u308c\u305flibphp5.so\u306f\u5fc5\u305a\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3055\u305b\u307e\u3059\u3002\n\nmv /opt/rh/httpd24/root/usr/lib64/httpd/modules/libphp5.so ~/.anyenv/envs/phpenv/versions/5.6.20/libexec/libphp5.so\n\n\u79fb\u52d5\u3055\u305b\u306a\u3044\u3068\u3001\u30d3\u30eb\u30c9\u306e\u305f\u3073\u306blibphp5.so\u304c\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u4e0a\u66f8\u304d\u56de\u907f\u306e\u305f\u3081\u306b\u5fc5\u305a\u9000\u907f\u3057\u307e\u3059\u3002\n\u3053\u3046\u3059\u308b\u3053\u3068\u3067httpd.conf\u3067\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048\u3082\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n\nCLI\u5074\u306ePHP\u306e\u5207\u308a\u66ff\u3048\nPHP\u306e\u30d3\u30eb\u30c9\u6210\u529f\u5f8c\u3001CLI\u304c\u8aad\u307f\u8fbc\u3080PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\nphpenv global 5.6.20\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u5207\u308a\u66ff\u3048\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u5207\u308a\u66ff\u3048\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\nanyenv version && \\\nphp -v\n\n\n\u5b9f\u884c\u7d50\u679c\nphpenv: 5.6.20 (set by /root/.anyenv/envs/phpenv/version)\nPHP 5.6.20 (cli) (built: Sep  1 2015 09:00:00) \nCopyright (c) 1997-2015 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2015 Zend Technologies\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies\n    with Xdebug v2.3.3, Copyright (c) 2002-2015, by Derick Rethans\n\n\n\nApache\u5074\u306ePHP\u306e\u5207\u308a\u66ff\u3048\n\u3042\u308f\u305b\u3066\u3001Apache\u304c\u8aad\u307f\u8fbc\u3080PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\u3053\u3061\u3089\u306fCLI\u3068\u306f\u5225\u3067\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e0a\u306b\u3001CLI\u306e\u3088\u3046\u306b\u5207\u308a\u66ff\u3048\u30b3\u30de\u30f3\u30c9\u3082\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nvi /etc/httpd/conf/httpd.conf\n\nhttpd.conf\u306e\u4e0b\u8a18\u306e\u30b3\u30e1\u30f3\u30c8\u884c\u306e\u6b21\u306e\u884c\u8fba\u308a\u306b\u3001\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3073\u306b\u81ea\u52d5\u3067LoadModule php5_module\u306e\u8a18\u8ff0\u304c\u8ffd\u8a18\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\nLoadModule php5_module\u304c\u8907\u6570\u884c\u3042\u308b\u3068Apache\u518d\u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n2\u56de\u76ee\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u3092\u884c\u3046\u969b\u306f\u3001LoadModule php5_module\u306f1\u884c\u3060\u3051\u6b8b\u3059\u3053\u3068\u3092\u899a\u3048\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  # Example:\n  # LoadModule foo_module modules/mod_foo.so\n- LoadModule php5_module /root/.anyenv/envs/phpenv/versions/5.6.19/libexec/libphp5.so\n+ LoadModule php5_module /root/.anyenv/envs/phpenv/versions/5.6.20/libexec/libphp5.so\n  :\n\n\n\nPECL\u3067ImageMagick\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u8a73\u7d30\u306a\u753b\u50cf\u51e6\u7406\u3092\u884c\u3046ImageMagick\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\npecl install imagick\n\nPECL\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bextension\u306f\u3001\u73fe\u5728\u6307\u5b9a\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u304b\u5165\u3089\u306a\u3044\u305f\u3081\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u6bce\u306bpecl install\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\nPHP\u306e\u8a2d\u5b9a\nImageMagick\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30ebphp.ini\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\nvi ~/.anyenv/envs/phpenv/versions/5.6.20/etc/php.ini\n\n\n~/.anyenv/envs/phpenv/versions/5.6.20/etc/php.ini\n  :\n+ extension=imagick.so\n  :\n- ;date.timezone = \n+ date.timezone = Asia/Tokyo\n  :\n- post_max_size = 8M\n+ post_max_size = 100M\n  :\n- upload_max_filesize = 2M\n+ upload_max_filesize = 100M\n  :\n- ;mbstring.language = Japanese \n+ mbstring.language = Japanese\n  :\n- ;mbstring.internal_encoding = \n+ mbstring.internal_encoding = UTF-8\n  :\n- ;mbstring.detect_order = auto\n+ mbstring.detect_order = UTF-8,SJIS,EUC-JP,JIS,ASCII\n  :\n- pdo_mysql.default_socket=\n+ pdo_mysql.default_socket=/var/lib/mysql/mysql.sock\n  :\n- mysql.default_socket =\n+ mysql.default_socket = /var/lib/mysql/mysql.sock\n  :\n- mysqli.default_socket =\n+ mysqli.default_socket = /var/lib/mysql/mysql.sock\n  :\n\n\n\nPECL\u3067APCu\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u9ad8\u901f\u5316\u306e\u305f\u3081\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u30e1\u30e2\u30ea\u5185\u306bKVS(Key Value Store)\u5f62\u5f0f\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30c7\u30fc\u30bf\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd\u3092\u3082\u3064APCu\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\npecl install apcu\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001PHP\u30d3\u30eb\u30c9\u6642\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u308bPHP\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bfOPCache\u306e\u8a2d\u5b9a\u3082\u540c\u6642\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\nopcache.blacklist_filename\u306e\u30d1\u30b9\u306f\u30d3\u30eb\u30c9\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306e/etc/conf.d/\u5185\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(\u591a\u5206)\n\nvim ~/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/apc.ini\n\n\n~/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/apc.ini\n+ [opcache]\n+ opcache.enable = 1\n+ opcache.enable_cli = 1\n+ opcache.memory_consumption = 128\n+ opcache.interned_strings_buffer = 8\n+ opcache.max_accelerated_files = 4000\n+ opcache.blacklist_filename = /root/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/opcache*.blacklist\n+ [apcu]\n+ extension = apcu.so\n+ apc.enabled = 1\n+ apc.enable_cli = 1\n+ apc.shm_size = 64M\n+ apc.mmap_file_mask = /tmp/apc.XXXXXX\n\n\n\nApache\u306e\u518d\u8d77\u52d5\nPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u30fbextension\u306e\u8ffd\u52a0\u306a\u3069\u304c\u7d42\u308f\u3063\u305f\u3089\u3001Apache\u3092\u518d\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\nservice httpd24-httpd restart\n\n\n\u6b21\u56de\n\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(5) Let's Encrypt\u3067SSL+HTTP/2\u5bfe\u5fdc\n## \u524d\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(3) Web\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a](http://qiita.com/takahiko-takei/items/110a3da996e733e5a43c)\n\n\n## MariaDB\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n\u4eca\u56de\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f`MariaDB`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n`MariaDB`\u3068\u306f\u3001`MySQL`\u306e\u30aa\u30ea\u30b8\u30ca\u30eb\u30b3\u30fc\u30c9\u4f5c\u8005\u3067\u3042\u308bMichael \"Monty\" Widenius\u6c0f\u304c\u7acb\u3061\u4e0a\u3052\u305f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u3066\u3044\u308bMySQL\u3068\u4e92\u63db\u6027\u3092\u3082\u3064\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306a\u95a2\u4fc2\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0(RDBMS)\u3067\u3059\u3002\n\n\n### \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u624b\u52d5\u3067`yum`\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n> `rpm --import https://yum.mariadb.org/RPM-GPG-KEY-MariaDB && \\`\n> `vi /etc/yum.repos.d/mariadb.repo`\n\n```diff:/etc/yum.repos.d/mariadb.repo\n+ [mariadb]\n+ name = MariaDB\n+ baseurl = http://yum.mariadb.org/10.1.6/centos6-amd64\n+ enabled=0\n+ gpgkey=https://yum.mariadb.org/RPM-GPG-KEY-MariaDB\n+ gpgcheck=1\n```\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u8ffd\u52a0\u3067\u304d\u305f\u3089\u3001`yum`\u30b3\u30de\u30f3\u30c9\u3067`MariaDB`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `yum install --enablerepo=mariadb MariaDB-devel MariaDB-client MariaDB-server`\n\n\n### MariaDB\u306e\u521d\u671f\u8a2d\u5b9a\n\n`MariaDB`\u3092\u4e00\u65e6\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n> `service mysql start`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nStarting MySQL. SUCCESS!\n```\n\n`MariaDB`\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n> `mysql_secure_installation`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nNOTE: RUNNING ALL PARTS OF THIS SCRIPT IS RECOMMENDED FOR ALL MariaDB\n      SERVERS IN PRODUCTION USE!  PLEASE READ EACH STEP CAREFULLY!\n\nIn order to log into MariaDB to secure it, we'll need the current\npassword for the root user.  If you've just installed MariaDB, and\nyou haven't set the root password yet, the password will be blank,\nso you should just press enter here.\n\nEnter current password for root (enter for none): <- \u7a7aEnter\nOK, successfully used password, moving on...\n\nSetting the root password ensures that nobody can log into the MariaDB\nroot user without the proper authorisation.\n\nSet root password? [Y/n] <- \u7a7aEnter\nNew password: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\nRe-enter new password: <- \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u518d\u5165\u529b\nPassword updated successfully!\nReloading privilege tables..\n ... Success!\n\n\nBy default, a MariaDB installation has an anonymous user, allowing anyone\nto log into MariaDB without having to have a user account created for\nthem.  This is intended only for testing, and to make the installation\ngo a bit smoother.  You should remove them before moving into a\nproduction environment.\n\nRemove anonymous users? [Y/n] <- \u7a7aEnter\n ... Success!\n\nNormally, root should only be allowed to connect from 'localhost'.  This\nensures that someone cannot guess at the root password from the network.\n\nDisallow root login remotely? [Y/n] <- \u7a7aEnter\n ... Success!\n\nBy default, MariaDB comes with a database named 'test' that anyone can\naccess.  This is also intended only for testing, and should be removed\nbefore moving into a production environment.\n\nRemove test database and access to it? [Y/n] <- \u7a7aEnter\n - Dropping test database...\n ... Success!\n - Removing privileges on test database...\n ... Success!\n\nReloading the privilege tables will ensure that all changes made so far\nwill take effect immediately.\n\nReload privilege tables now? [Y/n] <- \u7a7aEnter\n ... Success!\n\nCleaning up...\n\nAll done!  If you've completed all of the above steps, your MariaDB\ninstallation should now be secure.\n\nThanks for using MariaDB!\n```\n\n`MariaDB`\u3092\u4e00\u65e6\u505c\u6b62\u3057\u307e\u3059\u3002\n\n> `service mysql stop`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nShutting down MySQL... SUCCESS! \n```\n\n\n### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u8a2d\u5b9a\u3068\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\n\n\u4e2d\u898f\u6a21\u306e\u30d9\u30fc\u30b9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb`my-medium.cnf`\u3092`my.cnf`\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n> `cp /usr/share/mysql/my-medium.cnf /etc/my.cnf.d/my.cnf`\n\n\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306e`server.cnf`\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3001\u65b0\u898f\u3067`server.cnf`\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n> `mv /etc/my.cnf.d/server.cnf /etc/my.cnf.d/server.cnf.orig && \\`\n> `vi /etc/my.cnf.d/server.cnf`\n\n```diff:/etc/my.cnf.d/server.cnf\n+ [mysqld]\n+ datadir=/var/lib/mysql\n+ character-set-server=utf8\n+ symbolic-links=0\n+ innodb_buffer_pool_size=64M\n+ innodb_log_file_size=16M\n+ innodb_flush_method=O_DIRECT\n+ query_cache_size=128M\n+ query_cache_limit=2M\n+ query_cache_min_res_unit=4k\n+ query_cache_type=1\n+ tmp_table_size=128M\n+ max_heap_table_size=128M\n+ table_open_cache=1024\n+ max_allowed_packet=1M\n+ sort_buffer=256K\n+ read_buffer_size=256K\n+ read_rnd_buffer_size=256K\n+ join_buffer_size=256K\n+ key_buffer_size=16M\n+ max_connections=256\n+ thread_cache=256\n+ wait_timeout=60\n+ plugin-load = handlersocket.so\n```\n\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089`MariaDB`\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n> `service mysql start`\n\n`MariaDB`\u304c\u8d77\u52d5\u3057\u305f\u3089\u3001`MySQL Tuner`\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3092\u3057\u307e\u3059\u3002\n`mysqltuner.pl`\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3001\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u5b9f\u884c\u3057\u307e\u3059\u3002\n`ROOT_PASSWORD`\u306f\u3001\u521d\u671f\u8a2d\u5b9a\u3067\u8a2d\u5b9a\u3057\u305f`root`\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n> `cd ~/ && \\`\n> `wget https://raw.github.com/rackerhacker/MySQLTuner-perl/master/mysqltuner.pl && \\`\n> `chmod +x mysqltuner.pl && \\`\n> `./mysqltuner.pl -user root -pass ROOT_PASSWORD`\n\n\n## PHP\u306e\u30d3\u30eb\u30c9\u3068\u8a2d\u5b9a\n\n`PHP`\u306f\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u3059\u3050\u5207\u308a\u66ff\u3048\u3089\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3001`phpenv`\u3067\u7ba1\u7406\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u307e\u305f`phpenv`\u3092\u4f7f\u3046\u306b\u3042\u305f\u3063\u3066\u3001\u4ed6\u306e`\\*env`\u7cfb\u3068\u30d0\u30c3\u30c6\u30a3\u30f3\u30b0\u3057\u306a\u3044\u3088\u3046`anyenv`\u3092\u901a\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\n### anyenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[GitHub](https://github.com/riywo/anyenv)\u304b\u3089\u30af\u30ed\u30fc\u30f3\u3057\u3066\u304d\u307e\u3059\u3002\n\n> `git clone https://github.com/riywo/anyenv ~/.anyenv`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nInitialized empty Git repository in /root/.anyenv/.git/\nremote: Counting objects: 172, done.\nremote: Total 172 (delta 0), reused 0 (delta 0), pack-reused 172\nReceiving objects: 100% (172/172), 26.63 KiB, done.\nResolving deltas: 100% (57/57), done.\n```\n\n`anyenv`\u306ePATH\u3092\u901a\u3057\u307e\u3059\u3002\n\n> `vi ~/.bashrc`\n\n```diff:~/.bashrc\n+ # anyenv\n+ if [ -d ~/.anyenv ]; then\n+     export PATH=$PATH:$HOME/.anyenv/bin\n+     eval \"$(anyenv init -)\"\n+ fi\n```\n\n\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3057\u305f\u3089\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092`source`\u30b3\u30de\u30f3\u30c9\u3067\u4e00\u5ea6\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n> `source ~/.bashrc`\n\n\n### phpenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n`anyenv`\u306ePATH\u304c\u901a\u3063\u305f\u3089\u3001`anyenv`\u304b\u3089`phpenv`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n`anyenv`\u304b\u3089`phpenv`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3068\u3001`PHP`\u306e\u30d3\u30eb\u30c9\u7528\u30d7\u30e9\u30b0\u30a4\u30f3`php-build`\u304c\u81ea\u52d5\u7684\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\u3002\n\n> `anyenv install phpenv`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\n/tmp/phpenv.20150831090000.1979 ~\nCloning https://github.com/laprasdrum/phpenv.git...\nInitialized empty Git repository in /tmp/phpenv.20150831090000.1979/phpenv/.git/\nremote: Counting objects: 92, done.\nremote: Compressing objects: 100% (61/61), done.\nremote: Total 92 (delta 27), reused 92 (delta 27), pack-reused 0\nUnpacking objects: 100% (92/92), done.\n~\n~/.anyenv/envs/phpenv/plugins ~\nCloning https://github.com/CHH/php-build.git...\nInitialized empty Git repository in /root/.anyenv/envs/phpenv/plugins/php-build/.git/\nremote: Counting objects: 3417, done.\nremote: Total 3417 (delta 0), reused 0 (delta 0), pack-reused 3417\nReceiving objects: 100% (3417/3417), 500.39 KiB | 267 KiB/s, done.\nResolving deltas: 100% (2012/2012), done.\n~\n\nInstall phpenv succeeded!\nPlease reload your profile (exec $SHELL -l) or open a new session.\n```\n\n`phpenv`\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u901a\u308a\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n> `exec $SHELL -l`\n\n`phpenv`\u304c\u6b63\u5e38\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n`phpenv: command not found`\u3068\u8868\u793a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u5927\u4e08\u592b\u3067\u3059\u3002\n\n> `anyenv version`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nphpenv: system (set by /root/.anyenv/envs/phpenv/version)\n```\n\n\n### PHP\u306e\u30d3\u30eb\u30c9\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n`PHP`\u306e\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `yum --enablerepo=epel install re2c libmcrypt libmcrypt-devel && \\`\n> `yum install libxml2-devel bison bison-devel openssl-devel curl-devel libjpeg-devel libpng-devel libmcrypt-devel readline-devel libtidy-devel libxslt-devel enchant-devel libXpm libXpm-devel freetype-devel t1lib t1lib-devel gmp-devel libc-client-devel libicu-devel oniguruma-devel net-snmp net-snmp-devel bzip2-devel`\n\n\n### ImageMagick\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n2016\u5e745\u67083\u65e5\u9803\u516c\u958b\u3055\u308c\u305fImageMagick\u306e\u8106\u5f31\u6027(CVE-2016-3714\u4ed6)\u306e\u5bfe\u5fdc\u3068\u3057\u3066\u3001\u6700\u65b0\u7248\u306eImageMagick\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm`\n> `yum install --enablerepo=remi,epel ImageMagick-last ImageMagick-last-devel ImageMagick-last-libs`\n\n\n### \u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u5909\u66f4\n\n\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u3092`default_configure_options`\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n`PECL`\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3001`--without-pear`\u3092`--with-pear`\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u5404\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u8272\u3005\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n> `vi ~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options`\n\n```diff:~/.anyenv/envs/phpenv/plugins/php-build/share/php-build/default_configure_options\n- --without-pear\n+ --with-pear\n:\n+ --with-apxs2=/usr/bin/apxs\n+ --enable-fileinfo\n+ --enable-hash\n+ --enable-json\n+ --enable-sysvmsg\n+ --with-bz2\n+ --enable-ctype\n+ --with-iconv\n+ --enable-ftp\n+ --with-gettext\n+ --enable-mbstring\n+ --with-onig=/usr\n+ --with-pcre-regex\n+ --with-mysql-sock=/var/lib/mysql/mysql.sock\n+ --enable-phar\n+ --enable-shmop\n+ --enable-sockets\n+ --enable-simplexml\n+ --enable-dom\n+ --with-libxml-dir=/usr\n+ --enable-tokenizer\n+ --with-kerberos=/usr\n+ --with-openssl=/usr\n+ --enable-zip\n+ --with-mhash=yes\n+ --without-mm\n+ --with-enchant=/usr\n+ --enable-gd-native-ttf\n+ --with-gmp=/usr\n+ --with-xpm-dir=/usr/X11R6\n+ --with-freetype-dir=/usr\n+ --with-imap=/usr\n+ --with-imap-ssl\n+ --enable-intl\n+ --with-t1lib=/usr\n+ --with-snmp=/usr\n```\n\n\u30d3\u30eb\u30c9\u30aa\u30d7\u30b7\u30e7\u30f3\u306f`phpenv install`\u6642\u306b`CONFIGURE_OPTS`\u3067\u305d\u306e\u5834\u9650\u308a\u306e\u8ffd\u52a0\u6307\u5b9a\u3092\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n> **\u5b9f\u884c\u4f8b**\n> `CONFIGURE_OPTS=\"--with-pear --disable-fpm --with-apxs2=/usr/bin/apxs\" phpenv install 5.x.x`\n\n\n### \u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u306e\u78ba\u8a8d\n\n\u73fe\u5728\u306e`php-build`\u3067\u30d3\u30eb\u30c9\u53ef\u80fd\u306a`PHP`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u4e00\u89a7\u3092\u51fa\u529b\u3057\u307e\u3059\u3002\n\n> `phpenv install -l`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nAvailable versions:\n  5.2.17\n  5.3.2\n  5.3.3\n  : (\u7701\u7565)\n  7.0.5\n  7.0snapshot\n  master\n```\n\n\n### \u30d3\u30eb\u30c9\u53ef\u80fd\u306aPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u3092\u66f4\u65b0\n\n`php-build`\u306e\u30d3\u30eb\u30c9\u53ef\u80fd\u306a`PHP`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u4e00\u89a7\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n> `cd ~/.anyenv/envs/phpenv/plugins/php-build/ && \\`\n> `git pull`\n\n\n### PHP\u306e\u30d3\u30eb\u30c9\n\n`PHP`\u306e\u30d3\u30eb\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u57f7\u7b46\u5f53\u6642\u306e`5.6`\u306e\u6700\u65b0\u7248`5.6.20`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `phpenv install 5.6.20`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\n[Info]: Loaded extension plugin\n[Info]: Loaded apc Plugin.\n : (\u7701\u7565)\n[Success]: Built 5.6.20 successfully.\n```\n\n\u30d3\u30eb\u30c9\u306e\u5b8c\u4e86\u5f8c\u3001\u751f\u6210\u3055\u308c\u305f`libphp5.so`\u306f**\u5fc5\u305a**\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3055\u305b\u307e\u3059\u3002\n\n> `mv /opt/rh/httpd24/root/usr/lib64/httpd/modules/libphp5.so ~/.anyenv/envs/phpenv/versions/5.6.20/libexec/libphp5.so`\n> > \u79fb\u52d5\u3055\u305b\u306a\u3044\u3068\u3001\u30d3\u30eb\u30c9\u306e\u305f\u3073\u306b`libphp5.so`\u304c\u4e0a\u66f8\u304d\u3055\u308c\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u4e0a\u66f8\u304d\u56de\u907f\u306e\u305f\u3081\u306b\u5fc5\u305a\u9000\u907f\u3057\u307e\u3059\u3002\n> > \u3053\u3046\u3059\u308b\u3053\u3068\u3067`httpd.conf`\u3067\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048\u3082\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n### CLI\u5074\u306ePHP\u306e\u5207\u308a\u66ff\u3048\n\nPHP\u306e\u30d3\u30eb\u30c9\u6210\u529f\u5f8c\u3001CLI\u304c\u8aad\u307f\u8fbc\u3080PHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\n> phpenv global 5.6.20\n \n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u5207\u308a\u66ff\u3048\u304c\u6210\u529f\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u5207\u308a\u66ff\u3048\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n> `anyenv version && \\`\n> `php -v`\n\n```shell-session:\u5b9f\u884c\u7d50\u679c\nphpenv: 5.6.20 (set by /root/.anyenv/envs/phpenv/version)\nPHP 5.6.20 (cli) (built: Sep  1 2015 09:00:00) \nCopyright (c) 1997-2015 The PHP Group\nZend Engine v2.6.0, Copyright (c) 1998-2015 Zend Technologies\n    with Zend OPcache v7.0.6-dev, Copyright (c) 1999-2015, by Zend Technologies\n    with Xdebug v2.3.3, Copyright (c) 2002-2015, by Derick Rethans\n```\n\n\n### Apache\u5074\u306ePHP\u306e\u5207\u308a\u66ff\u3048\n\n\u3042\u308f\u305b\u3066\u3001`Apache`\u304c\u8aad\u307f\u8fbc\u3080`PHP`\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u307e\u3059\u3002\n\u3053\u3061\u3089\u306fCLI\u3068\u306f\u5225\u3067\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u4e0a\u306b\u3001CLI\u306e\u3088\u3046\u306b\u5207\u308a\u66ff\u3048\u30b3\u30de\u30f3\u30c9\u3082\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n> `vi /etc/httpd/conf/httpd.conf`\n\n`httpd.conf`\u306e\u4e0b\u8a18\u306e\u30b3\u30e1\u30f3\u30c8\u884c\u306e\u6b21\u306e\u884c\u8fba\u308a\u306b\u3001\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3073\u306b\u81ea\u52d5\u3067`LoadModule php5_module`\u306e\u8a18\u8ff0\u304c\u8ffd\u8a18\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n`LoadModule php5_module`\u304c\u8907\u6570\u884c\u3042\u308b\u3068`Apache`\u518d\u8d77\u52d5\u6642\u306b\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n2\u56de\u76ee\u4ee5\u964d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u3092\u884c\u3046\u969b\u306f\u3001`LoadModule php5_module`\u306f1\u884c\u3060\u3051\u6b8b\u3059\u3053\u3068\u3092\u899a\u3048\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```diff:/opt/rh/httpd24/root/etc/httpd/conf/httpd.conf\n  :\n  # Example:\n  # LoadModule foo_module modules/mod_foo.so\n- LoadModule php5_module /root/.anyenv/envs/phpenv/versions/5.6.19/libexec/libphp5.so\n+ LoadModule php5_module /root/.anyenv/envs/phpenv/versions/5.6.20/libexec/libphp5.so\n  :\n```\n\n\n### PECL\u3067ImageMagick\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u8a73\u7d30\u306a\u753b\u50cf\u51e6\u7406\u3092\u884c\u3046`ImageMagick`\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `pecl install imagick`\n> > `PECL`\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b`extension`\u306f\u3001\u73fe\u5728\u6307\u5b9a\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u304b\u5165\u3089\u306a\u3044\u305f\u3081\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u6bce\u306b`pecl install`\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n### PHP\u306e\u8a2d\u5b9a\n\n`ImageMagick`\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb`php.ini`\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n> `vi ~/.anyenv/envs/phpenv/versions/5.6.20/etc/php.ini`\n\n```diff:~/.anyenv/envs/phpenv/versions/5.6.20/etc/php.ini\n  :\n+ extension=imagick.so\n  :\n- ;date.timezone = \n+ date.timezone = Asia/Tokyo\n  :\n- post_max_size = 8M\n+ post_max_size = 100M\n  :\n- upload_max_filesize = 2M\n+ upload_max_filesize = 100M\n  :\n- ;mbstring.language = Japanese \n+ mbstring.language = Japanese\n  :\n- ;mbstring.internal_encoding = \n+ mbstring.internal_encoding = UTF-8\n  :\n- ;mbstring.detect_order = auto\n+ mbstring.detect_order = UTF-8,SJIS,EUC-JP,JIS,ASCII\n  :\n- pdo_mysql.default_socket=\n+ pdo_mysql.default_socket=/var/lib/mysql/mysql.sock\n  :\n- mysql.default_socket =\n+ mysql.default_socket = /var/lib/mysql/mysql.sock\n  :\n- mysqli.default_socket =\n+ mysqli.default_socket = /var/lib/mysql/mysql.sock\n  :\n```\n\n\n### PECL\u3067APCu\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u9ad8\u901f\u5316\u306e\u305f\u3081\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u30e1\u30e2\u30ea\u5185\u306bKVS(Key Value Store)\u5f62\u5f0f\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b**\u30c7\u30fc\u30bf\u30ad\u30e3\u30c3\u30b7\u30e5\u6a5f\u80fd**\u3092\u3082\u3064`APCu`\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n> `pecl install apcu`\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3001`PHP`\u30d3\u30eb\u30c9\u6642\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u308bPHP\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf`OPCache`\u306e\u8a2d\u5b9a\u3082\u540c\u6642\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n`opcache.blacklist_filename`\u306e\u30d1\u30b9\u306f\u30d3\u30eb\u30c9\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306e`/etc/conf.d/`\u5185\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002(\u591a\u5206)\n\n> `vim ~/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/apc.ini`\n\n```diff:~/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/apc.ini\n+ [opcache]\n+ opcache.enable = 1\n+ opcache.enable_cli = 1\n+ opcache.memory_consumption = 128\n+ opcache.interned_strings_buffer = 8\n+ opcache.max_accelerated_files = 4000\n+ opcache.blacklist_filename = /root/.anyenv/envs/phpenv/versions/5.6.21/etc/conf.d/opcache*.blacklist\n+ [apcu]\n+ extension = apcu.so\n+ apc.enabled = 1\n+ apc.enable_cli = 1\n+ apc.shm_size = 64M\n+ apc.mmap_file_mask = /tmp/apc.XXXXXX\n```\n\n\n### Apache\u306e\u518d\u8d77\u52d5\n\nPHP\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u8ffd\u52a0\u30fb\u5207\u308a\u66ff\u3048\u30fb`extension`\u306e\u8ffd\u52a0\u306a\u3069\u304c\u7d42\u308f\u3063\u305f\u3089\u3001Apache\u3092\u518d\u8d77\u52d5\u3055\u305b\u307e\u3059\u3002\n\n> `service httpd24-httpd restart`\n\n\n## \u6b21\u56de\n\n[\u3055\u304f\u3089\u306eVPS \u6a19\u6e96OS\u306e\u74b0\u5883\u69cb\u7bc9(5) Let's Encrypt\u3067SSL+HTTP/2\u5bfe\u5fdc](http://qiita.com/takahiko-takei/items/ce34defe0273a22e8baa)\n", "tags": ["\u30b5\u30fc\u30d0\u30fc\u69cb\u7bc9", "\u3055\u304f\u3089\u306eVPS", "CentOS6.x", "mariadb", "PHP"]}