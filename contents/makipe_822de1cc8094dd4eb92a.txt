{"context": "\n\n2\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u9593\u3067\u5dee\u5206\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092CSV\u306b\u307e\u3068\u3081\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u6982\u8981\n2\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u9593\u3067\u5dee\u5206\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u51fa\u529b\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d39\u4ecb\u3067\u3059\u3002\n\u4eca\u56de\u306fShift_JIS\u306eCSV\u306b\u307e\u3068\u3081\u307e\u3059\u3002\n\n\u5dee\u5206\u306e\u6bd4\u8f03\ndiff\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4e0b\u8a18\u3067\u3059\u3002\n\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\n\u5185\u5bb9\n\n\n\n\n-r\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u3092\u518d\u5e30\u7684\u306b\u6bd4\u8f03\u3057\u307e\u3059\u3002\n\n\n-q\n\u5dee\u5206\u306e\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3068\u3001\u3069\u3046\u3044\u3046\u5dee\uff08\u300c\u7247\u65b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u5b58\u5728\u3059\u308b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306b\u5dee\u304c\u3042\u308b\u300d\uff09\u306a\u306e\u304b\u3092\u306e\u307f\u8868\u793a\u3057\u307e\u3059\u3002\n\n\n\n\n\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u5909\u63db\n\u4eca\u56de\u306fnkf\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5909\u66f4\u3059\u308c\u3070\u5225\u306e\u6587\u5b57\u30b3\u30fc\u30c9\u306b\u3082\u5909\u63db\u53ef\u80fd\u3067\u3059\u3002\n\u4eca\u56de\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4e0b\u8a18\u3067\u3059\u3002\n\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\n\u5185\u5bb9\n\n\n\n\n-s\nShift_JIS\u3078\u5909\u63db\u3057\u307e\u3059\u3002\n\n\n--overwrite\n\u5f15\u6570\u306b\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3057\u305f\u5185\u5bb9\u3067\u4e0a\u66f8\u304d\u3057\u307e\u3059\u3002\n\n\n\n\uff08\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3067\u304d\u308c\u3070\u306a\u3093\u3067\u3082\u826f\u3044\u3067\u3059\u3002iconv\u3067\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\uff09\n\nCSV\u306b\u51fa\u529b\u3055\u308c\u308b\u5185\u5bb9\n\n\u300c\u7247\u65b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u5b58\u5728\u3059\u308b\u300d\u5834\u5408\nOnly in,/var/www/html/production/: file1.txt\n\n\n\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306b\u5dee\u304c\u3042\u308b\u300d\u5834\u5408\ndiffer,/var/www/html/production/file2.txt and /var/www/html/staging/file2.txt\n\n\n\u5b9f\u969b\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\ndiff\u306e\u5b9f\u884c\u90e8\u5206\u3067LANG=en\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u306e\u8a00\u8a9e\u8a2d\u5b9a\u304cen\u4ee5\u5916\u306e\u5834\u5408\u3067\u3082\n\u5b9f\u884c\u6642\u306fen\u306e\u7d50\u679c\u304csed\u306b\u6e21\u308a\u307e\u3059\u3002\n\ncheck_diff.sh\n#!/bin/bash\n\ncheck_diff() {\n  local dir1=$1\n  local dir2=$2\n  local export_path=$3\n\n  local now=$(date \"+%Y%m%d_%H%M%S\")\n  local file_name='diff_'${now}'_sjis.csv'\n  local working_dir=$(cd $(dirname $0); pwd)\n\n  # \u51fa\u529b\u5148\u306b\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070\u5b9f\u884c\u5834\u6240\u306b\u51fa\u529b\u3057\u307e\u3059\n  if [ -n \"$3\" ]; then\n    export_path=${working_dir}\n  fi\n\n  export_path=${export_path}${file_name}\n\n  echo 'DIR1                : '${working_dir}/${dir1}\n  echo 'DIR2                : '${working_dir}/${dir2}\n  echo 'EXPORT PATH         : '${working_dir}/${export_path}\n\n  export_diff ${dir1} ${dir2} ${export_path}\n  convert_encoding ${export_path}\n}\n\nexport_diff() {\n  local dir1=$1\n  local dir2=$2\n  local export_path=$3\n\n  LANG=en diff -qr ${dir1} ${dir2} | sed \\\n    -e 's:Only in :Only in,:' \\\n    -e 's:Files :differ,:' \\\n    -e 's: differ$::' \\\n    > ${export_path}\n}\n\nconvert_encoding() {\n  local export_path=$1\n\n  nkf -s --overwrite ${export_path}\n  echo 'CHARACTER ENCODING  : '$(nkf -g ${export_path})\n}\n\nreadonly DIR1=$1\nreadonly DIR2=$2\nreadonly EXPORT_PATH=$3\n\necho 'Check diff start ...'\ncheck_diff ${DIR1} ${DIR2} ${EXPORT_PATH}\necho 'Check diff end.'\n\nexit 0\n\n\n\n\n\u4f7f\u3044\u65b9\ncheck_diff.sh \u306b\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u7b2c\u4e00\u5f15\u6570\u306b\u6bd4\u8f03\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff11\n\u7b2c\u4e8c\u5f15\u6570\u306b\u6bd4\u8f03\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff12\n\u7b2c\u4e09\u5f15\u6570\u306b\u6bd4\u8f03\u7d50\u679c\u3092\u51fa\u529b\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u5b9f\u884c\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\uff09\n./check_diff.sh /var/www/html/production/ /var/www/html/staging/\n\n\n\u5b9f\u884c\u7d50\u679c\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u4e0b\u8a18\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u6bd4\u8f03\u5bfe\u8c61\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n\u51fa\u529b\u5148\u306e\u30d1\u30b9\n\u51fa\u529b\u3057\u305f\u7d50\u679c\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\n\n[root@XXXXXX ~]# ./check_diff.sh /var/www/html/production/ /var/www/html/staging/\nCheck diff start ...\nDIR1                : /var/www/html/production/\nDIR2                : /var/www/html/staging/\nEXPORT PATH         : /var/www/html/diff_20160809_181206_sjis.csv\nCHARACTER ENCODING  : Shift_JIS\nCheck diff end.\n\n\n\u53c2\u8003\n\nMan page of DIFF\nnkf\u3092\u4f7f\u3063\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3059\u308b \uff5c Developers.IO\n\n# 2\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u9593\u3067\u5dee\u5206\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092CSV\u306b\u307e\u3068\u3081\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\n\n## \u6982\u8981\n\n2\u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u9593\u3067\u5dee\u5206\u306e\u3042\u308b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3092\u51fa\u529b\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d39\u4ecb\u3067\u3059\u3002\n\u4eca\u56de\u306fShift_JIS\u306eCSV\u306b\u307e\u3068\u3081\u307e\u3059\u3002\n\n## \u5dee\u5206\u306e\u6bd4\u8f03\ndiff\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4e0b\u8a18\u3067\u3059\u3002\n\n|\u30aa\u30d7\u30b7\u30e7\u30f3|\u5185\u5bb9|\n|--:|:--|\n|-r|\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u3092\u518d\u5e30\u7684\u306b\u6bd4\u8f03\u3057\u307e\u3059\u3002|\n|-q|\u5dee\u5206\u306e\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u3068\u3001\u3069\u3046\u3044\u3046\u5dee\uff08\u300c\u7247\u65b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u5b58\u5728\u3059\u308b\u300d\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306b\u5dee\u304c\u3042\u308b\u300d\uff09\u306a\u306e\u304b\u3092\u306e\u307f\u8868\u793a\u3057\u307e\u3059\u3002|\n\n## \u6587\u5b57\u30b3\u30fc\u30c9\u306e\u5909\u63db\n\u4eca\u56de\u306fnkf\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5909\u66f4\u3059\u308c\u3070\u5225\u306e\u6587\u5b57\u30b3\u30fc\u30c9\u306b\u3082\u5909\u63db\u53ef\u80fd\u3067\u3059\u3002\n\u4eca\u56de\u4f7f\u7528\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u4e0b\u8a18\u3067\u3059\u3002\n\n|\u30aa\u30d7\u30b7\u30e7\u30f3|\u5185\u5bb9|\n|--:|:--|\n|-s|Shift_JIS\u3078\u5909\u63db\u3057\u307e\u3059\u3002|\n|--overwrite|\u5f15\u6570\u306b\u6307\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3057\u305f\u5185\u5bb9\u3067\u4e0a\u66f8\u304d\u3057\u307e\u3059\u3002|\n\n\uff08\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3067\u304d\u308c\u3070\u306a\u3093\u3067\u3082\u826f\u3044\u3067\u3059\u3002iconv\u3067\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\uff09\n\n## CSV\u306b\u51fa\u529b\u3055\u308c\u308b\u5185\u5bb9\n\n### \u300c\u7247\u65b9\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u307f\u5b58\u5728\u3059\u308b\u300d\u5834\u5408\n```\nOnly in,/var/www/html/production/: file1.txt\n```\n\n###\u300c\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u306b\u5dee\u304c\u3042\u308b\u300d\u5834\u5408\n```\ndiffer,/var/www/html/production/file2.txt and /var/www/html/staging/file2.txt\n```\n\n## \u5b9f\u969b\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\n\n`diff`\u306e\u5b9f\u884c\u90e8\u5206\u3067`LANG=en`\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30b5\u30fc\u30d0\u306e\u8a00\u8a9e\u8a2d\u5b9a\u304c`en`\u4ee5\u5916\u306e\u5834\u5408\u3067\u3082\n\u5b9f\u884c\u6642\u306f`en`\u306e\u7d50\u679c\u304c`sed`\u306b\u6e21\u308a\u307e\u3059\u3002\n\n```sh:check_diff.sh\n#!/bin/bash\n\ncheck_diff() {\n  local dir1=$1\n  local dir2=$2\n  local export_path=$3\n\n  local now=$(date \"+%Y%m%d_%H%M%S\")\n  local file_name='diff_'${now}'_sjis.csv'\n  local working_dir=$(cd $(dirname $0); pwd)\n\n  # \u51fa\u529b\u5148\u306b\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070\u5b9f\u884c\u5834\u6240\u306b\u51fa\u529b\u3057\u307e\u3059\n  if [ -n \"$3\" ]; then\n    export_path=${working_dir}\n  fi\n\n  export_path=${export_path}${file_name}\n\n  echo 'DIR1                : '${working_dir}/${dir1}\n  echo 'DIR2                : '${working_dir}/${dir2}\n  echo 'EXPORT PATH         : '${working_dir}/${export_path}\n\n  export_diff ${dir1} ${dir2} ${export_path}\n  convert_encoding ${export_path}\n}\n\nexport_diff() {\n  local dir1=$1\n  local dir2=$2\n  local export_path=$3\n\n  LANG=en diff -qr ${dir1} ${dir2} | sed \\\n    -e 's:Only in :Only in,:' \\\n    -e 's:Files :differ,:' \\\n    -e 's: differ$::' \\\n    > ${export_path}\n}\n\nconvert_encoding() {\n  local export_path=$1\n\n  nkf -s --overwrite ${export_path}\n  echo 'CHARACTER ENCODING  : '$(nkf -g ${export_path})\n}\n\nreadonly DIR1=$1\nreadonly DIR2=$2\nreadonly EXPORT_PATH=$3\n\necho 'Check diff start ...'\ncheck_diff ${DIR1} ${DIR2} ${EXPORT_PATH}\necho 'Check diff end.'\n\nexit 0\n\n```\n## \u4f7f\u3044\u65b9\ncheck_diff.sh \u306b\u5b9f\u884c\u6a29\u9650\u3092\u4e0e\u3048\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u7b2c\u4e00\u5f15\u6570\u306b\u6bd4\u8f03\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff11\n\u7b2c\u4e8c\u5f15\u6570\u306b\u6bd4\u8f03\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff12\n\u7b2c\u4e09\u5f15\u6570\u306b\u6bd4\u8f03\u7d50\u679c\u3092\u51fa\u529b\u3057\u305f\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u5b9f\u884c\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\uff09\n\n```sh\n./check_diff.sh /var/www/html/production/ /var/www/html/staging/\n```\n\n## \u5b9f\u884c\u7d50\u679c\n\u5b9f\u884c\u7d50\u679c\u3068\u3057\u3066\u4e0b\u8a18\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n+ \u6bd4\u8f03\u5bfe\u8c61\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n+ \u51fa\u529b\u5148\u306e\u30d1\u30b9\n+ \u51fa\u529b\u3057\u305f\u7d50\u679c\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\n\n```sh\n[root@XXXXXX ~]# ./check_diff.sh /var/www/html/production/ /var/www/html/staging/\nCheck diff start ...\nDIR1                : /var/www/html/production/\nDIR2                : /var/www/html/staging/\nEXPORT PATH         : /var/www/html/diff_20160809_181206_sjis.csv\nCHARACTER ENCODING  : Shift_JIS\nCheck diff end.\n```\n\n## \u53c2\u8003\n+ [Man page of DIFF](https://linuxjm.osdn.jp/html/gnumaniak/man1/diff.1.html)\n+ [nkf\u3092\u4f7f\u3063\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3059\u308b \uff5c Developers.IO](http://dev.classmethod.jp/tool/exchange-file-encode-by-nkf/)\n", "tags": ["ShellScript", "Bash", "Linux", "shell", "diff"]}