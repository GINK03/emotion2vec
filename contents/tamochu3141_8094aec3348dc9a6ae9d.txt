{"context": "\n\n\u4eca\u56de\u4f7f\u3046\u6280\u8853\u306e\u8981\u7d20\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\nphina.js\nver0.2.0\n\u4eca\u56de\u306e\u4e3b\u5f79\nhttp://phinajs.com/\n\u65e5\u672c\u7523\u306ejavascript\u3067\u306e\u30b2\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\n\u3053\u308c\u3092\u7528\u3044\u3066\u591a\u4eba\u6570\u53c2\u52a0\u578b\u30b2\u30fc\u30e0\u3092\u3069\u3046\u4f5c\u308b\u304b\u3068\u3044\u3046\u4f8b\n\n\u901a\u4fe1\n\nwebsocket\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u901a\u4fe1\u3092\u884c\u3046\u65b9\u6cd5\u306f\u3044\u304f\u3064\u3082\u3042\u308b\u304c\u3001\u4eca\u56de\u7528\u3044\u308b\u306e\u306f\u3053\u308c\n\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4e00\u7a2e\u3067\u30d6\u30e9\u30a6\u30b6\u304c\u53e4\u3044\u3082\u306e\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u70b9\u306b\u6ce8\u610f\u3002\n\u7d30\u304b\u3044\u8a71\u306f\u7701\u7565\n\u4eca\u56de\u306fphina.js\u3068\u9023\u643a\u3055\u305b\u308b\u5b9f\u88c5\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\n\nSpring-framework\nver4.3.2\nJava\u306e\u300cSpring\u300d\u3092\u6271\u3046\u305f\u3081\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\nwebsocket\u3092\u6271\u3048\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u56de\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u4f7f\u7528\n\n\u76ee\u6a19\n\u591a\u4eba\u6570\u53c2\u52a0\u578b\u30b2\u30fc\u30e0\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\u4eca\u56de\u306f\u8981\u7d20\u3068\u3057\u3066\u5fc5\u8981\u306a\u901a\u77e5\u6a5f\u80fd\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u8a73\u7d30\n\u753b\u9762\u4e0a\u306b\u300c\u30d9\u30eb\u300d\u30dc\u30bf\u30f3\u304c\u3042\u308a\u3001\u62bc\u4e0b\u3059\u308b\u3068\u540c\u3058\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u3044\u308b\u5168\u54e1\u306b\u97f3\u304c\u9cf4\u308b\n\n\u88fd\u9020\n\u4ed6\u306e\u30da\u30fc\u30b8\u3067\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306f\u3069\u3093\u3069\u3093\u7701\u7565\u3057\u3066\u3044\u304f\n\n\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\nhttp://acro-engineer.hatenablog.com/entry/2014/01/17/170607\n\u3092\u53c2\u8003\u306bTextWebSocketHandler\u3092\u7d99\u627f\u3057\u7279\u5b9a\u306e\u30e1\u30c3\u30bb\u30fc\u30b8(\u300ca\u300d\u4e00\u6587\u5b57\u3068\u304b\u3067\u3088\u3044)\u304c\u6765\u305f\u3089\u97f3\u3092\u9cf4\u3089\u3059\u30e1\u30c3\u30bb\u30fc\u30b8(\u300cb\u300d\u4e00\u6587\u5b57\u3068\u304b\u3067\u3088\u3044)\u3092\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u4f5c\u6210\u3002\nweb.xml\u306a\u3069\u3092\u9069\u5b9c\u8a2d\u5b9a\n\u4ee5\u4e0b\u8a2d\u5b9a\u306e\u5fc5\u8981\u306a\u90e8\u5206\u629c\u7c8b\n\nweb.xml\n    <servlet>\n        <servlet-name>bell</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n    <servlet>\n        <servlet-name>bellWebSocket</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>bell</servlet-name>\n        <url-pattern>/bell</url-pattern>\n        <url-pattern>/bell.jsp</url-pattern>\n        <url-pattern>/bell.html</url-pattern>\n        <url-pattern>*.html</url-pattern>\n    </servlet-mapping>\n    <servlet-mapping>\n        <servlet-name>bellWebSocket</servlet-name>\n        <url-pattern>/ws</url-pattern>\n    </servlet-mapping>\n\n\n\nbell-servlet.xml\n    <context:component-scan base-package=\"hoge.bell.controller\" />\n\n    <bean id=\"viewResolver\" class=\"org.springframework.web.servlet.view.UrlBasedViewResolver\">\n        <property name=\"viewClass\" value=\"org.springframework.web.servlet.view.JstlView\" />\n        <property name=\"prefix\" value=\"/WEB-INF/jsp/\" />\n        <property name=\"suffix\" value=\".jsp\" />\n    </bean>\n\n\n\nbellWebSocket-servlet.xml\n    <websocket:handlers>\n        <websocket:mapping path=\"/ws\" handler=\"bellHandler\" />\n    </websocket:handlers>\n\n    <bean id=\"bellHandler\" class=\"hoge.bell.handler.BellHandler\" />\n\n\n\nBell.java\n@Controller\npublic class Bell {\n    @RequestMapping(\"/bell\")\n    public ModelAndView index() {\n        return new ModelAndView(\"bell\");\n    }\n}\n\n\n\nBellHandler.java\npublic class BellHandler extends TextWebSocketHandler {\n    /** \u30bb\u30c3\u30b7\u30e7\u30f3\u4e00\u89a7 */\n    private Map<String, WebSocketSession> sessionsMap = new ConcurrentHashMap<String, WebSocketSession>();\n\n    @Override\n    public void afterConnectionEstablished(WebSocketSession session) throws Exception {\n        this.sessionsMap.put(session.getId(), session);\n    }\n\n    @Override\n    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {\n        this.sessionsMap.remove(session.getId());\n    }\n\n    @Override\n    public void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {\n        String mes = message.getPayload();\n        if (mes.equals(\"a\")) {\n            TextMessage broadcastMessage = new TextMessage(\"b\");\n            for (Entry<String, SessionInfo> entry : this.sessionsMap.entrySet()) {\n                entry.getValue().sendMessage(broadcastMessage);\n            }\n        }\n    }\n}\n\n\n\u306a\u3069\u3068\u3057\u3066websocket\u306e\u30a2\u30af\u30bb\u30b9\u306b/ws\u3092\u3001\u30da\u30fc\u30b8\u306e\u8868\u793a\u306b/bell\u3092\u5272\u308a\u5f53\u3066\u308b\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\u3053\u3061\u3089\u304c\u4eca\u56de\u306e\u30e1\u30a4\u30f3\nwebsocket\u3092\u751f\u6210\u3057onload\u3067GameApp\u3092run\u3059\u308b\u3002\nonmessage\u306e\u51e6\u7406\u3068phina.js\u3092\u9023\u643a\u3055\u305b\u308b\u3002\n\nbell.jsp\n<html>\n<head>\n<script src=\"http://code.jquery.com/jquery-1.11.1.min.js\"></script>\n<script src=\"http://cdn.rawgit.com/phi-jp/phina.js/v0.2.0/build/phina.js\"></script>\n<script src=\"./js/bell.js\"></script>\n</head>\n<body>\n</body>\n</html>\n\n\n\nbell.js\n    phina.globalize();\n    var SOUNDS = {\n        sound: {\n            'bell': './se/bell.mp3',\n        },\n    };\n    phina.define('WebsocketGameApp', {\n        superClass: 'GameApp',\n        init: function(params) {\n            this.superInit(params);\n            if (params.ws) {\n                this.ws = params.ws;\n            }\n            if (params.mesHandler) {\n                for (header in params.mesHandler) {\n                    this.addMesHandler(header, params.mesHandler[header]);\n                }\n            }\n        },\n        send: function(mes) {\n            if (this.ws) {\n                this.ws.send(mes);\n            }\n        },\n        addMesHandler: function(header, handler) {\n            this.on('mes' + header, handler);\n        },\n\n        _accessor: {\n            ws: {\n                get: function() { return this._ws; },\n                set: function(ws) {\n                    this._ws = ws;\n                    var that = this;\n                    this._ws.onmessage = function(mes) {\n                        that.flare('mes' + mes, {});\n                    };\n                },\n            },\n        },\n    });\n    phina.define('MainScene', {\n        superClass: 'DisplayScene',\n        init: function(params) {\n            this.superInit(params);\n            var that = this;\n\n            this.bell = Button({\n                text: '\u30d9\u30eb',\n                height: this.gridY.span(2),\n                width: this.gridX.span(5),\n                fontSize: 16,\n            })\n            .addChildTo(this)\n            .setPosition(this.gridX.center(), this.gridY.center());\n            this.bell.onpush = function(){\n                that.app.send('a');\n            };\n        },\n    });\n    phina.main(function() {\n        var ws = new WebSocket(\"ws://yourdomain/contextPath/ws\");\n        // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u751f\u6210\n        var app = WebsocketGameApp({\n            startLabel: 'main', // \u30e1\u30a4\u30f3\u30b7\u30fc\u30f3\u304b\u3089\u958b\u59cb\u3059\u308b\n            assets: $.extend(true, {}, SOUNDS),\n            ws: ws,\n            mesHandler: {\n                b: function() {\n                    AssetManager.get(\"sound\", \"bell\").play();\n                },\n            },\n        });\n        ws.onopen = function() {\n            // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\n            app.run();\n        };\n        ws.onclose = function() {};\n        ws.onerror = function(e) {\n            alert(\"\u30a8\u30e9\u30fc\");\n        };\n    });\n\n\n\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306f\u65b0\u305f\u306bWebsocketGameApp\u3092\u5b9a\u7fa9\u3057\u305f\u3002\nmesHandler\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6e21\u3057\u3066\u3084\u308a\u3001\u30ad\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u305f\u969b\u306b\u884c\u3046\u51e6\u7406\u3092\u30d0\u30ea\u30e5\u30fc\u306b\u6e21\u3059\u3002\n\u3053\u308c\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u3088\u308b\u51e6\u7406\u306e\u5224\u5b9a\u3092\u5916\u90e8\u304b\u3089\u6ce8\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3001\nGameApp\u5185\u90e8\u3067\u898f\u5b9a\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u554f\u984c\u306f\u306a\u3044\u3002\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066\u304f\u308b\u5185\u5bb9\u304c\u30d8\u30c3\u30c0\u30fc\u3068\u30dc\u30c7\u30a3\u30fc\u306b\u5206\u304b\u308c\u3066\u30dc\u30c7\u30a3\u30fc\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u3066\u3084\u308a\u305f\u3044\u5834\u5408\u306fws\u306e\u30bb\u30c3\u30bf\u30fc\u3092\n\nbell.js\n                set: function(ws) {\n                    this._ws = ws;\n                    var that = this;\n                    this._ws.onmessage = function(mes) {\n                        var header = mes.split(SEPARATOR)[0];\n                        var body = mes.split(SEPARATOR)[1];\n                        that.flare('mes' + header, {\n                            body: body,\n                        });\n                    };\n                },\n\n\n\u306a\u3069\u3068\u5909\u3048\u3066\u3084\u308ahandler\u306e\u5f15\u6570\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u53d7\u3051\u53d6\u308b\n\nbell.js\n            mesHandler: {\n                sound: function(arg) {\n                    // \u3053\u3053\u3067\u306f\u5f15\u6570\u306b\u97f3\u306e\u7a2e\u985e\u3092\u8868\u3059\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u304f\u308b\u3082\u306e\u3068\u3059\u308b\u3002\n                    // \u4e0a\u8a18\u30d9\u30eb\u3068\u540c\u3058\u51e6\u7406\u306a\u3089\u3070SEPARATOR = \",\"\u306e\u5834\u5408\u300csound,bell\u300d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6e21\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308b\u3002\n                    AssetManager.get(\"sound\", arg.body).play();\n                },\n            },\n\n\n\u4eca\u56de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306ebody\u3068\u3057\u3066\u6e21\u3057\u3066\u3044\u308b\u304c\u3001\u30dc\u30c7\u30a3\u3092\u305d\u306e\u307e\u307e\u6e21\u3057\u3066\u3082\u3088\u3044\u3002\n#\u4eca\u56de\u4f7f\u3046\u6280\u8853\u306e\u8981\u7d20\n##\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n###phina.js\nver0.2.0\n\u4eca\u56de\u306e\u4e3b\u5f79\nhttp://phinajs.com/\n\u65e5\u672c\u7523\u306ejavascript\u3067\u306e\u30b2\u30fc\u30e0\u30e9\u30a4\u30d6\u30e9\u30ea\n\u3053\u308c\u3092\u7528\u3044\u3066\u591a\u4eba\u6570\u53c2\u52a0\u578b\u30b2\u30fc\u30e0\u3092\u3069\u3046\u4f5c\u308b\u304b\u3068\u3044\u3046\u4f8b\n##\u901a\u4fe1\n###websocket\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u901a\u4fe1\u3092\u884c\u3046\u65b9\u6cd5\u306f\u3044\u304f\u3064\u3082\u3042\u308b\u304c\u3001\u4eca\u56de\u7528\u3044\u308b\u306e\u306f\u3053\u308c\n\u901a\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4e00\u7a2e\u3067\u30d6\u30e9\u30a6\u30b6\u304c\u53e4\u3044\u3082\u306e\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u70b9\u306b\u6ce8\u610f\u3002\n\u7d30\u304b\u3044\u8a71\u306f\u7701\u7565\n\u4eca\u56de\u306fphina.js\u3068\u9023\u643a\u3055\u305b\u308b\u5b9f\u88c5\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n##\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\n###Spring-framework\nver4.3.2\nJava\u306e\u300cSpring\u300d\u3092\u6271\u3046\u305f\u3081\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\nwebsocket\u3092\u6271\u3048\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u4eca\u56de\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u306b\u4f7f\u7528\n\n#\u76ee\u6a19\n\u591a\u4eba\u6570\u53c2\u52a0\u578b\u30b2\u30fc\u30e0\u3092\u4f5c\u308b\u306b\u3042\u305f\u3063\u3066\u4eca\u56de\u306f\u8981\u7d20\u3068\u3057\u3066\u5fc5\u8981\u306a\u901a\u77e5\u6a5f\u80fd\u3092\u4f5c\u6210\u3059\u308b\u3002\n##\u8a73\u7d30\n\u753b\u9762\u4e0a\u306b\u300c\u30d9\u30eb\u300d\u30dc\u30bf\u30f3\u304c\u3042\u308a\u3001\u62bc\u4e0b\u3059\u308b\u3068\u540c\u3058\u30da\u30fc\u30b8\u3092\u958b\u3044\u3066\u3044\u308b\u5168\u54e1\u306b\u97f3\u304c\u9cf4\u308b\n\n#\u88fd\u9020\n\u4ed6\u306e\u30da\u30fc\u30b8\u3067\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u306f\u3069\u3093\u3069\u3093\u7701\u7565\u3057\u3066\u3044\u304f\n##\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\nhttp://acro-engineer.hatenablog.com/entry/2014/01/17/170607\n\u3092\u53c2\u8003\u306bTextWebSocketHandler\u3092\u7d99\u627f\u3057\u7279\u5b9a\u306e\u30e1\u30c3\u30bb\u30fc\u30b8(\u300ca\u300d\u4e00\u6587\u5b57\u3068\u304b\u3067\u3088\u3044)\u304c\u6765\u305f\u3089\u97f3\u3092\u9cf4\u3089\u3059\u30e1\u30c3\u30bb\u30fc\u30b8(\u300cb\u300d\u4e00\u6587\u5b57\u3068\u304b\u3067\u3088\u3044)\u3092\u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u3059\u308b\u30cf\u30f3\u30c9\u30e9\u30fc\u3092\u4f5c\u6210\u3002\nweb.xml\u306a\u3069\u3092\u9069\u5b9c\u8a2d\u5b9a\n\u4ee5\u4e0b\u8a2d\u5b9a\u306e\u5fc5\u8981\u306a\u90e8\u5206\u629c\u7c8b\n\n```xml:web.xml\n    <servlet>\n        <servlet-name>bell</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n    <servlet>\n        <servlet-name>bellWebSocket</servlet-name>\n        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>\n        <load-on-startup>1</load-on-startup>\n    </servlet>\n    <servlet-mapping>\n        <servlet-name>bell</servlet-name>\n        <url-pattern>/bell</url-pattern>\n        <url-pattern>/bell.jsp</url-pattern>\n        <url-pattern>/bell.html</url-pattern>\n        <url-pattern>*.html</url-pattern>\n    </servlet-mapping>\n    <servlet-mapping>\n        <servlet-name>bellWebSocket</servlet-name>\n        <url-pattern>/ws</url-pattern>\n    </servlet-mapping>\n```\n\n```xml:bell-servlet.xml\n    <context:component-scan base-package=\"hoge.bell.controller\" />\n\n    <bean id=\"viewResolver\" class=\"org.springframework.web.servlet.view.UrlBasedViewResolver\">\n        <property name=\"viewClass\" value=\"org.springframework.web.servlet.view.JstlView\" />\n        <property name=\"prefix\" value=\"/WEB-INF/jsp/\" />\n        <property name=\"suffix\" value=\".jsp\" />\n    </bean>\n```\n\n```xml:bellWebSocket-servlet.xml\n    <websocket:handlers>\n        <websocket:mapping path=\"/ws\" handler=\"bellHandler\" />\n    </websocket:handlers>\n\n    <bean id=\"bellHandler\" class=\"hoge.bell.handler.BellHandler\" />\n```\n\n```java:Bell.java\n@Controller\npublic class Bell {\n    @RequestMapping(\"/bell\")\n    public ModelAndView index() {\n        return new ModelAndView(\"bell\");\n    }\n}\n```\n\n```java:BellHandler.java\npublic class BellHandler extends TextWebSocketHandler {\n    /** \u30bb\u30c3\u30b7\u30e7\u30f3\u4e00\u89a7 */\n    private Map<String, WebSocketSession> sessionsMap = new ConcurrentHashMap<String, WebSocketSession>();\n\n    @Override\n    public void afterConnectionEstablished(WebSocketSession session) throws Exception {\n        this.sessionsMap.put(session.getId(), session);\n    }\n\n    @Override\n    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) throws Exception {\n        this.sessionsMap.remove(session.getId());\n    }\n\n    @Override\n    public void handleTextMessage(WebSocketSession session, TextMessage message) throws Exception {\n        String mes = message.getPayload();\n        if (mes.equals(\"a\")) {\n            TextMessage broadcastMessage = new TextMessage(\"b\");\n            for (Entry<String, SessionInfo> entry : this.sessionsMap.entrySet()) {\n                entry.getValue().sendMessage(broadcastMessage);\n            }\n        }\n    }\n}\n```\n\n\u306a\u3069\u3068\u3057\u3066websocket\u306e\u30a2\u30af\u30bb\u30b9\u306b/ws\u3092\u3001\u30da\u30fc\u30b8\u306e\u8868\u793a\u306b/bell\u3092\u5272\u308a\u5f53\u3066\u308b\n##\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9\n\u3053\u3061\u3089\u304c\u4eca\u56de\u306e\u30e1\u30a4\u30f3\nwebsocket\u3092\u751f\u6210\u3057onload\u3067GameApp\u3092run\u3059\u308b\u3002\nonmessage\u306e\u51e6\u7406\u3068phina.js\u3092\u9023\u643a\u3055\u305b\u308b\u3002\n\n```jsp:bell.jsp\n<html>\n<head>\n<script src=\"http://code.jquery.com/jquery-1.11.1.min.js\"></script>\n<script src=\"http://cdn.rawgit.com/phi-jp/phina.js/v0.2.0/build/phina.js\"></script>\n<script src=\"./js/bell.js\"></script>\n</head>\n<body>\n</body>\n</html>\n```\n\n```js:bell.js\n    phina.globalize();\n    var SOUNDS = {\n        sound: {\n            'bell': './se/bell.mp3',\n        },\n    };\n    phina.define('WebsocketGameApp', {\n        superClass: 'GameApp',\n        init: function(params) {\n            this.superInit(params);\n            if (params.ws) {\n                this.ws = params.ws;\n            }\n            if (params.mesHandler) {\n                for (header in params.mesHandler) {\n                    this.addMesHandler(header, params.mesHandler[header]);\n                }\n            }\n        },\n        send: function(mes) {\n            if (this.ws) {\n                this.ws.send(mes);\n            }\n        },\n        addMesHandler: function(header, handler) {\n            this.on('mes' + header, handler);\n        },\n\n        _accessor: {\n            ws: {\n                get: function() { return this._ws; },\n                set: function(ws) {\n                    this._ws = ws;\n                    var that = this;\n                    this._ws.onmessage = function(mes) {\n                        that.flare('mes' + mes, {});\n                    };\n                },\n            },\n        },\n    });\n    phina.define('MainScene', {\n        superClass: 'DisplayScene',\n        init: function(params) {\n            this.superInit(params);\n            var that = this;\n\n            this.bell = Button({\n                text: '\u30d9\u30eb',\n                height: this.gridY.span(2),\n                width: this.gridX.span(5),\n                fontSize: 16,\n            })\n            .addChildTo(this)\n            .setPosition(this.gridX.center(), this.gridY.center());\n            this.bell.onpush = function(){\n                that.app.send('a');\n            };\n        },\n    });\n    phina.main(function() {\n        var ws = new WebSocket(\"ws://yourdomain/contextPath/ws\");\n        // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u751f\u6210\n        var app = WebsocketGameApp({\n            startLabel: 'main', // \u30e1\u30a4\u30f3\u30b7\u30fc\u30f3\u304b\u3089\u958b\u59cb\u3059\u308b\n            assets: $.extend(true, {}, SOUNDS),\n            ws: ws,\n            mesHandler: {\n                b: function() {\n                    AssetManager.get(\"sound\", \"bell\").play();\n                },\n            },\n        });\n        ws.onopen = function() {\n            // \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\n            app.run();\n        };\n        ws.onclose = function() {};\n        ws.onerror = function(e) {\n            alert(\"\u30a8\u30e9\u30fc\");\n        };\n    });\n```\n\n\u4eca\u56de\u306e\u5b9f\u88c5\u3067\u306f\u65b0\u305f\u306bWebsocketGameApp\u3092\u5b9a\u7fa9\u3057\u305f\u3002\nmesHandler\u306b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6e21\u3057\u3066\u3084\u308a\u3001\u30ad\u30fc\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u305f\u969b\u306b\u884c\u3046\u51e6\u7406\u3092\u30d0\u30ea\u30e5\u30fc\u306b\u6e21\u3059\u3002\n\u3053\u308c\u306f\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u3088\u308b\u51e6\u7406\u306e\u5224\u5b9a\u3092\u5916\u90e8\u304b\u3089\u6ce8\u5165\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3001\nGameApp\u5185\u90e8\u3067\u898f\u5b9a\u3057\u3066\u3057\u307e\u3063\u3066\u3082\u554f\u984c\u306f\u306a\u3044\u3002\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u3057\u3066\u304f\u308b\u5185\u5bb9\u304c\u30d8\u30c3\u30c0\u30fc\u3068\u30dc\u30c7\u30a3\u30fc\u306b\u5206\u304b\u308c\u3066\u30dc\u30c7\u30a3\u30fc\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u3066\u3084\u308a\u305f\u3044\u5834\u5408\u306fws\u306e\u30bb\u30c3\u30bf\u30fc\u3092\n\n```js:bell.js\n                set: function(ws) {\n                    this._ws = ws;\n                    var that = this;\n                    this._ws.onmessage = function(mes) {\n                        var header = mes.split(SEPARATOR)[0];\n                        var body = mes.split(SEPARATOR)[1];\n                        that.flare('mes' + header, {\n                            body: body,\n                        });\n                    };\n                },\n```\n\n\u306a\u3069\u3068\u5909\u3048\u3066\u3084\u308ahandler\u306e\u5f15\u6570\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u53d7\u3051\u53d6\u308b\n\n```js:bell.js\n            mesHandler: {\n                sound: function(arg) {\n                    // \u3053\u3053\u3067\u306f\u5f15\u6570\u306b\u97f3\u306e\u7a2e\u985e\u3092\u8868\u3059\u6587\u5b57\u5217\u304c\u5165\u3063\u3066\u304f\u308b\u3082\u306e\u3068\u3059\u308b\u3002\n                    // \u4e0a\u8a18\u30d9\u30eb\u3068\u540c\u3058\u51e6\u7406\u306a\u3089\u3070SEPARATOR = \",\"\u306e\u5834\u5408\u300csound,bell\u300d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6e21\u3055\u308c\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3042\u308b\u3002\n                    AssetManager.get(\"sound\", arg.body).play();\n                },\n            },\n```\n\n\u4eca\u56de\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306ebody\u3068\u3057\u3066\u6e21\u3057\u3066\u3044\u308b\u304c\u3001\u30dc\u30c7\u30a3\u3092\u305d\u306e\u307e\u307e\u6e21\u3057\u3066\u3082\u3088\u3044\u3002\n\n", "tags": ["phina.js", "websocket", "spring-framework"]}