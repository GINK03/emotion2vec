{"context": "\n\n\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u3092\u96c6\u3081\u305f\u3044\niOS\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u52d5\u304d\u3092\u30ed\u30b0\u3068\u3057\u3066\u96c6\u7a4d\u3057\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u65b9\u6cd5\u3068\u3057\u3066AWS\u306eCognito\u3067Temporary Credentials\u3092\u5404\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u767a\u884c\u3057\u3066\u3001Kinesis Firehose\u306b\u96c6\u3081\u305f\u3044\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066S3\u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\nKinesis Firehose\uff08\u4ee5\u4e0bFirehose\uff09\u3092\u4f7f\u3046\u3068Kinesis Stream\uff08\u5f93\u6765\u306eKinesis: \u4ee5\u4e0bKinesis\uff09\u3068\u7570\u306a\u308a\u3001\u3044\u304d\u306a\u308aS3\u3084Red Shift\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3067\u304d\u308b\u306e\u304c\u7279\u5fb4\u3067\u3059\u3002\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\nAWS\u306eiOS developer guide\n\u3053\u308c\u306fKinesis\u3068Firehose\u306e\u3075\u305f\u3064\u306b\u95a2\u3057\u3066\u5b9f\u88c5\u624b\u9806\u304c\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304cObjective-C\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002Objective-C\u306b\u306f\u99b4\u67d3\u307f\u304c\u3042\u307e\u308a\u306a\u304b\u3063\u305f\u306e\u3067\u3053\u308c\u3060\u3051\u3067\u306f\u5b9f\u88c5\u5b8c\u4e86\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\nclassmethod\u3055\u3093\u306e\u8a18\u4e8b\n\u30b3\u30f3\u30bd\u30fc\u30eb\u753b\u9762\u3067\u306e\u624b\u9806\u3082\u66f8\u3044\u3066\u3042\u308a\u3001\u3053\u308c\u306b\u6cbf\u3063\u3066\u3044\u3051\u3070Kinesis\u306e\u5c0e\u5165\u307e\u3067\u306f\u3059\u3050\u3044\u3051\u305d\u3046\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u30b3\u30fc\u30c9\u306fSwift3\u3067\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u81ea\u5206\u3067\u4fee\u6b63\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u70b9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n\n\u30cf\u30de\u3063\u305f\u3068\u3053\u308d\n\n1, \u30e6\u30fc\u30b6\u30fc\u30ed\u30fc\u30eb\u306b\u7d10\u3065\u304f\u6a29\u9650\u5468\u308a\uff08IAM\uff09\n\n1, Cognito\u306e\u6a29\u9650\nCognito\u306b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a29\u9650\u306b\u52a0\u3048\u3066Firehose\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6a29\u9650\uff08\u6700\u4f4e\u3067\u3082PutRecord, PutRecordBatch\uff09\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002Cognito\u306eFederated Identities\u306e\u307b\u3046\u3067Edit Identity Pool\u3092\u9078\u629e\u3057\u3066\u6a29\u9650\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n\uff08Firehose\u306fTokyo\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u307e\u3060\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067Cognito\u3082Firehose\u3082\u30d0\u30fc\u30b8\u30cb\u30a2\u306b\u3057\u307e\u3057\u305f\u3002\uff09\nAuthenticated Role\u3068Unauthenticated Role\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u6a29\u9650\u3092\u898b\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u30c7\u30d5\u30a9\u30eb\u30c8.\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"mobileanalytics:PutEvents\",\n                \"cognito-sync:*\",\n                \"cognito-identity:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n\n\n\u3053\u308c\u306bIAM\u753b\u9762\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u304c\u3042\u308b\u306e\u3067\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\nAmazonKinesisFirehoseFullAccess.\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"firehose:*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n\n2, Firehose\u306e\u6a29\u9650\n\u3053\u308c\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6e96\u5099\u3055\u308c\u308b\u3084\u3064\u306b\n{\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"firehose:PutRecord\",\n                \"firehose:PutRecordBatch\"\n            ],\n            \"Resource\": [\n                \"arn:aws:firehose:us-east-1:account-id:deliverystream/delivery-stream-name\"\n            ]\n        }\n\n\u3092\u4ed8\u3051\u52a0\u3048\u307e\u3057\u305f\u3002\nIAM Simulator\u3067\u78ba\u304b\u3081\u306a\u304c\u3089\u3084\u308b\u3068\u78ba\u5b9f\u3067\u3059\u3002\n\n2, iOS\u306esubmitAllRecords() \u306e\u3068\u3053\u308d\nFirehose\u306b\u95a2\u3059\u308b\u8a18\u4e8b\u306f\u5c11\u306a\u304f\u3066Swift3\u3067\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u308f\u304b\u308a\u306b\u304f\u304b\u3063\u305f\u3067\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u5b9f\u88c5\u3057\u3066\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\u5b9f\u969b\u306f\u3053\u308c\u3089\u3092\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\nAppDelegate.swift\n\nimport AWSCore\nimport AWSCognito\nimport AWSKinesis\n\n////\n\nfunc application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {\n\n    ////\n    configureAWSCognito()\n\n    ////\n\n    return true\n}\n\nfunc configureAWSCognito() {\n    // Settings for AWSCognito\n    let credentialsProvider = AWSCognitoCredentialsProvider(regionType: .usEast1, identityPoolId: \"us-east-1:00000000-xxxx-0000-0000-xxxxxxxxxxxx\")\n    let configuration = AWSServiceConfiguration(region:.usEast1, credentialsProvider:credentialsProvider)\n\n    AWSFirehoseRecorder.register(with: configuration, forKey: \"FirehoseName\")\n\n    AWSServiceManager.default().defaultServiceConfiguration = configuration\n    updateIdentifier()\n}\n\nfunc updateIdentifier() {\n    // Settings for AWSCognito\n    let credentialsProvider = AWSCognitoCredentialsProvider(regionType: .usEast1, identityPoolId: \"us-east-1:00000000-xxxx-0000-0000-xxxxxxxxxxxx\")\n    credentialsProvider.getIdentityId().continue({ (task: AWSTask!) -> Any! in\n        if (task.error != nil) {\n            print(\"Error: \" + task.error!.localizedDescription)\n        }\n        else {\n            // the task result will contain the identity id\n            self.cognitoId = task.result as? String\n            // print(\"CognitoId: \")\n            // print(task.result as? String)\n        }\n        return nil\n    })\n}\n\n\n\n\n\n\u30c7\u30fc\u30bf\u3092\u9001\u308b\u5834\u6240.swift\n\n    func record(data: [Data]) {\n        guard  let firehoseRecorder = AWSFirehoseRecorder.default() else { return }\n\n        let tasks: [AWSTask] = data.map { firehoseRecorder.saveRecord($0, streamName: \"FirehoseName\") }\n\n        let task = AWSTask(forCompletionOfAllTasks: tasks).continue(successBlock: { (task: AWSTask<AnyObject>) in\n\n            return firehoseRecorder.submitAllRecords()\n        })\n\n        task.continue({ [weak self] (task: AWSTask<AnyObject>) in\n            switch task.error {\n            case let .some(error):\n                print(\"Error: \\(error)\")\n            case .none:\n                print(\"FirehoseRecorded\")\n            }\n\n            return nil\n        })\n    }\n\n\n\u7279\u306b\u30cf\u30de\u3063\u305f\u306e\u306f\u53c2\u8003\u306b\u3057\u3066\u3044\u305f\u30da\u30fc\u30b8\u306e\nAWSTask(forCompletionOfAllTasks: tasks).continueWithSuccessBlock { task -> AnyObject? in\n    recorder.submitAllRecords()\n}.continueWithBlock { task -> AnyObject? in\n    if let err = task.error {\n        NSLog(\"Error: [%@]\", err)\n    }\n    return nil\n}\n\n\u306e\u90e8\u5206\u3092\nlet task = AWSTask(forCompletionOfAllTasks: tasks).continue(successBlock: { (task: AWSTask<AnyObject>) in\n\n    return firehoseRecorder.submitAllRecords()\n})\n\ntask.continue({ [weak self] (task: AWSTask<AnyObject>) in\n    switch task.error {\n    case let .some(error):\n        print(\"Error: \\(error)\")\n    case .none:\n        print(\"FirehoseRecorded\")\n    }\n\n    return nil\n})\n\n\u3068continue\u3092\u5206\u5272\u3057\u305f\u70b9\u3067\u3059\u3002\n\u3053\u308c\u3067S3\u306b\u6b32\u3057\u3044\u30ed\u30b0\u3092\u305f\u3081\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n#\u30e6\u30fc\u30b6\u30fc\u306e\u30ed\u30b0\u3092\u96c6\u3081\u305f\u3044\niOS\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u52d5\u304d\u3092\u30ed\u30b0\u3068\u3057\u3066\u96c6\u7a4d\u3057\u305f\u3044\u306e\u3067\u3001\u305d\u306e\u65b9\u6cd5\u3068\u3057\u3066AWS\u306eCognito\u3067Temporary Credentials\u3092\u5404\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u767a\u884c\u3057\u3066\u3001Kinesis Firehose\u306b\u96c6\u3081\u305f\u3044\u30c7\u30fc\u30bf\u3092\u6e21\u3057\u3066S3\u306b\u4fdd\u5b58\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nKinesis Firehose\uff08\u4ee5\u4e0bFirehose\uff09\u3092\u4f7f\u3046\u3068Kinesis Stream\uff08\u5f93\u6765\u306eKinesis: \u4ee5\u4e0bKinesis\uff09\u3068\u7570\u306a\u308a\u3001\u3044\u304d\u306a\u308aS3\u3084Red Shift\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3067\u304d\u308b\u306e\u304c\u7279\u5fb4\u3067\u3059\u3002\n\n#\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\n- [AWS\u306eiOS developer guide](http://docs.aws.amazon.com/mobile/sdkforios/developerguide/kinesis.html)\n\u3053\u308c\u306fKinesis\u3068Firehose\u306e\u3075\u305f\u3064\u306b\u95a2\u3057\u3066\u5b9f\u88c5\u624b\u9806\u304c\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304cObjective-C\u3067\u8a18\u8ff0\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002Objective-C\u306b\u306f\u99b4\u67d3\u307f\u304c\u3042\u307e\u308a\u306a\u304b\u3063\u305f\u306e\u3067\u3053\u308c\u3060\u3051\u3067\u306f\u5b9f\u88c5\u5b8c\u4e86\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n- [classmethod\u3055\u3093\u306e\u8a18\u4e8b](http://dev.classmethod.jp/cloud/aws/kinesis-stream-ios/)\n\u30b3\u30f3\u30bd\u30fc\u30eb\u753b\u9762\u3067\u306e\u624b\u9806\u3082\u66f8\u3044\u3066\u3042\u308a\u3001\u3053\u308c\u306b\u6cbf\u3063\u3066\u3044\u3051\u3070*Kinesis*\u306e\u5c0e\u5165\u307e\u3067\u306f\u3059\u3050\u3044\u3051\u305d\u3046\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u30b3\u30fc\u30c9\u306fSwift3\u3067\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u81ea\u5206\u3067\u4fee\u6b63\u3057\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u70b9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n#\u30cf\u30de\u3063\u305f\u3068\u3053\u308d\n##1, \u30e6\u30fc\u30b6\u30fc\u30ed\u30fc\u30eb\u306b\u7d10\u3065\u304f\u6a29\u9650\u5468\u308a\uff08IAM\uff09\n###1, Cognito\u306e\u6a29\u9650\nCognito\u306b\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u6a29\u9650\u306b\u52a0\u3048\u3066Firehose\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u6a29\u9650\uff08\u6700\u4f4e\u3067\u3082`PutRecord`, `PutRecordBatch`\uff09\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002Cognito\u306eFederated Identities\u306e\u307b\u3046\u3067Edit Identity Pool\u3092\u9078\u629e\u3057\u3066\u6a29\u9650\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n<img width=\"1432\" alt=\"Screen Shot 2016-11-28 at 23.31.24.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/122365/10e91bef-bfd5-4209-c730-a453b3640090.png\">\n\uff08Firehose\u306fTokyo\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u307e\u3060\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067Cognito\u3082Firehose\u3082\u30d0\u30fc\u30b8\u30cb\u30a2\u306b\u3057\u307e\u3057\u305f\u3002\uff09\n\nAuthenticated Role\u3068Unauthenticated Role\u306b\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u6a29\u9650\u3092\u898b\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n```\u30c7\u30d5\u30a9\u30eb\u30c8.\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"mobileanalytics:PutEvents\",\n                \"cognito-sync:*\",\n                \"cognito-identity:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\n```\n\n\u3053\u308c\u306bIAM\u753b\u9762\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30dd\u30ea\u30b7\u30fc\u304c\u3042\u308b\u306e\u3067\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\n\n```AmazonKinesisFirehoseFullAccess.\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Action\": [\n                \"firehose:*\"\n            ],\n            \"Effect\": \"Allow\",\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n###2, Firehose\u306e\u6a29\u9650\n\u3053\u308c\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u6e96\u5099\u3055\u308c\u308b\u3084\u3064\u306b\n\n```\n{\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"firehose:PutRecord\",\n                \"firehose:PutRecordBatch\"\n            ],\n            \"Resource\": [\n                \"arn:aws:firehose:us-east-1:account-id:deliverystream/delivery-stream-name\"\n            ]\n        }\n```\n\n\u3092\u4ed8\u3051\u52a0\u3048\u307e\u3057\u305f\u3002\n\n[IAM Simulator](https://policysim.aws.amazon.com/home/index.jsp?#users)\u3067\u78ba\u304b\u3081\u306a\u304c\u3089\u3084\u308b\u3068\u78ba\u5b9f\u3067\u3059\u3002\n\n##2, iOS\u306e`submitAllRecords()` \u306e\u3068\u3053\u308d\n\nFirehose\u306b\u95a2\u3059\u308b\u8a18\u4e8b\u306f\u5c11\u306a\u304f\u3066Swift3\u3067\u306f\u3069\u3046\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u308f\u304b\u308a\u306b\u304f\u304b\u3063\u305f\u3067\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067\u5b9f\u88c5\u3057\u3066\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\u5b9f\u969b\u306f\u3053\u308c\u3089\u3092\u30b7\u30f3\u30b0\u30eb\u30c8\u30f3\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\n```AppDelegate.swift\n\nimport AWSCore\nimport AWSCognito\nimport AWSKinesis\n\n////\n\nfunc application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?) -> Bool {\n\n    ////\n    configureAWSCognito()\n    \n    ////\n\n    return true\n}\n\nfunc configureAWSCognito() {\n    // Settings for AWSCognito\n    let credentialsProvider = AWSCognitoCredentialsProvider(regionType: .usEast1, identityPoolId: \"us-east-1:00000000-xxxx-0000-0000-xxxxxxxxxxxx\")\n    let configuration = AWSServiceConfiguration(region:.usEast1, credentialsProvider:credentialsProvider)\n        \n    AWSFirehoseRecorder.register(with: configuration, forKey: \"FirehoseName\")\n        \n    AWSServiceManager.default().defaultServiceConfiguration = configuration\n    updateIdentifier()\n}\n    \nfunc updateIdentifier() {\n    // Settings for AWSCognito\n    let credentialsProvider = AWSCognitoCredentialsProvider(regionType: .usEast1, identityPoolId: \"us-east-1:00000000-xxxx-0000-0000-xxxxxxxxxxxx\")\n    credentialsProvider.getIdentityId().continue({ (task: AWSTask!) -> Any! in\n        if (task.error != nil) {\n            print(\"Error: \" + task.error!.localizedDescription)\n        }\n        else {\n            // the task result will contain the identity id\n            self.cognitoId = task.result as? String\n            // print(\"CognitoId: \")\n            // print(task.result as? String)\n        }\n        return nil\n    })\n}\n\n\n```\n\n```\u30c7\u30fc\u30bf\u3092\u9001\u308b\u5834\u6240.swift\n\n    func record(data: [Data]) {\n        guard  let firehoseRecorder = AWSFirehoseRecorder.default() else { return }\n\n        let tasks: [AWSTask] = data.map { firehoseRecorder.saveRecord($0, streamName: \"FirehoseName\") }\n        \n        let task = AWSTask(forCompletionOfAllTasks: tasks).continue(successBlock: { (task: AWSTask<AnyObject>) in\n            \n            return firehoseRecorder.submitAllRecords()\n        })\n        \n        task.continue({ [weak self] (task: AWSTask<AnyObject>) in\n            switch task.error {\n            case let .some(error):\n                print(\"Error: \\(error)\")\n            case .none:\n                print(\"FirehoseRecorded\")\n            }\n          \n            return nil\n        })\n    }\n```\n\n\n\u7279\u306b\u30cf\u30de\u3063\u305f\u306e\u306f\u53c2\u8003\u306b\u3057\u3066\u3044\u305f\u30da\u30fc\u30b8\u306e\n\n    AWSTask(forCompletionOfAllTasks: tasks).continueWithSuccessBlock { task -> AnyObject? in\n        recorder.submitAllRecords()\n    }.continueWithBlock { task -> AnyObject? in\n        if let err = task.error {\n            NSLog(\"Error: [%@]\", err)\n        }\n        return nil\n    }\n\n\u306e\u90e8\u5206\u3092\n\n    let task = AWSTask(forCompletionOfAllTasks: tasks).continue(successBlock: { (task: AWSTask<AnyObject>) in\n           \n        return firehoseRecorder.submitAllRecords()\n    })\n        \n    task.continue({ [weak self] (task: AWSTask<AnyObject>) in\n        switch task.error {\n        case let .some(error):\n            print(\"Error: \\(error)\")\n        case .none:\n            print(\"FirehoseRecorded\")\n        }\n          \n        return nil\n    })\n\n\u3068continue\u3092\u5206\u5272\u3057\u305f\u70b9\u3067\u3059\u3002\n\n\u3053\u308c\u3067S3\u306b\u6b32\u3057\u3044\u30ed\u30b0\u3092\u305f\u3081\u3089\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n", "tags": ["swift3", "AWS", "Kinesis", "Firehose", "Swift"]}