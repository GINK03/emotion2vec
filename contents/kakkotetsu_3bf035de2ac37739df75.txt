{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\n\u672c\u9805\u3067\u3084\u308b\u3053\u3068\ntarget \u306b python \u304c\u5165\u3063\u3066\u3044\u306a\u304f\u3066\u3082 ssh \u63a5\u7d9a\u53ef\u80fd\u306a\u3089\u3070 Ansible \u3067\u4e00\u5fdc\u5236\u5fa1\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u8efd\u304f\u78ba\u8a8d\u3057\u307e\u3059\u3002\nLinux \u30d9\u30fc\u30b9\u3067\u306f\u306a\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668(Cisco IOS etc)\u306a\u3069\u3067\u4f7f\u3048\u308b\u7b48\u3067\u3059\u3002\n\n\u6c17\u3092\u3064\u3051\u308b\u3053\u3068(\u2252\u7d50\u8ad6)\n\u4ee5\u4e0b\u3092\u6e80\u305f\u305b\u3070\u3044\u3051\u308b\u7b48\u3067\u3059\u3002\n\n\ngather_facts \u306f no \u306b\u3059\u308b\u3053\u3068\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c module \u306f raw \u3092\u4f7f\u3046\u3053\u3068 (shell \u3084 command \u3067\u306f\u306a\u3044)\n\nssh \u306e command \u3067 target \u306b\u30ea\u30e2\u30fc\u30c8\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\n\n\n\u53c2\u8003\u60c5\u5831(\u516c\u5f0f\u3088\u308a)\n\u4f55\u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c module \u3068\u3057\u3066 raw \u3092\u4f7f\u3046\u306e\u304b\n\nraw \u30e2\u30b8\u30e5\u30fc\u30eb\n\nAnsible \u306e config \u30d5\u30a1\u30a4\u30eb\u3067\u4f7f\u3048\u308b ssh \u7cfb\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u8a2d\u5b9a\n\nParamiko Specific Settings\nOpenSSH Specific Settings\n\n\n\u74b0\u5883\u60c5\u5831\n\nAnsible\n\nOS\uff1aUbuntu-14.04.01-server-amd64\nansible\uff1a1.8.2\n\n\ntarget device (NW\u6a5f\u5668)\nPython \u304c\u5165\u3063\u3066\u3044\u306a\u3044 NW \u6a5f\u5668\u4ee3\u8868\u3068\u3057\u3066 Juniper Firefly \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nFreeBSD \u30d9\u30fc\u30b9\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3002\n\nOS\uff1a12.1X47-D10.4\n\n\n\u30b5\u30f3\u30d7\u30eb\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb/Playbook\n\nhosts\n\u5b9f\u884c\u6642\u306b --ask-pass \u3068\u304b\u4f7f\u3063\u305f\u308a\u3001\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u305f\u308a\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u30d9\u30bf\u66f8\u304d\u306f\u56de\u907f\u53ef\u80fd\u3067\u3059\u3002\n\nhosts\n[junos]\n192.168.101.70\n\n[junos:vars]\nansible_ssh_user=kotetsu\nansible_ssh_pass=kotetsu\n\n\n\nansible.cfg\nssh \u63a5\u7d9a\u306b Paramiko \u3068 OpenSSH \u306e\u3044\u305a\u308c\u3092\u4f7f\u3046\u304b\u3001\u3068\u3044\u3046\u8a71\u304c\u3042\u308a\u307e\u3059\u304c\u2026\u4eca\u56de\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8c4a\u5bcc\u306a OpenSSH \u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nansible.cfg\n[defaults]\ntransport=ssh\n\n[ssh_connection]\nssh_args= -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ControlMaster=no -o ControlPersist=60s\nscp_if_ssh=false\n\n\n\nPlaybook\n\u5358\u7d14\u306b ssh \u306e command \u3067 show version | no-more \u3092\u5b9f\u884c\u3057\u3066\u3001\u7d50\u679c\u3092 debug \u3067\u8868\u793a\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u3002\n\nplaybook_junos.yml\n- name: not support Python node\n  hosts: junos\n  gather_facts: no\n  sudo: false\n\n  tasks:\n    - name: show version\n      raw: show version | no-more\n      register: output_show_version\n\n    - debug: var=output_show_version\n\n\n\n\u5b9f\u884c\u4f8b\n\n\u5b9f\u884c\u4f8b\n$ ansible-playbook playbook_junos.yml -i hosts\n\nPLAY [not support Python node] ************************************************\n\nTASK: [show version] **********************************************************\nok: [192.168.101.70]\n\nTASK: [debug var=output_show_version] *****************************************\nok: [192.168.101.70] => {\n    \"output_show_version\": {\n        \"invocation\": {\n            \"module_args\": \"show version | no-more\",\n            \"module_name\": \"raw\"\n        },\n        \"rc\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"Could not chdir to home directory /var/home/kotetsu: No such file or directory\\r\\nHostname: fw01\\r\\nModel: firefly-perimeter\\r\\nJUNOS Software Release [12.1X47-D10.4]\\r\\n\",\n        \"stdout_lines\": [\n            \"Could not chdir to home directory /var/home/kotetsu: No such file or directory\",\n            \"Hostname: fw01\",\n            \"Model: firefly-perimeter\",\n            \"JUNOS Software Release [12.1X47-D10.4]\"\n        ]\n    }\n}\n\nPLAY RECAP ********************************************************************\n192.168.101.70             : ok=2    changed=0    unreachable=0    failed=0\n\n\n\n\u96d1\u8a18\n\nssh \u3067 command exec \u3067\u304d\u306a\u3044\u6a5f\u5668\u3082\u305d\u308c\u306a\u308a\u306b\u3042\u308b\u7b48(\u624b\u5143\u3067\u306f Yamaha RTX1200 \u304c\u8a72\u5f53)\u2026\u305d\u306e\u5834\u5408\u306b\u306f\u672c\u65b9\u5f0f\u306f\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001\u81ea\u524d\u3067 role \u3092\u4f5c\u308b\u3068\u304b\u3001Ansible \u4ee5\u5916\u306e\u624b\u6cd5(e.x. \u5fc5\u6bba\u306e expect)\u3092\u4f7f\u3046\u3068\u304b\u306b\u306a\u308b\u7b48\n\u4f8b\u3068\u3057\u3066 Junos \u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u306a\u3089 netconf \u3092\u4f7f\u3048\u308b\u306e\u3067(2015/02 \u73fe\u5728\u3001\u516c\u5f0f\u304c\u51fa\u3057\u3066\u3044\u308b role \u306f\u8ca7\u5f31\u3067\u3059\u304c)\u672c\u9805\u306e\u3088\u3046\u306a\u3084\u308a\u65b9\u306f\u3042\u307e\u308a\u3057\u306a\u3044\u7b48\n\u672c\u9805\u306e\u3084\u308a\u65b9\u306f\u3001\u3042\u304f\u307e\u3067 exec \u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u8a2d\u5b9a\u6295\u5165\u3068\u304b\u306f tftp \u30b5\u30fc\u30d0\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092 copy \u3057\u3066\u2026\u7684\u306a\u624b\u6cd5\u306b\u306a\u308a\u305d\u3046\n\n# \u6982\u8981\n\n## \u672c\u9805\u3067\u3084\u308b\u3053\u3068\n\ntarget \u306b python \u304c\u5165\u3063\u3066\u3044\u306a\u304f\u3066\u3082 ssh \u63a5\u7d9a\u53ef\u80fd\u306a\u3089\u3070 Ansible \u3067\u4e00\u5fdc\u5236\u5fa1\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3092\u8efd\u304f\u78ba\u8a8d\u3057\u307e\u3059\u3002\nLinux \u30d9\u30fc\u30b9\u3067\u306f\u306a\u3044\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668(Cisco IOS etc)\u306a\u3069\u3067\u4f7f\u3048\u308b\u7b48\u3067\u3059\u3002\n\n## \u6c17\u3092\u3064\u3051\u308b\u3053\u3068(\u2252\u7d50\u8ad6)\n\n\u4ee5\u4e0b\u3092\u6e80\u305f\u305b\u3070\u3044\u3051\u308b\u7b48\u3067\u3059\u3002\n\n* `gather_facts` \u306f `no` \u306b\u3059\u308b\u3053\u3068\n* \u30b3\u30de\u30f3\u30c9\u5b9f\u884c module \u306f `raw` \u3092\u4f7f\u3046\u3053\u3068 (`shell` \u3084 `command` \u3067\u306f\u306a\u3044)\n* `ssh` \u306e `command` \u3067 target \u306b\u30ea\u30e2\u30fc\u30c8\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3067\u304d\u308b\u3053\u3068\n\n## \u53c2\u8003\u60c5\u5831(\u516c\u5f0f\u3088\u308a)\n\n\u4f55\u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c module \u3068\u3057\u3066 `raw` \u3092\u4f7f\u3046\u306e\u304b\n\n* [raw \u30e2\u30b8\u30e5\u30fc\u30eb](http://docs.ansible.com/raw_module.html)\n\nAnsible \u306e config \u30d5\u30a1\u30a4\u30eb\u3067\u4f7f\u3048\u308b ssh \u7cfb\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u8a2d\u5b9a\n\n* [Paramiko Specific Settings](http://docs.ansible.com/intro_configuration.html#paramiko-specific-settings)\n* [OpenSSH Specific Settings](http://docs.ansible.com/intro_configuration.html#openssh-specific-settings)\n\n\n# \u74b0\u5883\u60c5\u5831\n\n## Ansible\n\n* OS\uff1aUbuntu-14.04.01-server-amd64\n* ansible\uff1a1.8.2\n\n## target device (NW\u6a5f\u5668)\n\nPython \u304c\u5165\u3063\u3066\u3044\u306a\u3044 NW \u6a5f\u5668\u4ee3\u8868\u3068\u3057\u3066 Juniper Firefly \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nFreeBSD \u30d9\u30fc\u30b9\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3002\n\n* OS\uff1a12.1X47-D10.4\n\n\n# \u30b5\u30f3\u30d7\u30eb\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb/Playbook\n\n### hosts\n\n\u5b9f\u884c\u6642\u306b `--ask-pass` \u3068\u304b\u4f7f\u3063\u305f\u308a\u3001\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u305f\u308a\u3067\u30d1\u30b9\u30ef\u30fc\u30c9\u30d9\u30bf\u66f8\u304d\u306f\u56de\u907f\u53ef\u80fd\u3067\u3059\u3002\n\n```bash:hosts\n[junos]\n192.168.101.70\n\n[junos:vars]\nansible_ssh_user=kotetsu\nansible_ssh_pass=kotetsu\n```\n\n### ansible.cfg\n\nssh \u63a5\u7d9a\u306b Paramiko \u3068 OpenSSH \u306e\u3044\u305a\u308c\u3092\u4f7f\u3046\u304b\u3001\u3068\u3044\u3046\u8a71\u304c\u3042\u308a\u307e\u3059\u304c\u2026\u4eca\u56de\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u8c4a\u5bcc\u306a OpenSSH \u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash:ansible.cfg\n[defaults]\ntransport=ssh\n\n[ssh_connection]\nssh_args= -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o ControlMaster=no -o ControlPersist=60s\nscp_if_ssh=false\n```\n\n### Playbook\n\n\u5358\u7d14\u306b ssh \u306e command \u3067 `show version | no-more` \u3092\u5b9f\u884c\u3057\u3066\u3001\u7d50\u679c\u3092 debug \u3067\u8868\u793a\u3055\u305b\u308b\u3060\u3051\u3067\u3059\u3002\n\n```bash:playbook_junos.yml\n- name: not support Python node\n  hosts: junos\n  gather_facts: no\n  sudo: false\n\n  tasks:\n    - name: show version\n      raw: show version | no-more\n      register: output_show_version\n\n    - debug: var=output_show_version\n```\n\n## \u5b9f\u884c\u4f8b\n\n```bash:\u5b9f\u884c\u4f8b\n$ ansible-playbook playbook_junos.yml -i hosts\n\nPLAY [not support Python node] ************************************************\n\nTASK: [show version] **********************************************************\nok: [192.168.101.70]\n\nTASK: [debug var=output_show_version] *****************************************\nok: [192.168.101.70] => {\n    \"output_show_version\": {\n        \"invocation\": {\n            \"module_args\": \"show version | no-more\",\n            \"module_name\": \"raw\"\n        },\n        \"rc\": 0,\n        \"stderr\": \"\",\n        \"stdout\": \"Could not chdir to home directory /var/home/kotetsu: No such file or directory\\r\\nHostname: fw01\\r\\nModel: firefly-perimeter\\r\\nJUNOS Software Release [12.1X47-D10.4]\\r\\n\",\n        \"stdout_lines\": [\n            \"Could not chdir to home directory /var/home/kotetsu: No such file or directory\",\n            \"Hostname: fw01\",\n            \"Model: firefly-perimeter\",\n            \"JUNOS Software Release [12.1X47-D10.4]\"\n        ]\n    }\n}\n\nPLAY RECAP ********************************************************************\n192.168.101.70             : ok=2    changed=0    unreachable=0    failed=0\n```\n\n# \u96d1\u8a18\n\n* ssh \u3067 command exec \u3067\u304d\u306a\u3044\u6a5f\u5668\u3082\u305d\u308c\u306a\u308a\u306b\u3042\u308b\u7b48(\u624b\u5143\u3067\u306f Yamaha RTX1200 \u304c\u8a72\u5f53)\u2026\u305d\u306e\u5834\u5408\u306b\u306f\u672c\u65b9\u5f0f\u306f\u4f7f\u3048\u306a\u3044\u306e\u3067\u3001\u81ea\u524d\u3067 role \u3092\u4f5c\u308b\u3068\u304b\u3001Ansible \u4ee5\u5916\u306e\u624b\u6cd5(e.x. \u5fc5\u6bba\u306e expect)\u3092\u4f7f\u3046\u3068\u304b\u306b\u306a\u308b\u7b48\n* \u4f8b\u3068\u3057\u3066 Junos \u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u308c\u306a\u3089 netconf \u3092\u4f7f\u3048\u308b\u306e\u3067(2015/02 \u73fe\u5728\u3001\u516c\u5f0f\u304c\u51fa\u3057\u3066\u3044\u308b role \u306f\u8ca7\u5f31\u3067\u3059\u304c)\u672c\u9805\u306e\u3088\u3046\u306a\u3084\u308a\u65b9\u306f\u3042\u307e\u308a\u3057\u306a\u3044\u7b48\n* \u672c\u9805\u306e\u3084\u308a\u65b9\u306f\u3001\u3042\u304f\u307e\u3067 exec \u3057\u3066\u3044\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u8a2d\u5b9a\u6295\u5165\u3068\u304b\u306f tftp \u30b5\u30fc\u30d0\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u3092 copy \u3057\u3066\u2026\u7684\u306a\u624b\u6cd5\u306b\u306a\u308a\u305d\u3046\n", "tags": ["Ansible1.8.2", "Network", "junos12.1X47-D10.4", "juniper"]}