{"context": " More than 1 year has passed since last update.CentOS6.3\u306bnode+nginx\u306e\u74b0\u5883\u3092\u7528\u610f\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u305d\u306e\u898b\u805e\u9332\u3067\u3059\u3002\n\n\u307e\u305a\u306fnode\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo yum install nodejs\n\n\u3053\u308c\u3060\u3051\u3067\u304ak\u3067\u3059\u3002\n\u3000\n2. \u6b21\u306bnpm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo curl https://npmjs.org/install.sh | sh\n\n\u3000\n3. \u3053\u3053\u3067\u3061\u3083\u3093\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n$ type node\nnode is /usr/bin/node\n\n$ type npm\nnpm is /usr/bin/npm\n\n\u3053\u308c\u3067\u3061\u3083\u3093\u3068\u5165\u3063\u3066\u3044\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u306d\u3002\n\u3000\n4. nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u305f\u3081\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6e96\u5099\n$ sudo /etc/yum.repos.d/nginx.conf\n\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/6/$basearch/\ngpgcheck=0\nenabled=1\n\n\u3000\n5. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install nginx\n\n\u3000\n6. nginx\u306econfig\u30d5\u30a1\u30a4\u30eb\u306e\u3078\u306e\u5909\u66f4\n$ sudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/hoge.polidog.jp.conf\n$ sudo vim /etc/nginx/conf.d/hoge.polidog.jp.conf\n\nupstream backend_node {\n    ip_hash;\n    server 127.0.0.1:3000;\n}\n\nserver {\n    listen       80;\n    server_name  hoge.polidog.jp;\n    root /path/to/hoge  \n\n    #charset koi8-r;\n    charset utf-8;\n    access_log /var/log/nginx/access_hoge.poidog.jp.log main;\n    error_log /var/log/nginx/errror_hoge.polidog.jp.log;\n\n    location / {\n        if (-f $request_filename) {\n            break;\n        }\n\n\n        if ( !-f $request_filename ) {\n            proxy_pass http://backend_node;\n            break;\n        }\n    }\n\n}\n\n\u3053\u308c\u3067\u3084\u3063\u3068nginx\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u3000\n7. nginx\u518d\u8d77\u52d5\n$ sudo /etc/init.d/nginx restart\n\n\u305f\u3060\u3053\u308c\u3060\u3068\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u3066\u3002\u3002\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u304c\u3046\u307e\u304f\u884c\u304b\u306a\u3044\u3068\u3002\u3002\u3002\nproxy_set_header\u3068\u304bproxy_redirect\u3092off\u306b\u3059\u308c\u3070\u89e3\u6c7a\u3059\u308b\u306e\u3067\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bnginx\u306e\u8a2d\u5b9a\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n$ sudo vim /etc/nginx/nginx.conf\n\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    gzip    on;\n\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-NginX-Proxy true;\n    proxy_redirect off;\n\n    include /etc/nginx/conf.d/*.conf;\n\n\n}\n\n\u3053\u308c\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u81ea\u4f53\u3082\u554f\u984c\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3055\u3066\u3055\u3066\u3001\u6b21\u306f\u3044\u3088\u3044\u3088\u3001nodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u3000\n8. nodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\nnodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u304c\u3001node-demon\u3068\u304bforever\u3068\u304b\u3042\u308b\u3044\u3063\u307d\u3044\u306e\u3067\u3068\u308a\u3042\u3048\u305aforever\u3092\u5165\u308c\u307e\u3057\u3087\u3046\n$ sudo npm install -g forever\n$ cd /path/to/hoge\n$ sudo forever start app.js\n\n\u3000\n9. node\u304c\u7121\u4e8b\u8d77\u52d5\u51fa\u6765\u305f\u3089nginx\u3092\u518d\u8d77\u52d5\n$ sudo /etc/init.d/nginx restart\n\n\u3053\u308c\u3067\u7121\u4e8bnginx\u7d4c\u7531\u3067nodejs\u304c\u5b9f\u884c\u3067\u304d\u307e\u3059\u3088\u30fc\n\nCentOS6.3\u306bnode+nginx\u306e\u74b0\u5883\u3092\u7528\u610f\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u305d\u306e\u898b\u805e\u9332\u3067\u3059\u3002\n\n\n1. \u307e\u305a\u306fnode\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo yum install nodejs\n```\n\u3053\u308c\u3060\u3051\u3067\u304ak\u3067\u3059\u3002\n\u3000\n2. \u6b21\u306bnpm\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo curl https://npmjs.org/install.sh | sh\n```\n\u3000\n3. \u3053\u3053\u3067\u3061\u3083\u3093\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n```\n$ type node\nnode is /usr/bin/node\n\n$ type npm\nnpm is /usr/bin/npm\n```\n\u3053\u308c\u3067\u3061\u3083\u3093\u3068\u5165\u3063\u3066\u3044\u308b\u4e8b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u306d\u3002\n\u3000\n4. nginx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u305f\u3081\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6e96\u5099\n\n````\n$ sudo /etc/yum.repos.d/nginx.conf\n\n[nginx]\nname=nginx repo\nbaseurl=http://nginx.org/packages/centos/6/$basearch/\ngpgcheck=0\nenabled=1\n```\n\u3000\n5. \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo yum install nginx\n```\t\n\u3000\n6. nginx\u306econfig\u30d5\u30a1\u30a4\u30eb\u306e\u3078\u306e\u5909\u66f4\n\n```\n$ sudo cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/hoge.polidog.jp.conf\n$ sudo vim /etc/nginx/conf.d/hoge.polidog.jp.conf\n\nupstream backend_node {\n    ip_hash;\n    server 127.0.0.1:3000;\n}\n\nserver {\n    listen       80;\n    server_name  hoge.polidog.jp;\n    root /path/to/hoge\t\n\n    #charset koi8-r;\n    charset utf-8;\n    access_log /var/log/nginx/access_hoge.poidog.jp.log main;\n    error_log /var/log/nginx/errror_hoge.polidog.jp.log;\n\n    location / {\n        if (-f $request_filename) {\n            break;\n        }\n\n\n        if ( !-f $request_filename ) {\n            proxy_pass http://backend_node;\n            break;\n        }\n    }\n\n}\n```\n\u3053\u308c\u3067\u3084\u3063\u3068nginx\u306e\u8a2d\u5b9a\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\u3000\n7. nginx\u518d\u8d77\u52d5\n\n```\n$ sudo /etc/init.d/nginx restart\n```\n\u305f\u3060\u3053\u308c\u3060\u3068\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u3066\u3002\u3002\u3002\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u304c\u3046\u307e\u304f\u884c\u304b\u306a\u3044\u3068\u3002\u3002\u3002\nproxy_set_header\u3068\u304bproxy_redirect\u3092off\u306b\u3059\u308c\u3070\u89e3\u6c7a\u3059\u308b\u306e\u3067\u3001\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bnginx\u306e\u8a2d\u5b9a\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n```\n$ sudo vim /etc/nginx/nginx.conf\n\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\n\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  /var/log/nginx/access.log  main;\n\n    sendfile        on;\n\n    keepalive_timeout  65;\n\n    gzip    on;\n\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_set_header X-NginX-Proxy true;\n    proxy_redirect off;\n\n    include /etc/nginx/conf.d/*.conf;\n\n\n}\n```\n\u3053\u308c\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u81ea\u4f53\u3082\u554f\u984c\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3055\u3066\u3055\u3066\u3001\u6b21\u306f\u3044\u3088\u3044\u3088\u3001nodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u3057\u3066\u3044\u3053\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u3000\n8. nodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\nnodejs\u306e\u30c7\u30fc\u30e2\u30f3\u5316\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u304c\u3001node-demon\u3068\u304bforever\u3068\u304b\u3042\u308b\u3044\u3063\u307d\u3044\u306e\u3067\u3068\u308a\u3042\u3048\u305aforever\u3092\u5165\u308c\u307e\u3057\u3087\u3046\n\n```\n$ sudo npm install -g forever\n$ cd /path/to/hoge\n$ sudo forever start app.js\n```\n\u3000\n9. node\u304c\u7121\u4e8b\u8d77\u52d5\u51fa\u6765\u305f\u3089nginx\u3092\u518d\u8d77\u52d5\n\n```\n$ sudo /etc/init.d/nginx restart\n```\n\n\u3053\u308c\u3067\u7121\u4e8bnginx\u7d4c\u7531\u3067nodejs\u304c\u5b9f\u884c\u3067\u304d\u307e\u3059\u3088\u30fc\n", "tags": ["CentOS", "nodejs", "nginx"]}