{"context": " More than 1 year has passed since last update.================================\nCoreOS\u306b\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3(yum, apt\u306a\u3069)\u304c\u306a\u3044\u306e\u3067\u3001\n$ yum install zsh\n\n\u306e\u3088\u3046\u306a\u30ce\u30ea\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u306a\u3044\u3002\n\u4efb\u610f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u3001\nSDK\u3092\u4f7f\u7528\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308b\u306e\u3067\n\u4eca\u56de\u306f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u3061\u306a\u307f\u306bCoreOS\u306fChomeOS\u6d3e\u751f\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3002(ChomeOS\u306fGentoo\u6d3e\u751f)\n\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u30b5\u30a4\u30c8\n* http://tdoc.info/blog/2014/04/02/coreos_sdk_image.html\n* CoreOS\u516c\u5f0f\u30b5\u30a4\u30c8\n\n\n\u76ee\u7684\nzsh\u3001ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308bvagrant\u7528CoreOS\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u4f5c\u696d\u74b0\u5883\n\nMBP cpu:i5 2.6GHz  mem:8GB\nOS X Yosemite 10.10\nVagrant 1.6.5\nVirtualBox 4.3.18\nVagrant + VirtualBox + Ubuntu-Trusty 14.04\n\n\ndepot_tools\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306f\u3001CoreOS\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nSDK \u306f x86-64 Linux \u3067\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001Vagrant + VirtualBox + Ubuntu-Trusty 14.04\u74b0\u5883\u306b\u3066\u4f5c\u696d\u3002\n\u81ea\u5206\u306f~/bin\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n$ mkdir ~/bin; cd ~/bin\n$ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n$ export PATH=~/bin/depot_tools:$PATH\n\n\nSDK chroot\u306e\u4f5c\u6210\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6398\u3063\u3066\u3001\u30bd\u30fc\u30b9\u3084SDK\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nrepo sync\u306b\u304b\u306a\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u6563\u6b69\u3057\u307e\u3057\u3087\u3046\u3002\n(repo\u306fandroid\u672c\u4f53\u306e\u958b\u767a\u306b\u3082\u4f7f\u3063\u3066\u3044\u308bGit\u306e\u30e9\u30c3\u30d1\u30fc\u30c4\u30fc\u30eb\u3067\u3059\u306d\u3002)\n$ mkdir ~/coreos; cd ~/coreos\n$ repo init -u https://github.com/coreos/manifest.git -g minilayout --repo-url https://chromium.googlesource.com/external/repo.git\n$ repo sync\n\n\nSDK chroot\u306b\u5165\u308b\nSDK\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066SDK chroot\u306b\u5165\u308b\u3002\n\u3053\u308c\u3082\u305d\u308c\u306a\u308a\u306b\u6642\u9593\u304b\u304b\u308a\u307e\u3059\u3002\u30b3\u30fc\u30d2\u30fc\u98f2\u3093\u3067\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n$ ./chromite/bin/cros_sdk\n\n\n\u5b9f\u306f\u3001OS X Yosemite 10.10 \u3067\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u305f\u3093\u3067\u3059\u304c\u3001\n\u30b3\u30b3\u3089\u3078\u3093\u304b\u3089python2\u306e\u30d1\u30b9\u304cLinux\u3068\u9055\u304f\u3066\u52d5\u304b\u306a\u304b\u3063\u305f\u308a\u3001unshare\u304c\u306a\u3044\u3063\u3066\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3001\n\u7d20\u76f4\u306bUbuntu\u3067\u3084\u308a\u76f4\u3057\u307e\u3057\u305f\u3002\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u5b8c\u4e86\u3002\ncros_sdk:make_chroot: All set up.  To enter the chroot, run:\n$ cros_sdk --enter\n\nCAUTION: Do *NOT* rm -rf the chroot directory; if there are stale bind\nmounts you may end up deleting your source tree too.  To unmount and\ndelete the chroot cleanly, use:\n$ cros_sdk --delete\n\nvagrant@ubuntu ~/trunk/src/scripts $\n\nSDK chroot\u306b\u5165\u3063\u3066\u3044\u308b(cros_sdk --enter\u3057\u305f)\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\nemerge\u306a\u3093\u304b\u304c\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u81ea\u5206\u306fGentoo\u30b7\u30ed\u30a6\u30c8\u3067\u3059\u3002\n$ emerge --help\n\nzsh\u3001ansible\u3069\u3061\u3089\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\n$ emerge -s ansible\n$ emerge -s zsh\n\n\u8a66\u3057\u306bemacs\u5165\u308c\u3066\u307f\u3088\u3046\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u9014\u4e2d\u3067\u30a8\u30e9\u30fc\u767a\u751f\u3002\n\u306a\u3093\u3060\u304b\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n$ sudo emerge emacs\n\ninstall: invalid group \u2018mail\u2019\nmake: *** [install_common] Error 1\nemake failed\n * ERROR: net-libs/liblockfile-1.08::portage-stable failed (install phase):\n *   (no error message)\n *\n * Call stack:\n *     ebuild.sh, line  93:  Called src_install\n *   environment, line 2882:  Called die\n * The specific snippet of code:\n *       emake ROOT=\"${D}\" install || die;\n *\n * If you need support, post the output of `emerge --info '=net-libs/liblockfile-1.08::portage-stable'`,\n * the complete build log and the output of `emerge -pqv '=net-libs/liblockfile-1.08::portage-stable'`.\n * The complete build log is located at '/var/log/portage/net-libs:liblockfile-1.08:20141111-015752.log'.\n * For convenience, a symlink to the build log is located at '/var/tmp/portage/net-libs/liblockfile-1.08/temp/build.log'.\n * The ebuild environment file is located at '/var/tmp/portage/net-libs/liblockfile-1.08/temp/environment'.\n * Working directory: '/var/tmp/portage/net-libs/liblockfile-1.08/work/liblockfile-1.08'\n * S: '/var/tmp/portage/net-libs/liblockfile-1.08/work/liblockfile-1.08'\n * QA Notice: command not found:\n *\n *      /mnt/host/source/src/third_party/portage-stable/net-libs/liblockfile/liblockfile-1.08.ebuild: line 19: enewgroup: command not found\n\n\nzsh\u3001ansible\u3092\u5165\u308c\u3066\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\nAdd new upstream package\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001\nemerge package\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001scripts/update_ebuilds\u3092\u4f7f\u3046\u3063\u307d\u3044\u3002\nzsh\u30fbansible\u3092\u30d5\u30a7\u30c3\u30c1\u3002\n\u3061\u306a\u307f\u306b\u3053\u3053\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u63a2\u305b\u308b\u3002\n$ ./update_ebuilds app-shells/zsh\n$ ./update_ebuilds app-admin/ansible\n\nscripts/update_ebuilds\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30d5\u30a7\u30c3\u30c1\u3059\u308b\u3068'src/third_party/portage-stable'\u306b\u5165\u308b\u3002\n\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f'src/third_party/coreos-overlay'\u306b\u5165\u308c\u308b\u3002\n\u3061\u306a\u307f\u306b\u3001\u3053\u3053\u3067\u8a00\u3046\u7de8\u96c6\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u306e\u304b\u306f\u308f\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1.ebuild\u306e\u74b0\u5883\u5909\u6570RDEPEND\u306e\u6700\u5f8c\u306b\n\u30d1\u30c3\u30b1\u30fc\u30b8\u8ffd\u8a18\u3059\u308b\u3002\n\ncoreos-0.0.1.ebuild\n\nRDEPEND=\n    \u30fb\n    \u30fb\n    \u30fb\n    dev-vcs/git\n    app-shells/zsh\n    app-admin/ansible\n\"\n\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30afcoreos-0.0.1-r241.ebuild\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u308b\u3002\nAdd new upstream package\u306b\u306fgit mv\u3068\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u4eca\u56de\u306f\u30b3\u30df\u30c3\u30c8\u3057\u306a\u3044\u306e\u3067\u666e\u901a\u306b\u30ea\u30cd\u30fc\u30e0\u3002\n\u203b\u306f\u3058\u3081\u3001\u3053\u308c\u3092\u3084\u3089\u305a\u306b\u30a4\u30e1\u30fc\u30b8\u4f5c\u3063\u3066\u3001zsh\u3001ansible\u304c\u5165\u3089\u306a\u304f\u3066\u3081\u3061\u3083\u304f\u3061\u3083\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u3002\n$ mv ~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1-r241.ebuild ~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1-r242.ebuild\n\n\"core\"\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n$ ./set_shared_user_password.sh\n\n\u30bf\u30fc\u30b2\u30c3\u30c8\u3092amd64\u306b\u3059\u308b\u3002x86\u3068\u304b\u3082\u3067\u304d\u308b\u307f\u305f\u3044\u3002\nCoreOS \u516c\u5f0f box \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f amd64\u3002\nsetup_board \u306f10\u5206\u4f4d\u304b\u304b\u3063\u305f\u3002\n$ echo amd64-usr > .default_board\n$ ./setup_board\n\n\u30d3\u30eb\u30c9\u3002\n$ ./build_packages\n\n\u30a8\u30e9\u30fc\u767a\u751f\u3002\nemerge: there are no ebuilds built with USE flags to satisfy \"dev-python/pyyaml[python_targets_python2_7(-)?,-python_single_target_python2_7(-)]\" for /build/amd64-usr/.\n!!! One of the following packages is required to complete your request:\n- app-admin/ansible-1.6.8::portage-stable (Change USE: -python_targets_python2_7, this change violates use flag constraints defined by app-admin/ansible-1.6.8: 'any-of ( python_targets_python2_7 )')\n(dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n(dependency required by \"coreos-base/coreos-0.0.1-r242::coreos\" [ebuild])\n(dependency required by \"coreos-devel/board-packages-0.0.1-r2::coreos\" [binary])\n(dependency required by \"coreos-devel/board-packages\" [argument])\nERROR   build_packages: script called: build_packages (args unknown, no debug available)\nERROR   build_packages: Backtrace:  (most recent call is last)\nERROR   build_packages:   file build_packages, line 223, called: die_err_trap 'sudo -E \"${EMERGE_CMD[@]}\" \"${EMERGE_FLAGS[@]}\" @system coreos-devel/board-packages' '1'\nERROR   build_packages:\nERROR   build_packages: Command failed:\nERROR   build_packages:   Command 'sudo -E \"${EMERGE_CMD[@]}\" \"${EMERGE_FLAGS[@]}\" @system coreos-devel/board-packages' exited with nonzero code: 1\nvagrant@ubuntu ~/trunk/src/scripts $\n\nansible\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u3001\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u78ba\u8a8d\u3057\u3066\u5165\u308c\u308b\u3002\ndev-python\u3001net-misc/sshpass\u3092\u5165\u308c\u305f\u3002\n$ emerge -tp ansible\n\nThese are the packages that would be merged, in reverse order:\n\nCalculating dependencies... done!\n\nemerge: there are no ebuilds built with USE flags to satisfy \"dev-python/pyyaml[python_targets_python2_7(-)?,-python_single_target_python2_7(-)]\".\n!!! One of the following packages is required to complete your request:\n- app-admin/ansible-1.6.8::portage-stable (Change USE: -python_targets_python2_7, this change violates use flag constraints defined by app-admin/ansib\nle-1.6.8: 'any-of ( python_targets_python2_7 )')\n(dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n(dependency required by \"ansible\" [argument])\n\n\n$ ./update_ebuilds dev-python/pyyaml\n$ emerge -tp ansible\n\nThese are the packages that would be merged, in reverse order:\n\nCalculating dependencies... done!\n\nemerge: there are no ebuilds to satisfy \"net-misc/sshpass\".\n(dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n(dependency required by \"ansible\" [argument])\n\n$ ./update_ebuilds net-misc/sshpass\n\n\u518d\u5ea6\u30d3\u30eb\u30c9\u3002\n$ ./build_packages\n\n\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3002\n10\u5206\u4f4d\u3002\ndevelop\u30a4\u30e1\u30fc\u30b8(developer overlay\u3092\u542b\u3080)\n$ ./build_image --noenable_rootfs_verification dev\n\nproduct\u30a4\u30e1\u30fc\u30b8\n$ ./build_image prod\n\nraw \u306a\u30a4\u30e1\u30fc\u30b8\u304c\u3067\u304d\u305f\u306e\u3067\u3001vagrant\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u30b3\u30f3\u30d0\u30fc\u30c8\u3059\u308b\u3002\ndevelop\u30a4\u30e1\u30fc\u30b8\u306e\u5834\u5408\n$ ./image_to_vm.sh --format vagrant\n\nproduct\u30a4\u30e1\u30fc\u30b8\u306e\u5834\u5408\n$ ./image_to_vm.sh --format vagrant --prod_image\n\n\u30b3\u30f3\u30d0\u30fc\u30c8\u53ef\u80fd\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002(default: 'qemu')\nami\npxe\niso\nopenstack\nqemu\nqemu_no_kexec\nqemu_uefi\nrackspace\nrackspace_onmetal\nrackspace_vhd\nvagrant\nvagrant_vmware_fusion\nvirtualbox\nvmware\nvmware_insecure\nxen\ngce\nbrightbox\ncloudstack\ncloudstack_vhd\ndigitalocean\nexoscale\nazure\nhyperv\nseaure_demo\n\n\u4ee5\u4e0b\u306bbox\u304c\u3067\u304d\u308b\u3002\n$ ls -l ~/trunk/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/\ntotal 1330052\n-rw-r--r-- 1 vagrant vagrant 4756340736 11\u6708 12 19:12 coreos_production_image.bin\n-rw-r--r-- 1 vagrant vagrant    1468783 11\u6708 12 19:12 coreos_production_image_contents.txt\n-rw-r--r-- 1 vagrant vagrant       5885 11\u6708 12 19:12 coreos_production_image_packages.txt\n-rw-r--r-- 1 vagrant vagrant 1073741824 11\u6708 12 19:12 coreos_production_update.bin\n-rw-r--r-- 1 vagrant vagrant    6072177 11\u6708 12 19:12 coreos_production_update.zip\n-rw-r--r-- 1 vagrant vagrant  225675625 11\u6708 12 19:18 coreos_production_vagrant.box\n-rw-r--r-- 1 vagrant vagrant        338 11\u6708 12 19:18 coreos_production_vagrant.json\n-rw-r--r-- 1 vagrant vagrant         84 11\u6708 12 19:07 developer_data\ndrwxr-xr-x 2 root    root          4096 11\u6708 12 19:07 rootfs\n-rw-r--r-- 1 vagrant vagrant        174 11\u6708 12 19:12 version.txt\n\nUbuntu\u304b\u3089\u3060\u3068\u4ee5\u4e0b\u306e\u5834\u6240\u3002\n$ ls -l ~/coreos/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/\n\n\n\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092 Vagrant + VirtualBox + Ubuntu \u74b0\u5883\u3068\u30db\u30b9\u30c8(Mac)\u306e\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u30b3\u30d4\u30fc\u3059\u308b\u3002\n$ cp ~/coreos/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/coreos_production_vagrant.* /vagrant/.\n\n\u30db\u30b9\u30c8\u3067\u3001\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3067 Vagrant + \u30ab\u30b9\u30bf\u30e0CoreOS \u3092\u8d77\u52d5\u3002\n$ mkdir coreos-custom; cd coreos-custom\n$ mv ../ubuntu-trusty/coreos_production_vagrant.* .\n$ vagrant init coreos-custom coreos_production_vagrant.box\n$ vagrant up\n\nCoreOS\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n$ vagrant ssh\nCoreOS (developer)\ncore@localhost ~ $ zsh\nzsh        zsh-5.0.5\ncore@localhost ~ $ zsh\nlocalhost%\ncore@localhost ~ $ ansible\nansible           ansible-doc       ansible-galaxy    ansible-playbook  ansible-pull      ansible-vault\ncore@localhost ~ $ ansible --version\nansible 1.6.8\n\n$ vagrant box list\u3067CoreOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c'0'\u306a\u306e\u306f\u3042\u3068\u3067\u8abf\u3079\u307e\u3059\u3002\n$ vagrant box list\ncoreos-custom        (virtualbox, 0)\n\n================================\n\nCoreOS\u306b\u306f\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3(yum, apt\u306a\u3069)\u304c\u306a\u3044\u306e\u3067\u3001\n\n    $ yum install zsh\n\n\u306e\u3088\u3046\u306a\u30ce\u30ea\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u51fa\u6765\u306a\u3044\u3002\n\u4efb\u610f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u3001\nSDK\u3092\u4f7f\u7528\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3068\u3044\u3046\u65b9\u6cd5\u304c\u3042\u308b\u306e\u3067\n\u4eca\u56de\u306f\u3053\u308c\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3061\u306a\u307f\u306bCoreOS\u306fChomeOS\u6d3e\u751f\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3002(ChomeOS\u306fGentoo\u6d3e\u751f)\n\n\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u30b5\u30a4\u30c8\n* http://tdoc.info/blog/2014/04/02/coreos_sdk_image.html\n* [CoreOS\u516c\u5f0f\u30b5\u30a4\u30c8](https://coreos.com/docs/sdk-distributors/sdk/modifying-coreos/)\n\n\n![coreos-logo.png](https://qiita-image-store.s3.amazonaws.com/0/37484/bc922263-d9e7-5445-0274-b211aa7adeec.png \"coreos-logo.png\")\n\n\n\u76ee\u7684\n----\nzsh\u3001ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3042\u308bvagrant\u7528CoreOS\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\n\u4f5c\u696d\u74b0\u5883\n--------\n\n- MBP cpu:i5 2.6GHz  mem:8GB\n- OS X Yosemite 10.10\n- Vagrant 1.6.5\n- VirtualBox 4.3.18\n- Vagrant + VirtualBox + Ubuntu-Trusty 14.04\n\n\ndepot_tools\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n--------------------------\n\u307e\u305a\u306f\u3001CoreOS\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\u3057\u3066\u30d3\u30eb\u30c9\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nSDK \u306f x86-64 Linux \u3067\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067\u3001Vagrant + VirtualBox + Ubuntu-Trusty 14.04\u74b0\u5883\u306b\u3066\u4f5c\u696d\u3002\n\u81ea\u5206\u306f~/bin\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\n    $ mkdir ~/bin; cd ~/bin\n    $ git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git\n    $ export PATH=~/bin/depot_tools:$PATH\n\nSDK chroot\u306e\u4f5c\u6210\n-----------------\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6398\u3063\u3066\u3001\u30bd\u30fc\u30b9\u3084SDK\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nrepo sync\u306b\u304b\u306a\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u6563\u6b69\u3057\u307e\u3057\u3087\u3046\u3002\n(repo\u306fandroid\u672c\u4f53\u306e\u958b\u767a\u306b\u3082\u4f7f\u3063\u3066\u3044\u308bGit\u306e\u30e9\u30c3\u30d1\u30fc\u30c4\u30fc\u30eb\u3067\u3059\u306d\u3002)\n\n    $ mkdir ~/coreos; cd ~/coreos\n    $ repo init -u https://github.com/coreos/manifest.git -g minilayout --repo-url https://chromium.googlesource.com/external/repo.git\n    $ repo sync\n\n\nSDK chroot\u306b\u5165\u308b\n----------------\nSDK\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066SDK chroot\u306b\u5165\u308b\u3002\n\u3053\u308c\u3082\u305d\u308c\u306a\u308a\u306b\u6642\u9593\u304b\u304b\u308a\u307e\u3059\u3002\u30b3\u30fc\u30d2\u30fc\u98f2\u3093\u3067\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\n    $ ./chromite/bin/cros_sdk\n\n> \u5b9f\u306f\u3001OS X Yosemite 10.10 \u3067\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u305f\u3093\u3067\u3059\u304c\u3001\n> \u30b3\u30b3\u3089\u3078\u3093\u304b\u3089python2\u306e\u30d1\u30b9\u304cLinux\u3068\u9055\u304f\u3066\u52d5\u304b\u306a\u304b\u3063\u305f\u308a\u3001unshare\u304c\u306a\u3044\u3063\u3066\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u306e\u3067\u3001\n> \u7d20\u76f4\u306bUbuntu\u3067\u3084\u308a\u76f4\u3057\u307e\u3057\u305f\u3002\u3002\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u3066\u5b8c\u4e86\u3002\n\n    cros_sdk:make_chroot: All set up.  To enter the chroot, run:\n    $ cros_sdk --enter\n\n    CAUTION: Do *NOT* rm -rf the chroot directory; if there are stale bind\n    mounts you may end up deleting your source tree too.  To unmount and\n    delete the chroot cleanly, use:\n    $ cros_sdk --delete\n\n    vagrant@ubuntu ~/trunk/src/scripts $\n\nSDK chroot\u306b\u5165\u3063\u3066\u3044\u308b(cros_sdk --enter\u3057\u305f)\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\nemerge\u306a\u3093\u304b\u304c\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u81ea\u5206\u306fGentoo\u30b7\u30ed\u30a6\u30c8\u3067\u3059\u3002\n\n    $ emerge --help\n\n\nzsh\u3001ansible\u3069\u3061\u3089\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3002\n\n    $ emerge -s ansible\n    $ emerge -s zsh\n\n\u8a66\u3057\u306bemacs\u5165\u308c\u3066\u307f\u3088\u3046\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u9014\u4e2d\u3067\u30a8\u30e9\u30fc\u767a\u751f\u3002\n\u306a\u3093\u3060\u304b\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n\n    $ sudo emerge emacs\n\n    install: invalid group \u2018mail\u2019\n    make: *** [install_common] Error 1\n    emake failed\n     * ERROR: net-libs/liblockfile-1.08::portage-stable failed (install phase):\n     *   (no error message)\n     *\n     * Call stack:\n     *     ebuild.sh, line  93:  Called src_install\n     *   environment, line 2882:  Called die\n     * The specific snippet of code:\n     *       emake ROOT=\"${D}\" install || die;\n     *\n     * If you need support, post the output of `emerge --info '=net-libs/liblockfile-1.08::portage-stable'`,\n     * the complete build log and the output of `emerge -pqv '=net-libs/liblockfile-1.08::portage-stable'`.\n     * The complete build log is located at '/var/log/portage/net-libs:liblockfile-1.08:20141111-015752.log'.\n     * For convenience, a symlink to the build log is located at '/var/tmp/portage/net-libs/liblockfile-1.08/temp/build.log'.\n     * The ebuild environment file is located at '/var/tmp/portage/net-libs/liblockfile-1.08/temp/environment'.\n     * Working directory: '/var/tmp/portage/net-libs/liblockfile-1.08/work/liblockfile-1.08'\n     * S: '/var/tmp/portage/net-libs/liblockfile-1.08/work/liblockfile-1.08'\n     * QA Notice: command not found:\n     *\n     *      /mnt/host/source/src/third_party/portage-stable/net-libs/liblockfile/liblockfile-1.08.ebuild: line 19: enewgroup: command not found\n\n\nzsh\u3001ansible\u3092\u5165\u308c\u3066\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\n--------------------------------\n[Add new upstream package](https://coreos.com/docs/sdk-distributors/sdk/tips-and-tricks/#add-new-upstream-package)\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001\n`emerge package`\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5165\u308c\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001`scripts/update_ebuilds`\u3092\u4f7f\u3046\u3063\u307d\u3044\u3002\n\nzsh\u30fbansible\u3092\u30d5\u30a7\u30c3\u30c1\u3002\n\u3061\u306a\u307f\u306b[\u3053\u3053](http://packages.gentoo.org/)\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u63a2\u305b\u308b\u3002\n\n    $ ./update_ebuilds app-shells/zsh\n    $ ./update_ebuilds app-admin/ansible\n\n`scripts/update_ebuilds`\u3067\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30d5\u30a7\u30c3\u30c1\u3059\u308b\u3068'src/third_party/portage-stable'\u306b\u5165\u308b\u3002\n\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u306f'src/third_party/coreos-overlay'\u306b\u5165\u308c\u308b\u3002\n\u3061\u306a\u307f\u306b\u3001\u3053\u3053\u3067\u8a00\u3046\u7de8\u96c6\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u306e\u304b\u306f\u308f\u304b\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n\n`~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1.ebuild`\u306e\u74b0\u5883\u5909\u6570RDEPEND\u306e\u6700\u5f8c\u306b\n\u30d1\u30c3\u30b1\u30fc\u30b8\u8ffd\u8a18\u3059\u308b\u3002\n\n```coreos-0.0.1.ebuild:coreos-0.0.1.ebuild\n\nRDEPEND=\n    \u30fb\n    \u30fb\n    \u30fb\n    dev-vcs/git\n    app-shells/zsh\n    app-admin/ansible\n\"\n```\n\n\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30afcoreos-0.0.1-r241.ebuild\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u308b\u3002\n[Add new upstream package](https://coreos.com/docs/sdk-distributors/sdk/tips-and-tricks/#add-new-upstream-package)\u306b\u306f`git mv`\u3068\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u4eca\u56de\u306f\u30b3\u30df\u30c3\u30c8\u3057\u306a\u3044\u306e\u3067\u666e\u901a\u306b\u30ea\u30cd\u30fc\u30e0\u3002\n\u203b\u306f\u3058\u3081\u3001\u3053\u308c\u3092\u3084\u3089\u305a\u306b\u30a4\u30e1\u30fc\u30b8\u4f5c\u3063\u3066\u3001zsh\u3001ansible\u304c\u5165\u3089\u306a\u304f\u3066\u3081\u3061\u3083\u304f\u3061\u3083\u30cf\u30de\u308a\u307e\u3057\u305f\u3002\u3002\n\n    $ mv ~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1-r241.ebuild ~/trunk/src/third_party/coreos-overlay/coreos-base/coreos/coreos-0.0.1-r242.ebuild\n\n\"core\"\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\n\n    $ ./set_shared_user_password.sh\n\n\u30bf\u30fc\u30b2\u30c3\u30c8\u3092amd64\u306b\u3059\u308b\u3002x86\u3068\u304b\u3082\u3067\u304d\u308b\u307f\u305f\u3044\u3002\nCoreOS \u516c\u5f0f box \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f amd64\u3002\nsetup_board \u306f10\u5206\u4f4d\u304b\u304b\u3063\u305f\u3002\n\n    $ echo amd64-usr > .default_board\n    $ ./setup_board\n\n\u30d3\u30eb\u30c9\u3002\n\n    $ ./build_packages\n\n\u30a8\u30e9\u30fc\u767a\u751f\u3002\n\n    emerge: there are no ebuilds built with USE flags to satisfy \"dev-python/pyyaml[python_targets_python2_7(-)?,-python_single_target_python2_7(-)]\" for /build/amd64-usr/.\n    !!! One of the following packages is required to complete your request:\n    - app-admin/ansible-1.6.8::portage-stable (Change USE: -python_targets_python2_7, this change violates use flag constraints defined by app-admin/ansible-1.6.8: 'any-of ( python_targets_python2_7 )')\n    (dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n    (dependency required by \"coreos-base/coreos-0.0.1-r242::coreos\" [ebuild])\n    (dependency required by \"coreos-devel/board-packages-0.0.1-r2::coreos\" [binary])\n    (dependency required by \"coreos-devel/board-packages\" [argument])\n    ERROR   build_packages: script called: build_packages (args unknown, no debug available)\n    ERROR   build_packages: Backtrace:  (most recent call is last)\n    ERROR   build_packages:   file build_packages, line 223, called: die_err_trap 'sudo -E \"${EMERGE_CMD[@]}\" \"${EMERGE_FLAGS[@]}\" @system coreos-devel/board-packages' '1'\n    ERROR   build_packages:\n    ERROR   build_packages: Command failed:\n    ERROR   build_packages:   Command 'sudo -E \"${EMERGE_CMD[@]}\" \"${EMERGE_FLAGS[@]}\" @system coreos-devel/board-packages' exited with nonzero code: 1\n    vagrant@ubuntu ~/trunk/src/scripts $\n\n\nansible\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u306a\u3044\u3063\u307d\u3044\u306e\u3067\u3001\u4f9d\u5b58\u3057\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u78ba\u8a8d\u3057\u3066\u5165\u308c\u308b\u3002\ndev-python\u3001net-misc/sshpass\u3092\u5165\u308c\u305f\u3002\n\n    $ emerge -tp ansible\n\n    These are the packages that would be merged, in reverse order:\n\n    Calculating dependencies... done!\n\n    emerge: there are no ebuilds built with USE flags to satisfy \"dev-python/pyyaml[python_targets_python2_7(-)?,-python_single_target_python2_7(-)]\".\n    !!! One of the following packages is required to complete your request:\n    - app-admin/ansible-1.6.8::portage-stable (Change USE: -python_targets_python2_7, this change violates use flag constraints defined by app-admin/ansib\n    le-1.6.8: 'any-of ( python_targets_python2_7 )')\n    (dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n    (dependency required by \"ansible\" [argument])\n\n\n    $ ./update_ebuilds dev-python/pyyaml\n    $ emerge -tp ansible\n    \n    These are the packages that would be merged, in reverse order:\n\n    Calculating dependencies... done!\n\n    emerge: there are no ebuilds to satisfy \"net-misc/sshpass\".\n    (dependency required by \"app-admin/ansible-1.6.8\" [ebuild])\n    (dependency required by \"ansible\" [argument])\n\n    $ ./update_ebuilds net-misc/sshpass\n\n\n\u518d\u5ea6\u30d3\u30eb\u30c9\u3002\n\n    $ ./build_packages\n\n\n\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3002\n10\u5206\u4f4d\u3002\n\n    develop\u30a4\u30e1\u30fc\u30b8(developer overlay\u3092\u542b\u3080)\n    $ ./build_image --noenable_rootfs_verification dev\n\n    product\u30a4\u30e1\u30fc\u30b8\n    $ ./build_image prod\n\n\nraw \u306a\u30a4\u30e1\u30fc\u30b8\u304c\u3067\u304d\u305f\u306e\u3067\u3001vagrant\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u30b3\u30f3\u30d0\u30fc\u30c8\u3059\u308b\u3002\n\n    develop\u30a4\u30e1\u30fc\u30b8\u306e\u5834\u5408\n    $ ./image_to_vm.sh --format vagrant\n\n    product\u30a4\u30e1\u30fc\u30b8\u306e\u5834\u5408\n    $ ./image_to_vm.sh --format vagrant --prod_image\n\n\n\u30b3\u30f3\u30d0\u30fc\u30c8\u53ef\u80fd\u306a\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3002(default: 'qemu')\n\n    ami\n    pxe\n    iso\n    openstack\n    qemu\n    qemu_no_kexec\n    qemu_uefi\n    rackspace\n    rackspace_onmetal\n    rackspace_vhd\n    vagrant\n    vagrant_vmware_fusion\n    virtualbox\n    vmware\n    vmware_insecure\n    xen\n    gce\n    brightbox\n    cloudstack\n    cloudstack_vhd\n    digitalocean\n    exoscale\n    azure\n    hyperv\n    seaure_demo\n\n\n\u4ee5\u4e0b\u306bbox\u304c\u3067\u304d\u308b\u3002\n\n    $ ls -l ~/trunk/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/\n    total 1330052\n    -rw-r--r-- 1 vagrant vagrant 4756340736 11\u6708 12 19:12 coreos_production_image.bin\n    -rw-r--r-- 1 vagrant vagrant    1468783 11\u6708 12 19:12 coreos_production_image_contents.txt\n    -rw-r--r-- 1 vagrant vagrant       5885 11\u6708 12 19:12 coreos_production_image_packages.txt\n    -rw-r--r-- 1 vagrant vagrant 1073741824 11\u6708 12 19:12 coreos_production_update.bin\n    -rw-r--r-- 1 vagrant vagrant    6072177 11\u6708 12 19:12 coreos_production_update.zip\n    -rw-r--r-- 1 vagrant vagrant  225675625 11\u6708 12 19:18 coreos_production_vagrant.box\n    -rw-r--r-- 1 vagrant vagrant        338 11\u6708 12 19:18 coreos_production_vagrant.json\n    -rw-r--r-- 1 vagrant vagrant         84 11\u6708 12 19:07 developer_data\n    drwxr-xr-x 2 root    root          4096 11\u6708 12 19:07 rootfs\n    -rw-r--r-- 1 vagrant vagrant        174 11\u6708 12 19:12 version.txt\n\n\nUbuntu\u304b\u3089\u3060\u3068\u4ee5\u4e0b\u306e\u5834\u6240\u3002\n\n    $ ls -l ~/coreos/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/\n\n\n\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n------------------------------\n\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092 Vagrant + VirtualBox + Ubuntu \u74b0\u5883\u3068\u30db\u30b9\u30c8(Mac)\u306e\u5171\u6709\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3078\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n    $ cp ~/coreos/src/build/images/amd64-usr/developer-494.0.0+2014-11-12-1906-a1/coreos_production_vagrant.* /vagrant/.\n\n\u30db\u30b9\u30c8\u3067\u3001\u4f5c\u6210\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3067 Vagrant + \u30ab\u30b9\u30bf\u30e0CoreOS \u3092\u8d77\u52d5\u3002\n\n    $ mkdir coreos-custom; cd coreos-custom\n    $ mv ../ubuntu-trusty/coreos_production_vagrant.* .\n    $ vagrant init coreos-custom coreos_production_vagrant.box\n    $ vagrant up\n\nCoreOS\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n    $ vagrant ssh\n    CoreOS (developer)\n    core@localhost ~ $ zsh\n    zsh        zsh-5.0.5\n    core@localhost ~ $ zsh\n    localhost%\n    core@localhost ~ $ ansible\n    ansible           ansible-doc       ansible-galaxy    ansible-playbook  ansible-pull      ansible-vault\n    core@localhost ~ $ ansible --version\n    ansible 1.6.8\n\n\n`$ vagrant box list`\u3067CoreOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c'0'\u306a\u306e\u306f\u3042\u3068\u3067\u8abf\u3079\u307e\u3059\u3002\n\n    $ vagrant box list\n    coreos-custom        (virtualbox, 0)\n\n\n", "tags": ["vagrant", "CoreOS"]}