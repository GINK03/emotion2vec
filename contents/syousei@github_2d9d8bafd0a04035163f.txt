{"context": "\u3053\u3093\u306b\u3061\u306f\u3002\nFPGA\u30dc\u30fc\u30c9\u3068\u30d1\u30bd\u30b3\u30f3\u3092\u901a\u4fe1\u3055\u305b\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u9593\u306bArduino\u3092\u631f\u3080\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\nArduino\u306b\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30b7\u30fc\u30eb\u30c9\u3092\u88c5\u7740\u3057\u3066PC\u3068Arduino\u3092\u63a5\u7d9a\u3002\nArduino\u3068FPGA\u30dc\u30fc\u30c9\u306f\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3001\u3068\u3044\u3046\u76ee\u8ad6\u898b\u3067\u3059\u3002\nArduino\u306e\u5f79\u5272\u306f\u3001HTTP\u30b5\u30fc\u30d0\u3063\u307d\u304f\u632f\u308b\u821e\u3063\u3066\u30d6\u30e9\u30a6\u30b6\u306e\u76f8\u624b\u3092\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u9001\u4fe1\u3055\u308c\u3066\u304f\u308bHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u304b\u3089FPGA\u306b\u9001\u4fe1\u3059\u308b\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3059\u308f\u3051\u3067\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30b1\u30c3\u30c1\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n#include <Arduino.h>\n#include <WString.h>\n#include <SPI.h>\n#include <Ethernet.h>\n\n\n#define LINE_BUF_SIZE (512)\n\nbyte mac_addr[] = {0x90, 0xA2, 0xDA, 0x00, 0x54, 0x65};\nbyte ip_addr[] = {192, 168, 11, 100};\n\nEthernetServer server = EthernetServer(80);\n\nString line_buf;\nint delimiter = 0;\nString key_values[20];\nString callback;\n\nint mode = 0;\nint pulse_width = 0;\nint pulse_interval = 0;\nint pulse_cycle = 0;\n\n\nvoid http_response_200(EthernetClient client) {\n  client.println(\"HTTP/1.1 200 OK\");\n  client.println(\"Content-Type: application/javascript\");\n  client.println();\n}\n\n\nvoid http_response_404(EthernetClient client) {\n  client.println(\"HTTP/1.1 404 Not Found\");\n  client.println(\"Content-Type: application/javascript\");\n  client.println();\n}\n\n\nvoid http_response_mode0(EthernetClient client) {\n\n  Serial.println(\"# MODE 0: STOP\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 0,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode1(EthernetClient client) {\n\n  Serial.println(\"# MODE 1: CONTINUOUS PULSE\");\n\n  http_response_200(client);\n  client.println();\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 1,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode2(EthernetClient client) {\n\n  Serial.println(\"# MODE 2: SINGLE PULSE\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 2,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode3(EthernetClient client) {\n\n  Serial.println(\"# MODE 3: DOUBLE PULSE\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 3,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid setup() {\n\n  Ethernet.begin(mac_addr, ip_addr);\n  server.begin();\n\n  Serial.begin(9600);\n\n  Serial.print(\"# IP address: \");\n  Serial.println(Ethernet.localIP());\n}\n\n\nvoid loop() {\n\n  EthernetClient client = server.available();\n\n  if (client) {\n\n    while (client.connected()) {\n\n      if (client.available()) {\n\n        char c = client.read();\n\n        if (c != '\\n' && line_buf.length() < LINE_BUF_SIZE) {\n\n          line_buf += c;\n\n        } else if (c == '\\n') {\n\n          line_buf.replace(\"GET /?\", \"\");\n          line_buf.replace(\" HTTP/1.1\", \"\");\n\n          int i = 0;\n\n          while (1) {\n\n            delimiter = line_buf.indexOf('&');\n\n            key_values[i] = line_buf.substring(0, delimiter);\n\n            if (delimiter == -1) {\n              break;\n            }\n\n            line_buf = line_buf.substring(delimiter + 1, line_buf.length());\n\n            i++;\n\n          }\n\n          for (int i = 0; i < 20; i++) {\n\n            if (key_values[i].startsWith(\"callback=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              callback = key_values[i].substring(pos);\n            }\n\n            if (key_values[i].startsWith(\"mode=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              mode = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"pulse_width=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_width = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"pulse_interval=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_interval = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"mrt3u_pulse_cycle=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_cycle = key_values[i].substring(pos).toInt();\n            }\n\n          }\n\n          switch (mode) {\n\n            case 0:\n              http_response_mode0(client);\n              break;\n\n            case 1:\n              http_response_mode1(client);\n              break;\n\n            case 2:\n              http_response_mode2(client);\n              break;\n\n            case 3:\n              http_response_mode3(client);\n              break;\n\n            default:\n              http_response_404(client);\n          }\n\n          client.stop();\n\n          line_buf = \"\";\n\n        } else {\n          client.flush();\n        }\n      }\n    }\n  }\n}\n\n\u3054\u89a7\u306e\u901a\u308a\u3001Arduino\u3068FPGA\u30dc\u30fc\u30c9\u306e\u901a\u4fe1\u90e8\u5206\u306f\u307e\u3060\u51fa\u6765\u3066\u3044\u307e\u305b\u3093\u3002\n\u305d\u308c\u306f\u3053\u308c\u304b\u3089\u52c9\u5f37\u3057\u3066\u4f5c\u6210\u3059\u308b\u3064\u3082\u308a\u3067\u3059\u3002\n\u4e00\u65b9\u3001\u3053\u308c\u3092\u66f8\u304d\u8fbc\u3093\u3060Arduino\u304c\u76f8\u624b\u3092\u3059\u308b\u30d6\u30e9\u30a6\u30b6\u306b\u306f\u3053\u3093\u306aHTML+JavaScript\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>PULSE CONTROLLER v0.1</title>\n    <link rel=\"stylesheet\" href=\"./css/bootstrap.min.css\">\n    <script src=\"./js/jquery-3.1.1.min.js\"></script>\n    <script src=\"./js/bootstrap.min.js\"></script>\n    <style>\n      body { padding: 20px; }\n      .navbar { margin-bottom: 20px; }\n      input[type=\"number\"] {\n          text-align: right;\n          -moz-appearance:textfield;\n      }\n      input[type=\"number\"]::-webkit-outer-spin-button,\n      input[type=\"number\"]::-webkit-inner-spin-button {\n          -webkit-appearance: none;\n          margin: 0;\n      }\n    </style>\n  </head>\n  <body>\n    <nav class=\"navbar navbar-default\">\n      <div class=\"container-fluid\">\n        <span class=\"navbar-brand\" href=\"#\">PULSE CONTROLLER v0.1</span>\n      </div>\n    </nav>\n    <div class=\"container\">\n      <div class=\"row\">\n        <div class=\"col-sm-4\" id=\"continuous-pulse\">\n          <h2>Continuous pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"continuous-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"continuous-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"continuous-pulse-cycle\">Pulse Interval</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"continuous-pulse-interval\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-sm-4\" id=\"single-pulse\">\n          <h2>Single pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"single-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"single-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"single-pulse-cycle\">Pulse Cycle</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"4000000\" id=\"single-pulse-cycle\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-sm-4\" id=\"double-pulse\">\n          <h2>Double pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"double-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-interval\">Pulse Interval</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"3000\" id=\"double-pulse-interval\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-cycle\">Pulse Cycle</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"4000000\" id=\"double-pulse-cycle\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </body>\n  <script>\n    +function ($) {\n        'use strict';\n\n        var IP_ADDR = '192.168.11.100';\n\n        var request = {\n            \"url\": \"http://\" + IP_ADDR,\n            \"params\": {},\n            \"send\": function() {\n                console.log(this.params);\n                var defer = $.Deferred();\n                $.ajax({\n                    type: \"GET\",\n                    url: this.url,\n                    data: this.params,\n                    dataType: \"jsonp\",\n                    success: defer.resolve,\n                    error: defer.reject\n                });\n                return defer.promise();\n            }\n        }\n\n\n        var $continuous_pulse_switch = $('#continuous-pulse .switch');\n        var $continuous_pulse_switch_on = $continuous_pulse_switch.children().first();\n        var $continuous_pulse_switch_off = $continuous_pulse_switch.children().last();\n\n        var $single_pulse_switch = $('#single-pulse .switch');\n        var $single_pulse_switch_on = $single_pulse_switch.children().first();\n        var $single_pulse_switch_off = $single_pulse_switch.children().last();\n\n        var $double_pulse_switch = $('#double-pulse .switch');\n        var $double_pulse_switch_on = $double_pulse_switch.children().first();\n        var $double_pulse_switch_off = $double_pulse_switch.children().last();\n\n\n        $continuous_pulse_switch.bind('turnOn', function() {\n            $continuous_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $continuous_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $continuous_pulse_switch.bind('turnOff', function() {\n            $continuous_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $continuous_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n        $single_pulse_switch.bind('turnOn', function() {\n            $single_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $single_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $single_pulse_switch.bind('turnOff', function() {\n            $single_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $single_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n        $double_pulse_switch.bind('turnOn', function() {\n            $double_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $double_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $double_pulse_switch.bind('turnOff', function() {\n            $double_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $double_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n\n        $continuous_pulse_switch_on.on('click', function() {\n            request.params = {\n                'mode': 1,\n                'pulse_width': get_continuous_pulse_width(),\n                'pulse_interval': get_continuous_pulse_interval(),\n                'pulse_cycle': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOn');\n                $single_pulse_switch.trigger('turnOff');\n                $double_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $continuous_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $single_pulse_switch_on.on('click', function() {\n            request.params = {\n                'mode': 2,\n                'pulse_width': get_single_pulse_width(),\n                'pulse_interval': 0,\n                'pulse_cycle': get_single_pulse_cycle()\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n                $single_pulse_switch.trigger('turnOn');\n                $double_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $single_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $single_pulse_switch.trigger('turnOff');\n            });\n\n        });\n\n        $double_pulse_switch_on.on('click', function() {\n            request.params = {\n              'mode': 3,\n              'pulse_width': get_double_pulse_width(),\n              'pulse_interval': get_double_pulse_interval(),\n              'pulse_cycle': get_double_pulse_cycle(),\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n                $single_pulse_switch.trigger('turnOff');\n                $double_pulse_switch.trigger('turnOn');\n            });\n        });\n\n        $double_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $double_pulse_switch.trigger('turnOff');\n            });\n\n        });\n\n\n        var get_continuous_pulse_width = function() {\n            return parseFloat($('#continuous-pulse-width').val());\n        }\n\n        var get_continuous_pulse_interval = function() {\n            return parseFloat($('#continuous-pulse-interval').val());\n        }\n\n        var get_single_pulse_width = function() {\n            return parseFloat($('#single-pulse-width').val());\n        }\n\n        var get_single_pulse_cycle = function() {\n            return parseFloat($('#single-pulse-cycle').val());\n        }\n\n        var get_double_pulse_width = function() {\n            return parseFloat($('#double-pulse-width').val());\n        }\n\n        var get_double_pulse_interval = function() {\n            return parseFloat($('#double-pulse-interval').val());\n        }\n\n        var get_double_pulse_cycle = function() {\n            return parseFloat($('#double-pulse-cycle').val());\n        }\n\n\n        request.params = {\n            'mode': 0\n        };\n        request.send().done(function(data) {\n            console.log(data);\n        });\n\n    }(jQuery);\n  </script>\n</html>\n\n\u30b9\u30bf\u30a4\u30eb\u30b7\u30fc\u30c8\u306bBootstrap3\u3092\u3001JavaScript\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u306fjQuery\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u305e\u308c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001HTML\u306eHEAD\u5185\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30d1\u30b9\u306e\u3068\u304a\u308a\u306b\u914d\u7f6e\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\npulse_controller.html\n\u251c css\n\u2502\u3000 \u2514 bootstrap.min.css\n\u2514 js\n\u3000\u3000\u251c jquery-3.1.1.min.js\n\u3000\u3000\u2514 bootstrap.min.js\n\n\u3053\u308c\u3092\u30ed\u30fc\u30ab\u30eb\u306e\u9069\u5f53\u306a\u30d5\u30a9\u30eb\u30c0\u30fc\u306b\u653e\u308a\u8fbc\u3093\u3067\u3001HTML\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\u4e0a\u306b\u8cbc\u308a\u4ed8\u3051\u305f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001ON/OFF\u30dc\u30bf\u30f3\u3092\u64cd\u4f5c\u3057\u305f\u308a\u3059\u308b\u3068Arduino\u306b\u8a2d\u5b9a\u5024\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\u30b7\u30ea\u30a2\u30eb\u30e2\u30cb\u30bf\u306b\u30ed\u30b0\u304c\u51fa\u307e\u3059\u3002\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\u76f8\u5909\u308f\u3089\u305a\u52d5\u304b\u3059\u3053\u3068\u3092\u6700\u512a\u5148\u3067\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u3053\u3053\u306f\u3053\u3046\u66f8\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3088\u300d\u306a\u3069\u306e\u3054\u610f\u898b\u3054\u3056\u3044\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u3067\u30a2\u30c9\u30d0\u30a4\u30b9\u3044\u305f\u3060\u3051\u307e\u3059\u3068\u5e78\u751a\u3067\u3059\u3002\n\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\u3053\u3093\u306b\u3061\u306f\u3002\n\nFPGA\u30dc\u30fc\u30c9\u3068\u30d1\u30bd\u30b3\u30f3\u3092\u901a\u4fe1\u3055\u305b\u308b\u306b\u3042\u305f\u3063\u3066\u3001\u9593\u306bArduino\u3092\u631f\u3080\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nArduino\u306b\u30a4\u30fc\u30b5\u30cd\u30c3\u30c8\u306e\u30b7\u30fc\u30eb\u30c9\u3092\u88c5\u7740\u3057\u3066PC\u3068Arduino\u3092\u63a5\u7d9a\u3002\nArduino\u3068FPGA\u30dc\u30fc\u30c9\u306f\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3001\u3068\u3044\u3046\u76ee\u8ad6\u898b\u3067\u3059\u3002\n\nArduino\u306e\u5f79\u5272\u306f\u3001HTTP\u30b5\u30fc\u30d0\u3063\u307d\u304f\u632f\u308b\u821e\u3063\u3066\u30d6\u30e9\u30a6\u30b6\u306e\u76f8\u624b\u3092\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u9001\u4fe1\u3055\u308c\u3066\u304f\u308bHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u304b\u3089FPGA\u306b\u9001\u4fe1\u3059\u308b\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3059\u308f\u3051\u3067\u3059\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b9\u30b1\u30c3\u30c1\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```C\n#include <Arduino.h>\n#include <WString.h>\n#include <SPI.h>\n#include <Ethernet.h>\n\n\n#define LINE_BUF_SIZE (512)\n\nbyte mac_addr[] = {0x90, 0xA2, 0xDA, 0x00, 0x54, 0x65};\nbyte ip_addr[] = {192, 168, 11, 100};\n\nEthernetServer server = EthernetServer(80);\n\nString line_buf;\nint delimiter = 0;\nString key_values[20];\nString callback;\n\nint mode = 0;\nint pulse_width = 0;\nint pulse_interval = 0;\nint pulse_cycle = 0;\n\n\nvoid http_response_200(EthernetClient client) {\n  client.println(\"HTTP/1.1 200 OK\");\n  client.println(\"Content-Type: application/javascript\");\n  client.println();\n}\n\n\nvoid http_response_404(EthernetClient client) {\n  client.println(\"HTTP/1.1 404 Not Found\");\n  client.println(\"Content-Type: application/javascript\");\n  client.println();\n}\n\n\nvoid http_response_mode0(EthernetClient client) {\n\n  Serial.println(\"# MODE 0: STOP\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 0,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode1(EthernetClient client) {\n\n  Serial.println(\"# MODE 1: CONTINUOUS PULSE\");\n\n  http_response_200(client);\n  client.println();\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 1,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode2(EthernetClient client) {\n\n  Serial.println(\"# MODE 2: SINGLE PULSE\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 2,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid http_response_mode3(EthernetClient client) {\n\n  Serial.println(\"# MODE 3: DOUBLE PULSE\");\n\n  http_response_200(client);\n  client.print(callback);\n  client.println(\"({\");\n  client.println(\"  \\\"mode\\\": 3,\");\n  client.println(\"  \\\"param1\\\": \\\"param1\\\",\");\n  client.println(\"  \\\"param2\\\": \\\"param2\\\",\");\n  client.println(\"  \\\"param3\\\": \\\"param3\\\"\");\n  client.println(\"})\");\n\n  // \u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u3067FPGA\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u6e21\u3059\u3002\n}\n\n\nvoid setup() {\n\n  Ethernet.begin(mac_addr, ip_addr);\n  server.begin();\n\n  Serial.begin(9600);\n\n  Serial.print(\"# IP address: \");\n  Serial.println(Ethernet.localIP());\n}\n\n\nvoid loop() {\n\n  EthernetClient client = server.available();\n\n  if (client) {\n\n    while (client.connected()) {\n\n      if (client.available()) {\n\n        char c = client.read();\n\n        if (c != '\\n' && line_buf.length() < LINE_BUF_SIZE) {\n\n          line_buf += c;\n\n        } else if (c == '\\n') {\n\n          line_buf.replace(\"GET /?\", \"\");\n          line_buf.replace(\" HTTP/1.1\", \"\");\n\n          int i = 0;\n\n          while (1) {\n\n            delimiter = line_buf.indexOf('&');\n\n            key_values[i] = line_buf.substring(0, delimiter);\n\n            if (delimiter == -1) {\n              break;\n            }\n\n            line_buf = line_buf.substring(delimiter + 1, line_buf.length());\n\n            i++;\n\n          }\n\n          for (int i = 0; i < 20; i++) {\n\n            if (key_values[i].startsWith(\"callback=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              callback = key_values[i].substring(pos);\n            }\n\n            if (key_values[i].startsWith(\"mode=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              mode = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"pulse_width=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_width = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"pulse_interval=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_interval = key_values[i].substring(pos).toInt();\n            }\n\n            if (key_values[i].startsWith(\"mrt3u_pulse_cycle=\")) {\n              int pos = key_values[i].indexOf(\"=\") + 1;\n              pulse_cycle = key_values[i].substring(pos).toInt();\n            }\n\n          }\n\n          switch (mode) {\n\n            case 0:\n              http_response_mode0(client);\n              break;\n\n            case 1:\n              http_response_mode1(client);\n              break;\n\n            case 2:\n              http_response_mode2(client);\n              break;\n\n            case 3:\n              http_response_mode3(client);\n              break;\n\n            default:\n              http_response_404(client);\n          }\n\n          client.stop();\n\n          line_buf = \"\";\n\n        } else {\n          client.flush();\n        }\n      }\n    }\n  }\n}\n```\n\u3054\u89a7\u306e\u901a\u308a\u3001**Arduino\u3068FPGA\u30dc\u30fc\u30c9\u306e\u901a\u4fe1\u90e8\u5206\u306f\u307e\u3060\u51fa\u6765\u3066\u3044\u307e\u305b\u3093**\u3002\n\u305d\u308c\u306f\u3053\u308c\u304b\u3089\u52c9\u5f37\u3057\u3066\u4f5c\u6210\u3059\u308b\u3064\u3082\u308a\u3067\u3059\u3002\n\n\u4e00\u65b9\u3001\u3053\u308c\u3092\u66f8\u304d\u8fbc\u3093\u3060Arduino\u304c\u76f8\u624b\u3092\u3059\u308b\u30d6\u30e9\u30a6\u30b6\u306b\u306f\u3053\u3093\u306aHTML+JavaScript\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n![WS000015.JPG](https://qiita-image-store.s3.amazonaws.com/0/14792/950c55c9-cb32-fabe-0460-88917b39296e.jpeg)\n\n```HTML\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>PULSE CONTROLLER v0.1</title>\n    <link rel=\"stylesheet\" href=\"./css/bootstrap.min.css\">\n    <script src=\"./js/jquery-3.1.1.min.js\"></script>\n    <script src=\"./js/bootstrap.min.js\"></script>\n    <style>\n      body { padding: 20px; }\n      .navbar { margin-bottom: 20px; }\n      input[type=\"number\"] {\n          text-align: right;\n          -moz-appearance:textfield;\n      }\n      input[type=\"number\"]::-webkit-outer-spin-button,\n      input[type=\"number\"]::-webkit-inner-spin-button {\n          -webkit-appearance: none;\n          margin: 0;\n      }\n    </style>\n  </head>\n  <body>\n    <nav class=\"navbar navbar-default\">\n      <div class=\"container-fluid\">\n        <span class=\"navbar-brand\" href=\"#\">PULSE CONTROLLER v0.1</span>\n      </div>\n    </nav>\n    <div class=\"container\">\n      <div class=\"row\">\n        <div class=\"col-sm-4\" id=\"continuous-pulse\">\n          <h2>Continuous pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"continuous-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"continuous-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"continuous-pulse-cycle\">Pulse Interval</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"continuous-pulse-interval\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-sm-4\" id=\"single-pulse\">\n          <h2>Single pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"single-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"single-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"single-pulse-cycle\">Pulse Cycle</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"4000000\" id=\"single-pulse-cycle\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n        <div class=\"col-sm-4\" id=\"double-pulse\">\n          <h2>Double pulse</h2>\n          <div class=\"btn-group switch\">\n            <button class=\"btn btn-default\">ON</button>\n            <button class=\"btn btn-primary\">OFF</button>\n          </div>\n          <hr>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-width\">Pulse Width</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"250\" id=\"double-pulse-width\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-interval\">Pulse Interval</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"3000\" id=\"double-pulse-interval\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n          <div class=\"form-group\">\n            <label for=\"double-pulse-cycle\">Pulse Cycle</label>\n            <div class=\"input-group\">\n              <input type=\"number\" class=\"form-control input-lg\" value=\"4000000\" id=\"double-pulse-cycle\">\n              <div class=\"input-group-addon\">nano-sec.</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </body>\n  <script>\n    +function ($) {\n        'use strict';\n\n        var IP_ADDR = '192.168.11.100';\n\n        var request = {\n            \"url\": \"http://\" + IP_ADDR,\n            \"params\": {},\n            \"send\": function() {\n                console.log(this.params);\n                var defer = $.Deferred();\n                $.ajax({\n                    type: \"GET\",\n                    url: this.url,\n                    data: this.params,\n                    dataType: \"jsonp\",\n                    success: defer.resolve,\n                    error: defer.reject\n                });\n                return defer.promise();\n            }\n        }\n\n\n        var $continuous_pulse_switch = $('#continuous-pulse .switch');\n        var $continuous_pulse_switch_on = $continuous_pulse_switch.children().first();\n        var $continuous_pulse_switch_off = $continuous_pulse_switch.children().last();\n\n        var $single_pulse_switch = $('#single-pulse .switch');\n        var $single_pulse_switch_on = $single_pulse_switch.children().first();\n        var $single_pulse_switch_off = $single_pulse_switch.children().last();\n\n        var $double_pulse_switch = $('#double-pulse .switch');\n        var $double_pulse_switch_on = $double_pulse_switch.children().first();\n        var $double_pulse_switch_off = $double_pulse_switch.children().last();\n\n\n        $continuous_pulse_switch.bind('turnOn', function() {\n            $continuous_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $continuous_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $continuous_pulse_switch.bind('turnOff', function() {\n            $continuous_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $continuous_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n        $single_pulse_switch.bind('turnOn', function() {\n            $single_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $single_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $single_pulse_switch.bind('turnOff', function() {\n            $single_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $single_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n        $double_pulse_switch.bind('turnOn', function() {\n            $double_pulse_switch_on.addClass('btn-primary').removeClass('btn-default');\n            $double_pulse_switch_off.addClass('btn-default').removeClass('btn-primary');\n        });\n\n        $double_pulse_switch.bind('turnOff', function() {\n            $double_pulse_switch_on.addClass('btn-default').removeClass('btn-primary');\n            $double_pulse_switch_off.addClass('btn-primary').removeClass('btn-default');\n        });\n\n\n        $continuous_pulse_switch_on.on('click', function() {\n            request.params = {\n                'mode': 1,\n                'pulse_width': get_continuous_pulse_width(),\n                'pulse_interval': get_continuous_pulse_interval(),\n                'pulse_cycle': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOn');\n                $single_pulse_switch.trigger('turnOff');\n                $double_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $continuous_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $single_pulse_switch_on.on('click', function() {\n            request.params = {\n                'mode': 2,\n                'pulse_width': get_single_pulse_width(),\n                'pulse_interval': 0,\n                'pulse_cycle': get_single_pulse_cycle()\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n                $single_pulse_switch.trigger('turnOn');\n                $double_pulse_switch.trigger('turnOff');\n            });\n        });\n\n        $single_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $single_pulse_switch.trigger('turnOff');\n            });\n\n        });\n\n        $double_pulse_switch_on.on('click', function() {\n            request.params = {\n              'mode': 3,\n              'pulse_width': get_double_pulse_width(),\n              'pulse_interval': get_double_pulse_interval(),\n              'pulse_cycle': get_double_pulse_cycle(),\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $continuous_pulse_switch.trigger('turnOff');\n                $single_pulse_switch.trigger('turnOff');\n                $double_pulse_switch.trigger('turnOn');\n            });\n        });\n\n        $double_pulse_switch_off.on('click', function() {\n            request.params = {\n                'mode': 0\n            };\n            request.send().done(function(data) {\n                console.log(data);\n                $double_pulse_switch.trigger('turnOff');\n            });\n\n        });\n\n\n        var get_continuous_pulse_width = function() {\n            return parseFloat($('#continuous-pulse-width').val());\n        }\n\n        var get_continuous_pulse_interval = function() {\n            return parseFloat($('#continuous-pulse-interval').val());\n        }\n\n        var get_single_pulse_width = function() {\n            return parseFloat($('#single-pulse-width').val());\n        }\n\n        var get_single_pulse_cycle = function() {\n            return parseFloat($('#single-pulse-cycle').val());\n        }\n\n        var get_double_pulse_width = function() {\n            return parseFloat($('#double-pulse-width').val());\n        }\n\n        var get_double_pulse_interval = function() {\n            return parseFloat($('#double-pulse-interval').val());\n        }\n\n        var get_double_pulse_cycle = function() {\n            return parseFloat($('#double-pulse-cycle').val());\n        }\n\n\n        request.params = {\n            'mode': 0\n        };\n        request.send().done(function(data) {\n            console.log(data);\n        });\n\n    }(jQuery);\n  </script>\n</html>\n```\n\n\u30b9\u30bf\u30a4\u30eb\u30b7\u30fc\u30c8\u306b[Bootstrap3](http://getbootstrap.com/)\u3092\u3001JavaScript\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u306f[jQuery](https://jquery.com/)\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u305e\u308c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3001HTML\u306eHEAD\u5185\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u30d1\u30b9\u306e\u3068\u304a\u308a\u306b\u914d\u7f6e\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```\npulse_controller.html\n\u251c css\n\u2502\u3000 \u2514 bootstrap.min.css\n\u2514 js\n\u3000\u3000\u251c jquery-3.1.1.min.js\n\u3000\u3000\u2514 bootstrap.min.js\n```\n\n\u3053\u308c\u3092\u30ed\u30fc\u30ab\u30eb\u306e\u9069\u5f53\u306a\u30d5\u30a9\u30eb\u30c0\u30fc\u306b\u653e\u308a\u8fbc\u3093\u3067\u3001HTML\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30d6\u30eb\u30af\u30ea\u30c3\u30af\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\u4e0a\u306b\u8cbc\u308a\u4ed8\u3051\u305f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001ON/OFF\u30dc\u30bf\u30f3\u3092\u64cd\u4f5c\u3057\u305f\u308a\u3059\u308b\u3068Arduino\u306b\u8a2d\u5b9a\u5024\u304c\u9001\u4fe1\u3055\u308c\u307e\u3059\u3002\n\n\u30b7\u30ea\u30a2\u30eb\u30e2\u30cb\u30bf\u306b\u30ed\u30b0\u304c\u51fa\u307e\u3059\u3002\n\n![WS000016.JPG](https://qiita-image-store.s3.amazonaws.com/0/14792/8b7232b3-c56a-5960-8f53-6cadf927ed74.jpeg)\n\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u76f8\u5909\u308f\u3089\u305a\u52d5\u304b\u3059\u3053\u3068\u3092\u6700\u512a\u5148\u3067\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u300c\u3053\u3053\u306f\u3053\u3046\u66f8\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3088\u300d\u306a\u3069\u306e\u3054\u610f\u898b\u3054\u3056\u3044\u307e\u3057\u305f\u3089\u30b3\u30e1\u30f3\u30c8\u3067\u30a2\u30c9\u30d0\u30a4\u30b9\u3044\u305f\u3060\u3051\u307e\u3059\u3068\u5e78\u751a\u3067\u3059\u3002\n\n\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n", "tags": ["FPGA", "Arduino", "JavaScript", "jQuery", "Ajax"]}