{"context": " More than 1 year has passed since last update.\n\n\u30b5\u30de\u30ea\nBluemix\u306b\u306f\"Watson Q&A\"\u3068\u3044\u3046\u30c7\u30e2\u7528\u306eQ&A\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308a\u3001\"\u30d8\u30eb\u30b9\u30b1\u30a2\"\u3068\"\u30c8\u30e9\u30d9\u30eb\"\u306e\u5206\u91ce\u306b\u3064\u3044\u3066\u56de\u7b54\u3057\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308a\u307e\u3059\u3002Github\u306b\u3053\u308c\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea(\u305f\u3060\u3057\u82f1\u8a9e\u7248)\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u7ffb\u8a33\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u65e5\u672c\u8a9e\u5316\u3057\u3064\u3064\u3001\u5143\u306e\u30b3\u30fc\u30c9\u3082\u62dd\u898b\u3057\u3066\u304a\u52c9\u5f37\u3057\u307e\u3057\u305f\u3068\u3044\u3046\u304a\u8a71\u3002\n\u5143\u306e\u30a2\u30d7\u30ea\u306fAndrew trice\u3055\u3093\u4f5c\u6210\u306e\u3053\u3061\u3089\u3002\nVoice-Driven Native Mobile Apps with IBM Watson & IBM MobileFirst\nhttp://www.tricedesigns.com/2015/07/13/voice-driven-native-mobile-apps-with-ibm-watson/\n\n\u4f5c\u3063\u305f(\u66f8\u304d\u63db\u3048\u305f)\u3082\u306e\n\"\u30d8\u30eb\u30b9\u30b1\u30a2\"\u306b\u95a2\u3059\u308b\u8cea\u554f\u3092\u97f3\u58f0\u8a8d\u8b58\u3057\u3001\u305d\u306e\u8cea\u554f\u3078\u306e\u56de\u7b54\u3092\u97f3\u58f0\u3067\u8aad\u307f\u4e0a\u3052\u308b\u30a2\u30d7\u30ea\u3002\u30a4\u30e1\u30fc\u30b8\u3067\u8a00\u3046\u3068\u2193\u306a\u611f\u3058\u3002\n\n\u52d5\u753b\u3060\u3068\u3053\u3093\u306a\u611f\u3058(https://www.youtube.com/watch?v=0zFuuHjsBaE&feature=youtu.be)\n\u305f\u3060\u3001\u5b66\u7fd2\u3055\u305b\u3066\u3044\u308b\u5185\u5bb9\u304b\u3089\u3001\u201d\u4f1a\u8a71\"\u306b\u306f\u3061\u3087\u3063\u3068\u7591\u554f\u7b26\u304c\u3064\u304f\u304b\u3082\u3002\u5fdc\u7b54\u90e8\u5206\u3092\u81ea\u524d\u3067\u4f5c\u308b\u3068\u3001\u3088\u308a\u4f1a\u8a71\u3089\u3057\u304f\u306a\u308a\u305d\u3046\u3002\n\n\u30a2\u30d7\u30ea\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3068\u51e6\u7406\u9806\u5e8f\n\n1.iOS\u30a2\u30d7\u30ea\u4e0a\u3067\u30de\u30a4\u30af\u3092\u6709\u52b9\u306b\u3057Recording\u3001WAV\u30d5\u30a1\u30a4\u30eb\u3067\u4fdd\u5b58\n2.WAV\u3092Node.js\u306bPost\u3057\u3001Node.js\u304b\u3089Speech to Text\u3067\u97f3\u58f0\u8a8d\u8b58\u3002\u540c\u6642\u306b\u3001\u7ffb\u8a33\u30b5\u30fc\u30d3\u30b9\u3092\u3064\u304b\u3063\u3066\u8a8d\u8b58\u3057\u305f\u6587\u5b57\u5217\u3092\u82f1\u8a33\u3002\u97f3\u58f0\u8a8d\u8b58\u3057\u305f\u6587\u5b57\u5217\u306e\u65e5\u672c\u8a9e\u30fb\u82f1\u8a9e\u3092\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3078\u5fdc\u7b54\u3002\n3.iOS\u30a2\u30d7\u30ea\u30672\u3067\u8a8d\u8b58\u3057\u305f\u65e5\u672c\u8a9e\u3092\u8868\u793a\u3002\u82f1\u8a33\u3057\u305f\u8cea\u554f\u3092Node.js\u306b\u5bfe\u3057\u3066Post\n4.Node.js\u304b\u3089Question and Answer\u306b\u5bfe\u3057\u3066\u8cea\u554f\u3001\u5f97\u305f\u56de\u7b54\u3092\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3078\u5fdc\u7b54\n5.\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304b\u3089\u3001\u5f97\u305f\u56de\u7b54\u306e\u3046\u3061\u3001\u6700\u3082\u30b9\u30b3\u30a2\u306e\u9ad8\u3044\u3082\u306e\u3092\u53d6\u5f97\u3057Post\u3002Node.js\u304c\u7ffb\u8a33\u3057\u3066\u5fdc\u7b54\n6.\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304c\u5fdc\u7b54\u3055\u308c\u305f\u65e5\u672c\u8a9e\u3092\u8aad\u307f\u4e0a\u3052\n\u30a2\u30d7\u30ea\u306f\u3001Andrew\u3055\u3093\u306e\u8a31\u53ef\u3092\u5f97\u3066\u3001\u4ee5\u4e0b\u306bfork\u3057\u3066\u30a2\u30c3\u30d7\u3057\u3066\u3044\u307e\u3059\u3002\nIBM-Watson-Speech-QA-Japanese-iOS\nhttps://github.com/GodaiAoki/IBM-Watson-Speech-QA-Japanese-iOS\n\nQA\u30a2\u30d7\u30ea\u306e\u30dd\u30a4\u30f3\u30c8\n\nWAV\u30d5\u30a1\u30a4\u30eb\u306ePost\u3068\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\n\u4eca\u56de\u306e\u3067\u4e00\u756a\u52c9\u5f37\u306b\u306a\u3063\u305f\u306e\u306f\u3001\u97f3\u58f0\u3067\u3042\u308bwav\u30d5\u30a1\u30a4\u30eb\u306ePost\u65b9\u6cd5\u3002multipart/form-data\u3067Post\u3057\u3066\u307e\u3059\u3002\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304b\u3089WAV\u30d5\u30a1\u30a4\u30eb\u3092Post\u3059\u308b\u30b3\u30fc\u30c9(objective-c)\n-(void) postToServer {\n\n    //update ui in main thread\n    dispatch_async(dispatch_get_main_queue(), ^{\n        [self.recordButton setEnabled:NO];\n    });\n\n    [logger logInfoWithMessages:@\"posting WAV to server...\"];\n\n    IMFResourceRequest * imfRequest = [IMFResourceRequest requestWithPath:transcribeURL method:@\"POST\"];\n    NSData *data = [NSData dataWithContentsOfURL:audioRecorder.url];\n    NSStringEncoding encoding = NSUTF8StringEncoding;\n\n    NSString *boundary = @\"------------------------------------------------------\";\n    NSString *contentType = [NSString stringWithFormat:@\"multipart/form-data; boundary=%@\",boundary];\n\n    [imfRequest setValue:contentType forHTTPHeaderField: @\"Content-Type\"];\n\n    NSMutableData *body = [NSMutableData data];\n\n    [body appendData:[[NSString stringWithFormat:@\"--%@\\r\\n\", boundary] dataUsingEncoding:encoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Disposition: form-data; name=\\\"audio\\\"; filename=\\\"%@\\\"\\r\\n\", @\"audio.wav\"] dataUsingEncoding:encoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Type: %@\\r\\n\\r\\n\", @\"audio/wav\"] dataUsingEncoding:encoding]];\n    [body appendData:data];\n    [body appendData:[[NSString stringWithFormat:@\"\\r\\n--%@--\\r\\n\",boundary] dataUsingEncoding:encoding]];\n\n\n    [imfRequest setHTTPBody:body];\n    [imfRequest sendWithCompletionHandler:^(IMFResponse *response, NSError *error) {\n\n        NSDictionary* json = response.responseJson;\n        if (json == nil) {\n            json = @{@\"transcript\":@\"\"};\n            [logger logErrorWithMessages:@\"Unable to retrieve results from server.  %@\", [error localizedDescription]];\n        }\n\n\n        //change start\n        NSString *resultTranscript = [json objectForKey:@\"transcript\"];\n        //\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3067resultString\u306b\u82f1\u8a33\u6587\u5b57\u3092\u8ffd\u52a0\n        NSArray *resultarray =[resultTranscript componentsSeparatedByString:@\"!%!\"];\n        NSString *resultString = resultarray[0];\n        //change end\n\n        BOOL animating = YES;\n\n\n\n        if ( error != nil ) {\n            resultString = [NSString stringWithFormat:@\"%@ Try again later.\", [error localizedDescription]];\n            animating = NO;\n        }\n        else if (resultString == nil || [resultString length] <= 0 || [resultString isEqualToString:@\"\"]) {\n\n            resultString = @\"Sorry, I didn't catch that.  Try again?\";\n            animating = NO;\n        }\n        else {\n            //change start\n            //\u82f1\u8a33\u3057\u305f\u6587\u5b57\u5217\u3092\u6295\u3052\u308b\n            [self requestQA:resultarray[1]];\n            //change end\n        }\n\n        [logger logInfoWithMessages:@\"Transcript: %@\", resultString];\n\n        //update ui in main thread\n        dispatch_async(dispatch_get_main_queue(), ^{\n            if( !animating) {\n                [self.activityView stopAnimating];\n                [self.activityView setHidden:YES];\n            }\n            [self.queryLabel setText:resultString];\n            [self.recordButton setEnabled:YES];\n        });\n    }];\n}\n\n\n\nPost\u3055\u308c\u305fWav\u3092Node.js\u5074\u3067\u306ffs\u306ecreateReadStream\u3067\u8aad\u307f\u53d6\u308a\n\n//fs = require('fs') \n\n// Handle the form POST containing an audio file and return transcript (from mobile)\napp.post('/transcribe', function(req, res){\n\n    var file = req.files.audio;\n    var readStream = fs.createReadStream(file.path);\n    console.log(\"opened stream for \" + file.path);\n        var params = {\n        audio:readStream,\n        model:'ja-JP_BroadbandModel',\n        content_type:'audio/l16; rate=16000; channels=1',\n        continuous:\"true\"\n    };\n\n    //var params = {\n      //  audio:readStream,\n        //content_type:'audio/l16; rate=16000; channels=1',\n        //continuous:\"true\"\n    //};\n\n    speechToText.recognize(params, function(err, response) {\n\n        readStream.close();\n\n        if (err) {\n            return res.status(err.code || 500).json(err);\n        } else {\n            var result = {};\n            if (response.results.length > 0) {\n                var finalResults = response.results.filter( isFinalResult );\n\n                if ( finalResults.length > 0 ) {\n                   result = finalResults[0].alternatives[0];\n                   console.log('result=' + shallowStringify(result));\n                   //\u82f1\u8a33\u8ffd\u52a0\n                    var params = {\n                        text: result.transcript\n                        , from: 'ja'\n                        , to: 'en'\n                    };\n                    msclient.translate(params, function(err, data) {\n                        if(err) console.log('err!' +err);\n                        console.log('translated=' + data);\n                        result.transcript = result.transcript +\"!%!\" +data;\n                        return res.send( result );\n                    });\n                }\n            }\n        }\n    });\n});\n\n\n\u7ffb\u8a33\n\u7ffb\u8a33\u306fMicrosoft Translater API\u3092\u5229\u7528\u3002Node.js\u306emstranlator module( https://www.npmjs.com/package/mstranslator )\u3092\u5229\u7528\u3059\u308b\u3068\u697d\u3060\u3063\u305f\u3002\nnpm install mstranslator\n\nMsTranslator = require('mstranslator');\n\n\nvar msclient = new MsTranslator({\n      client_id: \"Microsoft Tranlater API\u306b\u767b\u9332\u3057\u305fappID\"\n      , client_secret: \"\u767b\u9332\u6642\u306b\u767a\u884c\u3055\u308c\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30ad\u30fc\"\n    }, true);\n\napp.post('/translate', function(req, res){\n    console.log('translation start');\n    console.log('req=' + shallowStringify(req));\n    console.log('req.body.text=' + req.body.text);\n    var params = {\n        text: req.body.text\n        , from: 'en'\n        , to: 'ja'\n    };\n    msclient.translate(params, function(err, data) {\n        if(err) {\n            console.log('err!' +err);\n            res.status(500).send('Bad Query')\n        }\n        console.log('translated=' + data);\n        return res.send( data );\n    });\n\n});\n\n\n\u97f3\u58f0\u8aad\u307f\u4e0a\u3052\n\u3053\u3061\u3089\u306f\u6c7a\u307e\u3063\u305f\u3084\u308a\u65b9\u304c\u3042\u308b\u306e\u3067\u7279\u306b\u96e3\u3057\u304f\u306a\u3044\u3002\n-(void) speak:(NSDictionary*)data {\n\n    BOOL speaking = self.synthesizer.isSpeaking;\n    if (speaking)\n        [self.synthesizer stopSpeakingAtBoundary:AVSpeechBoundaryImmediate];\n\n    if (!speaking || currentData != data) {\n\n        [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil];\n\n        NSString *text = [data objectForKey:@\"text\"];\n        NSArray *sentences = [text componentsSeparatedByString:@\".\"];\n\n        for (int i=0;i<[sentences count]; i++) {\n            AVSpeechUtterance *utterance = [AVSpeechUtterance\n                                            speechUtteranceWithString:[sentences objectAtIndex:i]];\n\n            utterance.rate = 0.5;\n            utterance.preUtteranceDelay = 0.0;\n            utterance.volume = 1.0;\n\n            [self.synthesizer speakUtterance:utterance];\n        }\n    }\n    currentData = data;\n}\n\n\n\u7d42\u308f\u308a\u306b\n\u97f3\u58f0\u53d7\u3051\u53d6\u308a\u30fb\u8a8d\u8b58\u30fb\u8aad\u307f\u4e0a\u3052\u3042\u305f\u308a\u306e\u5b9f\u88c5\u65b9\u6cd5\u306f\u308f\u304b\u3063\u305f\u306e\u3067\u3001\u3088\u308a\u4f1a\u8a71\u3089\u3057\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u5fdc\u7b54\u3092\u81ea\u524d\u3067\u4f5c\u3063\u305f\u3082\u306e\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u3002\nBluemix\u306eWatson API\u3092\u99c6\u4f7f\u3057\u3066\u65e5\u672c\u8a9e\u8cea\u554f\u5fdc\u7b54\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u308b\nhttp://qiita.com/VegaSato/items\nBluemix Dialog\nhttp://dialog-demo.mybluemix.net/?cm_mc_uid=95527112266014321770359&cm_mc_sid_50200000=1450239397\n\n\n\n#\u30b5\u30de\u30ea\nBluemix\u306b\u306f\"Watson Q&A\"\u3068\u3044\u3046\u30c7\u30e2\u7528\u306eQ&A\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308a\u3001\"\u30d8\u30eb\u30b9\u30b1\u30a2\"\u3068\"\u30c8\u30e9\u30d9\u30eb\"\u306e\u5206\u91ce\u306b\u3064\u3044\u3066\u56de\u7b54\u3057\u3066\u304f\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u304c\u3042\u308a\u307e\u3059\u3002Github\u306b\u3053\u308c\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea(\u305f\u3060\u3057\u82f1\u8a9e\u7248)\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u7ffb\u8a33\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3063\u3066\u65e5\u672c\u8a9e\u5316\u3057\u3064\u3064\u3001\u5143\u306e\u30b3\u30fc\u30c9\u3082\u62dd\u898b\u3057\u3066\u304a\u52c9\u5f37\u3057\u307e\u3057\u305f\u3068\u3044\u3046\u304a\u8a71\u3002\n\n\u5143\u306e\u30a2\u30d7\u30ea\u306fAndrew trice\u3055\u3093\u4f5c\u6210\u306e\u3053\u3061\u3089\u3002\n\nVoice-Driven Native Mobile Apps with IBM Watson & IBM MobileFirst\nhttp://www.tricedesigns.com/2015/07/13/voice-driven-native-mobile-apps-with-ibm-watson/\n\n\n#\u4f5c\u3063\u305f(\u66f8\u304d\u63db\u3048\u305f)\u3082\u306e\n\"\u30d8\u30eb\u30b9\u30b1\u30a2\"\u306b\u95a2\u3059\u308b\u8cea\u554f\u3092\u97f3\u58f0\u8a8d\u8b58\u3057\u3001\u305d\u306e\u8cea\u554f\u3078\u306e\u56de\u7b54\u3092\u97f3\u58f0\u3067\u8aad\u307f\u4e0a\u3052\u308b\u30a2\u30d7\u30ea\u3002\u30a4\u30e1\u30fc\u30b8\u3067\u8a00\u3046\u3068\u2193\u306a\u611f\u3058\u3002\n\n![Kobito.v1vEXF.png](https://qiita-image-store.s3.amazonaws.com/0/76526/14862c28-b984-e562-1bd2-779d1a2ae6d5.png \"Kobito.v1vEXF.png\")\n\n\u52d5\u753b\u3060\u3068\u3053\u3093\u306a\u611f\u3058(https://www.youtube.com/watch?v=0zFuuHjsBaE&feature=youtu.be)\n\n\u305f\u3060\u3001\u5b66\u7fd2\u3055\u305b\u3066\u3044\u308b\u5185\u5bb9\u304b\u3089\u3001\u201d\u4f1a\u8a71\"\u306b\u306f\u3061\u3087\u3063\u3068\u7591\u554f\u7b26\u304c\u3064\u304f\u304b\u3082\u3002\u5fdc\u7b54\u90e8\u5206\u3092\u81ea\u524d\u3067\u4f5c\u308b\u3068\u3001\u3088\u308a\u4f1a\u8a71\u3089\u3057\u304f\u306a\u308a\u305d\u3046\u3002\n\n\n\n\n#\u30a2\u30d7\u30ea\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3068\u51e6\u7406\u9806\u5e8f\n\n![Kobito.XRbdjD.png](https://qiita-image-store.s3.amazonaws.com/0/76526/be6625f3-010a-55a3-5135-71f78c43bff8.png \"Kobito.XRbdjD.png\")\n\n1.iOS\u30a2\u30d7\u30ea\u4e0a\u3067\u30de\u30a4\u30af\u3092\u6709\u52b9\u306b\u3057Recording\u3001WAV\u30d5\u30a1\u30a4\u30eb\u3067\u4fdd\u5b58\n2.WAV\u3092Node.js\u306bPost\u3057\u3001Node.js\u304b\u3089Speech to Text\u3067\u97f3\u58f0\u8a8d\u8b58\u3002\u540c\u6642\u306b\u3001\u7ffb\u8a33\u30b5\u30fc\u30d3\u30b9\u3092\u3064\u304b\u3063\u3066\u8a8d\u8b58\u3057\u305f\u6587\u5b57\u5217\u3092\u82f1\u8a33\u3002\u97f3\u58f0\u8a8d\u8b58\u3057\u305f\u6587\u5b57\u5217\u306e\u65e5\u672c\u8a9e\u30fb\u82f1\u8a9e\u3092\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3078\u5fdc\u7b54\u3002\n3.iOS\u30a2\u30d7\u30ea\u30672\u3067\u8a8d\u8b58\u3057\u305f\u65e5\u672c\u8a9e\u3092\u8868\u793a\u3002\u82f1\u8a33\u3057\u305f\u8cea\u554f\u3092Node.js\u306b\u5bfe\u3057\u3066Post\n4.Node.js\u304b\u3089Question and Answer\u306b\u5bfe\u3057\u3066\u8cea\u554f\u3001\u5f97\u305f\u56de\u7b54\u3092\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3078\u5fdc\u7b54\n5.\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304b\u3089\u3001\u5f97\u305f\u56de\u7b54\u306e\u3046\u3061\u3001\u6700\u3082\u30b9\u30b3\u30a2\u306e\u9ad8\u3044\u3082\u306e\u3092\u53d6\u5f97\u3057Post\u3002Node.js\u304c\u7ffb\u8a33\u3057\u3066\u5fdc\u7b54\n6.\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304c\u5fdc\u7b54\u3055\u308c\u305f\u65e5\u672c\u8a9e\u3092\u8aad\u307f\u4e0a\u3052\n\n\u30a2\u30d7\u30ea\u306f\u3001Andrew\u3055\u3093\u306e\u8a31\u53ef\u3092\u5f97\u3066\u3001\u4ee5\u4e0b\u306bfork\u3057\u3066\u30a2\u30c3\u30d7\u3057\u3066\u3044\u307e\u3059\u3002\n\nIBM-Watson-Speech-QA-Japanese-iOS\nhttps://github.com/GodaiAoki/IBM-Watson-Speech-QA-Japanese-iOS\n\n\n#QA\u30a2\u30d7\u30ea\u306e\u30dd\u30a4\u30f3\u30c8\n\n##WAV\u30d5\u30a1\u30a4\u30eb\u306ePost\u3068\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\n\u4eca\u56de\u306e\u3067\u4e00\u756a\u52c9\u5f37\u306b\u306a\u3063\u305f\u306e\u306f\u3001\u97f3\u58f0\u3067\u3042\u308bwav\u30d5\u30a1\u30a4\u30eb\u306ePost\u65b9\u6cd5\u3002multipart/form-data\u3067Post\u3057\u3066\u307e\u3059\u3002\n\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u304b\u3089WAV\u30d5\u30a1\u30a4\u30eb\u3092Post\u3059\u308b\u30b3\u30fc\u30c9(objective-c)\n\n```\n-(void) postToServer {\n    \n    //update ui in main thread\n    dispatch_async(dispatch_get_main_queue(), ^{\n        [self.recordButton setEnabled:NO];\n    });\n    \n    [logger logInfoWithMessages:@\"posting WAV to server...\"];\n    \n    IMFResourceRequest * imfRequest = [IMFResourceRequest requestWithPath:transcribeURL method:@\"POST\"];\n    NSData *data = [NSData dataWithContentsOfURL:audioRecorder.url];\n    NSStringEncoding encoding = NSUTF8StringEncoding;\n    \n    NSString *boundary = @\"------------------------------------------------------\";\n    NSString *contentType = [NSString stringWithFormat:@\"multipart/form-data; boundary=%@\",boundary];\n    \n    [imfRequest setValue:contentType forHTTPHeaderField: @\"Content-Type\"];\n    \n    NSMutableData *body = [NSMutableData data];\n    \n    [body appendData:[[NSString stringWithFormat:@\"--%@\\r\\n\", boundary] dataUsingEncoding:encoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Disposition: form-data; name=\\\"audio\\\"; filename=\\\"%@\\\"\\r\\n\", @\"audio.wav\"] dataUsingEncoding:encoding]];\n    [body appendData:[[NSString stringWithFormat:@\"Content-Type: %@\\r\\n\\r\\n\", @\"audio/wav\"] dataUsingEncoding:encoding]];\n    [body appendData:data];\n    [body appendData:[[NSString stringWithFormat:@\"\\r\\n--%@--\\r\\n\",boundary] dataUsingEncoding:encoding]];\n    \n    \n    [imfRequest setHTTPBody:body];\n    [imfRequest sendWithCompletionHandler:^(IMFResponse *response, NSError *error) {\n        \n        NSDictionary* json = response.responseJson;\n        if (json == nil) {\n            json = @{@\"transcript\":@\"\"};\n            [logger logErrorWithMessages:@\"Unable to retrieve results from server.  %@\", [error localizedDescription]];\n        }\n        \n        \n        //change start\n        NSString *resultTranscript = [json objectForKey:@\"transcript\"];\n        //\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u3067resultString\u306b\u82f1\u8a33\u6587\u5b57\u3092\u8ffd\u52a0\n        NSArray *resultarray =[resultTranscript componentsSeparatedByString:@\"!%!\"];\n        NSString *resultString = resultarray[0];\n        //change end\n        \n        BOOL animating = YES;\n        \n\n        \n        if ( error != nil ) {\n            resultString = [NSString stringWithFormat:@\"%@ Try again later.\", [error localizedDescription]];\n            animating = NO;\n        }\n        else if (resultString == nil || [resultString length] <= 0 || [resultString isEqualToString:@\"\"]) {\n            \n            resultString = @\"Sorry, I didn't catch that.  Try again?\";\n            animating = NO;\n        }\n        else {\n            //change start\n            //\u82f1\u8a33\u3057\u305f\u6587\u5b57\u5217\u3092\u6295\u3052\u308b\n            [self requestQA:resultarray[1]];\n            //change end\n        }\n        \n        [logger logInfoWithMessages:@\"Transcript: %@\", resultString];\n        \n        //update ui in main thread\n        dispatch_async(dispatch_get_main_queue(), ^{\n            if( !animating) {\n                [self.activityView stopAnimating];\n                [self.activityView setHidden:YES];\n            }\n            [self.queryLabel setText:resultString];\n            [self.recordButton setEnabled:YES];\n        });\n    }];\n}\n\n\n```\n\nPost\u3055\u308c\u305fWav\u3092Node.js\u5074\u3067\u306ffs\u306ecreateReadStream\u3067\u8aad\u307f\u53d6\u308a\n\n```\n\n//fs = require('fs') \n\n// Handle the form POST containing an audio file and return transcript (from mobile)\napp.post('/transcribe', function(req, res){\n    \n    var file = req.files.audio;\n    var readStream = fs.createReadStream(file.path);\n    console.log(\"opened stream for \" + file.path);\n        var params = {\n        audio:readStream,\n        model:'ja-JP_BroadbandModel',\n        content_type:'audio/l16; rate=16000; channels=1',\n        continuous:\"true\"\n    };\n    \n    //var params = {\n      //  audio:readStream,\n        //content_type:'audio/l16; rate=16000; channels=1',\n        //continuous:\"true\"\n    //};\n         \n    speechToText.recognize(params, function(err, response) {\n        \n        readStream.close();\n        \n        if (err) {\n            return res.status(err.code || 500).json(err);\n        } else {\n            var result = {};\n            if (response.results.length > 0) {\n                var finalResults = response.results.filter( isFinalResult );\n                \n                if ( finalResults.length > 0 ) {\n                   result = finalResults[0].alternatives[0];\n                   console.log('result=' + shallowStringify(result));\n                   //\u82f1\u8a33\u8ffd\u52a0\n\t\t\t\t\tvar params = {\n      \t\t\t\t\ttext: result.transcript\n      \t\t\t\t\t, from: 'ja'\n      \t\t\t\t\t, to: 'en'\n    \t\t\t\t};\n    \t\t\t\tmsclient.translate(params, function(err, data) {\n    \t\t\t\t\tif(err) console.log('err!' +err);\n      \t\t\t\t\tconsole.log('translated=' + data);\n\t\t\t\t\t\tresult.transcript = result.transcript +\"!%!\" +data;\n\t\t\t\t\t\treturn res.send( result );\n    \t\t\t\t});\n                }\n            }\n        }\n    });\n});\n```\n\n##\u7ffb\u8a33\n\u7ffb\u8a33\u306fMicrosoft Translater API\u3092\u5229\u7528\u3002Node.js\u306emstranlator module( https://www.npmjs.com/package/mstranslator )\u3092\u5229\u7528\u3059\u308b\u3068\u697d\u3060\u3063\u305f\u3002\n\n```\nnpm install mstranslator\n```\n\n```\nMsTranslator = require('mstranslator');\n\n\nvar msclient = new MsTranslator({\n      client_id: \"Microsoft Tranlater API\u306b\u767b\u9332\u3057\u305fappID\"\n      , client_secret: \"\u767b\u9332\u6642\u306b\u767a\u884c\u3055\u308c\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30ad\u30fc\"\n    }, true);\n\napp.post('/translate', function(req, res){\n\tconsole.log('translation start');\n\tconsole.log('req=' + shallowStringify(req));\n\tconsole.log('req.body.text=' + req.body.text);\n\tvar params = {\n    \ttext: req.body.text\n      \t, from: 'en'\n      \t, to: 'ja'\n    };\n    msclient.translate(params, function(err, data) {\n    \tif(err) {\n    \t\tconsole.log('err!' +err);\n    \t\tres.status(500).send('Bad Query')\n    \t}\n      \tconsole.log('translated=' + data);\n\t\treturn res.send( data );\n    });\n\t\n});\n```\n\n\n##\u97f3\u58f0\u8aad\u307f\u4e0a\u3052\n\u3053\u3061\u3089\u306f\u6c7a\u307e\u3063\u305f\u3084\u308a\u65b9\u304c\u3042\u308b\u306e\u3067\u7279\u306b\u96e3\u3057\u304f\u306a\u3044\u3002\n\n```\n-(void) speak:(NSDictionary*)data {\n    \n    BOOL speaking = self.synthesizer.isSpeaking;\n    if (speaking)\n        [self.synthesizer stopSpeakingAtBoundary:AVSpeechBoundaryImmediate];\n    \n    if (!speaking || currentData != data) {\n        \n        [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil];\n        \n        NSString *text = [data objectForKey:@\"text\"];\n        NSArray *sentences = [text componentsSeparatedByString:@\".\"];\n        \n        for (int i=0;i<[sentences count]; i++) {\n            AVSpeechUtterance *utterance = [AVSpeechUtterance\n                                            speechUtteranceWithString:[sentences objectAtIndex:i]];\n            \n            utterance.rate = 0.5;\n            utterance.preUtteranceDelay = 0.0;\n            utterance.volume = 1.0;\n            \n            [self.synthesizer speakUtterance:utterance];\n        }\n    }\n    currentData = data;\n}\n```\n\n\n#\u7d42\u308f\u308a\u306b\n\u97f3\u58f0\u53d7\u3051\u53d6\u308a\u30fb\u8a8d\u8b58\u30fb\u8aad\u307f\u4e0a\u3052\u3042\u305f\u308a\u306e\u5b9f\u88c5\u65b9\u6cd5\u306f\u308f\u304b\u3063\u305f\u306e\u3067\u3001\u3088\u308a\u4f1a\u8a71\u3089\u3057\u304f\u3059\u308b\u305f\u3081\u306b\u3001\u5fdc\u7b54\u3092\u81ea\u524d\u3067\u4f5c\u3063\u305f\u3082\u306e\u3092\u8a66\u3057\u3066\u307f\u305f\u3044\u3002\n\nBluemix\u306eWatson API\u3092\u99c6\u4f7f\u3057\u3066\u65e5\u672c\u8a9e\u8cea\u554f\u5fdc\u7b54\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u308b\nhttp://qiita.com/VegaSato/items\n\nBluemix Dialog\nhttp://dialog-demo.mybluemix.net/?cm_mc_uid=95527112266014321770359&cm_mc_sid_50200000=1450239397\n\n", "tags": ["Bluemix", "iOS", "Objective-C"]}