{"context": " More than 1 year has passed since last update.Movable Type\u30af\u30e9\u30a6\u30c9\u7248\u306e\u30b5\u30fc\u30d0\u914d\u4fe1\u6a5f\u80fd\u306f\u6a5f\u80fd\u81ea\u4f53\u306f\u7533\u3057\u5206\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u3092\u884c\u3046\u753b\u9762\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u5c65\u6b74\u7b49\u304c\u78ba\u8a8d\u3067\u304d\u305a\u4f7f\u7528\u3057\u3066\u3044\u3066\u3044\u307e\u3044\u3061\u5b89\u5fc3\u611f\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u3067\u3059\u304c\u3001MT\u306e\u30ed\u30b0\u3092\u898b\u3066\u307f\u308b\u3068\u300c\u30b5\u30fc\u30d0\u30fc\u914d\u4fe1\u304c\u6b63\u5e38\u306b\u51e6\u7406\u3055\u308c\u307e\u3057\u305f\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u305f\u308a\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u3044\u3044\u611f\u3058\u306b\u8868\u793a\u3059\u308c\u3070\u914d\u4fe1\u5c65\u6b74\u3068\u3057\u3066\u4f7f\u7528\u3067\u304d\u305d\u3046\u3067\u3059\u3002\nMT\u306e\u30ed\u30b0\u306b\u306fcategory\u3068\u3044\u3046\u60c5\u5831\u3092\u4ed8\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u30ed\u30b0\u3092\u5206\u985e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u524d\u8ff0\u306e\u30ed\u30b0\u306b\u306f\u300ccontents_sync\u300d\u3068\u3044\u3046category\u304c\u3064\u3051\u3089\u308c\u3066\u3044\u305f\u70ba\u3001\u3053\u306ecategory\u3067\u30ed\u30b0\u3092\u629c\u304d\u51fa\u305b\u3070\u30b5\u30fc\u30d0\u914d\u4fe1\u7cfb\u306e\u30ed\u30b0\u3060\u3051\u3092\u53d6\u5f97\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067\u30b5\u30fc\u30d0\u914d\u4fe1\u7cfb\u306e\u30ed\u30b0\u306e\u6700\u65b05\u4ef6\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n    my @logs = MT::Log->load(\n                   { blog_id => $blog->id, category => 'contents_sync' },\n                   {\n                        sort => 'created_on',\n                        direction => 'descend',\n                        limit => 5\n                    }\n    );\n\n\u3053\u308c\u3092\u8868\u793a\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u9069\u5f53\u306b\u3053\u3057\u3089\u3048\u308b\u3068\u5b89\u5fc3\u611f\u304c\u307e\u3057\u3066\u3044\u3044\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\nconfig.yaml\nid  : MTCloudDeployLog\nkey : MTCloudDeployLog\nname: MT\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\nversion: 1.0\nauthor_name: rryu\nauthor_link: \ndescription: MT\u30af\u30e9\u30a6\u30c9\u306e\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\u3092\u8868\u793a\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nwidgets:\n    deploy_log:\n        label: \u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\n        plugin: $MTCloudDeployLog\n        singular: 1\n        set: main\n        template: deploy_log_widget.tmpl\n        handler: $MTCloudDeployLog::hdlr_deploy_log_widget\n\n\n\ntmpl/deploy_log_widget.tmpl\n<mtapp:widget\n   label=\"\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\"\n   id=\"deploy_log_widget\"\n   class=\"widget\"\n   can_close=\"1\">\n\n    <ul>\n      <mt:Loop name=\"logs\">\n        <li>\n          <$mt:Var name=\"log.format_created_on\"$> : \n          <$mt:Var name=\"log.message\"$>\n        </li>\n      </mt:Loop>\n    </ul>\n\n</mtapp:widget>\n\n\n\nlib/MTCloudDeployLog.pm\npackage MTCloudDeployLog;\nuse strict;\nuse utf8;\n\nsub hdlr_deploy_log_widget {\n    my ($app, $tmpl, $param) = @_;\n\n    my $blog = $app->blog;\n\n    my @logs = MT::Log->load(\n                   { blog_id => $blog->id, category => 'contents_sync' },\n                   {\n                        sort => 'created_on',\n                        direction => 'descend',\n                        limit => 5\n                    }\n    );\n\n    @logs = map { \n        my $item = $_->to_hash();\n        $item->{'log.format_created_on'} = _format_ts_gmt($app, $_->created_on, $blog);\n        $item;\n    } @logs;\n\n    $param->{'logs'} = \\@logs;\n}\n\n\nsub _format_ts_gmt {\n    my ($app, $ts, $blog) = @_;\n\n    return '' unless $ts;\n\n    $blog = $app->blog unless $blog;\n    my $epoch = MT::Util::ts2epoch(undef, $ts);\n    $epoch = MT::Util::offset_time($epoch, undef, 1);\n    $ts = MT::Util::epoch2ts(undef, $epoch);\n\n    my $lang = $app->user ? $app->user->preferred_language : undef;\n\n    return MT::Util::format_ts(MT::App::CMS::LISTING_TIMESTAMP_FORMAT(), $ts, $blog, $lang);\n}\n\n1;\n\n\nMovable Type\u30af\u30e9\u30a6\u30c9\u7248\u306e\u30b5\u30fc\u30d0\u914d\u4fe1\u6a5f\u80fd\u306f\u6a5f\u80fd\u81ea\u4f53\u306f\u7533\u3057\u5206\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u8a2d\u5b9a\u3092\u884c\u3046\u753b\u9762\u3057\u304b\u306a\u3044\u306e\u3067\u3001\u5c65\u6b74\u7b49\u304c\u78ba\u8a8d\u3067\u304d\u305a\u4f7f\u7528\u3057\u3066\u3044\u3066\u3044\u307e\u3044\u3061\u5b89\u5fc3\u611f\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u3067\u3059\u304c\u3001MT\u306e\u30ed\u30b0\u3092\u898b\u3066\u307f\u308b\u3068\u300c\u30b5\u30fc\u30d0\u30fc\u914d\u4fe1\u304c\u6b63\u5e38\u306b\u51e6\u7406\u3055\u308c\u307e\u3057\u305f\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u8a18\u9332\u3055\u308c\u3066\u3044\u305f\u308a\u3057\u307e\u3059\u3002\u3053\u308c\u3092\u3044\u3044\u611f\u3058\u306b\u8868\u793a\u3059\u308c\u3070\u914d\u4fe1\u5c65\u6b74\u3068\u3057\u3066\u4f7f\u7528\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\nMT\u306e\u30ed\u30b0\u306b\u306fcategory\u3068\u3044\u3046\u60c5\u5831\u3092\u4ed8\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u3053\u308c\u306b\u3088\u3063\u3066\u30ed\u30b0\u3092\u5206\u985e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u524d\u8ff0\u306e\u30ed\u30b0\u306b\u306f\u300ccontents_sync\u300d\u3068\u3044\u3046category\u304c\u3064\u3051\u3089\u308c\u3066\u3044\u305f\u70ba\u3001\u3053\u306ecategory\u3067\u30ed\u30b0\u3092\u629c\u304d\u51fa\u305b\u3070\u30b5\u30fc\u30d0\u914d\u4fe1\u7cfb\u306e\u30ed\u30b0\u3060\u3051\u3092\u53d6\u5f97\u3067\u304d\u308b\u306f\u305a\u3067\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3067\u30b5\u30fc\u30d0\u914d\u4fe1\u7cfb\u306e\u30ed\u30b0\u306e\u6700\u65b05\u4ef6\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```pl\n    my @logs = MT::Log->load(\n                   { blog_id => $blog->id, category => 'contents_sync' },\n                   {\n                        sort => 'created_on',\n                        direction => 'descend',\n                        limit => 5\n                    }\n    );\n```\n\n\u3053\u308c\u3092\u8868\u793a\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u9069\u5f53\u306b\u3053\u3057\u3089\u3048\u308b\u3068\u5b89\u5fc3\u611f\u304c\u307e\u3057\u3066\u3044\u3044\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n```yaml:config.yaml\nid  : MTCloudDeployLog\nkey : MTCloudDeployLog\nname: MT\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\nversion: 1.0\nauthor_name: rryu\nauthor_link: \ndescription: MT\u30af\u30e9\u30a6\u30c9\u306e\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\u3092\u8868\u793a\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nwidgets:\n    deploy_log:\n        label: \u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\n        plugin: $MTCloudDeployLog\n        singular: 1\n        set: main\n        template: deploy_log_widget.tmpl\n        handler: $MTCloudDeployLog::hdlr_deploy_log_widget\n```\n\n```html:tmpl/deploy_log_widget.tmpl\n<mtapp:widget\n   label=\"\u30b5\u30fc\u30d0\u914d\u4fe1\u30ed\u30b0\"\n   id=\"deploy_log_widget\"\n   class=\"widget\"\n   can_close=\"1\">\n\n    <ul>\n      <mt:Loop name=\"logs\">\n        <li>\n          <$mt:Var name=\"log.format_created_on\"$> : \n          <$mt:Var name=\"log.message\"$>\n        </li>\n      </mt:Loop>\n    </ul>\n\n</mtapp:widget>\n```\n\n```pl:lib/MTCloudDeployLog.pm\npackage MTCloudDeployLog;\nuse strict;\nuse utf8;\n\nsub hdlr_deploy_log_widget {\n    my ($app, $tmpl, $param) = @_;\n\n    my $blog = $app->blog;\n\n    my @logs = MT::Log->load(\n                   { blog_id => $blog->id, category => 'contents_sync' },\n                   {\n                        sort => 'created_on',\n                        direction => 'descend',\n                        limit => 5\n                    }\n    );\n\n    @logs = map { \n        my $item = $_->to_hash();\n        $item->{'log.format_created_on'} = _format_ts_gmt($app, $_->created_on, $blog);\n        $item;\n    } @logs;\n\n    $param->{'logs'} = \\@logs;\n}\n\n\nsub _format_ts_gmt {\n    my ($app, $ts, $blog) = @_;\n\n    return '' unless $ts;\n\n    $blog = $app->blog unless $blog;\n    my $epoch = MT::Util::ts2epoch(undef, $ts);\n    $epoch = MT::Util::offset_time($epoch, undef, 1);\n    $ts = MT::Util::epoch2ts(undef, $epoch);\n\n    my $lang = $app->user ? $app->user->preferred_language : undef;\n\n    return MT::Util::format_ts(MT::App::CMS::LISTING_TIMESTAMP_FORMAT(), $ts, $blog, $lang);\n}\n\n1;\n```\n", "tags": ["MovableType"]}