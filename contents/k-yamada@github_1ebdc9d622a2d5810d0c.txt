{"context": " More than 1 year has passed since last update.\n\nEnvironment\n\ngitbucket version: 3.6\nlocal git version: 2.4.3\n\n\nProblem\ngitbucket\u306bpush\u3059\u308b\u3068\u304d\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\n$ git push\nCounting objects: 42, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (41/41), done.\nWriting objects: 100% (42/42), 28.99 KiB | 0 bytes/s, done.\nTotal 42 (delta 24), reused 0 (delta 0)\nremote: error: Internal server error\nfatal: The remote end hung up unexpectedly\nfatal: The remote end hung up unexpectedly\nerror: failed to push some refs to 'http://xxx.git'\n\ngitbucket\u306e\u30ed\u30b0\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u305f\n# /var/log/upstart/gitbucket.log\n\n2015-11-09 15:57:38.451:WARN:/:Internal error during receive-pack\norg.eclipse.jgit.errors.PackProtocolException: error: invalid protocol: wanted 'old new ref'\n    at org.eclipse.jgit.transport.BaseReceivePack.recvCommands(BaseReceivePack.java:935)\n    at org.eclipse.jgit.transport.ReceivePack.service(ReceivePack.java:184)\n    at org.eclipse.jgit.transport.ReceivePack.receive(ReceivePack.java:160)\n    at org.eclipse.jgit.http.server.ReceivePackServlet.doPost(ReceivePackServlet.java:187)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n\n\nSolution\n\u53c2\u8003: http://stackoverflow.com/questions/21557004/protocol-error-expected-old-new-ref-got-shallow-deeb\nunshallow\u3057\u305f\u5f8c\u306bpush\u3059\u308b\u3068\u6210\u529f\u3057\u305f\n$ git fetch --unshallow\n$ git push\n\n# Environment\n\n- gitbucket version: 3.6\n- local git version: 2.4.3\n\n# Problem\n\ngitbucket\u306bpush\u3059\u308b\u3068\u304d\u306b\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u305f\n\n```bash\n$ git push\nCounting objects: 42, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (41/41), done.\nWriting objects: 100% (42/42), 28.99 KiB | 0 bytes/s, done.\nTotal 42 (delta 24), reused 0 (delta 0)\nremote: error: Internal server error\nfatal: The remote end hung up unexpectedly\nfatal: The remote end hung up unexpectedly\nerror: failed to push some refs to 'http://xxx.git'\n```\n\ngitbucket\u306e\u30ed\u30b0\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u305f\n\n```bash\n# /var/log/upstart/gitbucket.log\n\n2015-11-09 15:57:38.451:WARN:/:Internal error during receive-pack\norg.eclipse.jgit.errors.PackProtocolException: error: invalid protocol: wanted 'old new ref'\n\tat org.eclipse.jgit.transport.BaseReceivePack.recvCommands(BaseReceivePack.java:935)\n\tat org.eclipse.jgit.transport.ReceivePack.service(ReceivePack.java:184)\n\tat org.eclipse.jgit.transport.ReceivePack.receive(ReceivePack.java:160)\n\tat org.eclipse.jgit.http.server.ReceivePackServlet.doPost(ReceivePackServlet.java:187)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:755)\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:848)\n```\n\n# Solution\n\n\u53c2\u8003: http://stackoverflow.com/questions/21557004/protocol-error-expected-old-new-ref-got-shallow-deeb\n\nunshallow\u3057\u305f\u5f8c\u306bpush\u3059\u308b\u3068\u6210\u529f\u3057\u305f\n\n```bash\n$ git fetch --unshallow\n$ git push\n```\n", "tags": ["GitBucket"]}