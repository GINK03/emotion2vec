{"context": " More than 1 year has passed since last update.OSX + Vagrant + CoreOS\u3067Kubernetes\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u30e1\u30e2\u3067\u3059\u3002\u8a66\u3057\u305f\u624b\u9806\u3092\u591a\u5c11\u6574\u7406\u3057\u3066\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u53c2\u8003\n\nGoogleCloudPlatform/kubernetes\nRunning Kubernetes Example on CoreOS, Part 1\nRunning CoreOS on Vagrant\nkelseyhightower/kubernetes-coreos\n\n\n\u624b\u9806\n\nCoreOS\u3092Vagrant\u3067\u8d77\u52d5\u3057\u3066ssh\u30ed\u30b0\u30a4\u30f3\nRunning CoreOS on Vagrant\u3092\u53c2\u8003\u306bVagrantfile\u3092\u53d6\u5f97\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002Running Kubernetes Example on CoreOS, Part 1\u306b\n\na single node cluster will work for this tutorial.\n\n\u3068\u3042\u308b\u306e\u3067\u3001config.rb\u5185\u306e $num_instances \u306f1\u306e\u307e\u307e\u3067\u826f\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5168\u3066\u30b3\u30e1\u30f3\u30c8\u884c\u306b\u306a\u3063\u3066\u3044\u308bconfig.rb.sample\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3057\u305f\u3002\ngit clone https://github.com/coreos/coreos-vagrant.git\ncd coreos-vagrant\ncp config.rb.sample\nvagrant up\n\n\u8d77\u52d5\u3057\u305f\u3089ssh\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\nvagrant ssh\n\n\nCoreOS\u4e0a\u3067Kubernetes\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30fb\u8d77\u52d5\nRunning Kubernetes Example on CoreOS, Part 1\u306e\u8a18\u8ff0\u306f\u53e4\u3044\u306e\u3067\u3001kelseyhightower/kubernetes-coreos\u306e\u624b\u9806\u306b\u6cbf\u3063\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nKubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\u3053\u3053\u306fRunning Kubernetes Example on CoreOS, Part 1\u3068kelseyhightower/kubernetes-coreos\u3092\u53c2\u8003\u306b\u3057\u305f\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nsudo mkdir -p /opt/kubernetes \nsudo chown -R core: /opt/kubernetes\ncd /opt/kubernetes\n\n\nKubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo mkdir -p /opt/bin\nsudo wget http://storage.googleapis.com/kubernetes/binaries.tar.gz\nsudo tar -xvf binaries.tar.gz -C /opt/bin\n\nkubecfg\u306bPATH\u304c\u901a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ which kubecfg\n/opt/bin/kubecfg\n\n\nKubernetes\u306esystemd\u30e6\u30cb\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\ngit clone https://github.com/kelseyhightower/kubernetes-coreos.git\nsudo cp kubernetes-coreos/units/* /etc/systemd/system/\n\n\nKubernetes\u306e\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\nsudo systemctl start apiserver\nsudo systemctl start controller-manager\nsudo systemctl start kubelet\nsudo systemctl start proxy\n\n\npod\u306e\u4e00\u89a7\u8868\u793a\n\u307e\u3060\u4f55\u3082\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u7a7a\u3067\u3059\u3002\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\n\n\nredis\u306e\u4f8b\u306f\u3046\u307e\u304f\u52d5\u304d\u307e\u3057\u305f\nRunning Kubernetes Example on CoreOS, Part 1\u306eCreating a Kubernetes pod\u306e\u7bc0\u306e\u4f8b\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e0a\u8a18\u306e\u8a18\u4e8b\u3067\u306f /opt/kubernetes/bin/kubecfg \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u306e\u8a18\u4e8b\u3067\u306f /opt/bin/kubecfg \u3067PATH\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u3067\u306f\u5358\u306b kubecfg \u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u307e\u305f -h http://127.0.0.1:8080 \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u7121\u304f\u3066\u3082\u52d5\u3044\u305f\u306e\u3067\u7701\u7565\u3057\u3066\u3044\u307e\u3059\u3002\nCoreOS\u5185\u306e/opt/kubernetes\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\nmkdir kubernetes-coreos/pods\n\ncat <<EOF > kubernetes-coreos/pods/redis.json\n{\n  \"id\": \"redis\",\n  \"desiredState\": {\n    \"manifest\": {\n      \"version\": \"v1beta1\",\n      \"id\": \"redis\",\n      \"containers\": [{\n        \"name\": \"redis\",\n        \"image\": \"dockerfile/redis\",\n        \"ports\": [{\n          \"containerPort\": 6379,\n          \"hostPort\": 6379\n        }]\n      }]\n    }\n  },\n  \"labels\": {\n    \"name\": \"redis\"\n  }\n}\nEOF\n\nkubecfg -c kubernetes-coreos/pods/redis.json create /pods\n\n\u3057\u3070\u3089\u304f\uff0810\u5206\u3050\u3089\u3044\uff1f\uff09\u653e\u7f6e\u3057\u3066\u305f\u3089\u7121\u4e8b\u7d42\u4e86\u3057\u3066\u3044\u307e\u3057\u305f\u3002pod\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis               dockerfile/redis    127.0.0.1/          name=redis\n\ndocker0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes $ ip a show docker0\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP\n    link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff\n    inet 10.1.42.1/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::5484:7aff:fefe:9799/64 scope link\n       valid_lft forever preferred_lft forever\n\ndocker\u3067redis\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes $ docker run -t -i dockerfile/redis /usr/local/bin/redis-cli -h 10.1.42.1\n10.1.42.1:6379> keys *\n(empty list or set)\n10.1.42.1:6379> set foo bar\nOK\n10.1.42.1:6379> get foo\n\"bar\"\n10.1.42.1:6379> exit\n\npod\u3092\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes $ kubecfg delete /pods/redis\nI0721 03:23:40.857563 03173 request.go:220] Waiting for completion of /operations/3\nStatus\n----------\nsuccess\n\npod\u4e00\u89a7\u304b\u3089\u6d88\u3048\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\n\n\nkubernetes\u306e\u30bd\u30fc\u30b9\u306b\u542b\u307e\u308c\u308bguestbook\u306e\u4f8b\u306f\u9014\u4e2d\u304b\u3089\u3046\u307e\u304f\u3044\u304b\u305a\nGuestBook example\u306eREADME\u3092\u53c2\u8003\u306b\u8a66\u3057\u307e\u3057\u305f\u3002\ngit clone https://github.com/GoogleCloudPlatform/kubernetes\ncd kubernetes\n\n\n\u4e8b\u524d\u6e96\u5099\nGuestBook example\u306eStep Zero: Prerequisites\u306e\u3046\u3061\u3001hack/dev-build-and-up.sh \u306fGoogle Cloud Engine\u3067\u8a66\u3059\u3068\u304d\u306b\u5fc5\u8981\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u3088\u3046\u3067\u3059\u306e\u3067\u3053\u3053\u3067\u306f\u5b9f\u884c\u3057\u307e\u305b\u3093\u3002\nhack/build-go.sh \u306e\u307b\u3046\u306f\u5b9f\u884c\u304c\u5fc5\u8981\u305d\u3046\u306a\u306e\u3067\u8a66\u3057\u3066\u307f\u305f\u3089go\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3057\u305f\u3002\n\u305d\u306e\u5f8c\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u9032\u3081\u3066\u307f\u3066\u308f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001hack/build-go.sh \u3067\u30d3\u30eb\u30c9\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u4e0a\u8a18\u306e\u300cKubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u306e\u7bc0\u306b\u66f8\u3044\u305f http://storage.googleapis.com/kubernetes/binaries.tar.gz \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u3067\u3057\u305f\u3002\u30b3\u30de\u30f3\u30c9\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f\u9055\u3044\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u300cgo\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3068 hack/build-go.sh \u306e\u5b9f\u884c\u306f\u4e0d\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\ngo\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ncore@core-01 ~ $ uname -m\nx86_64\n\n\u3067\u78ba\u8a8d\u3059\u308b\u3068x86_64\u306a\u306e\u3067Downloads - The Go Programming Language\u304b\u3089go1.3.linux-amd64.tar.gz\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nGOPATH\u3092~/go\u306b\u3057\u305f\u3044\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f/usr/local/go\u306b\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c sudo mkdir /usr/local/go \u3068\u304b\u8a66\u3057\u3066\u3082Read-only file system\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067 /opt/go\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\ncd\nwget http://golang.org/dl/go1.3.linux-amd64.tar.gz\nsudo tar xf go1.3.linux-amd64.tar.gz -C /opt\n\n\u3042\u3068\u306fGOPATH\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\nmkdir ~/go\n\n~/.bash_profile\u306f\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\ncore@core-01 ~ $ ls -l ~/.bash_profile\nlrwxrwxrwx 1 core core 34 Jul 16 02:52 /home/core/.bash_profile -> ../../usr/share/skel/.bash_profile\n\n\u6d88\u3057\u3066\u30b3\u30d4\u30fc\u3057\u3066\ncore@core-01 ~ $ rm .bash_profile\ncore@core-01 ~ $ cp /usr/share/skel/.bash_profile .bash_profile\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\uff08\u305f\u3060\u3057\u3001CoreOS\u306e\u6d41\u5100\u306b\u5408\u3063\u3066\u3044\u308b\u304b\u306f\u4e0d\u660e\u3067\u3059\uff09\u3002\ncat <<'EOF' >> ~/.bash_profile\n\nexport GOROOT=/opt/go\nexport GOPATH=~/go\nexport PATH=$GOROOT/bin:$GOPATH/bin:$PATH\nEOF\n\nexec $SHELL -l\n\ncore@core-01 ~ $ which go\n/opt/go/bin/go\ncore@core-01 ~ $ go version\ngo version go1.3 linux/amd64\n\n\nhack/build-go.sh\u3092\u5b9f\u884c\ncore@core-01 ~ $ cd /opt/kubernetes/kubernetes\ncore@core-01 /opt/kubernetes/kubernetes $ hack/build-go.sh\n+++ Building proxy\n+++ Building integration\n+++ Building apiserver\n+++ Building controller-manager\n+++ Building kubelet\n+++ Building kubecfg\n\n\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u306fcmd\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308a\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ find cmd -type f -ls\n  8974    4 -rw-r--r--   1 core     core         3114 Jul 21 03:29 cmd/apiserver/apiserver.go\n  8976    4 -rw-r--r--   1 core     core         1905 Jul 21 03:29 cmd/controller-manager/controller-manager.go\n  8978   12 -rw-r--r--   1 core     core         9421 Jul 21 03:29 cmd/integration/integration.go\n  8980    8 -rw-r--r--   1 core     core         7687 Jul 21 03:29 cmd/kubecfg/kubecfg.go\n  8982    4 -rw-r--r--   1 core     core         3836 Jul 21 03:29 cmd/kubelet/kubelet.go\n  8984    4 -rw-r--r--   1 core     core         2187 Jul 21 03:29 cmd/proxy/proxy.go\n\n\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30a4\u30ca\u30ea\u306foutput/go\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ ls -l output/go\ntotal 50852\n-rwxr-xr-x 1 core core 10412840 Jul 21 14:23 apiserver\n-rwxr-xr-x 1 core core  7893672 Jul 21 14:23 controller-manager\n-rwxr-xr-x 1 core core  9233288 Jul 21 14:23 integration\n-rwxr-xr-x 1 core core  8522640 Jul 21 14:23 kubecfg\n-rwxr-xr-x 1 core core  8523160 Jul 21 14:23 kubelet\n-rwxr-xr-x 1 core core  7471752 Jul 21 14:23 proxy\ndrwxr-xr-x 1 core core       20 Jul 21 14:23 src\n\n/opt/bin\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d0\u30a4\u30ca\u30ea\u306f\u4ee5\u4e0b\u306e5\u3064\u3067\u3059\u3002\n\napiserver\ncontroll-manager\nkubecfg\nkubelet\nproxy\n\noutput/go\u306b\u306f\u3053\u308c\u306b\u52a0\u3048\u3066integration\u3068\u3044\u3046\u30d0\u30a4\u30ca\u30ea\u3082\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u30bd\u30fc\u30b9\u3092\u691c\u7d22\u3057\u3066\u307f\u308b\u3068\n\nhttps\n${KUBE_TARGET}/linux/amd64/integration\n\n\n\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u3066\u3001\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u3067\u3059\u3002\n\u30b5\u30fc\u30d3\u30b9\u3092\u6b62\u3081\u3066integration\u4ee5\u5916\u306e\u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092/opt/bin/\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop apiserver\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop controller-manager\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop kubelet\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop proxy\ncore@core-01 /opt/kubernetes/kubernetes $ sudo cp output/go/{apiserver,controller-manager,kubecfg,kubelet,proxy} /opt/bin\n\n\u305d\u306e\u5f8c\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start apiserver\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start controller-manager\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start kubelet\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start proxy\n\n\u3067\u3001\u7d9a\u304d\u3092\u5b9f\u884c\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u7d50\u5c40redis-slave\u306e\u8d77\u52d5\u304c\u7d42\u308f\u3089\u306a\u3044\u306e\u306f\u4e00\u7dd2\u3067\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-controller.json create /replicationControllers\nI0721 14:55:39.058324 01343 request.go:220] Waiting for completion of /operations/9\nI0721 14:55:59.062134 01343 request.go:220] Waiting for completion of /operations/9\n^C\n\n\nredis\u306e\u30de\u30b9\u30bf\u30fc\u3092\u8d77\u52d5\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-master.json\n{\n  \"id\": \"redis-master-2\",\n  \"desiredState\": {\n    \"manifest\": {\n      \"version\": \"v1beta1\",\n      \"id\": \"redis-master-2\",\n      \"containers\": [{\n        \"name\": \"master\",\n        \"image\": \"dockerfile/redis\",\n        \"ports\": [{\n          \"containerPort\": 6379,\n          \"hostPort\": 6379\n        }]\n      }]\n    }\n  },\n  \"labels\": {\n    \"name\": \"redis-master\"\n  }\n}\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-master.json create /pods\nI0721 03:47:11.215798 03349 request.go:220] Waiting for completion of /operations/8\nI0721 03:47:31.218575 03349 request.go:220] Waiting for completion of /operations/8\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis-master-2      dockerfile/redis    /                   name=redis-master\n\npod\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis-master-2      dockerfile/redis    127.0.0.1/          name=redis-master\n\ndocker\u306e\u72b6\u614b\u3092docker ps\u3067\u898b\u3066\u307f\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ docker ps\nCONTAINER ID        IMAGE                       COMMAND                CREATED              STATUS              PORTS                    NAMES\ne45fe7b25100        dockerfile/redis:latest     redis-server /etc/re   About a minute ago   Up About a minute                            k8s--master--redis_-_master_-_2--4befd1d1\n787bb5ddf655        busybox:buildroot-2014.02   sh -c 'rm -f nap &&    About a minute ago   Up About a minute   0.0.0.0:6379->6379/tcp   k8s--net--redis_-_master_-_2--f8803f12\n\nGuestBook example\u306eREADME\u3067\u306f redis-server /etc/re \u306e1\u884c\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f2\u884c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\nGuestBook example\u306eREADME\u3067\u306fGoogle Computing Engine\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306fCoreOS\u4e0a\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f55\u304b\u9055\u3044\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\nGuestBook example\u306eREADME\u306b\u3088\u308b\u3068\n\nA Kubernetes 'service' is a named load balancer that proxies traffic to one or more containers. The services in a Kubernetes cluster are discoverable inside other containers via environment variables. Services find the containers to load balance based on pod labels.\n\n\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-master-service.json\n{\n  \"id\": \"redismaster\",\n  \"port\": 10000,\n  \"selector\": {\n    \"name\": \"redis-master\"\n  }\n}\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-master-service.json create /services\nI0721 03:56:40.888615 03412 request.go:220] Waiting for completion of /operations/9\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\n\n\u30b5\u30fc\u30d3\u30b9\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3068\u540c\u3058\u5185\u5bb9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\n\n\n\u30b9\u30ec\u30fc\u30d6\u306epod\u3092\u8d77\u52d5\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave-controller.json\n  {\n    \"id\": \"redisSlaveController\",\n    \"desiredState\": {\n      \"replicas\": 2,\n      \"replicaSelector\": {\"name\": \"redisslave\"},\n      \"podTemplate\": {\n        \"desiredState\": {\n           \"manifest\": {\n             \"version\": \"v1beta1\",\n             \"id\": \"redisSlaveController\",\n             \"containers\": [{\n               \"image\": \"brendanburns/redis-slave\",\n               \"ports\": [{\"containerPort\": 6379, \"hostPort\": 6380}]\n             }]\n           }\n         },\n         \"labels\": {\"name\": \"redisslave\"}\n        }},\n    \"labels\": {\"name\": \"redisslave\"}\n  }\n\n\u8d77\u52d5\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001 Waiting for completion \u3068\u3044\u3046\u306e\u304c\u7e70\u308a\u8fd4\u3057\u8868\u793a\u3055\u308c\u3066\u3044\u3064\u307e\u3067\u3082\u7d42\u308f\u3089\u306a\u3044\u306e\u3067\u3001Ctrl\uff70C\u3067\u6b62\u3081\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-controller.json create /replicationControllers\nI0721 04:24:00.818199 03499 request.go:220] Waiting for completion of /operations/67\nI0721 04:24:20.823015 03499 request.go:220] Waiting for completion of /operations/67\nI0721 04:24:40.826668 03499 request.go:220] Waiting for completion of /operations/67\n\u2026(\u7565)\u2026\n^C\n\nredis-slave\u306eDockerfile\u304c\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u3082\u542b\u307e\u308c\u3066\u3044\u305f\u306e\u3067\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave/Dockerfile\nFROM dockerfile/redis\n\nADD run.sh /run.sh\n\nRUN chmod a+x /run.sh\n\nCMD /run.sh\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave/run.sh\n#!/bin/bash\n\nredis-server --slaveof $SERVICE_HOST $REDISMASTER_SERVICE_PORT\n\n\u5358\u306bredis-server\u3092\u8d77\u52d5\u3059\u308b\u3060\u3051\u306a\u306e\u306b\u3001\u3053\u3093\u306a\u306b\u304b\u304b\u308b\u308f\u3051\u304c\u306a\u3044\u306e\u3067\u4f55\u304b\u304a\u304b\u3057\u3044\u3088\u3046\u3067\u3059\u3002\n/replicationControllers \u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3068\u4f5c\u6210\u81ea\u4f53\u306f\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes/examples/guestbook $ kubecfg list /replicationControllers\nName                   Image(s)                   Selector            Replicas\n----------             ----------                 ----------          ----------\nredisSlaveController   brendanburns/redis-slave   name=redisslave     2\n\n/pods\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002Step Three: Turn up the replicated slave pods.\u3060\u3068brendanburns/redis-slave\u306epod\u304c2\u3064\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u624b\u5143\u306e\u74b0\u5883\u3067\u306f1\u3064\u3060\u3051\u3067\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n\n\u4f55\u304c\u8d77\u304d\u3066\u3044\u308b\u306e\u304b\u3068\u305d\u306e\u539f\u56e0\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u5148\u306b\u52e7\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\nredis\u30b9\u30ec\u30fc\u30d6\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave-service.json\n{\n  \"id\": \"redisslave\",\n  \"port\": 10001,\n  \"labels\": {\n    \"name\": \"redisslave\"\n  },\n  \"selector\": {\n    \"name\": \"redisslave\"\n  }\n}\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-service.json create /services\nI0721 04:44:42.565445 03593 request.go:220] Waiting for completion of /operations/128\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredisslave          name=redisslave     name=redisslave     10001\n\n\u3053\u308c\u306f\u554f\u984c\u306a\u304f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n/services\u3068/pods\u306e\u4e00\u89a7\u3092\u898b\u3066\u307f\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\nredisslave          name=redisslave     name=redisslave     10001\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n\n\n\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306epod\u4f5c\u6210\nkubernetes/examples/guestbook/README.md at master \u00b7 GoogleCloudPlatform/kubernetes\u3092\u53c2\u8003\u306b\u9032\u3081\u307e\u3059\u3002\n\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/frontend-controller.json\n  {\n    \"id\": \"frontendController\",\n    \"desiredState\": {\n      \"replicas\": 3,\n      \"replicaSelector\": {\"name\": \"frontend\"},\n      \"podTemplate\": {\n        \"desiredState\": {\n           \"manifest\": {\n             \"version\": \"v1beta1\",\n             \"id\": \"frontendController\",\n             \"containers\": [{\n               \"image\": \"brendanburns/php-redis\",\n               \"ports\": [{\"containerPort\": 80, \"hostPort\": 8000}]\n             }]\n           }\n         },\n         \"labels\": {\"name\": \"frontend\"}\n        }},\n    \"labels\": {\"name\": \"frontend\"}\n  }\n\nbrendanburns/php-redis\u306eDockerfile\u3068\u601d\u308f\u308c\u308b\u3082\u306e\u304cexamples/guestbook/php-redis/\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/Dockerfile\nFROM brendanburns/php\n\nADD index.php /var/www/index.php\nADD controllers.js /var/www/controllers.js\nADD index.html /var/www/index.html\n\nCMD /run.sh\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/index.php\n<?\n\nset_include_path('.:/usr/share/php:/usr/share/pear:/vendor/predis');\n\nerror_reporting(E_ALL);\nini_set('display_errors', 1);\n\nrequire 'predis/autoload.php';\n\nif (isset($_GET['cmd']) === true) {\n  header('Content-Type: application/json');\n  if ($_GET['cmd'] == 'set') {\n    $client = new Predis\\Client([\n      'scheme' => 'tcp',\n      'host'   => getenv('SERVICE_HOST'),\n      'port'   => getenv('REDISMASTER_SERVICE_PORT'),\n    ]);\n    $client->set($_GET['key'], $_GET['value']);\n    print('{\"message\": \"Updated\"}');\n  } else {\n    $read_port = getenv('REDISMASTER_SERVICE_PORT');\n\n    if (isset($_ENV['REDISSLAVE_SERVICE_PORT'])) {\n      $read_port = getenv('REDISSLAVE_SERVICE_PORT');\n    }\n    $client = new Predis\\Client([\n      'scheme' => 'tcp',\n      'host'   => getenv('SERVICE_HOST'),\n      'port'   => $read_port,\n    ]);\n\n    $value = $client->get($_GET['key']);\n    print('{\"data\": \"' . $value . '\"}');\n  }\n} else {\n  phpinfo();\n} ?>\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/index.html\n<html ng-app=\"redis\">\n  <head>\n    <title>Guestbook</title>\n    <link rel=\"stylesheet\" href=\"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js\"></script>\n    <script src=\"/controllers.js\"></script>\n    <script src=\"ui-bootstrap-tpls-0.10.0.min.js\"></script>\n  </head>\n  <body ng-controller=\"RedisCtrl\">\n    <div style=\"width: 50%; margin-left: 20px\">\n      <h2>Guestbook</h2>\n    <form>\n    <fieldset>\n    <input ng-model=\"msg\" placeholder=\"Messages\" class=\"form-control\" type=\"text\" name=\"input\"><br>\n    <button type=\"button\" class=\"btn btn-primary\" ng-click=\"controller.onRedis()\">Submit</button>\n    </fieldset>\n    </form>\n    <div>\n      <div ng-repeat=\"msg in messages\">\n        {{msg}}\n      </div>\n    </div>\n    </div>\n  </body>\n</html>\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/controllers.js\nvar redisApp = angular.module('redis', ['ui.bootstrap']);\n\n/**\n * Constructor\n */\nfunction RedisController() {}\n\nRedisController.prototype.onRedis = function() {\n    this.scope_.messages.push(this.scope_.msg);\n    this.scope_.msg = \"\";\n    var value = this.scope_.messages.join();\n    this.http_.get(\"/index.php?cmd=set&key=messages&value=\" + value)\n            .success(angular.bind(this, function(data) {\n                this.scope_.redisResponse = \"Updated.\";\n            }));\n};\n\nredisApp.controller('RedisCtrl', function ($scope, $http, $location) {\n        $scope.controller = new RedisController();\n        $scope.controller.scope_ = $scope;\n        $scope.controller.location_ = $location;\n        $scope.controller.http_ = $http;\n\n        $scope.controller.http_.get(\"/index.php?cmd=get&key=messages\")\n            .success(function(data) {\n                console.log(data);\n                $scope.messages = data.data.split(\",\");\n            });\n});\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/frontend-controller.json create /replicationControllers\nI0721 04:47:55.237466 03614 request.go:220] Waiting for completion of /operations/138\nI0721 04:48:15.242877 03614 request.go:220] Waiting for completion of /operations/138\nI0721 04:48:35.246837 03614 request.go:220] Waiting for completion of /operations/138\n\u2026(\u7565)\u2026\n^C\n\n\u306a\u304b\u306a\u304b\u5e30\u3063\u3066\u3053\u306a\u3044\u306e\u3067\u3001Ctrl-C\u3067\u6b62\u3081\u3066\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n45ff7456-1092-11e4-b2af-0800273da0c1   brendanburns/php-redis     127.0.0.1/          name=frontend,replicationController=frontendController\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /replicationControllers\nName                   Image(s)                   Selector            Replicas\n----------             ----------                 ----------          ----------\nredisSlaveController   brendanburns/redis-slave   name=redisslave     2\nfrontendController     brendanburns/php-redis     name=frontend       3\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\nredisslave          name=redisslave     name=redisslave     10001\n\ncurl\u3067http://localhost:8000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3068guestbook\u306e\u30da\u30fc\u30b8\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ curl http://localhost:8000\n<html ng-app=\"redis\">\n  <head>\n    <title>Guestbook</title>\n    <link rel=\"stylesheet\" href=\"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js\"></script>\n    <script src=\"/controllers.js\"></script>\n    <script src=\"ui-bootstrap-tpls-0.10.0.min.js\"></script>\n  </head>\n  <body ng-controller=\"RedisCtrl\">\n    <div style=\"width: 50%; margin-left: 20px\">\n      <h2>Guestbook</h2>\n    <form>\n    <fieldset>\n    <input ng-model=\"msg\" placeholder=\"Messages\" class=\"form-control\" type=\"text\" name=\"input\"><br>\n    <button type=\"button\" class=\"btn btn-primary\" ng-click=\"controller.onRedis()\">Submit</button>\n    </fieldset>\n    </form>\n    <div>\n      <div ng-repeat=\"msg in messages\">\n        {{msg}}\n      </div>\n    </div>\n    </div>\n  </body>\n</html>\n\nOSX\u3067Chrome\u3067 http://172.17.8.101:8000/ \u3092\u958b\u3044\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u306f\u3067\u304d\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u3067\u3059\u304c\u3001\u4f55\u304b\u5165\u529b\u3057\u3066Submit\u3092\u62bc\u3057\u3066\u3082\u4f55\u3082\u8d77\u304d\u307e\u305b\u3093\u3002\nhttp://172.17.8.101:8000/ \u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066Chrome\u306edevtool\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u898b\u3066\u307f\u308b\u3068JavaScript\u306e\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u3066\u3044\u307e\u3057\u305f\u3002\n\nbr />\n<b>Fatal error</b>:  Uncaught exception 'Predis\\Connection\\ConnectionException' with message 'Connection refused [tcp://127.0.0.1:10000]' in /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php:141\nStack trace:\n#0 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(96): Predis\\Connection\\AbstractConnection-&gt;onConnectionError('Connection refu...', 111)\n#1 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(70): Predis\\Connection\\StreamConnection-&gt;tcpStreamInitializer(Object(Predis\\Connection\\ConnectionParameters))\n#2 /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php(96): Predis\\Connection\\StreamConnection-&gt;createResource()\n#3 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(144): Predis\\Connection\\AbstractConnection-&gt;connect()\n#4 /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php(181): Predis\\Connection\\StreamConnection-&gt;connect()\n#5 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(183): Predis\\Connection\\AbstractConnection-&gt;ge in <b>/vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php</b> on line <b>141</b><br />\n controllers.js:26\n\n\nTypeError: Cannot read property 'split' of undefined\n    at http://172.17.8.101:8000/controllers.js:27:37\n    at https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:66:373\n    at A (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:93:5)\n    at A (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:93:5)\n    at https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:94:173\n    at h.$eval (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:102:456)\n    at h.$digest (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:100:218)\n    at h.$apply (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:103:264)\n    at f (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:67:120)\n    at H (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:71:191) angular.js:9435\n\npredis\u304c tcp://127.0.0.1:10000 \u306b\u7e4b\u304e\u306b\u884c\u3053\u3046\u3068\u3057\u3066\u5931\u6557\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u306a\u305c\u30dd\u30fc\u30c810000\u306a\u306e\u304b\u304c\u8b0e\u3067\u3059\u3002\u4e0a\u8a18\u306eindex.php\u3092\u898b\u308b\u3068REDISSLAVE_SERVICE_PORT\u74b0\u5883\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u306e\u5024\u3067\u3001\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070REDISMASTER_SERVICE_PORT\u74b0\u5883\u5909\u6570\u306e\u5024\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u6642\u70b9\u3067docker ps\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\ncore@core-01 /opt/kubernetes/kubernetes $ docker ps --no-trunc\nCONTAINER ID                                                       IMAGE                             COMMAND                                           CREATED             STATUS              PORTS                    NAMES\n150252488eb48d673ea27cc624f67d19894b0e6f7131b000d7f257b0fddff450   brendanburns/php-redis:latest     /bin/sh -c /run.sh                                46 minutes ago      Up 46 minutes                                k8s----45ff7456_-_1092_-_11e4_-_b2af_-_0800273da0c1--8fafe560\nd0c0d44598a1fc7e18bf3e37d4332dad2af23a61644092d3f7fb24344d6e0a1d   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   50 minutes ago      Up 50 minutes       0.0.0.0:8000->80/tcp     k8s--net--45ff7456_-_1092_-_11e4_-_b2af_-_0800273da0c1--94270597\n0f4f8e809955377da2c176e0114795fa23d38f7d18e6237e27332a8a861ec101   brendanburns/redis-slave:latest   /bin/sh -c /run.sh                                About an hour ago   Up About an hour                             k8s----169d845e_-_108c_-_11e4_-_b2af_-_0800273da0c1--c8c817c2\n56c29b155bab49ac10f76e963c7c431555accb4881a9d9dcf12952ed85265738   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   About an hour ago   Up About an hour    0.0.0.0:6380->6379/tcp   k8s--net--169d845e_-_108c_-_11e4_-_b2af_-_0800273da0c1--196db470\ne45fe7b2510009127e2700cb628a2ac2fc3cfafff2278040d2d0d26fc21a6935   dockerfile/redis:latest           redis-server /etc/redis/redis.conf                About an hour ago   Up About an hour                             k8s--master--redis_-_master_-_2--4befd1d1\n787bb5ddf655ef576b1425f64772291296ce5cc983836153787a56587ad41c85   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   About an hour ago   Up About an hour    0.0.0.0:6379->6379/tcp   k8s--net--redis_-_master_-_2--f8803f12\n\nredis\u306e\u30b9\u30ec\u30fc\u30d6\u306f6380\u3001\u30de\u30b9\u30bf\u30fc\u306f6379\u306a\u306e\u3067\u300110000\u306b\u306a\u308b\u306e\u306f\u4f55\u304b\u5909\u3067\u3059\u3002\u3072\u3087\u3063\u3068\u3059\u308b\u3068\u3001Docker Hub\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308bbrendanburns/php-redis\u30a4\u30e1\u30fc\u30b8\u306eDockerfile\u3084index.php\u306f\u4e0a\u8a18\u3067\u78ba\u8a8d\u3057\u305f\u306e\u3068\u306f\u9055\u3046\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u75b2\u308c\u3066\u304d\u305f\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f\u3053\u306e\u8fba\u3067\u3002\u6c17\u304c\u5411\u3044\u305f\u3089\u3001Docker Hub\u304b\u3089\u843d\u3068\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u30ed\u30fc\u30ab\u30eb\u3067docker build\u3057\u3066\u518d\u5ea6\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\nOSX + Vagrant + CoreOS\u3067Kubernetes\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u30e1\u30e2\u3067\u3059\u3002\u8a66\u3057\u305f\u624b\u9806\u3092\u591a\u5c11\u6574\u7406\u3057\u3066\u66f8\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# \u53c2\u8003\n\n* [GoogleCloudPlatform/kubernetes]( https://github.com/GoogleCloudPlatform/kubernetes#running-on-coreos )\n* [Running Kubernetes Example on CoreOS, Part 1]( http://coreos.com/blog/running-kubernetes-example-on-CoreOS-part-1/ )\n* [Running CoreOS on Vagrant]( http://coreos.com/docs/running-coreos/platforms/vagrant/ )\n* [kelseyhightower/kubernetes-coreos]( https://github.com/kelseyhightower/kubernetes-coreos#quick-start )\n\n# \u624b\u9806\n\n## CoreOS\u3092Vagrant\u3067\u8d77\u52d5\u3057\u3066ssh\u30ed\u30b0\u30a4\u30f3\n[Running CoreOS on Vagrant]( http://coreos.com/docs/running-coreos/platforms/vagrant/ )\u3092\u53c2\u8003\u306bVagrantfile\u3092\u53d6\u5f97\u3057\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002[Running Kubernetes Example on CoreOS, Part 1]( http://coreos.com/blog/running-kubernetes-example-on-CoreOS-part-1/ )\u306b\n> a single node cluster will work for this tutorial.\n\n\u3068\u3042\u308b\u306e\u3067\u3001config.rb\u5185\u306e ```$num_instances``` \u306f1\u306e\u307e\u307e\u3067\u826f\u3044\u3067\u3059\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5168\u3066\u30b3\u30e1\u30f3\u30c8\u884c\u306b\u306a\u3063\u3066\u3044\u308bconfig.rb.sample\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n```shell-session\ngit clone https://github.com/coreos/coreos-vagrant.git\ncd coreos-vagrant\ncp config.rb.sample\nvagrant up\n```\n\n\u8d77\u52d5\u3057\u305f\u3089ssh\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n```shell-session\nvagrant ssh\n```\n\n## CoreOS\u4e0a\u3067Kubernetes\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30fb\u8d77\u52d5\n\n[Running Kubernetes Example on CoreOS, Part 1]( http://coreos.com/blog/running-kubernetes-example-on-CoreOS-part-1/ )\u306e\u8a18\u8ff0\u306f\u53e4\u3044\u306e\u3067\u3001[kelseyhightower/kubernetes-coreos]( https://github.com/kelseyhightower/kubernetes-coreos#quick-start )\u306e\u624b\u9806\u306b\u6cbf\u3063\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n### Kubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\n\n\u3053\u3053\u306f[Running Kubernetes Example on CoreOS, Part 1]( http://coreos.com/blog/running-kubernetes-example-on-CoreOS-part-1/ )\u3068[kelseyhightower/kubernetes-coreos]( https://github.com/kelseyhightower/kubernetes-coreos#quick-start )\u3092\u53c2\u8003\u306b\u3057\u305f\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```shell-session\nsudo mkdir -p /opt/kubernetes \nsudo chown -R core: /opt/kubernetes\ncd /opt/kubernetes\n```\n\n### Kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell-session\nsudo mkdir -p /opt/bin\nsudo wget http://storage.googleapis.com/kubernetes/binaries.tar.gz\nsudo tar -xvf binaries.tar.gz -C /opt/bin\n```\n\nkubecfg\u306bPATH\u304c\u901a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ which kubecfg\n/opt/bin/kubecfg\n```\n\n### Kubernetes\u306esystemd\u30e6\u30cb\u30c3\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n\n```shell-session\ngit clone https://github.com/kelseyhightower/kubernetes-coreos.git\nsudo cp kubernetes-coreos/units/* /etc/systemd/system/\n```\n\n### Kubernetes\u306e\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n\n```shell-session\nsudo systemctl start apiserver\nsudo systemctl start controller-manager\nsudo systemctl start kubelet\nsudo systemctl start proxy\n```\n\n### pod\u306e\u4e00\u89a7\u8868\u793a\n\n\u307e\u3060\u4f55\u3082\u4f5c\u6210\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u7a7a\u3067\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\n```\n\n## redis\u306e\u4f8b\u306f\u3046\u307e\u304f\u52d5\u304d\u307e\u3057\u305f\n\n[Running Kubernetes Example on CoreOS, Part 1\u306eCreating a Kubernetes pod\u306e\u7bc0]( http://coreos.com/blog/running-kubernetes-example-on-CoreOS-part-1/#toc_0 )\u306e\u4f8b\u3092\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4e0a\u8a18\u306e\u8a18\u4e8b\u3067\u306f ```/opt/kubernetes/bin/kubecfg``` \u3068\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u306e\u8a18\u4e8b\u3067\u306f ```/opt/bin/kubecfg``` \u3067PATH\u304c\u901a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4ee5\u4e0b\u3067\u306f\u5358\u306b ```kubecfg``` \u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\u307e\u305f ```-h http://127.0.0.1:8080``` \u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u7121\u304f\u3066\u3082\u52d5\u3044\u305f\u306e\u3067\u7701\u7565\u3057\u3066\u3044\u307e\u3059\u3002\n\nCoreOS\u5185\u306e/opt/kubernetes\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\nmkdir kubernetes-coreos/pods\n\ncat <<EOF > kubernetes-coreos/pods/redis.json\n{\n  \"id\": \"redis\",\n  \"desiredState\": {\n    \"manifest\": {\n      \"version\": \"v1beta1\",\n      \"id\": \"redis\",\n      \"containers\": [{\n        \"name\": \"redis\",\n        \"image\": \"dockerfile/redis\",\n        \"ports\": [{\n          \"containerPort\": 6379,\n          \"hostPort\": 6379\n        }]\n      }]\n    }\n  },\n  \"labels\": {\n    \"name\": \"redis\"\n  }\n}\nEOF\n\nkubecfg -c kubernetes-coreos/pods/redis.json create /pods\n```\n\n\u3057\u3070\u3089\u304f\uff0810\u5206\u3050\u3089\u3044\uff1f\uff09\u653e\u7f6e\u3057\u3066\u305f\u3089\u7121\u4e8b\u7d42\u4e86\u3057\u3066\u3044\u307e\u3057\u305f\u3002pod\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis               dockerfile/redis    127.0.0.1/          name=redis\n```\n\ndocker0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ ip a show docker0\n4: docker0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP\n    link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff\n    inet 10.1.42.1/16 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::5484:7aff:fefe:9799/64 scope link\n       valid_lft forever preferred_lft forever\n```\n\ndocker\u3067redis\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ docker run -t -i dockerfile/redis /usr/local/bin/redis-cli -h 10.1.42.1\n10.1.42.1:6379> keys *\n(empty list or set)\n10.1.42.1:6379> set foo bar\nOK\n10.1.42.1:6379> get foo\n\"bar\"\n10.1.42.1:6379> exit\n```\n\npod\u3092\u524a\u9664\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ kubecfg delete /pods/redis\nI0721 03:23:40.857563 03173 request.go:220] Waiting for completion of /operations/3\nStatus\n----------\nsuccess\n```\n\npod\u4e00\u89a7\u304b\u3089\u6d88\u3048\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\n```\n\n## kubernetes\u306e\u30bd\u30fc\u30b9\u306b\u542b\u307e\u308c\u308bguestbook\u306e\u4f8b\u306f\u9014\u4e2d\u304b\u3089\u3046\u307e\u304f\u3044\u304b\u305a\n\n[GuestBook example\u306eREADME]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md )\u3092\u53c2\u8003\u306b\u8a66\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\ngit clone https://github.com/GoogleCloudPlatform/kubernetes\ncd kubernetes\n```\n\n### \u4e8b\u524d\u6e96\u5099\n\n[GuestBook example]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md )\u306e[Step Zero: Prerequisites]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md#step-zero-prerequisites )\u306e\u3046\u3061\u3001```hack/dev-build-and-up.sh``` \u306fGoogle Cloud Engine\u3067\u8a66\u3059\u3068\u304d\u306b\u5fc5\u8981\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u3088\u3046\u3067\u3059\u306e\u3067\u3053\u3053\u3067\u306f\u5b9f\u884c\u3057\u307e\u305b\u3093\u3002\n\n```hack/build-go.sh``` \u306e\u307b\u3046\u306f\u5b9f\u884c\u304c\u5fc5\u8981\u305d\u3046\u306a\u306e\u3067\u8a66\u3057\u3066\u307f\u305f\u3089go\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3057\u305f\u3002\n\n\u305d\u306e\u5f8c\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u9032\u3081\u3066\u307f\u3066\u308f\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001```hack/build-go.sh``` \u3067\u30d3\u30eb\u30c9\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u306e\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u4e0a\u8a18\u306e\u300cKubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u306e\u7bc0\u306b\u66f8\u3044\u305f http://storage.googleapis.com/kubernetes/binaries.tar.gz \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u3067\u3057\u305f\u3002\u30b3\u30de\u30f3\u30c9\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u306f\u9055\u3044\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u300cgo\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u300d\u3068 ```hack/build-go.sh``` \u306e\u5b9f\u884c\u306f\u4e0d\u8981\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n#### go\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell-session\ncore@core-01 ~ $ uname -m\nx86_64\n```\n\n\u3067\u78ba\u8a8d\u3059\u308b\u3068x86_64\u306a\u306e\u3067[Downloads - The Go Programming Language]( http://golang.org/dl/ )\u304b\u3089go1.3.linux-amd64.tar.gz\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nGOPATH\u3092~/go\u306b\u3057\u305f\u3044\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f/usr/local/go\u306b\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c ```sudo mkdir /usr/local/go``` \u3068\u304b\u8a66\u3057\u3066\u3082Read-only file system\u3068\u3044\u3046\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067 /opt/go\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\ncd\nwget http://golang.org/dl/go1.3.linux-amd64.tar.gz\nsudo tar xf go1.3.linux-amd64.tar.gz -C /opt\n```\n\n\u3042\u3068\u306fGOPATH\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\nmkdir ~/go\n```\n\n~/.bash_profile\u306f\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\n\n```shell-session\ncore@core-01 ~ $ ls -l ~/.bash_profile\nlrwxrwxrwx 1 core core 34 Jul 16 02:52 /home/core/.bash_profile -> ../../usr/share/skel/.bash_profile\n```\n\n\u6d88\u3057\u3066\u30b3\u30d4\u30fc\u3057\u3066\n\n```shell-session\ncore@core-01 ~ $ rm .bash_profile\ncore@core-01 ~ $ cp /usr/share/skel/.bash_profile .bash_profile\n```\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\uff08\u305f\u3060\u3057\u3001CoreOS\u306e\u6d41\u5100\u306b\u5408\u3063\u3066\u3044\u308b\u304b\u306f\u4e0d\u660e\u3067\u3059\uff09\u3002\n\n```shell-session\ncat <<'EOF' >> ~/.bash_profile\n\nexport GOROOT=/opt/go\nexport GOPATH=~/go\nexport PATH=$GOROOT/bin:$GOPATH/bin:$PATH\nEOF\n```\n\n```shell-session\nexec $SHELL -l\n```\n\n```shell-session\ncore@core-01 ~ $ which go\n/opt/go/bin/go\ncore@core-01 ~ $ go version\ngo version go1.3 linux/amd64\n```\n\n#### hack/build-go.sh\u3092\u5b9f\u884c\n\n```shell-session\ncore@core-01 ~ $ cd /opt/kubernetes/kubernetes\ncore@core-01 /opt/kubernetes/kubernetes $ hack/build-go.sh\n+++ Building proxy\n+++ Building integration\n+++ Building apiserver\n+++ Building controller-manager\n+++ Building kubelet\n+++ Building kubecfg\n```\n\n\u30d3\u30eb\u30c9\u5bfe\u8c61\u306e\u30bd\u30fc\u30b9\u306fcmd\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308a\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ find cmd -type f -ls\n  8974    4 -rw-r--r--   1 core     core         3114 Jul 21 03:29 cmd/apiserver/apiserver.go\n  8976    4 -rw-r--r--   1 core     core         1905 Jul 21 03:29 cmd/controller-manager/controller-manager.go\n  8978   12 -rw-r--r--   1 core     core         9421 Jul 21 03:29 cmd/integration/integration.go\n  8980    8 -rw-r--r--   1 core     core         7687 Jul 21 03:29 cmd/kubecfg/kubecfg.go\n  8982    4 -rw-r--r--   1 core     core         3836 Jul 21 03:29 cmd/kubelet/kubelet.go\n  8984    4 -rw-r--r--   1 core     core         2187 Jul 21 03:29 cmd/proxy/proxy.go\n```\n\n\u30d3\u30eb\u30c9\u3055\u308c\u305f\u30d0\u30a4\u30ca\u30ea\u306foutput/go\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f5c\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ ls -l output/go\ntotal 50852\n-rwxr-xr-x 1 core core 10412840 Jul 21 14:23 apiserver\n-rwxr-xr-x 1 core core  7893672 Jul 21 14:23 controller-manager\n-rwxr-xr-x 1 core core  9233288 Jul 21 14:23 integration\n-rwxr-xr-x 1 core core  8522640 Jul 21 14:23 kubecfg\n-rwxr-xr-x 1 core core  8523160 Jul 21 14:23 kubelet\n-rwxr-xr-x 1 core core  7471752 Jul 21 14:23 proxy\ndrwxr-xr-x 1 core core       20 Jul 21 14:23 src\n```\n\n/opt/bin\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30d0\u30a4\u30ca\u30ea\u306f\u4ee5\u4e0b\u306e5\u3064\u3067\u3059\u3002\n\n* apiserver\n* controll-manager\n* kubecfg\n* kubelet\n* proxy\n\noutput/go\u306b\u306f\u3053\u308c\u306b\u52a0\u3048\u3066```integration```\u3068\u3044\u3046\u30d0\u30a4\u30ca\u30ea\u3082\u4f5c\u3089\u308c\u3066\u3044\u307e\u3059\u3002\u30bd\u30fc\u30b9\u3092\u691c\u7d22\u3057\u3066\u307f\u308b\u3068\n\n```sh:https://github.com/GoogleCloudPlatform/kubernetes/blob/7910ae8159454fbaf353346919f1f8485316c871/build/build-image/run-integration.sh#L31\n${KUBE_TARGET}/linux/amd64/integration\n```\n\n\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u3066\u3044\u3066\u3001\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u306b\u4f7f\u3046\u30b3\u30de\u30f3\u30c9\u306e\u3088\u3046\u3067\u3059\u3002\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u6b62\u3081\u3066integration\u4ee5\u5916\u306e\u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092/opt/bin/\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop apiserver\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop controller-manager\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop kubelet\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl stop proxy\ncore@core-01 /opt/kubernetes/kubernetes $ sudo cp output/go/{apiserver,controller-manager,kubecfg,kubelet,proxy} /opt/bin\n```\n\n\u305d\u306e\u5f8c\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start apiserver\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start controller-manager\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start kubelet\ncore@core-01 /opt/kubernetes/kubernetes $ sudo systemctl start proxy\n```\n\n\u3067\u3001\u7d9a\u304d\u3092\u5b9f\u884c\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001\u7d50\u5c40redis-slave\u306e\u8d77\u52d5\u304c\u7d42\u308f\u3089\u306a\u3044\u306e\u306f\u4e00\u7dd2\u3067\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-controller.json create /replicationControllers\nI0721 14:55:39.058324 01343 request.go:220] Waiting for completion of /operations/9\nI0721 14:55:59.062134 01343 request.go:220] Waiting for completion of /operations/9\n^C\n```\n\n### redis\u306e\u30de\u30b9\u30bf\u30fc\u3092\u8d77\u52d5\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-master.json\n{\n  \"id\": \"redis-master-2\",\n  \"desiredState\": {\n    \"manifest\": {\n      \"version\": \"v1beta1\",\n      \"id\": \"redis-master-2\",\n      \"containers\": [{\n        \"name\": \"master\",\n        \"image\": \"dockerfile/redis\",\n        \"ports\": [{\n          \"containerPort\": 6379,\n          \"hostPort\": 6379\n        }]\n      }]\n    }\n  },\n  \"labels\": {\n    \"name\": \"redis-master\"\n  }\n}\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-master.json create /pods\nI0721 03:47:11.215798 03349 request.go:220] Waiting for completion of /operations/8\nI0721 03:47:31.218575 03349 request.go:220] Waiting for completion of /operations/8\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis-master-2      dockerfile/redis    /                   name=redis-master\n```\n\npod\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                Image(s)            Host                Labels\n----------          ----------          ----------          ----------\nredis-master-2      dockerfile/redis    127.0.0.1/          name=redis-master\n```\n\ndocker\u306e\u72b6\u614b\u3092docker ps\u3067\u898b\u3066\u307f\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ docker ps\nCONTAINER ID        IMAGE                       COMMAND                CREATED              STATUS              PORTS                    NAMES\ne45fe7b25100        dockerfile/redis:latest     redis-server /etc/re   About a minute ago   Up About a minute                            k8s--master--redis_-_master_-_2--4befd1d1\n787bb5ddf655        busybox:buildroot-2014.02   sh -c 'rm -f nap &&    About a minute ago   Up About a minute   0.0.0.0:6379->6379/tcp   k8s--net--redis_-_master_-_2--f8803f12\n```\n\n[GuestBook example\u306eREADME]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md )\u3067\u306f ```redis-server /etc/re``` \u306e1\u884c\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306f2\u884c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n[GuestBook example\u306eREADME]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md )\u3067\u306fGoogle Computing Engine\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306fCoreOS\u4e0a\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f55\u304b\u9055\u3044\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n### \u30de\u30b9\u30bf\u30fc\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\n\n[GuestBook example\u306eREADME]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md )\u306b\u3088\u308b\u3068\n\n> A Kubernetes 'service' is a named load balancer that proxies traffic to one or more containers. The services in a Kubernetes cluster are discoverable inside other containers via environment variables. Services find the containers to load balance based on pod labels.\n\n\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-master-service.json\n{\n  \"id\": \"redismaster\",\n  \"port\": 10000,\n  \"selector\": {\n    \"name\": \"redis-master\"\n  }\n}\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-master-service.json create /services\nI0721 03:56:40.888615 03412 request.go:220] Waiting for completion of /operations/9\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\n```\n\n\u30b5\u30fc\u30d3\u30b9\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b\u3068\u540c\u3058\u5185\u5bb9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\n```\n\n### \u30b9\u30ec\u30fc\u30d6\u306epod\u3092\u8d77\u52d5\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave-controller.json\n  {\n    \"id\": \"redisSlaveController\",\n    \"desiredState\": {\n      \"replicas\": 2,\n      \"replicaSelector\": {\"name\": \"redisslave\"},\n      \"podTemplate\": {\n        \"desiredState\": {\n           \"manifest\": {\n             \"version\": \"v1beta1\",\n             \"id\": \"redisSlaveController\",\n             \"containers\": [{\n               \"image\": \"brendanburns/redis-slave\",\n               \"ports\": [{\"containerPort\": 6379, \"hostPort\": 6380}]\n             }]\n           }\n         },\n         \"labels\": {\"name\": \"redisslave\"}\n        }},\n    \"labels\": {\"name\": \"redisslave\"}\n  }\n```\n\n\u8d77\u52d5\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\u3001 ```Waiting for completion``` \u3068\u3044\u3046\u306e\u304c\u7e70\u308a\u8fd4\u3057\u8868\u793a\u3055\u308c\u3066\u3044\u3064\u307e\u3067\u3082\u7d42\u308f\u3089\u306a\u3044\u306e\u3067\u3001Ctrl\uff70C\u3067\u6b62\u3081\u307e\u3057\u305f\u3002\n\n```\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-controller.json create /replicationControllers\nI0721 04:24:00.818199 03499 request.go:220] Waiting for completion of /operations/67\nI0721 04:24:20.823015 03499 request.go:220] Waiting for completion of /operations/67\nI0721 04:24:40.826668 03499 request.go:220] Waiting for completion of /operations/67\n\u2026(\u7565)\u2026\n^C\n```\n\nredis-slave\u306eDockerfile\u304c\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u3082\u542b\u307e\u308c\u3066\u3044\u305f\u306e\u3067\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave/Dockerfile\nFROM dockerfile/redis\n\nADD run.sh /run.sh\n\nRUN chmod a+x /run.sh\n\nCMD /run.sh\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave/run.sh\n#!/bin/bash\n\nredis-server --slaveof $SERVICE_HOST $REDISMASTER_SERVICE_PORT\n```\n\n\u5358\u306bredis-server\u3092\u8d77\u52d5\u3059\u308b\u3060\u3051\u306a\u306e\u306b\u3001\u3053\u3093\u306a\u306b\u304b\u304b\u308b\u308f\u3051\u304c\u306a\u3044\u306e\u3067\u4f55\u304b\u304a\u304b\u3057\u3044\u3088\u3046\u3067\u3059\u3002\n\n```/replicationControllers``` \u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3068\u4f5c\u6210\u81ea\u4f53\u306f\u3067\u304d\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes/examples/guestbook $ kubecfg list /replicationControllers\nName                   Image(s)                   Selector            Replicas\n----------             ----------                 ----------          ----------\nredisSlaveController   brendanburns/redis-slave   name=redisslave     2\n```\n\n/pods\u306e\u4e00\u89a7\u3092\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002[Step Three: Turn up the replicated slave pods.]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md#step-three-turn-up-the-replicated-slave-pods )\u3060\u3068brendanburns/redis-slave\u306epod\u304c2\u3064\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3059\u304c\u3001\u624b\u5143\u306e\u74b0\u5883\u3067\u306f1\u3064\u3060\u3051\u3067\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n```\n\n\u4f55\u304c\u8d77\u304d\u3066\u3044\u308b\u306e\u304b\u3068\u305d\u306e\u539f\u56e0\u306f\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u5148\u306b\u52e7\u3081\u3066\u307f\u307e\u3057\u305f\u3002\n\n### redis\u30b9\u30ec\u30fc\u30d6\u7528\u306e\u30b5\u30fc\u30d3\u30b9\u8d77\u52d5\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/redis-slave-service.json\n{\n  \"id\": \"redisslave\",\n  \"port\": 10001,\n  \"labels\": {\n    \"name\": \"redisslave\"\n  },\n  \"selector\": {\n    \"name\": \"redisslave\"\n  }\n}\n```\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/redis-slave-service.json create /services\nI0721 04:44:42.565445 03593 request.go:220] Waiting for completion of /operations/128\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredisslave          name=redisslave     name=redisslave     10001\n```\n\n\u3053\u308c\u306f\u554f\u984c\u306a\u304f\u7d42\u4e86\u3057\u307e\u3057\u305f\u3002\n\n/services\u3068/pods\u306e\u4e00\u89a7\u3092\u898b\u3066\u307f\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\nredisslave          name=redisslave     name=redisslave     10001\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n```\n\n### \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u306epod\u4f5c\u6210\n\n[kubernetes/examples/guestbook/README.md at master \u00b7 GoogleCloudPlatform/kubernetes]( https://github.com/GoogleCloudPlatform/kubernetes/blob/master/examples/guestbook/README.md#step-five-create-the-frontend-pod )\u3092\u53c2\u8003\u306b\u9032\u3081\u307e\u3059\u3002\n\n\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/frontend-controller.json\n  {\n    \"id\": \"frontendController\",\n    \"desiredState\": {\n      \"replicas\": 3,\n      \"replicaSelector\": {\"name\": \"frontend\"},\n      \"podTemplate\": {\n        \"desiredState\": {\n           \"manifest\": {\n             \"version\": \"v1beta1\",\n             \"id\": \"frontendController\",\n             \"containers\": [{\n               \"image\": \"brendanburns/php-redis\",\n               \"ports\": [{\"containerPort\": 80, \"hostPort\": 8000}]\n             }]\n           }\n         },\n         \"labels\": {\"name\": \"frontend\"}\n        }},\n    \"labels\": {\"name\": \"frontend\"}\n  }\n```\n\nbrendanburns/php-redis\u306eDockerfile\u3068\u601d\u308f\u308c\u308b\u3082\u306e\u304cexamples/guestbook/php-redis/\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/Dockerfile\nFROM brendanburns/php\n\nADD index.php /var/www/index.php\nADD controllers.js /var/www/controllers.js\nADD index.html /var/www/index.html\n\nCMD /run.sh\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/index.php\n<?\n\nset_include_path('.:/usr/share/php:/usr/share/pear:/vendor/predis');\n\nerror_reporting(E_ALL);\nini_set('display_errors', 1);\n\nrequire 'predis/autoload.php';\n\nif (isset($_GET['cmd']) === true) {\n  header('Content-Type: application/json');\n  if ($_GET['cmd'] == 'set') {\n    $client = new Predis\\Client([\n      'scheme' => 'tcp',\n      'host'   => getenv('SERVICE_HOST'),\n      'port'   => getenv('REDISMASTER_SERVICE_PORT'),\n    ]);\n    $client->set($_GET['key'], $_GET['value']);\n    print('{\"message\": \"Updated\"}');\n  } else {\n    $read_port = getenv('REDISMASTER_SERVICE_PORT');\n\n    if (isset($_ENV['REDISSLAVE_SERVICE_PORT'])) {\n      $read_port = getenv('REDISSLAVE_SERVICE_PORT');\n    }\n    $client = new Predis\\Client([\n      'scheme' => 'tcp',\n      'host'   => getenv('SERVICE_HOST'),\n      'port'   => $read_port,\n    ]);\n\n    $value = $client->get($_GET['key']);\n    print('{\"data\": \"' . $value . '\"}');\n  }\n} else {\n  phpinfo();\n} ?>\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/index.html\n<html ng-app=\"redis\">\n  <head>\n    <title>Guestbook</title>\n    <link rel=\"stylesheet\" href=\"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js\"></script>\n    <script src=\"/controllers.js\"></script>\n    <script src=\"ui-bootstrap-tpls-0.10.0.min.js\"></script>\n  </head>\n  <body ng-controller=\"RedisCtrl\">\n    <div style=\"width: 50%; margin-left: 20px\">\n      <h2>Guestbook</h2>\n    <form>\n    <fieldset>\n    <input ng-model=\"msg\" placeholder=\"Messages\" class=\"form-control\" type=\"text\" name=\"input\"><br>\n    <button type=\"button\" class=\"btn btn-primary\" ng-click=\"controller.onRedis()\">Submit</button>\n    </fieldset>\n    </form>\n    <div>\n      <div ng-repeat=\"msg in messages\">\n        {{msg}}\n      </div>\n    </div>\n    </div>\n  </body>\n</html>\ncore@core-01 /opt/kubernetes/kubernetes $ cat examples/guestbook/php-redis/controllers.js\nvar redisApp = angular.module('redis', ['ui.bootstrap']);\n\n/**\n * Constructor\n */\nfunction RedisController() {}\n\nRedisController.prototype.onRedis = function() {\n    this.scope_.messages.push(this.scope_.msg);\n    this.scope_.msg = \"\";\n    var value = this.scope_.messages.join();\n    this.http_.get(\"/index.php?cmd=set&key=messages&value=\" + value)\n            .success(angular.bind(this, function(data) {\n                this.scope_.redisResponse = \"Updated.\";\n            }));\n};\n\nredisApp.controller('RedisCtrl', function ($scope, $http, $location) {\n        $scope.controller = new RedisController();\n        $scope.controller.scope_ = $scope;\n        $scope.controller.location_ = $location;\n        $scope.controller.http_ = $http;\n\n        $scope.controller.http_.get(\"/index.php?cmd=get&key=messages\")\n            .success(function(data) {\n                console.log(data);\n                $scope.messages = data.data.split(\",\");\n            });\n});\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg -c examples/guestbook/frontend-controller.json create /replicationControllers\nI0721 04:47:55.237466 03614 request.go:220] Waiting for completion of /operations/138\nI0721 04:48:15.242877 03614 request.go:220] Waiting for completion of /operations/138\nI0721 04:48:35.246837 03614 request.go:220] Waiting for completion of /operations/138\n\u2026(\u7565)\u2026\n^C\n```\n\n\u306a\u304b\u306a\u304b\u5e30\u3063\u3066\u3053\u306a\u3044\u306e\u3067\u3001Ctrl-C\u3067\u6b62\u3081\u3066\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /pods\nName                                   Image(s)                   Host                Labels\n----------                             ----------                 ----------          ----------\nredis-master-2                         dockerfile/redis           127.0.0.1/          name=redis-master\n169d845e-108c-11e4-b2af-0800273da0c1   brendanburns/redis-slave   127.0.0.1/          name=redisslave,replicationController=redisSlaveController\n45ff7456-1092-11e4-b2af-0800273da0c1   brendanburns/php-redis     127.0.0.1/          name=frontend,replicationController=frontendController\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /replicationControllers\nName                   Image(s)                   Selector            Replicas\n----------             ----------                 ----------          ----------\nredisSlaveController   brendanburns/redis-slave   name=redisslave     2\nfrontendController     brendanburns/php-redis     name=frontend       3\n\ncore@core-01 /opt/kubernetes/kubernetes $ kubecfg list /services\nName                Labels              Selector            Port\n----------          ----------          ----------          ----------\nredismaster                             name=redis-master   10000\nredisslave          name=redisslave     name=redisslave     10001\n```\n\ncurl\u3067http://localhost:8000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3068guestbook\u306e\u30da\u30fc\u30b8\u304c\u8fd4\u3063\u3066\u304d\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ curl http://localhost:8000\n<html ng-app=\"redis\">\n  <head>\n    <title>Guestbook</title>\n    <link rel=\"stylesheet\" href=\"//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css\">\n    <script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js\"></script>\n    <script src=\"/controllers.js\"></script>\n    <script src=\"ui-bootstrap-tpls-0.10.0.min.js\"></script>\n  </head>\n  <body ng-controller=\"RedisCtrl\">\n    <div style=\"width: 50%; margin-left: 20px\">\n      <h2>Guestbook</h2>\n    <form>\n    <fieldset>\n    <input ng-model=\"msg\" placeholder=\"Messages\" class=\"form-control\" type=\"text\" name=\"input\"><br>\n    <button type=\"button\" class=\"btn btn-primary\" ng-click=\"controller.onRedis()\">Submit</button>\n    </fieldset>\n    </form>\n    <div>\n      <div ng-repeat=\"msg in messages\">\n        {{msg}}\n      </div>\n    </div>\n    </div>\n  </body>\n</html>\n```\n\nOSX\u3067Chrome\u3067 http://172.17.8.101:8000/ \u3092\u958b\u3044\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u306f\u3067\u304d\u3066\u3044\u307e\u3057\u305f\u3002\n\n![guestbook.png](https://qiita-image-store.s3.amazonaws.com/0/3227/1f25b2a4-0852-b7e2-6519-fb567b081b72.png)\n\n\u3067\u3059\u304c\u3001\u4f55\u304b\u5165\u529b\u3057\u3066Submit\u3092\u62bc\u3057\u3066\u3082\u4f55\u3082\u8d77\u304d\u307e\u305b\u3093\u3002\n\nhttp://172.17.8.101:8000/ \u3092\u30ea\u30ed\u30fc\u30c9\u3057\u3066Chrome\u306edevtool\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u898b\u3066\u307f\u308b\u3068JavaScript\u306e\u30a8\u30e9\u30fc\u304c\u8d77\u304d\u3066\u3044\u307e\u3057\u305f\u3002\n\n![guestbook_js_error.png](https://qiita-image-store.s3.amazonaws.com/0/3227/9b6c064b-6b1b-f600-81fb-013b6c38c9e4.png)\n\n```\nbr />\n<b>Fatal error</b>:  Uncaught exception 'Predis\\Connection\\ConnectionException' with message 'Connection refused [tcp://127.0.0.1:10000]' in /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php:141\nStack trace:\n#0 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(96): Predis\\Connection\\AbstractConnection-&gt;onConnectionError('Connection refu...', 111)\n#1 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(70): Predis\\Connection\\StreamConnection-&gt;tcpStreamInitializer(Object(Predis\\Connection\\ConnectionParameters))\n#2 /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php(96): Predis\\Connection\\StreamConnection-&gt;createResource()\n#3 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(144): Predis\\Connection\\AbstractConnection-&gt;connect()\n#4 /vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php(181): Predis\\Connection\\StreamConnection-&gt;connect()\n#5 /vendor/predis/predis/lib/Predis/Connection/StreamConnection.php(183): Predis\\Connection\\AbstractConnection-&gt;ge in <b>/vendor/predis/predis/lib/Predis/Connection/AbstractConnection.php</b> on line <b>141</b><br />\n controllers.js:26\n\n\nTypeError: Cannot read property 'split' of undefined\n    at http://172.17.8.101:8000/controllers.js:27:37\n    at https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:66:373\n    at A (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:93:5)\n    at A (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:93:5)\n    at https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:94:173\n    at h.$eval (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:102:456)\n    at h.$digest (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:100:218)\n    at h.$apply (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:103:264)\n    at f (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:67:120)\n    at H (https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js:71:191) angular.js:9435\n```\n\npredis\u304c tcp://127.0.0.1:10000 \u306b\u7e4b\u304e\u306b\u884c\u3053\u3046\u3068\u3057\u3066\u5931\u6557\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u306a\u305c\u30dd\u30fc\u30c810000\u306a\u306e\u304b\u304c\u8b0e\u3067\u3059\u3002\u4e0a\u8a18\u306eindex.php\u3092\u898b\u308b\u3068REDISSLAVE_SERVICE_PORT\u74b0\u5883\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\u305d\u306e\u5024\u3067\u3001\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070REDISMASTER_SERVICE_PORT\u74b0\u5883\u5909\u6570\u306e\u5024\u3092\u4f7f\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u306e\u6642\u70b9\u3067docker ps\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n```shell-session\ncore@core-01 /opt/kubernetes/kubernetes $ docker ps --no-trunc\nCONTAINER ID                                                       IMAGE                             COMMAND                                           CREATED             STATUS              PORTS                    NAMES\n150252488eb48d673ea27cc624f67d19894b0e6f7131b000d7f257b0fddff450   brendanburns/php-redis:latest     /bin/sh -c /run.sh                                46 minutes ago      Up 46 minutes                                k8s----45ff7456_-_1092_-_11e4_-_b2af_-_0800273da0c1--8fafe560\nd0c0d44598a1fc7e18bf3e37d4332dad2af23a61644092d3f7fb24344d6e0a1d   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   50 minutes ago      Up 50 minutes       0.0.0.0:8000->80/tcp     k8s--net--45ff7456_-_1092_-_11e4_-_b2af_-_0800273da0c1--94270597\n0f4f8e809955377da2c176e0114795fa23d38f7d18e6237e27332a8a861ec101   brendanburns/redis-slave:latest   /bin/sh -c /run.sh                                About an hour ago   Up About an hour                             k8s----169d845e_-_108c_-_11e4_-_b2af_-_0800273da0c1--c8c817c2\n56c29b155bab49ac10f76e963c7c431555accb4881a9d9dcf12952ed85265738   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   About an hour ago   Up About an hour    0.0.0.0:6380->6379/tcp   k8s--net--169d845e_-_108c_-_11e4_-_b2af_-_0800273da0c1--196db470\ne45fe7b2510009127e2700cb628a2ac2fc3cfafff2278040d2d0d26fc21a6935   dockerfile/redis:latest           redis-server /etc/redis/redis.conf                About an hour ago   Up About an hour                             k8s--master--redis_-_master_-_2--4befd1d1\n787bb5ddf655ef576b1425f64772291296ce5cc983836153787a56587ad41c85   busybox:buildroot-2014.02         sh -c 'rm -f nap && mkfifo nap && exec cat nap'   About an hour ago   Up About an hour    0.0.0.0:6379->6379/tcp   k8s--net--redis_-_master_-_2--f8803f12\n```\n\nredis\u306e\u30b9\u30ec\u30fc\u30d6\u306f6380\u3001\u30de\u30b9\u30bf\u30fc\u306f6379\u306a\u306e\u3067\u300110000\u306b\u306a\u308b\u306e\u306f\u4f55\u304b\u5909\u3067\u3059\u3002\u3072\u3087\u3063\u3068\u3059\u308b\u3068\u3001Docker Hub\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b[brendanburns/php-redis]( https://registry.hub.docker.com/u/brendanburns/php-redis/ )\u30a4\u30e1\u30fc\u30b8\u306eDockerfile\u3084index.php\u306f\u4e0a\u8a18\u3067\u78ba\u8a8d\u3057\u305f\u306e\u3068\u306f\u9055\u3046\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u75b2\u308c\u3066\u304d\u305f\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305a\u4eca\u56de\u306f\u3053\u306e\u8fba\u3067\u3002\u6c17\u304c\u5411\u3044\u305f\u3089\u3001Docker Hub\u304b\u3089\u843d\u3068\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u30ed\u30fc\u30ab\u30eb\u3067docker build\u3057\u3066\u518d\u5ea6\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n", "tags": ["kubernetes", "CoreOS379.3.0", "vagrant1.6.2", "\u3084\u3063\u3066\u307f\u305f"]}