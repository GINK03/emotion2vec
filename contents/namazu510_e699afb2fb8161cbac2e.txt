{"context": "\n\nVue.js\u3067SSR\uff08\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\uff09\u3059\u308b\n\u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u306f\u306a\u306b\u304b\u306e Advent Calendar 2016\u306e23\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059.\nVue.js\u306f\uff12\u7cfb\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u305d\u3053\u305d\u3053\u305f\u3061\u307e\u3057\u305f.\n\u65e5\u672c\u8a9e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u305d\u308d\u3063\u3066\u3044\u307e\u3059. \u30d5\u30ed\u30f3\u30c8\u306e\u53d6\u308a\u304b\u304b\u308a\u3068\u3057\u3066\u7c21\u5358\u3067\u30b9\u30b1\u30fc\u30eb\u3082\u3057\u3084\u3059\u304f\u826f\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b.\n\u305d\u3053\u3067\u4eca\u56de\u306fVue.js\uff12\u7cfb\u306e\u5927\u304d\u306a\u7279\u5fb4\u3067\u3042\u308b\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u884c\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5236\u4f5c\u3092\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059.\n\u6700\u7d42\u7684\u306b\n\nAPI\u30b3\u30fc\u30eb\u3092\u3057\u3066\u52d5\u7684\u30da\u30fc\u30b8\u306eSSR\u3092\u884c\u3046\n\u521d\u671f\u8868\u793a\u4ee5\u5f8c\u306fSPA\u3068\u3057\u3066\u52d5\u304f\n\n\u3053\u3093\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u76ee\u6307\u3057\u307e\u3059.\n\u5b8c\u6210\u7248\u306f\u4ee5\u4e0b\u3067\u3059\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 Github\n\n\n\u4f7f\u3046\u7269\nvuejs vue-router vuex\n\u3053\u306e\u3042\u305f\u308a\u3092\u4f7f\u3044\u307e\u3059.\n\u8a73\u3057\u304f\u306f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306epackage.json\u3092...\n\nStep1\u3000\u9759\u7684\u30da\u30fc\u30b8\u306eSSR\n\u3055\u3041\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059.\n\u307e\u305a\u7b2c\u4e00\u306b\u9759\u7684\u30da\u30fc\u30b8(API\u30b3\u30fc\u30eb\u3067\u30c7\u30fc\u30bf\u3092\u66f8\u3044\u305f\u308a\u3057\u306a\u3044\uff09\u30da\u30fc\u30b8\u3092SSR\u3067\u8868\u793a\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059.\nvuejs\u3068vue-router,\u4f55\u3082\u8a2d\u5b9a\u3057\u306a\u3044vuex\u3067\u30da\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059.\n\n\u30da\u30fc\u30b8\u4f5c\u6210\n\u9069\u5f53\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8fbc\u307f\u306e\u30da\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3059.\n\u4eca\u56de\u306fApp\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30eb\u30fc\u30c8\u3068\u3057router-view\u3092\u5b50\u306b\u4e0e\u3048\n\n/counter \u3067\u3000Counter\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08\u3088\u304f\u3042\u308b\u30ab\u30a6\u30f3\u30bf) \n/weather \u3067\u3000Weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3000\uff08\u6700\u7d42\u7684\u306bAPI\u30b3\u30fc\u30eb\u3067\u5929\u6c17\u3092\u8868\u793a)\n\n\u3053\u306e2\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u30d1\u30b9\u306b\u5fdc\u3058\u3066\u914d\u7f6e\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059.\n\u305d\u308c\u3067\u306f\u307e\u305avue\u30d5\u30a1\u30a4\u30eb\u3068\u30a8\u30f3\u30c8\u30ea\u30b9\u30af\u30ea\u30d7\u30c8\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3001webpack\u306e\u57fa\u672c\u8a2d\u5b9a\u7b49\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059.\n\u5c1a,\u8a2d\u5b9a\u7b49\u306f\u6975\u529b\u7c21\u7565\u5316\u3092\u3057\u3066\u3044\u307e\u3059. \u5b9f\u969b\u306b\u4f7f\u3046\u306b\u306f\u3053\u308c\u3067\u306f\u529b\u4e0d\u8db3\u306a\u306e\u3067\u53c2\u8003\u30da\u30fc\u30b8\u306evue-hacker-news\u3000\u306e\u8a2d\u5b9a\u3092\u30b3\u30d4\u3063\u3066\u81ea\u5206\u306b\u5408\u3046\u3088\u3046\u306b\u5909\u3048\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059. \u4eca\u56de\u793a\u3059\u8a2d\u5b9a\u306f\u53c2\u8003\u30b5\u30a4\u30c8\u306e\u8a2d\u5b9a\u3092\u5143\u306b\u524a\u3063\u305f\u7269\u3067\u3059\u3000\n\n\u30da\u30fc\u30b8\n\nsrc/App.vue\n<template>\n  <div id=\"app\">\n    <nav>\n      <ul>\n        <li><router-link to=\"/counter\">Counter</router-link></li>\n        <li><router-link to=\"/weather\">Weather</router-link></li>\n      </ul>\n    </nav>\n    <router-view></router-view>\n  </div>\n</template>\n<script>\nexport default {\n  name: 'app'\n}\n</script>\n\n\n\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059.\n\u5185\u90e8\u306brouter-view\u3092\u7528\u610f\u3057\u30d1\u30b9\u306b\u5fdc\u3058\u3066\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059.\n\nsrc/views/Counter.vue\n<template>\n    <div id=\"counter\">\n      <h1> Counter Comp </h1>\n      <p> {{ cnt }}.sec </p>\n    </div>\n</template>\n<script>\nexport default {\n  name: 'counter',\n  data () {\n    return {\n      cnt: 0\n    }\n  },\n  beforeMount () {\n    // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8d70\u3089\u305b\u308b\u51e6\u7406\u306f\u9069\u5f53\u306a\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30e1\u30bd\u30c3\u30c9\u3067\u8a2d\u5b9a.\n    // \u6ce8\u610f: \u3053\u306e\u95a2\u6570\u3068\u307e\u308a\u307e\u305b\u3093(\u00b4\u30fb\u03c9\u30fb\uff40)\n    setInterval(() => {\n      this.cnt++\n    }, 1000)\n  }\n}\n</script>\n\n\n\u30ab\u30a6\u30f3\u30bf\u30fc\u3067\u3059. \uff11\u79d2\u5f8c\u306b\u8868\u793a\u3055\u308c\u308b\u6570\u5024\u304c\u5897\u3048\u307e\u3059.\n\nsrc/views/Weather.vue\n<template>\n  <div id=\"weather\">\n    <h1> WeatherComp </h1>\n  </div>\n</template>\n\n\n\u305d\u306e\u3046\u3061API\u30b3\u30fc\u30eb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u304c,\u73fe\u72b6\u306f\u305f\u3060\u306e\u9759\u7684\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u306b\u3057\u307e\u3059.\n\nrouter\u8a2d\u5b9a\n\nsrc/router/index.js\nimport Vue from 'vue'\nimport Router from 'vue-router'\n\nVue.use(Router)\n\nimport Counter from '../views/Counter.vue'\nimport Weather from '../views/Weather.vue'\nexport default new Router({\n  mode: 'history',\n  routes: [\n    {\n      path: '/counter',\n      component: Counter\n    },\n    {\n      path: '/weather',\n      component: Weather\n    },\n    {\n      path: '/',\n      redirect: '/counter'\n    }\n  ]\n})\n\n\n\u30d1\u30b9\u5272\u308a\u5f53\u3066\u3092\u3057\u307e\u3059.\n\nvuex\u521d\u671f\u8a2d\u5b9a\n\nsrc/store/index.js\nimport Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex)\n\nconst store = new Vuex.Store({\n  state: {\n  },\n  actions: {\n  },\n  mutations: {\n  },\n  getters: {\n  }\n})\n\nexport default store\n\n\n\u73fe\u6bb5\u968e\u3067\u306f\u7a7a\u3063\u307d\u3067\u3059.\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30a8\u30f3\u30c8\u30ea\n\nsrc/app.js\nimport Vue from 'vue'\nimport App from './App.vue'\nimport store from './store'\nimport router from './router'\nimport { sync } from 'vuex-router-sync'\n\n// router\u3068store\u3092\u540c\u671f\u3055\u305b\u308b\u51e6\u7406\u3067\u3059\n// \u30da\u30fc\u30b8\u9077\u79fb\u3059\u308b\u3068mutation\u304c\u8d70\u3063\u305f\u308a\u3057\u3066\u304f\u308c\u3066store\u306e\u4e2d\u306brouter\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u304c\u5165\u308b\u4fbf\u5229\u306a\u5974\u3067\u3059.\nsync(store, router)\n\nconst app = new Vue({\n  router,\n  store,\n  ...App\n})\n\nexport { app, router, store }\n\n\nVue\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3067\u3059.\n\u666e\u901a\u306a\u3089\u3053\u3053\u3067\u30de\u30a6\u30f3\u30c8\u307e\u3067\u884c\u3044\u307e\u3059\u304c,\u4eca\u56de\u306fSSR\u3092\u884c\u3046\u306e\u3067\u30de\u30a6\u30f3\u30c8\u306f\u3053\u3053\u3067\u306f\u884c\u3044\u307e\u305b\u3093. \u5f8c\u8ff0\u306eclient-entry.js\u3067\u30de\u30a6\u30f3\u30c8\u3092\u3057\u307e\u3059.\n\nSSR\u7528\u306e\u8a2d\u5b9a\u3068\u5b9f\u884c\u30b3\u30fc\u30c9\nSSR\u3067\u304d\u308b\u3088\u3046\u306bwebpack\u306e\u8a2d\u5b9a\u3001\u53ca\u3073\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u307e\u3059.\nSSR\u3059\u308b\u306b\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u63d0\u4f9b\u3059\u308b\u3044\u3064\u3082\u306ewebpack\u306e\u51fa\u529b\u306b\u52a0\u3048\u3066\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u5b9f\u884c\u3059\u308b\u30d0\u30a4\u30ca\u30ea\u3082\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059.\n\u5177\u4f53\u7684\u306b\u306f\n\nwebpack\u306e\u8a2d\u5b9a\u3092\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u5074\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u306f\u304d\u51fa\u3059\u51e6\u7406\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u306f\u304d\u51fa\u3059\u51e6\u7406\u306e\uff12\u3064\u306e\u8a2d\u5b9a\u3092\u4f5c\u308a\u307e\u3059.\nwebpack\u306e\u30a8\u30f3\u30c8\u30ea\u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u3082\u306e\u3092client\u5074\u3068server\u5074\u3067\u5206\u3051\u307e\u3059. client\u5074\u306fclient-entry.js server\u5074\u306fserve-entry.js\u3067\u3059\n\n\u5148\u306bwebpack\u306e\u8a2d\u5b9a\u3092\u793a\u3057\u307e\u3059.\n\nbuild/webpack.base.conf.js\nconst path = require('path')\nconst webpack = require('webpack')\n\nmodule.exports = {\n  devtool: '#source-map',\n  entry: {\n    app: './src/client-entry.js',\n    vendor: [\n      'es6-promise',\n      'vue',\n      'vue-router',\n      'vuex',\n      'vuex-router-sync'\n    ]\n  },\n  output: {\n    path: path.resolve(__dirname, '../dist'),\n    publicPath: '/dist/',\n    filename: '[name].[chunkhash].js'\n  },\n  resolve: {\n    alias: {\n      'public': path.resolve(__dirname, '../public')\n    }\n  },\n  module: {\n    noParse: /es6-promise\\.js$/, // avoid webpack shimming process\n    rules: [\n      {\n        test: /\\.vue$/,\n        loader: 'vue-loader'\n      },\n      {\n        test: /\\.js$/,\n        loader: 'babel-loader',\n        exclude: /node_modules/\n      }\n    ]\n  }\n}\n\n\n\n\u57fa\u672c\u8a2d\u5b9a\u3067\u3059. \u3053\u308c\u3092\u53d7\u3051\u7d99\u304e\u3064\u3064\u30b5\u30fc\u30d0\u5074\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\uff12\u3064\u3092\u5410\u304f\u8a2d\u5b9a\u3092\u305d\u308c\u305e\u308c\u4f5c\u308a\u307e\u3059.\n\nbuild/webpack.client.conf.js\nconst webpack = require('webpack')\nconst base = require('./webpack.base.config')\nconst HTMLPlugin = require('html-webpack-plugin')\n\nconst config = Object.assign({}, base, {\n  plugins: (base.plugins || []).concat([\n    // strip comments in Vue code\n    new webpack.DefinePlugin({\n      'process.env.VUE_ENV': '\"client\"'\n    }),\n    // extract vendor chunks for better caching\n    new webpack.optimize.CommonsChunkPlugin({\n      name: 'vendor'\n    }),\n    // generate output HTML\n    new HTMLPlugin({\n      template: 'src/index.template.html'\n    })\n  ])\n})\n\nmodule.exports = config\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u3059.\n\nbuild/webpack.server.conf.js\nconst webpack = require('webpack')\nconst base = require('./webpack.base.config')\n\nmodule.exports = Object.assign({}, base, {\n  target: 'node',\n  devtool: false,\n  entry: './src/server-entry.js',\n  output: Object.assign({}, base.output, {\n    filename: 'server-bundle.js',\n    libraryTarget: 'commonjs2'\n  }),\n  externals: Object.keys(require('../package.json').dependencies),\n  plugins: [\n    new webpack.DefinePlugin({\n      'process.env.VUE_ENV': '\"server\"'\n    })\n  ]\n})\n\n\n\u30b5\u30fc\u30d0\u5074\u3067\u3059\u3000base\u3067\u8a2d\u5b9a\u3055\u308c\u305fentry\u3092\u4e0a\u66f8\u304d\u3057\u3066server-entry.js\u306b\u3057\u307e\u3059.\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u4f7f\u308f\u308c\u308b\u91cd\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u3067\u3059\n\nsrc/client-entry.js\nimport 'es6-promise/auto'\nimport { app, store } from './app'\n\n// window.__INITIAL_STATE__\u306b\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u306estate\u304c\u5165\u3063\u3066\u308b\n// \u30b5\u30fc\u30d0\u304b\u3089\u6e21\u3055\u308c\u305fState\u306bstore\u306e\u72b6\u614b\u3092\u8a2d\u5b9a\u3059\u308b\nstore.replaceState(window.__INITIAL_STATE__)\n\n// actually mount to DOM\napp.$mount('#app')\n\n\n\n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306fclient\u5074\u3067\u5b9f\u884c\u3055\u308c\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\n1. \u30b5\u30fc\u30d0\u30fc\u304b\u3089window\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3064\u3051\u3089\u308c\u305fINITIAL_STATE\u3092store\u306estate\u306b\u8a2d\u5b9a\n2. vue\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30de\u30a6\u30f3\u30c8\n\u3053\u308c\u3089\u3092\u884c\u3044\u307e\u3059.\n\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6642\u306b\u3082state\u304c\u66f4\u65b0\u3055\u308c\u305f\u308a\u3057\u307e\u3059,\u305d\u306estate\u3092\u30da\u30fc\u30b8\u3092\u30b5\u30fc\u30d6\u3059\u308b\u969b\u306b\u6dfb\u4ed8\u3057\u3066\u304a\u304d\u305d\u308c\u3092\u5143\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306estate\u306b\u53d7\u3051\u6e21\u3057\u307e\u3059. \u3053\u3046\u3059\u308b\u3053\u3068\u3067\u30b5\u30fc\u30d0\u30fc\u5074\u306estate\u3092\u53d7\u3051\u3064\u3044\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u30da\u30fc\u30b8\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059. \n\u3053\u306estate\u306e\u53d7\u3051\u6e21\u3057\u304c\u3042\u308b\u4ee5\u5916\u306f\u57fa\u672c\u7684\u306avue\u306e\u521d\u671f\u8a2d\u5b9a\u3068\u540c\u3058\u3060\u3068\u601d\u3044\u307e\u3059.\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306f\u4ee5\u4e0a\u3067\u3059.\n\u30b5\u30fc\u30d0\u30fc\u5074\u306f\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u3044\u3046\u3068...\nserer-entry.js\u3068express\u306e\u8a2d\u5b9a\u3068SSR\u3092\u884c\u3044\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u66f8\u304d\u51fa\u3059\u51e6\u7406(server.js)\u304c\u3042\u308a\u307e\u3059.\n2\u3064\u3081\u306eserver.js\u306f\u5b9f\u969b\u306bexpress\u3092\u7acb\u3061\u4e0a\u3052\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u3057\u7d50\u679c\u3092\u8fd4\u3059\u51e6\u7406\u304c\u66f8\u304b\u308c\u3066\u3044\u307e\u3059.\nexpress\u306e\u8a2d\u5b9a\u306fVue.js\u306e\u516c\u5f0f\u306eSSR\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u3044\u304f\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059.\n\nsrc/server-entry.js\nimport { app, router, store} from './app'\n\nexport default context => {\n  // set router's location\n  router.push(context.url)\n  const matchedComponents = router.getMatchedComponents()\n\n  // no matched routes\n  if (!matchedComponents.length) {\n    return Promise.reject({ code: '404' })\n  }\n  context.initialState = store.state\n  return app\n}\n\n\n\n\nserver.js\nprocess.env.VUE_ENV = 'server'\n\nconst fs = require('fs')\nconst path = require('path')\nconst express = require('express')\nconst compression = require('compression')\nconst serialize = require('serialize-javascript')\nconst resolve = file => path.resolve(__dirname, file)\n\nconst app = express()\n\nconst indexHTML = parseIndex(fs.readFileSync(resolve('./dist/index.html'), 'utf-8'))\nconst renderer = createRenderer(fs.readFileSync(resolve('./dist/server-bundle.js'), 'utf-8'))\n\n\n\nfunction createRenderer (bundle) {\n  // https://github.com/vuejs/vue/blob/next/packages/vue-server-renderer/README.md#why-use-bundlerenderer\n  return require('vue-server-renderer').createBundleRenderer(bundle, {\n    cache: require('lru-cache')({\n      max: 1000,\n      maxAge: 1000 * 60 * 15\n    })\n  })\n}\n\nfunction parseIndex (template) {\n  const contentMarker = '<!-- APP -->'\n  const i = template.indexOf(contentMarker)\n  return {\n    head: template.slice(0, i),\n    tail: template.slice(i + contentMarker.length)\n  }\n}\n\nconst serve = (path, cache) => express.static(resolve(path), {\n  maxAge: cache && 60 * 60 * 24 * 30\n})\n\napp.use(compression({ threshold: 0 }))\napp.use('/dist', serve('./dist'))\n\napp.get('*', (req, res) => {\n  if (!renderer) {\n    return res.end('waiting for compilation... refresh in a moment.')\n  }\n\n  res.setHeader(\"Content-Type\", \"text/html\");\n\n  const context = { url: req.url }\n  const renderStream = renderer.renderToStream(context)\n\n  renderStream.once('data', () => {\n    res.write(indexHTML.head)\n  })\n\n  renderStream.on('data', chunk => {\n    res.write(chunk)\n  })\n\n  renderStream.on('end', () => {\n    // \u30b5\u30fc\u30d0\u30fc\u5074\u306estore\u3092client\u5074\u306b\u6d41\u3059.\n    // window\u306b__INITIAL_STATE__\u307f\u305f\u3044\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u306f\u3084\u3057\u3066\u304a\u3044\u3066\u305d\u3053\u306b\u5165\u308c\u3066\u304a\u304f\n    // client-entry\u3067\u3053\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067state\u3092\u7f6e\u304d\u63db\u3048\u308b.\n    if (context.initialState) {\n      res.write(\n        `<script>window.__INITIAL_STATE__=${\n          serialize(context.initialState, { isJSON: true })\n        }</script>`\n      )\n    }\n    res.end(indexHTML.tail)\n  })\n\n  // error\u51e6\u7406\n  renderStream.on('error', err => {\n    if (err && err.code === '404') {\n      res.status(404).end('404 | Page Not Found')\n      return\n    }\n    // Render Error Page or Redirect\n    res.status(500).end('Internal Error 500')\n    console.error(`error during render : ${req.url}`)\n    console.error(err)\n  })\n})\n\nconst port = 8080\napp.listen(port, () => {\n  console.log(`server started at localhost:${port}`)\n})\n\n\n\n\n\u5b9f\u884c\n\u3053\u3053\u307e\u3067\u3084\u308b\u3068\u9759\u7684\u30da\u30fc\u30b8\u3092SSR\u3057\u3066\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059.\n\u5c1a,\u3053\u3053\u307e\u3067\u306e\u30b3\u30fc\u30c9\u306fStep1 code (Github) \u306b\u3042\u308a\u307e\u3059.\n\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u305f\u753b\u9762\u3067\u3059\u3002\n\nhttp://localhost:8080/counter\n\u30ab\u30a6\u30f3\u30bf\u30fc\u3067\u3059. 1\u79d2\u3054\u3068\u306b\u6570\u5024\u304c\u5897\u3048\u307e\u3059.\n\nhttp://localhost:8080/weather\n\n\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30bd\u30fc\u30b9\u3092\u898b\u305f\u5834\u5408\u3067\u3059. \u3061\u3083\u3093\u3068\u30b5\u30fc\u30d0\u5074\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u3066DIV\u306e\u4e2d\u8eab\u304c\u7a7a\u3063\u307d\u3058\u3083\u306a\u304f\u5e30\u3063\u3066\u304d\u307e\u3059.\n\u7c21\u5358\u306a\u30da\u30fc\u30b8\u3067\u3059\u304cvuejs\u3092\u7528\u3044\u3066SSR\u304c\u3067\u304d\u307e\u3057\u305f\uff01\u3000\u3053\u308c\u3067SEO\u5bfe\u7b56\u3082\u7c21\u5358\uff1f\u3067\u3059\u306d\nStep1\u306f\u3053\u308c\u3067\u304a\u3057\u307e\u3044\u3067\u3059.\n\nStep2\u3000\u52d5\u7684\u30da\u30fc\u30b8\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\nAPI\u30b3\u30fc\u30eb\u3092\u884c\u3044\u52d5\u7684\u306a\u30da\u30fc\u30b8\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3059.\n\u4eca\u4f55\u3082\u306a\u3044weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092API\u30b3\u30fc\u30eb\u3092\u884c\u3044\u5e30\u3063\u3066\u304d\u305f\u30c7\u30fc\u30bf\u3092\u5143\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059.\nAPI\u306f\u9069\u5f53\u306b\u898b\u3064\u3051\u305f\u304a\u5929\u6c17API\u306b\u304a\u4e16\u8a71\u306b\u306a\u308d\u3046\u3068\u601d\u3044\u307e\u3059.\n\u305d\u308c\u3067\u306fStep1\u306e\u30b3\u30fc\u30c9\u306b\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059.\n\u4f55\u3092\u3059\u308b\u304b\u3068\u3044\u3046\u3068,\u307e\u305a\u7b2c\u4e00\u306b\u30b5\u30fc\u30d0\u30fc\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6642\u306bcomponent\u306b\u7d10\u4ed8\u3051\u3089\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059.\npreFetch\u30e1\u30bd\u30c3\u30c9\u3068\u3044\u3046store\u3092\u5f15\u6570\u306b\u3082\u3064\u30e1\u30bd\u30c3\u30c9\u3092component\u306b\u5b9f\u88c5\u3057,\u3053\u306e\u4e2d\u3067API\u30b3\u30fc\u30eb\u3092\u5b9f\u884c\u3059\u308baction\u3092\u8d77\u3053\u3057,mutation\u3092\u547c\u3073\u307e\u3059. \nmutation\u306b\u3088\u308astate\u306f\u5909\u66f4\u3055\u308c\u307e\u3059. prefetch\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u884c\u304c\u7d42\u308f\u3063\u305f\u6642\u70b9\u3067\uff08promise\u304c\u5168\u90e8\u5e30\u3063\u3066\u304d\u305f\u3089\uff09\u5b9f\u969b\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306b\u5165\u308a\u307e\u3059.\n\u5177\u4f53\u7684\u306b\u306f\u307e\u305a\nserver-entry.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059.\n\nsrc/server-entry.js\nimport { app, router, store} from './app'\n\nexport default context => {\n  // set router's location\n  router.push(context.url)\n  const matchedComponents = router.getMatchedComponents()\n\n  // no matched routes\n  if (!matchedComponents.length) {\n    return Promise.reject({ code: '404' })\n  }\n  // preFetch\u30e1\u30bd\u30c3\u30c9\u3092\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u547c\u3093\u3067action\u306e\u5b9f\u884c\u3084mutation\u3092\u3055\u305b\u308b\n  // state\u306bSSR\u6642\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u5165\u308c\u308b.\n  return Promise.all(matchedComponents.map(component => {\n    if (component.preFetch) {\n      return component.preFetch(store)\n    }\n  })).then(() => {\n    context.initialState = store.state\n    return app\n  })\n\n  return app\n}\n\n\n\n\u3053\u306e\u3088\u3046\u306b\u3057\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u3079\u304d\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306epreFetch\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3055\u305b\u307e\u3059.\n\u307e\u305fwether.vue\u306bpreFetch\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u307e\u3059.\nwether.vue\u3067\u306fshowWeather\u3068\u3044\u3046action\u3092\u767a\u884c\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059.\n\u6c17\u304c\u65e9\u3044\u3067\u3059\u304cwether.vue\u306bstate\u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u30b3\u30fc\u30c9\u3082\u66f8\u3044\u3066\u3057\u307e\u3057\u307e\u3057\u3087\u3046\n\nsrc/views/Weather.vue\n<template>\n  <div id=\"weather\">\n    <h1> WeatherComp </h1>\n    <p> {{weather.title}} </p>\n    <p> {{weather.state}} </p>\n  </div>\n</template>\n<script>\nexport default {\n  name: 'weather',\n\n  preFetch(store) {\n    store.dispatch('SHOW_WEATHER')\n  },\n  beforeMount() {\n    this.$store.dispatch('SHOW_WEATHER')\n  },\n\n  computed: {\n    weather () {\n      return this.$store.state.weather\n    }\n  }\n}\n</script>\n\n\npreFetch\u3067SSR\u6642\u306e\u51e6\u7406\u306f\u51fa\u6765\u307e\u3059\u304c,\u4e00\u5ea6\u8868\u793a\u3055\u308c\u305f\u5f8c\u30da\u30fc\u30b8\u9077\u79fb\u3067\u3053\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u51fa\u3055\u308c\u305f\u3068\u304d\u7b49\u306f\u5bfe\u5fdc\u3067\u304d\u307e\u305b\u3093,\u305d\u3053\u3067beforeMount\u306b\u3082\u540c\u3058\u51e6\u7406\u3092\u547c\u3070\u305b\u307e\u3059. SHOW_WEATHER\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u306fstate\u306b\u65e2\u306b\u5929\u6c17\u306e\u60c5\u5831\u304c\u3042\u308b\u304b\u78ba\u8a8d\u3057\u3001\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306e\u307fFETCH_WEATHER\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u51e6\u7406\u3092\u59d4\u8b72\u3057\u305d\u306e\u306a\u304b\u3067API\u30b3\u30fc\u30eb\u3092\u3057\u3066\u3082\u3089\u3044\u307e\u3059.\n\u3053\u308c\u3067wether.vue\u306f\u5b8c\u6210\u3067\u3059.\nvuex\u306e\u65b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\n\u307e\u305astate\u306b\u5929\u6c17\u60c5\u5831(weather)\u3092\u6301\u305f\u305b\u307e\u3059. \u4eca\u56de\u306f\u5929\u6c17\u3060\u3051\u8868\u793a\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059.\n\ntitle\u304c\u25cb\u25cb\u306e\u5929\u6c17\u306e\u3088\u3046\u306a\u6587\u5b57\u5217\nstate\u304c\u5929\u6c17\uff08\u6674\u308c\u3068\u304b\uff09\u3067\u3059.\n\n\u307e\u305fAction showWeather\u3068\u5b9f\u969b\u306bapi\u30b3\u30fc\u30eb\u3092\u3059\u308bAction fetchWeather\u3092\u5b9f\u88c5\u3057,mutation\u3082\u66f8\u304d\u307e\u3059.\n\nsrc/store/index.js\nimport Vue from 'vue'\nimport Vuex from 'vuex'\nimport {fetchWeather} from './api'\n\nVue.use(Vuex)\n\nconst store = new Vuex.Store({\n  state: {\n    weather: {\n      title: '',\n      state: ''\n    }\n  },\n\n  actions: {\n    SHOW_WEATHER: ({state, dispatch}) => {\n      // Promise\u3092\u8fd4\u3059\u306e\u3092\u5fd8\u308c\u306a\u3044\uff01\uff01\n      if (state.weather.title.length !== 0) {\n        return Promise.resolve()\n      }\n      return dispatch('FETCH_WEATHER')\n    },\n    FETCH_WEATHER: ({commit}) => {\n      return fetchWeather()\n        .then((weather) => {\n          commit('SET_WEATHER', weather)\n        })\n    }\n  },\n\n  mutations: {\n    SET_WEATHER: (state, weather) => {\n      state.weather = weather\n    }\n  },\n\n  getters: {\n  }\n})\n\nexport default store\n\n\nstore\u304b\u3089\u547c\u3093\u3067\u3044\u308bapi\u306e\u51e6\u7406fetchInformation\u81ea\u4f53\u306f\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u62bd\u51fa\u3057\u307e\u3059. \napi\u306e\u51e6\u7406\u306b\u304a\u3044\u3066\u91cd\u8981\u306a\u70b9\u304c\u3042\u308a\u307e\u3059, \u305d\u308c\u306f\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067API\u3092\u53e9\u304f\u5834\u5408\n\u30b5\u30fc\u30d0\u5074\u3067API\u3092\u53e9\u304f\u5834\u5408\n\n\u3053\u306e\uff12\u3064\u304c\u3042\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059,\u3000\u30b5\u30fc\u30d0\u5074\u3067\u6bce\u56de\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306e\u969b\u306bAPI\u3092\u53e9\u3044\u3066\u3044\u3066\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u60aa\u3067\u3059\u306e\u3067\u5fdc\u7b54\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3042\u308b\u5834\u5408\u306f\u554f\u3044\u5408\u308f\u305b\u3092\u884c\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059.\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u306f\u884c\u3044\u307e\u305b\u3093.\n\u3053\u306e\u51e6\u7406\u5206\u3051\u3092\u52b9\u679c\u7684\u306b\u5b9f\u73fe\u3059\u308b\u305f\u3081create-api-client.js\u3068create-api-server.js\u306e\uff12\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057,webpack\u306e\u6a5f\u80fd\u3092\u7528\u3044\u3066create-api.js\u3068\u3044\u3046\u540d\u524d\u3067,client\u5074\u3067\u306fcreate-api-client.js\u304cserver\u5074\u3067\u306fcreate-api-server.js\u304c\u547c\u3079\u308b\u3088\u3046\u306b\u3057\u307e\u3059.\nwebpack\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\n\nbuild/webpack.client.config.js\n  resolve: {\n    alias: Object.assign({}, base.resolve.alias, {\n      // api\u3067\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092server\u5074\u3068client\u5074\u3067\u5207\u308a\u5206\u3051\u308b\n      'create-api': './create-api-client.js'\n    })\n  },\n\n\n\nbuild/webpack.server.config.js\n  resolve: {\n    alias: Object.assign({}, base.resolve.alias, {\n      // api\u3067\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092server\u5074\u3068client\u5074\u3067\u5207\u308a\u5206\u3051\u308b\n      'create-api': './create-api-server.js'\n    })\n  },\n\n\ncreate-api-client.js\u53ca\u3073ceate-api-server.js\u3092\u4f5c\u308a\u307e\u3059\n\nsrc/store/create-api-client.js\nimport axios from 'axios'\n\nconst api = {}\nconst axiosDefault = axios.create()\n\nexport {\n  api,\n  axiosDefault\n}\n\n\n\n\nsrc/store/create-api-server.js\nimport LRU from 'lru-cache'\nimport axios from 'axios'\n\nlet api\n\nif (process.__API__) {\n  api = process.__API__\n} else {\n  api = {}\n\n  // SSR\u306e\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u30c7\u30fc\u30bf\u30ad\u30e3\u30c3\u30b7\u30e5\n  api.cachedItems = LRU({\n    max: 10000,\n    maxAge: 1000 * 60 * 15 // 15 min cache\n  })\n  process.__API__ = api\n}\n\nconst axiosDefault = axios.create()\n\nexport {\n  api,\n  axiosDefault\n}\n\n\n\n\u4e2d\u3067\u306f(\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u307f\uff09\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u7528\u610f\u3068Ajax\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u3057\u307e\u3059. Ajax\u3067\u3059\u304c\u4eca\u56de\u306faxios\u3092\u7528\u3044\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3057\u307e\u3059.Ajax\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u306e\u306f\u597d\u304d\u306a\u7269\u3092\u4f7f\u3048\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u304c,promise\u3092\u8fd4\u3059\u3088\u3046\u306b\u4f5c\u3063\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067promise\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5e30\u3063\u3066\u304f\u308b\u7269\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059.\napi.js\u3092\u4f5c\u308aAPI\u30b3\u30fc\u30eb\u3092\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\n\nsrc/store/api.js\nimport {api, axiosDefault as axios} from 'create-api'\n\nexport function fetchWeather() {\n  const CACHE_KEY = 'WEATHER'\n\n  // TOKYO\n  const CITY_CODE = 130010\n  const API_URL = `http://weather.livedoor.com/forecast/webservice/json/v1?city=${CITY_CODE}`\n\n  // Cache\u30c1\u30a7\u30c3\u30af\n  const cache = api.cachedItems\n  if (cache && cache.has(CACHE_KEY)) {\n    return Promise.resolve(cache.get(CACHE_KEY))\n  }\n\n  return axios.get(API_URL)\n    .then(response => {\n      return response.data\n    }).then(json => {\n      // \u4eca\u65e5\u306e\u5929\u6c17\u3060\u3051\u51fa\u3059.\n      return {\n        title: json.title,\n        state: json.forecasts[0].telop\n      }\n    }).then(weather => {\n      // \u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u5165\u308c\u308b.\n      cache && cache.set(CACHE_KEY, weather)\n      return weather\n    })\n\n}\n\n\n\n\u3053\u308c\u3067API\u30b3\u30fc\u30eb\u3092\u884c\u3046\u52d5\u7684\u30da\u30fc\u30b8\u304c\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\n\u5b9f\u884c\n\u5b8c\u6210\u3057\u307e\u3057\u305f. \u5b9f\u884c\u3059\u308b\u3068weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\n\n\nAPI\u30b3\u30fc\u30eb\u306e\u7d50\u679c\u304cHTML\u3067\u98db\u3093\u3067\u304d\u307e\u3059. \n\uff08\u5c1aAPI\u3061\u3083\u3093\u3068\u898b\u3066\u3044\u306a\u304b\u3063\u305f\u305b\u3044\u3067CORS\u306eAllow\u30d8\u30c3\u30c0\u304c\u7740\u3044\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u5b8c\u6210\u3057\u3066\u304b\u3089\u6c17\u3065\u304d\u30d6\u30e9\u30a6\u30b6\u5074\u304b\u3089API\u30b3\u30fc\u30eb\u3057\u305f\u7d50\u679c\u304c\u53d7\u3051\u53d6\u308c\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u3000\u6b21\u306f\u3061\u3083\u3093\u3068\u53d6\u308c\u308bAPI\u3092\u9078\u629e\u3057\u307e\u3059...)\n\n\u91cd\u8981\u70b9\n\npreFetch\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u547c\u3073\u51fa\u3057\u5143\u3067promise\u3092\u5f85\u3063\u3066\u3044\u308b\u305f\u3081,\u30c1\u30a7\u30fc\u30f3\u3092\u5207\u3089\u3055\u306a\u3044\u3088\u3046\u306b\u7e4b\u3050\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059. \u5fd8\u308c\u3066\u30c1\u30a7\u30fc\u30f3\u3092\u5207\u3063\u3066\u3057\u307e\u3046\u3068\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u51fa\u529b\u5f8c\u306bAPI\u306e\u5fdc\u7b54\u304c\u5e30\u3063\u3066\u304f\u308b\u306a\u3093\u3066\u60b2\u3057\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059. \u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046. \u79c1\u306f\u4f55\u5ea6\u3082\u5d4c\u307e\u308a\u307e\u3057\u305f.\n\n\n\u304a\u308f\u308a\u306b\n\u4eca\u56de\u306fVuejs\u3092\u5229\u7528\u3057\u52d5\u7684\u306a\u30da\u30fc\u30b8\u306eSSR\u3092\u884c\u3046\u65b9\u6cd5\u306b\u3064\u3044\u3066\u793a\u3057\u307e\u3057\u305f.\nAPI\u30d5\u30a1\u30fc\u30b9\u30c8\u3067\u958b\u767a\u3092\u9032\u3081,Web\u30da\u30fc\u30b8\u3092SSR\u3092\u5b9f\u73fe\u3057\u305fSPA\u3068\u3057\u3066\u63d0\u4f9b\u3059\u308b\u3053\u3068\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u6027\u306e\u5411\u4e0a\u3068SPA\u306e\u5f31\u3044SEO\u5bfe\u7b56\u7c21\u5358\u5316\u3084\u521d\u671f\u8868\u793a\u6642\u9593\u306e\u77ed\u7e2e,\u307e\u3063\u305f\u304f\u30da\u30fc\u30b8\u304c\u898b\u3048\u306a\u3044\u3068\u3044\u3046\u72b6\u614b\u306e\u56de\u907f\u306a\u3069\u5927\u304d\u306a\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059.\n\u4e00\u822c\u306b\u306fReact\u7b49\u3092\u7528\u3044\u3066\u3053\u306e\u3088\u3046\u306a\u7269\u306f\u4f5c\u6210\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304c,Vuejs\u3068\u3044\u3046\u5b66\u7fd2\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u884c\u3048\u308b\u306e\u306f\u30e1\u30ea\u30c3\u30c8\u3060\u3068\u601d\u3044\u307e\u3059. \n\n\u53c2\u8003\u30da\u30fc\u30b8\nVue.js \u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3000SSR\n\u516c\u5f0f\u304c\u65e5\u672c\u8a9e\u3067\u308f\u304b\u308a\u3084\u3059\u304f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059.\u3000\n\u7c21\u5358\u306a\u7269\u3060\u3063\u305f\u3089\u3053\u3053\u306e\u901a\u308a\nvue.js 2.0 \u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\n2016Node\u5b66\u5712\u796d\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30b9\u30e9\u30a4\u30c9\u3067\u3059.\nVue\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u3068\u304b\u306e\u304a\u8a71.\nSSR\u306e\u4ed5\u7d44\u307f\u3068\u304b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059.\nvue-hacker-news-2.0 \nSSR\u3092\u884c\u3046\u975e\u5e38\u306b\u5b9f\u8df5\u7684\u306a\u30b5\u30f3\u30d7\u30eb\u3067\u3059.\n\u4eca\u56de\u306e\u8a18\u4e8b\u306f\u3053\u308c\u306e\u8d85\u77ed\u7e2e\u7248\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059.\n\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u306fFirebase\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059.\n# Vue.js\u3067SSR\uff08\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\uff09\u3059\u308b\n\n\u306f\u3058\u3081\u306b\n\u3053\u306e\u8a18\u4e8b\u306f[\u306a\u306b\u304b\u306e Advent Calendar 2016](http://www.adventar.org/calendars/1896)\u306e23\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059.\n\n\nVue.js\u306f\uff12\u7cfb\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u305d\u3053\u305d\u3053\u305f\u3061\u307e\u3057\u305f.\n\u65e5\u672c\u8a9e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u305d\u308d\u3063\u3066\u3044\u307e\u3059. \u30d5\u30ed\u30f3\u30c8\u306e\u53d6\u308a\u304b\u304b\u308a\u3068\u3057\u3066\u7c21\u5358\u3067\u30b9\u30b1\u30fc\u30eb\u3082\u3057\u3084\u3059\u304f\u826f\u3044\u306e\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b.\n\n\u305d\u3053\u3067\u4eca\u56de\u306fVue.js\uff12\u7cfb\u306e\u5927\u304d\u306a\u7279\u5fb4\u3067\u3042\u308b\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u884c\u3063\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5236\u4f5c\u3092\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059.\n\n\u6700\u7d42\u7684\u306b\n\n* API\u30b3\u30fc\u30eb\u3092\u3057\u3066\u52d5\u7684\u30da\u30fc\u30b8\u306eSSR\u3092\u884c\u3046\n* \u521d\u671f\u8868\u793a\u4ee5\u5f8c\u306fSPA\u3068\u3057\u3066\u52d5\u304f\n\n\u3053\u3093\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u76ee\u6307\u3057\u307e\u3059.\n\n\u5b8c\u6210\u7248\u306f\u4ee5\u4e0b\u3067\u3059\n\n* [\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 Github](https://github.com/namazu510/vue-ssr-sample)\n\n# \u4f7f\u3046\u7269\nvuejs vue-router vuex\n\u3053\u306e\u3042\u305f\u308a\u3092\u4f7f\u3044\u307e\u3059.\n\u8a73\u3057\u304f\u306f\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306epackage.json\u3092...\n\n\n# Step1\u3000\u9759\u7684\u30da\u30fc\u30b8\u306eSSR\n\u3055\u3041\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059.\n\u307e\u305a\u7b2c\u4e00\u306b\u9759\u7684\u30da\u30fc\u30b8(API\u30b3\u30fc\u30eb\u3067\u30c7\u30fc\u30bf\u3092\u66f8\u3044\u305f\u308a\u3057\u306a\u3044\uff09\u30da\u30fc\u30b8\u3092SSR\u3067\u8868\u793a\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059.\nvuejs\u3068vue-router,\u4f55\u3082\u8a2d\u5b9a\u3057\u306a\u3044vuex\u3067\u30da\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059.\n\n## \u30da\u30fc\u30b8\u4f5c\u6210\n\u9069\u5f53\u306a\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8fbc\u307f\u306e\u30da\u30fc\u30b8\u3092\u4f5c\u308a\u307e\u3059.\n\u4eca\u56de\u306fApp\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u30eb\u30fc\u30c8\u3068\u3057router-view\u3092\u5b50\u306b\u4e0e\u3048\n\n* /counter \u3067\u3000Counter\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\uff08\u3088\u304f\u3042\u308b\u30ab\u30a6\u30f3\u30bf) \n* /weather \u3067\u3000Weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3000\uff08\u6700\u7d42\u7684\u306bAPI\u30b3\u30fc\u30eb\u3067\u5929\u6c17\u3092\u8868\u793a)\n\n\u3053\u306e2\u3064\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u30d1\u30b9\u306b\u5fdc\u3058\u3066\u914d\u7f6e\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059.\n\n\u305d\u308c\u3067\u306f\u307e\u305avue\u30d5\u30a1\u30a4\u30eb\u3068\u30a8\u30f3\u30c8\u30ea\u30b9\u30af\u30ea\u30d7\u30c8\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3001webpack\u306e\u57fa\u672c\u8a2d\u5b9a\u7b49\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059.\n\n**\u5c1a,\u8a2d\u5b9a\u7b49\u306f\u6975\u529b\u7c21\u7565\u5316\u3092\u3057\u3066\u3044\u307e\u3059. \u5b9f\u969b\u306b\u4f7f\u3046\u306b\u306f\u3053\u308c\u3067\u306f\u529b\u4e0d\u8db3\u306a\u306e\u3067\u53c2\u8003\u30da\u30fc\u30b8\u306e[vue-hacker-news](https://github.com/vuejs/vue-hackernews-2.0)\u3000\u306e\u8a2d\u5b9a\u3092\u30b3\u30d4\u3063\u3066\u81ea\u5206\u306b\u5408\u3046\u3088\u3046\u306b\u5909\u3048\u305f\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059. \u4eca\u56de\u793a\u3059\u8a2d\u5b9a\u306f\u53c2\u8003\u30b5\u30a4\u30c8\u306e\u8a2d\u5b9a\u3092\u5143\u306b\u524a\u3063\u305f\u7269\u3067\u3059**\u3000\n\n### \u30da\u30fc\u30b8\n```js:src/App.vue\n<template>\n  <div id=\"app\">\n    <nav>\n      <ul>\n        <li><router-link to=\"/counter\">Counter</router-link></li>\n        <li><router-link to=\"/weather\">Weather</router-link></li>\n      </ul>\n    </nav>\n    <router-view></router-view>\n  </div>\n</template>\n<script>\nexport default {\n  name: 'app'\n}\n</script>\n```\n\u30c8\u30c3\u30d7\u30ec\u30d9\u30eb\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059.\n\u5185\u90e8\u306brouter-view\u3092\u7528\u610f\u3057\u30d1\u30b9\u306b\u5fdc\u3058\u3066\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u914d\u7f6e\u3057\u307e\u3059.\n\n\n```js:src/views/Counter.vue\n<template>\n    <div id=\"counter\">\n      <h1> Counter Comp </h1>\n      <p> {{ cnt }}.sec </p>\n    </div>\n</template>\n<script>\nexport default {\n  name: 'counter',\n  data () {\n    return {\n      cnt: 0\n    }\n  },\n  beforeMount () {\n    // \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u8d70\u3089\u305b\u308b\u51e6\u7406\u306f\u9069\u5f53\u306a\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30e1\u30bd\u30c3\u30c9\u3067\u8a2d\u5b9a.\n    // \u6ce8\u610f: \u3053\u306e\u95a2\u6570\u3068\u307e\u308a\u307e\u305b\u3093(\u00b4\u30fb\u03c9\u30fb\uff40)\n    setInterval(() => {\n      this.cnt++\n    }, 1000)\n  }\n}\n</script>\n```\n\u30ab\u30a6\u30f3\u30bf\u30fc\u3067\u3059. \uff11\u79d2\u5f8c\u306b\u8868\u793a\u3055\u308c\u308b\u6570\u5024\u304c\u5897\u3048\u307e\u3059.\n\n```js:src/views/Weather.vue\n<template>\n  <div id=\"weather\">\n    <h1> WeatherComp </h1>\n  </div>\n</template>\n```\n\u305d\u306e\u3046\u3061API\u30b3\u30fc\u30eb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u304c,\u73fe\u72b6\u306f\u305f\u3060\u306e\u9759\u7684\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u306b\u3057\u307e\u3059.\n\n### router\u8a2d\u5b9a\n```js:src/router/index.js\nimport Vue from 'vue'\nimport Router from 'vue-router'\n\nVue.use(Router)\n\nimport Counter from '../views/Counter.vue'\nimport Weather from '../views/Weather.vue'\nexport default new Router({\n  mode: 'history',\n  routes: [\n    {\n      path: '/counter',\n      component: Counter\n    },\n    {\n      path: '/weather',\n      component: Weather\n    },\n    {\n      path: '/',\n      redirect: '/counter'\n    }\n  ]\n})\n```\n\u30d1\u30b9\u5272\u308a\u5f53\u3066\u3092\u3057\u307e\u3059.\n\n### vuex\u521d\u671f\u8a2d\u5b9a\n```js:src/store/index.js\nimport Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex)\n\nconst store = new Vuex.Store({\n  state: {\n  },\n  actions: {\n  },\n  mutations: {\n  },\n  getters: {\n  }\n})\n\nexport default store\n```\n\u73fe\u6bb5\u968e\u3067\u306f\u7a7a\u3063\u307d\u3067\u3059.\n\n### \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30a8\u30f3\u30c8\u30ea\n```js:src/app.js\nimport Vue from 'vue'\nimport App from './App.vue'\nimport store from './store'\nimport router from './router'\nimport { sync } from 'vuex-router-sync'\n\n// router\u3068store\u3092\u540c\u671f\u3055\u305b\u308b\u51e6\u7406\u3067\u3059\n// \u30da\u30fc\u30b8\u9077\u79fb\u3059\u308b\u3068mutation\u304c\u8d70\u3063\u305f\u308a\u3057\u3066\u304f\u308c\u3066store\u306e\u4e2d\u306brouter\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u7b49\u304c\u5165\u308b\u4fbf\u5229\u306a\u5974\u3067\u3059.\nsync(store, router)\n\nconst app = new Vue({\n  router,\n  store,\n  ...App\n})\n\nexport { app, router, store }\n```\nVue\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3067\u3059.\n\u666e\u901a\u306a\u3089\u3053\u3053\u3067\u30de\u30a6\u30f3\u30c8\u307e\u3067\u884c\u3044\u307e\u3059\u304c,\u4eca\u56de\u306fSSR\u3092\u884c\u3046\u306e\u3067\u30de\u30a6\u30f3\u30c8\u306f\u3053\u3053\u3067\u306f\u884c\u3044\u307e\u305b\u3093. \u5f8c\u8ff0\u306eclient-entry.js\u3067\u30de\u30a6\u30f3\u30c8\u3092\u3057\u307e\u3059.\n\n## SSR\u7528\u306e\u8a2d\u5b9a\u3068\u5b9f\u884c\u30b3\u30fc\u30c9\nSSR\u3067\u304d\u308b\u3088\u3046\u306bwebpack\u306e\u8a2d\u5b9a\u3001\u53ca\u3073\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u307e\u3059.\nSSR\u3059\u308b\u306b\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u63d0\u4f9b\u3059\u308b\u3044\u3064\u3082\u306ewebpack\u306e\u51fa\u529b\u306b\u52a0\u3048\u3066\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u5b9f\u884c\u3059\u308b\u30d0\u30a4\u30ca\u30ea\u3082\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059.\n\n\u5177\u4f53\u7684\u306b\u306f\n\n* webpack\u306e\u8a2d\u5b9a\u3092\u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u5074\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u306f\u304d\u51fa\u3059\u51e6\u7406\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u306f\u304d\u51fa\u3059\u51e6\u7406\u306e\uff12\u3064\u306e\u8a2d\u5b9a\u3092\u4f5c\u308a\u307e\u3059.\n* webpack\u306e\u30a8\u30f3\u30c8\u30ea\u3068\u3057\u3066\u6307\u5b9a\u3059\u308b\u3082\u306e\u3092client\u5074\u3068server\u5074\u3067\u5206\u3051\u307e\u3059. client\u5074\u306fclient-entry.js server\u5074\u306fserve-entry.js\u3067\u3059\n\n\u5148\u306bwebpack\u306e\u8a2d\u5b9a\u3092\u793a\u3057\u307e\u3059.\n\n```js:build/webpack.base.conf.js\nconst path = require('path')\nconst webpack = require('webpack')\n\nmodule.exports = {\n  devtool: '#source-map',\n  entry: {\n    app: './src/client-entry.js',\n    vendor: [\n      'es6-promise',\n      'vue',\n      'vue-router',\n      'vuex',\n      'vuex-router-sync'\n    ]\n  },\n  output: {\n    path: path.resolve(__dirname, '../dist'),\n    publicPath: '/dist/',\n    filename: '[name].[chunkhash].js'\n  },\n  resolve: {\n    alias: {\n      'public': path.resolve(__dirname, '../public')\n    }\n  },\n  module: {\n    noParse: /es6-promise\\.js$/, // avoid webpack shimming process\n    rules: [\n      {\n        test: /\\.vue$/,\n        loader: 'vue-loader'\n      },\n      {\n        test: /\\.js$/,\n        loader: 'babel-loader',\n        exclude: /node_modules/\n      }\n    ]\n  }\n}\n\n```\n\u57fa\u672c\u8a2d\u5b9a\u3067\u3059. \u3053\u308c\u3092\u53d7\u3051\u7d99\u304e\u3064\u3064\u30b5\u30fc\u30d0\u5074\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\uff12\u3064\u3092\u5410\u304f\u8a2d\u5b9a\u3092\u305d\u308c\u305e\u308c\u4f5c\u308a\u307e\u3059.\n\n```js:build/webpack.client.conf.js\nconst webpack = require('webpack')\nconst base = require('./webpack.base.config')\nconst HTMLPlugin = require('html-webpack-plugin')\n\nconst config = Object.assign({}, base, {\n  plugins: (base.plugins || []).concat([\n    // strip comments in Vue code\n    new webpack.DefinePlugin({\n      'process.env.VUE_ENV': '\"client\"'\n    }),\n    // extract vendor chunks for better caching\n    new webpack.optimize.CommonsChunkPlugin({\n      name: 'vendor'\n    }),\n    // generate output HTML\n    new HTMLPlugin({\n      template: 'src/index.template.html'\n    })\n  ])\n})\n\nmodule.exports = config\n\n```\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u3059.\n\n\n```js:build/webpack.server.conf.js\nconst webpack = require('webpack')\nconst base = require('./webpack.base.config')\n\nmodule.exports = Object.assign({}, base, {\n  target: 'node',\n  devtool: false,\n  entry: './src/server-entry.js',\n  output: Object.assign({}, base.output, {\n    filename: 'server-bundle.js',\n    libraryTarget: 'commonjs2'\n  }),\n  externals: Object.keys(require('../package.json').dependencies),\n  plugins: [\n    new webpack.DefinePlugin({\n      'process.env.VUE_ENV': '\"server\"'\n    })\n  ]\n})\n```\n\u30b5\u30fc\u30d0\u5074\u3067\u3059\u3000base\u3067\u8a2d\u5b9a\u3055\u308c\u305fentry\u3092\u4e0a\u66f8\u304d\u3057\u3066server-entry.js\u306b\u3057\u307e\u3059.\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u4f7f\u308f\u308c\u308b\u91cd\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u306f\u4ee5\u4e0b\u3067\u3059\n\n```js:src/client-entry.js\nimport 'es6-promise/auto'\nimport { app, store } from './app'\n\n// window.__INITIAL_STATE__\u306b\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u306estate\u304c\u5165\u3063\u3066\u308b\n// \u30b5\u30fc\u30d0\u304b\u3089\u6e21\u3055\u308c\u305fState\u306bstore\u306e\u72b6\u614b\u3092\u8a2d\u5b9a\u3059\u308b\nstore.replaceState(window.__INITIAL_STATE__)\n\n// actually mount to DOM\napp.$mount('#app')\n\n```\n\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306fclient\u5074\u3067\u5b9f\u884c\u3055\u308c\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3067\n1. \u30b5\u30fc\u30d0\u30fc\u304b\u3089window\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u3064\u3051\u3089\u308c\u305fINITIAL_STATE\u3092store\u306estate\u306b\u8a2d\u5b9a\n2. vue\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30de\u30a6\u30f3\u30c8\n\u3053\u308c\u3089\u3092\u884c\u3044\u307e\u3059.\n\n\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6642\u306b\u3082state\u304c\u66f4\u65b0\u3055\u308c\u305f\u308a\u3057\u307e\u3059,\u305d\u306estate\u3092\u30da\u30fc\u30b8\u3092\u30b5\u30fc\u30d6\u3059\u308b\u969b\u306b\u6dfb\u4ed8\u3057\u3066\u304a\u304d\u305d\u308c\u3092\u5143\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306estate\u306b\u53d7\u3051\u6e21\u3057\u307e\u3059. \u3053\u3046\u3059\u308b\u3053\u3068\u3067\u30b5\u30fc\u30d0\u30fc\u5074\u306estate\u3092\u53d7\u3051\u3064\u3044\u3066\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u30da\u30fc\u30b8\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u307e\u3059. \n\n\u3053\u306estate\u306e\u53d7\u3051\u6e21\u3057\u304c\u3042\u308b\u4ee5\u5916\u306f\u57fa\u672c\u7684\u306avue\u306e\u521d\u671f\u8a2d\u5b9a\u3068\u540c\u3058\u3060\u3068\u601d\u3044\u307e\u3059.\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306f\u4ee5\u4e0a\u3067\u3059.\n\n\n**\u30b5\u30fc\u30d0\u30fc\u5074\u306f\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u3068\u3044\u3046\u3068...**\nserer-entry.js\u3068express\u306e\u8a2d\u5b9a\u3068SSR\u3092\u884c\u3044\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u7d50\u679c\u3092\u66f8\u304d\u51fa\u3059\u51e6\u7406(server.js)\u304c\u3042\u308a\u307e\u3059.\n2\u3064\u3081\u306eserver.js\u306f\u5b9f\u969b\u306bexpress\u3092\u7acb\u3061\u4e0a\u3052\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u3057\u7d50\u679c\u3092\u8fd4\u3059\u51e6\u7406\u304c\u66f8\u304b\u308c\u3066\u3044\u307e\u3059.\nexpress\u306e\u8a2d\u5b9a\u306fVue.js\u306e\u516c\u5f0f\u306eSSR\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u66f8\u3044\u3066\u3044\u304f\u3068\u3044\u3044\u3068\u601d\u3044\u307e\u3059.\n\n```js:src/server-entry.js\nimport { app, router, store} from './app'\n\nexport default context => {\n  // set router's location\n  router.push(context.url)\n  const matchedComponents = router.getMatchedComponents()\n\n  // no matched routes\n  if (!matchedComponents.length) {\n    return Promise.reject({ code: '404' })\n  }\n  context.initialState = store.state\n  return app\n}\n\n```\n\n```js:server.js\nprocess.env.VUE_ENV = 'server'\n\nconst fs = require('fs')\nconst path = require('path')\nconst express = require('express')\nconst compression = require('compression')\nconst serialize = require('serialize-javascript')\nconst resolve = file => path.resolve(__dirname, file)\n\nconst app = express()\n\nconst indexHTML = parseIndex(fs.readFileSync(resolve('./dist/index.html'), 'utf-8'))\nconst renderer = createRenderer(fs.readFileSync(resolve('./dist/server-bundle.js'), 'utf-8'))\n\n\n\nfunction createRenderer (bundle) {\n  // https://github.com/vuejs/vue/blob/next/packages/vue-server-renderer/README.md#why-use-bundlerenderer\n  return require('vue-server-renderer').createBundleRenderer(bundle, {\n    cache: require('lru-cache')({\n      max: 1000,\n      maxAge: 1000 * 60 * 15\n    })\n  })\n}\n\nfunction parseIndex (template) {\n  const contentMarker = '<!-- APP -->'\n  const i = template.indexOf(contentMarker)\n  return {\n    head: template.slice(0, i),\n    tail: template.slice(i + contentMarker.length)\n  }\n}\n\nconst serve = (path, cache) => express.static(resolve(path), {\n  maxAge: cache && 60 * 60 * 24 * 30\n})\n\napp.use(compression({ threshold: 0 }))\napp.use('/dist', serve('./dist'))\n\napp.get('*', (req, res) => {\n  if (!renderer) {\n    return res.end('waiting for compilation... refresh in a moment.')\n  }\n\n  res.setHeader(\"Content-Type\", \"text/html\");\n\n  const context = { url: req.url }\n  const renderStream = renderer.renderToStream(context)\n\n  renderStream.once('data', () => {\n    res.write(indexHTML.head)\n  })\n\n  renderStream.on('data', chunk => {\n    res.write(chunk)\n  })\n\n  renderStream.on('end', () => {\n    // \u30b5\u30fc\u30d0\u30fc\u5074\u306estore\u3092client\u5074\u306b\u6d41\u3059.\n    // window\u306b__INITIAL_STATE__\u307f\u305f\u3044\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u306f\u3084\u3057\u3066\u304a\u3044\u3066\u305d\u3053\u306b\u5165\u308c\u3066\u304a\u304f\n    // client-entry\u3067\u3053\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067state\u3092\u7f6e\u304d\u63db\u3048\u308b.\n    if (context.initialState) {\n      res.write(\n        `<script>window.__INITIAL_STATE__=${\n          serialize(context.initialState, { isJSON: true })\n        }</script>`\n      )\n    }\n    res.end(indexHTML.tail)\n  })\n\n  // error\u51e6\u7406\n  renderStream.on('error', err => {\n    if (err && err.code === '404') {\n      res.status(404).end('404 | Page Not Found')\n      return\n    }\n    // Render Error Page or Redirect\n    res.status(500).end('Internal Error 500')\n    console.error(`error during render : ${req.url}`)\n    console.error(err)\n  })\n})\n\nconst port = 8080\napp.listen(port, () => {\n  console.log(`server started at localhost:${port}`)\n})\n\n```\n\n## \u5b9f\u884c\n\u3053\u3053\u307e\u3067\u3084\u308b\u3068\u9759\u7684\u30da\u30fc\u30b8\u3092SSR\u3057\u3066\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059.\n\u5c1a,\u3053\u3053\u307e\u3067\u306e\u30b3\u30fc\u30c9\u306f[Step1 code (Github)](https://github.com/namazu510/vue-ssr-sample/tree/c6730bedffc09b046869037cc8033d1ab4104d76) \u306b\u3042\u308a\u307e\u3059.\n\u5b9f\u969b\u306b\u5b9f\u884c\u3057\u305f\u753b\u9762\u3067\u3059\u3002\n![Counter](https://gyazo.com/92de56e3ccbe92d7fdf6938819f9a7ec.png)\nhttp://localhost:8080/counter\n\u30ab\u30a6\u30f3\u30bf\u30fc\u3067\u3059. 1\u79d2\u3054\u3068\u306b\u6570\u5024\u304c\u5897\u3048\u307e\u3059.\n\n![Weather](https://gyazo.com/1860f75300077bd4a0f7283552cb1953.png)\nhttp://localhost:8080/weather\n\n![Counter-source](https://gyazo.com/ecb5972bf1966881f35cf0708e49c847.png)\n\u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u30bd\u30fc\u30b9\u3092\u898b\u305f\u5834\u5408\u3067\u3059. \u3061\u3083\u3093\u3068\u30b5\u30fc\u30d0\u5074\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3055\u308c\u3066DIV\u306e\u4e2d\u8eab\u304c\u7a7a\u3063\u307d\u3058\u3083\u306a\u304f\u5e30\u3063\u3066\u304d\u307e\u3059.\n\n**\u7c21\u5358\u306a\u30da\u30fc\u30b8\u3067\u3059\u304cvuejs\u3092\u7528\u3044\u3066SSR\u304c\u3067\u304d\u307e\u3057\u305f\uff01\u3000\u3053\u308c\u3067SEO\u5bfe\u7b56\u3082\u7c21\u5358\uff1f\u3067\u3059\u306d**\nStep1\u306f\u3053\u308c\u3067\u304a\u3057\u307e\u3044\u3067\u3059.\n\n# Step2\u3000\u52d5\u7684\u30da\u30fc\u30b8\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\nAPI\u30b3\u30fc\u30eb\u3092\u884c\u3044\u52d5\u7684\u306a\u30da\u30fc\u30b8\u3092\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u3066\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3059.\n\u4eca\u4f55\u3082\u306a\u3044weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092API\u30b3\u30fc\u30eb\u3092\u884c\u3044\u5e30\u3063\u3066\u304d\u305f\u30c7\u30fc\u30bf\u3092\u5143\u306b\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u8fd4\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059.\n\nAPI\u306f\u9069\u5f53\u306b\u898b\u3064\u3051\u305f[\u304a\u5929\u6c17API](http://weather.livedoor.com/weather_hacks/webservice)\u306b\u304a\u4e16\u8a71\u306b\u306a\u308d\u3046\u3068\u601d\u3044\u307e\u3059.\n\n\u305d\u308c\u3067\u306fStep1\u306e\u30b3\u30fc\u30c9\u306b\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059.\n\u4f55\u3092\u3059\u308b\u304b\u3068\u3044\u3046\u3068,\u307e\u305a\u7b2c\u4e00\u306b\u30b5\u30fc\u30d0\u30fc\u3067\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6642\u306bcomponent\u306b\u7d10\u4ed8\u3051\u3089\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059.\npreFetch\u30e1\u30bd\u30c3\u30c9\u3068\u3044\u3046store\u3092\u5f15\u6570\u306b\u3082\u3064\u30e1\u30bd\u30c3\u30c9\u3092component\u306b\u5b9f\u88c5\u3057,\u3053\u306e\u4e2d\u3067API\u30b3\u30fc\u30eb\u3092\u5b9f\u884c\u3059\u308baction\u3092\u8d77\u3053\u3057,mutation\u3092\u547c\u3073\u307e\u3059. \nmutation\u306b\u3088\u308astate\u306f\u5909\u66f4\u3055\u308c\u307e\u3059. prefetch\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u884c\u304c\u7d42\u308f\u3063\u305f\u6642\u70b9\u3067\uff08promise\u304c\u5168\u90e8\u5e30\u3063\u3066\u304d\u305f\u3089\uff09\u5b9f\u969b\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306b\u5165\u308a\u307e\u3059.\n\n\u5177\u4f53\u7684\u306b\u306f\u307e\u305a\nserver-entry.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059.\n\n```js:src/server-entry.js\nimport { app, router, store} from './app'\n\nexport default context => {\n  // set router's location\n  router.push(context.url)\n  const matchedComponents = router.getMatchedComponents()\n\n  // no matched routes\n  if (!matchedComponents.length) {\n    return Promise.reject({ code: '404' })\n  }\n  // preFetch\u30e1\u30bd\u30c3\u30c9\u3092\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u547c\u3093\u3067action\u306e\u5b9f\u884c\u3084mutation\u3092\u3055\u305b\u308b\n  // state\u306bSSR\u6642\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u5165\u308c\u308b.\n  return Promise.all(matchedComponents.map(component => {\n    if (component.preFetch) {\n      return component.preFetch(store)\n    }\n  })).then(() => {\n    context.initialState = store.state\n    return app\n  })\n\n  return app\n}\n\n```\n\u3053\u306e\u3088\u3046\u306b\u3057\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3059\u3079\u304d\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306epreFetch\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3055\u305b\u307e\u3059.\n\u307e\u305fwether.vue\u306bpreFetch\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3057\u307e\u3059.\nwether.vue\u3067\u306fshowWeather\u3068\u3044\u3046action\u3092\u767a\u884c\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059.\n\u6c17\u304c\u65e9\u3044\u3067\u3059\u304cwether.vue\u306bstate\u306e\u30c7\u30fc\u30bf\u3092\u8868\u793a\u3059\u308b\u30b3\u30fc\u30c9\u3082\u66f8\u3044\u3066\u3057\u307e\u3057\u307e\u3057\u3087\u3046\n\n```js:src/views/Weather.vue\n<template>\n  <div id=\"weather\">\n    <h1> WeatherComp </h1>\n    <p> {{weather.title}} </p>\n    <p> {{weather.state}} </p>\n  </div>\n</template>\n<script>\nexport default {\n  name: 'weather',\n\n  preFetch(store) {\n    store.dispatch('SHOW_WEATHER')\n  },\n  beforeMount() {\n    this.$store.dispatch('SHOW_WEATHER')\n  },\n\n  computed: {\n    weather () {\n      return this.$store.state.weather\n    }\n  }\n}\n</script>\n```\npreFetch\u3067SSR\u6642\u306e\u51e6\u7406\u306f\u51fa\u6765\u307e\u3059\u304c,\u4e00\u5ea6\u8868\u793a\u3055\u308c\u305f\u5f8c\u30da\u30fc\u30b8\u9077\u79fb\u3067\u3053\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u51fa\u3055\u308c\u305f\u3068\u304d\u7b49\u306f\u5bfe\u5fdc\u3067\u304d\u307e\u305b\u3093,\u305d\u3053\u3067beforeMount\u306b\u3082\u540c\u3058\u51e6\u7406\u3092\u547c\u3070\u305b\u307e\u3059. SHOW_WEATHER\u30a2\u30af\u30b7\u30e7\u30f3\u3067\u306fstate\u306b\u65e2\u306b\u5929\u6c17\u306e\u60c5\u5831\u304c\u3042\u308b\u304b\u78ba\u8a8d\u3057\u3001\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306e\u307fFETCH_WEATHER\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u51e6\u7406\u3092\u59d4\u8b72\u3057\u305d\u306e\u306a\u304b\u3067API\u30b3\u30fc\u30eb\u3092\u3057\u3066\u3082\u3089\u3044\u307e\u3059.\n\u3053\u308c\u3067wether.vue\u306f\u5b8c\u6210\u3067\u3059.\n\n**vuex\u306e\u65b9\u3092\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059**\n\u307e\u305astate\u306b\u5929\u6c17\u60c5\u5831(weather)\u3092\u6301\u305f\u305b\u307e\u3059. \u4eca\u56de\u306f\u5929\u6c17\u3060\u3051\u8868\u793a\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059.\n\n* title\u304c\u25cb\u25cb\u306e\u5929\u6c17\u306e\u3088\u3046\u306a\u6587\u5b57\u5217\n* state\u304c\u5929\u6c17\uff08\u6674\u308c\u3068\u304b\uff09\u3067\u3059.\n\n\u307e\u305fAction showWeather\u3068\u5b9f\u969b\u306bapi\u30b3\u30fc\u30eb\u3092\u3059\u308bAction fetchWeather\u3092\u5b9f\u88c5\u3057,mutation\u3082\u66f8\u304d\u307e\u3059.\n\n```js:src/store/index.js\nimport Vue from 'vue'\nimport Vuex from 'vuex'\nimport {fetchWeather} from './api'\n\nVue.use(Vuex)\n\nconst store = new Vuex.Store({\n  state: {\n    weather: {\n      title: '',\n      state: ''\n    }\n  },\n\n  actions: {\n    SHOW_WEATHER: ({state, dispatch}) => {\n      // Promise\u3092\u8fd4\u3059\u306e\u3092\u5fd8\u308c\u306a\u3044\uff01\uff01\n      if (state.weather.title.length !== 0) {\n        return Promise.resolve()\n      }\n      return dispatch('FETCH_WEATHER')\n    },\n    FETCH_WEATHER: ({commit}) => {\n      return fetchWeather()\n        .then((weather) => {\n          commit('SET_WEATHER', weather)\n        })\n    }\n  },\n\n  mutations: {\n    SET_WEATHER: (state, weather) => {\n      state.weather = weather\n    }\n  },\n\n  getters: {\n  }\n})\n\nexport default store\n```\n\n\nstore\u304b\u3089\u547c\u3093\u3067\u3044\u308bapi\u306e\u51e6\u7406fetchInformation\u81ea\u4f53\u306f\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u62bd\u51fa\u3057\u307e\u3059. \n\n**api\u306e\u51e6\u7406\u306b\u304a\u3044\u3066\u91cd\u8981\u306a\u70b9\u304c\u3042\u308a\u307e\u3059**, \u305d\u308c\u306f\n\n* \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067API\u3092\u53e9\u304f\u5834\u5408\n* \u30b5\u30fc\u30d0\u5074\u3067API\u3092\u53e9\u304f\u5834\u5408\n\n\u3053\u306e\uff12\u3064\u304c\u3042\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059,\u3000\u30b5\u30fc\u30d0\u5074\u3067\u6bce\u56de\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306e\u969b\u306bAPI\u3092\u53e9\u3044\u3066\u3044\u3066\u306f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u60aa\u3067\u3059\u306e\u3067\u5fdc\u7b54\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u3042\u308b\u5834\u5408\u306f\u554f\u3044\u5408\u308f\u305b\u3092\u884c\u308f\u306a\u3044\u3088\u3046\u306b\u3057\u307e\u3059.\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3067\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u306f\u884c\u3044\u307e\u305b\u3093.\n\n\u3053\u306e\u51e6\u7406\u5206\u3051\u3092\u52b9\u679c\u7684\u306b\u5b9f\u73fe\u3059\u308b\u305f\u3081create-api-client.js\u3068create-api-server.js\u306e\uff12\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057,webpack\u306e\u6a5f\u80fd\u3092\u7528\u3044\u3066create-api.js\u3068\u3044\u3046\u540d\u524d\u3067,client\u5074\u3067\u306fcreate-api-client.js\u304cserver\u5074\u3067\u306fcreate-api-server.js\u304c\u547c\u3079\u308b\u3088\u3046\u306b\u3057\u307e\u3059.\n\n**webpack\u306b\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059**\n\n```js:build/webpack.client.config.js\n  resolve: {\n    alias: Object.assign({}, base.resolve.alias, {\n      // api\u3067\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092server\u5074\u3068client\u5074\u3067\u5207\u308a\u5206\u3051\u308b\n      'create-api': './create-api-client.js'\n    })\n  },\n```\n\n```js:build/webpack.server.config.js\n  resolve: {\n    alias: Object.assign({}, base.resolve.alias, {\n      // api\u3067\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092server\u5074\u3068client\u5074\u3067\u5207\u308a\u5206\u3051\u308b\n      'create-api': './create-api-server.js'\n    })\n  },\n```\n\n**create-api-client.js\u53ca\u3073ceate-api-server.js\u3092\u4f5c\u308a\u307e\u3059**\n\n```js:src/store/create-api-client.js\nimport axios from 'axios'\n\nconst api = {}\nconst axiosDefault = axios.create()\n\nexport {\n  api,\n  axiosDefault\n}\n\n```\n\n```js:src/store/create-api-server.js\nimport LRU from 'lru-cache'\nimport axios from 'axios'\n\nlet api\n\nif (process.__API__) {\n  api = process.__API__\n} else {\n  api = {}\n\n  // SSR\u306e\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u30c7\u30fc\u30bf\u30ad\u30e3\u30c3\u30b7\u30e5\n  api.cachedItems = LRU({\n    max: 10000,\n    maxAge: 1000 * 60 * 15 // 15 min cache\n  })\n  process.__API__ = api\n}\n\nconst axiosDefault = axios.create()\n\nexport {\n  api,\n  axiosDefault\n}\n\n```\n\n\u4e2d\u3067\u306f(\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u307f\uff09\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u7528\u610f\u3068Ajax\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u521d\u671f\u8a2d\u5b9a\u3092\u3057\u307e\u3059. Ajax\u3067\u3059\u304c\u4eca\u56de\u306faxios\u3092\u7528\u3044\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u98db\u3070\u3057\u307e\u3059.Ajax\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u306e\u306f\u597d\u304d\u306a\u7269\u3092\u4f7f\u3048\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u304c,promise\u3092\u8fd4\u3059\u3088\u3046\u306b\u4f5c\u3063\u3066\u3044\u304f\u5fc5\u8981\u304c\u3042\u308b\u306e\u3067promise\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5e30\u3063\u3066\u304f\u308b\u7269\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059.\n\n**api.js\u3092\u4f5c\u308aAPI\u30b3\u30fc\u30eb\u3092\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059**\n\n```js:src/store/api.js\nimport {api, axiosDefault as axios} from 'create-api'\n\nexport function fetchWeather() {\n  const CACHE_KEY = 'WEATHER'\n\n  // TOKYO\n  const CITY_CODE = 130010\n  const API_URL = `http://weather.livedoor.com/forecast/webservice/json/v1?city=${CITY_CODE}`\n\n  // Cache\u30c1\u30a7\u30c3\u30af\n  const cache = api.cachedItems\n  if (cache && cache.has(CACHE_KEY)) {\n    return Promise.resolve(cache.get(CACHE_KEY))\n  }\n\n  return axios.get(API_URL)\n    .then(response => {\n      return response.data\n    }).then(json => {\n      // \u4eca\u65e5\u306e\u5929\u6c17\u3060\u3051\u51fa\u3059.\n      return {\n        title: json.title,\n        state: json.forecasts[0].telop\n      }\n    }).then(weather => {\n      // \u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u5165\u308c\u308b.\n      cache && cache.set(CACHE_KEY, weather)\n      return weather\n    })\n\n}\n\n```\n\n\u3053\u308c\u3067API\u30b3\u30fc\u30eb\u3092\u884c\u3046\u52d5\u7684\u30da\u30fc\u30b8\u304c\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059.\n\n## \u5b9f\u884c\n\u5b8c\u6210\u3057\u307e\u3057\u305f. \u5b9f\u884c\u3059\u308b\u3068weather\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u304c\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\n![weather](https://gyazo.com/f2dafe9d461290bf5b076b11b5dac489.png)\n![weather-html](https://gyazo.com/72194eb3a5a574a3f64bd51ba1ef0154.png)\nAPI\u30b3\u30fc\u30eb\u306e\u7d50\u679c\u304cHTML\u3067\u98db\u3093\u3067\u304d\u307e\u3059. \n\n\n\uff08\u5c1aAPI\u3061\u3083\u3093\u3068\u898b\u3066\u3044\u306a\u304b\u3063\u305f\u305b\u3044\u3067CORS\u306eAllow\u30d8\u30c3\u30c0\u304c\u7740\u3044\u3066\u3044\u306a\u3044\u3053\u3068\u306b\u5b8c\u6210\u3057\u3066\u304b\u3089\u6c17\u3065\u304d\u30d6\u30e9\u30a6\u30b6\u5074\u304b\u3089API\u30b3\u30fc\u30eb\u3057\u305f\u7d50\u679c\u304c\u53d7\u3051\u53d6\u308c\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u3000\u6b21\u306f\u3061\u3083\u3093\u3068\u53d6\u308c\u308bAPI\u3092\u9078\u629e\u3057\u307e\u3059...)\n\n# \u91cd\u8981\u70b9\n* preFetch\u30e1\u30bd\u30c3\u30c9\u3067\u306f\u547c\u3073\u51fa\u3057\u5143\u3067promise\u3092\u5f85\u3063\u3066\u3044\u308b\u305f\u3081,\u30c1\u30a7\u30fc\u30f3\u3092\u5207\u3089\u3055\u306a\u3044\u3088\u3046\u306b\u7e4b\u3050\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059. \u5fd8\u308c\u3066\u30c1\u30a7\u30fc\u30f3\u3092\u5207\u3063\u3066\u3057\u307e\u3046\u3068\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u51fa\u529b\u5f8c\u306bAPI\u306e\u5fdc\u7b54\u304c\u5e30\u3063\u3066\u304f\u308b\u306a\u3093\u3066\u60b2\u3057\u3044\u3053\u3068\u306b\u306a\u308a\u307e\u3059. \u6c17\u3092\u3064\u3051\u307e\u3057\u3087\u3046. \u79c1\u306f\u4f55\u5ea6\u3082\u5d4c\u307e\u308a\u307e\u3057\u305f.\n\n# \u304a\u308f\u308a\u306b\n\u4eca\u56de\u306fVuejs\u3092\u5229\u7528\u3057\u52d5\u7684\u306a\u30da\u30fc\u30b8\u306eSSR\u3092\u884c\u3046\u65b9\u6cd5\u306b\u3064\u3044\u3066\u793a\u3057\u307e\u3057\u305f.\nAPI\u30d5\u30a1\u30fc\u30b9\u30c8\u3067\u958b\u767a\u3092\u9032\u3081,Web\u30da\u30fc\u30b8\u3092SSR\u3092\u5b9f\u73fe\u3057\u305fSPA\u3068\u3057\u3066\u63d0\u4f9b\u3059\u308b\u3053\u3068\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u6027\u306e\u5411\u4e0a\u3068SPA\u306e\u5f31\u3044SEO\u5bfe\u7b56\u7c21\u5358\u5316\u3084\u521d\u671f\u8868\u793a\u6642\u9593\u306e\u77ed\u7e2e,\u307e\u3063\u305f\u304f\u30da\u30fc\u30b8\u304c\u898b\u3048\u306a\u3044\u3068\u3044\u3046\u72b6\u614b\u306e\u56de\u907f\u306a\u3069\u5927\u304d\u306a\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059.\n\u4e00\u822c\u306b\u306fReact\u7b49\u3092\u7528\u3044\u3066\u3053\u306e\u3088\u3046\u306a\u7269\u306f\u4f5c\u6210\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304c,Vuejs\u3068\u3044\u3046\u5b66\u7fd2\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u884c\u3048\u308b\u306e\u306f\u30e1\u30ea\u30c3\u30c8\u3060\u3068\u601d\u3044\u307e\u3059. \n\n\n\n# \u53c2\u8003\u30da\u30fc\u30b8\n[Vue.js \u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3000SSR](https://jp.vuejs.org/v2/guide/ssr.html)\n\u516c\u5f0f\u304c\u65e5\u672c\u8a9e\u3067\u308f\u304b\u308a\u3084\u3059\u304f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059.\u3000\n\u7c21\u5358\u306a\u7269\u3060\u3063\u305f\u3089\u3053\u3053\u306e\u901a\u308a\n\n[vue.js 2.0 \u30b5\u30fc\u30d0\u30fc\u30b5\u30a4\u30c9\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0](https://speakerdeck.com/kazupon/vue-dot-js-2-dot-0-server-side-rendering)\n2016Node\u5b66\u5712\u796d\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u30b9\u30e9\u30a4\u30c9\u3067\u3059.\nVue\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u30b7\u30b9\u30c6\u30e0\u3068\u304b\u306e\u304a\u8a71.\nSSR\u306e\u4ed5\u7d44\u307f\u3068\u304b\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059.\n\n[vue-hacker-news-2.0](https://github.com/vuejs/vue-hackernews-2.0) \nSSR\u3092\u884c\u3046\u975e\u5e38\u306b\u5b9f\u8df5\u7684\u306a\u30b5\u30f3\u30d7\u30eb\u3067\u3059.\n\u4eca\u56de\u306e\u8a18\u4e8b\u306f\u3053\u308c\u306e\u8d85\u77ed\u7e2e\u7248\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059.\n\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306b\u306fFirebase\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059.\n", "tags": ["vue.js", "JavaScript", "Vuex"]}