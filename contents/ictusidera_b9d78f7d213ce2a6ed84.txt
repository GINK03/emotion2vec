{"context": "\u30b5\u30fc\u30d0\u69cb\u7bc9\u5f8c\u3001\u78ba\u8a8d\u306e\u305f\u3081\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u30fb\u505c\u6b62\u3092\u3057\u3066\u3001\u305d\u306e\u6642\u306e\u30ed\u30b0\u3092\u5207\u308a\u51fa\u3057\u3066\u56de\u53ce\u3057\u305f\u304b\u3063\u305f\u306e\u3060\u3051\u3069\u3001\u3061\u3087\u3063\u3068\u306f\u307e\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\nrun()\u304c\u4e00\u5ea6\u547c\u3073\u51fa\u3055\u308c\u308b\u6bce\u306b\u7591\u4f3c\u7aef\u672b\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5358\u7d14\u306b\"[command] &\"\u306a\u3069\u306e\u65b9\u6cd5\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u305f\u3060\u3051\u3067\u306frun()\u3092\u629c\u3051\u305f\u3068\u304d\u306b\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u3066\u3057\u307e\u3046\u3002\n\"nohup\"\u3084\"disdown\"\u3067\u30c7\u30fc\u30e2\u30f3\u3068\u3057\u3066\u5b9f\u884c\u3055\u305b\u3066\u3001fabric\u306erun()\u304c\u7591\u4f3c\u7aef\u672b\u3092\u4f5c\u6210\u3057\u306a\u3044\u3088\u3046pty=False\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3057\u305f\u3002\n\u4ee5\u4e0b\u30b5\u30f3\u30d7\u30eb\u3002\n# \u5b9f\u884c\nfab test_tail_logfile -H localhost -u xxxxx -p xxxxx --port 2222\n\n\nfabfile.py\nfrom fabric.api import run, get, quiet\n\n\ndef kill_background_job(command):\n    with quiet():\n        run(u\"pkill -f '%s'\" % command)\n\n\ndef background_run(command, stdout):\n    run(u\"nohup %s > %s 2>&1 &\" % (command, stdout), pty=False)\n\n\ndef test_tail_logfile():\n    '''\n    \u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u30ed\u30b0\u3092tail\u3057\u3064\u3064\u307b\u304b\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3001\n    \u51e6\u7406\u7d42\u4e86\u5f8c\u306btail\u3092\u6b62\u3081\u3066\u30ed\u30b0\u3092\u56de\u53ce\u3059\u308b\u30b5\u30f3\u30d7\u30eb\n    '''\n    # \u30c6\u30b9\u30c8\u7528\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\n    run(u\"echo '**********************' > work.log\")\n\n    # \u30ed\u30b0\u306etail\u958b\u59cb\n    background_run(u\"tail -f work.log\", u\"out.log\")\n\n    # \u30ed\u30b0\u306b\u4f55\u304b\u66f8\u304d\u8fbc\u3093\u3067\u307f\u308b\n    run(\"echo 'piyo piyo' >> work.log\")\n    run(\"echo 'hoge' >> work.log\")\n\n    # tail\u3092\u6b62\u3081\u308b\n    kill_background_job(u\"tail -f work.log\")\n\n    # \u30ed\u30b0\u304c\u53d6\u308c\u3066\u308b\u304b\u78ba\u8a8d\n    run(u\"cat %s\" % u\"out.log\")\n    # \u30ed\u30b0\u3092\u56de\u53ce\n    get(r\"out.log\", u\".\\\\log\\\\out.log\")\n\n\n\n\n\u30b5\u30fc\u30d0\u69cb\u7bc9\u5f8c\u3001\u78ba\u8a8d\u306e\u305f\u3081\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8d77\u52d5\u30fb\u505c\u6b62\u3092\u3057\u3066\u3001\u305d\u306e\u6642\u306e\u30ed\u30b0\u3092\u5207\u308a\u51fa\u3057\u3066\u56de\u53ce\u3057\u305f\u304b\u3063\u305f\u306e\u3060\u3051\u3069\u3001\u3061\u3087\u3063\u3068\u306f\u307e\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\n\nrun()\u304c\u4e00\u5ea6\u547c\u3073\u51fa\u3055\u308c\u308b\u6bce\u306b\u7591\u4f3c\u7aef\u672b\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u5358\u7d14\u306b\"[command] &\"\u306a\u3069\u306e\u65b9\u6cd5\u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u305f\u3060\u3051\u3067\u306frun()\u3092\u629c\u3051\u305f\u3068\u304d\u306b\u30d7\u30ed\u30bb\u30b9\u304c\u7d42\u4e86\u3057\u3066\u3057\u307e\u3046\u3002\n\"nohup\"\u3084\"disdown\"\u3067\u30c7\u30fc\u30e2\u30f3\u3068\u3057\u3066\u5b9f\u884c\u3055\u305b\u3066\u3001fabric\u306erun()\u304c\u7591\u4f3c\u7aef\u672b\u3092\u4f5c\u6210\u3057\u306a\u3044\u3088\u3046pty=False\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3057\u305f\u3002\n\n\u4ee5\u4e0b\u30b5\u30f3\u30d7\u30eb\u3002\n\n```bash\n# \u5b9f\u884c\nfab test_tail_logfile -H localhost -u xxxxx -p xxxxx --port 2222\n```\n\n```python:fabfile.py\nfrom fabric.api import run, get, quiet\n\n\ndef kill_background_job(command):\n    with quiet():\n        run(u\"pkill -f '%s'\" % command)\n\n\ndef background_run(command, stdout):\n    run(u\"nohup %s > %s 2>&1 &\" % (command, stdout), pty=False)\n\n\ndef test_tail_logfile():\n    '''\n    \u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u30ed\u30b0\u3092tail\u3057\u3064\u3064\u307b\u304b\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3001\n    \u51e6\u7406\u7d42\u4e86\u5f8c\u306btail\u3092\u6b62\u3081\u3066\u30ed\u30b0\u3092\u56de\u53ce\u3059\u308b\u30b5\u30f3\u30d7\u30eb\n    '''\n    # \u30c6\u30b9\u30c8\u7528\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\n    run(u\"echo '**********************' > work.log\")\n\n    # \u30ed\u30b0\u306etail\u958b\u59cb\n    background_run(u\"tail -f work.log\", u\"out.log\")\n\n    # \u30ed\u30b0\u306b\u4f55\u304b\u66f8\u304d\u8fbc\u3093\u3067\u307f\u308b\n    run(\"echo 'piyo piyo' >> work.log\")\n    run(\"echo 'hoge' >> work.log\")\n\n    # tail\u3092\u6b62\u3081\u308b\n    kill_background_job(u\"tail -f work.log\")\n\n    # \u30ed\u30b0\u304c\u53d6\u308c\u3066\u308b\u304b\u78ba\u8a8d\n    run(u\"cat %s\" % u\"out.log\")\n    # \u30ed\u30b0\u3092\u56de\u53ce\n    get(r\"out.log\", u\".\\\\log\\\\out.log\")\n\n```\n\n", "tags": ["Python", "fabric"]}