{"context": " More than 1 year has passed since last update.\n\nalex/django-filter (doc)\n\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\n\u8907\u6570\u9078\u629e\u6307\u5b9a\u3067\u3042\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u691c\u7d22\u3059\u308b(\u30bf\u30b0\u3068\u304b)\n\u9078\u629e\u80a2\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089(ModelMultipleChoiceFilter)\n\u9078\u629e\u80a2\u304c\u591a\u3059\u304e\u308b\u306e\u3067\u3001\u3088\u304f\u4f7f\u308f\u308c\u308b\u9078\u629e\u652f\u3060\u3051\u3092\u6700\u521d\u3060\u3057\u3066\u3001\u300c\u3082\u3063\u3068\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u8ffd\u52a0\u306e\u9078\u629e\u80a2\u3092\u63d0\u793a\u3059\u308b\n\n\n\u691c\u7d22\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u306e\u9078\u629e\u652f\u3092\u4e8c\u3064\u306b\u5272\u308b\n\n\u30e1\u30b8\u30e3\u30fc\u306a\u9078\u629e\u80a2\u304c disp=1, \u305d\u308c\u4ee5\u5916\u306f disp=0\u306eDepartment\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u9078\u629e\u80a2\u3092\u5f15\u3044\u3066\u304f\u308b\n\nclass AlumnusFilter(django_filters.FilterSet):                                \n\n    depts = django_filters.ModelMultipleChoiceFilter(                               \n        queryset=models.Department.objects.filter(disp=1),                          \n        widget=forms.widgets.CheckboxSelectMultiple,                                \n    )                                                                               \n\n    depts_ex = django_filters.ModelMultipleChoiceFilter(                            \n        queryset=models.Department.objects.filter(disp=0),                          \n        widget=forms.widgets.CheckboxSelectMultiple,                                \n    )                                                                               \n\n    class Meta:\n      model = models.Alumnus\n\n\n\u30d5\u30a3\u30eb\u30bf\u30fc\u95a2\u6570\u3092\u6307\u5b9a\n\n\u95a2\u6570\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u30e2\u30c7\u30eb\u306eQuerySet\u306b\u30d5\u30a3\u30eb\u30bf\u30fc\u304b\u3051\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067__init__\u3067\u6307\u5b9a\u3059\u308b\ndepts, depts_ex \u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3068\u3057\u3066 filter_depts\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\nfilter_depts\u306b field \u5f15\u6570\u3092\u8ffd\u52a0\u3057\u3001 functools.partial\u3067\u3053\u308c\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\uff11\u3064\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u306b\u307e\u3068\u3081\u308b\nself.dept_items \u306brequest.GET\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u4e00\u89a7\u3059\u308b(\u6700\u5f8c\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u5224\u5b9a\u3059\u308b\u30d5\u30e9\u30b0)\nself.dept_values \u306f\u7a7a\u306elist\u3067\u521d\u671f\u5316\u3057\u3066\u304a\u304f\n\ndef __init__(self, data, *args, **kwargs):                                   \n    self.depts_items = {}                                                    \n    self.depts_values = []                                                   \n\n    for i in ['depts', 'depts_ex', ]:                                        \n        self.base_filters[i].filter = partial(self.filter_depts, field=i)    \n        if data.get(i, None):                                                \n            self.depts_items[i] = i                                          \n\n    super(AlumnusFilter, self).__init__(data, *args, **kwargs)         \n\n\n\u30d5\u30a3\u30eb\u30bf\u30fc\u95a2\u6570\n\nvalue\u304c\u6307\u5b9a\u3055\u308c\u305f\u3089\u3001 Department.code \u306e\u30ea\u30b9\u30c8\u306b\u5909\u63db\u3059\u308b\n\u30ea\u30b9\u30c8\u306f self.depts_values\u306b\u8caf\u3081\u308b\n\u5909\u63db\u3057\u305f\u3089\u81ea\u5206\u3092 self.depts_items\u304b\u3089\u629c\u304f\ndepts\u306b\u95a2\u3057\u3066\u51e6\u7406\u3059\u3079\u304d\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u6700\u5f8c\u3060\u3063\u305f\u3089\u3001queryset\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\u3002\u6700\u5f8c\u3067\u306a\u304b\u3063\u305f\u3089querset\u3092\u305d\u306e\u307e\u307e\u8fd4\u3059\u3002\ndepts\u3092\u5224\u5b9a\u3059\u308b\u30d5\u30a4\u30fc\u30eb\u30c9\u304c\uff13\u500b\u3042\u308b\u306e\u3067OR\u3067\u30af\u30a8\u30ea\u3092\u7d44\u307f\u7acb\u3066\u308b\n\ndef filter_depts(self, queryset, value, field=None):                         \n    if value:                                                                \n        del self.depts_items[field]                                          \n        self.depts_values += [i.code for i in value]                         \n\n    if not self.depts_items:                                                 \n        return queryset.filter(                                              \n            Q(dept_code_1__in=self.depts_values) |                      \n            Q(dept_code_2__in=self.depts_values) |                      \n            Q(dept_code_2__in=self.depts_values))                       \n\n    return queryset  \n\n\n\u8ffd\u52a0\u9078\u629e\u80a2\u306e\u8868\u793a/\u975e\u8868\u793a\u3092\u5207\u308a\u66ff\u3048\u308b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\n\nJavascript\u306eUI\u306e\u30c8\u30ea\u30ac\u30fc\u7528\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\n\u30af\u30a8\u30ea\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u30d5\u30a9\u30fc\u30e0\u3068\u3057\u3066\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u7528\u610f\u3059\u308b\n\u30e1\u30bf\u30af\u30e9\u30b9\u306e form \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u30d5\u30a9\u30fc\u30e0\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u3088\u3044\n\nclass Meta:                                                                  \n    form = type('BaseForm', (forms.Form,), dict(                             \n        depts_ex_on=forms.BooleanField(label=_('Dept Ex On'))                \n    ))\n\n\n- [alex/django-filter](https://github.com/alex/django-filter) ([doc](https://django-filter.readthedocs.org/en/latest/))\n\n## \u3084\u308a\u305f\u3044\u3053\u3068\n\n- \u8907\u6570\u9078\u629e\u6307\u5b9a\u3067\u3042\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u691c\u7d22\u3059\u308b(\u30bf\u30b0\u3068\u304b)\n- \u9078\u629e\u80a2\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089(ModelMultipleChoiceFilter)\n- \u9078\u629e\u80a2\u304c\u591a\u3059\u304e\u308b\u306e\u3067\u3001\u3088\u304f\u4f7f\u308f\u308c\u308b\u9078\u629e\u652f\u3060\u3051\u3092\u6700\u521d\u3060\u3057\u3066\u3001\u300c\u3082\u3063\u3068\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u3089\u8ffd\u52a0\u306e\u9078\u629e\u80a2\u3092\u63d0\u793a\u3059\u308b\n\n## \u691c\u7d22\u5bfe\u8c61\u30c6\u30fc\u30d6\u30eb\u306e\u9078\u629e\u652f\u3092\u4e8c\u3064\u306b\u5272\u308b\n\n- \u30e1\u30b8\u30e3\u30fc\u306a\u9078\u629e\u80a2\u304c disp=1, \u305d\u308c\u4ee5\u5916\u306f disp=0\u306eDepartment\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u9078\u629e\u80a2\u3092\u5f15\u3044\u3066\u304f\u308b\n\n~~~py\nclass AlumnusFilter(django_filters.FilterSet):                                \n\n    depts = django_filters.ModelMultipleChoiceFilter(                               \n        queryset=models.Department.objects.filter(disp=1),                          \n        widget=forms.widgets.CheckboxSelectMultiple,                                \n    )                                                                               \n\n    depts_ex = django_filters.ModelMultipleChoiceFilter(                            \n        queryset=models.Department.objects.filter(disp=0),                          \n        widget=forms.widgets.CheckboxSelectMultiple,                                \n    )                                                                               \n\n    class Meta:\n      model = models.Alumnus\n~~~\n\n## \u30d5\u30a3\u30eb\u30bf\u30fc\u95a2\u6570\u3092\u6307\u5b9a\n\n- \u95a2\u6570\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u30e2\u30c7\u30eb\u306eQuerySet\u306b\u30d5\u30a3\u30eb\u30bf\u30fc\u304b\u3051\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067`__init__`\u3067\u6307\u5b9a\u3059\u308b\n- depts, depts_ex \u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3068\u3057\u3066 filter_depts\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3046\n- filter_depts\u306b `field` \u5f15\u6570\u3092\u8ffd\u52a0\u3057\u3001 functools.partial\u3067\u3053\u308c\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\uff11\u3064\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u306b\u307e\u3068\u3081\u308b\n- self.dept_items \u306brequest.GET\u306b\u30c7\u30fc\u30bf\u304c\u5b58\u5728\u3059\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\u4e00\u89a7\u3059\u308b(\u6700\u5f8c\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u5224\u5b9a\u3059\u308b\u30d5\u30e9\u30b0)\n- self.dept_values \u306f\u7a7a\u306elist\u3067\u521d\u671f\u5316\u3057\u3066\u304a\u304f\n\n~~~py\ndef __init__(self, data, *args, **kwargs):                                   \n    self.depts_items = {}                                                    \n    self.depts_values = []                                                   \n\n    for i in ['depts', 'depts_ex', ]:                                        \n        self.base_filters[i].filter = partial(self.filter_depts, field=i)    \n        if data.get(i, None):                                                \n            self.depts_items[i] = i                                          \n\n    super(AlumnusFilter, self).__init__(data, *args, **kwargs)         \n~~~\n\n## \u30d5\u30a3\u30eb\u30bf\u30fc\u95a2\u6570\n\n- value\u304c\u6307\u5b9a\u3055\u308c\u305f\u3089\u3001 Department.code \u306e\u30ea\u30b9\u30c8\u306b\u5909\u63db\u3059\u308b\n- \u30ea\u30b9\u30c8\u306f self.depts_values\u306b\u8caf\u3081\u308b\n- \u5909\u63db\u3057\u305f\u3089\u81ea\u5206\u3092 self.depts_items\u304b\u3089\u629c\u304f\n- depts\u306b\u95a2\u3057\u3066\u51e6\u7406\u3059\u3079\u304d\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u6700\u5f8c\u3060\u3063\u305f\u3089\u3001queryset\u3092\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\u3002\u6700\u5f8c\u3067\u306a\u304b\u3063\u305f\u3089querset\u3092\u305d\u306e\u307e\u307e\u8fd4\u3059\u3002\n- depts\u3092\u5224\u5b9a\u3059\u308b\u30d5\u30a4\u30fc\u30eb\u30c9\u304c\uff13\u500b\u3042\u308b\u306e\u3067OR\u3067\u30af\u30a8\u30ea\u3092\u7d44\u307f\u7acb\u3066\u308b\n\n~~~py\ndef filter_depts(self, queryset, value, field=None):                         \n    if value:                                                                \n        del self.depts_items[field]                                          \n        self.depts_values += [i.code for i in value]                         \n\n    if not self.depts_items:                                                 \n        return queryset.filter(                                              \n            Q(dept_code_1__in=self.depts_values) |                      \n            Q(dept_code_2__in=self.depts_values) |                      \n            Q(dept_code_2__in=self.depts_values))                       \n\n    return queryset  \n~~~    \n\n## \u8ffd\u52a0\u9078\u629e\u80a2\u306e\u8868\u793a/\u975e\u8868\u793a\u3092\u5207\u308a\u66ff\u3048\u308b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\n\n- Javascript\u306eUI\u306e\u30c8\u30ea\u30ac\u30fc\u7528\u306e\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\n- \u30af\u30a8\u30ea\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3068\u306f\u95a2\u4fc2\u306a\u3044\u306e\u3067\u30d5\u30a9\u30fc\u30e0\u3068\u3057\u3066\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u7528\u610f\u3059\u308b\n- \u30e1\u30bf\u30af\u30e9\u30b9\u306e form \u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u30d5\u30a9\u30fc\u30e0\u3092\u5b9a\u7fa9\u3059\u308b\u3068\u3088\u3044\n\n~~~py\nclass Meta:                                                                  \n    form = type('BaseForm', (forms.Form,), dict(                             \n        depts_ex_on=forms.BooleanField(label=_('Dept Ex On'))                \n    ))\n~~~    \n", "tags": ["Django"]}