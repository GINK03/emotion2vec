{"context": "\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u8a9e\u53e5\u3092\u6b63\u898f\u8868\u73fe\u3067\u7f6e\u63db\u3059\u308b Windows \u5411\u3051\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\u3082\u3068\u306f2012\u5e74\u306b\u516c\u958b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u4ed6\u306b\u3082 PowerShell \u3092\u4f7f\u3046\u3068\u304b\u3001Git Bash \u306a\u3069\u3092\u5c0e\u5165\u3057\u3066\u30c6\u30ad\u30b9\u30c8\u51e6\u7406\u7cfb\u306e UNIX \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u304b\u3001\u305d\u306e\u4ed6\u306e\u7f6e\u63db\u7528\u306e\u30d5\u30ea\u30fc\u30a6\u30a7\u30a2\u3092\u4f7f\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u3063\u305f\u306e\u3067\u306f\u3068\u601d\u3044\u307e\u3059\u3002JScript \u306b\u3057\u305f\u7406\u7531\u306f\u3069\u3046\u3042\u308c\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306b\u3088\u308b\u81ea\u52d5\u5316\u304c\u3057\u305f\u304b\u3063\u305f\u3088\u3046\u3067\u3059\u3002\nADODB.Stream \u3092\u4f7f\u7528\u3057\u3066\u3044\u3066\u3001UTF-8 \u5165\u51fa\u529b\u5bfe\u5fdc\u3067\u3059\u3002BOM \u306a\u3057\u3067\u306e\u51fa\u529b\u3082\u3067\u304d\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5f8c\u534a\u306f\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5165\u51fa\u529b\u30e1\u30bd\u30c3\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u540c\u3058\u304f BOM \u306a\u3057\u306e UTF-8 \u3092\u51fa\u529b\u3057\u305f\u3044\u65b9\u304c\u3044\u308c\u3070\u6d41\u7528\u53ef\u80fd\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30a6\u30a7\u30d6\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u7d44\u307f\u5408\u308f\u305b\u3064\u3064\u4f5c\u3089\u308c\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u81ea\u7531\u306b\u6539\u5909\u3057\u3066\u5229\u7528\u3057\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n/** \n * @fileOverview \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u63db\u3059\u308b JScript \u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n * \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u306e\u8a73\u7d30\u306f\u3001\u5f15\u6570\u3092\u4ed8\u3051\u305a\u306b\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n */\n\n/**\n * WshArguments \u3092 JavaScript \u6a19\u6e96\u306e\u914d\u5217\u306b\u5909\u63db\u3059\u308b\u3002\n */\nfunction WshArgumentsToArray(wshArguments)\n{\n    var arguments = [];\n    for (var i = 0; i < wshArguments.length; i++)\n    {\n        var arg = wshArguments(i);\n\n        // WSH\u306e\u5f15\u6570\u306b\u306f\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\n        // \u4ee3\u66ff\u624b\u6bb5\u3068\u3057\u3066\u3001\u300c`\u300d\u304c\u6e21\u3055\u308c\u305f\u5834\u5408\u300c\"\u300d\u3068\u3057\u3066\u6271\u3046\n        // \u307e\u305f\u3001\u300c\\`\u300d\u304c\u6e21\u3055\u308c\u305f\u5834\u5408\u306f\u300c`\u300d\u3068\u3057\u3066\u6271\u3046\n        arg = arg.replace(/^`/g, \"\\\"\");\n        arg = arg.replace(/([^\\\\])`/g, \"$1\\\"\");\n        arg = arg.replace(/\\\\`/g, \"`\");\n\n        arguments.push(arg);\n    }\n    return arguments;\n}\n\n/**\n * \u30b3\u30de\u30f3\u30c9 \u30e1\u30a4\u30f3\u51e6\u7406\n * @param {Array} arguments \u5f15\u6570\u6587\u5b57\u5217\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\n */\nfunction Main(arguments)\n{\n    var EXIT_SUCCESS = 0;\n    var EXIT_FAILURE = 1;\n    var ERROR_TEXT_TOO_FEW_PARAMETERS = \"\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5c11\u306a\u3059\u304e\u307e\u3059\";\n\n    if (arguments.length == 0)\n    {\n        // \u5f15\u6570\u304c\u306a\u3051\u308c\u3070\u4f7f\u3044\u65b9\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b\n        ShowUsage();\n        return EXIT_SUCCESS;\n    }\n\n    // \u8aad\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\n    var charsetDst = \"utf-8n\";\n    // \u66f8\u8fbc\u5143\u6587\u5b57\u30b3\u30fc\u30c9\n    var charsetSrc = \"_autodetect\";\n    // \u8aad\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\n    var filenameDst = \"\";\n    // \u66f8\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\n    var filenameSrc = \"\";\n    // \u7f6e\u63db\u5148\u30ad\u30fc\u30ef\u30fc\u30c9\n    var keywordDst = \"\";\n    // \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9\n    var keywordSrc = \"\";\n\n    // \u30aa\u30d7\u30b7\u30e7\u30f3\u6587\u5b57\u5217\u3092\u51e6\u7406\n    while (arguments.length > 0 && arguments[0].charAt(0) == \"-\")\n    {\n        var option = arguments.shift().substr(1);\n        if (option.charAt(0) == \"-\")\n        {\n            // \u9577\u3044\u30aa\u30d7\u30b7\u30e7\u30f3 --long\n            option = option.substr(1);\n            if (option == \"charset\")\n            {\n                // \u8aad\u8fbc\u5143/\u66f8\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetDst = arguments.shift();\n                charsetSrc = charsetDst;\n                arguments.shift();\n            }\n            else if (option == \"charset-dst\")\n            {\n                // \u8aad\u8fbc\u5143\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetDst = arguments.shift();\n            }\n            else if (option == \"charset-src\")\n            {\n                // \u66f8\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetSrc = arguments.shift();\n            }\n            else\n            {\n                WScript.Echo(\"\u4e0d\u660e\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059: --\" + option);\n                return EXIT_FAILURE;\n            }\n        }\n        else\n        {\n            // 1\u6587\u5b57\u9023\u7d9a\u6307\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3 -AbCd\n            if (option.length == 0)\n            {\n                WScript.Echo(\"\u30aa\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a\u304c\u7121\u52b9\u3067\u3059\");\n                return EXIT_FAILURE;\n            }\n            for (var i = 0; i < option.length; i++)\n            {\n                var optionChar = option.charAt(i);\n                if (optionChar == \"\")\n                {\n                    // \u30d1\u30e9\u30e1\u30fc\u30bf\u51e6\u7406\u304c\u3042\u308c\u3070\u8ffd\u52a0...\n                }\n                else\n                {\n                    WScript.Echo(\"\u4e0d\u660e\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059: -\" + optionChar);\n                    return EXIT_FAILURE;\n                }\n            }\n        }\n    }\n\n    // \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\n    if (arguments.length < 1)\n    {\n        WScript.Echo(\"\u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\");\n        return EXIT_FAILURE;\n    }\n    filenameSrc = arguments[0];\n\n    // \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\n    if (arguments.length < 2)\n    {\n        WScript.Echo(\"\u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\");\n        return EXIT_FAILURE;\n    }\n    filenameDst = arguments[1];\n\n    // \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9\n    if (arguments.length >= 3)\n    {\n        keywordSrc = arguments[2];\n    }\n\n    // \u7f6e\u63db\u5148\u30ad\u30fc\u30ef\u30fc\u30c9\n    if (arguments.length >= 4)\n    {\n        keywordDst = arguments[3];\n    }\n\n    // \u30c6\u30ad\u30b9\u30c8\u7f6e\u63db\u51e6\u7406\u30e1\u30a4\u30f3\n    var text = LoadTextFile(filenameSrc, charsetSrc);\n    var regex = new RegExp(keywordSrc, \"gm\");\n    text = text.replace(regex, keywordDst);\n    SaveTextFile(filenameDst, text, charsetDst);\n}\n\n/**\n * \u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u7528\u65b9\u6cd5\u3092\u51fa\u529b\u3059\u308b\u3002\n */\nfunction ShowUsage()\n{\n    var lineSeparator = \"\\n\";\n    WScript.Echo(\n    \"\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f:\" + lineSeparator +\n    \"  (cscript) TextReplace.js <\u5f15\u6570> \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9(\u6b63\u898f\u8868\u73fe) \u7f6e\u63db\u5f8c\u30ad\u30fc\u30ef\u30fc\u30c9\" + lineSeparator +\n    \"  \u203b\u6b63\u898f\u8868\u73fe\u4e2d\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u4e00\u81f4\u3057\u305f\u30ad\u30fc\u30ef\u30fc\u30c9\u306f $1,$2... \u3067\u8868\u73fe\u53ef\u80fd\u3067\u3059\u3002\" + lineSeparator +\n    \"\" + lineSeparator +\n    \"\u5f15\u6570:\" + lineSeparator +\n    \"--charset \u8aad\u8fbc\u5143/\u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\" + lineSeparator +\n    \"  --charset-dst \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9 (default: utf-8n)\" + lineSeparator +\n    \"  --charset-src \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9 (default: _autodetect)\" + lineSeparator +\n    \"\" + lineSeparator +\n    \"  charset \u306e\u5024\u306e\u4f8b:\" + lineSeparator +\n    \"  _autodetect, euc-jp, iso-2022-jp, shift_jis, unicode, utf-8,...\"\n    );\n}\n\n//--[ \u30c6\u30ad\u30b9\u30c8\u5165\u51fa\u529b\u6a5f\u80fd \u958b\u59cb ]-------------------------------------------------\n\n// StreamTypeEnum Constants\nvar adTypeBinary = 1;\nvar adTypeText = 2;\n\n// LineSeparatorEnum Constants\nvar adLF = 10;\nvar adCR = 13;\nvar adCRLF = -1;\n\n// StreamWriteEnum Constants\nvar adWriteChar = 0;\nvar adWriteLine = 1;\n\n// SaveOptionsEnum Constants\nvar adSaveCreateNotExist = 1;\nvar adSaveCreateOverWrite = 2;\n\n// StreamReadEnum Constants\nvar adReadAll = -1;\nvar adReadLine = -2;\n\n/**\n * \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u3002\n * @param {String} filename \u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n * @param {String} charset \u6587\u5b57\u30b3\u30fc\u30c9\n * @return {String} \u6587\u5b57\u5217\n */\nfunction LoadTextFile(filename, charset)\n{\n    // \u6587\u5b57\u30b3\u30fc\u30c9\u306e\u6307\u5b9a\u306a\u304d\u5834\u5408\u3001\u81ea\u52d5\u691c\u51fa\u3068\u3059\u308b\u3002\n    // (\u8aa4\u5224\u5b9a\u304c\u8d77\u304d\u308b\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u6ce8\u610f)\n    if (charset == undefined)\n    {\n        charset = \"_autodetect\";\n    }\n\n    var stream, text;\n    stream = new ActiveXObject(\"ADODB.Stream\");\n    stream.type = adTypeText;\n    stream.charset = charset;\n    stream.open();\n    stream.loadFromFile(filename);\n    text = stream.readText(adReadAll);\n    stream.close();\n    return text;\n}\n\n/**\n * \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u51fa\u3059\u3002\n * @param {String} filename \u66f8\u304d\u51fa\u3059\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n * @param {String} text \u66f8\u304d\u51fa\u3059\u30c6\u30ad\u30b9\u30c8\n * @param {String} charset \u6587\u5b57\u30b3\u30fc\u30c9\n */\nfunction SaveTextFile(filename, text, charset)\n{\n    // \u6587\u5b57\u30b3\u30fc\u30c9\u306e\u6307\u5b9a\u306a\u304d\u5834\u5408\u3001UTF-8N\u3068\u3059\u308b\u3002\n    if (charset == undefined)\n    {\n        charset = \"utf-8n\";\n    }\n\n    // \u72ec\u81ea\u306bBOM\u9664\u53bb\u3092\u884c\u3046\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u5224\u5b9a\n    var trimUnicodeBOM = false;\n    var unicodeBOMLength = 0;\n    if (charset.match(/^utf-8n$/i))\n    {\n        charset = charset.replace(/n$/i, \"\");\n        unicodeBOMLength = 3;\n        trimUnicodeBOM = true;\n    }\n    else if (charset.match(/^utf-16n$/i))\n    {\n        charset = charset.replace(/n$/i, \"\");\n        unicodeBOMLength = 2;\n        trimUnicodeBOM = true;\n    }\n\n    var stream;\n    stream = new ActiveXObject(\"ADODB.Stream\");\n    stream.type = adTypeText;\n    stream.charset = charset;\n    stream.open();\n    stream.writeText(text);\n    if (trimUnicodeBOM)\n    {\n        // Unicode BOM\u3092\u9664\u53bb\u3057\u3066\u51fa\u529b\n\n        // \u30d0\u30a4\u30ca\u30ea\u30e2\u30fc\u30c9\u306b\u3059\u308b\u305f\u3081\u306bPosition\u3092\u4e00\u5ea60\u306b\u623b\u3059\n        // Read\u3059\u308b\u305f\u3081\u306b\u306f\u30d0\u30a4\u30ca\u30ea\u30e2\u30fc\u30c9\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n        stream.Position = 0;\n        stream.Type = adTypeBinary;\n        // Position\u3092\u9032\u3081\u3066\u304b\u3089\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3067\n        // BOM\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\n        stream.Position = unicodeBOMLength;\n        // \u5909\u63db\u5f8c\u306e\u5185\u5bb9\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8aad\u307f\u8fbc\u3080\n        var textBinary = stream.Read();\n        stream.Close();\n\n        // \u8aad\u307f\u8fbc\u3093\u3060\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u518d\u51fa\u529b\u3059\u308b\n        stream = new ActiveXObject(\"ADODB.Stream\");\n        stream.Type = adTypeBinary;\n        stream.Open();\n        stream.Write(textBinary);\n    }\n    stream.saveToFile(filename, adSaveCreateOverWrite);\n    stream.close();\n}\n\n//--[ \u30c6\u30ad\u30b9\u30c8\u5165\u51fa\u529b\u6a5f\u80fd \u7d42\u4e86 ]-------------------------------------------------\n\nWScript.Quit(Main(WshArgumentsToArray(WScript.Arguments)));\n\n\n\u30b3\u30de\u30f3\u30c9\u5229\u7528\u4f8b\ncscript //nologo TextReplace.js --charset-src utf-8 --charset-dst utf-8 \u8aad\u8fbc\u5143.txt \u66f8\u8fbc\u5148.txt \u307e\u304e\u308f\u3089\u3057\u3044 \u307e\u304e\u3089\u308f\u3057\u3044\n\n\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u8a9e\u53e5\u3092\u6b63\u898f\u8868\u73fe\u3067\u7f6e\u63db\u3059\u308b Windows \u5411\u3051\u306e\u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n\n\u3082\u3068\u306f2012\u5e74\u306b\u516c\u958b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\u4ed6\u306b\u3082 PowerShell \u3092\u4f7f\u3046\u3068\u304b\u3001Git Bash \u306a\u3069\u3092\u5c0e\u5165\u3057\u3066\u30c6\u30ad\u30b9\u30c8\u51e6\u7406\u7cfb\u306e UNIX \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3046\u3068\u304b\u3001\u305d\u306e\u4ed6\u306e\u7f6e\u63db\u7528\u306e\u30d5\u30ea\u30fc\u30a6\u30a7\u30a2\u3092\u4f7f\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u3063\u305f\u306e\u3067\u306f\u3068\u601d\u3044\u307e\u3059\u3002JScript \u306b\u3057\u305f\u7406\u7531\u306f\u3069\u3046\u3042\u308c\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306b\u3088\u308b\u81ea\u52d5\u5316\u304c\u3057\u305f\u304b\u3063\u305f\u3088\u3046\u3067\u3059\u3002\n\nADODB.Stream \u3092\u4f7f\u7528\u3057\u3066\u3044\u3066\u3001UTF-8 \u5165\u51fa\u529b\u5bfe\u5fdc\u3067\u3059\u3002BOM \u306a\u3057\u3067\u306e\u51fa\u529b\u3082\u3067\u304d\u307e\u3059\u3002\u30b9\u30af\u30ea\u30d7\u30c8\u5f8c\u534a\u306f\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5165\u51fa\u529b\u30e1\u30bd\u30c3\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u540c\u3058\u304f BOM \u306a\u3057\u306e UTF-8 \u3092\u51fa\u529b\u3057\u305f\u3044\u65b9\u304c\u3044\u308c\u3070\u6d41\u7528\u53ef\u80fd\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30a6\u30a7\u30d6\u4e0a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u7d44\u307f\u5408\u308f\u305b\u3064\u3064\u4f5c\u3089\u308c\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u3053\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u81ea\u7531\u306b\u6539\u5909\u3057\u3066\u5229\u7528\u3057\u3066\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n```js\n/** \n * @fileOverview \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u63db\u3059\u308b JScript \u30b3\u30de\u30f3\u30c9\u3067\u3059\u3002\n * \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u306e\u8a73\u7d30\u306f\u3001\u5f15\u6570\u3092\u4ed8\u3051\u305a\u306b\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n */\n\n/**\n * WshArguments \u3092 JavaScript \u6a19\u6e96\u306e\u914d\u5217\u306b\u5909\u63db\u3059\u308b\u3002\n */\nfunction WshArgumentsToArray(wshArguments)\n{\n    var arguments = [];\n    for (var i = 0; i < wshArguments.length; i++)\n    {\n        var arg = wshArguments(i);\n\n        // WSH\u306e\u5f15\u6570\u306b\u306f\u30c0\u30d6\u30eb\u30af\u30aa\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\n        // \u4ee3\u66ff\u624b\u6bb5\u3068\u3057\u3066\u3001\u300c`\u300d\u304c\u6e21\u3055\u308c\u305f\u5834\u5408\u300c\"\u300d\u3068\u3057\u3066\u6271\u3046\n        // \u307e\u305f\u3001\u300c\\`\u300d\u304c\u6e21\u3055\u308c\u305f\u5834\u5408\u306f\u300c`\u300d\u3068\u3057\u3066\u6271\u3046\n        arg = arg.replace(/^`/g, \"\\\"\");\n        arg = arg.replace(/([^\\\\])`/g, \"$1\\\"\");\n        arg = arg.replace(/\\\\`/g, \"`\");\n\n        arguments.push(arg);\n    }\n    return arguments;\n}\n\n/**\n * \u30b3\u30de\u30f3\u30c9 \u30e1\u30a4\u30f3\u51e6\u7406\n * @param {Array} arguments \u5f15\u6570\u6587\u5b57\u5217\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\n */\nfunction Main(arguments)\n{\n    var EXIT_SUCCESS = 0;\n    var EXIT_FAILURE = 1;\n    var ERROR_TEXT_TOO_FEW_PARAMETERS = \"\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5c11\u306a\u3059\u304e\u307e\u3059\";\n\n    if (arguments.length == 0)\n    {\n        // \u5f15\u6570\u304c\u306a\u3051\u308c\u3070\u4f7f\u3044\u65b9\u3092\u8868\u793a\u3057\u3066\u7d42\u4e86\u3059\u308b\n        ShowUsage();\n        return EXIT_SUCCESS;\n    }\n\n    // \u8aad\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\n    var charsetDst = \"utf-8n\";\n    // \u66f8\u8fbc\u5143\u6587\u5b57\u30b3\u30fc\u30c9\n    var charsetSrc = \"_autodetect\";\n    // \u8aad\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\n    var filenameDst = \"\";\n    // \u66f8\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\n    var filenameSrc = \"\";\n    // \u7f6e\u63db\u5148\u30ad\u30fc\u30ef\u30fc\u30c9\n    var keywordDst = \"\";\n    // \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9\n    var keywordSrc = \"\";\n\n    // \u30aa\u30d7\u30b7\u30e7\u30f3\u6587\u5b57\u5217\u3092\u51e6\u7406\n    while (arguments.length > 0 && arguments[0].charAt(0) == \"-\")\n    {\n        var option = arguments.shift().substr(1);\n        if (option.charAt(0) == \"-\")\n        {\n            // \u9577\u3044\u30aa\u30d7\u30b7\u30e7\u30f3 --long\n            option = option.substr(1);\n            if (option == \"charset\")\n            {\n                // \u8aad\u8fbc\u5143/\u66f8\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetDst = arguments.shift();\n                charsetSrc = charsetDst;\n                arguments.shift();\n            }\n            else if (option == \"charset-dst\")\n            {\n                // \u8aad\u8fbc\u5143\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetDst = arguments.shift();\n            }\n            else if (option == \"charset-src\")\n            {\n                // \u66f8\u8fbc\u5148\u6587\u5b57\u30b3\u30fc\u30c9\u6307\u5b9a\n                if (arguments.length < 1)\n                {\n                    WScript.Echo(ERROR_TEXT_TOO_FEW_PARAMETERS);\n                    return EXIT_FAILURE;\n                }\n                charsetSrc = arguments.shift();\n            }\n            else\n            {\n                WScript.Echo(\"\u4e0d\u660e\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059: --\" + option);\n                return EXIT_FAILURE;\n            }\n        }\n        else\n        {\n            // 1\u6587\u5b57\u9023\u7d9a\u6307\u5b9a\u30aa\u30d7\u30b7\u30e7\u30f3 -AbCd\n            if (option.length == 0)\n            {\n                WScript.Echo(\"\u30aa\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a\u304c\u7121\u52b9\u3067\u3059\");\n                return EXIT_FAILURE;\n            }\n            for (var i = 0; i < option.length; i++)\n            {\n                var optionChar = option.charAt(i);\n                if (optionChar == \"\")\n                {\n                    // \u30d1\u30e9\u30e1\u30fc\u30bf\u51e6\u7406\u304c\u3042\u308c\u3070\u8ffd\u52a0...\n                }\n                else\n                {\n                    WScript.Echo(\"\u4e0d\u660e\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059: -\" + optionChar);\n                    return EXIT_FAILURE;\n                }\n            }\n        }\n    }\n\n    // \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\n    if (arguments.length < 1)\n    {\n        WScript.Echo(\"\u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\");\n        return EXIT_FAILURE;\n    }\n    filenameSrc = arguments[0];\n\n    // \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\n    if (arguments.length < 2)\n    {\n        WScript.Echo(\"\u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\");\n        return EXIT_FAILURE;\n    }\n    filenameDst = arguments[1];\n\n    // \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9\n    if (arguments.length >= 3)\n    {\n        keywordSrc = arguments[2];\n    }\n\n    // \u7f6e\u63db\u5148\u30ad\u30fc\u30ef\u30fc\u30c9\n    if (arguments.length >= 4)\n    {\n        keywordDst = arguments[3];\n    }\n\n    // \u30c6\u30ad\u30b9\u30c8\u7f6e\u63db\u51e6\u7406\u30e1\u30a4\u30f3\n    var text = LoadTextFile(filenameSrc, charsetSrc);\n    var regex = new RegExp(keywordSrc, \"gm\");\n    text = text.replace(regex, keywordDst);\n    SaveTextFile(filenameDst, text, charsetDst);\n}\n\n/**\n * \u30b3\u30de\u30f3\u30c9\u306e\u4f7f\u7528\u65b9\u6cd5\u3092\u51fa\u529b\u3059\u308b\u3002\n */\nfunction ShowUsage()\n{\n    var lineSeparator = \"\\n\";\n    WScript.Echo(\n    \"\u30b3\u30de\u30f3\u30c9\u66f8\u5f0f:\" + lineSeparator +\n    \"  (cscript) TextReplace.js <\u5f15\u6570> \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u540d \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u540d \u7f6e\u63db\u5143\u30ad\u30fc\u30ef\u30fc\u30c9(\u6b63\u898f\u8868\u73fe) \u7f6e\u63db\u5f8c\u30ad\u30fc\u30ef\u30fc\u30c9\" + lineSeparator +\n    \"  \u203b\u6b63\u898f\u8868\u73fe\u4e2d\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u4e00\u81f4\u3057\u305f\u30ad\u30fc\u30ef\u30fc\u30c9\u306f $1,$2... \u3067\u8868\u73fe\u53ef\u80fd\u3067\u3059\u3002\" + lineSeparator +\n    \"\" + lineSeparator +\n    \"\u5f15\u6570:\" + lineSeparator +\n    \"--charset \u8aad\u8fbc\u5143/\u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9\" + lineSeparator +\n    \"  --charset-dst \u66f8\u8fbc\u5148\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9 (default: utf-8n)\" + lineSeparator +\n    \"  --charset-src \u8aad\u8fbc\u5143\u30d5\u30a1\u30a4\u30eb\u306e\u6587\u5b57\u30b3\u30fc\u30c9 (default: _autodetect)\" + lineSeparator +\n    \"\" + lineSeparator +\n    \"  charset \u306e\u5024\u306e\u4f8b:\" + lineSeparator +\n    \"  _autodetect, euc-jp, iso-2022-jp, shift_jis, unicode, utf-8,...\"\n    );\n}\n\n//--[ \u30c6\u30ad\u30b9\u30c8\u5165\u51fa\u529b\u6a5f\u80fd \u958b\u59cb ]-------------------------------------------------\n\n// StreamTypeEnum Constants\nvar adTypeBinary = 1;\nvar adTypeText = 2;\n\n// LineSeparatorEnum Constants\nvar adLF = 10;\nvar adCR = 13;\nvar adCRLF = -1;\n\n// StreamWriteEnum Constants\nvar adWriteChar = 0;\nvar adWriteLine = 1;\n\n// SaveOptionsEnum Constants\nvar adSaveCreateNotExist = 1;\nvar adSaveCreateOverWrite = 2;\n\n// StreamReadEnum Constants\nvar adReadAll = -1;\nvar adReadLine = -2;\n\n/**\n * \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3080\u3002\n * @param {String} filename \u8aad\u307f\u8fbc\u3080\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n * @param {String} charset \u6587\u5b57\u30b3\u30fc\u30c9\n * @return {String} \u6587\u5b57\u5217\n */\nfunction LoadTextFile(filename, charset)\n{\n    // \u6587\u5b57\u30b3\u30fc\u30c9\u306e\u6307\u5b9a\u306a\u304d\u5834\u5408\u3001\u81ea\u52d5\u691c\u51fa\u3068\u3059\u308b\u3002\n    // (\u8aa4\u5224\u5b9a\u304c\u8d77\u304d\u308b\u3053\u3068\u3082\u3042\u308b\u306e\u3067\u6ce8\u610f)\n    if (charset == undefined)\n    {\n        charset = \"_autodetect\";\n    }\n\n    var stream, text;\n    stream = new ActiveXObject(\"ADODB.Stream\");\n    stream.type = adTypeText;\n    stream.charset = charset;\n    stream.open();\n    stream.loadFromFile(filename);\n    text = stream.readText(adReadAll);\n    stream.close();\n    return text;\n}\n\n/**\n * \u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u51fa\u3059\u3002\n * @param {String} filename \u66f8\u304d\u51fa\u3059\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\n * @param {String} text \u66f8\u304d\u51fa\u3059\u30c6\u30ad\u30b9\u30c8\n * @param {String} charset \u6587\u5b57\u30b3\u30fc\u30c9\n */\nfunction SaveTextFile(filename, text, charset)\n{\n    // \u6587\u5b57\u30b3\u30fc\u30c9\u306e\u6307\u5b9a\u306a\u304d\u5834\u5408\u3001UTF-8N\u3068\u3059\u308b\u3002\n    if (charset == undefined)\n    {\n        charset = \"utf-8n\";\n    }\n\n    // \u72ec\u81ea\u306bBOM\u9664\u53bb\u3092\u884c\u3046\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u5224\u5b9a\n    var trimUnicodeBOM = false;\n    var unicodeBOMLength = 0;\n    if (charset.match(/^utf-8n$/i))\n    {\n        charset = charset.replace(/n$/i, \"\");\n        unicodeBOMLength = 3;\n        trimUnicodeBOM = true;\n    }\n    else if (charset.match(/^utf-16n$/i))\n    {\n        charset = charset.replace(/n$/i, \"\");\n        unicodeBOMLength = 2;\n        trimUnicodeBOM = true;\n    }\n\n    var stream;\n    stream = new ActiveXObject(\"ADODB.Stream\");\n    stream.type = adTypeText;\n    stream.charset = charset;\n    stream.open();\n    stream.writeText(text);\n    if (trimUnicodeBOM)\n    {\n        // Unicode BOM\u3092\u9664\u53bb\u3057\u3066\u51fa\u529b\n\n        // \u30d0\u30a4\u30ca\u30ea\u30e2\u30fc\u30c9\u306b\u3059\u308b\u305f\u3081\u306bPosition\u3092\u4e00\u5ea60\u306b\u623b\u3059\n        // Read\u3059\u308b\u305f\u3081\u306b\u306f\u30d0\u30a4\u30ca\u30ea\u30e2\u30fc\u30c9\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n        stream.Position = 0;\n        stream.Type = adTypeBinary;\n        // Position\u3092\u9032\u3081\u3066\u304b\u3089\u8aad\u307f\u8fbc\u3080\u3053\u3068\u3067\n        // BOM\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\n        stream.Position = unicodeBOMLength;\n        // \u5909\u63db\u5f8c\u306e\u5185\u5bb9\u3092\u30d0\u30c3\u30d5\u30a1\u306b\u8aad\u307f\u8fbc\u3080\n        var textBinary = stream.Read();\n        stream.Close();\n\n        // \u8aad\u307f\u8fbc\u3093\u3060\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u518d\u51fa\u529b\u3059\u308b\n        stream = new ActiveXObject(\"ADODB.Stream\");\n        stream.Type = adTypeBinary;\n        stream.Open();\n        stream.Write(textBinary);\n    }\n    stream.saveToFile(filename, adSaveCreateOverWrite);\n    stream.close();\n}\n\n//--[ \u30c6\u30ad\u30b9\u30c8\u5165\u51fa\u529b\u6a5f\u80fd \u7d42\u4e86 ]-------------------------------------------------\n\nWScript.Quit(Main(WshArgumentsToArray(WScript.Arguments)));\n```\n\n## \u30b3\u30de\u30f3\u30c9\u5229\u7528\u4f8b\n\n```\ncscript //nologo TextReplace.js --charset-src utf-8 --charset-dst utf-8 \u8aad\u8fbc\u5143.txt \u66f8\u8fbc\u5148.txt \u307e\u304e\u308f\u3089\u3057\u3044 \u307e\u304e\u3089\u308f\u3057\u3044\n```\n", "tags": ["JScript"]}