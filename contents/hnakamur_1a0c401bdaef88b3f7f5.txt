{"context": " More than 1 year has passed since last update.Docker\u306b\u306f\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u901a\u4fe1\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nLink Containers - Docker Documentation\nDocker 0.6.5\u306e\u65b0\u6a5f\u80fd\u3092\u8ffd\u3046 | u1's tech blog\n\n\u3053\u308c\u3092\u8a66\u3057\u3066\u898b\u308b\u305f\u3081\u3001lua-nginx-module \u3067\u5229\u7528\u3067\u304d\u308bStorage(memcache, MySQL, redis)\u5411\u3051\u306e\u30a2\u30c0\u30d7\u30bf\u3092\u8a66\u3059 - Qiita\u306eredis\u306e\u30b5\u30f3\u30d7\u30eb\u3092docker\u3067\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e2\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066nginx\u306e\u30b3\u30f3\u30c6\u30ca\u304b\u3089redis\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\nnginx + nginx-lua-module + lua-resty-redis\n\n\n\u30bd\u30fc\u30b9: https://github.com/hnakamur/docker-nginx-lua/tree/3484e93f671868ef8632064fbc6d2b1d54086ede \n\n\nredis\n\n\n\u30bd\u30fc\u30b9: https://github.com/hnakamur/docker-redis/tree/6f761f3564cae894be2b46c8509b09b39ebddf8f\n\n\n\n\ncd ${docker-nginx-lua\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea}\ndocker build -t hnakamur/nginx-lua .\n\ncd ${docker-redis\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea}\ndocker build -t hnakamur/redis .\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\ndocker run -d -p 6379:6379 -name redis hnakamur/redis\ndocker run -d -p 80:80 -link redis:redis hnakamur/nginx-lua\n\n-link \u306e\u5f15\u6570\u306f\u30b3\u30f3\u30c6\u30ca\u540d:\u30a8\u30a4\u30ea\u30a2\u30b9\u3068\u3044\u3046\u5f62\u5f0f\u306a\u3093\u3067\u3059\u304c\u3001\u30a8\u30a4\u30ea\u30a2\u30b9\u306f\u30b3\u30f3\u30c6\u30ca\u540d\u3068\u540c\u3058\u3067\u3082\u5927\u4e08\u592b\u3067\u3057\u305f\u3002\n\u3053\u306e\u5f15\u6570\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306b\u3088\u308ahnakmaur/nginx-lua\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30a8\u30a4\u30ea\u30a2\u30b9\u540d\u3068\u516c\u958b\u30dd\u30fc\u30c8\u306b\u5bfe\u5fdc\u3057\u3066REDIS_PORT_6379_TCP_ADDR\u3001REDIS_PORT_6379_TCP_PORT\u306a\u3069\u306e\u74b0\u5883\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\u8a2d\u5b9a\u3055\u308c\u308b\u74b0\u5883\u5909\u6570\u306fLink Containers - Docker Documentation\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067nginx\u304b\u3089redis\u306b\u63a5\u7d9a\u3059\u308b\u51e6\u7406\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u74b0\u5883\u5909\u6570\u306e\u5024\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nhttps\n        location /get {\n            content_by_lua '\n                local redis = require \"resty.redis\"\n                local client = redis:new()\n                client:connect(os.getenv(\"REDIS_PORT_6379_TCP_ADDR\"), tonumber(os.getenv(\"REDIS_PORT_6379_TCP_PORT\")))\n\n                local args = ngx.req.get_uri_args()\n                local key, field = args.key, args.field\n\n                local result, err = client:hmget(key, field)\n                ngx.say(result)\n            ';\n        }\n\n        location /set {\n            content_by_lua '\n                local redis = require \"resty.redis\"\n                local client = redis:new()\n                client:connect(os.getenv(\"REDIS_PORT_6379_TCP_ADDR\"), tonumber(os.getenv(\"REDIS_PORT_6379_TCP_PORT\")))\n\n                local args = ngx.req.get_uri_args()\n                local key, field, val = args.key, args.field, args.value\n\n                client:hmset(key, field, val)\n                ngx.say(\"Saved!\")\n            ';\n        }\n\n\nCore functionality\u306b\u3088\u308b\u3068\u3001nginx\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fTZ\u4ee5\u5916\u306e\u5168\u3066\u306e\u74b0\u5883\u5909\u6570\u3092\u524a\u9664\u3059\u308b\u305d\u3046\u3067\u3059\u3002\n\u305d\u3053\u3067\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092nginx.conf\u306b\u52a0\u3048\u3066\u3044\u307e\u3059\u3002\n\nhttps\nenv REDIS_PORT_6379_TCP_ADDR;\nenv REDIS_PORT_6379_TCP_PORT;\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nOSX\u3067\u306f\u4ee5\u4e0b\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\nVBoxManage controlvm \"boot2docker-vm\" natpf1 \"nginx,tcp,127.0.0.1,8080,,80\"\n\n\u305d\u3053\u3067\ncurl 'http://localhost:8080/set?key=foo&filed=bar&value=baz'\n\n\u3067\u5024\u3092\u8a2d\u5b9a\u3057\u3001\ncurl 'http://localhost:8080/get?key=foo&filed=bar'\n\n\u3067\u5024\u3092\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\nDocker\u306b\u306f\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u901a\u4fe1\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u305f\u3081\u306e\u4ed5\u7d44\u307f\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* [Link Containers - Docker Documentation](http://docs.docker.io/en/latest/use/working_with_links_names/)\n* [Docker 0.6.5\u306e\u65b0\u6a5f\u80fd\u3092\u8ffd\u3046 | u1's tech blog](http://blog.udcp.net/2013/11/06/docker-0-6-5%E3%81%AE%E6%96%B0%E6%A9%9F%E8%83%BD%E3%82%92%E8%BF%BD%E3%81%86/)\n\n\u3053\u308c\u3092\u8a66\u3057\u3066\u898b\u308b\u305f\u3081\u3001[lua-nginx-module \u3067\u5229\u7528\u3067\u304d\u308bStorage(memcache, MySQL, redis)\u5411\u3051\u306e\u30a2\u30c0\u30d7\u30bf\u3092\u8a66\u3059 - Qiita](http://qiita.com/futoase/items/ac0708a44d5158d1e73d)\u306eredis\u306e\u30b5\u30f3\u30d7\u30eb\u3092docker\u3067\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4ee5\u4e0b\u306e2\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3066nginx\u306e\u30b3\u30f3\u30c6\u30ca\u304b\u3089redis\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\n* nginx + nginx-lua-module + lua-resty-redis\n    * \u30bd\u30fc\u30b9: https://github.com/hnakamur/docker-nginx-lua/tree/3484e93f671868ef8632064fbc6d2b1d54086ede \n* redis\n    * \u30bd\u30fc\u30b9: https://github.com/hnakamur/docker-redis/tree/6f761f3564cae894be2b46c8509b09b39ebddf8f\n\n```shell-session\ncd ${docker-nginx-lua\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea}\ndocker build -t hnakamur/nginx-lua .\n\ncd ${docker-redis\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea}\ndocker build -t hnakamur/redis .\n```\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\n\n```shell-session\ndocker run -d -p 6379:6379 -name redis hnakamur/redis\ndocker run -d -p 80:80 -link redis:redis hnakamur/nginx-lua\n```\n\n```-link``` \u306e\u5f15\u6570\u306f\u30b3\u30f3\u30c6\u30ca\u540d:\u30a8\u30a4\u30ea\u30a2\u30b9\u3068\u3044\u3046\u5f62\u5f0f\u306a\u3093\u3067\u3059\u304c\u3001\u30a8\u30a4\u30ea\u30a2\u30b9\u306f\u30b3\u30f3\u30c6\u30ca\u540d\u3068\u540c\u3058\u3067\u3082\u5927\u4e08\u592b\u3067\u3057\u305f\u3002\n\n\u3053\u306e\u5f15\u6570\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306b\u3088\u308ahnakmaur/nginx-lua\u306e\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u30a8\u30a4\u30ea\u30a2\u30b9\u540d\u3068\u516c\u958b\u30dd\u30fc\u30c8\u306b\u5bfe\u5fdc\u3057\u3066REDIS_PORT_6379_TCP_ADDR\u3001REDIS_PORT_6379_TCP_PORT\u306a\u3069\u306e\u74b0\u5883\u5909\u6570\u304c\u8a2d\u5b9a\u3055\u308c\u307e\u3059\u3002\n\n\u8a2d\u5b9a\u3055\u308c\u308b\u74b0\u5883\u5909\u6570\u306f[Link Containers - Docker Documentation](http://docs.docker.io/en/latest/use/working_with_links_names/)\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u305d\u3053\u3067nginx\u304b\u3089redis\u306b\u63a5\u7d9a\u3059\u308b\u51e6\u7406\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u74b0\u5883\u5909\u6570\u306e\u5024\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```text:https://github.com/hnakamur/docker-nginx-lua/blob/3484e93f671868ef8632064fbc6d2b1d54086ede/nginx.conf#L57-L83\n        location /get {\n            content_by_lua '\n                local redis = require \"resty.redis\"\n                local client = redis:new()\n                client:connect(os.getenv(\"REDIS_PORT_6379_TCP_ADDR\"), tonumber(os.getenv(\"REDIS_PORT_6379_TCP_PORT\")))\n\n                local args = ngx.req.get_uri_args()\n                local key, field = args.key, args.field\n\n                local result, err = client:hmget(key, field)\n                ngx.say(result)\n            ';\n        }\n\n        location /set {\n            content_by_lua '\n                local redis = require \"resty.redis\"\n                local client = redis:new()\n                client:connect(os.getenv(\"REDIS_PORT_6379_TCP_ADDR\"), tonumber(os.getenv(\"REDIS_PORT_6379_TCP_PORT\")))\n\n                local args = ngx.req.get_uri_args()\n                local key, field, val = args.key, args.field, args.value\n\n                client:hmset(key, field, val)\n                ngx.say(\"Saved!\")\n            ';\n        }\n```\n\n[Core functionality](http://nginx.org/en/docs/ngx_core_module.html#env)\u306b\u3088\u308b\u3068\u3001nginx\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fTZ\u4ee5\u5916\u306e\u5168\u3066\u306e\u74b0\u5883\u5909\u6570\u3092\u524a\u9664\u3059\u308b\u305d\u3046\u3067\u3059\u3002\n\n\u305d\u3053\u3067\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092nginx.conf\u306b\u52a0\u3048\u3066\u3044\u307e\u3059\u3002\n\n```text:https://github.com/hnakamur/docker-nginx-lua/blob/3484e93f671868ef8632064fbc6d2b1d54086ede/nginx.conf#L11-L12\nenv REDIS_PORT_6379_TCP_ADDR;\nenv REDIS_PORT_6379_TCP_PORT;\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\nOSX\u3067\u306f\u4ee5\u4e0b\u306e\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\nVBoxManage controlvm \"boot2docker-vm\" natpf1 \"nginx,tcp,127.0.0.1,8080,,80\"\n```\n\n\u305d\u3053\u3067\n\n```shell-session\ncurl 'http://localhost:8080/set?key=foo&filed=bar&value=baz'\n```\n\n\u3067\u5024\u3092\u8a2d\u5b9a\u3057\u3001\n\n```shell-session\ncurl 'http://localhost:8080/get?key=foo&filed=bar'\n```\n\n\u3067\u5024\u3092\u53d6\u5f97\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002", "tags": ["docker0.8.0", "OSX10.8", "Redis2.8.6"]}