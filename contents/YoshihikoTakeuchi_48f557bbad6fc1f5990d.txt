{"context": " More than 1 year has passed since last update.kintone\u3063\u3066\u5168\u6587\u691c\u7d22\u3068\u3044\u3046\u4fbf\u5229\u306a\u6a5f\u80fd\u304c\u3042\u308b\u3093\u3067\u3059\u3088\u3002\n\u30a8\u30af\u30bb\u30eb\u696d\u52d9\u306ekintone\u4e57\u308a\u63db\u3048\u3082\u591a\u3044\u3093\u3067\u3059\u3088\u3002\n\u4e57\u308a\u63db\u3048\u6642\u306b\u3001\u5168\u6587\u691c\u7d22\u3082\u3042\u308b\u3057\u3001\u3068\u308a\u3042\u3048\u305a\u624b\u5143\u306b\u3042\u308b\u30a8\u30af\u30bb\u30eb\u3092\u5168\u90e8\u767b\u9332\u3057\u3068\u304f\u304b\uff01\n\u3068\u3044\u3046\u8a71\u3082\u3042\u308b\u3068\u601d\u3046\u3093\u3067\u3059\u3088\u30fb\u30fb\u30fb\u591a\u5206\u30fb\u30fb\u30fb\u304d\u3063\u3068\u3069\u3053\u304b\u306b\u30fb\u30fb\u30fb\n\u3068\u3044\u3046\u3053\u3068\u3067\uff08\uff1f\uff09\u3001\u6614\u306e\u30c7\u30fc\u30bf\u3092\u63a2\u3059\u6642\u306b\u30a8\u30af\u30bb\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u306a\u304f\u3001kintone\u4e0a\u3067\u30a8\u30af\u30bb\u30eb\u5185\u306e\u753b\u50cf\u3060\u3051\u3067\u3082\u898b\u3089\u308c\u305f\u3089\u4fbf\u5229\u3060\u306a\u3068\u601d\u3044\u7acb\u3061\u30fb\u30fb\u30fb\u601d\u3044\u7acb\u3063\u305f\u304c\u5409\u65e5\uff01\n\u307e\u305a\u306fdeveloper network\u306a\u3069\u3067\u4f3c\u305f\u8a18\u4e8b\u304c\u306a\u3044\u304b\u78ba\u8a8d \u03c6(\u30fb\u03c9\u30fb )\n\u306a\u304b\u3063\u305f\u306e\u3067\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092kintone\u306b\u767b\u9332\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3067\u304d\u308b\u3053\u3068\nkintone\u306b\u6dfb\u4ed8\u3055\u308c\u305f\u30a8\u30af\u30bb\u30eb\u5185\u306e\u753b\u50cf\u3092\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3002\n\u6587\u5b57\u30c7\u30fc\u30bf\u306f\u672a\u5bfe\u5fdc\u3067\u3059\u304c\u3001\u3082\u3046\u5c11\u3057\u9811\u5f35\u308c\u3070\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u51fa\u6765\u4e0a\u304c\u308a\u306e\u30a4\u30e1\u30fc\u30b8\n\u4eca\u56de\u306f\u7d50\u679c\u304b\u3089\uff01\n\u2193\u306e\u3088\u3046\u306b2\u30b7\u30fc\u30c8\u306b\u8a085\u679a\u306e\u753b\u50cf\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u30a8\u30af\u30bb\u30eb\u3067\u8a66\u3057\u3066\u307f\u308b\u3068\u30fb\u30fb\u30fb\n\n\u4e0a\u624b\u304f\u884c\u304d\u307e\u3057\u305f\uff01\uff08\u753b\u9762\u304c\u7070\u8272\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u30ea\u30ed\u30fc\u30c9\u306e\u305f\u3081\uff09\n\n\u30a8\u30af\u30bb\u30eb5\u30d5\u30a1\u30a4\u30eb\u3001\u8a0840\u500b\u306e\u753b\u50cf\u3067\u3082\u6b63\u5e38\u306b\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u524d\u63d0\n\n\u30a8\u30af\u30bb\u30eb\u306e\u5f62\u5f0f\u306fxlsx\n\u753b\u50cf\u306e\u7a2e\u985e\u306fJPG\u3001GIF\u3001PNG\nkintone\u306e\u30d5\u30a9\u30fc\u30e0\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\n\n\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7\n\u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9\n\n\n\n\n\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\nexcelFile\n\n\n\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\n\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\nimageFile\n\n\n\n\u30b9\u30da\u30fc\u30b9\nbutton\n\n\n\n\nJS/CSS\u8a2d\u5b9a\u306f\u4ee5\u4e0b\n\n\nhttps://js.cybozu.com/jquery/2.2.0/jquery.min.js\nhttps://js.cybozu.com/jszip/v2.5.0/jszip.min.js\n\u2193\u306eJS\u30d5\u30a1\u30a4\u30eb\uff08\u30dc\u30bf\u30f3\u3092\u5c11\u3057\u7dba\u9e97\u306b\u3059\u308b\u5834\u5408\u306fCSS\u30d5\u30a1\u30a4\u30eb\u3082\uff09\n\n\n\n\nsample.js\n(function() {\n    'use strict';\n\n    kintone.events.on('app.record.detail.show', parseExcel);\n\n    function parseExcel(event) {\n        var button = kintone.app.record.getSpaceElement('button');\n        $(button).append('<button id=\"parseExcelButton\">\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092kintone\u306b\u767b\u9332\uff01</button>');\n        $(button).append('<div id=\"parseExcelMessage\"></div>');\n\n        var record = event.record;\n\n        $('#parseExcelButton').on('click', function(e) {\n            $(this).prop('disabled', true);\n            e.preventDefault();\n\n            var files = record.excelFile.value;\n            var excelFileKeys = [];\n            for (var i = 0; i < files.length; i++) {\n                if (files[i].contentType !== 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {\n                    continue;\n                }\n                excelFileKeys.push(files[i].fileKey);\n            }\n            if (excelFileKeys.length === 0) {\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002');\n                return false;\n            }\n\n            Promise.all(excelFileKeys.map(function(excelFileKey) {\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u4e2d...');\n\n                return getFile(excelFileKey);\n            })).then(function(blobList) {\n                console.log('[SUCCESS] get excel files.');\n\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u53d6\u5f97\u4e2d...');\n\n                // 2\u6b21\u5143\u914d\u5217\u30921\u6b21\u5143\u914d\u5217\u306b\n                var blobs = Array.prototype.concat.apply([], blobList);\n\n                return Promise.all(blobs.map(function(blob) {\n                    return pickupImages(blob);\n                }));\n            }).then(function(imageList) {\n                console.log('[SUCCESS] get image files.');\n\n                $('#parseExcelMessage').text('\u753b\u50cf\u767b\u9332\u4e2d...');\n\n                var images = Array.prototype.concat.apply([], imageList);\n                return Promise.all(images.map(function(image) {\n                    return uploadImage(image);\n                }));\n            }).then(function(fileKeyList) {\n                console.log('[SUCCESS] upload image files.');\n\n                $('#parseExcelMessage').text('\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\u4e2d...');\n\n                var fileKeys = Array.prototype.concat.apply([], fileKeyList);\n                return updateRecord(fileKeys);\n            }).then(function() {\n                location.reload();\n            }).catch(function(error) {\n                console.log('[ERROR]', error);\n            });\n        });\n    }\n\n    // kintone\u306b\u6dfb\u4ed8\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n    function getFile(fileKey) {\n        var url = '/k/v1/file.json?fileKey=' + fileKey;\n        var df = new $.Deferred();\n        var xhr = new XMLHttpRequest();\n\n        xhr.open('GET', url, true);\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr.responseType = 'blob';\n\n        xhr.onload = function(e) {\n            if (this.status === 200) {\n                df.resolve(this.response);\n            }\n        };\n\n        xhr.send();\n        return df.promise();\n    }\n\n    // \u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092\u53d6\u5f97\n    function pickupImages(blob) {\n        var df = new $.Deferred();\n        var reader = new FileReader();\n        reader.readAsDataURL(blob);\n\n        // .xlsx\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n        reader.onload = function(e) {\n            var xlsxBase64 = e.target.result.split(',')[1];\n\n            var zip = new JSZip();\n            zip = zip.load(xlsxBase64, {base64: true});\n            var mediaFiles = zip.folder('xl/media').file(/^image/);\n\n            var images = [];\n            for (var i = 0; i < mediaFiles.length; i++) {\n                var filePath = mediaFiles[i].name;\n                var fileName = filePath.replace(/.*\\//, '');\n                var fileMime = toMimeType(filePath);\n\n                var arrayBuffer = zip.file(filePath).asArrayBuffer();\n                var imageBlob = new Blob([arrayBuffer], {type: fileMime});\n                images[i] = {'name': fileName, 'blob': imageBlob};\n            }\n\n            df.resolve(images);\n        };\n\n        return df.promise();\n    }\n\n    // \u753b\u50cf\u3092kintone\u306b\u767b\u9332\u3057\u3001fileKey\u3092\u8fd4\u3059\n    function uploadImage(image) {\n        return new Promise(function(resolve, reject) {\n            var formData = new FormData();\n            formData.append('__REQUEST_TOKEN__', kintone.getRequestToken());\n            formData.append('file', image.blob, image.name);\n\n            var xhr = new XMLHttpRequest();\n            xhr.open('POST', '/k/v1/file.json', true);\n            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n            xhr.onload = function(e) {\n                if (this.status === 200) {\n                    var res = JSON.parse(this.responseText);\n                    resolve(res.fileKey);\n                } else {\n                    reject(JSON.parse(this.responseText));\n                }\n            };\n\n            xhr.send(formData);\n        });\n    }\n\n    // \u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\n    function updateRecord(fileKeys) {\n        var appId = kintone.app.getId();\n        var recId = kintone.app.record.getId();\n\n        var putData = {\n            'app': appId,\n            'id': recId,\n            'record': {\n                'imageFile': {\n                    'value': []\n                }\n            }\n        };\n\n        for (var i = 0; i < fileKeys.length; i++) {\n            putData.record['imageFile'].value.push({'fileKey': fileKeys[i]});\n        }\n\n        return kintone.api('/k/v1/record', 'PUT', putData);\n    }\n\n    // MimeType\u3092\u8fd4\u3059\n    function toMimeType(filePath) {\n        var reg = /(.*)(?:\\.([^.]+$))/;\n        var fileExt = filePath.match(reg)[2];\n\n        var mimeType = '';\n        switch (fileExt.toLowerCase()) {\n            case 'jpg':\n                mimeType = 'image/jpeg';\n                break;\n            case 'jpeg':\n                mimeType = 'image/jpeg';\n                break;\n            case 'png':\n                mimeType = 'image/png';\n                break;\n            case 'gif':\n                mimeType = 'image/gif';\n                break;\n        }\n\n        return mimeType;\n    }\n\n})();\n\n\n\nsample.css\nbutton#parseExcelButton{\n    display: block;\n    padding: 10px;\n    margin: 20px;\n    text-align: center;\n    border: 3px solid;\n    border-color: #ccc #999 #999 #ccc;\n    color: #666\n}\n\nbutton#parseExcelButton:hover{\n    background: #aaa;\n    color: #fff;\n}\n\ndiv#parseExcelMessage{\n    display: block;\n    padding: 10px;\n    margin: 20px;\n    text-align: center;\n}\n\n\n\nkintone\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9\nkintone\u9762\u767d\u305d\u3046\u3060\u306a\uff5e\u3068\u601d\u3063\u305f\u65b9\u306f5\u30e6\u30fc\u30b6\u30fc\u30011\u5e74\u9593\u7121\u511f\u306e\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9\u3092\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\nkintone\u3063\u3066[\u5168\u6587\u691c\u7d22](https://kintone.cybozu.com/jp/feature/application.html#search)\u3068\u3044\u3046\u4fbf\u5229\u306a\u6a5f\u80fd\u304c\u3042\u308b\u3093\u3067\u3059\u3088\u3002\n\u30a8\u30af\u30bb\u30eb\u696d\u52d9\u306ekintone\u4e57\u308a\u63db\u3048\u3082\u591a\u3044\u3093\u3067\u3059\u3088\u3002\n\n\u4e57\u308a\u63db\u3048\u6642\u306b\u3001\u5168\u6587\u691c\u7d22\u3082\u3042\u308b\u3057\u3001\u3068\u308a\u3042\u3048\u305a\u624b\u5143\u306b\u3042\u308b\u30a8\u30af\u30bb\u30eb\u3092\u5168\u90e8\u767b\u9332\u3057\u3068\u304f\u304b\uff01\n\u3068\u3044\u3046\u8a71\u3082\u3042\u308b\u3068\u601d\u3046\u3093\u3067\u3059\u3088\u30fb\u30fb\u30fb\u591a\u5206\u30fb\u30fb\u30fb\u304d\u3063\u3068\u3069\u3053\u304b\u306b\u30fb\u30fb\u30fb\n\n\u3068\u3044\u3046\u3053\u3068\u3067\uff08\uff1f\uff09\u3001\u6614\u306e\u30c7\u30fc\u30bf\u3092\u63a2\u3059\u6642\u306b\u30a8\u30af\u30bb\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u306a\u304f\u3001kintone\u4e0a\u3067\u30a8\u30af\u30bb\u30eb\u5185\u306e\u753b\u50cf\u3060\u3051\u3067\u3082\u898b\u3089\u308c\u305f\u3089\u4fbf\u5229\u3060\u306a\u3068\u601d\u3044\u7acb\u3061\u30fb\u30fb\u30fb\u601d\u3044\u7acb\u3063\u305f\u304c\u5409\u65e5\uff01\n\u307e\u305a\u306f[developer network](https://cybozudev.zendesk.com/hc/ja)\u306a\u3069\u3067\u4f3c\u305f\u8a18\u4e8b\u304c\u306a\u3044\u304b\u78ba\u8a8d \u03c6(\u30fb\u03c9\u30fb )\n\u306a\u304b\u3063\u305f\u306e\u3067\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092kintone\u306b\u767b\u9332\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u3067\u304d\u308b\u3053\u3068\nkintone\u306b\u6dfb\u4ed8\u3055\u308c\u305f\u30a8\u30af\u30bb\u30eb\u5185\u306e\u753b\u50cf\u3092\u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u767b\u9332\u3059\u308b\u3002\n\u6587\u5b57\u30c7\u30fc\u30bf\u306f\u672a\u5bfe\u5fdc\u3067\u3059\u304c\u3001\u3082\u3046\u5c11\u3057\u9811\u5f35\u308c\u3070\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u51fa\u6765\u4e0a\u304c\u308a\u306e\u30a4\u30e1\u30fc\u30b8\n\u4eca\u56de\u306f\u7d50\u679c\u304b\u3089\uff01\n\u2193\u306e\u3088\u3046\u306b2\u30b7\u30fc\u30c8\u306b\u8a085\u679a\u306e\u753b\u50cf\u304c\u633f\u5165\u3055\u308c\u3066\u3044\u308b\u30a8\u30af\u30bb\u30eb\u3067\u8a66\u3057\u3066\u307f\u308b\u3068\u30fb\u30fb\u30fb\n![excel5.jpg](https://qiita-image-store.s3.amazonaws.com/0/102790/22a96204-6073-e454-5151-7f8b4fa18c21.jpeg)\n\n\u4e0a\u624b\u304f\u884c\u304d\u307e\u3057\u305f\uff01\uff08\u753b\u9762\u304c\u7070\u8272\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u306f\u30ea\u30ed\u30fc\u30c9\u306e\u305f\u3081\uff09\n[![https://gyazo.com/ca147339e435c40b59bab856dd2829ba](https://i.gyazo.com/ca147339e435c40b59bab856dd2829ba.gif)](https://gyazo.com/ca147339e435c40b59bab856dd2829ba)\n\n\u30a8\u30af\u30bb\u30eb5\u30d5\u30a1\u30a4\u30eb\u3001\u8a0840\u500b\u306e\u753b\u50cf\u3067\u3082\u6b63\u5e38\u306b\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u524d\u63d0\n- \u30a8\u30af\u30bb\u30eb\u306e\u5f62\u5f0f\u306fxlsx\n- \u753b\u50cf\u306e\u7a2e\u985e\u306fJPG\u3001GIF\u3001PNG\n- kintone\u306e\u30d5\u30a9\u30fc\u30e0\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\n\n| \u30d5\u30a3\u30fc\u30eb\u30c9\u540d | \u30d5\u30a3\u30fc\u30eb\u30c9\u30bf\u30a4\u30d7 | \u30d5\u30a3\u30fc\u30eb\u30c9\u30b3\u30fc\u30c9 |\n|----------|----------------|------------------|\n| \u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb | \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb | excelFile |\n| \u753b\u50cf\u30d5\u30a1\u30a4\u30eb | \u6dfb\u4ed8\u30d5\u30a1\u30a4\u30eb | imageFile |\n|  | \u30b9\u30da\u30fc\u30b9 | button |\n- JS/CSS\u8a2d\u5b9a\u306f\u4ee5\u4e0b\n - https://js.cybozu.com/jquery/2.2.0/jquery.min.js\n - https://js.cybozu.com/jszip/v2.5.0/jszip.min.js\n - \u2193\u306eJS\u30d5\u30a1\u30a4\u30eb\uff08\u30dc\u30bf\u30f3\u3092\u5c11\u3057\u7dba\u9e97\u306b\u3059\u308b\u5834\u5408\u306fCSS\u30d5\u30a1\u30a4\u30eb\u3082\uff09\n\n```js:sample.js\n(function() {\n    'use strict';\n\n    kintone.events.on('app.record.detail.show', parseExcel);\n\n    function parseExcel(event) {\n        var button = kintone.app.record.getSpaceElement('button');\n        $(button).append('<button id=\"parseExcelButton\">\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092kintone\u306b\u767b\u9332\uff01</button>');\n        $(button).append('<div id=\"parseExcelMessage\"></div>');\n\n        var record = event.record;\n\n        $('#parseExcelButton').on('click', function(e) {\n            $(this).prop('disabled', true);\n            e.preventDefault();\n\n            var files = record.excelFile.value;\n            var excelFileKeys = [];\n            for (var i = 0; i < files.length; i++) {\n                if (files[i].contentType !== 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet') {\n                    continue;\n                }\n                excelFileKeys.push(files[i].fileKey);\n            }\n            if (excelFileKeys.length === 0) {\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u304c\u767b\u9332\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002');\n                return false;\n            }\n\n            Promise.all(excelFileKeys.map(function(excelFileKey) {\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\u4e2d...');\n\n                return getFile(excelFileKey);\n            })).then(function(blobList) {\n                console.log('[SUCCESS] get excel files.');\n\n                $('#parseExcelMessage').text('\u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u53d6\u5f97\u4e2d...');\n\n                // 2\u6b21\u5143\u914d\u5217\u30921\u6b21\u5143\u914d\u5217\u306b\n                var blobs = Array.prototype.concat.apply([], blobList);\n\n                return Promise.all(blobs.map(function(blob) {\n                    return pickupImages(blob);\n                }));\n            }).then(function(imageList) {\n                console.log('[SUCCESS] get image files.');\n\n                $('#parseExcelMessage').text('\u753b\u50cf\u767b\u9332\u4e2d...');\n\n                var images = Array.prototype.concat.apply([], imageList);\n                return Promise.all(images.map(function(image) {\n                    return uploadImage(image);\n                }));\n            }).then(function(fileKeyList) {\n                console.log('[SUCCESS] upload image files.');\n\n                $('#parseExcelMessage').text('\u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\u4e2d...');\n\n                var fileKeys = Array.prototype.concat.apply([], fileKeyList);\n                return updateRecord(fileKeys);\n            }).then(function() {\n                location.reload();\n            }).catch(function(error) {\n                console.log('[ERROR]', error);\n            });\n        });\n    }\n\n    // kintone\u306b\u6dfb\u4ed8\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n    function getFile(fileKey) {\n        var url = '/k/v1/file.json?fileKey=' + fileKey;\n        var df = new $.Deferred();\n        var xhr = new XMLHttpRequest();\n\n        xhr.open('GET', url, true);\n        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n        xhr.responseType = 'blob';\n\n        xhr.onload = function(e) {\n            if (this.status === 200) {\n                df.resolve(this.response);\n            }\n        };\n\n        xhr.send();\n        return df.promise();\n    }\n\n    // \u30a8\u30af\u30bb\u30eb\u30d5\u30a1\u30a4\u30eb\u5185\u306e\u753b\u50cf\u3092\u53d6\u5f97\n    function pickupImages(blob) {\n        var df = new $.Deferred();\n        var reader = new FileReader();\n        reader.readAsDataURL(blob);\n\n        // .xlsx\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n        reader.onload = function(e) {\n            var xlsxBase64 = e.target.result.split(',')[1];\n\n            var zip = new JSZip();\n            zip = zip.load(xlsxBase64, {base64: true});\n            var mediaFiles = zip.folder('xl/media').file(/^image/);\n\n            var images = [];\n            for (var i = 0; i < mediaFiles.length; i++) {\n                var filePath = mediaFiles[i].name;\n                var fileName = filePath.replace(/.*\\//, '');\n                var fileMime = toMimeType(filePath);\n\n                var arrayBuffer = zip.file(filePath).asArrayBuffer();\n                var imageBlob = new Blob([arrayBuffer], {type: fileMime});\n                images[i] = {'name': fileName, 'blob': imageBlob};\n            }\n\n            df.resolve(images);\n        };\n\n        return df.promise();\n    }\n\n    // \u753b\u50cf\u3092kintone\u306b\u767b\u9332\u3057\u3001fileKey\u3092\u8fd4\u3059\n    function uploadImage(image) {\n        return new Promise(function(resolve, reject) {\n            var formData = new FormData();\n            formData.append('__REQUEST_TOKEN__', kintone.getRequestToken());\n            formData.append('file', image.blob, image.name);\n\n            var xhr = new XMLHttpRequest();\n            xhr.open('POST', '/k/v1/file.json', true);\n            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n            xhr.onload = function(e) {\n                if (this.status === 200) {\n                    var res = JSON.parse(this.responseText);\n                    resolve(res.fileKey);\n                } else {\n                    reject(JSON.parse(this.responseText));\n                }\n            };\n\n            xhr.send(formData);\n        });\n    }\n\n    // \u30ec\u30b3\u30fc\u30c9\u66f4\u65b0\n    function updateRecord(fileKeys) {\n        var appId = kintone.app.getId();\n        var recId = kintone.app.record.getId();\n\n        var putData = {\n            'app': appId,\n            'id': recId,\n            'record': {\n                'imageFile': {\n                    'value': []\n                }\n            }\n        };\n\n        for (var i = 0; i < fileKeys.length; i++) {\n            putData.record['imageFile'].value.push({'fileKey': fileKeys[i]});\n        }\n\n        return kintone.api('/k/v1/record', 'PUT', putData);\n    }\n\n    // MimeType\u3092\u8fd4\u3059\n    function toMimeType(filePath) {\n        var reg = /(.*)(?:\\.([^.]+$))/;\n        var fileExt = filePath.match(reg)[2];\n\n        var mimeType = '';\n        switch (fileExt.toLowerCase()) {\n            case 'jpg':\n                mimeType = 'image/jpeg';\n                break;\n            case 'jpeg':\n                mimeType = 'image/jpeg';\n                break;\n            case 'png':\n                mimeType = 'image/png';\n                break;\n            case 'gif':\n                mimeType = 'image/gif';\n                break;\n        }\n\n        return mimeType;\n    }\n\n})();\n```\n\n```css:sample.css\nbutton#parseExcelButton{\n    display: block;\n    padding: 10px;\n    margin: 20px;\n    text-align: center;\n    border: 3px solid;\n    border-color: #ccc #999 #999 #ccc;\n    color: #666\n}\n\nbutton#parseExcelButton:hover{\n    background: #aaa;\n    color: #fff;\n}\n\ndiv#parseExcelMessage{\n    display: block;\n    padding: 10px;\n    margin: 20px;\n    text-align: center;\n}\n```\n\n# kintone\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9\nkintone\u9762\u767d\u305d\u3046\u3060\u306a\uff5e\u3068\u601d\u3063\u305f\u65b9\u306f5\u30e6\u30fc\u30b6\u30fc\u30011\u5e74\u9593\u7121\u511f\u306e[\u958b\u767a\u8005\u30e9\u30a4\u30bb\u30f3\u30b9](https://cybozudev.zendesk.com/hc/ja/)\u3092\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n", "tags": ["JavaScript", "kintone", "Excel"]}