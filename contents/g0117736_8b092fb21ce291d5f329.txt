{"context": " More than 1 year has passed since last update.\u30aa\u30ec\u30aa\u30ec\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3059\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u3084\u308a\u65b9\u3092\u8a18\u9332\u306b\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u305d\u3082\u305d\u3082\u3001\u30aa\u30ec\u30aa\u30ec\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306e\u4f5c\u308a\u65b9\u306a\u3093\u304b\u306f\u3001\u30b0\u30b0\u3063\u3066\u3082\u3042\u307e\u308a\u51fa\u3066\u3053\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u79c1\u304c\u898b\u3064\u3051\u305f\u60c5\u5831\u3060\u3068 \u60c5\u5831 1, \u60c5\u5831 2 (\u60c5\u5831 1 \u3068\u540c\u3058\u5185\u5bb9), \u60c5\u5831 3, \u60c5\u5831 4 \u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3044\u307e\u3044\u3061\u60c5\u5831\u4e0d\u8db3\u3067\u3059\u3002\u30b0\u30b0\u308a\u65b9\u304c\u307e\u305a\u3044\u306e\u304b\u3001\u82f1\u8a9e\u306e\u30da\u30fc\u30b8\u3067\u3082\u3042\u307e\u308a\u60c5\u5831\u304c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u3053\u308c\u4ee5\u964d\u3001\u4e0a\u8a18\u306e\u60c5\u5831\u304c\u6b63\u3057\u3044\u3068\u4fe1\u3058\u3066\u9032\u307f\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u4f7f\u7528\u3059\u308b openssl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 1.0.2 \u3067\u3001\u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u3082\u306e\u3092 /opt/openssl-1.0.2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002Web \u30b5\u30fc\u30d0\u306b\u306f Apache \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.4.10 \u3067\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306f\u30b3\u30d4\u30da\u3057\u3084\u3059\u3055\u3092\u91cd\u8996\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u660e\u793a\u7684\u306b\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\u3044\u3061\u3044\u3061 man \u3067\u8abf\u3079\u306a\u304f\u3066\u3082\u6e08\u3080\u304b\u3089\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u5197\u9577\u306a\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\nopenssl.cnf \u306f\u8a8d\u8a3c\u5c40\u3054\u3068\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u5229\u7528\u3059\u308b\u3082\u306e\u3068\u52dd\u624b\u306b\u7406\u89e3\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u4f55\u500b\u3082\u8a8d\u8a3c\u5c40\u3092\u4f5c\u308b\u306e\u3067 openssl.cnf \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3059\u3002\u8a8d\u8a3c\u5c40\u3054\u3068\u306b\u66f8\u304d\u63db\u3048\u305f\u308a\u3057\u307e\u305b\u3093 (\u3082\u3061\u308d\u3093\u66f8\u304d\u63db\u3048\u3066\u3082\u69cb\u3044\u307e\u305b\u3093)\u3002\u8a8d\u8a3c\u5c40\u3054\u3068\u306e\u5dee\u9055\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u307e\u305f\u9577\u3044\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\u8a8d\u8a3c\u5c40\u306e\u69cb\u6210\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nCN \u306f\u30b3\u30e2\u30f3\u30cd\u30fc\u30e0 (Common Name) \u306e\u7565\u3067\u3059\u3002\n\n\u524d\u6e96\u5099\n\u4f5c\u696d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u4e3b\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u521d\u671f\u72b6\u614b\u3068\u3057\u3066\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002~ \u3084 dir \u306f\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3061\u308d\u3093\u305d\u306e\u307e\u307e\u30b3\u30d4\u30da\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\numask 077\ncd ~\nrm -rf dir\nmkdir dir\ncd dir\nmkdir server\nmkdir -p root1024/demoCA/newcerts root1024/demoCA/private\nmkdir -p root2048/demoCA/newcerts root2048/demoCA/private\nmkdir -p interCA/demoCA/newcerts  interCA/demoCA/private\nmkdir -p crossCA/demoCA/newcerts  crossCA/demoCA/private\n(cd root1024; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd root2048; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd interCA; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd crossCA; touch demoCA/index.txt; echo 01 > demoCA/serial)\n\nopenssl.cnf \u3092\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u3044\u307e\u308f\u3057\u307e\u3059\u3002\u79c1\u306f openssl \u3092 /opt/openssl-1.0.2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001/opt/openssl-1.0.2/ssl/openssl.cnf \u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u3044\u307e\u3059\u3002~/dir/openssl.cnf \u306f\u3001\u3053\u306e\u6642\u70b9\u3067\u90fd\u5408\u306e\u3044\u3044\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\ncp /opt/openssl-1.0.2/ssl/openssl.cnf ~/dir/openssl.cnf\n\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (2048 bit)\n\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 (2048 bit) \u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR\uff08Certificate Signing Request; \u8a3c\u660e\u66f8\u7f72\u540d\u8981\u6c42) \u3092\u751f\u6210\u3057\u3001\u81ea\u5df1\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/root2048/demoCA/cacert.pem \u304c\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\ncd ~/dir/root2048\nopenssl req -new -newkey rsa:2048 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:AAA Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:AAA ROOT CA 2048\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n\n\u81ea\u5df1\u7f72\u540d\ncd ~/dir/root2048\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     demoCA/cacert.pem \\\n        -selfsign -days 3650 -extensions v3_ca -batch\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB (1024 bit)\n\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 (1024 bit) \u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u81ea\u5df1\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/root1024/demoCA/cacert.pem \u304c\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\ncd ~/dir/root1024\nopenssl req -new -newkey rsa:1024 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:BBB Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:BBB ROOT CA 1024\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n\n\u81ea\u5df1\u7f72\u540d\ncd ~/dir/root1024\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     demoCA/cacert.pem \\\n        -selfsign -days 3650 -extensions v3_ca -batch\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC\n\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u3067\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/interCA/demoCA/cacert.pem \u304c\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\ncd ~/dir/interCA\nopenssl req -new -newkey rsa:2048 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:CCC Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:CCC Inter CA\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u3067\u7f72\u540d\ncd ~/dir/root2048\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../interCA/demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     ../interCA/demoCA/cacert.pem \\\n        -days 3650 -extensions v3_ca -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u3067\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/server/server.crt \u304c\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\ncd ~/dir/server\nopenssl genrsa 2048 > server.key\nopenssl req -new -sha256 -key server.key > server.csr\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:EEE CO., LTD.\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:www.example.jp\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n\n\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u3067\u7f72\u540d\ncd ~/dir/interCA\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../server/server.csr \\\n        -out     ../server/server.crt \\\n        -keyfile demoCA/private/cakey.pem \\\n        -cert    demoCA/cacert.pem \\\n        -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u78ba\u8a8d (\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u306a\u3057)\n\u3053\u306e\u6642\u70b9\u3067\u3001\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u306a\u3057\u306e\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002~/dir/server/server.key \u3068 ~/dir/server/server.crt \u3092\u305d\u308c\u305e\u308c Apache \u306e SSLCertificateKeyFile \u3068 SSLCertificateFile \u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u306e\u4e2d\u9593 CA \u8a3c\u660e\u66f8 ~/dir/interCA/demoCA/cacert.pem \u306f SSLCertificateChainFile \u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/root2048/demoCA/cacert.pem \u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 (\u4f8b\u3048\u3070 Firefox) \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nFirefox \u3067\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b 3 \u968e\u5c64\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nopenssl \u306e s_client \u306a\u3089\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nopenssl s_client \\\n        -CAfile ~/dir/root2048/demoCA/cacert.pem -trusted_first \\\n        -connect www.example.jp:443  < /dev/null\nCONNECTED(00000003)\ndepth=2 C = JP, ST = Chiba, O = AAA Corporation, CN = AAA ROOT CA 2048\nverify return:1\ndepth=1 C = JP, ST = Chiba, O = CCC Corporation, CN = CCC Inter CA\nverify return:1\ndepth=0 C = JP, ST = Chiba, O = \"EEE CO., LTD.\", CN = www.example.jp\nverify return:1\n---\nCertificate chain\n 0 s:/C=JP/ST=Chiba/O=EEE CO., LTD./CN=www.example.jp\n   i:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n 1 s:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n   i:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n---\n(\u4e2d\u7565)\n    Verify return code: 0 (ok)\n---\nDONE\n\n\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\n\n\u79d8\u5bc6\u9375\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 DDD (crossCA) \u306e\u79d8\u5bc6\u9375\u3068 \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e\u79d8\u5bc6\u9375\u306f\u540c\u3058\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\u30b3\u30d4\u30fc\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\ncd ~/dir\nln -s ../../../root2048/demoCA/private/cakey.pem crossCA/demoCA/private/cakey.pem\n\n\nCSR \u306e\u751f\u6210\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 DDD (crossCA) \u306e Organization Name \u3084 CN \u306f\u3001\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e CN \u3068\u540c\u3058\u3082\u306e\u306b\u3057\u307e\u3059\u3002\ncd ~/dir/crossCA\nopenssl req -new -sha256 \\\n        -key demoCA/private/cakey.pem \\\n        -out demoCA/careq.pem\nEnter pass phrase for demoCA/private/cakey.pem:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:AAA Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:AAA ROOT CA 2048\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB (root1024) \u3067\u7f72\u540d\ncd ~/dir/root1024\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../crossCA/demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     ../crossCA/demoCA/cacert.pem \\\n        -days 3650 -extensions v3_ca -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n\n\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u78ba\u8a8d (\u30af\u30ed\u30b9\u30eb\u30fc\u30c8)\n\u4eca\u3001\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u304c Apache \u306e SSLCertificateChainFile \u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/crossCA/demoCA/cacert.pem \u306e\u5185\u5bb9\u3092\u8ffd\u52a0\u66f8\u304d\u8fbc\u307f\u3057\u307e\u3059\u3002\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/root1024/demoCA/cacert.pem \u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u5148\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nFirefox \u3067\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b 4 \u968e\u5c64\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\nopenssl \u306e s_client \u306a\u3089\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nopenssl s_client \\\n        -CAfile ~/dir/root1024/demoCA/cacert.pem -trusted_first \\\n        -connect www.example.jp:443  < /dev/null\nCONNECTED(00000003)\ndepth=3 C = JP, ST = Chiba, O = BBB Corporation, CN = BBB ROOT CA 1024\nverify return:1\ndepth=2 C = JP, ST = Chiba, O = AAA Corporation, CN = AAA ROOT CA 2048\nverify return:1\ndepth=1 C = JP, ST = Chiba, O = CCC Corporation, CN = CCC Inter CA\nverify return:1\ndepth=0 C = JP, ST = Chiba, O = \"EEE CO., LTD.\", CN = www.example.jp\nverify return:1\n---\nCertificate chain\n 0 s:/C=JP/ST=Chiba/O=EEE CO., LTD./CN=www.example.jp\n   i:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n 1 s:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n   i:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n 2 s:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n   i:/C=JP/ST=Chiba/O=BBB Corporation/CN=BBB ROOT CA 1024\n---\n(\u4e2d\u7565)\n    Verify return code: 0 (ok)\n---\nDONE\n\n\n\u30aa\u30ec\u30aa\u30ec\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3059\u308b\u6a5f\u4f1a\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u3084\u308a\u65b9\u3092\u8a18\u9332\u306b\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u305d\u3082\u305d\u3082\u3001\u30aa\u30ec\u30aa\u30ec\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306e\u4f5c\u308a\u65b9\u306a\u3093\u304b\u306f\u3001\u30b0\u30b0\u3063\u3066\u3082\u3042\u307e\u308a\u51fa\u3066\u3053\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u79c1\u304c\u898b\u3064\u3051\u305f\u60c5\u5831\u3060\u3068 [\u60c5\u5831 1](http://soudan1.biglobe.ne.jp/qa8201691.html \"BIGLOBE \u306a\u3093\u3067\u3082\u76f8\u8ac7\u5ba4\"), [\u60c5\u5831 2 (\u60c5\u5831 1 \u3068\u540c\u3058\u5185\u5bb9)](http://okwave.jp/qa/q8201691.html \"OKWave\"), [\u60c5\u5831 3](http://brenhilt.com/tech/2013/0211 \"brenhilt.com\"), [\u60c5\u5831 4](http://ascii.jp/elem/000/000/550/550214/img.html \"ascii.jp\") \u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u3044\u307e\u3044\u3061\u60c5\u5831\u4e0d\u8db3\u3067\u3059\u3002\u30b0\u30b0\u308a\u65b9\u304c\u307e\u305a\u3044\u306e\u304b\u3001\u82f1\u8a9e\u306e\u30da\u30fc\u30b8\u3067\u3082\u3042\u307e\u308a\u60c5\u5831\u304c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\n\u3053\u308c\u4ee5\u964d\u3001\u4e0a\u8a18\u306e\u60c5\u5831\u304c\u6b63\u3057\u3044\u3068\u4fe1\u3058\u3066\u9032\u307f\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u4f7f\u7528\u3059\u308b openssl \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 1.0.2 \u3067\u3001\u30bd\u30fc\u30b9\u304b\u3089\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u305f\u3082\u306e\u3092 /opt/openssl-1.0.2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002Web \u30b5\u30fc\u30d0\u306b\u306f Apache \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f 2.4.10 \u3067\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306f\u30b3\u30d4\u30da\u3057\u3084\u3059\u3055\u3092\u91cd\u8996\u3057\u3066\u66f8\u3044\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001\u30aa\u30d7\u30b7\u30e7\u30f3\u5f15\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u660e\u793a\u7684\u306b\u5f15\u6570\u3067\u6307\u5b9a\u3057\u305f\u308a\u3057\u3066\u3044\u307e\u3059\u3002\u3044\u3061\u3044\u3061 man \u3067\u8abf\u3079\u306a\u304f\u3066\u3082\u6e08\u3080\u304b\u3089\u3067\u3059\u3002\u306a\u306e\u3067\u3001\u5197\u9577\u306a\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\nopenssl.cnf \u306f\u8a8d\u8a3c\u5c40\u3054\u3068\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u5229\u7528\u3059\u308b\u3082\u306e\u3068\u52dd\u624b\u306b\u7406\u89e3\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u4f55\u500b\u3082\u8a8d\u8a3c\u5c40\u3092\u4f5c\u308b\u306e\u3067 openssl.cnf \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u4f7f\u3044\u307e\u3059\u3002\u8a8d\u8a3c\u5c40\u3054\u3068\u306b\u66f8\u304d\u63db\u3048\u305f\u308a\u3057\u307e\u305b\u3093 (\u3082\u3061\u308d\u3093\u66f8\u304d\u63db\u3048\u3066\u3082\u69cb\u3044\u307e\u305b\u3093)\u3002\u8a8d\u8a3c\u5c40\u3054\u3068\u306e\u5dee\u9055\u306f\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u307e\u305f\u9577\u3044\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u8a8d\u8a3c\u5c40\u306e\u69cb\u6210\u306f\u4e0b\u56f3\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n![aa.png](https://qiita-image-store.s3.amazonaws.com/0/65370/59c0fe84-2547-61c7-73e0-ff7d97187a55.png)\nCN \u306f\u30b3\u30e2\u30f3\u30cd\u30fc\u30e0 (Common Name) \u306e\u7565\u3067\u3059\u3002\n\n\n### \u524d\u6e96\u5099\n\n\u4f5c\u696d\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u4e3b\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n![tree.png](https://qiita-image-store.s3.amazonaws.com/0/65370/c941b137-47a2-111c-43a0-cd27c43af675.png)\n\u521d\u671f\u72b6\u614b\u3068\u3057\u3066\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3084\u30d5\u30a1\u30a4\u30eb\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002~ \u3084 dir \u306f\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u3082\u3061\u308d\u3093\u305d\u306e\u307e\u307e\u30b3\u30d4\u30da\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\n```shell-session\numask 077\ncd ~\nrm -rf dir\nmkdir dir\ncd dir\nmkdir server\nmkdir -p root1024/demoCA/newcerts root1024/demoCA/private\nmkdir -p root2048/demoCA/newcerts root2048/demoCA/private\nmkdir -p interCA/demoCA/newcerts  interCA/demoCA/private\nmkdir -p crossCA/demoCA/newcerts  crossCA/demoCA/private\n(cd root1024; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd root2048; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd interCA; touch demoCA/index.txt; echo 01 > demoCA/serial)\n(cd crossCA; touch demoCA/index.txt; echo 01 > demoCA/serial)\n```\n\nopenssl.cnf \u3092\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u3044\u307e\u308f\u3057\u307e\u3059\u3002\u79c1\u306f openssl \u3092 /opt/openssl-1.0.2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u4f7f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001/opt/openssl-1.0.2/ssl/openssl.cnf \u304b\u3089\u30b3\u30d4\u30fc\u3057\u3066\u3044\u307e\u3059\u3002~/dir/openssl.cnf \u306f\u3001\u3053\u306e\u6642\u70b9\u3067\u90fd\u5408\u306e\u3044\u3044\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\n```shell-session\ncp /opt/openssl-1.0.2/ssl/openssl.cnf ~/dir/openssl.cnf\n```\n\n\n### \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (2048 bit)\n\n\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 (2048 bit) \u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR\uff08Certificate Signing Request; \u8a3c\u660e\u66f8\u7f72\u540d\u8981\u6c42) \u3092\u751f\u6210\u3057\u3001\u81ea\u5df1\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/root2048/demoCA/cacert.pem \u304c\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n#### \u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\n\n```shell-session\ncd ~/dir/root2048\nopenssl req -new -newkey rsa:2048 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:AAA Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:AAA ROOT CA 2048\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n```\n\n\n#### \u81ea\u5df1\u7f72\u540d\n\n```shell-session\ncd ~/dir/root2048\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     demoCA/cacert.pem \\\n        -selfsign -days 3650 -extensions v3_ca -batch\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\n### \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB (1024 bit)\n\n\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 (1024 bit) \u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u81ea\u5df1\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/root1024/demoCA/cacert.pem \u304c\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n#### \u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\n\n```shell-session\ncd ~/dir/root1024\nopenssl req -new -newkey rsa:1024 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:BBB Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:BBB ROOT CA 1024\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n```\n\n\n#### \u81ea\u5df1\u7f72\u540d\n\n```shell-session\ncd ~/dir/root1024\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     demoCA/cacert.pem \\\n        -selfsign -days 3650 -extensions v3_ca -batch\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\n### \u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC\n\n\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u3067\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/interCA/demoCA/cacert.pem \u304c\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n#### \u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\n\n```shell-session\ncd ~/dir/interCA\nopenssl req -new -newkey rsa:2048 -sha256 \\\n        -keyout demoCA/private/cakey.pem \\\n        -out    demoCA/careq.pem\n(\u4e2d\u7565)\nEnter PEM pass phrase:********\nVerifying - Enter PEM pass phrase:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:CCC Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:CCC Inter CA\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n```\n\n\n#### \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u3067\u7f72\u540d\n\n```shell-session\ncd ~/dir/root2048\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../interCA/demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     ../interCA/demoCA/cacert.pem \\\n        -days 3650 -extensions v3_ca -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\n### \u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\n\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u79d8\u5bc6\u9375\u3068 CSR \u3092\u751f\u6210\u3057\u3001\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u3067\u7f72\u540d\u3057\u307e\u3059\u3002~/dir/server/server.crt \u304c\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n#### \u79d8\u5bc6\u9375\u3068 CSR \u306e\u751f\u6210\n\n```shell-session\ncd ~/dir/server\nopenssl genrsa 2048 > server.key\nopenssl req -new -sha256 -key server.key > server.csr\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:EEE CO., LTD.\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:www.example.jp\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n```\n\n#### \u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u3067\u7f72\u540d\n\n```shell-session\ncd ~/dir/interCA\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../server/server.csr \\\n        -out     ../server/server.crt \\\n        -keyfile demoCA/private/cakey.pem \\\n        -cert    demoCA/cacert.pem \\\n        -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n```\n\n\n### \u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u78ba\u8a8d (\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u306a\u3057)\n\n\u3053\u306e\u6642\u70b9\u3067\u3001\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u306a\u3057\u306e\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u304c\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002~/dir/server/server.key \u3068 ~/dir/server/server.crt \u3092\u305d\u308c\u305e\u308c Apache \u306e SSLCertificateKeyFile \u3068 SSLCertificateFile \u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u4e2d\u9593\u8a8d\u8a3c\u5c40 CCC (interCA) \u306e\u4e2d\u9593 CA \u8a3c\u660e\u66f8 ~/dir/interCA/demoCA/cacert.pem \u306f SSLCertificateChainFile \u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/root2048/demoCA/cacert.pem \u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 (\u4f8b\u3048\u3070 Firefox) \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nFirefox \u3067\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b 3 \u968e\u5c64\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n![tier3.png](https://qiita-image-store.s3.amazonaws.com/0/65370/5f572424-c88f-2e09-f104-c2738ff7d832.png)\n\n\nopenssl \u306e s_client \u306a\u3089\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```shell-session\nopenssl s_client \\\n        -CAfile ~/dir/root2048/demoCA/cacert.pem -trusted_first \\\n        -connect www.example.jp:443  < /dev/null\nCONNECTED(00000003)\ndepth=2 C = JP, ST = Chiba, O = AAA Corporation, CN = AAA ROOT CA 2048\nverify return:1\ndepth=1 C = JP, ST = Chiba, O = CCC Corporation, CN = CCC Inter CA\nverify return:1\ndepth=0 C = JP, ST = Chiba, O = \"EEE CO., LTD.\", CN = www.example.jp\nverify return:1\n---\nCertificate chain\n 0 s:/C=JP/ST=Chiba/O=EEE CO., LTD./CN=www.example.jp\n   i:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n 1 s:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n   i:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n---\n(\u4e2d\u7565)\n    Verify return code: 0 (ok)\n---\nDONE\n```\n\n\n### \u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\n\n#### \u79d8\u5bc6\u9375\n\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 DDD (crossCA) \u306e\u79d8\u5bc6\u9375\u3068 \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e\u79d8\u5bc6\u9375\u306f\u540c\u3058\u3082\u306e\u306b\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308a\u307e\u3059\u3002\u30b3\u30d4\u30fc\u3057\u3066\u3082\u69cb\u3044\u307e\u305b\u3093\u3002\n\n```shell-session\ncd ~/dir\nln -s ../../../root2048/demoCA/private/cakey.pem crossCA/demoCA/private/cakey.pem\n```\n\n\n#### CSR \u306e\u751f\u6210\n\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 DDD (crossCA) \u306e Organization Name \u3084 CN \u306f\u3001\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA (root2048) \u306e CN \u3068\u540c\u3058\u3082\u306e\u306b\u3057\u307e\u3059\u3002\n\n```shell-session\ncd ~/dir/crossCA\nopenssl req -new -sha256 \\\n        -key demoCA/private/cakey.pem \\\n        -out demoCA/careq.pem\nEnter pass phrase for demoCA/private/cakey.pem:********\n(\u4e2d\u7565)\nCountry Name (2 letter code) [AU]:JP\nState or Province Name (full name) [Some-State]:Chiba\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:AAA Corporation\nOrganizational Unit Name (eg, section) []:\nCommon Name (e.g. server FQDN or YOUR name) []:AAA ROOT CA 2048\nEmail Address []:\nPlease enter the following 'extra' attributes\nto be sent with your certificate request\nA challenge password []:\nAn optional company name []:\n```\n\n\n#### \u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB (root1024) \u3067\u7f72\u540d\n\n```shell-session\ncd ~/dir/root1024\nopenssl ca -config ~/dir/openssl.cnf \\\n        -md sha256 \\\n        -in      ../crossCA/demoCA/careq.pem \\\n        -keyfile demoCA/private/cakey.pem \\\n        -out     ../crossCA/demoCA/cacert.pem \\\n        -days 3650 -extensions v3_ca -batch -policy policy_anything\nUsing configuration from /home/g0117736/dir/openssl.cnf\nEnter pass phrase for demoCA/private/cakey.pem:********\nCheck that the request matches the signature\nSignature ok\n(\u4e2d\u7565)\nWrite out database with 1 new entries\nData Base Updated\n```\n\n### \u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u78ba\u8a8d (\u30af\u30ed\u30b9\u30eb\u30fc\u30c8)\n\n\u4eca\u3001\u4e2d\u9593 CA \u8a3c\u660e\u66f8\u304c Apache \u306e SSLCertificateChainFile \u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/crossCA/demoCA/cacert.pem \u306e\u5185\u5bb9\u3092\u8ffd\u52a0\u66f8\u304d\u8fbc\u307f\u3057\u307e\u3059\u3002\n\n\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 BBB \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8 ~/dir/root1024/demoCA/cacert.pem \u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u5148\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30eb\u30fc\u30c8\u8a8d\u8a3c\u5c40 AAA \u306e\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u306f SSL \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nFirefox \u3067\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u56f3\u306e\u3088\u3046\u306b 4 \u968e\u5c64\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n![tier4.png](https://qiita-image-store.s3.amazonaws.com/0/65370/330cf788-91cb-020a-520c-a4b409054d0b.png)\n\nopenssl \u306e s_client \u306a\u3089\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```shell-session\nopenssl s_client \\\n        -CAfile ~/dir/root1024/demoCA/cacert.pem -trusted_first \\\n        -connect www.example.jp:443  < /dev/null\nCONNECTED(00000003)\ndepth=3 C = JP, ST = Chiba, O = BBB Corporation, CN = BBB ROOT CA 1024\nverify return:1\ndepth=2 C = JP, ST = Chiba, O = AAA Corporation, CN = AAA ROOT CA 2048\nverify return:1\ndepth=1 C = JP, ST = Chiba, O = CCC Corporation, CN = CCC Inter CA\nverify return:1\ndepth=0 C = JP, ST = Chiba, O = \"EEE CO., LTD.\", CN = www.example.jp\nverify return:1\n---\nCertificate chain\n 0 s:/C=JP/ST=Chiba/O=EEE CO., LTD./CN=www.example.jp\n   i:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n 1 s:/C=JP/ST=Chiba/O=CCC Corporation/CN=CCC Inter CA\n   i:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n 2 s:/C=JP/ST=Chiba/O=AAA Corporation/CN=AAA ROOT CA 2048\n   i:/C=JP/ST=Chiba/O=BBB Corporation/CN=BBB ROOT CA 1024\n---\n(\u4e2d\u7565)\n    Verify return code: 0 (ok)\n---\nDONE\n```\n---\n", "tags": ["openssl", "Apache"]}