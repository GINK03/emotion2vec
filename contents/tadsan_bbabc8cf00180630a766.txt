{"tags": ["PHP7", "\u30dd\u30a8\u30e0"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u524d\u3001private/protected\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5916\u90e8\u304b\u3089\u8aad\u307f\u8fbc\u307f\u53ef\u80fd\u306b\u3059\u308b\u3092\u66f8\u3044\u305f\u3068\u304d\u3001\u8a18\u4e8b\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u3066\u300c\u30b3\u30ec\u30af\u30b7\u30e7\u30f3(\u914d\u5217)\u5185\u306e\u8981\u7d20\u306e\u578b\u3092\u691c\u8a3c\u3057\u305f\u3044\u3088\u30fc\u300d\u300c\u3067\u3082\u305d\u3046\u3059\u308b\u3068\u5168\u8981\u7d20\u3092\u691c\u8a3c\u3057\u306a\u304f\u3061\u3083\u3044\u3051\u306a\u3044\u304b\u3089\u5b9f\u884c\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u554f\u984c\u304c\u3042\u308b\u3088\u306d\u300d\u3063\u3066\u8a71\u3092\u3057\u307e\u3057\u305f\u3002\n\n\u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\nPHP: \u95a2\u6570\u306e\u5f15\u6570 - Manual\u3092\u8aad\u3093\u3067\u305f\u79c1\u306f\u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u3002PHP 5.6\u3067\u5b9f\u88c5\u3055\u308c\u305f\u6a5f\u80fd\u3092\u5de7\u307f\u306b\u5229\u7528\u3059\u308c\u3070\u30d0\u30ea\u30c7\u30fc\u30bf\u304c\u5b9f\u88c5\u53ef\u80fd\u306a\u3053\u3068\u306b\u3002\n\u2026\u2026\u305d\u3046\u3067\u3059\u3002\u53ef\u5909\u9577\u5f15\u6570\u3067\u3059\u3002\n\nPHP\u306e\u53ef\u5909\u9577\u5f15\u6570\u3068\u306f\nPHP 5.6\u3067\u8ffd\u52a0\u3055\u308c\u305f\u53ef\u5909\u9577\u5f15\u6570\u306f\u3001\u4ee5\u524d\u306e\u6587\u6cd5\u306b...\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u30670\u500b\u4ee5\u4e0a\u306e\u5024\u3092\u307e\u3068\u3081\u3066\u53d7\u3051\u53d6\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\nfunction f($a, ...$b)\n{\n    var_dump($a, $b);\n}\n\n\u547c\u3073\u51fa\u3057\u305f\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\nf(\"a\")\n// =>\n// string(1) \"a\"\n// array(0) {\n// }\n\nf(\"a\", \"b\")\n// =>\n// string(1) \"a\"\n// array(1) {\n//   [0]=>\n//   string(1) \"b\"\n// }\n\nf(\"a\", \"b\", \"c\", \"d\")\n// =>\n// string(1) \"a\"\n// array(3) {\n//   [0]=>\n//   string(1) \"b\"\n//   [1]=>\n//   string(1) \"c\"\n//   [2]=>\n//   string(1) \"d\"\n// }\n\n\u3054\u89a7\u306e\u901a\u308a\u3001\u300c\u4e00\u500b\u4ee5\u4e0a\u300d\u3067\u306f\u306a\u304f\u300c0\u500b\u4ee5\u4e0a\u300d\u3067\u3059\u3002\n\n\u53ef\u5909\u500b\u5f15\u6570\u306e\u53d7\u3051\u6e21\u3057\n\u4f55\u304b\u306e\u4e8b\u60c5\u306b\u3088\u308a\u3001\u5f15\u6570\u306b\u53d7\u3051\u6e21\u3059\u3079\u304d\u5024\u3092\u914d\u5217\u3067\u53d7\u3051\u53d6\u3063\u305f\u3068\u304d\u3001\u611a\u76f4\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u306d\u3002\n\n$a = array_values($args);\n$count = count($args);\n\nif ($count === 1) {\n    f($a[0]);\n} elseif ($count === 2) {\n    f($a[0], $a[1]);\n} elseif ($count === 3) {\n    f($a[0], $a[1], $a[2]);\n} elseif ($count === 4) {\n    f($a[0], $a[1], $a[2], $a[3]);\n} elseif ($count === 5) {\n    f($a[0], $a[1], $a[2], $a[3], $a[4]);\n} elseif ($count === 6) {\n    f($a[0], $a[1], $a[2], $a[3], $a[4], $a[5]);\n}\n\n\u3044\u3084\u3001\u3053\u308c\u306f\u3042\u3093\u307e\u308a\u306b\u3082\u4e0d\u4fbf\u3059\u304e\u308b\u2026\n\u306a\u306e\u3067\u3075\u3064\u3046\u306fcall_user_func_array()\u3092\u4f7f\u3063\u3066\u3001\u3053\u3046\u66f8\u304d\u307e\u3059\u3002\ncall_user_func_array('f', $args);\n\n\u3055\u3066\u3001PHP 5.6\u4ee5\u964d\u3067\u306f\u3001\u3055\u3089\u306b\u77ed\u304f\u66f8\u3051\u307e\u3059\u3002\nf(...$args);\n\n\u77ed\u3044\uff01 \u3079\u3093\u308a\uff01\n\n\u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3068\u304d\u306b ... \u3092\u4f7f\u3046\u3068\u3001 \u914d\u5217\u5909\u6570\u3084Traversable\u30af\u30e9\u30b9\u3092\u5f15\u6570\u30ea\u30b9\u30c8\u306b\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3057\u308c\u3063\u3068\u3001Traversable\u306e\u540d\u524d\u304c\u51fa\u3066\u307e\u3059\u3002\u3053\u308c\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u304b\u3068\u3044\u3075\u3068\u3001$args\u306e\u5b9f\u88c5\u306fArrayObject\u3068\u304b\u3067\u3082\u826f\u3044\u306e\u3067\u3059\u3002\u3059\u3054\u3044\u3058\u3083\u3093PHP 5.6\u3002\n\n\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3001\u6539\u3081\u578b\u5ba3\u8a00\n\u5f15\u6570\u306b\u306f\u3001\u30af\u30e9\u30b9\u540d\u3092\u6307\u5b9a\u3057\u3066UserModel $user\u3068\u304barray $users\u3068\u304b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3067\u306f\u3001\u53ef\u5909\u9577\u5f15\u6570\u3068\u7d44\u307f\u5408\u305b\u308b\u3068\uff1f\n\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3042\u308a\u307e\u3059\u3002\n\n...\u30c8\u30fc\u30af\u30f3\u306e\u524d\u306b\u3001 \u30bf\u30a4\u30d7\u30d2\u30f3\u30c8 \u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 \u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u304c\u3042\u308b\u5834\u5408\u3001...\u304c\u53d6\u308a\u8fbc\u3080\u3059\u3079\u3066\u306e\u5f15\u6570\u306f\u305d\u306e\u30d2\u30f3\u30c8\u306b\u5f93\u308f\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u306a\u308b\u307b\u3069\uff01 \u3079\u3093\u308a\uff01 \u8d85\u3079\u3093\u308a!\n\n\u3064\u307e\u308a\u2026\uff1f\n\u3053\u308c\u3060\u3051\u3067\u300c\u914d\u5217\u8981\u7d20\u306e\u578b\u30c1\u30a7\u30c3\u30af\u304c\u3067\u304d\u308b\u300d\u3063\u3066\u3053\u3068\u3067\u3059\u3002\nclass User\n{\n}\n\n$v = function (User ...$users) {};\n\n$users = [new User(\"taro\"), new User(\"jiro\"), new User(\"saburo\")];\n$v(...$users);\n\n\u691c\u8a3c\u306b\u5931\u6557\u3059\u308b\u3001\u3064\u307e\u308a\u4e0d\u6b63\u306a\u8981\u7d20\u304c\u542b\u307e\u308c\u3066\u305f\u3089TypeError\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n$null_users = [new User(\"taro\"), null, new User(\"saburo\")];\n$v(...$null_users);\n// PHP Fatal error:  Uncaught TypeError: Argument 2 passed to {closure}() must be an instance of User, null given ...\n\n\n\u4efb\u610f\u306e\u578b\u3092\u691c\u8a3c\u3059\u308b\nPHP\u3067\u52d5\u7684\u306a\u51fd\u6570\u751f\u6210\u3068\u3044\u3063\u305f\u3089\u3001\u4e0a\u306e\u3088\u3046\u306bfunction\u5f0f\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u304c\u30dd\u30d4\u30e5\u30e9\u30fc\u3067\u3059\u306d\u3002\u3057\u304b\u3057\u4eca\u56de\u306e\u3088\u3046\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u306b\u4efb\u610f\u306e\u578b\u3092\u6307\u5b9a\u3057\u305f\u3044\u3068\u601d\u3063\u305f\u3068\u304d\u3001function\u5f0f\u3060\u3051\u3067\u306f\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u4e0d\u53ef\u80fd\u3067\u3059\u3002\u305f\u3060\u3057\u3001eval\u3092\u9664\u304f\u3002\n\u2026\u2026eval\u3092\u9664\u304f? \u307f\u306a\u3055\u3093\u3001\u3061\u3087\u3063\u3068\u30bb\u30ad\u30e5\u30a2\u306a\u30e2\u30c0\u30f3PHP\u306b\u6bd2\u3055\u308c\u3059\u304e\u306a\u3093\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff1f\uff1f\uff1f\n\u3064\u307e\u308acreate_function()\u306e\u5b58\u5728\u3092\u601d\u3072\u51fa\u3059\u306e\u3067\u3059\u3002\n\n\u8b66\u544a \u3053\u306e\u95a2\u6570\u306f\u3001\u5185\u90e8\u7684\u306b eval() \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u306e\u3067\u3001 eval() \u3068\u540c\u69d8\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u30ea\u30b9\u30af\u304c\u3042\u308a\u307e\u3059\u3002 \u3055\u3089\u306b\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3084\u30e1\u30e2\u30ea\u4f7f\u7528\u52b9\u7387\u306e\u9762\u3067\u3082\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\nPHP 5.3.0 \u4ee5\u964d\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u3053\u306e\u95a2\u6570\u3067\u306f\u306a\u304f\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u306e \u7121\u540d\u95a2\u6570 \u3092\u4f7f\u3046\u3079\u304d\u3067\u3059\u3002\n\n\u30b3\u30ef\u30a4\uff01 \u6b63\u5e38\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u610f\u8b58\u304c\u3042\u308c\u3070\u7d76\u5bfe\u306b\u8fd1\u4ed8\u304d\u305f\u304f\u306a\u3044\u3084\u3064\u3067\u3059\u3002\n\u3057\u304b\u3057\u3001\u3053\u308c\u306a\u3089\u2026?\n$f = create_function($type . ' ...$args', 'return true;');\n\n\u3053\u308c\u306a\u3089\u3001\u3061\u3087\u3063\u3068\u306f\u5927\u4e08\u592b\u306a\u6c17\u304c\u3059\u308b\u2026? $type\u306b\u30e6\u30fc\u30b6\u30fc\u5165\u529b\u304c\u5165\u3089\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3059\u308c\u3070\u3001\u307e\u3042\u5927\u4e08\u592b\u305d\u3046\u3002 (\u4fdd\u969c\u306f\u3067\u304d\u306a\u3044\uff01)\n\n\u5b9f\u88c5\nBaguettePHP/collection-validator\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\u6bd4\u8f03\u306e\u305f\u3081\u306b\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u306f\u307f\u3063\u3064\u3002Each\u3063\u3066\u3064\u3044\u3066\u308b\u30af\u30e9\u30b9\u306f\u914d\u5217\u306e\u4e2d\u8eab\u3092\u4e00\u500b\u4e00\u500b\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3084\u3064\u3002\n\n\nTypeHint.php: \u53ef\u5909\u9577\u5f15\u6570\u3068\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u3002PHP7\u5fc5\u9808\u3002\n\nEachIf.php: \u30eb\u30fc\u30d7\u5185\u3067\u81ea\u660e\u306a\u5206\u5c90\u3092\u4f55\u56de\u304b\u7e70\u308a\u8fd4\u3059\u3084\u3064\n\nEachCallable.php: \u81ea\u660e\u306a\u5206\u5c90\u3092\u7e70\u308a\u8fd4\u3055\u306a\u3044\u3088\u3046\u306bcallable\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3084\u3064\n\n\u4eca\u56de\u306e\u8a18\u4e8b\u306e\u672c\u984c\u306eTypeHint\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u3067\u3059\u3002\u307b\u304b\u306e\u30af\u30e9\u30b9\u306fGitHub\u3067\u8aad\u3093\u3067\u306d\u3002\n\nTypeHint.php\n<?php\ndeclare(strict_types=1);\nnamespace Teto\\CollectionValidator;\n\n/**\n * @license WTFPL\n */\nclass TypeHint\n{\n    private static $functions = [];\n    private $type;\n\n    /**\n     * @param  string   $type\n     * @return TypeHint\n     */\n    public function __construct($type)\n    {\n        $this->type = ltrim($type, '\\\\');\n    }\n\n    /**\n     * @return bool\n     */\n    public function validate($collection): bool\n    {\n        try {\n            $is_valid = self::getValidateFunction($this->type)(...$collection);\n        } catch (\\TypeError $e) {\n            $is_valid = false;\n        }\n        return $is_valid;\n    }\n\n    /**\n     * @return \\Closure\n     */\n    public static function getValidateFunction($type)\n    {\n        if (!isset(self::$functions[$type])) {\n            self::$functions[$type] = create_function($type . ' ...$args', 'return true;');\n        }\n        return self::$functions[$type];\n    }\n}\n\n\n\u3055\u3066\u3001\u4e09\u7a2e\u985e\u306e\u30af\u30e9\u30b9\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u3068\u3063\u3066\u307f\u3088\u3046\u3002\u3042\u3068\u3001\u30c6\u30b9\u30c8\u5bfe\u8c61\u306f\u300c10\u8981\u7d20\u306e\u914d\u5217\u300d\u3068\u300c1000\u8981\u7d20\u306e\u914d\u5217\u300d\u306b\u3057\u3066\u304a\u304f\u3002\n% php --version\nPHP 7.0.3 (cli) (built: Feb  6 2016 03:16:24) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n\n% php ./vendor/bin/athletic -p ./tests/\n\nTeto\\CollectionValidator\\StringBench\n    Method Name             Iterations    Average Time      Ops/second\n    ---------------------  ------------  --------------    -------------\n    foreach_callable_10  : [     1,000] [0.0000009810925] [1,019,271.93196]\n    foreach_if_10        : [     1,000] [0.0000008912086] [1,122,071.69609]\n    typehint_10          : [     1,000] [0.0000005047321] [1,981,248.93718]\n    foreach_callable_1000: [       100] [0.0000671696663] [   14,887.67259]\n    foreach_if_1000      : [       100] [0.0000663876534] [   15,063.04184]\n    typehint_1000        : [       100] [0.0000161123276] [   62,064.27937]\n\n\n\u3044\u3044\u306d\uff01 typehint\u901f\u3044\u3088\uff01 \u3053\u308c\u306a\u3089\u52dd\u3066\u308b\uff01 Average Time\u306f\u4f4e\u3044\u307b\u3069\u3001Ops/second\u306f\u9ad8\u3044\u307b\u3069\u6027\u80fd\u304c\u826f\u3044\u3053\u3068\u306b\u306a\u308b\u3002\n\u2026\u2026\u3057\u304b\u3057\u3001\u3053\u308c\u306f\u578b\u30c1\u30a7\u30c3\u30af\u306e\u5bfe\u8c61\u304c\u5168\u3066\u59a5\u5f53\u306a\u5834\u5408\u3060\u3002\u3067\u306f\u3001\u4e0d\u6b63\u306a\u8981\u7d20\u304c\u5165\u3063\u305f\u914d\u5217\u3067\u306f\uff1f\n% php --version\nPHP 7.0.3 (cli) (built: Feb  6 2016 03:16:24) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n\n% php ./vendor/bin/athletic -p ./tests/\n\nTeto\\CollectionValidator\\StringFailBench\n    Method Name             Iterations    Average Time      Ops/second\n    ---------------------  ------------  --------------    -------------\n    foreach_callable_10  : [     1,000] [0.0000004541874] [2,201,734.38320]\n    foreach_if_10        : [     1,000] [0.0000001759529] [5,683,338.75339]\n    typehint_10          : [     1,000] [0.0000481393337] [   20,773.03366]\n    foreach_callable_1000: [       100] [0.0000003933907] [2,542,002.42424]\n    foreach_if_1000      : [       100] [0.0000002026558] [4,934,475.29412]\n    typehint_1000        : [       100] [0.0426092553139] [       23.46908]\n\n\n\u306a\u3093\u3060\u3053\u306e\u7d50\u679c\u306f\u2026 \u305f\u307e\u3052\u305f\u306a\u3041\u3002\n\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u4e0a\u3001\u65e9\u671f\u306b\u5931\u6557\u3057\u305f\u65b9\u304c\u826f\u3044\u306e\u3067foreach\u304c\u8d85\u9ad8\u901f\u5316\u3059\u308b\u306e\u306f\u308f\u304b\u308b\u3002\u3057\u304b\u3057\u3066typehint_10\u306f100\u500d\u3001typehint_1000\u306b\u81f3\u3063\u3066\u306f3000\u500d\u8fd1\u304f\u306b\u3082\u306a\u308b\u5dee\u304c\u3064\u3044\u3066\u3057\u307e\u3063\u3066\u308b\u3002\n\n\u5bbf\u984c\n\n\ntypehint\u304c\u4e0d\u6b63\u306a\u5024\u3092\u691c\u51fa\u3057\u305f\u3068\u304d\u306e\u6027\u80fd\u52a3\u5316\u306f\u4f55\u306b\u8d77\u56e0\u3059\u308b\u304b\u8003\u3078\u3066\u307f\u3088\u3046\n\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u3001\u3042\u306a\u305f\u306e\u696d\u52d9\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u5c0e\u5165\u3059\u308b\u3053\u3068\u306f\u53ef\u80fd\u304b\u3001\u61f8\u5ff5\u4e8b\u9805\u3092\u6319\u3052\u3066\u307f\u3088\u3046\n\n\n\u8ffd\u8a18\nPHP 5.6\u30687\u306e\u65b0\u6a5f\u80fd\u3063\u3066\u8a00\u3063\u305f\u5272\u306b\u3001PHP 7\u306e\u8aac\u660e\u3092\u3057\u3066\u306a\u3044\u3084\u3002\u307e\u3042\u3001\u3044\u3063\u304b\u3002\n\u4ee5\u524d\u3001[private/protected\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5916\u90e8\u304b\u3089\u8aad\u307f\u8fbc\u307f\u53ef\u80fd\u306b\u3059\u308b](http://qiita.com/tadsan/items/2049243e47495764b191)\u3092\u66f8\u3044\u305f\u3068\u304d\u3001\u8a18\u4e8b\u306e\u30b3\u30e1\u30f3\u30c8\u306b\u3066\u300c\u30b3\u30ec\u30af\u30b7\u30e7\u30f3(\u914d\u5217)\u5185\u306e\u8981\u7d20\u306e\u578b\u3092\u691c\u8a3c\u3057\u305f\u3044\u3088\u30fc\u300d\u300c\u3067\u3082\u305d\u3046\u3059\u308b\u3068\u5168\u8981\u7d20\u3092\u691c\u8a3c\u3057\u306a\u304f\u3061\u3083\u3044\u3051\u306a\u3044\u304b\u3089\u5b9f\u884c\u6642\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u554f\u984c\u304c\u3042\u308b\u3088\u306d\u300d\u3063\u3066\u8a71\u3092\u3057\u307e\u3057\u305f\u3002\n\n## \u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\n\n[PHP: \u95a2\u6570\u306e\u5f15\u6570 - Manual](http://php.net/manual/ja/functions.arguments.php)\u3092\u8aad\u3093\u3067\u305f\u79c1\u306f\u6c17\u4ed8\u3044\u3066\u3057\u307e\u3063\u305f\u306e\u3067\u3059\u3002PHP 5.6\u3067\u5b9f\u88c5\u3055\u308c\u305f\u6a5f\u80fd\u3092\u5de7\u307f\u306b\u5229\u7528\u3059\u308c\u3070\u30d0\u30ea\u30c7\u30fc\u30bf\u304c\u5b9f\u88c5\u53ef\u80fd\u306a\u3053\u3068\u306b\u3002\n\n\u2026\u2026\u305d\u3046\u3067\u3059\u3002<dfn>**\u53ef\u5909\u9577\u5f15\u6570**</dfn>\u3067\u3059\u3002\n\n## PHP\u306e\u53ef\u5909\u9577\u5f15\u6570\u3068\u306f\n\nPHP 5.6\u3067\u8ffd\u52a0\u3055\u308c\u305f\u53ef\u5909\u9577\u5f15\u6570\u306f\u3001\u4ee5\u524d\u306e\u6587\u6cd5\u306b`...`\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067**0\u500b\u4ee5\u4e0a**\u306e\u5024\u3092\u307e\u3068\u3081\u3066\u53d7\u3051\u53d6\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\n```php\nfunction f($a, ...$b)\n{\n    var_dump($a, $b);\n}\n```\n\n\u547c\u3073\u51fa\u3057\u305f\u7d50\u679c\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```php\nf(\"a\")\n// =>\n// string(1) \"a\"\n// array(0) {\n// }\n\nf(\"a\", \"b\")\n// =>\n// string(1) \"a\"\n// array(1) {\n//   [0]=>\n//   string(1) \"b\"\n// }\n\nf(\"a\", \"b\", \"c\", \"d\")\n// =>\n// string(1) \"a\"\n// array(3) {\n//   [0]=>\n//   string(1) \"b\"\n//   [1]=>\n//   string(1) \"c\"\n//   [2]=>\n//   string(1) \"d\"\n// }\n```\n\n\u3054\u89a7\u306e\u901a\u308a\u3001\u300c\u4e00\u500b\u4ee5\u4e0a\u300d\u3067\u306f\u306a\u304f\u300c0\u500b\u4ee5\u4e0a\u300d\u3067\u3059\u3002\n\n## \u53ef\u5909\u500b\u5f15\u6570\u306e\u53d7\u3051\u6e21\u3057\n\n\u4f55\u304b\u306e\u4e8b\u60c5\u306b\u3088\u308a\u3001\u5f15\u6570\u306b\u53d7\u3051\u6e21\u3059\u3079\u304d\u5024\u3092\u914d\u5217\u3067\u53d7\u3051\u53d6\u3063\u305f\u3068\u304d\u3001*\u611a\u76f4\u306b\u306f*\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304d\u307e\u3059\u306d\u3002\n\n```php\n\n$a = array_values($args);\n$count = count($args);\n\nif ($count === 1) {\n    f($a[0]);\n} elseif ($count === 2) {\n    f($a[0], $a[1]);\n} elseif ($count === 3) {\n    f($a[0], $a[1], $a[2]);\n} elseif ($count === 4) {\n    f($a[0], $a[1], $a[2], $a[3]);\n} elseif ($count === 5) {\n    f($a[0], $a[1], $a[2], $a[3], $a[4]);\n} elseif ($count === 6) {\n    f($a[0], $a[1], $a[2], $a[3], $a[4], $a[5]);\n}\n```\n\n\u3044\u3084\u3001\u3053\u308c\u306f\u3042\u3093\u307e\u308a\u306b\u3082\u4e0d\u4fbf\u3059\u304e\u308b\u2026\n\n\u306a\u306e\u3067\u3075\u3064\u3046\u306f[`call_user_func_array()`](http://php.net/manual/function.call-user-func-array.php)\u3092\u4f7f\u3063\u3066\u3001\u3053\u3046\u66f8\u304d\u307e\u3059\u3002\n\n```php\ncall_user_func_array('f', $args);\n```\n\n\u3055\u3066\u3001PHP 5.6\u4ee5\u964d\u3067\u306f\u3001\u3055\u3089\u306b\u77ed\u304f\u66f8\u3051\u307e\u3059\u3002\n\n```php\nf(...$args);\n```\n\n\u77ed\u3044\uff01 \u3079\u3093\u308a\uff01\n\n> \u95a2\u6570\u3092\u547c\u3073\u51fa\u3059\u3068\u304d\u306b `...` \u3092\u4f7f\u3046\u3068\u3001 \u914d\u5217\u5909\u6570\u3084[`Traversable`](http://php.net/manual/class.traversable.php)\u30af\u30e9\u30b9\u3092\u5f15\u6570\u30ea\u30b9\u30c8\u306b\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3057\u308c\u3063\u3068\u3001`Traversable`\u306e\u540d\u524d\u304c\u51fa\u3066\u307e\u3059\u3002\u3053\u308c\u304c\u4f55\u3092\u610f\u5473\u3059\u308b\u304b\u3068\u3044\u3075\u3068\u3001`$args`\u306e\u5b9f\u88c5\u306f[`ArrayObject`](http://php.net/manual/class.arrayobject.php)\u3068\u304b\u3067\u3082\u826f\u3044\u306e\u3067\u3059\u3002\u3059\u3054\u3044\u3058\u3083\u3093PHP 5.6\u3002\n\n## \u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3001\u6539\u3081\u578b\u5ba3\u8a00\n\n\u5f15\u6570\u306b\u306f\u3001\u30af\u30e9\u30b9\u540d\u3092\u6307\u5b9a\u3057\u3066`UserModel $user`\u3068\u304b`array $users`\u3068\u304b\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3067\u306f\u3001\u53ef\u5909\u9577\u5f15\u6570\u3068\u7d44\u307f\u5408\u305b\u308b\u3068\uff1f\n\n\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3042\u308a\u307e\u3059\u3002\n\n> `...`\u30c8\u30fc\u30af\u30f3\u306e\u524d\u306b\u3001 \u30bf\u30a4\u30d7\u30d2\u30f3\u30c8 \u3092\u4ed8\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002 \u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u304c\u3042\u308b\u5834\u5408\u3001`...`\u304c\u53d6\u308a\u8fbc\u3080\u3059\u3079\u3066\u306e\u5f15\u6570\u306f\u305d\u306e\u30d2\u30f3\u30c8\u306b\u5f93\u308f\u306a\u3051\u308c\u3070\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u306a\u308b\u307b\u3069\uff01 \u3079\u3093\u308a\uff01 \u8d85\u3079\u3093\u308a!\n\n## \u3064\u307e\u308a\u2026\uff1f\n\n\u3053\u308c\u3060\u3051\u3067\u300c\u914d\u5217\u8981\u7d20\u306e\u578b\u30c1\u30a7\u30c3\u30af\u304c\u3067\u304d\u308b\u300d\u3063\u3066\u3053\u3068\u3067\u3059\u3002\n\n```php\nclass User\n{\n}\n\n$v = function (User ...$users) {};\n\n$users = [new User(\"taro\"), new User(\"jiro\"), new User(\"saburo\")];\n$v(...$users);\n```\n\n\u691c\u8a3c\u306b\u5931\u6557\u3059\u308b\u3001\u3064\u307e\u308a\u4e0d\u6b63\u306a\u8981\u7d20\u304c\u542b\u307e\u308c\u3066\u305f\u3089`TypeError`\u304c\u6295\u3052\u3089\u308c\u307e\u3059\u3002\n\n```php\n$null_users = [new User(\"taro\"), null, new User(\"saburo\")];\n$v(...$null_users);\n// PHP Fatal error:  Uncaught TypeError: Argument 2 passed to {closure}() must be an instance of User, null given ...\n```\n\n## \u4efb\u610f\u306e\u578b\u3092\u691c\u8a3c\u3059\u308b\n\nPHP\u3067\u52d5\u7684\u306a\u51fd\u6570\u751f\u6210\u3068\u3044\u3063\u305f\u3089\u3001\u4e0a\u306e\u3088\u3046\u306b`function`\u5f0f\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u304c\u30dd\u30d4\u30e5\u30e9\u30fc\u3067\u3059\u306d\u3002\u3057\u304b\u3057\u4eca\u56de\u306e\u3088\u3046\u306b\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066**\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u306b\u4efb\u610f\u306e\u578b\u3092\u6307\u5b9a\u3057\u305f\u3044**\u3068\u601d\u3063\u305f\u3068\u304d\u3001`function`\u5f0f\u3060\u3051\u3067\u306f\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3092\u52d5\u7684\u306b\u5909\u66f4\u3059\u308b\u3053\u3068\u306f\u4e0d\u53ef\u80fd\u3067\u3059\u3002\u305f\u3060\u3057\u3001`eval`\u3092\u9664\u304f\u3002\n\n\u2026\u2026`eval`\u3092\u9664\u304f? \u307f\u306a\u3055\u3093\u3001\u3061\u3087\u3063\u3068\u30bb\u30ad\u30e5\u30a2\u306a[\u30e2\u30c0\u30f3PHP](http://qiita.com/tadsan/items/157969b338fd8b782b21)\u306b\u6bd2\u3055\u308c\u3059\u304e\u306a\u3093\u3058\u3083\u306a\u3044\u3067\u3059\u304b\uff1f\uff1f\uff1f\n\n\u3064\u307e\u308a[`create_function()`](http://php.net/manual/ja/function.create-function.php)\u306e\u5b58\u5728\u3092\u601d\u3072\u51fa\u3059\u306e\u3067\u3059\u3002\n\n> **\u8b66\u544a** \u3053\u306e\u95a2\u6570\u306f\u3001\u5185\u90e8\u7684\u306b `eval()` \u3092\u5b9f\u884c\u3057\u3066\u3044\u308b\u306e\u3067\u3001 `eval()` \u3068\u540c\u69d8\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u30ea\u30b9\u30af\u304c\u3042\u308a\u307e\u3059\u3002 \u3055\u3089\u306b\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3084\u30e1\u30e2\u30ea\u4f7f\u7528\u52b9\u7387\u306e\u9762\u3067\u3082\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n> PHP 5.3.0 \u4ee5\u964d\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u3053\u306e\u95a2\u6570\u3067\u306f\u306a\u304f\u3001\u30cd\u30a4\u30c6\u30a3\u30d6\u306e \u7121\u540d\u95a2\u6570 \u3092\u4f7f\u3046\u3079\u304d\u3067\u3059\u3002\n\n\u30b3\u30ef\u30a4\uff01 \u6b63\u5e38\u306a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u610f\u8b58\u304c\u3042\u308c\u3070\u7d76\u5bfe\u306b\u8fd1\u4ed8\u304d\u305f\u304f\u306a\u3044\u3084\u3064\u3067\u3059\u3002\n\n\u3057\u304b\u3057\u3001\u3053\u308c\u306a\u3089\u2026?\n\n```php\n$f = create_function($type . ' ...$args', 'return true;');\n```\n\n\u3053\u308c\u306a\u3089\u3001\u3061\u3087\u3063\u3068\u306f\u5927\u4e08\u592b\u306a\u6c17\u304c\u3059\u308b\u2026? `$type`\u306b\u30e6\u30fc\u30b6\u30fc\u5165\u529b\u304c\u5165\u3089\u306a\u3044\u3088\u3046\u306b\u6ce8\u610f\u3059\u308c\u3070\u3001\u307e\u3042\u5927\u4e08\u592b\u305d\u3046\u3002 **(\u4fdd\u969c\u306f\u3067\u304d\u306a\u3044\uff01)**\n\n## \u5b9f\u88c5\n\n[BaguettePHP/collection-validator](https://github.com/BaguettePHP/collection-validator)\u3092\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n\u6bd4\u8f03\u306e\u305f\u3081\u306b\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u306f\u307f\u3063\u3064\u3002`Each`\u3063\u3066\u3064\u3044\u3066\u308b\u30af\u30e9\u30b9\u306f\u914d\u5217\u306e\u4e2d\u8eab\u3092\u4e00\u500b\u4e00\u500b\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3084\u3064\u3002\n\n* [TypeHint.php](https://github.com/BaguettePHP/collection-validator/blob/master/src/TypeHint.php): \u53ef\u5909\u9577\u5f15\u6570\u3068\u30bf\u30a4\u30d7\u30d2\u30f3\u30c8\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u3002PHP7\u5fc5\u9808\u3002\n* [EachIf.php](https://github.com/BaguettePHP/collection-validator/blob/master/src/EachIf.php): \u30eb\u30fc\u30d7\u5185\u3067\u81ea\u660e\u306a\u5206\u5c90\u3092\u4f55\u56de\u304b\u7e70\u308a\u8fd4\u3059\u3084\u3064\n* [EachCallable.php](https://github.com/BaguettePHP/collection-validator/blob/master/src/EachCallable.php): \u81ea\u660e\u306a\u5206\u5c90\u3092\u7e70\u308a\u8fd4\u3055\u306a\u3044\u3088\u3046\u306b`callable`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u3084\u3064\n\n\u4eca\u56de\u306e\u8a18\u4e8b\u306e\u672c\u984c\u306e`TypeHint`\u30af\u30e9\u30b9\u306e\u5b9f\u88c5\u3067\u3059\u3002\u307b\u304b\u306e\u30af\u30e9\u30b9\u306fGitHub\u3067\u8aad\u3093\u3067\u306d\u3002\n\n```php:TypeHint.php\n<?php\ndeclare(strict_types=1);\nnamespace Teto\\CollectionValidator;\n\n/**\n * @license WTFPL\n */\nclass TypeHint\n{\n    private static $functions = [];\n    private $type;\n\n    /**\n     * @param  string   $type\n     * @return TypeHint\n     */\n    public function __construct($type)\n    {\n        $this->type = ltrim($type, '\\\\');\n    }\n\n    /**\n     * @return bool\n     */\n    public function validate($collection): bool\n    {\n        try {\n            $is_valid = self::getValidateFunction($this->type)(...$collection);\n        } catch (\\TypeError $e) {\n            $is_valid = false;\n        }\n        return $is_valid;\n    }\n\n    /**\n     * @return \\Closure\n     */\n    public static function getValidateFunction($type)\n    {\n        if (!isset(self::$functions[$type])) {\n            self::$functions[$type] = create_function($type . ' ...$args', 'return true;');\n        }\n        return self::$functions[$type];\n    }\n}\n```\n\n\u3055\u3066\u3001\u4e09\u7a2e\u985e\u306e\u30af\u30e9\u30b9\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3092\u3068\u3063\u3066\u307f\u3088\u3046\u3002\u3042\u3068\u3001\u30c6\u30b9\u30c8\u5bfe\u8c61\u306f\u300c10\u8981\u7d20\u306e\u914d\u5217\u300d\u3068\u300c1000\u8981\u7d20\u306e\u914d\u5217\u300d\u306b\u3057\u3066\u304a\u304f\u3002\n\n```\n% php --version\nPHP 7.0.3 (cli) (built: Feb  6 2016 03:16:24) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n\n% php ./vendor/bin/athletic -p ./tests/\n\nTeto\\CollectionValidator\\StringBench\n    Method Name             Iterations    Average Time      Ops/second\n    ---------------------  ------------  --------------    -------------\n    foreach_callable_10  : [     1,000] [0.0000009810925] [1,019,271.93196]\n    foreach_if_10        : [     1,000] [0.0000008912086] [1,122,071.69609]\n    typehint_10          : [     1,000] [0.0000005047321] [1,981,248.93718]\n    foreach_callable_1000: [       100] [0.0000671696663] [   14,887.67259]\n    foreach_if_1000      : [       100] [0.0000663876534] [   15,063.04184]\n    typehint_1000        : [       100] [0.0000161123276] [   62,064.27937]\n\n```\n\n\u3044\u3044\u306d\uff01 `typehint`\u901f\u3044\u3088\uff01 \u3053\u308c\u306a\u3089\u52dd\u3066\u308b\uff01 `Average Time`\u306f\u4f4e\u3044\u307b\u3069\u3001`Ops/second`\u306f\u9ad8\u3044\u307b\u3069\u6027\u80fd\u304c\u826f\u3044\u3053\u3068\u306b\u306a\u308b\u3002\n\n\u2026\u2026\u3057\u304b\u3057\u3001\u3053\u308c\u306f\u578b\u30c1\u30a7\u30c3\u30af\u306e\u5bfe\u8c61\u304c\u5168\u3066\u59a5\u5f53\u306a\u5834\u5408\u3060\u3002\u3067\u306f\u3001\u4e0d\u6b63\u306a\u8981\u7d20\u304c\u5165\u3063\u305f\u914d\u5217\u3067\u306f\uff1f\n\n```\n% php --version\nPHP 7.0.3 (cli) (built: Feb  6 2016 03:16:24) ( NTS )\nCopyright (c) 1997-2016 The PHP Group\nZend Engine v3.0.0, Copyright (c) 1998-2016 Zend Technologies\n\n% php ./vendor/bin/athletic -p ./tests/\n\nTeto\\CollectionValidator\\StringFailBench\n    Method Name             Iterations    Average Time      Ops/second\n    ---------------------  ------------  --------------    -------------\n    foreach_callable_10  : [     1,000] [0.0000004541874] [2,201,734.38320]\n    foreach_if_10        : [     1,000] [0.0000001759529] [5,683,338.75339]\n    typehint_10          : [     1,000] [0.0000481393337] [   20,773.03366]\n    foreach_callable_1000: [       100] [0.0000003933907] [2,542,002.42424]\n    foreach_if_1000      : [       100] [0.0000002026558] [4,934,475.29412]\n    typehint_1000        : [       100] [0.0426092553139] [       23.46908]\n\n```\n\n\u306a\u3093\u3060\u3053\u306e\u7d50\u679c\u306f\u2026 \u305f\u307e\u3052\u305f\u306a\u3041\u3002\n\n\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u4e0a\u3001\u65e9\u671f\u306b\u5931\u6557\u3057\u305f\u65b9\u304c\u826f\u3044\u306e\u3067`foreach`\u304c\u8d85\u9ad8\u901f\u5316\u3059\u308b\u306e\u306f\u308f\u304b\u308b\u3002\u3057\u304b\u3057\u3066`typehint_10`\u306f100\u500d\u3001`typehint_1000`\u306b\u81f3\u3063\u3066\u306f3000\u500d\u8fd1\u304f\u306b\u3082\u306a\u308b\u5dee\u304c\u3064\u3044\u3066\u3057\u307e\u3063\u3066\u308b\u3002\n\n## \u5bbf\u984c\n\n* `typehint`\u304c\u4e0d\u6b63\u306a\u5024\u3092\u691c\u51fa\u3057\u305f\u3068\u304d\u306e\u6027\u80fd\u52a3\u5316\u306f\u4f55\u306b\u8d77\u56e0\u3059\u308b\u304b\u8003\u3078\u3066\u307f\u3088\u3046\n* \u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u3001\u3042\u306a\u305f\u306e\u696d\u52d9\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u5c0e\u5165\u3059\u308b\u3053\u3068\u306f\u53ef\u80fd\u304b\u3001\u61f8\u5ff5\u4e8b\u9805\u3092\u6319\u3052\u3066\u307f\u3088\u3046\n\n## \u8ffd\u8a18\n\n<q>PHP 5.6\u30687\u306e\u65b0\u6a5f\u80fd</q>\u3063\u3066\u8a00\u3063\u305f\u5272\u306b\u3001PHP 7\u306e\u8aac\u660e\u3092\u3057\u3066\u306a\u3044\u3084\u3002\u307e\u3042\u3001\u3044\u3063\u304b\u3002\n"}