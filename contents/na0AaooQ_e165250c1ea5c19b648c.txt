{"context": " More than 1 year has passed since last update.\n\n\u25a0\u306f\u3058\u3081\u306b\nAWS\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306bDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u3001unbound\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\u8af8\u4e8b\u60c5\u306b\u3088\u308a\u3001Amazon Route53\u306b\u4f5c\u6210\u3057\u305fPrivate\u306a\u30be\u30fc\u30f3\u306b\u3064\u3044\u3066\u3001Amazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3082\u540d\u524d\u89e3\u6c7a\u3059\u308b\u5fc5\u8981\u304c\u751f\u3058\u305f\u70ba\u3001Amazon VPC\u5185\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306bDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066unbound\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\nAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3001unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u3001Private\u306aRoute53\u30be\u30fc\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u25a0\u8ffd\u8a18\n\u672c\u6587\u306e\u4f8b\u306b\u4e0d\u9069\u5207\u306a\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u672c\u6587\u4fee\u6b63\u3057\u307e\u3059\u3002\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4fee\u6b63\u307e\u3067\u5c11\u3005\u304a\u5f85\u3061\u4e0b\u3055\u3044\u3002\n\u3000  \u2193\nhttp://qiita.com/iwaim@github \u69d8\u306b\u4f8b\u793a\u7528\u30c9\u30e1\u30a4\u30f3\u3092RFC 6761\u6e96\u62e0\u306e\u3082\u306e\u306b\u4fee\u6b63\u3057\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u9006\u5f15\u304d\u306eIP\u30a2\u30c9\u30ec\u30b9\u3082\u4f8b\u793a\u7528\u306eIP\u30a2\u30c9\u30ec\u30b9\u306b\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\u4f8b\u793a\u7528\u30c9\u30e1\u30a4\u30f3\u3068\u3057\u3066\u4e0d\u9069\u5207\u306a\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u8a18\u8f09\u3057\u3066\u3057\u307e\u3044\u554f\u984c\u3054\u3056\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u307e\u305f\u3001\u672c\u6587\u306e\u4fee\u6b63\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\u3000\u3000\u2193\nyum\u3067unbound\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5f8c\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305funbound\u306e\u30d0\u30fc\u30b8\u30e7\u30f3(unbound 1.4\u7cfb)\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8106\u5f31\u6027\u304c\u3042\u308b\u306e\u306b\u6c17\u304c\u3064\u304d\u307e\u3057\u305f\u3002\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3067unbound 1.5.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u304a\u3057\u307e\u3057\u305f\u3002\u8a73\u7d30\u306b\u3064\u304d\u307e\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/ac0e2f0588c70a12f0c5\n\u3000\u3000\u2193\nRoute53\u306bPrivate\u306a\u6b63\u5f15\u304d\u3068\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u3001Route53\u306bA\u30ec\u30b3\u30fc\u30c9\u3068PTR\u30ec\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/f89788e2e57263209860\n\n\u25a0unbound\u30b5\u30fc\u30d0\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n\u30fbAmazon Linux AMI 2014.09.1 x86_64 HVM\n\n\u25a0\u305d\u306e\u4ed6\n\u30fbRoute53\u306b\u306f\nroute53-test.example.org\u3068\u3044\u3046A\u30ec\u30b3\u30fc\u30c9\u300110.100.51.198.in-addr.arpa\u3068\u3044\u3046PTR\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u4f8b\u306b\u306a\u308a\u307e\u3059\u3002\n\u30fb\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3046VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306eUDP53\u756a\u30dd\u30fc\u30c8\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u25a0\u53c2\u8003\u30b5\u30a4\u30c8\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\nhttp://unbound.jp/unbound/unbound-conf/\nhttp://unbound.jp/unbound/howto_optimise/\n\n\u25a0unbound\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806\n\u306f\u3058\u3081\u306bAmazon Linux\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u51fa\u6765\u305f\u3089ec2-user\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n$ sudo su -\n# yum update\n# yum --enablerepo=epel install -y unbound\n\n# vi /etc/sysconfig/network-scripts/ifcfg-eth0\nPEERDNS=yes\n\u3000\u2193\nPEERDNS=no\n\n# vi /etc/sysconfig/unbound\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0)\nulimit -n 8290\n\n# cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\ncp: overwrite \u2018/etc/localtime\u2019? y\n[root@ip-192-168-250-8 ~]# date\nFri Dec 12 14:27:01 JST 2014\n#\n\n# vi /etc/sysconfig/clock\nZONE=\"UTC\" \nUTC=true\n\u3000\u2193\nZONE=\"Asia/Tokyo\" \nUTC=false\nARC=false\n#\n\n# mkdir /etc/unbound/local.d/BACKUP\n# mkdir /etc/unbound/conf.d/BACKUP\n#\n# mv /etc/unbound/conf.d/example.com.conf /etc/unbound/conf.d/BACKUP/\n#\n# mv /etc/unbound/local.d/block-example.com.conf /etc/unbound/local.d/BACKUP/\n#\n\nunbound\u306b\u3088\u308b\u540d\u524d\u89e3\u6c7a\u5148\u306eDNS\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3059\u308bDNS\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\nexample.org\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092Route53\u306b\u30d5\u30a9\u30ef\u30fc\u30c9\u3055\u305b\u305f\u3044\u5834\u5408\u3001forward-addr\u3067example.org\u30c9\u30e1\u30a4\u30f3\u3092\u7d10\u4ed8\u3051\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b\u3002\n# vi /etc/unbound/conf.d/example.org.conf\nforward-zone:\n      name: \"example.org.\"\n      forward-addr: XX.XX.XX.2 (unbound\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b)\n#\n\n\u9006\u5f15\u304d\u30be\u30fc\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092Route53\u3078\u30d5\u30a9\u30ef\u30fc\u30c9\u3055\u305b\u305f\u3044\u5834\u5408\u3001forward-addr\u3067\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3092\u7d10\u4ed8\u3051\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b\u3002\n# vi /etc/unbound/conf.d/100.51.198.in-addr.arpa.conf\nforward-zone:\n      name: \"100.51.198.in-addr.arpa.\"\n      forward-addr: XX.XX.XX.2 (unbound\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b)\n#\n\n# vi /etc/unbound/local.d/100.51.198.in-addr.arpa.conf\nlocal-zone: \"100.51.198.in-addr.arpa.\" transparent\n#\n\n# vi /etc/unbound/local.d/example.org.conf\nlocal-zone: \"example.org.\" transparent\n#\n\nunbound\u3092\u52d5\u304b\u3059\u70ba\u3001unbound.conf\u306b\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u30fb\u7de8\u96c6\u3059\u308b\u3002\n\u203bunbound\u30b5\u30fc\u30d0\u3092DNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u30b5\u30fc\u30d0\u53f0\u6570\u304c\u591a\u3044\u5834\u5408\u3001\u9069\u5b9c\u30d1\u30e9\u30e1\u30fc\u30bf\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n# cp -p /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n# diff /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n#\n\n# vi /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n\nunbound.conf\u306e\u5909\u66f4\u5f8c\u306e\u5dee\u5206\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n# diff /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n49,50d48\n<       interface: 0.0.0.0@53\n<       interface: ::0@53\n63d60\n<       port: 53\n115d111\n<       msg-buffer-size: 1311240\n163d158\n<       do-ip4: yes\n167d161\n<         do-ip6: no\n173d166\n<       do-udp: yes\n177d169\n<       do-tcp: no\n196,205d187\n<       access-control: 198.51.100.0/24 allow\n<       access-control: 192.0.2.0/24 allow\n<       access-control: 127.0.0.1/32 allow\n<       access-control: ::1 allow\n<       access-control: ::ffff:127.0.0.1 allow\n<       access-control: 0.0.0.0/0 deny\n246d227\n<       logfile: \"/var/log/unbound.log\"\n251d231\n<       use-syslog: no\n258d237\n<       log-queries: yes\n266d244\n<       root-hints: \"/etc/unbound/named.cache\"\n270d247\n<       hide-identity: yes\n274d250\n<       hide-version: yes\n431,432c407\n< ###   val-permissive-mode: no\n<       val-permissive-mode: yes\n---\n>       val-permissive-mode: no\n#\n\n\u4ee5\u4e0b\u306f/etc/unbound/unbound.conf\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\u203b\u672c\u756a\u74b0\u5883\u3067unbound\u30b5\u30fc\u30d0\u3092\u904b\u7528\u3059\u308b\u5834\u5408\u306f\u3001interface\u30920.0.0.0\u304b\u3089unbound\u30b5\u30fc\u30d0\u306e\u7279\u5b9a\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5236\u9650\u3057\u305f\u308a\u3001chroot\u3092\u6709\u52b9\u5316\u3057\u305f\u308a\u3057\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5468\u308a\u306e\u8a2d\u5b9a\u3092\u3082\u3063\u3068\u53b3\u3057\u304f\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n# grep -v \"#\" /etc/unbound/unbound.conf | grep -v ^$\nserver:\n        verbosity: 1\n        statistics-interval: 0\n        statistics-cumulative: yes\n        extended-statistics: yes\n        num-threads: 2\n        interface: 0.0.0.0@53\n        interface: ::0@53\n        interface-automatic: no\n        port: 53\n        outgoing-port-permit: 32768-65535\n        outgoing-port-avoid: 0-32767\n        max-udp-size: 3072\n        msg-buffer-size: 1311240\n        do-ip4: yes\n        do-ip6: no\n        do-udp: yes\n        do-tcp: no\n        access-control: 198.51.100.0/24 allow\n        access-control: 192.0.2.0/24 allow\n        access-control: ::1 allow\n        access-control: ::ffff:127.0.0.1 allow\n        access-control: 0.0.0.0/0 deny\n        chroot: \"\"\n        username: \"unbound\"\n        directory: \"/etc/unbound\"\n        logfile: \"/var/log/unbound.log\"\n        use-syslog: no\n        log-time-ascii: yes\n        log-queries: yes\n        pidfile: \"/var/run/unbound/unbound.pid\"\n        root-hints: \"/etc/unbound/named.cache\"\n        hide-identity: yes\n        hide-version: yes\n        harden-glue: yes\n        harden-dnssec-stripped: yes\n        harden-below-nxdomain: yes\n        harden-referral-path: yes\n        use-caps-for-id: no\n        unwanted-reply-threshold: 10000000\n        prefetch: yes\n        prefetch-key: yes\n        rrset-roundrobin: yes\n        minimal-responses: yes\n        dlv-anchor-file: \"/etc/unbound/dlv.isc.org.key\"\n        trusted-keys-file: /etc/unbound/keys.d/*.key\n        auto-trust-anchor-file: \"/var/lib/unbound/root.anchor\"\n        val-clean-additional: yes\n        val-permissive-mode: yes\n        val-log-level: 1\n        include: /etc/unbound/local.d/*.conf\nremote-control:\n        control-enable: yes\n        server-key-file: \"/etc/unbound/unbound_server.key\"\n        server-cert-file: \"/etc/unbound/unbound_server.pem\"\n        control-key-file: \"/etc/unbound/unbound_control.key\"\n        control-cert-file: \"/etc/unbound/unbound_control.pem\"\ninclude: /etc/unbound/conf.d/*.conf\n#\n\nDNS\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u304c\u8a18\u8f09\u3055\u308c\u305fhint\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n# wget -O \"/etc/unbound/named.cache\" ftp://FTP.INTERNIC.NET/domain/named.cache\n# chown unbound:unbound /etc/unbound/named.cache\n\n# vi /etc/resolv.conf\n### unbound\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\nnameserver 127.0.0.1\n#\n\npid\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u3002\n# mkdir /var/run/unbound\n# chown unbound:unbound /var/run/unbound\n#\n\n\u521d\u56de\u306e\u307f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3002\n# touch /var/log/unbound.log\n# chown unbound:unbound /var/log/unbound.log\n# chmod 644 /var/log/unbound.log\n#\n\nunbound\u3092\u8d77\u52d5\u3059\u308b\u3002\n# /etc/init.d/unbound start\nGenerating unbound control key and certificate:\nStarting unbound:                                          [  OK  ]\n#\n\n# ps awux | grep -v grep | grep unbound\nunbound   6897  0.0  0.7 146848  8064 ?        Ssl  14:01   0:00 /usr/sbin/unbound -c /etc/unbound/unbound.conf\n#\n\n# unbound-checkconf\nunbound-checkconf: no errors in /etc/unbound/unbound.conf\n#\n\n# chkconfig unbound on\n# chkconfig --list | grep unbound\nunbound         0:off   1:off   2:on    3:on    4:on    5:on    6:off\n#\n\n\n\u25a0unbound\u306b\u3088\u308b\u540d\u524d\u89e3\u6c7a\u30c6\u30b9\u30c8\nunbound\u30b5\u30fc\u30d0\u4e0a\u3067\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\nexample.org\u30c9\u30e1\u30a4\u30f3\u3084\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3001\u305d\u3057\u3066google.co.jp\u7b49\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u3092\u89e3\u6c7a\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\u30c6\u30b9\u30c8\u524d\u306b/etc/init.d/unbound reload\u3092\u5b9f\u884c\u3057\u3066\u3001unbound\u30b5\u30fc\u30d0\u4e0a\u306e\u540d\u524d\u89e3\u6c7a\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u6d88\u3057\u3066\u304a\u304f\u3002\n# cat /etc/resolv.conf\n### unbound\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\nnameserver 127.0.0.1\n#\n\n# /etc/init.d/unbound reload\nStopping unbound:                                          [  OK  ]\nStarting unbound:                                          [  OK  ]\n#\n\n# dig +noall +ans route53-test.example.org @127.0.0.1\nroute53-test.example.org. 5     IN      A       198.51.100.10\n#\n\n# dig +noall +ans -x 198.51.100.10 @127.0.0.1\n10.100.51.198.in-addr.arpa. 1   IN      PTR     route53-test.example.org.\n#\n\n# dig +noall +ans www.google.co.jp @127.0.0.1\nwww.google.co.jp.       300     IN      A       74.125.235.175\nwww.google.co.jp.       300     IN      A       74.125.235.191\nwww.google.co.jp.       300     IN      A       74.125.235.184\nwww.google.co.jp.       300     IN      A       74.125.235.183\n#\n\n# dig +noall +ans www.google.com @127.0.0.1\nwww.google.com.         300     IN      A       74.125.235.178\nwww.google.com.         300     IN      A       74.125.235.176\nwww.google.com.         300     IN      A       74.125.235.180\nwww.google.com.         300     IN      A       74.125.235.179\nwww.google.com.         300     IN      A       74.125.235.177\n#\n\n# /etc/init.d/unbound reload\n#\n\nAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3001DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u3001\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\nunbound\u30b5\u30fc\u30d0\u306eunbound.conf\u3084\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001unbound\u30b5\u30fc\u30d0\u3078\u306e\u540d\u524d\u89e3\u6c7a\u3092\u8a31\u53ef\u3057\u305fAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\nexample.org\u30c9\u30e1\u30a4\u30f3\u3084\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3001\u305d\u3057\u3066google.co.jp\u7b49\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u3092\u89e3\u6c7a\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.co.jp @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.co.jp.       300     IN      A       74.125.235.175\nwww.google.co.jp.       300     IN      A       74.125.235.184\nwww.google.co.jp.       300     IN      A       74.125.235.191\nwww.google.co.jp.       300     IN      A       74.125.235.183\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans route53-test.example.org @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nroute53-test.example.org. 1 IN A       198.51.100.10\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans -x 198.51.100.10 @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n10.100.51.198.in-addr.arpa. 1   IN      PTR     route53-test.example.org.\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.co.jp @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.co.jp.       289     IN      A       74.125.235.191\nwww.google.co.jp.       289     IN      A       74.125.235.183\nwww.google.co.jp.       289     IN      A       74.125.235.175\nwww.google.co.jp.       289     IN      A       74.125.235.184\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.com @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.com.         300     IN      A       74.125.235.177\nwww.google.com.         300     IN      A       74.125.235.180\nwww.google.com.         300     IN      A       74.125.235.179\nwww.google.com.         300     IN      A       74.125.235.176\nwww.google.com.         300     IN      A       74.125.235.178\n[testuser@notvpcserver ~]$\n\n\u4ee5\u4e0b\u306fAmazon VPC\u5916\u306eWindows\u30de\u30b7\u30f3\u304b\u3089\u3001\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u4f8b\u3067\u3059\u3002\nc:\\>ipconfig /flushdns\n\nWindows IP \u69cb\u6210\n\nDNS \u30ea\u30be\u30eb\u30d0\u30fc \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u6b63\u5e38\u306b\u30d5\u30e9\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3057\u305f\u3002\n\nc:\\>nslookup route53-test.example.org unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u6a29\u9650\u306e\u306a\u3044\u56de\u7b54:\n\u540d\u524d:    route53-test.example.org\nAddress:  198.51.100.10\n\n\nc:\\>nslookup 198.51.100.10 unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u540d\u524d:    route53-test.example.org\nAddress:  198.51.100.10\n\n\nc:\\>nslookup www.google.com unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u6a29\u9650\u306e\u306a\u3044\u56de\u7b54:\n\u540d\u524d:    www.google.com\nAddresses:  2404:6800:4004:801::1010\n          173.194.38.112\n          173.194.38.114\n          173.194.38.116\n          173.194.38.113\n          173.194.38.115\n\n\n\u25a0unbound\u30ed\u30b0\u30ed\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8a2d\u5b9a\n\u597d\u307f\u306b\u3082\u3088\u308b\u304c\u3001unbound\u30b5\u30fc\u30d0\u306e/var/log/unbound.log\u3092\u30ed\u30b0\u30ed\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3055\u305b\u305f\u3044\u5834\u5408\u3001unbound\u30b5\u30fc\u30d0\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u307e\u305aunbound-control\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u78ba\u8a8d\u3002\n# which unbound-control\n/usr/sbin/unbound-control\n#\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n# vi /etc/logrotate.d/unbound\n/var/log/unbound.log\n{\n    daily\n    rotate 30\n    size 10M\n    missingok\n    compress\n    create 644 unbound unbound\n    sharedscripts\n    prerotate\n        touch /var/log/unbound.log\n        chown unbound:unbound /var/log/unbound.log\n        chmod 644 /var/log/unbound.log\n        /usr/sbin/unbound-control log_reopen\n    endscript\n    postrotate\n        /usr/sbin/unbound-control log_reopen\n    endscript\n}\n#\n\n# chown root:root /etc/logrotate.d/unbound\n# chmod 644 /etc/logrotate.d/unbound\n# \n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n\u25a0\u306f\u3058\u3081\u306b\n===\n\nAWS\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306bDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u3001unbound\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u8af8\u4e8b\u60c5\u306b\u3088\u308a\u3001Amazon Route53\u306b\u4f5c\u6210\u3057\u305fPrivate\u306a\u30be\u30fc\u30f3\u306b\u3064\u3044\u3066\u3001Amazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3082\u540d\u524d\u89e3\u6c7a\u3059\u308b\u5fc5\u8981\u304c\u751f\u3058\u305f\u70ba\u3001Amazon VPC\u5185\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(Amazon Linux)\u306bDNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066unbound\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\nAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3001unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u3001Private\u306aRoute53\u30be\u30fc\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u624b\u9806\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u25a0\u8ffd\u8a18\n===\n\n**\u672c\u6587\u306e\u4f8b\u306b\u4e0d\u9069\u5207\u306a\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u672c\u6587\u4fee\u6b63\u3057\u307e\u3059\u3002\u7533\u3057\u8a33\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u4fee\u6b63\u307e\u3067\u5c11\u3005\u304a\u5f85\u3061\u4e0b\u3055\u3044\u3002**\n\n\u3000  \u2193\n\n**http://qiita.com/iwaim@github \u69d8\u306b\u4f8b\u793a\u7528\u30c9\u30e1\u30a4\u30f3\u3092RFC 6761\u6e96\u62e0\u306e\u3082\u306e\u306b\u4fee\u6b63\u3057\u3066\u9802\u304d\u307e\u3057\u305f\u3002\u9006\u5f15\u304d\u306eIP\u30a2\u30c9\u30ec\u30b9\u3082\u4f8b\u793a\u7528\u306eIP\u30a2\u30c9\u30ec\u30b9\u306b\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\u4f8b\u793a\u7528\u30c9\u30e1\u30a4\u30f3\u3068\u3057\u3066\u4e0d\u9069\u5207\u306a\u30c9\u30e1\u30a4\u30f3\u540d\u3092\u8a18\u8f09\u3057\u3066\u3057\u307e\u3044\u554f\u984c\u3054\u3056\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u307e\u305f\u3001\u672c\u6587\u306e\u4fee\u6b63\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002**\n\n\u3000\u3000\u2193\n\n**yum\u3067unbound\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u5f8c\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305funbound\u306e\u30d0\u30fc\u30b8\u30e7\u30f3(unbound 1.4\u7cfb)\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8106\u5f31\u6027\u304c\u3042\u308b\u306e\u306b\u6c17\u304c\u3064\u304d\u307e\u3057\u305f\u3002\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3067unbound 1.5.1\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u306a\u304a\u3057\u307e\u3057\u305f\u3002\u8a73\u7d30\u306b\u3064\u304d\u307e\u3057\u3066\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002**\nhttp://qiita.com/na0AaooQ/items/ac0e2f0588c70a12f0c5\n\n\u3000\u3000\u2193\n\nRoute53\u306bPrivate\u306a\u6b63\u5f15\u304d\u3068\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3092\u4f5c\u6210\u3059\u308b\u624b\u9806\u3001Route53\u306bA\u30ec\u30b3\u30fc\u30c9\u3068PTR\u30ec\u30b3\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u4e0b\u3055\u3044\u3002\nhttp://qiita.com/na0AaooQ/items/f89788e2e57263209860\n\n\u25a0unbound\u30b5\u30fc\u30d0\u4f5c\u6210\u6642\u306b\u4f7f\u7528\u3057\u305fAMI\n===\n\n\u30fbAmazon Linux AMI 2014.09.1 x86_64 HVM\n\n\u25a0\u305d\u306e\u4ed6\n===\n\n\u30fbRoute53\u306b\u306f\nroute53-test.example.org\u3068\u3044\u3046A\u30ec\u30b3\u30fc\u30c9\u300110.100.51.198.in-addr.arpa\u3068\u3044\u3046PTR\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3057\u3066\u3044\u308b\u3068\u3044\u3046\u4f8b\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30fb\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3046VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u306eUDP53\u756a\u30dd\u30fc\u30c8\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u25a0\u53c2\u8003\u30b5\u30a4\u30c8\n===\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\nhttp://unbound.jp/unbound/unbound-conf/\nhttp://unbound.jp/unbound/howto_optimise/\n\n\u25a0unbound\u30b5\u30fc\u30d0\u69cb\u7bc9\u624b\u9806\n===\n\n\u306f\u3058\u3081\u306bAmazon Linux\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3059\u3002\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u51fa\u6765\u305f\u3089ec2-user\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n```\n$ sudo su -\n# yum update\n# yum --enablerepo=epel install -y unbound\n```\n\n```\n# vi /etc/sysconfig/network-scripts/ifcfg-eth0\nPEERDNS=yes\n\u3000\u2193\nPEERDNS=no\n\n# vi /etc/sysconfig/unbound\n\u3000(\u672b\u5c3e\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0)\nulimit -n 8290\n```\n\n```\n# cp /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\ncp: overwrite \u2018/etc/localtime\u2019? y\n[root@ip-192-168-250-8 ~]# date\nFri Dec 12 14:27:01 JST 2014\n#\n\n# vi /etc/sysconfig/clock\nZONE=\"UTC\" \nUTC=true\n\u3000\u2193\nZONE=\"Asia/Tokyo\" \nUTC=false\nARC=false\n#\n\n# mkdir /etc/unbound/local.d/BACKUP\n# mkdir /etc/unbound/conf.d/BACKUP\n#\n# mv /etc/unbound/conf.d/example.com.conf /etc/unbound/conf.d/BACKUP/\n#\n# mv /etc/unbound/local.d/block-example.com.conf /etc/unbound/local.d/BACKUP/\n#\n```\n\nunbound\u306b\u3088\u308b\u540d\u524d\u89e3\u6c7a\u5148\u306eDNS\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3059\u308bDNS\u30d5\u30a9\u30ef\u30fc\u30c9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\nexample.org\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092Route53\u306b\u30d5\u30a9\u30ef\u30fc\u30c9\u3055\u305b\u305f\u3044\u5834\u5408\u3001forward-addr\u3067example.org\u30c9\u30e1\u30a4\u30f3\u3092\u7d10\u4ed8\u3051\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```\n# vi /etc/unbound/conf.d/example.org.conf\nforward-zone:\n      name: \"example.org.\"\n      forward-addr: XX.XX.XX.2 (unbound\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b)\n#\n```\n\n\u9006\u5f15\u304d\u30be\u30fc\u30f3\u306e\u540d\u524d\u89e3\u6c7a\u3092Route53\u3078\u30d5\u30a9\u30ef\u30fc\u30c9\u3055\u305b\u305f\u3044\u5834\u5408\u3001forward-addr\u3067\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3092\u7d10\u4ed8\u3051\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```\n# vi /etc/unbound/conf.d/100.51.198.in-addr.arpa.conf\nforward-zone:\n      name: \"100.51.198.in-addr.arpa.\"\n      forward-addr: XX.XX.XX.2 (unbound\u30b5\u30fc\u30d0\u3092\u4f5c\u6210\u3057\u305fVPC\u306eAmazonProvidedDNS\u3092\u6307\u5b9a\u3059\u308b)\n#\n```\n\n```\n# vi /etc/unbound/local.d/100.51.198.in-addr.arpa.conf\nlocal-zone: \"100.51.198.in-addr.arpa.\" transparent\n#\n\n# vi /etc/unbound/local.d/example.org.conf\nlocal-zone: \"example.org.\" transparent\n#\n```\n\nunbound\u3092\u52d5\u304b\u3059\u70ba\u3001unbound.conf\u306b\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u30fb\u7de8\u96c6\u3059\u308b\u3002\n\n\u203bunbound\u30b5\u30fc\u30d0\u3092DNS\u30ad\u30e3\u30c3\u30b7\u30e5\u30b5\u30fc\u30d0\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u30b5\u30fc\u30d0\u53f0\u6570\u304c\u591a\u3044\u5834\u5408\u3001\u9069\u5b9c\u30d1\u30e9\u30e1\u30fc\u30bf\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```\n# cp -p /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n# diff /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n#\n\n# vi /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n```\n\nunbound.conf\u306e\u5909\u66f4\u5f8c\u306e\u5dee\u5206\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n```\n# diff /etc/unbound/unbound.conf /etc/unbound/unbound.conf.ORG\n49,50d48\n<       interface: 0.0.0.0@53\n<       interface: ::0@53\n63d60\n<       port: 53\n115d111\n<       msg-buffer-size: 1311240\n163d158\n<       do-ip4: yes\n167d161\n<         do-ip6: no\n173d166\n<       do-udp: yes\n177d169\n<       do-tcp: no\n196,205d187\n<       access-control: 198.51.100.0/24 allow\n<       access-control: 192.0.2.0/24 allow\n<       access-control: 127.0.0.1/32 allow\n<       access-control: ::1 allow\n<       access-control: ::ffff:127.0.0.1 allow\n<       access-control: 0.0.0.0/0 deny\n246d227\n<       logfile: \"/var/log/unbound.log\"\n251d231\n<       use-syslog: no\n258d237\n<       log-queries: yes\n266d244\n<       root-hints: \"/etc/unbound/named.cache\"\n270d247\n<       hide-identity: yes\n274d250\n<       hide-version: yes\n431,432c407\n< ###   val-permissive-mode: no\n<       val-permissive-mode: yes\n---\n>       val-permissive-mode: no\n#\n```\n\n\u4ee5\u4e0b\u306f/etc/unbound/unbound.conf\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n\u203b\u672c\u756a\u74b0\u5883\u3067unbound\u30b5\u30fc\u30d0\u3092\u904b\u7528\u3059\u308b\u5834\u5408\u306f\u3001interface\u30920.0.0.0\u304b\u3089unbound\u30b5\u30fc\u30d0\u306e\u7279\u5b9a\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5236\u9650\u3057\u305f\u308a\u3001chroot\u3092\u6709\u52b9\u5316\u3057\u305f\u308a\u3057\u3066\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5468\u308a\u306e\u8a2d\u5b9a\u3092\u3082\u3063\u3068\u53b3\u3057\u304f\u3057\u305f\u65b9\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```\n# grep -v \"#\" /etc/unbound/unbound.conf | grep -v ^$\nserver:\n        verbosity: 1\n        statistics-interval: 0\n        statistics-cumulative: yes\n        extended-statistics: yes\n        num-threads: 2\n        interface: 0.0.0.0@53\n        interface: ::0@53\n        interface-automatic: no\n        port: 53\n        outgoing-port-permit: 32768-65535\n        outgoing-port-avoid: 0-32767\n        max-udp-size: 3072\n        msg-buffer-size: 1311240\n        do-ip4: yes\n        do-ip6: no\n        do-udp: yes\n        do-tcp: no\n        access-control: 198.51.100.0/24 allow\n        access-control: 192.0.2.0/24 allow\n        access-control: ::1 allow\n        access-control: ::ffff:127.0.0.1 allow\n        access-control: 0.0.0.0/0 deny\n        chroot: \"\"\n        username: \"unbound\"\n        directory: \"/etc/unbound\"\n        logfile: \"/var/log/unbound.log\"\n        use-syslog: no\n        log-time-ascii: yes\n        log-queries: yes\n        pidfile: \"/var/run/unbound/unbound.pid\"\n        root-hints: \"/etc/unbound/named.cache\"\n        hide-identity: yes\n        hide-version: yes\n        harden-glue: yes\n        harden-dnssec-stripped: yes\n        harden-below-nxdomain: yes\n        harden-referral-path: yes\n        use-caps-for-id: no\n        unwanted-reply-threshold: 10000000\n        prefetch: yes\n        prefetch-key: yes\n        rrset-roundrobin: yes\n        minimal-responses: yes\n        dlv-anchor-file: \"/etc/unbound/dlv.isc.org.key\"\n        trusted-keys-file: /etc/unbound/keys.d/*.key\n        auto-trust-anchor-file: \"/var/lib/unbound/root.anchor\"\n        val-clean-additional: yes\n        val-permissive-mode: yes\n        val-log-level: 1\n        include: /etc/unbound/local.d/*.conf\nremote-control:\n        control-enable: yes\n        server-key-file: \"/etc/unbound/unbound_server.key\"\n        server-cert-file: \"/etc/unbound/unbound_server.pem\"\n        control-key-file: \"/etc/unbound/unbound_control.key\"\n        control-cert-file: \"/etc/unbound/unbound_control.pem\"\ninclude: /etc/unbound/conf.d/*.conf\n#\n```\n\nDNS\u30eb\u30fc\u30c8\u30b5\u30fc\u30d0\u304c\u8a18\u8f09\u3055\u308c\u305fhint\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n```\n# wget -O \"/etc/unbound/named.cache\" ftp://FTP.INTERNIC.NET/domain/named.cache\n# chown unbound:unbound /etc/unbound/named.cache\n```\n\n```\n# vi /etc/resolv.conf\n### unbound\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\nnameserver 127.0.0.1\n#\n```\n\npid\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\u3002\n\n```\n# mkdir /var/run/unbound\n# chown unbound:unbound /var/run/unbound\n#\n```\n\n\u521d\u56de\u306e\u307f\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u3002\n\n```\n# touch /var/log/unbound.log\n# chown unbound:unbound /var/log/unbound.log\n# chmod 644 /var/log/unbound.log\n#\n```\n\nunbound\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n```\n# /etc/init.d/unbound start\nGenerating unbound control key and certificate:\nStarting unbound:                                          [  OK  ]\n#\n\n# ps awux | grep -v grep | grep unbound\nunbound   6897  0.0  0.7 146848  8064 ?        Ssl  14:01   0:00 /usr/sbin/unbound -c /etc/unbound/unbound.conf\n#\n\n# unbound-checkconf\nunbound-checkconf: no errors in /etc/unbound/unbound.conf\n#\n\n# chkconfig unbound on\n# chkconfig --list | grep unbound\nunbound         0:off   1:off   2:on    3:on    4:on    5:on    6:off\n#\n```\n\n\u25a0unbound\u306b\u3088\u308b\u540d\u524d\u89e3\u6c7a\u30c6\u30b9\u30c8\n===\n\nunbound\u30b5\u30fc\u30d0\u4e0a\u3067\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\nexample.org\u30c9\u30e1\u30a4\u30f3\u3084\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3001\u305d\u3057\u3066google.co.jp\u7b49\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u3092\u89e3\u6c7a\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\n\u30c6\u30b9\u30c8\u524d\u306b/etc/init.d/unbound reload\u3092\u5b9f\u884c\u3057\u3066\u3001unbound\u30b5\u30fc\u30d0\u4e0a\u306e\u540d\u524d\u89e3\u6c7a\u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u6d88\u3057\u3066\u304a\u304f\u3002\n\n```\n# cat /etc/resolv.conf\n### unbound\u30b5\u30fc\u30d0\u81ea\u8eab\u306eIP\u30a2\u30c9\u30ec\u30b9\nnameserver 127.0.0.1\n#\n\n# /etc/init.d/unbound reload\nStopping unbound:                                          [  OK  ]\nStarting unbound:                                          [  OK  ]\n#\n\n# dig +noall +ans route53-test.example.org @127.0.0.1\nroute53-test.example.org. 5     IN      A       198.51.100.10\n#\n\n# dig +noall +ans -x 198.51.100.10 @127.0.0.1\n10.100.51.198.in-addr.arpa. 1   IN      PTR     route53-test.example.org.\n#\n\n# dig +noall +ans www.google.co.jp @127.0.0.1\nwww.google.co.jp.       300     IN      A       74.125.235.175\nwww.google.co.jp.       300     IN      A       74.125.235.191\nwww.google.co.jp.       300     IN      A       74.125.235.184\nwww.google.co.jp.       300     IN      A       74.125.235.183\n#\n\n# dig +noall +ans www.google.com @127.0.0.1\nwww.google.com.         300     IN      A       74.125.235.178\nwww.google.com.         300     IN      A       74.125.235.176\nwww.google.com.         300     IN      A       74.125.235.180\nwww.google.com.         300     IN      A       74.125.235.179\nwww.google.com.         300     IN      A       74.125.235.177\n#\n\n# /etc/init.d/unbound reload\n#\n```\n\n\n\nAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u3001DNS\u30b5\u30fc\u30d0\u3068\u3057\u3066unbound\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\u3057\u3066\u3001\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\nunbound\u30b5\u30fc\u30d0\u306eunbound.conf\u3084\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001unbound\u30b5\u30fc\u30d0\u3078\u306e\u540d\u524d\u89e3\u6c7a\u3092\u8a31\u53ef\u3057\u305fAmazon VPC\u5916\u306e\u30b5\u30fc\u30d0\u304b\u3089\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\nexample.org\u30c9\u30e1\u30a4\u30f3\u3084\u9006\u5f15\u304d\u30be\u30fc\u30f3\u3001\u305d\u3057\u3066google.co.jp\u7b49\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u540d\u524d\u3092\u89e3\u6c7a\u51fa\u6765\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u3002\n\n```\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.co.jp @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.co.jp.       300     IN      A       74.125.235.175\nwww.google.co.jp.       300     IN      A       74.125.235.184\nwww.google.co.jp.       300     IN      A       74.125.235.191\nwww.google.co.jp.       300     IN      A       74.125.235.183\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans route53-test.example.org @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nroute53-test.example.org. 1 IN A       198.51.100.10\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans -x 198.51.100.10 @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n10.100.51.198.in-addr.arpa. 1   IN      PTR     route53-test.example.org.\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.co.jp @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.co.jp.       289     IN      A       74.125.235.191\nwww.google.co.jp.       289     IN      A       74.125.235.183\nwww.google.co.jp.       289     IN      A       74.125.235.175\nwww.google.co.jp.       289     IN      A       74.125.235.184\n[testuser@notvpcserver ~]$\n\n[testuser@notvpcserver ~]$ dig +noall +ans www.google.com @unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\nwww.google.com.         300     IN      A       74.125.235.177\nwww.google.com.         300     IN      A       74.125.235.180\nwww.google.com.         300     IN      A       74.125.235.179\nwww.google.com.         300     IN      A       74.125.235.176\nwww.google.com.         300     IN      A       74.125.235.178\n[testuser@notvpcserver ~]$\n```\n\n\u4ee5\u4e0b\u306fAmazon VPC\u5916\u306eWindows\u30de\u30b7\u30f3\u304b\u3089\u3001\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u4f8b\u3067\u3059\u3002\n\n```\nc:\\>ipconfig /flushdns\n\nWindows IP \u69cb\u6210\n\nDNS \u30ea\u30be\u30eb\u30d0\u30fc \u30ad\u30e3\u30c3\u30b7\u30e5\u306f\u6b63\u5e38\u306b\u30d5\u30e9\u30c3\u30b7\u30e5\u3055\u308c\u307e\u3057\u305f\u3002\n\nc:\\>nslookup route53-test.example.org unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u6a29\u9650\u306e\u306a\u3044\u56de\u7b54:\n\u540d\u524d:    route53-test.example.org\nAddress:  198.51.100.10\n\n\nc:\\>nslookup 198.51.100.10 unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u540d\u524d:    route53-test.example.org\nAddress:  198.51.100.10\n\n\nc:\\>nslookup www.google.com unbound\u30b5\u30fc\u30d0\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\n\u30b5\u30fc\u30d0\u30fc:  XXXXXXXXXXXXXXXXX\nAddress:  XXX.XXX.XXX.XXX\n\n\u6a29\u9650\u306e\u306a\u3044\u56de\u7b54:\n\u540d\u524d:    www.google.com\nAddresses:  2404:6800:4004:801::1010\n          173.194.38.112\n          173.194.38.114\n          173.194.38.116\n          173.194.38.113\n          173.194.38.115\n```\n\n\u25a0unbound\u30ed\u30b0\u30ed\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u8a2d\u5b9a\n===\n\n\u597d\u307f\u306b\u3082\u3088\u308b\u304c\u3001unbound\u30b5\u30fc\u30d0\u306e/var/log/unbound.log\u3092\u30ed\u30b0\u30ed\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3055\u305b\u305f\u3044\u5834\u5408\u3001unbound\u30b5\u30fc\u30d0\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u307e\u305aunbound-control\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u78ba\u8a8d\u3002\n\n```\n# which unbound-control\n/usr/sbin/unbound-control\n#\n```\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```\n# vi /etc/logrotate.d/unbound\n/var/log/unbound.log\n{\n    daily\n    rotate 30\n    size 10M\n    missingok\n    compress\n    create 644 unbound unbound\n    sharedscripts\n    prerotate\n        touch /var/log/unbound.log\n        chown unbound:unbound /var/log/unbound.log\n        chmod 644 /var/log/unbound.log\n        /usr/sbin/unbound-control log_reopen\n    endscript\n    postrotate\n        /usr/sbin/unbound-control log_reopen\n    endscript\n}\n#\n\n# chown root:root /etc/logrotate.d/unbound\n# chmod 644 /etc/logrotate.d/unbound\n# \n```\n\n\u4ee5\u4e0a\u306b\u306a\u308a\u307e\u3059\u3002\n", "tags": ["Linux", "dns", "unbound1.4.22", "AWS", "route53"]}