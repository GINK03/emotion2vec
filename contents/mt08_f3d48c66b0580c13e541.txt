{"context": "\nmacOS Sierra\u3092 Vagrant Up !\n\n\u6982\u8981\n\n[Vagrant](box\u4f5c\u6210) macOS Sierra(10.12.3)\u4eee\u60f3\u30de\u30b7\u30f3\u4f5c\u6210 (Packer\u4f7f\u7528) \n\u30ad\u30db\u30f3\u3001boxcutter\u3055\u3093\u306e\u3068\u3053\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4f7f\u7528https://github.com/boxcutter/macos\n\n\u3060\u304c\u3001\u305d\u306e\u307e\u307e\u3001\u4f5c\u3063\u305fdmg\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u304b\u3063\u305f\u3002\n\u30b3\u30ec\u2193\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u3001iso\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308c\u3070\u3001\u3044\u3044\u3093\u3058\u3083\u306d\uff1f=> \u30a4\u30f3\u30b9\u30c8\u30fc\u30ebISO\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\uff1amacOS Sierra (10.12)\n\n\n\n\u74b0\u5883\n\nOSX / macOS\u3000\u5b9f\u884c\u74b0\u5883\n\nVirtualbox 5.0.x (5.1\u7cfb\u306f\u3060\u3081\u3063\u307d\u3044)\nbash-3.2$ packer --version\n0.12.2\nbash-3.2$ VBoxManage --version\n5.0.32r112930\nbash-3.2$ vagrant --version\nVagrant 1.9.1\n\n\n\n\n\u624b\u9806\n\nSierra\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3092AppStore\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9=> \"/Applications/Install macOS Sierra.app/\"\n\niso\u4f5c\u6210\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u53d6\u5f97\n\n\u3053\u3074\u307a\nWORK_DIR=${HOME}/work\n# rm -rfv ${WORK_DIR}\nmkdir -p ${WORK_DIR}\ncd ${WORK_DIR}\ncurl -O https://raw.githubusercontent.com/kholia/OSX-KVM/master/create_install_iso.sh\ncurl -O https://raw.githubusercontent.com/kholia/OSX-KVM/master/pbzx\nchmod +x ./create_install_iso.sh\nchmod +x ./pbzx\n\n\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u624b\u3092\u52a0\u3048\u308b\n\ncreate_install_iso.sh\nstage_start \"Replacing Packages symlink with real files\"\nrm -f \"$OSX_inst_img_rw_mnt/System/Installation/Packages\" || exit_with_error \"Deleting Packages symlink failed\"\ncp -pPR \"$OSX_inst_inst_dmg_mnt/Packages\" \"$OSX_inst_img_rw_mnt/System/Installation/\" || exit_with_error \"Copying Packages failed\"\nstage_end_ok\n\n# --- mt08 : CUT from HERE ---\n\nstage_start \"Adding automated components..\"\nSCRIPT_DIR=\"$work_dir/macos/prepare_iso\"\nSUPPORT_DIR=\"$SCRIPT_DIR/support\"\n\nUSER=\"vagrant\"\nPASSWORD=\"vagrant\"\nIMAGE_PATH=\"$SUPPORT_DIR/vagrant.jpg\"\n\n# Flags\nDISABLE_REMOTE_MANAGEMENT=0\nDISABLE_SCREEN_SHARING=0\nDISABLE_SIP=0\n\n# payload items\nmkdir -p \"$SUPPORT_DIR/pkgroot/private/var/db/dslocal/nodes/Default/users\"\nmkdir -p \"$SUPPORT_DIR/pkgroot/private/var/db/shadow/hash\"\nBASE64_IMAGE=$(openssl base64 -in \"$IMAGE_PATH\")\n# Replace USER and BASE64_IMAGE in the user.plist file with the actual user and image\n\neval \"echo \\\"$(cat \"$SUPPORT_DIR/user.plist\")\\\"\" > \"$SUPPORT_DIR/pkgroot/private/var/db/dslocal/nodes/Default/users/$USER.plist\"\n\nUSER_GUID=$(/usr/libexec/PlistBuddy -c 'Print :generateduid:0' \"$SUPPORT_DIR/user.plist\")\n# Generate a shadowhash from the supplied password\n\"$SUPPORT_DIR/generate_shadowhash\" \"$PASSWORD\" > \"$SUPPORT_DIR/pkgroot/private/var/db/shadow/hash/$USER_GUID\"\n\n# postinstall script\nmkdir -p \"$SUPPORT_DIR/tmp/Scripts\"\ncat \"$SUPPORT_DIR/pkg-postinstall\" \\\n    | sed -e \"s/__USER__PLACEHOLDER__/${USER}/\" \\\n    | sed -e \"s/__DISABLE_REMOTE_MANAGEMENT__/${DISABLE_REMOTE_MANAGEMENT}/\" \\\n    | sed -e \"s/__DISABLE_SCREEN_SHARING__/${DISABLE_SCREEN_SHARING}/\" \\\n    | sed -e \"s/__DISABLE_SIP__/${DISABLE_SIP}/\" \\\n          > \"$SUPPORT_DIR/tmp/Scripts/postinstall\"\nchmod a+x \"$SUPPORT_DIR/tmp/Scripts/postinstall\"\n\n# build it\nBUILT_COMPONENT_PKG=\"$SUPPORT_DIR/tmp/veewee-config-component.pkg\"\nBUILT_PKG=\"$SUPPORT_DIR/tmp/veewee-config.pkg\"\npkgbuild --quiet \\\n         --root \"$SUPPORT_DIR/pkgroot\" \\\n         --scripts \"$SUPPORT_DIR/tmp/Scripts\" \\\n         --identifier com.vagrantup.veewee-config \\\n         --version 0.1 \\\n         \"$BUILT_COMPONENT_PKG\"\nproductbuild \\\n    --package \"$BUILT_COMPONENT_PKG\" \\\n    \"$BUILT_PKG\"\nrm -rf \"$SUPPORT_DIR/pkgroot\"\n\nMNT_BASE_SYSTEM=\"$OSX_inst_img_rw_mnt\"\nPACKAGES_DIR=\"$MNT_BASE_SYSTEM/System/Installation/Packages\"\n\nCDROM_LOCAL=\"$MNT_BASE_SYSTEM/private/etc/rc.cdrom.local\"\ncat > $CDROM_LOCAL <<EOF\ndiskutil eraseDisk jhfs+ \"Macintosh HD\" GPTFormat disk0\nif [ \"\\$?\" == \"1\" ]; then\n    diskutil eraseDisk jhfs+ \"Macintosh HD\" GPTFormat disk1\nfi\nEOF\nchmod a+x \"$CDROM_LOCAL\"\nmkdir \"$PACKAGES_DIR/Extras\"\ncp \"$SUPPORT_DIR/minstallconfig.xml\" \"$PACKAGES_DIR/Extras/\"\ncp \"$SUPPORT_DIR/OSInstall.collection\" \"$PACKAGES_DIR/\"\ncp \"$BUILT_PKG\" \"$PACKAGES_DIR/\"\nrm -rf \"$SUPPORT_DIR/tmp\"\nstage_end_ok\n\n# --- mt08 : CUT to HERE ---\n\nstage_start \"Configuring image as bootable\"\nOSX_inst_img_rw_CoreSrv=\"$OSX_inst_img_rw_mnt/System/Library/CoreServices\" || exit_with_error\n\n\n\n\nhttps://github.com/boxcutter/macos/blob/master/prepare_iso/prepare_iso.sh\u3092\u5143\u306b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u308b\u90e8\u5206\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u3068\u3053\u3092\u62bd\u51fa\u3057\u3066\u3001create_install_iso.sh\u306b\u3064\u3063\u3053\u3093\u3067\u308b\u3002\n\n\niso\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210time sudo ./create_install_iso.sh -n -m 2\n\n\u5f85\u3064\n\n\u3053\u3093\u306a\u306e\u304c\u3067\u304d\u308b\u3002\nbash-3.2$ pwd\n/Users/mt08/work\nbash-3.2$ ls -l \"Install_macOS_Sierra_(OS_X_10.12.3).iso\" \n-rw-r--r--  1 mt08  staff  6286895104 Jan 25 10:12 Install_macOS_Sierra_(OS_X_10.12.3).iso\nbash-3.2$ \n\n\n\n\npacker\u4f5c\u6210\u30b9\u30af\u30ea\u30d7\u30c8\u53d6\u5f97\u3057\u3066\u3001macos1012.json\u306b\u624b\u3092\u52a0\u3048\u308b\n\n\u53d6\u5f97\ncd ${WORK_DIR}\ngit clone https://github.com/boxcutter/macos.git\ncd ${WORK_DIR}/macos\n\n\n\nmacos1012.json__iso\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u306e\u5909\u66f4\n@@ -4,7 +4,7 @@\n\"desktop\": \"true\",\n\"cpus\": \"1\",\n\"disk_size\": \"62536\",\n-  \"iso_url\": \"dmg/OSX_InstallESD_10.12_16A323.dmg\",\n+  \"iso_url\": \"../Install_macOS_Sierra_(OS_X_10.12.3).iso\",\n\"memory\": \"4096\",\n\"parallels_guest_os_type\": \"win-8\",\n\"vagrantfile_template\": \"tpl/vagrantfile-macos1012.tpl\",\n\n\n\npacker\u5b9f\u884c\u3001time packer build -only=virtualbox-iso -var-file=macos1012.json macos.json\n\n\u5f85\u3064\u3002\n\n\u3053\u3093\u306a\u306e\u304c\u3067\u304d\u308b\u3002\nbash-3.2$ pwd\n/Users/mt08/work/macos/box/virtualbox\nbash-3.2$ ls -l\ntotal 14056336\n-rw-r--r--  1 mt08  staff  7196839942 Jan 25 17:36 macos1012-0.1.0.box\nbash-3.2$ \n\n\n\n\n\n\u4f7f\u3046\n# box\u8ffd\u52a0\nvagrant box add macos1012-0.1.0.box --name 'macos1012'\n# Vagrantfile\u4f5c\u6210\nvagrant init -m macos1012\n# Vagrant Up !\nvagrant up\n# ssh\u30ed\u30b0\u30a4\u30f3.\nvagrant ssh\n\n\n\nVagrantfile\u3092\u3044\u3058\u3063\u3066\u3001VM\u306e\u30e1\u30e2\u30ea\u3092\u5897\u3084\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3002\n\nVagrantfile(\u53c2\u8003\n# Vagrantfile\n# :: mt08\n\nVB_NAME=\"MacOS 10.12.3\"\nVM_MEMORY=4096\nVM_CORES=3\n\nVagrant.configure(\"2\") do |config|\n    config.vm.box = \"macos1012-1\"\n    config.vm.network \"public_network\", bridge: 'Intel(R) Ethernet Connection I217-LM'\n    config.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n    config.vm.provider \"virtualbox\" do |vb|\n        vb.gui = false\n        vb.name = VB_NAME\n        vb.memory = VM_MEMORY\n        vb.cpus = VM_CORES\n        #vb.customize [\"modifyvm\", :id, \"--hardwareuuid\", \"12345678-1234-5678-0123-456789abcdef\", \"--macaddress1\", \"080027112233\", \"--macaddress2\", \"080027445566\"]\n        #\n\n        #vb.customize [\"modifyvm\", :id, \"--graphicscontroller\", \"vboxvga\"]\n        vb.customize [\"setextradata\", :id, \"VBoxInternal2/EfiGopMode\", \"1\"]\n        #0 \u2013 640\u00d7480\n        #1 \u2013 800\u00d7600\n        #2 \u2013 1024\u00d7768\n        #3 \u2013 1280\u00d71024\n        #4 \u2013 1440\u00d7900\n        #5 \u2013 1920x1200\n    end\n\n    config.vm.provision \"shell\", inline: <<-SHELL\n        whoami # => root\n        defaults write /Library/Preferences/com.apple.screensaver loginWindowIdleTime 0\n    SHELL\n\n    config.vm.provision \"shell\", privileged: false, inline: <<-SHELL\n        defaults -currentHost write com.apple.screensaver idleTime 0\n        #defaults -currentHost read com.apple.screensaver idleTime\n        osascript -e 'tell application \"Finder\" to set desktop picture to POSIX file \"/Library/Desktop Pictures/Solid Colors/Solid Aqua Blue.png\"'\n        #sqlite3 \"${HOME}/Library/Application Support/Dock/desktoppicture.db\" \"update data set value = '/Library/Desktop Pictures/Solid Colors/Solid Aqua Blue.png'\";\n        #killall Dock\n\n        #whoami # => vagrant \n        if ! type \"brew\" > /dev/null; then\n            /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n            brew analytics off\n        fi\n        brew install wget\n        brew install htop\n        brew install byobu\n        mkdir -p /Users/vagrant/Library/Python/2.7/lib/python/site-packages\n        echo 'import site; site.addsitedir(\"/usr/local/lib/python2.7/site-packages\")' >> /Users/vagrant/Library/Python/2.7/lib/python/site-packages/homebrew.pth\n        brew cask install google-chrome         # Chrome\n        #brew cask install xampp\n    SHELL\n\n    config.vm.provision \"shell\", privileged: false, run: \"always\", inline: <<-SHELL\n        #whoami # => vagrant \n        brew analytics off\n        uname -a\n    SHELL\nend\n\n\n\n\u5b9f\u884c\u4f8b\nbash-3.2$ mkdir -p ~/macos1012/\nbash-3.2$ cd ~/macos1012/\nbash-3.2$ vagrant init -m macos1012\nA `Vagrantfile` has been placed in this directory. You are now\nready to `vagrant up` your first virtual environment! Please read\nthe comments in the Vagrantfile as well as documentation on\n`vagrantup.com` for more information on using Vagrant.\nbash-3.2$ \nbash-3.2$ vi ./Vagrantfile    ##\u7de8\u96c6.\nbash-3.2$ \nbash-3.2$ vagrant up\nBringing machine 'default' up with 'virtualbox' provider...\n==> default: Importing base box 'macos1012'...\n==> default: Matching MAC address for NAT networking...\n==> default: Setting the name of the VM: MacOS 10.12.3\n==> default: Clearing any previously set network interfaces...\n==> default: Preparing network interfaces based on configuration...\n    default: Adapter 1: nat\n==> default: Forwarding ports...\n    default: 22 (guest) => 2222 (host) (adapter 1)\n==> default: Running 'pre-boot' VM customizations...\n==> default: Booting VM...\n==> default: Waiting for machine to boot. This may take a few minutes...\n    default: SSH address: 127.0.0.1:2222\n    default: SSH username: vagrant\n    default: SSH auth method: private key\n    default: \n    default: Vagrant insecure key detected. Vagrant will automatically replace\n    default: this with a newly generated keypair for better security.\n    default: \n    default: Inserting generated public key within guest...\n    default: Removing insecure key from the guest if it's present...\n    default: Key inserted! Disconnecting and reconnecting using new SSH key...\n==> default: Machine booted and ready!\n==> default: Checking for guest additions in VM...\n    default: No guest additions were detected on the base box for this VM! Guest\n    default: additions are required for forwarded ports, shared folders, host only\n    default: networking, and more. If SSH fails on this machine, please install\n    default: the guest additions and repackage the box to continue.\n    default: \n    default: This is not an error message; everything may continue to work properly,\n    default: in which case you may ignore this message.\nbash-3.2$ vagrant ssh\nLast login: Thu Jan 26 10:12:11 2017\nosx-10_12:~ vagrant$ uname -a\nDarwin osx-10_12.vagrantup.com 16.4.0 Darwin Kernel Version 16.4.0: Thu Dec 22 22:53:21 PST 2016; root:xnu-3789.41.3~3/RELEASE_X86_64 x86_64\nosx-10_12:~ vagrant$ \n\n\n\n\n\n\u305d\u306e\u4ed6\n\nmacOS\u7528\u306eGuestAdditions\u306f\u306a\u3044\u3001\u3063\u307d\u3044\nVirtualbox\u306e\u753b\u9762\u89e3\u50cf\u5ea6\u3063\u3066\u3001\u3064\u304b\u3048\u308b\u3082\u306e\u306e\u4e2d\u304b\u3089\u3057\u304b\u9078\u3079\u306a\u3044??\n\u5171\u6709\u30d5\u30a9\u30eb\u30c0(Guest:/vagrant <-> Host: Vagranfile\u3042\u308b\u30d5\u30a9\u30eb\u30c0)\u306e\u540c\u671f\u306f\u3069\u3046\u3059\u308b\u306e\u304c\u3044\u3044\uff1f\nVMWare\u306ebox\u3082\u540c\u69d8\u306b\u3064\u304f\u308c\u308b\u304c\u3001\u3064\u304b\u3046\u306b\u306f\u3001Vagrant\u306e\u6709\u6599\u30e9\u30a4\u30bb\u30f3\u30b9\u304c\u5fc5\u8981. => https://www.vagrantup.com/vmware/\n\nVMware Fusion 8 or lower (Mac OS X)\nVMware Workstation 12 or lower (Linux and Windows) \u305d\u308c\u305e\u308c\u3001$79\u3002\u306a\u306e\u3067\u3001\u8a66\u3057\u3066\u3044\u306a\u3044\u3002\n\n\nWin\u67d0s\u306eVirtualbox\u3067\u306f... \u3054\u306b\u3087\u3054\u306b\u3087\u3057\u3066\u3001\u8d77\u52d5\u78ba\u8a8d\u3002\n\n![image.png](https://qiita-image-store.s3.amazonaws.com/0/75594/bd8a714c-2345-cf3d-ff01-f168459d2116.png)\nmacOS Sierra\u3092 Vagrant Up !\n\n## \u6982\u8981\n\n- \\[Vagrant\\](box\u4f5c\u6210) macOS Sierra(10.12.3)\u4eee\u60f3\u30de\u30b7\u30f3\u4f5c\u6210 (Packer\u4f7f\u7528) \n- \u30ad\u30db\u30f3\u3001boxcutter\u3055\u3093\u306e\u3068\u3053\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4f7f\u7528<br>https://github.com/boxcutter/macos\n- \u3060\u304c\u3001\u305d\u306e\u307e\u307e\u3001\u4f5c\u3063\u305fdmg\u3067\u306f\u3046\u307e\u304f\u52d5\u304b\u306a\u304b\u3063\u305f\u3002\n- \u30b3\u30ec\u2193\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u3001iso\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308c\u3070\u3001\u3044\u3044\u3093\u3058\u3083\u306d\uff1f<br>=> [\u30a4\u30f3\u30b9\u30c8\u30fc\u30ebISO\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210\uff1amacOS Sierra (10.12)](http://qiita.com/mt08/items/0e22d636206f27e3e5f5)\n\n## \u74b0\u5883\n- OSX / macOS\u3000\u5b9f\u884c\u74b0\u5883\n- Virtualbox <font color='red'>**5.0.x**</font> (5.1\u7cfb\u306f\u3060\u3081\u3063\u307d\u3044)\n\n    ```shell-session\nbash-3.2$ packer --version\n0.12.2\nbash-3.2$ VBoxManage --version\n5.0.32r112930\nbash-3.2$ vagrant --version\nVagrant 1.9.1\n```\n\n## \u624b\u9806\n1. Sierra\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3092AppStore\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9<br>=> \"`/Applications/Install macOS Sierra.app/`\"\n2. iso\u4f5c\u6210\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u53d6\u5f97\n\n    ```bash:\u3053\u3074\u307a\nWORK_DIR=${HOME}/work\n# rm -rfv ${WORK_DIR}\nmkdir -p ${WORK_DIR}\ncd ${WORK_DIR}\ncurl -O https://raw.githubusercontent.com/kholia/OSX-KVM/master/create_install_iso.sh\ncurl -O https://raw.githubusercontent.com/kholia/OSX-KVM/master/pbzx\nchmod +x ./create_install_iso.sh\nchmod +x ./pbzx\n```\n\n\n3. \u30b9\u30af\u30ea\u30d7\u30c8\u306b\u624b\u3092\u52a0\u3048\u308b\n\n    ```bash:create_install_iso.sh\n\tstage_start \"Replacing Packages symlink with real files\"\n\trm -f \"$OSX_inst_img_rw_mnt/System/Installation/Packages\" || exit_with_error \"Deleting Packages symlink failed\"\n\tcp -pPR \"$OSX_inst_inst_dmg_mnt/Packages\" \"$OSX_inst_img_rw_mnt/System/Installation/\" || exit_with_error \"Copying Packages failed\"\n\tstage_end_ok\n\n\t# --- mt08 : CUT from HERE ---\n\n\tstage_start \"Adding automated components..\"\n\tSCRIPT_DIR=\"$work_dir/macos/prepare_iso\"\n\tSUPPORT_DIR=\"$SCRIPT_DIR/support\"\n\n\tUSER=\"vagrant\"\n\tPASSWORD=\"vagrant\"\n\tIMAGE_PATH=\"$SUPPORT_DIR/vagrant.jpg\"\n\n\t# Flags\n\tDISABLE_REMOTE_MANAGEMENT=0\n\tDISABLE_SCREEN_SHARING=0\n\tDISABLE_SIP=0\n\n\t# payload items\n\tmkdir -p \"$SUPPORT_DIR/pkgroot/private/var/db/dslocal/nodes/Default/users\"\n\tmkdir -p \"$SUPPORT_DIR/pkgroot/private/var/db/shadow/hash\"\n\tBASE64_IMAGE=$(openssl base64 -in \"$IMAGE_PATH\")\n\t# Replace USER and BASE64_IMAGE in the user.plist file with the actual user and image\n\n\teval \"echo \\\"$(cat \"$SUPPORT_DIR/user.plist\")\\\"\" > \"$SUPPORT_DIR/pkgroot/private/var/db/dslocal/nodes/Default/users/$USER.plist\"\n\n\tUSER_GUID=$(/usr/libexec/PlistBuddy -c 'Print :generateduid:0' \"$SUPPORT_DIR/user.plist\")\n\t# Generate a shadowhash from the supplied password\n\t\"$SUPPORT_DIR/generate_shadowhash\" \"$PASSWORD\" > \"$SUPPORT_DIR/pkgroot/private/var/db/shadow/hash/$USER_GUID\"\n\n\t# postinstall script\n\tmkdir -p \"$SUPPORT_DIR/tmp/Scripts\"\n\tcat \"$SUPPORT_DIR/pkg-postinstall\" \\\n\t\t| sed -e \"s/__USER__PLACEHOLDER__/${USER}/\" \\\n\t\t| sed -e \"s/__DISABLE_REMOTE_MANAGEMENT__/${DISABLE_REMOTE_MANAGEMENT}/\" \\\n\t\t| sed -e \"s/__DISABLE_SCREEN_SHARING__/${DISABLE_SCREEN_SHARING}/\" \\\n\t\t| sed -e \"s/__DISABLE_SIP__/${DISABLE_SIP}/\" \\\n\t\t\t  > \"$SUPPORT_DIR/tmp/Scripts/postinstall\"\n\tchmod a+x \"$SUPPORT_DIR/tmp/Scripts/postinstall\"\n\n\t# build it\n\tBUILT_COMPONENT_PKG=\"$SUPPORT_DIR/tmp/veewee-config-component.pkg\"\n\tBUILT_PKG=\"$SUPPORT_DIR/tmp/veewee-config.pkg\"\n\tpkgbuild --quiet \\\n\t\t\t --root \"$SUPPORT_DIR/pkgroot\" \\\n\t\t\t --scripts \"$SUPPORT_DIR/tmp/Scripts\" \\\n\t\t\t --identifier com.vagrantup.veewee-config \\\n\t\t\t --version 0.1 \\\n\t\t\t \"$BUILT_COMPONENT_PKG\"\n\tproductbuild \\\n\t\t--package \"$BUILT_COMPONENT_PKG\" \\\n\t\t\"$BUILT_PKG\"\n\trm -rf \"$SUPPORT_DIR/pkgroot\"\n\n\tMNT_BASE_SYSTEM=\"$OSX_inst_img_rw_mnt\"\n\tPACKAGES_DIR=\"$MNT_BASE_SYSTEM/System/Installation/Packages\"\n\n\tCDROM_LOCAL=\"$MNT_BASE_SYSTEM/private/etc/rc.cdrom.local\"\n\tcat > $CDROM_LOCAL <<EOF\n\tdiskutil eraseDisk jhfs+ \"Macintosh HD\" GPTFormat disk0\n\tif [ \"\\$?\" == \"1\" ]; then\n\t\tdiskutil eraseDisk jhfs+ \"Macintosh HD\" GPTFormat disk1\n\tfi\n\tEOF\n\tchmod a+x \"$CDROM_LOCAL\"\n\tmkdir \"$PACKAGES_DIR/Extras\"\n\tcp \"$SUPPORT_DIR/minstallconfig.xml\" \"$PACKAGES_DIR/Extras/\"\n\tcp \"$SUPPORT_DIR/OSInstall.collection\" \"$PACKAGES_DIR/\"\n\tcp \"$BUILT_PKG\" \"$PACKAGES_DIR/\"\n\trm -rf \"$SUPPORT_DIR/tmp\"\n\tstage_end_ok\n\n\t# --- mt08 : CUT to HERE ---\n\n\tstage_start \"Configuring image as bootable\"\n\tOSX_inst_img_rw_CoreSrv=\"$OSX_inst_img_rw_mnt/System/Library/CoreServices\" || exit_with_error\n```\n    - `https://github.com/boxcutter/macos/blob/master/prepare_iso/prepare_iso.sh`\u3092\u5143\u306b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u81ea\u52d5\u5b9f\u884c\u3055\u308c\u308b\u90e8\u5206\u3092\u3054\u306b\u3087\u3054\u306b\u3087\u3059\u308b\u3068\u3053\u3092\u62bd\u51fa\u3057\u3066\u3001`create_install_iso.sh`\u306b\u3064\u3063\u3053\u3093\u3067\u308b\u3002\n\n4. iso\u30a4\u30e1\u30fc\u30b8\u4f5c\u6210<br>`time sudo ./create_install_iso.sh -n -m 2`\n5. \u5f85\u3064\n\n    ```shell-session:\u3053\u3093\u306a\u306e\u304c\u3067\u304d\u308b\u3002\nbash-3.2$ pwd\n/Users/mt08/work\nbash-3.2$ ls -l \"Install_macOS_Sierra_(OS_X_10.12.3).iso\" \n-rw-r--r--  1 mt08  staff  6286895104 Jan 25 10:12 Install_macOS_Sierra_(OS_X_10.12.3).iso\nbash-3.2$ \n```\n\n6. packer\u4f5c\u6210\u30b9\u30af\u30ea\u30d7\u30c8\u53d6\u5f97\u3057\u3066\u3001`macos1012.json`\u306b\u624b\u3092\u52a0\u3048\u308b\n\n    ```bash:\u53d6\u5f97\ncd ${WORK_DIR}\ngit clone https://github.com/boxcutter/macos.git\ncd ${WORK_DIR}/macos\n```\n\n    ```diff:macos1012.json__iso\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u306e\u5909\u66f4\n@@ -4,7 +4,7 @@\n   \"desktop\": \"true\",\n   \"cpus\": \"1\",\n   \"disk_size\": \"62536\",\n-  \"iso_url\": \"dmg/OSX_InstallESD_10.12_16A323.dmg\",\n+  \"iso_url\": \"../Install_macOS_Sierra_(OS_X_10.12.3).iso\",\n   \"memory\": \"4096\",\n   \"parallels_guest_os_type\": \"win-8\",\n   \"vagrantfile_template\": \"tpl/vagrantfile-macos1012.tpl\",\n```\n\n7. packer\u5b9f\u884c\u3001<br>`time packer build -only=virtualbox-iso -var-file=macos1012.json macos.json`\n\n8. \u5f85\u3064\u3002\n\n    ```shell-session:\u3053\u3093\u306a\u306e\u304c\u3067\u304d\u308b\u3002\nbash-3.2$ pwd\n/Users/mt08/work/macos/box/virtualbox\nbash-3.2$ ls -l\ntotal 14056336\n-rw-r--r--  1 mt08  staff  7196839942 Jan 25 17:36 macos1012-0.1.0.box\nbash-3.2$ \n```\n\n### \u4f7f\u3046\n\n```\n# box\u8ffd\u52a0\nvagrant box add macos1012-0.1.0.box --name 'macos1012'\n# Vagrantfile\u4f5c\u6210\nvagrant init -m macos1012\n# Vagrant Up !\nvagrant up\n# ssh\u30ed\u30b0\u30a4\u30f3.\nvagrant ssh\n```\n- Vagrantfile\u3092\u3044\u3058\u3063\u3066\u3001VM\u306e\u30e1\u30e2\u30ea\u3092\u5897\u3084\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3082\u3002\n\n    ```rb:Vagrantfile(\u53c2\u8003:brew\u3067\u3061\u3087\u3044\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b)\n\t# Vagrantfile\n\t# :: mt08\n\n\tVB_NAME=\"MacOS 10.12.3\"\n\tVM_MEMORY=4096\n\tVM_CORES=3\n\n\tVagrant.configure(\"2\") do |config|\n\t\tconfig.vm.box = \"macos1012-1\"\n\t\tconfig.vm.network \"public_network\", bridge: 'Intel(R) Ethernet Connection I217-LM'\n\t\tconfig.vm.synced_folder \".\", \"/vagrant\", disabled: true\n\n\t\tconfig.vm.provider \"virtualbox\" do |vb|\n\t\t\tvb.gui = false\n\t\t\tvb.name = VB_NAME\n\t\t\tvb.memory = VM_MEMORY\n\t\t\tvb.cpus = VM_CORES\n\t\t\t#vb.customize [\"modifyvm\", :id, \"--hardwareuuid\", \"12345678-1234-5678-0123-456789abcdef\", \"--macaddress1\", \"080027112233\", \"--macaddress2\", \"080027445566\"]\n\t\t\t#\n\t \n\t\t\t#vb.customize [\"modifyvm\", :id, \"--graphicscontroller\", \"vboxvga\"]\n\t\t\tvb.customize [\"setextradata\", :id, \"VBoxInternal2/EfiGopMode\", \"1\"]\n\t\t\t#0 \u2013 640\u00d7480\n\t\t\t#1 \u2013 800\u00d7600\n\t\t\t#2 \u2013 1024\u00d7768\n\t\t\t#3 \u2013 1280\u00d71024\n\t\t\t#4 \u2013 1440\u00d7900\n\t\t\t#5 \u2013 1920x1200\n\t\tend\n\n\t\tconfig.vm.provision \"shell\", inline: <<-SHELL\n\t\t\twhoami # => root\n\t\t\tdefaults write /Library/Preferences/com.apple.screensaver loginWindowIdleTime 0\n\t\tSHELL\n\n\t\tconfig.vm.provision \"shell\", privileged: false, inline: <<-SHELL\n\t\t\tdefaults -currentHost write com.apple.screensaver idleTime 0\n\t\t\t#defaults -currentHost read com.apple.screensaver idleTime\n\t\t\tosascript -e 'tell application \"Finder\" to set desktop picture to POSIX file \"/Library/Desktop Pictures/Solid Colors/Solid Aqua Blue.png\"'\n\t\t\t#sqlite3 \"${HOME}/Library/Application Support/Dock/desktoppicture.db\" \"update data set value = '/Library/Desktop Pictures/Solid Colors/Solid Aqua Blue.png'\";\n\t\t\t#killall Dock\n\n\t\t\t#whoami # => vagrant \n\t\t\tif ! type \"brew\" > /dev/null; then\n\t\t\t\t/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n\t\t\t\tbrew analytics off\n\t\t\tfi\n\t\t\tbrew install wget\n\t\t\tbrew install htop\n\t\t\tbrew install byobu\n\t\t\tmkdir -p /Users/vagrant/Library/Python/2.7/lib/python/site-packages\n\t\t\techo 'import site; site.addsitedir(\"/usr/local/lib/python2.7/site-packages\")' >> /Users/vagrant/Library/Python/2.7/lib/python/site-packages/homebrew.pth\n\t\t\tbrew cask install google-chrome         # Chrome\n\t\t\t#brew cask install xampp\n\t\tSHELL\n\n\t\tconfig.vm.provision \"shell\", privileged: false, run: \"always\", inline: <<-SHELL\n\t\t\t#whoami # => vagrant \n\t\t\tbrew analytics off\n\t\t\tuname -a\n\t\tSHELL\n\tend\n```\n\n    <!-- \n\t\t\tvb.customize [ \"modifyvm\", :id, \"--cpuidset\",\"00000001\",\"000106e5\",\"00100800\",\"0098e3fd\",\"bfebfbff\"]\n\t\t\tvb.customize [ \"setextradata\", :id, \"VBoxInternal/Devices/efi/0/Config/DmiSystemProduct\", \"iMac11,3\"]\n\t\t\tvb.customize [ \"setextradata\", :id, \"VBoxInternal/Devices/efi/0/Config/DmiSystemVersion\",\"1.0\"]\n\t\t\tvb.customize [ \"setextradata\", :id, \"VBoxInternal/Devices/efi/0/Config/DmiBoardProduct\",\"Iloveapple\"]\n\t\t\tvb.customize [ \"setextradata\", :id, \"VBoxInternal/Devices/smc/0/Config/DeviceKey\",\"ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc\"]\n\t\t\tvb.customize [ \"setextradata\", :id, \"VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC\", \"1\"]\n-->\n\n\n    ```shell-session:\u5b9f\u884c\u4f8b\n\tbash-3.2$ mkdir -p ~/macos1012/\n\tbash-3.2$ cd ~/macos1012/\n\tbash-3.2$ vagrant init -m macos1012\n\tA `Vagrantfile` has been placed in this directory. You are now\n\tready to `vagrant up` your first virtual environment! Please read\n\tthe comments in the Vagrantfile as well as documentation on\n\t`vagrantup.com` for more information on using Vagrant.\n\tbash-3.2$ \n\tbash-3.2$ vi ./Vagrantfile    ##\u7de8\u96c6.\n\tbash-3.2$ \n\tbash-3.2$ vagrant up\n\tBringing machine 'default' up with 'virtualbox' provider...\n\t==> default: Importing base box 'macos1012'...\n\t==> default: Matching MAC address for NAT networking...\n\t==> default: Setting the name of the VM: MacOS 10.12.3\n\t==> default: Clearing any previously set network interfaces...\n\t==> default: Preparing network interfaces based on configuration...\n\t\tdefault: Adapter 1: nat\n\t==> default: Forwarding ports...\n\t\tdefault: 22 (guest) => 2222 (host) (adapter 1)\n\t==> default: Running 'pre-boot' VM customizations...\n\t==> default: Booting VM...\n\t==> default: Waiting for machine to boot. This may take a few minutes...\n\t\tdefault: SSH address: 127.0.0.1:2222\n\t\tdefault: SSH username: vagrant\n\t\tdefault: SSH auth method: private key\n\t\tdefault: \n\t\tdefault: Vagrant insecure key detected. Vagrant will automatically replace\n\t\tdefault: this with a newly generated keypair for better security.\n\t\tdefault: \n\t\tdefault: Inserting generated public key within guest...\n\t\tdefault: Removing insecure key from the guest if it's present...\n\t\tdefault: Key inserted! Disconnecting and reconnecting using new SSH key...\n\t==> default: Machine booted and ready!\n\t==> default: Checking for guest additions in VM...\n\t\tdefault: No guest additions were detected on the base box for this VM! Guest\n\t\tdefault: additions are required for forwarded ports, shared folders, host only\n\t\tdefault: networking, and more. If SSH fails on this machine, please install\n\t\tdefault: the guest additions and repackage the box to continue.\n\t\tdefault: \n\t\tdefault: This is not an error message; everything may continue to work properly,\n\t\tdefault: in which case you may ignore this message.\n\tbash-3.2$ vagrant ssh\n\tLast login: Thu Jan 26 10:12:11 2017\n\tosx-10_12:~ vagrant$ uname -a\n\tDarwin osx-10_12.vagrantup.com 16.4.0 Darwin Kernel Version 16.4.0: Thu Dec 22 22:53:21 PST 2016; root:xnu-3789.41.3~3/RELEASE_X86_64 x86_64\n\tosx-10_12:~ vagrant$ \n```\n\n\n## \u305d\u306e\u4ed6\n1. macOS\u7528\u306eGuestAdditions\u306f\u306a\u3044\u3001\u3063\u307d\u3044\n2. Virtualbox\u306e\u753b\u9762\u89e3\u50cf\u5ea6\u3063\u3066\u3001\u3064\u304b\u3048\u308b\u3082\u306e\u306e\u4e2d\u304b\u3089\u3057\u304b\u9078\u3079\u306a\u3044??\n3. \u5171\u6709\u30d5\u30a9\u30eb\u30c0(Guest:`/vagrant` <-> Host: Vagranfile\u3042\u308b\u30d5\u30a9\u30eb\u30c0)\u306e\u540c\u671f\u306f\u3069\u3046\u3059\u308b\u306e\u304c\u3044\u3044\uff1f\n3. VMWare\u306ebox\u3082\u540c\u69d8\u306b\u3064\u304f\u308c\u308b\u304c\u3001\u3064\u304b\u3046\u306b\u306f\u3001Vagrant\u306e\u6709\u6599\u30e9\u30a4\u30bb\u30f3\u30b9\u304c\u5fc5\u8981. <br>=> https://www.vagrantup.com/vmware/\n    - VMware Fusion 8 or lower (Mac OS X)\n    - VMware Workstation 12 or lower (Linux and Windows) <br>\u305d\u308c\u305e\u308c\u3001$79\u3002\u306a\u306e\u3067\u3001\u8a66\u3057\u3066\u3044\u306a\u3044\u3002\n2. Win\u67d0s\u306eVirtualbox\u3067\u306f... \u3054\u306b\u3087\u3054\u306b\u3087\u3057\u3066\u3001\u8d77\u52d5\u78ba\u8a8d\u3002\n", "tags": ["vagrant", "VirtualBox", "MacOSX", "macosSierra"]}