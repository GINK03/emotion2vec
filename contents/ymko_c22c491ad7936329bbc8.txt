{"context": " More than 1 year has passed since last update.Twitter\u306eMojolicious\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3\u306b\" Mojolicious\u3067\u30ce\u30f3\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\u3057\u305f\u3044\u3068\u601d\u3063\u305f\u3089\u3074\u3063\u305f\u308a\u306e\u8a18\u4e8b\u304c\u3042\u3063\u305f \"\u3068\u3044\u3046\u306e\u304c\u6d41\u308c\u3066\u304d\u305f\u306e\u3067\u3084\u3063\u3066\u307f\u308b\n\u5143\u8a18\u4e8b\u306f\u3053\u308c Writing Non-Blocking Applications with Mojolicious: Part 1\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3082\u516c\u958b\u3055\u308c\u3066\u307e\u3059\u304c\u3053\u3053\u3067\u306f\u3061\u3087\u3063\u3068\u6539\u5909\u3002\nblocking_paste.pl \n\u307e\u305a\u3001MongoDB\u3092\u5165\u308c\u308b\u3002\n$ wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.4.9.tgz\n$ tar xzf mongodb-linux-x86_64-2.4.9.tgz\n\nDB\u3092\u4f5c\u6210\u3002\u30c7\u30d5\u30a9\u8a2d\u5b9a\u3060\u30683GB\u8fd1\u304f\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3092\u6d88\u8cbb\u3059\u308b\u306e\u3067smallfiles\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002port27017\u3067\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3059\u3002\n$ mkdir db\n$ ./mongodb-linux-x86_64-2.4.9/bin/mongod --dbpath ./db --nojournal --smallfiles --nssize 4 -vvvv\nTue Mar 18 01:55:00.244 [initandlisten] waiting for connections on port 27017\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u8ffd\u52a0\n$ cpanm Mango\n\n\u3088\u3046\u3084\u304fMojolisious\u30bd\u30fc\u30b9\u3092\u66f8\u304f\u30b3\u30d4\u30da\u5143\n\nnonblocking_paste.pl\n#!/usr/bin/env perl\n\nuse Mojolicious::Lite;\nuse Mango;\nuse Mango::BSON 'bson_oid';\n\n#helper mango  => sub { state $mango = Mango->new($ENV{PASTEDB}) };\nhelper mango  => sub { state $mango = Mango->new(\"mongodb:127.0.0.1:27017\") };\nhelper pastes => sub { shift->mango->db->collection('pastes') };\n\nget '/' => 'submit';\n\npost '/' => sub {\n  my $self = shift;\n  my $title = $self->param('title') || 'Untitled';\n  my $content = $self->param('content')\n    or return $self->redirect_to('/');\n  my $doc = {\n    title   => $title,\n    content => $content,\n  };\n  $self->render_later;\n  $self->pastes->save($doc, sub {\n    my ($coll, $err, $oid) = @_;\n    $self->redirect_to( show => id => \"$oid\" ); \n  });\n};\n\nget '/:id' => sub {\n  my $self = shift;\n  my $id = bson_oid $self->stash('id');\n  $self->render_later;\n  $self->pastes->find_one({ _id => $id }, sub {\n    my ($coll, $err, $doc) = @_;\n    return $self->redirect_to('/') if ( $err or not $doc );\n    $self->render( show => doc => $doc );\n  });\n} => 'show';\n\napp->start;\n\n__DATA__\n\n@@ layouts/basic.html.ep\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><%= title =%></title>\n    %= stylesheet '//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css'\n  </head>\n  <body>\n    <div class=\"container\">\n      <%= content =%>\n    </div>\n  </body>\n</html>\n\n@@ show.html.ep\n\n% title $doc->{title};\n% layout 'basic';\n\n%= stylesheet begin\npre.prettyprint {\n  background-color:inherit;\n  border:none;\n}\n% end\n%= tag h1 => $doc->{title}\n%= tag div => class => 'well' => begin\n  %= tag pre => class => 'prettyprint' => begin\n    <%= $doc->{content} =%>\n  % end\n% end\n%= javascript 'https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'\n\n@@ submit.html.ep\n\n% title 'Paste your content';\n% layout 'basic';\n\n%= form_for '/' => role => form => method => POST => begin\n  %= tag div => class => 'form-group' => begin\n    %= tag label => for => 'title' => 'Title'\n    %= text_field 'title', class => 'form-control'\n  % end\n  %= tag div => class => 'form-group' => begin\n    %= tag label => for => 'content' => 'Paste Content'\n    %= text_area  'content', class => 'form-control'\n  % end\n  %= submit_button 'Paste' => class => 'btn btn-primary'\n% end\n\n\n\nTitle\u3068Paste Content\u3092\u5165\u529b\u3057\u3066Paste\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\nurl/53272b74039ef44015020000 \u307f\u305f\u3044\u306a\u30a2\u30c9\u30ec\u30b9\u3067\u4fdd\u5b58\u3055\u308c\u308b\u3002\uff08BSON\uff09\nDB\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\u53c2\u8003\n\n\u30b1\u30c1\u30b1\u30c1MongoDB | \u3057\u306e\u3076\u3089!!!\n\nTwitter\u306eMojolicious\u30bf\u30a4\u30e0\u30e9\u30a4\u30f3\u306b\" [Mojolicious\u3067\u30ce\u30f3\u30d6\u30ed\u30c3\u30ad\u30f3\u30b0\u3057\u305f\u3044\u3068\u601d\u3063\u305f\u3089\u3074\u3063\u305f\u308a\u306e\u8a18\u4e8b\u304c\u3042\u3063\u305f](https://twitter.com/Squelch_JP/status/445555842520055808) \"\u3068\u3044\u3046\u306e\u304c\u6d41\u308c\u3066\u304d\u305f\u306e\u3067\u3084\u3063\u3066\u307f\u308b\n\n\u5143\u8a18\u4e8b\u306f\u3053\u308c [Writing Non-Blocking Applications with Mojolicious: Part 1](\nhttp://blogs.perl.org/users/joel_berger/2013/10/writing-non-blocking-applications-with-mojolicious-part-1.html)\n\n\u30bd\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u3082\u516c\u958b\u3055\u308c\u3066\u307e\u3059\u304c\u3053\u3053\u3067\u306f\u3061\u3087\u3063\u3068\u6539\u5909\u3002\n[blocking_paste.pl](https://gist.github.com/jberger/6884022\n) \n\n\n\u307e\u305a\u3001MongoDB\u3092\u5165\u308c\u308b\u3002\n\n```\n$ wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.4.9.tgz\n$ tar xzf mongodb-linux-x86_64-2.4.9.tgz\n```\n\nDB\u3092\u4f5c\u6210\u3002\u30c7\u30d5\u30a9\u8a2d\u5b9a\u3060\u30683GB\u8fd1\u304f\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3092\u6d88\u8cbb\u3059\u308b\u306e\u3067smallfiles\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002port27017\u3067\u7acb\u3061\u4e0a\u304c\u308a\u307e\u3059\u3002\n\n```\n$ mkdir db\n$ ./mongodb-linux-x86_64-2.4.9/bin/mongod --dbpath ./db --nojournal --smallfiles --nssize 4 -vvvv\nTue Mar 18 01:55:00.244 [initandlisten] waiting for connections on port 27017\n```\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u8ffd\u52a0\n\n```\n$ cpanm Mango\n```\n\n\u3088\u3046\u3084\u304fMojolisious\u30bd\u30fc\u30b9\u3092\u66f8\u304f[\u30b3\u30d4\u30da\u5143](https://gist.githubusercontent.com/jberger/6884022/raw/78766b3e7f1a84b275f8f804b3c68075b7e2065d/nonblocking_paste.pl)\n\n```pl:nonblocking_paste.pl\n#!/usr/bin/env perl\n\nuse Mojolicious::Lite;\nuse Mango;\nuse Mango::BSON 'bson_oid';\n\n#helper mango  => sub { state $mango = Mango->new($ENV{PASTEDB}) };\nhelper mango  => sub { state $mango = Mango->new(\"mongodb:127.0.0.1:27017\") };\nhelper pastes => sub { shift->mango->db->collection('pastes') };\n\nget '/' => 'submit';\n\npost '/' => sub {\n  my $self = shift;\n  my $title = $self->param('title') || 'Untitled';\n  my $content = $self->param('content')\n    or return $self->redirect_to('/');\n  my $doc = {\n    title   => $title,\n    content => $content,\n  };\n  $self->render_later;\n  $self->pastes->save($doc, sub {\n    my ($coll, $err, $oid) = @_;\n    $self->redirect_to( show => id => \"$oid\" ); \n  });\n};\n\nget '/:id' => sub {\n  my $self = shift;\n  my $id = bson_oid $self->stash('id');\n  $self->render_later;\n  $self->pastes->find_one({ _id => $id }, sub {\n    my ($coll, $err, $doc) = @_;\n    return $self->redirect_to('/') if ( $err or not $doc );\n    $self->render( show => doc => $doc );\n  });\n} => 'show';\n\napp->start;\n\n__DATA__\n\n@@ layouts/basic.html.ep\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <title><%= title =%></title>\n    %= stylesheet '//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css'\n  </head>\n  <body>\n    <div class=\"container\">\n      <%= content =%>\n    </div>\n  </body>\n</html>\n\n@@ show.html.ep\n\n% title $doc->{title};\n% layout 'basic';\n\n%= stylesheet begin\npre.prettyprint {\n  background-color:inherit;\n  border:none;\n}\n% end\n%= tag h1 => $doc->{title}\n%= tag div => class => 'well' => begin\n  %= tag pre => class => 'prettyprint' => begin\n    <%= $doc->{content} =%>\n  % end\n% end\n%= javascript 'https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js'\n\n@@ submit.html.ep\n\n% title 'Paste your content';\n% layout 'basic';\n\n%= form_for '/' => role => form => method => POST => begin\n  %= tag div => class => 'form-group' => begin\n    %= tag label => for => 'title' => 'Title'\n    %= text_field 'title', class => 'form-control'\n  % end\n  %= tag div => class => 'form-group' => begin\n    %= tag label => for => 'content' => 'Paste Content'\n    %= text_area  'content', class => 'form-control'\n  % end\n  %= submit_button 'Paste' => class => 'btn btn-primary'\n% end\n\n```\n\nTitle\u3068Paste Content\u3092\u5165\u529b\u3057\u3066Paste\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\nurl/53272b74039ef44015020000 \u307f\u305f\u3044\u306a\u30a2\u30c9\u30ec\u30b9\u3067\u4fdd\u5b58\u3055\u308c\u308b\u3002\uff08BSON\uff09\nDB\u3092\u518d\u8d77\u52d5\u3057\u3066\u3082\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\n## \u53c2\u8003\n* [\u30b1\u30c1\u30b1\u30c1MongoDB | \u3057\u306e\u3076\u3089!!!](\nhttp://shinobra.com/2012/05/sawanoboly/small_mongodb)\n", "tags": ["Mojolicious", "MongoDB"]}