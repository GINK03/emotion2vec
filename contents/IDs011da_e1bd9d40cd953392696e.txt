{"tags": ["photoshop", "JavaScript"], "context": " More than 1 year has passed since last update.\u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u306b\uff12\u3064\u4ee5\u4e0a\u306e\u30ec\u30a4\u30e4\u30fc\u304c\u5b58\u5728\u3059\u308b\u306e\u304c\u524d\u63d0\u3002\n\n\u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\nfunction closeGroup(layerSet) {\n   var m_Name = layerSet.name;\n   var m_Opacity = layerSet.opacity;\n   var m_BlendMode = layerSet.blendMode;\n   var m_LinkedLayers = layerSet.linkedLayers;\n   var m_bHasMask = hasLayerMask();\n   if(m_bHasMask) loadSelectionOfMask();\n   if(layerSet.layers.length <= 1) {\n      addLayer();\n      var m_Tmp = activeDocument.activeLayer;\n      m_Tmp.name = \"empty\";\n      activeDocument.activeLayer = layerSet;\n      ungroup();\n      addToSelection(\"empty\");\n      groupSelected(m_Name);\n   } else {\n      activeDocument.activeLayer = layerSet;\n      ungroup();\n      groupSelected(m_Name);\n   }\n   var m_Closed = activeDocument.activeLayer;\n   m_Closed.opacity = m_Opacity;\n   m_Closed.blendMode = m_BlendMode;\n   for(x in m_LinkedLayers) {\n      if(m_LinkedLayers[x].typename == \"LayerSet\")\n         activeDocument.activeLayer.link(m_LinkedLayers[x]);\n   }\n   if(m_bHasMask) maskFromSelection();\n   return m_Closed;\n}\n\n\n\n\ncloseGroup()\u306b\u5fc5\u8981\u306a\u30b5\u30d6\u30eb\u30fc\u30c1\u30f3\u95a2\u6570\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u306e\u6709\u7121\nfunction hasLayerMask() {\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( sTID( \"layer\" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ));\n   var m_Dsc01= executeActionGet( m_Ref01 );\n   return m_Dsc01.hasKey(cTID('Usrs'));\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u9078\u629e\u7bc4\u56f2\u306b\u3059\u308b\nfunction loadSelectionOfMask() {\n   selectLayerMask();\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putProperty( cTID( \"Chnl\" ), cTID( \"fsel\" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   var m_Ref02 = new ActionReference();\n   m_Ref02.putEnumerated( cTID( \"Chnl\" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"T   \" ), m_Ref02 );\n   try {\n      executeAction( cTID( \"setd\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u89e3\u9664\u3059\u308b\nfunction ungroup() {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( cTID( \"Lyr \" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   try {\n      executeAction( sTID( \"ungroupLayersEvent\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u65b0\u898f\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0\u3059\u308b\nfunction addLayer() {\n   var m_ActiveLayer = activeDocument.activeLayer;\n   var m_NewLayer = activeDocument.artLayers.add();\n   m_NewLayer.move(m_ActiveLayer, ElementPlacement.PLACEBEFORE);\n   return m_NewLayer;\n}\n\n// \u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u3092\u30a2\u30af\u30c6\u30a3\u30d6\u30ec\u30a4\u30e4\u30fc\u306b\u8ffd\u52a0\u3059\u308b\nfunction addToSelection(layerName) {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putName( cTID( \"Lyr \" ), layerName );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   m_Dsc01.putEnumerated( sTID( \"selectionModifier\" ), sTID( \"selectionModifierType\" ), sTID( \"addToSelection\" ) );\n   m_Dsc01.putBoolean( cTID( \"MkVs\" ), false );\n   try {\n      executeAction( cTID( \"slct\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u3092\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u306b\u3059\u308b\nfunction groupSelected(name) {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putClass( sTID( \"layerSection\" ) );\n   m_Dsc01.putReference(  cTID( \"null\" ), m_Ref01 );\n   var m_Ref02 = new ActionReference();\n   m_Ref02.putEnumerated( cTID( \"Lyr \" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"From\" ), m_Ref02 );\n   var m_Dsc02 = new ActionDescriptor();\n   m_Dsc02.putString( cTID( \"Nm  \" ), name);\n   m_Dsc01.putObject( cTID( \"Usng\" ), sTID( \"layerSection\" ), m_Dsc02 );\n   executeAction( cTID( \"Mk  \" ), m_Dsc01, DialogModes.NO );\n   return activeDocument.activeLayer;\n}\n\n// \u9078\u629e\u7bc4\u56f2\u3092\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u306b\u3059\u308b\uff0f\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u524a\u9664\u3059\u308b\nfunction maskFromSelection() {\n   if(!hasLayerMask()) {\n      var m_Dsc01 = new ActionDescriptor();\n      m_Dsc01.putClass( cTID( \"Nw  \" ), cTID( \"Chnl\" ) );\n      var m_Ref01 = new ActionReference();\n      m_Ref01.putEnumerated( cTID( \"Chnl\" ), cTID( \"Chnl\" ), cTID( \"Msk \" ) );\n      m_Dsc01.putReference( cTID( \"At  \" ), m_Ref01 );\n      m_Dsc01.putEnumerated( cTID( \"Usng\" ), cTID( \"UsrM\" ), cTID( \"RvlS\" ) );\n      try {\n         executeAction( cTID( \"Mk  \" ), m_Dsc01, DialogModes.NO );\n      } catch(e) {\n         activeDocument.selection.selectAll();\n         maskFromSelection();\n      }\n   } else {\n      if(confirm(\"Delete existing mask?\", true, \"Warning\")) {\n         activateLayerMask();\n         deleteMask();\n      }\n   }\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u30c1\u30e3\u30f3\u30cd\u30eb\u4e0a\u3067\u30a2\u30af\u30c6\u30a3\u30d6\u306b\u3059\u308b\nfunction activateLayerMask() {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( cTID( \"Chnl\" ), cTID( \"Chnl\" ), cTID( \"Msk \" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   try {\n      executeAction( cTID( \"slct\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {\n      var m_TmpAlpha = new TemporaryAlpha();\n      maskFromSelection();\n      activateLayerMask();\n      m_TmpAlpha.consume();\n   }\n}\n\n\n\n\n\u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\n// \u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\nfunction closeGroupAll(doc){\n    if (doc === undefined){doc = activeDocument;}\n    var layerSets = doc.layerSets;\n    for (var i=0; i<layerSets.length; i+=1){\n        closeGroupAll(layerSets[i]);\n        closeGroup(layerSets[i]);\n    }\n}\n\n// \u4e0b\u968e\u5c64\u306e\u30ec\u30a4\u30e4\u30fc\u3092\u6700\u4e0a\u5c64\u306e\u30ec\u30a4\u30e4\u30fc\u306b\u3059\u308b\nfunction getRoot(layer){\n    while (layer.parent.parent.name !== \"Adobe Photoshop\"){\n        layer = layer.parent;\n    }\n    return layer;\n}\n\n\n\n\n\u5b9f\u884c\nvar layer = activeDocument.activeLayer;\ncloseGroupAll(activeDocument);\nactiveDocument.activeLayer = getRoot(layer);\n\n\n\u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u306b\uff12\u3064\u4ee5\u4e0a\u306e\u30ec\u30a4\u30e4\u30fc\u304c\u5b58\u5728\u3059\u308b\u306e\u304c\u524d\u63d0\u3002\n\n```lang:\u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\nfunction closeGroup(layerSet) {\n   var m_Name = layerSet.name;\n   var m_Opacity = layerSet.opacity;\n   var m_BlendMode = layerSet.blendMode;\n   var m_LinkedLayers = layerSet.linkedLayers;\n   var m_bHasMask = hasLayerMask();\n   if(m_bHasMask) loadSelectionOfMask();\n   if(layerSet.layers.length <= 1) {\n      addLayer();\n      var m_Tmp = activeDocument.activeLayer;\n      m_Tmp.name = \"empty\";\n      activeDocument.activeLayer = layerSet;\n      ungroup();\n      addToSelection(\"empty\");\n      groupSelected(m_Name);\n   } else {\n      activeDocument.activeLayer = layerSet;\n      ungroup();\n      groupSelected(m_Name);\n   }\n   var m_Closed = activeDocument.activeLayer;\n   m_Closed.opacity = m_Opacity;\n   m_Closed.blendMode = m_BlendMode;\n   for(x in m_LinkedLayers) {\n      if(m_LinkedLayers[x].typename == \"LayerSet\")\n         activeDocument.activeLayer.link(m_LinkedLayers[x]);\n   }\n   if(m_bHasMask) maskFromSelection();\n   return m_Closed;\n}\n\n```\n\n```lang:closeGroup()\u306b\u5fc5\u8981\u306a\u30b5\u30d6\u30eb\u30fc\u30c1\u30f3\u95a2\u6570\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u306e\u6709\u7121\nfunction hasLayerMask() {\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( sTID( \"layer\" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ));\n   var m_Dsc01= executeActionGet( m_Ref01 );\n   return m_Dsc01.hasKey(cTID('Usrs'));\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u9078\u629e\u7bc4\u56f2\u306b\u3059\u308b\nfunction loadSelectionOfMask() {\n   selectLayerMask();\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putProperty( cTID( \"Chnl\" ), cTID( \"fsel\" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   var m_Ref02 = new ActionReference();\n   m_Ref02.putEnumerated( cTID( \"Chnl\" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"T   \" ), m_Ref02 );\n   try {\n      executeAction( cTID( \"setd\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u89e3\u9664\u3059\u308b\nfunction ungroup() {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( cTID( \"Lyr \" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   try {\n      executeAction( sTID( \"ungroupLayersEvent\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u65b0\u898f\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0\u3059\u308b\nfunction addLayer() {\n   var m_ActiveLayer = activeDocument.activeLayer;\n   var m_NewLayer = activeDocument.artLayers.add();\n   m_NewLayer.move(m_ActiveLayer, ElementPlacement.PLACEBEFORE);\n   return m_NewLayer;\n}\n\n// \u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u3092\u30a2\u30af\u30c6\u30a3\u30d6\u30ec\u30a4\u30e4\u30fc\u306b\u8ffd\u52a0\u3059\u308b\nfunction addToSelection(layerName) {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putName( cTID( \"Lyr \" ), layerName );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   m_Dsc01.putEnumerated( sTID( \"selectionModifier\" ), sTID( \"selectionModifierType\" ), sTID( \"addToSelection\" ) );\n   m_Dsc01.putBoolean( cTID( \"MkVs\" ), false );\n   try {\n      executeAction( cTID( \"slct\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {}\n}\n\n// \u6307\u5b9a\u30ec\u30a4\u30e4\u30fc\u3092\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u306b\u3059\u308b\nfunction groupSelected(name) {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putClass( sTID( \"layerSection\" ) );\n   m_Dsc01.putReference(  cTID( \"null\" ), m_Ref01 );\n   var m_Ref02 = new ActionReference();\n   m_Ref02.putEnumerated( cTID( \"Lyr \" ), cTID( \"Ordn\" ), cTID( \"Trgt\" ) );\n   m_Dsc01.putReference( cTID( \"From\" ), m_Ref02 );\n   var m_Dsc02 = new ActionDescriptor();\n   m_Dsc02.putString( cTID( \"Nm  \" ), name);\n   m_Dsc01.putObject( cTID( \"Usng\" ), sTID( \"layerSection\" ), m_Dsc02 );\n   executeAction( cTID( \"Mk  \" ), m_Dsc01, DialogModes.NO );\n   return activeDocument.activeLayer;\n}\n\n// \u9078\u629e\u7bc4\u56f2\u3092\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u306b\u3059\u308b\uff0f\u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u524a\u9664\u3059\u308b\nfunction maskFromSelection() {\n   if(!hasLayerMask()) {\n      var m_Dsc01 = new ActionDescriptor();\n      m_Dsc01.putClass( cTID( \"Nw  \" ), cTID( \"Chnl\" ) );\n      var m_Ref01 = new ActionReference();\n      m_Ref01.putEnumerated( cTID( \"Chnl\" ), cTID( \"Chnl\" ), cTID( \"Msk \" ) );\n      m_Dsc01.putReference( cTID( \"At  \" ), m_Ref01 );\n      m_Dsc01.putEnumerated( cTID( \"Usng\" ), cTID( \"UsrM\" ), cTID( \"RvlS\" ) );\n      try {\n         executeAction( cTID( \"Mk  \" ), m_Dsc01, DialogModes.NO );\n      } catch(e) {\n         activeDocument.selection.selectAll();\n         maskFromSelection();\n      }\n   } else {\n      if(confirm(\"Delete existing mask?\", true, \"Warning\")) {\n         activateLayerMask();\n         deleteMask();\n      }\n   }\n}\n\n// \u30ec\u30a4\u30e4\u30fc\u30de\u30b9\u30af\u3092\u30c1\u30e3\u30f3\u30cd\u30eb\u4e0a\u3067\u30a2\u30af\u30c6\u30a3\u30d6\u306b\u3059\u308b\nfunction activateLayerMask() {\n   var m_Dsc01 = new ActionDescriptor();\n   var m_Ref01 = new ActionReference();\n   m_Ref01.putEnumerated( cTID( \"Chnl\" ), cTID( \"Chnl\" ), cTID( \"Msk \" ) );\n   m_Dsc01.putReference( cTID( \"null\" ), m_Ref01 );\n   try {\n      executeAction( cTID( \"slct\" ), m_Dsc01, DialogModes.NO );\n   } catch(e) {\n      var m_TmpAlpha = new TemporaryAlpha();\n      maskFromSelection();\n      activateLayerMask();\n      m_TmpAlpha.consume();\n   }\n}\n\n```\n\n```lang:\u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\n// \u5168\u3066\u306e\u30ec\u30a4\u30e4\u30fc\u30bb\u30c3\u30c8\u3092\u9589\u3058\u308b\nfunction closeGroupAll(doc){\n\tif (doc === undefined){doc = activeDocument;}\n\tvar layerSets = doc.layerSets;\n\tfor (var i=0; i<layerSets.length; i+=1){\n\t\tcloseGroupAll(layerSets[i]);\n\t\tcloseGroup(layerSets[i]);\n\t}\n}\n\n// \u4e0b\u968e\u5c64\u306e\u30ec\u30a4\u30e4\u30fc\u3092\u6700\u4e0a\u5c64\u306e\u30ec\u30a4\u30e4\u30fc\u306b\u3059\u308b\nfunction getRoot(layer){\n\twhile (layer.parent.parent.name !== \"Adobe Photoshop\"){\n\t\tlayer = layer.parent;\n\t}\n\treturn layer;\n}\n\n```\n\n```lang:\u5b9f\u884c\nvar layer = activeDocument.activeLayer;\ncloseGroupAll(activeDocument);\nactiveDocument.activeLayer = getRoot(layer);\n```\n"}