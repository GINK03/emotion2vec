{"context": " More than 1 year has passed since last update.\u516c\u79c1\u5171\u306bchef\u3092\u4f7f\u3063\u3066\u3044\u3066\u3001\u30c6\u30b9\u30c8\u306bchefspec\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001RSpec\u7cfb\u306b\u306a\u3058\u307f\u304c\u306a\u3044\u304b\u3089\u304b\u3001\u306a\u304b\u306a\u304b\u899a\u3048\u3089\u308c\u306a\u3044\u306e\u3067\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306b\u307e\u3068\u3081\u307e\u3059\u3002\n\u8a73\u7d30\u3084\u6b63\u78ba\u306a\u60c5\u5831\u306f\u672c\u5bb6\u3067\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u672c\u5bb6\uff1ahttps://github.com/acrmp/chefspec\n\nspec\u3092\u66f8\u304f\u4e0a\u3067\u306e\u6e96\u5099\n\nnode\u306e\u8a2d\u5b9a\ncookbook, role, node\u7b49\u3067attributes\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u3066\u3001\u30ec\u30b7\u30d4\u306e\u52d5\u4f5c\u7d50\u679c\u304c\u3053\u308c\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001converge\u3088\u308a\u5148\u306bnode\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nprepare1\nlet( :chef_run ) do\n  chef_run = ChefSpec::ChefRunner.new do |node|\n    node.set['my_attribute'] = 'bar'\n    node.set['my_other_attribute'] = {'hoge' => 'bar2'}\n  end.converge 'example::default'\nend\n\n\n\nchef_environment\u306e\u8a2d\u5b9a\nchef-solo\u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3067\u3001\u500b\u4eba\u7684\u306b\u306f\u3042\u307e\u308a\u4f7f\u3044\u305f\u304f\u306a\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3002Environment\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u306e\u3067node\u3068\u6bd4\u3079\u308b\u3068\u9762\u5012\u3067\u3059\u3002\n\nprepare2\nlet( :chef_run ) do\n  ChefSpec::ChefRunner.new do |node|\n    env = Chef::Environment.new\n    env.name 'staging'\n    node.stub(:chef_environment).and_return env.name\n    Chef::Environment.stub(:load).and_return env\n  end.converge 'example::default'\nend\n\n\n\ncookbook_path\u306e\u8ffd\u52a0\nsite-cookbook\u3092\u4f7f\u3063\u3066\u3044\u305f\u308a\u3067cookbookpath\u304c\u8907\u6570\u3042\u308b\u5834\u5408\u306f\u3001\u30d1\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nprepare3\nlet (:chef_run) { ChefSpec::ChefRunner.new(:cookbook_path => ['cookbooks', 'site-cookbooks']).converge 'example::default' }\n\n\n\nspec\u306e\u66f8\u304d\u65b9\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30b5\u30fc\u30d3\u30b9\u95a2\u9023\n\npackage_and_service\n# package\nexpect(chef_run).to install_package 'foo'\nexpect(chef_run).to install_package_at_version 'foo', '1.2.3'\nexpect(chef_run).to upgrade_package 'foo'\nexpect(chef_run).to install_yum_package 'yum-foo'\n\n# service\nexpect(chef_run).to set_service_to_start_on_boot 'food'\nexpect(chef_run).to restart_service 'food'\n\n\n\n\u30d5\u30a1\u30a4\u30eb\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u64cd\u4f5c\u95a2\u9023\n\n\u57f7\u7b46\u6642\u70b9(2013/02)\u306e\u73fe\u884c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001cookbook_file\u304ccreate_file\u3067\u8a8d\u8b58\u3055\u308c\u306a\u3044\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\uff08pullreq\u306f\u627f\u8a8d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3058\u304d\u306b\u53cd\u6620\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u304c\uff09\n\n\u79c1\u306e\u52d8\u9055\u3044\u3067\u3057\u305f\u30020.9.0\u3067\u3082cookbook_file\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nfile_and_directory\n# directory\nexpect(chef_run).to create_directory '/var/lib/foo'\ndir = chef_run.directory('/var/lib/foo')\nexpect(dir.mode).to eq \"0700\"\nexpect(dir).to be_owned_by('user', 'group')\n\n# cookbook_file\nexpect(chef_run).to create_cookbook_file '/var/lib/hoge.txt'\nfile = chef_run.cookbook_file('/var/lib/hoge.txt')\nexpect(file.mode).to eq \"0700\"\nexpect(file).to be_owned_by('user', 'group')\n\n# file (template)\nexpect(chef_run).to create_file '/var/log/bar.log'\nfile = chef_run.template('/var/log/bar.log')\nexpect(file.mode).to eq \"0600\"\nexpect(file).to be_owned_by('user', 'group')\n\n# remote_file\nexpect(chef_run).to create_remote_file 'http://path/to/file'\nfile = chef_run.remote_file('/var/lib/hoge.txt')\nexpect(file.mode).to eq \"0700\"\nexpect(file).to be_owned_by('user', 'group')\n\n# symlink\nexpect(chef_run).to create_link \"/path/to/link\"\nchef_run.link(\"/path/to/link\").to.should == \"/path/from/link\"\n\n\n\n\u305d\u306e\u4ed6\n\nothers\n# cron\nexpect(chef_run.cron('daily_job')).to be\n\n# include recipe\nexpect(chef_run).to include_recipe 'foo::bar'\n\n# if you want check xxx not, use shoud_not\nexpect(chef_run).not_to create_directory '/no/such/directory'\n\n\n\n\u3042\u3068\u304c\u304d\n\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u3084\u305d\u306e\u5ea6\u5408\u3044\u306f\u3001\u7d71\u4e00\u7684\u306a\u898b\u89e3\u306f\u306a\u3044\u306e\u3067\u4eba\u305d\u308c\u305e\u308c\u3067\u3059\u3002\u79c1\u306e\u5834\u5408\u306f\u3001\u4ed5\u69d8\u3068\u3057\u3066\u660e\u3089\u304b\u306b\u3057\u305f\u3044\u3082\u306e\u3001\u5f8c\u7d9a\u51e6\u7406\u306a\u3069\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u91cd\u8981\u306a\u3082\u306e\u306b\u7d5e\u3063\u3066\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u7279\u306b\u8a2d\u8a08\u304c\u307e\u3068\u307e\u3089\u306a\u3044\u6642\u306f\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u3092\u3059\u308b\u3053\u3068\u3067\u3001\u8a2d\u8a08\u3068\u30c6\u30b9\u30c8\u6e96\u5099\u3092\u540c\u6642\u306b\u3084\u3063\u3064\u3051\u307e\u3059\u3002\n\u516c\u79c1\u5171\u306bchef\u3092\u4f7f\u3063\u3066\u3044\u3066\u3001\u30c6\u30b9\u30c8\u306bchefspec\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u304c\u3001RSpec\u7cfb\u306b\u306a\u3058\u307f\u304c\u306a\u3044\u304b\u3089\u304b\u3001\u306a\u304b\u306a\u304b\u899a\u3048\u3089\u308c\u306a\u3044\u306e\u3067\u30c1\u30fc\u30c8\u30b7\u30fc\u30c8\u306b\u307e\u3068\u3081\u307e\u3059\u3002\n\u8a73\u7d30\u3084\u6b63\u78ba\u306a\u60c5\u5831\u306f\u672c\u5bb6\u3067\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u672c\u5bb6\uff1ahttps://github.com/acrmp/chefspec\n\n## spec\u3092\u66f8\u304f\u4e0a\u3067\u306e\u6e96\u5099\n### node\u306e\u8a2d\u5b9a\ncookbook, role, node\u7b49\u3067attributes\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u3066\u3001\u30ec\u30b7\u30d4\u306e\u52d5\u4f5c\u7d50\u679c\u304c\u3053\u308c\u306b\u4f9d\u5b58\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u3001converge\u3088\u308a\u5148\u306bnode\u306b\u5024\u3092\u30bb\u30c3\u30c8\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```ruby:prepare1\nlet( :chef_run ) do\n  chef_run = ChefSpec::ChefRunner.new do |node|\n    node.set['my_attribute'] = 'bar'\n    node.set['my_other_attribute'] = {'hoge' => 'bar2'}\n  end.converge 'example::default'\nend\n```\n\n### chef_environment\u306e\u8a2d\u5b9a\nchef-solo\u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3067\u3001\u500b\u4eba\u7684\u306b\u306f\u3042\u307e\u308a\u4f7f\u3044\u305f\u304f\u306a\u3044\u3068\u3053\u308d\u3067\u3059\u304c\u3002Environment\u306f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u306e\u3067node\u3068\u6bd4\u3079\u308b\u3068\u9762\u5012\u3067\u3059\u3002\n\n```ruby:prepare2\nlet( :chef_run ) do\n  ChefSpec::ChefRunner.new do |node|\n    env = Chef::Environment.new\n    env.name 'staging'\n    node.stub(:chef_environment).and_return env.name\n    Chef::Environment.stub(:load).and_return env\n  end.converge 'example::default'\nend\n```\n\n### cookbook_path\u306e\u8ffd\u52a0\nsite-cookbook\u3092\u4f7f\u3063\u3066\u3044\u305f\u308a\u3067cookbookpath\u304c\u8907\u6570\u3042\u308b\u5834\u5408\u306f\u3001\u30d1\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```ruby:prepare3\nlet (:chef_run) { ChefSpec::ChefRunner.new(:cookbook_path => ['cookbooks', 'site-cookbooks']).converge 'example::default' }\n```\n\n## spec\u306e\u66f8\u304d\u65b9\n### \u30d1\u30c3\u30b1\u30fc\u30b8\u3001\u30b5\u30fc\u30d3\u30b9\u95a2\u9023\n```ruby:package_and_service\n# package\nexpect(chef_run).to install_package 'foo'\nexpect(chef_run).to install_package_at_version 'foo', '1.2.3'\nexpect(chef_run).to upgrade_package 'foo'\nexpect(chef_run).to install_yum_package 'yum-foo'\n\n# service\nexpect(chef_run).to set_service_to_start_on_boot 'food'\nexpect(chef_run).to restart_service 'food'\n```\n\n### \u30d5\u30a1\u30a4\u30eb\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u64cd\u4f5c\u95a2\u9023\n> \u57f7\u7b46\u6642\u70b9(2013/02)\u306e\u73fe\u884c\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u306f\u3001cookbook_file\u304ccreate_file\u3067\u8a8d\u8b58\u3055\u308c\u306a\u3044\u306e\u3067\u3054\u6ce8\u610f\u3092\u3002\uff08pullreq\u306f\u627f\u8a8d\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3058\u304d\u306b\u53cd\u6620\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u304c\uff09\n\n\u79c1\u306e\u52d8\u9055\u3044\u3067\u3057\u305f\u30020.9.0\u3067\u3082cookbook_file\u306f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```ruby:file_and_directory\n# directory\nexpect(chef_run).to create_directory '/var/lib/foo'\ndir = chef_run.directory('/var/lib/foo')\nexpect(dir.mode).to eq \"0700\"\nexpect(dir).to be_owned_by('user', 'group')\n\n# cookbook_file\nexpect(chef_run).to create_cookbook_file '/var/lib/hoge.txt'\nfile = chef_run.cookbook_file('/var/lib/hoge.txt')\nexpect(file.mode).to eq \"0700\"\nexpect(file).to be_owned_by('user', 'group')\n\n# file (template)\nexpect(chef_run).to create_file '/var/log/bar.log'\nfile = chef_run.template('/var/log/bar.log')\nexpect(file.mode).to eq \"0600\"\nexpect(file).to be_owned_by('user', 'group')\n\n# remote_file\nexpect(chef_run).to create_remote_file 'http://path/to/file'\nfile = chef_run.remote_file('/var/lib/hoge.txt')\nexpect(file.mode).to eq \"0700\"\nexpect(file).to be_owned_by('user', 'group')\n\n# symlink\nexpect(chef_run).to create_link \"/path/to/link\"\nchef_run.link(\"/path/to/link\").to.should == \"/path/from/link\"\n```\n\n### \u305d\u306e\u4ed6\n```ruby:others\n# cron\nexpect(chef_run.cron('daily_job')).to be\n\n# include recipe\nexpect(chef_run).to include_recipe 'foo::bar'\n\n# if you want check xxx not, use shoud_not\nexpect(chef_run).not_to create_directory '/no/such/directory'\n```\n\n## \u3042\u3068\u304c\u304d\n\u30c6\u30b9\u30c8\u306e\u66f8\u304d\u65b9\u3084\u305d\u306e\u5ea6\u5408\u3044\u306f\u3001\u7d71\u4e00\u7684\u306a\u898b\u89e3\u306f\u306a\u3044\u306e\u3067\u4eba\u305d\u308c\u305e\u308c\u3067\u3059\u3002\u79c1\u306e\u5834\u5408\u306f\u3001**\u4ed5\u69d8\u3068\u3057\u3066\u660e\u3089\u304b\u306b\u3057\u305f\u3044\u3082\u306e\u3001\u5f8c\u7d9a\u51e6\u7406\u306a\u3069\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u91cd\u8981\u306a\u3082\u306e**\u306b\u7d5e\u3063\u3066\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u7279\u306b**\u8a2d\u8a08\u304c\u307e\u3068\u307e\u3089\u306a\u3044\u6642\u306f\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u3092\u3059\u308b**\u3053\u3068\u3067\u3001\u8a2d\u8a08\u3068\u30c6\u30b9\u30c8\u6e96\u5099\u3092\u540c\u6642\u306b\u3084\u3063\u3064\u3051\u307e\u3059\u3002", "tags": ["chef", "chefspec", "TDD", "infrastructure"]}