{"context": "\u5df7\u3067\u5927\u6d41\u884c\u3057\u3066\u3044\u308b\u300c\u30ba\u30f3\u30c9\u30b3\u30ad\u30e8\u30b7\u300d\u3092Oracle\u306e\u8868\u95a2\u6570\u3067\u30ad\u30e1\u3066\u307f\u305f\u2606\nhttp://qiita.com/shunsugai@github/items/971a15461de29563bf90\nCREATE OR REPLACE TYPE TYPE_ZUNDOKO AS OBJECT(\n    COL VARCHAR2(256)\n);\n/\nCREATE OR REPLACE TYPE TYPE_ZUNDOKO_TABLE AS TABLE OF TYPE_ZUNDOKO;\n/\nCREATE OR REPLACE FUNCTION ZUNDOKO(MAXROW NUMBER DEFAULT 100) RETURN TYPE_ZUNDOKO_TABLE PIPELINED\nIS\n    WORD VARCHAR(4);\n    TYPE WORD_ARRAY IS VARRAY(2) OF VARCHAR2(4);\n    WORD_LIST WORD_ARRAY := WORD_ARRAY('\u30ba\u30f3', '\u30c9\u30b3');\n    TYPE HISTORY_ARRAY IS VARRAY(5) OF VARCHAR2(4);\n    HISTORY HISTORY_ARRAY := HISTORY_ARRAY('', '', '', '', '');\nBEGIN\n    FOR I IN 1..MAXROW LOOP\n        WORD := WORD_LIST(TRUNC(DBMS_RANDOM.VALUE() * 2 + 1));\n        PIPE ROW(TYPE_ZUNDOKO(WORD));\n        IF HISTORY(2) || HISTORY(3) || HISTORY(4) || HISTORY(5) || WORD = '\u30ba\u30f3\u30ba\u30f3\u30ba\u30f3\u30ba\u30f3\u30c9\u30b3' THEN\n            PIPE ROW(TYPE_ZUNDOKO('\u30ad\u30fb\u30e8\u30fb\u30b7\uff01'));\n            EXIT;\n        END IF;\n        HISTORY(1) := HISTORY(2);\n        HISTORY(2) := HISTORY(3);\n        HISTORY(3) := HISTORY(4);\n        HISTORY(4) := HISTORY(5);\n        HISTORY(5) := WORD;\n    END LOOP;\n    RETURN;\nEND;\n/\n\n\u3067\u3001\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u95a2\u6570\u3092\u30bb\u30ec\u30af\u30c8\u3059\u308b\u3068\u4ee5\u4e0b\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3002\nSQL> SELECT * FROM TABLE(ZUNDOKO());\n\nCOL\n--------------------------------------------------------------------------------\n\u30c9\u30b3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30c9\u30b3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30c9\u30b3\n\u30ad\u30fb\u30e8\u30fb\u30b7\uff01\n\n16\u884c\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u30d1\u30d1\u3084\u3063\u305f\u306d\uff01\uff01\uff01\n\u5df7\u3067\u5927\u6d41\u884c\u3057\u3066\u3044\u308b\u300c\u30ba\u30f3\u30c9\u30b3\u30ad\u30e8\u30b7\u300d\u3092Oracle\u306e\u8868\u95a2\u6570\u3067\u30ad\u30e1\u3066\u307f\u305f\u2606\n\nhttp://qiita.com/shunsugai@github/items/971a15461de29563bf90\n\n```sql\nCREATE OR REPLACE TYPE TYPE_ZUNDOKO AS OBJECT(\n\tCOL VARCHAR2(256)\n);\n/\nCREATE OR REPLACE TYPE TYPE_ZUNDOKO_TABLE AS TABLE OF TYPE_ZUNDOKO;\n/\nCREATE OR REPLACE FUNCTION ZUNDOKO(MAXROW NUMBER DEFAULT 100) RETURN TYPE_ZUNDOKO_TABLE PIPELINED\nIS\n    WORD VARCHAR(4);\n\tTYPE WORD_ARRAY IS VARRAY(2) OF VARCHAR2(4);\n    WORD_LIST WORD_ARRAY := WORD_ARRAY('\u30ba\u30f3', '\u30c9\u30b3');\n    TYPE HISTORY_ARRAY IS VARRAY(5) OF VARCHAR2(4);\n    HISTORY HISTORY_ARRAY := HISTORY_ARRAY('', '', '', '', '');\nBEGIN\n    FOR I IN 1..MAXROW LOOP\n        WORD := WORD_LIST(TRUNC(DBMS_RANDOM.VALUE() * 2 + 1));\n        PIPE ROW(TYPE_ZUNDOKO(WORD));\n        IF HISTORY(2) || HISTORY(3) || HISTORY(4) || HISTORY(5) || WORD = '\u30ba\u30f3\u30ba\u30f3\u30ba\u30f3\u30ba\u30f3\u30c9\u30b3' THEN\n\t\t\tPIPE ROW(TYPE_ZUNDOKO('\u30ad\u30fb\u30e8\u30fb\u30b7\uff01'));\n\t\t\tEXIT;\n\t\tEND IF;\n\t\tHISTORY(1) := HISTORY(2);\n\t\tHISTORY(2) := HISTORY(3);\n\t\tHISTORY(3) := HISTORY(4);\n\t\tHISTORY(4) := HISTORY(5);\n        HISTORY(5) := WORD;\n    END LOOP;\n    RETURN;\nEND;\n/\n```\n\n\u3067\u3001\u3053\u306e\u30c6\u30fc\u30d6\u30eb\u95a2\u6570\u3092\u30bb\u30ec\u30af\u30c8\u3059\u308b\u3068\u4ee5\u4e0b\u304c\u8868\u793a\u3055\u308c\u308b\u306f\u305a\u3002\n\n```cmd\nSQL> SELECT * FROM TABLE(ZUNDOKO());\n\nCOL\n--------------------------------------------------------------------------------\n\u30c9\u30b3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30c9\u30b3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30ba\u30f3\n\u30c9\u30b3\n\u30ad\u30fb\u30e8\u30fb\u30b7\uff01\n\n16\u884c\u304c\u9078\u629e\u3055\u308c\u307e\u3057\u305f\u3002\n```\n\n\u30d1\u30d1\u3084\u3063\u305f\u306d\uff01\uff01\uff01\n", "tags": ["oracle", "\u30ba\u30f3\u30c9\u30b3\u30ad\u30e8\u30b7", "SQL"]}