{"tags": ["Apache2.4", "awstats"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002WEB\u30da\u30fc\u30b8\u306e\u95b2\u89a7\u72b6\u6cc1\u78ba\u8a8d\u306e\u305f\u3081\u3001Apache\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\uff08AWStats\uff09\u3092\u4f7f\u7528\u3057\u3066\u307f\u305f\u3002\n\nUbuntu 14.04\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ sudo aptitude install awstats\n\nawstats\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\n\u203b\u4eee\u60f3\u30db\u30b9\u30c8\u8a2d\u5b9a\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u89e3\u6790\u5bfe\u8c61\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002\n$ sudo vi /etc/awstats/awstats.conf\n\n--- a/awstats/awstats.conf\n+++ b/awstats/awstats.conf\n@@ -48,7 +48,7 @@\n # If there are several log files from load balancing servers :\n # Example: \"/pathtotools/logresolvemerge.pl *.log |\"\n #\n-LogFile=\"/var/log/apache2/access.log\"\n+LogFile=\"/var/log/apache2/other_vhosts_access.log\"\n\n\n # Enter the log file type you want to analyze.\n@@ -120,7 +120,7 @@ LogType=W\n # Example for IIS:\n # LogFormat = 2\n #\n-LogFormat=4\n+LogFormat = \"%virtualname:%other %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot\"\n\n\n # If your log field's separator is not a space, you can change this parameter.\n@@ -151,7 +151,7 @@ LogSeparator=\" \"\n # Example: \"ftp.domain.com\"\n # Example: \"domain.com\"\n #\n-SiteDomain=\"\"\n+SiteDomain=\"home.local\"\n\n\n # Enter here all other possible domain names, addresses or virtual host\n@@ -210,7 +210,7 @@ DirData=\"/var/lib/awstats\"\n # Example: \"/awstats\"\n # Default: \"/cgi-bin\"   (means awstats.pl is in \"/yourwwwroot/cgi-bin\")\n #\n-DirCgi=\"/cgi-bin\"\n+DirCgi=\"/awstats\"\n\n\n # Relative or absolute web URL of your awstats icon directory.\n\n\u30ed\u30b0\u89e3\u6790\u5b9f\u884c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3059\u308b\u3002\n\u203b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u304bcron\u5b9f\u884c\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u3069\u3061\u3089\u304b\u3092\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\n$ sudo vi /etc/cron.d/awstats\n\n--- a/cron.d/awstats\n+++ b/cron.d/awstats\n@@ -1,6 +1,6 @@\n MAILTO=root\n\n-*/10 * * * * www-data [ -x /usr/share/awstats/tools/update.sh ] && /usr/share/awstats/tools/update.sh\n+*/10 * * * * root [ -x /usr/share/awstats/tools/update.sh ] && /usr/share/awstats/tools/update.sh\n\n # Generate static reports:\n-10 03 * * * www-data [ -x /usr/share/awstats/tools/buildstatic.sh ] && /usr/share/awstats/tools/buildstatic.sh\n+10 03 * * * root [ -x /usr/share/awstats/tools/buildstatic.sh ] && /usr/share/awstats/tools/buildstatic.sh\n\napache\u8a2d\u5b9a\u30d5\u30a3\u30a2\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u203b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\n$ cat <<EOS | sudo tee /etc/apache2/sites-available/awstats.conf\nAlias /awstats-icon/ /usr/share/awstats/icon/\nAlias /awstats/ /usr/lib/cgi-bin/\n<Location /awstats>\n    Options FollowSymLinks MultiViews ExecCGI\n    Require ip 192.168.0\n</Location>\n<FilesMatch \"\\.pl$\">\n    AddHandler cgi-script .pl\n</FilesMatch>\nEOS\n\n$ sudo a2enmod cgi\n$ sudo a2ensite awstats\n$ sudo service apache2 restart\n\n\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\nhttp://192.168.0.200/awstats/awstats.pl\n\nCentOS 7\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ sudo yum install awstats\n\napache\u8a2d\u5b9a\u30d5\u30a3\u30a2\u30eb\u3092\u5909\u66f4\u3059\u308b\u3002\n\u203b\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u5909\u66f4\n$ sudo vi /etc/httpd/conf.d/awstats.conf\n\n--- awstats.conf.org    2015-11-23 17:33:57.513830080 +0900\n+++ awstats.conf        2015-11-23 17:34:07.343830053 +0900\n@@ -26,7 +26,7 @@\n     AllowOverride None\n     <IfModule mod_authz_core.c>\n         # Apache 2.4\n-        Require local\n+        Require ip 192.168.0\n     </IfModule>\n     <IfModule !mod_authz_core.c>\n         # Apache 2.2\n\nhttpd\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n$ sudo systemctl restart httpd.service\n\nWEB\u30da\u30fc\u30b8\u306e\u95b2\u89a7\u72b6\u6cc1\u78ba\u8a8d\u306e\u305f\u3081\u3001Apache\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\uff08AWStats\uff09\u3092\u4f7f\u7528\u3057\u3066\u307f\u305f\u3002\n\nUbuntu 14.04\n------------\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```sh\n$ sudo aptitude install awstats\n```\n\nawstats\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\u3002\n\u203b\u4eee\u60f3\u30db\u30b9\u30c8\u8a2d\u5b9a\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u89e3\u6790\u5bfe\u8c61\u306e\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u6307\u5b9a\u3092\u5909\u3048\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u3002\n\n```sh\n$ sudo vi /etc/awstats/awstats.conf\n```\n```diff\n--- a/awstats/awstats.conf\n+++ b/awstats/awstats.conf\n@@ -48,7 +48,7 @@\n # If there are several log files from load balancing servers :\n # Example: \"/pathtotools/logresolvemerge.pl *.log |\"\n #\n-LogFile=\"/var/log/apache2/access.log\"\n+LogFile=\"/var/log/apache2/other_vhosts_access.log\"\n\n\n # Enter the log file type you want to analyze.\n@@ -120,7 +120,7 @@ LogType=W\n # Example for IIS:\n # LogFormat = 2\n #\n-LogFormat=4\n+LogFormat = \"%virtualname:%other %host %other %logname %time1 %methodurl %code %bytesd %refererquot %uaquot\"\n\n\n # If your log field's separator is not a space, you can change this parameter.\n@@ -151,7 +151,7 @@ LogSeparator=\" \"\n # Example: \"ftp.domain.com\"\n # Example: \"domain.com\"\n #\n-SiteDomain=\"\"\n+SiteDomain=\"home.local\"\n\n\n # Enter here all other possible domain names, addresses or virtual host\n@@ -210,7 +210,7 @@ DirData=\"/var/lib/awstats\"\n # Example: \"/awstats\"\n # Default: \"/cgi-bin\"   (means awstats.pl is in \"/yourwwwroot/cgi-bin\")\n #\n-DirCgi=\"/cgi-bin\"\n+DirCgi=\"/awstats\"\n\n\n # Relative or absolute web URL of your awstats icon directory.\n```\n\n\u30ed\u30b0\u89e3\u6790\u5b9f\u884c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3059\u308b\u3002\n\u203b\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3067\u306f\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u304bcron\u5b9f\u884c\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u3069\u3061\u3089\u304b\u3092\u4fee\u6b63\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\n\n```sh\n$ sudo vi /etc/cron.d/awstats\n```\n```diff\n--- a/cron.d/awstats\n+++ b/cron.d/awstats\n@@ -1,6 +1,6 @@\n MAILTO=root\n\n-*/10 * * * * www-data [ -x /usr/share/awstats/tools/update.sh ] && /usr/share/awstats/tools/update.sh\n+*/10 * * * * root [ -x /usr/share/awstats/tools/update.sh ] && /usr/share/awstats/tools/update.sh\n\n # Generate static reports:\n-10 03 * * * www-data [ -x /usr/share/awstats/tools/buildstatic.sh ] && /usr/share/awstats/tools/buildstatic.sh\n+10 03 * * * root [ -x /usr/share/awstats/tools/buildstatic.sh ] && /usr/share/awstats/tools/buildstatic.sh\n```\n\napache\u8a2d\u5b9a\u30d5\u30a3\u30a2\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u203b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u5b58\u5728\u3057\u306a\u3044\u306e\u3067\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u3042\u308a\u3002\n\n```sh\n$ cat <<EOS | sudo tee /etc/apache2/sites-available/awstats.conf\nAlias /awstats-icon/ /usr/share/awstats/icon/\nAlias /awstats/ /usr/lib/cgi-bin/\n<Location /awstats>\n    Options FollowSymLinks MultiViews ExecCGI\n    Require ip 192.168.0\n</Location>\n<FilesMatch \"\\.pl$\">\n    AddHandler cgi-script .pl\n</FilesMatch>\nEOS\n```\n```sh\n$ sudo a2enmod cgi\n$ sudo a2ensite awstats\n$ sudo service apache2 restart\n```\n\n\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\n\nhttp://192.168.0.200/awstats/awstats.pl\n\n\nCentOS 7\n--------\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```sh\n$ sudo yum install awstats\n```\n\napache\u8a2d\u5b9a\u30d5\u30a3\u30a2\u30eb\u3092\u5909\u66f4\u3059\u308b\u3002\n\u203b\u30a2\u30af\u30bb\u30b9\u8a31\u53ef\u5909\u66f4\n\n```sh\n$ sudo vi /etc/httpd/conf.d/awstats.conf\n```\n```diff\n--- awstats.conf.org    2015-11-23 17:33:57.513830080 +0900\n+++ awstats.conf        2015-11-23 17:34:07.343830053 +0900\n@@ -26,7 +26,7 @@\n     AllowOverride None\n     <IfModule mod_authz_core.c>\n         # Apache 2.4\n-        Require local\n+        Require ip 192.168.0\n     </IfModule>\n     <IfModule !mod_authz_core.c>\n         # Apache 2.2\n```\n\nhttpd\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```sh\n$ sudo systemctl restart httpd.service\n```\n"}