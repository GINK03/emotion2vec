{"context": "\"use strict\";\n\nconst inbox = require('inbox');\nconst nodemailer = require('nodemailer');\nconst iconv = require('iconv');\nconst conv = new iconv.Iconv(\"UTF-8\", \"UTF-8\");\nconst MailParser = require(\"mailparser\").MailParser;\nconst mailparser = new MailParser();\n\nconst auth = {user: 'xxxx', pass: 'xxxx'};\n\nvar imap = inbox.createConnection(false, 'imap.gmail.com', {secureConnection: true, auth});\n\nimap.on('connect', function() {\n    console.log('connected');\n    imap.openMailbox('INBOX', function(error) {\n        if (error) throw error;\n    });\n});\n\nimap.connect();\n\nimap.on(\"new\", function(message) { \n    console.log('\u65e5\u6642:' + message.date);\n    console.log('\u9001\u4fe1\u8005:' + message.from.name + '-' + message.from.address);\n    console.log('\u30bf\u30a4\u30c8\u30eb:' + message.title);\n\n    imap\n    .createMessageStream(message.UID)\n    .pipe(mailparser)\n    .on(\"end\", function(mail) {\n        console.log(mail);\n    });\n\n});\n\nimap.on('new', function(message) {\n/*\n    var smtp = nodemailer.createTransport('SMTP', {\n        port: 465,\n        host: 'smtp.gmail.com',\n        secureConnection: true,\n        auth\n    });\n    smtp.sendMail({\n        from: '\u3041\u3083\u3074\u307c\u3063\u3068<' + auth.user + '>',\n        to: message.from.address,\n        subject: \"\u3041\u308a\u304c\u3068\",\n        text: \"\u767b\u9332\u3057\u305f\u3087\"\n    }, function(e, res) {\n        console.log(e ? e.message : res.message);\n        smtp.close();\n    });\n*/\n});\n\n```js\n\"use strict\";\n\nconst inbox = require('inbox');\nconst nodemailer = require('nodemailer');\nconst iconv = require('iconv');\nconst conv = new iconv.Iconv(\"UTF-8\", \"UTF-8\");\nconst MailParser = require(\"mailparser\").MailParser;\nconst mailparser = new MailParser();\n\nconst auth = {user: 'xxxx', pass: 'xxxx'};\n\nvar imap = inbox.createConnection(false, 'imap.gmail.com', {secureConnection: true, auth});\n\nimap.on('connect', function() {\n\tconsole.log('connected');\n\timap.openMailbox('INBOX', function(error) {\n\t\tif (error) throw error;\n\t});\n});\n\nimap.connect();\n\nimap.on(\"new\", function(message) { \n  \tconsole.log('\u65e5\u6642:' + message.date);\n  \tconsole.log('\u9001\u4fe1\u8005:' + message.from.name + '-' + message.from.address);\n  \tconsole.log('\u30bf\u30a4\u30c8\u30eb:' + message.title);\n  \t\n  \timap\n  \t.createMessageStream(message.UID)\n\t.pipe(mailparser)\n  \t.on(\"end\", function(mail) {\n  \t\tconsole.log(mail);\n\t});\n \n});\n \nimap.on('new', function(message) {\n/*\n\tvar smtp = nodemailer.createTransport('SMTP', {\n\t\tport: 465,\n\t\thost: 'smtp.gmail.com',\n\t\tsecureConnection: true,\n\t\tauth\n\t});\n\tsmtp.sendMail({\n\t\tfrom: '\u3041\u3083\u3074\u307c\u3063\u3068<' + auth.user + '>',\n\t\tto: message.from.address,\n\t\tsubject: \"\u3041\u308a\u304c\u3068\",\n\t\ttext: \"\u767b\u9332\u3057\u305f\u3087\"\n\t}, function(e, res) {\n\t\tconsole.log(e ? e.message : res.message);\n\t\tsmtp.close();\n\t});\n*/\n});\n```\n", "tags": ["Node.js", "gmail"]}