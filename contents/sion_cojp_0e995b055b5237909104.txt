{"context": " More than 1 year has passed since last update.\n\n(1) \u74b0\u5883\n\u958b\u767a\u74b0\u5883\uff1aMac\n\u5b9f\u884c\u74b0\u5883\uff1aCentOS6\u30b5\u30fc\u30d0\n\n(2) \u307e\u305a\u306f\u958b\u767a\u74b0\u5883\u3092\u6574\u3048\u307e\u3057\u3087\u3046\u3002Go\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f8b\n[mac]\n### go install\n$ sudo brew install go --cross-compile-all\n\n### PATH\u3092\u901a\u3059\n$ vim /etc/profile\nexport PATH=$PATH:/usr/local/opt/go/libexec/bin\nexport GOPATH=$HOME/go\n\n### \u8aad\u307f\u8fbc\u3080\n$ source /etc/profile\n\n### golint\u5165\u308c\u3066\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u3055\u305b\u308b\n$ go get -u github.com/golang/lint/golint\n\n### atom\u5165\u308c\u308b\u3068\u958b\u767a\u3057\u3084\u3059\u3044\u3067\u3059\u3002\n### \u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304f\u3089\u3044\u30d1\u30c3\u30b1\u30fc\u30b8\u5165\u308c\u3068\u3051\u3070\u5927\u4e08\u592b\u304b\u3068\u3002\u79c1\u306e\u4ed6\u306e\u30b9\u30bf\u30fc\u306f\u3053\u308c\u3002\u3000https://atom.io/users/sioncojp/stars\nlinter-golint\ngodef\natom-runner\ngo-plus\n\n\n(3) \u4eca\u56de\u306f/ \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u7387\u3092\u53d6\u3063\u3066\u304f\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u304d\u307e\u3059\n### df -P\u306e\u5b9f\u884c\n$ df -P\nFilesystem         1024-blocks      Used Available Capacity \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/mapper/VolGroup00-lv_root 279349272 188646616  76512476      72% /\ntmpfs                 16436140         0  16436140       0% /dev/shm\n/dev/sda1               198337     55219    132878      30% /boot\n\n\ndf\u306e/ \u30d1\u30fc\u30c7\u30a3\u30b7\u30e7\u30f3\u4f7f\u7528\u7387\u3092\u53d6\u3063\u3066\u304f\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u304d\u307e\u3059\u3002go\u3067\u66f8\u3044\u305f\u7406\u7531\u306f\u3001\n\n\ngo-mackerel-plugin\u306b\u305d\u3063\u3066\u4f5c\u308b\u3068\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u7dba\u9e97\u306b\u8868\u793a\u3067\u304d\u308b\u3057\u3001x\u8ef8\u306e\u5024\u3082\u3044\u3058\u308c\u308b\u304b\u3089\u3002\n\nmackerel-agent-plugins\u3082Go\u3067\u66f8\u304b\u308c\u3066\u308b\u3057\u3001mackerel plugin\u304c\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3082\u3001nagios plugin\u306e\u4f7f\u3044\u56de\u3057\u3088\u308a\u4e92\u63db\u6027\u306f\u4fdd\u305f\u308c\u308b\u3060\u308d\u3046\u3002\n\n\n(4) \u307e\u305a\u306fGo\u3067\u66f8\u3044\u3066\u307f\u308b\uff08test.go\u3092\u4f5c\u3063\u3066\u307f\u308b\uff09\n\ntest.go\npackage main\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"regexp\"\n    \"strconv\"\n)\nfunc main() {\n    cmd := exec.Command(\"df\", \"-P\")\n    // \u62bd\u51fa\u3059\u308b\u6587\u5b57\u5217\u3002()\u3067\u304f\u304f\u3089\u308c\u3066\u308b\u90e8\u5206\u304c\u62bd\u51fa\u3055\u308c\u308b\u3002\n    // /dev/mapper/VolGroup00-lv_root  567182456 151718832 386652360  29% /\n    // df\u3092\u6253\u3063\u3066\u300129%\u3068/\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u540d\u3092\u30de\u30c3\u30c1\u3055\u305b\u308b\u3002\u6b63\u898f\u8868\u73fe\u306fperl\u306e\u3084\u3064\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u826f\u3044\u3067\u3059\n    re := regexp.MustCompile(`^[^\\s]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+%\\s+(\\/)$`)\n    // \u6a19\u6e96\u51fa\u529b\u3092stdout\u5909\u6570\u306b\u3076\u3061\u8fbc\u3080\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    // \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n    cmd.Start()\n    //\u3042\u3089\u304b\u3058\u3081\u884c\u6570\u304c\u4e8b\u524d\u306b\u308f\u304b\u308b\u306a\u3089\u3001make\u3067\u521d\u671fcapacity\u3092\u6307\u5b9a\u3057\u3066\u30e1\u30e2\u30ea\u78ba\u4fdd\u3059\u308b\n    lines := make([]string, 0, 10)\n    // stdout\u306e\u7d50\u679c\u30921\u884c\u305a\u3064\u8aad\u3093\u3067\u3044\u304f\n    scanner := bufio.NewScanner(stdout)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n        if err := scanner.Err(); err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n    }\n    // float\u578b\u306b\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u5ba3\u8a00\u3057\u3066\u304a\u304f\n    var used float64\n    // 1\u884c\u305a\u3064\u8aad\u3093\u3067\u3044\u3063\u305f\u3082\u306e\u304b\u3089\u3001\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u7387\u3092\u62bd\u51fa\u3059\u308b\n    for _, line := range lines {\n        // \u6b63\u898f\u8868\u73fe\u3067\u66f8\u3044\u305f\u90e8\u5206\u3092\u63a2\u3057\u3066\u3082\u3089\u3044\u3001m\u306b\u6253\u3061\u8fbc\u3080\n        m := re.FindStringSubmatch(line)\n        // \u6587\u5b57\u5217\u304c\u30de\u30c3\u30c1\u3057\u305f\u5834\u5408\u306e\u307f\u306e\n        if len(m) != 0 {\n            // string\u304b\u3089int\u578b\u306b\u5909\u63db\u3059\u308b\u3002\u307e\u305f\u4f7f\u7528\u7387\u306f\u30de\u30c3\u30c1\u3057\u305f1\u756a\u76ee\u306e\u30ab\u30c3\u30b3\n            used, _ = strconv.ParseFloat(m[1], 64)\n            fmt.Println(\"/ :\", used)\n        }\n    }\n}\n\n\n\n(5) \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u308b\n[mac]\n$ cd $HOME/go/src/my/\n### CentOS\u306ex86\u7cfb\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u7528\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\n$ GOOS=linux GOARCH=amd64 go build -o build/mackerel-plugin-disk-used mackerel-plugin-disk-used.go\n### \u7269\u7406\u30b5\u30fc\u30d0\u306brsync\n$ sudo rsync -av build/test 192.168.0.1:/var/tmp/\n\n[192.168.0.1]\n### \u5b9f\u884c\u30c6\u30b9\u30c8\n$ /var/tmp/test\n/ : 72\n# \u305d\u308c\u3063\u307d\u3044\u5024\u304c\u8fd4\u3063\u3066\u304d\u305f\uff01\n\n\n(6) mackerel\u3067\u30e1\u30c8\u30ea\u30c3\u30af\uff08\u30b0\u30e9\u30d5\uff09\u306b\u3059\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u308b\uff08mackerel-plugin-disk-used\u3092\u4f5c\u308b\uff09\n\u51fa\u529b\u306f\u3053\u3046\u306a\u308c\u3070\u826f\u3044\n{metric\u540d}\\t{metric\u5024}\\t{epoch\u79d2}\nGo plugin\u3092\u66f8\u304f\u3068\u304d\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u69cb\u9020\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\u3000\u2460 \u30e1\u30c8\u30ea\u30c3\u30af\u5b9a\u7fa9\u306e\u8a18\u8ff0\n\u3000\u2461 \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u6319\u52d5\u3092\u6c7a\u3081\u308b\u5909\u6570\u306e\u5b9a\u7fa9\n\u3000\u2462 \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u53d6\u5f97\n\u3000\u2463 \u30e1\u30c8\u30ea\u30c3\u30af\u5b9a\u7fa9\u306e\u53d6\u5f97\n\u3000\u2464 main()\u95a2\u6570\n\u9577\u3044\u306e\u3067\u3001git\u306e\u307b\u3046\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\u8aac\u660e\u3082\u66f8\u3044\u3066\u304a\u308a\u307e\u3059\u3002\nhttps://github.com/sioncojp/mackerel_plugins/blob/master/mackerel-plugin-disk-used/disk_used.go\n\n(7) \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u308b\n[mac]\n$ cd $HOME/go/src/my/\n### CentOS\u306ex86\u7cfb\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u7528\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\n$ GOOS=linux GOARCH=amd64 go build -o build/mackerel-plugin-disk-used mackerel-plugin-disk-used.go\n### \u7269\u7406\u30b5\u30fc\u30d0\u306brsync\n$ sudo rsync -av build/mackerel-plugin-disk-used 192.168.0.1:/var/tmp/\n\n[192.168.0.1]\n### \u5b9f\u884c\u30c6\u30b9\u30c8\n$ /var/tmp/disk_used\ndisk.used./ 72  1437975211\n# {metric\u540d}\\t{metric\u5024}\\t{epoch\u79d2}\u3067\u8fd4\u3063\u3066\u304d\u305f\uff01\n\n\n(8) \u5fc5\u8981\u3067\u3042\u308c\u3070pull req\u3092\u51fa\u3057\u307e\u3057\u3087\u3046\nhttps://github.com/sioncojp/mackerel_plugins/tree/master/mackerel-plugin-disk-used\n\u79c1\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u69cb\u9020\u3067\u3059\nbuild.sh\u3092\u53e9\u3051\u3070\u3001build/\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u697d\u30c1\u30f3\u3067\u3059\u3002\n\uff08.gitignore\u3067build/\u3092\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\uff09\n\n(9) \u5b9f\u969b\u306e\u30b5\u30fc\u30d0\u306b\u9069\u7528\u3057\u3066\u307f\u308b\n[192.168.0.1]\n### \u8aad\u307f\u8fbc\u307e\u305b\u308bconf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\n# mackerel-agent\u306fsudo\u6a29\u9650\u3067\u5b9f\u884c\u3057\u3066\u304f\u308c\u307e\u3059\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u90e8\u5206\u306bsudo\u306f\u4e0d\u8981\u3002\n# [plugin.metrics.disk_used]\u3000\u306e\u540d\u524d\u306f\u3001.\u304c\uff12\u500b\u533a\u5207\u308a\u3058\u3083\u306a\u3044\u3068\u30c0\u30e1\u3002\n# checks\uff1a\u95be\u5024\u5224\u5b9a\u306e\u307f\u3002metrics\uff1a\u30b0\u30e9\u30d5\u3068\u95be\u5024\u5224\u5b9a\u3002\n$ vim /etc/mackerel-agent/conf.d/hoge.conf\n[plugin.metrics.disk_used]\ncommand = '/var/tmp/mackerel-plugin-disk-used'\n\n### mackerel-agent\u30ea\u30b9\u30bf\u30fc\u30c8\u3002PATH\u3092\u6b63\u5f0f\u306b\u901a\u3059\u305f\u3081service\u30b3\u30de\u30f3\u30c9\u3067\u3084\u308b\u3002\n$ sudo service mackerel-agent restart\n\n### \u554f\u984c\u304c\u306a\u3044\u304b\u30ed\u30b0\u3092\u898b\u307e\u3057\u3087\u3046\n$ tail -f /var/log/mackerel-agent.log\n\n\n(10) mackerel.io\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\n\n1\u5206\u9593\u9694\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\n\n(11) \u30b0\u30e9\u30d5\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306f\n\n\u5bfe\u8c61\u306e*.conf\u3092\u4fee\u6b63\u3057\u3066mackerel-agent restart\u3002\u3053\u308c\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306f\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u5f8c\u3001\u30b0\u30e9\u30d5\u306esetting\u2192\u30b0\u30e9\u30d5\u306e\u524a\u9664\u3092\u3057\u306a\u3044\u3068\u3001\u30b0\u30e9\u30d5\u81ea\u4f53\u306f\u6d88\u3048\u307e\u305b\u3093\u3002\n\n# (1) \u74b0\u5883\n\u958b\u767a\u74b0\u5883\uff1aMac\n\u5b9f\u884c\u74b0\u5883\uff1aCentOS6\u30b5\u30fc\u30d0\n\n# (2) \u307e\u305a\u306f\u958b\u767a\u74b0\u5883\u3092\u6574\u3048\u307e\u3057\u3087\u3046\u3002Go\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4f8b\n\n```bash\n[mac]\n### go install\n$ sudo brew install go --cross-compile-all\n\n### PATH\u3092\u901a\u3059\n$ vim /etc/profile\nexport PATH=$PATH:/usr/local/opt/go/libexec/bin\nexport GOPATH=$HOME/go\n\n### \u8aad\u307f\u8fbc\u3080\n$ source /etc/profile\n\n### golint\u5165\u308c\u3066\u69cb\u6587\u30c1\u30a7\u30c3\u30af\u3092\u3055\u305b\u308b\n$ go get -u github.com/golang/lint/golint\n \n### atom\u5165\u308c\u308b\u3068\u958b\u767a\u3057\u3084\u3059\u3044\u3067\u3059\u3002\n### \u3068\u308a\u3042\u3048\u305a\u3053\u308c\u304f\u3089\u3044\u30d1\u30c3\u30b1\u30fc\u30b8\u5165\u308c\u3068\u3051\u3070\u5927\u4e08\u592b\u304b\u3068\u3002\u79c1\u306e\u4ed6\u306e\u30b9\u30bf\u30fc\u306f\u3053\u308c\u3002\u3000https://atom.io/users/sioncojp/stars\nlinter-golint\ngodef\natom-runner\ngo-plus\n```\n\n# (3) \u4eca\u56de\u306f/ \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u7387\u3092\u53d6\u3063\u3066\u304f\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u304d\u307e\u3059\n\n```bash\n### df -P\u306e\u5b9f\u884c\n$ df -P\nFilesystem         1024-blocks      Used Available Capacity \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/mapper/VolGroup00-lv_root 279349272 188646616  76512476      72% /\ntmpfs                 16436140         0  16436140       0% /dev/shm\n/dev/sda1               198337     55219    132878      30% /boot\n\n```\n\ndf\u306e/ \u30d1\u30fc\u30c7\u30a3\u30b7\u30e7\u30f3\u4f7f\u7528\u7387\u3092\u53d6\u3063\u3066\u304f\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u304d\u307e\u3059\u3002go\u3067\u66f8\u3044\u305f\u7406\u7531\u306f\u3001\n\n* <a href=\"https://github.com/mackerelio/go-mackerel-plugin\" target=_blank>go-mackerel-plugin</a>\u306b\u305d\u3063\u3066\u4f5c\u308b\u3068\u3001\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u7dba\u9e97\u306b\u8868\u793a\u3067\u304d\u308b\u3057\u3001x\u8ef8\u306e\u5024\u3082\u3044\u3058\u308c\u308b\u304b\u3089\u3002\n* <a href=\"https://github.com/mackerelio/mackerel-agent-plugins\" target=_blank>mackerel-agent-plugins</a>\u3082Go\u3067\u66f8\u304b\u308c\u3066\u308b\u3057\u3001mackerel plugin\u304c\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3055\u308c\u3066\u3082\u3001nagios plugin\u306e\u4f7f\u3044\u56de\u3057\u3088\u308a\u4e92\u63db\u6027\u306f\u4fdd\u305f\u308c\u308b\u3060\u308d\u3046\u3002\n\n# (4) \u307e\u305a\u306fGo\u3067\u66f8\u3044\u3066\u307f\u308b\uff08test.go\u3092\u4f5c\u3063\u3066\u307f\u308b\uff09\n\n```go:test.go\npackage main\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"regexp\"\n    \"strconv\"\n)\nfunc main() {\n    cmd := exec.Command(\"df\", \"-P\")\n    // \u62bd\u51fa\u3059\u308b\u6587\u5b57\u5217\u3002()\u3067\u304f\u304f\u3089\u308c\u3066\u308b\u90e8\u5206\u304c\u62bd\u51fa\u3055\u308c\u308b\u3002\n    // /dev/mapper/VolGroup00-lv_root  567182456 151718832 386652360  29% /\n    // df\u3092\u6253\u3063\u3066\u300129%\u3068/\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u540d\u3092\u30de\u30c3\u30c1\u3055\u305b\u308b\u3002\u6b63\u898f\u8868\u73fe\u306fperl\u306e\u3084\u3064\u3092\u53c2\u8003\u306b\u3059\u308b\u3068\u826f\u3044\u3067\u3059\n    re := regexp.MustCompile(`^[^\\s]+\\s+\\d+\\s+\\d+\\s+\\d+\\s+\\d+%\\s+(\\/)$`)\n    // \u6a19\u6e96\u51fa\u529b\u3092stdout\u5909\u6570\u306b\u3076\u3061\u8fbc\u3080\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        fmt.Println(err)\n        os.Exit(1)\n    }\n    // \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\n    cmd.Start()\n    //\u3042\u3089\u304b\u3058\u3081\u884c\u6570\u304c\u4e8b\u524d\u306b\u308f\u304b\u308b\u306a\u3089\u3001make\u3067\u521d\u671fcapacity\u3092\u6307\u5b9a\u3057\u3066\u30e1\u30e2\u30ea\u78ba\u4fdd\u3059\u308b\n    lines := make([]string, 0, 10)\n    // stdout\u306e\u7d50\u679c\u30921\u884c\u305a\u3064\u8aad\u3093\u3067\u3044\u304f\n    scanner := bufio.NewScanner(stdout)\n    for scanner.Scan() {\n        lines = append(lines, scanner.Text())\n        if err := scanner.Err(); err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n        }\n    }\n    // float\u578b\u306b\u5909\u66f4\u3059\u308b\u305f\u3081\u306b\u5ba3\u8a00\u3057\u3066\u304a\u304f\n    var used float64\n    // 1\u884c\u305a\u3064\u8aad\u3093\u3067\u3044\u3063\u305f\u3082\u306e\u304b\u3089\u3001\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u7387\u3092\u62bd\u51fa\u3059\u308b\n    for _, line := range lines {\n        // \u6b63\u898f\u8868\u73fe\u3067\u66f8\u3044\u305f\u90e8\u5206\u3092\u63a2\u3057\u3066\u3082\u3089\u3044\u3001m\u306b\u6253\u3061\u8fbc\u3080\n        m := re.FindStringSubmatch(line)\n        // \u6587\u5b57\u5217\u304c\u30de\u30c3\u30c1\u3057\u305f\u5834\u5408\u306e\u307f\u306e\n        if len(m) != 0 {\n            // string\u304b\u3089int\u578b\u306b\u5909\u63db\u3059\u308b\u3002\u307e\u305f\u4f7f\u7528\u7387\u306f\u30de\u30c3\u30c1\u3057\u305f1\u756a\u76ee\u306e\u30ab\u30c3\u30b3\n            used, _ = strconv.ParseFloat(m[1], 64)\n            fmt.Println(\"/ :\", used)\n        }\n    }\n}\n```\n\n# (5) \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u308b\n```bash\n[mac]\n$ cd $HOME/go/src/my/\n### CentOS\u306ex86\u7cfb\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u7528\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\n$ GOOS=linux GOARCH=amd64 go build -o build/mackerel-plugin-disk-used mackerel-plugin-disk-used.go\n### \u7269\u7406\u30b5\u30fc\u30d0\u306brsync\n$ sudo rsync -av build/test 192.168.0.1:/var/tmp/\n \n[192.168.0.1]\n### \u5b9f\u884c\u30c6\u30b9\u30c8\n$ /var/tmp/test\n/ : 72\n# \u305d\u308c\u3063\u307d\u3044\u5024\u304c\u8fd4\u3063\u3066\u304d\u305f\uff01\n```\n\n# (6) mackerel\u3067\u30e1\u30c8\u30ea\u30c3\u30af\uff08\u30b0\u30e9\u30d5\uff09\u306b\u3059\u308b\u305f\u3081\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u66f8\u3044\u3066\u307f\u308b\uff08mackerel-plugin-disk-used\u3092\u4f5c\u308b\uff09\n\n\u51fa\u529b\u306f\u3053\u3046\u306a\u308c\u3070\u826f\u3044\n{metric\u540d}\\t{metric\u5024}\\t{epoch\u79d2}\n\nGo plugin\u3092\u66f8\u304f\u3068\u304d\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u69cb\u9020\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u3000\u2460 \u30e1\u30c8\u30ea\u30c3\u30af\u5b9a\u7fa9\u306e\u8a18\u8ff0\n\u3000\u2461 \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u6319\u52d5\u3092\u6c7a\u3081\u308b\u5909\u6570\u306e\u5b9a\u7fa9\n\u3000\u2462 \u30e1\u30c8\u30ea\u30c3\u30af\u306e\u53d6\u5f97\n\u3000\u2463 \u30e1\u30c8\u30ea\u30c3\u30af\u5b9a\u7fa9\u306e\u53d6\u5f97\n\u3000\u2464 main()\u95a2\u6570\n\n\u9577\u3044\u306e\u3067\u3001git\u306e\u307b\u3046\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\u8aac\u660e\u3082\u66f8\u3044\u3066\u304a\u308a\u307e\u3059\u3002\nhttps://github.com/sioncojp/mackerel_plugins/blob/master/mackerel-plugin-disk-used/disk_used.go\n\n# (7) \u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u308b\n\n```bash\n[mac]\n$ cd $HOME/go/src/my/\n### CentOS\u306ex86\u7cfb\u3067\u5b9f\u884c\u3059\u308b\u306e\u3067\u3001\u305d\u308c\u7528\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\n$ GOOS=linux GOARCH=amd64 go build -o build/mackerel-plugin-disk-used mackerel-plugin-disk-used.go\n### \u7269\u7406\u30b5\u30fc\u30d0\u306brsync\n$ sudo rsync -av build/mackerel-plugin-disk-used 192.168.0.1:/var/tmp/\n\n[192.168.0.1]\n### \u5b9f\u884c\u30c6\u30b9\u30c8\n$ /var/tmp/disk_used\ndisk.used./ 72  1437975211\n# {metric\u540d}\\t{metric\u5024}\\t{epoch\u79d2}\u3067\u8fd4\u3063\u3066\u304d\u305f\uff01\n```\n\n# (8) \u5fc5\u8981\u3067\u3042\u308c\u3070pull req\u3092\u51fa\u3057\u307e\u3057\u3087\u3046\nhttps://github.com/sioncojp/mackerel_plugins/tree/master/mackerel-plugin-disk-used\n\u79c1\u306f\u3053\u3093\u306a\u611f\u3058\u306e\u69cb\u9020\u3067\u3059\nbuild.sh\u3092\u53e9\u3051\u3070\u3001build/\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3059\u308b\u3068\u697d\u30c1\u30f3\u3067\u3059\u3002\n\uff08.gitignore\u3067build/\u3092\u3059\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\uff09\n\n# (9) \u5b9f\u969b\u306e\u30b5\u30fc\u30d0\u306b\u9069\u7528\u3057\u3066\u307f\u308b\n\n```bash\n[192.168.0.1]\n### \u8aad\u307f\u8fbc\u307e\u305b\u308bconf\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\n# mackerel-agent\u306fsudo\u6a29\u9650\u3067\u5b9f\u884c\u3057\u3066\u304f\u308c\u307e\u3059\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u90e8\u5206\u306bsudo\u306f\u4e0d\u8981\u3002\n# [plugin.metrics.disk_used]\u3000\u306e\u540d\u524d\u306f\u3001.\u304c\uff12\u500b\u533a\u5207\u308a\u3058\u3083\u306a\u3044\u3068\u30c0\u30e1\u3002\n# checks\uff1a\u95be\u5024\u5224\u5b9a\u306e\u307f\u3002metrics\uff1a\u30b0\u30e9\u30d5\u3068\u95be\u5024\u5224\u5b9a\u3002\n$ vim /etc/mackerel-agent/conf.d/hoge.conf\n[plugin.metrics.disk_used]\ncommand = '/var/tmp/mackerel-plugin-disk-used'\n\n### mackerel-agent\u30ea\u30b9\u30bf\u30fc\u30c8\u3002PATH\u3092\u6b63\u5f0f\u306b\u901a\u3059\u305f\u3081service\u30b3\u30de\u30f3\u30c9\u3067\u3084\u308b\u3002\n$ sudo service mackerel-agent restart\n \n### \u554f\u984c\u304c\u306a\u3044\u304b\u30ed\u30b0\u3092\u898b\u307e\u3057\u3087\u3046\n$ tail -f /var/log/mackerel-agent.log\n```\n\n# (10) mackerel.io\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3001\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\n\n* 1\u5206\u9593\u9694\u3067\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-07-27 17.06.46.png](https://qiita-image-store.s3.amazonaws.com/0/29405/2962726b-771c-4851-c817-e95a9f8a253f.png)\n\n# (11) \u30b0\u30e9\u30d5\u3092\u524a\u9664\u3059\u308b\u3068\u304d\u306f\n\n* \u5bfe\u8c61\u306e*.conf\u3092\u4fee\u6b63\u3057\u3066mackerel-agent restart\u3002\u3053\u308c\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u306f\u3057\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n* \u305d\u306e\u5f8c\u3001\u30b0\u30e9\u30d5\u306esetting\u2192\u30b0\u30e9\u30d5\u306e\u524a\u9664\u3092\u3057\u306a\u3044\u3068\u3001\u30b0\u30e9\u30d5\u81ea\u4f53\u306f\u6d88\u3048\u307e\u305b\u3093\u3002\n", "tags": ["Mackerel", "golang", "Go"]}