{"context": "\n\n1. \u306f\u3058\u3081\u306b\nBluemix\u63d0\u4f9b\u306e\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d\u3092\u4f7f\u3063\u3066\u3001Blumix\u30b3\u30f3\u30c6\u30ca\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3078Softlayer\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n  \u4eca\u56de\u306f\u3001Bluemix\u3068Softlayer\u3092VPN\u63a5\u7d9a\u3057\u3001\u57fa\u672c\u7684\u306a\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\u306e\u304c\u76ee\u7684\u3067\u3059\u3002\n   IBM\u30b3\u30f3\u30c6\u30ca(Docker)\u3084VPN\u30b5\u30fc\u30d3\u30b9\u3001VyOS\u7b49\u306e\u77e5\u8b58\u304c\u5fc5\u8981\u306a\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3068\u3082\u304b\u304f\u52d5\u304b\u3057\u3066\u5168\u4f53\u30a4\u30e1\u30fc\u30b8\u3092\u3064\u304b\u3081\u308b\u3088\u3046\u306b\u9806\u3092\u8ffd\u3063\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n2. \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306b\u3064\u3044\u3066\n\u3000Bluemix \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u5185\u3067 IBM \u30b3\u30f3\u30c6\u30ca\u30fc (Docker \u30b3\u30f3\u30c6\u30ca\u30fc) \u306b\u30bb\u30ad\u30e5\u30a2\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nIBM \u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u524d\u63d0\u3067\u3001\u3053\u308c\u3092\u4f7f\u3048\u3070\u30af\u30e9\u30a6\u30c9\u3068\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30b7\u30b9\u30c6\u30e0\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\n\u5c1a\u3001\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f\u8a2d\u5b9a\u753b\u9762\u3084\u30b3\u30de\u30f3\u30c9\u3001API\u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8a2d\u5b9a\u753b\u9762\u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u4e0b\u8a18\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\nVPN\u30b5\u30fc\u30d3\u30b9\u306b\u3064\u3044\u3066\nhttps://console.ng.bluemix.net/docs/services/vpn/vpn_overview.html#vpn_overview\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3001API\u306b\u3064\u3044\u3066\nhttps://console.ng.bluemix.net/docs/cli/plugins/vpn/index.html\nhttps://new-console.ng.bluemix.net/apidocs/101\n\n\n3. \u69cb\u6210\u306b\u3064\u3044\u3066\n\u3000SoftLayer\u6771\u4eacDC\u306eDebian8\u304b\u3089curl\u3067\u3001Blumix\u4e0a\u306eWeb\u30b3\u30f3\u30c6\u30ca\u3078VPN\u7d4c\u7531\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a2\u30c9\u30ec\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n Debian8\u306fWeb\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u7528\u306e\u64cd\u4f5cPC\u3068\u3057\u3066\u3082\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n Bluemix\u3067\u306e\u4f7f\u7528\u5730\u57df\u306f\u300c\u7c73\u56fd\u5357\u90e8\u300d\n\n \n\u30fbSoftLayer\u5074\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n\u30fbBluemix\u5074VPN\u30b5\u30fc\u30d3\u30b9\u30d1\u30d6\u30ea\u30c3\u30afIP\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u6642\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n\u30fbBluemix\u5074\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u8d77\u52d5\u6642\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n\n4. \u69cb\u7bc9\u9806\u5e8f\n\n\u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\uff1cSoftLayer\u30dd\u30fc\u30bf\u30eb\u3067\u306e\u64cd\u4f5c\uff1e\n\u25bc VyOS\u7528(vyos)\u3068\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u74b0\u5883\u7528\u517cWeb\u63a5\u7d9a\u78ba\u8a8d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528(Debian8)\u306e\uff12\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3002\n\u203bDebian8\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3068\u30b5\u30d6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5024\u306f\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528\u3059\u308b\u3002\n\u2461 \u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u30fb\u4f5c\u6210\n\uff1cSoftLayer\u4f5c\u6210\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306e\u64cd\u4f5c\uff1e\n\u25bc Debian8\u3078Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078CloudFoundry CLI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078IBM Containers CF CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078Docker Hub\u3088\u308a\u3001Apach\u30a4\u30e1\u30fc\u30b8\u3092PULL\u3002\n\u25bc Debian8\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3002\n\u25bc Debian8\u304b\u3089IBM\u30b3\u30f3\u30c6\u30ca\u30fb\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u3078\u4f5c\u6210\u30a4\u30e1\u30fc\u30b8\u3092PUSH\u3057\u3001\u30ab\u30bf\u30ed\u30b0\u306b\u767b\u9332\u3002\n\u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\n\uff1cBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306e\u64cd\u4f5c\uff1e\n\u25bc Bluemix\u30ab\u30bf\u30ed\u30b0\u3088\u308a\u3001\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\u3002\n\u203b\u7a3c\u50cd\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5024\u306f\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528\u3059\u308b\u3002\n\u2463 VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\n\uff1cBluemi\u30c0\u30c3\u30b7\u30dc\u30fc\u30c9\u3067\u306e\u64cd\u4f5c\uff1e\n\u25bc\u300cGateway Appliance\u300d\u3067Gatwway\u540d\u767b\u9332\u3002\n\u25bc \u300cIKE & IPSec Policies\u300d\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u4f7f\u7528\u306e\u305f\u3081\u3001\u5165\u529b\u5909\u66f4\u306a\u3057\u3002\n\u25bc \u300cSite Connections\u300d\u8a2d\u5b9a\n\u2464VyOS\u306eVPN\u8a2d\u5b9a\n\uff1cDebian8\u3067\u306e\u64cd\u4f5c\uff1e\n\u25bc \u3053\u3053\u3067\u306f\u3001\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u306b\u5408\u308f\u305b\u3066\u3001VyOS\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n5. \u69cb\u7bc9\n\n5-1.  \u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\u30fbVyOS\u7528(vyos)\n \u30fb\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u74b0\u5883\u7528\u517cWeb\u63a5\u7d9a\u78ba\u8a8d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528(Debian8\uff1aDebian GNU/Linux 8.x jessie/Stable - Minimal Install (64 bit))\n 2\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3002\nVyOS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u306f\u3001\n\u30fb\u30d1\u30d6\u30ea\u30c3\u30afIP\u300c161.202.154.118\u300d\n\u30fb\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u300c10.132.52.192/16\u300d\u3002\n\u3053\u306e\u5024\u306f\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n5-2. \u2461 \u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u30fb\u4f5c\u6210\nDebian8\u306b\u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\n5-2-1. Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u25bc \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u4fee\u6b63\u306bvim\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nvim\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y vim\n\n\n\u25bc /etc/apt/sources.list\u306bjessie-backports\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\nDebian8\u306eDocker\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u201djessie-backports\u201d\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u306e\u3067\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6709\u52b9\u5316\u3092\u884c\u3046\u3002\n\nsources.list\u306e\u7de8\u96c6\n# vi /etc/apt/sources.list\n\n\n\nsources.list\u306b\u8ffd\u52a0\ndeb http://http.debian.net/debian jessie-backports main\n\n\n\u25bc \u30ab\u30fc\u30cd\u30eb\u3084\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n# apt-get install \u2013y update\n\n\n\u25bc Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y docker.io\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fDocker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\nDocker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n# docker version\n\n\n\nVersion 1.6.2\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\u5ff5\u306e\u305f\u3081\u3001Docker\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nDocker\u306e\u5b9f\u884c\n# docker run ubuntu:latest /bin/echo 'Hello docker'\n\n\nubuntu\u30a4\u30e1\u30fc\u30b8\u304c\u30ed\u30fc\u30ab\u30eb\u306b\u306a\u3044\u306e\u3067\u3001Docker\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089ubuntu\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u2018Hello Docker\u2019\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u306e\u3067\u3001\u6b63\u5e38\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u3044\u307e\u3059\u3002\n\u25bc Docker\u306e\u8d77\u52d5\n\nDocker\u306e\u8d77\u52d5\n# /etc/init.d/docker start\n\n\n\u25bc Docker\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\n\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u306esysv-rc-conf\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\nsysv-rc-conf\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y sysv-rc-conf\n\n\nDocker\u3092\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\u3002\n\n\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\n# sysv-rc-conf docker on\n\n\n\n5-2-2. Debian8\u3078CloudFoundry CLI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGitHub\u30ea\u30dd\u30b8\u30c8\u30eahttps://github.com/cloudfoundry/cli/releases\n\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306bLynx\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\u25bc Lynx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nlynx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y lynx\n\n\n\u25bc Cloud Foundry CLI\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nlynx\u64cd\u4f5c\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n# lynx https://github.com/cloudfoundry/cli/releases/tag/v6.21.1\n\n\n\n\u201cDebian 64 bit\u201d\u3092\u9078\u629e\n\n\u30d5\u30a1\u30a4\u30eb\u540d\u300ccf-cli-installer_6.21.1_x86-64.deb\u300d\u3067\u30c7\u30a3\u30b9\u30af\u306b\u4fdd\u5b58\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nCloudFoundryCLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# dpkg \u2013i cf-cli-installer_6.21.1_x86-64.deb\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fCloud Foundry CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\nCloudFoundryCLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n# cf \u2013v\n\n\n\nVersion 6.21.1\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\n5-2-3. Debian8\u3078IBM Containers CF CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u3053\u3053\u3067\u306f\u3001\u201cLinux 64 bit\u74b0\u5883\u201d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002\n\u25bc \u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# cf install-plugin https://static-ice.ng.bluemix.net/ibm-containers-linux_x64\n\n\n\n\u25bc \u30d7\u30e9\u30b0\u30a4\u30f3\u78ba\u8a8d\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u78ba\u8a8d\n# cf plugins\n\n\n\nVersion 0.8.897\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\u25bc \u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\n\n\u203b\u3042\u3089\u304b\u3058\u3081Bluemix\u74b0\u5883\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6e96\u5099\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u30ed\u30b0\u30a4\u30f3\u306b\u306f\u3001\u30e1\u30fc\u30ebID\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30b9\u30da\u30fc\u30b9\u304c\u5fc5\u8981\u3067\u3059\uff01\n30\u65e5\u30d5\u30ea\u30fc\u30c8\u30e9\u30a4\u30a2\u30eb\u306f\u4e0b\u8a18URL\u3088\u308a\nhttps://developer.ibm.com/sso/bmregistration?lang=ja_JP&ca=dwjapan-_-bluemix-_-bluemix-registration-_-landing&S_TACT=JP3GW27W&S_CMP=jp3gw\n\n\u3053\u3053\u3067\u306fBluemix\u306e\u5730\u57df\u3092\u3001\u7c73\u56fd\u5357\u90e8(cf login -a api.ng.bluemix.net)\u306b\u3057\u307e\u3057\u305f\u3002\n\uff1cCloud Foundry CLI \u3078\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\uff1e\n\nCloudFoundryCLI\u3078\u306e\u30ed\u30b0\u30a4\u30f3\n# cf login\n\n\n\n\u2460Api\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1a\u7c73\u56fd\u5357\u90e8\u306f\u201capi.ng.bluemix.net\u201d\u3067\u3059\u30022\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u3067\u306f\u3001\u3053\u306e\u9805\u76ee\u306e\u5165\u529b\u8981\u6c42\u3042\u308a\u307e\u305b\u3093\u3002\n\u2461Bluemix\u30ed\u30b0\u30a4\u30f3\u306e\u969b\u306eID\n\u2462Bluemix\u30ed\u30b0\u30a4\u30f3\u306e\u969b\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n\u2463Bluemix\u3067\u767b\u9332\u3057\u305f\u201d\u30b9\u30da\u30fc\u30b9\u540d\u201d\n\u3053\u3053\u3067\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3092\uff12\u3064\u4f5c\u6210\u3057\u3066\u3044\u305f\u305f\u3081\u3001\u30b9\u30da\u30fc\u30b9\u9078\u629e\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\uff1c IBM Containers \u30b5\u30fc\u30d3\u30b9\u3078\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\uff1e\n\nIBMContainers\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u30ed\u30b0\u30a4\u30f3\n# cf ic login\n\n\n\n\u30ed\u30b0\u30a4\u30f3\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u306e\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a2\u30a6\u30c8\n# cf logout\n\n\n\n5-2-4. Debian8\u3078Docker Hub\u3088\u308a\u3001Apach\u30a4\u30e1\u30fc\u30b8\u3092PULL\u3057\u3066\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 Bluemix\u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u306b\u30d3\u30eb\u30c9\u3002\nCloudFoundryCLI\u3068IBMContainers\u30b5\u30fc\u30d3\u30b9 \u3078\u306e\u30ed\u30b0\u30a4\u30f3\u3002\nDebian8\u306e\u30eb\u30fc\u30c8\u76f4\u4e0b\u306b/mura\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u4e2d\u306bDockerfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5909\u66f4\n# mkdir /mura\n# cd /mura\n\n\n\nDockerfile\u4f5c\u6210\n# vim ./Dockerfile\n\n\n\nDockerfile\u5185\u5bb9\nFROM httpd:2.4\nCOPY ./public-html/ /usr/local/apache2/htdocs/\n\nEXPOSE 80\n\nVOLUME [\"/url/local/apache2/htdocs\"]\n\n\nDocker Hub \u3088\u308a\u3001httpd(Apache2)\u3092PULL\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://hub.docker.com/explore/\n\nDocker \u30a4\u30e1\u30fc\u30b8\u3092\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 Bluemix\u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u306b\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u7c73\u56fd\u5357\u90e8(registry.ng.bluemix.net)\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\nDocker\u30a4\u30e1\u30fc\u30b8\u306e\u30d3\u30eb\u30c9\n# cf ic build -t registry.ng.bluemix.net/muranamespace/apache:v1 .\n\n\n\u203b\u53f3\u7aef\u306e\u30d4\u30ea\u30aa\u30c9\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\uff01\n\n\n(\u53c2\u8003)\nhttps://console.ng.bluemix.net/docs/containers/container_cli_reference_cfic.html#container_cli_reference_cfic__build\n\nnamespace\u304c\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nDocker\u30a4\u30e1\u30fc\u30b8\u306e\u30d3\u30eb\u30c9\n# cf ic namespace get\n\n\n\u300ccf ic\u300d\u30b3\u30de\u30f3\u30c9\u307e\u305f\u306fBluemix \u30ab\u30bf\u30ed\u30b0\u3067\u3001\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\uff1ccf ic \u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\uff1e\n\nDocker\u30a4\u30e1\u30fc\u30b8\u306e\u78ba\u8a8d\n# cf ic images\n\n\n\n\uff1cBluemix\u30ab\u30bf\u30ed\u30b0\u3067\u78ba\u8a8d\uff1e\n\n\n5-3. \u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\n\u25bc \u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u3068Bluemix\u30ab\u30bf\u30ed\u30b0\u304b\u3089\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f\u30ab\u30bf\u30ed\u30b0\u304b\u3089\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u4f5c\u6210\u3057\u305f\u300cApache \u30de\u30a4\u7d44\u7e54\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n\u300c\u30b3\u30f3\u30c6\u30ca\u540d\uff1amurac\u300d\n\n\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\u3057\u306a\u3089\u304f\u3059\u308b\u3068\u3001\u300c\u30b3\u30f3\u30c6\u30ca\u540d\uff1amurac\u300d\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u25bc \u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u78ba\u8a8d\n\u30b3\u30de\u30f3\u30c9\u307e\u305f\u306fBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\uff1ccf ic \u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\uff1e\n\n\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u306e\u78ba\u8a8d\n# cf ic ps\n\n\n\n\u300c\u30b3\u30f3\u30c6\u30caID\uff1ab95b454b-158\u300d\u3067\u7a3c\u50cd\u3057\u3066\u3044\u307e\u3059\u3002\n\uff1cBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u78ba\u8a8d\uff1e\n\n\u25bc \u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u78ba\u8a8d\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect \u30b3\u30f3\u30c6\u30caID\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect b95b454b-158\n\n\n\ninspect\u30b3\u30de\u30f3\u30c9\u7d50\u679c\n[{\n    \"BluemixApp\": null,\n    \"BluemixServices\": null,\n    \"Config\": {\n        \"AttachStderr\": false,\n        \"AttachStdin\": false,\n        \"AttachStdout\": false,\n        \"Cmd\": [],\n        \"Dns\": \"\",\n        \"Env\": [\n            \"logging_password=\",\n            \"space_id=d5f00494-eba9-4c8b-8c4d-8776619d518b\",\n            \"logstash_target=logmet.opvis.bluemix.net:9091\",\n            \"metrics_target=logmet.opvis.bluemix.net:9095\"\n        ],\n        \"Hostname\": \"instance-00138e9d\",\n        \"Image\": \"registry.ng.bluemix.net/muranamespace/apache:v1\",\n        \"ImageArchitecture\": \"amd64\",\n        \"Labels\": {},\n        \"Memory\": 256,\n        \"MemorySwap\": \"\",\n        \"OpenStdin\": true,\n        \"PortSpecs\": \"\",\n        \"StdinOnce\": false,\n        \"Tty\": true,\n        \"User\": \"\",\n        \"VCPU\": 4,\n        \"VolumesFrom\": \"\",\n        \"WorkingDir\": \"\"\n    },\n    \"ContainerState\": \"Running\",\n    \"Created\": \"2016-08-24T01:09:13.000000000Z\",\n    \"Group\": {},\n    \"HostConfig\": {\n        \"Binds\": [],\n        \"CapAdd\": [],\n        \"CapDrop\": [],\n        \"ContainerIDFile\": \"\",\n        \"Links\": [],\n        \"LogConfig\": {\n            \"Config\": {},\n            \"Type\": \"json-file\"\n        },\n        \"LxcConf\": [],\n        \"PortBindings\": {\n            \"80/tcp\": [\n                {\n                    \"HostPort\": \"80\"\n                }\n            ]\n        },\n        \"Privileged\": false,\n        \"PublishAllPorts\": false\n    },\n    \"HostId\": \"6e8cf8ca072d1e14cb4b9b570da9fde3d2303d49c2281d8e5ebef119\",\n    \"Human_id\": \"murac\",\n    \"Id\": \"b95b454b-158a-4a16-8d20-94ef8ce897f6\",\n    \"Image\": \"e61e9170b00b2b32655db4661135a7cc3f9649a767fff13cb96482070ac4e4be\",\n    \"Mounts\": [],\n    \"Name\": \"murac\",\n    \"NetworkSettings\": {\n        \"Bridge\": \"\",\n        \"Gateway\": \"\",\n        \"IPAddress\": \"172.31.0.2\",\n        \"IPPrefixLen\": 0,\n        \"MacAddress\": \"fa:16:3e:cf:73:8f\",\n        \"Networks\": {\n            \"default\": {\n                \"Aliases\": null,\n                \"EndpointID\": \"b95b454b-158a-4a16-8d20-94ef8ce897f6\",\n                \"Gateway\": \"172.31.0.1\",\n                \"GlobalIPv6Address\": \"\",\n                \"GlobalIPv6PrefixLen\": 0,\n                \"IPAMConfig\": null,\n                \"IPAddress\": \"172.31.0.2\",\n                \"IPPrefixLen\": 16,\n                \"IPv6Gateway\": \"\",\n                \"Links\": null,\n                \"MacAddress\": \"fa:16:3e:cf:73:8f\",\n                \"NetworkID\": \"a1983a32-958f-40db-a9b3-002d608ec848\"\n            }\n        },\n        \"PortMapping\": null,\n        \"Ports\": {\n            \"80/tcp\": [\n                {\n                    \"HostIp\": \"172.31.0.2\",\n                    \"HostPort\": \"80\"\n                }\n            ]\n        },\n        \"PublicIpAddress\": \"\"\n    },\n    \"Path\": \"date\",\n    \"ResolvConfPath\": \"/etc/resolv.conf\",\n    \"State\": {\n        \"Error\": \"\",\n        \"ExitCode\": 0,\n        \"FinishedAt\": \"0001-01-01T00:00:00Z\",\n        \"Ghost\": \"\",\n        \"Pid\": 1,\n        \"Running\": true,\n        \"StartedAt\": \"2016-08-24T01:09:20.000000000Z\",\n        \"Status\": \"Running\"\n    },\n    \"Volumes\": {},\n    \"VolumesRW\": {}\n}]\n\n\ngrep\u3067\u5fc5\u8981\u306a\u7b87\u6240\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect b95b454b-158 |grep IPAddress\n\n\n\nWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306f\u3001\u300c172.31.0.2\u300d\u3067\u3059\u3002\n\n5-4. \u2463 VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\nBluemix\u306e\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d\u3092\u30aa\u30fc\u30c0\u30fc\u3057\u3001\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u307e\u3067\u306e\u624b\u9806\u3067\u3001\n\u300c5-1.  \u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u300d\u3088\u308a\n\u30fbVyOS\u5074\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\uff1a\u300c161.202.154.118\u300d\n\u30fbVyOS\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a\u300c10.132.52.192/16\u300d\n\u300c5-3. \u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u300d\u3088\u308a\n\u30fbWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\uff1a\u300c172.31.0.2\u300d\u304c\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\u4e8b\u524d\u5171\u6709\u9375\u3092\u300cshared-key\u300d\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u307e\u3057\u305f\u3002\n\u25bc \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306e\u30aa\u30fc\u30c0\u30fc\n\n\u300cVirtual Private Network\u300d\u3092\u9078\u629e\u3057\u3001\u30af\u30ea\u30c3\u30af\u3002\n\n\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n\u203b\uff11\u3064\u306e\u30b9\u30da\u30fc\u30b9\u306b\u306f\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f1\u3064\u307e\u3067\u3067\u3059\u3002\n\n1\u3064\u306e\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f\u8907\u6570\u306e\u63a5\u7d9a\u5148\u304c\u8a2d\u5b9a\u53ef\u80fd\u3002\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001Bluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u30af\u30ea\u30c3\u30af\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\u25bc \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306e\u8a2d\u5b9a\n\n\u300cCreate Gateway\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n\u300cGateway Apliance\u300d\u30bf\u30b0\u9078\u629e\u21d2\u300cEdit\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\nWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001VPN\u30b5\u30fc\u30d3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u306f\u300c169.46.158.54\u300d\u3067\u3059\u3002\n\n\u300cGateway Apliance Name\u300d\u306f\u300cVPNGW01\u300d\u21d2\u300cSave\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\u3053\u3053\u3067\u306f\u300cIKE \uff06 IPsec Polices\u300d\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\u3057\u307e\u3059\u306e\u3067\u3001\u8a2d\u5b9a\u3057\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n\n\u300cSite Connections\u300d\u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u300cSite Connections\u300d\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\n\n\u2460 Name:\u3000\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e\u300cConnection1\u300d \n\u2461\u300cPreShared Key String\u300d: \u300cshared-key\u300d\n\u5f8c\u307b\u3069\u8a2d\u5b9a\u3059\u308bVyOS-VPN\u8a2d\u5b9a\u306e\u201d vpn ipsec site-to-site peer 169.46.158.54 authentication pre-shared-secret shared-key\u201d\u3068\u5408\u308f\u305b\u308b\u3002\n\u2462\u300cCustomer GatewayIP\u300d: \u300c161.202.154.118\u300d\nVyOS\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\n\u2463\u300cCustomer Subnet\u300d: \u300c10.132.52.192/16\u300d\nVyOS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\u2464\u300cDescription\u300d: \u5fc5\u9808\u3067\u306a\u3044\u306e\u3067\u5165\u529b\u306a\u3057\n\u2465\u300cAdmin State\u300d: \u300cdown\u300d\nVyOS\u8a2d\u5b9a\u3057\u305f\u5f8c\u306b\u300cup\u300d\u306b\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3002\n\u5404\u30d1\u30e9\u30e1\u30fc\u30bf\u5165\u529b\u5f8c\u3001\u300csave\u300d\u3092\u30af\u30ea\u30c3\u30af\n\n\n5-5. \u2464VyOS\u306eVPN\u8a2d\u5b9a\nSoftLayer\u5074\u306e\u300cvyos\u300d\u306e\u8a2d\u5b9a\u3067\u3059\u3002\nVyOS\u306e\u5c0e\u5165\u3001\u57fa\u672c\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n(\u53c2\u8003\u60c5\u5831)\u30fbVyOS\u5c0e\u5165\n \u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562b\n\u300cSoftLayer\u3068VyOS\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u790e\u3092\u52c9\u5f37\uff14-(IPsecVPN LAN\u9593\u63a5\u7d9a\u7de8)\u300d\nhttp://qiita.com/Mitsu-Murakita/items/9bb09f54494345b51ce8\nVyOS\u306e\u57fa\u672c\u8a2d\u5b9a\u60c5\u5831\u3067\u3059\u3002\u3053\u308c\u306bVPN\u95a2\u9023\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nVyOS\u57fa\u672c\u8a2d\u5b9a\n interfaces {\n     ethernet eth0 {\n         address 10.132.52.226/26\n         duplex auto\n         hw-id 06:38:a7:d9:ec:e4\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.154.118/29\n         duplex auto\n         hw-id 06:dc:71:bf:8e:b3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     domain-name softlayer.com\n     gateway-address 161.202.154.113\n     host-name vyos\n     login {\n         user vyos {\n             authentication {\n                 encrypted-password xxxxxxxxxxxxxxxxxxxx\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     name-server 10.0.80.12\n     ntp {\n         server time.service.networklayer.com {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone Asia/Tokyo\n }\n\n\n\u4e0b\u8a18VPN\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\u203b\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7[xx]\u3092\u3064\u3051\u3066\u307e\u3059\u3002\n\nVPN\u8a2d\u5b9a\u8ffd\u52a0\n[01] # set vpn ipsec esp-group bmixvpn-esp\n[02] # set vpn ipsec esp-group bmixvpn-esp compression disable\n[03] # set vpn ipsec esp-group bmixvpn-esp lifetime 3600\n[04] # set vpn ipsec esp-group bmixvpn-esp mode tuunel\n[05] # set vpn ipsec esp-group bmixvpn-esp pfs dh-group2\n[06] # set vpn ipsec esp-group bmixvpn-esp proposal 1\n[07] # set vpn ipsec esp-group bmixvpn-esp proposal 1 encryption aes128\n[08] # set vpn ipsec esp-group bmixvpn-esp proposal 1 hash sha1\n\n[09] # set vpn ipsec ike-group bmixvpn-ike\n[10] # set vpn ipsec ike-group bmixvpn-ike lifetime 28800\n[11] # set vpn ipsec ike-group bmixvpn-ike proposal 1\n[12] # set vpn ipsec ike-group bmixvpn-ike proposal 1 dh-group 2\n[13] # set vpn ipsec ike-group bmixvpn-ike proposal 1 encryption aes128\n[14] # set vpn ipsec ike-group bmixvpn-ike proposal 1 hash sha1\n\n[15] # set vpn ipsec ipsec-interfaces interface eth0\n\n[16] # set vpn ipsec site-to-site peer 169.46.158.54\n[17] # set vpn ipsec site-to-site peer 169.46.158.54 authentication\n[18] # set vpn ipsec site-to-site peer 169.46.158.54 authentication id 161.202.154.118\n[19] # set vpn ipsec site-to-site peer 169.46.158.54 authentication mode pre-shared-secret\n[20] # set vpn ipsec site-to-site peer 169.46.158.54 authentication pre-shared-secret shared-key\n[21] # set vpn ipsec site-to-site peer 169.46.158.54 authentication remote-id 169.46.158.54\n\n[22] # set vpn ipsec site-to-site peer 169.46.158.54 connection-type respond\n[23] # set vpn ipsec site-to-site peer 169.46.158.54 default-esp-group bmixvpn-esp\n[24] # set vpn ipsec site-to-site peer 169.46.158.54 ike-group bmixvpn-ike\n[25] # set vpn ipsec site-to-site peer 169.46.158.54 local-address any\n\n[26] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1\n[27] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 local\n[28] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 local prefix 10.132.52.192/26\n[29] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 remote prefix 172.31.0.0/16\n\n\n\n[01]-[08]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306e\"IPsec Policies\"\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\n[09]-[14]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306e\"IKE Policies\"\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\n[15]-[15]:  IPsecVPN\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\"eth0\"\u3092\u4f7f\u7528\n[20]-[21]:  \u4e8b\u524d\u5171\u901a\u9375\u3092\u4f7f\u7528\u3057\u3001\u5024\u306f\"shared-key\"\n[22]-[22]: \u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u304c\"initiate \"\u3067\u3042\u308b\u305f\u3081\u3001VyOS\u5074\u306f\u201drespond\u201d\u306b\u8a2d\u5b9a\n[28]-[28]: VyOS\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n[28]-[28]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n\nVyOS\u5074\u306eVPN\u8a2d\u5b9a\u3067\u3059\u3002\n\nVyOS-VPN\u8a2d\u5b9a\n interfaces {\n     ethernet eth0 {\n         address 10.132.52.226/26\n         duplex auto\n         hw-id 06:38:a7:d9:ec:e4\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.154.118/29\n         duplex auto\n         hw-id 06:dc:71:bf:8e:b3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     domain-name softlayer.com\n     gateway-address 161.202.154.113\n     host-name vyos\n     login {\n         user vyos {\n             authentication {\n                 encrypted-password xxxxxxxxxxxxxxxxxxx\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     name-server 10.0.80.12\n     ntp {\n         server time.service.networklayer.com {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone Asia/Tokyo\n }\n vpn {\n     ipsec {\n         esp-group bmixvpn-esp {\n             compression disable\n             lifetime 3600\n             mode tunnel\n             pfs dh-group2\n             proposal 1 {\n             }\n         }\n         ike-group bmixvpn-ike {\n             lifetime 28800\n             proposal 1 {\n                 dh-group 2\n                 encryption aes128\n                 hash sha1\n             }\n         }\n         ipsec-interfaces {\n             interface eth0\n         }\n         site-to-site {\n             peer 169.46.158.54 {\n                 authentication {\n                     id 161.202.154.118\n                     mode pre-shared-secret\n                     pre-shared-secret shared-key\n                     remote-id 169.46.158.54\n                 }\n                 connection-type respond\n                 default-esp-group bmixvpn-esp\n                 ike-group bmixvpn-ike\n                 local-address any\n                 tunnel 1 {\n                     local {\n                         prefix 10.132.52.192/26\n                     }\n                     remote {\n                         prefix 172.31.0.0/16\n                     }\n                 }\n             }\n         }\n     }\n }\n\n\n\n6. \u63a5\u7d9a\u78ba\u8a8d\n\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u5074\u306e\u300cAdmin State\u300d\u3092\u201dDOWN\u201d\u306b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001VyOS\u5074\u306eVPN\u3082\"down\"\u306e\u72b6\u614b\u3067\u3059\u3002\n\nVyOS\u5074IPsec\u72b6\u614b\u306e\u78ba\u8a8d\n# show vpn ipsec sa\n\n\n\n\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u5074\u306e\u300cAdmin State\u300d\u3092\u201dUP\u201d\u306b\u3057\u307e\u3059\u3002\n\u300cSite Connections\u300d\u21d2\u300cEdit\u300d\n\u300cPre Shared Key\u300d\u304c\u30d6\u30e9\u30f3\u30af\u3067\u3059\u306e\u3067\u3001\u518d\u5ea6\u5165\u529b\u3057(\"shared-key\")\u3001\u300cAdmin State\u300d\u3092\u201dUP\u201d \u21d2\u300cSave\u300d\n\nVyOS\u5074\u306eIPsec-VPN\u304c\"up\"\u306b\u306a\u308a\u3001VPN\u901a\u4fe1\u304c\u63a5\u7d9a\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u30fbPING\u3067\u306e\u63a5\u7d9a\u78ba\u8a8d  \nVyOS\u5074\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u300cDebian8\u300d\u304b\u3089Web\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066PING\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u300cDebian8\u300d\u306b\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u300cDebian8\u300d\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u8a2d\u5b9a\n# route add -net 172.31.0.0 netmask 255.255.0.0 gw 10.132.52.226\n\n\n\n\u758e\u901a\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\u30fbcurl\u3067Web\u30b3\u30f3\u30c6\u30ca\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u8868\u793a\u306e\u78ba\u8a8d\n\n'It works!'\u304c\u8868\u793a\u3055\u308c\u305f\u306e\u3067\u3001Web\u3082\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u3002\n\n7. \u304a\u308f\u308a\u306b\nBluemix\u74b0\u5883\u3068SoftLayer\u74b0\u5883\u306e\u63a5\u7d9a\u3067\u3057\u305f\u304c\u3001SoftLayer\u74b0\u5883\u3092\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306b\u7f6e\u304d\u63db\u3048\u308c\u3070\u3001\u30bb\u30ad\u30e5\u30a2\u306a\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u74b0\u5883\u3082\u6bd4\u8f03\u7684\u5bb9\u6613\u306b\u69cb\u7bc9\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n# 1. \u306f\u3058\u3081\u306b\n  Bluemix\u63d0\u4f9b\u306e<sytrong><font color=\"blue\">\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d</font></strong>\u3092\u4f7f\u3063\u3066\u3001Blumix\u30b3\u30f3\u30c6\u30ca\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3078Softlayer\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n  \u4eca\u56de\u306f\u3001Bluemix\u3068Softlayer\u3092VPN\u63a5\u7d9a\u3057\u3001\u57fa\u672c\u7684\u306a\u4ed5\u7d44\u307f\u3092\u7406\u89e3\u3059\u308b\u306e\u304c\u76ee\u7684\u3067\u3059\u3002\n   IBM\u30b3\u30f3\u30c6\u30ca(Docker)\u3084VPN\u30b5\u30fc\u30d3\u30b9\u3001VyOS\u7b49\u306e\u77e5\u8b58\u304c\u5fc5\u8981\u306a\u7b87\u6240\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3068\u3082\u304b\u304f\u52d5\u304b\u3057\u3066\u5168\u4f53\u30a4\u30e1\u30fc\u30b8\u3092\u3064\u304b\u3081\u308b\u3088\u3046\u306b\u9806\u3092\u8ffd\u3063\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\n\n# 2. \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306b\u3064\u3044\u3066\n\u3000Bluemix \u30af\u30e9\u30a6\u30c9\u74b0\u5883\u5185\u3067 IBM \u30b3\u30f3\u30c6\u30ca\u30fc (Docker \u30b3\u30f3\u30c6\u30ca\u30fc) \u306b\u30bb\u30ad\u30e5\u30a2\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nIBM \u30b3\u30f3\u30c6\u30ca\u30fc\u304c\u524d\u63d0\u3067\u3001\u3053\u308c\u3092\u4f7f\u3048\u3070\u30af\u30e9\u30a6\u30c9\u3068\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30b7\u30b9\u30c6\u30e0\u304c\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002\n\u5c1a\u3001\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f\u8a2d\u5b9a\u753b\u9762\u3084\u30b3\u30de\u30f3\u30c9\u3001API\u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u8a2d\u5b9a\u753b\u9762\u3092\u4f7f\u3063\u3066\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n>\u4e0b\u8a18\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\nVPN\u30b5\u30fc\u30d3\u30b9\u306b\u3064\u3044\u3066\nhttps://console.ng.bluemix.net/docs/services/vpn/vpn_overview.html#vpn_overview\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3001API\u306b\u3064\u3044\u3066\nhttps://console.ng.bluemix.net/docs/cli/plugins/vpn/index.html\nhttps://new-console.ng.bluemix.net/apidocs/101\n>\n\n# 3. \u69cb\u6210\u306b\u3064\u3044\u3066\n\u3000SoftLayer\u6771\u4eacDC\u306eDebian8\u304b\u3089curl\u3067\u3001Blumix\u4e0a\u306eWeb\u30b3\u30f3\u30c6\u30ca\u3078VPN\u7d4c\u7531\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30a2\u30c9\u30ec\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n Debian8\u306fWeb\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u7528\u306e\u64cd\u4f5cPC\u3068\u3057\u3066\u3082\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n Bluemix\u3067\u306e\u4f7f\u7528\u5730\u57df\u306f<font color=\"blue\">\u300c\u7c73\u56fd\u5357\u90e8\u300d</font>\n \n![01.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/01.png)\n\n![02.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/02.png) \n\u30fbSoftLayer\u5074\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306f\u3001<font color=\"blue\">\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30c7\u30d7\u30ed\u30a4\u6642</font>\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n\u30fbBluemix\u5074VPN\u30b5\u30fc\u30d3\u30b9\u30d1\u30d6\u30ea\u30c3\u30afIP\u306f\u3001<font color=\"blue\">\u30b5\u30fc\u30d3\u30b9\u958b\u59cb\u6642</font>\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n\u30fbBluemix\u5074\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306f<font color=\"blue\">\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u8d77\u52d5\u6642</font>\u306b\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u308b\u3002\n \n# 4. \u69cb\u7bc9\u9806\u5e8f\n![03.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/03.png)\n<strong>\u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210</strong>\n<font color=\"blue\">\uff1cSoftLayer\u30dd\u30fc\u30bf\u30eb\u3067\u306e\u64cd\u4f5c\uff1e</font>\n\u25bc VyOS\u7528(vyos)\u3068\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u74b0\u5883\u7528\u517cWeb\u63a5\u7d9a\u78ba\u8a8d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528(Debian8)\u306e\uff12\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3002\n<font color=\"green\">\u203bDebian8\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u3068\u30b5\u30d6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5024\u306f\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528\u3059\u308b\u3002</font>\n\n<strong>\u2461 \u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u30fb\u4f5c\u6210</strong>\n<font color=\"blue\">\uff1cSoftLayer\u4f5c\u6210\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306e\u64cd\u4f5c\uff1e</font>\n\u25bc Debian8\u3078Docker\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078CloudFoundry CLI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078IBM Containers CF CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u25bc Debian8\u3078Docker Hub\u3088\u308a\u3001Apach\u30a4\u30e1\u30fc\u30b8\u3092PULL\u3002\n\u25bc Debian8\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3002\n\u25bc Debian8\u304b\u3089IBM\u30b3\u30f3\u30c6\u30ca\u30fb\u30ec\u30dd\u30b8\u30c8\u30ea\u30fc\u3078\u4f5c\u6210\u30a4\u30e1\u30fc\u30b8\u3092PUSH\u3057\u3001\u30ab\u30bf\u30ed\u30b0\u306b\u767b\u9332\u3002\n\n<strong>\u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c</strong>\n<font color=\"blue\">\uff1cBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306e\u64cd\u4f5c\uff1e</font>\n\u25bc Bluemix\u30ab\u30bf\u30ed\u30b0\u3088\u308a\u3001\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\u3002\n<font color=\"green\">\u203b\u7a3c\u50cd\u30b3\u30f3\u30c6\u30ca\u306e\u30b5\u30d6\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5024\u306f\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528\u3059\u308b\u3002</font>\n\n<strong>\u2463 VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a</strong>\n<font color=\"blue\">\uff1cBluemi\u30c0\u30c3\u30b7\u30dc\u30fc\u30c9\u3067\u306e\u64cd\u4f5c\uff1e</font>\n\u25bc\u300cGateway Appliance\u300d\u3067Gatwway\u540d\u767b\u9332\u3002\n\u25bc \u300cIKE & IPSec Policies\u300d\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u4f7f\u7528\u306e\u305f\u3081\u3001\u5165\u529b\u5909\u66f4\u306a\u3057\u3002\n\u25bc \u300cSite Connections\u300d\u8a2d\u5b9a\n\n<strong>\u2464VyOS\u306eVPN\u8a2d\u5b9a</storng>\n<font color=\"blue\">\uff1cDebian8\u3067\u306e\u64cd\u4f5c\uff1e</font>\n\u25bc \u3053\u3053\u3067\u306f\u3001\u300c\u2463VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u300d\u3067\u8a2d\u5b9a\u3057\u305f\u5024\u306b\u5408\u308f\u305b\u3066\u3001VyOS\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n# 5. \u69cb\u7bc9\n## 5-1.  \u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n \u30fbVyOS\u7528(vyos)\n \u30fb\u30b3\u30f3\u30c6\u30ca\u69cb\u7bc9\u74b0\u5883\u7528\u517cWeb\u63a5\u7d9a\u78ba\u8a8d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528(Debian8\uff1aDebian GNU/Linux 8.x jessie/Stable - Minimal Install (64 bit))\n 2\u3064\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u3002\nVyOS\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\u306f\u3001\n\u30fb\u30d1\u30d6\u30ea\u30c3\u30afIP<font color=\"blue\">\u300c161.202.154.118\u300d</font>\n\u30fb\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af<font color=\"blue\">\u300c10.132.52.192/16\u300d</font>\u3002\n\u3053\u306e\u5024\u306f<font color=\"red\">\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u8a2d\u5b9a\u300d\u3067\u4f7f\u7528</font>\u3057\u307e\u3059\u3002\n\n## 5-2. \u2461 \u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u30fb\u4f5c\u6210\nDebian8\u306b\u30b3\u30f3\u30c6\u30ca\u74b0\u5883\u306e\u6e96\u5099\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n### 5-2-1. Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \n\n\u25bc \u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u4fee\u6b63\u306bvim\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```Command:vim\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y vim\n```\n\n\u25bc /etc/apt/sources.list\u306bjessie-backports\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\nDebian8\u306eDocker\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u201djessie-backports\u201d\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308b\u306e\u3067\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u6709\u52b9\u5316\u3092\u884c\u3046\u3002\n\n```Command:sources.list\u306e\u7de8\u96c6\n# vi /etc/apt/sources.list\n```\n\n```Command:sources.list\u306b\u8ffd\u52a0\ndeb http://http.debian.net/debian jessie-backports main\n```\n\n\u25bc \u30ab\u30fc\u30cd\u30eb\u3084\u30d1\u30c3\u30b1\u30fc\u30b8\u985e\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\n```Command:\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n# apt-get install \u2013y update\n```\n\u25bc Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```Command:Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y docker.io\n```\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fDocker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```Command:Docker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n# docker version\n```\n![04.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/04.png)\nVersion 1.6.2\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\u5ff5\u306e\u305f\u3081\u3001Docker\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```Command:Docker\u306e\u5b9f\u884c\n# docker run ubuntu:latest /bin/echo 'Hello docker'\n```\nubuntu\u30a4\u30e1\u30fc\u30b8\u304c\u30ed\u30fc\u30ab\u30eb\u306b\u306a\u3044\u306e\u3067\u3001Docker\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089ubuntu\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u3044\u307e\u3059\u3002\n![05.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/05.png)\n\u2018Hello Docker\u2019\u304c\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u306e\u3067\u3001<font color=\"blue\">\u6b63\u5e38\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5</font>\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u25bc Docker\u306e\u8d77\u52d5\n\n```Command:Docker\u306e\u8d77\u52d5\n# /etc/init.d/docker start\n```\n\u25bc Docker\u81ea\u52d5\u8d77\u52d5\u306e\u8a2d\u5b9a\n\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\u306esysv-rc-conf\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```Command:sysv-rc-conf\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y sysv-rc-conf\n```\nDocker\u3092\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\u3002\n\n```Command:\u81ea\u52d5\u8d77\u52d5\u306b\u8a2d\u5b9a\n# sysv-rc-conf docker on\n```\n\n### 5-2-2. Debian8\u3078CloudFoundry CLI\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \nGitHub\u30ea\u30dd\u30b8\u30c8\u30eahttps://github.com/cloudfoundry/cli/releases\n\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306bLynx\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n\u25bc Lynx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```Command:lynx\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# apt-get install \u2013y lynx\n```\n\n\u25bc Cloud Foundry CLI\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```Command:lynx\u64cd\u4f5c\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n# lynx https://github.com/cloudfoundry/cli/releases/tag/v6.21.1\n```\n![06.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/06.png)\n\u201cDebian 64 bit\u201d\u3092\u9078\u629e\n\n![07.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/07.png)\n\u30d5\u30a1\u30a4\u30eb\u540d\u300ccf-cli-installer_6.21.1_x86-64.deb\u300d\u3067\u30c7\u30a3\u30b9\u30af\u306b\u4fdd\u5b58\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```Command:CloudFoundryCLI\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# dpkg \u2013i cf-cli-installer_6.21.1_x86-64.deb\n```\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305fCloud Foundry CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n```Command:CloudFoundryCLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n# cf \u2013v\n```\n![08.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/08.png)\nVersion 6.21.1\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\n### 5-2-3. Debian8\u3078IBM Containers CF CLI \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \n\u3053\u3053\u3067\u306f\u3001<font color=\"blue\">\u201cLinux 64 bit\u74b0\u5883\u201d\u306e\u30d7\u30e9\u30b0\u30a4\u30f3</font>\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u25bc \u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```Command:\u30d7\u30e9\u30b0\u30a4\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb \n# cf install-plugin https://static-ice.ng.bluemix.net/ibm-containers-linux_x64\n```\n\n![09.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/09.png)\n\n\u25bc \u30d7\u30e9\u30b0\u30a4\u30f3\u78ba\u8a8d\n\n```Command:\u30d7\u30e9\u30b0\u30a4\u30f3\u78ba\u8a8d\n# cf plugins\n```\n![10.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/10.png)\nVersion 0.8.897\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u25bc \u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\n>\u203b\u3042\u3089\u304b\u3058\u3081Bluemix\u74b0\u5883\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u6e96\u5099\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u30ed\u30b0\u30a4\u30f3\u306b\u306f\u3001\u30e1\u30fc\u30ebID\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30b9\u30da\u30fc\u30b9\u304c\u5fc5\u8981\u3067\u3059\uff01\n30\u65e5\u30d5\u30ea\u30fc\u30c8\u30e9\u30a4\u30a2\u30eb\u306f\u4e0b\u8a18URL\u3088\u308a\nhttps://developer.ibm.com/sso/bmregistration?lang=ja_JP&ca=dwjapan-_-bluemix-_-bluemix-registration-_-landing&S_TACT=JP3GW27W&S_CMP=jp3gw\n>\n\n\u3053\u3053\u3067\u306fBluemix\u306e\u5730\u57df\u3092\u3001\u7c73\u56fd\u5357\u90e8(cf login -a api.ng.bluemix.net)\u306b\u3057\u307e\u3057\u305f\u3002\n\n\uff1cCloud Foundry CLI \u3078\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\uff1e\n\n```Command:CloudFoundryCLI\u3078\u306e\u30ed\u30b0\u30a4\u30f3\n# cf login\n```\n![11.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/11.png)\n\u2460Api\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff1a<font color=\"blue\">\u7c73\u56fd\u5357\u90e8\u306f\u201capi.ng.bluemix.net\u201d</font>\u3067\u3059\u30022\u56de\u76ee\u4ee5\u964d\u306e\u30ed\u30b0\u30a4\u30f3\u3067\u306f\u3001\u3053\u306e\u9805\u76ee\u306e\u5165\u529b\u8981\u6c42\u3042\u308a\u307e\u305b\u3093\u3002\n\u2461Bluemix\u30ed\u30b0\u30a4\u30f3\u306e\u969b\u306eID\n\u2462Bluemix\u30ed\u30b0\u30a4\u30f3\u306e\u969b\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n\u2463Bluemix\u3067\u767b\u9332\u3057\u305f\u201d\u30b9\u30da\u30fc\u30b9\u540d\u201d\n\u3053\u3053\u3067\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3092\uff12\u3064\u4f5c\u6210\u3057\u3066\u3044\u305f\u305f\u3081\u3001\u30b9\u30da\u30fc\u30b9\u9078\u629e\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\uff1c IBM Containers \u30b5\u30fc\u30d3\u30b9\u3078\u306e\u30ed\u30b0\u30a4\u30f3\u78ba\u8a8d\uff1e\n\n```Command:IBMContainers\u30b5\u30fc\u30d3\u30b9\u3078\u306e\u30ed\u30b0\u30a4\u30f3\n# cf ic login\n```\n![12.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/12.png)\n\n\u30ed\u30b0\u30a4\u30f3\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u306e\u3067\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\n```Command:\u30ed\u30b0\u30a2\u30a6\u30c8\n# cf logout\n```\n\n### 5-2-4. Debian8\u3078Docker Hub\u3088\u308a\u3001Apach\u30a4\u30e1\u30fc\u30b8\u3092PULL\u3057\u3066\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 Bluemix\u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u306b\u30d3\u30eb\u30c9\u3002\nCloudFoundryCLI\u3068IBMContainers\u30b5\u30fc\u30d3\u30b9 \u3078\u306e\u30ed\u30b0\u30a4\u30f3\u3002\nDebian8\u306e\u30eb\u30fc\u30c8\u76f4\u4e0b\u306b/mura\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u305d\u306e\u4e2d\u306b<font color=\"blue\">Dockerfile\u3092\u4f5c\u6210</font>\u3057\u307e\u3059\u3002\n\n```Command:\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3092\u4f5c\u6210\u3057\u3001\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u5909\u66f4\n# mkdir /mura\n# cd /mura\n```\n\n```Command:Dockerfile\u4f5c\u6210\n# vim ./Dockerfile\n```\n\n```Command:Dockerfile\u5185\u5bb9\nFROM httpd:2.4\nCOPY ./public-html/ /usr/local/apache2/htdocs/\n\nEXPOSE 80\n\nVOLUME [\"/url/local/apache2/htdocs\"]\n```\nDocker Hub \u3088\u308a\u3001httpd(Apache2)\u3092PULL\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://hub.docker.com/explore/\n![13.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/13.png)\n\n\nDocker \u30a4\u30e1\u30fc\u30b8\u3092\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 Bluemix\u30ea\u30dd\u30b8\u30c8\u30ea\u30fc\u306b\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u3001\u7c73\u56fd\u5357\u90e8(registry.ng.bluemix.net)\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n```Command:Docker\u30a4\u30e1\u30fc\u30b8\u306e\u30d3\u30eb\u30c9\n# cf ic build -t registry.ng.bluemix.net/muranamespace/apache:v1 .\n```\n<font color=\"red\">\u203b\u53f3\u7aef\u306e\u30d4\u30ea\u30aa\u30c9\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\uff01</font>\n![14.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/14.png)\n\n>(\u53c2\u8003)\nhttps://console.ng.bluemix.net/docs/containers/container_cli_reference_cfic.html#container_cli_reference_cfic__build\n>\n\nnamespace\u304c\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f\u3001\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```Command:Docker\u30a4\u30e1\u30fc\u30b8\u306e\u30d3\u30eb\u30c9\n# cf ic namespace get\n```\n\u300ccf ic\u300d\u30b3\u30de\u30f3\u30c9\u307e\u305f\u306fBluemix \u30ab\u30bf\u30ed\u30b0\u3067\u3001\u4f5c\u6210\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n<strong>\uff1ccf ic \u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\uff1e</strong>\n\n```Command:Docker\u30a4\u30e1\u30fc\u30b8\u306e\u78ba\u8a8d\n# cf ic images\n```\n![15.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/15.png)\n\n<strong>\uff1cBluemix\u30ab\u30bf\u30ed\u30b0\u3067\u78ba\u8a8d\uff1e</strong>\n![16.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/16.png)\n\n## 5-3. \u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\n<strong>\u25bc \u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u65b9\u6cd5\u3068Bluemix\u30ab\u30bf\u30ed\u30b0\u304b\u3089\u5b9f\u884c\u3059\u308b\u65b9\u6cd5</strong>\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3053\u3067\u306f<font color=\"blue\">\u30ab\u30bf\u30ed\u30b0\u304b\u3089\u5b9f\u884c</font>\u3057\u307e\u3059\u3002\n\n![16.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/16.png)\n\u4f5c\u6210\u3057\u305f<font color=\"blue\">\u300cApache \u30de\u30a4\u7d44\u7e54\u300d</font>\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n![17.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/17.png)\n<font color=\"blue\">\u300c\u30b3\u30f3\u30c6\u30ca\u540d\uff1amurac\u300d</font>\n\n![18.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/18.png)\n\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n\u3057\u306a\u3089\u304f\u3059\u308b\u3068\u3001<font color=\"blue\">\u300c\u30b3\u30f3\u30c6\u30ca\u540d\uff1amurac\u300d</font>\u304c\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n<strong>\u25bc \u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u78ba\u8a8d</strong>\n\u30b3\u30de\u30f3\u30c9\u307e\u305f\u306fBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n<strong>\uff1ccf ic \u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\uff1e</strong>\n\n```Command:\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u306e\u78ba\u8a8d\n# cf ic ps\n```\n![19.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/19.png)\n\u300c\u30b3\u30f3\u30c6\u30caID\uff1ab95b454b-158\u300d\u3067\u7a3c\u50cd\u3057\u3066\u3044\u307e\u3059\u3002\n\n<strong>\uff1cBluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u78ba\u8a8d\uff1e</strong>\n![20.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/20.png)\n\n<strong>\u25bc \u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u78ba\u8a8d</strong>\n\n```Command:\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect \u30b3\u30f3\u30c6\u30caID\n```\n\n```Command:\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect b95b454b-158\n```\n\n```Command:inspect\u30b3\u30de\u30f3\u30c9\u7d50\u679c\n[{\n    \"BluemixApp\": null,\n    \"BluemixServices\": null,\n    \"Config\": {\n        \"AttachStderr\": false,\n        \"AttachStdin\": false,\n        \"AttachStdout\": false,\n        \"Cmd\": [],\n        \"Dns\": \"\",\n        \"Env\": [\n            \"logging_password=\",\n            \"space_id=d5f00494-eba9-4c8b-8c4d-8776619d518b\",\n            \"logstash_target=logmet.opvis.bluemix.net:9091\",\n            \"metrics_target=logmet.opvis.bluemix.net:9095\"\n        ],\n        \"Hostname\": \"instance-00138e9d\",\n        \"Image\": \"registry.ng.bluemix.net/muranamespace/apache:v1\",\n        \"ImageArchitecture\": \"amd64\",\n        \"Labels\": {},\n        \"Memory\": 256,\n        \"MemorySwap\": \"\",\n        \"OpenStdin\": true,\n        \"PortSpecs\": \"\",\n        \"StdinOnce\": false,\n        \"Tty\": true,\n        \"User\": \"\",\n        \"VCPU\": 4,\n        \"VolumesFrom\": \"\",\n        \"WorkingDir\": \"\"\n    },\n    \"ContainerState\": \"Running\",\n    \"Created\": \"2016-08-24T01:09:13.000000000Z\",\n    \"Group\": {},\n    \"HostConfig\": {\n        \"Binds\": [],\n        \"CapAdd\": [],\n        \"CapDrop\": [],\n        \"ContainerIDFile\": \"\",\n        \"Links\": [],\n        \"LogConfig\": {\n            \"Config\": {},\n            \"Type\": \"json-file\"\n        },\n        \"LxcConf\": [],\n        \"PortBindings\": {\n            \"80/tcp\": [\n                {\n                    \"HostPort\": \"80\"\n                }\n            ]\n        },\n        \"Privileged\": false,\n        \"PublishAllPorts\": false\n    },\n    \"HostId\": \"6e8cf8ca072d1e14cb4b9b570da9fde3d2303d49c2281d8e5ebef119\",\n    \"Human_id\": \"murac\",\n    \"Id\": \"b95b454b-158a-4a16-8d20-94ef8ce897f6\",\n    \"Image\": \"e61e9170b00b2b32655db4661135a7cc3f9649a767fff13cb96482070ac4e4be\",\n    \"Mounts\": [],\n    \"Name\": \"murac\",\n    \"NetworkSettings\": {\n        \"Bridge\": \"\",\n        \"Gateway\": \"\",\n        \"IPAddress\": \"172.31.0.2\",\n        \"IPPrefixLen\": 0,\n        \"MacAddress\": \"fa:16:3e:cf:73:8f\",\n        \"Networks\": {\n            \"default\": {\n                \"Aliases\": null,\n                \"EndpointID\": \"b95b454b-158a-4a16-8d20-94ef8ce897f6\",\n                \"Gateway\": \"172.31.0.1\",\n                \"GlobalIPv6Address\": \"\",\n                \"GlobalIPv6PrefixLen\": 0,\n                \"IPAMConfig\": null,\n                \"IPAddress\": \"172.31.0.2\",\n                \"IPPrefixLen\": 16,\n                \"IPv6Gateway\": \"\",\n                \"Links\": null,\n                \"MacAddress\": \"fa:16:3e:cf:73:8f\",\n                \"NetworkID\": \"a1983a32-958f-40db-a9b3-002d608ec848\"\n            }\n        },\n        \"PortMapping\": null,\n        \"Ports\": {\n            \"80/tcp\": [\n                {\n                    \"HostIp\": \"172.31.0.2\",\n                    \"HostPort\": \"80\"\n                }\n            ]\n        },\n        \"PublicIpAddress\": \"\"\n    },\n    \"Path\": \"date\",\n    \"ResolvConfPath\": \"/etc/resolv.conf\",\n    \"State\": {\n        \"Error\": \"\",\n        \"ExitCode\": 0,\n        \"FinishedAt\": \"0001-01-01T00:00:00Z\",\n        \"Ghost\": \"\",\n        \"Pid\": 1,\n        \"Running\": true,\n        \"StartedAt\": \"2016-08-24T01:09:20.000000000Z\",\n        \"Status\": \"Running\"\n    },\n    \"Volumes\": {},\n    \"VolumesRW\": {}\n}]\n```\ngrep\u3067\u5fc5\u8981\u306a\u7b87\u6240\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n```Command:\u30b3\u30f3\u30c6\u30ca\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u60c5\u5831\n# cf ic inspect b95b454b-158 |grep IPAddress\n```\n![21.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/21.png)\nWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u306f\u3001<font color=\"blue\">\u300c172.31.0.2\u300d</font>\u3067\u3059\u3002\n\n## 5-4. \u2463 VPN\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\nBluemix\u306e\u300cVPN\u30b5\u30fc\u30d3\u30b9\u300d\u3092\u30aa\u30fc\u30c0\u30fc\u3057\u3001\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3053\u3053\u307e\u3067\u306e\u624b\u9806\u3067\u3001\n<strong>\u300c5-1.  \u2460 \u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u300d</strong>\u3088\u308a\n\u30fbVyOS\u5074\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\uff1a<font color=\"blue\">\u300c161.202.154.118\u300d</font>\n\u30fbVyOS\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff1a<font color=\"blue\">\u300c10.132.52.192/16\u300d</font>\n<strong>\u300c5-3. \u2462 Web\u30b3\u30f3\u30c6\u30ca\u5b9f\u884c\u300d</strong>\u3088\u308a\n\u30fbWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\uff1a<font color=\"blue\">\u300c172.31.0.2\u300d</font>\u304c\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u4e8b\u524d\u5171\u6709\u9375\u3092<font color=\"blue\">\u300cshared-key\u300d</font>\u3068\u3044\u3046\u540d\u524d\u306b\u3057\u307e\u3057\u305f\u3002\n\n<strong>\u25bc \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306e\u30aa\u30fc\u30c0\u30fc</strong>\n![22.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/22.png)\n\u300cVirtual Private Network\u300d\u3092\u9078\u629e\u3057\u3001\u30af\u30ea\u30c3\u30af\u3002\n![23.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/23.png)\n\u300c\u4f5c\u6210\u300d\u3092\u30af\u30ea\u30c3\u30af\u3002\n>\n<font color=\"green\">\u203b\uff11\u3064\u306e\u30b9\u30da\u30fc\u30b9\u306b\u306f\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f1\u3064\u307e\u3067\u3067\u3059\u3002</font>\n![24.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/24.png)\n1\u3064\u306e\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306f\u8907\u6570\u306e\u63a5\u7d9a\u5148\u304c\u8a2d\u5b9a\u53ef\u80fd\u3002\n>\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001Bluemix\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306b<font color=\"blue\">\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d</font>\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n![25.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/25.png)\n\u30af\u30ea\u30c3\u30af\u3057\u3066\u6b21\u306b\u9032\u307f\u307e\u3059\u3002\n\n<strong>\u25bc \u300cIBM VPN \u30b5\u30fc\u30d3\u30b9\u300d\u306e\u8a2d\u5b9a</strong>\n![26.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/26.png)\n<font color=\"blue\">\u300cCreate Gateway\u300d</font>\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n![27.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/27.png)\n<font color=\"blue\">\u300cGateway Apliance\u300d</font>\u30bf\u30b0\u9078\u629e\u21d2<font color=\"blue\">\u300cEdit\u300d</font>\u3092\u30af\u30ea\u30c3\u30af\u3002\nWeb\u30b3\u30f3\u30c6\u30ca\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306f\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001VPN\u30b5\u30fc\u30d3\u30b9\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\u306f<font color=\"blue\">\u300c169.46.158.54\u300d</font>\u3067\u3059\u3002\n\n![28.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/28.png)\n<font color=\"blue\">\u300cGateway Apliance Name\u300d</font>\u306f<font color=\"blue\">\u300cVPNGW01\u300d</font>\u21d2<font color=\"blue\">\u300cSave\u300d</font>\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n\u3053\u3053\u3067\u306f<font color=\"blue\">\u300cIKE \uff06 IPsec Polices\u300d</font>\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u4f7f\u7528\u3057\u307e\u3059\u306e\u3067\u3001\u8a2d\u5b9a\u3057\u307e\u305b\u3093\u3002\n\u3061\u306a\u307f\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306f\u4e0b\u8a18\u306e\u901a\u308a\u3067\u3059\u3002\n![29.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/29.png)\n\n<strong>\u300cSite Connections\u300d\u306e\u8a2d\u5b9a\u3057\u307e\u3059\u3002</strong>\n<font color=\"blue\">\u300cSite Connections\u300d</font>\u30bf\u30d6\u3092\u30af\u30ea\u30c3\u30af\n![30.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/30.png)\n<strong>\u2460 Name:</strong>\u3000\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u306e<font color=\"blue\">\u300cConnection1\u300d</font> \n<strong>\u2461\u300cPreShared Key String\u300d:</strong> <font color=\"blue\">\u300cshared-key\u300d</font>\n\u5f8c\u307b\u3069\u8a2d\u5b9a\u3059\u308bVyOS-VPN\u8a2d\u5b9a\u306e\u201d vpn ipsec site-to-site peer 169.46.158.54 authentication pre-shared-secret shared-key\u201d\u3068\u5408\u308f\u305b\u308b\u3002\n<strong>\u2462\u300cCustomer GatewayIP\u300d:</strong> <font color=\"blue\">\u300c161.202.154.118\u300d</font>\nVyOS\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\n<strong>\u2463\u300cCustomer Subnet\u300d:</strong> <font color=\"blue\">\u300c10.132.52.192/16\u300d</font>\nVyOS\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n<strong>\u2464\u300cDescription\u300d:</strong> <font color=\"blue\">\u5fc5\u9808\u3067\u306a\u3044\u306e\u3067\u5165\u529b\u306a\u3057</font>\n<strong>\u2465\u300cAdmin State\u300d:</strong> <font color=\"blue\">\u300cdown\u300d</font>\nVyOS\u8a2d\u5b9a\u3057\u305f\u5f8c\u306b\u300cup\u300d\u306b\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3002\n\n\u5404\u30d1\u30e9\u30e1\u30fc\u30bf\u5165\u529b\u5f8c\u3001\u300csave\u300d\u3092\u30af\u30ea\u30c3\u30af\n\n![31.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/31.png)\n\n\n## 5-5. \u2464VyOS\u306eVPN\u8a2d\u5b9a\nSoftLayer\u5074\u306e<strong><font color=\"blue\">\u300cvyos\u300d</font></strong>\u306e\u8a2d\u5b9a\u3067\u3059\u3002\n\nVyOS\u306e\u5c0e\u5165\u3001\u57fa\u672c\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\n(\u53c2\u8003\u60c5\u5831)\u30fbVyOS\u5c0e\u5165\n \u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562b\n\u300cSoftLayer\u3068VyOS\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u790e\u3092\u52c9\u5f37\uff14-(IPsecVPN LAN\u9593\u63a5\u7d9a\u7de8)\u300d\nhttp://qiita.com/Mitsu-Murakita/items/9bb09f54494345b51ce8\n\nVyOS\u306e\u57fa\u672c\u8a2d\u5b9a\u60c5\u5831\u3067\u3059\u3002\u3053\u308c\u306bVPN\u95a2\u9023\u60c5\u5831\u3092\u8ffd\u52a0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```Command:VyOS\u57fa\u672c\u8a2d\u5b9a\n interfaces {\n     ethernet eth0 {\n         address 10.132.52.226/26\n         duplex auto\n         hw-id 06:38:a7:d9:ec:e4\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.154.118/29\n         duplex auto\n         hw-id 06:dc:71:bf:8e:b3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     domain-name softlayer.com\n     gateway-address 161.202.154.113\n     host-name vyos\n     login {\n         user vyos {\n             authentication {\n                 encrypted-password xxxxxxxxxxxxxxxxxxxx\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     name-server 10.0.80.12\n     ntp {\n         server time.service.networklayer.com {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone Asia/Tokyo\n }\n```\n\n\u4e0b\u8a18VPN\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n<font color=\"green\">\u203b\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7[xx]\u3092\u3064\u3051\u3066\u307e\u3059\u3002</font>\n\n```Command:VPN\u8a2d\u5b9a\u8ffd\u52a0\n[01] # set vpn ipsec esp-group bmixvpn-esp\n[02] # set vpn ipsec esp-group bmixvpn-esp compression disable\n[03] # set vpn ipsec esp-group bmixvpn-esp lifetime 3600\n[04] # set vpn ipsec esp-group bmixvpn-esp mode tuunel\n[05] # set vpn ipsec esp-group bmixvpn-esp pfs dh-group2\n[06] # set vpn ipsec esp-group bmixvpn-esp proposal 1\n[07] # set vpn ipsec esp-group bmixvpn-esp proposal 1 encryption aes128\n[08] # set vpn ipsec esp-group bmixvpn-esp proposal 1 hash sha1\n\n[09] # set vpn ipsec ike-group bmixvpn-ike\n[10] # set vpn ipsec ike-group bmixvpn-ike lifetime 28800\n[11] # set vpn ipsec ike-group bmixvpn-ike proposal 1\n[12] # set vpn ipsec ike-group bmixvpn-ike proposal 1 dh-group 2\n[13] # set vpn ipsec ike-group bmixvpn-ike proposal 1 encryption aes128\n[14] # set vpn ipsec ike-group bmixvpn-ike proposal 1 hash sha1\n\n[15] # set vpn ipsec ipsec-interfaces interface eth0\n\n[16] # set vpn ipsec site-to-site peer 169.46.158.54\n[17] # set vpn ipsec site-to-site peer 169.46.158.54 authentication\n[18] # set vpn ipsec site-to-site peer 169.46.158.54 authentication id 161.202.154.118\n[19] # set vpn ipsec site-to-site peer 169.46.158.54 authentication mode pre-shared-secret\n[20] # set vpn ipsec site-to-site peer 169.46.158.54 authentication pre-shared-secret shared-key\n[21] # set vpn ipsec site-to-site peer 169.46.158.54 authentication remote-id 169.46.158.54\n\n[22] # set vpn ipsec site-to-site peer 169.46.158.54 connection-type respond\n[23] # set vpn ipsec site-to-site peer 169.46.158.54 default-esp-group bmixvpn-esp\n[24] # set vpn ipsec site-to-site peer 169.46.158.54 ike-group bmixvpn-ike\n[25] # set vpn ipsec site-to-site peer 169.46.158.54 local-address any\n\n[26] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1\n[27] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 local\n[28] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 local prefix 10.132.52.192/26\n[29] # set vpn ipsec site-to-site peer 169.46.158.54  tunnel 1 remote prefix 172.31.0.0/16\n```\n<font color=\"blue\">\n[01]-[08]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306e\"IPsec Policies\"\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\n[09]-[14]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u306e\"IKE Policies\"\u306b\u5408\u308f\u305b\u3066\u8a2d\u5b9a\n[15]-[15]:  IPsecVPN\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\"eth0\"\u3092\u4f7f\u7528\n[20]-[21]:  \u4e8b\u524d\u5171\u901a\u9375\u3092\u4f7f\u7528\u3057\u3001\u5024\u306f\"shared-key\"\n[22]-[22]: \u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u304c\"initiate \"\u3067\u3042\u308b\u305f\u3081\u3001VyOS\u5074\u306f\u201drespond\u201d\u306b\u8a2d\u5b9a\n[28]-[28]: VyOS\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n[28]-[28]:\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d\u5074\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\n</font>\n\n\nVyOS\u5074\u306eVPN\u8a2d\u5b9a\u3067\u3059\u3002\n\n```Command:VyOS-VPN\u8a2d\u5b9a\n interfaces {\n     ethernet eth0 {\n         address 10.132.52.226/26\n         duplex auto\n         hw-id 06:38:a7:d9:ec:e4\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.154.118/29\n         duplex auto\n         hw-id 06:dc:71:bf:8e:b3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     domain-name softlayer.com\n     gateway-address 161.202.154.113\n     host-name vyos\n     login {\n         user vyos {\n             authentication {\n                 encrypted-password xxxxxxxxxxxxxxxxxxx\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     name-server 10.0.80.12\n     ntp {\n         server time.service.networklayer.com {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone Asia/Tokyo\n }\n vpn {\n     ipsec {\n         esp-group bmixvpn-esp {\n             compression disable\n             lifetime 3600\n             mode tunnel\n             pfs dh-group2\n             proposal 1 {\n             }\n         }\n         ike-group bmixvpn-ike {\n             lifetime 28800\n             proposal 1 {\n                 dh-group 2\n                 encryption aes128\n                 hash sha1\n             }\n         }\n         ipsec-interfaces {\n             interface eth0\n         }\n         site-to-site {\n             peer 169.46.158.54 {\n                 authentication {\n                     id 161.202.154.118\n                     mode pre-shared-secret\n                     pre-shared-secret shared-key\n                     remote-id 169.46.158.54\n                 }\n                 connection-type respond\n                 default-esp-group bmixvpn-esp\n                 ike-group bmixvpn-ike\n                 local-address any\n                 tunnel 1 {\n                     local {\n                         prefix 10.132.52.192/26\n                     }\n                     remote {\n                         prefix 172.31.0.0/16\n                     }\n                 }\n             }\n         }\n     }\n }\n```\n\n# 6. \u63a5\u7d9a\u78ba\u8a8d\n<font color=\"blue\">\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d</font>\u5074\u306e<font color=\"blue\">\u300cAdmin State\u300d</font>\u3092<font color=\"blue\">\u201dDOWN\u201d</font>\u306b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001VyOS\u5074\u306eVPN\u3082<font color=\"blue\">\"down\"</font>\u306e\u72b6\u614b\u3067\u3059\u3002\n\n```Command:VyOS\u5074IPsec\u72b6\u614b\u306e\u78ba\u8a8d\n# show vpn ipsec sa\n```\n![32.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/32.png)\n\n<font color=\"blue\">\u300cIBM VPN\u30b5\u30fc\u30d3\u30b9\u300d</font>\u5074\u306e<font color=\"blue\">\u300cAdmin State\u300d</font>\u3092<font color=\"blue\">\u201dUP\u201d</font>\u306b\u3057\u307e\u3059\u3002\n\u300cSite Connections\u300d\u21d2\u300cEdit\u300d\n<font color=\"blue\">\u300cPre Shared Key\u300d</font>\u304c\u30d6\u30e9\u30f3\u30af\u3067\u3059\u306e\u3067\u3001\u518d\u5ea6\u5165\u529b\u3057(\"shared-key\")\u3001<font color=\"blue\">\u300cAdmin State\u300d</font>\u3092<font color=\"blue\">\u201dUP\u201d</font> \u21d2<font color=\"blue\">\u300cSave\u300d</font>\n![33.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/33.png)\n\nVyOS\u5074\u306eIPsec-VPN\u304c<font color=\"blue\">\"up\"</font>\u306b\u306a\u308a\u3001VPN\u901a\u4fe1\u304c\u63a5\u7d9a\u3067\u304d\u307e\u3057\u305f\u3002\n![34.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/34.png)\n\n<strong>\u30fbPING\u3067\u306e\u63a5\u7d9a\u78ba\u8a8d </strong> \nVyOS\u5074\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u300cDebian8\u300d\u304b\u3089Web\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066<font color=\"blue\">PING</font>\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u300cDebian8\u300d\u306b\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```Command:\u300cDebian8\u300d\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30c8\u8a2d\u5b9a\n# route add -net 172.31.0.0 netmask 255.255.0.0 gw 10.132.52.226\n```\n\n![35.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/35.png)\n\u758e\u901a\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n<strong>\u30fbcurl\u3067Web\u30b3\u30f3\u30c6\u30ca\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u8868\u793a\u306e\u78ba\u8a8d</strong>\n![36.png](http://www.seahorse-inc.com/QIITA/Bluemix-VPNService/36.png)\n<font color=\"blue\"><strong>'It works!'</strong></font>\u304c\u8868\u793a\u3055\u308c\u305f\u306e\u3067\u3001Web\u3082\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n# 7. \u304a\u308f\u308a\u306b\nBluemix\u74b0\u5883\u3068SoftLayer\u74b0\u5883\u306e\u63a5\u7d9a\u3067\u3057\u305f\u304c\u3001SoftLayer\u74b0\u5883\u3092\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u306b\u7f6e\u304d\u63db\u3048\u308c\u3070\u3001\u30bb\u30ad\u30e5\u30a2\u306a\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u74b0\u5883\u3082\u6bd4\u8f03\u7684\u5bb9\u6613\u306b\u69cb\u7bc9\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["Bluemix", "SoftLayer", "VPN", "container", "docker"]}