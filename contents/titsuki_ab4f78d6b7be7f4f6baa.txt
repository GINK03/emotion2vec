{"context": "\u3053\u3093\u306b\u3061\u306f\u3001Perl 6\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e10\u65e5\u76ee\u306e\u6295\u7a3f\u306b\u306a\u308a\u307e\u3059\u3002\nAdvent Calender 6\u65e5\u76ee\u3067\u306f\"\u3053\u3093\u306b\u3061\u306f\u4e16\u754c\uff01\"\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4eca\u65e5\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u5b9f\u7528\u7684\u306a\u4f8b\u3068\u3057\u3066\u3001Inline::Perl5\u3067Algorithm::LibLinear\u3092\u547c\u3073\u51fa\u3057\u3066SVM\u306b\u3088\u308b\u6a5f\u68b0\u5b66\u7fd2\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\uff01\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nInline::Perl5 \u306e\u5165\u308c\u65b9\u306f Advent Calender 6\u65e5\u76ee \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\nPerl 5\u5074\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5165\u308c\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002cpanm \u3092\u4f7f\u3063\u3066\u308b\u3068\u4eee\u5b9a\u3057\u3066\u3044\u307e\u3059\n\n $ cpanm Algorithm::LibLinear\n $ cpanm Mouse::Util::TypeConstraints\n $ cpanm PadWalker\n\n\n\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u6e96\u5099\n\n\nlibsvm\u306e\u30b5\u30a4\u30c8\u304b\u3089news20\u3092\u3082\u3089\u3063\u3066\u304d\u307e\u3057\u3087\u3046\n\nhttps://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html#news20\n\n\n\u30b3\u30de\u30f3\u30c9\n\n$ wget https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/news20.bz2\n$ bzip2 -d news20.bz2 # \u3053\u308c\u306ftrain\u7528\u30c7\u30fc\u30bf\n$ wget https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/news20.t.bz2\n$ bzip2 -d news20.t.bz2 # \u3053\u308c\u306ftest\u7528\u30c7\u30fc\u30bf\n\n\nLet's try!\n\n5\u5206\u5272\u4ea4\u5dee\u691c\u5b9a\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\n\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u306ftrain\u30c7\u30fc\u30bf\u30675\u5206\u5272\u4ea4\u5dee\u691c\u5b9a\u3092\u3084\u3063\u3066\u3044\u307e\u3059\n\n\nsvm.p6\nuse Algorithm::LibLinear:from<Perl5>;\nuse Algorithm::LibLinear::DataSet:from<Perl5>;\n\nmy $data-str = \"news20\".IO.slurp;\nmy $data-set = Algorithm::LibLinear::DataSet.load(string => $data-str);\nmy $learner = Algorithm::LibLinear.new;\n\nmy $accuracy = $learner.cross_validation(\n    data_set => $data-set,\n    num_folds => 5,\n);\n\n$accuracy.say; # accuracy \u304c\u51fa\u529b\u3055\u308c\u308b\n\n\n\noutput\n$ perl6 svm.p6\n0.801004079071227\n\n\n\u3044\u3051\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\npredict\u3082\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\n\n\ntrain\u7528\u30c7\u30fc\u30bf\u3067\u5b66\u7fd2\ntest\u7528\u30c7\u30fc\u30bf\u304b\u3089\u9069\u5f53\u306b\u3072\u3068\u3064\u3092\u53d6\u308a\u51fa\u3057\u3066\u30e9\u30d9\u30eb\u3092\u4e88\u60f3\u3055\u305b\u308b\u3002\u3068\u3044\u3046\u64cd\u4f5c\u30925\u56de\u884c\u3046\n\n\n\n\nsvm-predict.p6\nuse Algorithm::LibLinear:from<Perl5>;\nuse Algorithm::LibLinear::DataSet:from<Perl5>;\n\nmy $train-str = \"news20\".IO.slurp;\nmy @test-lines = \"news20.t\".IO.lines;\nmy $train-set = Algorithm::LibLinear::DataSet.load(string => $train-str);\nmy $learner = Algorithm::LibLinear.new;\nmy $classifier = $learner.train(data_set => $train-set);\n\nfor ^5 {\n    say '# ' ~ $_;\n    my $line = @test-lines.pick;\n    my ($label, *@feature) = $line.split(\" \", :skip-empty);\n    say \"label: \" ~ $label; # \u6b63\u89e3\u30e9\u30d9\u30eb\u3092\u51fa\u529b\n    say \"feature: \" ~ @feature[^5]; # \u5165\u529b\u3057\u305f\u7d20\u6027\u30d9\u30af\u30c8\u30eb\u3092\u51fa\u529b (\u591a\u3044\u306e\u3067\u3053\u3053\u306e\u51fa\u529b\u306f5\u500b\u306b\u3057\u307c\u3063\u3066\u307e\u3059)\n    my Map $feature := Map.new(@feature>>.split(\":\", :skip-empty).flat);\n    my $predict-label = $classifier.predict(feature => $feature);\n    say \"predict label: \" ~ $predict-label; # SVM\u306e\u4e88\u6e2c\u3057\u305f\u30e9\u30d9\u30eb\u3092\u51fa\u529b\n    ''.say;\n}\n\n\n\noutput\n# 0\nlabel: 6\nfeature: 40:1 159:2 926:1 1460:1 2481:1\npredict label: 6\n\n# 1\nlabel: 3\nfeature: 10:1 21:1 25:1 36:1 56:1\npredict label: 3\n\n# 2\nlabel: 18\nfeature: 1:1 61:1 115:1 132:1 150:1\npredict label: 18\n\n# 3\nlabel: 19\nfeature: 10:3 25:1 32:2 81:1 84:6\npredict label: 18\n\n# 4\nlabel: 20\nfeature: 1:1 10:1 25:2 40:2 79:1\npredict label: 20\n\n\n\n\u3044\u3051\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\u4ee5\u4e0a\u3001Perl 6\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e10\u65e5\u76ee\u306e\u6295\u7a3f\u3001\"Perl 6 \u306e Inline::Perl5 \u3067 Perl 5 \u306e Algorithm::LibLinear \u3092\u52d5\u304b\u3059\" \u3067\u3057\u305f\u3002\nP.S\n\u5b9f\u306f\u306f\u3058\u3081\u3001\u4eca\u65e5\u306e\u8a18\u4e8b\u306e\u5185\u5bb9\u3092\u3084\u308d\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3063\u3066\u56f0\u3063\u305f\u306e\u3067\u3059\u304c\u3001\n\u4f5c\u8005\u306e\u65b9\u306b\u76f8\u8ac7\u3057\u305f\u3089\u89e3\u6c7a\u3057\u3066\u304f\u3060\u3055\u3044\u307e\u3057\u305f\u3002\nhttps://github.com/niner/Inline-Perl5/issues/79\n\u3053\u3093\u306b\u3061\u306f\u3001Perl 6\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e10\u65e5\u76ee\u306e\u6295\u7a3f\u306b\u306a\u308a\u307e\u3059\u3002\n\n[Advent Calender 6\u65e5\u76ee](http://qiita.com/titsuki/items/0ee508c93d7bff149916)\u3067\u306f\"\u3053\u3093\u306b\u3061\u306f\u4e16\u754c\uff01\"\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4eca\u65e5\u306f\u3082\u3046\u3061\u3087\u3063\u3068\u5b9f\u7528\u7684\u306a\u4f8b\u3068\u3057\u3066\u3001Inline::Perl5\u3067[Algorithm::LibLinear](http://search.cpan.org/~sekia/Algorithm-LibLinear/lib/Algorithm/LibLinear.pm)\u3092\u547c\u3073\u51fa\u3057\u3066SVM\u306b\u3088\u308b\u6a5f\u68b0\u5b66\u7fd2\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\uff01\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n+ Inline::Perl5 \u306e\u5165\u308c\u65b9\u306f [Advent Calender 6\u65e5\u76ee](http://qiita.com/titsuki/items/0ee508c93d7bff149916) \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n\n\n+ Perl 5\u5074\u306b\u3064\u3044\u3066\u306f\u4e0b\u8a18\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5165\u308c\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002cpanm \u3092\u4f7f\u3063\u3066\u308b\u3068\u4eee\u5b9a\u3057\u3066\u3044\u307e\u3059\n\n```\n $ cpanm Algorithm::LibLinear\n $ cpanm Mouse::Util::TypeConstraints\n $ cpanm PadWalker\n```\n\n# \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u6e96\u5099\n\n+ libsvm\u306e\u30b5\u30a4\u30c8\u304b\u3089[news20](http://qwone.com/~jason/20Newsgroups/)\u3092\u3082\u3089\u3063\u3066\u304d\u307e\u3057\u3087\u3046\n + https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass.html#news20\n\n+ \u30b3\u30de\u30f3\u30c9\n\n```\n$ wget https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/news20.bz2\n$ bzip2 -d news20.bz2 # \u3053\u308c\u306ftrain\u7528\u30c7\u30fc\u30bf\n$ wget https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/multiclass/news20.t.bz2\n$ bzip2 -d news20.t.bz2 # \u3053\u308c\u306ftest\u7528\u30c7\u30fc\u30bf\n```\n\n# Let's try!\n\n## 5\u5206\u5272\u4ea4\u5dee\u691c\u5b9a\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\n\n+ \u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u306ftrain\u30c7\u30fc\u30bf\u30675\u5206\u5272\u4ea4\u5dee\u691c\u5b9a\u3092\u3084\u3063\u3066\u3044\u307e\u3059\n\n```pl:svm.p6\nuse Algorithm::LibLinear:from<Perl5>;\nuse Algorithm::LibLinear::DataSet:from<Perl5>;\n\nmy $data-str = \"news20\".IO.slurp;\nmy $data-set = Algorithm::LibLinear::DataSet.load(string => $data-str);\nmy $learner = Algorithm::LibLinear.new;\n\nmy $accuracy = $learner.cross_validation(\n    data_set => $data-set,\n    num_folds => 5,\n);\n\n$accuracy.say; # accuracy \u304c\u51fa\u529b\u3055\u308c\u308b\n```\n\n```bash:output\n$ perl6 svm.p6\n0.801004079071227\n```\n\u3044\u3051\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\n## predict\u3082\u3084\u3063\u3066\u307f\u307e\u3057\u3087\u3046\n\n+ \u4e0b\u8a18\u306e\u3088\u3046\u306a\u64cd\u4f5c\u3092\u884c\u3063\u3066\u3044\u307e\u3059\n  + train\u7528\u30c7\u30fc\u30bf\u3067\u5b66\u7fd2\n  + test\u7528\u30c7\u30fc\u30bf\u304b\u3089\u9069\u5f53\u306b\u3072\u3068\u3064\u3092\u53d6\u308a\u51fa\u3057\u3066\u30e9\u30d9\u30eb\u3092\u4e88\u60f3\u3055\u305b\u308b\u3002\u3068\u3044\u3046\u64cd\u4f5c\u30925\u56de\u884c\u3046\n\n```pl:svm-predict.p6\nuse Algorithm::LibLinear:from<Perl5>;\nuse Algorithm::LibLinear::DataSet:from<Perl5>;\n\nmy $train-str = \"news20\".IO.slurp;\nmy @test-lines = \"news20.t\".IO.lines;\nmy $train-set = Algorithm::LibLinear::DataSet.load(string => $train-str);\nmy $learner = Algorithm::LibLinear.new;\nmy $classifier = $learner.train(data_set => $train-set);\n\nfor ^5 {\n    say '# ' ~ $_;\n    my $line = @test-lines.pick;\n    my ($label, *@feature) = $line.split(\" \", :skip-empty);\n    say \"label: \" ~ $label; # \u6b63\u89e3\u30e9\u30d9\u30eb\u3092\u51fa\u529b\n    say \"feature: \" ~ @feature[^5]; # \u5165\u529b\u3057\u305f\u7d20\u6027\u30d9\u30af\u30c8\u30eb\u3092\u51fa\u529b (\u591a\u3044\u306e\u3067\u3053\u3053\u306e\u51fa\u529b\u306f5\u500b\u306b\u3057\u307c\u3063\u3066\u307e\u3059)\n    my Map $feature := Map.new(@feature>>.split(\":\", :skip-empty).flat);\n    my $predict-label = $classifier.predict(feature => $feature);\n    say \"predict label: \" ~ $predict-label; # SVM\u306e\u4e88\u6e2c\u3057\u305f\u30e9\u30d9\u30eb\u3092\u51fa\u529b\n    ''.say;\n}\n```\n\n```bash:output\n# 0\nlabel: 6\nfeature: 40:1 159:2 926:1 1460:1 2481:1\npredict label: 6\n\n# 1\nlabel: 3\nfeature: 10:1 21:1 25:1 36:1 56:1\npredict label: 3\n\n# 2\nlabel: 18\nfeature: 1:1 61:1 115:1 132:1 150:1\npredict label: 18\n\n# 3\nlabel: 19\nfeature: 10:3 25:1 32:2 81:1 84:6\npredict label: 18\n\n# 4\nlabel: 20\nfeature: 1:1 10:1 25:2 40:2 79:1\npredict label: 20\n\n```\n\u3044\u3051\u307e\u3057\u305f\uff01\uff01\uff01\uff01\n\n\n\u4ee5\u4e0a\u3001Perl 6\u30a2\u30c9\u30d9\u30f3\u30c8\u30ab\u30ec\u30f3\u30c0\u30fc\u306e10\u65e5\u76ee\u306e\u6295\u7a3f\u3001\"Perl 6 \u306e Inline::Perl5 \u3067 Perl 5 \u306e Algorithm::LibLinear \u3092\u52d5\u304b\u3059\" \u3067\u3057\u305f\u3002\n\n\nP.S\n\u5b9f\u306f\u306f\u3058\u3081\u3001\u4eca\u65e5\u306e\u8a18\u4e8b\u306e\u5185\u5bb9\u3092\u3084\u308d\u3046\u3068\u3057\u305f\u3068\u304d\u306b\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3063\u3066\u56f0\u3063\u305f\u306e\u3067\u3059\u304c\u3001\n\u4f5c\u8005\u306e\u65b9\u306b\u76f8\u8ac7\u3057\u305f\u3089\u89e3\u6c7a\u3057\u3066\u304f\u3060\u3055\u3044\u307e\u3057\u305f\u3002\nhttps://github.com/niner/Inline-Perl5/issues/79\n", "tags": ["Perl6", "Perl", "\u6a5f\u68b0\u5b66\u7fd2"]}