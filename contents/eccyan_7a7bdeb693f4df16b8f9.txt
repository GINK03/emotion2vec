{"context": " More than 1 year has passed since last update.\u3053\u306e\u3088\u3046\u306agem\u3082\u3042\u308a\u307e\u3059\u304c\nhttps://github.com/oggy/redis_master_slave\nconfig/initializers \u306b\u6570\u884c\u52a0\u3048\u308b\u3060\u3051\u3067\u632f\u308a\u5206\u3051\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u7b49\u3092\u4f7f\u3063\u3066\u308b\u3068\u4e0d\u5177\u5408\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nconfig/initializers/redis.rb\nclass Redis\n  class Client\n    def call(command, &block)\n      master_host = MASTER_HOST_URI\n      slave_host  = SLAVE_HOST_URI\n\n      # Slave \u306b\u5411\u3051\u305f\u3044\u304a\u597d\u304d\u306a\u30b3\u30de\u30f3\u30c9\u3092\u767b\u9332\n      slave_commands = [:get, :hget, :hgetall] \n\n      disconnect\n      @options[:host] = if slave_commands.include?(command[0])\n        slave_host \n      else\n        master_host\n      end\n      connect\n\n      reply = process([command]) { read }\n      raise reply if reply.is_a?(CommandError)\n\n      if block\n        block.call(reply)\n      else\n        reply\n      end\n    end\n  end\nend\n\n\n\u3053\u306e\u3088\u3046\u306agem\u3082\u3042\u308a\u307e\u3059\u304c\nhttps://github.com/oggy/redis_master_slave\n\n``config/initializers`` \u306b\u6570\u884c\u52a0\u3048\u308b\u3060\u3051\u3067\u632f\u308a\u5206\u3051\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u30d7\u30fc\u30eb\u7b49\u3092\u4f7f\u3063\u3066\u308b\u3068\u4e0d\u5177\u5408\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n```rb:config/initializers/redis.rb\nclass Redis\n  class Client\n    def call(command, &block)\n      master_host = MASTER_HOST_URI\n      slave_host  = SLAVE_HOST_URI\n\n      # Slave \u306b\u5411\u3051\u305f\u3044\u304a\u597d\u304d\u306a\u30b3\u30de\u30f3\u30c9\u3092\u767b\u9332\n      slave_commands = [:get, :hget, :hgetall] \n\n      disconnect\n      @options[:host] = if slave_commands.include?(command[0])\n        slave_host \n      else\n        master_host\n      end\n      connect\n\n      reply = process([command]) { read }\n      raise reply if reply.is_a?(CommandError)\n\n      if block\n        block.call(reply)\n      else\n        reply\n      end\n    end\n  end\nend\n```\n", "tags": ["Redis", "Rails3.2"]}