{"context": " More than 1 year has passed since last update.\n\n\u6e96\u5099\n# AWS Ubuntu 14.04 LTS/Trusty\n$ curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elasticsearch\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elb-log\n\n\u53c2\u7167: http://docs.fluentd.org/articles/install-by-deb\n\n\u8a2d\u5b9a\n$ sudo vi /etc/td-agent/td-agent.conf\n  <source>\n    type elb_log\n    access_key_id xxxxxx\n    secret_access_key xxxxxx\n    region ap-northeast-1\n    s3_bucketname xxxxxxx\n    s3_prefix xxxxxxxx\n    timestamp_file /tmp/elb_last_at.dat\n    buf_file /tmp/fluentd-elblog.tmpfile\n    refresh_interval 300\n    tag elb.access\n  </source>\n  <match **>\n    type elasticsearch\n    type_name access_log\n    host xxxxxxx.ap-northeast-1.es.amazonaws.com\n    port 80\n    logstash_format true\n    include_tag_key true\n    tag_key @log_name\n    buffer_type file\n    buffer_chunk_limit 5m\n    buffer_queue_limit 1280\n    flush_interval 5s\n    buffer_path /var/log/td-agent/buffer/access.buffer\n    disable_retry_limit false\n    retry_limit 17\n    retry_wait 1s\n  </match>\n</ROOT>\n\n\nport\u306f9200\u3058\u3083\u306a\u304f\u306680\u3067\u901a\u308b\nAmazon Elasticsearch \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u4e00\u5ea6\u306b\u30a2\u30c3\u30d7\u3067\u304d\u308bpayload\u306e\u30b5\u30a4\u30ba\u304c\u9650\u3089\u308c\u3066\u3044\nhttps://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/aes-limits.html\n\n\nEach supported instance type has a maximum supported payload for HTTP requests:\nt2.micro.elasticsearch: 10 MB\nt2.small.elasticsearch: 10 MB\nt2.medium.elasticsearch: 10 MB\nm3.medium.elasticsearch: 10 MB\nm3.large.elasticsearch: 10 MB\nm3.xlarge.elasticsearch: 100 MB\nm3.2xlarge.elasticsearch: 100 MB\nr3.large.elasticsearch: 100 MB\nr3.xlarge.elasticsearch: 100 MB\nr3.2xlarge.elasticsearch: 100 MB\nr3.4xlarge.elasticsearch: 100 MB\nr3.8xlarge.elasticsearch: 100 MB\ni2.xlarge.elasticsearch: 100 MB\ni2.2xlarge.elasticsearch: 100 MB\n\n\n\u8d77\u52d5\n$ sudo /etc/init.d/td-agent start\n\n\n# \u6e96\u5099\n```bash\n\b# AWS Ubuntu 14.04 LTS/Trusty\n$ curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elasticsearch\n$ sudo /opt/td-agent/embedded/bin/fluent-gem install fluent-plugin-elb-log\n```\n\u53c2\u7167: http://docs.fluentd.org/articles/install-by-deb\n\n# \u8a2d\u5b9a\n```bash\n\b$ sudo vi /etc/td-agent/td-agent.conf\n  <source>\n    type elb_log\n    access_key_id xxxxxx\n    secret_access_key xxxxxx\n    region ap-northeast-1\n    s3_bucketname xxxxxxx\n    s3_prefix xxxxxxxx\n    timestamp_file /tmp/elb_last_at.dat\n    buf_file /tmp/fluentd-elblog.tmpfile\n    refresh_interval 300\n    tag elb.access\n  </source>\n  <match **>\n    type elasticsearch\n    type_name access_log\n    host xxxxxxx.ap-northeast-1.es.amazonaws.com\n    port 80\n    logstash_format true\n    include_tag_key true\n    tag_key @log_name\n    buffer_type file\n    buffer_chunk_limit 5m\n    buffer_queue_limit 1280\n    flush_interval 5s\n    buffer_path /var/log/td-agent/buffer/access.buffer\n    disable_retry_limit false\n    retry_limit 17\n    retry_wait 1s\n  </match>\n</ROOT>\n```\n* port\u306f9200\u3058\u3083\u306a\u304f\u306680\u3067\u901a\u308b\n* Amazon Elasticsearch \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b5\u30a4\u30ba\u306b\u3088\u3063\u3066\u4e00\u5ea6\u306b\u30a2\u30c3\u30d7\u3067\u304d\u308bpayload\u306e\u30b5\u30a4\u30ba\u304c\u9650\u3089\u308c\u3066\u3044\nhttps://docs.aws.amazon.com/elasticsearch-service/latest/developerguide/aes-limits.html\n\n```\nEach supported instance type has a maximum supported payload for HTTP requests:\nt2.micro.elasticsearch: 10 MB\nt2.small.elasticsearch: 10 MB\nt2.medium.elasticsearch: 10 MB\nm3.medium.elasticsearch: 10 MB\nm3.large.elasticsearch: 10 MB\nm3.xlarge.elasticsearch: 100 MB\nm3.2xlarge.elasticsearch: 100 MB\nr3.large.elasticsearch: 100 MB\nr3.xlarge.elasticsearch: 100 MB\nr3.2xlarge.elasticsearch: 100 MB\nr3.4xlarge.elasticsearch: 100 MB\nr3.8xlarge.elasticsearch: 100 MB\ni2.xlarge.elasticsearch: 100 MB\ni2.2xlarge.elasticsearch: 100 MB\n```\n\n# \u8d77\u52d5\n```\n$ sudo /etc/init.d/td-agent start\n```\n", "tags": ["Kibana4", "Elasticsearch", "fluentd"]}