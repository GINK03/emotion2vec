{"context": "fabric\u306b\u3088\u308bjboss\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u7528\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\u30d3\u30eb\u30c9\u5f8c\u306e\u6210\u679c\u7269\u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3059\u308b\u3002\n\n\u30b9\u30af\u30ea\u30d7\u30c8\nfrom fabric.api import run, env, put\n\nenv.use_ssh_config = True\n\ndef deploy():\n    put(\"./trunk/project/build/libs/app.war\", \"/home/ec2-user/app.war\")\n    run(\"sudo chown jboss:jboss /home/ec2-user/app.war\")\n    run(\"sudo /opt/jboss7/bin/./jboss-cli.sh -c --command='undeploy app.war'\")\n    run(\"sudo /opt/jboss7/bin/./jboss-cli.sh -c --command='deploy /home/ec2-user/app.war'\")\n    run(\"sudo /etc/init.d/jboss restart\")\n\n\n\u5b9f\u884c\nfab -H {\u30db\u30b9\u30c8\u540d} deploy\n\n\n\u304a\u307e\u3051\n\u8e0f\u3080\u53f0\u30b5\u30fc\u30d0\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3002\n\u5f15\u6570\u306b\u6307\u5b9a\u3057\u3066\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3068config\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u3066\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306e\uff12\u3064\u3092\u7d39\u4ecb\u3002\n\n\u5f15\u6570\u3067\u6307\u5b9a\n.ssh/config\u306b\u5404\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\u3002\nHost           proxy                         #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\n\nHost           remote                        #\u63a5\u7d9a\u5148\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u63a5\u7d9a\u5148\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\n\n\u300c-g\u300d\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\nfab -H remote -g proxy deploy\n\n\nconfig\u306b\u6307\u5b9a\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u76f4\u63a5config\u306b\u6307\u5b9a\u3059\u308b\u3002\n```\nHost           proxy                         #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\nHost           remote                        #\u63a5\u7d9a\u5148\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u63a5\u7d9a\u5148\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\nProxyCommand   ssh -W %h:%p proxy            #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\n```\n\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\nfab -H remote deploy\n\n\nfabric\u306b\u3088\u308bjboss\u3078\u306e\u30c7\u30d7\u30ed\u30a4\u7528\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\u30d3\u30eb\u30c9\u5f8c\u306e\u6210\u679c\u7269\u304c\u4f5c\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3059\u308b\u3002\n\n### \u30b9\u30af\u30ea\u30d7\u30c8\n\n```python\nfrom fabric.api import run, env, put\n\nenv.use_ssh_config = True\n\ndef deploy():\n    put(\"./trunk/project/build/libs/app.war\", \"/home/ec2-user/app.war\")\n    run(\"sudo chown jboss:jboss /home/ec2-user/app.war\")\n    run(\"sudo /opt/jboss7/bin/./jboss-cli.sh -c --command='undeploy app.war'\")\n    run(\"sudo /opt/jboss7/bin/./jboss-cli.sh -c --command='deploy /home/ec2-user/app.war'\")\n    run(\"sudo /etc/init.d/jboss restart\")\n```\n\n### \u5b9f\u884c\n\n```\nfab -H {\u30db\u30b9\u30c8\u540d} deploy\n```\n\n## \u304a\u307e\u3051\n\u8e0f\u3080\u53f0\u30b5\u30fc\u30d0\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3002\n\u5f15\u6570\u306b\u6307\u5b9a\u3057\u3066\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3068config\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u3066\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306e\uff12\u3064\u3092\u7d39\u4ecb\u3002\n\n### \u5f15\u6570\u3067\u6307\u5b9a\n.ssh/config\u306b\u5404\u30b5\u30fc\u30d0\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n```\nHost           proxy                         #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\n\nHost           remote                        #\u63a5\u7d9a\u5148\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u63a5\u7d9a\u5148\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\n```\n\n\u300c-g\u300d\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```\nfab -H remote -g proxy deploy\n```\n\n### config\u306b\u6307\u5b9a\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306b\u76f4\u63a5config\u306b\u6307\u5b9a\u3059\u308b\u3002\n```\nHost           proxy                         #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\n\nHost           remote                        #\u63a5\u7d9a\u5148\u306e\u540d\u524d\nHostName       XXX.XXX.XXX.XXX               #\u63a5\u7d9a\u5148\u306e\u30db\u30b9\u30c8\nUser           deploy                        #SSH\u63a5\u7d9a\u306e\u30e6\u30fc\u30b6\u30fc\u540d\nIdentityFile   /home/ec2-user/.ssh/key.pem   #SSH\u63a5\u7d9a\u306e\u9375\u30d5\u30a1\u30a4\u30eb\nProxyCommand   ssh -W %h:%p proxy            #\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u3092\u6307\u5b9a\n```\n\n\u30db\u30b9\u30c8\u540d\u3092\u6307\u5b9a\u3057\u3066\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n```\nfab -H remote deploy\n```\n", "tags": ["fabric", "Python", "jboss", "Jenkins"]}