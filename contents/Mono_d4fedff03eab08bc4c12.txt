{"tags": ["JavaScript", "jasmine", "\u975e\u540c\u671f\u51e6\u7406", "\u5358\u4f53\u30c6\u30b9\u30c8"], "context": " More than 1 year has passed since last update.\u307e\u305a\u30c6\u30b9\u30c8\u3059\u308b\u30b3\u30fc\u30c9\nxhr\u3067\u9069\u5f53\u306bAjax\u901a\u4fe1\u3092\u884c\u3046\u3084\u30fc\u3064\n\ncommunication.js\nfunction Communication() {\n    var errorCallback;\n    return {\n    init : function() {\n        this.errorCallback = function(message) {\n            console.log(message);\n        };\n    },\n    connectAsync : function(type, url, callback, data) {\n        var xhr;\n\n        // \u5f15\u6570\u30c1\u30a7\u30c3\u30af\n        var checkResult = (function() {\n            var message = \"\";\n            if (typeof url === \"undefined\") {\n                message += \"url is undefined\u00a5n\";\n            }\n            if (typeof type === \"undefined\") {\n            message += \"type is undefined\u00a5n\";\n            } else if (type !== \"GET\" && type !== \"POST\") {\n                message += \"type is an incorrect value\u00a5n\";\n            }\n            if (typeof callback !== \"function\") {\n                message += \"callback is an incorrect value\u00a5n\";\n            }\n\n            if (message === \"\") {\n                return \"OK\";\n            } else {\n                return message;\n            }\n        })();\n        if (checkResult !== \"OK\") {\n            errorCallback(checkResult);\n            return false;\n        }\n\n        try {\n            xhr = new XMLHttpRequest();\n        } catch (e) {\n            errorCallback(e.message);\n            return false;\n        }\n\n        xhr.open(type, url);\n\n        xhr.setRequestHeader(\"Content-Type\",\"text/plain\");\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    callback(xhr.responseText);\n                } else {\n                    errorCallbailed(\"\u901a\u4fe1\u5931\u6557 : status code-\" + xhr.status);\n                }\n            }\n        };\n        xhr.send(data);\n    }\n};\n\n\n\u3053\u308c\u306b\u5bfe\u3057\u3066jasmine\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3068\u3053\u3046\u306a\u308b\n\ncommunication.js\ndescribe(\"connectAsync\", function() {\n        var communication = Communication();\n\n        it(\"GET\", function() {\n            var flag = false;\n            var callback = {\n                  success:function(data) {\n                            flag = true;\n                  }\n            };\n            communication.errorCallback = function(){\n                flag = true;\n            };\n            spyOn(callback, \"success\").andCallThrough();\n            communication.connectAsync(\"GET\", \"http://google.com/\", callback.success, null);\n\n            waitsFor(function() {\n                return flag;\n            });\n            runs(function() {\n                expect(callback.success).toHaveBeenCalled();\n            });\n        });\n    });\n\n\n\u901a\u4fe1\u304c\u6210\u529f\u3057\u3066\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u308b\u304b\u8abf\u3079\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306b\u5bfe\u3057\u3066spy\u3092\u4f7f\u7528\nwaitFor\u3067\u30d5\u30e9\u30b0\u3092\u5f85\u3064\u3002\n\u30a8\u30e9\u30fc\u3068\u6210\u529f\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u3067\u30d5\u30e9\u30b0\u3092ON\u306b\u3057\u3066\u3001\n\u6210\u529f\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3002\njQuery\u306eajax\u30e1\u30bd\u30c3\u30c9\u3067\u3082\u540c\u3058\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067\u51fa\u6765\u308b\u306f\u305a\u3002\n\u30b9\u30d1\u30a4\u3092On\u306b\u3059\u308b\u969b\u306b andCallThrough(); \u3068\u3057\u306a\u3044\u3068\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u304cspy\u306e\u95a2\u6570\u306b\u66f8\u304d\u63db\u308f\u3063\u3066\u3057\u307e\u3044\u3001\u30d5\u30e9\u30b0\u304cOn\u306b\u306a\u3089\u305a\u3001\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u901a\u3089\u306a\u3044\u3002\nandCallThrough();\u3068\u3059\u308b\u3053\u3068\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u969b\u306b\u672c\u6765\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3082\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\n\u50d5\u306f\u3053\u3053\u3067\u30cf\u30de\u3063\u3066\u3057\u307e\u3063\u305f\u3002\njasmine\u3067\u306e\u975e\u540c\u671f\u901a\u4fe1\uff0b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u4f8b\u304c\u306a\u304b\u306a\u304b\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3093\u3060\u304c\u306a\u305c\u3060\u308d\u3046\u3002\n\n\n\u307e\u305a\u30c6\u30b9\u30c8\u3059\u308b\u30b3\u30fc\u30c9\n\nxhr\u3067\u9069\u5f53\u306bAjax\u901a\u4fe1\u3092\u884c\u3046\u3084\u30fc\u3064\n\n```js:communication.js\nfunction Communication() {\n\tvar errorCallback;\n\treturn {\n\tinit : function() {\n\t\tthis.errorCallback = function(message) {\n\t\t\tconsole.log(message);\n\t\t};\n\t},\n\tconnectAsync : function(type, url, callback, data) {\n\t\tvar xhr;\n\n\t\t// \u5f15\u6570\u30c1\u30a7\u30c3\u30af\n\t\tvar checkResult = (function() {\n\t\t\tvar message = \"\";\n\t\t\tif (typeof url === \"undefined\") {\n\t\t\t\tmessage += \"url is undefined\u00a5n\";\n\t\t\t}\n\t\t\tif (typeof type === \"undefined\") {\n\t\t\tmessage += \"type is undefined\u00a5n\";\n\t\t\t} else if (type !== \"GET\" && type !== \"POST\") {\n\t\t\t\tmessage += \"type is an incorrect value\u00a5n\";\n\t\t\t}\n\t\t\tif (typeof callback !== \"function\") {\n\t\t\t\tmessage += \"callback is an incorrect value\u00a5n\";\n\t\t\t}\n\n\t\t\tif (message === \"\") {\n\t\t\t\treturn \"OK\";\n\t\t\t} else {\n\t\t\t\treturn message;\n\t\t\t}\n\t\t})();\n\t\tif (checkResult !== \"OK\") {\n\t\t\terrorCallback(checkResult);\n\t\t\treturn false;\n\t\t}\n\n\t\ttry {\n\t\t\txhr = new XMLHttpRequest();\n\t\t} catch (e) {\n\t\t\terrorCallback(e.message);\n\t\t\treturn false;\n\t\t}\n\n\t\txhr.open(type, url);\n\n\t\txhr.setRequestHeader(\"Content-Type\",\"text/plain\");\n\t\txhr.onreadystatechange = function() {\n\t\t\tif (xhr.readyState === 4) {\n\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\tcallback(xhr.responseText);\n\t\t\t\t} else {\n\t\t\t\t\terrorCallbailed(\"\u901a\u4fe1\u5931\u6557 : status code-\" + xhr.status);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\txhr.send(data);\n\t}\n};\n```\n\n\u3053\u308c\u306b\u5bfe\u3057\u3066jasmine\u3067\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u3068\u3053\u3046\u306a\u308b\n\n\n```js:communication.js\ndescribe(\"connectAsync\", function() {\n        var communication = Communication();\n        \n        it(\"GET\", function() {\n            var flag = false;\n            var callback = {\n                  success:function(data) {\n                            flag = true;\n                  }\n            };\n            communication.errorCallback = function(){\n                flag = true;\n            };\n            spyOn(callback, \"success\").andCallThrough();\n            communication.connectAsync(\"GET\", \"http://google.com/\", callback.success, null);\n            \n            waitsFor(function() {\n                return flag;\n            });\n            runs(function() {\n                expect(callback.success).toHaveBeenCalled();\n            });\n        });\n    });\n```\n\n\u901a\u4fe1\u304c\u6210\u529f\u3057\u3066\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u308b\u304b\u8abf\u3079\u305f\u304b\u3063\u305f\u306e\u3067\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306b\u5bfe\u3057\u3066spy\u3092\u4f7f\u7528\n\nwaitFor\u3067\u30d5\u30e9\u30b0\u3092\u5f85\u3064\u3002\n\n\u30a8\u30e9\u30fc\u3068\u6210\u529f\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u5185\u3067\u30d5\u30e9\u30b0\u3092ON\u306b\u3057\u3066\u3001\n\u6210\u529f\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3002\njQuery\u306eajax\u30e1\u30bd\u30c3\u30c9\u3067\u3082\u540c\u3058\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067\u51fa\u6765\u308b\u306f\u305a\u3002\n\n\u30b9\u30d1\u30a4\u3092On\u306b\u3059\u308b\u969b\u306b andCallThrough(); \u3068\u3057\u306a\u3044\u3068\u3001\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u304cspy\u306e\u95a2\u6570\u306b\u66f8\u304d\u63db\u308f\u3063\u3066\u3057\u307e\u3044\u3001\u30d5\u30e9\u30b0\u304cOn\u306b\u306a\u3089\u305a\u3001\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u901a\u3089\u306a\u3044\u3002\nandCallThrough();\u3068\u3059\u308b\u3053\u3068\u3067\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u304c\u547c\u3070\u308c\u305f\u969b\u306b\u672c\u6765\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3082\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\n\n\u50d5\u306f\u3053\u3053\u3067\u30cf\u30de\u3063\u3066\u3057\u307e\u3063\u305f\u3002\n\njasmine\u3067\u306e\u975e\u540c\u671f\u901a\u4fe1\uff0b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u4f8b\u304c\u306a\u304b\u306a\u304b\u898b\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u3093\u3060\u304c\u306a\u305c\u3060\u308d\u3046\u3002\n"}