{"tags": ["Drupal8", "\u5165\u9580"], "context": "\n\nDrupal\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u3064\u3044\u3066\u306e\u8cc7\u6599\n\u3053\u3053\u306e\u56f3\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u306a\u3093\u3068\u306a\u304f\u3002\u3002\u3002\n\nrenderviz: tool visualizing Drupal 8's render tree\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3064\u3044\u3066\n\nCacheability of render arrays\n\nDrupal8\u3067\u8ffd\u52a0\u3055\u308c\u305f\u306b\u300cDynamic Page Cache\u300d\u3064\u3044\u3066\u306e\u8aac\u660e\n\nhttps://www.drupal.org/documentation/modules/dynamic_page_cache\n\nRender API\n\nhttps://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/theme_render/8.1.x\n\n\nContext\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u306f\nurl\u3084user\u306a\u3069\u3001\u6587\u8108(\u76f4\u8a33\u3060\u3068)\u306b\u5fdc\u3058\u305f\u30ad\u30e3\u30c3\u30b7\u30e5(\u30ad\u30fc?)\u306e\u4e8b\n\nCache contexts\n\n\nContexts are automatically replaced with the value for the current request (e.g. the current language) and combined with the keys to form a cache ID. The cache contexts, tags, and max-age will be propagated up the render array hierarchy to determine cacheability for containing render array sections.\n\n\u53c2\u7167\uff1aCore\\Cache\\Context\\CacheContextInterface\n\u53c2\u7167\uff1aCore\\Cache\\Context\\UserCacheContext\nPHPStorm\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001CacheContextInterface\u3092\u958b\u3044\u3066\u3001Subtypes Hierarchy\u3067\u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308b\u306e\u304b\u78ba\u8a8d\u51fa\u6765\u308b\n(Type Hierarchy \u2192 Subtypes Hierarchy.)\n\u305f\u3068\u3048\u3070\u3001user\u5225\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u305f\u3081\u306e\u30ad\u30fc\u306fUserCacheContext\u3092\u78ba\u8a8d\u3059\u308b\u3068\n\nCache context ID: 'user'.\n\u3068\u306a\u3063\u3066\u3044\u308b\n\n\n\u305d\u306e\u4ed6\u3001core\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30ad\u30fc\u306e\u4f8b\n\nsite : \u30b5\u30a4\u30c8\u5168\u4f53\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\nurl.query_args : \u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u542b\u3081\u305furl(\u30da\u30fc\u30b8\u30e3\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3053\u308c\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b)\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\nuser.permission : \u30e6\u30fc\u30b6\u306e\u6a29\u9650\u3054\u3068\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\n\u306a\u3069\n\n\u72ec\u81ea\u306b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30ad\u30fc\u3092\u4f5c\u308b\u3053\u3068\u3082\u53ef\u80fd\uff1f\n\nTIPS\n\n\nTIPS. \u7279\u5b9a\u306e\u30d6\u30ed\u30c3\u30af\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b(\u304a\u305d\u3089\u304f\u30d0\u30c3\u30c9\u30ce\u30a6\u30cf\u30a6)\n\u4f8b\uff1a\u30e9\u30d9\u30eb\u3067\u5224\u5b9a\u3057\u3066\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b'url'\u3092\u8ffd\u52a0\u3059\u308b\n\nmymodule.module.php\nfunction mymodule_block_build_alter(array &$build, \\Drupal\\Core\\Block\\BlockPluginInterface $block)\n{\n    /**\n     * \u4f8b\u3067\u306f\u30d6\u30ed\u30c3\u30af\u306e\"\u30e9\u30d9\u30eb\"\u3067\u5224\u5b9a\u3057\u3066\u3044\u308b\u304c\u3001\u7ba1\u7406\u753b\u9762\u4e0a\u304b\u3089\u5909\u66f4\u53ef\u80fd\u306a\u90e8\u5206\u306a\u306e\u3067\u5371\u967a\n     * core/modules/block/block.api.php\n     * https://api.drupal.org/comment/60564\n     */\n    if ($block->getConfiguration()['label'] === 'xxxxxx') {\n        $build['#cache']['contexts'][] = 'url';\n    }\n}\n\n\n## Drupal\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u306b\u3064\u3044\u3066\u306e\u8cc7\u6599\n\n\u3053\u3053\u306e\u56f3\u3067\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30a4\u30e1\u30fc\u30b8\u304c\u306a\u3093\u3068\u306a\u304f\u3002\u3002\u3002\n\n- [renderviz: tool visualizing Drupal 8's render tree](http://wimleers.com/blog/renderviz-prototype)\n\n\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3064\u3044\u3066\n\n- [Cacheability of render arrays](https://www.drupal.org/developing/api/8/render/arrays/cacheability)\n\nDrupal8\u3067\u8ffd\u52a0\u3055\u308c\u305f\u306b\u300cDynamic Page Cache\u300d\u3064\u3044\u3066\u306e\u8aac\u660e\n\n- https://www.drupal.org/documentation/modules/dynamic_page_cache\n\nRender API\n\n- https://api.drupal.org/api/drupal/core%21lib%21Drupal%21Core%21Render%21theme.api.php/group/theme_render/8.1.x\n\n### Context\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u306f\n\nurl\u3084user\u306a\u3069\u3001\u6587\u8108(\u76f4\u8a33\u3060\u3068)\u306b\u5fdc\u3058\u305f\u30ad\u30e3\u30c3\u30b7\u30e5(\u30ad\u30fc?)\u306e\u4e8b\n\n- [Cache contexts](https://www.drupal.org/developing/api/8/cache/contexts)\n\n> Contexts are automatically replaced with the value for the current request (e.g. the current language) and combined with the keys to form a cache ID. The cache contexts, tags, and max-age will be propagated up the render array hierarchy to determine cacheability for containing render array sections.\n\n\u53c2\u7167\uff1aCore\\Cache\\Context\\CacheContextInterface\n\u53c2\u7167\uff1aCore\\Cache\\Context\\UserCacheContext\n\nPHPStorm\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001CacheContextInterface\u3092\u958b\u3044\u3066\u3001Subtypes Hierarchy\u3067\u3069\u3093\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308b\u306e\u304b\u78ba\u8a8d\u51fa\u6765\u308b\n(Type Hierarchy \u2192 Subtypes Hierarchy.)\n\n\u305f\u3068\u3048\u3070\u3001user\u5225\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u305f\u3081\u306e\u30ad\u30fc\u306fUserCacheContext\u3092\u78ba\u8a8d\u3059\u308b\u3068\n> Cache context ID: 'user'.\n\u3068\u306a\u3063\u3066\u3044\u308b\n\n#### \u305d\u306e\u4ed6\u3001core\u306b\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30ad\u30fc\u306e\u4f8b\n- site : \u30b5\u30a4\u30c8\u5168\u4f53\u3067\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\n- url.query_args : \u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u542b\u3081\u305furl(\u30da\u30fc\u30b8\u30e3\u30fc\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3053\u308c\u3092\u4f7f\u7528\u3057\u3066\u3044\u308b)\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\n- user.permission : \u30e6\u30fc\u30b6\u306e\u6a29\u9650\u3054\u3068\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\n\u306a\u3069\n\n\u72ec\u81ea\u306b\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30ad\u30fc\u3092\u4f5c\u308b\u3053\u3068\u3082\u53ef\u80fd\uff1f\n## **TIPS**\n\n### **TIPS.** \u7279\u5b9a\u306e\u30d6\u30ed\u30c3\u30af\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b(\u304a\u305d\u3089\u304f\u30d0\u30c3\u30c9\u30ce\u30a6\u30cf\u30a6)\n\n\u4f8b\uff1a\u30e9\u30d9\u30eb\u3067\u5224\u5b9a\u3057\u3066\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b'url'\u3092\u8ffd\u52a0\u3059\u308b\n\n```mymodule.module.php\nfunction mymodule_block_build_alter(array &$build, \\Drupal\\Core\\Block\\BlockPluginInterface $block)\n{\n    /**\n     * \u4f8b\u3067\u306f\u30d6\u30ed\u30c3\u30af\u306e\"\u30e9\u30d9\u30eb\"\u3067\u5224\u5b9a\u3057\u3066\u3044\u308b\u304c\u3001\u7ba1\u7406\u753b\u9762\u4e0a\u304b\u3089\u5909\u66f4\u53ef\u80fd\u306a\u90e8\u5206\u306a\u306e\u3067\u5371\u967a\n     * core/modules/block/block.api.php\n     * https://api.drupal.org/comment/60564\n     */\n    if ($block->getConfiguration()['label'] === 'xxxxxx') {\n        $build['#cache']['contexts'][] = 'url';\n    }\n}\n```\n"}