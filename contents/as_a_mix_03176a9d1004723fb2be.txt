{"context": " More than 1 year has passed since last update.\u4ee5\u4e0b\u306e\u30b7\u30a7\u30eb\u3092CRON\u3067\u5b9a\u671f\u5b9f\u884c\n\ncustom_metrics.sh\n#!/bin/zsh\n\nexport AWS_CREDENTIAL_FILE=`dirname $0`/credential\nexport AWS_CLOUDWATCH_HOME=/opt/aws/apitools/mon\nexport PATH=/opt/aws/bin:$PATH\nexport JAVA_HOME=/usr/lib/jvm/jre\n\n# get ec2 instance id\ninstanceid=`wget -q -O - http://169.254.169.254/latest/meta-data/instance-id`\n\nmemtotal=`free | grep 'Mem' | tr -s ' ' | cut -d ' ' -f 2`\nmemfree=`free | grep 'buffers/cache' | tr -s ' ' | cut -d ' ' -f 4`\nlet \"memused=100-(memfree*100/memtotal)\"\nswapmemused=`free |grep Swap:|awk '{print $3}'`\nloadave1=`uptime | tr -s ' ' | cut -d ' ' -f 9 | cut -d ',' -f 1`\nsteal=`vmstat | tail -1 | tr -s ' ' | cut -d ' ' -f 18`\n\nmon-put-data --metric-name \"SwapMemory\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$swapmemused\" --unit \"Bytes\" --region ap-northeast-1\nmon-put-data --metric-name \"FreeMemory\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$memfree\" --unit \"Bytes\" --region ap-northeast-1\nmon-put-data --metric-name \"UsedMemoryPercent\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$memused\" --unit \"Percent\" --region ap-northeast-1\nmon-put-data --metric-name \"LoadAverage\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$loadave1\" --unit \"Count\" --region ap-northeast-1\nmon-put-data --metric-name \"Steal\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$steal\" --unit \"Percent\" --region ap-northeast-1\n\n\n\uff0aPath\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\n\u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\nhttp://dev.classmethod.jp/cloud/cloudwatch-custom-metrics-vmstat-free-uptime/\n\u4ee5\u4e0b\u306e\u30b7\u30a7\u30eb\u3092CRON\u3067\u5b9a\u671f\u5b9f\u884c\n\n```custom_metrics.sh\n#!/bin/zsh\n\nexport AWS_CREDENTIAL_FILE=`dirname $0`/credential\nexport AWS_CLOUDWATCH_HOME=/opt/aws/apitools/mon\nexport PATH=/opt/aws/bin:$PATH\nexport JAVA_HOME=/usr/lib/jvm/jre\n\n# get ec2 instance id\ninstanceid=`wget -q -O - http://169.254.169.254/latest/meta-data/instance-id`\n\nmemtotal=`free | grep 'Mem' | tr -s ' ' | cut -d ' ' -f 2`\nmemfree=`free | grep 'buffers/cache' | tr -s ' ' | cut -d ' ' -f 4`\nlet \"memused=100-(memfree*100/memtotal)\"\nswapmemused=`free |grep Swap:|awk '{print $3}'`\nloadave1=`uptime | tr -s ' ' | cut -d ' ' -f 9 | cut -d ',' -f 1`\nsteal=`vmstat | tail -1 | tr -s ' ' | cut -d ' ' -f 18`\n\nmon-put-data --metric-name \"SwapMemory\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$swapmemused\" --unit \"Bytes\" --region ap-northeast-1\nmon-put-data --metric-name \"FreeMemory\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$memfree\" --unit \"Bytes\" --region ap-northeast-1\nmon-put-data --metric-name \"UsedMemoryPercent\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$memused\" --unit \"Percent\" --region ap-northeast-1\nmon-put-data --metric-name \"LoadAverage\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$loadave1\" --unit \"Count\" --region ap-northeast-1\nmon-put-data --metric-name \"Steal\" --namespace \"DP/App\" --dimensions \"InstanceId=$instanceid\" --value \"$steal\" --unit \"Percent\" --region ap-northeast-1\n```\n\n\uff0aPath\u306f\u5404\u81ea\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\n\n\u53c2\u8003\u306b\u3057\u305f\u8a18\u4e8b\nhttp://dev.classmethod.jp/cloud/cloudwatch-custom-metrics-vmstat-free-uptime/", "tags": ["EC2", "CloudWatch", "AWS"]}