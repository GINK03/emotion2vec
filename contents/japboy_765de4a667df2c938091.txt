{"context": " More than 1 year has passed since last update.\u6628\u65e5\u3001\u300c\u30d7\u30ed\u30df\u30b9\u51e6\u7406\u306e\u30e9\u30c3\u30d1\u30fc\u3092\u3064\u304f\u308b\u300d\u3068\u3044\u3046\u8a18\u4e8b\u3092\u66f8\u3044\u305f\u52d5\u6a5f\u4ed8\u3051\u304c\u3001\u4eca\u65e5\u306e\u8a18\u4e8b\u3002\n\ntl;dr\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u3001JavaScript \u5074\u304b\u3089 Modernizr \u633f\u5165\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3057\u3066\u3001\u66f4\u306b Modernizr.load \u6a5f\u80fd\u3067\u5fc5\u8981\u306a\u4e92\u63db\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u633f\u5165\u3059\u308b\u30d5\u30ed\u30fc\u3092\u5b9f\u88c5\u3057\u305f\u304b\u3063\u305f\u3002\nscripts =\n  # \u4e00\u756a\u6700\u521d\u306b\u633f\u5165\u3055\u308c\u308b `<script>` \u306e\u914d\u5217\n  modernizr: [ '/js/vendor/modernizr.custom.js' ]\n  # `Modernizr.load` \u3067\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u633f\u5165\u3055\u308c\u308b `<script>`\n  polyfills: [\n    test: (M) -> M.json\n    nope: '//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js'\n  ,\n    test: (M) -> M.ie8compat\n    yep: '//cdnjs.cloudflare.com/ajax/libs/aight/1.2.2/aight.min.js'\n  ,\n     test: -> !global.console\n     yep: '//cdnjs.cloudflare.com/ajax/libs/loglevel/1.4.0/loglevel.min.js'\n  ]\n\n# Modernizr \u306e\u633f\u5165\nscriptsInjected scripts.modernizr\n.then ->\n  # `Modernizr.load` \u306e\u5b9f\u884c\n  modernized scripts.polyfills\n.then ->\n  # \u30e1\u30a4\u30f3\u51e6\u7406\n\n\u3053\u306e\u70ba\u306b 2 \u3064\u95a2\u6570\u3092\u4f5c\u6210\u3057\u305f\u3002\nscriptsInjected \u5185\u90e8\u306e loaded \u95a2\u6570\u3001modernized \u5185\u90e8\u306e completed \u95a2\u6570\u3092 Promise \u5316\u3059\u308b\u306e\u306b\u3001promisify \u95a2\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002\n\u203b \u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n// Underscore.js\u3001jQuery \u3068 Modernizr \u304c\u5fc5\u8981\u3002\n\n/**\n * scriptInjected\n */\nvar scriptsInjected = function (urls) {\n  var selector = 'script', fjs = document.getElementsByTagName(selector)[0];\n  var loaded = promisify(function (resolve, reject, url) {\n    var js = document.createElement(selector); js.src = url;\n    if (js.addEventListener) {\n      js.addEventListener('load', resolve, false);\n      js.addEventListener('error', reject, false);\n      fjs.parentNode.insertBefore(js, fjs);\n    } else {\n      // MSIE8 \u4ee5\u4e0b\u304c `onload` \u62fe\u3048\u306a\u3044\u306e\u3067\u3002\n      $.getScript(url).then(resolve, reject);\n    }\n  });\n  return all(_.map(urls, loaded));\n};\n\n/**\n * modernized\n */\n var modernized = function (tests) {\n  var M = window.Modernizr, len = tests.length;\n  var completed = promisify(function (resolve, reject) {   \n    var loads = _.map(tests, function (test, idx) {\n      test.test = test.test(M);\n      if (idx === len - 1) test.complete = resolve;\n      return test;\n    });\n    M.load(loads);\n  });\n  return completed();\n};\n\n\u3061\u306a\u307f\u306b\u4e0a\u8a18\u95a2\u6570\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b promisified  \u3068 all \u95a2\u6570\u306f\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u304c\u3001promisify \u3092\u7528\u3044\u3066\u5024\u3092 Promise \u306b\u3057\u3066\u8fd4\u3059\u95a2\u6570\u3068\u3001\u8907\u6570\u306e Promise \u540c\u671f\u3059\u308b $.when \u306e\u30b7\u30e7\u30fc\u30c8\u30cf\u30f3\u30c9\u3002\n// Underscore.js \u304c\u5fc5\u8981\u3002\n\n/**\n * promisified\n */\nvar promisified = promisify(function (resolve, reject, val) {\n  if (_.isObject(val) && val instanceof Error) return reject(val);\n  resolve(val);\n});\n\n/**\n * all\n * \u3053\u308c\u306f\u5358\u306b `$.when` \u306e\u30e9\u30c3\u30d1\u30fc\n */\nvar all = function () {\n  var args = _.toArray(arguments), promises = _.isArray(args[0]) ? args[0] : args;\n  return $.when.apply(undefined, promises);\n};\n\n\n\u95a2\u5fc3\u306e\u5206\u96e2\n\u4e00\u9023\u306e\u5b9f\u88c5\u52d5\u6a5f\u306f\u3001Underscore.js \u3068 jQuery \u3060\u3051\u3067\u3001ES5 \u306b\u6e80\u305f\u306a\u3044\u74b0\u5883\u3067\u3082\u52d5\u4f5c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u6765\u305f\u3002\ngulp.js \u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3057\u3066\u3001\u7d30\u304b\u3044\u51e6\u7406\u3092\u6ca2\u5c71\u66f8\u3044\u3066\u3044\u3066\u3001Promise \u7cfb\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 JS \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5206\u3051\u3066\u3044\u305f\u3002\u4e0a\u8a18\u306e scriptsInjected \u3068 modernized \u95a2\u6570\u3082\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 JS \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u305f\u304c\u3001\u6a5f\u80fd\u7684\u306b Promise \u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u3002\n\u4e0a\u8a18\u95a2\u6570\u5185\u90e8\u3067\u3001\u76f4\u63a5 Deferred \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3092\u66f8\u3044\u305f\u65b9\u304c\u5358\u7d14\u306a\u3093\u3060\u3051\u3069\u3001\u3059\u3054\u304f\u5197\u9577\u3067\u3001\u5f8c\u3067 Promise \u56de\u308a\u3092\u4fee\u6b63\u3059\u308b\u304b\u3082\u77e5\u308c\u306a\u3044\u3068\u601d\u3046\u3068\u3001Promise \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u4e00\u7b87\u6240\u306b\u96c6\u7d04\u3057\u305f\u304b\u3063\u305f\u3002\n\u5f8c\u3001Modernizr \u306f\u30bf\u30b9\u30af\u30e9\u30f3\u30ca\u30fc\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3059\u308b\u6642\u3001\u5358\u7d14\u306b require \u3060\u3068\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u308a\u3001\u3053\u306e\u624b\u306e\u624b\u6cd5\u3068\u76f8\u6027\u304c\u60aa\u304f\u3066\u3001\u81ea\u5206\u306a\u308a\u306e\u843d\u3068\u3057\u3069\u3053\u308d\u3092\u898b\u3064\u3051\u305f\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001\u3053\u306e\u624b\u6cd5\u306f\u3057\u3063\u304f\u308a\u304d\u305f\u3002\u3053\u308c\u3067 JS \u306e\u51e6\u7406\u30d5\u30ed\u30fc\u306f\u5168\u90e8 JS \u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n\u3059\u3063\u304d\u308a\u3002\n\n\u6628\u65e5\u3001\u300c[\u30d7\u30ed\u30df\u30b9\u51e6\u7406\u306e\u30e9\u30c3\u30d1\u30fc\u3092\u3064\u304f\u308b](http://qiita.com/japboy/items/74fa0cb93baa6466e505)\u300d\u3068\u3044\u3046\u8a18\u4e8b\u3092\u66f8\u3044\u305f\u52d5\u6a5f\u4ed8\u3051\u304c\u3001\u4eca\u65e5\u306e\u8a18\u4e8b\u3002\n\n\n# tl;dr\n\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u3001JavaScript \u5074\u304b\u3089 [Modernizr](http://modernizr.com/) \u633f\u5165\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3057\u3066\u3001\u66f4\u306b `Modernizr.load` \u6a5f\u80fd\u3067\u5fc5\u8981\u306a\u4e92\u63db\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u633f\u5165\u3059\u308b\u30d5\u30ed\u30fc\u3092\u5b9f\u88c5\u3057\u305f\u304b\u3063\u305f\u3002\n\n```coffeescript\nscripts =\n  # \u4e00\u756a\u6700\u521d\u306b\u633f\u5165\u3055\u308c\u308b `<script>` \u306e\u914d\u5217\n  modernizr: [ '/js/vendor/modernizr.custom.js' ]\n  # `Modernizr.load` \u3067\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u633f\u5165\u3055\u308c\u308b `<script>`\n  polyfills: [\n    test: (M) -> M.json\n    nope: '//cdnjs.cloudflare.com/ajax/libs/json3/3.3.2/json3.min.js'\n  ,\n    test: (M) -> M.ie8compat\n    yep: '//cdnjs.cloudflare.com/ajax/libs/aight/1.2.2/aight.min.js'\n  ,\n  \t test: -> !global.console\n  \t yep: '//cdnjs.cloudflare.com/ajax/libs/loglevel/1.4.0/loglevel.min.js'\n  ]\n\n# Modernizr \u306e\u633f\u5165\nscriptsInjected scripts.modernizr\n.then ->\n  # `Modernizr.load` \u306e\u5b9f\u884c\n  modernized scripts.polyfills\n.then ->\n  # \u30e1\u30a4\u30f3\u51e6\u7406\n```\n\n\u3053\u306e\u70ba\u306b 2 \u3064\u95a2\u6570\u3092\u4f5c\u6210\u3057\u305f\u3002\n\n`scriptsInjected` \u5185\u90e8\u306e `loaded` \u95a2\u6570\u3001`modernized` \u5185\u90e8\u306e `completed` \u95a2\u6570\u3092 Promise \u5316\u3059\u308b\u306e\u306b\u3001`promisify` \u95a2\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u3002\n\n**\u203b \u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002**\n\n```javascript\n// Underscore.js\u3001jQuery \u3068 Modernizr \u304c\u5fc5\u8981\u3002\n\n/**\n * scriptInjected\n */\nvar scriptsInjected = function (urls) {\n  var selector = 'script', fjs = document.getElementsByTagName(selector)[0];\n  var loaded = promisify(function (resolve, reject, url) {\n    var js = document.createElement(selector); js.src = url;\n    if (js.addEventListener) {\n      js.addEventListener('load', resolve, false);\n      js.addEventListener('error', reject, false);\n      fjs.parentNode.insertBefore(js, fjs);\n    } else {\n      // MSIE8 \u4ee5\u4e0b\u304c `onload` \u62fe\u3048\u306a\u3044\u306e\u3067\u3002\n      $.getScript(url).then(resolve, reject);\n    }\n  });\n  return all(_.map(urls, loaded));\n};\n\n/**\n * modernized\n */\n var modernized = function (tests) {\n  var M = window.Modernizr, len = tests.length;\n  var completed = promisify(function (resolve, reject) {   \n    var loads = _.map(tests, function (test, idx) {\n      test.test = test.test(M);\n      if (idx === len - 1) test.complete = resolve;\n      return test;\n    });\n    M.load(loads);\n  });\n  return completed();\n};\n```\n\n\u3061\u306a\u307f\u306b\u4e0a\u8a18\u95a2\u6570\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b `promisified`  \u3068 `all` \u95a2\u6570\u306f\u8aac\u660e\u3057\u3066\u3044\u306a\u3044\u304c\u3001`promisify` \u3092\u7528\u3044\u3066\u5024\u3092 Promise \u306b\u3057\u3066\u8fd4\u3059\u95a2\u6570\u3068\u3001\u8907\u6570\u306e Promise \u540c\u671f\u3059\u308b `$.when` \u306e\u30b7\u30e7\u30fc\u30c8\u30cf\u30f3\u30c9\u3002\n\n```javascript\n// Underscore.js \u304c\u5fc5\u8981\u3002\n\n/**\n * promisified\n */\nvar promisified = promisify(function (resolve, reject, val) {\n  if (_.isObject(val) && val instanceof Error) return reject(val);\n  resolve(val);\n});\n\n/**\n * all\n * \u3053\u308c\u306f\u5358\u306b `$.when` \u306e\u30e9\u30c3\u30d1\u30fc\n */\nvar all = function () {\n  var args = _.toArray(arguments), promises = _.isArray(args[0]) ? args[0] : args;\n  return $.when.apply(undefined, promises);\n};\n```\n\n\n# \u95a2\u5fc3\u306e\u5206\u96e2\n\n\u4e00\u9023\u306e\u5b9f\u88c5\u52d5\u6a5f\u306f\u3001[Underscore.js](http://underscorejs.org/) \u3068 [jQuery](https://jquery.com/) \u3060\u3051\u3067\u3001ES5 \u306b\u6e80\u305f\u306a\u3044\u74b0\u5883\u3067\u3082\u52d5\u4f5c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304f\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u6765\u305f\u3002\n\n[gulp.js](http://gulpjs.com/) \u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3057\u3066\u3001\u7d30\u304b\u3044\u51e6\u7406\u3092\u6ca2\u5c71\u66f8\u3044\u3066\u3044\u3066\u3001Promise \u7cfb\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 JS \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5206\u3051\u3066\u3044\u305f\u3002\u4e0a\u8a18\u306e `scriptsInjected` \u3068 `modernized` \u95a2\u6570\u3082\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30a4\u30c9 JS \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u66f8\u3044\u3066\u3044\u305f\u304c\u3001\u6a5f\u80fd\u7684\u306b Promise \u304c\u5fc5\u8981\u306b\u306a\u3063\u305f\u3002\n\n\u4e0a\u8a18\u95a2\u6570\u5185\u90e8\u3067\u3001\u76f4\u63a5 Deferred \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\u3092\u66f8\u3044\u305f\u65b9\u304c\u5358\u7d14\u306a\u3093\u3060\u3051\u3069\u3001\u3059\u3054\u304f\u5197\u9577\u3067\u3001\u5f8c\u3067 Promise \u56de\u308a\u3092\u4fee\u6b63\u3059\u308b\u304b\u3082\u77e5\u308c\u306a\u3044\u3068\u601d\u3046\u3068\u3001Promise \u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u4e00\u7b87\u6240\u306b\u96c6\u7d04\u3057\u305f\u304b\u3063\u305f\u3002\n\n\u5f8c\u3001Modernizr \u306f\u30bf\u30b9\u30af\u30e9\u30f3\u30ca\u30fc\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3059\u308b\u6642\u3001\u5358\u7d14\u306b `require` \u3060\u3068\u52d5\u4f5c\u3057\u306a\u304b\u3063\u305f\u308a\u3001\u3053\u306e\u624b\u306e\u624b\u6cd5\u3068\u76f8\u6027\u304c\u60aa\u304f\u3066\u3001\u81ea\u5206\u306a\u308a\u306e\u843d\u3068\u3057\u3069\u3053\u308d\u3092\u898b\u3064\u3051\u305f\u304b\u3063\u305f\u3093\u3060\u3051\u3069\u3001\u3053\u306e\u624b\u6cd5\u306f\u3057\u3063\u304f\u308a\u304d\u305f\u3002\u3053\u308c\u3067 JS \u306e\u51e6\u7406\u30d5\u30ed\u30fc\u306f\u5168\u90e8 JS \u306b\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n\n\u3059\u3063\u304d\u308a\u3002\n", "tags": ["promise", "modernizr", "JavaScript"]}