{"context": "\n\n\u3084\u308a\u305f\u3044\u30b3\u30de\u30f3\u30c9\n$ docker service create \\\n--name example001 \\\n-p 30001:8080 \n--mount type=volume,src=fs-XXXXXX/example001,dst=/mnt/userdata,volume-driver=efs \\\nnginx:latest\n\n\n\u30aa\u30d7\u30b7\u30e7\u30f3\u30e1\u30e2\n\n\n\nParam\n\u8aac\u660e\n\n\n\n\n--name\n\u30b5\u30fc\u30d3\u30b9\u540d\n\n\n-p\n\u30ce\u30fc\u30c9\u30fb\u30dd\u30fc\u30c8\u3068\u3057\u3066\u30dd\u30fc\u30c8\u3092\u516c\u958b\n\n\n--mount\n\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u3059\u308b\u30de\u30a6\u30f3\u30c8\u3092\u30a2\u30bf\u30c3\u30c1\n\n\n\n\nAPI\u30ea\u30af\u30a8\u30b9\u30c8\nPOST /services/create -d '{\n  \"Name\": \"example001\",\n  \"TaskTemplate\": {\n    \"ContainerSpec\": {\n      \"Image\": \"redis:3.0.6\",\n      \"Mounts\": [{\n        \"Type\": \"volume\",\n        \"Target\": \"/mnt/userdata\",\n        \"Source\": \"fs-XXXXXX/example001\",\n        \"VolumeOptions\": {\n          \"DriverConfig\": {\n            \"Name\": \"efs\"\n          }\n        }\n      }]\n    }\n  },\n  \"EndpointSpec\": {\n    \"Ports\": [\n      {\n        \"Protocol\": \"tcp\",\n        \"PublishedPort\": 30001,\n        \"TargetPort\": 8080\n      }\n    ]\n  }\n}'\n\n\n\u5b9f\u884c\u7d50\u679c\n\u6210\u529f\u3059\u308b\u3068Swarm\u306e\u30b5\u30fc\u30d3\u30b9ID\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\n{\"ID\":\"XXXXXXXXXXXXXXXXXXXXXXXXX\"}\n\n\u30a8\u30e9\u30fc\u306e\u5834\u5408\u306f\u3053\u3046\u3002\uff08\u3059\u3067\u306b\u4f7f\u3063\u3066\u3044\u308bport\u3092\u4f7f\u3063\u305f\uff09\n{\"message\":\"rpc error: code = 3 desc = port '30001' is already in use by service XXXXXXXXXXXXXXXXXXXXXXXXX\"}\n\n\u30b5\u30fc\u30d3\u30b9ID\u304c\u8fd4\u3063\u3066\u304d\u3066\u308b\u306e\u3067\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\nGET /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n{\n  \"ID\": \"XXXXXXXXXXXXXXXXXXXXXXXXX\",\n  \"Version\": {\n    \"Index\": 615\n  },\n  \"CreatedAt\": \"2016-08-17T12:43:11.176565145Z\",\n  \"UpdatedAt\": \"2016-08-17T12:43:11.2277272Z\",\n  \"Spec\": {\n    \"Name\": \"example001\",\n    \"TaskTemplate\": {\n      \"ContainerSpec\": {\n        \"Image\": \"nginx:latest\",\n        \"Mounts\": [\n          {\n            \"Type\": \"volume\",\n            \"Source\": \"fs-XXXXXX/example001\",\n            \"Target\": \"/mnt/userdata\",\n            \"VolumeOptions\": {\n              \"DriverConfig\": {\n                \"Name\": \"efs\"\n              }\n            }\n          }\n        ]\n      }\n    },\n    \"Mode\": {\n      \"Replicated\": {\n        \"Replicas\": 1\n      }\n    },\n    \"EndpointSpec\": {\n      \"Mode\": \"vip\",\n      \"Ports\": [\n        {\n          \"Protocol\": \"tcp\",\n          \"TargetPort\": 8080,\n          \"PublishedPort\": 30001\n        }\n      ]\n    }\n  },\n  \"Endpoint\": {\n    \"Spec\": {\n      \"Mode\": \"vip\",\n      \"Ports\": [\n        {\n          \"Protocol\": \"tcp\",\n          \"TargetPort\": 8080,\n          \"PublishedPort\": 30001\n        }\n      ]\n    },\n    \"Ports\": [\n      {\n        \"Protocol\": \"tcp\",\n        \"TargetPort\": 8080,\n        \"PublishedPort\": 30001\n      }\n    ],\n    \"VirtualIPs\": [\n      {\n        \"NetworkID\": \"XXXXXXXXXXXXX\",\n        \"Addr\": \"10.255.0.15/16\"\n      }\n    ]\n  },\n  \"UpdateStatus\": {\n    \"StartedAt\": \"0001-01-01T00:00:00Z\",\n    \"CompletedAt\": \"0001-01-01T00:00:00Z\"\n  }\n}\n\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u6d88\u3059\nGET\u3058\u3083\u306a\u304f\u3066DELETE\u3059\u308c\u3070OK\nDELETE /services/XXXXXXXXXXXXXXXXXXXXXXXXX\n\n\u623b\u308a\u5024\u306f\u306a\u3057\u3002\nGET /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    58  100    58    0     0    130      0 --:--:-- --:--:-- --:--:--   130\n{\n  \"message\": \"service XXXXXXXXXXXXXXXXXXXXXXXXX not found\"\n}\n\n\u3082\u3046\u4e00\u5ea6GET\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u300c\u305d\u3093\u306a\u30b5\u30fc\u30d3\u30b9\u306d\u30fc\u3088\u300d\u3063\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\nDELETE /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    58  100    58    0     0     99      0 --:--:-- --:--:-- --:--:--   100\n{\n  \"message\": \"service XXXXXXXXXXXXXXXXXXXXXXXXX not found\"\n}\n\nDELETE\u3067\u3082\u540c\u3058\u3067\u3059\u306d\u3002\n\n\u30b5\u30fc\u30d3\u30b9ID\u3058\u3083\u306a\u304f\u3066\u30b5\u30fc\u30d3\u30b9\u540d\u3067\u3082OK\nGET /services/{SERVISE_NAME}\nDELETE /services/{SERVISE_NAME}\n\n\u3067\u3082\u3044\u3051\u307e\u3059\u3002\n\n\n##\u3084\u308a\u305f\u3044\u30b3\u30de\u30f3\u30c9\n\n```\n$ docker service create \\\n--name example001 \\\n-p 30001:8080 \n--mount type=volume,src=fs-XXXXXX/example001,dst=/mnt/userdata,volume-driver=efs \\\nnginx:latest\n```\n\n###\u30aa\u30d7\u30b7\u30e7\u30f3\u30e1\u30e2\n\n|Param|\u8aac\u660e|\n|:--|:--|\n|--name|\u30b5\u30fc\u30d3\u30b9\u540d|\n|-p|\u30ce\u30fc\u30c9\u30fb\u30dd\u30fc\u30c8\u3068\u3057\u3066\u30dd\u30fc\u30c8\u3092\u516c\u958b|\n|--mount|\u30b5\u30fc\u30d3\u30b9\u306b\u5bfe\u3059\u308b\u30de\u30a6\u30f3\u30c8\u3092\u30a2\u30bf\u30c3\u30c1|\n\n\n## API\u30ea\u30af\u30a8\u30b9\u30c8\n\n```\nPOST /services/create -d '{\n  \"Name\": \"example001\",\n  \"TaskTemplate\": {\n    \"ContainerSpec\": {\n      \"Image\": \"redis:3.0.6\",\n      \"Mounts\": [{\n      \t\"Type\": \"volume\",\n      \t\"Target\": \"/mnt/userdata\",\n      \t\"Source\": \"fs-XXXXXX/example001\",\n      \t\"VolumeOptions\": {\n      \t  \"DriverConfig\": {\n      \t  \t\"Name\": \"efs\"\n      \t  }\n      \t}\n      }]\n    }\n  },\n  \"EndpointSpec\": {\n    \"Ports\": [\n      {\n        \"Protocol\": \"tcp\",\n        \"PublishedPort\": 30001,\n        \"TargetPort\": 8080\n      }\n    ]\n  }\n}'\n```\n\n## \u5b9f\u884c\u7d50\u679c\n\n\u6210\u529f\u3059\u308b\u3068Swarm\u306e\u30b5\u30fc\u30d3\u30b9ID\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\n\n```\n{\"ID\":\"XXXXXXXXXXXXXXXXXXXXXXXXX\"}\n```\n\n\u30a8\u30e9\u30fc\u306e\u5834\u5408\u306f\u3053\u3046\u3002\uff08\u3059\u3067\u306b\u4f7f\u3063\u3066\u3044\u308bport\u3092\u4f7f\u3063\u305f\uff09\n\n```\n{\"message\":\"rpc error: code = 3 desc = port '30001' is already in use by service XXXXXXXXXXXXXXXXXXXXXXXXX\"}\n```\n\n\u30b5\u30fc\u30d3\u30b9ID\u304c\u8fd4\u3063\u3066\u304d\u3066\u308b\u306e\u3067\u3001\u30b9\u30c6\u30fc\u30bf\u30b9\u3082\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```\nGET /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n{\n  \"ID\": \"XXXXXXXXXXXXXXXXXXXXXXXXX\",\n  \"Version\": {\n    \"Index\": 615\n  },\n  \"CreatedAt\": \"2016-08-17T12:43:11.176565145Z\",\n  \"UpdatedAt\": \"2016-08-17T12:43:11.2277272Z\",\n  \"Spec\": {\n    \"Name\": \"example001\",\n    \"TaskTemplate\": {\n      \"ContainerSpec\": {\n        \"Image\": \"nginx:latest\",\n        \"Mounts\": [\n          {\n            \"Type\": \"volume\",\n            \"Source\": \"fs-XXXXXX/example001\",\n            \"Target\": \"/mnt/userdata\",\n            \"VolumeOptions\": {\n              \"DriverConfig\": {\n                \"Name\": \"efs\"\n              }\n            }\n          }\n        ]\n      }\n    },\n    \"Mode\": {\n      \"Replicated\": {\n        \"Replicas\": 1\n      }\n    },\n    \"EndpointSpec\": {\n      \"Mode\": \"vip\",\n      \"Ports\": [\n        {\n          \"Protocol\": \"tcp\",\n          \"TargetPort\": 8080,\n          \"PublishedPort\": 30001\n        }\n      ]\n    }\n  },\n  \"Endpoint\": {\n    \"Spec\": {\n      \"Mode\": \"vip\",\n      \"Ports\": [\n        {\n          \"Protocol\": \"tcp\",\n          \"TargetPort\": 8080,\n          \"PublishedPort\": 30001\n        }\n      ]\n    },\n    \"Ports\": [\n      {\n        \"Protocol\": \"tcp\",\n        \"TargetPort\": 8080,\n        \"PublishedPort\": 30001\n      }\n    ],\n    \"VirtualIPs\": [\n      {\n        \"NetworkID\": \"XXXXXXXXXXXXX\",\n        \"Addr\": \"10.255.0.15/16\"\n      }\n    ]\n  },\n  \"UpdateStatus\": {\n    \"StartedAt\": \"0001-01-01T00:00:00Z\",\n    \"CompletedAt\": \"0001-01-01T00:00:00Z\"\n  }\n}\n```\n\n##\u30b5\u30fc\u30d3\u30b9\u3092\u6d88\u3059\n\nGET\u3058\u3083\u306a\u304f\u3066DELETE\u3059\u308c\u3070OK\n\n```\nDELETE /services/XXXXXXXXXXXXXXXXXXXXXXXXX\n```\n\u623b\u308a\u5024\u306f\u306a\u3057\u3002\n\n```\nGET /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    58  100    58    0     0    130      0 --:--:-- --:--:-- --:--:--   130\n{\n  \"message\": \"service XXXXXXXXXXXXXXXXXXXXXXXXX not found\"\n}\n```\n\u3082\u3046\u4e00\u5ea6GET\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u300c\u305d\u3093\u306a\u30b5\u30fc\u30d3\u30b9\u306d\u30fc\u3088\u300d\u3063\u3066\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n```\nDELETE /services/XXXXXXXXXXXXXXXXXXXXXXXXX | jq .\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100    58  100    58    0     0     99      0 --:--:-- --:--:-- --:--:--   100\n{\n  \"message\": \"service XXXXXXXXXXXXXXXXXXXXXXXXX not found\"\n}\n```\nDELETE\u3067\u3082\u540c\u3058\u3067\u3059\u306d\u3002\n\n##\u30b5\u30fc\u30d3\u30b9ID\u3058\u3083\u306a\u304f\u3066\u30b5\u30fc\u30d3\u30b9\u540d\u3067\u3082OK\n```\nGET /services/{SERVISE_NAME}\nDELETE /services/{SERVISE_NAME}\n```\n\u3067\u3082\u3044\u3051\u307e\u3059\u3002\n", "tags": ["docker", "DockerSwarm", "DockerRemoteApi"]}