{"context": " More than 1 year has passed since last update.\n\n\u7d4c\u7def\n\n\u30a2\u30d7\u30ea\u306eURL\u3092\u5909\u66f4\u5f8c\u306bconfig\u306e\u5909\u66f4\u3092\u5fd8\u308c\u3066\u3044\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u3001email\u78ba\u8a8d\u304c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u306e\u306b\u6c17\u3065\u304b\u306a\u304b\u3063\u305f\u3002\n\u4eca\u5f8c\u306f\u30c6\u30b9\u30c8\u3067\u540c\u69d8\u306e\u30df\u30b9\u3092\u7121\u304f\u3057\u305f\u3044\u3002\n\n\n\u624b\u9806\n\nGemfile\n#...\ngem 'rails', '~> 4.2.3'\ngem 'devise', '~> 3.4.1'\n#...\ngroup :test do\n  gem 'rspec-rails'\n  gem 'capybara'\n  gem 'capybara-email'\n  gem 'email_spec'\n  #...\nend\n#...\n\n\n\n/spec/rails_helper.rb\n#...\nrequire 'capybara/email/rspec'\n#...\n\n\n\n/spec/features/user_registration_spec.rb\nrequire 'rails_helper';\n\n# Adopted from http://www.vanderpol.net/2014/10/07/rspec-integration-tests-devise-user-registration/\n\ndescribe 'User registration' do\n  let(:submit) { \"Create my account\" }\n  let(:user_email) { 'registration_test_user@example.org' }\n  let(:user_password) { 'registration_test_password' }\n\n  before :each do\n    visit new_user_registration_path\n\n    fill_in 'user_email', with: user_email\n    fill_in 'user_password', with: user_password\n    fill_in 'user_password_confirmation', with: user_password\n\n    click_button submit\n  end\n\n  it \"shows message about confirmation email\" do\n    expect(page).to have_content(\"A message with a confirmation link has been sent to your email address.\")\n  end\n\n  describe \"confirmation email\" do\n    # Include email_spec modules here, not in rails_helper because they\n    # conflict with the capybara-email#open_email method which lets us\n    # call current_email.click_link below.\n    # Re: https://github.com/dockyard/capybara-email/issues/34#issuecomment-49528389\n    include EmailSpec::Helpers\n    include EmailSpec::Matchers\n\n    # open the most recent email sent to user_email\n    subject { open_email(user_email) }\n\n    # Verify email details\n    it { is_expected.to deliver_to(user_email) }\n    it { is_expected.to have_body_text(/You can confirm your account/) }\n    it { is_expected.to have_body_text(/users\\/confirmation\\?confirmation/) }\n    it { is_expected.to have_subject(/Confirmation instructions/) }\n  end\n\n  context \"when clicking confirmation link in email\" do\n    before do\n      open_email(user_email)\n      current_email.click_link 'Confirm my account'\n    end\n\n    it \"shows confirmation message\" do\n      expect(page).to have_content('successfully confirmed')\n    end\n\n    it \"confirms user\" do\n      user = User.find_for_authentication(email: user_email)\n      expect(user).to be_confirmed\n    end\n  end\nend\n\n\n\n\u53c2\u8003\u8cc7\u6599\n\nhttps://github.com/dockyard/capybara-email\nhttps://github.com/bmabey/email-spec\nhttp://www.vanderpol.net/2014/10/07/rspec-integration-tests-devise-user-registration/\n\n#\u7d4c\u7def\n\n- \u30a2\u30d7\u30ea\u306eURL\u3092\u5909\u66f4\u5f8c\u306bconfig\u306e\u5909\u66f4\u3092\u5fd8\u308c\u3066\u3044\u305f\u306e\u306b\u3082\u95a2\u308f\u3089\u305a\u3001email\u78ba\u8a8d\u304c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u306e\u306b\u6c17\u3065\u304b\u306a\u304b\u3063\u305f\u3002\n- \u4eca\u5f8c\u306f\u30c6\u30b9\u30c8\u3067\u540c\u69d8\u306e\u30df\u30b9\u3092\u7121\u304f\u3057\u305f\u3044\u3002\n\n#\u624b\u9806\n\n```rb:Gemfile\n#...\ngem 'rails', '~> 4.2.3'\ngem 'devise', '~> 3.4.1'\n#...\ngroup :test do\n  gem 'rspec-rails'\n  gem 'capybara'\n  gem 'capybara-email'\n  gem 'email_spec'\n  #...\nend\n#...\n```\n\n```rb:/spec/rails_helper.rb\n#...\nrequire 'capybara/email/rspec'\n#...\n```\n\n```rb:/spec/features/user_registration_spec.rb\nrequire 'rails_helper';\n\n# Adopted from http://www.vanderpol.net/2014/10/07/rspec-integration-tests-devise-user-registration/\n\ndescribe 'User registration' do\n  let(:submit) { \"Create my account\" }\n  let(:user_email) { 'registration_test_user@example.org' }\n  let(:user_password) { 'registration_test_password' }\n\n  before :each do\n    visit new_user_registration_path\n\n    fill_in 'user_email', with: user_email\n    fill_in 'user_password', with: user_password\n    fill_in 'user_password_confirmation', with: user_password\n\n    click_button submit\n  end\n\n  it \"shows message about confirmation email\" do\n    expect(page).to have_content(\"A message with a confirmation link has been sent to your email address.\")\n  end\n\n  describe \"confirmation email\" do\n    # Include email_spec modules here, not in rails_helper because they\n    # conflict with the capybara-email#open_email method which lets us\n    # call current_email.click_link below.\n    # Re: https://github.com/dockyard/capybara-email/issues/34#issuecomment-49528389\n    include EmailSpec::Helpers\n    include EmailSpec::Matchers\n\n    # open the most recent email sent to user_email\n    subject { open_email(user_email) }\n\n    # Verify email details\n    it { is_expected.to deliver_to(user_email) }\n    it { is_expected.to have_body_text(/You can confirm your account/) }\n    it { is_expected.to have_body_text(/users\\/confirmation\\?confirmation/) }\n    it { is_expected.to have_subject(/Confirmation instructions/) }\n  end\n\n  context \"when clicking confirmation link in email\" do\n    before do\n      open_email(user_email)\n      current_email.click_link 'Confirm my account'\n    end\n\n    it \"shows confirmation message\" do\n      expect(page).to have_content('successfully confirmed')\n    end\n\n    it \"confirms user\" do\n      user = User.find_for_authentication(email: user_email)\n      expect(user).to be_confirmed\n    end\n  end\nend\n```\n\n#\u53c2\u8003\u8cc7\u6599\n\n- https://github.com/dockyard/capybara-email\n- https://github.com/bmabey/email-spec\n- http://www.vanderpol.net/2014/10/07/rspec-integration-tests-devise-user-registration/\n", "tags": ["Ruby", "Rails", "devise", "RSpec", "Capybara"]}