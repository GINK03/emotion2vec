{"tags": ["EC2", "aws-sdk", "Ruby"], "context": " More than 1 year has passed since last update.\n\nAWS-SDK Ruby \u3067 EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id / ip address \u3092\u53d6\u5f97\u3059\u308b #aws #ec2 #ruby\n\n \u6982\u8981\nAWS-SDK Ruby \u3067  EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id / ip address  \u3092\u53d6\u5f97\u3057\u307e\u3059\n\n \u76ee\u7684\nVagrant AWS provider \u3067 EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092 tag name \u3067\u6307\u5b9a\u3057\u3066\u3001 vagrant up \u3067 EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u305f\u5f8c\u306b\u3001\n\u5f8c\u7d9a\u306e\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u51e6\u7406\u306b\u5fc5\u8981\u3068\u306a\u308b IP\u30a2\u30c9\u30ec\u30b9\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id \u3092 tag name \u3092\u5143\u306b\u53d6\u5f97\u3057\u305f\u3044\u3002\n\nVagrantfile \u4f8b\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVAGRANTFILE_API_VERSION = \"2\"\n\n$shell =<<-EOS\n# some provisioning logic\nEOS\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"dummy\"\n\n  config.vm.provider :aws do |aws, override|\n    Dotenv.load\n    aws.access_key_id             = ENV['ACCESS_KEY_ID']\n    aws.secret_access_key         = ENV['SECRET_ACCESS_KEY']\n    aws.keypair_name              = ENV['KEY_PAIR_NAME']\n\n    aws.region                    = \"ap-northeast-1\"\n    aws.ami                       = 'ami-858eb884'\n    aws.instance_type             = 't1.micro'\n    aws.security_groups           = 'sample'\n    timestamp = Time.now.strftime('%Y%m%d_%H%M%S')\n    aws.tags = {\n      'Name' => \"vagrant_aws_test_#{timestamp}\",\n    }\n\n    override.ssh.username         = \"core\"\n    override.ssh.private_key_path = \"/path/to/your/key\"\n\n    config.vm.provision :shell, :inline => $shell\n  end\nend\n\n\n \u624b\u9806\n\n Gemfile\n\u8a8d\u8a3c\u306e\u305f\u3081\u306e\u74b0\u5883\u5909\u6570\u306f  dotenv GitHub \u3092\u5229\u7528\u3057\u307e\u3059\nsource \"https://rubygems.org\"\n\ngem \"dotenv\"\ngem \"aws-sdk\"\n\n\n AWS API \u7528\u8a8d\u8a3c\u60c5\u5831\u306e\u53d6\u5f97\n\nAWS Management Console \u306b\u30b5\u30a4\u30f3\u30a4\u30f3\nIAM \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u79fb\u52d5\n\n\u753b\u9762\u30b5\u30d6\u306e [Navigation] \u30da\u30a4\u30f3\u3067 [Users] \u3092\u30af\u30ea\u30c3\u30af\n\n\u5bfe\u8c61\u30e6\u30fc\u30b6\u30fc\u3092\u9078\u629e\n\u753b\u9762\u4e0b\u90e8\u306e Security Credentials \u306e Manage Access Keys \u3092\u9078\u629e\n\u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u4e0b\u90e8\u306b\u3042\u308b [Create Access Key] \u3092\u30af\u30ea\u30c3\u30af\n\u30da\u30fc\u30b8\u306e\u4e0b\u90e8\u306b\u3042\u308b [Download Credentials] \u3092\u30af\u30ea\u30c3\u30af\n\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID \u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092 CSV \u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u306b\u4fdd\u5b58\n\n\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u5b89\u5168\u306a\u5834\u6240\u306b\u4fdd\u5b58\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u518d\u53d6\u5f97\u306f\u4e0d\u53ef\u80fd\n\n\n\n\n .env\nAWS Management Console \u304b\u3089\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092 .env \u306b\u8a2d\u5b9a\u3059\u308b\nACCESS_KEY_ID=your_access_key\nSECRET_ACCESS_KEY=your_secret_key\nEC2_ENDPOINT=your_endpoint\n\n\n read_ec2_instance_id_and_key.rb\nrequire 'aws-sdk'\nrequire 'dotenv'\n\nDotenv.load\nec2 = AWS::EC2.new(\n  access_key_id:     ENV[\"ACCESS_KEY_ID\"],\n  secret_access_key: ENV[\"SECRET_ACCESS_KEY\"],\n  ec2_endpoint:      ENV[\"EC2_ENDPOINT\"]\n)\n\nprint ec2.instances.select { |e|e.tags['Name'] =~ /vagrant/ }\n                   .map { |e| { id: e.id, ip_address: e.ip_address, name: e.tags['Name'] } }\n\n\n \u5b9f\u884c\n$ bundle exec ruby read_ec2_instance_id_and_key.rb\n[{:id=>\"i-some_id\", :ip_address=>\"your_ip_address\", :name=>\"vagrant_aws_test_20141216_224111\"}]\n\n\n \u53c2\u7167\n\n\n aws-sdk GitHub\n\n\n aws-sdk API Document\n\n\n dotenv GitHub\n\n\n# AWS-SDK Ruby \u3067 EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id / ip address \u3092\u53d6\u5f97\u3059\u308b #aws #ec2 #ruby\n## <i class=\"fa fa-cubes\" style=\"font-size:1em;\"></i> \u6982\u8981\nAWS-SDK Ruby \u3067 <i class=\"fa fa-cloud\" style=\"font-size:1em;\"></i> EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id / ip address  \u3092\u53d6\u5f97\u3057\u307e\u3059\n## <i class=\"fa fa-flag-checkered\" style=\"font-size:1em;\"></i> \u76ee\u7684\nVagrant AWS provider \u3067 EC2 \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092 tag name \u3067\u6307\u5b9a\u3057\u3066\u3001 `vagrant up` \u3067 EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u305f\u5f8c\u306b\u3001\n\u5f8c\u7d9a\u306e\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\u51e6\u7406\u306b\u5fc5\u8981\u3068\u306a\u308b IP\u30a2\u30c9\u30ec\u30b9\u30fb\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 id \u3092 tag name \u3092\u5143\u306b\u53d6\u5f97\u3057\u305f\u3044\u3002\n\n### Vagrantfile \u4f8b\n~~~ruby\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVAGRANTFILE_API_VERSION = \"2\"\n\n$shell =<<-EOS\n# some provisioning logic\nEOS\n\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\n  config.vm.box = \"dummy\"\n\n  config.vm.provider :aws do |aws, override|\n    Dotenv.load\n    aws.access_key_id             = ENV['ACCESS_KEY_ID']\n    aws.secret_access_key         = ENV['SECRET_ACCESS_KEY']\n    aws.keypair_name              = ENV['KEY_PAIR_NAME']\n\n    aws.region                    = \"ap-northeast-1\"\n    aws.ami                       = 'ami-858eb884'\n    aws.instance_type             = 't1.micro'\n    aws.security_groups           = 'sample'\n    timestamp = Time.now.strftime('%Y%m%d_%H%M%S')\n    aws.tags = {\n      'Name' => \"vagrant_aws_test_#{timestamp}\",\n    }\n\n    override.ssh.username         = \"core\"\n    override.ssh.private_key_path = \"/path/to/your/key\"\n\n    config.vm.provision :shell, :inline => $shell\n  end\nend\n~~~\n\n## <i class=\"fa fa-files-o\" style=\"font-size:1em;\"></i> \u624b\u9806\n### <i class=\"fa fa-file-text\" style=\"font-size:1em;\"></i> Gemfile\n\u8a8d\u8a3c\u306e\u305f\u3081\u306e\u74b0\u5883\u5909\u6570\u306f <i class=\"fa fa-external-link\" style=\"font-size:1em;\"></i> [dotenv GitHub](https://github.com/bkeepers/dotenv) \u3092\u5229\u7528\u3057\u307e\u3059\n\n~~~ruby\nsource \"https://rubygems.org\"\n\ngem \"dotenv\"\ngem \"aws-sdk\"\n~~~\n\n### <i class=\"fa fa-gears\" style=\"font-size:1em;\"></i> AWS API \u7528\u8a8d\u8a3c\u60c5\u5831\u306e\u53d6\u5f97\n* AWS Management Console \u306b\u30b5\u30a4\u30f3\u30a4\u30f3\n* IAM \u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u79fb\u52d5\n    ![aws1.png](https://qiita-image-store.s3.amazonaws.com/0/43480/865ccf0c-d63a-783c-c18b-b1a4e820a732.png)\n\n* \u753b\u9762\u30b5\u30d6\u306e [Navigation] \u30da\u30a4\u30f3\u3067 [Users] \u3092\u30af\u30ea\u30c3\u30af\n    ![aws2.png](https://qiita-image-store.s3.amazonaws.com/0/43480/46821c0d-dccb-20de-365d-34a0ff2782cf.png)\n\n* \u5bfe\u8c61\u30e6\u30fc\u30b6\u30fc\u3092\u9078\u629e\n* \u753b\u9762\u4e0b\u90e8\u306e Security Credentials \u306e Manage Access Keys \u3092\u9078\u629e\n* \u30c0\u30a4\u30a2\u30ed\u30b0\u306e\u4e0b\u90e8\u306b\u3042\u308b [Create Access Key] \u3092\u30af\u30ea\u30c3\u30af\n* \u30da\u30fc\u30b8\u306e\u4e0b\u90e8\u306b\u3042\u308b [Download Credentials] \u3092\u30af\u30ea\u30c3\u30af\n* \u30a2\u30af\u30bb\u30b9\u30ad\u30fc ID \u3068\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u3092 CSV \u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u306b\u4fdd\u5b58\n    * \u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u5b89\u5168\u306a\u5834\u6240\u306b\u4fdd\u5b58\n    * \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\u306e\u518d\u53d6\u5f97\u306f\u4e0d\u53ef\u80fd\n\n### <i class=\"fa fa-gears\" style=\"font-size:1em;\"></i> .env\nAWS Management Console \u304b\u3089\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092 .env \u306b\u8a2d\u5b9a\u3059\u308b\n\n~~~\nACCESS_KEY_ID=your_access_key\nSECRET_ACCESS_KEY=your_secret_key\nEC2_ENDPOINT=your_endpoint\n~~~\n\n### <i class=\"fa fa-code\" style=\"font-size:1em;\"></i> read_ec2_instance_id_and_key.rb\n\n~~~ruby\nrequire 'aws-sdk'\nrequire 'dotenv'\n\nDotenv.load\nec2 = AWS::EC2.new(\n  access_key_id:     ENV[\"ACCESS_KEY_ID\"],\n  secret_access_key: ENV[\"SECRET_ACCESS_KEY\"],\n  ec2_endpoint:      ENV[\"EC2_ENDPOINT\"]\n)\n\nprint ec2.instances.select { |e|e.tags['Name'] =~ /vagrant/ }\n                   .map { |e| { id: e.id, ip_address: e.ip_address, name: e.tags['Name'] } }\n~~~\n\n### <i class=\"fa fa-play\" style=\"font-size:1em;\"></i> \u5b9f\u884c\n\n~~~bash\n$ bundle exec ruby read_ec2_instance_id_and_key.rb\n[{:id=>\"i-some_id\", :ip_address=>\"your_ip_address\", :name=>\"vagrant_aws_test_20141216_224111\"}]\n~~~\n\n## <i class=\"fa fa-arrow-circle-right\" style=\"font-size:1em;\"></i> \u53c2\u7167\n* <i class=\"fa fa-external-link\" style=\"font-size:1em;\"></i> [aws-sdk GitHub](https://github.com/aws/aws-sdk-ruby)\n* <i class=\"fa fa-book\" style=\"font-size:1em;\"></i> [aws-sdk API Document](http://docs.aws.amazon.com/AWSRubySDK/latest/frames.html)\n* <i class=\"fa fa-external-link\" style=\"font-size:1em;\"></i> [dotenv GitHub](https://github.com/bkeepers/dotenv)\n"}