{"context": "\u3053\u306e\u8a18\u4e8b\u306fKVM(Kernel-based Virtual Machine)\u306e\u9006\u5f15\u304dTips\u3067\u3059\u3002 CentOS 6.3\u306eKVM\u3092\u57fa\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nKVM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nCentOS 6.3 64bit\u3092\u6700\u5c0f\u69cb\u6210\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nSELinux\u3092\u5207\u308b\n# setenforce 0\n# vi /etc/sysconfig/selinux\n---\nSELINUX=disabled\n---\n\nFirewall\u3092\u5207\u308b\n# /etc/init.d/iptables stop\n# chkconfig iptables off\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30d6\u30ea\u30c3\u30b8\u306b\u3059\u308b\n# vi /etc/sysconfig/network-scripts/ifcfg-eth0\n---\nDEVICE=eth0\nONBOOT=yes\nBRIDGE=br0\n---\n\n# vi /etc/sysconfig/network-scripts/ifcfg-br0\n---\nDEVICE=br0\nONBOOT=yes\nTYPE=Bridge\nIPADDR=192.168.1.2\nNETMASK=255.255.255.0\nGATEWAY=192.168.1.1\n---\n\n# /etc/init.d/network restart\n# ifconfig eth0 0.0.0.0 promisc up\n\nkvm\u3092yum\u3067\u5165\u308c\u308b\n# yum -y groupinstall \"Virtualization\" \"Virtualization Client\" \"Virtualization Platform\" \"Virtualization Tools\" \"X Window System\"\n\nvirt-manager\u7528\u306b\u65e5\u672c\u8a9efont\u3092\u5165\u308c\u308b\n# yum -y install \"vlgothic-p-fonts\"\n\nmDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u5931\u6557\u306e\u30a8\u30e9\u30fc\u56de\u907f\u306e\u305f\u3081avahi\u3092\u5165\u308c\u308b\n# yum -y install avahi\n# /etc/init.d/messagebus restart\n# /etc/init.d/avahi-daemon restart\n# chkconfig messagebus on\n# chkconfig avahi-daemon on\n# /etc/init.d/libvirtd start\n\nlibvirtd\u306e\u8d77\u52d5\n# /etc/init.d/libvirtd start\n# chkconfig libvirtd on\n\n\nKVM\u306e\u7ba1\u7406\n\nssh\u7d4c\u7531\u3067GUI(virt-manager)\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\nLinux\u4ed8\u5c5e\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3(virt-manager)\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nvirt-manager\u306fX11\u306eGUI\u30a2\u30d7\u30ea\u306a\u306e\u3067\u3001\u30ea\u30e2\u30fc\u30c8\u304b\u3089\u753b\u9762\u3092\u898b\u308b\u305f\u3081\u306b\u306f\u3001\u753b\u9762\u3092\u8ee2\u9001\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067ssh\u306eX11 Forwading\u3068\u3044\u3046\u6a5f\u80fd\u3067\u3001\u753b\u9762\u3092\u30ed\u30fc\u30ab\u30eb\u7aef\u672b\u306b\u8ee2\u9001\u3057\u3066\u3001\u305d\u3053\u3067\u64cd\u4f5c\u3057\u307e\u3059\u3002\n\n\u624b\u9806\n\u30b5\u30fc\u30d0\u5074\u3067sshd\u306e\u8a2d\u5b9a\u3067X11Forwarding yes\u3068\u3057\u3066\u3001X11\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8OS\u306bX11\u30b5\u30fc\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\nWindows\u3067\u3042\u308c\u3070xming\u304c\u304a\u52e7\u3081\nMacOS X\u3067\u3042\u308c\u3070XQuartz\u306a\u3069\u304c\u3042\u308a\u307e\u3059\uff082016/3\u8ffd\u8a18\uff1a\u539f\u56e0\u306f\u5b9a\u304b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u79c1\u306e\u74b0\u5883\u3060\u3068XQuartz\u3067\u306fVirtManager\u304b\u3089\u5165\u529b\u3067\u304d\u306a\u3044\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3042\u308bX11.app\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d\u3001\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\uff09\n\nssh\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3001X11\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3057\u3066\u63a5\u7d9a\u3057\u307e\u3059\n\nputty\u306a\u3089\u3070\u300c\u30e1\u30cb\u30e5\u30fc\u300d\u2192\u300c\u63a5\u7d9a\u300d\u2192\u300cSSH\u300d\u2192\u300cX11\u300d\u2192\u300cX11\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b\u300d\u3092\u30c1\u30a7\u30c3\u30af\u3002\u305d\u306e\u5f8c\u63a5\u7d9a\nteraterm\u306a\u3089\u3070\u300c\u8a2d\u5b9a\u300d\u2192\u300cSSH\u8ee2\u9001\u300d\u2192\u300c\u30ea\u30e2\u30fc\u30c8\u306e(X)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30ed\u30fc\u30ab\u30eb\u306eX\u30b5\u30fc\u30d0\u306b\u8868\u793a\u3059\u308b\u300d\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3002\u518d\u5ea6teraterm\u3092\u7acb\u3061\u4e0a\u3052\u308b\u5fc5\u8981\u3042\u308a\u3002\u305d\u306e\u5f8cSSH\u63a5\u7d9a\nOpenSSH\u3067\u3042\u308c\u3070\u3000ssh -X root@(KVM\u30db\u30b9\u30c8)\u3068-X\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u63a5\u7d9a\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3089\u300cvirt-manager\u300d\u3068\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3066\u3070\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n# virt-manager\n\n\n\u500b\u5225\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u753b\u9762\u3060\u3051\u3092\u898b\u305f\u3044\u3068\u304d\u306f\n# virt-viewer \u4eee\u60f3\u30de\u30b7\u30f3\u540d\n\n\n\u6ce8\u610f\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b alt\uff0bctrl\u304c\u52b9\u304b\u306a\u304f\u3066\u30de\u30a6\u30b9\u3092\u51fa\u305b\u306a\u304f\u306a\u308b\u306e\u3067\u3001\n\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b .Xmodmap\u3092\u4f5c\u6210\u3057\u3066\u3001\u4e0b\u306e\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n# vi ~/.Xmodmap\n---\nclear Mod1\nkeycode 66 = Alt_L\nkeycode 69 = Alt_R\nadd Mod1 = Alt_L\nadd Mod1 = Alt_R\n---\n\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089virsh\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\u5834\u5408\u3001Linux\u4ed8\u5c5e\u306evirsh\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\n\n\u8d77\u52d5\u4e2d\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\u8868\u793a\n# virsh list\n\n\n\u5168\u3066\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\u8868\u793a\n# virsh list --all\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u60c5\u5831\n# virsh dominfo (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8d77\u52d5\n# virsh start (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u505c\u6b62\n# virsh shutdown (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5f37\u5236\u505c\u6b62\uff08\u96fb\u6e90OFF)\n# virsh destroy (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u6642\u505c\u6b62\n# virsh suspend (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u6642\u505c\u6b62\u306e\u518d\u958b\n# virsh resume (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4fdd\u5b58(\u30e1\u30e2\u30ea\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059)\n# virsh save (\u4eee\u60f3\u30de\u30b7\u30f3\u540d) (\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u540d)\n\n\n\u4fdd\u5b58\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5fa9\u5143(\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30e1\u30e2\u30ea\u306b\u623b\u3059)\n# virsh restore (\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u540d)\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u69cb\u6210\u5909\u66f4(\u30e1\u30e2\u30ea\u91cf\u5909\u66f4\u306a\u3069)\n\u4eee\u60f3\u30de\u30b7\u30f3\u505c\u6b62\n/etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml \u3092\u5909\u66f4\n\u5909\u66f4\u3092\u53cd\u6620\n# virsh define /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n\u8d77\u52d5\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u8a2d\u5b9a\n\u901a\u5e38\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u306eOS\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u3051\u3066\u3042\u3052\u308b\u3068\u3001\u30db\u30b9\u30c8OS\u304b\u3089virsh console\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304cCentOS 5,6\u306e\u5834\u5408\ngrub\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4(CentOS 5\u7cfb\uff066\u7cfb\u5171\u306b\u5b9f\u65bd\u304c\u5fc5\u8981)\n# vi /etc/grub.conf\n---\nserial --speed=115200 --unit=0 --word=8 --parity=no --stop=1 # \u3053\u306e\u884c\u3092\u8ffd\u52a0\nterminal --timeout=5 serial console # \u3053\u306e\u884c\u3092\u8ffd\u52a0\ntitle CentOS (2.6.18-128.4.1.el5)\n       root (hd0,0)\n       kernel /vmlinuz (\u4e2d\u7565) console=tty0 console=ttyS0,115200n8 # console\u4ee5\u964d\u3092\u8ffd\u52a0\n       initrd /initrd-2.6.18-128.4.1.el5.img\n---\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u7aef\u672b\u3092\u4f5c\u6210 (CentOS 5 \u7cfb\u306e\u307f\u3067\u5fc5\u8981)\n# vi /etc/inittab\n---\nS0:12345:respawn:/sbin/agetty ttyS0 115200 # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n1:2345:respawn:/sbin/mingetty tty1\n---\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089root\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002(CentOS 5 \u7cfb\u306e\u307f\u3067\u5fc5\u8981)\n# vi /etc/securetty\n---\nttyS0 #\u8ffd\u8a18\n---\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304cCentOS 7\u306e\u5834\u5408\nGRUB2\u304b\u3089\u306f\u3001\u76f4\u63a5\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb/boot/grub2/grub.cfg\u3092\u3044\u3058\u308b\u306e\u3067\u306f\u306a\u304f\u3001/etc/default/grub\u3092\u7de8\u96c6\u3057\u305f\u306e\u3061\u3001grub2-mkconfig\u30b3\u30de\u30f3\u30c9\u306b\u3066GRUB2\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3059\u308b\u306e\u304c\u4f5c\u6cd5\uff08\u3053\u3061\u3089\u306e\u30d6\u30ed\u30b0\u304c\u5927\u5909\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\uff09\u3002\n\u306a\u306e\u3067\u307e\u305a\u306f/etc/default/grub\u3092\u7de8\u96c6\u3057\u3001\nGRUB_CMDLINE_LINUX\u306bconsole=tty0 console=ttyS0,115200n8r\u3092\u8ffd\u8a18\u3059\u308b\u3002\nGRUB_TIMEOUT=5\nGRUB_DEFAULT=saved\nGRUB_DISABLE_SUBMENU=true\nGRUB_TERMINAL_OUTPUT=\"console\"\nGRUB_CMDLINE_LINUX=\"rd.lvm.lv=centos_centos70-template/root rd.lvm.lv=centos_cenn\ntos70-template/swap console=tty0 console=ttyS0,115200n8r\"  #\u3053\u3053\u3092\u8ffd\u8a18\nGRUB_DISABLE_RECOVERY=\"true\"\n\n\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001GRUB_CMDLINE_LINUX\u304b\u3089rhgb\u3068 quiet\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u8d77\u52d5\u6642\u306e\u51fa\u529b\u3092\u6291\u6b62\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u306b\u304f\u304f\u306a\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\n\u6b21\u306b\u3001grub2-mkconfig\u30b3\u30de\u30f3\u30c9\u306b\u3066GRUB2\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\n# grub2-mkconfig -o /boot/grub2/grub.cfg\n\n\u3053\u308c\u3067\u30b2\u30b9\u30c8\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308c\u3070\u30aa\u30fc\u30b1\u30fc\u3002\n\n\u30b2\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u63a5\u7d9a\n# virsh console (\u30c9\u30e1\u30a4\u30f3\u540d)\n\n\u203b \u629c\u3051\u308b\u5834\u5408\u306fctrl + ]\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u8d77\u52d5\uff06\u305d\u306e\u307e\u307e\u30b3\u30f3\u30bd\u30fc\u30eb\u63a5\u7d9a\n# virsh start (\u30c9\u30e1\u30a4\u30f3\u540d) --console\n\n\nKVM\u306e\u904b\u7528\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\u57fa\u672c\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u4e8c\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u3070OK\n\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n    /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\n    \u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\u306f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\n    \u901a\u5e38\u306f /var/lib/libvirt/images/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).img\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u306e\u30ea\u30b9\u30c8\u30a2\n\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306a\u5834\u6240(\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3042\u308b\u30d1\u30b9)\u306b\u7f6e\u304f\n    \u901a\u5e38\u306f /var/lib/libvirt/images/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).img\n\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306a\u5834\u6240\u306b\u7f6e\u304f\n    \u901a\u5e38\u306f /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\n# virsh define (\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb)\n\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\nruby\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u4f5c\u3063\u305f\u306e\u3067\u3001\u3082\u3057\u3088\u304b\u3063\u305f\u3089\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u2192KVM\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\n\nVMWare\u306e\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30de\u30b7\u30f3\u3092KVM\u7528\u306b\u5909\u63db\nvmware\u306e\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8(vmdk)\u3092kvm\u306b\u5909\u63db\u3059\u308b\u3068\u304d\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\nqemu-img convert (vmdk\u30d5\u30a1\u30a4\u30eb) -O raw (kvm\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb)\n\n\nKVM\u306eTips\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u60c5\u5831\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb : /etc/libvirt/qemu/xxx.xml\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8 : /var/lib/libvirt/images/xxx.[img|qcow2]\n\n\n\nKVM\u306e\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0(CentOS6\u7cfb)\n\nmDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\n/var/log/libvirt/libvirtd.log\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n2012-07-17 15:47:49.240+0000: 15548: info : libvirt version: 0.9.10,\npackage: 21.el6_3.1 (CentOS BuildSystem ,]\n2012-07-03-16:15:49, c6b8.bsys.dev.centos.org)\n2012-07-17 15:47:49.240+0000: 15548: error : virNetServerMDNSStart:460\n: \u5185\u90e8\u30a8\u30e9\u30fc mDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: Daemon not running\n\n\u5bfe\u5fdc\n# yum -y install avahi\n# /etc/init.d/messagebus restart\n# /etc/init.d/avahi-daemon restart\n# /etc/init.d/libvirtd restart\n# chkconfig messagebus on\n# chkconfig avahi-daemon on\n# chkconfig libvirtd on\n\n\u53c2\u8003\nhttp://quags.net/archives/53\n\n\nvirt-manager\u306e\u65e5\u672c\u8a9efont\u304c\u8868\u793a\u3055\u308c\u306a\u3044\nfont\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\n\u5bfe\u5fdc\n# yum install \"vlgothic-p-fonts\"\n\n\n\u9069\u5207\u306a\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3092\u898b\u3064\u3051\u3089\u308c\u306a\u3044\n/var/log/libvirt/libvirtd.log\u306e\u30a8\u30e9\u30fc\n2012-07-24 01:43:07.595+0000: 2126: error : qemuCapsExtractVersion:1566 : \u5185\u90e8\u30a8\u30e9\u30fc x86_64 \u306e\u9069\u5207\u306a\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3092\u898b\u3064\u3051\u3089\u308c\u307e\u305b\u3093\n\n\u5bfe\u5fdc\n# ln -s /usr/libexec/qemu-kvm /usr/bin/qemu-system-x86_64\n# /etc/init.d/libvirtd restart\n\n\nKVM\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8aad\u307f\u8fbc\u307e\u308c\u306a\u3044\nKVM \u3092\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f KVM \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u307e\u305f\n\u306f\u3001KVM \u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb (kvm.ko) \u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\nQEMU \u304c\u4f7f\u308f\u308c\u308b\u306e\u3067\u52d5\u4f5c\u304c\u9045\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\nwarning: KVM is not available. This may mean the KVM package is not installed, or the KVM kernel modules are not loaded. Your virtual machines my perform poorly\n\n\u4e00\u6642\u7684\u306a\u5bfe\u5fdc\u306f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8aad\u307f\u8fbc\u3081\u3070OK\n# modprobe kvm\n# modprobe kvm-intel\n\n\u518d\u8d77\u52d5\u5f8c\u3082\u8a2d\u5b9a\u3092\u7d99\u7d9a\u3055\u305b\u308b\u5834\u5408\u306f\u3001 /etc/rc.d/rc.sysinit\u306b\u4ee5\u4e0b\u3092\u8a18\u8f09\nmodprobe kvm\nmodprobe kvm-intel\n\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304cKVM\u306e\u5185\u90e8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304b\u3089\u5916\u306b\u51fa\u308c\u306a\u3044\n\u4eee\u60f3\u30de\u30a4\u30f3\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3042\u308b\n\u5bfe\u5fdc\n# ifconfig eth0 0.0.0.0 promisc up\n\n\nvirsh shutdown\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u505c\u6b62\u3057\u306a\u3044\nacpid\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070OK\n# yum install acpid\n\n\u3053\u306e\u8a18\u4e8b\u306fKVM(Kernel-based Virtual Machine)\u306e\u9006\u5f15\u304dTips\u3067\u3059\u3002 CentOS 6.3\u306eKVM\u3092\u57fa\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nKVM\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n==========================================\n\nCentOS 6.3 64bit\u3092\u6700\u5c0f\u69cb\u6210\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n--------------------------------------------\n\nSELinux\u3092\u5207\u308b\n\n    # setenforce 0\n    # vi /etc/sysconfig/selinux\n    ---\n    SELINUX=disabled\n    ---\n\nFirewall\u3092\u5207\u308b\n\n    # /etc/init.d/iptables stop\n    # chkconfig iptables off\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30d6\u30ea\u30c3\u30b8\u306b\u3059\u308b\n\n    # vi /etc/sysconfig/network-scripts/ifcfg-eth0\n    ---\n    DEVICE=eth0\n    ONBOOT=yes\n    BRIDGE=br0\n    ---\n\n    # vi /etc/sysconfig/network-scripts/ifcfg-br0\n    ---\n    DEVICE=br0\n    ONBOOT=yes\n    TYPE=Bridge\n    IPADDR=192.168.1.2\n    NETMASK=255.255.255.0\n    GATEWAY=192.168.1.1\n    ---\n\n    # /etc/init.d/network restart\n    # ifconfig eth0 0.0.0.0 promisc up\n\nkvm\u3092yum\u3067\u5165\u308c\u308b\n\n    # yum -y groupinstall \"Virtualization\" \"Virtualization Client\" \"Virtualization Platform\" \"Virtualization Tools\" \"X Window System\"\n\nvirt-manager\u7528\u306b\u65e5\u672c\u8a9efont\u3092\u5165\u308c\u308b\n\n    # yum -y install \"vlgothic-p-fonts\"\n\nmDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u5931\u6557\u306e\u30a8\u30e9\u30fc\u56de\u907f\u306e\u305f\u3081avahi\u3092\u5165\u308c\u308b\n\n    # yum -y install avahi\n    # /etc/init.d/messagebus restart\n    # /etc/init.d/avahi-daemon restart\n    # chkconfig messagebus on\n    # chkconfig avahi-daemon on\n    # /etc/init.d/libvirtd start\n\nlibvirtd\u306e\u8d77\u52d5\n\n    # /etc/init.d/libvirtd start\n    # chkconfig libvirtd on\n\n\n\n\nKVM\u306e\u7ba1\u7406\n================================\n\n\nssh\u7d4c\u7531\u3067GUI(virt-manager)\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\n-----------------------------------------\n\nLinux\u4ed8\u5c5e\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3(virt-manager)\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nvirt-manager\u306fX11\u306eGUI\u30a2\u30d7\u30ea\u306a\u306e\u3067\u3001\u30ea\u30e2\u30fc\u30c8\u304b\u3089\u753b\u9762\u3092\u898b\u308b\u305f\u3081\u306b\u306f\u3001\u753b\u9762\u3092\u8ee2\u9001\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u3053\u3067ssh\u306eX11 Forwading\u3068\u3044\u3046\u6a5f\u80fd\u3067\u3001\u753b\u9762\u3092\u30ed\u30fc\u30ab\u30eb\u7aef\u672b\u306b\u8ee2\u9001\u3057\u3066\u3001\u305d\u3053\u3067\u64cd\u4f5c\u3057\u307e\u3059\u3002\n\n\n### \u624b\u9806\n\n\u30b5\u30fc\u30d0\u5074\u3067sshd\u306e\u8a2d\u5b9a\u3067`X11Forwarding yes`\u3068\u3057\u3066\u3001X11\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8OS\u306bX11\u30b5\u30fc\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n* Windows\u3067\u3042\u308c\u3070[xming](http://sourceforge.jp/projects/sfnet_xming/)\u304c\u304a\u52e7\u3081\n* MacOS X\u3067\u3042\u308c\u3070[XQuartz](http://xquartz.macosforge.org/landing/)\u306a\u3069\u304c\u3042\u308a\u307e\u3059\uff082016/3\u8ffd\u8a18\uff1a\u539f\u56e0\u306f\u5b9a\u304b\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u79c1\u306e\u74b0\u5883\u3060\u3068XQuartz\u3067\u306fVirtManager\u304b\u3089\u5165\u529b\u3067\u304d\u306a\u3044\u554f\u984c\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u53e4\u3044\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3042\u308bX11.app\u3092\u4f7f\u3063\u305f\u3068\u3053\u308d\u3001\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\uff09\n\nssh\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3001X11\u306e\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3057\u3066\u63a5\u7d9a\u3057\u307e\u3059\n\n* putty\u306a\u3089\u3070\u300c\u30e1\u30cb\u30e5\u30fc\u300d\u2192\u300c\u63a5\u7d9a\u300d\u2192\u300cSSH\u300d\u2192\u300cX11\u300d\u2192\u300cX11\u30d5\u30a9\u30ef\u30fc\u30c7\u30a3\u30f3\u30b0\u3092\u6709\u52b9\u306b\u3059\u308b\u300d\u3092\u30c1\u30a7\u30c3\u30af\u3002\u305d\u306e\u5f8c\u63a5\u7d9a\n* teraterm\u306a\u3089\u3070\u300c\u8a2d\u5b9a\u300d\u2192\u300cSSH\u8ee2\u9001\u300d\u2192\u300c\u30ea\u30e2\u30fc\u30c8\u306e(X)\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30ed\u30fc\u30ab\u30eb\u306eX\u30b5\u30fc\u30d0\u306b\u8868\u793a\u3059\u308b\u300d\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u3001\u8a2d\u5b9a\u3092\u4fdd\u5b58\u3002\u518d\u5ea6teraterm\u3092\u7acb\u3061\u4e0a\u3052\u308b\u5fc5\u8981\u3042\u308a\u3002\u305d\u306e\u5f8cSSH\u63a5\u7d9a\n* OpenSSH\u3067\u3042\u308c\u3070\u3000`ssh -X root@(KVM\u30db\u30b9\u30c8)`\u3068-X\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u63a5\u7d9a\n\n\u30ed\u30b0\u30a4\u30f3\u3057\u305f\u3089\u300cvirt-manager\u300d\u3068\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3066\u3070\u3001\u4eee\u60f3\u30de\u30b7\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\u304c\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    # virt-manager\n\n![snap.png](https://qiita-image-store.s3.amazonaws.com/0/33447/8fe8b2b1-092a-3ac8-4471-0a7a1908c442.png)\n\n\u500b\u5225\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u753b\u9762\u3060\u3051\u3092\u898b\u305f\u3044\u3068\u304d\u306f\n\n    # virt-viewer \u4eee\u60f3\u30de\u30b7\u30f3\u540d\n\n### \u6ce8\u610f\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u3068\u304d\u306b alt\uff0bctrl\u304c\u52b9\u304b\u306a\u304f\u3066\u30de\u30a6\u30b9\u3092\u51fa\u305b\u306a\u304f\u306a\u308b\u306e\u3067\u3001\n\n\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b .Xmodmap\u3092\u4f5c\u6210\u3057\u3066\u3001\u4e0b\u306e\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\n\n    # vi ~/.Xmodmap\n    ---\n    clear Mod1\n    keycode 66 = Alt_L\n    keycode 69 = Alt_R\n    add Mod1 = Alt_L\n    add Mod1 = Alt_R\n    ---\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089virsh\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\n---------------------------------------\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u3067KVM\u3092\u7ba1\u7406\u3059\u308b\u5834\u5408\u3001Linux\u4ed8\u5c5e\u306evirsh\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\n\n### \u8d77\u52d5\u4e2d\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\u8868\u793a\n\n    # virsh list\n\n### \u5168\u3066\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u4e00\u89a7\u8868\u793a\n\n    # virsh list --all\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u60c5\u5831\n\n    # virsh dominfo (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u8d77\u52d5\n\n    # virsh start (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u505c\u6b62\n\n    # virsh shutdown (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5f37\u5236\u505c\u6b62\uff08\u96fb\u6e90OFF)\n\n    # virsh destroy (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u6642\u505c\u6b62\n\n    # virsh suspend (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4e00\u6642\u505c\u6b62\u306e\u518d\u958b\n\n    # virsh resume (\u4eee\u60f3\u30de\u30b7\u30f3\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u4fdd\u5b58(\u30e1\u30e2\u30ea\u3092\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u51fa\u3059)\n\n    # virsh save (\u4eee\u60f3\u30de\u30b7\u30f3\u540d) (\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u540d)\n\n### \u4fdd\u5b58\u3057\u305f\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u5fa9\u5143(\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30e1\u30e2\u30ea\u306b\u623b\u3059)\n\n    # virsh restore (\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u540d)\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u69cb\u6210\u5909\u66f4(\u30e1\u30e2\u30ea\u91cf\u5909\u66f4\u306a\u3069)\n\n    \u4eee\u60f3\u30de\u30b7\u30f3\u505c\u6b62\n    /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml \u3092\u5909\u66f4\n    \u5909\u66f4\u3092\u53cd\u6620\n    # virsh define /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n    \u8d77\u52d5\n\n### \u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u8a2d\u5b9a\n\n\u901a\u5e38\u306e\u4eee\u60f3\u30de\u30b7\u30f3\u3067\u306f\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u3044\u3002\n\u4eee\u60f3\u30de\u30b7\u30f3\u306eOS\u8d77\u52d5\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u3051\u3066\u3042\u3052\u308b\u3068\u3001\u30db\u30b9\u30c8OS\u304b\u3089`virsh console`\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n#### \u4eee\u60f3\u30de\u30b7\u30f3\u304cCentOS 5,6\u306e\u5834\u5408\n\ngrub\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4(CentOS 5\u7cfb\uff066\u7cfb\u5171\u306b\u5b9f\u65bd\u304c\u5fc5\u8981)\n\n    # vi /etc/grub.conf\n    ---\n    serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1 # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n    terminal --timeout=5 serial console # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n    title CentOS (2.6.18-128.4.1.el5)\n           root (hd0,0)\n           kernel /vmlinuz (\u4e2d\u7565) console=tty0 console=ttyS0,115200n8 # console\u4ee5\u964d\u3092\u8ffd\u52a0\n           initrd /initrd-2.6.18-128.4.1.el5.img\n    ---\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u7aef\u672b\u3092\u4f5c\u6210 (CentOS 5 \u7cfb\u306e\u307f\u3067\u5fc5\u8981)\n\n    # vi /etc/inittab\n    ---\n    S0:12345:respawn:/sbin/agetty ttyS0 115200 # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n    1:2345:respawn:/sbin/mingetty tty1\n    ---\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089root\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002(CentOS 5 \u7cfb\u306e\u307f\u3067\u5fc5\u8981)\n\n    # vi /etc/securetty\n    ---\n    ttyS0 #\u8ffd\u8a18\n    ---\n\n#### \u4eee\u60f3\u30de\u30b7\u30f3\u304cCentOS 7\u306e\u5834\u5408\n\nGRUB2\u304b\u3089\u306f\u3001\u76f4\u63a5\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb`/boot/grub2/grub.cfg`\u3092\u3044\u3058\u308b\u306e\u3067\u306f\u306a\u304f\u3001`/etc/default/grub`\u3092\u7de8\u96c6\u3057\u305f\u306e\u3061\u3001`grub2-mkconfig`\u30b3\u30de\u30f3\u30c9\u306b\u3066GRUB2\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3059\u308b\u306e\u304c\u4f5c\u6cd5\uff08\u3053\u3061\u3089\u306e[\u30d6\u30ed\u30b0](http://www.torutk.com/projects/swe/wiki/CentOS_7_KVM%E3%82%B2%E3%82%B9%E3%83%88%E3%81%A8%E3%81%97%E3%81%A6%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB)\u304c\u5927\u5909\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\uff09\u3002\n\n\u306a\u306e\u3067\u307e\u305a\u306f`/etc/default/grub`\u3092\u7de8\u96c6\u3057\u3001\n\nGRUB_CMDLINE_LINUX\u306b`console=tty0 console=ttyS0,115200n8r`\u3092\u8ffd\u8a18\u3059\u308b\u3002\n\n```\nGRUB_TIMEOUT=5\nGRUB_DEFAULT=saved\nGRUB_DISABLE_SUBMENU=true\nGRUB_TERMINAL_OUTPUT=\"console\"\nGRUB_CMDLINE_LINUX=\"rd.lvm.lv=centos_centos70-template/root rd.lvm.lv=centos_cenn\ntos70-template/swap console=tty0 console=ttyS0,115200n8r\"  #\u3053\u3053\u3092\u8ffd\u8a18\nGRUB_DISABLE_RECOVERY=\"true\"\n```\n*\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u3001GRUB_CMDLINE_LINUX\u304b\u3089`rhgb`\u3068 `quiet`\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u6d88\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u8d77\u52d5\u6642\u306e\u51fa\u529b\u3092\u6291\u6b62\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u304c\u3001\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u306b\u304f\u304f\u306a\u308b\u3060\u3051\u306a\u306e\u3067\u3001\u6d88\u3057\u3066\u3044\u307e\u3059\u3002*\n\n\u6b21\u306b\u3001`grub2-mkconfig`\u30b3\u30de\u30f3\u30c9\u306b\u3066GRUB2\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\n\n```\n# grub2-mkconfig -o /boot/grub2/grub.cfg\n```\n\n\u3053\u308c\u3067\u30b2\u30b9\u30c8\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308c\u3070\u30aa\u30fc\u30b1\u30fc\u3002\n\n### \u30b2\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u63a5\u7d9a\n\n    # virsh console (\u30c9\u30e1\u30a4\u30f3\u540d)\n\n\u203b \u629c\u3051\u308b\u5834\u5408\u306fctrl + ]\n\u4eee\u60f3\u30de\u30b7\u30f3\u3092\u8d77\u52d5\uff06\u305d\u306e\u307e\u307e\u30b3\u30f3\u30bd\u30fc\u30eb\u63a5\u7d9a\n\n    # virsh start (\u30c9\u30e1\u30a4\u30f3\u540d) --console\n\nKVM\u306e\u904b\u7528\n===========\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n---------------------------\n\n\u57fa\u672c\u7684\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u4e8c\u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u3070OK\n\n    \u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n        /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n    \u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\n        \u4e0a\u8a18\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\u306f\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\n        \u901a\u5e38\u306f /var/lib/libvirt/images/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).img\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u306e\u30ea\u30b9\u30c8\u30a2\n---------------------------------\n\n    \u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306a\u5834\u6240(\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3042\u308b\u30d1\u30b9)\u306b\u7f6e\u304f\n        \u901a\u5e38\u306f /var/lib/libvirt/images/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).img\n    \u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u9069\u5207\u306a\u5834\u6240\u306b\u7f6e\u304f\n        \u901a\u5e38\u306f /etc/libvirt/qemu/(\u4eee\u60f3\u30de\u30b7\u30f3\u540d).xml\n    \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\n    # virsh define (\u4eee\u60f3\u30de\u30b7\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb)\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\n-------------------------\n\nruby\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u4f5c\u3063\u305f\u306e\u3067\u3001\u3082\u3057\u3088\u304b\u3063\u305f\u3089\u4f7f\u3063\u3066\u304f\u3060\u3055\u3044\u2192[KVM\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8](http://qiita.com/fetaro/items/6e4c88fa9b5e5346eae4)\n\nVMWare\u306e\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30de\u30b7\u30f3\u3092KVM\u7528\u306b\u5909\u63db\n--------------------------------------\n\nvmware\u306e\u4eee\u60f3\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8(vmdk)\u3092kvm\u306b\u5909\u63db\u3059\u308b\u3068\u304d\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u6253\u3064\u3002\n\n    qemu-img convert (vmdk\u30d5\u30a1\u30a4\u30eb) -O raw (kvm\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb)\n\n\nKVM\u306eTips\n===========\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\n----------------------------\n\n* \u4eee\u60f3\u30de\u30b7\u30f3\u60c5\u5831\u5b9a\u7fa9\u30d5\u30a1\u30a4\u30eb : `/etc/libvirt/qemu/xxx.xml`\n* \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8 : `/var/lib/libvirt/images/xxx.[img|qcow2]`\n\nKVM\u306e\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0(CentOS6\u7cfb)\n===================================\n\nmDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\n----------------------------\n\n/var/log/libvirt/libvirtd.log\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\n\n    2012-07-17 15:47:49.240+0000: 15548: info : libvirt version: 0.9.10,\n    package: 21.el6_3.1 (CentOS BuildSystem ,]\n    2012-07-03-16:15:49, c6b8.bsys.dev.centos.org)\n    2012-07-17 15:47:49.240+0000: 15548: error : virNetServerMDNSStart:460\n    : \u5185\u90e8\u30a8\u30e9\u30fc mDNS \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u4f5c\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f: Daemon not running\n\n\u5bfe\u5fdc\n\n    # yum -y install avahi\n    # /etc/init.d/messagebus restart\n    # /etc/init.d/avahi-daemon restart\n    # /etc/init.d/libvirtd restart\n    # chkconfig messagebus on\n    # chkconfig avahi-daemon on\n    # chkconfig libvirtd on\n\n\u53c2\u8003\n\n    http://quags.net/archives/53\n\nvirt-manager\u306e\u65e5\u672c\u8a9efont\u304c\u8868\u793a\u3055\u308c\u306a\u3044\n------------------------------------\n\nfont\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\n\n\u5bfe\u5fdc\n\n    # yum install \"vlgothic-p-fonts\"\n\n\u9069\u5207\u306a\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3092\u898b\u3064\u3051\u3089\u308c\u306a\u3044\n-------------------------------------\n\n/var/log/libvirt/libvirtd.log\u306e\u30a8\u30e9\u30fc\n\n    2012-07-24 01:43:07.595+0000: 2126: error : qemuCapsExtractVersion:1566 : \u5185\u90e8\u30a8\u30e9\u30fc x86_64 \u306e\u9069\u5207\u306a\u30a8\u30df\u30e5\u30ec\u30fc\u30bf\u30fc\u3092\u898b\u3064\u3051\u3089\u308c\u307e\u305b\u3093\n\n\u5bfe\u5fdc\n\n    # ln -s /usr/libexec/qemu-kvm /usr/bin/qemu-system-x86_64\n    # /etc/init.d/libvirtd restart\n\nKVM\u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8aad\u307f\u8fbc\u307e\u308c\u306a\u3044\n----------------------------------------\n\n    KVM \u3092\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306f KVM \u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u306a\u3044\u3002\u307e\u305f\n    \u306f\u3001KVM \u306e\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb (kvm.ko) \u304c\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\n    QEMU \u304c\u4f7f\u308f\u308c\u308b\u306e\u3067\u52d5\u4f5c\u304c\u9045\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n\n    warning: KVM is not available. This may mean the KVM package is not installed, or the KVM kernel modules are not loaded. Your virtual machines my perform poorly\n\n\u4e00\u6642\u7684\u306a\u5bfe\u5fdc\u306f\u30ab\u30fc\u30cd\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8aad\u307f\u8fbc\u3081\u3070OK\n\n    # modprobe kvm\n    # modprobe kvm-intel\n\n\u518d\u8d77\u52d5\u5f8c\u3082\u8a2d\u5b9a\u3092\u7d99\u7d9a\u3055\u305b\u308b\u5834\u5408\u306f\u3001 /etc/rc.d/rc.sysinit\u306b\u4ee5\u4e0b\u3092\u8a18\u8f09\n\n    modprobe kvm\n    modprobe kvm-intel\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u304cKVM\u306e\u5185\u90e8\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304b\u3089\u5916\u306b\u51fa\u308c\u306a\u3044\n-------------------------------------------\n\n\u4eee\u60f3\u30de\u30a4\u30f3\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3042\u308b\n\n\u5bfe\u5fdc\n\n    # ifconfig eth0 0.0.0.0 promisc up\n\n\nvirsh shutdown\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u304c\u505c\u6b62\u3057\u306a\u3044\n-------------------------------------------\n\nacpid\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308b\u3002\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308c\u3070OK\n\n```\n# yum install acpid\n```\n", "tags": ["KVM", "Linux"]}