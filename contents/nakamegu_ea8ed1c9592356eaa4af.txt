{"tags": ["fluentd", "Elasticsearch"], "context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\nMySQL\u306e\u30c7\u30fc\u30bf\u3092Fluentd\u3092\u4f7f\u3063\u3066Elasticsearch\u306b\u6d41\u3057\u8fbc\u3080\u3068\u304d\u3001logstash\u5f62\u5f0f\u306b\u3057\u3066@timestamp\u306bMySQL\u5185\u306e\u65e5\u4ed8\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\n(DB\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u30ed\u30b0\u30a4\u30f3\u5c65\u6b74\u3092\u3001\u305d\u306e\u307e\u307eKibana\u3067\u3082\u898b\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306a\u30fc\u3068\u3044\u3046\u306e\u304c\u8981\u4ef6)\n\n\u4f7f\u3046\u3082\u306e\n\nhttps://github.com/uken/fluent-plugin-elasticsearch\n\nhttps://github.com/y-ken/fluent-plugin-mysql-replicator\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3064\u307e\u3065\u3044\u305f\u304c\u3001gem install mysql \u3092\u5358\u4f53\u3067\u5148\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u3002\n\nMySQL\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f4\u65b0/\u524a\u9664\u30a4\u30d9\u30f3\u30c8\u3092\u9010\u6b21\u53d6\u5f97\u3059\u308bFluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u300cfluent-plugin-mysql-replicator\u300d\u3092\u30ea\u30ea\u30fc\u30b9\u3057\u307e\u3057\u305f \u304c\u5f79\u306b\u7acb\u3064\u3002\n\n\n\n\n\u72b6\u6cc1\n\nMySQL\n\n\nHost: localhost\nUser: dbuser\nPassword: dbpass\nDatabase: testdb\nTable: history\nSchema: \u3053\u306e\u4e2d\u306e loginTime \u3092 @timestamp \u3068\u3057\u3066\u4f7f\u3044\u305f\u3044\n\n\n\n\n\n\nField\nType\n\n\n\n\nlogin\nvarchar(255)\n\n\nuserId\nbigint(20)\n\n\nloginTime\ndatetime\n\n\nsessionId\nvarchar(255)\n\n\n\n\nElasticsearch\n\n\nHost: localhost\nPort: 9200\n\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n<source>\n  type mysql_replicator\n  host localhost\n  username dbuser\n  password dbpass\n  database testdb\n  query SELECT login,userId,loginTime,sessionId,DATE_FORMAT(loginTime, '%Y-%m-%dT%k:%i:%s+09:00') as \"@timestamp\" FROM history WHERE DATE_ADD(loginTime, INTERVAL 1 MINUTE) > NOW();\n  primary_key sessionId\n  interval 1m\n  enable_delete no\n  tag replicator.testdb.history.${event}\n</source>\n\n\n\nREADME \u306b\u306f\u3001\"@timestamp\":\"2014-04-07T000:00:00-00:00\"\n\u3084\"@timstamp\": \"2014-12-19T08:01:03Z\"\n\u306a\u3069\u306e\u8868\u8a18\u304c\u3042\u308b\u304c\u3001DATE_FORMAT(loginTime, '%Y-%m-%dT%k:%i:%s+09:00') \u3067\u52d5\u3044\u3066\u304f\u308c\u305f\u3002('%Y-%m-%dT%k:%i:%sZ'\u306f\u52d5\u304b\u305a\u3002)\n\n<match replicator.**>\n  type copy\n  <store>\n    type_name dbsync\n    type elasticsearch\n    include_tag_key true\n    tag_key @log_name\n    host localhost\n    port 9200\n    logstash_format true\n  </store>\n  <store>\n    type file\n    path /tmp/login_history\n  </store>\n</match>\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\ntd-agent \u3092\u518d\u8d77\u52d5\u3059\u308b\nKibana \u3067DB\u306e\u30c7\u30fc\u30bf\u304c\u898b\u3048\u308b\n\n{\n  \"_index\": \"logstash-2015.02.16\",\n  \"_type\": \"dbsync\",\n  \"_id\": \"iXONkf2-SWWbYXN7ZngtdQ\",\n  \"_score\": null,\n  \"_source\": {\n    \"login\": \"TEST_LOGIN\",\n    \"userId\": 123,\n    \"loginTime\": \"2015-02-16 16:02:01 +0900\",\n    \"sessionId\": \"ab533450625c7e849272fea658426545\",\n    \"@timestamp\": \"2015-02-16T16:02:01+09:00\",\n    \"@log_name\": \"replicator.testdb.history.insert\"\n  },\n  \"sort\": [\n    1424070121000,\n    1424070121000\n  ]\n}\n\n\n# \u76ee\u7684\n\nMySQL\u306e\u30c7\u30fc\u30bf\u3092Fluentd\u3092\u4f7f\u3063\u3066Elasticsearch\u306b\u6d41\u3057\u8fbc\u3080\u3068\u304d\u3001logstash\u5f62\u5f0f\u306b\u3057\u3066@timestamp\u306bMySQL\u5185\u306e\u65e5\u4ed8\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\n\n(DB\u306b\u683c\u7d0d\u3057\u3066\u3044\u308b\u30ed\u30b0\u30a4\u30f3\u5c65\u6b74\u3092\u3001\u305d\u306e\u307e\u307eKibana\u3067\u3082\u898b\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306a\u30fc\u3068\u3044\u3046\u306e\u304c\u8981\u4ef6)\n\n# \u4f7f\u3046\u3082\u306e\n\n* https://github.com/uken/fluent-plugin-elasticsearch\n* https://github.com/y-ken/fluent-plugin-mysql-replicator\n * \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3064\u307e\u3065\u3044\u305f\u304c\u3001gem install mysql \u3092\u5358\u4f53\u3067\u5148\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u56de\u907f\u3002\n * [MySQL\u30c6\u30fc\u30d6\u30eb\u3078\u306e\u66f4\u65b0/\u524a\u9664\u30a4\u30d9\u30f3\u30c8\u3092\u9010\u6b21\u53d6\u5f97\u3059\u308bFluentd\u30d7\u30e9\u30b0\u30a4\u30f3\u300cfluent-plugin-mysql-replicator\u300d\u3092\u30ea\u30ea\u30fc\u30b9\u3057\u307e\u3057\u305f](http://y-ken.hatenablog.com/entry/fluent-plugin-mysql-replicator-has-released) \u304c\u5f79\u306b\u7acb\u3064\u3002\n\n# \u72b6\u6cc1\n\n* MySQL\n * Host: localhost\n * User: dbuser\n * Password: dbpass\n * Database: testdb\n * Table: history\n * Schema: \u3053\u306e\u4e2d\u306e loginTime \u3092 @timestamp \u3068\u3057\u3066\u4f7f\u3044\u305f\u3044\n\n| Field      | Type         |\n|:-----------|-------------:|\n| login      | varchar(255) |\n| userId     | bigint(20)   |\n| loginTime  | datetime     |\n| sessionId  | varchar(255) |\n\n* Elasticsearch\n * Host: localhost\n * Port: 9200\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n```\n<source>\n  type mysql_replicator\n  host localhost\n  username dbuser\n  password dbpass\n  database testdb\n  query SELECT login,userId,loginTime,sessionId,DATE_FORMAT(loginTime, '%Y-%m-%dT%k:%i:%s+09:00') as \"@timestamp\" FROM history WHERE DATE_ADD(loginTime, INTERVAL 1 MINUTE) > NOW();\n  primary_key sessionId\n  interval 1m\n  enable_delete no\n  tag replicator.testdb.history.${event}\n</source>\n```\n\n* [README](https://github.com/uken/fluent-plugin-elasticsearch/blob/master/README.md) \u306b\u306f\u3001```\"@timestamp\":\"2014-04-07T000:00:00-00:00\"```\n\u3084```\"@timstamp\": \"2014-12-19T08:01:03Z\"```\n\u306a\u3069\u306e\u8868\u8a18\u304c\u3042\u308b\u304c\u3001```DATE_FORMAT(loginTime, '%Y-%m-%dT%k:%i:%s+09:00')``` \u3067\u52d5\u3044\u3066\u304f\u308c\u305f\u3002(```'%Y-%m-%dT%k:%i:%sZ'```\u306f\u52d5\u304b\u305a\u3002)\n\n```\n<match replicator.**>\n  type copy\n  <store>\n    type_name dbsync\n    type elasticsearch\n    include_tag_key true\n    tag_key @log_name\n    host localhost\n    port 9200\n    logstash_format true\n  </store>\n  <store>\n    type file\n    path /tmp/login_history\n  </store>\n</match>\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n1. td-agent \u3092\u518d\u8d77\u52d5\u3059\u308b\n2. Kibana \u3067DB\u306e\u30c7\u30fc\u30bf\u304c\u898b\u3048\u308b\n\n```\n{\n  \"_index\": \"logstash-2015.02.16\",\n  \"_type\": \"dbsync\",\n  \"_id\": \"iXONkf2-SWWbYXN7ZngtdQ\",\n  \"_score\": null,\n  \"_source\": {\n    \"login\": \"TEST_LOGIN\",\n    \"userId\": 123,\n    \"loginTime\": \"2015-02-16 16:02:01 +0900\",\n    \"sessionId\": \"ab533450625c7e849272fea658426545\",\n    \"@timestamp\": \"2015-02-16T16:02:01+09:00\",\n    \"@log_name\": \"replicator.testdb.history.insert\"\n  },\n  \"sort\": [\n    1424070121000,\n    1424070121000\n  ]\n}\n```\n"}