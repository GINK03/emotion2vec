{"context": " More than 1 year has passed since last update.\n\nunicorn \u5c0e\u5165\u624b\u9806\u66f8\n#!/usr/bin/ruby ruby\n## config/unicorn.rb\n\n# pid\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\npath_pid = \"unicorn.pid\"\n\n# \u30ed\u30b0\npath_stdout_log = \"log/unicorn.log\"\npath_stderr_log = \"log/unicorn.log\"\n\n# port\nport = 8080\n# socket\npath_socket = \"/tmp/unicorn.sock\"\n\n\n# ===== \u4ee5\u4e0b\u306f\u57fa\u672c\u7684\u306b\u3042\u305f\u308b\u5fc5\u8981\u306a\u3057 =====\n# from https://github.com/defunkt/unicorn/blob/master/examples/unicorn.conf.rb\n\nrails_root = File.expand_path('../../', __FILE__)\nENV['BUNDLE_GEMFILE'] = rails_root + \"/Gemfile\"\n\n# Use at least one worker per core if you're on a dedicated server,\n# more will usually help for _short_ waits on databases/caches.\nworker_processes 4\n\n# \u5909\u6570\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u3001listen\u3059\u308b\nlisten path_socket, :backlog => 64 if !defined?(path_socket).empty?\nlisten port,        :tcp_nopush => true   if !defined?(port).empty?\n\nworking_directory rails_root\n\n# \u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\ntimeout 30\n\n# unicorn\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u306b\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ed\u30b0\u306f\u4e00\u5207production.log\u306b\u306f\u51fa\u529b\u3055\u308c\u306a\u3044\u3002\n# \u306a\u306e\u3067\u3001\u305d\u308c\u3092\u5f37\u5236\u7684\u306b\u5410\u304d\u51fa\u3059\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\n# INT\u30b7\u30b0\u30e9\u30eb\u3067\u30c8\u30e9\u30c3\u30d7\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\ntimeout_signal :INT\nafter_fork do |server, worker|\n  trap (:INT) do\n    Rails.logger.error \"Unicorn Timeout (trapped SIGINT)\"\n    Rails.logger.flush\n    Process.kill :KILL, $$\n  end\nend\n\npid path_pid\n\n# unicorn\u30ed\u30b0\u306e\u5834\u6240\u3092\u6307\u5b9a\u3059\u308b\nstdout_path path_stdout_log\nstderr_path path_stderr_log\n\n\n# \u57fa\u672c\u7684\u306b\u306f`true`\u3092\u6307\u5b9a\u3059\u308b\u3002Unicorn\u306e\u518d\u8d77\u52d5\u6642\u306b\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u306a\u3057\u3067\u518d\u8d77\u52d5\u304c\u884c\u308f\u308c\u308b\u3002\npreload_app true\n\n# \u3053\u308c\u3092\u3059\u308b\u7406\u7531\u306f\u3001\n# http://techracho.bpsinc.jp/baba/2012_08_29/6001\n# \u3092\u307f\u308b\u3068\u3001\u89e3\u308a\u3084\u3059\u3044\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and\n    ActiveRecord::Base.connection.disconnect!\nend\n\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n\nunicorn \u5c0e\u5165\u624b\u9806\u66f8\n----\n\n```rb\n#!/usr/bin/ruby ruby\n## config/unicorn.rb\n\n# pid\u30d5\u30a1\u30a4\u30eb\u306e\u5834\u6240\npath_pid = \"unicorn.pid\"\n\n# \u30ed\u30b0\npath_stdout_log = \"log/unicorn.log\"\npath_stderr_log = \"log/unicorn.log\"\n\n# port\nport = 8080\n# socket\npath_socket = \"/tmp/unicorn.sock\"\n\n\n# ===== \u4ee5\u4e0b\u306f\u57fa\u672c\u7684\u306b\u3042\u305f\u308b\u5fc5\u8981\u306a\u3057 =====\n# from https://github.com/defunkt/unicorn/blob/master/examples/unicorn.conf.rb\n\nrails_root = File.expand_path('../../', __FILE__)\nENV['BUNDLE_GEMFILE'] = rails_root + \"/Gemfile\"\n\n# Use at least one worker per core if you're on a dedicated server,\n# more will usually help for _short_ waits on databases/caches.\nworker_processes 4\n\n# \u5909\u6570\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u3001listen\u3059\u308b\nlisten path_socket, :backlog => 64 if !defined?(path_socket).empty?\nlisten port,        :tcp_nopush => true   if !defined?(port).empty?\n\nworking_directory rails_root\n\n# \u63a5\u7d9a\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\ntimeout 30\n\n# unicorn\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u306b\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ed\u30b0\u306f\u4e00\u5207production.log\u306b\u306f\u51fa\u529b\u3055\u308c\u306a\u3044\u3002\n# \u306a\u306e\u3067\u3001\u305d\u308c\u3092\u5f37\u5236\u7684\u306b\u5410\u304d\u51fa\u3059\u51e6\u7406\u3092\u8ffd\u52a0\u3059\u308b\n# INT\u30b7\u30b0\u30e9\u30eb\u3067\u30c8\u30e9\u30c3\u30d7\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\ntimeout_signal :INT\nafter_fork do |server, worker|\n  trap (:INT) do\n    Rails.logger.error \"Unicorn Timeout (trapped SIGINT)\"\n    Rails.logger.flush\n    Process.kill :KILL, $$\n  end\nend\n\npid path_pid\n\n# unicorn\u30ed\u30b0\u306e\u5834\u6240\u3092\u6307\u5b9a\u3059\u308b\nstdout_path path_stdout_log\nstderr_path path_stderr_log\n\n\n# \u57fa\u672c\u7684\u306b\u306f`true`\u3092\u6307\u5b9a\u3059\u308b\u3002Unicorn\u306e\u518d\u8d77\u52d5\u6642\u306b\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u306a\u3057\u3067\u518d\u8d77\u52d5\u304c\u884c\u308f\u308c\u308b\u3002\npreload_app true\n\n# \u3053\u308c\u3092\u3059\u308b\u7406\u7531\u306f\u3001\n# http://techracho.bpsinc.jp/baba/2012_08_29/6001\n# \u3092\u307f\u308b\u3068\u3001\u89e3\u308a\u3084\u3059\u3044\nbefore_fork do |server, worker|\n  defined?(ActiveRecord::Base) and\n    ActiveRecord::Base.connection.disconnect!\nend\n\nafter_fork do |server, worker|\n  defined?(ActiveRecord::Base) and ActiveRecord::Base.establish_connection\nend\n\n```\n", "tags": ["unicorn", "RubyOnRails"]}