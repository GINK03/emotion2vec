{"context": " More than 1 year has passed since last update.\u901a\u5e38Serverspec\u306f$ rake spec\u3067\u5b9f\u884c\u3059\u308b\n\u4e00\u65b9\u3001rspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\u6b21\u306e\u65b9\u6cd5\u3067rspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3067\u304d\u308b\n\uff08\u3082\u3057\u3001\u3059\u3067\u306b\u4e00\u822c\u7684\u306a\u5bfe\u5fdc\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u307b\u3057\u3044\uff09\n\n\u901a\u5e38\u306frspec\u30b3\u30de\u30f3\u30c9\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\n$ rake spec\u3067\u5b9f\u884c\u3057\u305f\u5f8c\u306e\u51fa\u529b\u306eFailed examples:\u306brspec\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\n\u305d\u306e\u901a\u308a\u306brspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308b\n$ rspec ./spec/www.example.com/some_spec.rb:33\n\n  1) Port \"80\" should be listening\n     Failure/Error: it { should be_listening }\n     TypeError:\n       no implicit conversion of nil into String\n\n\u307e\u305f\u306f\n/Users/user/.rbenv/versions/2.1.4/lib/ruby/gems/2.1.0/gems/net-ssh-2.9.2/lib/net/ssh/transport/session.rb:70:in `initialize': no implicit conversion of nil into String (TypeError)\n\n\nrspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u8a2d\u5b9a\n\n\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u5834\u5408\n\u5f8c\u8ff0\u3059\u308b\u8907\u6570\u30db\u30b9\u30c8\u306e\u5834\u5408\u306e\u3088\u3046\u306b\u3001RSpec.configure\u3067host\u3092\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u6700\u521d\u8a66\u3057\u305f\u304c\u3001\u305d\u3082\u305d\u3082\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u5834\u5408\u306f\u30d5\u30a9\u30eb\u30c0\u304b\u3089host\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\n\u306a\u306e\u3067\u3001dotenv\u3092\u4f7f\u3046\u65b9\u6cd5\u304c\u826f\u3044\n\nGemfile\ngem 'dotenv'\n\n\n\nspec/spec_helper.rb\nrequire 'dotenv'\nDotenv.load\n\n\n\n.env\nTARGET_HOST=www.example.com\n\n\n\u5b9f\u884c\u7d50\u679c\n$ rspec\n\n...\nFailed examples:\n\nrspec ./spec/www.example.com/sample_spec.rb:5 # Service \"httpd\" should be enabled\n\n\n\u8907\u6570\u30db\u30b9\u30c8\u306e\u5834\u5408\n\u60f3\u5b9a\u3057\u3066\u3044\u308b\u69cb\u6210\u306fspec\u4ee5\u4e0b\u306b\u30db\u30b9\u30c8\u540d\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u3063\u3066\u8907\u6570\u7ba1\u7406\u3057\u3066\u3044\u308b\u30b1\u30fc\u30b9\uff08\u4f8b. spec/www.example.com/some_spec.rb \uff09\n\nspec_helper.rb\nRSpec.configure do |c|\n  c.add_setting :host_taken_from_path\n\n  c.before do |example|\n    if c.host.nil?\n      c.host = example.metadata[:file_path].gsub('./spec/', '').split('/').first\n      c.ssh_options = Net::SSH::Config.for(c.host)\n      c.host_taken_from_path = true\n    end\n  end\n\n  c.after do\n    if c.host_taken_from_path\n      c.host = c.ssh_options = nil\n      c.host_taken_from_path = false\n    end\n  end\nend\n\n\nrspec\u5b9f\u884c\n$ rspec ./spec/www.example.com/some_spec.rb:33\n\nPort \"80\"\n  should be listening\n\nFinished in 4.77 seconds (files took 1.46 seconds to load)\n1 example, 0 failures\n\n\n\u5236\u7d04\nRSpec.configure\u3067host\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001\u6b21\u306e\u3088\u3046\u306aos\u306e\u6761\u4ef6\u306a\u3069\u304c\u4f7f\u3048\u306a\u3044(host\u304c\u7a7a\u306e\u6642\u70b9\u3067ssh\u304c\u8d70\u3063\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b)\ndescribe service('httpd'), :if => os[:family] == 'redhat' do\n\n\n\u7559\u610f\u70b9\nRSpec.configure\u3067host\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001\u7559\u610f\u70b9\u3068\u3057\u3066\u306f\u5931\u6557\u6642\u306bOn host 'www.example.com'\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\n\u30bd\u30fc\u30b9 serverspec.rb\nhost_taken_from_path\u3068after\u306e\u30d6\u30ed\u30c3\u30af\u3092\u66f8\u304b\u306a\u3051\u308c\u3070\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u304c\u3001ssh_options\u3092\u30af\u30ea\u30a2\u3057\u306a\u3044\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bssh_options\u5185\u306e:send_env\u304c\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u308b\n{:auth_methods=>[\"none\", \"publickey\", \"password\", \"keyboard-interactive\"], :host_name=>\"XXX.XXX.XXX.XXX\", :user=>\"hoge\", :keys=>[\"/Users/hoge/.ssh/id_rsa\"], :send_env=>[/^LANG$/, /^LC_.*$/, \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\"]}\n\n\n\u74b0\u5883\n\nrbenv + Ruby 2.1.4\nserverspec (2.14.1), specinfra (2.30.0)\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306fUN*X, SSH\n\n\u30db\u30b9\u30c8\u306e\u8a2d\u5b9a ~/.ssh/config\n\nset :request_pty, true\n\u9069\u5f53\u306asudo\u306e\u8a2d\u5b9a\n\n\n\u305d\u306e\u4ed6\n\u305d\u3082\u305d\u3082\u306eFailed examples\u306e\u90e8\u5206\u306e\u51fa\u529b\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304b\u3082\nFailed examples:\n\nrspec ./spec/www.example.com/some_spec.rb:33 # Port \"80\" should be listening\n\n\u2193\nrake spec SPEC=spec/www.example.com/some_spec.rb:33\n\n\u901a\u5e38Serverspec\u306f`$ rake spec`\u3067\u5b9f\u884c\u3059\u308b\n\u4e00\u65b9\u3001`rspec`\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\n\u6b21\u306e\u65b9\u6cd5\u3067`rspec`\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3067\u304d\u308b\n\uff08\u3082\u3057\u3001\u3059\u3067\u306b\u4e00\u822c\u7684\u306a\u5bfe\u5fdc\u65b9\u6cd5\u304c\u3042\u3063\u305f\u3089\u6559\u3048\u3066\u307b\u3057\u3044\uff09\n\n### \u901a\u5e38\u306frspec\u30b3\u30de\u30f3\u30c9\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\n`$ rake spec`\u3067\u5b9f\u884c\u3057\u305f\u5f8c\u306e\u51fa\u529b\u306e`Failed examples:`\u306brspec\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\n\u305d\u306e\u901a\u308a\u306brspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u306b\u306a\u308b\n\n```\n$ rspec ./spec/www.example.com/some_spec.rb:33\n```\n```\n  1) Port \"80\" should be listening\n     Failure/Error: it { should be_listening }\n     TypeError:\n       no implicit conversion of nil into String\n```\n\n\u307e\u305f\u306f\n\n```\n/Users/user/.rbenv/versions/2.1.4/lib/ruby/gems/2.1.0/gems/net-ssh-2.9.2/lib/net/ssh/transport/session.rb:70:in `initialize': no implicit conversion of nil into String (TypeError)\n```\n\n## rspec\u30b3\u30de\u30f3\u30c9\u3067\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u8a2d\u5b9a\n\n### \u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u5834\u5408\n\n\u5f8c\u8ff0\u3059\u308b\u8907\u6570\u30db\u30b9\u30c8\u306e\u5834\u5408\u306e\u3088\u3046\u306b\u3001`RSpec.configure`\u3067host\u3092\u8a2d\u5b9a\u3057\u3088\u3046\u3068\u6700\u521d\u8a66\u3057\u305f\u304c\u3001\u305d\u3082\u305d\u3082\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u5834\u5408\u306f\u30d5\u30a9\u30eb\u30c0\u304b\u3089host\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u306a\u3044\n\n\u306a\u306e\u3067\u3001`dotenv`\u3092\u4f7f\u3046\u65b9\u6cd5\u304c\u826f\u3044\n\n```rb:Gemfile\ngem 'dotenv'\n```\n\n```rb:spec/spec_helper.rb\nrequire 'dotenv'\nDotenv.load\n```\n\n```text:.env\nTARGET_HOST=www.example.com\n```\n\n\u5b9f\u884c\u7d50\u679c\n\n```\n$ rspec\n\n...\nFailed examples:\n\nrspec ./spec/www.example.com/sample_spec.rb:5 # Service \"httpd\" should be enabled\n```\n\n### \u8907\u6570\u30db\u30b9\u30c8\u306e\u5834\u5408\n\n\u60f3\u5b9a\u3057\u3066\u3044\u308b\u69cb\u6210\u306f`spec`\u4ee5\u4e0b\u306b\u30db\u30b9\u30c8\u540d\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u3063\u3066\u8907\u6570\u7ba1\u7406\u3057\u3066\u3044\u308b\u30b1\u30fc\u30b9\uff08\u4f8b. `spec/www.example.com/some_spec.rb` \uff09\n\n```rb:spec_helper.rb\nRSpec.configure do |c|\n  c.add_setting :host_taken_from_path\n\n  c.before do |example|\n    if c.host.nil?\n      c.host = example.metadata[:file_path].gsub('./spec/', '').split('/').first\n      c.ssh_options = Net::SSH::Config.for(c.host)\n      c.host_taken_from_path = true\n    end\n  end\n\n  c.after do\n    if c.host_taken_from_path\n      c.host = c.ssh_options = nil\n      c.host_taken_from_path = false\n    end\n  end\nend\n```\n\nrspec\u5b9f\u884c\n\n\n```\n$ rspec ./spec/www.example.com/some_spec.rb:33\n\nPort \"80\"\n  should be listening\n\nFinished in 4.77 seconds (files took 1.46 seconds to load)\n1 example, 0 failures\n```\n\n### \u5236\u7d04\n\n`RSpec.configure`\u3067host\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001\u6b21\u306e\u3088\u3046\u306a`os`\u306e\u6761\u4ef6\u306a\u3069\u304c\u4f7f\u3048\u306a\u3044(host\u304c\u7a7a\u306e\u6642\u70b9\u3067ssh\u304c\u8d70\u3063\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308b)\n\n```\ndescribe service('httpd'), :if => os[:family] == 'redhat' do\n```\n\n### \u7559\u610f\u70b9\n\n`RSpec.configure`\u3067host\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u3001\u7559\u610f\u70b9\u3068\u3057\u3066\u306f\u5931\u6557\u6642\u306b`On host 'www.example.com'`\u306e\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u306a\u3044\n[\u30bd\u30fc\u30b9 serverspec.rb](https://github.com/serverspec/serverspec/blob/master/lib/serverspec.rb)\n\n`host_taken_from_path`\u3068`after`\u306e\u30d6\u30ed\u30c3\u30af\u3092\u66f8\u304b\u306a\u3051\u308c\u3070\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u304c\u3001`ssh_options`\u3092\u30af\u30ea\u30a2\u3057\u306a\u3044\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bssh_options\u5185\u306e`:send_env`\u304c\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u308b\n\n```\n{:auth_methods=>[\"none\", \"publickey\", \"password\", \"keyboard-interactive\"], :host_name=>\"XXX.XXX.XXX.XXX\", :user=>\"hoge\", :keys=>[\"/Users/hoge/.ssh/id_rsa\"], :send_env=>[/^LANG$/, /^LC_.*$/, \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\", \"LANG\"]}\n```\n\n### \u74b0\u5883\n\n- rbenv + Ruby 2.1.4\n- serverspec (2.14.1), specinfra (2.30.0)\n- \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f`UN*X`, `SSH`\n- \u30db\u30b9\u30c8\u306e\u8a2d\u5b9a `~/.ssh/config`\n- `set :request_pty, true`\n- \u9069\u5f53\u306asudo\u306e\u8a2d\u5b9a\n\n### \u305d\u306e\u4ed6\n\n\u305d\u3082\u305d\u3082\u306eFailed examples\u306e\u90e8\u5206\u306e\u51fa\u529b\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304b\u3082\n\n```\nFailed examples:\n\nrspec ./spec/www.example.com/some_spec.rb:33 # Port \"80\" should be listening\n```\n\u2193\n\n```\nrake spec SPEC=spec/www.example.com/some_spec.rb:33\n```\n", "tags": ["serverspec"]}