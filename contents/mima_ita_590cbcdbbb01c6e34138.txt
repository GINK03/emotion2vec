{"context": " More than 1 year has passed since last update.\u4ee5\u524d\u3001\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092Web\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3057\u307e\u3057\u305f\u3002\n\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3(eStat)\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092Web\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3059\u308b\u65b9\u6cd5 \nhttp://qiita.com/mima_ita/items/38784095a146c87dcd23\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001three.js\u3092\u7528\u3044\u3066\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u30923D\u3067\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\ndemo\nhttp://needtec.sakura.ne.jp/threemap/mesh3d_example.html\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nhttps://github.com/mima3/threemap\n\n\n\u6307\u5b9a\u7bc4\u56f2\u306e\u30c7\u30fc\u30bf\u3092JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3068\u3001\u56fd\u571f\u6570\u5024\u60c5\u5831\u306e\u884c\u653f\u533a\u57df\u3092\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u300c\u7d30\u304b\u3044\u3053\u3068\u306f\u3044\u3044\u3093\u3060\u3088\uff01\u4ffa\u306f\uff13D\u3067\u8868\u793a\u3057\u305f\u3044\u3093\u3060\uff01\u300d\u3063\u3066\u4eba\u306f\u3001\u4ee5\u4e0b\u306e\u547c\u3073\u51fa\u3057\u4f8b\u3092\u30b3\u30d4\u30da\u3059\u308c\u3070JSON\u304c\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u6307\u5b9a\u306e\u7bc4\u56f2\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u307e\u305a\u3001\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092HTTP\u7d4c\u7531\u3067JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u547c\u3073\u51fa\u3057\u4f8b\uff1a \nhttp://needtec.sakura.ne.jp/estat/json/get_mesh_stat_group_by_mesh?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81&stat_id=T000608\n\u53d6\u5f97\u5185\u5bb9\uff1a \n{\n  \"type\": \"FeatureCollection\", \n  \"features\": [\n    {\n      \"geometry\": {\n        \"type\": \"Polygon\", \n        \"coordinates\": [\n          [\n            [139.4124999999999, 35.45833333333333], \n            [139.4249999999999, 35.45833333333333], \n            [139.4249999999999, 35.46666666666666], \n            [139.4124999999999, 35.46666666666666], \n            [139.4124999999999, 35.45833333333333]\n          ]\n        ]\n      }, \n      \"type\": \"Feature\", \n      \"properties\": {\n        \"\u4e16\u5e2f\u7dcf\u6570\": \"5018\", \n        \"\u5973\": \"6093\", \"\\u4eba\\u53e3\\u7dcf\\u6570\": \"12349\", \n        \"\u7537\": \"6256\", \"area\": \"53391353\"\n      }\n    },// \u7565 \n  ]\n} \n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 \nhttps://github.com/mima3/estat\n\u3053\u306e\u5b9f\u88c5\u306fPython+bottle\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u6307\u5b9a\u306e\u7bc4\u56f2\u306e\u884c\u653f\u533a\u57df\u3092GeoJSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u540c\u69d8\u306b\u56fd\u571f\u6570\u5024\u60c5\u5831\u306e\u884c\u653f\u533a\u57df\u3082\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u3066GeoJSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u547c\u3073\u51fa\u3057\u4f8b\uff1a \nhttp://needtec.sakura.ne.jp/kokudo/json/get_administrative_district_by_geometry?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81\n\u53d6\u5f97\u5185\u5bb9\uff1a \n{\n  \"type\": \"FeatureCollection\", \n  \"features\": [\n    {\n      \"geometry\": {\n        \"type\": \"Polygon\", \n        \"coordinates\": [\n          [\n            [139.4478029999999, 35.42797099999999], \n            [139.445154, 35.428581], // \u7565\n          ]\n        ]\n      }, \n      \"type\": \"Feature\", \n      \"properties\": {\n        \"prefectureName\": \"\\u795e\\u5948\\u5ddd\\u770c\", \n        \"administrativeAreaCode\": \"14218\", \n        \"cityName\": \"\\u7dbe\\u702c\\u5e02\", \n        \"countryName\": \"                    \", \n        \"subPrefectureName\": \"                    \", \n        \"PK_UID\": 94566\n      }\n    }, // \u7565\n  ]\n}\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 \nhttps://github.com/mima3/kokudo\n\u3053\u306e\u5b9f\u88c5\u306fPython+bottle\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\nthree.js\u3092\u4f7f\u7528\u3057\u30663D\u3067\u8868\u793a\u3059\u308b\n\nD3.js\u3067\u8aad\u307f\u8fbc\u3093\u3060\u884c\u653f\u533a\u57df\u306eGeojson\u30923D\u8868\u793a\u3059\u308b\u3002\nGeojson\u3092D3.js\u3067\u8aad\u307f\u8fbc\u307f\u3001\u4f5c\u6210\u3055\u308c\u305fSVG\u3092three.js\u30673D\u8868\u793a\u3057\u307e\u3059\u3002\n\u3053\u306e\u65b9\u6cd5\u306f\u3001\u4e0b\u8a18\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nGUNMA GIS GEEK D3.js\u3067\u8aad\u307f\u8fbc\u3093\u3060geoJSON\u30c7\u30fc\u30bf\u3092three.js\u3092\u4f7f\u3063\u30663D\u8868\u793a\u3059\u308b\u3002 \nhttp://shimz.me/blog/d3-js/3137\nRender geographic information in 3D with Three.js and D3.js \nhttp://www.smartjava.org/content/render-geographic-information-3d-threejs-and-d3js\n\u307e\u305a\u3001JSON\u3092D3.js\u3092\u5229\u7528\u3057\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u3053\u306e\u969b\u3001async.js\u3092\u7528\u3044\u3066\u4e26\u5217\u3067JSON\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\nasync.parallel([\n  function (callback) {\n    d3.json(\"http://needtec.sakura.ne.jp/kokudo/json/get_administrative_district_by_geometry?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81\", function(json) {\n        callback(null, json);\n    });\n  },\n  function (callback) {\n    d3.json(\"http://needtec.sakura.ne.jp/estat/json/get_mesh_stat_group_by_mesh?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81&stat_id=T000608\", function(json) {\n        callback(null, json);\n    });\n  }\n], function(err, results) {\n  // \u7565\n});\n\n\u3053\u306e\u53d6\u5f97\u3057\u305fgeojson\u3092svg path\u306b\u5909\u63db\u3057\u3066\u3001\u305d\u306e\u5f8c\u3001three.js\u306b\u8868\u793a\u3057\u307e\u3059\u3002\n  function initScene() {\n    container = $('#map');\n\n    //\u30b7\u30fc\u30f3\u306e\u8ffd\u52a0\n    scene = new THREE.Scene();\n\n    //\u30ab\u30e1\u30e9\u306e\u8a2d\u5b9a\n    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);\n    camera.position.set(-6.005123939520757, -6.754277108005312, 3.1756149676051133);\n    var target = new THREE.Vector3();\n    target.x = -7.162140160089945;\n    target.y = 0.42803104270646924;\n    target.z = -2.063747120298727;\n    //camera.lookAt(target); // TrackballControls\u4f7f\u7528\u4e2d\u306f\u52b9\u304b\u306a\u3044\n\n    scene.add(camera);\n\n    //\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u306e\u8a2d\u5b9a\n    var light = new THREE.DirectionalLight(0xffffff, 2);\n    light.position.set(-10, -20, 30).normalize();\n    scene.add(light);\n\n    light2 = new THREE.AmbientLight(0x333333);               \n    scene.add(light2);  \n\n    var projection = d3.geo.equirectangular()\n       .scale(900)\n       .translate([-2200, 560]);\n\n    //\u4e0a\u4e0b\u304c\u53cd\u8ee2\u3057\u3066\u3044\u308b\u306e\u3067\u30e0\u30ea\u304f\u308a\u5408\u308f\u305b\u308b\n    var reverseProjection = function(x, y) {\n      pt = projection(x, y);\n      pt[1] *= -1;\n      return pt;\n    };\n\n    //geoJSON\u306e\u30c7\u30fc\u30bf\u3092\u30d1\u30b9\u306b\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u4f5c\u6210\n    var path = d3.geo.path().projection(reverseProjection);\n\n    createAdministrativeDistrictMesh(results[0].features);\n    function createAdministrativeDistrictMesh(geodata) {\n      //geoJSON\u2192svg path\u2192three.js mesh\u5909\u63db    \n      var countries = [];\n      for (i = 0 ; i < geodata.length ; i++) {\n        var geoFeature = geodata[i];\n        var properties = geoFeature.properties;\n        var feature = path(geoFeature);\n\n        //svg\u30d1\u30b9\u3092three.js\u306emesh\u306b\u5909\u63db\n        var gmesh = transformSVGPathExposed(feature);\n        //console.log(properties, gmesh);\n        countries.push({\"data\": properties, \"mesh\": gmesh});\n      }\n\n      //mesh\u8ffd\u52a0\n      for (i = 0 ; i < countries.length ; i++) {\n\n          var material = new THREE.MeshLambertMaterial({color:0x888888});\n\n          var shape3d = countries[i].mesh.extrude({\n              amount: 0,\n              bevelEnabled: false\n          });\n\n          var toAdd = new THREE.Mesh(shape3d, material);\n          //toAdd.rotation.x = 60;\n          scene.add(toAdd);\n      }\n    }\n\nsvg path\u304b\u3089three.js\u3078\u306e\u5909\u63db\u306f\u4e0b\u8a18\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nd3-threeD \nhttps://github.com/asutherland/d3-threeD\n\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306ftransformSVGPath\u3068\u3044\u3046\u5185\u90e8\u95a2\u6570\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u95a2\u6570\u304csvg path\u304b\u3089three.js\u306e\u30b8\u30aa\u30e1\u30c8\u30ea\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\u3053\u306e\u95a2\u6570\u306f\u5185\u90e8\u95a2\u6570\u306e\u305f\u3081\u3001d3-threeD.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u5916\u90e8\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nd3-threeD.js\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this file,\n * You can obtain one at http://mozilla.org/MPL/2.0/. */\nvar transformSVGPathExposed;\n\nfunction d3threeD(exports) {\n// \u7565\ntransformSVGPathExposed = transformSVGPath;\n}\n\n\n\n\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092BoxGeometry\u3067\u8868\u73fe\u3059\u308b\n\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u306eGeojson\u304b\u3089BoxGeometry\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ngeojson\u306e\u7d4c\u5ea6\u7def\u5ea6\u3092BoxGeometry\u306ex,y\u306b\u6307\u5b9a\u3057\u3001\u7537\u3001\u5973\u306e\u4eba\u53e3\u6570\u3092z\u8ef8\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n    function createPopulationMesh(geodata) {\n      //geoJSON\u2192svg path\u2192three.js mesh\u5909\u63db    \n      var countries = [];\n      for (i = 0 ; i < geodata.length ; i++) {\n        var geoFeature = geodata[i];\n        console.log();\n        var properties = geoFeature.properties;\n\n        var extX = d3.extent(geoFeature.geometry.coordinates[0], function(d) { return d[0];});\n        var extY = d3.extent(geoFeature.geometry.coordinates[0], function(d) { return d[1];});\n        var ptMin = reverseProjection([extX[0], extY[0]]);\n        var ptMax = reverseProjection([extX[1], extY[1]]);\n\n        var vm = parseFloat(geoFeature.properties['\u7537']) /10000;\n        var vw = parseFloat(geoFeature.properties['\u5973']) /10000;\n\n        var geometry = new THREE.BoxGeometry(Math.abs(ptMax[0] - ptMin[0]), Math.abs(ptMax[1] - ptMin[1]), vm);\n        var material = new THREE.MeshLambertMaterial({\n          color:0x0000ff,\n          transparent: true,\n          opacity: 0.7\n        });\n        var mesh = new THREE.Mesh(geometry, material);\n        mesh.position.set(ptMin[0], ptMin[1], vm/2);\n        scene.add(mesh);\n\n        var geometry = new THREE.BoxGeometry(Math.abs(ptMax[0] - ptMin[0]), Math.abs(ptMax[1] - ptMin[1]), vw);\n        var material = new THREE.MeshLambertMaterial({\n          color:0xff0000,\n          transparent: true,\n          opacity: 0.7\n        });\n        var mesh = new THREE.Mesh(geometry, material);\n        mesh.position.set(ptMin[0], ptMin[1], vm + (vw/2));\n        scene.add(mesh);\n      }\n    }\n\n\n\u307e\u3068\u3081\nthree.js\u3092\u4f7f\u7528\u3059\u308c\u3070\u7c21\u5358\u306b3D\u8868\u73fe\u304c\u3067\u304d\u307e\u3059\u3002\nD3.js\u3092\u4f7f\u7528\u3057\u3066geojson\u3092SVG\u306b\u7c21\u5358\u306b\u5909\u63db\u3067\u304d\u307e\u3059\u3002\nD3.js\u3067\u4f5c\u6210\u3057\u305fSVG\u3092three.js\u3067\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001d3-threeD.js\u306e\u5185\u90e8\u95a2\u6570\u3001transformSVGPath\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u306f\uff13D\u3067\u8868\u73fe\u3059\u308b\u3088\u308a\u8272\u3067\u8868\u73fe\u3057\u305f\u65b9\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3063\u3066\u306f\u3063\u304d\u308a\u308f\u304b\u3093\u3060\u306d\u3002\n\u4ee5\u524d\u3001\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092Web\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3057\u307e\u3057\u305f\u3002\n\n **\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3(eStat)\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092Web\u30d6\u30e9\u30a6\u30b6\u3067\u8868\u793a\u3059\u308b\u65b9\u6cd5** \nhttp://qiita.com/mima_ita/items/38784095a146c87dcd23\n\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001three.js\u3092\u7528\u3044\u3066\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u30923D\u3067\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n **demo**\nhttp://needtec.sakura.ne.jp/threemap/mesh3d_example.html\n\n **\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9**\nhttps://github.com/mima3/threemap\n\n![3dmesh.png](https://qiita-image-store.s3.amazonaws.com/0/47856/61f38d87-abf0-b71a-dd7e-fe031bd78ad1.png)\n\n\n##\u6307\u5b9a\u7bc4\u56f2\u306e\u30c7\u30fc\u30bf\u3092JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3068\u3001\u56fd\u571f\u6570\u5024\u60c5\u5831\u306e\u884c\u653f\u533a\u57df\u3092\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u300c\u7d30\u304b\u3044\u3053\u3068\u306f\u3044\u3044\u3093\u3060\u3088\uff01\u4ffa\u306f\uff13D\u3067\u8868\u793a\u3057\u305f\u3044\u3093\u3060\uff01\u300d\u3063\u3066\u4eba\u306f\u3001\u4ee5\u4e0b\u306e\u547c\u3073\u51fa\u3057\u4f8b\u3092\u30b3\u30d4\u30da\u3059\u308c\u3070JSON\u304c\u53d6\u5f97\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n###\u6307\u5b9a\u306e\u7bc4\u56f2\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u307e\u305a\u3001\u653f\u5e9c\u7d71\u8a08\u7a93\u53e3\u306e\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092HTTP\u7d4c\u7531\u3067JSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n **\u547c\u3073\u51fa\u3057\u4f8b\uff1a** \nhttp://needtec.sakura.ne.jp/estat/json/get_mesh_stat_group_by_mesh?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81&stat_id=T000608\n\n **\u53d6\u5f97\u5185\u5bb9\uff1a** \n\n```json\n{\n  \"type\": \"FeatureCollection\", \n  \"features\": [\n    {\n      \"geometry\": {\n        \"type\": \"Polygon\", \n        \"coordinates\": [\n          [\n            [139.4124999999999, 35.45833333333333], \n            [139.4249999999999, 35.45833333333333], \n            [139.4249999999999, 35.46666666666666], \n            [139.4124999999999, 35.46666666666666], \n            [139.4124999999999, 35.45833333333333]\n          ]\n        ]\n      }, \n      \"type\": \"Feature\", \n      \"properties\": {\n        \"\u4e16\u5e2f\u7dcf\u6570\": \"5018\", \n        \"\u5973\": \"6093\", \"\\u4eba\\u53e3\\u7dcf\\u6570\": \"12349\", \n        \"\u7537\": \"6256\", \"area\": \"53391353\"\n      }\n    },// \u7565 \n  ]\n} \n```\n\n **\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9** \nhttps://github.com/mima3/estat\n\n\u3053\u306e\u5b9f\u88c5\u306fPython+bottle\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n###\u6307\u5b9a\u306e\u7bc4\u56f2\u306e\u884c\u653f\u533a\u57df\u3092GeoJSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u540c\u69d8\u306b\u56fd\u571f\u6570\u5024\u60c5\u5831\u306e\u884c\u653f\u533a\u57df\u3082\u7bc4\u56f2\u3092\u6307\u5b9a\u3057\u3066GeoJSON\u3067\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n **\u547c\u3073\u51fa\u3057\u4f8b\uff1a** \nhttp://needtec.sakura.ne.jp/kokudo/json/get_administrative_district_by_geometry?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81\n\n **\u53d6\u5f97\u5185\u5bb9\uff1a** \n\n```json\n{\n  \"type\": \"FeatureCollection\", \n  \"features\": [\n    {\n      \"geometry\": {\n        \"type\": \"Polygon\", \n        \"coordinates\": [\n          [\n            [139.4478029999999, 35.42797099999999], \n            [139.445154, 35.428581], // \u7565\n          ]\n        ]\n      }, \n      \"type\": \"Feature\", \n      \"properties\": {\n        \"prefectureName\": \"\\u795e\\u5948\\u5ddd\\u770c\", \n        \"administrativeAreaCode\": \"14218\", \n        \"cityName\": \"\\u7dbe\\u702c\\u5e02\", \n        \"countryName\": \"                    \", \n        \"subPrefectureName\": \"                    \", \n        \"PK_UID\": 94566\n      }\n    }, // \u7565\n  ]\n}\n```\n\n **\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9** \nhttps://github.com/mima3/kokudo\n\n\u3053\u306e\u5b9f\u88c5\u306fPython+bottle\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n##three.js\u3092\u4f7f\u7528\u3057\u30663D\u3067\u8868\u793a\u3059\u308b\n###D3.js\u3067\u8aad\u307f\u8fbc\u3093\u3060\u884c\u653f\u533a\u57df\u306eGeojson\u30923D\u8868\u793a\u3059\u308b\u3002\nGeojson\u3092D3.js\u3067\u8aad\u307f\u8fbc\u307f\u3001\u4f5c\u6210\u3055\u308c\u305fSVG\u3092three.js\u30673D\u8868\u793a\u3057\u307e\u3059\u3002\n\u3053\u306e\u65b9\u6cd5\u306f\u3001\u4e0b\u8a18\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\n\n **GUNMA GIS GEEK D3.js\u3067\u8aad\u307f\u8fbc\u3093\u3060geoJSON\u30c7\u30fc\u30bf\u3092three.js\u3092\u4f7f\u3063\u30663D\u8868\u793a\u3059\u308b\u3002** \nhttp://shimz.me/blog/d3-js/3137\n\n **Render geographic information in 3D with Three.js and D3.js** \nhttp://www.smartjava.org/content/render-geographic-information-3d-threejs-and-d3js\n\n\u307e\u305a\u3001JSON\u3092D3.js\u3092\u5229\u7528\u3057\u3066\u53d6\u5f97\u3057\u307e\u3059\u3002\n\u3053\u306e\u969b\u3001[async.js](https://github.com/caolan/async \"async.js\")\u3092\u7528\u3044\u3066\u4e26\u5217\u3067JSON\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n```js\nasync.parallel([\n  function (callback) {\n    d3.json(\"http://needtec.sakura.ne.jp/kokudo/json/get_administrative_district_by_geometry?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81\", function(json) {\n        callback(null, json);\n    });\n  },\n  function (callback) {\n    d3.json(\"http://needtec.sakura.ne.jp/estat/json/get_mesh_stat_group_by_mesh?swlat=35.45&swlng=139.4&nelat=35.7&nelng=139.81&stat_id=T000608\", function(json) {\n        callback(null, json);\n    });\n  }\n], function(err, results) {\n  // \u7565\n});\n```\n\n\u3053\u306e\u53d6\u5f97\u3057\u305fgeojson\u3092svg path\u306b\u5909\u63db\u3057\u3066\u3001\u305d\u306e\u5f8c\u3001three.js\u306b\u8868\u793a\u3057\u307e\u3059\u3002\n\n```js\n  function initScene() {\n    container = $('#map');\n\n    //\u30b7\u30fc\u30f3\u306e\u8ffd\u52a0\n    scene = new THREE.Scene();\n\n    //\u30ab\u30e1\u30e9\u306e\u8a2d\u5b9a\n    camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 1, 10000);\n    camera.position.set(-6.005123939520757, -6.754277108005312, 3.1756149676051133);\n    var target = new THREE.Vector3();\n    target.x = -7.162140160089945;\n    target.y = 0.42803104270646924;\n    target.z = -2.063747120298727;\n    //camera.lookAt(target); // TrackballControls\u4f7f\u7528\u4e2d\u306f\u52b9\u304b\u306a\u3044\n\n    scene.add(camera);\n\n    //\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u306e\u8a2d\u5b9a\n    var light = new THREE.DirectionalLight(0xffffff, 2);\n    light.position.set(-10, -20, 30).normalize();\n    scene.add(light);\n\n    light2 = new THREE.AmbientLight(0x333333);               \n    scene.add(light2);  \n\n    var projection = d3.geo.equirectangular()\n       .scale(900)\n       .translate([-2200, 560]);\n\n    //\u4e0a\u4e0b\u304c\u53cd\u8ee2\u3057\u3066\u3044\u308b\u306e\u3067\u30e0\u30ea\u304f\u308a\u5408\u308f\u305b\u308b\n    var reverseProjection = function(x, y) {\n      pt = projection(x, y);\n      pt[1] *= -1;\n      return pt;\n    };\n\n    //geoJSON\u306e\u30c7\u30fc\u30bf\u3092\u30d1\u30b9\u306b\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u4f5c\u6210\n    var path = d3.geo.path().projection(reverseProjection);\n\n    createAdministrativeDistrictMesh(results[0].features);\n    function createAdministrativeDistrictMesh(geodata) {\n      //geoJSON\u2192svg path\u2192three.js mesh\u5909\u63db    \n      var countries = [];\n      for (i = 0 ; i < geodata.length ; i++) {\n        var geoFeature = geodata[i];\n        var properties = geoFeature.properties;\n        var feature = path(geoFeature);\n\n        //svg\u30d1\u30b9\u3092three.js\u306emesh\u306b\u5909\u63db\n        var gmesh = transformSVGPathExposed(feature);\n        //console.log(properties, gmesh);\n        countries.push({\"data\": properties, \"mesh\": gmesh});\n      }\n\n      //mesh\u8ffd\u52a0\n      for (i = 0 ; i < countries.length ; i++) {\n      \n          var material = new THREE.MeshLambertMaterial({color:0x888888});\n          \n          var shape3d = countries[i].mesh.extrude({\n              amount: 0,\n              bevelEnabled: false\n          });\n\n          var toAdd = new THREE.Mesh(shape3d, material);\n          //toAdd.rotation.x = 60;\n          scene.add(toAdd);\n      }\n    }\n```\n\nsvg path\u304b\u3089three.js\u3078\u306e\u5909\u63db\u306f\u4e0b\u8a18\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n **d3-threeD** \nhttps://github.com/asutherland/d3-threeD\n\n\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306b\u306ftransformSVGPath\u3068\u3044\u3046\u5185\u90e8\u95a2\u6570\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u95a2\u6570\u304csvg path\u304b\u3089three.js\u306e\u30b8\u30aa\u30e1\u30c8\u30ea\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u95a2\u6570\u306f\u5185\u90e8\u95a2\u6570\u306e\u305f\u3081\u3001d3-threeD.js\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u5916\u90e8\u304b\u3089\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```js:d3-threeD.js\n/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this file,\n * You can obtain one at http://mozilla.org/MPL/2.0/. */\nvar transformSVGPathExposed;\n\nfunction d3threeD(exports) {\n// \u7565\ntransformSVGPathExposed = transformSVGPath;\n}\n```\n\n\n###\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u3092BoxGeometry\u3067\u8868\u73fe\u3059\u308b\n\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u306eGeojson\u304b\u3089BoxGeometry\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ngeojson\u306e\u7d4c\u5ea6\u7def\u5ea6\u3092BoxGeometry\u306ex,y\u306b\u6307\u5b9a\u3057\u3001\u7537\u3001\u5973\u306e\u4eba\u53e3\u6570\u3092z\u8ef8\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n```js\n    function createPopulationMesh(geodata) {\n      //geoJSON\u2192svg path\u2192three.js mesh\u5909\u63db    \n      var countries = [];\n      for (i = 0 ; i < geodata.length ; i++) {\n        var geoFeature = geodata[i];\n        console.log();\n        var properties = geoFeature.properties;\n\n        var extX = d3.extent(geoFeature.geometry.coordinates[0], function(d) { return d[0];});\n        var extY = d3.extent(geoFeature.geometry.coordinates[0], function(d) { return d[1];});\n        var ptMin = reverseProjection([extX[0], extY[0]]);\n        var ptMax = reverseProjection([extX[1], extY[1]]);\n\n        var vm = parseFloat(geoFeature.properties['\u7537']) /10000;\n        var vw = parseFloat(geoFeature.properties['\u5973']) /10000;\n\n        var geometry = new THREE.BoxGeometry(Math.abs(ptMax[0] - ptMin[0]), Math.abs(ptMax[1] - ptMin[1]), vm);\n        var material = new THREE.MeshLambertMaterial({\n          color:0x0000ff,\n          transparent: true,\n          opacity: 0.7\n        });\n        var mesh = new THREE.Mesh(geometry, material);\n        mesh.position.set(ptMin[0], ptMin[1], vm/2);\n        scene.add(mesh);\n\n        var geometry = new THREE.BoxGeometry(Math.abs(ptMax[0] - ptMin[0]), Math.abs(ptMax[1] - ptMin[1]), vw);\n        var material = new THREE.MeshLambertMaterial({\n          color:0xff0000,\n          transparent: true,\n          opacity: 0.7\n        });\n        var mesh = new THREE.Mesh(geometry, material);\n        mesh.position.set(ptMin[0], ptMin[1], vm + (vw/2));\n        scene.add(mesh);\n      }\n    }\n```\n\n###\u307e\u3068\u3081\nthree.js\u3092\u4f7f\u7528\u3059\u308c\u3070\u7c21\u5358\u306b3D\u8868\u73fe\u304c\u3067\u304d\u307e\u3059\u3002\nD3.js\u3092\u4f7f\u7528\u3057\u3066geojson\u3092SVG\u306b\u7c21\u5358\u306b\u5909\u63db\u3067\u304d\u307e\u3059\u3002\nD3.js\u3067\u4f5c\u6210\u3057\u305fSVG\u3092three.js\u3067\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u306b\u306f\u3001d3-threeD.js\u306e\u5185\u90e8\u95a2\u6570\u3001transformSVGPath\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n~~\u5730\u57df\u30e1\u30c3\u30b7\u30e5\u306f\uff13D\u3067\u8868\u73fe\u3059\u308b\u3088\u308a\u8272\u3067\u8868\u73fe\u3057\u305f\u65b9\u304c\u308f\u304b\u308a\u3084\u3059\u3044\u3063\u3066\u306f\u3063\u304d\u308a\u308f\u304b\u3093\u3060\u306d\u3002~~\n\n", "tags": ["JavaScript", "three.js", "d3.js"]}