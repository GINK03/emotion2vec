{"context": "sshpass\u3092\u4f7f\u7528\u3057\u3066\u3001subversion\u30b5\u30fc\u30d0\u304b\u3089\u3001\u5225\u306e\u30db\u30b9\u30c8\u306bsvn update\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\u7b46\u8005\u74b0\u5883\u3067\u306fOS\u306fCentOS6.7\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\nsshpass\u306f\u4fbf\u5229\u3067\u3059\u304c\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u554f\u984c\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u516c\u958b\u9375\u8a8d\u8a3c\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nsshpass\u3092\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002(epel\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308a\u307e\u3059)\nsvn\u30b5\u30fc\u30d0\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306ehooks\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b\u3001post-commit.tmpl\u3092post-commit\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u3001\u5909\u6570\u306b\u5fc5\u8981\u306a\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30b5\u30fc\u30d0\u540d\u3092\u5165\u308c\u307e\u3059\u3002\n\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u5074\u306e\u30db\u30b9\u30c8\u306e\u3001sshpass\u63a5\u7d9a\u30e6\u30fc\u30b6\u306e\".subversion/config\"\u30d5\u30a1\u30a4\u30eb\u306e[auth]\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u4fdd\u5b58\u306e\u554f\u3044\u5408\u308f\u305b\u3092\u3057\u306a\u3044\u8a2d\u5b9a\u3092\u5165\u308c\u307e\u3059\u3002\n\n\n~/.subversion/config\n[auth]\nstore-passwords = no\nstore-plaintext-passwords = no\n\n\n\npost-commit\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n\u5b9f\u969b\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u30b3\u30df\u30c3\u30c8\u3057\u3066\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n\u4e0b\u8a18\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001post-commit\u306e\u30ed\u30b0\u306f/var/log/svn/post-commit.log\u306b\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002\n\n/var/svn/repos/target_repos/hooks/post-commit\nREPOS=\"$1\"\nREV=\"$2\"\n\n#Deploy target server's info.\nDEPLOY_SERVER=\"user_name@target.server\"\nDEPLOY_SERVER_PASS=\"password\"\n#Sub version user's info for svn update.\nSVNUSER=\"svn_user_name\"\nSVNPASS=\"svn_user_pass\"\nSVN_UPDATE_DIR=/var/www/html/svn_update_dir/\nHOOK_BRANCH=\"trunk\"\nSVNOPTS=\"--username $SVNUSER --password $SVNPASS\"\n#Log file path.\nLOG=/var/log/svn/post-commit.log\n\n#Pick up changed files.\nCHANGED_FILES=`svnlook changed -r $REV $REPOS`\n\n#svn update on target server.\n#Affect only hook branch.\nif echo $CHANGED_FILES | grep $HOOK_BRANCH > /dev/null; then\n    echo \"--- `date` deploy started.\" >> $LOG\n    echo \"deploy target server: $DEPLOY_SERVER\" >> $LOG\n    echo \"repos and rev: $REPOS $REV\" >> $LOG\n    #svn update on server using sshpass.\n    RESULT=`sshpass -p $DEPLOY_SERVER_PASS ssh -o StrictHostKeyChecking=no $DEPLOY_SERVER svn $SVNOPTS update $SVN_UPDATE_DIR`\n    echo \"svn update result: $RESULT\" >> $LOG\n    echo \"--- `date` deploy ended.\" >> $LOG\nfi\n\n\nsshpass\u3092\u4f7f\u7528\u3057\u3066\u3001subversion\u30b5\u30fc\u30d0\u304b\u3089\u3001\u5225\u306e\u30db\u30b9\u30c8\u306bsvn update\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30d7\u30ed\u30a4\u3057\u307e\u3059\u3002\n\u7b46\u8005\u74b0\u5883\u3067\u306fOS\u306fCentOS6.7\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\n\nsshpass\u306f\u4fbf\u5229\u3067\u3059\u304c\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e0a\u306e\u554f\u984c\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u516c\u958b\u9375\u8a8d\u8a3c\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- sshpass\u3092\u4e21\u65b9\u306e\u30b5\u30fc\u30d0\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002(epel\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u3042\u308a\u307e\u3059)\n- svn\u30b5\u30fc\u30d0\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u5185\u306ehooks\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u3042\u308b\u3001post-commit.tmpl\u3092post-commit\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n- \u4e0b\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8cbc\u308a\u4ed8\u3051\u3066\u3001\u5909\u6570\u306b\u5fc5\u8981\u306a\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30b5\u30fc\u30d0\u540d\u3092\u5165\u308c\u307e\u3059\u3002\n- \u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u5074\u306e\u30db\u30b9\u30c8\u306e\u3001sshpass\u63a5\u7d9a\u30e6\u30fc\u30b6\u306e\".subversion/config\"\u30d5\u30a1\u30a4\u30eb\u306e[auth]\u30bb\u30af\u30b7\u30e7\u30f3\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u4fdd\u5b58\u306e\u554f\u3044\u5408\u308f\u305b\u3092\u3057\u306a\u3044\u8a2d\u5b9a\u3092\u5165\u308c\u307e\u3059\u3002\n\n```bash:~/.subversion/config\n[auth]\nstore-passwords = no\nstore-plaintext-passwords = no\n```\n\n- post-commit\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5b9f\u884c\u6a29\u9650\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\n- \u5b9f\u969b\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u30b3\u30df\u30c3\u30c8\u3057\u3066\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n\u4e0b\u8a18\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001post-commit\u306e\u30ed\u30b0\u306f/var/log/svn/post-commit.log\u306b\u51fa\u529b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n```bash:/var/svn/repos/target_repos/hooks/post-commit\nREPOS=\"$1\"\nREV=\"$2\"\n\n#Deploy target server's info.\nDEPLOY_SERVER=\"user_name@target.server\"\nDEPLOY_SERVER_PASS=\"password\"\n#Sub version user's info for svn update.\nSVNUSER=\"svn_user_name\"\nSVNPASS=\"svn_user_pass\"\nSVN_UPDATE_DIR=/var/www/html/svn_update_dir/\nHOOK_BRANCH=\"trunk\"\nSVNOPTS=\"--username $SVNUSER --password $SVNPASS\"\n#Log file path.\nLOG=/var/log/svn/post-commit.log\n\n#Pick up changed files.\nCHANGED_FILES=`svnlook changed -r $REV $REPOS`\n\n#svn update on target server.\n#Affect only hook branch.\nif echo $CHANGED_FILES | grep $HOOK_BRANCH > /dev/null; then\n    echo \"--- `date` deploy started.\" >> $LOG\n    echo \"deploy target server: $DEPLOY_SERVER\" >> $LOG\n    echo \"repos and rev: $REPOS $REV\" >> $LOG\n    #svn update on server using sshpass.\n    RESULT=`sshpass -p $DEPLOY_SERVER_PASS ssh -o StrictHostKeyChecking=no $DEPLOY_SERVER svn $SVNOPTS update $SVN_UPDATE_DIR`\n    echo \"svn update result: $RESULT\" >> $LOG\n    echo \"--- `date` deploy ended.\" >> $LOG\nfi\n```\n\n", "tags": ["Subversion", "CentOS"]}