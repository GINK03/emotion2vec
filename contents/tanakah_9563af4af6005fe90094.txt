{"context": "\u3053\u306e\u3042\u305f\u308a\u304b\u3089Win32API\u95a2\u9023\u60c5\u5831\u304c\u9014\u7aef\u306b\u5c11\u306a\u304f\u306a\u3063\u3066\u56f0\u3063\u3066\u304f\u308b\uff57\n\u30a2\u30eb\u30d5\u30a1\u5024\u4ed8\u304d\u306ePNG\u753b\u50cf(\u8981\u3059\u308b\u306b\u900f\u660e\u80cc\u666f\u306e\u753b\u50cf)\u3092\u30dc\u30bf\u30f3\u306b\u8cbc\u308a\u4ed8\u3051\u308b\n\u306b\u306f\u3001GDI+\u3067\u8aad\u307f\u8fbc\u3093\u3060\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\nLoadPNGFromResource()\u306f\u3001\u9069\u5f53\u306b\u30b0\u30b0\u3063\u3066\u62fe\u3063\u3066\u6539\u5909\u3057\u305f\u3082\u306e\u3002\n\nGdiplus::Bitmap* LoadPNGFromResource(UINT pResourceID, LPCTSTR pResourceType,\n                                     HMODULE hInstance=NULL)\n{\n  LPCTSTR pResourceName=MAKEINTRESOURCE(pResourceID);\n  HRSRC hResource=FindResource(hInstance, pResourceName, pResourceType);\n  if(!hResource) return NULL;\n\n  DWORD dwResourceSize=SizeofResource(hInstance, hResource);\n  const void* pResourceData=LockResource(LoadResource(hInstance, hResource));\n  HGLOBAL hResourceBuffer=GlobalAlloc(GMEM_MOVEABLE, dwResourceSize);\n  void* pResourceBuffer=GlobalLock(hResourceBuffer);\n  CopyMemory(pResourceBuffer, pResourceData, dwResourceSize);\n  IStream* pIStream=NULL;\n  if(CreateStreamOnHGlobal(hResourceBuffer, FALSE, &pIStream)==S_OK){\n    Gdiplus::Bitmap *pBitmap=Gdiplus::Bitmap::FromStream(pIStream);\n    pIStream->Release();\n    GlobalUnlock(hResourceBuffer);\n    GlobalFree(hResourceBuffer);\n    return pBitmap;\n  }\n}\n\n      Gdiplus::Bitmap* pImg;\n      HICON hicon1;\n\n      pImg=LoadPNGFromResource(IDR_PNG_1, \"PNG\", hAppInstance);\n      if(pImg!=NULL){\n        pImg->GetHICON(&hicon1);\n        SendMessage(GetDlgItem(hdlg, IDC_BUTTON_TEST),\n                    BM_SETIMAGE, IMAGE_ICON, (LPARAM)hicon1);\n        delete pImg;\n      }\n...\n      DestroyIcon(hicon1);\n\n\u3053\u306e\u3042\u305f\u308a\u304b\u3089Win32API\u95a2\u9023\u60c5\u5831\u304c\u9014\u7aef\u306b\u5c11\u306a\u304f\u306a\u3063\u3066\u56f0\u3063\u3066\u304f\u308b\uff57\n\n\u30a2\u30eb\u30d5\u30a1\u5024\u4ed8\u304d\u306ePNG\u753b\u50cf(\u8981\u3059\u308b\u306b\u900f\u660e\u80cc\u666f\u306e\u753b\u50cf)\u3092\u30dc\u30bf\u30f3\u306b\u8cbc\u308a\u4ed8\u3051\u308b\n\u306b\u306f\u3001GDI+\u3067\u8aad\u307f\u8fbc\u3093\u3060\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\n\nLoadPNGFromResource()\u306f\u3001\u9069\u5f53\u306b\u30b0\u30b0\u3063\u3066\u62fe\u3063\u3066\u6539\u5909\u3057\u305f\u3082\u306e\u3002\n\n```\n\nGdiplus::Bitmap* LoadPNGFromResource(UINT pResourceID, LPCTSTR pResourceType,\n                                     HMODULE hInstance=NULL)\n{\n  LPCTSTR pResourceName=MAKEINTRESOURCE(pResourceID);\n  HRSRC hResource=FindResource(hInstance, pResourceName, pResourceType);\n  if(!hResource) return NULL;\n\n  DWORD dwResourceSize=SizeofResource(hInstance, hResource);\n  const void* pResourceData=LockResource(LoadResource(hInstance, hResource));\n  HGLOBAL hResourceBuffer=GlobalAlloc(GMEM_MOVEABLE, dwResourceSize);\n  void* pResourceBuffer=GlobalLock(hResourceBuffer);\n  CopyMemory(pResourceBuffer, pResourceData, dwResourceSize);\n  IStream* pIStream=NULL;\n  if(CreateStreamOnHGlobal(hResourceBuffer, FALSE, &pIStream)==S_OK){\n    Gdiplus::Bitmap *pBitmap=Gdiplus::Bitmap::FromStream(pIStream);\n    pIStream->Release();\n    GlobalUnlock(hResourceBuffer);\n    GlobalFree(hResourceBuffer);\n    return pBitmap;\n  }\n}\n\n      Gdiplus::Bitmap* pImg;\n      HICON hicon1;\n\n      pImg=LoadPNGFromResource(IDR_PNG_1, \"PNG\", hAppInstance);\n      if(pImg!=NULL){\n        pImg->GetHICON(&hicon1);\n        SendMessage(GetDlgItem(hdlg, IDC_BUTTON_TEST),\n                    BM_SETIMAGE, IMAGE_ICON, (LPARAM)hicon1);\n        delete pImg;\n      }\n...\n      DestroyIcon(hicon1);\n```\n", "tags": ["Win32API"]}