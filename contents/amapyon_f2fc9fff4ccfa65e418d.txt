{"tags": ["Java", "EV3", "leJOS", "bluetooth"], "context": "EV\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u63a5\u7d9a\u3057\u3001\u30c7\u30fc\u30bf\u3092\u9001\u53d7\u4fe1\u3057\u307e\u3059\u3002\n\u4e8b\u524d\u306bEV3\u3068\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u52d5\u304b\u3059PC\u3092\u30da\u30a2\u30ea\u30f3\u30b0\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\nBlueCov\u3092\u30d3\u30eb\u30c9\u30d1\u30b9\u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u52d5\u4f5c\u78ba\u8a8d\u74b0\u5883\n\nSurfece Pro 4\nWindows 10 pro 64bit\nbluecov-2.1.0.jar\nEV3 lejos 0.9.1 beta\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\n\nBtPcClient.java\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\n\nimport javax.microedition.io.Connection;\nimport javax.microedition.io.Connector;\nimport javax.microedition.io.InputConnection;\nimport javax.microedition.io.OutputConnection;\n\n\npublic class BtPcClient {\n\n    public static void main(String[] args) throws Exception {\n        int sendMessageNo = 2; // \u9001\u4fe1\u3059\u308b\u756a\u53f7\n        int recvMessageNo = 3; // \u53d7\u4fe1\u3059\u308b\u756a\u53f7\n\n        // \u30b5\u30fc\u30d0\u30fc\u5074EV3\u306eBluetooth\u306eMAC\u30a2\u30c9\u30ec\u30b9\u3001\u30c1\u30e3\u30cd\u30eb=1\n        String connectionURL = \"btspp://001653999999:1\";\n\n        System.out.println(\"Connecting...\");\n\n        // \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3059\u308b\n        Connection connection = Connector.open(connectionURL);\n        if (connection == null) {\n            System.out.println(\"Connect fail\");\n            System.exit(1);\n        }\n        System.out.println(\"Connected\");\n\n\n        // \u8aad\u307f\u3001\u66f8\u304d\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u53d6\u5f97\u3059\u308b\n        OutputStream os = ((OutputConnection)connection).openOutputStream();\n        InputStream is = ((InputConnection)connection).openInputStream();\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n        System.out.println(\"Sending...\");\n        send(os, sendMessageNo);\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\n        System.out.println(\"Receivng...\");\n        if (isReceived(is, recvMessageNo)) {\n            System.out.println(\"Receive success\");\n        } else {\n            System.out.println(\"Receive fail\");\n        }\n\n        // \u901a\u4fe1\u306e\u5207\u65ad\u3092\u884c\u3046\n        System.out.println(\"Closing...\");\n        try {\n            if (null != connection) {\n                os.close();\n                is.close();\n                connection.close();\n            }\n        } catch (Exception ioe) {\n        }\n\n        System.out.println(\"Finished\");\n\n    }\n\n    // \u9001\u4fe1\u3059\u308b\n    static void send(OutputStream os, int messageNo) {\n        byte[] sendBuff = new byte[16];\n        for (int i = 0; i < sendBuff.length; i++) {\n            sendBuff[i] = (byte) messageNo;\n        }\n        try {\n            os.write(sendBuff);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n\n    // \u6307\u5b9a\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u756a\u53f7\u3092\u53d7\u4fe1\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b\n    static boolean isReceived(InputStream is, int messageNo) {\n        byte[] recvBuff = receive(is);\n        for (int i = 0; i < recvBuff.length; i++) {\n            System.out.print(recvBuff[i]);\n            if (recvBuff[i] != (byte) messageNo) {\n                System.out.println();\n                return false;\n            }\n        }\n        System.out.println();\n        return true;\n    }\n\n    // \u53d7\u4fe1\u3059\u308b\n    static byte[] receive(InputStream is) {\n        byte[] recvBuff = new byte[16];\n        try {\n            is.read(recvBuff);\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n        return recvBuff;\n    }\n\n}\n\n\n\n[EV\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u30d7\u30ed\u30b0\u30e9\u30e0](http://qiita.com/amapyon/items/e6ed3cf83dbaa3893726#%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E5%81%B4)\u306b\u63a5\u7d9a\u3057\u3001\u30c7\u30fc\u30bf\u3092\u9001\u53d7\u4fe1\u3057\u307e\u3059\u3002\n\u4e8b\u524d\u306bEV3\u3068\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u52d5\u304b\u3059PC\u3092\u30da\u30a2\u30ea\u30f3\u30b0\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n[BlueCov](http://bluecove.org/)\u3092\u30d3\u30eb\u30c9\u30d1\u30b9\u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\u74b0\u5883\n\n * Surfece Pro 4\n * Windows 10 pro 64bit\n * bluecov-2.1.0.jar\n * EV3 lejos 0.9.1 beta\n\n#\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\n```BtPcClient.java\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\n\nimport javax.microedition.io.Connection;\nimport javax.microedition.io.Connector;\nimport javax.microedition.io.InputConnection;\nimport javax.microedition.io.OutputConnection;\n\n\npublic class BtPcClient {\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tint sendMessageNo = 2; // \u9001\u4fe1\u3059\u308b\u756a\u53f7\n\t\tint recvMessageNo = 3; // \u53d7\u4fe1\u3059\u308b\u756a\u53f7\n\t\t\n\t\t// \u30b5\u30fc\u30d0\u30fc\u5074EV3\u306eBluetooth\u306eMAC\u30a2\u30c9\u30ec\u30b9\u3001\u30c1\u30e3\u30cd\u30eb=1\n\t\tString connectionURL = \"btspp://001653999999:1\";\n\n\t\tSystem.out.println(\"Connecting...\");\n\n\t\t// \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u30c7\u30d0\u30a4\u30b9\u304b\u3089\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u53d6\u5f97\u3059\u308b\n\t\tConnection connection = Connector.open(connectionURL);\n\t\tif (connection == null) {\n\t\t\tSystem.out.println(\"Connect fail\");\n\t\t\tSystem.exit(1);\n\t\t}\n\t\tSystem.out.println(\"Connected\");\n\n\n\t\t// \u8aad\u307f\u3001\u66f8\u304d\u306e\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u53d6\u5f97\u3059\u308b\n\t\tOutputStream os = ((OutputConnection)connection).openOutputStream();\n\t\tInputStream is = ((InputConnection)connection).openInputStream();\n\t\t\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3059\u308b\n\t\tSystem.out.println(\"Sending...\");\n\t\tsend(os, sendMessageNo);\n\t\t\n\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u53d7\u4fe1\u3059\u308b\n\t\tSystem.out.println(\"Receivng...\");\n\t\tif (isReceived(is, recvMessageNo)) {\n\t\t\tSystem.out.println(\"Receive success\");\n\t\t} else {\n\t\t\tSystem.out.println(\"Receive fail\");\n\t\t}\n\t\t\n\t\t// \u901a\u4fe1\u306e\u5207\u65ad\u3092\u884c\u3046\n\t\tSystem.out.println(\"Closing...\");\n\t\ttry {\n\t\t\tif (null != connection) {\n\t\t\t\tos.close();\n\t\t\t\tis.close();\n\t\t\t\tconnection.close();\n\t\t\t}\n\t\t} catch (Exception ioe) {\n\t\t}\n\n\t\tSystem.out.println(\"Finished\");\n\n\t}\n\t\n\t// \u9001\u4fe1\u3059\u308b\n\tstatic void send(OutputStream os, int messageNo) {\n\t\tbyte[] sendBuff = new byte[16];\n\t\tfor (int i = 0; i < sendBuff.length; i++) {\n\t\t\tsendBuff[i] = (byte) messageNo;\n\t\t}\n\t\ttry {\n\t\t\tos.write(sendBuff);\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\t\n\t// \u6307\u5b9a\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u756a\u53f7\u3092\u53d7\u4fe1\u3067\u304d\u3066\u3044\u308b\u304b\u3092\u5224\u5b9a\u3059\u308b\n\tstatic boolean isReceived(InputStream is, int messageNo) {\n\t\tbyte[] recvBuff = receive(is);\n\t\tfor (int i = 0; i < recvBuff.length; i++) {\n\t\t\tSystem.out.print(recvBuff[i]);\n\t\t\tif (recvBuff[i] != (byte) messageNo) {\n\t\t\t\tSystem.out.println();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tSystem.out.println();\n\t\treturn true;\n\t}\n\t\n\t// \u53d7\u4fe1\u3059\u308b\n\tstatic byte[] receive(InputStream is) {\n\t\tbyte[] recvBuff = new byte[16];\n\t\ttry {\n\t\t\tis.read(recvBuff);\n\t\t} catch (IOException e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t\treturn recvBuff;\n\t}\n\n}\n\n```\n"}