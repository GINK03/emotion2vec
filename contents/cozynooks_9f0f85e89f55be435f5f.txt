{"tags": ["rbenv", "chef", "CentOS"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002Apache + Passenger + Rails + PostgreSQL \u3068\u3044\u3046\u69cb\u6210\u306e\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u308a\u305f\u3044\u3002\n\u307e\u305a\u306fRuby\u3092\u5165\u308c\u308b\u3068\u3053\u308d\u304b\u3089\u3002Ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u3048\u308b\u3053\u3068\u306f\u3057\u306a\u3044\u3068\u306f\u601d\u3044\u307e\u3059\u304c\u3001rbenv\u3092\u4f7f\u3063\u3066Ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u308a\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305a\nGit\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u5834\u5408Git\u3068ruby-devel\u304c\u5fc5\u8981\u3067\u3059\u306e\u3067\n%w{git ruby-devel}.each do |pkg|\n  package pkg do\n    action :install\n  end\nend\n\nrbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fGithub\u304b\u3089\u306eclone\u306b\u306a\u308b\u306e\u3067\ngit \"/usr/local/rbenv\" do\n  repository \"git://github.com/sstephenson/rbenv.git\"\n  reference \"master\"\n  # action :sync\n  action :checkout\nend\n\n/usr/local/rbenv\u306bclone\u3057\u307e\u3059\u3002\n/usr/local\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306f\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067\u4f7f\u7528\u3057\u305f\u3044\u304b\u3089\u3068\u3044\u3046\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\nRuby\u3092\u5165\u308c\u308b\u306e\u306b\u5fc5\u8981\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nbash \"add-directory-for-rbenv\" do\n  code <<-EOC\n    mkdir /usr/local/rbenv/shims /usr/local/rbenv/versions usr/local/rbenv/plugins\n    groupadd rbenv\n    chgrp -R rbenv /usr/local/rbenv\n    chmod -R g+rwxXs /usr/local/rbenv\n  EOC\nend\n\n\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9\u3092\u305d\u306e\u307e\u307e\u66f8\u3044\u3066\u3044\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n/usr/local/rbenv/\u306e\u4e0b\u306bshims versions \u305d\u3057\u3066ruby-build\u3092rbenv\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u3044\u308c\u308b\u306e\u3067plugins\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nrbenv\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u306e\u8ffd\u52a0\u3068\u305d\u306e\u30b0\u30eb\u30fc\u30d7\u306b/usr/local/rbenv\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u4e0e\u3048\u307e\u3059\u3002\nruby-build\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\ngit \"/usr/local/rbenv/plugins/ruby-build\" do\n  repository \"git://github.com/sstephenson/ruby-build.git\"\n  reference \"master\"\n  # action :sync\n  action :checkout\nend\n\n\u5148\u307b\u3069\u4f5c\u3063\u305fplugins\u30d5\u30a9\u30eb\u30c0\u306bclone\u3059\u308b\u3060\u3051\u3067\u3059\u3002\nRuby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nbash \"rbenv\" do\n  code <<-EOC\n    echo 'export RBENV_ROOT=\"/usr/local/rbenv\"' >> /etc/profile.d/rbenv.sh\n    echo 'export PATH=\"/usr/local/rbenv/bin:$PATH\"' >> /etc/profile.d/rbenv.sh\n    echo 'eval \"$(rbenv init -)\"' >> /etc/profile.d/rbenv.sh\n    source /etc/profile.d/rbenv.sh\n    rbenv install #{node['rbenv']['version']}\n    rbenv global #{node['rbenv']['version']}\n    rbenv versions\n    rbenv rehash\n  EOC\nend\n\n\u3053\u3053\u3082\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u30d0\u30ea\u30d0\u30ea\u3067\u3059\u3002\nChef\u3044\u3089\u3093\u304f\u306d\uff1f\u3063\u3066\u3044\u3046\u306e\u306f\u8a00\u3044\u3063\u3053\u306a\u3057\u3067\u3059\u3002\n\u5b9f\u884c\u6642\u306ejson\u306f\n{\n    \"rbenv\": {\n        \"version\": \"2.0.0-p353\"\n    },\n    \"run_list\":[\n        \"recipe[rbenv]\"\n    ]\n}\n\n\u3068\u3057\u3066Ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\u53c2\u8003\uff1a\nhttp://nomnel.net/blog/centos-system-wide-rbenv-and-ruby-build/\nnomnel\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01\nApache + Passenger + Rails + PostgreSQL \u3068\u3044\u3046\u69cb\u6210\u306e\u30b5\u30fc\u30d0\u3092\u4f5c\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u308a\u305f\u3044\u3002\n\n\u307e\u305a\u306fRuby\u3092\u5165\u308c\u308b\u3068\u3053\u308d\u304b\u3089\u3002Ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3054\u3068\u306b\u5909\u3048\u308b\u3053\u3068\u306f\u3057\u306a\u3044\u3068\u306f\u601d\u3044\u307e\u3059\u304c\u3001rbenv\u3092\u4f7f\u3063\u3066Ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30ec\u30b7\u30d4\u3092\u4f5c\u308a\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u307e\u305a\nGit\u304c\u5165\u3063\u3066\u3044\u306a\u3044\u5834\u5408Git\u3068ruby-devel\u304c\u5fc5\u8981\u3067\u3059\u306e\u3067\n\n```ruby\n%w{git ruby-devel}.each do |pkg|\n  package pkg do\n    action :install\n  end\nend\n```\n\nrbenv\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306fGithub\u304b\u3089\u306eclone\u306b\u306a\u308b\u306e\u3067\n\n```ruby\ngit \"/usr/local/rbenv\" do\n  repository \"git://github.com/sstephenson/rbenv.git\"\n  reference \"master\"\n  # action :sync\n  action :checkout\nend\n```\n\n/usr/local/rbenv\u306bclone\u3057\u307e\u3059\u3002\n/usr/local\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u306e\u306f\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u3067\u4f7f\u7528\u3057\u305f\u3044\u304b\u3089\u3068\u3044\u3046\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\n\nRuby\u3092\u5165\u308c\u308b\u306e\u306b\u5fc5\u8981\u306a\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```ruby\nbash \"add-directory-for-rbenv\" do\n  code <<-EOC\n    mkdir /usr/local/rbenv/shims /usr/local/rbenv/versions usr/local/rbenv/plugins\n    groupadd rbenv\n    chgrp -R rbenv /usr/local/rbenv\n    chmod -R g+rwxXs /usr/local/rbenv\n  EOC\nend\n```\n\n\u30b7\u30a7\u30eb\u30b3\u30de\u30f3\u30c9\u3092\u305d\u306e\u307e\u307e\u66f8\u3044\u3066\u3044\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n/usr/local/rbenv/\u306e\u4e0b\u306bshims versions \u305d\u3057\u3066ruby-build\u3092rbenv\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u3057\u3066\u3044\u308c\u308b\u306e\u3067plugins\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nrbenv\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u306e\u8ffd\u52a0\u3068\u305d\u306e\u30b0\u30eb\u30fc\u30d7\u306b/usr/local/rbenv\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u4e0e\u3048\u307e\u3059\u3002\n\nruby-build\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\n\n```ruby\ngit \"/usr/local/rbenv/plugins/ruby-build\" do\n  repository \"git://github.com/sstephenson/ruby-build.git\"\n  reference \"master\"\n  # action :sync\n  action :checkout\nend\n```\n\n\u5148\u307b\u3069\u4f5c\u3063\u305fplugins\u30d5\u30a9\u30eb\u30c0\u306bclone\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\nRuby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```ruby\nbash \"rbenv\" do\n  code <<-EOC\n    echo 'export RBENV_ROOT=\"/usr/local/rbenv\"' >> /etc/profile.d/rbenv.sh\n    echo 'export PATH=\"/usr/local/rbenv/bin:$PATH\"' >> /etc/profile.d/rbenv.sh\n    echo 'eval \"$(rbenv init -)\"' >> /etc/profile.d/rbenv.sh\n    source /etc/profile.d/rbenv.sh\n    rbenv install #{node['rbenv']['version']}\n    rbenv global #{node['rbenv']['version']}\n    rbenv versions\n    rbenv rehash\n  EOC\nend\n```\n\n\u3053\u3053\u3082\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u30d0\u30ea\u30d0\u30ea\u3067\u3059\u3002\nChef\u3044\u3089\u3093\u304f\u306d\uff1f\u3063\u3066\u3044\u3046\u306e\u306f\u8a00\u3044\u3063\u3053\u306a\u3057\u3067\u3059\u3002\n\n\u5b9f\u884c\u6642\u306ejson\u306f\n\n```json\n{\n    \"rbenv\": {\n        \"version\": \"2.0.0-p353\"\n    },\n    \"run_list\":[\n        \"recipe[rbenv]\"\n    ]\n}\n```\n\n\u3068\u3057\u3066Ruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\n\u53c2\u8003\uff1a\nhttp://nomnel.net/blog/centos-system-wide-rbenv-and-ruby-build/\nnomnel\u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff01"}