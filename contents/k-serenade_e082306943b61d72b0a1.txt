{"context": " More than 1 year has passed since last update.\u3044\u3088\u3044\u3088\u4eca\u56de\u306f\u3001playbook \u3067 LAMP \u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\n\n\u4eca\u56de\u306e\u30c8\u30d4\u30c3\u30af\u30b9\n\n\u4eca\u56de\u3067 LAMP \u74b0\u5883\u306f\u5b8c\u6210\u3057\u306a\u3044\uff01\nMariaDB \u306e\u305b\u3044\u3067 MySQL5.7 \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044\uff01\n\n\nplaybook \u3092\u4f5c\u6210\nLAMP\u74b0\u5883\u306e playbook \u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n- hosts: DevServer1\n  become: yes\n  tasks:\n    #\n    # \u30b7\u30b9\u30c6\u30e0\n    #\n    - name: OS \u6700\u65b0\u5316\n      yum: name=* state=latest\n\n    - name: DeveloperTool \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=\"@Development tools\"\n\n    - name: vim \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=vim\n\n    #\n    # Apache\n    #\n    - name: Apache \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=httpd\n\n    - name: Apache \u8d77\u52d5\n      service: name=httpd state=started enabled=yes\n\n    - name: .htaccess\u3092\u6709\u52b9\u306b\u3059\u308b\n      replace:\n        dest=/etc/httpd/conf/httpd.conf\n        regexp='AllowOverride None'\n        replace='AllowOverride All'\n      notify:\n        - restart httpd\n\n    #\n    # PHP\n    #\n    - name: PHP\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name={{item}}\n      with_items:\n        - php\n        - php-mbstring\n        - php-mysql\n\n    - name: PHP\u3092\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\n      replace: >\n        dest=/etc/php.ini\n        regexp=\"^;date\\.timezone =\"\n        replace=\"date.timezone = Asia/Tokyo\"\n\n    #\n    # MySQL 5.7\n    #\n    - name: MariaDB \u524a\u9664\n      yum: name=mariadb-libs state=removed\n\n    - name: MySQL5.7 \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n      command: >\n        yum -y install http://dev.mysql.com/get/mysql57-community-release-el7-7.noarch.rpm\n        creates=/etc/yum.repos.d/mysql-community.repo\n\n    - name: MySQL5.7 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=mysql-community-server\n\n    - name: MySQL5.7 \u8d77\u52d5\n      service: name=mysqld state=started enabled=yes\n\n  handlers:\n    - name: restart httpd\n      service: name=httpd state=restarted\n\n\nplaybook \u3092\u5b9f\u884c\nansible-playbook -i hosts playbook.ml\u3067 playbook \u3092\u5b9f\u884c\u3057\u3001\u6210\u529f\u3057\u305f\u6642\u306e\u51fa\u529b\u304c\u4ee5\u4e0b\n\u6700\u521d\u3001MariaDB \u3092\u524a\u9664\u3057\u3066\u3044\u306a\u304f\u3066 MySQL \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u304f\u3066\u3064\u307e\u3065\u3044\u305f\u4ee5\u5916\u306f\u307b\u307c\u554f\u984c\u306a\u304f\u5b9f\u884c\u3067\u304d\u305f\nPLAY ***************************************************************************\n\nTASK [setup] *******************************************************************\nok: [10.0.0.5]\n\nTASK [OS \u6700\u65b0\u5316] ******************************************************************\nchanged: [10.0.0.5]\n\nTASK [DeveloperTool \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] ****************************************************\nchanged: [10.0.0.5]\n\nTASK [vim \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] **************************************************************\nchanged: [10.0.0.5]\n\nTASK [Apache \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] ***********************************************************\nchanged: [10.0.0.5]\n\nTASK [Apache \u8d77\u52d5] ***************************************************************\nchanged: [10.0.0.5]\n\nTASK [.htaccess\u3092\u6709\u52b9\u306b\u3059\u308b] *********************************************************\nchanged: [10.0.0.5]\n\nTASK [PHP\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] **************************************************************\nchanged: [10.0.0.5] => (item=[u'php', u'php-mbstring', u'php-mysql'])\n\nTASK [PHP\u3092\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a] ***********************************************************\nchanged: [10.0.0.5]\n\nTASK [MariaDB \u524a\u9664] **************************************************************\nchanged: [10.0.0.5]\n\nTASK [MySQL5.7 \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0] ********************************************************\nchanged: [10.0.0.5]\n [WARNING]: Consider using yum module rather than running yum\n\n\nTASK [MySQL5.7 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] *********************************************************\nchanged: [10.0.0.5]\n\nTASK [MySQL5.7 \u8d77\u52d5] *************************************************************\nchanged: [10.0.0.5]\n\nRUNNING HANDLER [restart httpd] ************************************************\nchanged: [10.0.0.5]\n\nPLAY RECAP *********************************************************************\n10.0.0.5                   : ok=14   changed=13   unreachable=0    failed=0   \n\n\n\u30d6\u30e9\u30a6\u30b6\u3067http://10.0.0.5\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u305f\u306e\u3067\u3001Apache \u306f OK\n\n\u7d9a\u3044\u3066\u3001/var/www/html/info.php\u3092\u4f5c\u6210\u3057\u3001http://10.0.0.5/info.php\u306b\u30a2\u30af\u30bb\u30b9\n\ninfo.php\n<?php\nphpinfo();\n\n\n\nPHP\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u308b\uff01\u3051\u3069\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 5.4 \u306b\u306a\u3063\u3066\u308b\u3001\u3001\u3001\nPHP7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u3057\u3001PDO_mysql \u3082\u3046\u307e\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044(phpinfo \u306b\u9805\u76ee\u304c\u306a\u3044)\u306e\u3067\u6b21\u56de\u3001\u305d\u306e\u8fba\u306e\u8abf\u67fb\u3068\u4fee\u6b63\u3092\u3059\u308b\n\u3044\u3088\u3044\u3088\u4eca\u56de\u306f\u3001playbook \u3067 LAMP \u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\n\n## \u4eca\u56de\u306e\u30c8\u30d4\u30c3\u30af\u30b9\n* \u4eca\u56de\u3067 LAMP \u74b0\u5883\u306f\u5b8c\u6210\u3057\u306a\u3044\uff01\n* MariaDB \u306e\u305b\u3044\u3067 MySQL5.7 \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044\uff01\n\n## playbook \u3092\u4f5c\u6210\nLAMP\u74b0\u5883\u306e playbook \u3092\u4f5c\u6210\u3057\u3066\u307f\u308b\n\n```yaml\n- hosts: DevServer1\n  become: yes\n  tasks:\n    #\n    # \u30b7\u30b9\u30c6\u30e0\n    #\n    - name: OS \u6700\u65b0\u5316\n      yum: name=* state=latest\n\n    - name: DeveloperTool \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=\"@Development tools\"\n\n    - name: vim \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=vim\n\n    #\n    # Apache\n    #\n    - name: Apache \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=httpd\n\n    - name: Apache \u8d77\u52d5\n      service: name=httpd state=started enabled=yes\n\n    - name: .htaccess\u3092\u6709\u52b9\u306b\u3059\u308b\n      replace:\n        dest=/etc/httpd/conf/httpd.conf\n        regexp='AllowOverride None'\n        replace='AllowOverride All'\n      notify:\n        - restart httpd\n\n    #\n    # PHP\n    #\n    - name: PHP\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name={{item}}\n      with_items:\n        - php\n        - php-mbstring\n        - php-mysql\n\n    - name: PHP\u3092\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\n      replace: >\n        dest=/etc/php.ini\n        regexp=\"^;date\\.timezone =\"\n        replace=\"date.timezone = Asia/Tokyo\"\n\n    #\n    # MySQL 5.7\n    #\n    - name: MariaDB \u524a\u9664\n      yum: name=mariadb-libs state=removed\n\n    - name: MySQL5.7 \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0\n      command: >\n        yum -y install http://dev.mysql.com/get/mysql57-community-release-el7-7.noarch.rpm\n        creates=/etc/yum.repos.d/mysql-community.repo\n\n    - name: MySQL5.7 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n      yum: name=mysql-community-server\n\n    - name: MySQL5.7 \u8d77\u52d5\n      service: name=mysqld state=started enabled=yes\n\n  handlers:\n    - name: restart httpd\n      service: name=httpd state=restarted\n```\n\n## playbook \u3092\u5b9f\u884c\n`ansible-playbook -i hosts playbook.ml`\u3067 playbook \u3092\u5b9f\u884c\u3057\u3001\u6210\u529f\u3057\u305f\u6642\u306e\u51fa\u529b\u304c\u4ee5\u4e0b\n\n\u6700\u521d\u3001MariaDB \u3092\u524a\u9664\u3057\u3066\u3044\u306a\u304f\u3066 MySQL \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u304f\u3066\u3064\u307e\u3065\u3044\u305f\u4ee5\u5916\u306f\u307b\u307c\u554f\u984c\u306a\u304f\u5b9f\u884c\u3067\u304d\u305f\n\n```sh\nPLAY ***************************************************************************\n\nTASK [setup] *******************************************************************\nok: [10.0.0.5]\n\nTASK [OS \u6700\u65b0\u5316] ******************************************************************\nchanged: [10.0.0.5]\n\nTASK [DeveloperTool \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] ****************************************************\nchanged: [10.0.0.5]\n\nTASK [vim \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] **************************************************************\nchanged: [10.0.0.5]\n\nTASK [Apache \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] ***********************************************************\nchanged: [10.0.0.5]\n\nTASK [Apache \u8d77\u52d5] ***************************************************************\nchanged: [10.0.0.5]\n\nTASK [.htaccess\u3092\u6709\u52b9\u306b\u3059\u308b] *********************************************************\nchanged: [10.0.0.5]\n\nTASK [PHP\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] **************************************************************\nchanged: [10.0.0.5] => (item=[u'php', u'php-mbstring', u'php-mysql'])\n\nTASK [PHP\u3092\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a] ***********************************************************\nchanged: [10.0.0.5]\n\nTASK [MariaDB \u524a\u9664] **************************************************************\nchanged: [10.0.0.5]\n\nTASK [MySQL5.7 \u30ea\u30dd\u30b8\u30c8\u30ea\u8ffd\u52a0] ********************************************************\nchanged: [10.0.0.5]\n [WARNING]: Consider using yum module rather than running yum\n\n\nTASK [MySQL5.7 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb] *********************************************************\nchanged: [10.0.0.5]\n\nTASK [MySQL5.7 \u8d77\u52d5] *************************************************************\nchanged: [10.0.0.5]\n\nRUNNING HANDLER [restart httpd] ************************************************\nchanged: [10.0.0.5]\n\nPLAY RECAP *********************************************************************\n10.0.0.5                   : ok=14   changed=13   unreachable=0    failed=0   \n\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067`http://10.0.0.5`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u305f\u306e\u3067\u3001Apache \u306f OK\n\n![2016-03-06 18.28.22.png](https://qiita-image-store.s3.amazonaws.com/0/115864/29620263-248d-7d75-742d-099ad71d8be5.png)\n\n\u7d9a\u3044\u3066\u3001`/var/www/html/info.php`\u3092\u4f5c\u6210\u3057\u3001`http://10.0.0.5/info.php`\u306b\u30a2\u30af\u30bb\u30b9\n\n```php:info.php\n<?php\nphpinfo();\n```\n\n![2016-03-06 18.33.26.png](https://qiita-image-store.s3.amazonaws.com/0/115864/c7d4cc18-3178-524d-3cc2-f3a53c822ef0.png)\n\nPHP\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u308b\uff01\u3051\u3069\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 5.4 \u306b\u306a\u3063\u3066\u308b\u3001\u3001\u3001\nPHP7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u3044\u3057\u3001PDO_mysql \u3082\u3046\u307e\u304f\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044(phpinfo \u306b\u9805\u76ee\u304c\u306a\u3044)\u306e\u3067\u6b21\u56de\u3001\u305d\u306e\u8fba\u306e\u8abf\u67fb\u3068\u4fee\u6b63\u3092\u3059\u308b\n", "tags": ["ansible-playbook"]}