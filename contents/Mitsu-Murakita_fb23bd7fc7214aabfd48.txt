{"context": "\n\n1. \u306f\u3058\u3081\u306b\nVyOS\u3092\u4f7f\u3063\u3066VPN\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001L2TP\u3001PPTP\u69cb\u6210\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306fOpenVPN\u3092\u4f7f\u7528\u3057\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\u3000SoftLayer\u4e0a\u306eVyOS\u306bOpenVPN\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001\u30ea\u30e2\u30fc\u30c8\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\u3000VyOS\u306eL2TP\u69cb\u6210\u3067\u306f\u3001\u540c\u6642\u63a5\u7d9a\u304c1\u30e6\u30fc\u30b6\u30fc\u306e\u307f\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u304cOpenVPN\u3067\u306f\u3053\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u305b\u3093\u3002\nL2TP\u3067\u306e\u69cb\u7bc9\u306b\u3064\u3044\u3066\u306f\u3001\nSoftLayer\u3068VyOS\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u790e\u3092\u52c9\u5f37\uff12-(L2TP/IPsec\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u7de8)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/990f0f4151a5b0485731\n\n2. OpenVPN\u306b\u3064\u3044\u3066\n\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3001GPL\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nWindows\u3084Linux\u3001MacOS\u306a\u3069\u3001\u3044\u308d\u3044\u308d\u306aOS\u3067\u5229\u7528\u53ef\u80fd\u3002\u307e\u305f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fiOS\u3084Android\u3067\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\nOpenVPN\u306e\u30b5\u30a4\u30c8\u3000 https://openvpn.net/\n\n3. \u69cb\u6210\u306b\u3064\u3044\u3066\n\u3000SoftLayerTokyo\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u306bOpenVPN(VyOS)\u30b5\u30fc\u30d0\u3092\u8a2d\u5b9a\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u3092\u63a5\u7d9a\u3057\u307e\u3059\u3002\n VPN\u63a5\u7d9a\u5f8cCent6\u30b5\u30fc\u30d0\u30fc\u306bSSH\u63a5\u7d9a\u3092\u884c\u3044\u3001\u4f7f\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n  \u30af\u30e9\u30a4\u30a2\u30f3\u30c8IP\u30d7\u30fc\u30eb\u7528\u306bPrivate Portable IP\u3092\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n  IP\u30d7\u30fc\u30eb\uff1a 10.132.42.52\uff5e10.132.42.62\n\n\uff14.\u5168\u4f53\u306e\u6d41\u308c\n\n\u2460\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u2461VyOS\u8a2d\u5b9a\n\u2462\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u8a2d\u5b9a\n\u2463\u63a5\u7d9a\u78ba\u8a8d\n\u3067\u4f5c\u696d\u5b8c\u4e86\u3067\u3059\u3002\n\n\uff15.\u30b5\u30fc\u30d0\u30fc\u5074\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\neth0\u3001eth1\u3001gateway-addoress\u3001ssh\u7b49\u306e\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\u306e\u300c9. \u2466 VyOS\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u300d\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562b\n\u4ee5\u964d\u306fSSH\u63a5\u7d9a(TeraTerm\u7b49\uff09\u3067\u304d\u3066\u3044\u308b\u524d\u63d0\u3067\u3001\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n\n\uff15-1. root\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6709\u52b9\u5316\n\u8a8d\u8a3c\u5c40\u3001\u9375\u3092\u4f5c\u6210\u3059\u308b\u306b\u306fOS\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u5165\u308b\u305f\u3081\u306b\u3001VyOS\u306e\u69cb\u6210\u3067root\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\nVyOS\u306b\u306f\u3001\n\u30fb\u4e00\u822c\u30e2\u30fc\u30c9(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\uff04)\n\u30fb\u8a2d\u5b9a\u30e2\u30fc\u30c9(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\uff03)\n\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u6700\u521d\u306f\u4e00\u822c\u30e2\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u300cconfigure\u300d\u23ce\u3067\u8a2d\u5b9a\u30e2\u30fc\u30c9\u306b\u3057\u3066\u304b\u3089\u5165\u529b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\n\nroot\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6709\u52b9\u5316\n# set system login user root authentication plaintext-password root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9 \u23ce\n# commit \u23ce\n# save \u23ce\n\n\nroot\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u3053\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306bSoftLayer\u3067\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u305froot\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u3059\u3002\n\n\n\uff15-\uff12. \u8a8d\u8a3c\u5c40\u306e\u69cb\u7bc9\n\u521d\u56de\u306e\u6642\u3060\u3051\u5b9f\u884c\u3057\u3001\u904b\u7528\u4e2d\u306f\u5b9f\u884c\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\n\u2460 root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u300csu -\u3000\u23ce\u300d\n\u2461 root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3000\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3002\n\u2462\u4eca\u56de\u4f7f\u7528\u3059\u308bVyOS\u306b\u4ed8\u5c5e\u306eOpenVPN\u30d7\u30ed\u30b0\u30e9\u30e0\u985e\u306f\u3001/usr/share/doc/openvpn/examples/easy-rsa/2.0/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u3042\u308a\u307e\u3059\u3002\n\u2463vars\u306e\u547c\u3073\u51fa\u3057\u3001\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\u300c.  ./vars \u23ce\u300d\n\u2464\u53e4\u3044\u9375\u30d5\u30a1\u30a4\u30eb\u985e\u306e\u6d88\u53bb\u3001\u8a8d\u8a3c\u5c40\u306e\u521d\u671f\u5316\n\u300c./clean-all \u300d\n\u2465\u8a8d\u8a3c\u5c40\u306e\u4f5c\u6210\n\u300c./build-ca \u23ce\u300d\n\u2466\u56fd\u540d\u30b3\u30fc\u30c9\n\u2467\u90fd\u9053\u5e9c\u770c\u540d\n\u2468\u90fd\u5e02\u540d\n\u2469\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u246a\u7701\u7565\n\u246b\u5171\u901a\u540d\n\u246c\u7701\u7565\n\u246d\u8a8d\u8a3c\u5c40\u306e\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\nCA\u8a3c\u660e\u66f8---ca.crt\nCA\u79d8\u5bc6\u9375---ca.key\n\n\uff15-\uff13. \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u521d\u56de\u306e\u6642\u3060\u3051\u5b9f\u884c\u3057\u3001\u904b\u7528\u4e2d\u306f\u5b9f\u884c\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u9375\u540d\u79f0\u3092\u300cserver\u300d\u3068\u3057\u307e\u3059\u3002\n\u2460\u30b5\u30fc\u30d0\u30fc\u5074\u9375\u4f5c\u6210\n\u300c./build-key-server server \u23ce\u300d\n\u2461\u56fd\u540d\u30b3\u30fc\u30c9\n\u2462\u90fd\u9053\u5e9c\u770c\u540d\n\u2463\u90fd\u5e02\u540d\n\u2464\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u2465\u300c\u23ce\u300d\n\u2466\u300c\u23ce\u300d\n\u2467\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u2468\u4eca\u56de\u30c1\u30e3\u30ec\u30f3\u30b8\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u3002\n\u300c\u23ce\u300d\n\u2469\u300c\u23ce\u300d\n\u246a\u300cy \u23ce\u300d\n\u246b\u300cy \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8---server.crt\n\u30b5\u30fc\u30d0\u30fc\u79d8\u5bc6\u9375---server.key\n\n\uff15-\uff14. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u3053\u3053\u3067\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u9375\u540d\u79f0\u3092\u300cclient\u300d\u3068\u3057\u307e\u3059\u3002\n\u5fc5\u8981\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6570\u5206\u3001\u540d\u79f0\u3092\u5909\u3048\u3066\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002\n\n\u2460\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u9375\u4f5c\u6210\n\u300c./build-key client \u23ce\u300d\n\u2461\u56fd\u540d\u30b3\u30fc\u30c9\n\u2462\u90fd\u9053\u5e9c\u770c\u540d\n\u2463\u90fd\u5e02\u540d\n\u2464\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u2465\u300c\u23ce\u300d\n\u2466\u300c\u23ce\u300d\n\u2467\u300c\u23ce\u300d\n\u2468\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u2469\u4eca\u56de\u30c1\u30e3\u30ec\u30f3\u30b8\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u3002\n\u300c\u23ce\u300d\n\u246a\u300c\u23ce\u300d\n\u246b\u300cy \u23ce\u300d\n\u246c\u300cy \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8---client.crt\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375---client.key\n\n\uff15-\uff15. DH\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4f5c\u6210\n\u9375\u306e\u4ea4\u63db\u306b\u4f7f\u7528\u3059\u308bDH\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n\n\u2460\u300c./build-dh \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\ndh1024.pem\n\n\uff15-\uff16. \u9375\u3092\u6240\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3078\u30b3\u30d4\u30fc\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u7528\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528\u5225\u306b\u305d\u308c\u305e\u308c\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883\u306f\u4ee5\u964d\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u306e\u3067\u3001\u305d\u306e\u6642\u4f7f\u7528\u3057\u307e\u3059\u3002\n<\u30b5\u30fc\u30d0\u30fc\u7528>\n\u30fbca.crt\n\u30fbdh1024.pem\n\u30fbserver.crt\n\u30fbserver.key\n<\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528>\n\u30fbca.crt\n\u30fbclient.crt\n\u30fbclient.key\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3001/root\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002\n(\u3061\u306a\u307f\u306b\u3001/config/auth/\u306b\u4fdd\u5b58\u3059\u308b\u3068\u3001VyOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u6642\u306b\u6d88\u3055\u308c\u305a\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002)\n\n\uff16.VyOS\u306e\u8a2d\u5b9a\nVyOS\u306e\u57fa\u672c\u8a2d\u5b9a\u306f\u300c\uff15.\u30b5\u30fc\u30d0\u30fc\u5074\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u300d\u3067\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n\u69cb\u6210\u3067\u8a2d\u5b9a\u3059\u308b\u306e\u306f\u3001\u300cOpenVPN\u300d\u300cNAT\u300d\u3067\u3059\u3002\n\nOpenVPN\u306e\u8a2d\u5b9a\n(01) # set interfaces openvpn vtun0 \u23ce\n(02) # set interfaces openvpn vtun0 mode server\u23ce\n(03) # set interfaces openvpn vtun0 openvpn-option \"--push route 10.0.0.0 255.0.0.0  --push dhcp-option DNS 10.0.80.11\" \u23ce\n(04) # set interfaces openvpn vtun0 server client client ip 10.132.42.50 \u23ce\n(05) # set interfaces openvpn vtun0 server subnet 10.132.42.48/28 \u23ce\n(06) # set interfaces openvpn vtun0 tls ca-cert-file /root/ca.crt \u23ce\n(07) # set interfaces openvpn vtun0 tls cert-file /root/server.crt \u23ce\n(08) # set interfaces openvpn vtun0 tls dh-file /root/dh1024.pem \u23ce\n(09) # set interfaces openvpn vtun0 tls key-file /root/server.key \u23ce\n(10) # commit \u23ce\n(11) # save \u23ce\n\n\n\u203b\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u3001\u884c\u756a\u53f7\u3092\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n(03) SoftLayer\u5074\u306e\u30eb\u30fc\u30c8(10.0.0.0 255.0.0.0)\u3068DNS(10.0.80.11)\u3092push\u3057\u3066\u3044\u307e\u3059\u3002\n\"redirect-gateway def1\"\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u3067\u3059\u3002\n(04)\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u540d\u524d\u306f\u300cclient\u300d\u3067\u3001client.crt/client.key\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30ebIP\u304b\u3089IP\u3092\u5207\u308a\u3060\u3057\u3066\u300110.132.42.50\u3092\u30a2\u30b5\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u3002\n(05)\u30b5\u30d6\u30cd\u30c3\u30c8\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30eb\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af(10.132.42.48/28)\u3067\u3059\u3002\n(06)CA\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5834\u6240\n(07)\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5834\u6240\n(08)DH\u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\u5834\u6240\n(09)\u30b5\u30fc\u30d0\u30fc\u79d8\u5bc6\u9375\u306e\u4fdd\u5b58\u5834\u6240\n\u3053\u3053\u307e\u3067\u306e\u8a2d\u5b9a\u3067\u306f\u3001OpenVPN\u63a5\u7d9a\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528\u306eIP\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u304c\u3001SoftLayer\u306eDNS\u3084\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u3068\u901a\u4fe1\u3059\u308b\u305f\u3081\u306b\u3001NAT\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\nNAT\u306e\u8a2d\u5b9a\n(01) # set nat source rule 1 \u23ce\n(02) # set nat source rule 1 outbound-interface eth0 \u23ce\n(03) # set nat source rule 1 source address 10.132.42.48/28 \u23ce\n(04) # set nat source rule 1 translation address masquerade \u23ce\n(05) # commit \u23ce\n(06) # save \u23ce\n\n\n\u203b\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u3001\u884c\u756a\u53f7\u3092\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\nSourceNAT\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n(02) \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306feth0\n(03)source \u30a2\u30c9\u30ec\u30b9\u306f\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30eb\u3067\u3059\n(04)\u30de\u30b9\u30ab\u30ec\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u3057\u307e\u3057\u305f\n\u3053\u308c\u3067\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u3078PING\u304c\u901a\u308a\u307e\u3059\u3002\n\n\u5168\u4f53\u69cb\u6210\u4f8b\ninterfaces {\n     ethernet eth0 {\n         address 10.132.52.229/26\n         duplex auto\n         hw-id 06:64:e1:be:f5:79\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.104.109/29\n         duplex auto\n         hw-id 06:f3:4d:9a:db:f3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n     openvpn vtun0 {\n         mode server\n         openvpn-option \"--push route 10.0.0.0 255.0.0.0  --push dhcp-option DNS  10.0.80.11\"\n         server {\n             client client {\n                 ip 10.132.42.50\n             }\n             subnet 10.132.42.48/28\n         }\n         tls {\n             ca-cert-file /root/ca.crt\n             cert-file /root/server.crt\n             dh-file /root/dh1024.pem\n             key-file /root/server.key\n         }\n     }\n }\n nat {\n     source {\n         rule 1 {\n             outbound-interface eth0\n             source {\n                 address 10.132.42.48/28\n             }\n             translation {\n                 address masquerade\n             }\n         }\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     gateway-address 161.202.104.105\n     host-name vyos\n     login {\n         user root {\n             authentication {\n                 encrypted-password $6$Q0pf7AroZmY$MK7zWwUJdBbY4wsZ94/ZCDkSk9068 /LeYM6G.B7a.hOdHhjnAZtRNqVPkvr1obJFxFFzygEE1vINpK74vR92s.\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n         user vyos {\n             authentication {\n                 encrypted-password $1$4c8nA5Q/$Jdf4lZMTVMebY9d64llpE1\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     ntp {\n         server 0.pool.ntp.org {\n         }\n         server 1.pool.ntp.org {\n         }\n         server 2.pool.ntp.org {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone UTC\n }\n\n\n\n7.\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u8a2d\u5b9a\n\n7-1.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nOpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u4e0b\u8a18\u30b5\u30a4\u30c8\u3088\u308a\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://www.openvpn.jp/download/\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304cWindows10(32bit)\u3067\u3059\u306e\u3067\u300copenvpn-install-2.3.11-I601-i686.exe\u300d\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\n\n\n7-2.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u300copenvpn-install-2.3.11-I601-i686.exe\u300d\u3092\u5b9f\u884c\u3002\n\n\u300cNext\u300d\n\n\u300cI Agree\u300d\n\n\u300cNext\u300d\n\n\u300cNext\u300d \n\u3053\u3053\u3067\u306f\u5c0e\u5165\u30d5\u30a9\u30eb\u30c0\u30fc\u3092\"ProgramFiles\\OpenVPN\"\u306b\u3057\u307e\u3057\u305f\u3002\n\n\n\u300cNext\u300d \n\n\u300cFinish\u300d\n\n7-3.CA\u8a3c\u660e\u66f8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375\u306e\u30b3\u30d4\u30fc\n\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u4f5c\u6210\u3057\u305fca.crt\u3001client.crt\u3001client.key\u3092\n\u201dc:\\Program Files\\OpenVPN\\config\"\u30d5\u30a9\u30eb\u30c0\u30fc\u3078\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n\n7-2.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\u306e\u7de8\u96c6\n\n\u300cOpenVPN\u300d\u8d77\u52d5\n\n\u300c\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u300d\u306eOpenVPN\u30a2\u30a4\u30b3\u30f3\u4e0a\u3067\u3001\u30de\u30a6\u30b9\u53f3\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u3092\u8868\u793a\n\n\u300c\u8a2d\u5b9a\u306e\u7de8\u96c6\u300d\n\nremoto \"OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\"\nca  \"CA\u8a3c\u660e\u66f8\"\ncert \"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\"\nkey \"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375\"\n\u3092\u7de8\u96c6\u3057\u3001\u4fdd\u5b58\u3002\n\n8.\u63a5\u7d9a\u78ba\u8a8d\n\n8-1.OpenVPN\u306e\u63a5\u7d9a\n\n\u300c\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u300d\u306eOpenVPN\u30a2\u30a4\u30b3\u30f3\u4e0a\u3067\u3001\u30de\u30a6\u30b9\u53f3\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u3092\u8868\u793a\u21d2\u300c\u63a5\u7d9a\u300d\n\n\u63a5\u7d9a\u4e2d\u3067\u3059\u3002\n\n\u300c10.132.42.50\u300d\u306b\u63a5\u7d9a\u3055\u308c\u307e\u3057\u305f\u3002\n\n8-2.PING\u3068SSH\u3067\u78ba\u8a8d\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3088\u308a\u3001\n\u30fbVyOS\u30b5\u30fc\u30d0\u30fc(10.132.52.229)\n\u30fbCent6\u30b5\u30fc\u30d0\u30fc(10.132.52.225)\n\u306b\u5bfe\u3057\u3066PING\u304c\u901a\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n\n\nVyOS\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u78ba\u8a8d\u5b8c\u4e86\n\nCent6\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u78ba\u8a8d\u5b8c\u4e86\n\n9. \u304a\u308f\u308a\u306b\n\u5b9f\u904b\u7528\u306e\u969b\u306f\u3001\u30d5\u30a1\u30a4\u30a2\u30fc\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u3092\u5fc5\u305a\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001VyOS\u5197\u9577\u5316\u3059\u308b\u306b\u306fVRRP\u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001OpenVPN\u63a5\u7d9a\u304c\u6a19\u6e96\u3067\u306fUDP\u63a5\u7d9a\u306e\u305f\u3081\u3001TCP\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4eca\u5f8c\u66f8\u304f\u4e88\u5b9a\u3067\u3059\u3002\n# 1. \u306f\u3058\u3081\u306b\n  VyOS\u3092\u4f7f\u3063\u3066VPN\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001L2TP\u3001PPTP\u69cb\u6210\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306fOpenVPN\u3092\u4f7f\u7528\u3057\u3066\u69cb\u7bc9\u3057\u307e\u3059\u3002\n\u3000SoftLayer\u4e0a\u306eVyOS\u306bOpenVPN\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u3001\u30ea\u30e2\u30fc\u30c8\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089\u63a5\u7d9a\u3057\u307e\u3059\u3002\n\u3000VyOS\u306eL2TP\u69cb\u6210\u3067\u306f\u3001\u540c\u6642\u63a5\u7d9a\u304c1\u30e6\u30fc\u30b6\u30fc\u306e\u307f\u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u304cOpenVPN\u3067\u306f\u3053\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u305b\u3093\u3002\nL2TP\u3067\u306e\u69cb\u7bc9\u306b\u3064\u3044\u3066\u306f\u3001\nSoftLayer\u3068VyOS\u3067\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u57fa\u790e\u3092\u52c9\u5f37\uff12-(L2TP/IPsec\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u7de8)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/990f0f4151a5b0485731\n\n# 2. OpenVPN\u306b\u3064\u3044\u3066\n\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3001GPL\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nWindows\u3084Linux\u3001MacOS\u306a\u3069\u3001\u3044\u308d\u3044\u308d\u306aOS\u3067\u5229\u7528\u53ef\u80fd\u3002\u307e\u305f\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fiOS\u3084Android\u3067\u3082\u5229\u7528\u3067\u304d\u307e\u3059\u3002\n\nOpenVPN\u306e\u30b5\u30a4\u30c8\u3000 https://openvpn.net/\n       \n# 3. \u69cb\u6210\u306b\u3064\u3044\u3066\n\u3000SoftLayerTokyo\u30ed\u30b1\u30fc\u30b7\u30e7\u30f3\u306bOpenVPN(VyOS)\u30b5\u30fc\u30d0\u3092\u8a2d\u5b9a\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u7d4c\u7531\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u3092\u63a5\u7d9a\u3057\u307e\u3059\u3002\n VPN\u63a5\u7d9a\u5f8cCent6\u30b5\u30fc\u30d0\u30fc\u306bSSH\u63a5\u7d9a\u3092\u884c\u3044\u3001\u4f7f\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002![01.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/01.png)\n![02.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/02.png)\n  \u30af\u30e9\u30a4\u30a2\u30f3\u30c8IP\u30d7\u30fc\u30eb\u7528\u306bPrivate Portable IP\u3092\u69cb\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n  IP\u30d7\u30fc\u30eb\uff1a 10.132.42.52\uff5e10.132.42.62\n \n# \uff14.\u5168\u4f53\u306e\u6d41\u308c\n![03.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/03.png)\n\u2460\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u2461VyOS\u8a2d\u5b9a\n\u2462\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u8a2d\u5b9a\n\u2463\u63a5\u7d9a\u78ba\u8a8d\n\u3067\u4f5c\u696d\u5b8c\u4e86\u3067\u3059\u3002\n\n# \uff15.\u30b5\u30fc\u30d0\u30fc\u5074\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\neth0\u3001eth1\u3001gateway-addoress\u3001ssh\u7b49\u306e\u8a2d\u5b9a\u306f\u7701\u7565\u3057\u307e\u3059\u3002\n\u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\u306e\u300c9. \u2466 VyOS\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u300d\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562b\n\n\u4ee5\u964d\u306fSSH\u63a5\u7d9a(TeraTerm\u7b49\uff09\u3067\u304d\u3066\u3044\u308b\u524d\u63d0\u3067\u3001\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n\n## \uff15-1. root\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6709\u52b9\u5316\n\u8a8d\u8a3c\u5c40\u3001\u9375\u3092\u4f5c\u6210\u3059\u308b\u306b\u306fOS\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u304b\u3089\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u5165\u308b\u305f\u3081\u306b\u3001VyOS\u306e\u69cb\u6210\u3067root\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\nVyOS\u306b\u306f\u3001\n\u30fb\u4e00\u822c\u30e2\u30fc\u30c9(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\uff04)\n\u30fb\u8a2d\u5b9a\u30e2\u30fc\u30c9(\u30d7\u30ed\u30f3\u30d7\u30c8\u304c\uff03)\n\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u6700\u521d\u306f\u4e00\u822c\u30e2\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u300cconfigure\u300d\u23ce\u3067\u8a2d\u5b9a\u30e2\u30fc\u30c9\u306b\u3057\u3066\u304b\u3089\u5165\u529b\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\n\n```Command:root\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6709\u52b9\u5316\n# set system login user root authentication plaintext-password root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9 \u23ce\n# commit \u23ce\n# save \u23ce\n``` \nroot\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u3053\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7528\u306bSoftLayer\u3067\u30a2\u30b5\u30a4\u30f3\u3055\u308c\u305froot\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u3059\u3002\n![04.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/\\04.png)\n## \uff15-\uff12. \u8a8d\u8a3c\u5c40\u306e\u69cb\u7bc9\n\u521d\u56de\u306e\u6642\u3060\u3051\u5b9f\u884c\u3057\u3001\u904b\u7528\u4e2d\u306f\u5b9f\u884c\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n![05.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/05.png)\n\u2460 root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u300csu -\u3000\u23ce\u300d\n\u2461 root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3000\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3002\n\u2462\u4eca\u56de\u4f7f\u7528\u3059\u308bVyOS\u306b\u4ed8\u5c5e\u306eOpenVPN\u30d7\u30ed\u30b0\u30e9\u30e0\u985e\u306f\u3001/usr/share/doc/openvpn/examples/easy-rsa/2.0/\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u306b\u3042\u308a\u307e\u3059\u3002\n\u2463vars\u306e\u547c\u3073\u51fa\u3057\u3001\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\u300c.  ./vars \u23ce\u300d\n\u2464\u53e4\u3044\u9375\u30d5\u30a1\u30a4\u30eb\u985e\u306e\u6d88\u53bb\u3001\u8a8d\u8a3c\u5c40\u306e\u521d\u671f\u5316\n\u300c./clean-all \u300d\n\u2465\u8a8d\u8a3c\u5c40\u306e\u4f5c\u6210\n\u300c./build-ca \u23ce\u300d\n\u2466\u56fd\u540d\u30b3\u30fc\u30c9\n\u2467\u90fd\u9053\u5e9c\u770c\u540d\n\u2468\u90fd\u5e02\u540d\n\u2469\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u246a\u7701\u7565\n\u246b\u5171\u901a\u540d\n\u246c\u7701\u7565\n\u246d\u8a8d\u8a3c\u5c40\u306e\u7ba1\u7406\u8005\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\nCA\u8a3c\u660e\u66f8---ca.crt\nCA\u79d8\u5bc6\u9375---ca.key\n\n\n\n\n## \uff15-\uff13. \u30b5\u30fc\u30d0\u30fc\u5074\u306e\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u521d\u56de\u306e\u6642\u3060\u3051\u5b9f\u884c\u3057\u3001\u904b\u7528\u4e2d\u306f\u5b9f\u884c\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n![06.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/06.png)\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u9375\u540d\u79f0\u3092\u300cserver\u300d\u3068\u3057\u307e\u3059\u3002\n\u2460\u30b5\u30fc\u30d0\u30fc\u5074\u9375\u4f5c\u6210\n\u300c./build-key-server server \u23ce\u300d\n\u2461\u56fd\u540d\u30b3\u30fc\u30c9\n\u2462\u90fd\u9053\u5e9c\u770c\u540d\n\u2463\u90fd\u5e02\u540d\n\u2464\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u2465\u300c\u23ce\u300d\n\u2466\u300c\u23ce\u300d\n\u2467\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u2468\u4eca\u56de\u30c1\u30e3\u30ec\u30f3\u30b8\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u3002\n\u300c\u23ce\u300d\n\u2469\u300c\u23ce\u300d\n\u246a\u300cy \u23ce\u300d\n\u246b\u300cy \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8---server.crt\n\u30b5\u30fc\u30d0\u30fc\u79d8\u5bc6\u9375---server.key\n\n\n## \uff15-\uff14. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u3068\u7f72\u540d\n\u3053\u3053\u3067\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u306e\u9375\u540d\u79f0\u3092\u300cclient\u300d\u3068\u3057\u307e\u3059\u3002\n\u5fc5\u8981\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u6570\u5206\u3001\u540d\u79f0\u3092\u5909\u3048\u3066\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002\n![07.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/07.png)\n\u2460\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u9375\u4f5c\u6210\n\u300c./build-key client \u23ce\u300d\n\u2461\u56fd\u540d\u30b3\u30fc\u30c9\n\u2462\u90fd\u9053\u5e9c\u770c\u540d\n\u2463\u90fd\u5e02\u540d\n\u2464\u7d44\u7e54\u540d\u3002\u793e\u540d\u3084\u56e3\u4f53\u540d\n\u2465\u300c\u23ce\u300d\n\u2466\u300c\u23ce\u300d\n\u2467\u300c\u23ce\u300d\n\u2468\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\u2469\u4eca\u56de\u30c1\u30e3\u30ec\u30f3\u30b8\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u3002\n\u300c\u23ce\u300d\n\u246a\u300c\u23ce\u300d\n\u246b\u300cy \u23ce\u300d\n\u246c\u300cy \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8---client.crt\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375---client.key\n\n## \uff15-\uff15. DH\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u4f5c\u6210\n\u9375\u306e\u4ea4\u63db\u306b\u4f7f\u7528\u3059\u308bDH\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u751f\u6210\u3057\u307e\u3059\u3002\n![08.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/08.png)\n\u2460\u300c./build-dh \u23ce\u300d\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\ndh1024.pem\n## \uff15-\uff16. \u9375\u3092\u6240\u5b9a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30fc\u3078\u30b3\u30d4\u30fc\n/usr/share/doc/openvpn/examples/easy-rsa/2.0/keys\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u30b5\u30fc\u30d0\u30fc\u7528\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528\u5225\u306b\u305d\u308c\u305e\u308c\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u74b0\u5883\u306f\u4ee5\u964d\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u306e\u3067\u3001\u305d\u306e\u6642\u4f7f\u7528\u3057\u307e\u3059\u3002\n<\u30b5\u30fc\u30d0\u30fc\u7528>\n\u30fbca.crt\n\u30fbdh1024.pem\n\u30fbserver.crt\n\u30fbserver.key\n<\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528>\n\u30fbca.crt\n\u30fbclient.crt\n\u30fbclient.key\n\n\u3053\u3053\u3067\u306f\u30b5\u30fc\u30d0\u30fc\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u3001/root\u914d\u4e0b\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f\u3002\n(\u3061\u306a\u307f\u306b\u3001/config/auth/\u306b\u4fdd\u5b58\u3059\u308b\u3068\u3001VyOS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u6642\u306b\u6d88\u3055\u308c\u305a\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3067\u304d\u308b\u3088\u3046\u3067\u3059\u3002)\n\n# \uff16.VyOS\u306e\u8a2d\u5b9a\n VyOS\u306e\u57fa\u672c\u8a2d\u5b9a\u306f\u300c\uff15.\u30b5\u30fc\u30d0\u30fc\u5074\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u79d8\u5bc6\u9375\u30fb\u516c\u958b\u9375\u306e\u4f5c\u6210\u300d\u3067\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u8a71\u3092\u9032\u3081\u307e\u3059\u3002\n \n\u69cb\u6210\u3067\u8a2d\u5b9a\u3059\u308b\u306e\u306f\u3001\u300cOpenVPN\u300d\u300cNAT\u300d\u3067\u3059\u3002\n\n ```Command:OpenVPN\u306e\u8a2d\u5b9a\n(01) # set interfaces openvpn vtun0 \u23ce\n(02) # set interfaces openvpn vtun0 mode server\u23ce\n(03) # set interfaces openvpn vtun0 openvpn-option \"--push route 10.0.0.0 255.0.0.0  --push dhcp-option DNS 10.0.80.11\" \u23ce\n(04) # set interfaces openvpn vtun0 server client client ip 10.132.42.50 \u23ce\n(05) # set interfaces openvpn vtun0 server subnet 10.132.42.48/28 \u23ce\n(06) # set interfaces openvpn vtun0 tls ca-cert-file /root/ca.crt \u23ce\n(07) # set interfaces openvpn vtun0 tls cert-file /root/server.crt \u23ce\n(08) # set interfaces openvpn vtun0 tls dh-file /root/dh1024.pem \u23ce\n(09) # set interfaces openvpn vtun0 tls key-file /root/server.key \u23ce\n(10) # commit \u23ce\n(11) # save \u23ce\n```\n\u203b\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u3001\u884c\u756a\u53f7\u3092\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n(03) SoftLayer\u5074\u306e\u30eb\u30fc\u30c8(10.0.0.0 255.0.0.0)\u3068DNS(10.0.80.11)\u3092push\u3057\u3066\u3044\u307e\u3059\u3002\n\"redirect-gateway def1\"\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u5165\u308c\u3066\u3082\u3044\u3044\u3067\u3059\u3002\n(04)\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u540d\u524d\u306f\u300cclient\u300d\u3067\u3001client.crt/client.key\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30ebIP\u304b\u3089IP\u3092\u5207\u308a\u3060\u3057\u3066\u300110.132.42.50\u3092\u30a2\u30b5\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u3002\n(05)\u30b5\u30d6\u30cd\u30c3\u30c8\u306f\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30eb\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af(10.132.42.48/28)\u3067\u3059\u3002\n(06)CA\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5834\u6240\n(07)\u30b5\u30fc\u30d0\u30fc\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5834\u6240\n(08)DH\u30d5\u30a1\u30a4\u30eb\u306e\u4fdd\u5b58\u5834\u6240\n(09)\u30b5\u30fc\u30d0\u30fc\u79d8\u5bc6\u9375\u306e\u4fdd\u5b58\u5834\u6240\n\n\n\u3053\u3053\u307e\u3067\u306e\u8a2d\u5b9a\u3067\u306f\u3001OpenVPN\u63a5\u7d9a\u3057\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7528\u306eIP\u304c\u53d6\u5f97\u3067\u304d\u307e\u3059\u304c\u3001SoftLayer\u306eDNS\u3084\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u3068\u901a\u4fe1\u3059\u308b\u305f\u3081\u306b\u3001NAT\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n ```Command:NAT\u306e\u8a2d\u5b9a\n(01) # set nat source rule 1 \u23ce\n(02) # set nat source rule 1 outbound-interface eth0 \u23ce\n(03) # set nat source rule 1 source address 10.132.42.48/28 \u23ce\n(04) # set nat source rule 1 translation address masquerade \u23ce\n(05) # commit \u23ce\n(06) # save \u23ce\n```\n\u203b\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u3001\u884c\u756a\u53f7\u3092\u5165\u308c\u306a\u3044\u3088\u3046\u306b\u3002\nSourceNAT\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n(02) \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306feth0\n(03)source \u30a2\u30c9\u30ec\u30b9\u306f\u3001\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30dd\u30fc\u30bf\u30d6\u30eb\u3067\u3059\n(04)\u30de\u30b9\u30ab\u30ec\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u3057\u307e\u3057\u305f\n\n\u3053\u308c\u3067\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306e\u4ed6\u306e\u30b5\u30fc\u30d0\u30fc\u3078PING\u304c\u901a\u308a\u307e\u3059\u3002\n\n```Command:\u5168\u4f53\u69cb\u6210\u4f8b\ninterfaces {\n     ethernet eth0 {\n         address 10.132.52.229/26\n         duplex auto\n         hw-id 06:64:e1:be:f5:79\n         smp_affinity auto\n         speed auto\n     }\n     ethernet eth1 {\n         address 161.202.104.109/29\n         duplex auto\n         hw-id 06:f3:4d:9a:db:f3\n         smp_affinity auto\n         speed auto\n     }\n     loopback lo {\n     }\n     openvpn vtun0 {\n         mode server\n         openvpn-option \"--push route 10.0.0.0 255.0.0.0  --push dhcp-option DNS  10.0.80.11\"\n         server {\n             client client {\n                 ip 10.132.42.50\n             }\n             subnet 10.132.42.48/28\n         }\n         tls {\n             ca-cert-file /root/ca.crt\n             cert-file /root/server.crt\n             dh-file /root/dh1024.pem\n             key-file /root/server.key\n         }\n     }\n }\n nat {\n     source {\n         rule 1 {\n             outbound-interface eth0\n             source {\n                 address 10.132.42.48/28\n             }\n             translation {\n                 address masquerade\n             }\n         }\n     }\n }\n protocols {\n     static {\n         route 10.0.0.0/8 {\n             next-hop 10.132.52.193 {\n             }\n         }\n     }\n }\n service {\n     ssh {\n         port 22\n     }\n }\n system {\n     config-management {\n         commit-revisions 20\n     }\n     console {\n         device hvc0 {\n             speed 9600\n         }\n         device ttyS0 {\n             speed 9600\n         }\n     }\n     gateway-address 161.202.104.105\n     host-name vyos\n     login {\n         user root {\n             authentication {\n                 encrypted-password $6$Q0pf7AroZmY$MK7zWwUJdBbY4wsZ94/ZCDkSk9068 /LeYM6G.B7a.hOdHhjnAZtRNqVPkvr1obJFxFFzygEE1vINpK74vR92s.\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n         user vyos {\n             authentication {\n                 encrypted-password $1$4c8nA5Q/$Jdf4lZMTVMebY9d64llpE1\n                 plaintext-password \"\"\n             }\n             level admin\n         }\n     }\n     name-server 10.0.80.11\n     ntp {\n         server 0.pool.ntp.org {\n         }\n         server 1.pool.ntp.org {\n         }\n         server 2.pool.ntp.org {\n         }\n     }\n     package {\n         auto-sync 1\n         repository community {\n             components main\n             distribution helium\n             password \"\"\n             url http://packages.vyos.net/vyos\n             username \"\"\n         }\n     }\n     syslog {\n         global {\n             facility all {\n                 level notice\n             }\n             facility protocols {\n                 level debug\n             }\n         }\n     }\n     time-zone UTC\n }\n``` \n\n# 7.\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u8a2d\u5b9a\n## 7-1.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nOpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u4e0b\u8a18\u30b5\u30a4\u30c8\u3088\u308a\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://www.openvpn.jp/download/\n![10.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/10.png)\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304cWindows10(32bit)\u3067\u3059\u306e\u3067\u300copenvpn-install-2.3.11-I601-i686.exe\u300d\u3092\u4f7f\u7528\u3057\u307e\u3057\u305f\u3002\n![09.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/09.png)\n\n## 7-2.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u300copenvpn-install-2.3.11-I601-i686.exe\u300d\u3092\u5b9f\u884c\u3002\n\n![11.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/11.png)\n\u300cNext\u300d\n\n![12.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/12.png)\n\u300cI Agree\u300d\n\n![13.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/13.png)\n\u300cNext\u300d\n\n![14.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/14.png)\n\u300cNext\u300d \n\u3053\u3053\u3067\u306f\u5c0e\u5165\u30d5\u30a9\u30eb\u30c0\u30fc\u3092\"ProgramFiles\\OpenVPN\"\u306b\u3057\u307e\u3057\u305f\u3002\n\n![15.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/15.png)\n\n![16.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/16.png)\n\u300cNext\u300d \n\n![17.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/17.png)\n\u300cFinish\u300d\n\n## 7-3.CA\u8a3c\u660e\u66f8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375\u306e\u30b3\u30d4\u30fc\n\u30b5\u30fc\u30d0\u30fc\u5074\u3067\u4f5c\u6210\u3057\u305fca.crt\u3001client.crt\u3001client.key\u3092\n\u201dc:\\Program Files\\OpenVPN\\config\"\u30d5\u30a9\u30eb\u30c0\u30fc\u3078\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n![18.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/18.png)\n\n## 7-2.OpenVPN\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a2d\u5b9a\u306e\u7de8\u96c6\n![19.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/19.png)\n\u300cOpenVPN\u300d\u8d77\u52d5\n\n![21.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/21.png)\n\u300c\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u300d\u306eOpenVPN\u30a2\u30a4\u30b3\u30f3\u4e0a\u3067\u3001\u30de\u30a6\u30b9\u53f3\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u3092\u8868\u793a\n\n![22.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/22.png)\n\u300c\u8a2d\u5b9a\u306e\u7de8\u96c6\u300d\n\n![23.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/23.png)\nremoto \"OpenVPN\u30b5\u30fc\u30d0\u30fc\u306e\u30d1\u30d6\u30ea\u30c3\u30afIP\"\nca  \"CA\u8a3c\u660e\u66f8\"\ncert \"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u8a3c\u660e\u66f8\"\nkey \"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u79d8\u5bc6\u9375\"\n\u3092\u7de8\u96c6\u3057\u3001\u4fdd\u5b58\u3002\n\n# 8.\u63a5\u7d9a\u78ba\u8a8d\n## 8-1.OpenVPN\u306e\u63a5\u7d9a\n\n![24.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/24.png)\n\u300c\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u300d\u306eOpenVPN\u30a2\u30a4\u30b3\u30f3\u4e0a\u3067\u3001\u30de\u30a6\u30b9\u53f3\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u3092\u8868\u793a\u21d2\u300c\u63a5\u7d9a\u300d\n\n![25.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/25.png)\n\u63a5\u7d9a\u4e2d\u3067\u3059\u3002\n\n\n![26.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/26.png)\n\u300c10.132.42.50\u300d\u306b\u63a5\u7d9a\u3055\u308c\u307e\u3057\u305f\u3002\n\n## 8-2.PING\u3068SSH\u3067\u78ba\u8a8d\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u306e\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3088\u308a\u3001\n\u30fbVyOS\u30b5\u30fc\u30d0\u30fc(10.132.52.229)\n\u30fbCent6\u30b5\u30fc\u30d0\u30fc(10.132.52.225)\n\u306b\u5bfe\u3057\u3066PING\u304c\u901a\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n![27.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/27.png)\n\n![28.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/28.png)\nVyOS\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u78ba\u8a8d\u5b8c\u4e86\n![29.png](http://www.seahorse-inc.com/QIITA/OpenVPNRemortAccess/29.png)\nCent6\u30b5\u30fc\u30d0\u30fc\u3068\u306e\u63a5\u7d9a\u78ba\u8a8d\u5b8c\u4e86\n\n\n\n# 9. \u304a\u308f\u308a\u306b\n\u5b9f\u904b\u7528\u306e\u969b\u306f\u3001\u30d5\u30a1\u30a4\u30a2\u30fc\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u3092\u5fc5\u305a\u884c\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001VyOS\u5197\u9577\u5316\u3059\u308b\u306b\u306fVRRP\u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001OpenVPN\u63a5\u7d9a\u304c\u6a19\u6e96\u3067\u306fUDP\u63a5\u7d9a\u306e\u305f\u3081\u3001TCP\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4eca\u5f8c\u66f8\u304f\u4e88\u5b9a\u3067\u3059\u3002\n\n", "tags": ["SoftLayer", "VyOS", "OpenVPN", "\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9"]}