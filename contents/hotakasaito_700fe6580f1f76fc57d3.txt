{"context": " More than 1 year has passed since last update.aws elastic beanstalk \u3067 .ebextensions \u306b\u5171\u901a\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3082\u306e\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u305f\u3002\n\nfiles\n\n\n.gemrc\u306b--no-rdoc --no-ri\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n  \"/root/.gemrc\":\n    mode: \"000644\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      gem: --no-rdoc --no-ri\n\n\n\u30ea\u30bd\u30fc\u30b9\u5236\u9650\n\n  \"/etc/security/limits.d/60-nofile-limit.conf\":\n    mode: \"000644\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      nginx  soft  nofile  65535\n      nginx  hard  nofile  65535\n      root   soft  nofile  65535\n      root   hard  nofile  65535\n\n\ncommands\n\n\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\n\n  01_sysctl:\n    command: |\n      sysctl -w net.core.somaxconn=8192\n      ...\n\n\nswap\n*.micro\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4fdd\u967a\u3068\u3057\u3066swapon\u3057\u3066\u304a\u304f\n\n  02_swapon:\n    command: |\n      if (curl -s http://169.254.169.254/latest/meta-data/instance-type | grep -E \"\\.micro$\" > /dev/null)\n      then\n      SWAPFILENAME=/swap.img\n      test -e $SWAPFILENAME && exit 0\n      MEMSIZE=`cat /proc/meminfo | grep MemTotal | awk '{print $2}'`\n      if [ $MEMSIZE -lt 2097152 ]; then\n        SIZE=$((MEMSIZE * 2))k\n      elif [ $MEMSIZE -lt 8388608 ]; then\n        SIZE=${MEMSIZE}k\n      elif [ $MEMSIZE -lt 67108864 ]; then\n        SIZE=$((MEMSIZE / 2))k\n      else\n        SIZE=4194304k\n      fi\n      fallocate -l $SIZE $SWAPFILENAME && mkswap $SWAPFILENAME && chmod 0600 $SWAPFILENAME && swapon $SWAPFILENAME\n      fi\n\n\nlocaltime\n\n  03_localtime:\n    command: |\n      if [ ! -e /etc/localtime.orig ] ; then\n      cp -pf /etc/localtime{,.orig}\n      cp -pf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n      fi\n\naws elastic beanstalk \u3067 `.ebextensions` \u306b\u5171\u901a\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u3082\u306e\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u305f\u3002\n\n### files\n* `.gemrc`\u306b`--no-rdoc --no-ri`\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n```yaml\n  \"/root/.gemrc\":\n    mode: \"000644\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      gem: --no-rdoc --no-ri\n```\n\n* \u30ea\u30bd\u30fc\u30b9\u5236\u9650\n\n```yaml\n  \"/etc/security/limits.d/60-nofile-limit.conf\":\n    mode: \"000644\"\n    owner: \"root\"\n    group: \"root\"\n    content: |\n      nginx  soft  nofile  65535\n      nginx  hard  nofile  65535\n      root   soft  nofile  65535\n      root   hard  nofile  65535\n```\n\n### commands\n* \u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\n\n```yaml\n  01_sysctl:\n    command: |\n      sysctl -w net.core.somaxconn=8192\n      ...\n```\n\n* swap  \n*.micro\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4fdd\u967a\u3068\u3057\u3066swapon\u3057\u3066\u304a\u304f\n\n```yaml\n  02_swapon:\n    command: |\n      if (curl -s http://169.254.169.254/latest/meta-data/instance-type | grep -E \"\\.micro$\" > /dev/null)\n      then\n      SWAPFILENAME=/swap.img\n      test -e $SWAPFILENAME && exit 0\n      MEMSIZE=`cat /proc/meminfo | grep MemTotal | awk '{print $2}'`\n      if [ $MEMSIZE -lt 2097152 ]; then\n        SIZE=$((MEMSIZE * 2))k\n      elif [ $MEMSIZE -lt 8388608 ]; then\n        SIZE=${MEMSIZE}k\n      elif [ $MEMSIZE -lt 67108864 ]; then\n        SIZE=$((MEMSIZE / 2))k\n      else\n        SIZE=4194304k\n      fi\n      fallocate -l $SIZE $SWAPFILENAME && mkswap $SWAPFILENAME && chmod 0600 $SWAPFILENAME && swapon $SWAPFILENAME\n      fi\n```\n\n* localtime\n\n```yaml\n  03_localtime:\n    command: |\n      if [ ! -e /etc/localtime.orig ] ; then\n      cp -pf /etc/localtime{,.orig}\n      cp -pf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime\n      fi\n```\n\n", "tags": ["ElasticBeanstalk"]}