{"tags": ["Phoenix", "Elixir"], "context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068/\u3084\u308b\u3053\u3068\nElixir/Phoenix\u3067Session\u3092\u4f7f\u7528\u3057\u305f\u753b\u9762\u9077\u79fb\u3092\u4f34\u3046\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u3057\u305f\u3044\nPhoenix\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSession\u3092\u6271\u3063\u305f\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306e\u304c\u5c11\u3057\u9762\u5012\u306a\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067PhantomJS\u7d4c\u7531\u3067\u30c6\u30b9\u30c8\u3092\u3057\u307e\u3059\n\u3053\u3053\u3089\u3078\u3093\u516c\u5f0f\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u3063\u3068\u5145\u5b9f\u3059\u308b\u304b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7c21\u5358\u306b\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u51fa\u6765\u308b\u3068\u3044\u3044\u306e\u306b\u306a\u30fc\n\n\u74b0\u5883\n\n\nPhoenix 1.1.4\n\nElixir 1.2.5\n\nhound 1.0.0\n\nPhantomJS 2.1.1\n\nDocker 1.11.1\n\n\n\n\u624b\u9806\n\nElixir\u306eIntegration Test\u30e9\u30a4\u30d6\u30e9\u30ea\u306ehound\u3092mix\u306e\u4f9d\u5b58\u306b\u8ffd\u52a0\n\nmix.exs\n{:hound, \"~> 1.0\"}\n\n\u4f9d\u5b58\u3092\u66f4\u65b0\nmix deps.get\n\n\n\u30ed\u30fc\u30ab\u30eb\u306bPhantomJS\u3092\u5165\u308c\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3068\u3057\u3066PhantomJS\u3092Docker\u3067\u8d77\u52d5\u3059\u308b\n\ndocker run -itd -p 8910:8910 shufo/phantomjs --webdriver 8910\n\ndocker-compose\u3092\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u30b5\u30fc\u30d3\u30b9\u3092docker-compose.yml\u306b\u8ffd\u52a0\u3059\u308b\n  phantomjs:\n    image: shufo/phantomjs\n    container_name: phantomjs\n    hostname: phantomjs\n    command: \"--webdriver 8910\"\n\n\n\nhound\u306e\u8a2d\u5b9a\n\nconfig/config.ex\nconfig :hound, driver: \"phantomjs\", host: \"phantomjs\", port: 8910\n\n\u88dc\u8db3: host\u306f\u8d77\u52d5\u3057\u305fphantomjs\u306e\u30db\u30b9\u30c8\u540d\u3002docker-compose\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u81ea\u52d5\u7684\u306bservice\u540d\u3067\u89e3\u6c7a\u51fa\u6765\u308b\u306e\u3067phantomjs\u3067ok\u3002docker-compose\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306fDocker\u30c7\u30fc\u30e2\u30f3\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u30de\u30b7\u30f3\u306e\u30db\u30b9\u30c8\u540d\u304bdocker inspect\u7b49\u3067\u30b3\u30f3\u30c6\u30ca\u306eIP\u3092\u78ba\u8a8d\u3002\ntest_helpers.exs\nApplication.ensure_all_started(:hound)\nExUnit.start\n\nExUnit.start\u306e\u524d\u306bApplication.ensure_all_started(:hound)\u3092\u8ffd\u52a0\nconfig/test.exs\nconfig :example, Example.Endpoint,\n  http: [port: 4001],\n-  server: false\n+  server: true\n\nMIX_ENV=test\u6642\u306eEndpoint\u306econfig\u3092server: true\u306b\u5909\u66f4\n\nTest\u3092\u66f8\u304f\n\ntest/controllers/auth_controller_test.exs\ndefmodule Example.AuthControllerTest do\n  use Example.ConnCase\n  import Example.Router.Helpers\n  use Hound.Helpers\n\n  # Start hound session and destroy when tests are run\n  hound_session\n\n  @moduletag :auth\n\n  setup do\n    # \u30e6\u30fc\u30b6\u4f5c\u6210\u51e6\u7406\u7b49\n    # \uff5e\u4e2d\u7565\uff5e\n\n    navigate_to(\"/auth/login\")\n    assert page_source =~ \"\u30ed\u30b0\u30a4\u30f3\"\n\n    username = \"foobar\"\n    find_element(:name, \"username\")\n    |> fill_field(username)\n\n    find_element(:name, \"password\")\n    |> fill_field(\"123456\")\n\n    find_element(:tag, \"button\")\n    |> click\n\n    assert page_source =~ \"\u3088\u3046\u3053\u305d\"\n    {:ok, username: username}\n  end\n\n  test \"user can logout\", %{username: username} do\n    # click logout\n    find_element(:id, \"button_get_logout\")\n    |> click\n    # Assert redirected to login page\n    assert page_source =~ \"\u30ed\u30b0\u30a4\u30f3\"\n    assert current_path == auth_path(conn, :get_login)\n    # Assert logouted user can't access to private page\n    navigate_to(\"/mypage\")\n    assert current_path == auth_path(conn, :get_login)\n  end\nend\n\n\u88dc\u8db3: setup\u5185\u3067\u5171\u901a\u51e6\u7406\u3092\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3002Hound\u306eHelper\u306efind_element/2\u3067\u8981\u7d20\u3092\u9078\u3093\u3067\u5024\u3092\u5165\u308c\u305f\u308a\u51fa\u6765\u308b\u3002\n\nTest\u5b9f\u884c\n\nmix test --only auth\n\n@moduletag\u3067\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u7bc4\u56f2\u3092\u7d5e\u308c\u308b\n\u3053\u308c\u3067\u4e00\u901a\u308a\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u304c\u51fa\u6765\u305f\u3002\nfind_element/2\u3067\u6307\u5b9a\u3067\u304d\u308belement\u306e\u6307\u5b9a\u306e\u65b9\u6cd5\u306f\u4ed6\u306b\u3082:name, :tag, :id, :class, :css, :link_text\u7b49\u304c\u3042\u308b\u3002\nfill_element/2\u3067\u9078\u629e\u3057\u305f\u8981\u7d20\u306binput value\u3092\u5165\u308c\u3066click/1\u304bsubmit/1\u3067\u30d5\u30a9\u30fc\u30e0\u3092submit\u3057\u3066current_path/0\u304bcurrent_url/0\u3067\u9077\u79fb\u5148\u306e\u30d1\u30b9\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\u3002\u3042\u3068page_source/0\u3067\u30da\u30fc\u30b8\u306b\u671f\u5f85\u3059\u308b\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3001\u8fba\u308a\u304c\u51fa\u6765\u308b\u306e\u3067\u57fa\u672c\u7684\u306a\u3068\u3053\u308d\u306f\u5341\u5206\u3060\u3068\u601d\u3046\u3051\u3069\u8db3\u308a\u306a\u3044\u5834\u5408\u306f Hex\u306edocument \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u8ffd\u8a18:\n\u5c11\u3057\u3084\u308a\u65b9\u304c\u7279\u6b8a\u306a\u30c6\u30b9\u30c8\u3067\u30cf\u30de\u3063\u305f\u306e\u3067\u8ffd\u8a18\n\n\u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\ninput_into_field/2\u306b\u5bfe\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u5165\u529b\u3059\u308b\nfind_element(:name, \"image\")\n|> input_into_field(\"#{__DIR__}/../../fixtures/example.jpg\")\n\n\u30d5\u30a1\u30a4\u30eb\u306fphantomjs\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u74b0\u5883\u306e\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u53c2\u7167\u3059\u308b\u306e\u3067Docker\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30b3\u30f3\u30c6\u30ca\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u304a\u304f\n\u4f8b)\ndocker run -itd -p 8910:8910 -v $(pwd):/app shufo/phantomjs --webdriver 8910\n\n  phantomjs:\n    image: shufo/phantomjs\n    container_name: phantomjs\n    hostname: phantomjs\n    command: \"--webdriver 8910\"\n+    volumes:\n+      - \".:/app\"\n\n\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092/app\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067input_into_field\u3067\u306f/app/test/fixtures/example.jpg\u306a\u3069\u3067\u53c2\u7167\u51fa\u6765\u308b\n\n\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u9078\u629e\n\nfind_element(:css, \"#element_id option[value='value']\")\n|> click\n\n\n## \u3084\u308a\u305f\u3044\u3053\u3068/\u3084\u308b\u3053\u3068\n\nElixir/Phoenix\u3067Session\u3092\u4f7f\u7528\u3057\u305f\u753b\u9762\u9077\u79fb\u3092\u4f34\u3046\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u3092\u3057\u305f\u3044\nPhoenix\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fSession\u3092\u6271\u3063\u305f\u30c6\u30b9\u30c8\u3092\u66f8\u304f\u306e\u304c\u5c11\u3057\u9762\u5012\u306a\u3088\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u7528\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067PhantomJS\u7d4c\u7531\u3067\u30c6\u30b9\u30c8\u3092\u3057\u307e\u3059\n\n\n\u3053\u3053\u3089\u3078\u3093\u516c\u5f0f\u3067\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u3063\u3068\u5145\u5b9f\u3059\u308b\u304b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u7c21\u5358\u306b\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u51fa\u6765\u308b\u3068\u3044\u3044\u306e\u306b\u306a\u30fc\n\n## \u74b0\u5883\n\n- [Phoenix](http://www.phoenixframework.org/) `1.1.4`\n- Elixir `1.2.5`\n- hound `1.0.0`\n- PhantomJS `2.1.1`\n- Docker `1.11.1`\n\n## \u624b\u9806\n\n- Elixir\u306eIntegration Test\u30e9\u30a4\u30d6\u30e9\u30ea\u306e[hound](https://github.com/HashNuke/hound)\u3092mix\u306e\u4f9d\u5b58\u306b\u8ffd\u52a0\n\n`mix.exs`\n\n```elixir\n{:hound, \"~> 1.0\"}\n```\n\n\u4f9d\u5b58\u3092\u66f4\u65b0\n\n```bash\nmix deps.get\n```\n\n- \u30ed\u30fc\u30ab\u30eb\u306bPhantomJS\u3092\u5165\u308c\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u30ea\u30e2\u30fc\u30c8\u30b5\u30fc\u30d0\u3068\u3057\u3066PhantomJS\u3092Docker\u3067\u8d77\u52d5\u3059\u308b\n\n```bash\ndocker run -itd -p 8910:8910 shufo/phantomjs --webdriver 8910\n```\n\ndocker-compose\u3092\u4f7f\u3063\u3066\u3044\u308b\u306a\u3089\u30b5\u30fc\u30d3\u30b9\u3092`docker-compose.yml`\u306b\u8ffd\u52a0\u3059\u308b\n\n```yaml\n  phantomjs:\n    image: shufo/phantomjs\n    container_name: phantomjs\n    hostname: phantomjs\n    command: \"--webdriver 8910\"\n```\n\n- `hound`\u306e\u8a2d\u5b9a\n\n`config/config.ex`\n\n```elixir\nconfig :hound, driver: \"phantomjs\", host: \"phantomjs\", port: 8910\n```\n\n\u88dc\u8db3: `host`\u306f\u8d77\u52d5\u3057\u305fphantomjs\u306e\u30db\u30b9\u30c8\u540d\u3002docker-compose\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306f\u81ea\u52d5\u7684\u306bservice\u540d\u3067\u89e3\u6c7a\u51fa\u6765\u308b\u306e\u3067`phantomjs`\u3067ok\u3002docker-compose\u3092\u4f7f\u308f\u306a\u3044\u5834\u5408\u306fDocker\u30c7\u30fc\u30e2\u30f3\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u30de\u30b7\u30f3\u306e\u30db\u30b9\u30c8\u540d\u304b`docker inspect`\u7b49\u3067\u30b3\u30f3\u30c6\u30ca\u306eIP\u3092\u78ba\u8a8d\u3002\n\n`test_helpers.exs`\n\n```elixir\nApplication.ensure_all_started(:hound)\nExUnit.start\n```\n\n`ExUnit.start`\u306e\u524d\u306b`Application.ensure_all_started(:hound)`\u3092\u8ffd\u52a0\n\n`config/test.exs`\n\n```diff\nconfig :example, Example.Endpoint,\n  http: [port: 4001],\n-  server: false\n+  server: true\n```\n\nMIX_ENV=test\u6642\u306eEndpoint\u306econfig\u3092`server: true`\u306b\u5909\u66f4\n\n\n- Test\u3092\u66f8\u304f\n\n`test/controllers/auth_controller_test.exs`\n\n```elixir\ndefmodule Example.AuthControllerTest do\n  use Example.ConnCase\n  import Example.Router.Helpers\n  use Hound.Helpers\n\n  # Start hound session and destroy when tests are run\n  hound_session\n\n  @moduletag :auth\n\n  setup do\n    # \u30e6\u30fc\u30b6\u4f5c\u6210\u51e6\u7406\u7b49\n    # \uff5e\u4e2d\u7565\uff5e\n\n    navigate_to(\"/auth/login\")\n    assert page_source =~ \"\u30ed\u30b0\u30a4\u30f3\"\n\n    username = \"foobar\"\n    find_element(:name, \"username\")\n    |> fill_field(username)\n\n    find_element(:name, \"password\")\n    |> fill_field(\"123456\")\n\n    find_element(:tag, \"button\")\n    |> click\n\n    assert page_source =~ \"\u3088\u3046\u3053\u305d\"\n    {:ok, username: username}\n  end\n\n  test \"user can logout\", %{username: username} do\n    # click logout\n    find_element(:id, \"button_get_logout\")\n    |> click\n    # Assert redirected to login page\n    assert page_source =~ \"\u30ed\u30b0\u30a4\u30f3\"\n    assert current_path == auth_path(conn, :get_login)\n    # Assert logouted user can't access to private page\n    navigate_to(\"/mypage\")\n    assert current_path == auth_path(conn, :get_login)\n  end\nend\n```\n\n\u88dc\u8db3: `setup`\u5185\u3067\u5171\u901a\u51e6\u7406\u3092\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3002Hound\u306eHelper\u306e`find_element/2`\u3067\u8981\u7d20\u3092\u9078\u3093\u3067\u5024\u3092\u5165\u308c\u305f\u308a\u51fa\u6765\u308b\u3002\n\n\n- Test\u5b9f\u884c\n\n```bash\nmix test --only auth\n```\n\n`@moduletag`\u3067\u30c6\u30b9\u30c8\u306e\u5b9f\u884c\u7bc4\u56f2\u3092\u7d5e\u308c\u308b\n\n\u3053\u308c\u3067\u4e00\u901a\u308a\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30b9\u30c8\u304c\u51fa\u6765\u305f\u3002\n\n`find_element/2`\u3067\u6307\u5b9a\u3067\u304d\u308belement\u306e\u6307\u5b9a\u306e\u65b9\u6cd5\u306f\u4ed6\u306b\u3082`:name`, `:tag`, `:id`, `:class`, `:css`, `:link_text`\u7b49\u304c\u3042\u308b\u3002\n`fill_element/2`\u3067\u9078\u629e\u3057\u305f\u8981\u7d20\u306binput value\u3092\u5165\u308c\u3066`click/1`\u304b`submit/1`\u3067\u30d5\u30a9\u30fc\u30e0\u3092submit\u3057\u3066`current_path/0`\u304b`current_url/0`\u3067\u9077\u79fb\u5148\u306e\u30d1\u30b9\u304c\u6b63\u3057\u3044\u304b\u78ba\u8a8d\u3002\u3042\u3068`page_source/0`\u3067\u30da\u30fc\u30b8\u306b\u671f\u5f85\u3059\u308b\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3001\u8fba\u308a\u304c\u51fa\u6765\u308b\u306e\u3067\u57fa\u672c\u7684\u306a\u3068\u3053\u308d\u306f\u5341\u5206\u3060\u3068\u601d\u3046\u3051\u3069\u8db3\u308a\u306a\u3044\u5834\u5408\u306f [Hex\u306edocument](https://hexdocs.pm/hound/readme.html) \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u8ffd\u8a18:\n\n\u5c11\u3057\u3084\u308a\u65b9\u304c\u7279\u6b8a\u306a\u30c6\u30b9\u30c8\u3067\u30cf\u30de\u3063\u305f\u306e\u3067\u8ffd\u8a18\n\n- \u30d5\u30a1\u30a4\u30eb\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n`input_into_field/2`\u306b\u5bfe\u3057\u3066\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u5165\u529b\u3059\u308b\n\n```elixir\nfind_element(:name, \"image\")\n|> input_into_field(\"#{__DIR__}/../../fixtures/example.jpg\")\n```\n\n\u30d5\u30a1\u30a4\u30eb\u306fphantomjs\u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u74b0\u5883\u306e\u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u53c2\u7167\u3059\u308b\u306e\u3067Docker\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u30b3\u30f3\u30c6\u30ca\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u304a\u304f\n\n\u4f8b)\n\n```bash\ndocker run -itd -p 8910:8910 -v $(pwd):/app shufo/phantomjs --webdriver 8910\n```\n\n```diff\n  phantomjs:\n    image: shufo/phantomjs\n    container_name: phantomjs\n    hostname: phantomjs\n    command: \"--webdriver 8910\"\n+    volumes:\n+      - \".:/app\"\n```\n\n\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092`/app`\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067`input_into_field`\u3067\u306f`/app/test/fixtures/example.jpg`\u306a\u3069\u3067\u53c2\u7167\u51fa\u6765\u308b\n\n- \u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u9078\u629e\n\n```elixir\nfind_element(:css, \"#element_id option[value='value']\")\n|> click\n```\n"}