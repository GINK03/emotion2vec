{"tags": ["consul"], "context": "\n\nConsul\n\n\nconsul\u306f\u30b5\u30fc\u30d3\u30b9\u76e3\u8996\u304c\u53ef\u80fd\u306a\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\n\u547c\u3073\u65b9\u306f\u30ab\u30f3\u30b5\u30eb\uff08\u30b3\u30f3\u30b5\u30eb\u3068\u3082\u547c\u3070\u308c\u308b\uff09\nserf\u3067\u3082\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u308b\u304c\u3001serf\u306fserf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u6d3b\u6027\u306e\u307f\u76e3\u8996\u3059\u308b\u3002consul\u306f\u30b5\u30fc\u30d3\u30b9\u691c\u51fa\u6a5f\u80fd\u3092\u6301\u3061\u3001\u305d\u308c\u3089\u304c\u6b63\u5e38\u304b\u7570\u5e38\u304b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u70ba\u3001\u4efb\u610f\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u76e3\u8996\u3057\u3001\u30c8\u30ea\u30ac\u30fc\u767a\u52d5\u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n1\u3064\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u5b9f\u884c\u3057\u3001\u8d77\u52d5\u6642\u306b\u30b5\u30fc\u30d0\u304b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3092\u9078\u629e\u3059\u308b\u3001LinuxH/A\u3068\u6bd4\u3079\u3066\u69cb\u6210\u90e8\u54c1\u304c\u5c11\u306a\u304f\u3001\u69cb\u7bc9\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u3002\n\u30b5\u30fc\u30d0\u306f\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u60c5\u5831\u3092\u84c4\u7a4d\u3057\u3001\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306b\u56de\u7b54\u3059\u308b\u3002\n\n\u30a4\u30e1\u30fc\u30b8\n\n\n\n\u8a2d\u5b9a\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u306a\u3044\u70ba\u3001\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n$ wget -O consul_0.6.4_linux_amd64.zip https://releases.hashicorp.com/consul/0.6.4/consul_0.6.4_linux_amd64.zip\n$ unzip consul_0.6.4_linux_amd64.zip\n$ sudo cp consul /bin\n$ sudo consul version\nConsul v0.6.4\nConsul Protocol: 3 (Understands back to: 1)\n$ sudo rm consul_0.6.4_linux_amd64.zip\n\n\nWeb-UI\u30d5\u30a1\u30a4\u30eb\u3082\u5225\u9014\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n$ sudo mkdir -p /var/www/consul-web-ui\n$ cd /var/www/consul-web-ui\n$ sudo wget -O consul_0.6.4_web_ui.zip https://releases.hashicorp.com/consul/0.6.4/consul_0.6.4_web_ui.zip\n$ sudo unzip consul_0.6.4_web_ui.zip\n$ sudo rm consul_0.6.4_web_ui.zip \n\n\n\u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9json\u3092\u7f6e\u304fDir\u4f5c\u6210\u3057\u3001Web-UI\u7528\u3092\u4f5c\u6210\n\n$ sudo mkdir /etc/consul.d && cd /etc/consul.d\n$ sudo vim web_ui.json\n{\n    \"ui_dir\":\"/var/www/consul-web-ui\",\n    \"addresses\":{\"http\":\"0.0.0.0\"}\n}\n\n\nconsul-server\u8d77\u52d5\n$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=consul-server -bind=10.0.1.155 -config-dir /etc/consul.d &\n\nconsul agent -server:\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30b5\u30fc\u30d0\u72b6\u614b\u306b\u3059\u308b\n-bootstrap-expect=1\uff1aconsul\u30b5\u30fc\u30d0\u30921\u53f0\u3067\u69cb\u6210\u3059\u308b\u3053\u3068\u3092\u660e\u793a\u7684\u306b\u8a18\u8ff0\n-data-dir\uff1a\u30c7\u30fc\u30bf\u4fdd\u7ba1\u5834\u6240\u3092\u8a18\u8ff0\n-bind\uff1a\u8907\u6570\u306eNIC\u304c\u3042\u308b\u5834\u5408\u306bIP\u6307\u5b9a\n-node:\u8868\u793a\u540d\n-data-dir:\u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9json\u683c\u7d0dDIR\n\n\n\u78ba\u8a8d\n$ sudo consul members\nNode           Address          Status  Type    Build  Protocol  DC\nconsul-server  10.0.1.155:8301  alive   server  0.6.4  2         dc1\n\n\nconsul-client\u8d77\u52d5\n\u30d5\u30a1\u30a4\u30eb\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u301c\u306fconsul-server\u3068\u540c\u3058\u624b\u9806\u3092\u8e0f\u3080\uff08Web-ui\u30d5\u30a1\u30a4\u30eb\u306f\u4e0d\u8981\uff09\nserver~client\u9593\u306ftcp:8300,8301\u3092\u660e\u793a\u7684\u306b\u8a31\u53ef\n$ sudo consul agent -data-dir=/tmp/consul -node=consul-node1 -bind=10.0.0.90 -join=10.0.1.155 &\n\n-join:consul\u30b5\u30fc\u30d0\u306eIP\n\n\n\u30af\u30e9\u30b9\u30bf\u3078\u30b8\u30e7\u30a4\u30f3\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n$ sudo consul members\nNode           Address          Status  Type    Build  Protocol  DC\nconsul-node1   10.0.0.90:8301   alive   client  0.6.4  2         dc1\nconsul-server  10.0.1.155:8301  alive   server  0.6.4  2         dc1\n\n\nweb-ui\n8500\u30dd\u30fc\u30c8\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\nhttp://<server-hostname>:8500/ui\n\n\n# [Consul](https://www.consul.io/)\n* consul\u306f\u30b5\u30fc\u30d3\u30b9\u76e3\u8996\u304c\u53ef\u80fd\u306a\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\n* \u547c\u3073\u65b9\u306f\u30ab\u30f3\u30b5\u30eb\uff08\u30b3\u30f3\u30b5\u30eb\u3068\u3082\u547c\u3070\u308c\u308b\uff09\n* serf\u3067\u3082\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3067\u304d\u308b\u304c\u3001serf\u306fserf\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u6d3b\u6027\u306e\u307f\u76e3\u8996\u3059\u308b\u3002consul\u306f\u30b5\u30fc\u30d3\u30b9\u691c\u51fa\u6a5f\u80fd\u3092\u6301\u3061\u3001\u305d\u308c\u3089\u304c\u6b63\u5e38\u304b\u7570\u5e38\u304b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u70ba\u3001\u4efb\u610f\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u76e3\u8996\u3057\u3001\u30c8\u30ea\u30ac\u30fc\u767a\u52d5\u3067\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n* 1\u3064\u306e\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u5b9f\u884c\u3057\u3001\u8d77\u52d5\u6642\u306b\u30b5\u30fc\u30d0\u304b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3092\u9078\u629e\u3059\u308b\u3001LinuxH/A\u3068\u6bd4\u3079\u3066\u69cb\u6210\u90e8\u54c1\u304c\u5c11\u306a\u304f\u3001\u69cb\u7bc9\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u3002\n* \u30b5\u30fc\u30d0\u306f\u4e3b\u306b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u60c5\u5831\u3092\u84c4\u7a4d\u3057\u3001\u8981\u6c42\u304c\u3042\u3063\u305f\u5834\u5408\u306b\u56de\u7b54\u3059\u308b\u3002\n\n\u30a4\u30e1\u30fc\u30b8\n![cloudcraft - consul.png](https://qiita-image-store.s3.amazonaws.com/0/58788/8d0f6567-cbd1-1886-0476-997e5db2939b.png)\n***\n\n#\u8a2d\u5b9a\n* \u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u914d\u5e03\u3055\u308c\u3066\u3044\u306a\u3044\u70ba\u3001\u30d0\u30a4\u30ca\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash\n$ wget -O consul_0.6.4_linux_amd64.zip https://releases.hashicorp.com/consul/0.6.4/consul_0.6.4_linux_amd64.zip\n$ unzip consul_0.6.4_linux_amd64.zip\n$ sudo cp consul /bin\n$ sudo consul version\nConsul v0.6.4\nConsul Protocol: 3 (Understands back to: 1)\n$ sudo rm consul_0.6.4_linux_amd64.zip\n```\n* Web-UI\u30d5\u30a1\u30a4\u30eb\u3082\u5225\u9014\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```bash\n$ sudo mkdir -p /var/www/consul-web-ui\n$ cd /var/www/consul-web-ui\n$ sudo wget -O consul_0.6.4_web_ui.zip https://releases.hashicorp.com/consul/0.6.4/consul_0.6.4_web_ui.zip\n$ sudo unzip consul_0.6.4_web_ui.zip\n$ sudo rm consul_0.6.4_web_ui.zip \n```\n* \u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9json\u3092\u7f6e\u304fDir\u4f5c\u6210\u3057\u3001Web-UI\u7528\u3092\u4f5c\u6210\n\n```bash\n$ sudo mkdir /etc/consul.d && cd /etc/consul.d\n$ sudo vim web_ui.json\n{\n\t\"ui_dir\":\"/var/www/consul-web-ui\",\n\t\"addresses\":{\"http\":\"0.0.0.0\"}\n}\n```\n\n# consul-server\u8d77\u52d5\n```bash\n$ consul agent -server -bootstrap-expect 1 -data-dir /tmp/consul -node=consul-server -bind=10.0.1.155 -config-dir /etc/consul.d &\n```\n\n```text\nconsul agent -server:\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30b5\u30fc\u30d0\u72b6\u614b\u306b\u3059\u308b\n-bootstrap-expect=1\uff1aconsul\u30b5\u30fc\u30d0\u30921\u53f0\u3067\u69cb\u6210\u3059\u308b\u3053\u3068\u3092\u660e\u793a\u7684\u306b\u8a18\u8ff0\n-data-dir\uff1a\u30c7\u30fc\u30bf\u4fdd\u7ba1\u5834\u6240\u3092\u8a18\u8ff0\n-bind\uff1a\u8907\u6570\u306eNIC\u304c\u3042\u308b\u5834\u5408\u306bIP\u6307\u5b9a\n-node:\u8868\u793a\u540d\n-data-dir:\u30b5\u30fc\u30d3\u30b9\u5b9a\u7fa9json\u683c\u7d0dDIR\n```\n\n## \u78ba\u8a8d\n```bash\n$ sudo consul members\nNode           Address          Status  Type    Build  Protocol  DC\nconsul-server  10.0.1.155:8301  alive   server  0.6.4  2         dc1\n```\n\n# consul-client\u8d77\u52d5\n\u30d5\u30a1\u30a4\u30eb\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u301c\u306fconsul-server\u3068\u540c\u3058\u624b\u9806\u3092\u8e0f\u3080\uff08Web-ui\u30d5\u30a1\u30a4\u30eb\u306f\u4e0d\u8981\uff09\nserver~client\u9593\u306ftcp:8300,8301\u3092\u660e\u793a\u7684\u306b\u8a31\u53ef\n\n```bash\n$ sudo consul agent -data-dir=/tmp/consul -node=consul-node1 -bind=10.0.0.90 -join=10.0.1.155 &\n```\n\n```text\n-join:consul\u30b5\u30fc\u30d0\u306eIP\n```\n\n## \u30af\u30e9\u30b9\u30bf\u3078\u30b8\u30e7\u30a4\u30f3\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash\n$ sudo consul members\nNode           Address          Status  Type    Build  Protocol  DC\nconsul-node1   10.0.0.90:8301   alive   client  0.6.4  2         dc1\nconsul-server  10.0.1.155:8301  alive   server  0.6.4  2         dc1\n```\n\n# web-ui\n8500\u30dd\u30fc\u30c8\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\n\n```http\nhttp://<server-hostname>:8500/ui\n```\n![Screenshot from 2016-09-10 21:39:09.png](https://qiita-image-store.s3.amazonaws.com/0/58788/b788b949-c042-66ee-dd09-e17f431e98fd.png)\n\n\n\n\n"}