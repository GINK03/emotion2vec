{"tags": ["AWS", "S3", "Ruby"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002\u30e1\u30e2\u66f8\u304d\n\n\u4e3b\u306b\u6271\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f3\u7a2e\u985e\n\nclient\uff08AWS\u3068\u306e\u63a5\u7d9a\u3092\u884c\u3046\uff09\nbucket\uff08\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff09\nobject\uff08\u30d5\u30a1\u30a4\u30eb\uff09\n\n\n1.client\ns3\u3092\u64cd\u4f5c\u3059\u308b\u4e3b\u4f53\u3068\u306a\u308b\nrequire 'aws-sdk'\n\nAWS.config({\n    :access_key_id => as.access,\n    :secret_access_key => as.secret,\n})\n\ns3 = AWS::S3.new\n\n\n2.bucket\n\n\u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\n\u8ab0\u304b\u304c\u65e2\u306b\u4f7f\u3063\u3066\u3044\u308b\u30d0\u30b1\u30c3\u30c8\u540d\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u3002\ns3.buckets.create 'angelbeats'\n#=> AWS::S3::Errors::BucketAlreadyExists: The requested bucket name is not available. The bucket namespace is shared by all users of the system. Please select a different name and try again.\n\ns3.buckets.create 'angel-beats'\n#=> #<AWS::S3::Bucket:angel-beats>\n\n\n\u30d0\u30b1\u30c3\u30c8\u306e\u5b58\u5728\n\u3042\u308b\u30d0\u30b1\u30c3\u30c8\u306a\u3044\u3057\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5b58\u5728\u3059\u308b\u304b\uff1f\u306fexists?\n\u8ab0\u304b\u304c\u4f7f\u3063\u3066\u304a\u308a\u3001\u6a29\u9650\u304c\u306a\u3044\u30d0\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u306f\u3001\u5f53\u305f\u308a\u524d\u3060\u304c\u5f3e\u304b\u308c\u308b\u3002\ns3.buckets['angel-beats'].exists?\n#=> true\n\ns3.buckets['angel----beats'].exists?\n#=> false\n\ns3.buckets['angelbeats'].exists?\n#=> AWS::S3::Errors::AllAccessDisabled: All access to this object has been disabled\n\n\n3.object\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\n\u5b58\u5728\u3057\u306a\u3044object\u3092write\u3059\u308b\u3068\u3001S3\u30b5\u30fc\u30d0\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u3002\nobj = s3.buckets['angel-beats'].objects['test.txt']\n#=> <AWS::S3::S3Object:angel-beats/test.txt>\n\nobj.exists?\n#=> false\n\nobj.write(\"\u5929\u4f7f\u3061\u3083\u3093\")\n#=> <AWS::S3::S3Object:angel-beats/test.txt>\n\nobj.exists?\n#=> true\n\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eURL\u306e\u78ba\u8a8d\u3001\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u306e\u64cd\u4f5c\n\u5b58\u5728\u3059\u308bobject\u306b\u306f\u3001\u4e00\u610f\u306eURL\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u3002\n\u3068\u306f\u3044\u3048\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u300c\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30f3\u30af\u300d\u306b\u306a\u3063\u3066\u3044\u308b\u3002\nobj.public_url.to_s\n#=> \"https://angel-beats.s3.amazonaws.com/test.txt\"\n\n# \"https://angel-beats.s3.amazonaws.com/test.txt\"\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\u3068\uff1a\n# <Message>Access Denied</Message>\n\n\u30d1\u30d6\u30ea\u30c3\u30af\u5c5e\u6027\u3092\u4e0e\u3048\u308c\u3070\u3001URL\u3067\u89b3\u89a7\u3067\u304d\u308b\u3002\n# write\u6642\nobj.write(\"\u5929\u4f7f\u3061\u3083\u3093\", acl: :public_read)\n\n# \u5f8c\u4ed8\u3051\nobj.acl = :public_read\n\n# \u623b\u3059\nobj.acl = :private\n\n\n\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8aad\u307f\u51fa\u3057\n\u306a\u304a\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u5c5e\u6027\u3092\u3064\u3051\u306a\u304f\u3066\u3082\u3001\u6a29\u9650\u3092\u6301\u3064client\u306a\u3089read\u3067\u8aad\u307f\u51fa\u305b\u308b\u3002\nobj.read\n#=> \"\\xE5\\xA4\\xA9\\xE4\\xBD\\xBF\\xE3\\x81\\xA1\\xE3\\x82\\x83\\xE3\\x82\\x93\"\n\nobj.read.encoding\n#=> #<Encoding:ASCII-8BIT>\n\nobj.read.force_encoding('utf-8')\n#=> \"\u5929\u4f7f\u3061\u3083\u3093\"\n\n\n\u305d\u306e\u4ed6\n\n\u3042\u308b\u30d0\u30b1\u30c3\u30c8\u306e\u3001\u30d5\u30a1\u30a4\u30eb\u3084\u30d5\u30a9\u30eb\u30c0\u306e\u4e00\u89a7\u3092\u53d6\u5f97\n# \u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\uff06\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e00\u89a7\ns3.buckets['angel-beats'].objects.map(&:key)\n#=> [\"test.txt\"] \n\n# \u30d5\u30a1\u30a4\u30eb\uff08\u30c4\u30ea\u30fc\u306e\u8449\u3063\u3071\uff09\u4e00\u89a7\ns3.buckets['angel-beats'].as_tree.children.select(&:leaf?).map(&:key)\n#=> [\"test.txt\"]\n\n# \u30d5\u30a9\u30eb\u30c0\uff08\u30c4\u30ea\u30fc\u306e\u679d\uff09\u4e00\u89a7\ns3.buckets['angel-beats'].as_tree.children.select(&:branch?).map(&:prefix)\n#=> []\n\n\n\u53c2\u8003\n\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306eRuby\u3068Amazon S3\u3067\u30c7\u30fc\u30bf\u3092\u3084\u308a\u53d6\u308a\u3059\u308b - \u672a\u8e0f\u4f5c\u696d\u65e5\u8a8c\u2015\u2015\u4f59\u8a08\u306a\u3082\u306e\u4f5c\u308b\u3088\uff01\n\n\u30e1\u30e2\u66f8\u304d\n\n## \u4e3b\u306b\u6271\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f3\u7a2e\u985e\n\n1. client\uff08AWS\u3068\u306e\u63a5\u7d9a\u3092\u884c\u3046\uff09\n2. bucket\uff08\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff09\n3. object\uff08\u30d5\u30a1\u30a4\u30eb\uff09\n\n## 1.client\ns3\u3092\u64cd\u4f5c\u3059\u308b\u4e3b\u4f53\u3068\u306a\u308b\n\n```ruby \nrequire 'aws-sdk'\n\nAWS.config({\n\t:access_key_id => as.access,\n\t:secret_access_key => as.secret,\n})\n\ns3 = AWS::S3.new\n```\n\n## 2.bucket\n### \u30d0\u30b1\u30c3\u30c8\u3092\u4f5c\u6210\n\n\u8ab0\u304b\u304c\u65e2\u306b\u4f7f\u3063\u3066\u3044\u308b\u30d0\u30b1\u30c3\u30c8\u540d\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u3002\n\n```ruby\ns3.buckets.create 'angelbeats'\n#=> AWS::S3::Errors::BucketAlreadyExists: The requested bucket name is not available. The bucket namespace is shared by all users of the system. Please select a different name and try again.\n\ns3.buckets.create 'angel-beats'\n#=> #<AWS::S3::Bucket:angel-beats>\n```\n\n### \u30d0\u30b1\u30c3\u30c8\u306e\u5b58\u5728\n\u3042\u308b\u30d0\u30b1\u30c3\u30c8\u306a\u3044\u3057\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5b58\u5728\u3059\u308b\u304b\uff1f\u306f`exists?`\n\u8ab0\u304b\u304c\u4f7f\u3063\u3066\u304a\u308a\u3001\u6a29\u9650\u304c\u306a\u3044\u30d0\u30b1\u30c3\u30c8\u306b\u5bfe\u3057\u3066\u306f\u3001\u5f53\u305f\u308a\u524d\u3060\u304c\u5f3e\u304b\u308c\u308b\u3002\n\n```ruby\ns3.buckets['angel-beats'].exists?\n#=> true\n\ns3.buckets['angel----beats'].exists?\n#=> false\n\ns3.buckets['angelbeats'].exists?\n#=> AWS::S3::Errors::AllAccessDisabled: All access to this object has been disabled\n```\n\n## 3.object\n\n### \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\n\u5b58\u5728\u3057\u306a\u3044object\u3092write\u3059\u308b\u3068\u3001S3\u30b5\u30fc\u30d0\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u308b\u3002\n\n```ruby\nobj = s3.buckets['angel-beats'].objects['test.txt']\n#=> <AWS::S3::S3Object:angel-beats/test.txt>\n\nobj.exists?\n#=> false\n\nobj.write(\"\u5929\u4f7f\u3061\u3083\u3093\")\n#=> <AWS::S3::S3Object:angel-beats/test.txt>\n\nobj.exists?\n#=> true\n```\n\n### \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306eURL\u306e\u78ba\u8a8d\u3001\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u306e\u64cd\u4f5c\n\u5b58\u5728\u3059\u308bobject\u306b\u306f\u3001\u4e00\u610f\u306eURL\u304c\u4e0e\u3048\u3089\u308c\u3066\u3044\u308b\u3002\n\u3068\u306f\u3044\u3048\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u300c\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ea\u30f3\u30af\u300d\u306b\u306a\u3063\u3066\u3044\u308b\u3002\n\n```ruby\nobj.public_url.to_s\n#=> \"https://angel-beats.s3.amazonaws.com/test.txt\"\n\n# \"https://angel-beats.s3.amazonaws.com/test.txt\"\u3092\u30d6\u30e9\u30a6\u30b6\u3067\u958b\u304f\u3068\uff1a\n# <Message>Access Denied</Message>\n```\n\n\u30d1\u30d6\u30ea\u30c3\u30af\u5c5e\u6027\u3092\u4e0e\u3048\u308c\u3070\u3001URL\u3067\u89b3\u89a7\u3067\u304d\u308b\u3002\n\n```ruby\n# write\u6642\nobj.write(\"\u5929\u4f7f\u3061\u3083\u3093\", acl: :public_read)\n\n# \u5f8c\u4ed8\u3051\nobj.acl = :public_read\n\n# \u623b\u3059\nobj.acl = :private\n```\n\n### \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8aad\u307f\u51fa\u3057\n\u306a\u304a\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u5c5e\u6027\u3092\u3064\u3051\u306a\u304f\u3066\u3082\u3001\u6a29\u9650\u3092\u6301\u3064client\u306a\u3089`read`\u3067\u8aad\u307f\u51fa\u305b\u308b\u3002\n\n```ruby\nobj.read\n#=> \"\\xE5\\xA4\\xA9\\xE4\\xBD\\xBF\\xE3\\x81\\xA1\\xE3\\x82\\x83\\xE3\\x82\\x93\"\n\nobj.read.encoding\n#=> #<Encoding:ASCII-8BIT>\n\nobj.read.force_encoding('utf-8')\n#=> \"\u5929\u4f7f\u3061\u3083\u3093\"\n```\n\n\n## \u305d\u306e\u4ed6\n### \u3042\u308b\u30d0\u30b1\u30c3\u30c8\u306e\u3001\u30d5\u30a1\u30a4\u30eb\u3084\u30d5\u30a9\u30eb\u30c0\u306e\u4e00\u89a7\u3092\u53d6\u5f97\n\n```ruby\n# \u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\uff06\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4e00\u89a7\ns3.buckets['angel-beats'].objects.map(&:key)\n#=> [\"test.txt\"] \n\n# \u30d5\u30a1\u30a4\u30eb\uff08\u30c4\u30ea\u30fc\u306e\u8449\u3063\u3071\uff09\u4e00\u89a7\ns3.buckets['angel-beats'].as_tree.children.select(&:leaf?).map(&:key)\n#=> [\"test.txt\"]\n\n# \u30d5\u30a9\u30eb\u30c0\uff08\u30c4\u30ea\u30fc\u306e\u679d\uff09\u4e00\u89a7\ns3.buckets['angel-beats'].as_tree.children.select(&:branch?).map(&:prefix)\n#=> []\n```\n\n## \u53c2\u8003\n[\u30ed\u30fc\u30ab\u30eb\u74b0\u5883\u306eRuby\u3068Amazon S3\u3067\u30c7\u30fc\u30bf\u3092\u3084\u308a\u53d6\u308a\u3059\u308b - \u672a\u8e0f\u4f5c\u696d\u65e5\u8a8c\u2015\u2015\u4f59\u8a08\u306a\u3082\u306e\u4f5c\u308b\u3088\uff01](\nhttp://grgsiberia-mitou.hatenadiary.jp/entry/2014/01/17/000310)\n"}