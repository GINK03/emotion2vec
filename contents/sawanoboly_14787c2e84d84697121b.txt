{"context": " More than 1 year has passed since last update.\nAmazon EC2\u3067CentOS\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u3001CentOS\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304cAWS MarketPlace\u306b\u516c\u958b\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u304c\u4e00\u5fdc\u3042\u308b\u3002\n\n\u304b\u306a\u308a\u7d20\u306e\u72b6\u614b\u3067\u7f6e\u3044\u3066\u3042\u308a\u3001\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306a\u70b9\u3067Amazon Linux\u306a\u3069\u3068\u7570\u306a\u3063\u3066\u3044\u308b\u3002\n\n\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304croot\n\n\n\u3064\u3044\u3067\u306b\u30e9\u30f3\u30c0\u30e0\u30d1\u30b9\u30ef\u30fc\u30c9\n\n\nIptables, Selinux\u304c\u6709\u52b9\n\nec2metadata\u3084aws\u30b3\u30de\u30f3\u30c9\u304c\u306a\u3044 (curl\u3067\u53d6\u308b\u306e\u306fOK)\ncloud-init\u304c\u5165\u3063\u3066\u306a\u3044\n\n\nPacker\u3067\u8abf\u6574\u3057\u3066\u4fdd\u5b58\n\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3002\nhttps://github.com/OpsRockin/centos6_ami_from_official\n\u3053\u308c\u306b\u3088\u308a\u3001\u6b21\u306e\u3088\u3046\u306b\u8abf\u6574\u3057\u305fAMI\u3092\u4f5c\u308c\u308b\u3002\n\n- Iptables, Selinux\u7121\u52b9\n\u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306fcloud-user\u306b\u3001sudo\u5bfe\u5fdc\n\n\nPlease login as the user \"cloud-user\" rather than the user \"root\".\n\n\n\naws\u30b3\u30de\u30f3\u30c9\u6a19\u6e96\u88c5\u5099\u3001Role\u3082\u5bfe\u5fdc\n\nPacker\u306eShell-Provisioner\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nbootstrap.sh\n#!/usr/bin/env bash\n\nset -ex\n\n# Disable Selinux and Iptables\nsed s/SELINUX=enforcing/SELINUX=disabled/ /etc/selinux/config -i\nchkconfig iptables off\nchkconfig ip6tables off\n\nyum update -y\n\n\n## Install AWS Tools and Git\nrpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\nyum install -y cloud-init git jq cloud-utils python-pip\npip install awscli\n\n\n## Remove Password from root\npasswd -d root\nsed -e '9,$d' /etc/rc.local -i\n\n\n## Set sudo rule for cloud-user\ncat <<EOL > cloud-init\ncloud-user ALL = NOPASSWD: ALL\n\n# User rules for cloud-user\ncloud-user ALL=(ALL) NOPASSWD:ALL\nDefaults:cloud-user !requiretty\nEOL\n\ninstall -o root -g root -m 0440 cloud-init /etc/sudoers.d/cloud-init\nrm -f cloud-init\n\n\n\u3053\u308c\u3067\u4f5c\u3063\u3066\u304a\u3044\u305fAMI\u306b\u5bfe\u3057\u3066\u306f\u3001\u901a\u5e38\u306eAmazon\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u3068\u307b\u307c\u540c\u69d8\u306e\u6271\u3044\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n$ ssh cloud-user@ec2-xx-xx-xxx-xxx.compute-1.amazonaws.com sudo echo 'hogehoge'\nhogehoge\n\n\u5143\u304cAWS MarketPlace\u306e\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u66f4\u306bPublic\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u306a\u3044\u3051\u3069\u3002\n<!-- permanent -->\n\n\nAmazon EC2\u3067CentOS\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u3001CentOS\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u304cAWS MarketPlace\u306b\u516c\u958b\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u304c\u4e00\u5fdc\u3042\u308b\u3002\n\n\n![CentOS_6__x86_64__-_with_Updates_on_AWS_Marketplace.png](https://qiita-image-store.s3.amazonaws.com/0/7454/30cb71f0-b992-8ca7-1eb2-75afea9ffb68.png \"CentOS_6__x86_64__-_with_Updates_on_AWS_Marketplace.png\")\n\n\n\u304b\u306a\u308a\u7d20\u306e\u72b6\u614b\u3067\u7f6e\u3044\u3066\u3042\u308a\u3001\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306a\u70b9\u3067Amazon Linux\u306a\u3069\u3068\u7570\u306a\u3063\u3066\u3044\u308b\u3002\n\n- \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u304croot\n    - \u3064\u3044\u3067\u306b\u30e9\u30f3\u30c0\u30e0\u30d1\u30b9\u30ef\u30fc\u30c9\n- Iptables, Selinux\u304c\u6709\u52b9\n- `ec2metadata`\u3084`aws`\u30b3\u30de\u30f3\u30c9\u304c\u306a\u3044 (curl\u3067\u53d6\u308b\u306e\u306fOK)\n- cloud-init\u304c\u5165\u3063\u3066\u306a\u3044\n\n## Packer\u3067\u8abf\u6574\u3057\u3066\u4fdd\u5b58\n\n\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3002\n\n[https://github.com/OpsRockin/centos6_ami_from_official](https://github.com/OpsRockin/centos6_ami_from_official)\n\n\u3053\u308c\u306b\u3088\u308a\u3001\u6b21\u306e\u3088\u3046\u306b\u8abf\u6574\u3057\u305fAMI\u3092\u4f5c\u308c\u308b\u3002\n\n- - Iptables, Selinux\u7121\u52b9\n- \u30ed\u30b0\u30a4\u30f3\u30e6\u30fc\u30b6\u306f`cloud-user`\u306b\u3001sudo\u5bfe\u5fdc\n    - `Please login as the user \"cloud-user\" rather than the user \"root\".`\n- `aws`\u30b3\u30de\u30f3\u30c9\u6a19\u6e96\u88c5\u5099\u3001Role\u3082\u5bfe\u5fdc\n\nPacker\u306eShell-Provisioner\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n```shell:bootstrap.sh\n#!/usr/bin/env bash\n\nset -ex\n\n# Disable Selinux and Iptables\nsed s/SELINUX=enforcing/SELINUX=disabled/ /etc/selinux/config -i\nchkconfig iptables off\nchkconfig ip6tables off\n\nyum update -y\n\n\n## Install AWS Tools and Git\nrpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm\nyum install -y cloud-init git jq cloud-utils python-pip\npip install awscli\n\n\n## Remove Password from root\npasswd -d root\nsed -e '9,$d' /etc/rc.local -i\n\n\n## Set sudo rule for cloud-user\ncat <<EOL > cloud-init\ncloud-user ALL = NOPASSWD: ALL\n\n# User rules for cloud-user\ncloud-user ALL=(ALL) NOPASSWD:ALL\nDefaults:cloud-user !requiretty\nEOL\n\ninstall -o root -g root -m 0440 cloud-init /etc/sudoers.d/cloud-init\nrm -f cloud-init\n```\n\n\u3053\u308c\u3067\u4f5c\u3063\u3066\u304a\u3044\u305fAMI\u306b\u5bfe\u3057\u3066\u306f\u3001\u901a\u5e38\u306eAmazon\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u3068\u307b\u307c\u540c\u69d8\u306e\u6271\u3044\u304c\u53ef\u80fd\u306b\u306a\u308b\u3002\n\n```\n$ ssh cloud-user@ec2-xx-xx-xxx-xxx.compute-1.amazonaws.com sudo echo 'hogehoge'\nhogehoge\n```\n\n\u5143\u304cAWS MarketPlace\u306e\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u3053\u308c\u3092\u66f4\u306bPublic\u306b\u3059\u308b\u4e8b\u306f\u3067\u304d\u306a\u3044\u3051\u3069\u3002\n", "tags": ["packer", "CentOS", "AWS"]}