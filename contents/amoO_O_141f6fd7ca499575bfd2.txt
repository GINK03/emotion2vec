{"context": "ver 1 \u2192 .git/hooks/pre-push \u899a\u66f8\uff08rails\u30a2\u30d7\u30ea\u7de8\uff09\nhotfix \u4f5c\u696d\u4e2d\u306b\u5225\u30bf\u30b9\u30af\uff08 feature \u2192 develop \uff09\u306e\u30d7\u30eb\u30ea\u30af\u304c\u901a\u308a\u3001hotfix \u7d42\u4e86\u5f8c\u306b\u8aa4\u3063\u3066 git push -f origin develop \u3092\u3084\u3089\u304b\u3057\u3066 develop \u3092\u4e0a\u66f8\u304d\u3057\u3066\u3057\u307e\u3063\u305f\u3002 feature \u30d6\u30e9\u30f3\u30c1\u306f\u6b8b\u3063\u3066\u3044\u305f\u306e\u3067\u30d7\u30eb\u30ea\u30af\u3092\u51fa\u3057\u76f4\u3057\u3066\u30ec\u30d3\u30e5\u30ef\u30fc\u306b\u713c\u304d\u571f\u4e0b\u5ea7\u3092\u3057\u305f\u304c\u3001\n\n\ndevelop \u306b git push -f \u3057\u305f\u3089\u30a2\u30ab\u30f3\n\u8aa4\u3063\u3066 git push -f \u3057\u3066\u3082\u3001 pre-push \u30d5\u30c3\u30af\u3067\u5f3e\u3044\u3066\u6b32\u3057\u3044\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u3053\u3061\u3089\u3092\u53c2\u8003\u306b .git/hooks/pre-push \u3092\u4fee\u6b63\n\n.git/hooks/pre-push\n#!/bin/bash\n\nprotected_branch='master|develop'\n\ncurrent_branch=$(git symbolic-ref HEAD | sed -e 's,refs/heads/\\(.*\\),\\1,')\npush_command=$(ps -ocommand= -p $PPID)\nis_destructive='force|delete|\\-f'\n\npolicy=\"[Policy] Never force push or delete the $protected_branch branch! (Prevented with pre-push hook.)\"\nproc_exit(){\n  echo $policy\n  exit 1\n}\n\nprevent_force_push() {\n  if [[ $push_command =~ $is_destructive ]]; then\n    if [[ $current_branch =~ $protected_branch ]] || [[ $push_command =~ $protected_branch ]]; then\n      proc_exit\n    fi\n  fi\n}\n\nprevent_delete() {\n  delete_reg=' :('$protected_branch')'\n  if [[ $push_command =~ $delete_reg ]]; then\n    proc_exit\n  fi\n}\n\nproc_test() {\n  activator scalastyle\n  ss=$?\n\n  activator test:scalastyle\n  tss=$?\n\n  activator test\n  t=$?\n\n  exit $(($ss || $tss || $t))\n}\n\nprevent_force_push\nprevent_delete\nproc_test\n\n\nrails\u30a2\u30d7\u30ea \u306e\u5834\u5408\u306f proc_test \u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\nbundle exec rubocop\ncop=$?\n\nbundle exec rspec spec\npec=$?\n\nexit $(($cop || $pec))\n\nver 1 \u2192 [.git/hooks/pre-push \u899a\u66f8\uff08rails\u30a2\u30d7\u30ea\u7de8\uff09](http://qiita.com/amoO_O/items/e710389c3468064e633f)\n\n`hotfix` \u4f5c\u696d\u4e2d\u306b\u5225\u30bf\u30b9\u30af\uff08 `feature` \u2192 `develop` \uff09\u306e\u30d7\u30eb\u30ea\u30af\u304c\u901a\u308a\u3001`hotfix` \u7d42\u4e86\u5f8c\u306b\u8aa4\u3063\u3066 `git push -f origin develop` \u3092\u3084\u3089\u304b\u3057\u3066 `develop` \u3092\u4e0a\u66f8\u304d\u3057\u3066\u3057\u307e\u3063\u305f\u3002 `feature` \u30d6\u30e9\u30f3\u30c1\u306f\u6b8b\u3063\u3066\u3044\u305f\u306e\u3067\u30d7\u30eb\u30ea\u30af\u3092\u51fa\u3057\u76f4\u3057\u3066\u30ec\u30d3\u30e5\u30ef\u30fc\u306b\u713c\u304d\u571f\u4e0b\u5ea7\u3092\u3057\u305f\u304c\u3001\n\n- `develop` \u306b `git push -f` \u3057\u305f\u3089\u30a2\u30ab\u30f3\n- \u8aa4\u3063\u3066 `git push -f` \u3057\u3066\u3082\u3001 `pre-push` \u30d5\u30c3\u30af\u3067\u5f3e\u3044\u3066\u6b32\u3057\u3044\n\n\u3068\u3044\u3046\u308f\u3051\u3067[\u3053\u3061\u3089\u3092\u53c2\u8003](https://gist.github.com/pixelhandler/5718585)\u306b `.git/hooks/pre-push` \u3092\u4fee\u6b63\n\n```bash:.git/hooks/pre-push\n#!/bin/bash\n\nprotected_branch='master|develop'\n\ncurrent_branch=$(git symbolic-ref HEAD | sed -e 's,refs/heads/\\(.*\\),\\1,')\npush_command=$(ps -ocommand= -p $PPID)\nis_destructive='force|delete|\\-f'\n\npolicy=\"[Policy] Never force push or delete the $protected_branch branch! (Prevented with pre-push hook.)\"\nproc_exit(){\n  echo $policy\n  exit 1\n}\n\nprevent_force_push() {\n  if [[ $push_command =~ $is_destructive ]]; then\n    if [[ $current_branch =~ $protected_branch ]] || [[ $push_command =~ $protected_branch ]]; then\n      proc_exit\n    fi\n  fi\n}\n\nprevent_delete() {\n  delete_reg=' :('$protected_branch')'\n  if [[ $push_command =~ $delete_reg ]]; then\n    proc_exit\n  fi\n}\n\nproc_test() {\n  activator scalastyle\n  ss=$?\n\n  activator test:scalastyle\n  tss=$?\n\n  activator test\n  t=$?\n\n  exit $(($ss || $tss || $t))\n}\n\nprevent_force_push\nprevent_delete\nproc_test\n```\n\nrails\u30a2\u30d7\u30ea \u306e\u5834\u5408\u306f `proc_test` \u3092\u6b21\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u308b\u3002\n\n```\nbundle exec rubocop\ncop=$?\n\nbundle exec rspec spec\npec=$?\n\nexit $(($cop || $pec))\n```\n", "tags": ["Bash", "Scala", "PlayFramework", "Rails"]}