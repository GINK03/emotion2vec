{"tags": ["GoogleAppsScript", "Slack"], "context": " More than 1 year has passed since last update.\n\u307e\u305a\u306f\u3001App Script\u3067\u3059\u3002\nfunction slackResponse(txt) {\n  return ContentService.createTextOutput(JSON.stringify({text: txt}))\n                       .setMimeType(ContentService.MimeType.JSON); \n}\n\nfunction genQueryURI(q) {\n  return \"http://api.giphy.com/v1/gifs/search?q=\"+ encodeURIComponent(q) +\"&api_key=dc6zaTOxFJmzC\";\n}\n\nfunction lookup(q) {\n  var uri = genQueryURI(q);\n  var response = UrlFetchApp.fetch(uri);\n  return JSON.parse(response.getContentText());\n}\n\nfunction doGet() {\n  return slackResponse(\"?\");\n}\n\nfunction doPost(e) {\n  var command = e.parameters.text[0].split(\" \");\n\n  if(command.length < 2) {\n    return slackResponse(\"Use: !giphy [tags to seach for]\");\n  }\n\n  var resp = lookup(command.slice(1).join(\" \"));\n\n  if(resp.meta.status !== 200) {\n    return slackResponse(\"Error: \" + resp.meta.status + \" - \" + resp.meta.msg);\n  }\n\n  var data = resp.data;\n\n  if (data.length === 0){\n    return slackResponse(\"No images found.\");\n  }\n\n  var selectedImage = data[Math.floor(Math.random() * data.length)];\n\n  return slackResponse(selectedImage.images[\"downsized\"]);\n}\n\n\u4e0a\u8a18\u3092\u4fdd\u5b58\u3057\u3066\u3001\u4e00\u56de\u30e1\u30cb\u30e5\u30fc\u304b\u3089lookup\u3068\u3044\u3046function\u3092\u9078\u3093\u3067\u3001\u52d5\u304b\u3057\u3087\u3046\u3002Google App Script\u306f\u3001\u5916\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u306b\u306f\u3001Authorization\u304c\u5fc5\u8981\u306e\u3067\u3053\u3053\u3067\u304d\u304b\u308c\u307e\u3059\u3002\u51fa\u3066\u304f\u308bDialog\u3046\u3092OK\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\u6b21\u306f\u3001\u30e1\u30cb\u30e5\u30fc\u304b\u3089Publish -> Deploy as web app...\u3092\u9078\u3073\u307e\u3057\u3087\u3046\uff0e\n\n\u305d\u3057\u3066\u3001\u8ab0\u3067\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u7528\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\nUpdate\u62bc\u3059\u3068\u3001URL\u304c\u51fa\u3066\u304d\u307e\u3059\uff0e\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001Slack\u306eOutgoing Webhook\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\uff0e\nhttps://[your slack team].slack.com/home\u304b\u3089\u306f\u3067\u304d\u307e\u3059\u3002\n\u30c1\u30e3\u30cd\u30eb\u3067!giphy funny cat\u3084!giphy dancing bear\u306a\u3069\u3092\u697d\u3057\u307f\u307e\u3057\u3087\u3046\uff0e\n![Screen Shot 2014-11-19 at 11.04.01 AM.png](https://qiita-image-store.s3.amazonaws.com/0/32921/c578d57c-1cea-f89c-0977-eb7fa50e28d1.png)\n\n\u307e\u305a\u306f\u3001App Script\u3067\u3059\u3002\n\n```js\nfunction slackResponse(txt) {\n  return ContentService.createTextOutput(JSON.stringify({text: txt}))\n                       .setMimeType(ContentService.MimeType.JSON); \n}\n\nfunction genQueryURI(q) {\n  return \"http://api.giphy.com/v1/gifs/search?q=\"+ encodeURIComponent(q) +\"&api_key=dc6zaTOxFJmzC\";\n}\n\nfunction lookup(q) {\n  var uri = genQueryURI(q);\n  var response = UrlFetchApp.fetch(uri);\n  return JSON.parse(response.getContentText());\n}\n\nfunction doGet() {\n  return slackResponse(\"?\");\n}\n\nfunction doPost(e) {\n  var command = e.parameters.text[0].split(\" \");\n  \n  if(command.length < 2) {\n    return slackResponse(\"Use: !giphy [tags to seach for]\");\n  }\n  \n  var resp = lookup(command.slice(1).join(\" \"));\n  \n  if(resp.meta.status !== 200) {\n    return slackResponse(\"Error: \" + resp.meta.status + \" - \" + resp.meta.msg);\n  }\n  \n  var data = resp.data;\n  \n  if (data.length === 0){\n    return slackResponse(\"No images found.\");\n  }\n  \n  var selectedImage = data[Math.floor(Math.random() * data.length)];\n    \n  return slackResponse(selectedImage.images[\"downsized\"]);\n}\n```\n\n\u4e0a\u8a18\u3092\u4fdd\u5b58\u3057\u3066\u3001\u4e00\u56de\u30e1\u30cb\u30e5\u30fc\u304b\u3089lookup\u3068\u3044\u3046function\u3092\u9078\u3093\u3067\u3001\u52d5\u304b\u3057\u3087\u3046\u3002Google App Script\u306f\u3001\u5916\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308b\u306b\u306f\u3001Authorization\u304c\u5fc5\u8981\u306e\u3067\u3053\u3053\u3067\u304d\u304b\u308c\u307e\u3059\u3002\u51fa\u3066\u304f\u308bDialog\u3046\u3092OK\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\n\u6b21\u306f\u3001\u30e1\u30cb\u30e5\u30fc\u304b\u3089`Publish -> Deploy as web app...`\u3092\u9078\u3073\u307e\u3057\u3087\u3046\uff0e\n\n![Screen Shot 2014-11-19 at 11.09.26 AM.png](https://qiita-image-store.s3.amazonaws.com/0/32921/3139d218-fdce-c28c-f12e-55387de0aa0c.png)\n\n\u305d\u3057\u3066\u3001\u8ab0\u3067\u3082\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u7528\u306b\u3057\u3066\u304f\u3060\u3055\u3044\uff0e\n\n![Screen Shot 2014-11-19 at 11.10.54 AM.png](https://qiita-image-store.s3.amazonaws.com/0/32921/5753be8c-1dee-9afc-3b43-821a88b8583d.png)\n\nUpdate\u62bc\u3059\u3068\u3001URL\u304c\u51fa\u3066\u304d\u307e\u3059\uff0e\n\n\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u3001Slack\u306eOutgoing Webhook\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\uff0e\n`https://[your slack team].slack.com/home`\u304b\u3089\u306f\u3067\u304d\u307e\u3059\u3002\n\n\u30c1\u30e3\u30cd\u30eb\u3067`!giphy funny cat`\u3084`!giphy dancing bear`\u306a\u3069\u3092\u697d\u3057\u307f\u307e\u3057\u3087\u3046\uff0e\n\n"}