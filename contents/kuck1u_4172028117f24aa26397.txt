{"context": " More than 1 year has passed since last update.\u3053\u306e\u30e1\u30e2\u306f\u3001ConoHa \u306e Nginx + WordPress CentOS \u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u7528\u3059\u308b\u6642\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u307e\u305f\u3001\u5e38\u306b\u66f4\u65b0\u3068\u4fee\u6b63\u304c\u884c\u308f\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u306e DNS \u30ec\u30b3\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u89e6\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u5404\u81ea\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066 VPS \u3092\u8ffd\u52a0\nConoHa \u306b\u306f\u4e88\u3081 WordPress \u3092\u5feb\u9069\u306b\u5229\u7528\u3059\u308b\u70ba\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\n\u30a4\u30f3\u30d5\u30e9\u77e5\u8b58\u306a\u3044\u3057\u3001\u6298\u89d2\u306a\u306e\u3067\u3042\u308a\u304c\u305f\u304f\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304f\u3002\nVPS \u3092\u8ffd\u52a0\u3059\u308b\u969b [ \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 ] Nginx + WordPress CentOS \u3092\u9078\u629e\u3057\u3066 VPS \u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u4f55\u3082\u8003\u3048\u305a\u306b\u53d6\u308a\u6562\u3048\u305a\u6700\u65b0\u306b\u3057\u3066\u307f\u308b\u3002\n$ yum update\n\n\n\u30dd\u30fc\u30c8\u756a\u53f7\u306e\u8a2d\u5b9a\n\nIPv4 \u306e\u8a2d\u5b9a\n$ vi /etc/sysconfig/iptables\n$ ggVGd\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n*filter\n:INPUT   ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT  ACCEPT [0:0]\n:RH-Firewall-1-INPUT - [0:0]\n\n-A INPUT -j RH-Firewall-1-INPUT\n-A FORWARD -j RH-Firewall-1-INPUT\n-A RH-Firewall-1-INPUT -i lo -j ACCEPT\n-A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 10022 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80    -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 443   -j ACCEPT\n\n-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\n$ service iptables restart\n\n\n\u3053\u306e\u7bc0\u306fCentOS \u306b iptables \u306e\u8a2d\u5b9a\u3092\u884c\u3046 (IPv4)\u3088\u308a\u5f15\u7528\n\n\nIPv6 \u306e\u8a2d\u5b9a\n$ vi /etc/sysconfig/ip6tables\n$ ggVGd\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n# Firewall configuration written by system-config-firewall\n# Manual customization of this file is not recommended.\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n:RH-Firewall-1-INPUT - [0:0]\n-A INPUT -j RH-Firewall-1-INPUT\n-A FORWARD -j RH-Firewall-1-INPUT\n-A RH-Firewall-1-INPUT -i lo -j ACCEPT\n-A RH-Firewall-1-INPUT -p icmpv6 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 10022 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80    -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 443   -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m udp -p udp --dport 546 --sport 547 -s fe80::/10 -d fe80::/10 -j ACCEPT\n-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp6-adm-prohibited\n\n-A FORWARD -j REJECT --reject-with icmp6-adm-prohibited\nCOMMIT\n\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\n$ service ip6tables restart\n\n\n\u3053\u306e\u7bc0\u306fCentOS \u306b ip6tables \u306e\u8a2d\u5b9a\u3092\u884c\u3046(IPv6)\u3088\u308a\u5f15\u7528\n\n\nSSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\n$ vi /etc/ssh/sshd_config\n\n#Port 22 \u3068\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308b\u306e\u3067 Port 10022 \u306b\u5909\u66f4\u3057\u3066\u4fdd\u5b58\u3002\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\nservice sshd restart\n\n\n\u3053\u306e\u7bc0\u306fCentOS \u306e SSH \u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\u3059\u308b\u3088\u308a\u5f15\u7528\n\n\nphpMyAdmin \u3092\u66f4\u65b0\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u304b\u78ba\u8a8d\n$ yum list | grep phpMyAdmin\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\nphpMyAdmin.noarch                       4.2.6-2.el6.remi            remi\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n$ yum --enablerepo=remi install phpmyadmin\n\n\nNginx \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n\nphpMyAdmin \u3092\u52d5\u304b\u3059\u70ba\u306e\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n$ vi /etc/nginx/conf.d/phpmyadmin.conf\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3057\u3001server_name \u3092\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\nserver {\n    listen      80;\n    server_name phpmyadmin.example.com;\n    root        /var/www/vhosts/default;\n    index       index.html index.htm;\n    charset     utf-8;\n\n    include     /etc/nginx/drop;\n\n    # phpMyAdmin\n    location /phpMyAdmin {\n        alias                /usr/share/phpMyAdmin;\n        index                index.php;\n        include              /etc/nginx/expires;\n        auth_basic           \"Local Security\";\n        auth_basic_user_file \"/var/www/vhosts/default/.htpasswd\";\n    }\n    location ~ ^/phpMyAdmin/.+\\.php$ {\n        alias /usr/share/phpMyAdmin;\n        fastcgi_pass   phpfpm;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME /usr/share$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}\n\n.htpasswd \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\nhtpasswd -nbs YourName YourPassword > /var/www/vhosts/default/.htpasswd\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n$ service nginx restart\n\n\u306a\u304a\u3001/etc/nginx/conf.d/default.conf \u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001/etc/nginx/conf.d/default.conf \u306e 53 \u884c\u76ee\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u3001Nginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3060\u3051\u3067\u5b8c\u4e86\u3067\u3059\u3002\nBasic \u8a8d\u8a3c\u3092\u639b\u3051\u308b\u5834\u5408\u306f\u3001auth_basic \u3068 auth_basic_user_file \u306e\u90e8\u5206\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nMySQL \u8a2d\u5b9a\n\nMySQL \u306e root \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8a2d\u5b9a\n$ mysqladmin -u root password '\u597d\u304d\u306a\u30d1\u30b9\u30ef\u30fc\u30c9'\n$ mysql -u root -p mysql\n$ DELETE FROM user WHERE user = '';\n$ DELETE FROM user WHERE host != 'localhost';\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u534a\u89d2\u82f1\u6570\u5b57 + \u5927\u6587\u5b57\u82f1\u5b57 + \u5c0f\u6587\u5b57\u82f1\u5b57 + \u8a18\u53f7\u3067\u69cb\u6210\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nGit \u306e\u524a\u9664\u3068\u6700\u65b0\u7248\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGit \u306f\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 1.7 \u3067\u3042\u3063\u305f\u305f\u3081\u4e00\u65e6\u524a\u9664\u3057\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nGit \u306e\u524a\u9664\n$ yum remove git\n\n\n\u6700\u65b0\u7248\u306e Git \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install make curl-devel gcc openssl-devel expat-devel  cpan\n$ yum install gettext  asciidoc xmlto\n$ mkdir /root/temp/\n$ cd /root/temp/\n$ wget https://www.kernel.org/pub/software/scm/git/git-2.2.1.tar.gz\n$ yum install zlib-devel.x86_64\n$ tar -zxf git-2.2.1.tar.gz\n$ cd ./git-2.2.1\n$ make prefix=/usr all\n$ make prefix=/usr install\n$ rm -rf /root/temp/*\n\n\nGit \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u306a\u3044\n\u3044\u3056 Git \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u304a\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u4e8b\u304c\u3042\u308b\u3002\n$ git --version\n-bash: /usr/bin/git: \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093\n\n\u3053\u306e\u5834\u5408\u3001Git \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u6240\u3092\u63a2\u3057\u3066\u3001\u305d\u306e\u5834\u6240\u3092\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067\u7e4b\u3052\u3066\u3042\u3052\u308b\u3068\u89e3\u6c7a\u3059\u308b\u3002\n$ which git\n/usr/local/bin/git\n$ ln -s /usr/local/bin/git /usr/bin/git\n\n\n\u30ed\u30b0\u76e3\u8996\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\nLogwatch \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install logwatch\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n$ /usr/sbin/logwatch --print\n\n\n\u8a2d\u5b9a\u3092\u5909\u66f4\n$ vi /usr/share/logwatch/default.conf/logwatch.conf\n\n\u30ed\u30b0\u76e3\u8996\u30c4\u30fc\u30eb Logwatch \u3092\u4f7f\u3063\u3066\u307f\u308b\u3092\u53c2\u8003\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n\u3053\u306e\u7ae0\u306fVPS \u501f\u308a\u305f\u3089\u3001\u305b\u3081\u3066\u3053\u308c\u304f\u3089\u3044\u306f\u3084\u3063\u3068\u3051\u3068\u3044\u3046\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a\u3088\u308a\u5f15\u7528\n\n\nOS \u5168\u4f53\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\nMondoRescue \u3092\u5c0e\u5165\n$ wget ftp://ftp.mondorescue.org/rhel/6/x86_64/mondorescue.repo\n$ mv mondorescue.repo /etc/yum.repos.d/\n$ yum -y install mondo\n\n\n\u5727\u7e2e\u30bd\u30d5\u30c8 ( LZO ) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ vi /etc/yum.repos.d/dag.repo\n[dag]\nname=Dag RPM Repository for Red Hat Enterprise Linux\nbaseurl=http://ftp.riken.jp/Linux/dag/redhat/el$releasever/en/$basearch/dag\ngpgcheck=1\ngpgkey=http://dag.wieers.com/packages/RPM-GPG-KEY.dag.txt\nenabled=0\n\n$ yum -y install lzop lzo --enablerepo=dag\n\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u5b9f\u884c\n$ setenforce 0\n$ mkdir /tmp/backup/\n$ mondoarchive -Oi -L -N -s 4200m -d /tmp/backup -E /tmp/backup\n$ setenforce 1\n\n\n\u3053\u306e\u7ae0\u306f\u3055\u304f\u3089VPS\u4e0a\u306eOS\u3092\u4e38\u3054\u3068\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u3088\u308a\u5f15\u7528\n\n\nWordPress \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n\nNginx \u306e\u8a2d\u5b9a (\u4e0d\u8981\u3067\u3059)\n@wokamoto \u3055\u3093\u3088\u308a\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u3092\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e \u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650 \u306f\u4e0d\u8981\u3067\u3059\u3002\n/etc/nginx/conf.d/default.conf \u5185\u306b include /etc/nginx/drop; \u3068\u3044\u3046\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e include /etc/nginx/drop; \u306e\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\nlocation ~ /\\. { deny all; access_log /dev/null; log_not_found off; }\n\n\u203b\u4e00\u90e8\u629c\u7c8b\n\u3053\u306e\u8a18\u8ff0\u304c \u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650 \u3068\u88ab\u308b\u70ba\u4e0d\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u3001wp-config.php \u3068 wp-blog-header.php \u306b\u30a2\u30af\u30bb\u30b9\u304c\u3042\u3063\u305f\u5834\u5408\u3001404 \u3092\u8fd4\u3059\u3088\u3046\u306a\u8a18\u8ff0\u3082\u3042\u308a\u307e\u3057\u305f\u3002\ninclude \u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u3082\u3057\u3063\u304b\u308a\u78ba\u8a8d\u3057\u306a\u3044\u3068\u3067\u3059\u306d!!\n\n\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650 ( \u4e0d\u8981\u3067\u3059 )\n/etc/nginx/conf.d/default.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3002\nlocation ~ (\\.ht|\\.git|\\.svn|\\.conf) {\n    deny  all;\n}\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n$ service nginx restart\n\n\n\u30c9\u30e1\u30a4\u30f3\u306e\u8a2d\u5b9a\nConoHa \u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u306b\u3042\u308b DNS \u9006\u5f15\u304d\u8a2d\u5b9a\u3067 1 \u3064\u306f\u8a2d\u5b9a\u53ef\u80fd\u3002\n\u4ee5\u4e0b\u306f\u3001\u30de\u30eb\u30c1\u30c9\u30e1\u30a4\u30f3\u3001\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306e\u30b5\u30f3\u30d7\u30eb\u3002\n\u203b\u305f\u3060\u3057\u3001\u6b63\u3057\u3044\u8a2d\u5b9a\u65b9\u6cd5\u304b\u306f\u5fae\u5999\n\n\u8ffd\u52a0\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n$ cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/example.conf\n$ cp /etc/nginx/conf.d/default.backend.conf /etc/nginx/conf.d/example.backend.conf\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\nexample.conf \u3092\u958b\u304f\u3002\n$ vi /etc/nginx/conf.d/example.conf\n\n\u8a72\u5f53\u90e8\u5206\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3002\nlisten      80;\nserver_name example.com;\nroot        /var/www/vhosts/example/;\nindex       index.html index.htm index.php;\ncharset     utf-8;\n\naccess_log  /var/log/nginx/example.access.log main;\nerror_log   /var/log/nginx/example.error.log;\n\nexample.backend.conf \u3092\u958b\u304f\u3002\n$ vi /etc/nginx/conf.d/example.backend.conf\n\n\u8a72\u5f53\u90e8\u5206\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3002\nlisten      unix:/var/run/nginx-backend.sock;\nserver_name example.com;\nroot        /var/www/vhosts/example/;\nindex       index.html index.htm index.php;\n\naccess_log  /var/log/nginx/example.backend.access.log backend;\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n$ service nginx restart\n\n\u3053\u308c\u3067\u4e00\u5fdc\u306f\u5927\u4e08\u592b\u3060\u3068\u601d\u308f\u308c\u308b\u3002\n\nW3 Total Cache \u95a2\u9023\u306e\u8a2d\u5b9a\n\nJava \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ yum search jdk\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install java-1.7.0-openjdk-devel.x86_64\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ java -version\n# Path \u3092\u78ba\u8a8d\n$ which java\n\n\nYUI Compressor \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5834\u6240\u3078\u79fb\u52d5\n$ cd /usr/share/\n# \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ wget https://github.com/yui/yuicompressor/releases/download/v2.4.8/yuicompressor-2.4.8.jar\n# \u52d5\u4f5c\u78ba\u8a8d\n$ java -jar /usr/share/yuicompressor-2.4.8.jar\n\n\nNginx \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n$ vi /etc/nginx/wp-w3tc\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n# BEGIN W3TC Minify cache\nlocation ~ /wp-content/cache/minify.*\\.js$ {\n    types {}\n    default_type application/x-javascript;\n    add_header Vary \"Accept-Encoding\";\n}\nlocation ~ /wp-content/cache/minify.*\\.css$ {\n    types {}\n    default_type text/css;\n    add_header Vary \"Accept-Encoding\";\n}\nlocation ~ /wp-content/cache/minify.*js\\.gzip$ {\n    gzip off;\n    types {}\n    default_type application/x-javascript;\n    add_header Vary \"Accept-Encoding\";\n    add_header Content-Encoding gzip;\n}\nlocation ~ /wp-content/cache/minify.*css\\.gzip$ {\n    gzip off;\n    types {}\n    default_type text/css;\n    add_header Vary \"Accept-Encoding\";\n    add_header Content-Encoding gzip;\n}\n# END W3TC Minify cache\n# BEGIN W3TC Page Cache cache\nlocation ~ /wp-content/cache/page_enhanced.*html$ {\n    add_header Vary \"Accept-Encoding, Cookie\";\n}\nlocation ~ /wp-content/cache/page_enhanced.*gzip$ {\n    gzip off;\n    types {}\n    default_type text/html;\n    add_header Vary \"Accept-Encoding, Cookie\";\n    add_header Content-Encoding gzip;\n}\n# END W3TC Page Cache cache\n# BEGIN W3TC Browser Cache\ngzip on;\ngzip_types text/css text/x-component application/x-javascript application/javascript text/javascript text/x-js text/richtext image/svg+xml text/plain text/xsd text/xsl text/xml image/x-icon;\n# END W3TC Browser Cache\n# BEGIN W3TC Minify core\nrewrite ^/wp-content/cache/minify.*/w3tc_rewrite_test$ /wp-content/plugins/w3-total-cache/pub/minify.php?w3tc_rewrite_test=1 last;\nset $w3tc_enc \"\";\nif ($http_accept_encoding ~ gzip) {\n    set $w3tc_enc .gzip;\n}\nif (-f $request_filename$w3tc_enc) {\n    rewrite (.*) $1$w3tc_enc break;\n}\nrewrite ^/wp-content/cache/minify/(.+\\.(css|js))$ /wp-content/plugins/w3-total-cache/pub/minify.php?file=$1 last;\n# END W3TC Minify core\n# BEGIN W3TC Page Cache core\nset $w3tc_rewrite 1;\nif ($request_method = POST) {\n    set $w3tc_rewrite 0;\n}\nif ($query_string != \"\") {\n    set $w3tc_rewrite 0;\n}\nif ($http_cookie ~* \"(comment_author|wp\\-postpass|w3tc_logged_out|wordpress_logged_in|wptouch_switch_toggle)\") {\n    set $w3tc_rewrite 0;\n}\nset $w3tc_enc \"\";\nif ($http_accept_encoding ~ gzip) {\n    set $w3tc_enc _gzip;\n}\nset $w3tc_ext \"\";\nif (-f \"$document_root/wp-content/cache/page_enhanced/$http_host/$request_uri/_index.html$w3tc_enc\") {\n    set $w3tc_ext .html;\n}\nif (-f \"$document_root/wp-content/cache/page_enhanced/$http_host/$request_uri/_index.xml$w3tc_enc\") {\n    set $w3tc_ext .xml;\n}\nif ($w3tc_ext = \"\") {\n  set $w3tc_rewrite 0;\n}\nif ($w3tc_rewrite = 1) {\n    rewrite .* \"/wp-content/cache/page_enhanced/$http_host/$request_uri/_index$w3tc_ext$w3tc_enc\" last;\n}\n# END W3TC Page Cache core\n\n\n\u3053\u306e\u5185\u5bb9\u306f\u3001W3 Total Cache \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b nginx.conf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u81ea\u52d5\u3067\u4f5c\u3089\u308c\u308b\u3002\u305d\u306e\u4e2d\u8eab\u3092\u4e88\u3081\u4f5c\u6210\u3059\u308b\u4f5c\u696d\u306b\u306a\u308b\u3002\n\n\u53c2\u7167: (WordPress) W3 Total Cache + Nginx\n\n/etc/nginx/conf.d/default.conf \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3002\ninclude /etc/nginx/wp-w3tc;\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n$ service nginx restart\n\n\nWordPress \u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u8a2d\u5b9a\n\u524d\u7ae0\u3067 MondoRescue \u3092\u5c0e\u5165\u3057\u3066\u3044\u308b\u306e\u3067\u4e0d\u8981!\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u5099\u3048\u3042\u308c\u3070\u6182\u3044\u306a\u3057!\nWordPess \u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u5358\u4f53\u3067\u4f7f\u3046\u53ef\u80fd\u6027 ( \u30b5\u30fc\u30d0\u30fc\u306e\u5f15\u3063\u8d8a\u3057\u306a\u3069 ) \u3082\u8003\u616e\u3002\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u65b9\u6cd5\u305d\u306e 1 - BackWPup \u3092\u8a2d\u5b9a\n\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n * \u300cWordPress\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300d\u3068Dropbox\u3067\u304b\u3093\u305f\u3093\u30d6\u30ed\u30b0\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\uff01\n * WordPress\u3092\u6bce\u65e5\u81ea\u52d5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u65b9\u6cd5\u305d\u306e 2 - VaultPress \u3092\u8a2d\u5b9a\n\u3053\u3061\u3089\u306f BackWPup \u3068\u306f\u7570\u306a\u308a\u6709\u6599 ( 1\u30f6\u6708 500\u5186\u7a0b\u5ea6 ) \u3067\u3059\u3002\nVaultPress \u3092\u8a2d\u5b9a\u5f8c\u306f BackWPup \u3068\u540c\u3058\u304f\u81ea\u52d5\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u4f5c\u6210\u3002\n\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u30ea\u30b9\u30c8\u30a2\u3059\u308b\u6642\u306f VaultPress \u306e\u7ba1\u7406\u753b\u9762\u3067\u30dc\u30bf\u30f3\u3092\u30ef\u30f3\u30af\u30ea\u30c3\u30af\u3067\u7d42\u308f\u308a\u3002 ( \u3060\u3063\u305f\u306f\u305a\u2026\u8a18\u61b6\u304c\u66d6\u6627\u3067\u3059 )\n\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3002\n*\u30ef\u30f3\u30b3\u30a4\u30f3\u7a0b\u3067WordPress\u3092\u6bce\u65e5\u81ea\u52d5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3002VaultPress\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002\n\n\u7ba1\u7406\u753b\u9762\u306b Basic \u8a8d\u8a3c\u3092\u8a2d\u5b9a\n\u8a2d\u5b9a\u304c\u9762\u5012\u306a\u306e\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u304a\u9858\u3044\u3057\u3061\u3083\u3044\u307e\u3057\u3087\u3046 ( \u8981\u52d5\u4f5c\u30c6\u30b9\u30c8 )\u3002\n* WP BASIC Auth\n\n\u3053\u306e\u30e1\u30e2\u306f\u3001[ConoHa](http://www.conoha.jp/) \u306e Nginx + WordPress CentOS \u3068\u3044\u3046\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f7f\u7528\u3059\u308b\u6642\u306e\u30e1\u30e2\u3067\u3059\u3002\n\u307e\u305f\u3001\u5e38\u306b\u66f4\u65b0\u3068\u4fee\u6b63\u304c\u884c\u308f\u308c\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u306e DNS \u30ec\u30b3\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u89e6\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\u5404\u81ea\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\n## \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066 VPS \u3092\u8ffd\u52a0\nConoHa \u306b\u306f\u4e88\u3081 WordPress \u3092\u5feb\u9069\u306b\u5229\u7528\u3059\u308b\u70ba\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\n\u30a4\u30f3\u30d5\u30e9\u77e5\u8b58\u306a\u3044\u3057\u3001\u6298\u89d2\u306a\u306e\u3067\u3042\u308a\u304c\u305f\u304f\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304f\u3002\nVPS \u3092\u8ffd\u52a0\u3059\u308b\u969b ``[ \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8 ] Nginx + WordPress CentOS`` \u3092\u9078\u629e\u3057\u3066 VPS \u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n\n## \u5168\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u4f55\u3082\u8003\u3048\u305a\u306b\u53d6\u308a\u6562\u3048\u305a\u6700\u65b0\u306b\u3057\u3066\u307f\u308b\u3002\n\n```shell\n$ yum update\n```\n\n## \u30dd\u30fc\u30c8\u756a\u53f7\u306e\u8a2d\u5b9a\n### IPv4 \u306e\u8a2d\u5b9a\n\n```shel\n$ vi /etc/sysconfig/iptables\n$ ggVGd\n```\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n\n```shel\n*filter\n:INPUT   ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT  ACCEPT [0:0]\n:RH-Firewall-1-INPUT - [0:0]\n\n-A INPUT -j RH-Firewall-1-INPUT\n-A FORWARD -j RH-Firewall-1-INPUT\n-A RH-Firewall-1-INPUT -i lo -j ACCEPT\n-A RH-Firewall-1-INPUT -p icmp --icmp-type any -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 10022 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80    -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 443   -j ACCEPT\n\n-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp-host-prohibited\nCOMMIT\n````\n\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\n\n```shell\n$ service iptables restart\n```\n\n> \u3053\u306e\u7bc0\u306f[CentOS \u306b iptables \u306e\u8a2d\u5b9a\u3092\u884c\u3046 (IPv4)](http://www.websec-room.com/2014/01/12/1511)\u3088\u308a\u5f15\u7528\n\n### IPv6 \u306e\u8a2d\u5b9a\n\n```shel\n$ vi /etc/sysconfig/ip6tables\n$ ggVGd\n```\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n\n```shel\n# Firewall configuration written by system-config-firewall\n# Manual customization of this file is not recommended.\n*filter\n:INPUT ACCEPT [0:0]\n:FORWARD ACCEPT [0:0]\n:OUTPUT ACCEPT [0:0]\n:RH-Firewall-1-INPUT - [0:0]\n-A INPUT -j RH-Firewall-1-INPUT\n-A FORWARD -j RH-Firewall-1-INPUT\n-A RH-Firewall-1-INPUT -i lo -j ACCEPT\n-A RH-Firewall-1-INPUT -p icmpv6 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 10022 -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80    -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 443   -j ACCEPT\n-A RH-Firewall-1-INPUT -m state --state NEW -m udp -p udp --dport 546 --sport 547 -s fe80::/10 -d fe80::/10 -j ACCEPT\n-A RH-Firewall-1-INPUT -j REJECT --reject-with icmp6-adm-prohibited\n\n-A FORWARD -j REJECT --reject-with icmp6-adm-prohibited\nCOMMIT\n```\n\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\n\n```shell\n$ service ip6tables restart\n```\n\n> \u3053\u306e\u7bc0\u306f[CentOS \u306b ip6tables \u306e\u8a2d\u5b9a\u3092\u884c\u3046(IPv6)](http://www.websec-room.com/2014/01/13/1532)\u3088\u308a\u5f15\u7528\n\n### SSH\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\n\n```shell\n$ vi /etc/ssh/sshd_config\n```\n\n``#Port 22`` \u3068\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u7b87\u6240\u304c\u3042\u308b\u306e\u3067 ``Port 10022`` \u306b\u5909\u66f4\u3057\u3066\u4fdd\u5b58\u3002\n\u5909\u66f4\u3057\u305f\u8a2d\u5b9a\u3092\u9069\u7528\u3059\u308b\u3002\n\n```shell\nservice sshd restart\n```\n\n> \u3053\u306e\u7bc0\u306f[CentOS \u306e SSH \u30dd\u30fc\u30c8\u756a\u53f7\u3092\u5909\u66f4\u3059\u308b](http://www.websec-room.com/2014/01/16/1552)\u3088\u308a\u5f15\u7528\n\n\n## phpMyAdmin \u3092\u66f4\u65b0\n### \u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u304b\u78ba\u8a8d\n\n```shell\n$ yum list | grep phpMyAdmin\n```\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n```shell\nphpMyAdmin.noarch                       4.2.6-2.el6.remi            remi\n```\n\n\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u3063\u305f\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```shell\n$ yum --enablerepo=remi install phpmyadmin\n```\n\n### Nginx \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n#### phpMyAdmin \u3092\u52d5\u304b\u3059\u70ba\u306e\u30c9\u30e1\u30a4\u30f3\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\n```shell\n$ vi /etc/nginx/conf.d/phpmyadmin.conf\n```\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3057\u3001``server_name`` \u3092\u74b0\u5883\u306b\u3042\u308f\u305b\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\n\n```shell\nserver {\n    listen      80;\n    server_name phpmyadmin.example.com;\n    root        /var/www/vhosts/default;\n    index       index.html index.htm;\n    charset     utf-8;\n\n    include     /etc/nginx/drop;\n\n    # phpMyAdmin\n    location /phpMyAdmin {\n        alias                /usr/share/phpMyAdmin;\n        index                index.php;\n        include              /etc/nginx/expires;\n        auth_basic           \"Local Security\";\n        auth_basic_user_file \"/var/www/vhosts/default/.htpasswd\";\n    }\n    location ~ ^/phpMyAdmin/.+\\.php$ {\n        alias /usr/share/phpMyAdmin;\n        fastcgi_pass   phpfpm;\n        fastcgi_index  index.php;\n        fastcgi_param  SCRIPT_FILENAME /usr/share$fastcgi_script_name;\n        include        fastcgi_params;\n    }\n}\n```\n\n.htpasswd \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```shell\nhtpasswd -nbs YourName YourPassword > /var/www/vhosts/default/.htpasswd\n```\n\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n\n```shell\n$ service nginx restart\n```\n\n\u306a\u304a\u3001``/etc/nginx/conf.d/default.conf`` \u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001``/etc/nginx/conf.d/default.conf`` \u306e 53 \u884c\u76ee\u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3066\u3001Nginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3060\u3051\u3067\u5b8c\u4e86\u3067\u3059\u3002\nBasic \u8a8d\u8a3c\u3092\u639b\u3051\u308b\u5834\u5408\u306f\u3001``auth_basic`` \u3068 ``auth_basic_user_file`` \u306e\u90e8\u5206\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n## MySQL \u8a2d\u5b9a\n\n### MySQL \u306e root \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8a2d\u5b9a\n\n```shell\n$ mysqladmin -u root password '\u597d\u304d\u306a\u30d1\u30b9\u30ef\u30fc\u30c9'\n$ mysql -u root -p mysql\n$ DELETE FROM user WHERE user = '';\n$ DELETE FROM user WHERE host != 'localhost';\n```\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u3001\u534a\u89d2\u82f1\u6570\u5b57 + \u5927\u6587\u5b57\u82f1\u5b57 + \u5c0f\u6587\u5b57\u82f1\u5b57 + \u8a18\u53f7\u3067\u69cb\u6210\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n## Git \u306e\u524a\u9664\u3068\u6700\u65b0\u7248\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nGit \u306f\u65e2\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u304c 1.7 \u3067\u3042\u3063\u305f\u305f\u3081\u4e00\u65e6\u524a\u9664\u3057\u6700\u65b0\u7248\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n### Git \u306e\u524a\u9664\n\n```shell\n$ yum remove git\n```\n\n### \u6700\u65b0\u7248\u306e Git \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell\n$ yum install make curl-devel gcc openssl-devel expat-devel  cpan\n$ yum install gettext  asciidoc xmlto\n$ mkdir /root/temp/\n$ cd /root/temp/\n$ wget https://www.kernel.org/pub/software/scm/git/git-2.2.1.tar.gz\n$ yum install zlib-devel.x86_64\n$ tar -zxf git-2.2.1.tar.gz\n$ cd ./git-2.2.1\n$ make prefix=/usr all\n$ make prefix=/usr install\n$ rm -rf /root/temp/*\n```\n\n### Git \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u306a\u3044\n\u3044\u3056 Git \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u304a\u3046\u3068\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u4e8b\u304c\u3042\u308b\u3002\n\n```shell\n$ git --version\n-bash: /usr/bin/git: \u305d\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3084\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3042\u308a\u307e\u305b\u3093\n```\n\n\u3053\u306e\u5834\u5408\u3001Git \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5834\u6240\u3092\u63a2\u3057\u3066\u3001\u305d\u306e\u5834\u6240\u3092\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3067\u7e4b\u3052\u3066\u3042\u3052\u308b\u3068\u89e3\u6c7a\u3059\u308b\u3002\n\n```shell\n$ which git\n/usr/local/bin/git\n$ ln -s /usr/local/bin/git /usr/bin/git\n```\n\n## \u30ed\u30b0\u76e3\u8996\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n### Logwatch \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell\n$ yum install logwatch\n```\n\n### \u52d5\u4f5c\u78ba\u8a8d\n\n```shell\n$ /usr/sbin/logwatch --print\n```\n\n### \u8a2d\u5b9a\u3092\u5909\u66f4\n\n```shell\n$ vi /usr/share/logwatch/default.conf/logwatch.conf\n```\n[\u30ed\u30b0\u76e3\u8996\u30c4\u30fc\u30eb Logwatch \u3092\u4f7f\u3063\u3066\u307f\u308b](http://blog.thingslabo.com/archives/000054.html)\u3092\u53c2\u8003\u306b\u5fc5\u8981\u306a\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n> \u3053\u306e\u7ae0\u306f[VPS \u501f\u308a\u305f\u3089\u3001\u305b\u3081\u3066\u3053\u308c\u304f\u3089\u3044\u306f\u3084\u3063\u3068\u3051\u3068\u3044\u3046\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a2d\u5b9a](http://dogmap.jp/2011/05/12/vps-security/)\u3088\u308a\u5f15\u7528\n\n## OS \u5168\u4f53\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n### MondoRescue \u3092\u5c0e\u5165\n\n```shell\n$ wget ftp://ftp.mondorescue.org/rhel/6/x86_64/mondorescue.repo\n$ mv mondorescue.repo /etc/yum.repos.d/\n$ yum -y install mondo\n```\n\n### \u5727\u7e2e\u30bd\u30d5\u30c8 ( LZO ) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell\n$ vi /etc/yum.repos.d/dag.repo\n[dag]\nname=Dag RPM Repository for Red Hat Enterprise Linux\nbaseurl=http://ftp.riken.jp/Linux/dag/redhat/el$releasever/en/$basearch/dag\ngpgcheck=1\ngpgkey=http://dag.wieers.com/packages/RPM-GPG-KEY.dag.txt\nenabled=0\n```\n\n```shell\n$ yum -y install lzop lzo --enablerepo=dag\n```\n\n### \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306e\u5b9f\u884c\n\n```shell\n$ setenforce 0\n$ mkdir /tmp/backup/\n$ mondoarchive -Oi -L -N -s 4200m -d /tmp/backup -E /tmp/backup\n$ setenforce 1\n```\n\n> \u3053\u306e\u7ae0\u306f[\u3055\u304f\u3089VPS\u4e0a\u306eOS\u3092\u4e38\u3054\u3068\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3059\u308b](http://goo.gl/h4Rrq4)\u3088\u308a\u5f15\u7528\n\n## WordPress \u306b\u95a2\u3059\u308b\u8a2d\u5b9a\n### Nginx \u306e\u8a2d\u5b9a (\u4e0d\u8981\u3067\u3059)\n[@wokamoto](https://twitter.com/wokamoto) \u3055\u3093\u3088\u308a\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u3092\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\u4ee5\u4e0b\u306e **\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650** \u306f\u4e0d\u8981\u3067\u3059\u3002\n``/etc/nginx/conf.d/default.conf`` \u5185\u306b ``include /etc/nginx/drop;`` \u3068\u3044\u3046\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e ``include /etc/nginx/drop;`` \u306e\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\n```\nlocation ~ /\\. { deny all; access_log /dev/null; log_not_found off; }\n```\n\u203b\u4e00\u90e8\u629c\u7c8b\n\u3053\u306e\u8a18\u8ff0\u304c **\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650** \u3068\u88ab\u308b\u70ba\u4e0d\u8981\u3068\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u3001``wp-config.php`` \u3068 ``wp-blog-header.php`` \u306b\u30a2\u30af\u30bb\u30b9\u304c\u3042\u3063\u305f\u5834\u5408\u3001404 \u3092\u8fd4\u3059\u3088\u3046\u306a\u8a18\u8ff0\u3082\u3042\u308a\u307e\u3057\u305f\u3002\ninclude \u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u3082\u3057\u3063\u304b\u308a\u78ba\u8a8d\u3057\u306a\u3044\u3068\u3067\u3059\u306d!!\n\n\n\n#### \u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30a2\u30af\u30bb\u30b9\u5236\u9650 ( \u4e0d\u8981\u3067\u3059 )\n``/etc/nginx/conf.d/default.conf`` \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3002\n\n```\nlocation ~ (\\.ht|\\.git|\\.svn|\\.conf) {\n    deny  all;\n}\n```\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n\n```shell\n$ service nginx restart\n```\n\n### \u30c9\u30e1\u30a4\u30f3\u306e\u8a2d\u5b9a\nConoHa \u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30d1\u30cd\u30eb\u306b\u3042\u308b DNS \u9006\u5f15\u304d\u8a2d\u5b9a\u3067 1 \u3064\u306f\u8a2d\u5b9a\u53ef\u80fd\u3002\n\u4ee5\u4e0b\u306f\u3001\u30de\u30eb\u30c1\u30c9\u30e1\u30a4\u30f3\u3001\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u3059\u308b\u5834\u5408\u306e\u30b5\u30f3\u30d7\u30eb\u3002\n\u203b\u305f\u3060\u3057\u3001\u6b63\u3057\u3044\u8a2d\u5b9a\u65b9\u6cd5\u304b\u306f\u5fae\u5999\n\n#### \u8ffd\u52a0\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```shell\n$ cp /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/example.conf\n$ cp /etc/nginx/conf.d/default.backend.conf /etc/nginx/conf.d/example.backend.conf\n```\n\n#### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\nexample.conf \u3092\u958b\u304f\u3002\n\n```shell\n$ vi /etc/nginx/conf.d/example.conf\n```\n\n\u8a72\u5f53\u90e8\u5206\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3002\n\n```\nlisten      80;\nserver_name example.com;\nroot        /var/www/vhosts/example/;\nindex       index.html index.htm index.php;\ncharset     utf-8;\n\naccess_log  /var/log/nginx/example.access.log main;\nerror_log   /var/log/nginx/example.error.log;\n```\n\nexample.backend.conf \u3092\u958b\u304f\u3002\n\n```shell\n$ vi /etc/nginx/conf.d/example.backend.conf\n```\n\n\u8a72\u5f53\u90e8\u5206\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3002\n\n```\nlisten      unix:/var/run/nginx-backend.sock;\nserver_name example.com;\nroot        /var/www/vhosts/example/;\nindex       index.html index.htm index.php;\n\naccess_log  /var/log/nginx/example.backend.access.log backend;\n```\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n\n```shell\n$ service nginx restart\n```\n\n\u3053\u308c\u3067\u4e00\u5fdc\u306f\u5927\u4e08\u592b\u3060\u3068\u601d\u308f\u308c\u308b\u3002\n\n### W3 Total Cache \u95a2\u9023\u306e\u8a2d\u5b9a\n#### Java \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u306a\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ yum search jdk\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install java-1.7.0-openjdk-devel.x86_64\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\n$ java -version\n# Path \u3092\u78ba\u8a8d\n$ which java\n```\n\n#### YUI Compressor \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5834\u6240\u3078\u79fb\u52d5\n$ cd /usr/share/\n# \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n$ wget https://github.com/yui/yuicompressor/releases/download/v2.4.8/yuicompressor-2.4.8.jar\n# \u52d5\u4f5c\u78ba\u8a8d\n$ java -jar /usr/share/yuicompressor-2.4.8.jar\n```\n\n#### Nginx \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\u65b0\u898f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```shell\n$ vi /etc/nginx/wp-w3tc\n```\n\n\u4ee5\u4e0b\u3092\u30da\u30fc\u30b9\u30c8\u3002\n\n```\n# BEGIN W3TC Minify cache\nlocation ~ /wp-content/cache/minify.*\\.js$ {\n    types {}\n    default_type application/x-javascript;\n    add_header Vary \"Accept-Encoding\";\n}\nlocation ~ /wp-content/cache/minify.*\\.css$ {\n    types {}\n    default_type text/css;\n    add_header Vary \"Accept-Encoding\";\n}\nlocation ~ /wp-content/cache/minify.*js\\.gzip$ {\n    gzip off;\n    types {}\n    default_type application/x-javascript;\n    add_header Vary \"Accept-Encoding\";\n    add_header Content-Encoding gzip;\n}\nlocation ~ /wp-content/cache/minify.*css\\.gzip$ {\n    gzip off;\n    types {}\n    default_type text/css;\n    add_header Vary \"Accept-Encoding\";\n    add_header Content-Encoding gzip;\n}\n# END W3TC Minify cache\n# BEGIN W3TC Page Cache cache\nlocation ~ /wp-content/cache/page_enhanced.*html$ {\n    add_header Vary \"Accept-Encoding, Cookie\";\n}\nlocation ~ /wp-content/cache/page_enhanced.*gzip$ {\n    gzip off;\n    types {}\n    default_type text/html;\n    add_header Vary \"Accept-Encoding, Cookie\";\n    add_header Content-Encoding gzip;\n}\n# END W3TC Page Cache cache\n# BEGIN W3TC Browser Cache\ngzip on;\ngzip_types text/css text/x-component application/x-javascript application/javascript text/javascript text/x-js text/richtext image/svg+xml text/plain text/xsd text/xsl text/xml image/x-icon;\n# END W3TC Browser Cache\n# BEGIN W3TC Minify core\nrewrite ^/wp-content/cache/minify.*/w3tc_rewrite_test$ /wp-content/plugins/w3-total-cache/pub/minify.php?w3tc_rewrite_test=1 last;\nset $w3tc_enc \"\";\nif ($http_accept_encoding ~ gzip) {\n    set $w3tc_enc .gzip;\n}\nif (-f $request_filename$w3tc_enc) {\n    rewrite (.*) $1$w3tc_enc break;\n}\nrewrite ^/wp-content/cache/minify/(.+\\.(css|js))$ /wp-content/plugins/w3-total-cache/pub/minify.php?file=$1 last;\n# END W3TC Minify core\n# BEGIN W3TC Page Cache core\nset $w3tc_rewrite 1;\nif ($request_method = POST) {\n    set $w3tc_rewrite 0;\n}\nif ($query_string != \"\") {\n    set $w3tc_rewrite 0;\n}\nif ($http_cookie ~* \"(comment_author|wp\\-postpass|w3tc_logged_out|wordpress_logged_in|wptouch_switch_toggle)\") {\n    set $w3tc_rewrite 0;\n}\nset $w3tc_enc \"\";\nif ($http_accept_encoding ~ gzip) {\n    set $w3tc_enc _gzip;\n}\nset $w3tc_ext \"\";\nif (-f \"$document_root/wp-content/cache/page_enhanced/$http_host/$request_uri/_index.html$w3tc_enc\") {\n    set $w3tc_ext .html;\n}\nif (-f \"$document_root/wp-content/cache/page_enhanced/$http_host/$request_uri/_index.xml$w3tc_enc\") {\n    set $w3tc_ext .xml;\n}\nif ($w3tc_ext = \"\") {\n  set $w3tc_rewrite 0;\n}\nif ($w3tc_rewrite = 1) {\n    rewrite .* \"/wp-content/cache/page_enhanced/$http_host/$request_uri/_index$w3tc_ext$w3tc_enc\" last;\n}\n# END W3TC Page Cache core\n\n```\n\u3053\u306e\u5185\u5bb9\u306f\u3001W3 Total Cache \u3092\u5229\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b nginx.conf \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u304c\u81ea\u52d5\u3067\u4f5c\u3089\u308c\u308b\u3002\u305d\u306e\u4e2d\u8eab\u3092\u4e88\u3081\u4f5c\u6210\u3059\u308b\u4f5c\u696d\u306b\u306a\u308b\u3002\n> \u53c2\u7167: [(WordPress) W3 Total Cache + Nginx](http://smokycat.info/nginx/487)\n\n``/etc/nginx/conf.d/default.conf`` \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3002\n\n```\ninclude /etc/nginx/wp-w3tc;\n```\n\nNginx \u3092\u30ea\u30b9\u30bf\u30fc\u30c8\u3059\u308b\u3002\n\n```shell\n$ service nginx restart\n```\n\n### WordPress \u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u8a2d\u5b9a\n\u524d\u7ae0\u3067 MondoRescue \u3092\u5c0e\u5165\u3057\u3066\u3044\u308b\u306e\u3067\u4e0d\u8981!\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u5099\u3048\u3042\u308c\u3070\u6182\u3044\u306a\u3057!\nWordPess \u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30a1\u30a4\u30eb\u3092\u5358\u4f53\u3067\u4f7f\u3046\u53ef\u80fd\u6027 ( \u30b5\u30fc\u30d0\u30fc\u306e\u5f15\u3063\u8d8a\u3057\u306a\u3069 ) \u3082\u8003\u616e\u3002\n\n#### \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u65b9\u6cd5\u305d\u306e 1 - BackWPup \u3092\u8a2d\u5b9a\n\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n * [\u300cWordPress\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u300d\u3068Dropbox\u3067\u304b\u3093\u305f\u3093\u30d6\u30ed\u30b0\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\uff01](http://www.conoha.jp/blog/1450.html)\n * [WordPress\u3092\u6bce\u65e5\u81ea\u52d5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7](http://designinglabo.com/352/wordpress_backwpup_dropbox.html)\n#### \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u65b9\u6cd5\u305d\u306e 2 - VaultPress \u3092\u8a2d\u5b9a\n\u3053\u3061\u3089\u306f BackWPup \u3068\u306f\u7570\u306a\u308a\u6709\u6599 ( 1\u30f6\u6708 500\u5186\u7a0b\u5ea6 ) \u3067\u3059\u3002\nVaultPress \u3092\u8a2d\u5b9a\u5f8c\u306f BackWPup \u3068\u540c\u3058\u304f\u81ea\u52d5\u3067\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u4f5c\u6210\u3002\n**\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089\u30ea\u30b9\u30c8\u30a2\u3059\u308b\u6642\u306f VaultPress \u306e\u7ba1\u7406\u753b\u9762\u3067\u30dc\u30bf\u30f3\u3092\u30ef\u30f3\u30af\u30ea\u30c3\u30af\u3067\u7d42\u308f\u308a\u3002** ( \u3060\u3063\u305f\u306f\u305a\u2026\u8a18\u61b6\u304c\u66d6\u6627\u3067\u3059 )\n\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u8a2d\u5b9a\u3002\n*[\u30ef\u30f3\u30b3\u30a4\u30f3\u7a0b\u3067WordPress\u3092\u6bce\u65e5\u81ea\u52d5\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3002VaultPress\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u3002](http://designinglabo.com/322/wordpress_backup_vaultpress.html)\n\n### \u7ba1\u7406\u753b\u9762\u306b Basic \u8a8d\u8a3c\u3092\u8a2d\u5b9a\n\u8a2d\u5b9a\u304c\u9762\u5012\u306a\u306e\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u304a\u9858\u3044\u3057\u3061\u3083\u3044\u307e\u3057\u3087\u3046 ( \u8981\u52d5\u4f5c\u30c6\u30b9\u30c8 )\u3002\n* [WP BASIC Auth](http://wordpress.org/plugins/wp-basic-auth/)\n\n", "tags": ["WordPress", "nginx", "vps", "Conoha"]}