{"tags": ["RSpec", "Capybara", "poltergeist", "MySQL"], "context": " More than 1 year has passed since last update.\u5099\u5fd8\u9332\u3068\u3057\u3066\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n\u554f\u984c\n\u8868\u984c\u306e\u901a\u308a\u3001mysql2\u3001capybara\u3001poltergeist\u3092\u7d44\u307f\u5408\u308f\u305b\u305frapec\u306e\u30c6\u30b9\u30c8\u3067\u3001\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\nThis connection is in use by: #<Thread:0x007fd32136efd8 sleep>\n\n\n\u5bfe\u7b56\ngithub gist :josevalim / shared_connection.rb\u3067mrsimo\u3055\u3093\u304c\u793a\u3057\u305f\u5185\u5bb9\u3067\u3059\u3002\n\nspec/support/active_record.rb\nclass ActiveRecord::Base\n  mattr_accessor :shared_connections\n  self.shared_connections = {}\n\n  def self.connection\n    shared_connections[connection_config[:database]] ||= begin\n      retrieve_connection\n    end\n  end\nend\n\nmodule MutexLockedQuerying\n  @@semaphore = Mutex.new\n\n  def query(*)\n    @@semaphore.synchronize { super }\n  end\nend\n\nMysql2::Client.prepend(MutexLockedQuerying)\n\n\n\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001spec/support\u306b\u4e0a\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u30c6\u30b9\u30c8\u304c\u901a\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u4ee5\u4e0a\u3067\u3059\u3002\n\n\u53c2\u8003\nhttps://gist.github.com/josevalim/470808\n\u5099\u5fd8\u9332\u3068\u3057\u3066\u30e1\u30e2\u3057\u307e\u3059\u3002\n\n#\u554f\u984c\n\u8868\u984c\u306e\u901a\u308a\u3001mysql2\u3001capybara\u3001poltergeist\u3092\u7d44\u307f\u5408\u308f\u305b\u305frapec\u306e\u30c6\u30b9\u30c8\u3067\u3001\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n\n````\nThis connection is in use by: #<Thread:0x007fd32136efd8 sleep>\n````\n\n\n#\u5bfe\u7b56\n[github gist :josevalim / shared_connection.rb](https://gist.github.com/josevalim/470808)\u3067mrsimo\u3055\u3093\u304c\u793a\u3057\u305f\u5185\u5bb9\u3067\u3059\u3002\n\n````spec/support/active_record.rb\nclass ActiveRecord::Base\n  mattr_accessor :shared_connections\n  self.shared_connections = {}\n\n  def self.connection\n    shared_connections[connection_config[:database]] ||= begin\n      retrieve_connection\n    end\n  end\nend\n\nmodule MutexLockedQuerying\n  @@semaphore = Mutex.new\n\n  def query(*)\n    @@semaphore.synchronize { super }\n  end\nend\n\nMysql2::Client.prepend(MutexLockedQuerying)\n````\n\n\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001spec/support\u306b\u4e0a\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u30c6\u30b9\u30c8\u304c\u901a\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u4ee5\u4e0a\u3067\u3059\u3002\n\n# \u53c2\u8003\nhttps://gist.github.com/josevalim/470808\n"}