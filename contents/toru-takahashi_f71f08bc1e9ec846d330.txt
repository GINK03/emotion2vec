{"context": " More than 1 year has passed since last update.\u6628\u65e5\u3001\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u516c\u958b\u3057\u305f\u3089\u3001DataConnector\u7248\u3082\u3088\u308d\uff01\u3068\u8a00\u308f\u308c\u305f\u306e\u3067\u3001\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\nEmbulk\u3092\u4f7f\u3063\u3066S3\u4e0a\u306eELB\u306e\u30ed\u30b0\u3092TreasureData\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\n\nEmbulk\u3068DataConnector\u306e\u9055\u3044\nEmbulk\u306f\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30d0\u30c3\u30c1\u51e6\u7406\u7248\u306efluentd\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059\u306d\u3002\nDataConnector\u306f\u3001TreasureData\u304cEmbulk\u3092\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u3044\u3066\u3001\u306a\u304a\u304b\u3064\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u6a5f\u80fd\u3082\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001embulk-output-td\u306e\u5834\u5408\u306b\u306f\u3001\u5f93\u6765\u306e\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3044\u305fBulkimport\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001DataConnector\u3067\u306fTreasureData\u306b\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001embulk-output-td\u3088\u308a\u3082\u9ad8\u901f\u306b\u51e6\u7406\u3067\u304d\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u52a0\u3048\u3066\u3001TreasureData\u306eDataConnector\u306e\u30b5\u30fc\u30d0\u7528\u306eIP Range\u3082\u3042\u308b\u305f\u3081\u3001DataConnector\u3092\u672c\u756a\u904b\u7528\u3057\u3066\u307f\u305f\u3044\u65b9\u304c\u3044\u305f\u3089\u3001TreasureData\u307e\u3067\u76f8\u8ac7\u3059\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nPrerequisites\nELB\u306e\u30ed\u30b0\u306b\u3064\u3044\u3066\u306f\u3001\u524d\u56de\u306e\u8a18\u4e8b\u3092\u53c2\u7167\u3059\u308b\u3068\u826f\u3044\u3067\u3059\u304c\u3001\u518d\u5ea6\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\nELB\u306e\u30ed\u30b0\u306e\u4ed5\u69d8\u306f\u4e0b\u8a18\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nElastic Load Balancing \u30a2\u30af\u30bb\u30b9\u30ed\u30b0\n\u30ed\u30b0\u306e\u6709\u52b9\u5316\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u3061\u3089\n\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\u540d\n\u30d5\u30a3\u30fc\u30eb\u30c9\u5024\u306e\u4f8b\n\n\n\n\ntimestamp\n2014-02-15T23:39:43.945958Z\n\n\nelb\nmy-test-loadbalancer\n\n\nclient:port\n192.168.131.39:2817\n\n\nbackend:port\n10.0.0.1:80\n\n\nrequest_processing_time\n0.000073\n\n\nbackend_processing_time\n0.001048\n\n\nresponse_processing_time\n0.000057\n\n\nelb_status_code\n200\n\n\nbackend_status_code\n200\n\n\nreceived_bytes\n0\n\n\nsent_bytes\n29\n\n\n\"request\"\n\"GET http://www.example.com: 80/HTTP/1.1\"\n\n\n\n\u30d5\u30a1\u30a4\u30eb\u751f\u6210\u306e\u30eb\u30fc\u30eb\u306f\u3001\u4e0b\u8a18\u306e\u30d1\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\"{Bucket}/{Prefix}/AWSLogs/{AWS AccountID}/elasticloadbalancing/{Region}/{Year}/{Month}/{Day}/{AWS Account ID}elasticloadbalancing{Region}{Load Balancer Name}{End Time}{Load Balancer IP}{Random String}.log\"\n\nStep 0. Install td \u30b3\u30de\u30f3\u30c9\nDataConnector\u306ftd\u30b3\u30de\u30f3\u30c9\u306ev0.11.9\u304b\u3089\u306e\u5bfe\u5fdc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nmac\u306e\u5834\u5408\u306b\u306f\u3001\u3053\u3061\u3089\u304b\u3089toolbelt\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3067\u3001td\u30b3\u30de\u30f3\u30c9\u3082\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n$ td --version\n0.11.10\n\n\u3064\u3044\u3067\u306b\u3069\u3093\u306a\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u304b\u3082\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ td help connector\nAdditional commands, type \"td help COMMAND\" for more details:\n\n  connector:guess [config]                   # Run guess to generate connector config file\n  connector:preview <config>                 # Show preview of connector execution\n  connector:issue <config>                   # Run one time connector execution\n  connector:list                             # Show list of connector sessions\n  connector:create <name> <cron> <database> <table> <config>   # Create new connector session\n  connector:show <name>                      # Show connector session\n  connector:update <name> <config>           # Modify connector session\n  connector:delete <name>                    # Delete connector session\n  connector:history <name>                   # Show job history of connector session\n  connector:run <name> <time>                # Run connector session for the specified time\n\n\nStep 1. Create Seed Config File (seed.yml)\nDataConnector\u3067\u306f\u3001S3\u4e0a\u306eELB\u306e\u30ed\u30b0\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u3001AWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u306a\u3069\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fseed.yml\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\u307e\u305f\u3001S3\u304b\u3089\u306e\u53d6\u308a\u8fbc\u307f\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3057\u307e\u3059\u3002Step 1: Create Seed Config File (seed.yml)\n\u3059\u308b\u3068\u3001seed.yml\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001out\u5074\u306fTD\u306e\u307f\u306a\u306e\u3067\u3001mode\u3092append\u304bReplace\u3067\u9078\u629e\u3059\u308b\u3060\u3051\u3088\u3044\u306e\u3067\u697d\u3067\u3059\u3002\u307e\u305f\u3001\u305d\u308c\u4ee5\u5916\u306e\u8a2d\u5b9a\u306fEmbulk\u3068\u307b\u307c\u4e00\u7dd2\u3067\u3059\u306d\u3002\n\nseed.yml\nconfig:\n  in:\n    type: s3\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    bucket: sample_bucket\n    path_prefix: AWSLogs/9192993993/elasticloadbalancing/us-east-1/\n  out:\n    mode: replace\n\n\n\nStep 2. Guess Fields (Generate load.yml)\n\u305d\u308c\u3067\u306f\u3001\u4e0a\u8a18\u306eseed.yml\u3092\u5143\u306bGuess\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ td connector:guess seed.yml -o load.yml\nGuessed configuration:\n\n---\nconfig:\n  in:\n    type: s3\n    bucket: sample_bucket\n    path_prefix: AWSLogs/523683666290/elasticloadbalancing/us-east-1/\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    parser:\n      charset: UTF-8\n      newline: CRLF\n      type: csv\n      delimiter: ','\n      quote: ''\n      escape: ''\n      skip_header_lines: 1\n      allow_extra_columns: false\n      allow_optional_columns: false\n      columns:\n      - name: '2015-06-11T23:48:04.039816Z production-event-collector 71..200:59905\n          10.~06:5140 0.000028 0.012609 0.000026 200 200 776 16 \"POST https://treasuredata.com:443/js/v3/event/\n          HTTP/1.1\" \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML'\n        type: string\n      - name: ' like Gecko) Chrome/43.0.2357.81 Safari/537.36\" ECDHE-RSA-AES128-GCM-SHA256\n          TLSv1.2'\n        type: string\n  out:\n    mode: replace\n\nCreated load.yml file.\nUse 'td connector:preview load.yml' to see bulk load preview.\n\nGuess\u3092\u884c\u3046\u3068\u3001\u524d\u56de\u306e\u30d6\u30ed\u30b0\u3068\u540c\u69d8\u306b\u3001\u6b63\u3057\u3044\u30ab\u30e9\u30e0\u6570\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001ELB\u306e\u30ed\u30b0\u306f\u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u306a\u306e\u3067\u3059\u304c\u3001Guess\u306edelimiter\u5019\u88dc\u306b\u30b9\u30da\u30fc\u30b9\u304c\u306a\u3044\u305f\u3081\u306b\u8a72\u5f53\u306e\u73fe\u8c61\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001\u67d0\u53e4\u6a4b\u3055\u3093\u304c\u4e0b\u8a18\u306e\u5185\u5bb9\u3092\u8a00\u3063\u3066\u305f\u306e\u3067\u3001\u3053\u306e\u8a18\u4e8b\u3092\u8aad\u3093\u3067\u308b\u307f\u306a\u3055\u3093\u306f\u4e0a\u624b\u304f\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\n@nora96o \u3055\u3063\u304d\u8a00\u3063\u3066\u3044\u305f\u3001delimiter: \u2018 \u2018 \u3055\u3048\u66f8\u3044\u3066\u304a\u3051\u3070\u3001\u3042\u3068\u306fguess\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u5909\u66f4\u3001\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\u660e\u65e5\u304b\u6765\u9031\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u5165\u308c\u307e\u3059\u3002 ttps://github.com/embulk/embulk/pull/215\u2014 FURUHASHI Sadayuki (@frsyuki) 2015, 6\u6708 27\n\n\u7dba\u9e97\u306bGuess\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5fc5\u8981\u306a\u5f62\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u4fee\u6b63\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u306f\u3053\u3061\u3089\u3092\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002\n\n\u30ab\u30e9\u30e0\u540d\u304cTreasuredata\u3067\u306f\u3001\u82f1\u6570\u5b57\u5c0f\u6587\u5b57\u307e\u305f\u306f'_'\u306e\u307f\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u305d\u308c\u306b\u5408\u308f\u305b\u3066\u30ab\u30e9\u30e0\u540d\u3092\u5909\u66f4\ndelimiter\u3068trim_if_not_quoted\u3068skip_header_lines\u306e\u5909\u66f4\ncolumns\u306e\u30b9\u30ad\u30fc\u30de\u306e\u5909\u66f4\nallow_optional_columns\u3092true\u306b\u3057\u3001\u30ab\u30e9\u30e0\u304c\u8db3\u308a\u306a\u3044\u884c\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u4ee3\u308f\u308a\u306bnull\u3092\u30bb\u30c3\u30c8\n\n\u3053\u308c\u3089\u306e\u4fee\u6b63\u3092\u52a0\u3048\u3066\u3001\u6700\u7d42\u7684\u306bload.yml\u306f\u4e0b\u8a18\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\n\nload.yml\n---\nconfig:\n  in:\n    type: s3\n    bucket: event-collect-access\n    path_prefix: AWSLogs/523683666290/elasticloadbalancing/us-east-1/\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    parser:\n      charset: UTF-8\n      newline: CRLF\n      type: csv\n      delimiter: ' '\n      quote: ''\n      escape: ''\n      trim_if_not_quoted: false\n      skip_header_lines: 0\n      allow_extra_columns: true\n      allow_optional_columns: false\n      columns:\n        - name: timestamp\n          type: timestamp\n          format: '%Y-%m-%dT%H:%M:%S.%NZ'\n        - name: elb\n          type: string\n        - name: client_port\n          type: string\n        - name: backend_port\n          type: string\n        - name: request_processing_time\n          type: double\n        - name: backend_processing_time\n          type: double\n        - name: response_processing_time\n          type: double\n        - name: elb_status_code\n          type: string\n        - name: backend_status_code\n          type: string\n        - name: received_bytes\n          type: double\n        - name: sent_bytes\n          type: double\n        - name: request\n          type: string\n  out:\n    mode: replace\n\n\n\u6700\u5f8c\u306b\u3001Preview\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ td connector:preview load.yml\n\u301c\n\n\nStep 3, Execute Load Job\n\u524d\u8ff0\u3067\u4f5c\u6210\u3057\u305fload.yml\u30d5\u30a1\u30a4\u30eb\u3092\u5143\u306b\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u884c\u3046\u305f\u3081\u306b\u306fissue\u30b3\u30de\u30f3\u30c9\u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\u305d\u306e\u969b\u306b\u306f\u3001database, table, time column\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n$ td connector:issue load.yml --database support --table elb_log --time-column timestamp\nError: TreasureData::NotFoundError - BulkLoad job issuing failed: {\"error\":\"Resource not found\",\"text\":\"Resource not found\",\"severity\":\"error\"}\n\n\u3080\u3080\u3001\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3057\u305f\u3002DataConncetor\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u81ea\u52d5\u751f\u6210\u306f\u3057\u306a\u3044\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3001\u518d\u5ea6\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n$ td table:create support elb_log\nTable 'support.elb_log' is created.\n\n\u30b8\u30e7\u30d6\u304c\u767a\u884c\u3055\u308c\u307e\u3057\u305f\u3002wait\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068\u30b8\u30e7\u30d6\u304c\u5b8c\u4e86\u307e\u3067\u5f85\u6a5f\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u5229\u7528\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n$ td connector:issue load.yml --database support --table elb_log --time-column timestamp\nJob 27776006 is queued.\nUse 'td job:show 27776006' to show the status.\n\n\u767a\u884c\u3055\u308c\u305f\u30b8\u30e7\u30d6\u3092\u8ffd\u3046\u306b\u306f\u3001WebConsole\u307e\u305f\u306f\u4e0b\u8a18\u306eshow\u30b3\u30de\u30f3\u30c9\u3067\u95b2\u89a7\u3057\u307e\u3059\u3002\n$ td job:show 27776006 -v\nJobID       : 27776006\nStatus      : running\nType        : bulkload\nDatabase    : support\n\nOutput:\n  2015-06-27 13:14:15,620 [WARN]: transaction: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n  2015-06-27 13:14:15,950 [WARN]: transaction: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.\n  2015-06-27 13:14:17,723 [INFO]: transaction: Connecting to ResourceManager at /10.111.206.77:8032\n  2015-06-27 13:14:17,877 [WARN]: transaction: Hadoop command-line option parsing not performed. Implement the Tool interface and execute your application with ToolRunner to remedy this.\n  2015-06-27 13:14:22,097 [WARN]: transaction: No job jar file set.  User classes may not be found. See Job or Job#setJar(String).\n  2015-06-27 13:14:22,541 [INFO]: transaction: number of splits:15667\n  2015-06-27 13:14:22,681 [INFO]: transaction: Submitting tokens for job: job_1435268999144_0066\n  2015-06-27 13:14:22,792 [INFO]: transaction: Job jar is not present. Not adding any jar to the list of resources.\n  2015-06-27 13:14:23,447 [INFO]: transaction: Submitted application application_1435268999144_0066\n  2015-06-27 13:14:23,477 [INFO]: transaction: The url to track the job: http://ip-10-111-206-77.ec2.internal:8088/proxy/application_1435268999144_0066/\n  2015-06-27 13:14:23,481 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:28,490 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:33,601 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:38,629 [INFO]: transaction: map 0.0% reduce 0.0%\n\n\u307e\u305f\u3001\u30ed\u30b0\u3092\u773a\u3081\u3066\u3044\u308b\u3068TreasureData\u4e0a\u3067\u306f\u3001MapReduceExecutorPlugin\u306b\u3066\u3001\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u8fbc\u307f\u304c\u884c\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u5236\u9650\n\u73fe\u5728\u306eDataConnector\u306e\u5236\u7d04\u3092\u5e7e\u3064\u304b\u3042\u3052\u308b\u3068\u4e0b\u8a18\u304c\u3042\u308a\u307e\u3059\u3002\n\nWebConsole\u306ePreview\u306b\u3066\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044\u3002\nReplace\u5f8c\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u4ef6\u6570\u306f\u7d2f\u7a4d\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\u3068\u3044\u3063\u305f\u70b9\u304c\u3042\u308a\u307e\u3059\u3002\n\u6628\u65e5\u3001\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u516c\u958b\u3057\u305f\u3089\u3001DataConnector\u7248\u3082\u3088\u308d\uff01\u3068\u8a00\u308f\u308c\u305f\u306e\u3067\u3001\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n[Embulk\u3092\u4f7f\u3063\u3066S3\u4e0a\u306eELB\u306e\u30ed\u30b0\u3092TreasureData\u306b\u30a4\u30f3\u30dd\u30fc\u30c8](http://qiita.com/toru-takahashi/items/41e678fd2c60f2d68497)\n\n# Embulk\u3068DataConnector\u306e\u9055\u3044\nEmbulk\u306f\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u30d0\u30c3\u30c1\u51e6\u7406\u7248\u306efluentd\u307f\u305f\u3044\u306a\u3082\u306e\u3067\u3059\u306d\u3002\nDataConnector\u306f\u3001TreasureData\u304cEmbulk\u3092\u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u3057\u3066\u3044\u3066\u3001\u306a\u304a\u304b\u3064\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u6a5f\u80fd\u3082\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30a4\u30e1\u30fc\u30b8\u3067\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001embulk-output-td\u306e\u5834\u5408\u306b\u306f\u3001\u5f93\u6765\u306e\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u30c4\u30fc\u30eb\u3068\u3057\u3066\u3044\u305fBulkimport\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001DataConnector\u3067\u306fTreasureData\u306b\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001embulk-output-td\u3088\u308a\u3082\u9ad8\u901f\u306b\u51e6\u7406\u3067\u304d\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u52a0\u3048\u3066\u3001TreasureData\u306eDataConnector\u306e\u30b5\u30fc\u30d0\u7528\u306eIP Range\u3082\u3042\u308b\u305f\u3081\u3001DataConnector\u3092\u672c\u756a\u904b\u7528\u3057\u3066\u307f\u305f\u3044\u65b9\u304c\u3044\u305f\u3089\u3001TreasureData\u307e\u3067\u76f8\u8ac7\u3059\u308b\u3068\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# Prerequisites\n\nELB\u306e\u30ed\u30b0\u306b\u3064\u3044\u3066\u306f\u3001[\u524d\u56de\u306e\u8a18\u4e8b](http://qiita.com/toru-takahashi/items/41e678fd2c60f2d68497)\u3092\u53c2\u7167\u3059\u308b\u3068\u826f\u3044\u3067\u3059\u304c\u3001\u518d\u5ea6\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\nELB\u306e\u30ed\u30b0\u306e\u4ed5\u69d8\u306f\u4e0b\u8a18\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n[Elastic Load Balancing \u30a2\u30af\u30bb\u30b9\u30ed\u30b0](http://docs.aws.amazon.com/ja_jp/ElasticLoadBalancing/latest/DeveloperGuide/access-log-collection.html#access-log-entry-format)\n\n\u30ed\u30b0\u306e\u6709\u52b9\u5316\u306b\u3064\u3044\u3066\u306f\u3001[\u3053\u3061\u3089](http://docs.aws.amazon.com/ja_jp/ElasticLoadBalancing/latest/DeveloperGuide/enable-access-logs.html)\n\n| \u30d5\u30a3\u30fc\u30eb\u30c9\u540d | \u30d5\u30a3\u30fc\u30eb\u30c9\u5024\u306e\u4f8b |\n|------------|----------------|\n|timestamp|2014-02-15T23:39:43.945958Z|\n|elb|my-test-loadbalancer|\n|client:port|192.168.131.39:2817|\n|backend:port|10.0.0.1:80|\n|request_processing_time|0.000073|\n|backend_processing_time|0.001048|\n|response_processing_time|0.000057|\n|elb_status_code|200|\n|backend_status_code|200|\n|received_bytes|0|\n|sent_bytes|29|\n|\"request\"|\"GET http://www.example.com: 80/HTTP/1.1\"|\n\n\u30d5\u30a1\u30a4\u30eb\u751f\u6210\u306e\u30eb\u30fc\u30eb\u306f\u3001\u4e0b\u8a18\u306e\u30d1\u30b9\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\"{Bucket}/{Prefix}/AWSLogs/{AWS AccountID}/elasticloadbalancing/{Region}/{Year}/{Month}/{Day}/{AWS Account ID}_elasticloadbalancing_{Region}_{Load Balancer Name}_{End Time}_{Load Balancer IP}_{Random String}.log\"\n\n# Step 0. Install td \u30b3\u30de\u30f3\u30c9\n\nDataConnector\u306ftd\u30b3\u30de\u30f3\u30c9\u306ev0.11.9\u304b\u3089\u306e\u5bfe\u5fdc\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nmac\u306e\u5834\u5408\u306b\u306f\u3001[\u3053\u3061\u3089](http://toolbelt.treasuredata.com/)\u304b\u3089toolbelt\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u3067\u3001td\u30b3\u30de\u30f3\u30c9\u3082\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n$ td --version\n0.11.10\n```\n\n\u3064\u3044\u3067\u306b\u3069\u3093\u306a\u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u304c\u3042\u308b\u304b\u3082\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ td help connector\nAdditional commands, type \"td help COMMAND\" for more details:\n\n  connector:guess [config]                   # Run guess to generate connector config file\n  connector:preview <config>                 # Show preview of connector execution\n  connector:issue <config>                   # Run one time connector execution\n  connector:list                             # Show list of connector sessions\n  connector:create <name> <cron> <database> <table> <config>   # Create new connector session\n  connector:show <name>                      # Show connector session\n  connector:update <name> <config>           # Modify connector session\n  connector:delete <name>                    # Delete connector session\n  connector:history <name>                   # Show job history of connector session\n  connector:run <name> <time>                # Run connector session for the specified time\n```\n\n\n# Step 1. Create Seed Config File (seed.yml)\n\nDataConnector\u3067\u306f\u3001S3\u4e0a\u306eELB\u306e\u30ed\u30b0\u3092\u53c2\u7167\u3059\u308b\u305f\u3081\u306b\u3001AWS\u306e\u8a8d\u8a3c\u60c5\u5831\u3084\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u30d1\u30b9\u306a\u3069\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306fseed.yml\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\u307e\u305f\u3001S3\u304b\u3089\u306e\u53d6\u308a\u8fbc\u307f\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u53c2\u8003\u306b\u3057\u307e\u3059\u3002[Step 1: Create Seed Config File (seed.yml)](http://docs.treasure-data.com/articles/data-connector-amazon-s3#step-1-create-seed-config-file-seedyml)\n\n\u3059\u308b\u3068\u3001seed.yml\u306f\u4e0b\u8a18\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001out\u5074\u306fTD\u306e\u307f\u306a\u306e\u3067\u3001mode\u3092append\u304bReplace\u3067\u9078\u629e\u3059\u308b\u3060\u3051\u3088\u3044\u306e\u3067\u697d\u3067\u3059\u3002\u307e\u305f\u3001\u305d\u308c\u4ee5\u5916\u306e\u8a2d\u5b9a\u306fEmbulk\u3068\u307b\u307c\u4e00\u7dd2\u3067\u3059\u306d\u3002\n\n```seed.yml\nconfig:\n  in:\n    type: s3\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    bucket: sample_bucket\n    path_prefix: AWSLogs/9192993993/elasticloadbalancing/us-east-1/\n  out:\n    mode: replace\n```\n\n# Step 2. Guess Fields (Generate load.yml)\n\n\u305d\u308c\u3067\u306f\u3001\u4e0a\u8a18\u306eseed.yml\u3092\u5143\u306bGuess\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ td connector:guess seed.yml -o load.yml\nGuessed configuration:\n\n---\nconfig:\n  in:\n    type: s3\n    bucket: sample_bucket\n    path_prefix: AWSLogs/523683666290/elasticloadbalancing/us-east-1/\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    parser:\n      charset: UTF-8\n      newline: CRLF\n      type: csv\n      delimiter: ','\n      quote: ''\n      escape: ''\n      skip_header_lines: 1\n      allow_extra_columns: false\n      allow_optional_columns: false\n      columns:\n      - name: '2015-06-11T23:48:04.039816Z production-event-collector 71..200:59905\n          10.~06:5140 0.000028 0.012609 0.000026 200 200 776 16 \"POST https://treasuredata.com:443/js/v3/event/\n          HTTP/1.1\" \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML'\n        type: string\n      - name: ' like Gecko) Chrome/43.0.2357.81 Safari/537.36\" ECDHE-RSA-AES128-GCM-SHA256\n          TLSv1.2'\n        type: string\n  out:\n    mode: replace\n\nCreated load.yml file.\nUse 'td connector:preview load.yml' to see bulk load preview.\n```\n\nGuess\u3092\u884c\u3046\u3068\u3001\u524d\u56de\u306e\u30d6\u30ed\u30b0\u3068\u540c\u69d8\u306b\u3001\u6b63\u3057\u3044\u30ab\u30e9\u30e0\u6570\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u751f\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3053\u308c\u306f\u3001ELB\u306e\u30ed\u30b0\u306f\u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u306a\u306e\u3067\u3059\u304c\u3001Guess\u306edelimiter\u5019\u88dc\u306b\u30b9\u30da\u30fc\u30b9\u304c\u306a\u3044\u305f\u3081\u306b\u8a72\u5f53\u306e\u73fe\u8c61\u304c\u767a\u751f\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001\u67d0\u53e4\u6a4b\u3055\u3093\u304c\u4e0b\u8a18\u306e\u5185\u5bb9\u3092\u8a00\u3063\u3066\u305f\u306e\u3067\u3001\u3053\u306e\u8a18\u4e8b\u3092\u8aad\u3093\u3067\u308b\u307f\u306a\u3055\u3093\u306f\u4e0a\u624b\u304f\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n<blockquote class=\"twitter-tweet\" lang=\"ja\"><p lang=\"ja\" dir=\"ltr\"><a href=\"https://twitter.com/nora96o\">@nora96o</a> \u3055\u3063\u304d\u8a00\u3063\u3066\u3044\u305f\u3001delimiter: \u2018 \u2018 \u3055\u3048\u66f8\u3044\u3066\u304a\u3051\u3070\u3001\u3042\u3068\u306fguess\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u5909\u66f4\u3001\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002\u660e\u65e5\u304b\u6765\u9031\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u5165\u308c\u307e\u3059\u3002 ttps://github.com/embulk/embulk/pull/215</p>&mdash; FURUHASHI Sadayuki (@frsyuki) <a href=\"https://twitter.com/frsyuki/status/614672722509979648\">2015, 6\u6708 27</a></blockquote>\n<script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n\u7dba\u9e97\u306bGuess\u304c\u3067\u304d\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5fc5\u8981\u306a\u5f62\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u4fee\u6b63\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/toru-takahashi/items/41e678fd2c60f2d68497#embulk-input-s3%E3%81%AE%E8%A8%AD%E5%AE%9A)\u3092\u30c1\u30a7\u30c3\u30af\u3067\u3059\u3002\n\n- \u30ab\u30e9\u30e0\u540d\u304cTreasuredata\u3067\u306f\u3001\u82f1\u6570\u5b57\u5c0f\u6587\u5b57\u307e\u305f\u306f'_'\u306e\u307f\u3068\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001\u305d\u308c\u306b\u5408\u308f\u305b\u3066\u30ab\u30e9\u30e0\u540d\u3092\u5909\u66f4\n- delimiter\u3068trim_if_not_quoted\u3068skip_header_lines\u306e\u5909\u66f4\n- columns\u306e\u30b9\u30ad\u30fc\u30de\u306e\u5909\u66f4\n- allow_optional_columns\u3092true\u306b\u3057\u3001\u30ab\u30e9\u30e0\u304c\u8db3\u308a\u306a\u3044\u884c\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u4ee3\u308f\u308a\u306bnull\u3092\u30bb\u30c3\u30c8\n\n\u3053\u308c\u3089\u306e\u4fee\u6b63\u3092\u52a0\u3048\u3066\u3001\u6700\u7d42\u7684\u306bload.yml\u306f\u4e0b\u8a18\u306e\u8a2d\u5b9a\u306b\u306a\u308a\u307e\u3059\u3002\n\n```load.yml\n---\nconfig:\n  in:\n    type: s3\n    bucket: event-collect-access\n    path_prefix: AWSLogs/523683666290/elasticloadbalancing/us-east-1/\n    access_key_id: XXXXXXXXXX\n    secret_access_key: YYYYYYYYYY\n    parser:\n      charset: UTF-8\n      newline: CRLF\n      type: csv\n      delimiter: ' '\n      quote: ''\n      escape: ''\n      trim_if_not_quoted: false\n      skip_header_lines: 0\n      allow_extra_columns: true\n      allow_optional_columns: false\n      columns:\n        - name: timestamp\n          type: timestamp\n          format: '%Y-%m-%dT%H:%M:%S.%NZ'\n        - name: elb\n          type: string\n        - name: client_port\n          type: string\n        - name: backend_port\n          type: string\n        - name: request_processing_time\n          type: double\n        - name: backend_processing_time\n          type: double\n        - name: response_processing_time\n          type: double\n        - name: elb_status_code\n          type: string\n        - name: backend_status_code\n          type: string\n        - name: received_bytes\n          type: double\n        - name: sent_bytes\n          type: double\n        - name: request\n          type: string\n  out:\n    mode: replace\n```\n\n\u6700\u5f8c\u306b\u3001Preview\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ td connector:preview load.yml\n\u301c\n```\n\n# Step 3, Execute Load Job\n\n\u524d\u8ff0\u3067\u4f5c\u6210\u3057\u305fload.yml\u30d5\u30a1\u30a4\u30eb\u3092\u5143\u306b\u30c7\u30fc\u30bf\u30a4\u30f3\u30dd\u30fc\u30c8\u3092\u884c\u3046\u305f\u3081\u306b\u306fissue\u30b3\u30de\u30f3\u30c9\u3092\u767a\u884c\u3057\u307e\u3059\u3002\n\n\u305d\u306e\u969b\u306b\u306f\u3001database, table, time column\u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n$ td connector:issue load.yml --database support --table elb_log --time-column timestamp\nError: TreasureData::NotFoundError - BulkLoad job issuing failed: {\"error\":\"Resource not found\",\"text\":\"Resource not found\",\"severity\":\"error\"}\n```\n\n\u3080\u3080\u3001\u30a8\u30e9\u30fc\u304c\u3067\u307e\u3057\u305f\u3002DataConncetor\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30c6\u30fc\u30d6\u30eb\u306e\u81ea\u52d5\u751f\u6210\u306f\u3057\u306a\u3044\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3066\u3001\u518d\u5ea6\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n```\n$ td table:create support elb_log\nTable 'support.elb_log' is created.\n```\n\n\u30b8\u30e7\u30d6\u304c\u767a\u884c\u3055\u308c\u307e\u3057\u305f\u3002wait\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3068\u30b8\u30e7\u30d6\u304c\u5b8c\u4e86\u307e\u3067\u5f85\u6a5f\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u5229\u7528\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\n```\n$ td connector:issue load.yml --database support --table elb_log --time-column timestamp\nJob 27776006 is queued.\nUse 'td job:show 27776006' to show the status.\n```\n\n\u767a\u884c\u3055\u308c\u305f\u30b8\u30e7\u30d6\u3092\u8ffd\u3046\u306b\u306f\u3001WebConsole\u307e\u305f\u306f\u4e0b\u8a18\u306eshow\u30b3\u30de\u30f3\u30c9\u3067\u95b2\u89a7\u3057\u307e\u3059\u3002\n\n```\n$ td job:show 27776006 -v\nJobID       : 27776006\nStatus      : running\nType        : bulkload\nDatabase    : support\n\nOutput:\n  2015-06-27 13:14:15,620 [WARN]: transaction: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\n  2015-06-27 13:14:15,950 [WARN]: transaction: The short-circuit local reads feature cannot be used because libhadoop cannot be loaded.\n  2015-06-27 13:14:17,723 [INFO]: transaction: Connecting to ResourceManager at /10.111.206.77:8032\n  2015-06-27 13:14:17,877 [WARN]: transaction: Hadoop command-line option parsing not performed. Implement the Tool interface and execute your application with ToolRunner to remedy this.\n  2015-06-27 13:14:22,097 [WARN]: transaction: No job jar file set.  User classes may not be found. See Job or Job#setJar(String).\n  2015-06-27 13:14:22,541 [INFO]: transaction: number of splits:15667\n  2015-06-27 13:14:22,681 [INFO]: transaction: Submitting tokens for job: job_1435268999144_0066\n  2015-06-27 13:14:22,792 [INFO]: transaction: Job jar is not present. Not adding any jar to the list of resources.\n  2015-06-27 13:14:23,447 [INFO]: transaction: Submitted application application_1435268999144_0066\n  2015-06-27 13:14:23,477 [INFO]: transaction: The url to track the job: http://ip-10-111-206-77.ec2.internal:8088/proxy/application_1435268999144_0066/\n  2015-06-27 13:14:23,481 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:28,490 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:33,601 [INFO]: transaction: map 0.0% reduce 0.0%\n  2015-06-27 13:14:38,629 [INFO]: transaction: map 0.0% reduce 0.0%\n```\n\n\u307e\u305f\u3001\u30ed\u30b0\u3092\u773a\u3081\u3066\u3044\u308b\u3068TreasureData\u4e0a\u3067\u306f\u3001MapReduceExecutorPlugin\u306b\u3066\u3001\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u8fbc\u307f\u304c\u884c\u308f\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n# \u5236\u9650\n\n\u73fe\u5728\u306eDataConnector\u306e\u5236\u7d04\u3092\u5e7e\u3064\u304b\u3042\u3052\u308b\u3068\u4e0b\u8a18\u304c\u3042\u308a\u307e\u3059\u3002\n\n- WebConsole\u306ePreview\u306b\u3066\u30c7\u30fc\u30bf\u304c\u898b\u3048\u306a\u3044\u3002\n- Replace\u5f8c\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u4ef6\u6570\u306f\u7d2f\u7a4d\u30ec\u30b3\u30fc\u30c9\u6570\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\u3068\u3044\u3063\u305f\u70b9\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\n\n", "tags": ["TreasureData"]}