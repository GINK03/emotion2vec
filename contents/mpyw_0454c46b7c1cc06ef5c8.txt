{"context": "\u7d39\u4ecb\u7528\u30b5\u30f3\u30d7\u30eb\u306a\u306e\u3067\u7d30\u304b\u3044\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n<?php\n\n/* HTML\u7279\u6b8a\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u95a2\u6570 */\nfunction h($str) {\n    return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');\n}\n\n# $_GET['q'] \u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b (\u672a\u5b9a\u7fa9\u306e\u5834\u5408\u306f\u7a7a\u6587\u5b57\u5217\u306b\u306a\u308b)\n$q = (string)filter_input(INPUT_GET, 'q');\n\n# $_GET['q'] \u304c\u7a7a\u6587\u5b57\u5217\u3067\u306a\u304b\u3063\u305f\u5834\u5408\u306b\u306e\u307f\u691c\u7d22\u3092\u884c\u3046\nif ($q !== '') {\n\n    // \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u53d6\u5f97\n    $ch = curl_init();\n    curl_setopt_array($ch, [\n        CURLOPT_URL => 'http://www.amazon.co.jp/s/field-keywords=' . urlencode($q),\n        CURLOPT_RETURNTRANSFER => true,\n        CURLOPT_FOLLOWLOCATION => true,\n        CURLOPT_AUTOREFERER => true,\n        CURLOPT_USERAGENT => 'Mozilla/5.0',\n        CURLOPT_ENCODING => 'gzip',\n    ]);\n    $html = curl_exec($ch);\n\n    // \u30a8\u30e9\u30fc\u3092\u51fa\u3055\u305a\u306bDOMDocument\u306b\u8aad\u307f\u8fbc\u3080\n    $dom = new DOMDocument;\n    @$dom->loadHTML($html);\n\n    // DOMDocument\u304b\u3089XPath\u5f0f\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306eDOMXPath\u3092\u751f\u6210\n    $xpath = new DOMXPath($dom);\n\n    // class\u5c5e\u6027\u5024\u306bs-result-item\u3092\u542b\u3080li\u8981\u7d20\u3092\u5168\u30ce\u30fc\u30c9\u304b\u3089\u691c\u7d22\u3059\u308b\n    foreach ($xpath->query('//li[contains(@class, \"s-result-item\")]') as $li) {\n        // class\u5c5e\u6027\u5024\u306b\u6240\u5b9a\u306e\u5024\u3092\u542b\u3080\u6240\u5b9a\u306e\u8981\u7d20\u3092\u5404li\u8981\u7d20\u306e\u4e2d\u304b\u3089\u691c\u7d22\u3059\u308b\n        // \u5404\u60c5\u5831\u3092\u307e\u3068\u3081\u3066\u914d\u5217\u306b\u3057\u3001\u66f4\u306b\u305d\u306e\u914d\u5217\u3092$items\u914d\u5217\u306e\u8981\u7d20\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\n        $items[] = [\n            'title' => $xpath->evaluate('string(.//h2[contains(@class, \"s-access-title\")])', $li),\n            'image' => $xpath->evaluate('string(.//img[contains(@class, \"s-access-image\")]/@src)', $li),\n            'price' => $xpath->evaluate('string(.//span[contains(@class, \"s-price\")])', $li),\n            'url'   => $xpath->evaluate('string(.//a[contains(@class, \"s-access-detail-page\")]/@href)', $li),\n        ];\n    }\n\n}\n\n# \u6587\u5b57\u30b3\u30fc\u30c9UTF-8\u306eHTML\u6587\u66f8\u3067\u3042\u308b\u3068\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u77e5\u3089\u305b\u308b\nheader('Content-Type: text/html; charset=utf-8');\n\n?>\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Amazon Scraping Sample</title>\n        <style>\n            article {\n                padding: 10px 5px;\n            }\n            article:after {\n                content: \"\";\n                clear: both;\n                height: 0;\n                display: block;\n                visibility: hidden;\n            }\n            article + article {\n                border-top: 1px solid #CCC;\n            }\n            img {\n                float: left;\n            }\n            .price {\n                color: orange;\n            }\n        </style>\n    </head>\n    <body>\n        <section>\n            <h1>\u691c\u7d22\u30d5\u30a9\u30fc\u30e0</h1>\n            <form method=\"get\" action=\"\">\n                <input type=\"text\" name=\"q\" value=\"<?=h($q)?>\">\n                <input type=\"submit\" value=\"\u691c\u7d22\">\n            </form>\n        </section>\n<?php if (!empty($items)): ?>\n        <section>\n            <h1>\u691c\u7d22\u7d50\u679c</h1>\n<?php foreach ($items as $item): ?>\n            <article>\n                <a href=\"<?=h($item['url'])?>\" target=\"_blank\"><img src=\"<?=h($item['image'])?>\"></a><br>\n                <a href=\"<?=h($item['url'])?>\" target=\"_blank\"><?=h($item['title'])?></a><br>\n                <span class=\"price\"><?=h($item['price'])?></span><br>\n            </article>\n<?php endforeach; ?>\n        </section>\n<?php endif; ?>\n    </body>\n</html>\n\n\n\u5b9f\u884c\u7d50\u679c\u4f8b\n\n\n\u95a2\u9023\u8a18\u4e8b\n\n$_GET, $_POST\u306a\u3069\u3092\u53d7\u3051\u53d6\u308b\u969b\u306e\u51e6\u7406\nPHP\u30cd\u30a4\u30c6\u30a3\u30d6\u306eDOM\u306b\u3088\u308b\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u5165\u9580\n\n\u7d39\u4ecb\u7528\u30b5\u30f3\u30d7\u30eb\u306a\u306e\u3067\u7d30\u304b\u3044\u8aac\u660e\u306f\u7701\u304d\u307e\u3059\n\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9 \n\n```html+php\n<?php\n\n/* HTML\u7279\u6b8a\u6587\u5b57\u3092\u30a8\u30b9\u30b1\u30fc\u30d7\u3059\u308b\u95a2\u6570 */\nfunction h($str) {\n    return htmlspecialchars($str, ENT_QUOTES, 'UTF-8');\n}\n\n# $_GET['q'] \u3092\u6587\u5b57\u5217\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b (\u672a\u5b9a\u7fa9\u306e\u5834\u5408\u306f\u7a7a\u6587\u5b57\u5217\u306b\u306a\u308b)\n$q = (string)filter_input(INPUT_GET, 'q');\n\n# $_GET['q'] \u304c\u7a7a\u6587\u5b57\u5217\u3067\u306a\u304b\u3063\u305f\u5834\u5408\u306b\u306e\u307f\u691c\u7d22\u3092\u884c\u3046\nif ($q !== '') {\n\n    // \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u53d6\u5f97\n    $ch = curl_init();\n    curl_setopt_array($ch, [\n        CURLOPT_URL => 'http://www.amazon.co.jp/s/field-keywords=' . urlencode($q),\n        CURLOPT_RETURNTRANSFER => true,\n        CURLOPT_FOLLOWLOCATION => true,\n        CURLOPT_AUTOREFERER => true,\n        CURLOPT_USERAGENT => 'Mozilla/5.0',\n        CURLOPT_ENCODING => 'gzip',\n    ]);\n    $html = curl_exec($ch);\n    \n    // \u30a8\u30e9\u30fc\u3092\u51fa\u3055\u305a\u306bDOMDocument\u306b\u8aad\u307f\u8fbc\u3080\n    $dom = new DOMDocument;\n    @$dom->loadHTML($html);\n    \n    // DOMDocument\u304b\u3089XPath\u5f0f\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306eDOMXPath\u3092\u751f\u6210\n    $xpath = new DOMXPath($dom);\n\n    // class\u5c5e\u6027\u5024\u306bs-result-item\u3092\u542b\u3080li\u8981\u7d20\u3092\u5168\u30ce\u30fc\u30c9\u304b\u3089\u691c\u7d22\u3059\u308b\n    foreach ($xpath->query('//li[contains(@class, \"s-result-item\")]') as $li) {\n        // class\u5c5e\u6027\u5024\u306b\u6240\u5b9a\u306e\u5024\u3092\u542b\u3080\u6240\u5b9a\u306e\u8981\u7d20\u3092\u5404li\u8981\u7d20\u306e\u4e2d\u304b\u3089\u691c\u7d22\u3059\u308b\n        // \u5404\u60c5\u5831\u3092\u307e\u3068\u3081\u3066\u914d\u5217\u306b\u3057\u3001\u66f4\u306b\u305d\u306e\u914d\u5217\u3092$items\u914d\u5217\u306e\u8981\u7d20\u3068\u3057\u3066\u4ee3\u5165\u3059\u308b\n        $items[] = [\n            'title' => $xpath->evaluate('string(.//h2[contains(@class, \"s-access-title\")])', $li),\n            'image' => $xpath->evaluate('string(.//img[contains(@class, \"s-access-image\")]/@src)', $li),\n            'price' => $xpath->evaluate('string(.//span[contains(@class, \"s-price\")])', $li),\n            'url'   => $xpath->evaluate('string(.//a[contains(@class, \"s-access-detail-page\")]/@href)', $li),\n        ];\n    }\n\n}\n\n# \u6587\u5b57\u30b3\u30fc\u30c9UTF-8\u306eHTML\u6587\u66f8\u3067\u3042\u308b\u3068\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u306b\u77e5\u3089\u305b\u308b\nheader('Content-Type: text/html; charset=utf-8');\n\n?>\n<!DOCTYPE html>\n<html>\n    <head>\n        <title>Amazon Scraping Sample</title>\n        <style>\n            article {\n                padding: 10px 5px;\n            }\n            article:after {\n                content: \"\";\n                clear: both;\n                height: 0;\n                display: block;\n                visibility: hidden;\n            }\n            article + article {\n                border-top: 1px solid #CCC;\n            }\n            img {\n                float: left;\n            }\n            .price {\n                color: orange;\n            }\n        </style>\n    </head>\n    <body>\n        <section>\n            <h1>\u691c\u7d22\u30d5\u30a9\u30fc\u30e0</h1>\n            <form method=\"get\" action=\"\">\n                <input type=\"text\" name=\"q\" value=\"<?=h($q)?>\">\n                <input type=\"submit\" value=\"\u691c\u7d22\">\n            </form>\n        </section>\n<?php if (!empty($items)): ?>\n        <section>\n            <h1>\u691c\u7d22\u7d50\u679c</h1>\n<?php foreach ($items as $item): ?>\n            <article>\n                <a href=\"<?=h($item['url'])?>\" target=\"_blank\"><img src=\"<?=h($item['image'])?>\"></a><br>\n                <a href=\"<?=h($item['url'])?>\" target=\"_blank\"><?=h($item['title'])?></a><br>\n                <span class=\"price\"><?=h($item['price'])?></span><br>\n            </article>\n<?php endforeach; ?>\n        </section>\n<?php endif; ?>\n    </body>\n</html>\n```\n\n# \u5b9f\u884c\u7d50\u679c\u4f8b\n\n![\u3042\uff3e\u301c\u5fc3\u304c\u3074\u3087\u3093\u3074\u3087\u3093\u3059\u308b\u3093\u3058\u3083\uff3e\u301c](https://qiita-image-store.s3.amazonaws.com/0/25060/db625909-2050-6eee-17dd-db408dd2390c.png)\n\n# \u95a2\u9023\u8a18\u4e8b\n\n- [$_GET, $_POST\u306a\u3069\u3092\u53d7\u3051\u53d6\u308b\u969b\u306e\u51e6\u7406](http://qiita.com/mpyw/items/2f9955db1c02eeef43ea)\n- [PHP\u30cd\u30a4\u30c6\u30a3\u30d6\u306eDOM\u306b\u3088\u308b\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u5165\u9580](http://qiita.com/mpyw/items/c0312271819baee09132)\n", "tags": ["PHP", "\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0", "dom"]}