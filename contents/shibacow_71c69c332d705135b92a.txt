{"context": " More than 1 year has passed since last update.\n\nEC2\u5b89\u304f\u306a\u308b\n\u6c17\u304c\u3064\u3044\u305f\u3089\u3001EC2\u304c\u3060\u3044\u3076\u5024\u4e0b\u3052\u3057\u3066\u3044\u3066\u3001\u6211\u304c\u5bb6\u306e \u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u5206\u6790\u74b0\u5883\u306eHive\u5229\u7528\u6599\u3082\u5b89\u304f\u306a\u3063\u3066\u3044\u305f\u3002\n\u53c2\u8003\n\n\u3010AWS\u767a\u8868\u301142\u56de\u76ee\u306e\u5024\u4e0b\u3052\uff01EC2\u3001S3\u3001RDS\u3001ElastiCache\u3001\u305d\u3057\u3066Elastic MapReduce\u3082\uff01\nhttp://aws.typepad.com/aws_japan/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html\n\n\u5024\u6bb5\u306e\u554f\u984c\u3082\u3042\u308a\u3001\u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5206\u6790\u74b0\u5883\u306f\u3001hadoop\u306e\u30d0\u30fc\u30b8\u30e7\u30f31\u7cfb\u3067m1.medium\u30923\u53f0\u5229\u7528\u3057\u3066\u3001\u5206\u6790\u3092\u884c\u3063\u3066\u3044\u305f\u3002\u3057\u304b\u3057\u3001Elastic Map Reduce\u304chadoop2\u7cfb\u304b\u3089impala\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u3053\u3068\u3082\u3042\u308a\u3001hadoop\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u3066\u3001impala\u3067\u5206\u6790\u51fa\u6765\u306a\u3044\u304b\u691c\u8a3c\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\nimpala\u3068\u306f\n\ncludiera\u306e\u4f5c\u3063\u3066\u3044\u308bhive\u306e\u4f55\u500d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u65e9\u3044\u5206\u6790\u74b0\u5883\u3002hive\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u305d\u306e\u307e\u307e\u6d41\u7528\u3067\u304d\u308b\u3002\nhttp://www.cloudera.co.jp/products-services/cdh/cloudera-impala.html\n\n\n\u5b9f\u9a13\u306e\u307e\u3068\u3081\n\u5148\u306b\u5b9f\u9a13\u306e\u307e\u3068\u3081\u3092\u66f8\u304f\u3002\u8208\u5473\u306e\u3042\u308b\u4eba\u306f\u4e0b\u3092\u8aad\u3093\u3067\u306d\u3002\nEC2\u306e\u5024\u4e0b\u3052\u306b\u3088\u308a\u3001ElasticMapreduce\u3082\u5024\u4e0b\u3052\u3057\u3066\u304a\u308a\u3001\u307e\u305f\u3001hadoop\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3001hive\u4ee5\u5916\u306e\u9078\u629e\u80a2\u3082\u51fa\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u3068\u3057\u3066impala\u3092\u4f7f\u3048\u306a\u3044\u304b\u3068\u8a55\u4fa1\u3092\u884c\u3063\u305f\u3002\u6982\u306d\u30015\u500d\u304b\u308920\u500d\u7a0b\u5ea6\u9ad8\u901f\u5316\u3057\u305f\u3002impala\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u7684\u306a\u30af\u30a8\u30ea\u30fc\u306f\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u3067\u306f\u306a\u3044\u3068\u601d\u3063\u305f\u304c\u3001\u304d\u3061\u3093\u3068\u65e9\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u8a55\u4fa1\u3092\u3059\u308b\u524d\u306b\u3001m3.xlarge\u3067\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u3092\u884c\u3063\u305f\u304c\u305d\u306e\u5834\u5408\u306f60\u79d2\u7a0b\u5ea6\u3067\u7d50\u679c\u304c\u5e30\u3063\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u306b\u7c21\u5358\u306a\u30af\u30a8\u30ea\u30fc\u306fimpala\u3092\u4f7f\u3046\u306e\u306f\u3042\u308a\u3060\u3068\u611f\u3058\u305f\u3002\n\u30cb\u30b3\u30cb\u30b3\u52d5\u753b\u306e\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u305f\u3001\u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u3053\u3061\u3089\u306b\u3042\u308b\u3002\nhttp://www.nii.ac.jp/cscenter/idr/nico/nico.html\n\u52d5\u753b\u60c5\u5831\u3068\u3001\u30b3\u30e1\u30f3\u30c8\u60c5\u5831\u3001\u30cb\u30b3\u30cb\u30b3\u5927\u767e\u79d1\u306e\u60c5\u5831\u3092\u5229\u7528\u3067\u304d\u308b\u3002\n\nHive Impala\u5206\u6790\u74b0\u5883\u306e\u6e96\u5099\nElastic mapreduce(EMR)\u74b0\u5883\u3067\u3001impala\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001\u8a2d\u5b9a\u306f\u7c21\u5358\u3060\u3002EMR\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u308b\u969b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6700\u3082\u65b0\u3057\u3044hadoop\u3092\u9078\u3093\u3067\u3001impala\u3092\u8ffd\u52a0\u3059\u308c\u3070\u826f\u3044\u3002\n\nruby\u88fd\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3042\u308belastic-mapreduce-ruby-cli\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u6700\u65b0\u7248\u3092\u843d\u3068\u3057\u3066\u304d\u3066\u3001credentials.json\u3092\u81ea\u5206\u306e\u74b0\u5883\u306b\u66f8\u304d\u63db\u3048\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u6642\u306b\u3001--hive-interactive\u3092\u629c\u3044\u3066\u3001--impala-interactive\u3092\u4ed8\u3051\u8db3\u305b\u3070\u826f\u3044\u3002\n\u30b7\u30a7\u30eb\u3092\u6652\u3059\u3068\u3053\u306e\u3088\u3046\u306a\u8d77\u52d5\u30b7\u30a7\u30eb\u3092\u66f8\u3044\u305f\n\ncreate_emr.sh\n\n#!/bin/bash\n~/elastic-mapreduce-ruby-cli/elastic-mapreduce --create --alive --impala-interactive --name \"niconico_impala_test\" \\\n--instance-group master --instance-type m1.medium --instance-count 1 --bid-price 0.3 \\\n--instance-group core --instance-type m1.large --instance-count 3 --bid-price 0.3 \\\n--ami-version 3.0.4\n\n\n\u30c7\u30fc\u30bf\u306e\u6295\u5165\u306f\u3001\u4e00\u65e6\u624b\u5143\u306e\u74b0\u5883\u306b\u30c7\u30fc\u30bf\u3092\u6301\u3063\u3066\u304d\u3066\u304b\u3089\u884c\u3046\u3002s3\u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066impala\u304c\u65e9\u304f\u306a\u308b\u304b\u4e0d\u5b89\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u624b\u5143\u306b\u6301\u3063\u3066\u304d\u305f\u3002\n\u30c7\u30fc\u30bf\u3092s3\u304b\u3089\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u69d8\u306a\u30b3\u30de\u30f3\u30c9\u3092\u66f8\u3044\u305f\n\ncopy_hadoop.sh\n#!/bin/bash\nhadoop fs -mkdir -p /mnt/nico-data/\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo_sampling10 /mnt/nico-data/videoinfo_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo_sampling100 /mnt/nico-data/videoinfo_sampling100\nhadoop fs -cp s3n://nicovideo-info-data/comment_data_sampling10 /mnt/nico-data/comment_data_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/comment_data_sampling100 /mnt/nico-data/comment_data_sampling100\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo-rcfile /mnt/nico-data/videoinfo-rcfile\nhadoop fs -cp s3n://nicovideo-info-data/comment-data-rcfile /mnt/nico-data/comment-data-rcfile\nhadoop fs -cp s3n://nicovideo-info-data/tags /mnt/nico-data/tags\nhadoop fs -cp s3n://nicovideo-info-data/tags_sampling10 /mnt/nico-data/tags_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/tags_sampling100 /mnt/nico-data/tags_sampling100\n\n\n\u6614\u306ehadoop\u3068\u9055\u3063\u3066\u3044\u305f\u70b9\u306f\u3001mkdir \u306b-p\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u306a\u3044\u3068\u3001\u8907\u6570\u6bb5\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u304f\u308c\u306a\u3044\u3002cp\u306e\u969b\u306b\u3001\u5f8c\u308d\u306b/\u304c\u3042\u308b\u3068\u304d\u3061\u3093\u3068\u30b3\u30d4\u30fc\u3055\u308c\u306a\u3044\u306e2\u70b9\u3060\u3063\u305f\u3002\n\u3053\u306e\u3088\u3046\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u3042\u3068\u3001\n\ninsert.sql\n\nset hive.exec.compress.intermediate=true;\nset hive.exec.compress.output=true;\nset mapred.map.output.compression.codec=org.apache.hadoop.io.compress.SnappyCodec;\nset mapred.output.compression.type=RECORD;\ncreate database nicodata;\nuse nicodata;\n\nCREATE TABLE videoinfo(\nsmid STRING,\nthread_id STRING,\ntitle STRING,\ndescription STRING,\nthumbnail_url STRING,\nupload_time STRING,\nlength INT,\nmovie_type STRING,\nsize_high INT,\nsize_low INT,\nview_counter INT,\ncomment_counter INT,\nmylist_counter INT,\nlast_res_body STRING)\nSTORED AS RCFILE;\n\nCREATE TABLE `comment_data`(\nsmid STRING,\n`date` INT,\nvpos INT,\nno INT,\ncommand STRING,\n`comment_string` STRING)\nSTORED AS RCFILE;\n\nCREATE TABLE `tags`(\nsmid STRING,\nlocked TINYINT,\ncategory TINYINT,\ntag STRING\n)\nSTORED AS RCFILE;\n\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo-rcfile\" INTO TABLE videoinfo;\nLOAD DATA INPATH \"/mnt/nico-data/comment-data-rcfile\" INTO TABLE comment_data;\nLOAD DATA INPATH \"/mnt/nico-data/tags/\" INTO TABLE tags;\n\nCREATE TABLE videoinfo_sampling10 LIKE videoinfo;\nCREATE TABLE videoinfo_sampling100 LIKE videoinfo;\n\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo_sampling10\" INTO TABLE videoinfo_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo_sampling100\" INTO TABLE videoinfo_sampling100;\n\nCREATE TABLE comment_data_sampling10 LIKE `comment_data`;\nCREATE TABLE comment_data_sampling100 LIKE `comment_data`;\n\nLOAD DATA INPATH \"/mnt/nico-data/comment_data_sampling10\" INTO TABLE comment_data_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/comment_data_sampling100\" INTO TABLE comment_data_sampling100;\n\nCREATE TABLE tags_sampling10 LIKE tags;\nCREATE TABLE tags_sampling100 LIKE tags;\n\nLOAD DATA INPATH \"/mnt/nico-data/tags_sampling10\" INTO TABLE tags_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/tags_sampling100\" INTO TABLE tags_sampling100;\n\n\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304c\u5165\u308b\u3002\n\n\n\n\u30c6\u30fc\u30d6\u30eb\n\u4ef6\u6570\n\n\n\n\n\u52d5\u753b\u60c5\u5831\n800\u4e07\n\n\n\u30bf\u30b0\u60c5\u5831\n4000\u4e07\n\n\n\u30b3\u30e1\u30f3\u30c8\u60c5\u5831\n24\u5104\n\n\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3067\u81ea\u52d5\u751f\u6210\u3057\u305f\u308f\u3051\u3067\u306f\u306a\u3044\u3001\u751f\u306e\u30c7\u30fc\u30bf\u304c\u5927\u91cf\u306b\u624b\u306b\u5165\u308b\u306e\u306f\u691c\u8a3c\u306b\u4fbf\u5229\u3060\u3002\n\nimpala\u5b9f\u884c\n\u3053\u3053\u307e\u3067\u3084\u3063\u3066\u3001\u3084\u3063\u3068\u30c6\u30fc\u30d6\u30eb\u306e\u8a2d\u5b9a\u304c\u51fa\u6765\u305f\u3002\u3042\u3068\u306f\u3001\u51fa\u6765\u4e0a\u304c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\nimpala-shell -r \n\n-r\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3044\u308b\u306e\u306f\u3001\u63a5\u7d9a\u5f8cimplara\u306e\u30e1\u30bf\u30c6\u30fc\u30d6\u30eb\u3092refresh\u3059\u308b\u305f\u3081\u306b\u3060(\u305d\u3046\u3057\u306a\u3044\u3068hive\u3067\u884c\u3063\u305f\u5909\u66f4\u304c\u53cd\u6620\u3055\u308c\u306a\u3044)\u3002\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select tag,count(*) as cnt from tags group by tag order by cnt desc limit 10;\n\nQuery: select tag,count(*) as cnt from tags group by tag order by cnt desc limit 10\n+----------------------+---------+\n|\u3000\u30bf\u30b0\u540d                  | \u4ef6\u6570    |\n+----------------------+---------+\n| \u30b2\u30fc\u30e0               | 3593302 |\n| \u5b9f\u6cc1\u30d7\u30ec\u30a4\u52d5\u753b       | 1134356 |\n| \u97f3\u697d                 | 874535  |\n| \u6b4c\u3063\u3066\u307f\u305f           | 549536  |\n| \u6295\u7a3f\u8005\u30b3\u30e1\u30f3\u30c8       | 444108  |\n| \u30a2\u30cb\u30e1               | 332877  |\n| \u30a8\u30f3\u30bf\u30fc\u30c6\u30a4\u30e1\u30f3\u30c8   | 320617  |\n| \u6771\u65b9                 | 231043  |\n| \u3082\u3063\u3068\u8a55\u4fa1\u3055\u308c\u308b\u3079\u304d | 224274  |\n| VOCALOID             | 218548  |\n+----------------------+---------+\nReturned 10 row(s) in 17.98s\n\n4\u5343\u4e07\u306e\u30c7\u30fc\u30bf\u306e\u96c6\u7d04\u304c17\u79d2\u3002\u3060\u3044\u3076\u65e9\u3044\u3002\u3061\u306a\u307f\u306bhive\u3067\u884c\u3046\u30686\u5206\u304b\u304b\u3063\u305f\u3002\n\u7d50\u69cb\u65e9\u3044\u3002\u5927\u4f5321\u500d\u7a0b\u5ea6\n\nimpala\u306e\u5236\u7d04\nimpala-shell>\u3067\u3001\u65e5\u672c\u8a9e\u3092\u542b\u3080SQL\u306e\u5b9f\u884c\u304c\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\u30a8\u30e9\u30fc\u304c\u8d77\u3053\u3063\u305f\u3002\u65e5\u672c\u8a9e\u3092\u542b\u3080sql\u3082\u5b9f\u884c\u3067\u304d\u308b\u3068\u601d\u3046\u3051\u3069\u3001\u3084\u308a\u65b9\u306f\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\nimpala\u3068hive\u306e\u901f\u5ea6\u6bd4\u8f03\nimpala\u3082hive\u3082\u540c\u3058HDFS\u3092\u8aad\u3081\u308b\u3057\u3001\u540c\u3058\u30de\u30b7\u30f3\u3067\u5b9f\u884c\u3067\u304d\u308b\u306e\u3067\u3001\u901f\u5ea6\u306e\u6bd4\u8f03\u3092\u884c\u3063\u305f\u3002\u4f7f\u7528\u3057\u305f\u30de\u30b7\u30f3\u306f\u3001m1.large 4\u53f0\u3060\u3002m3.xlarge\u3067\u3082\u8a66\u3057\u305f\u304c\u3001\u7d50\u679c\u3092\u53d6\u308a\u5fd8\u308c\u305f\u3002\nm1.large\u306f\u30e1\u30e2\u30ea\u304c8GB\u3042\u308b\u3002\u30a4\u30f3\u30d1\u30e9\u306f\u30e1\u30e2\u30ea\u30fc\u304c\u591a\u3044\u307b\u3069\u30b9\u30b3\u30a2\u304c\u4e0a\u304c\u308b\u306e\u3067\u3001\u672c\u5f53\u306f\u3082\u3063\u3068\u3042\u3063\u305f\u307b\u3046\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\nwwww\u3092\u6700\u3082\u591a\u304f\u542b\u3093\u3067\u3044\u308b\u52d5\u753b\u306f\u306a\u306b\uff1f\n\u3088\u304f\u3084\u308b\u691c\u7d22\u3002www\u3092\u542b\u3080\u30b3\u30e1\u30f3\u30c8\u3092\u629c\u304d\u51fa\u3057\u3001\u305d\u306e\u30b3\u30e1\u30f3\u30c8\u304c\u6700\u3082\u591a\u3044\u52d5\u753b\u3092\u63a2\u3059\u3002\u691c\u7d22\u7684\u306b\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u306a\u306e\u3067\u3001\u30ab\u30e9\u30e0\u6307\u5411DB\u3067\u3082\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u3068\u4e88\u6e2c\u3057\u305f\u3002\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306f24\u5104\u4ef6\u3060\u3002\n\nimpala\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a;\nQuery: select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a\n+----------+\n| count(*) |\n+----------+\n| 2133268  |\n+----------+\nReturned 1 row(s) in 283.81s\n\n\n\nhive\nhive>  select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a;\n\nMapReduce Jobs Launched:\nJob 0: Map: 117  Reduce: 37   Cumulative CPU: 4496.83 sec   HDFS Read: 20356796592 HDFS Write: 4292 SUCCESS\nJob 1: Map: 3  Reduce: 1   Cumulative CPU: 8.26 sec   HDFS Read: 13681 HDFS Write: 8 SUCCESS\nTotal MapReduce CPU Time Spent: 0 days 1 hours 15 minutes 5 seconds 90 msec\nOK\n2133268\nTime taken: 1372.008 seconds, Fetched: 1 row(s)\n\n\n\n\n\n\u30bf\u30a4\u30d7\n\u79d2\u6570\n\n\n\n\nimpala\n283\u79d2\n\n\nhive\n1372\u79d2\n\n\n\n\u5927\u4f534\u500d\u4f4d\u9ad8\u901f\u300224\u5104\u4ef6\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u500b\u4eba\u304c\u624b\u304c\u51fa\u308b\u304a\u5024\u6bb5\u30675\u5206\u7a0b\u5ea6\u3067\u89e3\u6790\u3067\u304d\u308b\u306e\u306f\u3059\u3055\u307e\u3058\u3044\u3002\n\n\u6700\u3082\u9577\u3044\u52d5\u753b\u3092\u63a2\u305b\n800\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u304b\u3089\u3001\u6700\u3082\u52d5\u753b\u9577\u306e\u9577\u3044\u52d5\u753b\u3092\u63a2\u3059\u3002\n\nimpala\nQuery: select max(length) from videoinfo\n+-------------+\n| max(length) |\n+-------------+\n| 65535       |\n+-------------+\nReturned 1 row(s) in 3.57s\n\n\nhive\nhive> select max(length) from videoinfo;\nJob 0: Map: 7  Reduce: 1   Cumulative CPU: 53.31 sec   HDFS Read: 56293172 HDFS Write: 6 SUCCESS\nTotal MapReduce CPU Time Spent: 53 seconds 310 msec\nOK\n65535\nTime taken: 71.146 seconds, Fetched: 1 row(s)\n\n\n\n\n\u30bf\u30a4\u30d7\n\u79d2\u6570\n\n\n\n\nimpala\n3.5\u79d2\n\n\nhive\n71\u79d2\n\n\n\n3.5\u79d2 vs 71\u79d2\u306a\u306e\u3067\u5927\u4f5320\u500d\u4f4d\u9055\u3046\u3002\n\u79c1\u9054\u304c\u89e3\u6790\u3059\u308b\u30c7\u30fc\u30bf\u306f\u610f\u5916\u3068\u5c11\u306a\u3044\u30c7\u30fc\u30bf\u3082\u591a\u3044\u306e\u3067\u3001\u5c11\u306a\u3044\u30c7\u30fc\u30bf\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u77ed\u3044impala\u306f\u3042\u308a\u304c\u305f\u3044\u3002\n\n\u5358\u7d14\u306b\u30b3\u30e1\u30f3\u30c8\u6570\u3092\u6e2c\u308b\n\u5358\u7d14\u306b\u3001\u30b3\u30e1\u30f3\u30c8\u4ef6\u6570\u3092\u6e2c\u3063\u305f\u3002\u8907\u96d1\u3067\u306f\u306a\u3044\u306e\u3067\u3042\u307e\u308a\u6027\u80fd\u306e\u6307\u6a19\u306b\u306f\u306a\u3089\u306a\u3044\u3002\n\nimpala\n\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select count(*) from nicodata.comment_data;\nQuery: select count(*) from nicodata.comment_data\n+------------+\n| count(*)   |\n+------------+\n| 2474388510 |\n+------------+\nReturned 1 row(s) in 133.86s\n\n\n\nhive\nhive> select count(*) from comment_data;\nMapReduce Jobs Launched:\nOK\n2474388510\nTime taken: 872.161 seconds, Fetched: 1 row(s)\n\n\n\n\n\n\u30bf\u30a4\u30d7\n\u79d2\u6570\n\n\n\n\nimpala\n133\u79d2\n\n\nhive\n872\u79d2\n\n\n\n133\u79d2 vs 872\u79d2 \u30676.5\u500d\u9ad8\u901f\n\n\u307e\u3068\u3081\nEC2\u306e\u5024\u4e0b\u3052\u306b\u3088\u308a\u3001ElasticMapreduce\u3082\u5024\u4e0b\u3052\u3057\u3066\u304a\u308a\u3001\u307e\u305f\u3001hadoop\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3001hive\u4ee5\u5916\u306e\u9078\u629e\u80a2\u3082\u51fa\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u3068\u3057\u3066impala\u3092\u4f7f\u3048\u306a\u3044\u304b\u3068\u8a55\u4fa1\u3092\u884c\u3063\u305f\u3002\u6982\u306d\u30015\u500d\u304b\u308920\u500d\u7a0b\u5ea6\u9ad8\u901f\u5316\u3057\u305f\u3002impala\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u7684\u306a\u30af\u30a8\u30ea\u30fc\u306f\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u3067\u306f\u306a\u3044\u3068\u601d\u3063\u305f\u304c\u3001\u304d\u3061\u3093\u3068\u65e9\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u8a55\u4fa1\u3092\u3059\u308b\u524d\u306b\u3001m3.xlarge\u3067\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u3092\u884c\u3063\u305f\u304c\u305d\u306e\u5834\u5408\u306f60\u79d2\u7a0b\u5ea6\u3067\u7d50\u679c\u304c\u5e30\u3063\u3066\u304d\u305f\u3002\n\u3084\u306f\u308a10\u79d2\u7acb\u305f\u305a\u306b\u7d50\u679c\u304c\u5e30\u3063\u3066\u304f\u308b\u306e\u306f\u3001\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u306e\u7dad\u6301\u306b\u3064\u306a\u304c\u308b\u3068\u601d\u3063\u305f\u3002\n# EC2\u5b89\u304f\u306a\u308b\n\n\u6c17\u304c\u3064\u3044\u305f\u3089\u3001EC2\u304c\u3060\u3044\u3076\u5024\u4e0b\u3052\u3057\u3066\u3044\u3066\u3001\u6211\u304c\u5bb6\u306e [\u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u5206\u6790\u74b0\u5883](http://nicodata.info/)\u306eHive\u5229\u7528\u6599\u3082\u5b89\u304f\u306a\u3063\u3066\u3044\u305f\u3002\n\n\u53c2\u8003\n>\u3010AWS\u767a\u8868\u301142\u56de\u76ee\u306e\u5024\u4e0b\u3052\uff01EC2\u3001S3\u3001RDS\u3001ElastiCache\u3001\u305d\u3057\u3066Elastic MapReduce\u3082\uff01\n> http://aws.typepad.com/aws_japan/2014/03/aws-price-reduction-42-ec2-s3-rds-elasticache-and-elastic-mapreduce.html\n\n\u5024\u6bb5\u306e\u554f\u984c\u3082\u3042\u308a\u3001\u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5206\u6790\u74b0\u5883\u306f\u3001hadoop\u306e\u30d0\u30fc\u30b8\u30e7\u30f31\u7cfb\u3067m1.medium\u30923\u53f0\u5229\u7528\u3057\u3066\u3001\u5206\u6790\u3092\u884c\u3063\u3066\u3044\u305f\u3002\u3057\u304b\u3057\u3001Elastic Map Reduce\u304chadoop2\u7cfb\u304b\u3089impala\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u305f\u3053\u3068\u3082\u3042\u308a\u3001hadoop\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u4e0a\u3052\u3066\u3001impala\u3067\u5206\u6790\u51fa\u6765\u306a\u3044\u304b\u691c\u8a3c\u3059\u308b\u3053\u3068\u306b\u3057\u305f\u3002\n\nimpala\u3068\u306f\n> cludiera\u306e\u4f5c\u3063\u3066\u3044\u308bhive\u306e\u4f55\u500d\u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u65e9\u3044\u5206\u6790\u74b0\u5883\u3002hive\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u305d\u306e\u307e\u307e\u6d41\u7528\u3067\u304d\u308b\u3002\n> http://www.cloudera.co.jp/products-services/cdh/cloudera-impala.html\n\n# \u5b9f\u9a13\u306e\u307e\u3068\u3081\n\n\u5148\u306b\u5b9f\u9a13\u306e\u307e\u3068\u3081\u3092\u66f8\u304f\u3002\u8208\u5473\u306e\u3042\u308b\u4eba\u306f\u4e0b\u3092\u8aad\u3093\u3067\u306d\u3002\n\nEC2\u306e\u5024\u4e0b\u3052\u306b\u3088\u308a\u3001ElasticMapreduce\u3082\u5024\u4e0b\u3052\u3057\u3066\u304a\u308a\u3001\u307e\u305f\u3001hadoop\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3001hive\u4ee5\u5916\u306e\u9078\u629e\u80a2\u3082\u51fa\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u3068\u3057\u3066impala\u3092\u4f7f\u3048\u306a\u3044\u304b\u3068\u8a55\u4fa1\u3092\u884c\u3063\u305f\u3002\u6982\u306d\u30015\u500d\u304b\u308920\u500d\u7a0b\u5ea6\u9ad8\u901f\u5316\u3057\u305f\u3002impala\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u7684\u306a\u30af\u30a8\u30ea\u30fc\u306f\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u3067\u306f\u306a\u3044\u3068\u601d\u3063\u305f\u304c\u3001\u304d\u3061\u3093\u3068\u65e9\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u8a55\u4fa1\u3092\u3059\u308b\u524d\u306b\u3001m3.xlarge\u3067\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u3092\u884c\u3063\u305f\u304c\u305d\u306e\u5834\u5408\u306f60\u79d2\u7a0b\u5ea6\u3067\u7d50\u679c\u304c\u5e30\u3063\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u306b\u7c21\u5358\u306a\u30af\u30a8\u30ea\u30fc\u306fimpala\u3092\u4f7f\u3046\u306e\u306f\u3042\u308a\u3060\u3068\u611f\u3058\u305f\u3002\n\n\u30cb\u30b3\u30cb\u30b3\u52d5\u753b\u306e\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u305f\u3001\u30cb\u30b3\u30cb\u30b3\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u3053\u3061\u3089\u306b\u3042\u308b\u3002\n\nhttp://www.nii.ac.jp/cscenter/idr/nico/nico.html\n\n\u52d5\u753b\u60c5\u5831\u3068\u3001\u30b3\u30e1\u30f3\u30c8\u60c5\u5831\u3001\u30cb\u30b3\u30cb\u30b3\u5927\u767e\u79d1\u306e\u60c5\u5831\u3092\u5229\u7528\u3067\u304d\u308b\u3002\n\n\n# Hive Impala\u5206\u6790\u74b0\u5883\u306e\u6e96\u5099\n\nElastic mapreduce(EMR)\u74b0\u5883\u3067\u3001impala\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u3001\u8a2d\u5b9a\u306f\u7c21\u5358\u3060\u3002EMR\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f5c\u308b\u969b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6700\u3082\u65b0\u3057\u3044hadoop\u3092\u9078\u3093\u3067\u3001impala\u3092\u8ffd\u52a0\u3059\u308c\u3070\u826f\u3044\u3002\n\n![EMR](http://i.gyazo.com/024d9b895df955981c7abc829acbeabe.png)\n\nruby\u88fd\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3067\u3042\u308belastic-mapreduce-ruby-cli\u3092\u4f7f\u3046\u5834\u5408\u306f\u3001\u6700\u65b0\u7248\u3092\u843d\u3068\u3057\u3066\u304d\u3066\u3001credentials.json\u3092\u81ea\u5206\u306e\u74b0\u5883\u306b\u66f8\u304d\u63db\u3048\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30fc\u4f5c\u6210\u6642\u306b\u3001--hive-interactive\u3092\u629c\u3044\u3066\u3001--impala-interactive\u3092\u4ed8\u3051\u8db3\u305b\u3070\u826f\u3044\u3002\n\n\u30b7\u30a7\u30eb\u3092\u6652\u3059\u3068\u3053\u306e\u3088\u3046\u306a\u8d77\u52d5\u30b7\u30a7\u30eb\u3092\u66f8\u3044\u305f\n\n```bash:create_emr.sh\n\n#!/bin/bash\n~/elastic-mapreduce-ruby-cli/elastic-mapreduce --create --alive --impala-interactive --name \"niconico_impala_test\" \\\n--instance-group master --instance-type m1.medium --instance-count 1 --bid-price 0.3 \\\n--instance-group core --instance-type m1.large --instance-count 3 --bid-price 0.3 \\\n--ami-version 3.0.4\n```\n\n\u30c7\u30fc\u30bf\u306e\u6295\u5165\u306f\u3001\u4e00\u65e6\u624b\u5143\u306e\u74b0\u5883\u306b\u30c7\u30fc\u30bf\u3092\u6301\u3063\u3066\u304d\u3066\u304b\u3089\u884c\u3046\u3002s3\u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d8a\u3057\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3063\u3066impala\u304c\u65e9\u304f\u306a\u308b\u304b\u4e0d\u5b89\u304c\u3042\u3063\u305f\u306e\u3067\u3001\u624b\u5143\u306b\u6301\u3063\u3066\u304d\u305f\u3002\n\n\u30c7\u30fc\u30bf\u3092s3\u304b\u3089\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081\u306b\u4ee5\u4e0b\u306e\u69d8\u306a\u30b3\u30de\u30f3\u30c9\u3092\u66f8\u3044\u305f\n\n```bash:copy_hadoop.sh\n#!/bin/bash\nhadoop fs -mkdir -p /mnt/nico-data/\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo_sampling10 /mnt/nico-data/videoinfo_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo_sampling100 /mnt/nico-data/videoinfo_sampling100\nhadoop fs -cp s3n://nicovideo-info-data/comment_data_sampling10 /mnt/nico-data/comment_data_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/comment_data_sampling100 /mnt/nico-data/comment_data_sampling100\nhadoop fs -cp s3n://nicovideo-info-data/videoinfo-rcfile /mnt/nico-data/videoinfo-rcfile\nhadoop fs -cp s3n://nicovideo-info-data/comment-data-rcfile /mnt/nico-data/comment-data-rcfile\nhadoop fs -cp s3n://nicovideo-info-data/tags /mnt/nico-data/tags\nhadoop fs -cp s3n://nicovideo-info-data/tags_sampling10 /mnt/nico-data/tags_sampling10\nhadoop fs -cp s3n://nicovideo-info-data/tags_sampling100 /mnt/nico-data/tags_sampling100\n```\n\n\u6614\u306ehadoop\u3068\u9055\u3063\u3066\u3044\u305f\u70b9\u306f\u3001mkdir \u306b-p\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u306a\u3044\u3068\u3001\u8907\u6570\u6bb5\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u3063\u3066\u304f\u308c\u306a\u3044\u3002cp\u306e\u969b\u306b\u3001\u5f8c\u308d\u306b/\u304c\u3042\u308b\u3068\u304d\u3061\u3093\u3068\u30b3\u30d4\u30fc\u3055\u308c\u306a\u3044\u306e2\u70b9\u3060\u3063\u305f\u3002\n\u3053\u306e\u3088\u3046\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u3042\u3068\u3001\n\n```sql:insert.sql\n\nset hive.exec.compress.intermediate=true;\nset hive.exec.compress.output=true;\nset mapred.map.output.compression.codec=org.apache.hadoop.io.compress.SnappyCodec;\nset mapred.output.compression.type=RECORD;\ncreate database nicodata;\nuse nicodata;\n\nCREATE TABLE videoinfo(\nsmid STRING,\nthread_id STRING,\ntitle STRING,\ndescription STRING,\nthumbnail_url STRING,\nupload_time STRING,\nlength INT,\nmovie_type STRING,\nsize_high INT,\nsize_low INT,\nview_counter INT,\ncomment_counter INT,\nmylist_counter INT,\nlast_res_body STRING)\nSTORED AS RCFILE;\n\nCREATE TABLE `comment_data`(\nsmid STRING,\n`date` INT,\nvpos INT,\nno INT,\ncommand STRING,\n`comment_string` STRING)\nSTORED AS RCFILE;\n\nCREATE TABLE `tags`(\nsmid STRING,\nlocked TINYINT,\ncategory TINYINT,\ntag STRING\n)\nSTORED AS RCFILE;\n\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo-rcfile\" INTO TABLE videoinfo;\nLOAD DATA INPATH \"/mnt/nico-data/comment-data-rcfile\" INTO TABLE comment_data;\nLOAD DATA INPATH \"/mnt/nico-data/tags/\" INTO TABLE tags;\n\nCREATE TABLE videoinfo_sampling10 LIKE videoinfo;\nCREATE TABLE videoinfo_sampling100 LIKE videoinfo;\n\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo_sampling10\" INTO TABLE videoinfo_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/videoinfo_sampling100\" INTO TABLE videoinfo_sampling100;\n\nCREATE TABLE comment_data_sampling10 LIKE `comment_data`;\nCREATE TABLE comment_data_sampling100 LIKE `comment_data`;\n\nLOAD DATA INPATH \"/mnt/nico-data/comment_data_sampling10\" INTO TABLE comment_data_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/comment_data_sampling100\" INTO TABLE comment_data_sampling100;\n\nCREATE TABLE tags_sampling10 LIKE tags;\nCREATE TABLE tags_sampling100 LIKE tags;\n\nLOAD DATA INPATH \"/mnt/nico-data/tags_sampling10\" INTO TABLE tags_sampling10;\nLOAD DATA INPATH \"/mnt/nico-data/tags_sampling100\" INTO TABLE tags_sampling100;\n```\n\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u6b21\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304c\u5165\u308b\u3002\n\n| \u30c6\u30fc\u30d6\u30eb     | \u4ef6\u6570    |\n|:------------:|:------:|\n| \u52d5\u753b\u60c5\u5831     | 800\u4e07  |\n| \u30bf\u30b0\u60c5\u5831     | 4000\u4e07 |\n| \u30b3\u30e1\u30f3\u30c8\u60c5\u5831 | 24\u5104   |\n\n\u30b3\u30f3\u30d4\u30e5\u30fc\u30bf\u3067\u81ea\u52d5\u751f\u6210\u3057\u305f\u308f\u3051\u3067\u306f\u306a\u3044\u3001\u751f\u306e\u30c7\u30fc\u30bf\u304c\u5927\u91cf\u306b\u624b\u306b\u5165\u308b\u306e\u306f\u691c\u8a3c\u306b\u4fbf\u5229\u3060\u3002\n\n# impala\u5b9f\u884c\n\n\u3053\u3053\u307e\u3067\u3084\u3063\u3066\u3001\u3084\u3063\u3068\u30c6\u30fc\u30d6\u30eb\u306e\u8a2d\u5b9a\u304c\u51fa\u6765\u305f\u3002\u3042\u3068\u306f\u3001\u51fa\u6765\u4e0a\u304c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\n\n```bash\nimpala-shell -r \n```\n-r\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066\u3044\u308b\u306e\u306f\u3001\u63a5\u7d9a\u5f8cimplara\u306e\u30e1\u30bf\u30c6\u30fc\u30d6\u30eb\u3092refresh\u3059\u308b\u305f\u3081\u306b\u3060(\u305d\u3046\u3057\u306a\u3044\u3068hive\u3067\u884c\u3063\u305f\u5909\u66f4\u304c\u53cd\u6620\u3055\u308c\u306a\u3044)\u3002\n\n```sql\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select tag,count(*) as cnt from tags group by tag order by cnt desc limit 10;\n\nQuery: select tag,count(*) as cnt from tags group by tag order by cnt desc limit 10\n+----------------------+---------+\n|\u3000\u30bf\u30b0\u540d                  | \u4ef6\u6570    |\n+----------------------+---------+\n| \u30b2\u30fc\u30e0               | 3593302 |\n| \u5b9f\u6cc1\u30d7\u30ec\u30a4\u52d5\u753b       | 1134356 |\n| \u97f3\u697d                 | 874535  |\n| \u6b4c\u3063\u3066\u307f\u305f           | 549536  |\n| \u6295\u7a3f\u8005\u30b3\u30e1\u30f3\u30c8       | 444108  |\n| \u30a2\u30cb\u30e1               | 332877  |\n| \u30a8\u30f3\u30bf\u30fc\u30c6\u30a4\u30e1\u30f3\u30c8   | 320617  |\n| \u6771\u65b9                 | 231043  |\n| \u3082\u3063\u3068\u8a55\u4fa1\u3055\u308c\u308b\u3079\u304d | 224274  |\n| VOCALOID             | 218548  |\n+----------------------+---------+\nReturned 10 row(s) in 17.98s\n```\n\n4\u5343\u4e07\u306e\u30c7\u30fc\u30bf\u306e\u96c6\u7d04\u304c17\u79d2\u3002\u3060\u3044\u3076\u65e9\u3044\u3002\u3061\u306a\u307f\u306bhive\u3067\u884c\u3046\u30686\u5206\u304b\u304b\u3063\u305f\u3002\n\u7d50\u69cb\u65e9\u3044\u3002\u5927\u4f5321\u500d\u7a0b\u5ea6\n\n# impala\u306e\u5236\u7d04\n\nimpala-shell>\u3067\u3001\u65e5\u672c\u8a9e\u3092\u542b\u3080SQL\u306e\u5b9f\u884c\u304c\u51fa\u6765\u306a\u304b\u3063\u305f\u3002\u30a8\u30e9\u30fc\u304c\u8d77\u3053\u3063\u305f\u3002\u65e5\u672c\u8a9e\u3092\u542b\u3080sql\u3082\u5b9f\u884c\u3067\u304d\u308b\u3068\u601d\u3046\u3051\u3069\u3001\u3084\u308a\u65b9\u306f\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\n# impala\u3068hive\u306e\u901f\u5ea6\u6bd4\u8f03\n\nimpala\u3082hive\u3082\u540c\u3058HDFS\u3092\u8aad\u3081\u308b\u3057\u3001\u540c\u3058\u30de\u30b7\u30f3\u3067\u5b9f\u884c\u3067\u304d\u308b\u306e\u3067\u3001\u901f\u5ea6\u306e\u6bd4\u8f03\u3092\u884c\u3063\u305f\u3002\u4f7f\u7528\u3057\u305f\u30de\u30b7\u30f3\u306f\u3001m1.large 4\u53f0\u3060\u3002m3.xlarge\u3067\u3082\u8a66\u3057\u305f\u304c\u3001\u7d50\u679c\u3092\u53d6\u308a\u5fd8\u308c\u305f\u3002\n\nm1.large\u306f\u30e1\u30e2\u30ea\u304c8GB\u3042\u308b\u3002\u30a4\u30f3\u30d1\u30e9\u306f\u30e1\u30e2\u30ea\u30fc\u304c\u591a\u3044\u307b\u3069\u30b9\u30b3\u30a2\u304c\u4e0a\u304c\u308b\u306e\u3067\u3001\u672c\u5f53\u306f\u3082\u3063\u3068\u3042\u3063\u305f\u307b\u3046\u304c\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n## wwww\u3092\u6700\u3082\u591a\u304f\u542b\u3093\u3067\u3044\u308b\u52d5\u753b\u306f\u306a\u306b\uff1f\n\n\n\u3088\u304f\u3084\u308b\u691c\u7d22\u3002www\u3092\u542b\u3080\u30b3\u30e1\u30f3\u30c8\u3092\u629c\u304d\u51fa\u3057\u3001\u305d\u306e\u30b3\u30e1\u30f3\u30c8\u304c\u6700\u3082\u591a\u3044\u52d5\u753b\u3092\u63a2\u3059\u3002\u691c\u7d22\u7684\u306b\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u306a\u306e\u3067\u3001\u30ab\u30e9\u30e0\u6307\u5411DB\u3067\u3082\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u3068\u4e88\u6e2c\u3057\u305f\u3002\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u306f24\u5104\u4ef6\u3060\u3002\n\n### impala\n\n```sql\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a;\nQuery: select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a\n+----------+\n| count(*) |\n+----------+\n| 2133268  |\n+----------+\nReturned 1 row(s) in 283.81s\n\n```\n\n### hive\n\n```sql\nhive>  select count(*) from (select smid,count(*) from comment_data where comment_string like \"%wwwww%\" group by smid) a;\n\nMapReduce Jobs Launched:\nJob 0: Map: 117  Reduce: 37   Cumulative CPU: 4496.83 sec   HDFS Read: 20356796592 HDFS Write: 4292 SUCCESS\nJob 1: Map: 3  Reduce: 1   Cumulative CPU: 8.26 sec   HDFS Read: 13681 HDFS Write: 8 SUCCESS\nTotal MapReduce CPU Time Spent: 0 days 1 hours 15 minutes 5 seconds 90 msec\nOK\n2133268\nTime taken: 1372.008 seconds, Fetched: 1 row(s)\n\n```\n\n|\u30bf\u30a4\u30d7|\u79d2\u6570|\n|:--|:---|\n|impala|283\u79d2|\n|hive|1372\u79d2|\n\n\u5927\u4f534\u500d\u4f4d\u9ad8\u901f\u300224\u5104\u4ef6\u30b5\u30a4\u30ba\u306e\u30c7\u30fc\u30bf\u3092\u500b\u4eba\u304c\u624b\u304c\u51fa\u308b\u304a\u5024\u6bb5\u30675\u5206\u7a0b\u5ea6\u3067\u89e3\u6790\u3067\u304d\u308b\u306e\u306f\u3059\u3055\u307e\u3058\u3044\u3002\n\n## \u6700\u3082\u9577\u3044\u52d5\u753b\u3092\u63a2\u305b\n\n800\u4e07\u4ef6\u306e\u30c7\u30fc\u30bf\u304b\u3089\u3001\u6700\u3082\u52d5\u753b\u9577\u306e\u9577\u3044\u52d5\u753b\u3092\u63a2\u3059\u3002\n\n### impala\n```sql\nQuery: select max(length) from videoinfo\n+-------------+\n| max(length) |\n+-------------+\n| 65535       |\n+-------------+\nReturned 1 row(s) in 3.57s\n```\n\n### hive\n\n```sql\nhive> select max(length) from videoinfo;\nJob 0: Map: 7  Reduce: 1   Cumulative CPU: 53.31 sec   HDFS Read: 56293172 HDFS Write: 6 SUCCESS\nTotal MapReduce CPU Time Spent: 53 seconds 310 msec\nOK\n65535\nTime taken: 71.146 seconds, Fetched: 1 row(s)\n```\n\n|\u30bf\u30a4\u30d7|\u79d2\u6570|\n|:--|:--|\n|impala|3.5\u79d2|\n|hive|71\u79d2|\n\n3.5\u79d2 vs 71\u79d2\u306a\u306e\u3067\u5927\u4f5320\u500d\u4f4d\u9055\u3046\u3002\n\n\u79c1\u9054\u304c\u89e3\u6790\u3059\u308b\u30c7\u30fc\u30bf\u306f\u610f\u5916\u3068\u5c11\u306a\u3044\u30c7\u30fc\u30bf\u3082\u591a\u3044\u306e\u3067\u3001\u5c11\u306a\u3044\u30c7\u30fc\u30bf\u3067\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u77ed\u3044impala\u306f\u3042\u308a\u304c\u305f\u3044\u3002\n\n## \u5358\u7d14\u306b\u30b3\u30e1\u30f3\u30c8\u6570\u3092\u6e2c\u308b\n\n\u5358\u7d14\u306b\u3001\u30b3\u30e1\u30f3\u30c8\u4ef6\u6570\u3092\u6e2c\u3063\u305f\u3002\u8907\u96d1\u3067\u306f\u306a\u3044\u306e\u3067\u3042\u307e\u308a\u6027\u80fd\u306e\u6307\u6a19\u306b\u306f\u306a\u3089\u306a\u3044\u3002\n\n### impala\n\n```sql\n\n[ip-10-156-249-127.ap-northeast-1.compute.internal:21000] > select count(*) from nicodata.comment_data;\nQuery: select count(*) from nicodata.comment_data\n+------------+\n| count(*)   |\n+------------+\n| 2474388510 |\n+------------+\nReturned 1 row(s) in 133.86s\n\n```\n\n### hive\n\n```sql\nhive> select count(*) from comment_data;\nMapReduce Jobs Launched:\nOK\n2474388510\nTime taken: 872.161 seconds, Fetched: 1 row(s)\n\n```\n\n|\u30bf\u30a4\u30d7|\u79d2\u6570|\n|:--|:--|\n|impala|133\u79d2|\n|hive|872\u79d2|\n\n133\u79d2 vs 872\u79d2 \u30676.5\u500d\u9ad8\u901f\n\n# \u307e\u3068\u3081\n\nEC2\u306e\u5024\u4e0b\u3052\u306b\u3088\u308a\u3001ElasticMapreduce\u3082\u5024\u4e0b\u3052\u3057\u3066\u304a\u308a\u3001\u307e\u305f\u3001hadoop\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3001hive\u4ee5\u5916\u306e\u9078\u629e\u80a2\u3082\u51fa\u3066\u304d\u305f\u3002hive\u306e\u4ee3\u308f\u308a\u3068\u3057\u3066impala\u3092\u4f7f\u3048\u306a\u3044\u304b\u3068\u8a55\u4fa1\u3092\u884c\u3063\u305f\u3002\u6982\u306d\u30015\u500d\u304b\u308920\u500d\u7a0b\u5ea6\u9ad8\u901f\u5316\u3057\u305f\u3002impala\u306f\u3001\u4e2d\u9593\u4e00\u81f4\u7684\u306a\u30af\u30a8\u30ea\u30fc\u306f\u305d\u3093\u306a\u306b\u65e9\u304f\u306a\u3089\u306a\u3044\u306e\u3067\u306f\u306a\u3044\u3068\u601d\u3063\u305f\u304c\u3001\u304d\u3061\u3093\u3068\u65e9\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u8a55\u4fa1\u3092\u3059\u308b\u524d\u306b\u3001m3.xlarge\u3067\u30b3\u30e1\u30f3\u30c8\u30c7\u30fc\u30bf\u306e\u4e2d\u9593\u4e00\u81f4\u691c\u7d22\u3092\u884c\u3063\u305f\u304c\u305d\u306e\u5834\u5408\u306f60\u79d2\u7a0b\u5ea6\u3067\u7d50\u679c\u304c\u5e30\u3063\u3066\u304d\u305f\u3002\n\n\u3084\u306f\u308a10\u79d2\u7acb\u305f\u305a\u306b\u7d50\u679c\u304c\u5e30\u3063\u3066\u304f\u308b\u306e\u306f\u3001\u30e2\u30c1\u30d9\u30fc\u30b7\u30e7\u30f3\u306e\u7dad\u6301\u306b\u3064\u306a\u304c\u308b\u3068\u601d\u3063\u305f\u3002\n\n\n\n", "tags": ["Impala", "hive", "hadoop", "ElasticMapReduce", "EMR"]}