{"tags": ["Elasticsearch", "Wikipedia"], "context": "Wikipedia \u306e\u30c7\u30fc\u30bf\u3092\u304a\u624b\u8efd\u306b Elasticsearch \u306b\u6d41\u3057\u8fbc\u3080\u624b\u9806\u3067\u3059\u3002\n\nWikipedia \u8a18\u4e8b\u30c7\u30fc\u30bf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nhttp://dumps.wikimedia.org/backup-index.html \u304b\u3089\u30ea\u30f3\u30af\u3092\u305f\u3069\u308b\u3068 pages-articles.xml.bz2 \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3002\n\u65e5\u672c\u8a9e\u7248\u3060\u3063\u305f\u3089 jawiki.\n\u3053\u3053\u3067\u306f jawiki \u306e 20150602 \u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\n\n$ wget http://dumps.wikimedia.org/jawiki/20150602/jawiki-20150602-pages-articles.xml.bz2\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\u307e\u3067\u6642\u9593\u304b\u304b\u308b\u304b\u3089\u305d\u306e\u9593\u306b\u4e26\u884c\u3057\u3066 elasticsearch \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u304b\u3059\u308b\u3068\u3088\u3055\u305d\u3046\u3002\n\nelasticsearch \u95a2\u4fc2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u672c\u4f53\n\n$ brew install elasticsearch\n\n\u3053\u3053\u3067\u306f Mac \u74b0\u5883\u306a\u306e\u3067 Homebrew \u3067\u3044\u308c\u3066\u307e\u3059\u3002\n\nelasticsearch-head\nhttp://mobz.github.io/elasticsearch-head/\nelasticsearch \u306e Web \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3002\u5165\u308c\u308b\u3068 http://localhost:9200/_plugin/head/ \u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3044\u308d\u3044\u308d\u3067\u304d\u308b\u3002\n\n$ /usr/local/Cellar/elasticsearch/*/libexec/bin/plugin install mobz/elasticsearch-head\n\n\nstream2es\nhttps://github.com/elastic/stream2es\n\u30b9\u30c8\u30ea\u30fc\u30e0\u3067 elasticsearch \u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u8fbc\u3080\u306e\u304c\u7c21\u5358\u306b\u306a\u308b\u3082\u306e\u3002\n\n$ curl -O download.elasticsearch.org/stream2es/stream2es\n$ chmod +x stream2es\n$ mv stream2es /usr/local/bin/\n\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u3064\u304f\u308b\nn-gram \u3067\u691c\u7d22\u3057\u305f\u3044\u306e\u3067 analyzer \u3068 mapping \u3092\u3053\u3053\u3067\u5b9a\u7fa9\u3002\n\u3053\u3053\u3067\u306f 1-3 gram \u306b\u3057\u3066\u308b\u3002\n\ncurl -XPUT 'localhost:9200/wiki' -d '{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"ngram\": {\n          \"filter\": [\n            \"cjk_width\",\n            \"lowercase\"\n          ],\n          \"char_filter\": [\n            \"html_strip\"\n          ],\n          \"type\": \"custom\",\n          \"tokenizer\": \"ngram\"\n        }\n      },\n      \"tokenizer\": {\n        \"ngram\": {\n          \"token_chars\": [\n            \"letter\",\n            \"digit\"\n          ],\n          \"min_gram\": \"1\",\n          \"type\": \"nGram\",\n          \"max_gram\": \"3\"\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"page\": {\n      \"properties\": {\n        \"redirect\": {\n          \"type\": \"boolean\"\n        },\n        \"special\": {\n          \"type\": \"boolean\"\n        },\n        \"disambiguation\": {\n          \"type\": \"boolean\"\n        },\n        \"link\": {\n          \"type\": \"string\"\n        },\n        \"stub\": {\n          \"type\": \"boolean\"\n        },\n        \"text\": {\n          \"analyzer\": \"ngram\",\n          \"type\": \"string\"\n        },\n        \"category\": {\n          \"type\": \"string\"\n        },\n        \"title\": {\n          \"analyzer\": \"ngram\",\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}'\n\n\n\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3053\u3093\u3067\u307f\u308b\n\u305f\u3081\u3057\u306b5\u4ef6\u3002\n\n$ stream2es wiki --max-docs 5 --source jawiki-20150602-pages-articles.xml.bz2\n\n\u30d6\u30e9\u30a6\u30b6\u3067 http://localhost:9200/_plugin/head/ \u3092\u958b\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3067\u308c\u3070OK\n\n\u3082\u3057\u3001Unassigned \u3063\u3066\u3067\u305f\u3089\n\n$ curl -XPUT localhost:9200/_settings -d'{\"number_of_replicas\":0}'\n\n\u3057\u3066\u304b\u3089\u3084\u308a\u76f4\u3057\u3002\n\n\u5168\u90e8\u5165\u308c\u308b\u3068\u3053\u306e\u304f\u3089\u3044\u306b\u306a\u308b\u3002\nWikipedia \u306e\u30c7\u30fc\u30bf\u3092\u304a\u624b\u8efd\u306b Elasticsearch \u306b\u6d41\u3057\u8fbc\u3080\u624b\u9806\u3067\u3059\u3002\n\n## Wikipedia \u8a18\u4e8b\u30c7\u30fc\u30bf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nhttp://dumps.wikimedia.org/backup-index.html \u304b\u3089\u30ea\u30f3\u30af\u3092\u305f\u3069\u308b\u3068 pages-articles.xml.bz2 \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3002\n\u65e5\u672c\u8a9e\u7248\u3060\u3063\u305f\u3089 jawiki.\n\n\u3053\u3053\u3067\u306f jawiki \u306e 20150602 \u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3046\u3002\n\n```bash\n\n$ wget http://dumps.wikimedia.org/jawiki/20150602/jawiki-20150602-pages-articles.xml.bz2\n```\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5b8c\u4e86\u307e\u3067\u6642\u9593\u304b\u304b\u308b\u304b\u3089\u305d\u306e\u9593\u306b\u4e26\u884c\u3057\u3066 elasticsearch \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u304b\u3059\u308b\u3068\u3088\u3055\u305d\u3046\u3002\n\n## elasticsearch \u95a2\u4fc2\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n### \u672c\u4f53\n\n```bash\n\n$ brew install elasticsearch\n```\n\n\u3053\u3053\u3067\u306f Mac \u74b0\u5883\u306a\u306e\u3067 Homebrew \u3067\u3044\u308c\u3066\u307e\u3059\u3002\n\n### elasticsearch-head\n\nhttp://mobz.github.io/elasticsearch-head/\nelasticsearch \u306e Web \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3002\u5165\u308c\u308b\u3068 http://localhost:9200/_plugin/head/ \u3067\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3044\u308d\u3044\u308d\u3067\u304d\u308b\u3002\n\n```bash\n\n$ /usr/local/Cellar/elasticsearch/*/libexec/bin/plugin install mobz/elasticsearch-head\n```\n\n### stream2es\n\nhttps://github.com/elastic/stream2es\n\u30b9\u30c8\u30ea\u30fc\u30e0\u3067 elasticsearch \u306b\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u8fbc\u3080\u306e\u304c\u7c21\u5358\u306b\u306a\u308b\u3082\u306e\u3002\n\n```bash\n\n$ curl -O download.elasticsearch.org/stream2es/stream2es\n$ chmod +x stream2es\n$ mv stream2es /usr/local/bin/\n```\n\n## \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u3064\u304f\u308b\n\nn-gram \u3067\u691c\u7d22\u3057\u305f\u3044\u306e\u3067 analyzer \u3068 mapping \u3092\u3053\u3053\u3067\u5b9a\u7fa9\u3002\n\u3053\u3053\u3067\u306f 1-3 gram \u306b\u3057\u3066\u308b\u3002\n\n```bash\n\ncurl -XPUT 'localhost:9200/wiki' -d '{\n  \"settings\": {\n    \"analysis\": {\n      \"analyzer\": {\n        \"ngram\": {\n          \"filter\": [\n            \"cjk_width\",\n            \"lowercase\"\n          ],\n          \"char_filter\": [\n            \"html_strip\"\n          ],\n          \"type\": \"custom\",\n          \"tokenizer\": \"ngram\"\n        }\n      },\n      \"tokenizer\": {\n        \"ngram\": {\n          \"token_chars\": [\n            \"letter\",\n            \"digit\"\n          ],\n          \"min_gram\": \"1\",\n          \"type\": \"nGram\",\n          \"max_gram\": \"3\"\n        }\n      }\n    }\n  },\n  \"mappings\": {\n    \"page\": {\n      \"properties\": {\n        \"redirect\": {\n          \"type\": \"boolean\"\n        },\n        \"special\": {\n          \"type\": \"boolean\"\n        },\n        \"disambiguation\": {\n          \"type\": \"boolean\"\n        },\n        \"link\": {\n          \"type\": \"string\"\n        },\n        \"stub\": {\n          \"type\": \"boolean\"\n        },\n        \"text\": {\n          \"analyzer\": \"ngram\",\n          \"type\": \"string\"\n        },\n        \"category\": {\n          \"type\": \"string\"\n        },\n        \"title\": {\n          \"analyzer\": \"ngram\",\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}'\n```\n\n## \u30c7\u30fc\u30bf\u3092\u6d41\u3057\u3053\u3093\u3067\u307f\u308b\n\n\u305f\u3081\u3057\u306b5\u4ef6\u3002\n\n```bash\n\n$ stream2es wiki --max-docs 5 --source jawiki-20150602-pages-articles.xml.bz2\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3067 http://localhost:9200/_plugin/head/ \u3092\u958b\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3067\u308c\u3070OK\n\n![Screen Shot 2015-08-04 at 17.59.00.png](https://qiita-image-store.s3.amazonaws.com/0/48207/6a3eff00-4cff-9d82-847d-28264a168c2f.png)\n\n\n\n\u3082\u3057\u3001Unassigned \u3063\u3066\u3067\u305f\u3089\n\n```bash\n\n$ curl -XPUT localhost:9200/_settings -d'{\"number_of_replicas\":0}'\n```\n\n\u3057\u3066\u304b\u3089\u3084\u308a\u76f4\u3057\u3002\n\n\n![\u65e5\u672c\u8a9eWikipedia\u306e\u5168\u8a18\u4e8b\u3092Elasticsearch\u306b\u3044\u308c\u305f](https://qiita-image-store.s3.amazonaws.com/0/48207/96e78cc3-7060-0721-a3d5-a70d11d665d7.png)\n\u5168\u90e8\u5165\u308c\u308b\u3068\u3053\u306e\u304f\u3089\u3044\u306b\u306a\u308b\u3002\n"}