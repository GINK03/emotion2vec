{"tags": ["Firebase", "ios10", "Swift"], "context": "iOS10\u3067\u3001Firebase\u3092\u7528\u3044\u305f\u30b5\u30a4\u30ec\u30f3\u30c8\u901a\u77e5\u3092\u884c\u3046\u3002\nFirebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u9001\u4fe1\u3067\u304d\u308bFirebase Notifications\u3067\u306fJSON\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u306a\u3044\u306e\u3067\u3001Firebase Cloud Messaging\u3092\u5229\u7528\u3059\u308b\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n1. \u666e\u901a\u306epush\u901a\u77e5\u3092\u9001\u308c\u308b\u3088\u3046\u306b\u3059\u308b\nhttps://firebase.google.com/docs/cloud-messaging/ios/client?hl=ja\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306fiOS9\u307e\u3067\u306e\u5b9f\u88c5\u65b9\u6cd5\u3057\u304b\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001User Notifications Framework\u3092\u7528\u3044\u305f\u3084\u308a\u65b9\u3067\u66f8\u304f\u3002\n\n2. BackgroundModes\u306e\u8a2d\u5b9a\nTARGETS > Capabilities > Background Modes\u306eBackground fetch\u3068Remote notifications\u306b\u30c1\u30a7\u30c3\u30af\n\n3. AppDelegate\u306b\u4e0b\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\n\nAppDelegate.swift\n    func application(_ application: UIApplication,\n                     didReceiveRemoteNotification userInfo: [AnyHashable : Any],\n                     fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) \n    {\n        // \u51e6\u7406\n        completionHandler(.newData)\n    }\n\n\n\n\u30a2\u30d7\u30ea\u306eforeground, background\u306b\u95a2\u308f\u3089\u305a\u4e0a\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u304c\u547c\u3070\u308c\u308b\u3002\n\n\u30b5\u30fc\u30d0\u5074\n\n1. Chrome\u30a6\u30a7\u30d6\u30b9\u30c8\u30a2\u304b\u3089Postman\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=ja\n\n2. Firebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u30ad\u30fc\u3092\u53d6\u5f97\n\u5de6\u4e0a\u306e\u6b6f\u8eca\u30de\u30fc\u30af > \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a > \u30af\u30e9\u30a6\u30c9\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\n\n\n3. Postman\u3067\u9001\u4fe1\u3059\u308bJSON\u3092\u8a18\u8ff0\n\nHTTP\u30e1\u30bd\u30c3\u30c9\u306fPOST\u3001URL\u306f https://fcm.googleapis.com/fcm/send \u3092\u8a2d\u5b9a\u3002\nHeaders\u306b\u4e0b\u8a18\u306e\u30ad\u30fc\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nHeaders\n  Content-Type:application/json\n  Authorization:key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  \n\n\nxxxxx\u306b\u306f\u5148\u307b\u3069\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30ad\u30fc\u3092\u5165\u529b\u3059\u308b\u3002\nkey=\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9401\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u6ce8\u610f\u3002\nBody\u306bJSON\u3092\u8a18\u8ff0\u3059\u308b\u3002\n\n\nBody\n{\n    \"to\" : \"/topics/ios\",\n    \"priority\" : \"high\",\n    \"notification\" : {\n        \"content_available\" : true\n    }\n}\n\n\n\"to\":\u306f\u9001\u4fe1\u3057\u305f\u3044\u30c7\u30d0\u30a4\u30b9\u304c\u767b\u9332\u3055\u308c\u3066\u3042\u308b\u30c8\u30d4\u30c3\u30af\u304b\u3001\u3082\u3057\u304f\u306f\u30c7\u30d0\u30a4\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\u30c8\u30d4\u30c3\u30af\u306e\u767b\u9332\u306b\u306fFIRMessaging.messaging().subscribe(toTopic: \"\u30c8\u30d4\u30c3\u30af\u540d\")\u3092\u7528\u3044\u308b\u3002\u53cd\u6620\u3055\u308c\u308b\u307e\u3067\u6570\u6642\u9593\u304b\u304b\u308b\u304c\u3001\u305d\u308c\u307e\u3067\u306f\u305d\u306e\u30c8\u30d4\u30c3\u30af\u306b\u9001\u4fe1\u304c\u3067\u304d\u306a\u3044\u3002Firebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u306eNotifications > \u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8 >\u3000\u30bf\u30fc\u30b2\u30c3\u30c8 > \u30c8\u30d4\u30c3\u30af \u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089\u9001\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\u3053\u306e\u30ad\u30fc\u3092\u524a\u308b\u3068\u5168\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u901a\u77e5\u304c\u884c\u304f\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u901a\u77e5\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3002\n\"notification:\"\u5185\u306e\"content_available\" : true\u3067\u3001\u30a2\u30d7\u30ea\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u72b6\u614b\u3067\u3082\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u306a\u304a\u3001Apple\u306e\u516c\u5f0f\u30ac\u30a4\u30c9\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u3053\u3061\u3089\u306eJSON\u3067\u306f\u901a\u77e5\u304c\u5c4a\u304b\u306a\u3044\u306e\u3067\u6ce8\u610f\u3002\n\n\n4. POST\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\n\u53f3\u4e0a\u306e\"Send\"\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n\u30a2\u30d7\u30ea\u304cbackground\u3067\u3042\u3063\u3066\u3082didReceiveRemoteNotification\u5185\u306e\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u308b\u3002\u30e4\u30c3\u30bf\u30cd\uff01\n\n\u8ffd\u8a18\n\nAppDelegate.swift\nUIApplication.shared.registerForRemoteNotifications()\n\n\n\u3053\u306e\u30b3\u30fc\u30c9\u3060\u3051\u66f8\u304f\u3068\u627f\u8a8d\u30a2\u30e9\u30fc\u30c8\u3092\u51fa\u3055\u305a\u306b\u30b5\u30a4\u30ec\u30f3\u30c8\u901a\u77e5\u3092\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\niOS10\u3067\u3001Firebase\u3092\u7528\u3044\u305f\u30b5\u30a4\u30ec\u30f3\u30c8\u901a\u77e5\u3092\u884c\u3046\u3002\nFirebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u9001\u4fe1\u3067\u304d\u308bFirebase Notifications\u3067\u306fJSON\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u306a\u3044\u306e\u3067\u3001Firebase Cloud Messaging\u3092\u5229\u7528\u3059\u308b\u3002\n\n# \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n## 1. \u666e\u901a\u306epush\u901a\u77e5\u3092\u9001\u308c\u308b\u3088\u3046\u306b\u3059\u308b\n\nhttps://firebase.google.com/docs/cloud-messaging/ios/client?hl=ja\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306fiOS9\u307e\u3067\u306e\u5b9f\u88c5\u65b9\u6cd5\u3057\u304b\u66f8\u304b\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001User Notifications Framework\u3092\u7528\u3044\u305f\u3084\u308a\u65b9\u3067\u66f8\u304f\u3002\n\n## 2. BackgroundModes\u306e\u8a2d\u5b9a\n\nTARGETS > Capabilities > Background Modes\u306e`Background fetch`\u3068`Remote notifications`\u306b\u30c1\u30a7\u30c3\u30af\n\n## 3. AppDelegate\u306b\u4e0b\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u8ffd\u52a0\n\n```ruby:AppDelegate.swift\n    func application(_ application: UIApplication,\n                     didReceiveRemoteNotification userInfo: [AnyHashable : Any],\n                     fetchCompletionHandler completionHandler: @escaping (UIBackgroundFetchResult) -> Void) \n    {\n        // \u51e6\u7406\n        completionHandler(.newData)\n    }\n    \n```\n**\u30a2\u30d7\u30ea\u306eforeground, background\u306b\u95a2\u308f\u3089\u305a\u4e0a\u8a18\u306e\u30e1\u30bd\u30c3\u30c9\u304c\u547c\u3070\u308c\u308b\u3002**\n\n\n# \u30b5\u30fc\u30d0\u5074\n\n## 1. Chrome\u30a6\u30a7\u30d6\u30b9\u30c8\u30a2\u304b\u3089Postman\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhttps://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=ja\n\n## 2. Firebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u30b5\u30fc\u30d0\u30fc\u30ad\u30fc\u3092\u53d6\u5f97\n\u5de6\u4e0a\u306e\u6b6f\u8eca\u30de\u30fc\u30af > \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u5b9a > \u30af\u30e9\u30a6\u30c9\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-09 17.30.38.png](https://qiita-image-store.s3.amazonaws.com/0/64665/08aedf2d-e9cc-7635-6609-7d1f62146814.png)\n\n## 3. Postman\u3067\u9001\u4fe1\u3059\u308bJSON\u3092\u8a18\u8ff0\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-09 21.36.13.png](https://qiita-image-store.s3.amazonaws.com/0/64665/0a723a28-0027-82ac-da64-c83e14102858.png)\n\nHTTP\u30e1\u30bd\u30c3\u30c9\u306fPOST\u3001URL\u306f https://fcm.googleapis.com/fcm/send \u3092\u8a2d\u5b9a\u3002\nHeaders\u306b\u4e0b\u8a18\u306e\u30ad\u30fc\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```ruby:Headers\n  Content-Type:application/json\n  Authorization:key=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  \n```\nxxxxx\u306b\u306f\u5148\u307b\u3069\u53d6\u5f97\u3057\u305f\u30b5\u30fc\u30d0\u30fc\u30ad\u30fc\u3092\u5165\u529b\u3059\u308b\u3002\n**`key=`\u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\u30b3\u30fc\u30c9401\u304c\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u6ce8\u610f\u3002**\n\n\nBody\u306bJSON\u3092\u8a18\u8ff0\u3059\u308b\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-09 17.25.33.png](https://qiita-image-store.s3.amazonaws.com/0/64665/cf18e184-75a2-8be6-cd46-48f969c3c273.png)\n\n```ruby:Body\n{\n    \"to\" : \"/topics/ios\",\n    \"priority\" : \"high\",\n    \"notification\" : {\n\t    \"content_available\" : true\n    }\n}\n```\n\n`\"to\":`\u306f\u9001\u4fe1\u3057\u305f\u3044\u30c7\u30d0\u30a4\u30b9\u304c\u767b\u9332\u3055\u308c\u3066\u3042\u308b\u30c8\u30d4\u30c3\u30af\u304b\u3001\u3082\u3057\u304f\u306f\u30c7\u30d0\u30a4\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a\u3059\u308b\u3002\u30c8\u30d4\u30c3\u30af\u306e\u767b\u9332\u306b\u306f`FIRMessaging.messaging().subscribe(toTopic: \"\u30c8\u30d4\u30c3\u30af\u540d\")`\u3092\u7528\u3044\u308b\u3002\u53cd\u6620\u3055\u308c\u308b\u307e\u3067\u6570\u6642\u9593\u304b\u304b\u308b\u304c\u3001\u305d\u308c\u307e\u3067\u306f\u305d\u306e\u30c8\u30d4\u30c3\u30af\u306b\u9001\u4fe1\u304c\u3067\u304d\u306a\u3044\u3002Firebase Web\u30b3\u30f3\u30bd\u30fc\u30eb\u306eNotifications > \u65b0\u3057\u3044\u30e1\u30c3\u30bb\u30fc\u30b8 >\u3000\u30bf\u30fc\u30b2\u30c3\u30c8 > \u30c8\u30d4\u30c3\u30af \u306b\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3089\u9001\u4fe1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n**\u3053\u306e\u30ad\u30fc\u3092\u524a\u308b\u3068\u5168\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u901a\u77e5\u304c\u884c\u304f\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u901a\u77e5\u306e\u9001\u4fe1\u306b\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u3002**\n\n\n`\"notification:\"`\u5185\u306e`\"content_available\" : true`\u3067\u3001\u30a2\u30d7\u30ea\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u72b6\u614b\u3067\u3082\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u3002\u306a\u304a\u3001Apple\u306e\u516c\u5f0f\u30ac\u30a4\u30c9\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u66f8\u3044\u3066\u3042\u308b\u304c\u3001\u3053\u3061\u3089\u306eJSON\u3067\u306f\u901a\u77e5\u304c\u5c4a\u304b\u306a\u3044\u306e\u3067\u6ce8\u610f\u3002\n\n<img width=\"478\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-01-09 18.34.06.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/64665/c20469cc-d092-631a-203e-a1b5a7fea296.png\">\n\n\n## 4. POST\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\n\u53f3\u4e0a\u306e\"Send\"\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n\u30a2\u30d7\u30ea\u304cbackground\u3067\u3042\u3063\u3066\u3082`didReceiveRemoteNotification`\u5185\u306e\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u308b\u3002\u30e4\u30c3\u30bf\u30cd\uff01:dango:\n\n## \u8ffd\u8a18\n```ruby:AppDelegate.swift\nUIApplication.shared.registerForRemoteNotifications()\n```\n\u3053\u306e\u30b3\u30fc\u30c9\u3060\u3051\u66f8\u304f\u3068\u627f\u8a8d\u30a2\u30e9\u30fc\u30c8\u3092\u51fa\u3055\u305a\u306b\u30b5\u30a4\u30ec\u30f3\u30c8\u901a\u77e5\u3092\u9001\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n"}