{"context": " More than 1 year has passed since last update.Docker \u4fbf\u5229\u305d\u3046\u306a\u4e8b\u306b\u3088\u3046\u3084\u304f\u6c17\u4ed8\u3044\u305f\u306e\u3067\u3001CoreOS \u3067\u59cb\u3081\u308b\u30e1\u30e2\u3002Mac OS X \u3067\u4f5c\u696d\u3057\u3066\u307e\u3059\u3002diskutil \u3084 pbcopy \u306a\u3093\u304b\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8aad\u307f\u5909\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n\u7269\u7406\u30b5\u30fc\u30d0\u30fc\u3078 CoreOS \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30b9\u30af\u306e\u4f5c\u6210\n\n\nCoreOS \u306e web \u30b5\u30a4\u30c8\u3088\u308a ISO \u30d5\u30a1\u30a4\u30eb\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nUSB \u30e1\u30e2\u30ea\u3078 ISO \u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u3092\u30b3\u30d4\u30fc:\n\ndiskutil unmountDisk /dev/diskN  # USB \u30e1\u30e2\u30ea\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\nsudo dd if=./coreos_production_iso_image.iso of=/dev/diskN bs=1m  # dd \u3067 ISO \u3092 USB \u30e1\u30e2\u30ea\u306b\u30b3\u30d4\u30fc\n\n\nInstalling to Disk\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ncloud-config \u306e\u4f5c\u6210\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306e\u8a2d\u5b9a\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b cloud-config.yml \u3092\u4f5c\u6210\u3059\u308b\u3002CentOS \u306b\u304a\u3051\u308b ks.cfg \u307f\u305f\u3044\u306a\u3082\u306e\u304b\u3002\nSSH \u9375 coreos_key \u30da\u30a2\u3092\u4f5c\u6210:\nssh-keygen -t rsa -C anony@foo.bar -f ./coreos_key\n\n\u516c\u958b\u9375 coreos_key.pub \u306e\u6587\u5b57\u5217\u3092\u30b3\u30d4\u30fc\u3057\u3066 cloud-config.yml \u306b\u4f7f\u7528:\ncat ./coreos_key.pub | pbcopy\n\ncloud-config.yml \u3092\u4f5c\u6210:\ntouch ./cloud-config.yml\n\n\ncloud-config.yml\n#cloud-config\n\ncoreos:\n  units:\n    - name: etcd.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: docker.service\n      command: start\n\n    # \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092 JST \u306b\u8a2d\u5b9a\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n\n    # \u56fa\u5b9a IP \u306e\u8a2d\u5b9a\u8ffd\u52a0\n    - name: 10-static.network\n      runtime: false\n      content: |\n        [Match]\n        Name=eno1\n        [Network]\n        Address=192.168.0.98/24\n        Gateway=192.168.0.1\n        DNS=192.168.0.1\n\n    # NFS \u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u306e\u8a2d\u5b9a\u8ffd\u52a0\n    - name: media-myvolume.mount\n      command: start\n      content: |\n        [Mount]\n        What=192.168.0.88:/var\n        Where=/media/myvolume\n        Type=nfs\n        Options=nolock\n\n  update:\n    - reboot-strategy: best-effort\n\nssh_authorized_keys:\n    # \u7ba1\u7406\u30e6\u30fc\u30b6\u30fc core \u306e\u516c\u958b\u9375\u3002coreos_key.pub \u306e\u6587\u5b57\u5217\u3092\u4f7f\u7528\n    - ssh-rsa AAAAB3NzaC[...] anony@foo.bar\n\nhostname: coreos  # \u30db\u30b9\u30c8\u540d\u3092\u9069\u5f53\u306b\u6307\u5b9a\n\nmanage_etc_hosts: localhost  # \u30ed\u30fc\u30ab\u30eb\u306e\u540d\u524d\u89e3\u6c7a\u7528\n\n\n\nCustomize with Cloud-Config\nNetwork Configuration\nMounting Storage\n\n\nUSB \u30e1\u30e2\u30ea\u304b\u3089\u8d77\u52d5\nCoreOS \u306e USB \u30e1\u30e2\u30ea\u304b\u3089 PC \u3092\u8d77\u52d5\u3059\u308b\u3002\u81ea\u52d5\u3067 core \u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b:\nlocalhost login: core (automatic login)\nCoreOS (stable)\nUpdate Strategy: No Reboots\ncore@localhost ~ $\n\n\u30b5\u30fc\u30d0\u30fc\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3059\u308b:\nip add show\n\neno1: flags=4163<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500 \n    inet 192.168.0.98 netmask 255.255.255.0 broadcast 192.168.1.255\n\n\u4e00\u6642\u7684\u306b core \u30e6\u30fc\u30b6\u30fc\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b:\nsudo passwd core\n\n\u8a2d\u5b9a\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u4f5c\u6210\u3057\u305f cloud-config.yml \u3092\u4f5c\u696d PC \u304b\u3089\u30b5\u30fc\u30d0\u30fc\u306b\u8ee2\u9001\u3059\u308b:\nscp ./cloud-config.yml core@192.168.0.98:~\n\n\n\u5b9f\u969b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b:\nsudo coreos-install -d /dev/sda -C stable -c ~/cloud-config.yml\n\n\n\n/dev/sda \u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8aad\u307f\u5909\u3048\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u518d\u8d77\u52d5\u3059\u308b:\nsudo reboot\n\n\n\u63a5\u7d9a\u78ba\u8a8d\n\u4f5c\u696d PC \u304b\u3089 SSH \u9375 coreos_key \u3092\u7528\u3044\u3066 CoreOS \u30b5\u30fc\u30d0\u30fc\u3078 SSH \u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b:\nssh -i ./coreos_key core@192.168.0.98\n\n\u3061\u306a\u307f\u306b cloud-config.yml \u306e\u8a2d\u5b9a\u306f /var/lib/coreos-install/user_data \u3092\u66f4\u65b0\u3059\u308b\u4e8b\u3067\u5909\u66f4\u304c\u53ef\u80fd\u3002\u8a2d\u5b9a\u306e\u66f4\u65b0\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3053\u3061\u3089\u304b\u3089\u3002\n\u63a5\u7d9a\u3067\u304d\u305f\u3089\u5b8c\u4e86\u3002\u4ee5\u964d\u306f SSH \u7d4c\u7531\u306e\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 Docker \u3092\u5b9f\u884c\u3059\u308b\u3002\n\nVagrant \u3067 CoreOS \u3092\u5b9f\u884c\n\u3061\u3087\u3063\u3068\u5bc4\u308a\u9053\u3067\u3001\u7269\u7406\u30b5\u30fc\u30d0\u30fc\u3067\u306f\u306a\u304f Vagrant \u3067 CoreOS \u3092\u8d77\u52d5\u3059\u308b\u65b9\u6cd5\u3082\u66f8\u3044\u3066\u304a\u304f\u3002\nCoreOS \u304c\u516c\u5f0f\u306b Vagrantfile \u3092\u516c\u958b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u3002\nCoreOS \u306e GitHub \u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089 Vagrantfile \u4e00\u5f0f\u3092\u30af\u30ed\u30fc\u30f3\u3059\u308b:\ngit clone https://github.com/coreos/coreos-vagrant.git\ncd ./coreos-vagrant\n\n\u3042\u3068\u306f\u666e\u901a\u306b Vagrant \u306e\u624b\u9806\u3067\u3059:\nvagrant up\nvagrant ssh\n\n\nRunning CoreOS on Vagrant\n\n\nDocker \u3067 \"Hello, world.\"\n\u3053\u3053\u304b\u3089 Docker \u306e\u8a71\u3002CoreOS \u306b SSH \u30ed\u30b0\u30a4\u30f3\u3057\u305f\u72b6\u614b\u3067\u4f5c\u696d\u3059\u308b\u3002\n\u307e\u305a\u306f\u7c21\u5358\u306b Docker \u306e\u52d5\u4f5c\u78ba\u8a8d\u3067\u3001\u65e2\u5b58\u306e\u30b3\u30f3\u30c6\u30ca\u304b\u3089 echo \u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066 \"Hello, world.\" \u3068\u8868\u793a\u3057\u3066\u307f\u308b\u3002\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n\u307e\u305a Docker Hub \u3068\u3044\u3046\u516c\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u5171\u6709\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u304b\u3089 CentOS \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\u3059\u308b\u3002\u5c1a\u3001\u4e88\u3081 Docker Hub \u3067\u30e6\u30fc\u30b6\u30fc\u767b\u9332\u3092\u3057\u3066\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u3002\nDocker Hub \u3078\u30ed\u30b0\u30a4\u30f3\u3059\u308b:\ndocker login\n\nCentOS \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u691c\u7d22\u3059\u308b:\ndocker search centos\n\nNAME                                DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                              The official build of CentOS.                   764       [OK]       \nansible/centos7-ansible             Ansible on Centos7                              27                   [OK]\ntutum/centos                        Centos image with SSH access. For the root...   12                   [OK]\nblalor/centos                       Bare-bones base CentOS 6.5 image                8                    [OK]\n[...]\n\n\u691c\u7d22\u7d50\u679c\u306e\u4e00\u756a\u4e0a centos \u304c\u516c\u5f0f\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u6700\u65b0\u7248 (centos:latest) \u3092\u53d6\u5f97\u3059\u308b:\ndocker pull centos:latest\n\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u751f\u6210\nDocker Hub \u7b49\u304b\u3089\u53d6\u5f97\u3057\u3066\u304d\u305f\u30db\u30b9\u30c8\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u4e00\u89a7\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u308b:\ndocker images\n\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\ncentos              7                   8efe422e6104        2 weeks ago         224 MB\ncentos              centos7             8efe422e6104        2 weeks ago         224 MB\ncentos              latest              8efe422e6104        2 weeks ago         224 MB\n\n\n\ncentos \u306e\u30a4\u30e1\u30fc\u30b8\u304c 3 \u3064\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u306f IMAGE ID \u304c\u793a\u3059\u901a\u308a\u540c\u4e00\u306e\u30a4\u30e1\u30fc\u30b8\u3002\u30bf\u30b0\u306e\u9055\u3044\u304b\u3089 3 \u3064\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u4e0a\u8a18 centos:latest \u30a4\u30e1\u30fc\u30b8\u4e0a\u3067 echo \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b:\ndocker run centos:latest echo 'Hello, world.'\n\nHello, world.\n\n\u4e0a\u8a18\u306e\u901a\u308a Hello, world. \u3068\u6a19\u6e96\u51fa\u529b\u304c\u8fd4\u3055\u308c\u308b\u306f\u305a\u3002\n\u3053\u308c\u306f centos:latest \u30a4\u30e1\u30fc\u30b8\u3092\u5143\u306b\u3001echo 'Hello, world.' \u3092\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u751f\u6210\u3057\u305f\u4e8b\u306b\u306a\u308b\u3002\n\u5c1a\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u5b9f\u884c\u304c\u7d42\u4e86\u3057\u3066\u3082\u524a\u9664\u3055\u308c\u306a\u3044\u3002\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u7d42\u4e86\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u304c\u6b8b\u3063\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b:\ncore@coreos ~ $ docker ps -a\nCONTAINER ID        IMAGE                        COMMAND                CREATED             STATUS                       PORTS                                          NAMES\nbab4118699d3        centos:7                     \"echo 'Hello, world.   7 seconds ago       Exited (0) 6 seconds ago                                                    trusting_elion\n\n\u3053\u308c\u306f\u660e\u793a\u7684\u306b\u524a\u9664\u3059\u308b\u307e\u3067\u3001\u3044\u3064\u307e\u3067\u3082\u6b8b\u308b\u3002\u524a\u9664\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b:\ncore@coreos ~ $ docker rm bab4118699d3\nbab4118699d3\n\n\n\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u5b9f\u884c\n\nForeground - Run Reference - Docker Documentation\n\ncore@coreos ~ $ docker run -i -t --rm=true centos:latest sh\nsh-4.2# echo 'Hello, world.'\nHello, world.\nsh-4.2# exit\nexit\ncore@coreos ~ $ \n\n\n\n-i (--interactive=true) \u6a19\u6e96\u51fa\u529b\u53d7\u3051\u4ed8\u3051\u306e\u7dad\u6301\n\n-t (--tty=true) \u7591\u4f3c TTY \u306e\u5272\u308a\u5f53\u3066\n\n--rm=true \u7d42\u4e86\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u52d5\u524a\u9664\n\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\n\nDetached (-d) - Run Reference - Docker Documentation\n\ncore@coreos ~ $ docker run -d centos:latest sh -c \"while true; do echo \\\"Hello, world.\\\"; sleep 1; done\"\nae101d4eb9eaa8cc43a6789fa8752825cb43df8e6e9a11093d44f5ebe61bb96c\n\n\n\n-d (--detach=true) \u30b3\u30f3\u30c6\u30ca\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u3001\u30b3\u30f3\u30c6\u30ca ID \u3092\u8fd4\u3059\n\ndocker ps \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b:\ncore@coreos ~ $ docker ps\nCONTAINER ID        IMAGE                        COMMAND                CREATED              STATUS              PORTS                    NAMES\nae101d4eb9ea        centos:7                     \"\\\"sh -c 'while true   About a minute ago   Up About a minute                            hungry_shockley\n\ndocker logs \u306b\u30d7\u30ed\u30bb\u30b9\u306e NAME \u3092\u6307\u5b9a\u3057\u3066\u51fa\u529b\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b:\ncore@coreos ~ $ docker logs hungry_shockley\nHello, world.\nHello, world.\nHello, world.\n\ndocker stop \u306b\u30d7\u30ed\u30bb\u30b9\u306e NAME \u3092\u6307\u5b9a\u3057\u3066\u7d42\u4e86\u3055\u305b\u308b:\ncore@coreos ~ $ docker stop hungry_shockley\nhungry_shockley\n\ndocker rm \u306b CONTAINER ID \u3092\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b:\ncore@coreos ~ $ docker rm ae101d4eb9ea\nae101d4eb9ea\n\n\nDockerfile \u306e\u5229\u7528\n\u65e2\u5b58\u306e centos \u30a4\u30e1\u30fc\u30b8\u4e0a\u3067\u69d8\u3005\u306a\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u3066\u3001\u305d\u308c\u3092\u30ab\u30b9\u30bf\u30e0\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u307f\u307e\u3059\u3002\n\nCentOS \u30b3\u30f3\u30c6\u30ca\u3067 Apache \u3068 SSH \u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u308b\n\u307e\u305a\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b centos \u30a4\u30e1\u30fc\u30b8\u4e0a\u306b\u81ea\u5206\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3059\u3002\ncentos:centos7 \u306f systemctl \u56de\u308a\u306e\u6319\u52d5\u304c\u96e3\u3057\u304b\u3063\u305f\u306e\u3067 centos:centos6 \u3067\u65e7\u6765\u901a\u308a service \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u306b\u3057\u307e\u3059\u3002\ncentos:centos6 \u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u8d77\u52d5\u3057\u307e\u3059:\ndocker run -i -t --rm=true centos:centos6 sh\n\n\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30b7\u30a7\u30eb\u306b\u5165\u308b\u3068 root \u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u3002\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u6a29\u9650\u306a\u3069\u6c17\u306b\u305b\u305a\u30ac\u30f3\u30ac\u30f3 root \u3067\u4f5c\u696d\u3059\u308b\u4e8b\u306b\u3059\u308b\u3002\n\u4e0b\u8a18\u624b\u9806\u3067 Apache \u3068 SSH \u74b0\u5883\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059:\nyum update -y\nyum install -y httpd openssh-server\n\nsed -ri \"s/^#PermitRootLogin yes/PermitRootLogin yes/\" /etc/ssh/sshd_config\nsed -ri \"s/^PasswordAuthentication yes/PasswordAuthentication no/\" /etc/ssh/sshd_config\nsed -ri \"s/^ChallengeResponseAuthentication yes/ChallengeResponseAuthentication no/\" /etc/ssh/sshd_config\nsed -ri \"s/^UsePAM yes/UsePAM no/\" /etc/ssh/sshd_config\n\nmkdir -m 700 /root/.ssh\n\ncat - > /root/.ssh/authorized_keys <<__KEY__\nssh-rsa AAAAB3NzaC[...] anony@foo.bar\n__KEY__\n\nchmod 600 /root/.ssh/authorized_keys\nchown root:root /root/.ssh/authorized_keys\n\nchkconfig httpd on\nchkconfig sshd on\n\nservice httpd start\nservice sshd start\n\n\u3068\u3001\u3053\u3053\u307e\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u306f\u7acb\u3061\u4e0a\u304c\u3063\u305f\u304c\u3001\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u8853\u304c\u5206\u304b\u3089\u306a\u3044...\n...\u3068\u3001\u3053\u308c\u306f docker run \u3059\u308b\u6642\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u3067\u89e3\u6c7a\u3059\u308b:\ndocker run -i -t --rm=true --expose=22,80 -p 10022:22 -p 10080:80 centos:centos6 sh\n\n\n\n--expose=PORT \u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5916\u90e8\u516c\u958b\u3092\u8a31\u53ef\u3059\u308b\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n-p PUBLISHED:EXPOSED \u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u3067\u5916\u90e8\u516c\u958b\u3092\u8a31\u53ef\u3055\u308c\u305f\u30dd\u30fc\u30c8 EXPOSED \u3068\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067\u516c\u958b\u3059\u308b\u306e\u306b\u4f7f\u7528\u3059\u308b\u5272\u308a\u5f53\u3066\u30dd\u30fc\u30c8 PUBLISHED \u306e\u5bfe\u3067\u6307\u5b9a\u3059\u308b\u3002 \n\n\u3053\u308c\u3067 \u30b5\u30fc\u30d0\u30fc\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\nEXPOSE (incoming ports) - Run Reference - Docker Documentation\n\n\n\u30a4\u30e1\u30fc\u30b8\u5316\u3059\u308b\n\u3055\u3066\u3001\u5916\u90e8\u516c\u958b\u306e\u65b9\u6cd5\u3060\u304c\u3001\u3053\u308c\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u751f\u6210\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001Dockerfile \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u306b\u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5217\u6319\u3057\u3066\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u5316\u3059\u308b\u306e\u304c\u30d9\u30b9\u30c8\u3002\n\nDockerfile \u306e\u4f5c\u6210\n\u524d\u8ff0\u306e\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30b7\u30a7\u30eb\u3067\u5b9f\u884c\u3057\u305f\u5185\u5bb9\u3092 Dockerfile \u3067\u8868\u73fe\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e 2 \u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308b\u3002\n\nauthorized_keys\nssh-rsa AAAAB3NzaC[...] anony@foo.bar\n\n\n\nDockerfile\nFROM centos:centos6\n\nMAINTAINER Yu I. <yu.inao@facebook.com>\n\nRUN yum update -y\nRUN yum install -y httpd openssh-server\n\nRUN sed -ri \"s/^#PermitRootLogin yes/PermitRootLogin yes/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^PasswordAuthentication yes/PasswordAuthentication no/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^ChallengeResponseAuthentication yes/ChallengeResponseAuthentication no/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^UsePAM yes/UsePAM no/\" /etc/ssh/sshd_config\n\nRUN mkdir -m 700 /root/.ssh\nADD ./authorized_keys /root/.ssh/authorized_keys\nRUN chmod 600 /root/.ssh/authorized_keys && chown root:root /root/.ssh/authorized_keys\n\nRUN chkconfig httpd on\nRUN chkconfig sshd on\n\nRUN service httpd start\nRUN service sshd start\n\nEXPOSE 22 80\n\nCMD [ \"/sbin/init\" ]\n\n\n\u3053\u308c\u3089 2 \u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea (\u3053\u3053\u3067\u306f myimage) \u306b\u683c\u7d0d\u3059\u308b:\n./myimage/\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 authorized_keys\n\n\nDockerfile - Docker Documentation\n\n\n\u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u5316\nDockerfile \u3092\u66f8\u3044\u305f\u3089\u30d3\u30eb\u30c9\u3057\u3066\u524d\u8ff0\u306e CentOS \u7b49\u3068\u540c\u3058\u304f\u30a4\u30e1\u30fc\u30b8\u5316\u3059\u308b\u3002\n\u30d3\u30eb\u30c9\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067:\ndocker build -t myimage ./myimage/\n\n\n\n-t (--tag=\"\") \u30a4\u30e1\u30fc\u30b8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u540d\u3068\u30bf\u30b0\u540d\u3092\u6307\u5b9a\n\n\u5b8c\u4e86\u3057\u305f\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30db\u30b9\u30c8\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d:\ndocker images\n\n\n\u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\n\u3042\u3068\u306f centos \u30a4\u30e1\u30fc\u30b8\u3068\u540c\u69d8\u3001docker run -d \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u5b9f\u884c\u3057\u3066\u3084\u308c\u3070\u826f\u3044\u3002\n\u305f\u3060\u3057\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u3092\u9069\u5207\u306b\u516c\u958b\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3059\u308b:\ndocker run -d -p 10022:22 -p 10080:80 myimage\n\n\n\n-p (--publish=[]) \u30db\u30b9\u30c8\u306e\u6307\u5b9a\u30dd\u30fc\u30c8\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u306e\u6307\u5b9a\u30dd\u30fc\u30c8\u3092\u516c\u958b\n\n\u3053\u308c\u3067 HTTP \u30b5\u30fc\u30d0\u30fc\u3067\u3042\u308c\u3070\u4e0b\u8a18\u306e\u30a2\u30c9\u30ec\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u306a\u308b:\nhttp://192.168.0.98:10080/\n\n\u3064\u304b\u308c\u305f\u3002\n\nDocker \u4fbf\u5229\u305d\u3046\u306a\u4e8b\u306b\u3088\u3046\u3084\u304f\u6c17\u4ed8\u3044\u305f\u306e\u3067\u3001CoreOS \u3067\u59cb\u3081\u308b\u30e1\u30e2\u3002Mac OS X \u3067\u4f5c\u696d\u3057\u3066\u307e\u3059\u3002`diskutil` \u3084 `pbcopy` \u306a\u3093\u304b\u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8aad\u307f\u5909\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n\n# \u7269\u7406\u30b5\u30fc\u30d0\u30fc\u3078 CoreOS \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30c7\u30a3\u30b9\u30af\u306e\u4f5c\u6210\n\n1. [CoreOS \u306e web \u30b5\u30a4\u30c8](https://coreos.com/)\u3088\u308a [ISO \u30d5\u30a1\u30a4\u30eb](https://coreos.com/docs/running-coreos/platforms/iso/)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n2. USB \u30e1\u30e2\u30ea\u3078 ISO \u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u30a4\u30e1\u30fc\u30b8\u3092\u30b3\u30d4\u30fc:\n\n```sh\ndiskutil unmountDisk /dev/diskN  # USB \u30e1\u30e2\u30ea\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\nsudo dd if=./coreos_production_iso_image.iso of=/dev/diskN bs=1m  # dd \u3067 ISO \u3092 USB \u30e1\u30e2\u30ea\u306b\u30b3\u30d4\u30fc\n```\n\n* [Installing to Disk](https://coreos.com/docs/running-coreos/bare-metal/installing-to-disk/)\n\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n### cloud-config \u306e\u4f5c\u6210\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306e\u8a2d\u5b9a\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b `cloud-config.yml` \u3092\u4f5c\u6210\u3059\u308b\u3002CentOS \u306b\u304a\u3051\u308b `ks.cfg` \u307f\u305f\u3044\u306a\u3082\u306e\u304b\u3002\n\nSSH \u9375 `coreos_key` \u30da\u30a2\u3092\u4f5c\u6210:\n\n```\nssh-keygen -t rsa -C anony@foo.bar -f ./coreos_key\n```\n\n\u516c\u958b\u9375 `coreos_key.pub` \u306e\u6587\u5b57\u5217\u3092\u30b3\u30d4\u30fc\u3057\u3066 `cloud-config.yml` \u306b\u4f7f\u7528:\n\n```\ncat ./coreos_key.pub | pbcopy\n```\n\n`cloud-config.yml` \u3092\u4f5c\u6210:\n\n```\ntouch ./cloud-config.yml\n```\n\n```yaml:cloud-config.yml\n#cloud-config\n\ncoreos:\n  units:\n    - name: etcd.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: docker.service\n      command: start\n\n    # \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092 JST \u306b\u8a2d\u5b9a\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n\n    # \u56fa\u5b9a IP \u306e\u8a2d\u5b9a\u8ffd\u52a0\n    - name: 10-static.network\n      runtime: false\n      content: |\n        [Match]\n        Name=eno1\n        [Network]\n        Address=192.168.0.98/24\n        Gateway=192.168.0.1\n        DNS=192.168.0.1\n\n    # NFS \u81ea\u52d5\u30de\u30a6\u30f3\u30c8\u306e\u8a2d\u5b9a\u8ffd\u52a0\n    - name: media-myvolume.mount\n      command: start\n      content: |\n        [Mount]\n        What=192.168.0.88:/var\n        Where=/media/myvolume\n        Type=nfs\n        Options=nolock\n\n  update:\n    - reboot-strategy: best-effort\n\nssh_authorized_keys:\n    # \u7ba1\u7406\u30e6\u30fc\u30b6\u30fc core \u306e\u516c\u958b\u9375\u3002coreos_key.pub \u306e\u6587\u5b57\u5217\u3092\u4f7f\u7528\n    - ssh-rsa AAAAB3NzaC[...] anony@foo.bar\n\nhostname: coreos  # \u30db\u30b9\u30c8\u540d\u3092\u9069\u5f53\u306b\u6307\u5b9a\n\nmanage_etc_hosts: localhost  # \u30ed\u30fc\u30ab\u30eb\u306e\u540d\u524d\u89e3\u6c7a\u7528\n```\n\n* [Customize with Cloud-Config](https://coreos.com/docs/cluster-management/setup/cloudinit-cloud-config/)\n* [Network Configuration](https://coreos.com/docs/cluster-management/setup/network-config-with-networkd/)\n* [Mounting Storage](https://coreos.com/docs/cluster-management/setup/mounting-storage/)\n\n\n### USB \u30e1\u30e2\u30ea\u304b\u3089\u8d77\u52d5\n\nCoreOS \u306e USB \u30e1\u30e2\u30ea\u304b\u3089 PC \u3092\u8d77\u52d5\u3059\u308b\u3002\u81ea\u52d5\u3067 `core` \u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b:\n\n```\nlocalhost login: core (automatic login)\nCoreOS (stable)\nUpdate Strategy: No Reboots\ncore@localhost ~ $\n```\n\n\u30b5\u30fc\u30d0\u30fc\u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3059\u308b:\n\n```\nip add show\n```\n\n```\neno1: flags=4163<UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST> mtu 1500 \n\tinet 192.168.0.98 netmask 255.255.255.0 broadcast 192.168.1.255\n```\n\n\u4e00\u6642\u7684\u306b `core` \u30e6\u30fc\u30b6\u30fc\u306b\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b:\n\n```\nsudo passwd core\n```\n\n\u8a2d\u5b9a\u3057\u305f\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u4f5c\u6210\u3057\u305f `cloud-config.yml` \u3092\u4f5c\u696d PC \u304b\u3089\u30b5\u30fc\u30d0\u30fc\u306b\u8ee2\u9001\u3059\u308b:\n\n```\nscp ./cloud-config.yml core@192.168.0.98:~\n```\n\n\n### \u5b9f\u969b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u30b5\u30fc\u30d0\u30fc\u3067\u5b9f\u884c\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b:\n\n```\nsudo coreos-install -d /dev/sda -C stable -c ~/cloud-config.yml\n```\n\n* `/dev/sda` \u306f\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u8aad\u307f\u5909\u3048\u308b\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u518d\u8d77\u52d5\u3059\u308b:\n\n```\nsudo reboot\n```\n\n## \u63a5\u7d9a\u78ba\u8a8d\n\n\u4f5c\u696d PC \u304b\u3089 SSH \u9375 `coreos_key` \u3092\u7528\u3044\u3066 CoreOS \u30b5\u30fc\u30d0\u30fc\u3078 SSH \u63a5\u7d9a\u3067\u304d\u308b\u304b\u78ba\u8a8d\u3059\u308b:\n\n```\nssh -i ./coreos_key core@192.168.0.98\n```\n\n\u3061\u306a\u307f\u306b `cloud-config.yml` \u306e\u8a2d\u5b9a\u306f `/var/lib/coreos-install/user_data` \u3092\u66f4\u65b0\u3059\u308b\u4e8b\u3067\u5909\u66f4\u304c\u53ef\u80fd\u3002\u8a2d\u5b9a\u306e\u66f4\u65b0\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3053\u3061\u3089\u304b\u3089\u3002\n\n\u63a5\u7d9a\u3067\u304d\u305f\u3089\u5b8c\u4e86\u3002\u4ee5\u964d\u306f SSH \u7d4c\u7531\u306e\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067 Docker \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\n# Vagrant \u3067 CoreOS \u3092\u5b9f\u884c\n\n\u3061\u3087\u3063\u3068\u5bc4\u308a\u9053\u3067\u3001\u7269\u7406\u30b5\u30fc\u30d0\u30fc\u3067\u306f\u306a\u304f Vagrant \u3067 CoreOS \u3092\u8d77\u52d5\u3059\u308b\u65b9\u6cd5\u3082\u66f8\u3044\u3066\u304a\u304f\u3002\n\nCoreOS \u304c\u516c\u5f0f\u306b `Vagrantfile` \u3092\u516c\u958b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3092\u5229\u7528\u3059\u308b\u3002\n\nCoreOS \u306e GitHub \u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089 `Vagrantfile` \u4e00\u5f0f\u3092\u30af\u30ed\u30fc\u30f3\u3059\u308b:\n\n```\ngit clone https://github.com/coreos/coreos-vagrant.git\ncd ./coreos-vagrant\n```\n\n\u3042\u3068\u306f\u666e\u901a\u306b Vagrant \u306e\u624b\u9806\u3067\u3059:\n\n```\nvagrant up\nvagrant ssh\n```\n\n* [Running CoreOS on Vagrant](https://coreos.com/docs/running-coreos/platforms/vagrant/)\n\n\n# Docker \u3067 \"Hello, world.\"\n\n\u3053\u3053\u304b\u3089 Docker \u306e\u8a71\u3002CoreOS \u306b SSH \u30ed\u30b0\u30a4\u30f3\u3057\u305f\u72b6\u614b\u3067\u4f5c\u696d\u3059\u308b\u3002\n\n\u307e\u305a\u306f\u7c21\u5358\u306b Docker \u306e\u52d5\u4f5c\u78ba\u8a8d\u3067\u3001\u65e2\u5b58\u306e\u30b3\u30f3\u30c6\u30ca\u304b\u3089 `echo` \u30b3\u30de\u30f3\u30c9\u3092\u53e9\u3044\u3066 \"Hello, world.\" \u3068\u8868\u793a\u3057\u3066\u307f\u308b\u3002\n\n\n## \u30a4\u30e1\u30fc\u30b8\u306e\u53d6\u5f97\n\n\u307e\u305a [Docker Hub](https://registry.hub.docker.com/) \u3068\u3044\u3046\u516c\u5f0f\u306e\u30a4\u30e1\u30fc\u30b8\u5171\u6709\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d3\u30b9\u304b\u3089 CentOS \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\u3059\u308b\u3002\u5c1a\u3001\u4e88\u3081 Docker Hub \u3067\u30e6\u30fc\u30b6\u30fc\u767b\u9332\u3092\u3057\u3066\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u3066\u304a\u304f\u3002\n\nDocker Hub \u3078\u30ed\u30b0\u30a4\u30f3\u3059\u308b:\n\n```\ndocker login\n```\n\nCentOS \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u691c\u7d22\u3059\u308b:\n\n```\ndocker search centos\n```\n\n```\nNAME                                DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\ncentos                              The official build of CentOS.                   764       [OK]       \nansible/centos7-ansible             Ansible on Centos7                              27                   [OK]\ntutum/centos                        Centos image with SSH access. For the root...   12                   [OK]\nblalor/centos                       Bare-bones base CentOS 6.5 image                8                    [OK]\n[...]\n```\n\n\u691c\u7d22\u7d50\u679c\u306e\u4e00\u756a\u4e0a `centos` \u304c\u516c\u5f0f\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u6700\u65b0\u7248 (`centos:latest`) \u3092\u53d6\u5f97\u3059\u308b:\n\n```\ndocker pull centos:latest\n```\n\n\n## \u30b3\u30f3\u30c6\u30ca\u306e\u751f\u6210\n\nDocker Hub \u7b49\u304b\u3089\u53d6\u5f97\u3057\u3066\u304d\u305f\u30db\u30b9\u30c8\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u4e00\u89a7\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3067\u304d\u308b:\n\n```\ndocker images\n```\n\n```\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\ncentos              7                   8efe422e6104        2 weeks ago         224 MB\ncentos              centos7             8efe422e6104        2 weeks ago         224 MB\ncentos              latest              8efe422e6104        2 weeks ago         224 MB\n```\n\n* `centos` \u306e\u30a4\u30e1\u30fc\u30b8\u304c 3 \u3064\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u308c\u306f `IMAGE ID` \u304c\u793a\u3059\u901a\u308a\u540c\u4e00\u306e\u30a4\u30e1\u30fc\u30b8\u3002\u30bf\u30b0\u306e\u9055\u3044\u304b\u3089 3 \u3064\u8868\u793a\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u4e0a\u8a18 `centos:latest` \u30a4\u30e1\u30fc\u30b8\u4e0a\u3067 `echo` \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u308b:\n\n```\ndocker run centos:latest echo 'Hello, world.'\n```\n\n```\nHello, world.\n```\n\n\u4e0a\u8a18\u306e\u901a\u308a `Hello, world.` \u3068\u6a19\u6e96\u51fa\u529b\u304c\u8fd4\u3055\u308c\u308b\u306f\u305a\u3002\n\n\u3053\u308c\u306f `centos:latest` \u30a4\u30e1\u30fc\u30b8\u3092\u5143\u306b\u3001`echo 'Hello, world.'` \u3092\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u751f\u6210\u3057\u305f\u4e8b\u306b\u306a\u308b\u3002\n\n\u5c1a\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u5b9f\u884c\u304c\u7d42\u4e86\u3057\u3066\u3082\u524a\u9664\u3055\u308c\u306a\u3044\u3002\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u7d42\u4e86\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u304c\u6b8b\u3063\u3066\u3044\u308b\u306e\u304c\u5206\u304b\u308b:\n\n```\ncore@coreos ~ $ docker ps -a\nCONTAINER ID        IMAGE                        COMMAND                CREATED             STATUS                       PORTS                                          NAMES\nbab4118699d3        centos:7                     \"echo 'Hello, world.   7 seconds ago       Exited (0) 6 seconds ago                                                    trusting_elion\n```\n\n\u3053\u308c\u306f\u660e\u793a\u7684\u306b\u524a\u9664\u3059\u308b\u307e\u3067\u3001\u3044\u3064\u307e\u3067\u3082\u6b8b\u308b\u3002\u524a\u9664\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3059\u308b:\n\n```\ncore@coreos ~ $ docker rm bab4118699d3\nbab4118699d3\n```\n\n\n### \u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u5b9f\u884c\n\n* [Foreground - Run Reference - Docker Documentation](http://docs.docker.com/reference/run/#foreground)\n\n```\ncore@coreos ~ $ docker run -i -t --rm=true centos:latest sh\nsh-4.2# echo 'Hello, world.'\nHello, world.\nsh-4.2# exit\nexit\ncore@coreos ~ $ \n```\n\n* `-i` (`--interactive=true`) \u6a19\u6e96\u51fa\u529b\u53d7\u3051\u4ed8\u3051\u306e\u7dad\u6301\n* `-t` (`--tty=true`) \u7591\u4f3c TTY \u306e\u5272\u308a\u5f53\u3066\n* `--rm=true` \u7d42\u4e86\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u52d5\u524a\u9664\n\n\n### \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\n\n* [Detached (-d) - Run Reference - Docker Documentation](http://docs.docker.com/reference/run/#detached-d)\n\n```\ncore@coreos ~ $ docker run -d centos:latest sh -c \"while true; do echo \\\"Hello, world.\\\"; sleep 1; done\"\nae101d4eb9eaa8cc43a6789fa8752825cb43df8e6e9a11093d44f5ebe61bb96c\n```\n\n* `-d` (`--detach=true`) \u30b3\u30f3\u30c6\u30ca\u3092\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u3067\u5b9f\u884c\u3057\u3001\u30b3\u30f3\u30c6\u30ca ID \u3092\u8fd4\u3059\n\n`docker ps` \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u30d7\u30ed\u30bb\u30b9\u4e00\u89a7\u3092\u53d6\u5f97\u3059\u308b:\n\n```\ncore@coreos ~ $ docker ps\nCONTAINER ID        IMAGE                        COMMAND                CREATED              STATUS              PORTS                    NAMES\nae101d4eb9ea        centos:7                     \"\\\"sh -c 'while true   About a minute ago   Up About a minute                            hungry_shockley\n```\n\n`docker logs` \u306b\u30d7\u30ed\u30bb\u30b9\u306e `NAME` \u3092\u6307\u5b9a\u3057\u3066\u51fa\u529b\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b:\n\n```\ncore@coreos ~ $ docker logs hungry_shockley\nHello, world.\nHello, world.\nHello, world.\n```\n\n`docker stop` \u306b\u30d7\u30ed\u30bb\u30b9\u306e `NAME` \u3092\u6307\u5b9a\u3057\u3066\u7d42\u4e86\u3055\u305b\u308b:\n\n```\ncore@coreos ~ $ docker stop hungry_shockley\nhungry_shockley\n```\n\n`docker rm` \u306b `CONTAINER ID` \u3092\u6307\u5b9a\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u524a\u9664\u3059\u308b:\n\n```\ncore@coreos ~ $ docker rm ae101d4eb9ea\nae101d4eb9ea\n```\n\n\n# Dockerfile \u306e\u5229\u7528\n\n\u65e2\u5b58\u306e `centos` \u30a4\u30e1\u30fc\u30b8\u4e0a\u3067\u69d8\u3005\u306a\u30d7\u30ed\u30bb\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u3066\u3001\u305d\u308c\u3092\u30ab\u30b9\u30bf\u30e0\u30a4\u30e1\u30fc\u30b8\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n## CentOS \u30b3\u30f3\u30c6\u30ca\u3067 Apache \u3068 SSH \u3092\u7acb\u3061\u4e0a\u3052\u3066\u307f\u308b\n\n\u307e\u305a\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b `centos` \u30a4\u30e1\u30fc\u30b8\u4e0a\u306b\u81ea\u5206\u306e\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u307e\u3059\u3002\n\n[`centos:centos7` \u306f `systemctl` \u56de\u308a\u306e\u6319\u52d5\u304c\u96e3\u3057\u304b\u3063\u305f](http://qiita.com/yunano/items/9637ee21a71eba197345)\u306e\u3067 `centos:centos6` \u3067\u65e7\u6765\u901a\u308a `service` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u306b\u3057\u307e\u3059\u3002\n\n`centos:centos6` \u30b3\u30f3\u30c6\u30ca\u3092\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u8d77\u52d5\u3057\u307e\u3059:\n\n```\ndocker run -i -t --rm=true centos:centos6 sh\n```\n\n\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30b7\u30a7\u30eb\u306b\u5165\u308b\u3068 `root` \u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u3002\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u6a29\u9650\u306a\u3069\u6c17\u306b\u305b\u305a\u30ac\u30f3\u30ac\u30f3 `root` \u3067\u4f5c\u696d\u3059\u308b\u4e8b\u306b\u3059\u308b\u3002\n\n\u4e0b\u8a18\u624b\u9806\u3067 Apache \u3068 SSH \u74b0\u5883\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059:\n\n```sh\nyum update -y\nyum install -y httpd openssh-server\n\nsed -ri \"s/^#PermitRootLogin yes/PermitRootLogin yes/\" /etc/ssh/sshd_config\nsed -ri \"s/^PasswordAuthentication yes/PasswordAuthentication no/\" /etc/ssh/sshd_config\nsed -ri \"s/^ChallengeResponseAuthentication yes/ChallengeResponseAuthentication no/\" /etc/ssh/sshd_config\nsed -ri \"s/^UsePAM yes/UsePAM no/\" /etc/ssh/sshd_config\n\nmkdir -m 700 /root/.ssh\n\ncat - > /root/.ssh/authorized_keys <<__KEY__\nssh-rsa AAAAB3NzaC[...] anony@foo.bar\n__KEY__\n\nchmod 600 /root/.ssh/authorized_keys\nchown root:root /root/.ssh/authorized_keys\n\nchkconfig httpd on\nchkconfig sshd on\n\nservice httpd start\nservice sshd start\n```\n\n\u3068\u3001\u3053\u3053\u307e\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u3066\u30b5\u30fc\u30d0\u30fc\u306f\u7acb\u3061\u4e0a\u304c\u3063\u305f\u304c\u3001\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3089\u306e\u30b5\u30fc\u30d0\u30fc\u3092\u5916\u90e8\u306b\u516c\u958b\u3059\u308b\u8853\u304c\u5206\u304b\u3089\u306a\u3044...\n\n...\u3068\u3001\u3053\u308c\u306f `docker run` \u3059\u308b\u6642\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u3067\u89e3\u6c7a\u3059\u308b:\n\n```\ndocker run -i -t --rm=true --expose=22,80 -p 10022:22 -p 10080:80 centos:centos6 sh\n```\n\n* `--expose=PORT` \u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5916\u90e8\u516c\u958b\u3092\u8a31\u53ef\u3059\u308b\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3059\u308b\u3002\n* `-p PUBLISHED:EXPOSED` \u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u3067\u5916\u90e8\u516c\u958b\u3092\u8a31\u53ef\u3055\u308c\u305f\u30dd\u30fc\u30c8 `EXPOSED` \u3068\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067\u516c\u958b\u3059\u308b\u306e\u306b\u4f7f\u7528\u3059\u308b\u5272\u308a\u5f53\u3066\u30dd\u30fc\u30c8 `PUBLISHED` \u306e\u5bfe\u3067\u6307\u5b9a\u3059\u308b\u3002 \n\n\u3053\u308c\u3067 \u30b5\u30fc\u30d0\u30fc\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n* [EXPOSE (incoming ports) - Run Reference - Docker Documentation](http://docs.docker.com/reference/run/#expose-incoming-ports)\n\n\n## \u30a4\u30e1\u30fc\u30b8\u5316\u3059\u308b\n\n\u3055\u3066\u3001\u5916\u90e8\u516c\u958b\u306e\u65b9\u6cd5\u3060\u304c\u3001\u3053\u308c\u306f\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u751f\u6210\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001`Dockerfile` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u306b\u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5217\u6319\u3057\u3066\u3001\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u5316\u3059\u308b\u306e\u304c\u30d9\u30b9\u30c8\u3002\n\n\n### Dockerfile \u306e\u4f5c\u6210\n\n\n\u524d\u8ff0\u306e\u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6\u30b7\u30a7\u30eb\u3067\u5b9f\u884c\u3057\u305f\u5185\u5bb9\u3092 `Dockerfile` \u3067\u8868\u73fe\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e 2 \u3064\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308b\u3002\n\n```authorized_keys:authorized_keys\nssh-rsa AAAAB3NzaC[...] anony@foo.bar\n```\n\n```Dockerfile:Dockerfile\nFROM centos:centos6\n\nMAINTAINER Yu I. <yu.inao@facebook.com>\n\nRUN yum update -y\nRUN yum install -y httpd openssh-server\n\nRUN sed -ri \"s/^#PermitRootLogin yes/PermitRootLogin yes/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^PasswordAuthentication yes/PasswordAuthentication no/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^ChallengeResponseAuthentication yes/ChallengeResponseAuthentication no/\" /etc/ssh/sshd_config\nRUN sed -ri \"s/^UsePAM yes/UsePAM no/\" /etc/ssh/sshd_config\n\nRUN mkdir -m 700 /root/.ssh\nADD ./authorized_keys /root/.ssh/authorized_keys\nRUN chmod 600 /root/.ssh/authorized_keys && chown root:root /root/.ssh/authorized_keys\n\nRUN chkconfig httpd on\nRUN chkconfig sshd on\n\nRUN service httpd start\nRUN service sshd start\n\nEXPOSE 22 80\n\nCMD [ \"/sbin/init\" ]\n```\n\n\u3053\u308c\u3089 2 \u3064\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea (\u3053\u3053\u3067\u306f `myimage`) \u306b\u683c\u7d0d\u3059\u308b:\n\n```\n./myimage/\n\u251c\u2500\u2500 Dockerfile\n\u2514\u2500\u2500 authorized_keys\n```\n\n* [Dockerfile - Docker Documentation](https://docs.docker.com/reference/builder/#entrypoint)\n\n\n### \u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u5316\n\n`Dockerfile` \u3092\u66f8\u3044\u305f\u3089\u30d3\u30eb\u30c9\u3057\u3066\u524d\u8ff0\u306e CentOS \u7b49\u3068\u540c\u3058\u304f\u30a4\u30e1\u30fc\u30b8\u5316\u3059\u308b\u3002\n\n\u30d3\u30eb\u30c9\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067:\n\n```\ndocker build -t myimage ./myimage/\n```\n\n* `-t` (`--tag=\"\"`) \u30a4\u30e1\u30fc\u30b8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u540d\u3068\u30bf\u30b0\u540d\u3092\u6307\u5b9a\n\n\u5b8c\u4e86\u3057\u305f\u3089\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30db\u30b9\u30c8\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u306e\u3092\u78ba\u8a8d:\n\n```\ndocker images\n```\n\n\n### \u30a4\u30e1\u30fc\u30b8\u3092\u5b9f\u884c\n\n\u3042\u3068\u306f `centos` \u30a4\u30e1\u30fc\u30b8\u3068\u540c\u69d8\u3001`docker run -d` \u3067\u30d0\u30c3\u30af\u30b0\u30e9\u30f3\u30c9\u5b9f\u884c\u3057\u3066\u3084\u308c\u3070\u826f\u3044\u3002\n\n\u305f\u3060\u3057\u30b3\u30f3\u30c6\u30ca\u306e\u30dd\u30fc\u30c8\u3092\u9069\u5207\u306b\u516c\u958b\u3059\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3059\u308b:\n\n```\ndocker run -d -p 10022:22 -p 10080:80 myimage\n```\n\n* `-p` (`--publish=[]`) \u30db\u30b9\u30c8\u306e\u6307\u5b9a\u30dd\u30fc\u30c8\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u90e8\u306e\u6307\u5b9a\u30dd\u30fc\u30c8\u3092\u516c\u958b\n\n\u3053\u308c\u3067 HTTP \u30b5\u30fc\u30d0\u30fc\u3067\u3042\u308c\u3070\u4e0b\u8a18\u306e\u30a2\u30c9\u30ec\u30b9\u3067\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u306a\u308b:\n\n```\nhttp://192.168.0.98:10080/\n```\n\n\u3064\u304b\u308c\u305f\u3002\n", "tags": ["docker", "vagrant", "CoreOS"]}