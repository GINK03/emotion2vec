{"context": " More than 1 year has passed since last update.\n\n0. \u306f\u3058\u3081\u306b\nGoogle API Client for python\u3067\u306eOAuth\u3068API\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u3002\n\u4eca\u56de\u306fService Account\u3067\u306e\u8a8d\u8a3c\u3067\u3001API\u306fCalendar\u3092\u5bfe\u8c61\u3068\u3057\u307e\u3059\u3002\nGoogle\u516c\u5f0f\u306e\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\u30da\u30fc\u30b8\u3002\nUsing OAuth 2.0 for Server to Server Applications\n\n1. \u4e0b\u6e96\u5099\n\nGoogle API Client\u306e\u53d6\u5f97\n\u3053\u3061\u3089\u3092\u4f7f\u3044\u307e\u3059\u3002\ngoogle/google-api-python-client\npip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ pip install --upgrade google-api-python-client\n\n\nGoogle Developers Console\n\u307e\u305a\u3001Google Developers Console\u3067Service Account\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n[API\u3068\u8a8d\u8a3c]\u2192[API]\u3067Calendar\u3092\u6709\u52b9\u5316 \u203bOAuth\u540c\u610f\u753b\u9762\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304a\u304f\n[API\u3068\u8a8d\u8a3c]\u2192[\u8a8d\u8a3c\u60c5\u5831]\u2192[\u8a8d\u8a3c\u60c5\u5831\u3092\u8ffd\u52a0]\u2192[\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8]\u2192[p12]\u3067\u4f5c\u6210\u3057\u300c~.p12]\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u7ba1\u3057\u3066\u304a\u304f \u203bJSON\u3067\u3082\u53ef\n\n\n\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\n\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\u3067API\u306e\u6a29\u9650\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u203b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u6bce\u306b\u8a2d\u5b9a\u3092\u884c\u308f\u306a\u3044\u3068API\u3092\u4f7f\u3063\u305f\u969b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u306e\u3067\u5fc5\u305a\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\noauth2client.client.AccessTokenRefreshError: access_denied: Requested client not authorized.\n\n\n[\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3]\u2192[\u3082\u3063\u3068\u898b\u308b]\u2192[\u8a73\u7d30\u8a2d\u5b9a]\u2192[API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u3092\u7ba1\u7406\u3059\u308b]\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d]\u306bDevelopers Console\u3067\u4f5c\u6210\u3057\u305f\u300c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u300d\uff08.apps.googleusercontent.com\uff09\u3092\u5165\u529b \u203b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u306f\u306a\u3044\u306e\u3067\u6ce8\u610f\n[1 \u3064\u4ee5\u4e0a\u306e API \u306e\u7bc4\u56f2]\u306b\u300chttps://www.googleapis.com/auth/calendar,https://www.googleapis.com/auth/calendar.readonly\u300d\u3092\u5165\u529b\n\n[\u627f\u8a8d]\u3092\u62bc\u4e0b\n\n\n2. \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4f5c\u6210\n\ngoogle_auth.py\n\nimport json\n\nfrom httplib2 import Http\n\nfrom oauth2client.client import SignedJwtAssertionCredentials\nfrom googleapiclient.discovery import build\n\n# \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nclient_email = '999-xxx@developer.gserviceaccount.com'\n\n# p12\u7248\u306e\u8a8d\u8a3c\nfileName = \"./project.p12\"\n\nwith open(fileName, 'rb') as f:\n    private_key = f.read()\n\ncredentials = SignedJwtAssertionCredentials(client_email, private_key,\n        'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly'\n    ,sub='info@example.com')\n\n# json\u7248\u306e\u8a8d\u8a3c\n#fileName = \"./project.json\"\n#json_key = json.load(open(fileName))\n\n#credentials = SignedJwtAssertionCredentials(json_key['client_email'], json_key['private_key'],\n#   'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly'\n#    ,sub='info@example.com')\n\n\nhttp = Http()\ncredentials.authorize(http)\n\n# Calendar API\nfrom apiclient.discovery import build\n\ncalendar_service = build('calendar', 'v3', http=http)\n\ncalendar_list = calendar_service.calendarList().get(calendarId='info@example.com').execute()\n\nprint calendar_list['summary']\n\n\n\n\u5b9f\u884c\u7d50\u679c\uff09\ninfo@example.com\n\n\u6ce8\u610f\u4e8b\u9805\uff09\n\nSignedJwtAssertionCredentials\u306e\u5f15\u6570\u306bsub='\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9'\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066API\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\n\ngoogleapiclient.errors.HttpError: <HttpError 404 when requesting https://www.googleapis.com/calendar/v3/users/me/calendarList/info%40example.com?alt=json returned \"Not Found\">\n\n\n\u53c2\u8003URL\n\nhttps://developers.google.com/api-client-library/python/auth/service-accounts?hl=ja\nhttp://stackoverflow.com/questions/21407985/google-calendar-api-404-on-calendar-service-account\nhttp://kb.cloudiway.com/errorunauthorized_client-descriptionunauthorized-client-or-scope-in-request-uri/\n\n\u4ee5\u4e0a\u3002\n# 0. \u306f\u3058\u3081\u306b\n\nGoogle API Client for python\u3067\u306eOAuth\u3068API\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u3002\n\u4eca\u56de\u306fService Account\u3067\u306e\u8a8d\u8a3c\u3067\u3001API\u306fCalendar\u3092\u5bfe\u8c61\u3068\u3057\u307e\u3059\u3002\n\nGoogle\u516c\u5f0f\u306e\u8a8d\u8a3c\u306b\u3064\u3044\u3066\u306e\u89e3\u8aac\u30da\u30fc\u30b8\u3002\n[Using OAuth 2.0 for Server to Server Applications](https://developers.google.com/api-client-library/python/auth/service-accounts?hl=ja)\n\n# 1. \u4e0b\u6e96\u5099\n\n## Google API Client\u306e\u53d6\u5f97\n\n\u3053\u3061\u3089\u3092\u4f7f\u3044\u307e\u3059\u3002\n[google/google-api-python-client](https://github.com/google/google-api-python-client)\n\npip\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ pip install --upgrade google-api-python-client\n```\n\n## Google Developers Console\n\n\u307e\u305a\u3001Google Developers Console\u3067Service Account\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n2. [API\u3068\u8a8d\u8a3c]\u2192[API]\u3067Calendar\u3092\u6709\u52b9\u5316 \u203bOAuth\u540c\u610f\u753b\u9762\u306e\u8a2d\u5b9a\u3092\u884c\u3063\u3066\u304a\u304f\n3. [API\u3068\u8a8d\u8a3c]\u2192[\u8a8d\u8a3c\u60c5\u5831]\u2192[\u8a8d\u8a3c\u60c5\u5831\u3092\u8ffd\u52a0]\u2192[\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8]\u2192[p12]\u3067\u4f5c\u6210\u3057\u300c~.p12]\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u7ba1\u3057\u3066\u304a\u304f \u203bJSON\u3067\u3082\u53ef\n\n## \u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb\n\n[\u7ba1\u7406\u30b3\u30f3\u30bd\u30fc\u30eb](https://admin.google.com/)\u3067API\u306e\u6a29\u9650\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u203b\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u6bce\u306b\u8a2d\u5b9a\u3092\u884c\u308f\u306a\u3044\u3068API\u3092\u4f7f\u3063\u305f\u969b\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u306e\u3067\u5fc5\u305a\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\noauth2client.client.AccessTokenRefreshError: access_denied: Requested client not authorized.\n```\n\n1. [\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3]\u2192[\u3082\u3063\u3068\u898b\u308b]\u2192[\u8a73\u7d30\u8a2d\u5b9a]\u2192[API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u3092\u7ba1\u7406\u3059\u308b]\n2. [\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u540d]\u306bDevelopers Console\u3067\u4f5c\u6210\u3057\u305f\u300c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u300d\uff08.apps.googleusercontent.com\uff09\u3092\u5165\u529b \u203b\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u306f\u306a\u3044\u306e\u3067\u6ce8\u610f\n3. [1 \u3064\u4ee5\u4e0a\u306e API \u306e\u7bc4\u56f2]\u306b\u300chttps://www.googleapis.com/auth/calendar,https://www.googleapis.com/auth/calendar.readonly\u300d\u3092\u5165\u529b\n4. [\u627f\u8a8d]\u3092\u62bc\u4e0b\n\n# 2. \u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u4f5c\u6210\n\n```py:google_auth.py\n\nimport json\n\nfrom httplib2 import Http\n\nfrom oauth2client.client import SignedJwtAssertionCredentials\nfrom googleapiclient.discovery import build\n\n# \u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\nclient_email = '999-xxx@developer.gserviceaccount.com'\n\n# p12\u7248\u306e\u8a8d\u8a3c\nfileName = \"./project.p12\"\n\nwith open(fileName, 'rb') as f:\n    private_key = f.read()\n\ncredentials = SignedJwtAssertionCredentials(client_email, private_key,\n        'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly'\n    ,sub='info@example.com')\n\n# json\u7248\u306e\u8a8d\u8a3c\n#fileName = \"./project.json\"\n#json_key = json.load(open(fileName))\n\n#credentials = SignedJwtAssertionCredentials(json_key['client_email'], json_key['private_key'],\n#   'https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.readonly'\n#    ,sub='info@example.com')\n\n\nhttp = Http()\ncredentials.authorize(http)\n\n# Calendar API\nfrom apiclient.discovery import build\n\ncalendar_service = build('calendar', 'v3', http=http)\n\ncalendar_list = calendar_service.calendarList().get(calendarId='info@example.com').execute()\n\nprint calendar_list['summary']\n\n```\n\n\u5b9f\u884c\u7d50\u679c\uff09\n\n```\ninfo@example.com\n```\n\n\u6ce8\u610f\u4e8b\u9805\uff09\n\n1. SignedJwtAssertionCredentials\u306e\u5f15\u6570\u306bsub='\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9'\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u3001\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066API\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u305b\u3093\u3002\n\n```\ngoogleapiclient.errors.HttpError: <HttpError 404 when requesting https://www.googleapis.com/calendar/v3/users/me/calendarList/info%40example.com?alt=json returned \"Not Found\">\n```\n\n## \u53c2\u8003URL\n1. https://developers.google.com/api-client-library/python/auth/service-accounts?hl=ja\n\n2. http://stackoverflow.com/questions/21407985/google-calendar-api-404-on-calendar-service-account\n\n3. http://kb.cloudiway.com/errorunauthorized_client-descriptionunauthorized-client-or-scope-in-request-uri/\n\n\n\u4ee5\u4e0a\u3002\n\n", "tags": ["Python", "googleapi", "OAuth"]}