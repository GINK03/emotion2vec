{"context": " More than 1 year has passed since last update.\u30b5\u30fc\u30d0\u3001\u30b7\u30b9\u30c6\u30e0\u4fdd\u5b88\u3059\u308b\u4e0a\u3067\u76e3\u8996\u306f\u8981\u3067\u3059\u3002\u305f\u3060\u3057\u76e3\u8996\u3059\u308b\u3053\u3068\u81ea\u4f53\u306f\u672c\u8cea\u3067\u306f\u306a\u304f\u3001\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u6642\u306b\u3001\u3044\u304b\u306b\u65e9\u304f\u6c17\u3065\u304d\u30b9\u30e0\u30fc\u30ba\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u304b\u304c\u91cd\u8981\u3067\u3059\u3002\nSensu\u304b\u3089\u30e1\u30fc\u30eb\u3060\u3051\u3058\u3083\u306a\u304f\u3001\u81ea\u793e\u306e\u969c\u5bb3\u5bfe\u5fdc\u7ba1\u7406\u30c4\u30fc\u30eb\u300cReactio\u300d\u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u96fb\u8a71\u3067\u306e\u4e00\u6589\u901a\u77e5\u3068\u30c1\u30e3\u30c3\u30c8\u3067\u306e\u5bfe\u5fdc\u3059\u308b\u65b9\u6cd5\u3092\u5171\u6709\u3057\u307e\u3059\u3002\n\n\u6982\u8981\n\nSense\u306e\u8a2d\u5b9a\n\n\n\u521d\u671f\u8a2d\u5b9a \nhandlers\u306e\u767b\u9332\n\n\nReactio\u306e\u8a2d\u5b9a\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eAPI\u30ad\u30fc\u306e\u767b\u9332\n\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n\n\n\u307e\u3068\u3081\n\n\nSensu\u306e\u8a2d\u5b9a\nSensu\u3068\u306f\uff1f (https://sensuapp.org/)\nRuby\u88fd\u306e\u76e3\u8996\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3002AWS\u306a\u3069\u306e\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u306b\u5f37\u304f\u3001API\u3092\u5229\u7528\u3057\u305f\u5916\u90e8\u9023\u643a\u304c\u5f97\u610f\u3002\n\n\n\u521d\u671f\u8a2d\u5b9a\n\u521d\u671f\u8a2d\u5b9a\u3068\u5404\u7a2e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\uff08\u5272\u611b\uff09\nhttp://qiita.com/spesnova/items/f9a8c9661861cc453ead\n\nhadlers\u306e\u767b\u9332\n\u53c2\u8003\uff09https://sensuapp.org/docs/latest/getting-started-with-handlers\n\nSensu\u306b\u767b\u9332\u3057\u305f\u76e3\u8996\u30ea\u30bd\u30fc\u30b9\u306b\u4e0b\u8a18\u3092\u767b\u9332\n\n\n/etc/sensu/conf.d/reactio_handler.json\n{\n  \"reactio\": {\n    \"api_key\": \"<API\u30ad\u30fc>\",\n    \"organization\": \"demo\"\n  },\n  \"handlers\": {\n    \"reactio\": {\n      \"type\": \"pipe\",\n      \"command\": \"/etc/sensu/handlers/reactio_handler.rb\",\n      \"serverities\": [\"critical\"]\n    }\n  }\n}\n\n\n\nReactio\u306e\u8a2d\u5b9a\nReactio\u3068\u306f\uff1f (https://reactio.jp)\n\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u3067\u691c\u77e5\u3057\u305f\u969c\u5bb3\u5bfe\u5fdc\u3092\u3001\u8fc5\u901f\u306b\u884c\u3044\u5bfe\u5fdc\u304c\u305d\u306e\u307e\u307e\u8a18\u9332\u3055\u308c\u7ba1\u7406\u3067\u304d\u308b\u30c4\u30fc\u30eb\u3002\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eAPI\u30ad\u30fc\u306e\u767b\u9332\n\u672c\u5bb6\u306e\u30d6\u30ed\u30b0\u3092\u53c2\u8003\uff08\u5272\u611b\uff09\nhttp://blog.reactio.jp/entry/2015/05/26/161408\n\n\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\nreactio\u306eRuby\u7248API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5229\u7528\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u308b\n\u53c2\u8003\uff09http://blog.reactio.jp/entry/2015/05/13/172036\n\nreactio_handler.rb\n#!/usr/bin/env ruby\n#\n# Sensu Reactio Handler\n# ===\n\nrequire 'rubygems' if RUBY_VERSION < '1.9.0'\nrequire 'sensu-handler'\nrequire 'reactio'\nrequire 'timeout'\nrequire 'json'\n\nclass ReactioHandler < Sensu::Handler\n\n  def event_name\n    \"#{@event['client']['name']}/#{@event['check']['name']}\"\n  end\n\n  def handle\n    return unless @event['action'].eql?('create')\n    return unless @event['check']['status'].eql?(2)\n    begin\n      timeout(10) do\n        create_reactio_incident\n        puts \"reactio -- incident #{event_name} created.\"\n      end\n    rescue Timeout::Error\n      puts \"reactio -- timed out while attempting to #{@event['action']} a incident -- #{event_name}\"\n    end\n  end\n\n  private\n\n    def create_reactio_incident\n      reactio.create_incident(\n        \"#{event_name} #{@event['check']['output']}\",\n        detection: 'internal',\n        notification_text: '\u5bfe\u5fdc\u3092\u304a\u9858\u3044\u3057\u307e\u3059',\n        notification_call: false\n      )\n    end\n\n    def reactio\n      Reactio::Service.new(\n        api_key: settings['reactio']['api_key'],\n        organization: settings['reactio']['organization']\n      )\n    end\nend\n\n\n\u4ee5\u4e0a\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5b8c\u4e86\u3067\u3059\u3002\n\n\u307e\u3068\u3081\n\n\u5b9f\u969b\u306b\u969c\u5bb3\u304c\u8d77\u304d\u305f\u6642\u306e\u6d41\u308c\n\n\u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306b\u554f\u984c\u304c\u767a\u751f\nSensu\u306b\u3066\u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u691c\u77e5\u3057\u3066\u3001\u30a2\u30e9\u30fc\u30c8\u767a\u5831\n\n\n\u30e1\u30fc\u30eb\u306b\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u53d7\u4fe1\nReactio\u306eAPI\u3067\u81ea\u52d5\u3067\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\n\n\nReactio\u3067\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u767b\u9332\n\n\n\u4e00\u6589\u901a\u77e5\u6a5f\u80fd\u3067\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u95a2\u4fc2\u8005\u306b\u96fb\u8a71\u901a\u77e5\uff08\u97f3\u58f0\u8aad\u307f\u4e0a\u3052\uff09\n\n\nReactio\u306e\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b\u96c6\u7d50\u3057\u3066\u969c\u5bb3\u5bfe\u5fdc\n\u901a\u77e5\u5148\u3001\u901a\u77e5\u5185\u5bb9\u3001\u30c1\u30e3\u30c3\u30c8\u306e\u4f1a\u8a71\u3059\u3079\u3066\u304c\u8a18\u9332\u3055\u308c\u308b\n\n\u30b5\u30fc\u30d0\u3001\u30b7\u30b9\u30c6\u30e0\u4fdd\u5b88\u3059\u308b\u4e0a\u3067\u76e3\u8996\u306f\u8981\u3067\u3059\u3002\u305f\u3060\u3057\u76e3\u8996\u3059\u308b\u3053\u3068\u81ea\u4f53\u306f\u672c\u8cea\u3067\u306f\u306a\u304f\u3001\u969c\u5bb3\u304c\u767a\u751f\u3057\u305f\u6642\u306b\u3001\u3044\u304b\u306b\u65e9\u304f\u6c17\u3065\u304d\u30b9\u30e0\u30fc\u30ba\u306b\u5bfe\u5fdc\u3067\u304d\u308b\u304b\u304c\u91cd\u8981\u3067\u3059\u3002\n\n\nSensu\u304b\u3089\u30e1\u30fc\u30eb\u3060\u3051\u3058\u3083\u306a\u304f\u3001\u81ea\u793e\u306e\u969c\u5bb3\u5bfe\u5fdc\u7ba1\u7406\u30c4\u30fc\u30eb\u300cReactio\u300d\u3068\u3044\u3046\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u96fb\u8a71\u3067\u306e\u4e00\u6589\u901a\u77e5\u3068\u30c1\u30e3\u30c3\u30c8\u3067\u306e\u5bfe\u5fdc\u3059\u308b\u65b9\u6cd5\u3092\u5171\u6709\u3057\u307e\u3059\u3002\n\n# \u6982\u8981\n\n- Sense\u306e\u8a2d\u5b9a\n - \u521d\u671f\u8a2d\u5b9a \n - handlers\u306e\u767b\u9332\n- Reactio\u306e\u8a2d\u5b9a\n - \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eAPI\u30ad\u30fc\u306e\u767b\u9332\n - \u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n- \u307e\u3068\u3081\n\n# Sensu\u306e\u8a2d\u5b9a\n\nSensu\u3068\u306f\uff1f (https://sensuapp.org/)\nRuby\u88fd\u306e\u76e3\u8996\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3002AWS\u306a\u3069\u306e\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u306b\u5f37\u304f\u3001API\u3092\u5229\u7528\u3057\u305f\u5916\u90e8\u9023\u643a\u304c\u5f97\u610f\u3002\n\n![Screen Shot 2015-06-08 at 11.52.18 AM.png](https://qiita-image-store.s3.amazonaws.com/0/9416/bb0d5fa4-b81b-e7fa-1c38-5fbb936830b5.png)\n\n\n## \u521d\u671f\u8a2d\u5b9a\n\n\u521d\u671f\u8a2d\u5b9a\u3068\u5404\u7a2e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306f\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\uff08\u5272\u611b\uff09\nhttp://qiita.com/spesnova/items/f9a8c9661861cc453ead\n\n\n## hadlers\u306e\u767b\u9332\n\n\u53c2\u8003\uff09https://sensuapp.org/docs/latest/getting-started-with-handlers\n\n- Sensu\u306b\u767b\u9332\u3057\u305f\u76e3\u8996\u30ea\u30bd\u30fc\u30b9\u306b\u4e0b\u8a18\u3092\u767b\u9332\n\n```lang:/etc/sensu/conf.d/reactio_handler.json \n{\n  \"reactio\": {\n    \"api_key\": \"<API\u30ad\u30fc>\",\n    \"organization\": \"demo\"\n  },\n  \"handlers\": {\n    \"reactio\": {\n      \"type\": \"pipe\",\n      \"command\": \"/etc/sensu/handlers/reactio_handler.rb\",\n      \"serverities\": [\"critical\"]\n    }\n  }\n}\n```\n\n# Reactio\u306e\u8a2d\u5b9a\n\nReactio\u3068\u306f\uff1f (https://reactio.jp)\n\u76e3\u8996\u30b7\u30b9\u30c6\u30e0\u3067\u691c\u77e5\u3057\u305f\u969c\u5bb3\u5bfe\u5fdc\u3092\u3001\u8fc5\u901f\u306b\u884c\u3044\u5bfe\u5fdc\u304c\u305d\u306e\u307e\u307e\u8a18\u9332\u3055\u308c\u7ba1\u7406\u3067\u304d\u308b\u30c4\u30fc\u30eb\u3002\n\n![Screen Shot 2015-06-08 at 11.50.58 AM.png](https://qiita-image-store.s3.amazonaws.com/0/9416/16865cea-824e-f5d1-ee6a-db77e8cbaed6.png)\n\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306eAPI\u30ad\u30fc\u306e\u767b\u9332\n\n\u672c\u5bb6\u306e\u30d6\u30ed\u30b0\u3092\u53c2\u8003\uff08\u5272\u611b\uff09\nhttp://blog.reactio.jp/entry/2015/05/26/161408\n\n## \u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f5c\u6210\n\nreactio\u306eRuby\u7248API\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5229\u7528\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u308b\n\u53c2\u8003\uff09http://blog.reactio.jp/entry/2015/05/13/172036\n\n```lang:reactio_handler.rb\n#!/usr/bin/env ruby\n#\n# Sensu Reactio Handler\n# ===\n\nrequire 'rubygems' if RUBY_VERSION < '1.9.0'\nrequire 'sensu-handler'\nrequire 'reactio'\nrequire 'timeout'\nrequire 'json'\n\nclass ReactioHandler < Sensu::Handler\n\n  def event_name\n    \"#{@event['client']['name']}/#{@event['check']['name']}\"\n  end\n\n  def handle\n    return unless @event['action'].eql?('create')\n    return unless @event['check']['status'].eql?(2)\n    begin\n      timeout(10) do\n        create_reactio_incident\n        puts \"reactio -- incident #{event_name} created.\"\n      end\n    rescue Timeout::Error\n      puts \"reactio -- timed out while attempting to #{@event['action']} a incident -- #{event_name}\"\n    end\n  end\n\n  private\n\n    def create_reactio_incident\n      reactio.create_incident(\n        \"#{event_name} #{@event['check']['output']}\",\n        detection: 'internal',\n        notification_text: '\u5bfe\u5fdc\u3092\u304a\u9858\u3044\u3057\u307e\u3059',\n        notification_call: false\n      )\n    end\n\n    def reactio\n      Reactio::Service.new(\n        api_key: settings['reactio']['api_key'],\n        organization: settings['reactio']['organization']\n      )\n    end\nend\n```\n\n\u4ee5\u4e0a\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5b8c\u4e86\u3067\u3059\u3002\n\n\n# \u307e\u3068\u3081\n\n## \u5b9f\u969b\u306b\u969c\u5bb3\u304c\u8d77\u304d\u305f\u6642\u306e\u6d41\u308c\n\n1. \u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306b\u554f\u984c\u304c\u767a\u751f\n2. Sensu\u306b\u3066\u76e3\u8996\u5bfe\u8c61\u30b5\u30fc\u30d0\u306e\u72b6\u614b\u3092\u691c\u77e5\u3057\u3066\u3001\u30a2\u30e9\u30fc\u30c8\u767a\u5831\n    3. \u30e1\u30fc\u30eb\u306b\u3066\u30a2\u30e9\u30fc\u30c8\u3092\u53d7\u4fe1\n    4. Reactio\u306eAPI\u3067\u81ea\u52d5\u3067\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u4f5c\u6210\n5. Reactio\u3067\u30a4\u30f3\u30b7\u30c7\u30f3\u30c8\u767b\u9332\n    6. \u4e00\u6589\u901a\u77e5\u6a5f\u80fd\u3067\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u95a2\u4fc2\u8005\u306b\u96fb\u8a71\u901a\u77e5\uff08\u97f3\u58f0\u8aad\u307f\u4e0a\u3052\uff09\n7. Reactio\u306e\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b\u96c6\u7d50\u3057\u3066\u969c\u5bb3\u5bfe\u5fdc\n8. \u901a\u77e5\u5148\u3001\u901a\u77e5\u5185\u5bb9\u3001\u30c1\u30e3\u30c3\u30c8\u306e\u4f1a\u8a71\u3059\u3079\u3066\u304c\u8a18\u9332\u3055\u308c\u308b\n\n\n\n\n\n\n\n", "tags": ["Sensu", "\u969c\u5bb3\u5bfe\u5fdc\u65b9\u6cd5", "\u76e3\u8996", "Reactio"]}