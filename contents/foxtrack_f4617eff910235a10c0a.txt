{"context": "\u524d\u56de\u8a18\u4e8bAWS SES\u3067\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u3057\u3066S3\u3078\u4fdd\u7ba1\u3057\u3066\u307f\u308b \u306e\u7d9a\u304d\u3067\u3059\u3002\n\u524d\u56de\u306fSES\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u3092S3\u3078\u4fdd\u7ba1\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3084\u308a\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fS3\u306b\u4fdd\u7ba1\u3057\u305f\u30e1\u30fc\u30eb\u3092\u8aad\u3093\u3067\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30e1\u30fc\u30eb\u306e\u4e2d\u8eab\n[\u30e1\u30fc\u30eb\u30d8\u30c3\u30c0\u7701\u7565]\nContent-Type: text/plain; charset=\"iso-2022-jp\"\n\nContent-Transfer-Encoding: 7bit\n\nMIME-Version: 1.0\n\nX-PHP-Qdmail: version-1.2.6b The_MIT_License http://hal456.net/qdmail PHPver 5.2.17\n\n    send-by MailFunction\n\n$BEl6h!!9aDG>HMU!!#3CzL\\#4HVIU6a$GL}O31L$N$?$a>CKIBb$,=PF0$7$F$$$^$9!#(B\n----------------------\n$B!~G[?.%(%j%\"$N>\\:Y@_Dj$dG[?.;~4VBS$NJQ99!\"$*$h$SG[?.$N2r=|$O$3$A$i\"-(B\nhttp://m119.city.fukuoka.lg.jp\n\n$B!~J!2,;T>CKI6I(B\n$B!|7HBS$+$i$N%\"%/%;%9$O$3$A$i\"-(B\nhttp://119.city.fukuoka.lg.jp/i/\n\n$B!|%Q%=%3%s$+$i$N%\"%/%;%9$O$3$A$i\"-(B\nhttp://119.city.fukuoka.lg.jp/\n\n\u5b9f\u969b\u306bSES\u3067\u53d7\u3051\u53d6\u3063\u305f\u30e1\u30fc\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\u6587\u5b57\u30b3\u30fc\u30c9\u304ciso-2022-jp\u306a\u306e\u3067\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n\u5185\u5bb9\u306f\u798f\u5ca1\u5e02\u6d88\u9632\u60c5\u5831\u30e1\u30fc\u30eb\uff08\u3075\u304f\u3057\u3087\u3046\u3081\u30fc\u308b\uff09\u3067\u3001\u798f\u5ca1\u5e02\u5185\u306e\u533a\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u305d\u306e\u533a\u306b\u6d88\u9632\u8eca\u3084\u6551\u6025\u8eca\u304c\u51fa\u52d5\u3057\u305f\u5834\u5408\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u3068\u3044\u3046\u3084\u3064\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3053\u306e\u30e1\u30fc\u30eb\u3092\u30d1\u30fc\u30b9\u3057\u3066DynamoDB\u3078\u4fdd\u7ba1\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nS3\u306e\u30a4\u30d9\u30f3\u30c8\u8ffd\u52a0\nS3\u306b\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u8ffd\u52a0\u3084\u524a\u9664\u3092\u3055\u308c\u305f\u5834\u5408\u3001\u7279\u5b9a\u306eLambda\u3092\u547c\u3073\u51fa\u3059\u3068\u3044\u3046\u8d85\u4fbf\u5229\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304b\u3089\u300c\u30a4\u30d9\u30f3\u30c8\u300d\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3053\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u4f55\u304b\u3057\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u305f\u5834\u5408[ses]\u3068\u3044\u3046Lambda\u3092\u547c\u3076\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3084\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3001\u7279\u5b9a\u306e\u6761\u4ef6\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u52d5\u3055\u305b\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\nLambda\u3067S3\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u3063\u3066\u304f\u308b\nS3\u304b\u3089\u306e\u901a\u77e5\u3067Lambda\u304c\u8d77\u52d5\u3057\u305f\u5834\u5408\u3001\u30d0\u30b1\u30c3\u30c8\u540d\u3068\u30d5\u30a1\u30a4\u30ebKEY\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\nLambda\u306e\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306f\u3053\u3093\u306a\u611f\u3058\u3067S3\u306e\u5185\u5bb9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\nexports.handler = (event, context, callback) => {\n  var bucket = event.Records[0].s3.bucket.name;\n  var key = event.Records[0].s3.object.key;\n  s3.getObject({\n    Bucket:bucket,\n    Key:key\n  },function(err,data) {\n    //S3\u306b\u4e0a\u304c\u3063\u305f\u5185\u5bb9\u304cdata\u306b\u5165\u308b\n  });\n};\n\n\n\n\u6587\u5b57\u30b3\u30fc\u30c9\nNode.js\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u81ea\u52d5\u5224\u5225\u3068\u81ea\u52d5\u5909\u63db\u3068\u3044\u3046\u65b9\u6cd5\u3092\u4f7f\u3046\u3068\u81ea\u52d5\u3067\u5224\u5225\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u4eca\u56de\u306fiso-2022-jp\u306e\u30e1\u30fc\u30eb\u3057\u304b\u3053\u306a\u3044\u306e\u3067AWS Lambda\u5185\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3059\u308b\u65b9\u6cd5\u306b\u8f09\u3063\u3066\u3044\u305f\u3061\u3087\u3063\u3068\u8352\u6280\u3063\u307d\u3044\u4e8b\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\uff08\u3059\u3054\u3044\u306a\u3053\u308c\uff09\nvar filepath = \"/tmp/filepath\";\nfs.writeFileSync(filepath, \"\u5909\u63db\u5143\u6587\u5b57\u5217\");\nvar exec = require('child_process').exec;\nvar cmd = \"iconv -f iso-2022-jp -t utf-8 \" + filepath;\nvar child = exec(cmd, function(err, stdout, stderr) {\n  # stdout <= \u5909\u63db\u5f8c\u6587\u5b57\u5217\n});\n\ntmp\u306b\u5909\u63db\u5143\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3093\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3061\u3083\u3046\u3093\u3067\u3059\u306d\u30fb\u30fbLambda\u306b\u3053\u3093\u306a\u4f7f\u3044\u65b9\u304c\u3042\u3063\u305f\u3068\u306f\uff08\u3044\u3044\u306e\u304b\u306a\uff1f\uff09\n\u203bAWS\u5074\u306eLambda\u5b9f\u884c\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u591a\u5206\u52d5\u304b\u306a\u304f\u306a\u308b\n\n\u6b63\u898f\u8868\u73fe\u3067\u6b32\u3057\u3044\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057DynamoDB\u306b\u7a81\u3063\u8fbc\u3080\n\u3069\u3053\u306e\u533a\u306e\u3069\u3053\u306e\u8857\u306e\u3069\u3053\u306e\u756a\u5730\u3067\u4f55\u306e\u305f\u3081\u306b\u51fa\u52d5\u3057\u305f\u304b\u3092\u6b63\u898f\u8868\u73fe\u3067\u53d6\u3063\u305f\u5f8c\u3001Unixtime\u3092\u3064\u3051\u3066DynamoDB\u3078PutItem\u3057\u307e\u3057\u305f\u3002\nvar tableName = \"Dispatches\";\nif (stdout.match(/(\u535a\u591a\u533a|\u4e2d\u592e\u533a|\u5357\u533a|\u897f\u533a|\u65e9\u826f\u533a|\u57ce\u5357\u533a|\u6771\u533a)\\s(.+)\\s(.+)\u4ed8\u8fd1\u3067(.+)\u306e\u305f\u3081/g)) {\n  var params = {\n    \"ward\" : RegExp.$1,\n    \"town\" : RegExp.$2,\n    \"street\" : RegExp.$3,\n    \"type\" : RegExp.$4,\n    \"time\" : String(date.getTime())\n  };\n  var dynamoRequest = {\n      \"TableName\" : tableName\n  };\n  dynamoRequest.Item = marshaler.marshalItem(params);\n  dynamo.putItem(dynamoRequest, function (err, data) {\n      if (err) {\n          console.log('err:', JSON.stringify(err, null, 2));\n          context.fail(new Error('putItem query error occured'+ JSON.stringify(dynamoRequest, null, 2)));\n      } else {\n          context.succeed(data);\n      }\n  });\n}\n\n\nDynamoDB\n\n\u7121\u4e8b\u4fdd\u7ba1\u3055\u308c\u305f\u3002\nlambda\u306e\u30b3\u30fc\u30c9\u306fGitHub\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\u524d\u56de\u8a18\u4e8b[AWS SES\u3067\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u3057\u3066S3\u3078\u4fdd\u7ba1\u3057\u3066\u307f\u308b](http://qiita.com/foxtrack/items/435bd6a77a04c23e03f3) \u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u524d\u56de\u306fSES\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u3092S3\u3078\u4fdd\u7ba1\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3084\u308a\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306fS3\u306b\u4fdd\u7ba1\u3057\u305f\u30e1\u30fc\u30eb\u3092\u8aad\u3093\u3067\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u30e1\u30fc\u30eb\u306e\u4e2d\u8eab\n```\n[\u30e1\u30fc\u30eb\u30d8\u30c3\u30c0\u7701\u7565]\nContent-Type: text/plain; charset=\"iso-2022-jp\"\n\nContent-Transfer-Encoding: 7bit\n\nMIME-Version: 1.0\n\nX-PHP-Qdmail: version-1.2.6b The_MIT_License http://hal456.net/qdmail PHPver 5.2.17\n\n\tsend-by MailFunction\n\n\u001b$BEl6h!!9aDG>HMU!!#3CzL\\#4HVIU6a$GL}O31L$N$?$a>CKIBb$,=PF0$7$F$$$^$9!#\u001b(B\n----------------------\n\u001b$B!~G[?.%(%j%\"$N>\\:Y@_Dj$dG[?.;~4VBS$NJQ99!\"$*$h$SG[?.$N2r=|$O$3$A$i\"-\u001b(B\nhttp://m119.city.fukuoka.lg.jp\n\n\u001b$B!~J!2,;T>CKI6I\u001b(B\n\u001b$B!|7HBS$+$i$N%\"%/%;%9$O$3$A$i\"-\u001b(B\nhttp://119.city.fukuoka.lg.jp/i/\n\n\u001b$B!|%Q%=%3%s$+$i$N%\"%/%;%9$O$3$A$i\"-\u001b(B\nhttp://119.city.fukuoka.lg.jp/\n```\n\u5b9f\u969b\u306bSES\u3067\u53d7\u3051\u53d6\u3063\u305f\u30e1\u30fc\u30eb\u306f\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6587\u5b57\u30b3\u30fc\u30c9\u304ciso-2022-jp\u306a\u306e\u3067\u3088\u304f\u308f\u304b\u308a\u307e\u305b\u3093\u3002\n\u5185\u5bb9\u306f\u798f\u5ca1\u5e02\u6d88\u9632\u60c5\u5831\u30e1\u30fc\u30eb\uff08\u3075\u304f\u3057\u3087\u3046\u3081\u30fc\u308b\uff09\u3067\u3001\u798f\u5ca1\u5e02\u5185\u306e\u533a\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u3001\u305d\u306e\u533a\u306b\u6d88\u9632\u8eca\u3084\u6551\u6025\u8eca\u304c\u51fa\u52d5\u3057\u305f\u5834\u5408\u30e1\u30fc\u30eb\u304c\u5c4a\u304f\u3068\u3044\u3046\u3084\u3064\u3067\u3059\u3002\n\u4eca\u56de\u306f\u3053\u306e\u30e1\u30fc\u30eb\u3092\u30d1\u30fc\u30b9\u3057\u3066DynamoDB\u3078\u4fdd\u7ba1\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# S3\u306e\u30a4\u30d9\u30f3\u30c8\u8ffd\u52a0\nS3\u306b\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u304c\u8ffd\u52a0\u3084\u524a\u9664\u3092\u3055\u308c\u305f\u5834\u5408\u3001\u7279\u5b9a\u306eLambda\u3092\u547c\u3073\u51fa\u3059\u3068\u3044\u3046\u8d85\u4fbf\u5229\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\nS3\u306e\u30d0\u30b1\u30c3\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u304b\u3089\u300c\u30a4\u30d9\u30f3\u30c8\u300d\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n![p1.png](https://qiita-image-store.s3.amazonaws.com/0/142489/f6855375-49c8-aa95-507b-cfd68a92d1dc.png \"p1.png\")\n\n\u4eca\u56de\u306f\u3053\u306e\u30d0\u30b1\u30c3\u30c8\u306b\u4f55\u304b\u3057\u3089\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u305f\u5834\u5408[ses]\u3068\u3044\u3046Lambda\u3092\u547c\u3076\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3084\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u6307\u5b9a\u3057\u3066\u3001\u7279\u5b9a\u306e\u6761\u4ef6\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u52d5\u3055\u305b\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n# Lambda\u3067S3\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u3063\u3066\u304f\u308b\nS3\u304b\u3089\u306e\u901a\u77e5\u3067Lambda\u304c\u8d77\u52d5\u3057\u305f\u5834\u5408\u3001\u30d0\u30b1\u30c3\u30c8\u540d\u3068\u30d5\u30a1\u30a4\u30ebKEY\u3092\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\nLambda\u306e\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306f\u3053\u3093\u306a\u611f\u3058\u3067S3\u306e\u5185\u5bb9\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```\nexports.handler = (event, context, callback) => {\n  var bucket = event.Records[0].s3.bucket.name;\n  var key = event.Records[0].s3.object.key;\n  s3.getObject({\n    Bucket:bucket,\n    Key:key\n  },function(err,data) {\n    //S3\u306b\u4e0a\u304c\u3063\u305f\u5185\u5bb9\u304cdata\u306b\u5165\u308b\n  });\n};\n\n```\n\n# \u6587\u5b57\u30b3\u30fc\u30c9\n\n[Node.js\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u306e\u81ea\u52d5\u5224\u5225\u3068\u81ea\u52d5\u5909\u63db](http://qiita.com/shoma2da/items/c77ec534dd36873d73c9)\u3068\u3044\u3046\u65b9\u6cd5\u3092\u4f7f\u3046\u3068\u81ea\u52d5\u3067\u5224\u5225\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u4eca\u56de\u306fiso-2022-jp\u306e\u30e1\u30fc\u30eb\u3057\u304b\u3053\u306a\u3044\u306e\u3067[AWS Lambda\u5185\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3059\u308b\u65b9\u6cd5](http://www.bokukoko.info/entry/2015/08/30/AWS_Lambda%E5%86%85%E3%81%A7%E6%96%87%E5%AD%97%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%A4%89%E6%8F%9B%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95)\u306b\u8f09\u3063\u3066\u3044\u305f\u3061\u3087\u3063\u3068\u8352\u6280\u3063\u307d\u3044\u4e8b\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\uff08\u3059\u3054\u3044\u306a\u3053\u308c\uff09\n\n```\nvar filepath = \"/tmp/filepath\";\nfs.writeFileSync(filepath, \"\u5909\u63db\u5143\u6587\u5b57\u5217\");\nvar exec = require('child_process').exec;\nvar cmd = \"iconv -f iso-2022-jp -t utf-8 \" + filepath;\nvar child = exec(cmd, function(err, stdout, stderr) {\n  # stdout <= \u5909\u63db\u5f8c\u6587\u5b57\u5217\n});\n```\ntmp\u306b\u5909\u63db\u5143\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3093\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3061\u3083\u3046\u3093\u3067\u3059\u306d\u30fb\u30fbLambda\u306b\u3053\u3093\u306a\u4f7f\u3044\u65b9\u304c\u3042\u3063\u305f\u3068\u306f\uff08\u3044\u3044\u306e\u304b\u306a\uff1f\uff09\n\u203bAWS\u5074\u306eLambda\u5b9f\u884c\u74b0\u5883\u306b\u3088\u3063\u3066\u306f\u591a\u5206\u52d5\u304b\u306a\u304f\u306a\u308b\n\n# \u6b63\u898f\u8868\u73fe\u3067\u6b32\u3057\u3044\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u51fa\u3057DynamoDB\u306b\u7a81\u3063\u8fbc\u3080\n\u3069\u3053\u306e\u533a\u306e\u3069\u3053\u306e\u8857\u306e\u3069\u3053\u306e\u756a\u5730\u3067\u4f55\u306e\u305f\u3081\u306b\u51fa\u52d5\u3057\u305f\u304b\u3092\u6b63\u898f\u8868\u73fe\u3067\u53d6\u3063\u305f\u5f8c\u3001Unixtime\u3092\u3064\u3051\u3066DynamoDB\u3078PutItem\u3057\u307e\u3057\u305f\u3002\n\n```\nvar tableName = \"Dispatches\";\nif (stdout.match(/(\u535a\u591a\u533a|\u4e2d\u592e\u533a|\u5357\u533a|\u897f\u533a|\u65e9\u826f\u533a|\u57ce\u5357\u533a|\u6771\u533a)\\s(.+)\\s(.+)\u4ed8\u8fd1\u3067(.+)\u306e\u305f\u3081/g)) {\n  var params = {\n    \"ward\" : RegExp.$1,\n    \"town\" : RegExp.$2,\n    \"street\" : RegExp.$3,\n    \"type\" : RegExp.$4,\n    \"time\" : String(date.getTime())\n  };\n  var dynamoRequest = {\n      \"TableName\" : tableName\n  };\n  dynamoRequest.Item = marshaler.marshalItem(params);\n  dynamo.putItem(dynamoRequest, function (err, data) {\n      if (err) {\n          console.log('err:', JSON.stringify(err, null, 2));\n          context.fail(new Error('putItem query error occured'+ JSON.stringify(dynamoRequest, null, 2)));\n      } else {\n          context.succeed(data);\n      }\n  });\n}\n```\n\n# DynamoDB\n\n![p2.png](https://qiita-image-store.s3.amazonaws.com/0/142489/b796d75f-1d69-6061-01a0-3a9e4164f050.png \"p2.png\")\n\n\u7121\u4e8b\u4fdd\u7ba1\u3055\u308c\u305f\u3002\n\nlambda\u306e\u30b3\u30fc\u30c9\u306f[GitHub](https://github.com/miyasue/ses)\u306b\u7f6e\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n\n", "tags": ["AWS", "lambda", "DynamoDB", "ses", "S3"]}