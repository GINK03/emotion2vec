{"context": "\n\n\u7d4c\u7def\n\u793e\u4f1a\u4eba\u30b5\u30fc\u30af\u30eb\u3068\u304b\u3067\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u4ee5\u5916\u306e\u4eba\u304c\u3044\u308b\u3088\u3046\u306a\u74b0\u5883\u3060\u3068\u300cTODO\u7ba1\u7406\u306f\u3057\u305f\u3044\u3051\u3069\u3001Slack\u3068\u304b\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u300d\u3068\u3044\u3046\u3053\u3068\u306f\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u3068\u304d\u306bLine\u306e\u30b0\u30eb\u30fc\u30d7\u304b\u3089TODO\u767b\u9332\u3067\u304d\u305f\u3089\u4fbf\u5229\u3060\u306a\u30fc\u3068\u3044\u3046\u767a\u60f3\u306e\u3082\u3068\u3001\n\u899a\u3048\u305f\u3066\u306eGAS\u3067Line\u304b\u3089SpreadSheet\u306bTODO\u3092\u98db\u3070\u3059Bot\u3092\u4f5c\u3063\u305f\u306e\u3067\u7d39\u4ecb\u3067\u3059\u3002\n\n\u30b3\u30fc\u30c9\n// LINE Developers > Basic Information > Channel Access Token \u304b\u3089\u53d6\u5f97\nvar channel_access_token = \"your line bot token\"; \n\nfunction doPost(e) {\n  var posted_json = JSON.parse(e.postData.contents);\n  var events = posted_json.events;\n  events.forEach(function(event) {\n    // \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u5224\u5b9a\n    if (event.message.type != \"text\" || isCommand(event.message.text) == false) {\n      return;\n    }\n\n    var message = doTask(event.message.text);\n\n    var postData = {\n      \"replyToken\" : event.replyToken,\n      \"messages\" : [\n        {\n          \"type\" : \"text\",\n          \"text\" : message\n        }\n      ]\n    };\n\n    var options = {\n      \"method\" : \"post\",\n      \"headers\" : {\n        \"Content-Type\" : \"application/json\",\n        \"Authorization\" : \"Bearer \" + channel_access_token\n      },\n      \"payload\" : JSON.stringify(postData)\n    };\n\n    var reply = UrlFetchApp.fetch(\"https://api.line.me/v2/bot/message/reply\", options);\n  });\n};\n\n\n// \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u5224\u5b9a\nfunction isCommand(text) {\n  var isCommnadText = false;\n  var reg =/^bot:[cuh]:/i;\n\n  if (text.match(reg)) {\n    isCommnadText = true;\n  }\n\n  return isCommnadText;\n}\n\n// TODO\u30ea\u30b9\u30c8\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u64cd\u4f5c\nfunction doTask(command) {\n  var spreadsheet = SpreadsheetApp.openByUrl(\"your todo list url\");\n  var sheets = spreadsheet.getSheets();\n  for ( var i in sheets ){\n    if ( sheets[i].getSheetName() == \"TODO\" ) {\n      return orderTask(command, sheets[i])\n    }\n    return;\n  }\n}\n\n// \u547d\u4ee4\u5224\u5b9a\u3068\u5b9f\u884c\nfunction orderTask(command, sheet) {\n  var message = \"\";\n  var order = command.split(\":\");\n  switch(order[1]) {\n    case \"h\":\n      message = showHelp();\n      break;\n    case \"c\":\n      if (order.length != 6) {\n        message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\n[bot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b]\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n      } else {\n        message = addRow(order[2], order[3], order[4], order[5], sheet);\n      }\n      break;\n    case \"u\":\n       if (order.length != 4) {\n        message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\n[bot:u:ID:\u72b6\u614b]\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n       } else {\n         message = updateRow(order[2], order[3], sheet);\n      }\n      break;\n    default:\n      message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\nbot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b\\nbot:u:ID:\u72b6\u614b\\n\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n      break;\n  }\n\n  return message;\n}\n\n// \u65b0\u898f\u8ffd\u52a0\nfunction addRow(person, limit, todo, state, sheetObj) {\n  var lastRow = sheetObj.getLastRow();\n  var lastRowId = sheetObj.getRange(lastRow, 1).getValue();\n\n  if (lastRowId == \"id\") {\n    lastRowId = 0;\n  }\n\n  sheetObj.getRange(lastRow+1, 1).setValue(lastRowId + 1); // id\n  sheetObj.getRange(lastRow+1, 2).setValue(person); // \u62c5\u5f53\u8005\n  sheetObj.getRange(lastRow+1, 3).setValue(limit); // \u671f\u9650\n  sheetObj.getRange(lastRow+1, 4).setValue(todo); // TODO\n  sheetObj.getRange(lastRow+1, 5).setValue(state); // \u72b6\u614b\n\n  return \"ID:\" + (lastRowId+1) + \"\u306b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\";\n}\n\n// \u30b9\u30c6\u30fc\u30bf\u30b9\u66f4\u65b0\nfunction updateRow(id, state, sheetObj) {\n  var lastRow = sheetObj.getLastRow();\n  var lastRowId = sheetObj.getRange(lastRow, 1).getValue();\n  if (id > lastRowId) {\n    return \"\u30bf\u30b9\u30af\u30ea\u30b9\u30c8\u306b\u5b58\u5728\u3057\u306a\u3044ID\u3067\u3059\u3002\\nID:\" + lastRowId + \"\u304c\u6700\u5927\u3067\u3059\u3002\";\n  }\n\n  idNum = Number(id);\n  sheetObj.getRange(idNum+1, 5).setValue(state); // \u72b6\u614b\n\n  return \"ID:\"\u3000 + id + \"\u306e\u72b6\u614b\u3092\u300c\" + state + \"\u300d\u306b\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002\";\n}\n\n// \u30d8\u30eb\u30d7\nfunction showHelp() {\n  return \"bot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b\\nbot:u:ID:\u72b6\u614b\";\n}\n\n\n\n\u611f\u60f3\n\n\u3053\u308c\u3060\u3068\u30b9\u30de\u30db(\u7279\u306b\u30d5\u30ea\u30c3\u30af\u5165\u529b)\u304b\u3089\u5165\u529b\u3057\u3065\u3089\u3044\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306f\u518d\u8003\u306e\u4f59\u5730\u3042\u308a\u3002\n\n\n\u53c2\u8003\n\u5148\u4eba\u306e\u77e5\u6075\u306b\u611f\u8b1d\nLINE Bot\u3092\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u958b\u767a\uff01Google Apps Script\u3068LINE Messaging API\u3092\u4f7f\u3063\u3066\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f\n\u521d\u5fc3\u8005\u304cGAS\u3067Slack Bot\u3092\u3064\u304f\u3063\u3066\u307f\u305f\n## \u7d4c\u7def\n\u793e\u4f1a\u4eba\u30b5\u30fc\u30af\u30eb\u3068\u304b\u3067\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u4ee5\u5916\u306e\u4eba\u304c\u3044\u308b\u3088\u3046\u306a\u74b0\u5883\u3060\u3068\u300cTODO\u7ba1\u7406\u306f\u3057\u305f\u3044\u3051\u3069\u3001Slack\u3068\u304b\u3088\u304f\u308f\u304b\u3089\u306a\u3044\u300d\u3068\u3044\u3046\u3053\u3068\u306f\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u3068\u304d\u306bLine\u306e\u30b0\u30eb\u30fc\u30d7\u304b\u3089TODO\u767b\u9332\u3067\u304d\u305f\u3089\u4fbf\u5229\u3060\u306a\u30fc\u3068\u3044\u3046\u767a\u60f3\u306e\u3082\u3068\u3001\n\u899a\u3048\u305f\u3066\u306eGAS\u3067Line\u304b\u3089SpreadSheet\u306bTODO\u3092\u98db\u3070\u3059Bot\u3092\u4f5c\u3063\u305f\u306e\u3067\u7d39\u4ecb\u3067\u3059\u3002\n\n## \u30b3\u30fc\u30c9\n\n```\n// LINE Developers > Basic Information > Channel Access Token \u304b\u3089\u53d6\u5f97\nvar channel_access_token = \"your line bot token\"; \n\nfunction doPost(e) {\n  var posted_json = JSON.parse(e.postData.contents);\n  var events = posted_json.events;\n  events.forEach(function(event) {\n    // \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u5224\u5b9a\n    if (event.message.type != \"text\" || isCommand(event.message.text) == false) {\n      return;\n    }\n        \n    var message = doTask(event.message.text);\n    \n    var postData = {\n      \"replyToken\" : event.replyToken,\n      \"messages\" : [\n        {\n          \"type\" : \"text\",\n          \"text\" : message\n        }\n      ]\n    };\n    \n    var options = {\n      \"method\" : \"post\",\n      \"headers\" : {\n        \"Content-Type\" : \"application/json\",\n        \"Authorization\" : \"Bearer \" + channel_access_token\n      },\n      \"payload\" : JSON.stringify(postData)\n    };\n    \n    var reply = UrlFetchApp.fetch(\"https://api.line.me/v2/bot/message/reply\", options);\n  });\n};\n\n\n// \u30b3\u30de\u30f3\u30c9\u66f8\u5f0f\u5224\u5b9a\nfunction isCommand(text) {\n  var isCommnadText = false;\n  var reg =/^bot:[cuh]:/i;\n  \n  if (text.match(reg)) {\n    isCommnadText = true;\n  }\n\n  return isCommnadText;\n}\n\n// TODO\u30ea\u30b9\u30c8\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u64cd\u4f5c\nfunction doTask(command) {\n  var spreadsheet = SpreadsheetApp.openByUrl(\"your todo list url\");\n  var sheets = spreadsheet.getSheets();\n  for ( var i in sheets ){\n    if ( sheets[i].getSheetName() == \"TODO\" ) {\n      return orderTask(command, sheets[i])\n    }\n    return;\n  }\n}\n\n// \u547d\u4ee4\u5224\u5b9a\u3068\u5b9f\u884c\nfunction orderTask(command, sheet) {\n  var message = \"\";\n  var order = command.split(\":\");\n  switch(order[1]) {\n    case \"h\":\n      message = showHelp();\n      break;\n    case \"c\":\n      if (order.length != 6) {\n        message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\n[bot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b]\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n      } else {\n        message = addRow(order[2], order[3], order[4], order[5], sheet);\n      }\n      break;\n    case \"u\":\n       if (order.length != 4) {\n        message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\n[bot:u:ID:\u72b6\u614b]\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n       } else {\n         message = updateRow(order[2], order[3], sheet);\n      }\n      break;\n    default:\n      message = \"\u66f8\u5f0f\u306b\u8aa4\u308a\u304c\u3042\u308a\u307e\u3059\u3002\\nbot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b\\nbot:u:ID:\u72b6\u614b\\n\u306e\u5f62\u5f0f\u3067\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\";\n      break;\n  }\n  \n  return message;\n}\n\n// \u65b0\u898f\u8ffd\u52a0\nfunction addRow(person, limit, todo, state, sheetObj) {\n  var lastRow = sheetObj.getLastRow();\n  var lastRowId = sheetObj.getRange(lastRow, 1).getValue();\n  \n  if (lastRowId == \"id\") {\n    lastRowId = 0;\n  }\n  \n  sheetObj.getRange(lastRow+1, 1).setValue(lastRowId + 1); // id\n  sheetObj.getRange(lastRow+1, 2).setValue(person); // \u62c5\u5f53\u8005\n  sheetObj.getRange(lastRow+1, 3).setValue(limit); // \u671f\u9650\n  sheetObj.getRange(lastRow+1, 4).setValue(todo); // TODO\n  sheetObj.getRange(lastRow+1, 5).setValue(state); // \u72b6\u614b\n  \n  return \"ID:\" + (lastRowId+1) + \"\u306b\u30bf\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002\";\n}\n\n// \u30b9\u30c6\u30fc\u30bf\u30b9\u66f4\u65b0\nfunction updateRow(id, state, sheetObj) {\n  var lastRow = sheetObj.getLastRow();\n  var lastRowId = sheetObj.getRange(lastRow, 1).getValue();\n  if (id > lastRowId) {\n    return \"\u30bf\u30b9\u30af\u30ea\u30b9\u30c8\u306b\u5b58\u5728\u3057\u306a\u3044ID\u3067\u3059\u3002\\nID:\" + lastRowId + \"\u304c\u6700\u5927\u3067\u3059\u3002\";\n  }\n  \n  idNum = Number(id);\n  sheetObj.getRange(idNum+1, 5).setValue(state); // \u72b6\u614b\n  \n  return \"ID:\"\u3000 + id + \"\u306e\u72b6\u614b\u3092\u300c\" + state + \"\u300d\u306b\u66f4\u65b0\u3057\u307e\u3057\u305f\u3002\";\n}\n\n// \u30d8\u30eb\u30d7\nfunction showHelp() {\n  return \"bot:c:\u62c5\u5f53\u8005:\u671f\u9650:TODO:\u72b6\u614b\\nbot:u:ID:\u72b6\u614b\";\n}\n\n```\n\n## \u611f\u60f3\n- \u3053\u308c\u3060\u3068\u30b9\u30de\u30db(\u7279\u306b\u30d5\u30ea\u30c3\u30af\u5165\u529b)\u304b\u3089\u5165\u529b\u3057\u3065\u3089\u3044\u306e\u3067\u3001\u30b3\u30de\u30f3\u30c9\u306f\u518d\u8003\u306e\u4f59\u5730\u3042\u308a\u3002\n\n## \u53c2\u8003\n\u5148\u4eba\u306e\u77e5\u6075\u306b\u611f\u8b1d:pray:\n\n[LINE Bot\u3092\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u3067\u958b\u767a\uff01Google Apps Script\u3068LINE Messaging API\u3092\u4f7f\u3063\u3066\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u3092\u4f5c\u3063\u3066\u307f\u305f](http://inside.pixiv.net/entry/2016/11/14/150000)\n[\u521d\u5fc3\u8005\u304cGAS\u3067Slack Bot\u3092\u3064\u304f\u3063\u3066\u307f\u305f](https://tech.camph.net/slack-bot-with-gas/)\n", "tags": ["GoogleAppsScript", "linebot"]}