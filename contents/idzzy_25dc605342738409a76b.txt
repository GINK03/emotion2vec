{"tags": ["openstack", "Cinder"], "context": " More than 1 year has passed since last update.\n\nWhat's this?\nRegion \u9593\u306e Cinder volume \u306e\u79fb\u52d5\n\n[Region1] Cinder upload to Glance\n[Somewhere installed Openstack client tool] Download Glance image from Region1\n[Somewhere installed Openstack client tool] Upload Glance image to Region2\n[Region2] Create Cinder volume from the image\n\n\n[Region1] Initial State\n# cinder list\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n| 64b66381-0068-4d5a-99c3-c59da5792061 | available | admin_vol01  |  1   |     None    |  false   |             |\n+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n# cinder show 64b66381-0068-4d5a-99c3-c59da5792061\n+--------------------------------+--------------------------------------+\n|            Property            |                Value                 |\n+--------------------------------+--------------------------------------+\n|          attachments           |                  []                  |\n|       availability_zone        |                 nova                 |\n|            bootable            |                false                 |\n|           created_at           |      2015-03-20T07:23:22.000000      |\n|      display_description       |                                      |\n|          display_name          |             admin_vol01              |\n|           encrypted            |                False                 |\n|               id               | 64b66381-0068-4d5a-99c3-c59da5792061 |\n|            metadata            |                  {}                  |\n|     os-vol-host-attr:host      |               node-17                |\n| os-vol-mig-status-attr:migstat |                 None                 |\n| os-vol-mig-status-attr:name_id |                 None                 |\n|  os-vol-tenant-attr:tenant_id  |   a8085d1871f847bdb906ef4a28d1bd48   |\n|              size              |                  1                   |\n|          snapshot_id           |                 None                 |\n|          source_volid          |                 None                 |\n|             status             |              available               |\n|          volume_type           |                 None                 |\n+--------------------------------+--------------------------------------+\n\n\n[Region1] Upload Cinder volume to Glance as image\n\nCinder upload to image\n# cinder upload-to-image --disk-format qcow2 --container-format bare 64b66381-0068-4d5a-99c3-c59da5792061 admin_vol01_img\n+---------------------+--------------------------------------+\n|       Property      |                Value                 |\n+---------------------+--------------------------------------+\n|   container_format  |                 bare                 |\n|     disk_format     |                qcow2                 |\n| display_description |                                      |\n|          id         | 64b66381-0068-4d5a-99c3-c59da5792061 |\n|       image_id      | 9c33c6ef-a25b-47f0-bef7-3e5ed6df54c2 |\n|      image_name     |           admin_vol01_img            |\n|         size        |                  1                   |\n|        status       |              uploading               |\n|      updated_at     |      2015-03-20T07:23:22.000000      |\n|     volume_type     |                 None                 |\n+---------------------+--------------------------------------+\n\n\nCheck Glance image\n# glance image-list\n+--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n| ID                                   | Name                                   | Disk Format | Container Format | Size       | Status |\n+--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n| 9c33c6ef-a25b-47f0-bef7-3e5ed6df54c2 | admin_vol01_img                        | qcow2       | bare             | 197120     | active |\n+--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n\n\nDownload from Region1 to Somewhere server installed Openstack client tool\n\nEnv\n$ env | egrep \"OS_REGION_NAME|OS_AUTH_URL|OS_USERNAME\"\nOS_REGION_NAME=RegionOne\nOS_AUTH_URL=http://10.30.0.2:5000/v2.0/\nOS_USERNAME=admin\n\n\nGlance download\n$ glance image-download --file admin_vol01_img_PoC1 admin_vol01_img\n\n$ ls -l admin_vol01_img_PoC1\n-rw-r--r-- 1 root root 197120 Mar 20 16:28 admin_vol01_img_PoC1\n\n\nUpload to Region2 from Somewhere server installed Openstack client tool\n\nEnv\n$ env | egrep \"OS_REGION_NAME|OS_AUTH_URL|OS_USERNAME\"\nOS_REGION_NAME=RegionTwo\nOS_AUTH_URL=http://10.32.37.45:5000/v2.0/\nOS_USERNAME=admin\n\n\nGlance upload (= create from download file)\n$ glance image-create --name admin_vol01_img_PoC1 --disk-format qcow2 --container-format bare --is-public True --file admin_vol01_img_PoC1\n+------------------+--------------------------------------+\n| Property         | Value                                |\n+------------------+--------------------------------------+\n| checksum         | 5789e2a5cabb3007171a45a06e86936f     |\n| container_format | bare                                 |\n| created_at       | 2015-03-20T07:29:58                  |\n| deleted          | False                                |\n| deleted_at       | None                                 |\n| disk_format      | qcow2                                |\n| id               | c56612a0-3bc0-4419-b09b-7db0f9e9b53c |\n| is_public        | True                                 |\n| min_disk         | 0                                    |\n| min_ram          | 0                                    |\n| name             | admin_vol01_img_PoC1                 |\n| owner            | 103cfcfb3a094c3382441d21ccff32b3     |\n| protected        | False                                |\n| size             | 197120                               |\n| status           | active                               |\n| updated_at       | 2015-03-20T07:29:59                  |\n| virtual_size     | None                                 |\n+------------------+--------------------------------------+\n\n\nGlance image list\n$ glance image-list\n+--------------------------------------+----------------------+-------------+------------------+------------+--------+\n| ID                                   | Name                 | Disk Format | Container Format | Size       | Status |\n+--------------------------------------+----------------------+-------------+------------------+------------+--------+\n| c56612a0-3bc0-4419-b09b-7db0f9e9b53c | admin_vol01_img_PoC1 | qcow2       | bare             | 197120     | active |\n+--------------------------------------+----------------------+-------------+------------------+------------+--------+\n\n\n[Region2] Create Cinder volume from the Glance image\n\nCinder create from the image uploaded from different Region\n$ cinder create --image-id c56612a0-3bc0-4419-b09b-7db0f9e9b53c --display-name \"admin_vol11_from_PoC1\" 1\n+---------------------+--------------------------------------+\n|       Property      |                Value                 |\n+---------------------+--------------------------------------+\n|     attachments     |                  []                  |\n|  availability_zone  |                 nova                 |\n|       bootable      |                false                 |\n|      created_at     |      2015-03-20T07:33:13.078943      |\n| display_description |                 None                 |\n|     display_name    |        admin_vol11_from_PoC1         |\n|      encrypted      |                False                 |\n|          id         | 5607c316-6c82-4462-999e-8f7f1bdef1cb |\n|       image_id      | c56612a0-3bc0-4419-b09b-7db0f9e9b53c |\n|       metadata      |                  {}                  |\n|         size        |                  1                   |\n|     snapshot_id     |                 None                 |\n|     source_volid    |                 None                 |\n|        status       |               creating               |\n|     volume_type     |                 None                 |\n+---------------------+--------------------------------------+\n\n\nCinder volume list\n# cinder list\n+--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n|                  ID                  |   Status  |      Display Name     | Size | Volume Type | Bootable | Attached to |\n+--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n| 5607c316-6c82-4462-999e-8f7f1bdef1cb | available | admin_vol11_from_PoC1 |  1   |     None    |   true   |             |\n+--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nCinder Migration to Different Backend\nCinder Migration to Different AZ\nCinder Migration to Different Region\n## What's this?\n\nRegion \u9593\u306e Cinder volume \u306e\u79fb\u52d5\n\n1. [Region1] Cinder upload to Glance\n2. [Somewhere installed Openstack client tool] Download Glance image from Region1\n3. [Somewhere installed Openstack client tool] Upload Glance image to Region2\n4. [Region2] Create Cinder volume from the image\n\n## [Region1] Initial State\n\n    # cinder list\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n    | 64b66381-0068-4d5a-99c3-c59da5792061 | available | admin_vol01  |  1   |     None    |  false   |             |\n    +--------------------------------------+-----------+--------------+------+-------------+----------+-------------+\n\n    # cinder show 64b66381-0068-4d5a-99c3-c59da5792061\n    +--------------------------------+--------------------------------------+\n    |            Property            |                Value                 |\n    +--------------------------------+--------------------------------------+\n    |          attachments           |                  []                  |\n    |       availability_zone        |                 nova                 |\n    |            bootable            |                false                 |\n    |           created_at           |      2015-03-20T07:23:22.000000      |\n    |      display_description       |                                      |\n    |          display_name          |             admin_vol01              |\n    |           encrypted            |                False                 |\n    |               id               | 64b66381-0068-4d5a-99c3-c59da5792061 |\n    |            metadata            |                  {}                  |\n    |     os-vol-host-attr:host      |               node-17                |\n    | os-vol-mig-status-attr:migstat |                 None                 |\n    | os-vol-mig-status-attr:name_id |                 None                 |\n    |  os-vol-tenant-attr:tenant_id  |   a8085d1871f847bdb906ef4a28d1bd48   |\n    |              size              |                  1                   |\n    |          snapshot_id           |                 None                 |\n    |          source_volid          |                 None                 |\n    |             status             |              available               |\n    |          volume_type           |                 None                 |\n    +--------------------------------+--------------------------------------+\n\n\n## [Region1] Upload Cinder volume to Glance as image\n\n#### Cinder upload to image\n\n    # cinder upload-to-image --disk-format qcow2 --container-format bare 64b66381-0068-4d5a-99c3-c59da5792061 admin_vol01_img\n    +---------------------+--------------------------------------+\n    |       Property      |                Value                 |\n    +---------------------+--------------------------------------+\n    |   container_format  |                 bare                 |\n    |     disk_format     |                qcow2                 |\n    | display_description |                                      |\n    |          id         | 64b66381-0068-4d5a-99c3-c59da5792061 |\n    |       image_id      | 9c33c6ef-a25b-47f0-bef7-3e5ed6df54c2 |\n    |      image_name     |           admin_vol01_img            |\n    |         size        |                  1                   |\n    |        status       |              uploading               |\n    |      updated_at     |      2015-03-20T07:23:22.000000      |\n    |     volume_type     |                 None                 |\n    +---------------------+--------------------------------------+\n\n#### Check Glance image\n\n    # glance image-list\n    +--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                                   | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n    | 9c33c6ef-a25b-47f0-bef7-3e5ed6df54c2 | admin_vol01_img                        | qcow2       | bare             | 197120     | active |\n    +--------------------------------------+----------------------------------------+-------------+------------------+------------+--------+\n\n\n## Download from Region1 to Somewhere server installed Openstack client tool\n\n#### Env\n\n    $ env | egrep \"OS_REGION_NAME|OS_AUTH_URL|OS_USERNAME\"\n    OS_REGION_NAME=RegionOne\n    OS_AUTH_URL=http://10.30.0.2:5000/v2.0/\n    OS_USERNAME=admin\n\n#### Glance download\n\n    $ glance image-download --file admin_vol01_img_PoC1 admin_vol01_img\n\n    $ ls -l admin_vol01_img_PoC1\n    -rw-r--r-- 1 root root 197120 Mar 20 16:28 admin_vol01_img_PoC1\n\n\n## Upload to Region2 from Somewhere server installed Openstack client tool\n\n#### Env\n\n    $ env | egrep \"OS_REGION_NAME|OS_AUTH_URL|OS_USERNAME\"\n    OS_REGION_NAME=RegionTwo\n    OS_AUTH_URL=http://10.32.37.45:5000/v2.0/\n    OS_USERNAME=admin\n\n#### Glance upload (= create from download file)\n\n    $ glance image-create --name admin_vol01_img_PoC1 --disk-format qcow2 --container-format bare --is-public True --file admin_vol01_img_PoC1\n    +------------------+--------------------------------------+\n    | Property         | Value                                |\n    +------------------+--------------------------------------+\n    | checksum         | 5789e2a5cabb3007171a45a06e86936f     |\n    | container_format | bare                                 |\n    | created_at       | 2015-03-20T07:29:58                  |\n    | deleted          | False                                |\n    | deleted_at       | None                                 |\n    | disk_format      | qcow2                                |\n    | id               | c56612a0-3bc0-4419-b09b-7db0f9e9b53c |\n    | is_public        | True                                 |\n    | min_disk         | 0                                    |\n    | min_ram          | 0                                    |\n    | name             | admin_vol01_img_PoC1                 |\n    | owner            | 103cfcfb3a094c3382441d21ccff32b3     |\n    | protected        | False                                |\n    | size             | 197120                               |\n    | status           | active                               |\n    | updated_at       | 2015-03-20T07:29:59                  |\n    | virtual_size     | None                                 |\n    +------------------+--------------------------------------+\n\n#### Glance image list\n\n    $ glance image-list\n    +--------------------------------------+----------------------+-------------+------------------+------------+--------+\n    | ID                                   | Name                 | Disk Format | Container Format | Size       | Status |\n    +--------------------------------------+----------------------+-------------+------------------+------------+--------+\n    | c56612a0-3bc0-4419-b09b-7db0f9e9b53c | admin_vol01_img_PoC1 | qcow2       | bare             | 197120     | active |\n    +--------------------------------------+----------------------+-------------+------------------+------------+--------+\n\n### [Region2] Create Cinder volume from the Glance image\n\n#### Cinder create from the image uploaded from different Region\n\n    $ cinder create --image-id c56612a0-3bc0-4419-b09b-7db0f9e9b53c --display-name \"admin_vol11_from_PoC1\" 1\n    +---------------------+--------------------------------------+\n    |       Property      |                Value                 |\n    +---------------------+--------------------------------------+\n    |     attachments     |                  []                  |\n    |  availability_zone  |                 nova                 |\n    |       bootable      |                false                 |\n    |      created_at     |      2015-03-20T07:33:13.078943      |\n    | display_description |                 None                 |\n    |     display_name    |        admin_vol11_from_PoC1         |\n    |      encrypted      |                False                 |\n    |          id         | 5607c316-6c82-4462-999e-8f7f1bdef1cb |\n    |       image_id      | c56612a0-3bc0-4419-b09b-7db0f9e9b53c |\n    |       metadata      |                  {}                  |\n    |         size        |                  1                   |\n    |     snapshot_id     |                 None                 |\n    |     source_volid    |                 None                 |\n    |        status       |               creating               |\n    |     volume_type     |                 None                 |\n    +---------------------+--------------------------------------+\n\n#### Cinder volume list\n\n    # cinder list\n    +--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n    |                  ID                  |   Status  |      Display Name     | Size | Volume Type | Bootable | Attached to |\n    +--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n    | 5607c316-6c82-4462-999e-8f7f1bdef1cb | available | admin_vol11_from_PoC1 |  1   |     None    |   true   |             |\n    +--------------------------------------+-----------+-----------------------+------+-------------+----------+-------------+\n\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n\n## Reference\n\n[Cinder Migration to Different Backend][link-01]\n[Cinder Migration to Different AZ][link-02]\n[Cinder Migration to Different Region][link-03]\n\n[link-01]:http://qiita.com/idzzy/items/d4258be6bf73b0060dfb\n[link-02]:http://qiita.com/idzzy/items/153c5668ba08c87c1d2b\n[link-03]:http://qiita.com/idzzy/items/25dc605342738409a76b\n"}