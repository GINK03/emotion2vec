{"context": " More than 1 year has passed since last update.\u4ee5\u4e0b\u3092\u5143\u306b\u8a2d\u5b9a\uff08\u203b\u4e8b\u524d\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3078Ruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\uff09\nhttp://sensuapp.org/docs/0.16/adding_a_check\n\nSensu\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n\n\n\u30b5\u30fc\u30d0\u5074\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074 \u8a2d\u5b9a\n\nsensu-plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# gem install sensu-plugin --no-rdoc --no-ri\n\n\n\u76e3\u8996\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n# wget -O /etc/sensu/plugins/check-procs.rb https://raw.github.com/sensu/sensu-community-plugins/master/plugins/processes/check-procs.rb\n# chmod 755 /etc/sensu/plugins/check-procs.rb\n\n\nsubscriptions\u306e\u8a2d\u5b9a\n\u203bname/address\u306f\u9069\u5b9c\u4fee\u6b63\u3059\u308b\u3053\u3068\n# vi /etc/sensu/conf.d/client.json\n\n\n/etc/sensu/conf.d/client.json\n{\n  \"client\": {\n    \"name\": \"Sensu-Client\",\n    \"address\": \"192.168.xxx.xxx\",\n-    \"subscriptions\": [ \"all\" ]\n+    \"subscriptions\": [ \"webservers\" ]\n  }\n}\n\n\n\n\u30b5\u30fc\u30d0\u5074 \u8a2d\u5b9a\n\n\u76e3\u8996\u5b9a\u7fa9\u8a2d\u5b9a\n# vi /etc/sensu/conf.d/check_cron.json\n\n\n/etc/sensu/conf.d/check_cron.json\n{\n  \"checks\": {\n    \"cron_check\": {\n      \"handlers\": [\"default\"],\n      \"command\": \"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\n      \"interval\": 60,\n      \"subscribers\": [ \"webservers\" ]\n    }\n  }\n}\n\n\n\nSensu \u518d\u8d77\u52d5\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n# service sensu-client restart\n\n\n\u30b5\u30fc\u30d0\u5074\n# service sensu-server restart\n# service sensu-api restart\n\n\n\u30ed\u30b0\u78ba\u8a8d\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n# grep cron_check /var/log/sensu/sensu-client.log\n{\"timestamp\":\"2015-01-19T21:51:48.042368+0900\",\"level\":\"info\",\"message\":\"received check request\",\"check\":{\"name\":\"cron_check\",\"issued\":1421671843,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"}}\n{\"timestamp\":\"2015-01-19T21:51:48.129277+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"Sensu-Client\",\"check\":{\"name\":\"cron_check\",\"issued\":1421671843,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\"executed\":1421671908,\"duration\":0.086,\"output\":\"CheckProcs OK: Found 1 matching processes; cmd /crond/\\n\",\"status\":0}}}\n\n\n\u30b5\u30fc\u30d0\u5074\n# grep cron_check /var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-01-19T21:51:43.444922+0900\",\"level\":\"info\",\"message\":\"publishing check request\",\"payload\":{\"name\":\"cron_check\",\"issued\":1421671903,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"},\"subscribers\":[\"webservers\"]}\n\n\n\u969c\u5bb3\u691c\u51fa\u78ba\u8a8d\n\ncrond\u3092\u505c\u6b62\u3057\u3066\u307f\u308b\n# service crond stop\n\n\nDashboard\u78ba\u8a8d\nhttp://\uff1cServer IP\uff1e:3000/#/events\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074 \u30ed\u30b0\u78ba\u8a8d\n# grep cron_check /var/log/sensu/sensu-client.log | tail -2\n{\"timestamp\":\"2015-01-19T21:58:03.577208+0900\",\"level\":\"info\",\"message\":\"received check request\",\"check\":{\"name\":\"cron_check\",\"issued\":1421672203,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"}}\n{\"timestamp\":\"2015-01-19T21:58:03.663127+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"Sensu-Client\",\"check\":{\"name\":\"cron_check\",\"issued\":1421672203,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\"executed\":1421672283,\"duration\":0.086,\"output\":\"CheckProcs CRITICAL: Found 0 matching processes; cmd /crond/\\n\",\"status\":2}}}\n\n\u4ee5\u4e0b\u3092\u5143\u306b\u8a2d\u5b9a\uff08\u203b\u4e8b\u524d\u306b\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\u3078Ruby\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\uff09\nhttp://sensuapp.org/docs/0.16/adding_a_check\n\n* Sensu\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n    * [\u30b5\u30fc\u30d0\u5074](http://qiita.com/narvaux/items/15da8f71f7e175116d8b)\n    * [\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074](http://qiita.com/narvaux/items/4d8d2bc59229af359c81)\n\n## \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074 \u8a2d\u5b9a\n\n### sensu-plugin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# gem install sensu-plugin --no-rdoc --no-ri\n```\n\n### \u76e3\u8996\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```\n# wget -O /etc/sensu/plugins/check-procs.rb https://raw.github.com/sensu/sensu-community-plugins/master/plugins/processes/check-procs.rb\n# chmod 755 /etc/sensu/plugins/check-procs.rb\n```\n\n### subscriptions\u306e\u8a2d\u5b9a\n\n\u203bname/address\u306f\u9069\u5b9c\u4fee\u6b63\u3059\u308b\u3053\u3068\n\n```\n# vi /etc/sensu/conf.d/client.json\n```\n\n```diff:/etc/sensu/conf.d/client.json\n{\n  \"client\": {\n    \"name\": \"Sensu-Client\",\n    \"address\": \"192.168.xxx.xxx\",\n-    \"subscriptions\": [ \"all\" ]\n+    \"subscriptions\": [ \"webservers\" ]\n  }\n}\n```\n\n## \u30b5\u30fc\u30d0\u5074 \u8a2d\u5b9a\n\n### \u76e3\u8996\u5b9a\u7fa9\u8a2d\u5b9a\n\n```\n# vi /etc/sensu/conf.d/check_cron.json\n```\n\n```json:/etc/sensu/conf.d/check_cron.json\n{\n  \"checks\": {\n    \"cron_check\": {\n      \"handlers\": [\"default\"],\n      \"command\": \"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\n      \"interval\": 60,\n      \"subscribers\": [ \"webservers\" ]\n    }\n  }\n}\n```\n\n## Sensu \u518d\u8d77\u52d5\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n```\n# service sensu-client restart\n```\n\n### \u30b5\u30fc\u30d0\u5074\n\n```\n# service sensu-server restart\n# service sensu-api restart\n```\n\n## \u30ed\u30b0\u78ba\u8a8d\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074\n\n```\n# grep cron_check /var/log/sensu/sensu-client.log\n{\"timestamp\":\"2015-01-19T21:51:48.042368+0900\",\"level\":\"info\",\"message\":\"received check request\",\"check\":{\"name\":\"cron_check\",\"issued\":1421671843,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"}}\n{\"timestamp\":\"2015-01-19T21:51:48.129277+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"Sensu-Client\",\"check\":{\"name\":\"cron_check\",\"issued\":1421671843,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\"executed\":1421671908,\"duration\":0.086,\"output\":\"CheckProcs OK: Found 1 matching processes; cmd /crond/\\n\",\"status\":0}}}\n```\n\n### \u30b5\u30fc\u30d0\u5074\n\n```\n# grep cron_check /var/log/sensu/sensu-server.log\n{\"timestamp\":\"2015-01-19T21:51:43.444922+0900\",\"level\":\"info\",\"message\":\"publishing check request\",\"payload\":{\"name\":\"cron_check\",\"issued\":1421671903,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"},\"subscribers\":[\"webservers\"]}\n```\n\n## \u969c\u5bb3\u691c\u51fa\u78ba\u8a8d\n\n### crond\u3092\u505c\u6b62\u3057\u3066\u307f\u308b\n\n```\n# service crond stop\n```\n\n### Dashboard\u78ba\u8a8d\n\nhttp://\uff1cServer IP\uff1e:3000/#/events\n\n![sensu-crond-check.png](https://qiita-image-store.s3.amazonaws.com/1163/3539/18028b06-0eee-448b-5102-ecddb92bcce8.png \"sensu-crond-check.png\")\n\n\n### \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u5074 \u30ed\u30b0\u78ba\u8a8d\n\n```\n# grep cron_check /var/log/sensu/sensu-client.log | tail -2\n{\"timestamp\":\"2015-01-19T21:58:03.577208+0900\",\"level\":\"info\",\"message\":\"received check request\",\"check\":{\"name\":\"cron_check\",\"issued\":1421672203,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \"}}\n{\"timestamp\":\"2015-01-19T21:58:03.663127+0900\",\"level\":\"info\",\"message\":\"publishing check result\",\"payload\":{\"client\":\"Sensu-Client\",\"check\":{\"name\":\"cron_check\",\"issued\":1421672203,\"command\":\"/etc/sensu/plugins/check-procs.rb -p crond -C 1 \",\"executed\":1421672283,\"duration\":0.086,\"output\":\"CheckProcs CRITICAL: Found 0 matching processes; cmd /crond/\\n\",\"status\":2}}}\n```\n", "tags": ["Sensu"]}