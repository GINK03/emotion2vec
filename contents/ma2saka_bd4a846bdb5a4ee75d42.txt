{"context": " More than 1 year has passed since last update.\u4f55\u5468\u9045\u308c\u3060\u3088\u3063\u3066\u8a71\u3067\u306f\u3042\u308b\u3051\u3069 Docker \u4f7f\u3044\u59cb\u3081\u307e\u3057\u305f\u3002\n\u3055\u3066\u3001\u3010\u53c2\u8003\u8a33\u3011 \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3059\u308b\u30de\u30eb\u30c1\u30db\u30b9\u30c8 Docker \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd\u3092\u53c2\u8003\u306b\u3057\u3066\u8a66\u3057\u305f\u3002\u307f\u3093\u306a\u300cdocker\u306e\u30ea\u30f3\u30af\u306f\u3068\u3066\u3082\u4fbf\u5229\u300d\u3068\u7d76\u8cdb\u3059\u308b\u3051\u3069\u3069\u3046\u3082\u99b4\u67d3\u307e\u306a\u304b\u3063\u305f\u81ea\u5206\u306b\u306f\u7d20\u6674\u3089\u3057\u3044\u5c55\u958b\u3002\n\u307e\u305a\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u3067MySQL\u30ce\u30fc\u30c9\u3078\u3068\u4ed6\u306e\u30ce\u30fc\u30c9\u304b\u3089\u63a5\u7d9a\u3055\u305b\u308b\u30c6\u30b9\u30c8\u3092\u3057\u305f\u306e\u3061\u3001\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u540c\u69d8\u306e\u52d5\u4f5c\u3092\u8a66\u3059\u3053\u3068\u306b\u3002\n\u52d5\u4f5c\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\nMacBook(2015) Mem 8GB\nOS X El Capitan\nvirtualbox 5.0.8\n\n\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u3044\u3002\n<\u8ffd\u8a18>\u306a\u304a\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e0a\u4f4d\u4e92\u63db\u306e\u5185\u5bb9\u304c @zembutsu \u3055\u3093\u306b\u3088\u3063\u3066\u66f8\u304b\u308c\u3066\u3044\u308b\u306e\u3067\u3088\u308a\u8a73\u7d30\u306a\u5185\u5bb9\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u305d\u3061\u3089\u3092\u3002</\u8ffd\u8a18>\n\nDocker Toolbox\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u521d\u5fc3\u8005\u306a\u306e\u3067\u516c\u5f0f\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nhttps://www.docker.com/docker-toolbox\n\n\n\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u3067\u8a66\u3059\n\ndocker network\u3092\u4f5c\u308b\n$ docker network create backend\n461b41ec193090776948e42bee70b64cdc46dfe59e8206e5bbf0cb49372d9589\n\n\n\u5fc5\u8981\u306a\u30a4\u30e1\u30fc\u30b8\u3092 pull \u3059\u308b\n$ docker pull mysql\n$ docker pull centos\n\n\nDB\u3092\u4f5c\u308b\ndb\u3068\u3044\u3046\u30db\u30b9\u30c8\u540d\u3067\u3001backend \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u3002\n$ docker run -d -e MYSQL_ROOT_PASSWORD=mysql --net=backend --name db mysql:5.7\n3637731853a41c7c318c0f88d356005e48cf76806f360f0d5df8c217beaa544d\n\n\n\u3082\u3044\u3063\u3053CentOS\u3092\u7acb\u3066\u3066\u3001\u3055\u3063\u304d\u306eDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5c5e\u3057\u305f\u30db\u30b9\u30c8\u540c\u58eb\u306f\u30db\u30b9\u30c8\u540d\u3067\u304a\u4e92\u3044\u3092\u89e3\u6c7a\u3067\u304d\u308b\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d(backend)\u3068\u30db\u30b9\u30c8\u540d(db)\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\u3053\u306e\u3042\u305f\u308a\u306e\u52d5\u304d\u306f\u81ea\u7136\u3002\u306a\u304a\u3001/etc/hosts \u3092\u898b\u308c\u3070\u308f\u304b\u308b\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5c5e\u3057\u3066\u3044\u308b\u306e\u3067\u30db\u30b9\u30c8\u540d\u3060\u3051\u3067\u3082\u89e3\u6c7a\u3067\u304d\u308b\u3002\n$ docker run -it --net=backend centos\n[root@1ea2906c98f0 /]# ping db.backend\nPING db.backend (172.19.0.2) 56(84) bytes of data.\n64 bytes from db (172.19.0.2): icmp_seq=1 ttl=64 time=0.153 ms\n64 bytes from db (172.19.0.2): icmp_seq=2 ttl=64 time=0.080 ms\n64 bytes from db (172.19.0.2): icmp_seq=3 ttl=64 time=0.085 ms\n[root@1ea2906c98f0 /]# yum install -y mysql\n\n.... \n\n[root@1ea2906c98f0 /]# mysql --version\nmysql  Ver 15.1 Distrib 5.5.44-MariaDB, for Linux (x86_64) using readline 5.1\n\n[root@1ea2906c98f0 /]# mysql -h db.backend -uroot -pmysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.9 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMySQL [(none)]> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n\n\n\u3061\u3083\u3093\u3068db.backend \u3068\u3044\u3046\u540d\u524d\u3067 MySQL 5.7.9 \u306b\u63a5\u7d9a\u3067\u304d\u305f!\n[root@1ea2906c98f0 /]# cat /etc/hosts\n172.19.0.3  1ea2906c98f0\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.19.0.2  db\n172.19.0.2  db.backend\n\n\u3053\u308c\u3089\u540d\u524d\u306f /etc/hosts \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\u307e\u3042\u3053\u306e\u3042\u305f\u308a\u306f\u7406\u89e3\u3067\u304d\u308b\u8a71\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u72b6\u614b\u3067 mysql \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u843d\u3068\u3059\u3068 /etc/hosts \u306b\u66f8\u304b\u308c\u305f mysql \u306e\u30a8\u30f3\u30c8\u30ea\u3082\u6d88\u3048\u308b\u3002 \u3057\u304b\u3082\u3001\u65b0\u3057\u304f\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068 /etc/hosts \u306b\u30a8\u30f3\u30c8\u30ea\u304c\u5897\u3048\u308b\u3002\u306a\u3093\u3066\u3053\u3068\u3060\u3002\u3084\u3084\u611f\u52d5\u3057\u305f\u3002\n\n<\u4f59\u8ac7> MySQL\u30b5\u30fc\u30d0\u306e\u65b9\u306e /etc/hosts\n\u3053\u3046\u306a\u3063\u3066\u305f\u3002\n# cat /etc/hosts\n172.19.0.2  3637731853a4\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n#\n\ncentos\u304c\u3044\u306a\u3044\u306e\u306f\u30db\u30b9\u30c8\u540d\u3064\u3051\u3066\u306a\u3044\u304b\u3089\u304b\u306a\u3002\n\n<\u4f59\u8ac7>\u4f5c\u6210\u6e08\u307f\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5f8c\u304b\u3089\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3055\u305b\u305f\u308a\n\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u6642\u306b --net=hogehoge \u3067\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001connect \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3067\u5f8c\u304b\u3089\u6240\u5c5e\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n$ docker network connect <\u30b3\u30f3\u30c6\u30ca\u540d> <\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d>\n\n\u624b\u5143\u3067\u8a66\u3057\u305f\u969b\u3001-p 80:80 \u3067\u516c\u958b\u6e08\u307f\u306e Nginx \u30b3\u30f3\u30c6\u30ca\u3092 frontend \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3055\u305b\u3088\u3046\u3068\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6012\u3089\u308c\u305f\u306e\u3067\u4e00\u5ea6\u30dd\u30fc\u30c8\u306e\u30d0\u30a4\u30f3\u30c9\u5916\u3059\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u304b\u3057\u305d\u3046\u3002\u3053\u306e\u3042\u305f\u308a\u306f\u7d30\u304b\u304f\u898b\u3066\u306a\u3044\u3002\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n$ docker network connect frontend nginx_web\nError response from daemon: failed to create endpoint nginx_front on network frontend: Bind for 0.0.0.0:80 failed: port is already allocated\n\n\n\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u8a66\u3059\n\nswarm \u3092\u4f5c\u308b\n$ docker run swarm create\n\n=> <SWARM_TOKEN>\n\n\u3053\u306e\u30c8\u30fc\u30af\u30f3\u3092\u5f8c\u304b\u3089\u4f7f\u3046\u306e\u3067\u3068\u3063\u3066\u304a\u304f\u3002\n\n\u3068\u3053\u308d\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u306f\u30af\u30e9\u30b9\u30bf\u8a2d\u5b9a\u304c\u5fc5\u8981\u3060\n--cluster-advertise\u3068--cluster-store\u306e\u6307\u5b9a\u3092\u3057\u305f Docker Engine \u304c\u5fc5\u8981\u3067\u3042\u308b\u3002\n\nTo use multi-host networking you need to start your docker engines with --cluster-store and --cluster-advertise as indicated in the docker engine docs\nhttps://docs.docker.com/swarm/networking/\n\n\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306b\u306f Consul \u3092\u8d77\u52d5\u3059\u308b\u624b\u9806\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\u3053\u3053\u3067\u306f\u3068\u308a\u3042\u3048\u305a\u306a\u306e\u3067\u3001\u3053\u306e\u307e\u3093\u307e Consul\u7528\u306e\u74b0\u5883\u3092\u4e00\u500b\u4f5c\u3063\u3066\u3057\u307e\u3046\u3002Consul\u3082\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u3044\u304c\u3001\u3044\u3044\u3093\u3060\u3002\u3069\u3046\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u7d30\u304b\u304f\u7406\u89e3\u3059\u308b\u306e\u306f\u5f8c\u56de\u3057\u3067\u3042\u308b\u3002\u5f8c\u3067\u898b\u3088\u3046\u3002\ndocker-machine create \\\n    -d virtualbox \\\n    mhl-consul-1\n\ndocker $(docker-machine config mhl-consul-1) run -d \\\n    -p \"8500:8500\" \\\n    -h \"consul\" \\\n    progrium/consul -server -bootstrap\n\nhttps://docs.docker.com/swarm/discovery/ \u3053\u306e\u3078\u3093\u898b\u308b\u3068 \u30af\u30e9\u30b9\u30bf\u60c5\u5831\u3092\u5916\u90e8\u3067\u4fdd\u6301\u3059\u308b discovery \u306b\u306f consul \u3060\u3051\u3067\u306a\u304f etcd \u3068\u304b zookeeper \u3082\u9078\u629e\u3067\u304d\u308b\u307f\u305f\u3044\u3002\n\nswarm master \u3092\u4f5c\u308b\ndocker-machine create \\\n        -d virtualbox \\\n        --swarm \\\n        --swarm-master \\\n        --swarm-discovery token://${SWARM_TOKEN} \\\n        --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n        --engine-opt=\"cluster-advertise=eth1:0\" \\\n        swarm-master\n\n\u3067\u304d\u305f\u3089\u3053\u3063\u3061\u306b\u74b0\u5883\u3092\u5207\u308a\u66ff\u3048\u308b\u3002eval $(docker-machine env --swarm swarm-master)\u3059\u308b\u3002\n\nswarm node \u3092\u4f5c\u308b\n$ docker-machine create \\\n    -d virtualbox \\\n    --swarm \\\n    --swarm-discovery token://${SWARM_TOKEN} \\\n    --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n    --engine-opt=\"cluster-advertise=eth1:0\" \\\n    swarm-agent-00\n\n\n$ docker-machine create \\\n    -d virtualbox \\\n    --swarm \\\n    --swarm-discovery token://${SWARM_TOKEN} \\\n    --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n    --engine-opt=\"cluster-advertise=eth1:0\" \\\n    swarm-agent-01\n\n\u78ba\u8a8d\u3002\n$ docker-machine ls\nNAME             ACTIVE   DRIVER       STATE     URL                         SWARM\ndefault          -        virtualbox   Running   tcp://192.168.99.100:2376\nmhl-consul-1     -        virtualbox   Running   tcp://192.168.99.101:2376\nswarm-agent-00   -        virtualbox   Running   tcp://192.168.99.103:2376   swarm-master\nswarm-agent-01   -        virtualbox   Running   tcp://192.168.99.104:2376   swarm-master\nswarm-master     -        virtualbox   Running   tcp://192.168.99.102:2376   swarm-master (master)\n\n\u5b50\u4f9b\u9054\u304c\u5897\u3048\u3066\u305f\u3002\n\nswarm-master \u306b\u63a5\u7d9a\u3057\u3066\u72b6\u614b\u3092\u898b\u308b\nswarm-master \u3092\u666e\u901a\u306eDocker\u30a8\u30f3\u30b8\u30f3\u306e\u3088\u3046\u306b\u6271\u3063\u3066\u63a5\u7d9a\u3067\u304d\u308b\u3002--swarm \u3092\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3068\u3001\u5358\u72ec\u30ce\u30fc\u30c9\u3067\u306f\u306a\u304f\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092\u5bfe\u8c61\u3068\u3057\u3066\u64cd\u4f5c\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n$ eval $(docker-machine env --swarm swarm-master)\n\n\u3042\u3068\u306f\u666e\u901a\u306b docker \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n\n$ docker info\nContainers: 4\nImages: 3\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n swarm-agent-00: 192.168.99.103:2376\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\n swarm-agent-01: 192.168.99.104:2376\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\n swarm-master: 192.168.99.102:2376\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\nCPUs: 3\nTotal Memory: 3.064 GiB\nName: a1eae869d74b\n\n3\u30ce\u30fc\u30c9\u304c\u7d71\u62ec\u3055\u308c\u3066\u3044\u308b\u3002\n\u3069\u3046\u3067\u3082\u3044\u3044\u3051\u3069 3CPU\u3001Total Memory 3GB\u306fMacBook\u306b\u306f\u305d\u308c\u306a\u308a\u306b\u6df1\u523b\u2026\u3002\u3053\u306e\u4ed6\u306bConsul\u30de\u30b7\u30f3\u304c\u3044\u308b\u304b\u3089\u306d\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3002\n$ docker network create backend\ncf756ea9e77cbabf1e3ba019b4e7afc8b8b4575bd565415e9c304397e23c0664\n\n$ docker network ls\nNETWORK ID          NAME                    DRIVER\nded21015a5b2        swarm-master/none       null\n41558558d9be        swarm-master/host       host\ncf756ea9e77c        backend                 overlay\n4cbc614ed481        swarm-agent-01/none     null\ne9aefb33dfd7        swarm-agent-01/host     host\nd1435420f650        swarm-master/bridge     bridge\n01cbc675564a        swarm-agent-00/bridge   bridge\n9ea065803ecc        swarm-agent-00/none     null\n8fbe7735ed4c        swarm-agent-00/host     host\nd69c33adb66c        swarm-agent-01/bridge   bridge\n\n\u5404\u30db\u30b9\u30c8\u3054\u3068\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4ed6\u306b\u3001\u4eca\u4f5c\u3063\u305f backend \u3068\u3044\u3046\u540d\u306e\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u3067\u304d\u3066\u308b\u3002\n\ndiscovery \u3092\u4f7f\u308f\u305a\u306b\u5404\u30a8\u30f3\u30b8\u30f3\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u3001\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\u304c\u3067\u304d\u306a\u3044\u3002\n$ docker network create backend\nError response from daemon: 500 Internal Server Error: failed to parse pool request for address space \"GlobalDefault\" pool \"\" subpool \"\": cannot find address space GlobalDefault (most likely the backing datastore is not configured)\n\n\u3053\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u6642\u306f Docker \u30a8\u30f3\u30b8\u30f3\u304c cluster-advertise \u3068 cluster-store \u306e\u6307\u5b9a\u306a\u3057\u3067\u4f5c\u3089\u308c\u3061\u3083\u3063\u3066\u308b\u7591\u60d1\u3002docker-machine inspect\u3067\u78ba\u8a8d\u3059\u308b\u3093\u3060\u3002\n\u4e0a\u306e\u624b\u9806\u3067 Consul \u3092\u7acb\u3066\u3066\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u3053\u308c\u3067\u3053\u3051\u308b\u3002\n\ndocker pull \u3059\u308b\u3068\u5404\u30ce\u30fc\u30c9\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\n\u5404\u30ce\u30fc\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306f\u6301\u305f\u306a\u3044\u3068\u306a\u308f\u3051\u3060\u304b\u3089\u3001\u307e\u3042\u305d\u3046\u306a\u308b\u306e\u304b\u3002\n$ docker pull mysql\nUsing default tag: latest\nswarm-agent-01: Pulling mysql:latest...\nswarm-master: Pulling mysql:latest...\nswarm-agent-00: Pulling mysql:latest...\n$ docker pull centos\nUsing default tag: latest\nswarm-agent-01: Pulling centos:latest... : downloaded\nswarm-master: Pulling centos:latest... : downloaded\nswarm-agent-00: Pulling centos:latest... : downloaded\n\n\u5168\u90e8 virtualbox\u3000\u3060\u3068\u8907\u6570\u4e26\u5217\u3067 pull \u3059\u308b\u306e\u3067\u3001\u81ea\u5b85\u56de\u7dda\u7684\u306b\u3064\u3089\u307f\u304c\u3042\u308b\u3002\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nswarm               latest              6b40fe7724bd        3 days ago          15.6 MB\nmysql               latest              fb86ef4dd8b7        8 days ago          359.8 MB\ncentos              latest              e9fa5d3a0d0e        3 weeks ago         172.3 MB\n\nswarm \u3060\u3068 docker images \u30b3\u30de\u30f3\u30c9\u53e9\u3051\u306a\u3044\u3068\u66f8\u304b\u308c\u305f\u8a18\u4e8b\u3082\u3042\u308b\u304c\u3001\u73fe\u6642\u70b9\u3067\u306f\u305d\u3093\u306a\u3053\u3068\u3082\u306a\u3044\u6a21\u69d8\u3002\n\n\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u3063\u3066\u8a66\u3059\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u300cbackend\u300d\u306b\u6240\u5c5e\u3055\u305b\u308b\u3002\ndocker run -d -e MYSQL_ROOT_PASSWORD=mysql --net=backend --name db mysql\ndocker run -it --net=backend --name centos centos\n\nswarm\u4e0a\u3060\u3068 -d \u3067\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\u3057\u306a\u3044\u3068\u307e\u305a\u3044\u3068\u3044\u3046\u8a18\u4e8b\u3082\u898b\u305f\u304c\u3001\u73fe\u6642\u70b9\u3067\u306f\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3082\u53ef\u80fd\u307f\u305f\u3044\u3002\n\u5225\u7a93\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066 docker ps \u6253\u3064\u3068\u3001\u3061\u3083\u3093\u3068\u7570\u306a\u308b\u30ce\u30fc\u30c9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002mysql\u306f swarm-agent-00\u3001 centos\u306f swarm-agent-01\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n6a2a862a4fac        centos              \"/bin/bash\"              39 seconds ago      Up 38 seconds                           swarm-agent-01/centos\n33358a65ed35        mysql               \"/entrypoint.sh mysql\"   39 minutes ago      Up 39 minutes       3306/tcp            swarm-agent-00/db\n\nCentOS\u5074\u3067mysql(maria)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001MySQL\u30ce\u30fc\u30c9\u306b\u63a5\u7d9a\u3059\u308b\u3002\n[root@6a2a862a4fac /]# yum install -y mysql\n[root@6a2a862a4fac /]# mysql -uroot -hdb.backend -pmysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.9 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMySQL [(none)]>\n\n\u3067\u3051\u305f\u30fc\u3002\u3061\u3083\u3093\u3068 MySQL5.7.9 \u306b\u3064\u306a\u304c\u308b\u3002\n\u3044\u3044\u611f\u3058\u306b\u300c\u666e\u901a\u300d\u306b\u3064\u306a\u304c\u308b\u3002\n\u3044\u3063\u305f\u3093\u306f\u3053\u3053\u307e\u3067\u3002\n\n\u4f55\u5468\u9045\u308c\u3060\u3088\u3063\u3066\u8a71\u3067\u306f\u3042\u308b\u3051\u3069 Docker \u4f7f\u3044\u59cb\u3081\u307e\u3057\u305f\u3002\n\n\u3055\u3066\u3001[\u3010\u53c2\u8003\u8a33\u3011 \u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3059\u308b\u30de\u30eb\u30c1\u30db\u30b9\u30c8 Docker \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u80fd](http://pocketstudio.jp/log3/2015/11/04/docker-multi-host-networking-ga/)\u3092\u53c2\u8003\u306b\u3057\u3066\u8a66\u3057\u305f\u3002\u307f\u3093\u306a\u300cdocker\u306e\u30ea\u30f3\u30af\u306f\u3068\u3066\u3082\u4fbf\u5229\u300d\u3068\u7d76\u8cdb\u3059\u308b\u3051\u3069\u3069\u3046\u3082\u99b4\u67d3\u307e\u306a\u304b\u3063\u305f\u81ea\u5206\u306b\u306f\u7d20\u6674\u3089\u3057\u3044\u5c55\u958b\u3002\n\n\u307e\u305a\u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u3067MySQL\u30ce\u30fc\u30c9\u3078\u3068\u4ed6\u306e\u30ce\u30fc\u30c9\u304b\u3089\u63a5\u7d9a\u3055\u305b\u308b\u30c6\u30b9\u30c8\u3092\u3057\u305f\u306e\u3061\u3001\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u540c\u69d8\u306e\u52d5\u4f5c\u3092\u8a66\u3059\u3053\u3068\u306b\u3002\n\n\u52d5\u4f5c\u74b0\u5883\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n- MacBook(2015) Mem 8GB\n- OS X El Capitan\n- virtualbox 5.0.8\n\n\u30e1\u30e2\u30ea\u304c\u8db3\u308a\u306a\u3044\u3002\n\n<\u8ffd\u8a18>\u306a\u304a\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e0a\u4f4d\u4e92\u63db\u306e\u5185\u5bb9\u304c @zembutsu \u3055\u3093\u306b\u3088\u3063\u3066[\u66f8\u304b\u308c\u3066\u3044\u308b](http://qiita.com/zembutsu/items/4cd756ff8be4be76e5a3)\u306e\u3067\u3088\u308a\u8a73\u7d30\u306a\u5185\u5bb9\u3092\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u305d\u3061\u3089\u3092\u3002</\u8ffd\u8a18>\n\n# Docker Toolbox\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u521d\u5fc3\u8005\u306a\u306e\u3067\u516c\u5f0f\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n- https://www.docker.com/docker-toolbox\n\n# \u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u3067\u8a66\u3059\n## docker network\u3092\u4f5c\u308b\n\n```bash\n$ docker network create backend\n461b41ec193090776948e42bee70b64cdc46dfe59e8206e5bbf0cb49372d9589\n```\n\n## \u5fc5\u8981\u306a\u30a4\u30e1\u30fc\u30b8\u3092 pull \u3059\u308b\n\n```\n$ docker pull mysql\n$ docker pull centos\n```\n\n## DB\u3092\u4f5c\u308b\n\n`db`\u3068\u3044\u3046\u30db\u30b9\u30c8\u540d\u3067\u3001backend \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```bash\n$ docker run -d -e MYSQL_ROOT_PASSWORD=mysql --net=backend --name db mysql:5.7\n3637731853a41c7c318c0f88d356005e48cf76806f360f0d5df8c217beaa544d\n```\n\n## \u3082\u3044\u3063\u3053CentOS\u3092\u7acb\u3066\u3066\u3001\u3055\u3063\u304d\u306eDB\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\n\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5c5e\u3057\u305f\u30db\u30b9\u30c8\u540c\u58eb\u306f\u30db\u30b9\u30c8\u540d\u3067\u304a\u4e92\u3044\u3092\u89e3\u6c7a\u3067\u304d\u308b\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d(backend)\u3068\u30db\u30b9\u30c8\u540d(db)\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\u3053\u306e\u3042\u305f\u308a\u306e\u52d5\u304d\u306f\u81ea\u7136\u3002\u306a\u304a\u3001`/etc/hosts` \u3092\u898b\u308c\u3070\u308f\u304b\u308b\u304c\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5c5e\u3057\u3066\u3044\u308b\u306e\u3067\u30db\u30b9\u30c8\u540d\u3060\u3051\u3067\u3082\u89e3\u6c7a\u3067\u304d\u308b\u3002\n\n```bash\n$ docker run -it --net=backend centos\n[root@1ea2906c98f0 /]# ping db.backend\nPING db.backend (172.19.0.2) 56(84) bytes of data.\n64 bytes from db (172.19.0.2): icmp_seq=1 ttl=64 time=0.153 ms\n64 bytes from db (172.19.0.2): icmp_seq=2 ttl=64 time=0.080 ms\n64 bytes from db (172.19.0.2): icmp_seq=3 ttl=64 time=0.085 ms\n[root@1ea2906c98f0 /]# yum install -y mysql\n\n.... \n\n[root@1ea2906c98f0 /]# mysql --version\nmysql  Ver 15.1 Distrib 5.5.44-MariaDB, for Linux (x86_64) using readline 5.1\n\n[root@1ea2906c98f0 /]# mysql -h db.backend -uroot -pmysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.9 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\nMySQL [(none)]> show databases;\n+--------------------+\n| Database           |\n+--------------------+\n| information_schema |\n| mysql              |\n| performance_schema |\n| sys                |\n+--------------------+\n4 rows in set (0.00 sec)\n\n```\t\n\n\u3061\u3083\u3093\u3068`db.backend` \u3068\u3044\u3046\u540d\u524d\u3067 MySQL 5.7.9 \u306b\u63a5\u7d9a\u3067\u304d\u305f!\n\n```\n[root@1ea2906c98f0 /]# cat /etc/hosts\n172.19.0.3\t1ea2906c98f0\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n172.19.0.2\tdb\n172.19.0.2\tdb.backend\n```\n \n\u3053\u308c\u3089\u540d\u524d\u306f `/etc/hosts` \u306b\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\u307e\u3042\u3053\u306e\u3042\u305f\u308a\u306f\u7406\u89e3\u3067\u304d\u308b\u8a71\u3002**\u3057\u304b\u3057\u3001\u3053\u306e\u72b6\u614b\u3067 mysql \u306e\u30b3\u30f3\u30c6\u30ca\u3092\u843d\u3068\u3059\u3068 /etc/hosts \u306b\u66f8\u304b\u308c\u305f mysql \u306e\u30a8\u30f3\u30c8\u30ea\u3082\u6d88\u3048\u308b\u3002** \u3057\u304b\u3082\u3001**\u65b0\u3057\u304f\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068 /etc/hosts \u306b\u30a8\u30f3\u30c8\u30ea\u304c\u5897\u3048\u308b\u3002**\u306a\u3093\u3066\u3053\u3068\u3060\u3002\u3084\u3084\u611f\u52d5\u3057\u305f\u3002\n\n### <\u4f59\u8ac7> MySQL\u30b5\u30fc\u30d0\u306e\u65b9\u306e /etc/hosts\n\n\u3053\u3046\u306a\u3063\u3066\u305f\u3002\n\n```\n# cat /etc/hosts\n172.19.0.2\t3637731853a4\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n#\n```\n\ncentos\u304c\u3044\u306a\u3044\u306e\u306f\u30db\u30b9\u30c8\u540d\u3064\u3051\u3066\u306a\u3044\u304b\u3089\u304b\u306a\u3002\n\n### <\u4f59\u8ac7>\u4f5c\u6210\u6e08\u307f\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5f8c\u304b\u3089\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3055\u305b\u305f\u308a\n\n\u30b3\u30f3\u30c6\u30ca\u4f5c\u6210\u6642\u306b `--net=hogehoge` \u3067\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001connect \u30b5\u30d6\u30b3\u30de\u30f3\u30c9\u3067\u5f8c\u304b\u3089\u6240\u5c5e\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n```\n$ docker network connect <\u30b3\u30f3\u30c6\u30ca\u540d> <\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u540d>\n```\n\n\u624b\u5143\u3067\u8a66\u3057\u305f\u969b\u3001`-p 80:80` \u3067\u516c\u958b\u6e08\u307f\u306e Nginx \u30b3\u30f3\u30c6\u30ca\u3092 frontend \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u6240\u5c5e\u3055\u305b\u3088\u3046\u3068\u3057\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6012\u3089\u308c\u305f\u306e\u3067\u4e00\u5ea6\u30dd\u30fc\u30c8\u306e\u30d0\u30a4\u30f3\u30c9\u5916\u3059\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u304b\u3057\u305d\u3046\u3002\u3053\u306e\u3042\u305f\u308a\u306f\u7d30\u304b\u304f\u898b\u3066\u306a\u3044\u3002\u3054\u3081\u3093\u306a\u3055\u3044\u3002\n\n```\n$ docker network connect frontend nginx_web\nError response from daemon: failed to create endpoint nginx_front on network frontend: Bind for 0.0.0.0:80 failed: port is already allocated\n```\n\n\n# \u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u8a66\u3059\n## swarm \u3092\u4f5c\u308b\n\n```\n$ docker run swarm create\n\n=> <SWARM_TOKEN>\n```\n\n\u3053\u306e\u30c8\u30fc\u30af\u30f3\u3092\u5f8c\u304b\u3089\u4f7f\u3046\u306e\u3067\u3068\u3063\u3066\u304a\u304f\u3002\n\n## \u3068\u3053\u308d\u3067\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u306f\u30af\u30e9\u30b9\u30bf\u8a2d\u5b9a\u304c\u5fc5\u8981\u3060\n\n`--cluster-advertise`\u3068`--cluster-store`\u306e\u6307\u5b9a\u3092\u3057\u305f Docker Engine \u304c\u5fc5\u8981\u3067\u3042\u308b\u3002\n\n> To use multi-host networking you need to start your docker engines with --cluster-store and --cluster-advertise as indicated in the docker engine docs\nhttps://docs.docker.com/swarm/networking/\n\n[\u516c\u5f0f\u306e\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9](https://github.com/dave-tucker/docker-network-demos/blob/master/multihost-local.sh)\u306b\u306f Consul \u3092\u8d77\u52d5\u3059\u308b\u624b\u9806\u304c\u66f8\u304b\u308c\u3066\u3044\u308b\u3002\n\n\u3053\u3053\u3067\u306f\u3068\u308a\u3042\u3048\u305a\u306a\u306e\u3067\u3001\u3053\u306e\u307e\u3093\u307e Consul\u7528\u306e\u74b0\u5883\u3092\u4e00\u500b\u4f5c\u3063\u3066\u3057\u307e\u3046\u3002Consul\u3082\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u3044\u304c\u3001\u3044\u3044\u3093\u3060\u3002\u3069\u3046\u52d5\u3044\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u7d30\u304b\u304f\u7406\u89e3\u3059\u308b\u306e\u306f\u5f8c\u56de\u3057\u3067\u3042\u308b\u3002\u5f8c\u3067\u898b\u3088\u3046\u3002\n\n```bash\ndocker-machine create \\\n    -d virtualbox \\\n    mhl-consul-1\n\ndocker $(docker-machine config mhl-consul-1) run -d \\\n    -p \"8500:8500\" \\\n    -h \"consul\" \\\n    progrium/consul -server -bootstrap\n```\n\nhttps://docs.docker.com/swarm/discovery/ \u3053\u306e\u3078\u3093\u898b\u308b\u3068 \u30af\u30e9\u30b9\u30bf\u60c5\u5831\u3092\u5916\u90e8\u3067\u4fdd\u6301\u3059\u308b discovery \u306b\u306f consul \u3060\u3051\u3067\u306a\u304f `etcd` \u3068\u304b `zookeeper` \u3082\u9078\u629e\u3067\u304d\u308b\u307f\u305f\u3044\u3002\n\n## swarm master \u3092\u4f5c\u308b\n\n```bash\ndocker-machine create \\\n        -d virtualbox \\\n        --swarm \\\n        --swarm-master \\\n        --swarm-discovery token://${SWARM_TOKEN} \\\n        --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n        --engine-opt=\"cluster-advertise=eth1:0\" \\\n        swarm-master\n```\n\n\u3067\u304d\u305f\u3089\u3053\u3063\u3061\u306b\u74b0\u5883\u3092\u5207\u308a\u66ff\u3048\u308b\u3002`eval $(docker-machine env --swarm swarm-master)`\u3059\u308b\u3002\n\n\n## swarm node \u3092\u4f5c\u308b\n\n```bash\n$ docker-machine create \\\n    -d virtualbox \\\n    --swarm \\\n    --swarm-discovery token://${SWARM_TOKEN} \\\n    --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n    --engine-opt=\"cluster-advertise=eth1:0\" \\\n    swarm-agent-00\n\n\n$ docker-machine create \\\n    -d virtualbox \\\n    --swarm \\\n    --swarm-discovery token://${SWARM_TOKEN} \\\n    --engine-opt=\"cluster-store=consul://$(docker-machine ip mhl-consul-1):8500\" \\\n    --engine-opt=\"cluster-advertise=eth1:0\" \\\n    swarm-agent-01\n```\n\n\u78ba\u8a8d\u3002\n\n```bash\n$ docker-machine ls\nNAME             ACTIVE   DRIVER       STATE     URL                         SWARM\ndefault          -        virtualbox   Running   tcp://192.168.99.100:2376\nmhl-consul-1     -        virtualbox   Running   tcp://192.168.99.101:2376\nswarm-agent-00   -        virtualbox   Running   tcp://192.168.99.103:2376   swarm-master\nswarm-agent-01   -        virtualbox   Running   tcp://192.168.99.104:2376   swarm-master\nswarm-master     -        virtualbox   Running   tcp://192.168.99.102:2376   swarm-master (master)\n```\n\n\u5b50\u4f9b\u9054\u304c\u5897\u3048\u3066\u305f\u3002\n\n## swarm-master \u306b\u63a5\u7d9a\u3057\u3066\u72b6\u614b\u3092\u898b\u308b\n\nswarm-master \u3092\u666e\u901a\u306eDocker\u30a8\u30f3\u30b8\u30f3\u306e\u3088\u3046\u306b\u6271\u3063\u3066\u63a5\u7d9a\u3067\u304d\u308b\u3002`--swarm` \u3092\u6307\u5b9a\u3057\u3066\u63a5\u7d9a\u3059\u308b\u3068\u3001\u5358\u72ec\u30ce\u30fc\u30c9\u3067\u306f\u306a\u304f\u30af\u30e9\u30b9\u30bf\u5168\u4f53\u3092\u5bfe\u8c61\u3068\u3057\u3066\u64cd\u4f5c\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\n```\n$ eval $(docker-machine env --swarm swarm-master)\n```\n\n\u3042\u3068\u306f\u666e\u901a\u306b docker \u30b3\u30de\u30f3\u30c9\u304c\u4f7f\u3048\u308b\u3002\n\n```\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\n\n$ docker info\nContainers: 4\nImages: 3\nRole: primary\nStrategy: spread\nFilters: health, port, dependency, affinity, constraint\nNodes: 3\n swarm-agent-00: 192.168.99.103:2376\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\n swarm-agent-01: 192.168.99.104:2376\n  \u2514 Containers: 1\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\n swarm-master: 192.168.99.102:2376\n  \u2514 Containers: 2\n  \u2514 Reserved CPUs: 0 / 1\n  \u2514 Reserved Memory: 0 B / 1.021 GiB\n  \u2514 Labels: executiondriver=native-0.2, kernelversion=4.1.12-boot2docker, operatingsystem=Boot2Docker 1.9.0 (TCL 6.4); master : 16e4a2a - Tue Nov  3 19:49:22 UTC 2015, provider=virtualbox, storagedriver=aufs\nCPUs: 3\nTotal Memory: 3.064 GiB\nName: a1eae869d74b\n```\n\n3\u30ce\u30fc\u30c9\u304c\u7d71\u62ec\u3055\u308c\u3066\u3044\u308b\u3002\n\u3069\u3046\u3067\u3082\u3044\u3044\u3051\u3069 3CPU\u3001Total Memory 3GB\u306fMacBook\u306b\u306f\u305d\u308c\u306a\u308a\u306b\u6df1\u523b\u2026\u3002\u3053\u306e\u4ed6\u306bConsul\u30de\u30b7\u30f3\u304c\u3044\u308b\u304b\u3089\u306d\u3002\n\n## \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u4f5c\u6210\u3059\u308b\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u8868\u793a\u3057\u3066\u307f\u308b\u3002\n\n```\n$ docker network create backend\ncf756ea9e77cbabf1e3ba019b4e7afc8b8b4575bd565415e9c304397e23c0664\n\n$ docker network ls\nNETWORK ID          NAME                    DRIVER\nded21015a5b2        swarm-master/none       null\n41558558d9be        swarm-master/host       host\ncf756ea9e77c        backend                 overlay\n4cbc614ed481        swarm-agent-01/none     null\ne9aefb33dfd7        swarm-agent-01/host     host\nd1435420f650        swarm-master/bridge     bridge\n01cbc675564a        swarm-agent-00/bridge   bridge\n9ea065803ecc        swarm-agent-00/none     null\n8fbe7735ed4c        swarm-agent-00/host     host\nd69c33adb66c        swarm-agent-01/bridge   bridge\n```\n\n\u5404\u30db\u30b9\u30c8\u3054\u3068\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4ed6\u306b\u3001\u4eca\u4f5c\u3063\u305f backend \u3068\u3044\u3046\u540d\u306e\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304c\u3067\u304d\u3066\u308b\u3002\n\n### discovery \u3092\u4f7f\u308f\u305a\u306b\u5404\u30a8\u30f3\u30b8\u30f3\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u3001\u30aa\u30fc\u30d0\u30fc\u30ec\u30a4\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u4f5c\u6210\u304c\u3067\u304d\u306a\u3044\u3002\n\n```\n$ docker network create backend\nError response from daemon: 500 Internal Server Error: failed to parse pool request for address space \"GlobalDefault\" pool \"\" subpool \"\": cannot find address space GlobalDefault (most likely the backing datastore is not configured)\n```\n\n\u3053\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u6642\u306f Docker \u30a8\u30f3\u30b8\u30f3\u304c `cluster-advertise` \u3068 `cluster-store` \u306e\u6307\u5b9a\u306a\u3057\u3067\u4f5c\u3089\u308c\u3061\u3083\u3063\u3066\u308b\u7591\u60d1\u3002`docker-machine inspect`\u3067\u78ba\u8a8d\u3059\u308b\u3093\u3060\u3002\n\n\u4e0a\u306e\u624b\u9806\u3067 Consul \u3092\u7acb\u3066\u3066\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u3053\u308c\u3067\u3053\u3051\u308b\u3002\n\n## docker pull \u3059\u308b\u3068\u5404\u30ce\u30fc\u30c9\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\n\n\u5404\u30ce\u30fc\u30c9\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306f\u6301\u305f\u306a\u3044\u3068\u306a\u308f\u3051\u3060\u304b\u3089\u3001\u307e\u3042\u305d\u3046\u306a\u308b\u306e\u304b\u3002\n\n```bash\n$ docker pull mysql\nUsing default tag: latest\nswarm-agent-01: Pulling mysql:latest...\nswarm-master: Pulling mysql:latest...\nswarm-agent-00: Pulling mysql:latest...\n$ docker pull centos\nUsing default tag: latest\nswarm-agent-01: Pulling centos:latest... : downloaded\nswarm-master: Pulling centos:latest... : downloaded\nswarm-agent-00: Pulling centos:latest... : downloaded\n```\n\n\u5168\u90e8 virtualbox\u3000\u3060\u3068\u8907\u6570\u4e26\u5217\u3067 pull \u3059\u308b\u306e\u3067\u3001\u81ea\u5b85\u56de\u7dda\u7684\u306b\u3064\u3089\u307f\u304c\u3042\u308b\u3002\n\n```\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nswarm               latest              6b40fe7724bd        3 days ago          15.6 MB\nmysql               latest              fb86ef4dd8b7        8 days ago          359.8 MB\ncentos              latest              e9fa5d3a0d0e        3 weeks ago         172.3 MB\n```\n\nswarm \u3060\u3068 docker images \u30b3\u30de\u30f3\u30c9\u53e9\u3051\u306a\u3044\u3068\u66f8\u304b\u308c\u305f\u8a18\u4e8b\u3082\u3042\u308b\u304c\u3001\u73fe\u6642\u70b9\u3067\u306f\u305d\u3093\u306a\u3053\u3068\u3082\u306a\u3044\u6a21\u69d8\u3002\n\n## \u30b7\u30f3\u30b0\u30eb\u30db\u30b9\u30c8\u306e\u6642\u3068\u540c\u3058\u3088\u3046\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u3063\u3066\u8a66\u3059\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u300cbackend\u300d\u306b\u6240\u5c5e\u3055\u305b\u308b\u3002\n\n```bash\ndocker run -d -e MYSQL_ROOT_PASSWORD=mysql --net=backend --name db mysql\ndocker run -it --net=backend --name centos centos\n```\n\nswarm\u4e0a\u3060\u3068 `-d` \u3067\u30c7\u30fc\u30e2\u30f3\u8d77\u52d5\u3057\u306a\u3044\u3068\u307e\u305a\u3044\u3068\u3044\u3046\u8a18\u4e8b\u3082\u898b\u305f\u304c\u3001\u73fe\u6642\u70b9\u3067\u306f\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3082\u53ef\u80fd\u307f\u305f\u3044\u3002\n\n\u5225\u7a93\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066 `docker ps` \u6253\u3064\u3068\u3001\u3061\u3083\u3093\u3068\u7570\u306a\u308b\u30ce\u30fc\u30c9\u3067\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u304c\u308f\u304b\u308b\u3002mysql\u306f swarm-agent-00\u3001 centos\u306f swarm-agent-01\u3002\n\n```bash\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES\n6a2a862a4fac        centos              \"/bin/bash\"              39 seconds ago      Up 38 seconds                           swarm-agent-01/centos\n33358a65ed35        mysql               \"/entrypoint.sh mysql\"   39 minutes ago      Up 39 minutes       3306/tcp            swarm-agent-00/db\n```\n\nCentOS\u5074\u3067mysql(maria)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3001MySQL\u30ce\u30fc\u30c9\u306b\u63a5\u7d9a\u3059\u308b\u3002\n\n```\n[root@6a2a862a4fac /]# yum install -y mysql\n[root@6a2a862a4fac /]# mysql -uroot -hdb.backend -pmysql\nWelcome to the MariaDB monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 2\nServer version: 5.7.9 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2015, Oracle, MariaDB Corporation Ab and others.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nMySQL [(none)]>\n```\n\n\u3067\u3051\u305f\u30fc\u3002\u3061\u3083\u3093\u3068 MySQL5.7.9 \u306b\u3064\u306a\u304c\u308b\u3002\n\u3044\u3044\u611f\u3058\u306b\u300c\u666e\u901a\u300d\u306b\u3064\u306a\u304c\u308b\u3002\n\n\u3044\u3063\u305f\u3093\u306f\u3053\u3053\u307e\u3067\u3002\n", "tags": ["docker", "Network", "Cluster", "DockerSwarm", "Mac"]}