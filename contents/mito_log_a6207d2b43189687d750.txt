{"context": " More than 1 year has passed since last update.\n\n\u7d4c\u7def\n\u524d\u56deslack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8abf\u3079\u305f\u6642\u306bweb\u30bd\u30b1\u30c3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3001rocketsocket\u304c\u5165\u3063\u3066\u3044\u3066\u3001\u9762\u767d\u305d\u3046\u3060\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u65e9\u901f\u4f7f\u3063\u3066\u307f\u3088\u3046\u304b\u3068\u3002web\u30bd\u30b1\u30c3\u30c8\u3068\u3044\u3048\u3070\u30c1\u30e3\u30c3\u30c8\uff01\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\u305d\u306e\u307e\u3093\u307esocketrocket\u3092\u898b\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001\u7406\u89e3\u30bc\u30ed\u304b\u3089\u30c1\u30e3\u30c3\u30c8\u3084\u308d\u3046\u3068\u3059\u308b\u3068\u3001\u7d50\u69cb\u5927\u5909\u305d\u3046\u3060\u306a...\u3068\u601d\u3044\u3001socket.io\u306brooms\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3092\u307f\u3064\u3051\u307e\u3057\u305f\u3002\u304a\u3001\u3053\u308c\u306f\u4f7f\u3048\u305d\u3046\u3060\u3068\u8abf\u3079\u3066\u884c\u3063\u305f\u3089\u3001iOS\u3067\u3082webView\u3067socket.io\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u66f8\u3044\u3066\u304f\u308c\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002SIOSocket\u3068\u3044\u3046\u3084\u3064\u3067\u3059\u3002\u3053\u308c\u306f\u3044\u3051\u305d\u3046\u3060\u306a\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u7d50\u679c\u3001\u308f\u308a\u3068\u5927\u5909\u3067\u3057\u305f\u304c\u3001\u306a\u3093\u3068\u304b\u52d5\u304f\u3082\u306e\u306f\u3067\u304d\u305f\u304b\u306a\u30fc\u3068\u304a\u3082\u3063\u305f\u306e\u3067\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3067\u304d\u305f\u3082\u306e\n\u306a\u3093\u304b\u3073\u307f\u3087\u30fc\u306a\u4ed5\u69d8\u3067\u3059\u304c...\n\n\u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u81ea\u5206\u306eroom\u306b\u5165\u308b\n\u4eca\u306e\u3068\u3053\u308d\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u306e\u52d5\u4f5c\u306e\u307f\uff08\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u306f\u6c17\u304c\u5411\u3044\u305f\u3089...)\n\u3082\u3057\u4ed6\u306e\u4eba\u3082\u30a2\u30d7\u30ea\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308c\u3070\u5de6\u5074\u306e\u30c9\u30ed\u30ef\u30fc\u306b\u3067\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u3053\u304b\u3089\u9078\u629e\u3057\u3066join\u3067\u304d\u307e\u3059\u3002\u540c\u6642\u306b\u8907\u6570\u306eroom\u306bjoin\u3067\u304d\u307e\u3059\u3002\n\n\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30d0\u30fc\u306e\u30bf\u30a4\u30c8\u30eb\u306e\u90e8\u5206\u304c\u3044\u308f\u3086\u308b\u90e8\u5c4b\u306e\u540d\u524d\u3067\u3059...\u4fbf\u5b9c\u4e0asocket id\u306b\u3057\u3066\u308b\u306e\u3067\u3001\u7121\u6a5f\u8cea\u6975\u307e\u308a\u306a\u3044\u3067\u3059\u3002\u540d\u524d\u3068\u304b\u5439\u304d\u51fa\u3057\u306e\u4e0b\u306b\u51fa\u305b\u308c\u3070\u3088\u304b\u3063\u305f\u3067\u3059\u3002\u8ffd\u3005\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u203b \u3061\u306a\u307f\u306b\u3053\u306e\u30d5\u30ad\u30c0\u30b7\u306f JSQMessagesViewController \u3068\u3044\u3046\u3082\u306e\u3092\u3064\u304b\u3063\u3066\u3044\u307e\u3059\uff01\u4f7f\u3044\u65b9\u306f\u3001Developer.IO\u3055\u3093\u306e\u8a18\u4e8b\u3092\u3054\u53c2\u8003\u306b\u3002\n\n\u304a\u90e8\u5c4b\u4e00\u89a7\u304c\u307f\u3048\u307e\u3059\u3002\u4e00\u5fdc\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u306e\u5909\u66f4\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n\u7528\u610f\u3057\u305f\u3082\u306e\n\n()\u306e\u4e2d\u306f\u4eca\u56de\u5229\u7528\u3057\u305fversion\u306a\u3069\n\nec2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 (Amazon Linux AMI release 2014.09)\nnode.js (v0.12.0)\nsocket.io (1.3.5)\n\n\n\u69cb\u6210\n\u4eca\u56de\u306f\u3001iOS\u30a2\u30d7\u30ea\u4e0a\u306eSIOSocket <-> ec2\u4e0a\u306enode\u30b5\u30fc\u30d0 with socket.io \u3063\u3066\u611f\u3058\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002vagrant\u3060\u3068\u611f\u52d5\u304c\u591a\u5c11\u6e1b\u308b\u306e\u3067\u3001ec2\u306b\u7f6e\u3044\u3066\u30ea\u30a2\u30eb\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3067\u3002\n\n\u624b\u9806\n\n1. node\u30b5\u30fc\u30d0\u3092\u7528\u610f\nwebsocket\u901a\u4fe1\u3067\u306ftcp3000\u756a\u30dd\u30fc\u30c8\u3092\u4f7f\u3046\u306e\u3067\u305d\u3053\u3060\u3051\u958b\u3051\u308b\u3088\u3046\u306b\u6ce8\u610f\n\n# nodebrew\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget git.io/nodebrew\nperl nodebrew setup\n\n# nodebrew\u306e\u30d1\u30b9\u3092\u901a\u3059\nvim ~/.bashrc\nPATH=$HOME/.nodebrew/current/bin:$PATH\n\n# node\u306e\u6700\u65b0\u5b89\u5b9a\u7248(\u30d0\u30a4\u30ca\u30ea)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnodebrew install-binary stable\n# ls\u3057\u3066\u51fa\u3066\u304d\u305f\u3082\u306e\u3092use\nnodebrew ls\nnodebrew use v0.12.0\n# \u4e0a\u8a18version\u304c\u51fa\u3066\u304d\u305f\u3089\u6210\u529f\nnode -v\n\n# \u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\nmkdir ~/SIOChatServer\ncd ~/SIOChatServer\n\n# socket.io\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install socket.io\n\nnode\u7528\u30b5\u30fc\u30d0\u306bscp\u3067server.js\u3092\u914d\u7f6e\nscp -i path/to/your.pem server.js ec2-user@yourhostname:/home/ec2-user/SIOChatServer\n\n\u3042\u3068\u306f\u5b9f\u884c\u3059\u308b\u3060\u3051\u3002\u306e\u306f\u305a\u3002\n# node\u30b5\u30fc\u30d0\u5b9f\u884c (\u30c7\u30d0\u30c3\u30b0\u3057\u305f\u3044\u5834\u5408\u306f DEBUG*= node server \u4f7f\u3046\u3068\u3044\u3044\u304b\u3082)\nnode server\n\n\n2. \u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u3092\u6e96\u5099\nhttps://github.com/mitolog/SIOChat \n\u3053\u3061\u3089\u306b\u30bd\u30fc\u30b9\u3092\u4e0a\u3052\u305f\u306e\u3067\u3001clone\u3057\u3066\u4f7f\u3063\u3066\u4e0b\u3055\u3044\u3002\u305d\u306e\u969b\u3001AppConst.h\u30d5\u30a1\u30a4\u30eb\u306ekWebSocketHostName\u3092\u9069\u5b9c\u3054\u81ea\u8eab\u306e\u3082\u306e\u306b\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u305d\u306e\u969b\u3001\u30b9\u30ad\u30fc\u30de\u3092ws://\u306b\u3057\u3068\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u3068\u30dd\u30fc\u30c8\u6307\u5b9a\u3082\u3002\n\nWebSocket\u901a\u4fe1\u3092\u62c5\u3063\u3066\u3044\u308b\u7b87\u6240\n\n\u30a2\u30d7\u30ea\u5074\nWebSocket\u306e\u53d7\u3051\u5074\u306f\u3001SIOSocket\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4e00\u767a\u3067\u3059\u3002\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092blocks\u306e\u4e2d\u3067\u5b9a\u7fa9\u3057\u3066\u3042\u3052\u3066\u307e\u3059\u3002\n\nChatViewController.h\n- (void)connectWs\n{\n    // Close existing connection if needed\n    if(self.socket){ [self.socket close];}\n\n    [SIOSocket socketWithHost: kWebSocketHostName response: ^(SIOSocket *socket){\n\n        self.socket = socket;\n\n        __weak typeof(self) weakSelf = self;\n        self.socket.onConnect = ^()\n        {\n            /* ~\u3053\u3053\u7701\u7565~ */\n            [weakSelf.socket emit: @\"init\" args: @[[param paramStr]]];\n        };\n\n        [self.socket on: @\"join\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n\n        [self.socket on: @\"update\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n\n        [self.socket on: @\"rooms\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n\n        [self.socket on: @\"disappear\" callback: ^(SIOParameterArray *args)\n         {                  \n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n    }];\n}\n\n\n\n\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u901a\u77e5\u3059\u308b\u5834\u5408\u306f\u3001\n\nChatViewController.h\n[self.socket emit:@\"post\" args:@[[param paramStr]]];\n\n\n\u3053\u3093\u306a\u3075\u3046\u306b\u304b\u3051\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d0\u5074\n\u3053\u308c\u3060\u3051\uff01\n\nserver.js\nvar io = require('socket.io')(3000);\n\nvar sepStr = ',';\nvar roomIdx = 0;\nvar isParentIdx = 1;\nvar nicknameIdx = 3;\nvar joinedRooms = [];\nvar nicknames = [];\n\nio.on('connection', function (socket) {\n\n    console.log(socket['id'] + ' has connected!');\n\n    // join the specific room everytime socket connected\n    socket.on('init', function(data){\n\n    var params = data.split(sepStr);\n        var isParent = params[isParentIdx];\n    var room = params[roomIdx]\n        var output = data;  \n\n    if(isParent == '1'){\n            room = socket['id'];\n        output = room;\n            output += data;\n        nicknames[socket['id']] = params[nicknameIdx];\n    }else{\n            socket.join(room);\n    }\n\n    joinedRooms[socket['id']] = socket.rooms;\n\n    io.emit('rooms', io.sockets.adapter.rooms);\n    io.to(room).emit('join', output);\n\n        console.log('joined room ' + room);\n    });\n\n    // bradcast the specific room everytime someone posted some\n    socket.on('post', function (data) {\n\n        console.log(socket['id'] + ' ' + data);\n\n        var room = data.split(sepStr)[roomIdx];\n        io.to(room).emit('update', data);\n    });\n\n    // clients are disconnected automatically everytime they going background \n    socket.on('disconnect', function (data) {\n\n    io.emit('rooms', io.sockets.adapter.rooms);\n\n    var message = nicknames[socket['id']];\n    message += ' left room';\n    message += sepStr;\n    var prevJoinedRooms = joinedRooms[socket['id']];\n    for(var i=0; i<prevJoinedRooms.length; i++){\n        var room = prevJoinedRooms[i];\n        io.to(room).emit('disappear', message + room);\n        console.log(message + room);\n    }\n        console.log(socket['id'] + ' has disconnected!');\n    });\n\n});\n\n\n\n\u611f\u60f3\n\n\u30a2\u30d7\u30ea\u3082\u30b5\u30fc\u30d0\u3082\u3001\u307e\u3060\u307e\u3060\u7121\u99c4\u306a\u30bd\u30fc\u30b9\u3042\u308b\u3093\u3067\u3059\u304c\u3001\u305d\u308c\u3067\u3082\u7d50\u69cb\u5c11\u306a\u3044\u30b3\u30fc\u30c9\u3067\u3059\u3093\u3060\u3068\u601d\u3063\u3066\u3044\u3066\u3001node\u3059\u3054\u3044\u306a\u30fcsocket.io\u3059\u3054\u3044\u306a\u30fc\u3068\u611f\u52d5\u3057\u307e\u3057\u305f\u3002\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30c1\u30e3\u30c3\u30c8\u304c\u98db\u3093\u3067\u304d\u305f\u6642\u306f\u3061\u3087\u3063\u3068\u611f\u52d5\u3057\u307e\u3057\u305f\u3002\nslack\u3063\u3066\u3084\u3063\u3071\u308a\u3059\u3052\u30fc\u306a\u30fc...\nsocket.io-redis\u3068socket.io-emitter\u3092\u4f7f\u3048\u3070socket.io\u4ee5\u5916\u306e\u30d7\u30ed\u30bb\u30b9\u304b\u3089socket.io\u306b\u30c7\u30fc\u30bf\u3092\u9001\u308c\u308b\u306e\u3067\u65e2\u5b58\u306ephp\u3068\u304brails\u306eAPI\u304b\u3089\u3067\u3082\u9023\u643a\u3067\u304d\u308b\u3057\u3001\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3082\u3067\u304d\u308b\u306e\u306f\u826f\u3044\u306e\u3067\u306f\u3002\n\n\n\u53c2\u8003\nSocket.io\nSIOSocket\n(\u516c\u5f0f\u30da\u30fc\u30b8)Rooms and Namespaces\nWebSocket \u4e8b\u59cb\u3081 by Node.js + Socket.IO\nNode.js\u306b\u3066socket.io\u306ejoin\u3067\u30c1\u30e3\u30c3\u30c8\u30eb\u30fc\u30e0\u5b9f\u88c5\uff01\n# \u7d4c\u7def\n[\u524d\u56deslack\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8abf\u3079\u305f\u6642](http://qiita.com/mito_log/items/68da5f5be6545113adf7)\u306bweb\u30bd\u30b1\u30c3\u30c8\u30e9\u30a4\u30d6\u30e9\u30ea\u3001[rocketsocket](https://github.com/square/SocketRocket)\u304c\u5165\u3063\u3066\u3044\u3066\u3001\u9762\u767d\u305d\u3046\u3060\u306a\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u65e9\u901f\u4f7f\u3063\u3066\u307f\u3088\u3046\u304b\u3068\u3002web\u30bd\u30b1\u30c3\u30c8\u3068\u3044\u3048\u3070\u30c1\u30e3\u30c3\u30c8\uff01\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u3001\u305d\u306e\u307e\u3093\u307esocketrocket\u3092\u898b\u3066\u307f\u305f\u3093\u3067\u3059\u304c\u3001\u7406\u89e3\u30bc\u30ed\u304b\u3089\u30c1\u30e3\u30c3\u30c8\u3084\u308d\u3046\u3068\u3059\u308b\u3068\u3001\u7d50\u69cb\u5927\u5909\u305d\u3046\u3060\u306a...\u3068\u601d\u3044\u3001socket.io\u306b[rooms](http://socket.io/docs/rooms-and-namespaces/)\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3092\u307f\u3064\u3051\u307e\u3057\u305f\u3002\u304a\u3001\u3053\u308c\u306f\u4f7f\u3048\u305d\u3046\u3060\u3068\u8abf\u3079\u3066\u884c\u3063\u305f\u3089\u3001iOS\u3067\u3082webView\u3067socket.io\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u66f8\u3044\u3066\u304f\u308c\u3066\u3044\u308b\u4eba\u304c\u3044\u307e\u3057\u305f\u3002[SIOSocket](https://github.com/MegaBits/SIOSocket)\u3068\u3044\u3046\u3084\u3064\u3067\u3059\u3002\u3053\u308c\u306f\u3044\u3051\u305d\u3046\u3060\u306a\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u7d50\u679c\u3001\u308f\u308a\u3068\u5927\u5909\u3067\u3057\u305f\u304c\u3001\u306a\u3093\u3068\u304b\u52d5\u304f\u3082\u306e\u306f\u3067\u304d\u305f\u304b\u306a\u30fc\u3068\u304a\u3082\u3063\u305f\u306e\u3067\u30a2\u30c3\u30d7\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u3067\u304d\u305f\u3082\u306e\n\u306a\u3093\u304b\u3073\u307f\u3087\u30fc\u306a\u4ed5\u69d8\u3067\u3059\u304c...\n\n - \u30a2\u30d7\u30ea\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u81ea\u5206\u306eroom\u306b\u5165\u308b\n - \u4eca\u306e\u3068\u3053\u308d\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u306e\u52d5\u4f5c\u306e\u307f\uff08\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u306f\u6c17\u304c\u5411\u3044\u305f\u3089...)\n - \u3082\u3057\u4ed6\u306e\u4eba\u3082\u30a2\u30d7\u30ea\u3092\u7acb\u3061\u4e0a\u3052\u3066\u3044\u308c\u3070\u5de6\u5074\u306e\u30c9\u30ed\u30ef\u30fc\u306b\u3067\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u3053\u304b\u3089\u9078\u629e\u3057\u3066join\u3067\u304d\u307e\u3059\u3002\u540c\u6642\u306b\u8907\u6570\u306eroom\u306bjoin\u3067\u304d\u307e\u3059\u3002\n\n\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u30d0\u30fc\u306e\u30bf\u30a4\u30c8\u30eb\u306e\u90e8\u5206\u304c\u3044\u308f\u3086\u308b\u90e8\u5c4b\u306e\u540d\u524d\u3067\u3059...\u4fbf\u5b9c\u4e0asocket id\u306b\u3057\u3066\u308b\u306e\u3067\u3001\u7121\u6a5f\u8cea\u6975\u307e\u308a\u306a\u3044\u3067\u3059\u3002\u540d\u524d\u3068\u304b\u5439\u304d\u51fa\u3057\u306e\u4e0b\u306b\u51fa\u305b\u308c\u3070\u3088\u304b\u3063\u305f\u3067\u3059\u3002\u8ffd\u3005\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\u203b \u3061\u306a\u307f\u306b\u3053\u306e\u30d5\u30ad\u30c0\u30b7\u306f [JSQMessagesViewController](https://github.com/jessesquires/JSQMessagesViewController) \u3068\u3044\u3046\u3082\u306e\u3092\u3064\u304b\u3063\u3066\u3044\u307e\u3059\uff01\u4f7f\u3044\u65b9\u306f\u3001[Developer.IO\u3055\u3093\u306e\u8a18\u4e8b](http://dev.classmethod.jp/smartphone/iphone/jsq-messages-view-controller/)\u3092\u3054\u53c2\u8003\u306b\u3002\n\n![iOS Simulator Screen Shot Mar 17, 2015, 07.07.15.png](https://qiita-image-store.s3.amazonaws.com/0/46489/1132e574-cd11-77db-65ee-53929c42a3ac.png)\n\n\u304a\u90e8\u5c4b\u4e00\u89a7\u304c\u307f\u3048\u307e\u3059\u3002\u4e00\u5fdc\u30cb\u30c3\u30af\u30cd\u30fc\u30e0\u306e\u5909\u66f4\u3082\u3067\u304d\u307e\u3059\u3002\n![iOS Simulator Screen Shot Mar 17, 2015, 07.05.34.png](https://qiita-image-store.s3.amazonaws.com/0/46489/1985a3b2-77bd-6fd7-176b-873752afde18.png)\n\n\n# \u7528\u610f\u3057\u305f\u3082\u306e\n###### ()\u306e\u4e2d\u306f\u4eca\u56de\u5229\u7528\u3057\u305fversion\u306a\u3069\n - ec2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 (Amazon Linux AMI release 2014.09)\n - node.js (v0.12.0)\n - socket.io (1.3.5)\n\n# \u69cb\u6210\n\n\u4eca\u56de\u306f\u3001iOS\u30a2\u30d7\u30ea\u4e0a\u306eSIOSocket <-> ec2\u4e0a\u306enode\u30b5\u30fc\u30d0 with socket.io \u3063\u3066\u611f\u3058\u3067\u3084\u3063\u3066\u307f\u307e\u3059\u3002vagrant\u3060\u3068\u611f\u52d5\u304c\u591a\u5c11\u6e1b\u308b\u306e\u3067\u3001ec2\u306b\u7f6e\u3044\u3066\u30ea\u30a2\u30eb\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u3067\u3002\n\n# \u624b\u9806\n## 1. node\u30b5\u30fc\u30d0\u3092\u7528\u610f\nwebsocket\u901a\u4fe1\u3067\u306ftcp3000\u756a\u30dd\u30fc\u30c8\u3092\u4f7f\u3046\u306e\u3067\u305d\u3053\u3060\u3051\u958b\u3051\u308b\u3088\u3046\u306b\u6ce8\u610f\n\n![Screen Shot 2015-03-06 at 16.44.45.png](https://qiita-image-store.s3.amazonaws.com/0/46489/63c1ef18-2dc1-5a23-c6be-bb86a1831008.png)\n\n```bash\n# nodebrew\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget git.io/nodebrew\nperl nodebrew setup\n\n# nodebrew\u306e\u30d1\u30b9\u3092\u901a\u3059\nvim ~/.bashrc\nPATH=$HOME/.nodebrew/current/bin:$PATH\n\n# node\u306e\u6700\u65b0\u5b89\u5b9a\u7248(\u30d0\u30a4\u30ca\u30ea)\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnodebrew install-binary stable\n# ls\u3057\u3066\u51fa\u3066\u304d\u305f\u3082\u306e\u3092use\nnodebrew ls\nnodebrew use v0.12.0\n# \u4e0a\u8a18version\u304c\u51fa\u3066\u304d\u305f\u3089\u6210\u529f\nnode -v\n\n# \u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\nmkdir ~/SIOChatServer\ncd ~/SIOChatServer\n\n# socket.io\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnpm install socket.io\n```\n\nnode\u7528\u30b5\u30fc\u30d0\u306bscp\u3067server.js\u3092\u914d\u7f6e\n\n```bash\nscp -i path/to/your.pem server.js ec2-user@yourhostname:/home/ec2-user/SIOChatServer\n```\n\n\u3042\u3068\u306f\u5b9f\u884c\u3059\u308b\u3060\u3051\u3002\u306e\u306f\u305a\u3002\n\n```bash\n# node\u30b5\u30fc\u30d0\u5b9f\u884c (\u30c7\u30d0\u30c3\u30b0\u3057\u305f\u3044\u5834\u5408\u306f DEBUG*= node server \u4f7f\u3046\u3068\u3044\u3044\u304b\u3082)\nnode server\n```\n\n## 2. \u30a2\u30d7\u30ea\u306e\u30bd\u30fc\u30b9\u3092\u6e96\u5099\n[https://github.com/mitolog/SIOChat](https://github.com/mitolog/SIOChat) \n\u3053\u3061\u3089\u306b\u30bd\u30fc\u30b9\u3092\u4e0a\u3052\u305f\u306e\u3067\u3001clone\u3057\u3066\u4f7f\u3063\u3066\u4e0b\u3055\u3044\u3002\u305d\u306e\u969b\u3001**AppConst.h**\u30d5\u30a1\u30a4\u30eb\u306e**kWebSocketHostName**\u3092\u9069\u5b9c\u3054\u81ea\u8eab\u306e\u3082\u306e\u306b\u5909\u3048\u3066\u304f\u3060\u3055\u3044\u3002\u305d\u306e\u969b\u3001\u30b9\u30ad\u30fc\u30de\u3092`ws://`\u306b\u3057\u3068\u3044\u305f\u307b\u3046\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u3068\u30dd\u30fc\u30c8\u6307\u5b9a\u3082\u3002\n\n# WebSocket\u901a\u4fe1\u3092\u62c5\u3063\u3066\u3044\u308b\u7b87\u6240\n\n## \u30a2\u30d7\u30ea\u5074\n\nWebSocket\u306e\u53d7\u3051\u5074\u306f\u3001SIOSocket\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4e00\u767a\u3067\u3059\u3002\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092blocks\u306e\u4e2d\u3067\u5b9a\u7fa9\u3057\u3066\u3042\u3052\u3066\u307e\u3059\u3002\n\n```objc:ChatViewController.h\n- (void)connectWs\n{\n    // Close existing connection if needed\n    if(self.socket){ [self.socket close];}\n    \n    [SIOSocket socketWithHost: kWebSocketHostName response: ^(SIOSocket *socket){\n        \n        self.socket = socket;\n        \n        __weak typeof(self) weakSelf = self;\n        self.socket.onConnect = ^()\n        {\n            /* ~\u3053\u3053\u7701\u7565~ */\n            [weakSelf.socket emit: @\"init\" args: @[[param paramStr]]];\n        };\n        \n        [self.socket on: @\"join\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n        \n        [self.socket on: @\"update\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n        \n        [self.socket on: @\"rooms\" callback: ^(SIOParameterArray *args)\n         {\n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n        \n        [self.socket on: @\"disappear\" callback: ^(SIOParameterArray *args)\n         {                  \n             /* ~\u3053\u3053\u7701\u7565~ */\n         }];\n    }];\n}\n\n```\n\n\u4ed6\u306e\u30ce\u30fc\u30c9\u306b\u901a\u77e5\u3059\u308b\u5834\u5408\u306f\u3001\n\n```objc:ChatViewController.h\n[self.socket emit:@\"post\" args:@[[param paramStr]]];\n```\n\n\u3053\u3093\u306a\u3075\u3046\u306b\u304b\u3051\u307e\u3059\u3002\n\n## \u30b5\u30fc\u30d0\u5074\n\n\u3053\u308c\u3060\u3051\uff01\n\n```js:server.js\nvar io = require('socket.io')(3000);\n\nvar sepStr = ',';\nvar roomIdx = 0;\nvar isParentIdx = 1;\nvar nicknameIdx = 3;\nvar joinedRooms = [];\nvar nicknames = [];\n\nio.on('connection', function (socket) {\n\t\n    console.log(socket['id'] + ' has connected!');\n  \n    // join the specific room everytime socket connected\n    socket.on('init', function(data){\n        \n\tvar params = data.split(sepStr);\n        var isParent = params[isParentIdx];\n \tvar room = params[roomIdx]\n        var output = data;\t\n\n\tif(isParent == '1'){\n            room = socket['id'];\n\t    output = room;\n            output += data;\n\t    nicknames[socket['id']] = params[nicknameIdx];\n\t}else{\n            socket.join(room);\n\t}\n      \t\n\tjoinedRooms[socket['id']] = socket.rooms;\n \n\tio.emit('rooms', io.sockets.adapter.rooms);\n\tio.to(room).emit('join', output);\n\n        console.log('joined room ' + room);\n    });\n\n    // bradcast the specific room everytime someone posted some\n    socket.on('post', function (data) {\n        \n        console.log(socket['id'] + ' ' + data);\n\n        var room = data.split(sepStr)[roomIdx];\n        io.to(room).emit('update', data);\n    });\n    \n    // clients are disconnected automatically everytime they going background \n    socket.on('disconnect', function (data) {\n       \t\n\tio.emit('rooms', io.sockets.adapter.rooms);\n\t\n\tvar message = nicknames[socket['id']];\n\tmessage += ' left room';\n\tmessage += sepStr;\n\tvar prevJoinedRooms = joinedRooms[socket['id']];\n \tfor(var i=0; i<prevJoinedRooms.length; i++){\n\t    var room = prevJoinedRooms[i];\n\t    io.to(room).emit('disappear', message + room);\n\t    console.log(message + room);\n\t}\n        console.log(socket['id'] + ' has disconnected!');\n    });\n    \n});\n```\n\n\n# \u611f\u60f3\n - \u30a2\u30d7\u30ea\u3082\u30b5\u30fc\u30d0\u3082\u3001\u307e\u3060\u307e\u3060\u7121\u99c4\u306a\u30bd\u30fc\u30b9\u3042\u308b\u3093\u3067\u3059\u304c\u3001\u305d\u308c\u3067\u3082\u7d50\u69cb\u5c11\u306a\u3044\u30b3\u30fc\u30c9\u3067\u3059\u3093\u3060\u3068\u601d\u3063\u3066\u3044\u3066\u3001node\u3059\u3054\u3044\u306a\u30fcsocket.io\u3059\u3054\u3044\u306a\u30fc\u3068\u611f\u52d5\u3057\u307e\u3057\u305f\u3002\n\n - \u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30c1\u30e3\u30c3\u30c8\u304c\u98db\u3093\u3067\u304d\u305f\u6642\u306f\u3061\u3087\u3063\u3068\u611f\u52d5\u3057\u307e\u3057\u305f\u3002\n\n - slack\u3063\u3066\u3084\u3063\u3071\u308a\u3059\u3052\u30fc\u306a\u30fc...\n - [socket.io-redis](http://github.com/automattic/socket.io-redis)\u3068[socket.io-emitter](http://github.com/automattic/socket.io-emitter)\u3092\u4f7f\u3048\u3070socket.io\u4ee5\u5916\u306e\u30d7\u30ed\u30bb\u30b9\u304b\u3089socket.io\u306b\u30c7\u30fc\u30bf\u3092\u9001\u308c\u308b\u306e\u3067\u65e2\u5b58\u306ephp\u3068\u304brails\u306eAPI\u304b\u3089\u3067\u3082\u9023\u643a\u3067\u304d\u308b\u3057\u3001\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\u3082\u3067\u304d\u308b\u306e\u306f\u826f\u3044\u306e\u3067\u306f\u3002\n\n## \u53c2\u8003\n\n[Socket.io](http://socket.io/)\n\n[SIOSocket](https://github.com/mitolog/SIOChat)\n\n[(\u516c\u5f0f\u30da\u30fc\u30b8)Rooms and Namespaces](http://socket.io/docs/rooms-and-namespaces/)\n\n[WebSocket \u4e8b\u59cb\u3081 by Node.js + Socket.IO](http://qiita.com/ogwmtnr/items/f88c8b5433b5469322f1)\n\n[Node.js\u306b\u3066socket.io\u306ejoin\u3067\u30c1\u30e3\u30c3\u30c8\u30eb\u30fc\u30e0\u5b9f\u88c5\uff01](http://d.hatena.ne.jp/hekyou/20111222/p1)\n", "tags": ["Socket.io", "iOS", "JavaScript"]}