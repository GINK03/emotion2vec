{"context": "\u696d\u52d9\u3067\u30b5\u30a4\u30c8\u306b\u4eba\u6c17\u8a18\u4e8b\u30e9\u30f3\u30ad\u30f3\u30b0\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092 Google Analytics \u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\u81ea\u30b5\u30fc\u30d0\u30fc\u306bRedis\u306a\u3069\u3092\u5165\u308c\u3066PV\u30c7\u30fc\u30bf\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u304a\u304f\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001Google Analytics\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3048\u3070\u4efb\u610f\u306e\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u3084\u6307\u6a19\u3092\u4f7f\u3063\u305f\u96c6\u8a08\u304c\u7c21\u5358\u306b\u884c\u3048\u308b\u306e\u304c\u9b45\u529b\u3067\u3059\u3002\n\u65b9\u6cd5\u3092\u8abf\u3079\u3066\u3044\u3066\u3001\u3042\u307e\u308a\u65e5\u672c\u8a9e\u306e\u6700\u65b0\u306e\u60c5\u5831\u304c\u306a\u304f\u82e6\u52b4\u3057\u305f\u306e\u3067\u624b\u9806\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u524d\u63d0\n\nAPI \u306e\u8a8d\u8a3c\u65b9\u5f0f\u306f\u3001OAuth\u8a8d\u8a3c\u3068\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3069\u3061\u3089\u306e\u8a8d\u8a3c\u304c\u9069\u5207\u304b\u307e\u3060\u3088\u304f\u5206\u304b\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u5f8c\u65e5\u898b\u76f4\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\nG Suite \u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3067\u3001\u4f7f\u7528\u3067\u304d\u308b\u30c9\u30e1\u30a4\u30f3\u3084\u6a5f\u80fd\u3092\u9650\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u3046\u307e\u304f\u767b\u9332\u3067\u304d\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\nGoogle APIs \u304b\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u60c5\u5831\u3092\u767b\u9332\u3057\u3066 JSON \u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\nGoogle APIs \u306b\u30a2\u30af\u30bb\u30b9\nhttps://console.developers.google.com/apis\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u60c5\u5831\u3092\u5165\u529b\u3057\u3066\u3001\u4f5c\u6210\u3092\u62bc\u3059\n\n\u5de6\u30e1\u30cb\u30e5\u30fc\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u958b\u3044\u3066\u3001API \u306e\u691c\u7d22\u30dc\u30c3\u30af\u30b9\u304b\u3089 Analytics \u3067\u691c\u7d22Google Analytics Reporting API \u3092\u30af\u30ea\u30c3\u30af\n\n\u6709\u52b9\u306b\u3059\u308b \u3092\u30af\u30ea\u30c3\u30af\uff08\u6709\u52b9\u3058\u3083\u306a\u3044\u5834\u5408\uff09\n\n\u8a8d\u8a3c\u60c5\u5831\u3092\u4f5c\u6210\u3059\u308b \u3092\u30af\u30ea\u30c3\u30af\n\n\u8a8d\u8a3c\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\n\u4f7f\u7528\u3059\u308bAPI: Google Analytics Reporting API\nAPI \u3092\u547c\u3073\u51fa\u3059\u5834\u6240: \u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30c7\u30fc\u30bf\u306e\u7a2e\u985e: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\nGoogle App Engine \u304b Google Compute Engine \u306f\u4eca\u56de\u4f7f\u7528\u3057\u306a\u3044\n\u5fc5\u8981\u306a\u8a8d\u8a3c\u60c5\u5831\u3092\u30af\u30ea\u30c3\u30af\n\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u5165\u529b\u3002\u30ad\u30fc\u306e\u30bf\u30a4\u30d7\u306f\u3001JSON \u306b\u3059\u308b\n\n\u6b21\u3078\u3001\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3066\u3001json \u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\n\nJSON\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\n\u3053\u306eJSON\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\n{\n  \"type\": \"service_account\",\n  \"project_id\": \"my-project-152392889\",\n  \"private_key_id\": \"b2f97b9daec858a25b34ca8b6a99a0fb60e36836\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nxxxxxxxxxxxxxxxxx\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\": \"analytics-report@my-project-152392889.iam.gserviceaccount.com\",\n  \"client_id\": \"112337920347961566540\",\n  \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n  \"token_uri\": \"https://accounts.google.com/o/oauth2/token\",\n  \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\",\n  \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/analytics-report%40my-project-152392889.iam.gserviceaccount.com\"\n}\n\n\n\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u305f\u3044 Google Analytics \u306e\u30d3\u30e5\u30fc\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\nGoogle Analytics \u306e\u7ba1\u7406\u3092\u958b\u3044\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u3092\u30af\u30ea\u30c3\u30af\n\nJSON \u30d5\u30a1\u30a4\u30eb\u306e client_email \u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u3001\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u8ffd\u52a0\n\n\u30d3\u30e5\u30fc\u306eID\u3092\u53d6\u5f97\n\u7ba1\u7406 -> \u30d3\u30e5\u30fc\u8a2d\u5b9a\u304b\u3089\u3001\u30d3\u30e5\u30fcID \u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\n\n\nRuby \u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u3001Google Analytics API \u3092\u53e9\u3044\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\nJSON \u30d5\u30a1\u30a4\u30eb\u306f\u3001google-auth-cred.json \u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u3001Ruby \u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\ngoogle-api-client \u304c\u5fc5\u8981\u3067\u3059\u306e\u3067\u5165\u308c\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://github.com/google/google-api-ruby-client\ngem 'google-api-client', '~> 0.9'\n\n\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\nGoogle::Apis::AnalyticsreportingV4 \u306e\u4f7f\u3044\u65b9\u306f http://www.rubydoc.info/github/google/google-api-ruby-client/Google/Apis/AnalyticsreportingV4 \u3092\u53c2\u8003\u306b\u3002\nrequire 'googleauth/stores/redis_token_store'\nrequire 'google/apis/analyticsreporting_v4'\n\nview_id = '123456789'\nscope = ['https://www.googleapis.com/auth/analytics.readonly']\nanalytics =Google::Apis::AnalyticsreportingV4\n\nclient = analytics::AnalyticsReportingService.new\nclient.authorization = Google::Auth::ServiceAccountCredentials.make_creds(\n  json_key_io: File.open('google-auth-cred.json'),\n  scope: scope\n)\n\ndate_range = analytics::DateRange.new(start_date: '7DaysAgo', end_date: 'today')\nmetric = analytics::Metric.new(expression: 'ga:sessions', alias: 'sessions')\ndimension = analytics::Dimension.new(name: 'ga:browser')\nrequest = analytics::GetReportsRequest.new(\n  report_requests: [analytics::ReportRequest.new(\n    view_id: view_id, metrics: [metric], dimensions: [dimension], date_ranges: [date_range]\n  )]\n)\nresponse = client.batch_get_reports(request)\n\nresponse.reports\n\n\u53d6\u5f97\u3067\u304d\u308b\u623b\u308a\u5024\u306e\u30b5\u30f3\u30d7\u30eb\n> response.to_h\n=> {:reports=>\n  [{:column_header=>{:dimensions=>[\"ga:browser\"], :metric_header=>{:metric_header_entries=>[{:type=>\"INTEGER\", :name=>\"sessions\"}]}},\n    :data=>\n     {:row_count=>24,\n      :maximums=>[{:values=>[\"95666\"]}],\n      :minimums=>[{:values=>[\"1\"]}],\n      :rows=>\n       [{:dimensions=>[\"Amazon Silk\"], :metrics=>[{:values=>[\"43\"]}]},\n        {:dimensions=>[\"Android Browser\"], :metrics=>[{:values=>[\"4642\"]}]},\n        {:dimensions=>[\"Android Webview\"], :metrics=>[{:values=>[\"6372\"]}]},\n        {:dimensions=>[\"BlackBerry\"], :metrics=>[{:values=>[\"8\"]}]},\n        {:dimensions=>[\"Camino\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"Chrome\"], :metrics=>[{:values=>[\"35649\"]}]},\n        {:dimensions=>[\"Coc Coc\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"DoCoMo\"], :metrics=>[{:values=>[\"42\"]}]},\n        {:dimensions=>[\"Edge\"], :metrics=>[{:values=>[\"7255\"]}]},\n        {:dimensions=>[\"Firefox\"], :metrics=>[{:values=>[\"1664\"]}]},\n        {:dimensions=>[\"IE with Chrome Frame\"], :metrics=>[{:values=>[\"3\"]}]},\n        {:dimensions=>[\"Internet Explorer\"], :metrics=>[{:values=>[\"22139\"]}]},\n        {:dimensions=>[\"Iron\"], :metrics=>[{:values=>[\"3\"]}]},\n        {:dimensions=>[\"Lunascape\"], :metrics=>[{:values=>[\"12\"]}]},\n        {:dimensions=>[\"Mozilla\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"Mozilla Compatible Agent\"], :metrics=>[{:values=>[\"2\"]}]},\n        {:dimensions=>[\"Nintendo Browser\"], :metrics=>[{:values=>[\"11\"]}]},\n        {:dimensions=>[\"Opera\"], :metrics=>[{:values=>[\"87\"]}]},\n        {:dimensions=>[\"Opera Mini\"], :metrics=>[{:values=>[\"18\"]}]},\n        {:dimensions=>[\"Playstation Vita Browser\"], :metrics=>[{:values=>[\"7\"]}]},\n        {:dimensions=>[\"Puffin\"], :metrics=>[{:values=>[\"9\"]}]},\n        {:dimensions=>[\"Safari\"], :metrics=>[{:values=>[\"95666\"]}]},\n        {:dimensions=>[\"Safari (in-app)\"], :metrics=>[{:values=>[\"7624\"]}]},\n        {:dimensions=>[\"UC Browser\"], :metrics=>[{:values=>[\"3\"]}]}],\n      :totals=>[{:values=>[\"181262\"]}]}}]}\n\n\n\u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\n\nhttps://github.com/google/google-api-ruby-client\nhttp://qiita.com/ryurock/items/35cbdbd4f693fdc79bf8\nhttps://github.com/google/google-api-ruby-client/issues/489\n\n\u696d\u52d9\u3067\u30b5\u30a4\u30c8\u306b\u4eba\u6c17\u8a18\u4e8b\u30e9\u30f3\u30ad\u30f3\u30b0\u3092\u5b9f\u88c5\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092 Google Analytics \u304b\u3089\u53d6\u5f97\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\u81ea\u30b5\u30fc\u30d0\u30fc\u306bRedis\u306a\u3069\u3092\u5165\u308c\u3066PV\u30c7\u30fc\u30bf\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u304a\u304f\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\u304c\u3001Google Analytics\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u3048\u3070\u4efb\u610f\u306e\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u3084\u6307\u6a19\u3092\u4f7f\u3063\u305f\u96c6\u8a08\u304c\u7c21\u5358\u306b\u884c\u3048\u308b\u306e\u304c\u9b45\u529b\u3067\u3059\u3002\n\n\u65b9\u6cd5\u3092\u8abf\u3079\u3066\u3044\u3066\u3001\u3042\u307e\u308a\u65e5\u672c\u8a9e\u306e\u6700\u65b0\u306e\u60c5\u5831\u304c\u306a\u304f\u82e6\u52b4\u3057\u305f\u306e\u3067\u624b\u9806\u3092\u66f8\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n# \u524d\u63d0\n- API \u306e\u8a8d\u8a3c\u65b9\u5f0f\u306f\u3001OAuth\u8a8d\u8a3c\u3068\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3069\u3061\u3089\u306e\u8a8d\u8a3c\u304c\u9069\u5207\u304b\u307e\u3060\u3088\u304f\u5206\u304b\u3063\u3066\u3044\u306a\u3044\u305f\u3081\u5f8c\u65e5\u898b\u76f4\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n- G Suite \u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u3067\u3001\u4f7f\u7528\u3067\u304d\u308b\u30c9\u30e1\u30a4\u30f3\u3084\u6a5f\u80fd\u3092\u9650\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u3046\u307e\u304f\u767b\u9332\u3067\u304d\u306a\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n# Google APIs \u304b\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u8a8d\u8a3c\u60c5\u5831\u3092\u767b\u9332\u3057\u3066 JSON \u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\n\nGoogle APIs \u306b\u30a2\u30af\u30bb\u30b9\nhttps://console.developers.google.com/apis\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u3063\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n![API_\u30e9\u30a4\u30d6\u30e9\u30ea.png](https://qiita-image-store.s3.amazonaws.com/0/108133/eeb47280-12c6-7e52-fa14-d36a285f85b1.png)\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u60c5\u5831\u3092\u5165\u529b\u3057\u3066\u3001\u4f5c\u6210\u3092\u62bc\u3059\n![API_\u30e9\u30a4\u30d6\u30e9\u30ea.png](https://qiita-image-store.s3.amazonaws.com/0/108133/6a5344f1-fef8-7a8f-4a09-713625846ae4.png)\n\n\u5de6\u30e1\u30cb\u30e5\u30fc\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u958b\u3044\u3066\u3001API \u306e\u691c\u7d22\u30dc\u30c3\u30af\u30b9\u304b\u3089 Analytics \u3067\u691c\u7d22Google Analytics Reporting API \u3092\u30af\u30ea\u30c3\u30af\n![API_\u30e9\u30a4\u30d6\u30e9\u30ea_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/6c141451-ce6e-958d-d862-05c4140142ed.png)\n\n\u6709\u52b9\u306b\u3059\u308b \u3092\u30af\u30ea\u30c3\u30af\uff08\u6709\u52b9\u3058\u3083\u306a\u3044\u5834\u5408\uff09\n![API_Manager_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/a576c916-38dd-b544-ab0e-b6ebd43d5105.png)\n\n\u8a8d\u8a3c\u60c5\u5831\u3092\u4f5c\u6210\u3059\u308b \u3092\u30af\u30ea\u30c3\u30af\n![API_Manager_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/0b3bab6b-3d3f-0722-86f9-cf7a977dc90b.png)\n\n\u8a8d\u8a3c\u60c5\u5831\u3092\u5165\u529b\u3059\u308b\n\u4f7f\u7528\u3059\u308bAPI: Google Analytics Reporting API\nAPI \u3092\u547c\u3073\u51fa\u3059\u5834\u6240: \u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\n\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30c7\u30fc\u30bf\u306e\u7a2e\u985e: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30c7\u30fc\u30bf\nGoogle App Engine \u304b Google Compute Engine \u306f\u4eca\u56de\u4f7f\u7528\u3057\u306a\u3044\n\u5fc5\u8981\u306a\u8a8d\u8a3c\u60c5\u5831\u3092\u30af\u30ea\u30c3\u30af\n![\u8a8d\u8a3c\u60c5\u5831\u30a6\u30a3\u30b6\u30fc\u30c9_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/4c156861-673b-0552-37b6-ca26e52be470.png)\n\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\u30b5\u30fc\u30d3\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u3092\u5165\u529b\u3002\u30ad\u30fc\u306e\u30bf\u30a4\u30d7\u306f\u3001JSON \u306b\u3059\u308b\n![\u8a8d\u8a3c\u60c5\u5831\u30a6\u30a3\u30b6\u30fc\u30c9_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/41b0f316-607f-7640-8640-53dafd0ec2be.png)\n\n\u6b21\u3078\u3001\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3066\u3001json \u30d5\u30a1\u30a4\u30eb\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u308b\n![\u8a8d\u8a3c\u60c5\u5831\u30a6\u30a3\u30b6\u30fc\u30c9_-_My_Project.png](https://qiita-image-store.s3.amazonaws.com/0/108133/ab9abd05-e143-111c-d23c-cac25a13f089.png)\n\nJSON\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\n\u3053\u306eJSON\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u8aad\u307f\u8fbc\u3093\u3067\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```js\n{\n  \"type\": \"service_account\",\n  \"project_id\": \"my-project-152392889\",\n  \"private_key_id\": \"b2f97b9daec858a25b34ca8b6a99a0fb60e36836\",\n  \"private_key\": \"-----BEGIN PRIVATE KEY-----\\nxxxxxxxxxxxxxxxxx\\n-----END PRIVATE KEY-----\\n\",\n  \"client_email\": \"analytics-report@my-project-152392889.iam.gserviceaccount.com\",\n  \"client_id\": \"112337920347961566540\",\n  \"auth_uri\": \"https://accounts.google.com/o/oauth2/auth\",\n  \"token_uri\": \"https://accounts.google.com/o/oauth2/token\",\n  \"auth_provider_x509_cert_url\": \"https://www.googleapis.com/oauth2/v1/certs\",\n  \"client_x509_cert_url\": \"https://www.googleapis.com/robot/v1/metadata/x509/analytics-report%40my-project-152392889.iam.gserviceaccount.com\"\n}\n```\n\n# \u30c7\u30fc\u30bf\u3092\u53d6\u308a\u305f\u3044 Google Analytics \u306e\u30d3\u30e5\u30fc\u306b\u3001\u30e6\u30fc\u30b6\u30fc\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8ffd\u52a0\nGoogle Analytics \u306e\u7ba1\u7406\u3092\u958b\u3044\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u3092\u30af\u30ea\u30c3\u30af\n![\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9.png](https://qiita-image-store.s3.amazonaws.com/0/108133/827432ac-457c-efed-d372-15a21a547124.png)\n\nJSON \u30d5\u30a1\u30a4\u30eb\u306e client_email \u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u3001\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3068\u3057\u3066\u8ffd\u52a0\n![\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9.png](https://qiita-image-store.s3.amazonaws.com/0/108133/6da56dc5-8795-518c-9346-c40ed0dc7268.png)\n\n\u30d3\u30e5\u30fc\u306eID\u3092\u53d6\u5f97\n\u7ba1\u7406 -> \u30d3\u30e5\u30fc\u8a2d\u5b9a\u304b\u3089\u3001\u30d3\u30e5\u30fcID \u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\n![\u30a2\u30ca\u30ea\u30c6\u30a3\u30af\u30b9.png](https://qiita-image-store.s3.amazonaws.com/0/108133/5b565a93-64eb-9c96-ec77-b678ef2398c6.png)\n\n# Ruby \u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u3001Google Analytics API \u3092\u53e9\u3044\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\nJSON \u30d5\u30a1\u30a4\u30eb\u306f\u3001google-auth-cred.json \u3068\u3044\u3046\u540d\u524d\u306b\u3057\u3066\u3001Ruby \u30d7\u30ed\u30b0\u30e9\u30e0\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\ngoogle-api-client \u304c\u5fc5\u8981\u3067\u3059\u306e\u3067\u5165\u308c\u3066\u304a\u304d\u307e\u3059\u3002\nhttps://github.com/google/google-api-ruby-client\n\n```rb\ngem 'google-api-client', '~> 0.9'\n```\n\n\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b0\u30e9\u30e0\nGoogle::Apis::AnalyticsreportingV4 \u306e\u4f7f\u3044\u65b9\u306f http://www.rubydoc.info/github/google/google-api-ruby-client/Google/Apis/AnalyticsreportingV4 \u3092\u53c2\u8003\u306b\u3002\n\n```rb\nrequire 'googleauth/stores/redis_token_store'\nrequire 'google/apis/analyticsreporting_v4'\n\nview_id = '123456789'\nscope = ['https://www.googleapis.com/auth/analytics.readonly']\nanalytics =Google::Apis::AnalyticsreportingV4\n\nclient = analytics::AnalyticsReportingService.new\nclient.authorization = Google::Auth::ServiceAccountCredentials.make_creds(\n  json_key_io: File.open('google-auth-cred.json'),\n  scope: scope\n)\n\ndate_range = analytics::DateRange.new(start_date: '7DaysAgo', end_date: 'today')\nmetric = analytics::Metric.new(expression: 'ga:sessions', alias: 'sessions')\ndimension = analytics::Dimension.new(name: 'ga:browser')\nrequest = analytics::GetReportsRequest.new(\n  report_requests: [analytics::ReportRequest.new(\n    view_id: view_id, metrics: [metric], dimensions: [dimension], date_ranges: [date_range]\n  )]\n)\nresponse = client.batch_get_reports(request)\n\nresponse.reports\n```\n\n\u53d6\u5f97\u3067\u304d\u308b\u623b\u308a\u5024\u306e\u30b5\u30f3\u30d7\u30eb\n\n```\n> response.to_h\n=> {:reports=>\n  [{:column_header=>{:dimensions=>[\"ga:browser\"], :metric_header=>{:metric_header_entries=>[{:type=>\"INTEGER\", :name=>\"sessions\"}]}},\n    :data=>\n     {:row_count=>24,\n      :maximums=>[{:values=>[\"95666\"]}],\n      :minimums=>[{:values=>[\"1\"]}],\n      :rows=>\n       [{:dimensions=>[\"Amazon Silk\"], :metrics=>[{:values=>[\"43\"]}]},\n        {:dimensions=>[\"Android Browser\"], :metrics=>[{:values=>[\"4642\"]}]},\n        {:dimensions=>[\"Android Webview\"], :metrics=>[{:values=>[\"6372\"]}]},\n        {:dimensions=>[\"BlackBerry\"], :metrics=>[{:values=>[\"8\"]}]},\n        {:dimensions=>[\"Camino\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"Chrome\"], :metrics=>[{:values=>[\"35649\"]}]},\n        {:dimensions=>[\"Coc Coc\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"DoCoMo\"], :metrics=>[{:values=>[\"42\"]}]},\n        {:dimensions=>[\"Edge\"], :metrics=>[{:values=>[\"7255\"]}]},\n        {:dimensions=>[\"Firefox\"], :metrics=>[{:values=>[\"1664\"]}]},\n        {:dimensions=>[\"IE with Chrome Frame\"], :metrics=>[{:values=>[\"3\"]}]},\n        {:dimensions=>[\"Internet Explorer\"], :metrics=>[{:values=>[\"22139\"]}]},\n        {:dimensions=>[\"Iron\"], :metrics=>[{:values=>[\"3\"]}]},\n        {:dimensions=>[\"Lunascape\"], :metrics=>[{:values=>[\"12\"]}]},\n        {:dimensions=>[\"Mozilla\"], :metrics=>[{:values=>[\"1\"]}]},\n        {:dimensions=>[\"Mozilla Compatible Agent\"], :metrics=>[{:values=>[\"2\"]}]},\n        {:dimensions=>[\"Nintendo Browser\"], :metrics=>[{:values=>[\"11\"]}]},\n        {:dimensions=>[\"Opera\"], :metrics=>[{:values=>[\"87\"]}]},\n        {:dimensions=>[\"Opera Mini\"], :metrics=>[{:values=>[\"18\"]}]},\n        {:dimensions=>[\"Playstation Vita Browser\"], :metrics=>[{:values=>[\"7\"]}]},\n        {:dimensions=>[\"Puffin\"], :metrics=>[{:values=>[\"9\"]}]},\n        {:dimensions=>[\"Safari\"], :metrics=>[{:values=>[\"95666\"]}]},\n        {:dimensions=>[\"Safari (in-app)\"], :metrics=>[{:values=>[\"7624\"]}]},\n        {:dimensions=>[\"UC Browser\"], :metrics=>[{:values=>[\"3\"]}]}],\n      :totals=>[{:values=>[\"181262\"]}]}}]}\n```\n\n# \u53c2\u8003\u306b\u3057\u305f\u30da\u30fc\u30b8\n- https://github.com/google/google-api-ruby-client\n- http://qiita.com/ryurock/items/35cbdbd4f693fdc79bf8\n- https://github.com/google/google-api-ruby-client/issues/489\n", "tags": ["Ruby", "GoogleAnalytics", "api"]}