{"tags": ["test", "PHPUnit", "Silex", "PHP"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002Symfony\u52c9\u5f37\u4f1a #10 \u306e Silex \u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\u3067\u30c6\u30b9\u30c8\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\nTesting - Documentation - Silex - The PHP micro-framework based on Symfony2 Components \u3092\u53c2\u8003\u306b\u3001Silex \u306e\u7c21\u5358\u306a\u30b3\u30fc\u30c9\u3092 PHPUnit \u3067\u30c6\u30b9\u30c8\u3057\u3066\u307f\u3088\u3046\uff01\n\u4eca\u56de\u306e\u30b3\u30fc\u30c9\u306f https://github.com/hideyuki/silex-proj-symfony-study10 \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3067\u3059\u3002\napp.php\ncomposer.json\ncomposer.lock\nphpunit.xml\ntests/\n    indexTest.php\nvendor/\n    So many files...\nweb/\n    index.php\n\n\n\u30e1\u30a4\u30f3\u30b3\u30fc\u30c9 app.php\nCreating a simple REST application with Silex. \u3092\u53c2\u8003\u306b\u30a2\u30d7\u30ea\u90e8\u5206\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\napp.php \u3067\u306f $app->run() \u305b\u305a\u306b return $app \u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3002$app \u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3067 require \u3057\u307e\u3059\u3002\n\napp.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$app = new Silex\\Application();\n\n$toys = array(\n    '00001'=> array(\n        'name' => 'Racing Car',\n        'quantity' => '53',\n        'description' => '...',\n        'image' => 'racing_car.jpg',\n    ),  \n    '00002' => array(\n        'name' => 'Raspberry Pi',\n        'quantity' => '13',\n        'description' => '...',\n        'image' => 'raspberry_pi.jpg',\n    ),  \n);\n\n$app->get('/', function() use ($toys) {\n\n    return json_encode($toys);\n});\n\n$app->get('/{stockcode}', function (Silex\\Application $app, $stockcode) use ($toys) {\n\n    if (!isset($toys[$stockcode])) {\n        $app->abort(404, \"Stockcode {$stockcode} does not exist.\");\n    }   \n    return json_encode($toys[$stockcode]);\n});\n\nreturn $app;\n\n\n\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9 web/indexTest.php\ncreateApplication \u306b\u3066\u3001\u4e0a\u8a18\u306e $app \u3092\u751f\u6210\u3002\n\u305d\u3057\u3066\u3001testIndex \u306b\u30c6\u30b9\u30c8\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\ntests/indexTest.php\n<?php\n\nrequire_once __DIR__.'/../vendor/autoload.php';\n\nuse Silex\\WebTestCase;\n\nclass IndexTest extends WebTestCase\n{\n  public function createApplication()\n  {\n    $app = require __DIR__ . '/../app.php';\n\n    $app['debug'] = true;\n    $app['exception_handler']->disable();\n\n    return $app;\n  }\n\n  public function testIndex()\n  {\n    $client = $this->createClient();\n    $crawler = $client->request('GET', '/');\n\n    # ok?\n    $this->assertTrue($client->getResponse()->isOK());\n\n    # check count\n    $response = $client->getResponse();\n    $data = json_decode($response->getContent(), true);\n\n    $this->assertEquals(2, count($data));\n  }\n}\n\n\nPHPUnit \u306e\u5bfe\u8c61\u306f phpunit.xml \u306b\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002(tests \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b)\n\nphpunit.xml\n<phpunit>\n  <testsuites>\n    <testsuite name=\"Silex Test\">\n      <directory>tests</directory>\n    </testsuite>\n  </testsuites>\n</phpunit>\n\n\n\u305d\u3057\u3066 \u30c6\u30b9\u30c8\u5b9f\u884c\u3002PHPUnit\u306fcompsoer\u306b\u3088\u3063\u3066vendor\u306b\u5165\u3063\u3066\u3044\u307e\u3059\n$ ./vendor/bin/phpunit\n\nPHPUnit 4.1.4 by Sebastian Bergmann.\n\nConfiguration read from /Users/hide/github/silex-proj-symfony-study10/phpunit.xml\n\n.\n\nTime: 81 ms, Memory: 5.50Mb\n\nOK (1 test, 2 assertions)\n\n\u3053\u308c\u3067\u30c6\u30b9\u30c8\u304c\u3067\u304d\u307e\u3057\u305f\uff01\n\nAPPENDIX: \u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\n$app->run() \u306f\u3000web/index.php \u306b\u8a18\u8ff0\u3002\n\nweb/index.php\n<?php\n\nrequire_once __DIR__ . '/../vendor/autoload.php';\n\n$app = require __DIR__ . '/../app.php';\n$app['debug'] = true;\n$app->run();\n\n\n\u5b9f\u884c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9 (php5.4\u3067\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u3063\u305f\u3088\u3046\u3067\u3059)\n$ php -S localhost:8888 -t web\n\nPHP 5.5.15 Development Server started at Sun Jul 27 07:22:49 2014\nListening on http://localhost:8888\nDocument root is /Users/hide/github/silex-proj-symfony-study10/web\nPress Ctrl-C to quit.\n\n\u8a66\u3057\u306b localhost:8888 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n$ curl -i http://localhost:8888\n\nHTTP/1.1 200 OK\nHost: localhost:8888\nConnection: close\nX-Powered-By: PHP/5.5.15\nCache-Control: no-cache\nDate: Sat, 26 Jul 2014 22:23:03 GMT\nContent-Type: text/html; charset=UTF-8\n\n{\"00001\":{\"name\":\"Racing Car\",\"quantity\":\"53\",\"description\":\"...\",\"image\":\"racing_car.jpg\"},\"00002\":{\"name\":\"Raspberry Pi\",\"quantity\":\"13\",\"description\":\"...\",\"image\":\"raspberry_pi.jpg\"}}\n\nOK\uff01\n\n[Symfony\u52c9\u5f37\u4f1a #10](http://symfony.doorkeeper.jp/events/12539) \u306e Silex \u30ef\u30fc\u30af\u30b7\u30e7\u30c3\u30d7\u3067\u30c6\u30b9\u30c8\u307e\u3067\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n--- \n\n[Testing - Documentation - Silex - The PHP micro-framework based on Symfony2 Components](http://silex.sensiolabs.org/doc/testing.html) \u3092\u53c2\u8003\u306b\u3001Silex \u306e\u7c21\u5358\u306a\u30b3\u30fc\u30c9\u3092 PHPUnit \u3067\u30c6\u30b9\u30c8\u3057\u3066\u307f\u3088\u3046\uff01\n\n\u4eca\u56de\u306e\u30b3\u30fc\u30c9\u306f https://github.com/hideyuki/silex-proj-symfony-study10 \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n\n## \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3067\u3059\u3002\n\n```\napp.php\ncomposer.json\ncomposer.lock\nphpunit.xml\ntests/\n    indexTest.php\nvendor/\n    So many files...\nweb/\n    index.php\n```\n\n## \u30e1\u30a4\u30f3\u30b3\u30fc\u30c9 app.php\n\n[Creating a simple REST application with Silex.](http://sleep-er.co.uk/blog/2013/Creating-a-simple-REST-application-with-Silex/) \u3092\u53c2\u8003\u306b\u30a2\u30d7\u30ea\u90e8\u5206\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3057\u305f\u3002\n\napp.php \u3067\u306f `$app->run()` \u305b\u305a\u306b `return $app` \u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3002$app \u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3067 require \u3057\u307e\u3059\u3002\n\n```app.php\n<?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\n$app = new Silex\\Application();\n\n$toys = array(\n    '00001'=> array(\n        'name' => 'Racing Car',\n        'quantity' => '53',\n        'description' => '...',\n        'image' => 'racing_car.jpg',\n    ),  \n    '00002' => array(\n        'name' => 'Raspberry Pi',\n        'quantity' => '13',\n        'description' => '...',\n        'image' => 'raspberry_pi.jpg',\n    ),  \n);\n\n$app->get('/', function() use ($toys) {\n\n    return json_encode($toys);\n});\n\n$app->get('/{stockcode}', function (Silex\\Application $app, $stockcode) use ($toys) {\n\n    if (!isset($toys[$stockcode])) {\n        $app->abort(404, \"Stockcode {$stockcode} does not exist.\");\n    }   \n    return json_encode($toys[$stockcode]);\n});\n\nreturn $app;\n```\n\n## \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9 web/indexTest.php\n\n`createApplication` \u306b\u3066\u3001\u4e0a\u8a18\u306e $app \u3092\u751f\u6210\u3002\n\u305d\u3057\u3066\u3001`testIndex` \u306b\u30c6\u30b9\u30c8\u5185\u5bb9\u3092\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```tests/indexTest.php\n<?php\n\nrequire_once __DIR__.'/../vendor/autoload.php';\n\nuse Silex\\WebTestCase;\n\nclass IndexTest extends WebTestCase\n{\n  public function createApplication()\n  {\n    $app = require __DIR__ . '/../app.php';\n\n    $app['debug'] = true;\n    $app['exception_handler']->disable();\n\n    return $app;\n  }\n\n  public function testIndex()\n  {\n    $client = $this->createClient();\n    $crawler = $client->request('GET', '/');\n\n    # ok?\n    $this->assertTrue($client->getResponse()->isOK());\n\n    # check count\n    $response = $client->getResponse();\n    $data = json_decode($response->getContent(), true);\n\n    $this->assertEquals(2, count($data));\n  }\n}\n```\n\nPHPUnit \u306e\u5bfe\u8c61\u306f `phpunit.xml` \u306b\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002(tests \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b)\n\n```phpunit.xml\n<phpunit>\n  <testsuites>\n    <testsuite name=\"Silex Test\">\n      <directory>tests</directory>\n    </testsuite>\n  </testsuites>\n</phpunit>\n```\n\n\u305d\u3057\u3066 \u30c6\u30b9\u30c8\u5b9f\u884c\u3002PHPUnit\u306fcompsoer\u306b\u3088\u3063\u3066vendor\u306b\u5165\u3063\u3066\u3044\u307e\u3059\n\n```terminal\n$ ./vendor/bin/phpunit\n\nPHPUnit 4.1.4 by Sebastian Bergmann.\n\nConfiguration read from /Users/hide/github/silex-proj-symfony-study10/phpunit.xml\n\n.\n\nTime: 81 ms, Memory: 5.50Mb\n\nOK (1 test, 2 assertions)\n```\n\n\u3053\u308c\u3067\u30c6\u30b9\u30c8\u304c\u3067\u304d\u307e\u3057\u305f\uff01\n\n## APPENDIX: \u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u3067\u5b9f\u884c\n\n`$app->run()` \u306f\u3000web/index.php \u306b\u8a18\u8ff0\u3002\n\n```web/index.php\n<?php\n\nrequire_once __DIR__ . '/../vendor/autoload.php';\n\n$app = require __DIR__ . '/../app.php';\n$app['debug'] = true;\n$app->run();\n```\n\n\u5b9f\u884c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9 (php5.4\u3067\u30d3\u30eb\u30c8\u30a4\u30f3\u30b5\u30fc\u30d0\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u3063\u305f\u3088\u3046\u3067\u3059)\n\n```terminal\n$ php -S localhost:8888 -t web\n\nPHP 5.5.15 Development Server started at Sun Jul 27 07:22:49 2014\nListening on http://localhost:8888\nDocument root is /Users/hide/github/silex-proj-symfony-study10/web\nPress Ctrl-C to quit.\n```\n\n\u8a66\u3057\u306b localhost:8888 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3002\n\n```terminal\n$ curl -i http://localhost:8888\n\nHTTP/1.1 200 OK\nHost: localhost:8888\nConnection: close\nX-Powered-By: PHP/5.5.15\nCache-Control: no-cache\nDate: Sat, 26 Jul 2014 22:23:03 GMT\nContent-Type: text/html; charset=UTF-8\n\n{\"00001\":{\"name\":\"Racing Car\",\"quantity\":\"53\",\"description\":\"...\",\"image\":\"racing_car.jpg\"},\"00002\":{\"name\":\"Raspberry Pi\",\"quantity\":\"13\",\"description\":\"...\",\"image\":\"raspberry_pi.jpg\"}}\n```\n\nOK\uff01\n"}