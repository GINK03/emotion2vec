{"context": " More than 1 year has passed since last update.\u5168\u4e16\u754c10\u5104\u4eba\u306eAMIMOTO\u30d5\u30a1\u30f3\u306e\u7686\u69d8\u3053\u3093\u306b\u3061\u306f\uff01\n\u300cAMIMOTO Advent Calendar 2015\u300d 3\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\nWEB\u30b5\u30a4\u30c8\u3092AMIMOTO\u3067\u69cb\u7bc9\u3057\u3066\u3001\u30e1\u30fc\u30eb\u306f\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3084GoogleApps\u3001Office365\u306a\u3069\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001AMIMOTO\u306e\u304a\u304b\u3052\u3067ec2\u306e\u30b5\u30fc\u30d0\u30ea\u30bd\u30fc\u30b9\u304c\u307e\u3060\u307e\u3060\u4f59\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u304a\u91d1\u3092\u3059\u3053\u3057\u3067\u3082\u7bc0\u7d04\u3059\u308b\u305f\u3081\u306bAMIMOTO\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3092\u7a81\u3063\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u5bfe\u5fdc\u306a\u306e\u3067\u3001\uff11\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5185\u306e\u8907\u6570\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u3082\u305d\u308c\u305e\u308c\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u30e1\u30fc\u30eb\u74b0\u5883\u3092\u7528\u610f\u3067\u304d\u307e\u3059\u3002\n\n\u74b0\u5883\n\u30fbAMIMOTO HTTP2 ver.0.1 (2015-10-23)\u3000\u203b\u4ed6\u306e\u30bf\u30a4\u30d7\u3067\u3082\u57fa\u672c\u7684\u306b\u306f\u52d5\u304f\u306f\u305a\u3067\u3059\u3002\n\u30fbAmazonLinux2015.09\n\u30fbt2.micro\u3067\u3082\u52d5\u304f\n\u30fbpostfix+dovecot+postfixadmin+mysql\n\u30fb\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30db\u30b9\u30c8\u540d\uff1amail.hoge.jp\n\n\u69cb\u7bc9\n\u3068\u308a\u3042\u3048\u305a\u5168\u90e8root\u3067\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\nsudo su -\n\n\nmysql\u8a2d\u5b9a\n\u30e1\u30fc\u30eb\u7528\u306eDB\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nMySQL(Percona)\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306a\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001localhost\u304b\u3089root\u30e6\u30fc\u30b6\u30fc\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u3067\u3059\u3002\nmysql \nmysql> CREATE DATABASE postfix;\nmysql> GRANT ALL PRIVILEGES ON postfix.* TO 'postfix'@'localhost' IDENTIFIED BY 'mailpasswd';\nmysql> quit\n\n\npostfix\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\nSMTP\u30b5\u30fc\u30d0\u3068\u306a\u308bpostfix\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nyum install postfix\n\nvi /etc/postfix/main.cf\n--------------------\n#\u65e2\u5b58\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\nmyhostname = mail.hoge.jp\nmydomain = hoge.jp\ninet_interfaces = all\nmydestination = localhost\nmynetworks = 127.0.0.0/8\nhome_mailbox = Maildir\n\n\n##\u3053\u3053\u304b\u3089\u306f\u65b0\u305f\u306b\u8ffd\u8a18\n# Virtual mailbox settings\nvirtual_mailbox_domains = proxy:mysql:$config_directory/mysql_virtual_domains_maps.cf\nvirtual_mailbox_base = /var/vmail\nvirtual_mailbox_maps = proxy:mysql:$config_directory/mysql_virtual_mailbox_maps.cf\nvirtual_alias_maps = proxy:mysql:$config_directory/mysql_virtual_alias_maps.cf\nvirtual_minimum_uid = 150\nvirtual_uid_maps = static:150\nvirtual_gid_maps = static:12\n\n# SASL Authentication\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_exceptions_networks = $mynetworks\nsmtpd_sasl_security_options = noanonymous\nbroken_sasl_auth_clients = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination\n-------------------------\n\n\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8(587\u756a)\u3092\u89e3\u653e\u3057\u307e\u3059\u3002\nvi /etc/postfix/master.cf\n--------------------------\nsubmission inet n       -       n       -       -       smtpd\n--------------------------\n\nalternatives --config mta\n-----------\nThere are 2 programs which provide 'mta'.\n\n  Selection    Command\n-----------------------------------------------\n*+ 1           /usr/sbin/sendmail.sendmail\n   2           /usr/sbin/sendmail.postfix\n\nEnter to keep the current selection[+], or type selection number: 2 <=2\u3092\u5165\u529b\u3057\u3066postfix\u306b\u5909\u66f4\n---------\n\n\u30e1\u30fc\u30eb\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nuseradd -r -u 150 -g mail -d /var/vmail -s /sbin/nologin -c \"Virtual mailbox\" vmail\nmkdir /var/vmail\nchmod 770 /var/vmail/\nchown vmail:mail /var/vmail/\n\npostfix\u3068mysql\u3092\u9023\u643a\u3055\u305b\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nvi /etc/postfix/mysql_virtual_alias_maps.cf\n-------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = alias\nselect_field = goto\nwhere_field = address\nadditional_conditions = and active = '1'\n-----------\n\nvi /etc/postfix/mysql_virtual_domains_maps.cf\n-------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = domain\nselect_field = domain\nwhere_field = domain\nadditional_conditions = and backupmx = '0' and active = '1'\n-----------\n\nvi /etc/postfix/mysql_virtual_mailbox_limit_maps.cf\n-----------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = quota\nwhere_field = username\nadditional_conditions = and active = '1'\n-----------\n\n\nvi /etc/postfix/mysql_virtual_mailbox_maps.cf\n------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = CONCAT(domain,'/',maildir)\nwhere_field = username\nadditional_conditions = and active = '1'#query = SELECT CONCAT(domain,'/',maildir) FROM mailbox WHERE username='%s' Aactive = '1'\n-----------\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fsendmail\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\nsendmail\u3092\u505c\u6b62\u3057\u3066postfix\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n/etc/init.d/sendmail stop\n/etc/init.d/postfix start\nchkconfig sendmail off\nchkconfig postfix on\n\n\n\nDovecot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\npop3/imap4\u30b5\u30fc\u30d0\u3068\u306a\u308bDovecot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nyum -y install dovecot-mysql dovecot\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nvi /etc/dovecot/dovecot.conf\n------------------\nprotocols = imap pop3\n------------------\n\nvi /etc/dovecot/conf.d/10-auth.conf\n--------------------\ndisable_plaintext_auth = no\nauth_mechanisms = plain login\n#!include auth-system.conf.ext\n!include auth-sql.conf.ext\n--------------------\n\nvi /etc/dovecot/conf.d/10-mail.conf\n--------------------\nmail_location = maildir:~/\n\nfirst_valid_uid = 150\nlast_valid_uid = 150\n--------------------\n\nvi /etc/dovecot/conf.d/10-master.conf\n-------------------\n  # Postfix smtp-auth\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0666\n  }\n-------------------\n\nvi /etc/dovecot/dovecot-sql.conf.ext\n-----------------\ndriver = mysql\ndefault_pass_scheme = MD5\nconnect = dbname=postfix user=postfix host=/var/lib/mysql/mysql.sock password=mailpasswd\npassword_query = SELECT password FROM mailbox WHERE username = '%u' AND active = '1'\nuser_query = SELECT concat('/var/vmail/%d/', maildir) as home, 150 as uid, 12 as gid FROM mailbox WHERE username = '%u' AND active = '1'\n----------------\n\n\ndovecot\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n/etc/init.d/dovecot start\nchkconfig dovecot on\n\n\npotfixadmin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30c9\u30e1\u30a4\u30f3\u3084\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u7ba1\u7406\u3092\u884c\u3046\u305f\u3081\u306bpostfixadmin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ncd /usr/local/src/\nwget http://sourceforge.net/projects/postfixadmin/files/postfixadmin/postfixadmin-2.92/postfixadmin-2.92.tar.gz/download\ntar zxvf download\nmv postfixadmin-2.92 /var/www/postfixadmin\nchown -R nginx. /var/www/postfixadmin\n\nnginx\u3067potfixadmin\u3092\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\nvi /etc/nginx/postfixadmin\n----------------\n # postfixadmin\n    location /postfixadmin {\n        alias /var/www/postfixadmin;\n        index index.php;\n        include /etc/nginx/expires;\n\n        location ~ ^/postfixadmin/.+\\.php$ {\n            alias /var/www/postfixadmin;\n            fastcgi_pass   phpfpm;\n            fastcgi_index  index.php;\n            fastcgi_param  SCRIPT_FILENAME /var/www$fastcgi_script_name;\n            include        fastcgi_params;\n        }\n    }\n----------------\n\n\nvi /etc/nginx/conf.d/default-ssl.conf\n(http2\u30bf\u30a4\u30d7\u3067\u306a\u3044\u5834\u5408\u306f\u3001/etc/nginx/conf.d/default.conf\u3092\u7de8\u96c6)\n---------\n    include     /etc/nginx/postfixadmin;\n---------\n\n/etc/init.d/nginx restart\n\npostfixadmin\u306e\u57fa\u672c\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\nvi /var/www/postfixadmin/config.inc.php\n-----------------\n$CONF['configured'] = true;\n$CONF['database_type'] = 'mysql';\n$CONF['database_host'] = '127.0.0.1';\n$CONF['database_user'] = 'postfix';\n$CONF['database_password'] = 'mailpasswd';\n$CONF['database_name'] = 'postfix';\n-----------------\n\n\n\u8db3\u308a\u306a\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nyum install php-imap\n\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u8a2d\u5b9a\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u30fbhttp2\u30bf\u30a4\u30d7\nhttps://hostname/postfixadmin/setup.php\nhttp2\u30bf\u30a4\u30d7\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u81ea\u5df1\u8a3c\u660e\u306e\u305f\u3081\u8a3c\u660e\u66f8\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u304c\u3001\u30a8\u30e9\u30fc\u3092\u7121\u8996\u3057\u3066\u9032\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\u30fb\u305d\u308c\u4ee5\u5916\u306e\u30bf\u30a4\u30d7\nhttp://hostname/postfixadmin/setup.php\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u74b0\u5883\u306e\u30c1\u30a7\u30c3\u30af\u304c\u554f\u984c\u306a\u3051\u308c\u3070\u3001\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3057\u3066\u9032\u307f\u307e\u3059\u3002\n\n\u6b21\u306e\u753b\u9762\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30cf\u30c3\u30b7\u30e5\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30d4\u30fc\u3057\u3066\u30b5\u30fc\u30d0\u5185\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nvi /var/www/postfixadmin/config.inc.php\n-------------\n//$CONF['setup_password'] = 'changeme';\n$CONF['setup_password'] = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';\n-------------\n\n\n\u518d\u5ea6\u30d6\u30e9\u30a6\u30b6\u3078\u623b\u308a\u3001\u5148\u307b\u3069\u5165\u529b\u3057\u305f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u7ba1\u7406\u8005\u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3053\u308c\u3067\u521d\u671f\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3067\u3059\u3002\n\u7ba1\u7406\u8005\u306e\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u5165\u529b\u3057\u305f\u60c5\u5831\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\nhttps://hostname/postfixadmin/login.php\n(http://hostname/postfixadmin/login.php)\n\n\n\u5b8c\u6210\uff01\n\u3053\u308c\u3067\u81ea\u7531\u306b\u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3057\u305f\u308a\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u30c9\u30e1\u30a4\u30f3\u4f5c\u6210\n\n\u30a2\u30c9\u30ec\u30b9\u4f5c\u6210\n\n\u8ee2\u9001\u8a2d\u5b9a\n\n\n\u6ce8\u610f\u70b9\n\u30e1\u30fc\u30eb\u306e\u8a8d\u8a3c\u306fSMTP-AUTH\u3067\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u306f@\u4ee5\u964d\u3092\u542b\u3080\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5168\u4f53\u3068\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001TCP\u306e25/110/143/587\u756a\u30dd\u30fc\u30c8\u306e\u89e3\u653e\u304c\u5fc5\u8981\u3067\u3059\u3002\nec2\u3092\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001AWS\u30d8\u306e\u9006\u5f15\u304d\u7533\u8acb\u3001\u30e1\u30fc\u30eb\u9001\u4fe1\u7533\u8acb\u306a\u3069\u3082\u304a\u5fd8\u308c\u306a\u304f\u3002\n\u3053\u308c\u3067\u57fa\u672c\u7684\u306a\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u304c\u3067\u304d\u307e\u3059\u304c\u3001DKIM\u3001SPF\u3001\u6697\u53f7\u5316\u306a\u3069\u3082\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002\n\u305d\u3057\u3066\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u904b\u7528\u306f\u5927\u5909\u3067\u3059\u3002\n\u5168\u4e16\u754c10\u5104\u4eba\u306eAMIMOTO\u30d5\u30a1\u30f3\u306e\u7686\u69d8\u3053\u3093\u306b\u3061\u306f\uff01\n[\u300cAMIMOTO Advent Calendar 2015\u300d](http://www.adventar.org/calendars/1107) 3\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\nWEB\u30b5\u30a4\u30c8\u3092AMIMOTO\u3067\u69cb\u7bc9\u3057\u3066\u3001\u30e1\u30fc\u30eb\u306f\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u3084GoogleApps\u3001Office365\u306a\u3069\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u304c\u3001AMIMOTO\u306e\u304a\u304b\u3052\u3067ec2\u306e\u30b5\u30fc\u30d0\u30ea\u30bd\u30fc\u30b9\u304c\u307e\u3060\u307e\u3060\u4f59\u3063\u3066\u3044\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u304a\u91d1\u3092\u3059\u3053\u3057\u3067\u3082\u7bc0\u7d04\u3059\u308b\u305f\u3081\u306bAMIMOTO\u306e\u4e2d\u306b\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3092\u7a81\u3063\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u5bfe\u5fdc\u306a\u306e\u3067\u3001\uff11\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u5185\u306e\u8907\u6570\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u904b\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u306b\u3082\u305d\u308c\u305e\u308c\u306e\u30c9\u30e1\u30a4\u30f3\u306b\u30e1\u30fc\u30eb\u74b0\u5883\u3092\u7528\u610f\u3067\u304d\u307e\u3059\u3002\n\n#\u74b0\u5883\n\u30fbAMIMOTO HTTP2 ver.0.1 (2015-10-23)\u3000\u203b\u4ed6\u306e\u30bf\u30a4\u30d7\u3067\u3082\u57fa\u672c\u7684\u306b\u306f\u52d5\u304f\u306f\u305a\u3067\u3059\u3002\n\u30fbAmazonLinux2015.09\n\u30fbt2.micro\u3067\u3082\u52d5\u304f\n\u30fbpostfix+dovecot+postfixadmin+mysql\n\u30fb\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u30db\u30b9\u30c8\u540d\uff1amail.hoge.jp\n\n#\u69cb\u7bc9\n\n\u3068\u308a\u3042\u3048\u305a\u5168\u90e8root\u3067\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\n\n```\nsudo su -\n```\n\n##mysql\u8a2d\u5b9a\n\n\u30e1\u30fc\u30eb\u7528\u306eDB\u3092\u4f5c\u6210\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nMySQL(Percona)\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306a\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001localhost\u304b\u3089root\u30e6\u30fc\u30b6\u30fc\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u306f\u30d1\u30b9\u30ef\u30fc\u30c9\u4e0d\u8981\u3067\u3059\u3002\n\n```\nmysql \nmysql> CREATE DATABASE postfix;\nmysql> GRANT ALL PRIVILEGES ON postfix.* TO 'postfix'@'localhost' IDENTIFIED BY 'mailpasswd';\nmysql> quit\n```\n\n\n\n##postfix\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\nSMTP\u30b5\u30fc\u30d0\u3068\u306a\u308bpostfix\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```\nyum install postfix\n\nvi /etc/postfix/main.cf\n--------------------\n#\u65e2\u5b58\u306e\u8a2d\u5b9a\u3092\u5909\u66f4\nmyhostname = mail.hoge.jp\nmydomain = hoge.jp\ninet_interfaces = all\nmydestination = localhost\nmynetworks = 127.0.0.0/8\nhome_mailbox = Maildir\n\n\n##\u3053\u3053\u304b\u3089\u306f\u65b0\u305f\u306b\u8ffd\u8a18\n# Virtual mailbox settings\nvirtual_mailbox_domains = proxy:mysql:$config_directory/mysql_virtual_domains_maps.cf\nvirtual_mailbox_base = /var/vmail\nvirtual_mailbox_maps = proxy:mysql:$config_directory/mysql_virtual_mailbox_maps.cf\nvirtual_alias_maps = proxy:mysql:$config_directory/mysql_virtual_alias_maps.cf\nvirtual_minimum_uid = 150\nvirtual_uid_maps = static:150\nvirtual_gid_maps = static:12\n\n# SASL Authentication\nsmtpd_sasl_auth_enable = yes\nsmtpd_sasl_exceptions_networks = $mynetworks\nsmtpd_sasl_security_options = noanonymous\nbroken_sasl_auth_clients = yes\nsmtpd_sasl_type = dovecot\nsmtpd_sasl_path = private/auth\nsmtpd_recipient_restrictions = permit_mynetworks, permit_sasl_authenticated, reject_unauth_destination\n-------------------------\n\n\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8(587\u756a)\u3092\u89e3\u653e\u3057\u307e\u3059\u3002\nvi /etc/postfix/master.cf\n--------------------------\nsubmission inet n       -       n       -       -       smtpd\n--------------------------\n\nalternatives --config mta\n-----------\nThere are 2 programs which provide 'mta'.\n\n  Selection    Command\n-----------------------------------------------\n*+ 1           /usr/sbin/sendmail.sendmail\n   2           /usr/sbin/sendmail.postfix\n\nEnter to keep the current selection[+], or type selection number: 2 <=2\u3092\u5165\u529b\u3057\u3066postfix\u306b\u5909\u66f4\n---------\n```\n\n\u30e1\u30fc\u30eb\u7528\u306e\u30e6\u30fc\u30b6\u30fc\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nuseradd -r -u 150 -g mail -d /var/vmail -s /sbin/nologin -c \"Virtual mailbox\" vmail\nmkdir /var/vmail\nchmod 770 /var/vmail/\nchown vmail:mail /var/vmail/\n```\n\npostfix\u3068mysql\u3092\u9023\u643a\u3055\u305b\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nvi /etc/postfix/mysql_virtual_alias_maps.cf\n-------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = alias\nselect_field = goto\nwhere_field = address\nadditional_conditions = and active = '1'\n-----------\n\nvi /etc/postfix/mysql_virtual_domains_maps.cf\n-------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = domain\nselect_field = domain\nwhere_field = domain\nadditional_conditions = and backupmx = '0' and active = '1'\n-----------\n\nvi /etc/postfix/mysql_virtual_mailbox_limit_maps.cf\n-----------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = quota\nwhere_field = username\nadditional_conditions = and active = '1'\n-----------\n\n\nvi /etc/postfix/mysql_virtual_mailbox_maps.cf\n------------\nuser = postfix\npassword = mailpasswd\nhosts = localhost\ndbname = postfix\ntable = mailbox\nselect_field = CONCAT(domain,'/',maildir)\nwhere_field = username\nadditional_conditions = and active = '1'#query = SELECT CONCAT(domain,'/',maildir) FROM mailbox WHERE username='%s' Aactive = '1'\n-----------\n\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306fsendmail\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u306e\u3067\nsendmail\u3092\u505c\u6b62\u3057\u3066postfix\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n/etc/init.d/sendmail stop\n/etc/init.d/postfix start\nchkconfig sendmail off\nchkconfig postfix on\n\n```\n\n\n##Dovecot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\npop3/imap4\u30b5\u30fc\u30d0\u3068\u306a\u308bDovecot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\nyum -y install dovecot-mysql dovecot\n```\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```\nvi /etc/dovecot/dovecot.conf\n------------------\nprotocols = imap pop3\n------------------\n\nvi /etc/dovecot/conf.d/10-auth.conf\n--------------------\ndisable_plaintext_auth = no\nauth_mechanisms = plain login\n#!include auth-system.conf.ext\n!include auth-sql.conf.ext\n--------------------\n\nvi /etc/dovecot/conf.d/10-mail.conf\n--------------------\nmail_location = maildir:~/\n \nfirst_valid_uid = 150\nlast_valid_uid = 150\n--------------------\n\nvi /etc/dovecot/conf.d/10-master.conf\n-------------------\n  # Postfix smtp-auth\n  unix_listener /var/spool/postfix/private/auth {\n    mode = 0666\n  }\n-------------------\n\nvi /etc/dovecot/dovecot-sql.conf.ext\n-----------------\ndriver = mysql\ndefault_pass_scheme = MD5\nconnect = dbname=postfix user=postfix host=/var/lib/mysql/mysql.sock password=mailpasswd\npassword_query = SELECT password FROM mailbox WHERE username = '%u' AND active = '1'\nuser_query = SELECT concat('/var/vmail/%d/', maildir) as home, 150 as uid, 12 as gid FROM mailbox WHERE username = '%u' AND active = '1'\n----------------\n\n```\n\ndovecot\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n/etc/init.d/dovecot start\nchkconfig dovecot on\n```\n\n\n\n##potfixadmin\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb/\u8a2d\u5b9a\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u30c9\u30e1\u30a4\u30f3\u3084\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u7ba1\u7406\u3092\u884c\u3046\u305f\u3081\u306bpostfixadmin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\ncd /usr/local/src/\nwget http://sourceforge.net/projects/postfixadmin/files/postfixadmin/postfixadmin-2.92/postfixadmin-2.92.tar.gz/download\ntar zxvf download\nmv postfixadmin-2.92 /var/www/postfixadmin\nchown -R nginx. /var/www/postfixadmin\n```\n\nnginx\u3067potfixadmin\u3092\u8868\u793a\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\nvi /etc/nginx/postfixadmin\n----------------\n # postfixadmin\n    location /postfixadmin {\n        alias /var/www/postfixadmin;\n        index index.php;\n        include /etc/nginx/expires;\n\n        location ~ ^/postfixadmin/.+\\.php$ {\n            alias /var/www/postfixadmin;\n            fastcgi_pass   phpfpm;\n            fastcgi_index  index.php;\n            fastcgi_param  SCRIPT_FILENAME /var/www$fastcgi_script_name;\n            include        fastcgi_params;\n        }\n    }\n----------------\n\n\nvi /etc/nginx/conf.d/default-ssl.conf\n(http2\u30bf\u30a4\u30d7\u3067\u306a\u3044\u5834\u5408\u306f\u3001/etc/nginx/conf.d/default.conf\u3092\u7de8\u96c6)\n---------\n    include     /etc/nginx/postfixadmin;\n---------\n\n/etc/init.d/nginx restart\n```\n\npostfixadmin\u306e\u57fa\u672c\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\nvi /var/www/postfixadmin/config.inc.php\n-----------------\n$CONF['configured'] = true;\n$CONF['database_type'] = 'mysql';\n$CONF['database_host'] = '127.0.0.1';\n$CONF['database_user'] = 'postfix';\n$CONF['database_password'] = 'mailpasswd';\n$CONF['database_name'] = 'postfix';\n-----------------\n\n```\n\n\u8db3\u308a\u306a\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\nyum install php-imap\n\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u8a2d\u5b9a\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n\u30fbhttp2\u30bf\u30a4\u30d7\nhttps://_hostname_/postfixadmin/setup.php\nhttp2\u30bf\u30a4\u30d7\u3067\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u81ea\u5df1\u8a3c\u660e\u306e\u305f\u3081\u8a3c\u660e\u66f8\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u307e\u3059\u304c\u3001\u30a8\u30e9\u30fc\u3092\u7121\u8996\u3057\u3066\u9032\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n\u30fb\u305d\u308c\u4ee5\u5916\u306e\u30bf\u30a4\u30d7\nhttp://_hostname_/postfixadmin/setup.php\n\n![Postfix Admin.png](https://qiita-image-store.s3.amazonaws.com/0/52904/1152f4df-9d84-cd0b-2e1d-4c896bfacc85.png)\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u74b0\u5883\u306e\u30c1\u30a7\u30c3\u30af\u304c\u554f\u984c\u306a\u3051\u308c\u3070\u3001\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u5165\u529b\u3057\u3066\u9032\u307f\u307e\u3059\u3002\n\n![Postfix Admin - 2.png](https://qiita-image-store.s3.amazonaws.com/0/52904/206330d2-e32f-a7bf-ede7-ce77a70e88c5.png)\n\n\u6b21\u306e\u753b\u9762\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30cf\u30c3\u30b7\u30e5\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30b3\u30d4\u30fc\u3057\u3066\u30b5\u30fc\u30d0\u5185\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```\n\nvi /var/www/postfixadmin/config.inc.php\n-------------\n//$CONF['setup_password'] = 'changeme';\n$CONF['setup_password'] = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx';\n-------------\n\n```\n\n\u518d\u5ea6\u30d6\u30e9\u30a6\u30b6\u3078\u623b\u308a\u3001\u5148\u307b\u3069\u5165\u529b\u3057\u305f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u7ba1\u7406\u8005\u306e\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3053\u308c\u3067\u521d\u671f\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3067\u3059\u3002\n\n\u7ba1\u7406\u8005\u306e\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066\u3001\u5165\u529b\u3057\u305f\u60c5\u5831\u3067\u30ed\u30b0\u30a4\u30f3\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\nhttps://_hostname_/postfixadmin/login.php\n(http://_hostname_/postfixadmin/login.php)\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-03 14.59.46.png](https://qiita-image-store.s3.amazonaws.com/0/52904/698fd0e1-ab21-7945-60cb-2e8b02614a1a.png)\n\n#\u5b8c\u6210\uff01\n\u3053\u308c\u3067\u81ea\u7531\u306b\u30c9\u30e1\u30a4\u30f3\u3092\u4f5c\u6210\u3057\u305f\u308a\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u4f5c\u6210\u3057\u3066\u3001\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30c9\u30e1\u30a4\u30f3\u4f5c\u6210\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-03 15.19.36.png](https://qiita-image-store.s3.amazonaws.com/0/52904/d004c791-8bce-18d7-8b71-7a4bfc1e12b1.png)\n\n\n\n\u30a2\u30c9\u30ec\u30b9\u4f5c\u6210\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-03 15.20.00.png](https://qiita-image-store.s3.amazonaws.com/0/52904/2b020177-c67b-dc3b-dc31-be0bcebfc0b4.png)\n\n\n\u8ee2\u9001\u8a2d\u5b9a\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-03 15.21.53.png](https://qiita-image-store.s3.amazonaws.com/0/52904/59d92f4d-30b4-6c99-d88b-5d1e6987e98b.png)\n\n\n\n#\u6ce8\u610f\u70b9\n\u30e1\u30fc\u30eb\u306e\u8a8d\u8a3c\u306fSMTP-AUTH\u3067\u3001\u30e6\u30fc\u30b6\u30fc\u540d\u306f@\u4ee5\u964d\u3092\u542b\u3080\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5168\u4f53\u3068\u306a\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3067\u3001TCP\u306e25/110/143/587\u756a\u30dd\u30fc\u30c8\u306e\u89e3\u653e\u304c\u5fc5\u8981\u3067\u3059\u3002\nec2\u3092\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001AWS\u30d8\u306e\u9006\u5f15\u304d\u7533\u8acb\u3001\u30e1\u30fc\u30eb\u9001\u4fe1\u7533\u8acb\u306a\u3069\u3082\u304a\u5fd8\u308c\u306a\u304f\u3002\n\u3053\u308c\u3067\u57fa\u672c\u7684\u306a\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3068\u3057\u3066\u4f7f\u7528\u304c\u3067\u304d\u307e\u3059\u304c\u3001DKIM\u3001SPF\u3001\u6697\u53f7\u5316\u306a\u3069\u3082\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3057\u3087\u3046\u3002\n\u305d\u3057\u3066\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u904b\u7528\u306f\u5927\u5909\u3067\u3059\u3002\n", "tags": ["Amimoto", "postfix", "postfixadmin", "dovecot"]}