{"context": " More than 1 year has passed since last update.Mina - \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nCapistrano is dead - use\u00a0Mina - weluse Blog \u306b\u3066\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3001\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u300cMina\u300d\u306e\u5c0e\u5165\u65b9\u6cd5\u3002\nMina \u306f Capistrano \u306e\u3088\u3046\u306a\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30ea\u30e2\u30fc\u30c8\u306b\u914d\u7f6e\u3059\u308b\u3001\u3044\u308f\u3070\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u306e\u4e00\u3064\u3060\u3002\n\u3056\u3063\u3068\u8abf\u3079\u3066\u307f\u305f\u611f\u3058\u3067\u306f\u3001\n\nRake \u305d\u306e\u3082\u306e\u3092\u62e1\u5f35\u3057\u3066\u3044\u308b (Capistrano \u306e\u3088\u3046\u306b\u3001\u69cb\u6587\u3092\u63c3\u3048\u3066\u3044\u308b\u3060\u3051\u3067\u306f\u306a\u3044)\n\u30ea\u30e2\u30fc\u30c8\u3067\u6d41\u3059\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001SSH\u63a5\u7d9a\u30921\u56de\u306b\u6291\u3048\u3001\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u89e3\u6d88\n\u30ea\u30e2\u30fc\u30c8\u3067\u6d41\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u3057\u3066\u8868\u793a\u30fb\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\nCapistrano \u306b\u6bd4\u3079\u3066\u30c7\u30d7\u30ed\u30a4\u30b9\u30d4\u30fc\u30c9\u304c\u901f\u304f\u3001\u30de\u30b7\u30f3\u306b\u3082\u512a\u3057\u3044\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Capistrano \u306e deploy_via :remote_cache \u306e\u3088\u3046\u306a\u6319\u52d5 (\u30ea\u30dd\u30b8\u30c8\u30ea\u306e clone \u306f\u6700\u521d\u3060\u3051\u3001\u6b21\u56de\u4ee5\u964d\u306f\u5dee\u5206\u3067\u66f4\u65b0)\n\u307e\u3060\u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001Capistrano \u306b\u6bd4\u3079\u308b\u3068\u62e1\u5f35\u9762\u3067\u975e\u529b\uff1f\nCapistrano \u3088\u308a\u540d\u524d\u304c\u53ef\u611b\u3044 (New!)\n\n\u3068\u3044\u3063\u305f\u5370\u8c61\u3060\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u60c5\u5831\u91cf\u304c\u5c11\u306a\u3044\u306a\u304c\u3089\u3082\u7dba\u9e97\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u3002\n\u7269\u306f\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u305f\u3002\n\n\u5c0e\u5165\n$ gem install mina\n\n\u4f8b\u306e\u5982\u304f gem \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7 (\u30ed\u30fc\u30ab\u30eb)\n$ mina init\n\n\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b config/deploy.rb \u304c\u4f5c\u6210\u3055\u308c\u308b\u3002 \nCapistrano \u306e capify \u3068\u540c\u3058\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u65b9\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\u524d\u306b DSL \u3092\u5c11\u3057\u3060\u3051\u982d\u306b\u5165\u308c\u3066\u304a\u304f\u3002\n\u57fa\u672c\u7684\u306b\u306f Rake \u306e\u8a18\u6cd5\u306b\u5247\u308b\u3002\n(\u5b9f\u969b\u306e\u3068\u3053\u308d\u3001mina \u30b3\u30de\u30f3\u30c9\u306f rake \u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u3067\u3042\u308a\u3001lib/mina/helpers.rb \u306b\u3088\u308b\u8ffd\u52a0\u306e DSL \u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30bf\u30b9\u30af\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u306e\u69d8\u5b50)\n\n# set: \u30ad\u30fc\u306b\u5bfe\u3057\u3066\u5024\u3092\u8a2d\u5b9a\u3059\u308b (Mina \u306e\u8a2d\u5b9a\u7528)\nset :user, 'username'\np user # => \"username\" (set \u3057\u305f\u30c7\u30fc\u30bf\u306f\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066\u547c\u3073\u51fa\u305b\u308b)\n\n# desc: task \u306e\u524d\u306b\u66f8\u3044\u3066\u30bf\u30b9\u30af\u306b\u8aac\u660e\u3092\u4ed8\u3051\u308b\ndesc \"\u30bf\u30b9\u30af\u306e\u8aac\u660e\"\n# task: \u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3059\u308b\ntask :mytask => [:subtask] do # subtask \u3092\u524d\u63d0\u30bf\u30b9\u30af\u3068\u3057\u3066 mytask \u3092\u5b9a\u7fa9\n\n  # queue: \u30ea\u30e2\u30fc\u30c8\u3067 \"touch hoge.txt\" \u3092\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\n  queue  'touch hoge.txt'\n  # queue!: --verbose \u30e2\u30fc\u30c9\u3067\u30b3\u30de\u30f3\u30c9\u304c\u51fa\u529b\u3055\u308c\u308b\u4ee5\u5916\u306f queue \u3068\u540c\u3058\n  queue! 'rm -f hoge.txt' \n\n  # invoke: \u30bf\u30b9\u30af another \u3092\u5b9f\u884c\n  invoke :another\n\n  # commands: \u30ad\u30e5\u30fc\u306b\u5165\u3063\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u5217\u3067\u8fd4\u3059\n  puts commands\n  # >    touch hoge.txt\n  # >    rm -f hoge.txt\n\n  # run!: \u30ad\u30e5\u30fc\u306b\u5165\u3063\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5168\u3066\u5b9f\u884c\u3059\u308b\n  #       \u30ad\u30e5\u30fc\u306e\u4e2d\u8eab\u304c\u6d88\u3048\u305f\u308a\u306f\u3057\u306a\u3044\n  run!\n\n  # run: \u30ea\u30e2\u30fc\u30c8\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5373\u5ea7\u306b\u5b9f\u884c\u3059\u308b\n  run \"bundle install\"\n\n  # to: \u7279\u5b9a\u306e\u51e6\u7406\u306b\u540d\u524d\u3092\u3064\u3051\u308b\u3002\u30d6\u30ed\u30c3\u30af\u5185\u90e8\u3067\u306f\u30ad\u30e5\u30fc\u304c\u72ec\u7acb\u3059\u308b\u3002\n  #     \u540c\u540d\u3067 to \u51e6\u7406\u3092\u4e8c\u5ea6\u66f8\u3044\u305f\u5834\u5408\u3001\u30d6\u30ed\u30c3\u30af\u304c\u8a55\u4fa1\u3055\u308c\u308b\u306e\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3042\u308b (\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u3001\u4f46\u3057\u5b9f\u884c\u306f\u3055\u308c\u308b)\n  to :barks do\n    queue %[echo 'nyaoon']\n    p commands(:queue) # => [\"echo 'nyaoon'\"] \n    run! # => nyaoon\n  end\n\n  # isolate: \u660e\u793a\u7684\u306b\u30ad\u30e5\u30fc\u3092\u72ec\u7acb\u3055\u305b\u308b\u3002\n  #          (\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u304d\u7b49\u306b\u4f7f\u3046\uff1f)\n  isolate do\n    domains = [\"a.example.com\", \"b.example.com\"]\n    domains.each do |domain|\n      set :domain, domain\n      Rake::Task[:deploy].reenable # 2\u56de\u76ee\u4ee5\u964d\u3067\u3082\u5b9f\u884c\u3059\u308b\n      invoke :deploy\n      run!\n    end\n  end\n\n  # die: \u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u843d\u3061\u308b\n  die \"Bad Luck!\"\nend\n\n\n\u8a2d\u5b9a\n\u304a\u597d\u307f\u306e\u30a8\u30c7\u30a3\u30bf\u3067 config/deploy.rb \u3092\u7de8\u96c6\u3002\n\u4e00\u822c\u7684\u306a Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u60f3\u5b9a\u3057\u305f\u5834\u5408\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u3002\n\nconfig/deploy.rb\n# \u9069\u5b9c\u5fc5\u8981\u306a\u88dc\u52a9\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\u3002\nrequire 'mina/rails'\nrequire 'mina/git'\nrequire 'mina/bundler'\n# require 'mina/rbenv'  # (Rbenv \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408)\n# require 'mina/rvm'    # (RVM \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408)\n\n# \u30c7\u30d7\u30ed\u30a4\u30e6\u30fc\u30b6\u3001SSH\u63a5\u7d9a\u5148\u3001\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30d1\u30b9\u3001Git \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3001\u30d6\u30e9\u30f3\u30c1\u3001RAILS_ENV\nset :user,       'www'\nset :domain,     '10.0.1.1'\nset :deploy_to,  '/Users/www/rails/waooon'\nset :repository, 'ssh://git@10.0.1.2/~/repos/waooon.git'\nset :branch,     'develop'\nset :rails_env,  ENV['RAILS_ENV'] || 'production'\n\n# \u30b5\u30fc\u30d0\u56fa\u6709\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n# #{deploy_to}/shared \u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u3051\u3070\u3001deploy:link_shared_paths \u30bf\u30b9\u30af\u306b\u3088\u3063\u3066\u672c\u6765\u306e\u4f4d\u7f6e\u3078\u3068\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3055\u308c\u308b\u3002\n# config/database.yml \u3092\u8a2d\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3067 shared/config/database.yml \u3092\u66f8\u3044\u3066\u304a\u3051\u3070 OK\nset :shared_paths, ['config/database.yml', 'log']\n\n# \u74b0\u5883\u8a2d\u5b9a\u7528\u30bf\u30b9\u30af\u3002\n# \u30d1\u30b9\u3092\u5f35\u3063\u305f\u308a\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u306a\u3089\u3053\u3053\uff1f\n# \u8a66\u3057\u306b .bashrc \u3092\u8aad\u3093\u3067\u3042\u3052\u305f\u3089\u4e0a\u624b\u304f\u52d5\u3044\u305f\u3002\u7121\u3044\u3068 bundle \u306b\u30d1\u30b9\u304c\u901a\u3063\u3066\u306a\u304f\u3066\u30a8\u30e9\u30fc\ntask :environment do\n  queue %[source ~/.bashrc]\n\n  # Rbenv \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\n  # invoke :'rbenv:load'\n\n  # RVM \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\n  # invoke :'rvm:use[ruby-1.9.3-p125@default]'\nend\n\n# \u30ea\u30e2\u30fc\u30c8\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u6642\u306e\u6319\u52d5\u3092\u8a2d\u5b9a\u3059\u308b\n# (\u30c7\u30d5\u30a9\u30eb\u30c8)\ntask :setup => :environment do\n  queue! %[mkdir -p \"#{deploy_to}/shared/log\"]\n  queue! %[chmod g+rx,u+rwx \"#{deploy_to}/shared/log\"]\n\n  queue! %[mkdir -p \"#{deploy_to}/shared/config\"]\n  queue! %[chmod g+rx,u+rwx \"#{deploy_to}/shared/config\"]\n\n  queue! %[touch \"#{deploy_to}/shared/config/database.yml\"]\nend\n\n# \u30c7\u30d7\u30ed\u30a4\u6642\u306e\u6319\u52d5\u3092\u8a2d\u5b9a\u3059\u308b\ndesc \"Deploys the current version to the server.\"\ntask :deploy => :environment do\n  deploy do\n    # \u4e00\u822c\u7684\u306a Rails \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u7528\u306e\u30bf\u30b9\u30af\n    invoke :'git:clone'\n    invoke :'deploy:link_shared_paths'\n    invoke :'bundle:install'\n    invoke :'rails:db_migrate'\n    invoke :'rails:assets_precompile'\n\n    to :launch do # \u518d\u8d77\u52d5\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n      queue 'mkdir -p tmp'\n      queue 'touch tmp/restart.txt'\n    end\n  end\nend\n\n\n\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7 (\u30ea\u30e2\u30fc\u30c8)\n\u30ea\u30e2\u30fc\u30c8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002\u305d\u306e\u524d\u306b\u3001\u30ea\u30e2\u30fc\u30c8\u306b\u30c7\u30d7\u30ed\u30a4\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u7121\u3044\u306a\u3089\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n(11/8 13:00 \u8ffd\u8a18) \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u306a\u3044\u5834\u5408\u306f\u81ea\u52d5\u3067\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u3060\u3002\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u5834\u5408\u306a\u3069\u306f\u3001\u5f53\u7136\u81ea\u5206\u3067\u4f5c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n$ ssh www@10.0.1.1 \"mkdir -p /Users/www/rails/waooon\"\n\n\u30ea\u30e2\u30fc\u30c8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\n$ mina setup\n\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\u251c\u2500\u2500 releases\n\u2514\u2500\u2500 shared\n    \u251c\u2500\u2500 config\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 database.yml\n    \u2514\u2500\u2500 log\n\n\u3053\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30ea\u30e2\u30fc\u30c8\u306e database.yml \u3092\u9069\u5b9c\u7de8\u96c6\u3002\n\u4ed6\u306b shared_paths \u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308c\u3070\u7de8\u96c6\u3057\u3066\u304a\u304f\u3002\n\n\u30c7\u30d7\u30ed\u30a4 (\u78ba\u8a8d)\n--simulate \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\u6240\u8b02 Dry-Run?\n$ mina deploy --simulate\n\n\u30bf\u30b9\u30af\u5b9f\u884c\u6642\u306b\u30ea\u30e2\u30fc\u30c8\u3067\u884c\u308f\u308c\u308b\u4e88\u5b9a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u305a\u3089\u305a\u3089\u3068\u7f85\u5217\u3055\u308c\u3066\u3044\u304f\u3002\n\u30ea\u30e2\u30fc\u30c8\u3067\u5b9f\u969b\u306b\u3069\u3093\u306a\u51e6\u7406\u304c\u884c\u308f\u308c\u308b\u304b\u3068\u3044\u3046\u306e\u306f\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3060\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u308c\u306f\u78ba\u8a8d\u3057\u3066\u304a\u3053\u3046\u3002\n\u3068\u3044\u3063\u3066\u3082\u3001\u50d5\u306f\u4e3b\u306b\u30c7\u30d0\u30c3\u30b0\u7528\u9014\u306b\u4f7f\u3063\u3066\u3044\u305f\u3002\n\n\u30c7\u30d7\u30ed\u30a4\n$ mina deploy --verbose --trace\n\n--verbose, --trace \u306f\u8a73\u7d30\u8868\u793a\u3068\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\n--verbose \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u305f\u3068\u304d\u3001deploy.rb \u3067 queue! \u3092\u4f7f\u3063\u3066\u3044\u308c\u3070\u3001\u5b9f\u884c\u524d\u306b\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n(\u4ed6\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u3053\u3061\u3089)\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3002\n-----> Creating a temporary build path\n       $ touch \"deploy.lock\"\n       $ mkdir -p \"$build_path\"\n       $ cd \"$build_path\"\n\n-----> Fetching new git commits\n       $ (cd \"/Users/www/rails/waooon/scm\" && git fetch \"ssh://git@10.0.1.2/~/repos/waooon.git\" \"master:master\" --force)\n\n-----> Using git branch 'master'\n       $ git clone \"/Users/www/rails/waooon/scm\" . --recursive --branch \"master\"\n       Cloning into '.'...\n       done.\n\n-----> Using this git commit\n\n       $ git --no-pager log --format=\"%aN (%h):%n> %s\" -n 1\n       AOKI Yuuto (xxxxxx):\n       > initial commit\n       $ rm -rf .git\n\n\n-----> Symlinking shared paths\n       $ mkdir -p \"./config\"\n       $ mkdir -p \".\"\n       $ rm -rf \"./config/database.yml\"\n       $ ln -s \"/Users/www/rails/waooon/shared/config/database.yml\" \"./config/database.yml\"\n       $ rm -rf \"./log\"\n       $ ln -s \"/Users/www/rails/waooon/shared/log\" \"./log\"\n\n-----> Installing gem dependencies using Bundler\n       $ mkdir -p \"/Users/www/rails/waooon/shared/bundle\"\n       $ mkdir -p \"./vendor\"\n       $ ln -s \"/Users/www/rails/waooon/shared/bundle\" \"./vendor/bundle\"\n       $ bundle install --without development:test --path \"./vendor/bundle\" --binstubs bin/ --deployment\n       (\u7701\u7565)\n       Your bundle is complete! It was installed into ./vendor/bundle\n\n-----> Migrating database\n       $ RAILS_ENV=\"production\" bundle exec rake db:migrate\n\n-----> Precompiling asset files\n       $ RAILS_ENV=\"production\" bundle exec rake assets:precompile RAILS_GROUPS=assets\n\n-----> Build finished\n\n-----> Moving build to releases/1\n       $ mv \"$build_path\" \"$release_path\"\n\n-----> Updating the current symlink\n       $ ln -nfs \"$release_path\" \"current\"\n\n-----> Launching\n       $ cd \"$release_path\"\n\n-----> Done. Deployed v1\n       Elapsed time: 16.00 seconds\n\n\n\u6ce8\u610f\u70b9 (\u4eca\u56de\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u3042\u305f\u3063\u3066)\n\ndatabase.yml \u304c\u6b63\u3057\u304f\u7de8\u96c6\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u666e\u901a\u306b mina deploy \u5185\u306e db:migrate \u3067\u843d\u3061\u308b (\u5f53\u305f\u308a\u524d\u3060\u3051\u3069)\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3060\u3068 #{Rails.root}/tmp \u304c\u4f5c\u6210\u3055\u308c\u305a 'touch tmp/restart.txt' \u304c\u5931\u6557\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\nenvironment \u30bf\u30b9\u30af\u3067 .bashrc \u3092\u8aad\u3093\u3067\u3042\u3052\u306a\u3044\u3068 bundle \u304c\u898b\u3064\u304b\u3089\u305a\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002 (command not found: bundle)\nisolate \u3068\u30eb\u30fc\u30d7\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u7e70\u308a\u8fd4\u3057 invoke \u3059\u308b\u969b\u3001reenable \u3067\u30bf\u30b9\u30af\u3092\u6709\u52b9\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u547c\u3073\u51fa\u3057\u305f\u30bf\u30b9\u30af\u3067\u66f4\u306b invoke \u304c\u884c\u308f\u308c\u3066\u3044\u305f\u5834\u5408\u305d\u308c\u3082 reenable \u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u70ba\u3001\u73fe\u5b9f\u7684\u3067\u306f\u306a\u3044\uff1f\n\n\n\u899a\u3048\u3066\u305f\u3089\u4fbf\u5229\u305d\u3046\u306a\u3053\u3068\n$ mina tasks\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u4f7f\u3044\u65b9\u3092\u78ba\u8a8d\u3002\nBasic usage:\n  mina help    # Show help.\n  mina init    # Creates a sample config file.\n  mina tasks   # Show all tasks.\n\nServer tasks:\n  mina console            # Starts an interactive console.\n  mina deploy             # Deploys the current version to the server.\n  mina rails[arguments]   # Execute a Rails command in the current deploy.\n  mina rake[arguments]    # Execute a Rake command in the current deploy.\n  mina run[command]       # Runs a command in the server.\n  mina setup              # Sets up a site.\n\nMore tasks:\n  mina bundle:install                  # Install gem dependencies using Bundler.\n  mina deploy:cleanup                  # Clean up old releases.\n  mina deploy:force_unlock             # Forces a deploy unlock.\n  mina deploy:link_shared_paths        # Links paths set in :shared_paths.\n  mina git:clone                       # Clones the Git repository to the release path.\n  mina rails:assets_precompile         # Precompiles assets (skips if nothing has changed since the last release).\n  mina rails:assets_precompile:force   # Precompiles assets.\n  mina rails:db_migrate                # Migrates the Rails database (skips if nothing has changed since the last release).\n  mina rails:db_migrate:force          # Migrates the Rails database.\n\ndeploy.rb \u5185\u3067 invoke \u3057\u3066\u3044\u305f\u30bf\u30b9\u30af\u306f\u305d\u308c\u305e\u308c\u5207\u308a\u51fa\u3057\u3066\u500b\u5225\u306b\u4f7f\u3048\u308b\u3002\n\u307e\u305f\u3001mina run \u306a\u3093\u304b\u306f\u30b5\u30fc\u30d0\u306e\u30ed\u30b0\u3092\u3061\u3087\u3063\u3068\u78ba\u8a8d\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\nCapistrano \u306b\u53d6\u3063\u3066\u4ee3\u308f\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u6210\u308a\u3046\u308b\u304b\uff1f\n\u4f7f\u3044\u65b9\u6b21\u7b2c\u3060\u3068\u306f\u601d\u3046\u3051\u308c\u3069\u3001Capistrano \u3068 Mina \u3067\u30bf\u30b9\u30af\u306b\u4e92\u63db\u6027\u304c\u306a\u3044\u306e\u304c\u96e3\u70b9\u3002\n\u50d5\u306f Cap \u81ea\u4f53\u3042\u307e\u308a\u7a81\u3063\u8fbc\u3093\u3060\u4f7f\u3044\u65b9\u3092\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u3001Mina \u306b\u79fb\u884c\u3057\u3066\u3082\u4e0d\u4fbf\u306f\u306a\u3044\u304b\u306a\u3068\u611f\u3058\u305f\u3002\n\u5192\u982d\u3067\u7d39\u4ecb\u3057\u305f\u8a18\u4e8b\u3067\u306f\u300cCapistrano \u306f\u6b7b\u3093\u3060\u300d\u306a\u3093\u3066\u717d\u308a\u6c17\u5473\u306e\u30bf\u30a4\u30c8\u30eb\u304c\u8e0a\u3063\u3066\u3044\u308b\u8a33\u3060\u304c\u3001\u307e\u3060\u307e\u3060\u30a8\u30f3\u30b8\u30cb\u30a2\u6b21\u7b2c\u3067\u306f\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\n\u53c2\u8003\u306b\u306a\u3063\u305f\u30da\u30fc\u30b8\n\n\u516c\u5f0f - Mina\n\n\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb mina \u3092\u4f7f\u3063\u3066\u307f\u308b | yukku++\nMina \u2013 Getting started \u548c\u8a33 | yukku++\n\n\n[Mina - \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://nadarei.co/mina/)\n\n[Capistrano is dead - use\u00a0Mina - weluse Blog](http://weluse.de/blog/capistrano-is-dead-use-mina.html) \u306b\u3066\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u3001\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u300cMina\u300d\u306e\u5c0e\u5165\u65b9\u6cd5\u3002\n\nMina \u306f Capistrano \u306e\u3088\u3046\u306a\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u30ea\u30e2\u30fc\u30c8\u306b\u914d\u7f6e\u3059\u308b\u3001\u3044\u308f\u3070\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u306e\u4e00\u3064\u3060\u3002\n\u3056\u3063\u3068\u8abf\u3079\u3066\u307f\u305f\u611f\u3058\u3067\u306f\u3001\n\n- Rake \u305d\u306e\u3082\u306e\u3092\u62e1\u5f35\u3057\u3066\u3044\u308b (Capistrano \u306e\u3088\u3046\u306b\u3001\u69cb\u6587\u3092\u63c3\u3048\u3066\u3044\u308b\u3060\u3051\u3067\u306f\u306a\u3044)\n- \u30ea\u30e2\u30fc\u30c8\u3067\u6d41\u3059\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e88\u3081\u7528\u610f\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001SSH\u63a5\u7d9a\u30921\u56de\u306b\u6291\u3048\u3001\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u89e3\u6d88\n- \u30ea\u30e2\u30fc\u30c8\u3067\u6d41\u3055\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3092\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u3057\u3066\u8868\u793a\u30fb\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n- Capistrano \u306b\u6bd4\u3079\u3066\u30c7\u30d7\u30ed\u30a4\u30b9\u30d4\u30fc\u30c9\u304c\u901f\u304f\u3001\u30de\u30b7\u30f3\u306b\u3082\u512a\u3057\u3044\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Capistrano \u306e deploy_via :remote_cache \u306e\u3088\u3046\u306a\u6319\u52d5 (\u30ea\u30dd\u30b8\u30c8\u30ea\u306e clone \u306f\u6700\u521d\u3060\u3051\u3001\u6b21\u56de\u4ee5\u964d\u306f\u5dee\u5206\u3067\u66f4\u65b0)\n- \u307e\u3060\u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306a\u306e\u3067\u3001Capistrano \u306b\u6bd4\u3079\u308b\u3068\u62e1\u5f35\u9762\u3067\u975e\u529b\uff1f\n- Capistrano \u3088\u308a\u540d\u524d\u304c\u53ef\u611b\u3044 (New!)\n\n\u3068\u3044\u3063\u305f\u5370\u8c61\u3060\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u60c5\u5831\u91cf\u304c\u5c11\u306a\u3044\u306a\u304c\u3089\u3082\u7dba\u9e97\u306b\u307e\u3068\u307e\u3063\u3066\u3044\u308b\u3002\n\n\u7269\u306f\u8a66\u3057\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u5b9f\u969b\u306b\u4f7f\u3063\u3066\u307f\u305f\u3002\n\n## \u5c0e\u5165\n\n```\n$ gem install mina\n```\n\n\u4f8b\u306e\u5982\u304f gem \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n## \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7 (\u30ed\u30fc\u30ab\u30eb)\n\n```\n$ mina init\n```\n\n\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b config/deploy.rb \u304c\u4f5c\u6210\u3055\u308c\u308b\u3002 \nCapistrano \u306e capify \u3068\u540c\u3058\u3002\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u66f8\u304d\u65b9\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\u524d\u306b DSL \u3092\u5c11\u3057\u3060\u3051\u982d\u306b\u5165\u308c\u3066\u304a\u304f\u3002\n\u57fa\u672c\u7684\u306b\u306f Rake \u306e\u8a18\u6cd5\u306b\u5247\u308b\u3002\n(\u5b9f\u969b\u306e\u3068\u3053\u308d\u3001mina \u30b3\u30de\u30f3\u30c9\u306f rake \u306e\u30a8\u30a4\u30ea\u30a2\u30b9\u3067\u3042\u308a\u3001lib/mina/helpers.rb \u306b\u3088\u308b\u8ffd\u52a0\u306e DSL \u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30bf\u30b9\u30af\u3092\u8aad\u307f\u8fbc\u3080\u3060\u3051\u306e\u69d8\u5b50)\n\n``` ruby\n\n# set: \u30ad\u30fc\u306b\u5bfe\u3057\u3066\u5024\u3092\u8a2d\u5b9a\u3059\u308b (Mina \u306e\u8a2d\u5b9a\u7528)\nset :user, 'username'\np user # => \"username\" (set \u3057\u305f\u30c7\u30fc\u30bf\u306f\u30e1\u30bd\u30c3\u30c9\u3068\u3057\u3066\u547c\u3073\u51fa\u305b\u308b)\n\n# desc: task \u306e\u524d\u306b\u66f8\u3044\u3066\u30bf\u30b9\u30af\u306b\u8aac\u660e\u3092\u4ed8\u3051\u308b\ndesc \"\u30bf\u30b9\u30af\u306e\u8aac\u660e\"\n# task: \u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3059\u308b\ntask :mytask => [:subtask] do # subtask \u3092\u524d\u63d0\u30bf\u30b9\u30af\u3068\u3057\u3066 mytask \u3092\u5b9a\u7fa9\n\n  # queue: \u30ea\u30e2\u30fc\u30c8\u3067 \"touch hoge.txt\" \u3092\u5b9f\u884c\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\n  queue  'touch hoge.txt'\n  # queue!: --verbose \u30e2\u30fc\u30c9\u3067\u30b3\u30de\u30f3\u30c9\u304c\u51fa\u529b\u3055\u308c\u308b\u4ee5\u5916\u306f queue \u3068\u540c\u3058\n  queue! 'rm -f hoge.txt' \n\n  # invoke: \u30bf\u30b9\u30af another \u3092\u5b9f\u884c\n  invoke :another\n\n  # commands: \u30ad\u30e5\u30fc\u306b\u5165\u3063\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u5217\u3067\u8fd4\u3059\n  puts commands\n  # >    touch hoge.txt\n  # >    rm -f hoge.txt\n\n  # run!: \u30ad\u30e5\u30fc\u306b\u5165\u3063\u3066\u3044\u308b\u30b3\u30de\u30f3\u30c9\u3092\u5168\u3066\u5b9f\u884c\u3059\u308b\n  #       \u30ad\u30e5\u30fc\u306e\u4e2d\u8eab\u304c\u6d88\u3048\u305f\u308a\u306f\u3057\u306a\u3044\n  run!\n\n  # run: \u30ea\u30e2\u30fc\u30c8\u3067\u30b3\u30de\u30f3\u30c9\u3092\u5373\u5ea7\u306b\u5b9f\u884c\u3059\u308b\n  run \"bundle install\"\n\n  # to: \u7279\u5b9a\u306e\u51e6\u7406\u306b\u540d\u524d\u3092\u3064\u3051\u308b\u3002\u30d6\u30ed\u30c3\u30af\u5185\u90e8\u3067\u306f\u30ad\u30e5\u30fc\u304c\u72ec\u7acb\u3059\u308b\u3002\n  #     \u540c\u540d\u3067 to \u51e6\u7406\u3092\u4e8c\u5ea6\u66f8\u3044\u305f\u5834\u5408\u3001\u30d6\u30ed\u30c3\u30af\u304c\u8a55\u4fa1\u3055\u308c\u308b\u306e\u306f\u6700\u521d\u306e\u4e00\u56de\u3060\u3051\u3067\u3042\u308b (\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u3001\u4f46\u3057\u5b9f\u884c\u306f\u3055\u308c\u308b)\n  to :barks do\n    queue %[echo 'nyaoon']\n    p commands(:queue) # => [\"echo 'nyaoon'\"] \n    run! # => nyaoon\n  end\n\n  # isolate: \u660e\u793a\u7684\u306b\u30ad\u30e5\u30fc\u3092\u72ec\u7acb\u3055\u305b\u308b\u3002\n  #          (\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3068\u304d\u7b49\u306b\u4f7f\u3046\uff1f)\n  isolate do\n    domains = [\"a.example.com\", \"b.example.com\"]\n    domains.each do |domain|\n      set :domain, domain\n      Rake::Task[:deploy].reenable # 2\u56de\u76ee\u4ee5\u964d\u3067\u3082\u5b9f\u884c\u3059\u308b\n      invoke :deploy\n      run!\n    end\n  end\n\n  # die: \u30a8\u30e9\u30fc\u3092\u5410\u3044\u3066\u843d\u3061\u308b\n  die \"Bad Luck!\"\nend\n```\n\n## \u8a2d\u5b9a\n\n\u304a\u597d\u307f\u306e\u30a8\u30c7\u30a3\u30bf\u3067 config/deploy.rb \u3092\u7de8\u96c6\u3002\n\u4e00\u822c\u7684\u306a Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u60f3\u5b9a\u3057\u305f\u5834\u5408\u3001\u3053\u3093\u306a\u611f\u3058\u306b\u3002\n\n``` ruby:config/deploy.rb\n# \u9069\u5b9c\u5fc5\u8981\u306a\u88dc\u52a9\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8aad\u307f\u8fbc\u3080\u3002\nrequire 'mina/rails'\nrequire 'mina/git'\nrequire 'mina/bundler'\n# require 'mina/rbenv'  # (Rbenv \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408)\n# require 'mina/rvm'    # (RVM \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408)\n\n# \u30c7\u30d7\u30ed\u30a4\u30e6\u30fc\u30b6\u3001SSH\u63a5\u7d9a\u5148\u3001\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30d1\u30b9\u3001Git \u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3001\u30d6\u30e9\u30f3\u30c1\u3001RAILS_ENV\nset :user,       'www'\nset :domain,     '10.0.1.1'\nset :deploy_to,  '/Users/www/rails/waooon'\nset :repository, 'ssh://git@10.0.1.2/~/repos/waooon.git'\nset :branch,     'develop'\nset :rails_env,  ENV['RAILS_ENV'] || 'production'\n\n# \u30b5\u30fc\u30d0\u56fa\u6709\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n# #{deploy_to}/shared \u306b\u30d5\u30a1\u30a4\u30eb\u3092\u7f6e\u3044\u3066\u304a\u3051\u3070\u3001deploy:link_shared_paths \u30bf\u30b9\u30af\u306b\u3088\u3063\u3066\u672c\u6765\u306e\u4f4d\u7f6e\u3078\u3068\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3055\u308c\u308b\u3002\n# config/database.yml \u3092\u8a2d\u5b9a\u3057\u305f\u3044\u5834\u5408\u306f\u30b5\u30fc\u30d0\u30b5\u30a4\u30c9\u3067 shared/config/database.yml \u3092\u66f8\u3044\u3066\u304a\u3051\u3070 OK\nset :shared_paths, ['config/database.yml', 'log']\n\n# \u74b0\u5883\u8a2d\u5b9a\u7528\u30bf\u30b9\u30af\u3002\n# \u30d1\u30b9\u3092\u5f35\u3063\u305f\u308a\u30d7\u30ed\u30ad\u30b7\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u306a\u3089\u3053\u3053\uff1f\n# \u8a66\u3057\u306b .bashrc \u3092\u8aad\u3093\u3067\u3042\u3052\u305f\u3089\u4e0a\u624b\u304f\u52d5\u3044\u305f\u3002\u7121\u3044\u3068 bundle \u306b\u30d1\u30b9\u304c\u901a\u3063\u3066\u306a\u304f\u3066\u30a8\u30e9\u30fc\ntask :environment do\n  queue %[source ~/.bashrc]\n\n  # Rbenv \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\n  # invoke :'rbenv:load'\n\n  # RVM \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\n  # invoke :'rvm:use[ruby-1.9.3-p125@default]'\nend\n\n# \u30ea\u30e2\u30fc\u30c8\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u6642\u306e\u6319\u52d5\u3092\u8a2d\u5b9a\u3059\u308b\n# (\u30c7\u30d5\u30a9\u30eb\u30c8)\ntask :setup => :environment do\n  queue! %[mkdir -p \"#{deploy_to}/shared/log\"]\n  queue! %[chmod g+rx,u+rwx \"#{deploy_to}/shared/log\"]\n\n  queue! %[mkdir -p \"#{deploy_to}/shared/config\"]\n  queue! %[chmod g+rx,u+rwx \"#{deploy_to}/shared/config\"]\n\n  queue! %[touch \"#{deploy_to}/shared/config/database.yml\"]\nend\n\n# \u30c7\u30d7\u30ed\u30a4\u6642\u306e\u6319\u52d5\u3092\u8a2d\u5b9a\u3059\u308b\ndesc \"Deploys the current version to the server.\"\ntask :deploy => :environment do\n  deploy do\n    # \u4e00\u822c\u7684\u306a Rails \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u7528\u306e\u30bf\u30b9\u30af\n    invoke :'git:clone'\n    invoke :'deploy:link_shared_paths'\n    invoke :'bundle:install'\n    invoke :'rails:db_migrate'\n    invoke :'rails:assets_precompile'\n\n    to :launch do # \u518d\u8d77\u52d5\u7528\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n      queue 'mkdir -p tmp'\n      queue 'touch tmp/restart.txt'\n    end\n  end\nend\n\n```\n\n## \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7 (\u30ea\u30e2\u30fc\u30c8)\n\n\u30ea\u30e2\u30fc\u30c8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u884c\u3046\u3002\u305d\u306e\u524d\u306b\u3001\u30ea\u30e2\u30fc\u30c8\u306b\u30c7\u30d7\u30ed\u30a4\u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u7121\u3044\u306a\u3089\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n(11/8 13:00 \u8ffd\u8a18) \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u306a\u3044\u5834\u5408\u306f\u81ea\u52d5\u3067\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u3060\u3002\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u306a\u3044\u5834\u5408\u306a\u3069\u306f\u3001\u5f53\u7136\u81ea\u5206\u3067\u4f5c\u308b\u3053\u3068\u306b\u306a\u308b\u3002\n\n```\n$ ssh www@10.0.1.1 \"mkdir -p /Users/www/rails/waooon\"\n```\n\n\u30ea\u30e2\u30fc\u30c8\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3002\n\n```\n$ mina setup\n```\n\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u5f8c\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u305f\u3002\n\n```\n\u251c\u2500\u2500 releases\n\u2514\u2500\u2500 shared\n    \u251c\u2500\u2500 config\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 database.yml\n    \u2514\u2500\u2500 log\n```\n\n\u3053\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u30ea\u30e2\u30fc\u30c8\u306e database.yml \u3092\u9069\u5b9c\u7de8\u96c6\u3002\n\u4ed6\u306b shared_paths \u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308c\u3070\u7de8\u96c6\u3057\u3066\u304a\u304f\u3002\n\n## \u30c7\u30d7\u30ed\u30a4 (\u78ba\u8a8d)\n\n--simulate \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\u6240\u8b02 Dry-Run?\n\n```\n$ mina deploy --simulate\n```\n\n\u30bf\u30b9\u30af\u5b9f\u884c\u6642\u306b\u30ea\u30e2\u30fc\u30c8\u3067\u884c\u308f\u308c\u308b\u4e88\u5b9a\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u304c\u305a\u3089\u305a\u3089\u3068\u7f85\u5217\u3055\u308c\u3066\u3044\u304f\u3002\n\u30ea\u30e2\u30fc\u30c8\u3067\u5b9f\u969b\u306b\u3069\u3093\u306a\u51e6\u7406\u304c\u884c\u308f\u308c\u308b\u304b\u3068\u3044\u3046\u306e\u306f\u6c17\u306b\u306a\u308b\u3068\u3053\u308d\u3060\u3068\u601d\u3046\u306e\u3067\u3001\u3053\u308c\u306f\u78ba\u8a8d\u3057\u3066\u304a\u3053\u3046\u3002\n\u3068\u3044\u3063\u3066\u3082\u3001\u50d5\u306f\u4e3b\u306b\u30c7\u30d0\u30c3\u30b0\u7528\u9014\u306b\u4f7f\u3063\u3066\u3044\u305f\u3002\n\n\n## \u30c7\u30d7\u30ed\u30a4\n\n```\n$ mina deploy --verbose --trace\n```\n\n--verbose, --trace \u306f\u8a73\u7d30\u8868\u793a\u3068\u30c7\u30d0\u30c3\u30b0\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\n--verbose \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8a2d\u5b9a\u3057\u305f\u3068\u304d\u3001deploy.rb \u3067 queue! \u3092\u4f7f\u3063\u3066\u3044\u308c\u3070\u3001\u5b9f\u884c\u524d\u306b\u30b3\u30de\u30f3\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n(\u4ed6\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f[\u3053\u3061\u3089](http://nadarei.co/mina/command_line_options.html))\n\n\u4e0b\u8a18\u306e\u3088\u3046\u306a\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3002\n\n```\n-----> Creating a temporary build path\n       $ touch \"deploy.lock\"\n       $ mkdir -p \"$build_path\"\n       $ cd \"$build_path\"\n\n-----> Fetching new git commits\n       $ (cd \"/Users/www/rails/waooon/scm\" && git fetch \"ssh://git@10.0.1.2/~/repos/waooon.git\" \"master:master\" --force)\n\n-----> Using git branch 'master'\n       $ git clone \"/Users/www/rails/waooon/scm\" . --recursive --branch \"master\"\n       Cloning into '.'...\n       done.\n\n-----> Using this git commit\n       \n       $ git --no-pager log --format=\"%aN (%h):%n> %s\" -n 1\n       AOKI Yuuto (xxxxxx):\n       > initial commit\n       $ rm -rf .git\n       \n\n-----> Symlinking shared paths\n       $ mkdir -p \"./config\"\n       $ mkdir -p \".\"\n       $ rm -rf \"./config/database.yml\"\n       $ ln -s \"/Users/www/rails/waooon/shared/config/database.yml\" \"./config/database.yml\"\n       $ rm -rf \"./log\"\n       $ ln -s \"/Users/www/rails/waooon/shared/log\" \"./log\"\n\n-----> Installing gem dependencies using Bundler\n       $ mkdir -p \"/Users/www/rails/waooon/shared/bundle\"\n       $ mkdir -p \"./vendor\"\n       $ ln -s \"/Users/www/rails/waooon/shared/bundle\" \"./vendor/bundle\"\n       $ bundle install --without development:test --path \"./vendor/bundle\" --binstubs bin/ --deployment\n       (\u7701\u7565)\n       Your bundle is complete! It was installed into ./vendor/bundle\n\n-----> Migrating database\n       $ RAILS_ENV=\"production\" bundle exec rake db:migrate\n\n-----> Precompiling asset files\n       $ RAILS_ENV=\"production\" bundle exec rake assets:precompile RAILS_GROUPS=assets\n\n-----> Build finished\n\n-----> Moving build to releases/1\n       $ mv \"$build_path\" \"$release_path\"\n\n-----> Updating the current symlink\n       $ ln -nfs \"$release_path\" \"current\"\n\n-----> Launching\n       $ cd \"$release_path\"\n\n-----> Done. Deployed v1\n       Elapsed time: 16.00 seconds\n```\n\n## \u6ce8\u610f\u70b9 (\u4eca\u56de\u306e\u30c7\u30d7\u30ed\u30a4\u306b\u3042\u305f\u3063\u3066)\n\n- database.yml \u304c\u6b63\u3057\u304f\u7de8\u96c6\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u666e\u901a\u306b mina deploy \u5185\u306e db:migrate \u3067\u843d\u3061\u308b (\u5f53\u305f\u308a\u524d\u3060\u3051\u3069)\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u307e\u307e\u3060\u3068 #{Rails.root}/tmp \u304c\u4f5c\u6210\u3055\u308c\u305a 'touch tmp/restart.txt' \u304c\u5931\u6557\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\n- environment \u30bf\u30b9\u30af\u3067 .bashrc \u3092\u8aad\u3093\u3067\u3042\u3052\u306a\u3044\u3068 bundle \u304c\u898b\u3064\u304b\u3089\u305a\u30a8\u30e9\u30fc\u306b\u306a\u3063\u305f\u3002 (command not found: bundle)\n- isolate \u3068\u30eb\u30fc\u30d7\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u7e70\u308a\u8fd4\u3057 invoke \u3059\u308b\u969b\u3001reenable \u3067\u30bf\u30b9\u30af\u3092\u6709\u52b9\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u547c\u3073\u51fa\u3057\u305f\u30bf\u30b9\u30af\u3067\u66f4\u306b invoke \u304c\u884c\u308f\u308c\u3066\u3044\u305f\u5834\u5408\u305d\u308c\u3082 reenable \u3057\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u70ba\u3001\u73fe\u5b9f\u7684\u3067\u306f\u306a\u3044\uff1f\n\n## \u899a\u3048\u3066\u305f\u3089\u4fbf\u5229\u305d\u3046\u306a\u3053\u3068\n\n```\n$ mina tasks\n```\n\n\u4e0a\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u4f7f\u3044\u65b9\u3092\u78ba\u8a8d\u3002\n\n```\nBasic usage:\n  mina help    # Show help.\n  mina init    # Creates a sample config file.\n  mina tasks   # Show all tasks.\n\nServer tasks:\n  mina console            # Starts an interactive console.\n  mina deploy             # Deploys the current version to the server.\n  mina rails[arguments]   # Execute a Rails command in the current deploy.\n  mina rake[arguments]    # Execute a Rake command in the current deploy.\n  mina run[command]       # Runs a command in the server.\n  mina setup              # Sets up a site.\n\nMore tasks:\n  mina bundle:install                  # Install gem dependencies using Bundler.\n  mina deploy:cleanup                  # Clean up old releases.\n  mina deploy:force_unlock             # Forces a deploy unlock.\n  mina deploy:link_shared_paths        # Links paths set in :shared_paths.\n  mina git:clone                       # Clones the Git repository to the release path.\n  mina rails:assets_precompile         # Precompiles assets (skips if nothing has changed since the last release).\n  mina rails:assets_precompile:force   # Precompiles assets.\n  mina rails:db_migrate                # Migrates the Rails database (skips if nothing has changed since the last release).\n  mina rails:db_migrate:force          # Migrates the Rails database.\n```\n\ndeploy.rb \u5185\u3067 invoke \u3057\u3066\u3044\u305f\u30bf\u30b9\u30af\u306f\u305d\u308c\u305e\u308c\u5207\u308a\u51fa\u3057\u3066\u500b\u5225\u306b\u4f7f\u3048\u308b\u3002\n\u307e\u305f\u3001mina run \u306a\u3093\u304b\u306f\u30b5\u30fc\u30d0\u306e\u30ed\u30b0\u3092\u3061\u3087\u3063\u3068\u78ba\u8a8d\u3057\u305f\u308a\u3059\u308b\u306e\u306b\u826f\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n## Capistrano \u306b\u53d6\u3063\u3066\u4ee3\u308f\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3068\u6210\u308a\u3046\u308b\u304b\uff1f\n\n\u4f7f\u3044\u65b9\u6b21\u7b2c\u3060\u3068\u306f\u601d\u3046\u3051\u308c\u3069\u3001Capistrano \u3068 Mina \u3067\u30bf\u30b9\u30af\u306b\u4e92\u63db\u6027\u304c\u306a\u3044\u306e\u304c\u96e3\u70b9\u3002\n\u50d5\u306f Cap \u81ea\u4f53\u3042\u307e\u308a\u7a81\u3063\u8fbc\u3093\u3060\u4f7f\u3044\u65b9\u3092\u3057\u3066\u3044\u306a\u304b\u3063\u305f\u306e\u3067\u3001Mina \u306b\u79fb\u884c\u3057\u3066\u3082\u4e0d\u4fbf\u306f\u306a\u3044\u304b\u306a\u3068\u611f\u3058\u305f\u3002\n\u5192\u982d\u3067\u7d39\u4ecb\u3057\u305f\u8a18\u4e8b\u3067\u306f\u300cCapistrano \u306f\u6b7b\u3093\u3060\u300d\u306a\u3093\u3066\u717d\u308a\u6c17\u5473\u306e\u30bf\u30a4\u30c8\u30eb\u304c\u8e0a\u3063\u3066\u3044\u308b\u8a33\u3060\u304c\u3001\u307e\u3060\u307e\u3060\u30a8\u30f3\u30b8\u30cb\u30a2\u6b21\u7b2c\u3067\u306f\u306a\u3044\u3060\u308d\u3046\u304b\u3002\n\n## \u53c2\u8003\u306b\u306a\u3063\u305f\u30da\u30fc\u30b8\n- \u516c\u5f0f - [Mina](http://nadarei.co/mina/)\n- [\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb mina \u3092\u4f7f\u3063\u3066\u307f\u308b | yukku++](http://blog.44uk.net/2012/11/03/use-deploy-tool-mina/)\n- [Mina \u2013 Getting started \u548c\u8a33 | yukku++](http://blog.44uk.net/2012/11/03/mina-getting-started-ja/)", "tags": ["Rails", "Ruby", "rubygems", "mina"]}