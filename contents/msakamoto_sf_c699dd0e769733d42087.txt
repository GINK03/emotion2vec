{"context": "2017\u5e741\u6708\u6642\u70b9\u3067\u3001CentOS7\u3068\u305d\u306eRPM\u7248 Apache HTTPD 2.4.6 \u306b\u3066 Let's Encrypt\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u306e\u3067\u3001\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\nhttps://letsencrypt.org/\nhttps://letsencrypt.jp/\n\n\u691c\u8a3c\u74b0\u5883\uff1a\n$ cat /etc/centos-release\nCentOS Linux release 7.3.1611 (Core)\n\n\u95a2\u9023RPM : \nhttpd-2.4.6-45.el7.centos.x86_64\nopenssl-1.0.1e-60.el7.x86_64\nopenssl-libs-1.0.1e-60.el7.x86_64\nmod_ssl-2.4.6-45.el7.centos.x86_64\n\n2015\uff5e2016\u5e74\u306b\u304b\u3051\u3066\u306e\u8a18\u4e8b\u3067\u306f https://github.com/letsencrypt/letsencrypt \u3092\u4f7f\u3046\u624b\u6cd5\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057\u30012016\u5e74\u5f8c\u534a\u304f\u3089\u3044\u304b\u3089 Certbot \u3092\u4f7f\u3046\u8a18\u4e8b\u304c\u5897\u3048\u3066\u307e\u3059\u3002\n\u4eca\u56de\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u3044\u305f Certbot + CentOS7 + Apache \u306e\u8a18\u4e8b\uff1a\n\nCentOS 7 \u3067 Let's Encrypt - \u30e9\u30a4\u9ea6\u7551\u3092\u3055\u304c\u3057\u3066\n\n\nhttp://dacci.hatenablog.com/entry/2016/05/01/CentOS_7_%E3%81%A7_Let's_Encrypt\n\n\nSE\u596e\u95d8\u8a18: Let's Encrypt\u3067\u7121\u6599SSL\u3092CentOS7\u306b\u8a2d\u5b9a\uff08certbot\uff09\n\n\nhttp://blog.dksg.jp/2016/08/lets-encryptsslcentos7certbot.html\n\n\nCentOS7\u3067Let's Encrypt\u3092\u4f7f\u3046 - Qiita\n\n\nhttp://qiita.com/yasushi00/items/40bdaf8f05017e212325\n\n\n\n\u5b9f\u969b\u30012017\u5e741\u6708\u6642\u70b9\u3067 https://github.com/letsencrypt/letsencrypt \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001Certbot \u306e GitHub \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u30012017\u5e741\u6708\u6642\u70b9\u3067\u306fCertbot\u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u6311\u6226\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nhttps://certbot.eff.org/\nhttps://github.com/certbot/certbot\n\nCertbot\u306b\u306f\u3044\u304f\u3064\u304b\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001Apache\u3084Nginx\u3067\u3042\u308c\u3070\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3082\u3042\u308b\u7a0b\u5ea6\u81ea\u52d5\u8abf\u6574\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u4eca\u56de\u306f\u52c9\u5f37\u306e\u305f\u3081\u3001\u7a3c\u50cd\u4e2d\u306eApache\u3068\u305d\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u53ef\u80fd\u306a\u9650\u308a\u89e6\u3089\u306a\u3044\u65b9\u5411\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://certbot.eff.org/#centosrhel7-apache \u306b\u5f93\u3044\u3001EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u305f\u5f8c\u3001\u4ee5\u4e0b\u5b9f\u884c\u3059\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u3067\u3059\u3002\n$ sudo yum install python-certbot-apache\n(...)\nInstalling:\n python2-certbot-apache                              noarch                 0.9.3-1.el7                          epel                 135 k\nInstalling for dependencies:\n certbot                                             noarch                 0.9.3-1.el7                          epel                  16 k\n(...)\n\nCentOS7\u3067\u3001\u304b\u3064Apache\u3092\u9078\u3093\u3060\u305f\u3081\u304b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u6307\u793a\u3055\u308c\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f python-certbot-apache \u3067\u3057\u305f\u3002 certbot \u30d1\u30c3\u30b1\u30fc\u30b8\u81ea\u4f53\u306f python-certbot-apache \u306e\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ rpm -qil --scripts python2-certbot-apache\nName        : python2-certbot-apache\nVersion     : 0.9.3\nRelease     : 1.el7\nArchitecture: noarch\nInstall Date: Sat 14 Jan 2017 12:42:22 PM JST\nGroup       : Unspecified\nSize        : 532527\nLicense     : ASL 2.0\nSignature   : RSA/SHA256, Sat 15 Oct 2016 01:26:45 AM JST, Key ID 6a2faea2352c64e5\nSource RPM  : python-certbot-apache-0.9.3-1.el7.src.rpm\nBuild Date  : Sat 15 Oct 2016 01:24:13 AM JST\nBuild Host  : buildhw-10.phx2.fedoraproject.org\nRelocations : (not relocatable)\nPackager    : Fedora Project\nVendor      : Fedora Project\nURL         : https://pypi.python.org/pypi/certbot-apache\nSummary     : The apache plugin for certbot\nDescription :\nPlugin for certbot that allows for automatic configuration of apache\n/usr/lib/python2.7/site-packages/certbot_apache\n/usr/lib/python2.7/site-packages/certbot_apache-0.9.3-py2.7.egg-info\n/usr/lib/python2.7/site-packages/certbot_apache-0.9.3-py2.7.egg-info/PKG-INFO\n(...)\n/usr/lib/python2.7/site-packages/certbot_apache/__init__.py\n(...)\n\n$ rpm -qil --scripts certbot\nName        : certbot\nVersion     : 0.9.3\nRelease     : 1.el7\nArchitecture: noarch\nInstall Date: Sat 14 Jan 2017 12:42:22 PM JST\nGroup       : Unspecified\nSize        : 21757\nLicense     : ASL 2.0\nSignature   : RSA/SHA256, Sat 15 Oct 2016 01:26:53 AM JST, Key ID 6a2faea2352c64e5\nSource RPM  : certbot-0.9.3-1.el7.src.rpm\nBuild Date  : Sat 15 Oct 2016 12:57:19 AM JST\nBuild Host  : buildvm-16.phx2.fedoraproject.org\nRelocations : (not relocatable)\nPackager    : Fedora Project\nVendor      : Fedora Project\nURL         : https://pypi.python.org/pypi/certbot\nSummary     : A free, automated certificate authority client\nDescription :\ncertbot is a free, automated certificate authority that aims\nto lower the barriers to entry for encrypting all HTTP traffic on the internet.\n/etc/letsencrypt\n/usr/bin/certbot\n/usr/bin/letsencrypt\n/usr/share/doc/certbot-0.9.3\n/usr/share/doc/certbot-0.9.3/CHANGES.rst\n/usr/share/doc/certbot-0.9.3/CONTRIBUTING.md\n/usr/share/doc/certbot-0.9.3/README.rst\n/usr/share/licenses/certbot-0.9.3\n/usr/share/licenses/certbot-0.9.3/LICENSE.txt\n/var/lib/letsencrypt\n\npython2-certbot-apache \u306f certbot \u306b\u5bfe\u3059\u308bApache\u7528\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0\u3055\u308c\u3066\u304a\u308a\u3001\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u672c\u4f53\u306f certbot \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n/usr/bin/certbot \u306f Python \u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3001 /usr/bin/letsencrypt \u306f /usr/bin/certbot \u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\uff08\u6050\u3089\u304f\u4e92\u63db\u6027\u7dad\u6301\u306e\u305f\u3081\u3068\u601d\u308f\u308c\u307e\u3059\uff09\n$ file /usr/bin/certbot\n/usr/bin/certbot: Python script, ASCII text executable\n\n$ file /usr/bin/letsencrypt\n/usr/bin/letsencrypt: symbolic link to `/usr/bin/certbot'\n\n\u306a\u304a\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3060\u3051\u3067\u306f\u7279\u306b\u751f\u6210\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u4e00\u5fdc\u3001\u4ee5\u4e0b\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u8f09\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u4e00\u5ea6\u3082\u89e6\u3089\u306a\u304b\u3063\u305f\u3067\u3059\u30fb\u30fb\u30fb\u3002\n\nhttps://certbot.eff.org/docs/using.html#configuration-file\n\n\n\u8a3c\u660e\u66f8\u306e\u53d6\u5f97\n\u4eca\u56de\u5b9f\u9a13\u3057\u305f\u74b0\u5883\u3067\u306f\u3001\u3059\u3067\u306b\u4ed6\u306e\u7528\u9014\u3067Apache\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u3059\u3067\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u306bHTTP\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u3066\u304a\u308a\u3001\u5916\u90e8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u526f\u4f5c\u7528\u3068Web\u30b5\u30fc\u30d3\u30b9\u306e\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u3001Certbot \u306e Apache \u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u306f\u306a\u304f\u3001Webroot \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\nhttps://certbot.eff.org/docs/using.html#webroot\n\nWebroot \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u516c\u958b\u4e2d\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b .well-known/ \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u305d\u3053\u306b\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u7528\u306b Let's Encrypt \u304c\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304f\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3059\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u7a3c\u50cd\u4e2d\u306eApache\u3092\u505c\u6b62\u3059\u308b\u3053\u3068\u7121\u304f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u526f\u4f5c\u7528\u3082\u7121\u304f\u3001\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f --dry-run \u3067\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002--webroot-path or -w \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u516c\u958b\u4e2d\u306eDocumentRoot\u3092\u6307\u5b9a\u3057\u3001\u5bfe\u5fdc\u3059\u308bFQDN\u540d\u3092 -d FQDN\u540d \u3067\u7d9a\u3051\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066 DocumentRoot = /var/www/html, FQDN\u540d = www.example.com \u3068\u8a18\u8f09\u3057\u3066\u307e\u3059\u3002\n$ sudo certbot certonly --dry-run --webroot -w /var/www/html -d www.example.com\n\ncurses\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u5bfe\u8a71\u5f62\u5f0f\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u958b\u59cb\u3055\u308c\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5165\u529b\u3068\u5229\u7528\u898f\u7d04\u3078\u306e\u540c\u610f\u3092\u884c\u3044\u307e\u3059\u3002\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n(curses\u306eUI\u4e0a)\nGenerating key (2048 bits): /var/log/letsencrypt/letsencrypt.log\nCreating CSR: /etc/letsencrypt/keys/0000_key-certbot.pem\n\n(\u30bf\u30fc\u30df\u30ca\u30eb\u4e0a)\nIMPORTANT NOTES:\n - The dry run was successful.\n - If you lose your account credentials, you can recover through\n   e-mails sent to (\u5165\u529b\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9)\n - Your account credentials have been saved in your Certbot\n   configuration directory at /etc/letsencrypt. You should make a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n\n\u3053\u306e\u6642\u70b9\u3067\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3067\u3059\u3002\n# find /etc/letsencrypt/\n/etc/letsencrypt/\n/etc/letsencrypt/accounts\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/regr.json\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/private_key.json\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/meta.json\n/etc/letsencrypt/renewal\n/etc/letsencrypt/keys\n/etc/letsencrypt/keys/0000_key-certbot.pem\n/etc/letsencrypt/csr\n/etc/letsencrypt/csr/0000_csr-certbot.pem\n\n# find /var/log/letsencrypt/\n/var/log/letsencrypt/\n/var/log/letsencrypt/letsencrypt.log.1\n/var/log/letsencrypt/letsencrypt.log\n\n$ find /var/www/html/.well-known/\n.well-known/\n(DocumentRoot \u306e\u4e0b\u306b .well-known/ \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4f5c\u3089\u308c\u3066\u3044\u305f\u304c\u3001\u4e2d\u8eab\u306f\u7a7a\u3002)\n\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002 --dry-run \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u3001\u307e\u305fcurses\u306eTUI\u306b\u3088\u308b\u78ba\u8a8d\u3092\u907f\u3051\u308b\u305f\u3081 --non-interactive \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ sudo certbot certonly --non-interactive --webroot -w /var/www/html -d www.example.com\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nYou should register before running non-interactively, or provide --agree-tos and --email <email_address> flags.\n\n-> \u6307\u793a\u306e\u3068\u304a\u308a\u306b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n$ sudo certbot certonly --non-interactive --agree-tos --email (\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9) --webroot -w /var/www/html -d www.example.com\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nStarting new HTTPS connection (1): acme-v01.api.letsencrypt.org\nObtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for (-d \u3067\u6307\u5b9a\u3057\u305fFQDN\u540d)\nUsing the webroot path (-w \u3067\u6307\u5b9a\u3057\u305fDocumentRoot) for all unmatched domains.\nWaiting for verification...\nCleaning up challenges\nGenerating key (2048 bits): /etc/letsencrypt/keys/0001_key-certbot.pem\nCreating CSR: /etc/letsencrypt/csr/0001_csr-certbot.pem\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/(-d \u3067\u6307\u5b9a\u3057\u305fFQDN\u540d)/fullchain.pem. Your\n   cert will expire on 2017-04-14. To obtain a new or tweaked version\n   of this certificate in the future, simply run certbot again. To\n   non-interactively renew *all* of your certificates, run \"certbot\n   renew\"\n - If you lose your account credentials, you can recover through\n   e-mails sent to (--email \u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9).\n - Your account credentials have been saved in your Certbot\n   configuration directory at /etc/letsencrypt. You should make a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n\n\u3053\u306e\u6bb5\u968e\u3067 DocumentRoot \u4ee5\u4e0b\u306e .well-known/ \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u7a7a\u3063\u307d\u3067\u3057\u305f\u3002\u51e6\u7406\u304c\u6210\u529f\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3057\u3066\u304f\u308c\u308b\u306e\u304b\u3082\u3002\n\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5148\u306f\u5229\u7528\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306eURL\u3067\u6848\u5185\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nhttps://certbot.eff.org/docs/using.html#where-are-my-certificates\n\n\u3053\u306e\u6642\u70b9\u3067\u306e /etc/letsencrypt \u4ee5\u4e0b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n# find /etc/letsencrypt/\n/etc/letsencrypt/\n/etc/letsencrypt/accounts\n\n(--dry-run \u5b9f\u884c\u6642\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea)\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/\n\n(\u4ee5\u4e0b\u304c\u5b9f\u969b\u306e\u53d6\u5f97\u3067\u4f5c\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb)\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/regr.json\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/private_key.json\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/meta.json\n\n/etc/letsencrypt/renewal\n/etc/letsencrypt/renewal/(FQDN\u540d)\n/etc/letsencrypt/keys\n/etc/letsencrypt/keys/0000_key-certbot.pem  (--dry-run \u5b9f\u884c\u6642\u306e\u3082\u306e)\n/etc/letsencrypt/keys/0001_key-certbot.pem\n/etc/letsencrypt/csr\n/etc/letsencrypt/csr/0000_csr-certbot.pem  (--dry-run \u5b9f\u884c\u6642\u306e\u3082\u306e)\n/etc/letsencrypt/csr/0001_csr-certbot.pem\n/etc/letsencrypt/archive\n/etc/letsencrypt/archive/(FQDN\u540d)\n/etc/letsencrypt/archive/(FQDN\u540d)/cert1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/privkey1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/chain1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/fullchain1.pem\n/etc/letsencrypt/live\n/etc/letsencrypt/live/(FQDN\u540d)\n/etc/letsencrypt/live/(FQDN\u540d)/cert.pem\n/etc/letsencrypt/live/(FQDN\u540d)/privkey.pem\n/etc/letsencrypt/live/(FQDN\u540d)/chain.pem\n/etc/letsencrypt/live/(FQDN\u540d)/fullchain.pem\n\n\u306a\u304a /etc/letsencrypt/live/(FQDN\u540d) \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u3001 /etc/letsencrypt/archive/(FQDN\u540d) \u3078\u306esymlink \u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\u3053\u306e\u6bb5\u968e\u3067 /etc/letsencrypt \u4ee5\u4e0b\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\nApache HTTPD 2.4.6 \u306e\u8a2d\u5b9a\n\u4eca\u56de\u691c\u8a3c\u3057\u305f CentOS7 \u306e Apache HTTPD \u306f\u30d0\u30fc\u30b8\u30e7\u30f3 2.4.6 \u3067\u3057\u305f\u3002\u305d\u306e\u305f\u3081\u3001 fullchain.pem (Apache >= 2.4.8) \u3067\u306f\u306a\u304f\u3001 chani.pem + cert.pem (Apache < 2.4.8) \u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u672c\u8a18\u4e8b\u3067\u306f\u9375\u30d5\u30a1\u30a4\u30eb\u3068\u8a3c\u660e\u66f8, \u8a3c\u660e\u66f8\u30c1\u30a7\u30a4\u30f3\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u307f\u4ee5\u4e0b\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\nSSLCertificateKeyFile   /etc/letsencrypt/live/(FQDN\u540d)/privkey.pem\nSSLCertificateFile      /etc/letsencrypt/live/(FQDN\u540d)/cert.pem\nSSLCertificateChainFile /etc/letsencrypt/live/(FQDN\u540d)/chain.pem\n\nCentOS7\u3067\u306efirewalld\u306e\u7a74\u3042\u3051\uff1a\n$ sudo firewall-cmd --add-service=https --zone=public --permanent\n$ sudo firewall-cmd --reload\n\n\n\u8a3c\u660e\u66f8\u306e\u66f4\u65b0\ncertbot renew \u3067\u3001\u53d6\u5f97\u3057\u305f\u8a3c\u660e\u66f8\u5168\u3066\u306b\u3064\u3044\u3066\u6709\u52b9\u671f\u9650\u3092\u30c1\u30a7\u30c3\u30af & \u6709\u52b9\u671f\u9650\u307e\u306730\u65e5\u672a\u6e80\u306a\u3089\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u7279\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a\u7121\u3057\u3067\u3001\u6700\u5f8c\u306b\u53d6\u5f97\u3057\u305f\u3068\u304d\u306eplugin & option\u3092\u4f7f\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\nhttps://certbot.eff.org/docs/using.html#renewing-certificates\n\n\u6bce\u65e5cron\u306a\u3069\u3067\u5b9f\u884c\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u3057\u300130\u65e5\u672a\u6e80\u3067\u66f4\u65b0\u3057\u3066\u304f\u308c\u307e\u3059\u306e\u3067\u3001\u6bce\u9031\u4f4d\u307e\u3067\u983b\u5ea6\u3092\u843d\u3068\u3057\u3066\u3082\u5e73\u6c17\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nCentOS7\u306b\u306a\u308a\u3001systemd\u306etimer\u65b9\u5f0f\u3067 certbot renew \u3092\u6bce\u9031\u884c\u3046\u8a2d\u5b9a\u304c\u4ee5\u4e0b\u306b\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nhttp://dacci.hatenablog.com/entry/2016/05/01/CentOS_7_%E3%81%A7_Let's_Encrypt\n\n\u4e0a\u8a18URL\u304b\u3089\u306e\u5f15\u7528\u3067\u3059(\u5f37\u8abf\u30fb\u7701\u7565\u306f\u672c\u8a18\u4e8b\u306e\u8457\u8005\u306b\u3088\u308b)\uff1a\n\n/etc/systemd/system/certbot.service\n[Unit]\nDescription=Let's Encrypt certificate renewal\n\n[Service]\nType=oneshot\nExecStart=/bin/certbot renew\nExecStartPost=/bin/systemctl reload httpd.service\n\n\n\n/etc/systemd/system/certbot.timer\n[Unit]\nDescription=Let's Encrypt weekly certificate renewal\n\n[Timer]\nOnCalendar=weekly\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n\n\n# systemctl enable certbot.timer\n# systemctl --type=timer --all\nUNIT                         LOAD   ACTIVE   SUB     DESCRIPTION\ncertbot.timer                loaded inactive dead    Let's Encrypt monthly certificate renewal\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n\n\u4ee5\u4e0a\u3067 CentOS7 + RPM\u7248 Apache HTTPD 2.4.6 \u306b Let's Encrypt \u5c0e\u5165\u3067\u304d\u307e\u3057\u305f\uff01\n2017\u5e741\u6708\u6642\u70b9\u3067\u3001CentOS7\u3068\u305d\u306eRPM\u7248 Apache HTTPD 2.4.6 \u306b\u3066 Let's Encrypt\u3092\u5c0e\u5165\u3057\u3066\u307f\u305f\u306e\u3067\u3001\u305d\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n* https://letsencrypt.org/\n* https://letsencrypt.jp/\n\n\u691c\u8a3c\u74b0\u5883\uff1a\n\n```\n$ cat /etc/centos-release\nCentOS Linux release 7.3.1611 (Core)\n\n\u95a2\u9023RPM : \nhttpd-2.4.6-45.el7.centos.x86_64\nopenssl-1.0.1e-60.el7.x86_64\nopenssl-libs-1.0.1e-60.el7.x86_64\nmod_ssl-2.4.6-45.el7.centos.x86_64\n```\n\n2015\uff5e2016\u5e74\u306b\u304b\u3051\u3066\u306e\u8a18\u4e8b\u3067\u306f https://github.com/letsencrypt/letsencrypt \u3092\u4f7f\u3046\u624b\u6cd5\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\n\u3057\u304b\u3057\u30012016\u5e74\u5f8c\u534a\u304f\u3089\u3044\u304b\u3089 Certbot \u3092\u4f7f\u3046\u8a18\u4e8b\u304c\u5897\u3048\u3066\u307e\u3059\u3002\n\n\u4eca\u56de\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u3044\u305f Certbot + CentOS7 + Apache \u306e\u8a18\u4e8b\uff1a\n\n* CentOS 7 \u3067 Let's Encrypt - \u30e9\u30a4\u9ea6\u7551\u3092\u3055\u304c\u3057\u3066\n  * http://dacci.hatenablog.com/entry/2016/05/01/CentOS_7_%E3%81%A7_Let's_Encrypt\n* SE\u596e\u95d8\u8a18: Let's Encrypt\u3067\u7121\u6599SSL\u3092CentOS7\u306b\u8a2d\u5b9a\uff08certbot\uff09\n  * http://blog.dksg.jp/2016/08/lets-encryptsslcentos7certbot.html\n* CentOS7\u3067Let's Encrypt\u3092\u4f7f\u3046 - Qiita\n  * http://qiita.com/yasushi00/items/40bdaf8f05017e212325\n\n\u5b9f\u969b\u30012017\u5e741\u6708\u6642\u70b9\u3067 https://github.com/letsencrypt/letsencrypt \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001Certbot \u306e GitHub \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u30012017\u5e741\u6708\u6642\u70b9\u3067\u306fCertbot\u3092\u4f7f\u3046\u65b9\u6cd5\u3067\u6311\u6226\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n* https://certbot.eff.org/\n* https://github.com/certbot/certbot\n\nCertbot\u306b\u306f\u3044\u304f\u3064\u304b\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u7528\u610f\u3055\u308c\u3066\u304a\u308a\u3001Apache\u3084Nginx\u3067\u3042\u308c\u3070\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u3064\u3044\u3066\u3082\u3042\u308b\u7a0b\u5ea6\u81ea\u52d5\u8abf\u6574\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u4eca\u56de\u306f\u52c9\u5f37\u306e\u305f\u3081\u3001\u7a3c\u50cd\u4e2d\u306eApache\u3068\u305d\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u53ef\u80fd\u306a\u9650\u308a\u89e6\u3089\u306a\u3044\u65b9\u5411\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhttps://certbot.eff.org/#centosrhel7-apache \u306b\u5f93\u3044\u3001EPEL\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u305f\u5f8c\u3001\u4ee5\u4e0b\u5b9f\u884c\u3059\u308c\u3070\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u3067\u3059\u3002\n\n```\n$ sudo yum install python-certbot-apache\n(...)\nInstalling:\n python2-certbot-apache                              noarch                 0.9.3-1.el7                          epel                 135 k\nInstalling for dependencies:\n certbot                                             noarch                 0.9.3-1.el7                          epel                  16 k\n(...)\n```\n\nCentOS7\u3067\u3001\u304b\u3064Apache\u3092\u9078\u3093\u3060\u305f\u3081\u304b\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3088\u3046\u6307\u793a\u3055\u308c\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u306f `python-certbot-apache` \u3067\u3057\u305f\u3002 `certbot` \u30d1\u30c3\u30b1\u30fc\u30b8\u81ea\u4f53\u306f `python-certbot-apache` \u306e\u4f9d\u5b58\u30d1\u30c3\u30b1\u30fc\u30b8\u3068\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ rpm -qil --scripts python2-certbot-apache\nName        : python2-certbot-apache\nVersion     : 0.9.3\nRelease     : 1.el7\nArchitecture: noarch\nInstall Date: Sat 14 Jan 2017 12:42:22 PM JST\nGroup       : Unspecified\nSize        : 532527\nLicense     : ASL 2.0\nSignature   : RSA/SHA256, Sat 15 Oct 2016 01:26:45 AM JST, Key ID 6a2faea2352c64e5\nSource RPM  : python-certbot-apache-0.9.3-1.el7.src.rpm\nBuild Date  : Sat 15 Oct 2016 01:24:13 AM JST\nBuild Host  : buildhw-10.phx2.fedoraproject.org\nRelocations : (not relocatable)\nPackager    : Fedora Project\nVendor      : Fedora Project\nURL         : https://pypi.python.org/pypi/certbot-apache\nSummary     : The apache plugin for certbot\nDescription :\nPlugin for certbot that allows for automatic configuration of apache\n/usr/lib/python2.7/site-packages/certbot_apache\n/usr/lib/python2.7/site-packages/certbot_apache-0.9.3-py2.7.egg-info\n/usr/lib/python2.7/site-packages/certbot_apache-0.9.3-py2.7.egg-info/PKG-INFO\n(...)\n/usr/lib/python2.7/site-packages/certbot_apache/__init__.py\n(...)\n\n$ rpm -qil --scripts certbot\nName        : certbot\nVersion     : 0.9.3\nRelease     : 1.el7\nArchitecture: noarch\nInstall Date: Sat 14 Jan 2017 12:42:22 PM JST\nGroup       : Unspecified\nSize        : 21757\nLicense     : ASL 2.0\nSignature   : RSA/SHA256, Sat 15 Oct 2016 01:26:53 AM JST, Key ID 6a2faea2352c64e5\nSource RPM  : certbot-0.9.3-1.el7.src.rpm\nBuild Date  : Sat 15 Oct 2016 12:57:19 AM JST\nBuild Host  : buildvm-16.phx2.fedoraproject.org\nRelocations : (not relocatable)\nPackager    : Fedora Project\nVendor      : Fedora Project\nURL         : https://pypi.python.org/pypi/certbot\nSummary     : A free, automated certificate authority client\nDescription :\ncertbot is a free, automated certificate authority that aims\nto lower the barriers to entry for encrypting all HTTP traffic on the internet.\n/etc/letsencrypt\n/usr/bin/certbot\n/usr/bin/letsencrypt\n/usr/share/doc/certbot-0.9.3\n/usr/share/doc/certbot-0.9.3/CHANGES.rst\n/usr/share/doc/certbot-0.9.3/CONTRIBUTING.md\n/usr/share/doc/certbot-0.9.3/README.rst\n/usr/share/licenses/certbot-0.9.3\n/usr/share/licenses/certbot-0.9.3/LICENSE.txt\n/var/lib/letsencrypt\n```\n\n`python2-certbot-apache` \u306f `certbot` \u306b\u5bfe\u3059\u308bApache\u7528\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0\u3055\u308c\u3066\u304a\u308a\u3001\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u672c\u4f53\u306f `certbot` \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n`/usr/bin/certbot` \u306f Python \u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3001 `/usr/bin/letsencrypt` \u306f `/usr/bin/certbot` \u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\uff08\u6050\u3089\u304f\u4e92\u63db\u6027\u7dad\u6301\u306e\u305f\u3081\u3068\u601d\u308f\u308c\u307e\u3059\uff09\n\n```\n$ file /usr/bin/certbot\n/usr/bin/certbot: Python script, ASCII text executable\n\n$ file /usr/bin/letsencrypt\n/usr/bin/letsencrypt: symbolic link to `/usr/bin/certbot'\n```\n\n\u306a\u304a\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3060\u3051\u3067\u306f\u7279\u306b\u751f\u6210\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u4e00\u5fdc\u3001\u4ee5\u4e0b\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u8f09\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u4e00\u5ea6\u3082\u89e6\u3089\u306a\u304b\u3063\u305f\u3067\u3059\u30fb\u30fb\u30fb\u3002\n\n* https://certbot.eff.org/docs/using.html#configuration-file\n\n# \u8a3c\u660e\u66f8\u306e\u53d6\u5f97\n\n\u4eca\u56de\u5b9f\u9a13\u3057\u305f\u74b0\u5883\u3067\u306f\u3001\u3059\u3067\u306b\u4ed6\u306e\u7528\u9014\u3067Apache\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u3059\u3067\u306b\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u306bHTTP\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u3066\u304a\u308a\u3001\u5916\u90e8\u304b\u3089\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u526f\u4f5c\u7528\u3068Web\u30b5\u30fc\u30d3\u30b9\u306e\u30c0\u30a6\u30f3\u30bf\u30a4\u30e0\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u3001Certbot \u306e Apache \u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u306f\u306a\u304f\u3001Webroot \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3046\u3053\u3068\u306b\u3057\u307e\u3057\u305f\u3002\n\n* https://certbot.eff.org/docs/using.html#webroot\n\nWebroot \u30d7\u30e9\u30b0\u30a4\u30f3\u306f\u516c\u958b\u4e2d\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30eb\u30fc\u30c8\u306b `.well-known/` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u305d\u3053\u306b\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u7528\u306b Let's Encrypt \u304c\u30a2\u30af\u30bb\u30b9\u3057\u3066\u304f\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u4ed5\u7d44\u307f\u3067\u3059\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u7a3c\u50cd\u4e2d\u306eApache\u3092\u505c\u6b62\u3059\u308b\u3053\u3068\u7121\u304f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u526f\u4f5c\u7528\u3082\u7121\u304f\u3001\u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\u307e\u305a\u306f `--dry-run` \u3067\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002`--webroot-path or -w` \u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u516c\u958b\u4e2d\u306eDocumentRoot\u3092\u6307\u5b9a\u3057\u3001\u5bfe\u5fdc\u3059\u308bFQDN\u540d\u3092 `-d FQDN\u540d` \u3067\u7d9a\u3051\u3066\u6307\u5b9a\u3057\u307e\u3059\u3002\u306a\u304a\u3001\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066 DocumentRoot = /var/www/html, FQDN\u540d = `www.example.com` \u3068\u8a18\u8f09\u3057\u3066\u307e\u3059\u3002\n\n```\n$ sudo certbot certonly --dry-run --webroot -w /var/www/html -d www.example.com\n```\n\ncurses\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u5bfe\u8a71\u5f62\u5f0f\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u304c\u958b\u59cb\u3055\u308c\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5165\u529b\u3068\u5229\u7528\u898f\u7d04\u3078\u306e\u540c\u610f\u3092\u884c\u3044\u307e\u3059\u3002\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n```\n(curses\u306eUI\u4e0a)\nGenerating key (2048 bits): /var/log/letsencrypt/letsencrypt.log\nCreating CSR: /etc/letsencrypt/keys/0000_key-certbot.pem\n\n(\u30bf\u30fc\u30df\u30ca\u30eb\u4e0a)\nIMPORTANT NOTES:\n - The dry run was successful.\n - If you lose your account credentials, you can recover through\n   e-mails sent to (\u5165\u529b\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9)\n - Your account credentials have been saved in your Certbot\n   configuration directory at /etc/letsencrypt. You should make a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n```\n\n\u3053\u306e\u6642\u70b9\u3067\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3067\u3059\u3002\n\n```\n# find /etc/letsencrypt/\n/etc/letsencrypt/\n/etc/letsencrypt/accounts\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/regr.json\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/private_key.json\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/meta.json\n/etc/letsencrypt/renewal\n/etc/letsencrypt/keys\n/etc/letsencrypt/keys/0000_key-certbot.pem\n/etc/letsencrypt/csr\n/etc/letsencrypt/csr/0000_csr-certbot.pem\n\n# find /var/log/letsencrypt/\n/var/log/letsencrypt/\n/var/log/letsencrypt/letsencrypt.log.1\n/var/log/letsencrypt/letsencrypt.log\n\n$ find /var/www/html/.well-known/\n.well-known/\n(DocumentRoot \u306e\u4e0b\u306b .well-known/ \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u4f5c\u3089\u308c\u3066\u3044\u305f\u304c\u3001\u4e2d\u8eab\u306f\u7a7a\u3002)\n```\n\n\u3067\u306f\u3001\u5b9f\u969b\u306b\u53d6\u5f97\u3057\u3066\u307f\u307e\u3059\u3002 `--dry-run` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u524a\u9664\u3057\u3001\u307e\u305fcurses\u306eTUI\u306b\u3088\u308b\u78ba\u8a8d\u3092\u907f\u3051\u308b\u305f\u3081 `--non-interactive` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\n$ sudo certbot certonly --non-interactive --webroot -w /var/www/html -d www.example.com\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nYou should register before running non-interactively, or provide --agree-tos and --email <email_address> flags.\n\n-> \u6307\u793a\u306e\u3068\u304a\u308a\u306b\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n$ sudo certbot certonly --non-interactive --agree-tos --email (\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9) --webroot -w /var/www/html -d www.example.com\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\nStarting new HTTPS connection (1): acme-v01.api.letsencrypt.org\nObtaining a new certificate\nPerforming the following challenges:\nhttp-01 challenge for (-d \u3067\u6307\u5b9a\u3057\u305fFQDN\u540d)\nUsing the webroot path (-w \u3067\u6307\u5b9a\u3057\u305fDocumentRoot) for all unmatched domains.\nWaiting for verification...\nCleaning up challenges\nGenerating key (2048 bits): /etc/letsencrypt/keys/0001_key-certbot.pem\nCreating CSR: /etc/letsencrypt/csr/0001_csr-certbot.pem\n\nIMPORTANT NOTES:\n - Congratulations! Your certificate and chain have been saved at\n   /etc/letsencrypt/live/(-d \u3067\u6307\u5b9a\u3057\u305fFQDN\u540d)/fullchain.pem. Your\n   cert will expire on 2017-04-14. To obtain a new or tweaked version\n   of this certificate in the future, simply run certbot again. To\n   non-interactively renew *all* of your certificates, run \"certbot\n   renew\"\n - If you lose your account credentials, you can recover through\n   e-mails sent to (--email \u3067\u6307\u5b9a\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9).\n - Your account credentials have been saved in your Certbot\n   configuration directory at /etc/letsencrypt. You should make a\n   secure backup of this folder now. This configuration directory will\n   also contain certificates and private keys obtained by Certbot so\n   making regular backups of this folder is ideal.\n - If you like Certbot, please consider supporting our work by:\n\n   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate\n   Donating to EFF:                    https://eff.org/donate-le\n```\n\n\u3053\u306e\u6bb5\u968e\u3067 DocumentRoot \u4ee5\u4e0b\u306e `.well-known/` \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u7a7a\u3063\u307d\u3067\u3057\u305f\u3002\u51e6\u7406\u304c\u6210\u529f\u3057\u305f\u3089\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3057\u3066\u304f\u308c\u308b\u306e\u304b\u3082\u3002\n\n\u8a3c\u660e\u66f8\u306e\u4fdd\u5b58\u5148\u306f\u5229\u7528\u65b9\u6cd5\u306f\u4ee5\u4e0b\u306eURL\u3067\u6848\u5185\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* https://certbot.eff.org/docs/using.html#where-are-my-certificates\n\n\u3053\u306e\u6642\u70b9\u3067\u306e `/etc/letsencrypt` \u4ee5\u4e0b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n# find /etc/letsencrypt/\n/etc/letsencrypt/\n/etc/letsencrypt/accounts\n\n(--dry-run \u5b9f\u884c\u6642\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea)\n/etc/letsencrypt/accounts/acme-staging.api.letsencrypt.org/directory/(xxx)/\n\n(\u4ee5\u4e0b\u304c\u5b9f\u969b\u306e\u53d6\u5f97\u3067\u4f5c\u3089\u308c\u305f\u30d5\u30a1\u30a4\u30eb)\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/regr.json\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/private_key.json\n/etc/letsencrypt/accounts/acme-v01.api.letsencrypt.org/directory/(yyy)/meta.json\n\n/etc/letsencrypt/renewal\n/etc/letsencrypt/renewal/(FQDN\u540d)\n/etc/letsencrypt/keys\n/etc/letsencrypt/keys/0000_key-certbot.pem  (--dry-run \u5b9f\u884c\u6642\u306e\u3082\u306e)\n/etc/letsencrypt/keys/0001_key-certbot.pem\n/etc/letsencrypt/csr\n/etc/letsencrypt/csr/0000_csr-certbot.pem  (--dry-run \u5b9f\u884c\u6642\u306e\u3082\u306e)\n/etc/letsencrypt/csr/0001_csr-certbot.pem\n/etc/letsencrypt/archive\n/etc/letsencrypt/archive/(FQDN\u540d)\n/etc/letsencrypt/archive/(FQDN\u540d)/cert1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/privkey1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/chain1.pem\n/etc/letsencrypt/archive/(FQDN\u540d)/fullchain1.pem\n/etc/letsencrypt/live\n/etc/letsencrypt/live/(FQDN\u540d)\n/etc/letsencrypt/live/(FQDN\u540d)/cert.pem\n/etc/letsencrypt/live/(FQDN\u540d)/privkey.pem\n/etc/letsencrypt/live/(FQDN\u540d)/chain.pem\n/etc/letsencrypt/live/(FQDN\u540d)/fullchain.pem\n```\n\n\u306a\u304a `/etc/letsencrypt/live/(FQDN\u540d)` \u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306f\u3001 `/etc/letsencrypt/archive/(FQDN\u540d)` \u3078\u306esymlink \u3068\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n\u3053\u306e\u6bb5\u968e\u3067 `/etc/letsencrypt` \u4ee5\u4e0b\u3092\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\n# Apache HTTPD 2.4.6 \u306e\u8a2d\u5b9a\n\n\u4eca\u56de\u691c\u8a3c\u3057\u305f CentOS7 \u306e Apache HTTPD \u306f\u30d0\u30fc\u30b8\u30e7\u30f3 2.4.6 \u3067\u3057\u305f\u3002\u305d\u306e\u305f\u3081\u3001 fullchain.pem (Apache >= 2.4.8) \u3067\u306f\u306a\u304f\u3001 chani.pem + cert.pem (Apache < 2.4.8) \u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u672c\u8a18\u4e8b\u3067\u306f\u9375\u30d5\u30a1\u30a4\u30eb\u3068\u8a3c\u660e\u66f8, \u8a3c\u660e\u66f8\u30c1\u30a7\u30a4\u30f3\u306e\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u306e\u307f\u4ee5\u4e0b\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n```\nSSLCertificateKeyFile   /etc/letsencrypt/live/(FQDN\u540d)/privkey.pem\nSSLCertificateFile      /etc/letsencrypt/live/(FQDN\u540d)/cert.pem\nSSLCertificateChainFile /etc/letsencrypt/live/(FQDN\u540d)/chain.pem\n```\n\nCentOS7\u3067\u306efirewalld\u306e\u7a74\u3042\u3051\uff1a\n\n```\n$ sudo firewall-cmd --add-service=https --zone=public --permanent\n$ sudo firewall-cmd --reload\n```\n\n# \u8a3c\u660e\u66f8\u306e\u66f4\u65b0\n\n`certbot renew` \u3067\u3001\u53d6\u5f97\u3057\u305f\u8a3c\u660e\u66f8\u5168\u3066\u306b\u3064\u3044\u3066\u6709\u52b9\u671f\u9650\u3092\u30c1\u30a7\u30c3\u30af & \u6709\u52b9\u671f\u9650\u307e\u306730\u65e5\u672a\u6e80\u306a\u3089\u66f4\u65b0\u3057\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\u7279\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u6307\u5b9a\u7121\u3057\u3067\u3001\u6700\u5f8c\u306b\u53d6\u5f97\u3057\u305f\u3068\u304d\u306eplugin & option\u3092\u4f7f\u3063\u3066\u304f\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n* https://certbot.eff.org/docs/using.html#renewing-certificates\n\n\u6bce\u65e5cron\u306a\u3069\u3067\u5b9f\u884c\u3057\u3066\u3082\u3044\u3044\u3067\u3059\u3057\u300130\u65e5\u672a\u6e80\u3067\u66f4\u65b0\u3057\u3066\u304f\u308c\u307e\u3059\u306e\u3067\u3001\u6bce\u9031\u4f4d\u307e\u3067\u983b\u5ea6\u3092\u843d\u3068\u3057\u3066\u3082\u5e73\u6c17\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\nCentOS7\u306b\u306a\u308a\u3001systemd\u306etimer\u65b9\u5f0f\u3067 `certbot renew` \u3092\u6bce\u9031\u884c\u3046\u8a2d\u5b9a\u304c\u4ee5\u4e0b\u306b\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n* http://dacci.hatenablog.com/entry/2016/05/01/CentOS_7_%E3%81%A7_Let's_Encrypt\n\n\u4e0a\u8a18URL\u304b\u3089\u306e\u5f15\u7528\u3067\u3059(\u5f37\u8abf\u30fb\u7701\u7565\u306f\u672c\u8a18\u4e8b\u306e\u8457\u8005\u306b\u3088\u308b)\uff1a\n\n```/etc/systemd/system/certbot.service\n[Unit]\nDescription=Let's Encrypt certificate renewal\n\n[Service]\nType=oneshot\nExecStart=/bin/certbot renew\nExecStartPost=/bin/systemctl reload httpd.service\n```\n\n```/etc/systemd/system/certbot.timer\n[Unit]\nDescription=Let's Encrypt weekly certificate renewal\n\n[Timer]\nOnCalendar=weekly\nPersistent=true\n\n[Install]\nWantedBy=timers.target\n```\n\n```\n# systemctl enable certbot.timer\n# systemctl --type=timer --all\nUNIT                         LOAD   ACTIVE   SUB     DESCRIPTION\ncertbot.timer                loaded inactive dead    Let's Encrypt monthly certificate renewal\n^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\n```\n\n\u4ee5\u4e0a\u3067 CentOS7 + RPM\u7248 Apache HTTPD 2.4.6 \u306b Let's Encrypt \u5c0e\u5165\u3067\u304d\u307e\u3057\u305f\uff01\n", "tags": ["centos7", "Apache", "HTTPS", "SSL", "letsencrypt"]}