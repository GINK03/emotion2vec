{"context": "libvirtd \u306a\u74b0\u5883\u3067 guest \u306b cloud-init \u3092\u5165\u308c\u3066\u3001\u3068\u308a\u3042\u3048\u305a\u6700\u5c0f\u9650\u3067\u52d5\u4f5c\u3055\u305b\u308b\u30e1\u30e2\u3002\u65b9\u91dd\u3068\u3057\u3066\u306f ConfigDrive v2 \u3092\u4f7f\u3046\u3002\nISO \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002\u4e2d\u8eab\u3067\u5fc5\u9808\u306a\u306e\u306f meta_data.json \u3067\u3001\u305d\u306e\u4e2d\u306b uuid key \u306e\u307f\u304c\u5fc5\u9808\u3002\nmkdir -p /path/to/workdir/openstack/latest\necho '{\"uuid\":\"'$(uuidgen)'\"}' > /path/to/workdir/openstack/latest/meta_data.json\n\n\u5f8c\u306f\u304a\u597d\u307f\u3067 meta_data.json \u306e\u6a2a\u306b user_data \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u3067 shell script \u3092\u7f6e\u3044\u3066\u3082\u3088\u3044\u3002\nmkisofs \u3067 image file \u3092\u4f5c\u308b\u3002\u53c2\u8003\nmkisofs -R -V config-2 -o /path/to/work.iso /path/to/workdir\n\n\u3053\u308c\u3067 iso \u30d5\u30a1\u30a4\u30eb\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3002\nguest \u306b\u306f cloud-init \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e ubuntu16guest \u3068\u3044\u3046\u540d\u524d\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u304d\u305f\u3002\nvirsh start ubuntu16guest && virsh attach-disk ubuntu16guest /path/to/work.iso hdb --type cdrom\n\n\u3046\u307e\u304f\u3044\u3051\u3070\u3001cloud-config server \u306e\u691c\u7d22\u3092\u305b\u305a\u306b\u3001\u30b5\u30af\u30c3\u3068\u8d77\u52d5\u3059\u308b\u306f\u305a\u3002\n\nmemo 1\nvirsh start \u306e\u5f8c\u306b\u5373\u5ea7\u306b attach-disk \u3092\u3057\u3066\u3044\u308b\u306e\u306f\u3001domain xml \u3092\u66f8\u304d\u63db\u3048\u305a\u306b\u5b9f\u884c\u3057\u305f\u304b\u3063\u305f\u304b\u3089\u3002domain xml \u3092\u66f4\u65b0\u3057\u3066\u3057\u307e\u3063\u3066\u3088\u3044\u5834\u5408\u306f --config \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066 attach-disk \u3057\u3066\u304b\u3089\u3001start \u3059\u308c\u3070\u3088\u3044\u306e\u3060\u308d\u3046\u3002\u53c2\u8003\n\nmemo 2\nVFAT \u306e\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u4f5c\u308b\u3002\u53c2\u8003 -f 160 \u3068\u304b\u306e\u898f\u5b9a\u5024\u3067\u4f5c\u308b\u3068 vfat \u3067\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u306e\u306f\u4f55\u6545\u304b\u306f\u8ffd\u6c42\u3057\u3066\u306a\u3044\u3002\nmformat -F -M 2048 -S 4 -h 255 -s 63 -t 2428 -v config-2 -C -i /path/to/work.img\nmmd -i /path/to/work.img ::openstack\nmmd -i /path/to/work.img ::openstack/latest\nmcopy -i /path/to/work.img /path/to/work/openstack/latest/meta_data.json ::openstack/latest\nmcopy -i /path/to/work.img /path/to/work/openstack/latest/user_data ::openstack/latest\n\n\u5f8c\u306f\u540c\u3058\u3088\u3046\u306b\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u3092 cdrom \u306e\u5834\u6240\u306b attach \u3059\u308b\u3002\nlibvirtd \u306a\u74b0\u5883\u3067 guest \u306b cloud-init \u3092\u5165\u308c\u3066\u3001\u3068\u308a\u3042\u3048\u305a\u6700\u5c0f\u9650\u3067\u52d5\u4f5c\u3055\u305b\u308b\u30e1\u30e2\u3002\u65b9\u91dd\u3068\u3057\u3066\u306f [ConfigDrive](http://cloudinit.readthedocs.io/en/latest/topics/datasources.html#config-drive) v2 \u3092\u4f7f\u3046\u3002\n\nISO \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u3002\u4e2d\u8eab\u3067\u5fc5\u9808\u306a\u306e\u306f `meta_data.json` \u3067\u3001\u305d\u306e\u4e2d\u306b `uuid` key [\u306e\u307f\u304c\u5fc5\u9808](http://bazaar.launchpad.net/~cloud-init-dev/cloud-init/trunk/view/head:/cloudinit/sources/helpers/openstack.py#L49)\u3002\n\n```\nmkdir -p /path/to/workdir/openstack/latest\necho '{\"uuid\":\"'$(uuidgen)'\"}' > /path/to/workdir/openstack/latest/meta_data.json\n```\n\n\u5f8c\u306f\u304a\u597d\u307f\u3067 `meta_data.json` \u306e\u6a2a\u306b `user_data` \u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u540d\u3067 shell script \u3092\u7f6e\u3044\u3066\u3082\u3088\u3044\u3002\n\n`mkisofs` \u3067 image file \u3092\u4f5c\u308b\u3002[\u53c2\u8003](https://coreos.com/os/docs/latest/config-drive.html)\n\n```\nmkisofs -R -V config-2 -o /path/to/work.iso /path/to/workdir\n```\n\n\u3053\u308c\u3067 iso \u30d5\u30a1\u30a4\u30eb\u306e\u6e96\u5099\u306f\u5b8c\u4e86\u3002\n\nguest \u306b\u306f cloud-init \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u306e ubuntu16guest \u3068\u3044\u3046\u540d\u524d\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u304d\u305f\u3002\n\n```\nvirsh start ubuntu16guest && virsh attach-disk ubuntu16guest /path/to/work.iso hdb --type cdrom\n```\n\n\u3046\u307e\u304f\u3044\u3051\u3070\u3001cloud-config server \u306e\u691c\u7d22\u3092\u305b\u305a\u306b\u3001\u30b5\u30af\u30c3\u3068\u8d77\u52d5\u3059\u308b\u306f\u305a\u3002\n\nmemo 1\n------\n`virsh start` \u306e\u5f8c\u306b\u5373\u5ea7\u306b `attach-disk` \u3092\u3057\u3066\u3044\u308b\u306e\u306f\u3001domain xml \u3092\u66f8\u304d\u63db\u3048\u305a\u306b\u5b9f\u884c\u3057\u305f\u304b\u3063\u305f\u304b\u3089\u3002domain xml \u3092\u66f4\u65b0\u3057\u3066\u3057\u307e\u3063\u3066\u3088\u3044\u5834\u5408\u306f `--config` \u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u3066 `attach-disk` \u3057\u3066\u304b\u3089\u3001`start` \u3059\u308c\u3070\u3088\u3044\u306e\u3060\u308d\u3046\u3002[\u53c2\u8003](https://access.redhat.com/documentation/ja-JP/Red_Hat_Enterprise_Linux/6/html/Virtualization_Administration_Guide/sect-Virtualization-Virtualized_block_devices-Adding_storage_devices_to_guests.html)\n\n\nmemo 2\n------\n\nVFAT \u306e\u30a4\u30e1\u30fc\u30b8\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u4f5c\u308b\u3002[\u53c2\u8003](http://www.rockbox.org/wiki/IpodConversionToFAT32) `-f 160` \u3068\u304b\u306e\u898f\u5b9a\u5024\u3067\u4f5c\u308b\u3068 vfat \u3067\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u304b\u3063\u305f\u308a\u3059\u308b\u306e\u306f\u4f55\u6545\u304b\u306f\u8ffd\u6c42\u3057\u3066\u306a\u3044\u3002\n\n```\nmformat -F -M 2048 -S 4 -h 255 -s 63 -t 2428 -v config-2 -C -i /path/to/work.img\nmmd -i /path/to/work.img ::openstack\nmmd -i /path/to/work.img ::openstack/latest\nmcopy -i /path/to/work.img /path/to/work/openstack/latest/meta_data.json ::openstack/latest\nmcopy -i /path/to/work.img /path/to/work/openstack/latest/user_data ::openstack/latest\n```\n\n\u5f8c\u306f\u540c\u3058\u3088\u3046\u306b\u4e0a\u306e\u30a4\u30e1\u30fc\u30b8\u3092 cdrom \u306e\u5834\u6240\u306b attach \u3059\u308b\u3002\n\n", "tags": ["libvirt", "cloud-init"]}