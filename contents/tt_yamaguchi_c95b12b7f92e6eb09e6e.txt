{"tags": ["chef", "serverspec"], "context": " More than 1 year has passed since last update.opscode\u306epublic cookbooks\u3092\u4f7f\u3063\u3066selinux\u3092\u7121\u52b9\u5316\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001chef-solo\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30ec\u30b7\u30d4\u7ba1\u7406\u306b\u306fBerkshelf\u3092\u4f7f\u3044\u3001serverspec\u3067\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n\u4f7f\u7528\u3059\u308b\u30ec\u30b7\u30d4\nOpscode Cookbook selinux\nhttps://github.com/opscode-cookbooks/selinux\n\n\u30ec\u30b7\u30d4\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\nBerksfile\nsite :opscode\ncookbook 'selinux'\n\n\nbundle exec berks install --path vendor/cookbooks\n\n\n\u30ec\u30b7\u30d4\u3092\u8aad\u3080\n\nvendor/cookbooks/selinux/recipes/disabled.rb\n\n# setenforce 0\u3067\u4e00\u6642\u7684\u306bSELinux\u3092\u7121\u52b9\u5316\u3057\u3001\n# /etc/selinux/config\u306e\u4f5c\u6210\u3092\u901a\u77e5\u3059\u308b\n# selinuxenabled\u30b3\u30de\u30f3\u30c9\u306e\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u304c0(selinux\u304c\u6709\u52b9)\u306e\u5834\u5408\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\nexecute \"disable selinux enforcement\" do\n  only_if \"which selinuxenabled && selinuxenabled\"\n  command \"setenforce 0\"\n  action :run\n  notifies :create, \"template[/etc/selinux/config]\"\nend\n\n# \u518d\u8d77\u52d5\u306e\u969b\u3082SELinux\u306e\u7121\u52b9\u72b6\u614b\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306b\u3001\n# /etc/selinux/config\u306b\u3001\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\ntemplate \"/etc/selinux/config\" do\n  source \"sysconfig/selinux.erb\"\n  variables(\n    :selinux => \"disabled\",\n    :selinuxtype => \"targeted\"\n  )\n  action :nothing\nend\n\n\n\n\u30ec\u30b7\u30d4\u306e\u5b9f\u884c\n\nnodes/localhost.json\n{\n    \"run_list\":[\n        \"recipe[selinux::disabled]\"\n    ]\n}\n\n\nsudo bundle exec chef-solo -c solo.rb -j nodes/localhost.json\n\n\nserverspec\u3067\u30c6\u30b9\u30c8\n\nspec/localhost/selinux_disabled_spec.rb\nrequire 'spec_helper'\n\ndescribe selinux do\n  it { should be_disabled }\nend\n\ndescribe file('/etc/selinux/config') do\n  it { should be_file }\n  it { should contain \"SELINUX=disabled\" }\nend\n\n\nbundle exec rake spec\n\nSELinux\n  should be disabled\n\nFile \"/etc/selinux/config\"\n  should be file\n  should contain \"SELINUX=disabled\"\n\nFinished in 0.19807 seconds\n3 examples, 0 failures\n\nopscode\u306epublic cookbooks\u3092\u4f7f\u3063\u3066selinux\u3092\u7121\u52b9\u5316\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u3001chef-solo\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u30db\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u30ec\u30b7\u30d4\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u30ec\u30b7\u30d4\u7ba1\u7406\u306b\u306fBerkshelf\u3092\u4f7f\u3044\u3001serverspec\u3067\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n## \u4f7f\u7528\u3059\u308b\u30ec\u30b7\u30d4\nOpscode Cookbook selinux\nhttps://github.com/opscode-cookbooks/selinux\n\n## \u30ec\u30b7\u30d4\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n```ruby:Berksfile\nsite :opscode\ncookbook 'selinux'\n```\n\n```\nbundle exec berks install --path vendor/cookbooks\n```\n\n## \u30ec\u30b7\u30d4\u3092\u8aad\u3080\n```ruby:vendor/cookbooks/selinux/recipes/disabled.rb\n\n# setenforce 0\u3067\u4e00\u6642\u7684\u306bSELinux\u3092\u7121\u52b9\u5316\u3057\u3001\n# /etc/selinux/config\u306e\u4f5c\u6210\u3092\u901a\u77e5\u3059\u308b\n# selinuxenabled\u30b3\u30de\u30f3\u30c9\u306e\u7d42\u4e86\u30b9\u30c6\u30fc\u30bf\u30b9\u304c0(selinux\u304c\u6709\u52b9)\u306e\u5834\u5408\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\nexecute \"disable selinux enforcement\" do\n  only_if \"which selinuxenabled && selinuxenabled\"\n  command \"setenforce 0\"\n  action :run\n  notifies :create, \"template[/etc/selinux/config]\"\nend\n\n# \u518d\u8d77\u52d5\u306e\u969b\u3082SELinux\u306e\u7121\u52b9\u72b6\u614b\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306b\u3001\n# /etc/selinux/config\u306b\u3001\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3059\u308b\ntemplate \"/etc/selinux/config\" do\n  source \"sysconfig/selinux.erb\"\n  variables(\n    :selinux => \"disabled\",\n    :selinuxtype => \"targeted\"\n  )\n  action :nothing\nend\n```\n\n## \u30ec\u30b7\u30d4\u306e\u5b9f\u884c\n```js:nodes/localhost.json\n{\n    \"run_list\":[\n        \"recipe[selinux::disabled]\"\n    ]\n}\n```\n\n```\nsudo bundle exec chef-solo -c solo.rb -j nodes/localhost.json\n```\n\n## serverspec\u3067\u30c6\u30b9\u30c8\n```ruby:spec/localhost/selinux_disabled_spec.rb\nrequire 'spec_helper'\n\ndescribe selinux do\n  it { should be_disabled }\nend\n\ndescribe file('/etc/selinux/config') do\n  it { should be_file }\n  it { should contain \"SELINUX=disabled\" }\nend\n```\n\n```\nbundle exec rake spec\n```\n\n```\nSELinux\n  should be disabled\n\nFile \"/etc/selinux/config\"\n  should be file\n  should contain \"SELINUX=disabled\"\n\nFinished in 0.19807 seconds\n3 examples, 0 failures\n```\n"}