{"context": "@Opt Technologies \u793e\u5185\u52c9\u5f37\u4f1a 2017/01/20\n\u3053\u3061\u3089\u306f\u3001\u793e\u5185\u52c9\u5f37\u4f1a\u3067\u4f7f\u3063\u305f\u8cc7\u6599\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\u306f\u3058\u3081\u306b\n\n\u8a71\u3059\u3053\u3068\n\nKubernetes(\u4ee5\u964dk8s)\u3068\u306f\u4f55\u304b\nk8s\u306e\u6a5f\u80fd\u306e\u4e00\u90e8\n\u7c21\u5358\u306aScala\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308b\u4f8b\n\n\n\n\u8a71\u3055\u306a\u3044\u3053\u3068\n\n\u76e3\u8996\n\u30ed\u30ae\u30f3\u30b0\n\u6c38\u7d9a\u5316 (Volume)\n\u8a8d\u8a3c\n\u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u65b9\u6cd5\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u306e\u5229\u70b9\n\nBlue-Green(Red-Black)\u30c7\u30d7\u30ed\u30a4\u306b\u3088\u308b\u904b\u7528\u30b3\u30b9\u30c8\u6e1b\n\n\n<=> In-Place (Capistrano\u306a\u3069)\n\u30b3\u30f3\u30c6\u30ca\u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002(packer\u3067\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u4f5c\u308b\u306a\u3069\u3067\u3082\u3044\u3044)\n\n\n\u8d77\u52d5\u304c\u901f\u3044\n\n\n\u7d20\u65e9\u304f\u30b9\u30b1\u30fc\u30eb\u3067\u304d\u308b\n\u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306f\u7121\u3044\u5229\u70b9\n\n\n\u958b\u767a\u74b0\u5883\u3068\u672c\u756a\u74b0\u5883\u306e\u30ae\u30e3\u30c3\u30d7\u3092\u6e1b\u3089\u305b\u308b\n\n\n\n\u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u3067\u8003\u3048\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\n\n\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u901a\u4fe1\n\n\n\u4f8b: MicroServices\n\n\nLoad Balancing\n\n\n\u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\n\n\n\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u5272\u308a\u5f53\u3066\n\u81ea\u52d5\u30ea\u30ab\u30d0\u30ea\n\u306a\u3069\u306a\u3069\n\n\n\nk8s\u3068\u306f\n\n\u524d\u8ff0\u306e\u3088\u3046\u306a\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u3001\u30b3\u30f3\u30c6\u30ca\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u306e\u4e00\u3064\n\n\n\u4ed6: Docker Swarm, Amazon ECS etc\n\n\nGoogle\u5185\u90e8\u3067\u4f7f\u308f\u308c\u3066\u3044\u305fBorg\u304c\u5143\u306b\u306a\u3063\u3066\u3044\u308b\n\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3082\u3042\u308b\n\n\nGoogle Container Engine (GKE)\n\n\n\u8aad\u307f\u65b9\u306f\u3001k8s meetup\u3067\u306f\u300c\u30af\u30d0\u30cd\u30c6\u30b9\u300d\u304c\u591a\u6570\u6d3e\u3060\u3063\u305f\u5370\u8c61\n\n\n\n\u3053\u306e\u8cc7\u6599\u306e\u74b0\u5883\n\nminikube : v0.14.0\n\n\nkubernetes : v1.5.1\n\n\n\n\n\nk8s\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\u56f3\u306a\u3069\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002Kubernetes architecture\n\nMaster\n\nk8s\u306fmaster - slave(node)\u30e2\u30c7\u30eb\u3002\n\u30af\u30e9\u30b9\u30bf\u306e\u7ba1\u7406\u3092\u884c\u3046\u3001\u8907\u6570\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u7d44\u3092master(\u307e\u305f\u306fcontrol plane)\u3068\u547c\u3076\u3002\n\u3059\u3079\u3066\u30921\u30de\u30b7\u30f3\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\uff08\u7279\u306betcd\u306f\u5206\u3051\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\uff09\nk8s\u306fmaster\u304c\u6b7b\u3093\u3067\u3082pod\u306f\u52d5\u304d\u7d9a\u3051\u308b\u306e\u3067\u3001HA\u69cb\u6210\u306b\u3057\u306a\u304f\u3066\u3082\u3042\u308b\u7a0b\u5ea6\u904b\u7528\u3067\u304d\u305d\u3046\u3002(\u3082\u3061\u308d\u3093api-server\u304c\u6b7b\u3093\u3067\u308b\u306e\u3067pod\u306e\u8ffd\u52a0/\u524a\u9664\u306a\u3069\u306f\u3067\u304d\u306a\u3044\u3002\u3042\u3068DNS\u3068\u304b\u306f\u3069\u3046\u306a\u308b\u3093\u3060\u308d\u3046\uff1f)\n\n\n\u4ee5\u4e0b\u304cmaster\u3092\u69cb\u6210\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n\nkube-apiserver\n\n\nk8s\u306e\u8a2d\u5b9a\u60c5\u5831\u306eCRUD\u3092\u884c\u3046REST server\n\n\netcd\n\n\nRaft\u3068\u3044\u3046\u5408\u610f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u57fa\u3065\u304fGo\u88fd\u306e\u5206\u6563KVS\nk8s\u30af\u30e9\u30b9\u30bf\u306e\u8a2d\u5b9a\u60c5\u5831\u306f\u3059\u3079\u3066\u3053\u3053\u306b\u4fdd\u5b58\u3055\u308c\u308b\n\n\nkube-controller-manager\n\n\nk8s\u3067\u306f\u3001controller\u3068\u547c\u3070\u308c\u308b\u30eb\u30fc\u30d7\u304c\u3044\u304f\u3064\u304b\u56de\u3063\u3066\u3044\u3066\u3001\u305d\u306e\u30eb\u30fc\u30d7\u306e\u4e2d\u3067\u73fe\u5728\u306e\u30af\u30e9\u30b9\u30bf\u306estate\u3068\u8a2d\u5b9a\u3055\u308c\u305fstate\u3092\u6bd4\u8f03\u3057\u3066\u66f4\u65b0\u3057\u3066\u3044\u304f\u3002\n\u305d\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30eb\u30fc\u30d7\u3092\u675f\u306d\u305f\u30c7\u30fc\u30e2\u30f3\n\n\nReplication Controller\nNode Controller\nDeployment Controller\n\u306a\u3069\u306a\u3069\n\n\n\n\nkube-scheduler\n\n\n\u65b0\u305f\u306b\u8ffd\u52a0\u3055\u308c\u305fpod\u3092\u691c\u51fa\u3057\u3001node\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3002\n\n\naddons\n\n\n\u30af\u30e9\u30b9\u30bf\u5185DNS\u306a\u3069\u3001\u4e00\u90e8\u306e\u671f\u9593\u6a5f\u80fd\u306f\u305d\u308c\u81ea\u4f53\u304cpod/service\u3068\u3057\u3066\u52d5\u3044\u3066\u3044\u3066\u3001\u3053\u308c\u3089\u3092addons\u3068\u547c\u3076\u3002\n\nkube-system\u3068\u3044\u3046namespace\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u3002 ($ kubectl get svc --namespace=kube-system\u3067\u898b\u3048\u308b)\n\n\n\n\n\n\u53c2\u8003\n\nKubernetes Components\nCoreOS User Forum\nMaster-Node communication\nCan Pod/Service still work if kube-master or etcd service down?\nKubernetes\u3092\u62e1\u5f35\u3057\u3088\u3046\n\n\n\nNode\n\n\u30b3\u30f3\u30c6\u30ca\u304c\u8d70\u308b\u30de\u30b7\u30f3\u306e\u3053\u3068\u3092\u3001node\u3068\u547c\u3076\u3002\uff08\u5f93\u6765\u306fminion\u3068\u547c\u3070\u308c\u3066\u3044\u305f\uff09\nnode\u306e\u8ffd\u52a0/\u524a\u9664\u306fk8s\u306e\u8cac\u52d9\u306e\u5916\u3002\uff08\u843d\u3061\u3066\u3044\u308bnode\u306bpod\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3057\u306a\u3044\u3001\u306a\u3069\u306f\u3057\u3066\u304f\u308c\u308b\uff09\n\nk8s\u30af\u30e9\u30b9\u30bf\u306e\u30e1\u30f3\u30d0\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u305f\u3081\u306b\u3001\u3059\u3079\u3066\u306enode\u3067\u4ee5\u4e0b\u306e\u30c7\u30fc\u30e2\u30f3\u304c\u52d5\u3044\u3066\u3044\u308b\u3002\n\nkubelet\n\n\napiserver\u3092\u901a\u3058\u3066\u3001\u81ea\u30ce\u30fc\u30c9\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305fpod\u3092\u78ba\u8a8d\u3057\u3001\u8d77\u52d5\u3059\u308b\n\n\nkube-proxy\n\n\n\u8a2d\u5b9a\u3055\u308c\u305fservice\u306b\u5fdc\u3058\u3066\u3001TCP/UDP\u901a\u4fe1\u3092\u9069\u5207\u306apod\u306bforward\u3059\u308bproxy\n\n\n\n\n\n\u53c2\u8003\n\nkubelet\nkube-proxy\n\n\n\nResources(\u4e00\u90e8)\nk8s\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bresource\u306e\u4e00\u90e8\u3092\u89e3\u8aac\u3002\n\u30ab\u30b9\u30bf\u30e0resource\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002(https://kubernetes.io/docs/user-guide/thirdpartyresources/)\n\n\nPod\n\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u96c6\u5408\u3067\u3001\u30c7\u30d7\u30ed\u30a4\u306e\u6700\u5c0f\u5358\u4f4d\u3002\n\n\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u307e\u3068\u3081\u305f\u3044\u30b1\u30fc\u30b9:\n\n\nfluentd\u306a\u3069\u306e\u30ed\u30b0\u30b3\u30ec\u30af\u30bf\u30fc\u3092\u4e00\u7dd2\u306b\u8d70\u3089\u305b\u308b\nRedis\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ec\u30a4\u30e4\u30fc\u3092\u631f\u3080\n\n\n\n\n\nReplication Controller\n\n\u6307\u5b9a\u3057\u305f\u6570\u306epod\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u3002\n\n\n\u591a\u3059\u304e\u305f\u3089\u6bba\u3059\u3001\u5c11\u306a\u304b\u3063\u305f\u3089\u7acb\u3061\u4e0a\u3052\u308b\u3001\u843d\u3061\u305f\u3089\u518d\u8d77\u52d5\u3059\u308b\n\n\n\n\n\nDeployment\n\nReplication Controller\u306e\u6a5f\u80fd\u306b\u52a0\u3048\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\n\n\npod\u306e\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\n\n\n\n\n\nService\n\npod\u306f\u3001replication controller\u306b\u3088\u308b\u8ffd\u52a0/\u524a\u9664\u3084\u518d\u8d77\u52d5\u304c\u884c\u308f\u308c\u308b\u305f\u3081\u3001\u57fa\u672c\u7684\u306bip\u306f\u56fa\u5b9a\u3067\u306a\u3044\u3002\n\u306a\u306e\u3067\u3001pod\u306b\u5225\u306epod\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u305f\u308a(micro service\u306a\u3069)\u3001\u30af\u30e9\u30b9\u30bf\u5916\u90e8\u304b\u3089pod\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u306fservice\u3092\u4f5c\u308b\u3002\n\u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u306f\u3001DNS\u3067service\u3092\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nService\u306f\u3001\u7528\u9014\u5225\u306b4\u7a2e\u985e\u3042\u308b\u3002\n\n\nClusterIP\n\n\u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u3057\u304b\u30a2\u30af\u30bb\u30b9\u3057\u306a\u3044pod\u306b\u5bfe\u3057\u3066\u306f\u3001\u3053\u306etype\u306eservice\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u3069\u306epod\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u632f\u308a\u5206\u3051\u308b\u304b\u3069\u3046\u304b\u3001\u306flabel\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\n\n\nNodePort\n\n\u30af\u30e9\u30b9\u30bf\u5916\u90e8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u3001\u3053\u306etype\u3067\u4f5c\u6210\u3059\u308b\u3002\n\u4f5c\u6210\u6642\u306b\u3001nodePort\u3068\u3088\u3070\u308c\u308b\u30dd\u30fc\u30c8\u304c\u81ea\u52d5\u7684\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3001\u3059\u3079\u3066\u306enode\u306b\u5bfe\u3057\u3066\u3001node\u306eip:nodePort\u3067\u8a72\u5f53pod\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002(ClusterIP\u3068\u540c\u3058\u304f\u3001pod\u306e\u884c\u304d\u5148\u306flabel\u3067\u8a2d\u5b9a)\nnodePort\u306f\u660e\u793a\u7684\u306b\u6307\u5b9a\u3067\u304d\u308b\u304c\u3001\u91cd\u8907\u3092\u3055\u3051\u308b\u305f\u3081k8s\u306b\u4efb\u305b\u305f\u65b9\u304c\u3088\u3044\u3002\n\u5916\u90e8LB\u3092\u4f7f\u3063\u3066\u3001\u8a73\u7d30\u306ahealth\u30c1\u30a7\u30c3\u30af\u306e\u8a2d\u5b9a\u3084SSL-termination\u3092\u884c\u3046\u5834\u5408\u3001\u300cNodePort\u3067service\u3092\u4f5c\u6210\u5f8c\u3001kubectl\u3067nodePort\u3092\u53d6\u5f97\u3001\u5225\u9014(GCP\u306a\u3089deployment-manager\u306a\u3069)\u3067LB\u3092\u8a2d\u5b9a\u300d\u3059\u308b\u306e\u304c\u3088\u3055\u305d\u3046\uff1f\n\n\n\nLoadBalancer\n\nNodePort\u3068\u540c\u3058\u304f\u30af\u30e9\u30b9\u30bf\u5916\u90e8\u306bpod\u3092\u516c\u958b\u3059\u308b\u969b\u306b\u4f7f\u3046\u304c\u3001\u5916\u90e8LB\u3082\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002(GKE\u306a\u3089Cloud LB)\n\n\nhealth\u30c1\u30a7\u30c3\u30af\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3084\u9593\u9694\u306a\u3069\u3001\u7d30\u304b\u3044\u5236\u5fa1\u304c\u53ef\u80fd\u306a\u306e\u304b\uff1f(\u672a\u8abf\u67fb)\n\u4f5c\u6210\u3055\u308c\u308bLB\u306fL4\u3002L7LB\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u4e0a\u8ff0\u306e\u901a\u308aNodePort + L7LB\u3092\u5225\u9014\u7acb\u3066\u308b\u304b\u3001Ingress Resources\u3092\u4f7f\u3046\u3002\n\n\n\n\n\nExternalName\n\n\u4ed6\u306e\u3068\u306f\u9055\u3044\u3001pod\u304b\u3089\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u305f\u3044\u969b\u306b\u4f7f\u3046\n\n\n\u5b9f\u904b\u7528\u3067\u306f\u3001RDB\u306f\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u305d\u3046\u3044\u3046\u5834\u5408\u306bExternalName\u3092\u7acb\u3066\u308b\u3002\n\u30ed\u30fc\u30ab\u30eb\u3068\u672c\u756a\u3067\u5411\u304d\u5148\u3092\u5909\u3048\u308b\u3001\u307f\u305f\u3044\u306e\u304cExternalName Service\u306e\u5207\u308a\u66ff\u3048\u3060\u3051\u3067\u3067\u304d\u308b\u3002\n\n\n\n\n\n\u53c2\u8003\n\nPods\nReplication Controller\nDeployments\nServices\n\n\n\nExample\n\nAkka-Http application\n\n\nbackend DB (external MySQL)\n\n\n\n\n0. Clone repository\n$ git clone https://github.com/ocadaruma/introduction-to-kubernetes\n\n\n1. Build image\n$ eval $(minikube docker-env) # minikube\u4e0a\u3067\u30ed\u30fc\u30ab\u30eb\u306edocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u305f\u3081\n$ cd app\n$ sbt docker\n$ docker images\nREPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE\nexample/example                                       latest              ac5970138dba        About an hour ago   144.4 MB\nexample/example                                       v1.0-SNAPSHOT       4a6bdb4a8719        8 hours ago         144.4 MB\n\n\n2. Create services\n$ cd ../k8s\n$ kubectl create -f services.yaml\nservice \"mysql-service\" created\nservice \"example-app\" created\n$ kubectl get svc\nNAME            CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nexample-app     10.0.0.24    <nodes>       3000/TCP   40s\nkubernetes      10.0.0.1     <none>        443/TCP    54d\nmysql-service                10.0.2.2      3306/TCP   40s\n$ kubectl get svc example-app -o 'jsonpath={.spec.ports[0].nodePort}'\n32425\n\n32425\u756a\u3067NodePort\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n3. Deploy application\n$ kubectl apply -f deployment.yaml\ndeployment \"example-app-deployment\" created\n$ kubectl get po\nNAME                                      READY     STATUS    RESTARTS   AGE\nexample-app-deployment-2393591303-86kcz   1/1       Running   0          18s\nexample-app-deployment-2393591303-8nn4g   1/1       Running   0          18s\nexample-app-deployment-2393591303-ldbx1   1/1       Running   0          18s\n\n\n\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\n\nhttps://github.com/ocadaruma/introduction-to-kubernetes\n\n\nFurther Reading\n\nUser Guide\nBuilding High-Availability Clusters\nZero Downtime Deployments in Kuberentes\n\n`@Opt Technologies \u793e\u5185\u52c9\u5f37\u4f1a 2017/01/20`\n\u3053\u3061\u3089\u306f\u3001\u793e\u5185\u52c9\u5f37\u4f1a\u3067\u4f7f\u3063\u305f\u8cc7\u6599\u3068\u306a\u308a\u307e\u3059\u3002\n\n---\n## \u306f\u3058\u3081\u306b\n### \u8a71\u3059\u3053\u3068\n- Kubernetes(\u4ee5\u964dk8s)\u3068\u306f\u4f55\u304b\n- k8s\u306e\u6a5f\u80fd\u306e\u4e00\u90e8\n- \u7c21\u5358\u306aScala\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308b\u4f8b\n\n---\n### \u8a71\u3055\u306a\u3044\u3053\u3068\n- \u76e3\u8996\n- \u30ed\u30ae\u30f3\u30b0\n- \u6c38\u7d9a\u5316 (Volume)\n- \u8a8d\u8a3c\n- \u30af\u30e9\u30b9\u30bf\u306e\u69cb\u7bc9\u65b9\u6cd5\n\n---\n## \u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u306e\u5229\u70b9\n- Blue-Green(Red-Black)\u30c7\u30d7\u30ed\u30a4\u306b\u3088\u308b\u904b\u7528\u30b3\u30b9\u30c8\u6e1b\n  - <=> In-Place (Capistrano\u306a\u3069)\n  - \u30b3\u30f3\u30c6\u30ca\u3067\u3042\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002(packer\u3067\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u4f5c\u308b\u306a\u3069\u3067\u3082\u3044\u3044)\n- \u8d77\u52d5\u304c\u901f\u3044\n  - \u7d20\u65e9\u304f\u30b9\u30b1\u30fc\u30eb\u3067\u304d\u308b\n  - \u4eee\u60f3\u30de\u30b7\u30f3\u306b\u306f\u7121\u3044\u5229\u70b9\n- \u958b\u767a\u74b0\u5883\u3068\u672c\u756a\u74b0\u5883\u306e\u30ae\u30e3\u30c3\u30d7\u3092\u6e1b\u3089\u305b\u308b\n\n---\n## \u30b3\u30f3\u30c6\u30ca\u30c7\u30d7\u30ed\u30a4\u3067\u8003\u3048\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3053\u3068\n- \u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u901a\u4fe1\n  - \u4f8b: MicroServices\n- Load Balancing\n  - \u30aa\u30fc\u30c8\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\n- \u30de\u30eb\u30c1\u30db\u30b9\u30c8\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u5272\u308a\u5f53\u3066\n- \u81ea\u52d5\u30ea\u30ab\u30d0\u30ea\n- \u306a\u3069\u306a\u3069\n\n---\n## k8s\u3068\u306f\n- \u524d\u8ff0\u306e\u3088\u3046\u306a\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u3001\u30b3\u30f3\u30c6\u30ca\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u306e\u4e00\u3064\n  - \u4ed6: Docker Swarm, Amazon ECS etc\n- Google\u5185\u90e8\u3067\u4f7f\u308f\u308c\u3066\u3044\u305fBorg\u304c\u5143\u306b\u306a\u3063\u3066\u3044\u308b\n- \u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3082\u3042\u308b\n  - Google Container Engine (GKE)\n- \u8aad\u307f\u65b9\u306f\u3001k8s meetup\u3067\u306f\u300c\u30af\u30d0\u30cd\u30c6\u30b9\u300d\u304c\u591a\u6570\u6d3e\u3060\u3063\u305f\u5370\u8c61\n\n---\n## \u3053\u306e\u8cc7\u6599\u306e\u74b0\u5883\n- minikube : v0.14.0\n  - kubernetes : v1.5.1\n\n---\n## k8s\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\n\u56f3\u306a\u3069\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3002[Kubernetes architecture](https://github.com/kubernetes/community/blob/master/contributors/design-proposals/architecture.md)\n\n### Master\n\n- k8s\u306fmaster - slave(node)\u30e2\u30c7\u30eb\u3002\n- \u30af\u30e9\u30b9\u30bf\u306e\u7ba1\u7406\u3092\u884c\u3046\u3001\u8907\u6570\u306e\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u7d44\u3092master(\u307e\u305f\u306fcontrol plane)\u3068\u547c\u3076\u3002\n- \u3059\u3079\u3066\u30921\u30de\u30b7\u30f3\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u306f\u306a\u3044\u3002\uff08\u7279\u306betcd\u306f\u5206\u3051\u305f\u307b\u3046\u304c\u3088\u3055\u305d\u3046\uff09\n- k8s\u306fmaster\u304c\u6b7b\u3093\u3067\u3082pod\u306f\u52d5\u304d\u7d9a\u3051\u308b\u306e\u3067\u3001HA\u69cb\u6210\u306b\u3057\u306a\u304f\u3066\u3082\u3042\u308b\u7a0b\u5ea6\u904b\u7528\u3067\u304d\u305d\u3046\u3002(\u3082\u3061\u308d\u3093api-server\u304c\u6b7b\u3093\u3067\u308b\u306e\u3067pod\u306e\u8ffd\u52a0/\u524a\u9664\u306a\u3069\u306f\u3067\u304d\u306a\u3044\u3002\u3042\u3068DNS\u3068\u304b\u306f\u3069\u3046\u306a\u308b\u3093\u3060\u308d\u3046\uff1f)\n\n---\n\u4ee5\u4e0b\u304cmaster\u3092\u69cb\u6210\u3059\u308b\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\n\n- kube-apiserver\n  - k8s\u306e\u8a2d\u5b9a\u60c5\u5831\u306eCRUD\u3092\u884c\u3046REST server\n- etcd\n  - Raft\u3068\u3044\u3046\u5408\u610f\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u57fa\u3065\u304fGo\u88fd\u306e\u5206\u6563KVS\n  - k8s\u30af\u30e9\u30b9\u30bf\u306e\u8a2d\u5b9a\u60c5\u5831\u306f\u3059\u3079\u3066\u3053\u3053\u306b\u4fdd\u5b58\u3055\u308c\u308b\n- kube-controller-manager\n  - k8s\u3067\u306f\u3001controller\u3068\u547c\u3070\u308c\u308b\u30eb\u30fc\u30d7\u304c\u3044\u304f\u3064\u304b\u56de\u3063\u3066\u3044\u3066\u3001\u305d\u306e\u30eb\u30fc\u30d7\u306e\u4e2d\u3067\u73fe\u5728\u306e\u30af\u30e9\u30b9\u30bf\u306estate\u3068\u8a2d\u5b9a\u3055\u308c\u305fstate\u3092\u6bd4\u8f03\u3057\u3066\u66f4\u65b0\u3057\u3066\u3044\u304f\u3002\n  - \u305d\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u30eb\u30fc\u30d7\u3092\u675f\u306d\u305f\u30c7\u30fc\u30e2\u30f3\n      - Replication Controller\n      - Node Controller\n      - Deployment Controller\n      - \u306a\u3069\u306a\u3069\n- kube-scheduler\n  - \u65b0\u305f\u306b\u8ffd\u52a0\u3055\u308c\u305fpod\u3092\u691c\u51fa\u3057\u3001node\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3002\n- addons\n  - \u30af\u30e9\u30b9\u30bf\u5185DNS\u306a\u3069\u3001\u4e00\u90e8\u306e\u671f\u9593\u6a5f\u80fd\u306f\u305d\u308c\u81ea\u4f53\u304cpod/service\u3068\u3057\u3066\u52d5\u3044\u3066\u3044\u3066\u3001\u3053\u308c\u3089\u3092addons\u3068\u547c\u3076\u3002\n  - `kube-system`\u3068\u3044\u3046namespace\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u308b\u3002 (`$ kubectl get svc --namespace=kube-system`\u3067\u898b\u3048\u308b)\n\n---\n#### \u53c2\u8003\n- [Kubernetes Components](https://kubernetes.io/docs/admin/cluster-components/)\n- [CoreOS User Forum](https://groups.google.com/d/msg/coreos-user/-g3o3ZAOwQ4/Lm25-6gdYdEJ)\n- [Master-Node communication](https://kubernetes.io/docs/admin/master-node-communication/)\n- [Can Pod/Service still work if kube-master or etcd service down?](http://stackoverflow.com/questions/33951663/can-pod-service-still-work-if-kube-master-or-etcd-service-down)\n- [Kubernetes\u3092\u62e1\u5f35\u3057\u3088\u3046](https://www.ianlewis.org/jp/extending-kubernetes-ja)\n\n---\n### Node\n\n- \u30b3\u30f3\u30c6\u30ca\u304c\u8d70\u308b\u30de\u30b7\u30f3\u306e\u3053\u3068\u3092\u3001node\u3068\u547c\u3076\u3002\uff08\u5f93\u6765\u306fminion\u3068\u547c\u3070\u308c\u3066\u3044\u305f\uff09\n- node\u306e\u8ffd\u52a0/\u524a\u9664\u306fk8s\u306e\u8cac\u52d9\u306e\u5916\u3002\uff08\u843d\u3061\u3066\u3044\u308bnode\u306bpod\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3057\u306a\u3044\u3001\u306a\u3069\u306f\u3057\u3066\u304f\u308c\u308b\uff09\n\nk8s\u30af\u30e9\u30b9\u30bf\u306e\u30e1\u30f3\u30d0\u3068\u3057\u3066\u52d5\u4f5c\u3059\u308b\u305f\u3081\u306b\u3001\u3059\u3079\u3066\u306enode\u3067\u4ee5\u4e0b\u306e\u30c7\u30fc\u30e2\u30f3\u304c\u52d5\u3044\u3066\u3044\u308b\u3002\n\n- kubelet\n  - apiserver\u3092\u901a\u3058\u3066\u3001\u81ea\u30ce\u30fc\u30c9\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u305fpod\u3092\u78ba\u8a8d\u3057\u3001\u8d77\u52d5\u3059\u308b\n- kube-proxy\n  - \u8a2d\u5b9a\u3055\u308c\u305fservice\u306b\u5fdc\u3058\u3066\u3001TCP/UDP\u901a\u4fe1\u3092\u9069\u5207\u306apod\u306bforward\u3059\u308bproxy\n\n---\n#### \u53c2\u8003\n\n- [kubelet](https://kubernetes.io/docs/admin/kubelet/)\n- [kube-proxy](https://kubernetes.io/docs/admin/kube-proxy/)\n\n---\n## Resources(\u4e00\u90e8)\n\nk8s\u3067\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308bresource\u306e\u4e00\u90e8\u3092\u89e3\u8aac\u3002\n\n\u30ab\u30b9\u30bf\u30e0resource\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002(https://kubernetes.io/docs/user-guide/thirdpartyresources/)\n\n---\n### Pod\n\n\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u96c6\u5408\u3067\u3001\u30c7\u30d7\u30ed\u30a4\u306e\u6700\u5c0f\u5358\u4f4d\u3002\n\n- \u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u307e\u3068\u3081\u305f\u3044\u30b1\u30fc\u30b9:\n  - fluentd\u306a\u3069\u306e\u30ed\u30b0\u30b3\u30ec\u30af\u30bf\u30fc\u3092\u4e00\u7dd2\u306b\u8d70\u3089\u305b\u308b\n  - Redis\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30ec\u30a4\u30e4\u30fc\u3092\u631f\u3080\n\n---\n### Replication Controller\n\n- \u6307\u5b9a\u3057\u305f\u6570\u306epod\u304c\u7acb\u3061\u4e0a\u304c\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u4fdd\u8a3c\u3059\u308b\u3002\n  - \u591a\u3059\u304e\u305f\u3089\u6bba\u3059\u3001\u5c11\u306a\u304b\u3063\u305f\u3089\u7acb\u3061\u4e0a\u3052\u308b\u3001\u843d\u3061\u305f\u3089\u518d\u8d77\u52d5\u3059\u308b\n\n---\n### Deployment\n\n- Replication Controller\u306e\u6a5f\u80fd\u306b\u52a0\u3048\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\n  - pod\u306e\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\n  - \u30ed\u30fc\u30eb\u30d0\u30c3\u30af\n\n---\n### Service\n\n- pod\u306f\u3001replication controller\u306b\u3088\u308b\u8ffd\u52a0/\u524a\u9664\u3084\u518d\u8d77\u52d5\u304c\u884c\u308f\u308c\u308b\u305f\u3081\u3001\u57fa\u672c\u7684\u306bip\u306f\u56fa\u5b9a\u3067\u306a\u3044\u3002\n- \u306a\u306e\u3067\u3001pod\u306b\u5225\u306epod\u304b\u3089\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u305f\u308a(micro service\u306a\u3069)\u3001\u30af\u30e9\u30b9\u30bf\u5916\u90e8\u304b\u3089pod\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u306fservice\u3092\u4f5c\u308b\u3002\n- \u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u306f\u3001DNS\u3067service\u3092\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\nService\u306f\u3001\u7528\u9014\u5225\u306b4\u7a2e\u985e\u3042\u308b\u3002\n\n---\n#### ClusterIP\n\n- \u30af\u30e9\u30b9\u30bf\u5185\u90e8\u304b\u3089\u3057\u304b\u30a2\u30af\u30bb\u30b9\u3057\u306a\u3044pod\u306b\u5bfe\u3057\u3066\u306f\u3001\u3053\u306etype\u306eservice\u3092\u4f5c\u6210\u3059\u308b\u3002\n- \u3069\u306epod\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u632f\u308a\u5206\u3051\u308b\u304b\u3069\u3046\u304b\u3001\u306flabel\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\n---\n#### NodePort\n\n- \u30af\u30e9\u30b9\u30bf\u5916\u90e8\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u306b\u3001\u3053\u306etype\u3067\u4f5c\u6210\u3059\u308b\u3002\n- \u4f5c\u6210\u6642\u306b\u3001nodePort\u3068\u3088\u3070\u308c\u308b\u30dd\u30fc\u30c8\u304c\u81ea\u52d5\u7684\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u3001**\u3059\u3079\u3066\u306enode\u306b\u5bfe\u3057\u3066\u3001**`node\u306eip:nodePort`\u3067\u8a72\u5f53pod\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3002(ClusterIP\u3068\u540c\u3058\u304f\u3001pod\u306e\u884c\u304d\u5148\u306flabel\u3067\u8a2d\u5b9a)\n- nodePort\u306f\u660e\u793a\u7684\u306b\u6307\u5b9a\u3067\u304d\u308b\u304c\u3001\u91cd\u8907\u3092\u3055\u3051\u308b\u305f\u3081k8s\u306b\u4efb\u305b\u305f\u65b9\u304c\u3088\u3044\u3002\n- \u5916\u90e8LB\u3092\u4f7f\u3063\u3066\u3001\u8a73\u7d30\u306ahealth\u30c1\u30a7\u30c3\u30af\u306e\u8a2d\u5b9a\u3084SSL-termination\u3092\u884c\u3046\u5834\u5408\u3001\u300cNodePort\u3067service\u3092\u4f5c\u6210\u5f8c\u3001kubectl\u3067nodePort\u3092\u53d6\u5f97\u3001\u5225\u9014(GCP\u306a\u3089deployment-manager\u306a\u3069)\u3067LB\u3092\u8a2d\u5b9a\u300d\u3059\u308b\u306e\u304c\u3088\u3055\u305d\u3046\uff1f\n\n---\n#### LoadBalancer\n\n- NodePort\u3068\u540c\u3058\u304f\u30af\u30e9\u30b9\u30bf\u5916\u90e8\u306bpod\u3092\u516c\u958b\u3059\u308b\u969b\u306b\u4f7f\u3046\u304c\u3001\u5916\u90e8LB\u3082\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u308b\u3002(GKE\u306a\u3089Cloud LB)\n  - health\u30c1\u30a7\u30c3\u30af\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3084\u9593\u9694\u306a\u3069\u3001\u7d30\u304b\u3044\u5236\u5fa1\u304c\u53ef\u80fd\u306a\u306e\u304b\uff1f(\u672a\u8abf\u67fb)\n  - \u4f5c\u6210\u3055\u308c\u308bLB\u306fL4\u3002L7LB\u3092\u4f7f\u3044\u305f\u3044\u5834\u5408\u306f\u4e0a\u8ff0\u306e\u901a\u308aNodePort + L7LB\u3092\u5225\u9014\u7acb\u3066\u308b\u304b\u3001[Ingress Resources](http://kubernetes.io/docs/user-guide/ingress/)\u3092\u4f7f\u3046\u3002\n\n---\n#### ExternalName\n\n- \u4ed6\u306e\u3068\u306f\u9055\u3044\u3001pod\u304b\u3089\u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u53c2\u7167\u3057\u305f\u3044\u969b\u306b\u4f7f\u3046\n  - \u5b9f\u904b\u7528\u3067\u306f\u3001RDB\u306f\u30de\u30cd\u30fc\u30b8\u30c9\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u308a\u3059\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u305d\u3046\u3044\u3046\u5834\u5408\u306bExternalName\u3092\u7acb\u3066\u308b\u3002\n  - \u30ed\u30fc\u30ab\u30eb\u3068\u672c\u756a\u3067\u5411\u304d\u5148\u3092\u5909\u3048\u308b\u3001\u307f\u305f\u3044\u306e\u304cExternalName Service\u306e\u5207\u308a\u66ff\u3048\u3060\u3051\u3067\u3067\u304d\u308b\u3002\n\n---\n### \u53c2\u8003\n- [Pods](https://kubernetes.io/docs/user-guide/pods/)\n- [Replication Controller](https://kubernetes.io/docs/user-guide/replication-controller/)\n- [Deployments](https://kubernetes.io/docs/user-guide/deployments/)\n- [Services](https://kubernetes.io/docs/user-guide/services/)\n\n---\n## Example\n- Akka-Http application\n  - backend DB (external MySQL)\n\n### 0. Clone repository\n\n```bash\n$ git clone https://github.com/ocadaruma/introduction-to-kubernetes\n```\n\n### 1. Build image\n\n```bash\n$ eval $(minikube docker-env) # minikube\u4e0a\u3067\u30ed\u30fc\u30ab\u30eb\u306edocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u305f\u3081\n$ cd app\n$ sbt docker\n$ docker images\nREPOSITORY                                            TAG                 IMAGE ID            CREATED             SIZE\nexample/example                                       latest              ac5970138dba        About an hour ago   144.4 MB\nexample/example                                       v1.0-SNAPSHOT       4a6bdb4a8719        8 hours ago         144.4 MB\n```\n\n### 2. Create services\n\n```bash\n$ cd ../k8s\n$ kubectl create -f services.yaml\nservice \"mysql-service\" created\nservice \"example-app\" created\n$ kubectl get svc\nNAME            CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE\nexample-app     10.0.0.24    <nodes>       3000/TCP   40s\nkubernetes      10.0.0.1     <none>        443/TCP    54d\nmysql-service                10.0.2.2      3306/TCP   40s\n$ kubectl get svc example-app -o 'jsonpath={.spec.ports[0].nodePort}'\n32425\n```\n\n32425\u756a\u3067NodePort\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n### 3. Deploy application\n\n```bash\n$ kubectl apply -f deployment.yaml\ndeployment \"example-app-deployment\" created\n$ kubectl get po\nNAME                                      READY     STATUS    RESTARTS   AGE\nexample-app-deployment-2393591303-86kcz   1/1       Running   0          18s\nexample-app-deployment-2393591303-8nn4g   1/1       Running   0          18s\nexample-app-deployment-2393591303-ldbx1   1/1       Running   0          18s\n```\n\n![Screen Shot 2017-01-20 at 6.51.18 PM.png](https://qiita-image-store.s3.amazonaws.com/0/38151/c48cc659-0fd9-c385-d2f2-18e7cfc1abbd.png)\n\n---\n## \u30ea\u30dd\u30b8\u30c8\u30ea\n- https://github.com/ocadaruma/introduction-to-kubernetes\n\n## Further Reading\n- [User Guide](https://kubernetes.io/docs/user-guide/)\n- [Building High-Availability Clusters](https://kubernetes.io/docs/admin/high-availability/)\n- [Zero Downtime Deployments in Kuberentes](https://www.chrismoos.com/2016/09/28/zero-downtime-deployments-kubernetes/)\n", "tags": ["kubernetes", "GoogleContainerEngine"]}