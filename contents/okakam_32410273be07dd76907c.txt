{"tags": ["fluentd", "Elasticsearch"], "context": " More than 1 year has passed since last update.\n\nfluentd \u306b GEOIP Plugin \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nIP Adress \u304b\u3089 Location\u60c5\u5831\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5f15\u3044\u3066\u304f\u308c\u308b\u4fbf\u5229\u306aPlugin\u3067\u3059\nCentOS6\u3067Install\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u307e\u3059\nPlugin \u3053\u3061\u3089\u306e\u65b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\nhttps://github.com/y-ken/fluent-plugin-geoip\n\ngpio-devel \u3092 Install \u3059\u308b\n\nepel repository \u3092\u8ffd\u52a0\nepel repository \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u308b\n\nwget http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\nrpm -ivh epel-release-6-8.noarch.rpm\n\n\ngpio-devel \u3092Install\n\nyum install geoip-devel --enablerepo=epel \n\n\nPlugin Install\n\nPlugin \u3092 Install \u3059\u308b\n\n\nsudo td-agent-gem install fluent-plugin-geoip\n\ngcc \u304c Install\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u3053\u3053\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001gcc \u306eInstall\u304c\u672a\u6e08\u306e\u5834\u5408\u3053\u3053\u3067Install\u3059\u308b\nyum install gcc\n\n\n\u4f7f\u3044\u65b9\n\u8a73\u3057\u3044\u4f7f\u3044\u65b9\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\nhttps://github.com/y-ken/fluent-plugin-geoip\nElasticsearch \u306b\u3044\u308c\u3066\u3001kibana \u304b\u3089\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u3066\u3084\u308b\u3068\u3044\u3044\n\u203b Elasticsearch \u4e0a\u3067 GIO_IP \u3068\u3057\u3066 mapping \u3059\u308b\u3053\u3068\u3092\u5fd8\u308c\u305a\u306b  \n\ntd-agent.conf\n<match access.*>\n  type geoip\n  geoip_lookup_key host\n  skip_adding_null_record  true\n  add_tag_suffix .gioip\n  <record>\n    country ${country_code['host']}\n    location ${latitude['host']},${longitude['host']}\n  </record>\n</match>\n\n\nElasticserch \u306e\u30de\u30c3\u30d4\u30f3\u30b0(\u53c2\u8003)\ncurl -XPUT http://localhost:9200/_template/access_log/ -d '\n{\n  \"template\": \"access_log-*\",\n  \"mappings\": {\n    \"access_log\":{\n      \"properties\":{\n        \"location\":{\n          \"type\":\"geo_point\"\n        }\n      }\n    }\n  }\n}\n'\n\n\n# fluentd \u306b GEOIP Plugin \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\nIP Adress \u304b\u3089 Location\u60c5\u5831\u3092\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5f15\u3044\u3066\u304f\u308c\u308b\u4fbf\u5229\u306aPlugin\u3067\u3059  \nCentOS6\u3067Install\u3059\u308b\u3053\u3068\u3092\u60f3\u5b9a\u3057\u307e\u3059\n\nPlugin \u3053\u3061\u3089\u306e\u65b9\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002  \nhttps://github.com/y-ken/fluent-plugin-geoip\n\n## gpio-devel \u3092 Install \u3059\u308b\n\n1. epel repository \u3092\u8ffd\u52a0  \nepel repository \u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u308b\n\n```bash\nwget http://ftp-srv2.kddilabs.jp/Linux/distributions/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\nrpm -ivh epel-release-6-8.noarch.rpm\n```\n\n2. gpio-devel \u3092Install\n\n```bash\nyum install geoip-devel --enablerepo=epel \n```\n\n## Plugin Install\n1. Plugin \u3092 Install \u3059\u308b  \n\n```bash\nsudo td-agent-gem install fluent-plugin-geoip\n```\n\ngcc \u304c Install\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u3053\u3053\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u306e\u3067\u3001gcc \u306eInstall\u304c\u672a\u6e08\u306e\u5834\u5408\u3053\u3053\u3067Install\u3059\u308b\n\n```bash\nyum install gcc\n```\n\n## \u4f7f\u3044\u65b9\n\u8a73\u3057\u3044\u4f7f\u3044\u65b9\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002  \nhttps://github.com/y-ken/fluent-plugin-geoip\n\nElasticsearch \u306b\u3044\u308c\u3066\u3001kibana \u304b\u3089\u53c2\u7167\u3057\u305f\u3044\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3057\u3066\u3084\u308b\u3068\u3044\u3044  \n\u203b Elasticsearch \u4e0a\u3067 GIO_IP \u3068\u3057\u3066 mapping \u3059\u308b\u3053\u3068\u3092\u5fd8\u308c\u305a\u306b  \n\n```xml:td-agent.conf\n<match access.*>\n  type geoip\n  geoip_lookup_key host\n  skip_adding_null_record  true\n  add_tag_suffix .gioip\n  <record>\n    country ${country_code['host']}\n    location ${latitude['host']},${longitude['host']}\n  </record>\n</match>\n```\n\nElasticserch \u306e\u30de\u30c3\u30d4\u30f3\u30b0(\u53c2\u8003)\n\n```bash\ncurl -XPUT http://localhost:9200/_template/access_log/ -d '\n{\n  \"template\": \"access_log-*\",\n  \"mappings\": {\n    \"access_log\":{\n      \"properties\":{\n        \"location\":{\n          \"type\":\"geo_point\"\n        }\n      }\n    }\n  }\n}\n'\n```\n"}