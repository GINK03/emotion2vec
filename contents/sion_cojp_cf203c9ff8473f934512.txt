{"context": "\n\n\u6982\u8981\n\nlambda + apex + Go\u3067Slack\u306eIncomming Webhooks\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u98db\u3070\u3057\u307e\u3059\n\n\n\u5185\u5bb9\n\n\u2460IAM\u3067\"lambda_apex_go\"\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\n\u30a4\u30f3\u30e9\u30a4\u30f3\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"iam:Create*\",\n                \"iam:Attach*\",\n                \"iam:PassRole\",\n                \"lambda:*\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n\u2461\u81ea\u5206\u306eIAM\u30e6\u30fc\u30b6\u306b\"lambda_apex_go\"\u30b0\u30eb\u30fc\u30d7\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n\n\u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304f\u3060\u3055\u3044\n\n\n\u2462\u3053\u3053\u304b\u3089\u30ed\u30fc\u30ab\u30eb\u4f5c\u696d\u3002apex\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6398\u308a\u307e\u3059\u3002\n### apex\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh\n$ mkdir apex-sample-go\n$ cd apex-sample-go\n\n### ~/.aws/config\u306f\u3002\u3002\u8a2d\u5b9a\u3057\u3066\u308b\u3068\u601d\u3046\u304b\u3089\u30b9\u30eb\u30fc\u3059\u308b\u306d\uff01\n\n### init\n$ go get github.com/apex/go-apex\n$ apex init\n\n             _    ____  _______  __\n            / \\  |  _ \\| ____\\ \\/ /\n           / _ \\ | |_) |  _|  \\  /\n          / ___ \\|  __/| |___ /  \\\n         /_/   \\_\\_|   |_____/_/\\_\\\n\n\n\n  Enter the name of your project. It should be machine-friendly, as this\n  is used to prefix your functions in Lambda.\n\n    Project name: apex-sample-golang\n\n  Enter an optional description of your project.\n\n    Project description: apex-samle-golang\n\n  [+] creating IAM apex-sample-golang_lambda_function role\n  [+] creating IAM apex-sample-golang_lambda_logs policy\n  [+] attaching policy to lambda_function role.\n  [+] creating ./project.json\n  [+] creating ./functions\n\n  Setup complete, deploy those functions!\n\n    $ apex deploy\n\n### \u78ba\u8a8d\n$ tree\n.\n\u251c\u2500\u2500 functions\n\u2502   \u2514\u2500\u2500 hello\n\u2502       \u2514\u2500\u2500 index.js\n\u2514\u2500\u2500 project.json\n\n\n\u2463\u901a\u77e5\u7528\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304f\n\n\u6700\u7d42\u7684\u306a\u69cb\u6210\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\u6700\u521d\u306b\u51fa\u6765\u305f\u3001index.js\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\n\n$ tree\n.\n\u251c\u2500\u2500 functions\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hello\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 main.go\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 run.go\n\u2514\u2500\u2500 project.json\n\n\nmain.go\npackage main\n\nimport (\n    \"encoding/json\"\n\n    \"github.com/apex/go-apex\"\n)\n\ntype message struct {\n    Hello string `json:\"hello\"`\n}\n\nfunc main() {\n    apex.HandleFunc(func(event json.RawMessage, ctx *apex.Context) (interface{}, error) {\n        Run()\n\n        return nil, nil\n    })\n}\n\n\nrun.go\u3000\u3000(\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\u3092\u7de8\u96c6\u3057\u3066\u304f\u3060\u3055\u3044)\npackage main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"net/url\"\n)\n\ntype Slack struct {\n    Text      string `json:\"text\"`\n    Username  string `json:\"username\"`\n    IconEmoji string `json:\"icon_emoji\"`\n    IconURL   string `json:\"icon_url\"`\n    Channel   string `json:\"channel\"`\n}\n\nfunc LoadSlackParam() *Slack {\n    return &Slack{\n        Text:      \"test\u3060\u3088\uff01\",\n        Username:  \"test\",\n        IconEmoji: \":bow:\",\n        IconURL:   \"\",\n        Channel:   \"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\u66f8\u3044\u3066\u306d\",\n    }\n}\n\nfunc Run()  {\n    URL := \"https://hooks.slack.com/services/xxxxxx/xxxxx/xxxxxxxxxxxxxxxxx\"\n    params, _ := json.Marshal(LoadSlackParam())\n\n    resp, _ := http.PostForm(\n        URL,\n        url.Values{\"payload\": {string(params)}},\n    )\n\n    defer resp.Body.Close()\n}\n\n\n\u2464deploy\u3059\u308b\n$ apex deploy\n# deploy\u304c\u7d42\u308f\u3063\u305f\u3001lambda\u3067apex-sample-golang_hello\u95a2\u6570\u304c\u3067\u304d\u3066\u308b\u306f\u305a\u3067\u3059\n\n\n\u2465\u5b9f\u884c\u3057\u3066\u307f\u308b\n### apex\u3067\u6398\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u3067\u3042\u308c\u3070\n$ apex invoke hello\n\n### aws cli\u7d4c\u7531\u3067\u3042\u308c\u3070\n$ aws lambda invoke --function-name apex-sample-golang_hello --invocation-type Event outputfile.txt\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u6295\u7a3f\u3055\u308c\u308b\u304b\u3068\u601d\u3044\u307e\u3059\n\n\n\n\u2466\u524a\u9664\u3059\u308b\u3068\u304d\u306f\uff1f\n### apex\u304b\u3089\u524a\u9664\n$ apex delete\nyes\n# \u30a6\u30a7\u30d6\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u524a\u9664\u3057\u3066\u3082\u826f\u3044\u3067\u3059\n\n### \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067IAM\u304b\u3089\u4e0b\u8a18\u3092\u524a\u9664\n\u4f7f\u3063\u305fPolicy\n\u4f7f\u3063\u305frole\n\n# \u6982\u8981\n* lambda + apex + Go\u3067Slack\u306eIncomming Webhooks\u3092\u4f7f\u3063\u3066\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u98db\u3070\u3057\u307e\u3059\n\n# \u5185\u5bb9\n## \u2460IAM\u3067\"lambda_apex_go\"\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u308b\n\u30a4\u30f3\u30e9\u30a4\u30f3\u30dd\u30ea\u30b7\u30fc\u306f\u4e0b\u8a18\u306b\u306a\u308a\u307e\u3059\n\n```json\n\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"iam:Create*\",\n                \"iam:Attach*\",\n                \"iam:PassRole\",\n                \"lambda:*\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n## \u2461\u81ea\u5206\u306eIAM\u30e6\u30fc\u30b6\u306b\"lambda_apex_go\"\u30b0\u30eb\u30fc\u30d7\u30a2\u30bf\u30c3\u30c1\u3059\u308b\n* \u30a2\u30bf\u30c3\u30c1\u3057\u3066\u304f\u3060\u3055\u3044\n\n## \u2462\u3053\u3053\u304b\u3089\u30ed\u30fc\u30ab\u30eb\u4f5c\u696d\u3002apex\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6398\u308a\u307e\u3059\u3002\n```bash\n### apex\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh\n$ mkdir apex-sample-go\n$ cd apex-sample-go\n\n### ~/.aws/config\u306f\u3002\u3002\u8a2d\u5b9a\u3057\u3066\u308b\u3068\u601d\u3046\u304b\u3089\u30b9\u30eb\u30fc\u3059\u308b\u306d\uff01\n\n### init\n$ go get github.com/apex/go-apex\n$ apex init\n\n             _    ____  _______  __\n            / \\  |  _ \\| ____\\ \\/ /\n           / _ \\ | |_) |  _|  \\  /\n          / ___ \\|  __/| |___ /  \\\n         /_/   \\_\\_|   |_____/_/\\_\\\n\n\n\n  Enter the name of your project. It should be machine-friendly, as this\n  is used to prefix your functions in Lambda.\n\n    Project name: apex-sample-golang\n\n  Enter an optional description of your project.\n\n    Project description: apex-samle-golang\n\n  [+] creating IAM apex-sample-golang_lambda_function role\n  [+] creating IAM apex-sample-golang_lambda_logs policy\n  [+] attaching policy to lambda_function role.\n  [+] creating ./project.json\n  [+] creating ./functions\n\n  Setup complete, deploy those functions!\n\n    $ apex deploy\n\n### \u78ba\u8a8d\n$ tree\n.\n\u251c\u2500\u2500 functions\n\u2502   \u2514\u2500\u2500 hello\n\u2502       \u2514\u2500\u2500 index.js\n\u2514\u2500\u2500 project.json\n```\n\n## \u2463\u901a\u77e5\u7528\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304f\n* \u6700\u7d42\u7684\u306a\u69cb\u6210\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n* \u6700\u521d\u306b\u51fa\u6765\u305f\u3001`index.js`\u306f\u524a\u9664\u3057\u3066\u304f\u3060\u3055\u3044\n\n```bash\n$ tree\n.\n\u251c\u2500\u2500 functions\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 hello\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 main.go\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 run.go\n\u2514\u2500\u2500 project.json\n```\n\n### main.go\n```go\npackage main\n\nimport (\n\t\"encoding/json\"\n\n\t\"github.com/apex/go-apex\"\n)\n\ntype message struct {\n\tHello string `json:\"hello\"`\n}\n\nfunc main() {\n\tapex.HandleFunc(func(event json.RawMessage, ctx *apex.Context) (interface{}, error) {\n\t\tRun()\n\n\t\treturn nil, nil\n\t})\n}\n```\n\n### run.go\u3000\u3000(\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\u3092\u7de8\u96c6\u3057\u3066\u304f\u3060\u3055\u3044)\n```go\npackage main\n\nimport (\n\t\"encoding/json\"\n\t\"net/http\"\n\t\"net/url\"\n)\n\ntype Slack struct {\n\tText      string `json:\"text\"`\n\tUsername  string `json:\"username\"`\n\tIconEmoji string `json:\"icon_emoji\"`\n\tIconURL   string `json:\"icon_url\"`\n\tChannel   string `json:\"channel\"`\n}\n\nfunc LoadSlackParam() *Slack {\n\treturn &Slack{\n\t\tText:      \"test\u3060\u3088\uff01\",\n\t\tUsername:  \"test\",\n\t\tIconEmoji: \":bow:\",\n\t\tIconURL:   \"\",\n\t\tChannel:   \"\u30c1\u30e3\u30f3\u30cd\u30eb\u540d\u66f8\u3044\u3066\u306d\",\n\t}\n}\n\nfunc Run()  {\n\tURL := \"https://hooks.slack.com/services/xxxxxx/xxxxx/xxxxxxxxxxxxxxxxx\"\n\tparams, _ := json.Marshal(LoadSlackParam())\n\n\tresp, _ := http.PostForm(\n\t\tURL,\n\t\turl.Values{\"payload\": {string(params)}},\n\t)\n\n\tdefer resp.Body.Close()\n}\n```\n\n## \u2464deploy\u3059\u308b\n```bash\n$ apex deploy\n# deploy\u304c\u7d42\u308f\u3063\u305f\u3001lambda\u3067apex-sample-golang_hello\u95a2\u6570\u304c\u3067\u304d\u3066\u308b\u306f\u305a\u3067\u3059\n```\n\n## \u2465\u5b9f\u884c\u3057\u3066\u307f\u308b\n```bash\n### apex\u3067\u6398\u3063\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5185\u3067\u3042\u308c\u3070\n$ apex invoke hello\n\n### aws cli\u7d4c\u7531\u3067\u3042\u308c\u3070\n$ aws lambda invoke --function-name apex-sample-golang_hello --invocation-type Event outputfile.txt\n```\n* \u3053\u3093\u306a\u611f\u3058\u3067\u6295\u7a3f\u3055\u308c\u308b\u304b\u3068\u601d\u3044\u307e\u3059\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-02-01 17.06.56.png](https://qiita-image-store.s3.amazonaws.com/0/29405/f3dee002-4dd1-bbc3-1fdd-428d85c91e0c.png)\n\n## \u2466\u524a\u9664\u3059\u308b\u3068\u304d\u306f\uff1f\n```bash\n### apex\u304b\u3089\u524a\u9664\n$ apex delete\nyes\n# \u30a6\u30a7\u30d6\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u524a\u9664\u3057\u3066\u3082\u826f\u3044\u3067\u3059\n\n### \u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067IAM\u304b\u3089\u4e0b\u8a18\u3092\u524a\u9664\n\u4f7f\u3063\u305fPolicy\n\u4f7f\u3063\u305frole\n```\n", "tags": ["lambda", "Apex", "Go"]}