{"context": "\n\n\u3069\u3093\u306a\u3068\u304d\u306b\u6709\u52b9?\n\n1\u3064\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u4e2d\u306b\u66f4\u65b0/\u53c2\u7167\u983b\u5ea6\u304c\u9ad8\u3044\u30ab\u30e9\u30e0\u3068\u4f4e\u3044\u30ab\u30e9\u30e0\u304c\u6df7\u5728\u3057\u3066\u3044\u308b\n1\u3064\u306emodel\u306b\u5927\u91cf\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u304c\u3042\u3063\u3066\u53ef\u8aad\u6027\u304c\u4f4e\u3044\n\n\n\u30ab\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\u30e1\u30ea\u30c3\u30c8\n\nmemcache \u306a\u3069\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u7121\u99c4\u304c\u6e1b\u308b\n\n\n\u53c2\u7167\u983b\u5ea6\u306e\u9ad8\u3044\u30c7\u30fc\u30bf\u3060\u3051\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3079\u304d\n\n\n\u66f4\u65b0\u983b\u5ea6\u306e\u591a\u3044\u60c5\u5831\u306e\u30b5\u30a4\u30ba\u306f\u5c0f\u3055\u3044\u307b\u3046\u304c\u826f\u3044\n\n\nDB\u306e\u30e1\u30e2\u30ea\u306b\u306a\u308b\u3079\u304f\u4e57\u308b\u3088\u3046\u306b\n\n\n\n\n\u4f8b\nUser model\u306e\u4e2d\u306b\u3001\u66f4\u65b0/\u53c2\u7167\u983b\u5ea6\u304c\u4f4e\u3044 profile \u95a2\u4fc2\u306e\u60c5\u5831\u304c\u3042\u308b\n\nzipcode\nprefecture_code\ncity_code\naddress\n\n\nUser model\n$ rails g scaffold user name:string mail:string zipcode:string prefecture_code:integer city_code:integer address:string\n\n\ndb/schema.rb\n  create_table \"users\", force: :cascade do |t|\n    t.string   \"name\"\n    t.string   \"mail\"\n    t.string   \"zipcode\"\n    t.integer  \"prefecture_code\"\n    t.integer  \"city_code\"\n    t.string   \"address\"\n    t.datetime \"created_at\",      null: false\n    t.datetime \"updated_at\",      null: false\n  end\n\n\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u5206\u5272\u3059\u308b\n\n1. Profile \u30e2\u30c7\u30eb\u4f5c\u6210\n$ rails g model profile zipcode:string prefecture_code:integer city_code:integer address:string user_id:integer\n\n\n2. Profile \u30e2\u30c7\u30eb\u3068\u3001User\u30e2\u30c7\u30eb\u3092\u95a2\u9023\u4ed8\u3051\n\nprofile.rb\nclass Profile < ActiveRecord::Base\n  belongs_to :user\nend\n\n\nProfile model \u3092 delegate \u3059\u308b\u3053\u3068\u3067\u3001\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u4fee\u6b63\u304c\u4e0d\u8981\u306b\n\nuser.rb\nclass User < ActiveRecord::Base\n  # delegate\u3059\u308b\u3053\u3068\u3067\u3001Profile \u30e2\u30c7\u30eb\u306e\u4e2d\u8eab\u3092 User \u304b\u3089\u53d6\u5f97\u3067\u304d\u308b \n  delegate :zipcode, :prefecture_code, :city_code, :address, to: :profile\n  has_one :profile\nend\n\n\n\n3. \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\nProfile\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u308b\nProfile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u884c\u3059\u308b\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u304b\u3089\u30b3\u30d4\u30fc\nUser\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3001Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3063\u305f\u30ab\u30e9\u30e0\u3092\u524a\u9664\n\n\ndb/migrate/20160619032503_create_profiles.rb\nclass CreateProfiles < ActiveRecord::Migration\n  def up\n    # Profile\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u308b\n    create_table :profiles do |t|\n      t.string :zipcode\n      t.integer :prefecture_code\n      t.integer :city_code\n      t.string :address\n      t.integer :user_id\n\n      t.timestamps null: false\n    end\n\n    # Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u884c\u3059\u308b\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u304b\u3089\u30b3\u30d4\u30fc\n    User.all.each do |user|\n      Profile.create(\n        user:            user,\n        zipcode:         user.zipcode,\n        prefecture_code: user.prefecture_code,\n        city_code:       user.city_code,\n        address:         user.address\n      )\n    end\n\n    # User\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3001Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3063\u305f\u30ab\u30e9\u30e0\u3092\u524a\u9664\n    remove_column :users, :zipcode\n    remove_column :users, :prefecture_code\n    remove_column :users, :city_code\n    remove_column :users, :address\n  end\n\n  def down\n    add_column :users, :zipcode\n    add_column :users, :prefecture_code\n    add_column :users, :city_code\n    add_column :users, :address\n\n    # Profile\u30e2\u30c7\u30eb\u306e\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u306b\u79fb\u884c\n    Profile.each do |profile|\n      profile.user.update(\n        zipcode:         profile.zipcode,\n        prefecture_code: profile.prefecture_code,\n        city_code:       profile.city_code,\n        address:         profile.address\n      )\n    end\n\n    drop_table :profiles\n  end\nend\n\n\n\nProfile\u60c5\u5831\u304c\u5fc5\u8981\u306a\u6642\u3060\u3051\u3001Profile\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\nirb(main):010:0> User.all.first.zipcode\n  User Load (0.3ms)  SELECT  \"users\".* FROM \"users\"  ORDER BY \"users\".\"id\" ASC LIMIT 1\n  Profile Load (0.1ms)  SELECT  \"profiles\".* FROM \"profiles\" WHERE \"profiles\".\"user_id\" = ? LIMIT 1  [[\"user_id\", 1]]\n=> \"419-4284\"\n\nirb(main):011:0> User.all.first.name\n  User Load (0.2ms)  SELECT  \"users\".* FROM \"users\"  ORDER BY \"users\".\"id\" ASC LIMIT 1\n=> \"\u6728\u6751 \u512a\u8863\"\n\n\n\u3053\u306e\u5f8c\u3084\u308b\u3079\u304d\u3053\u3068\n\n\u5fc5\u7136\u6027\u304c\u3042\u307e\u308a\u306a\u3044\u306e\u306b\u3001Profile\u306e\u60c5\u5831\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u90e8\u5206\u3092\u4fee\u6b63\u3059\u308b\n\n\ncode\n\nhttps://github.com/kasei-san/refactor_model\n\n\n\u53c2\u8003\n\n\n\u30d7\u30e9\u30a4\u30de\u30ea\u30ad\u30fc\u3092\u4f7f\u3063\u305f1:1\u95a2\u9023\u3067\u30ab\u30e9\u30e0\u6570\u306e\u591a\u3044\u30c6\u30fc\u30d6\u30eb\u3092\u5206\u5272\u3059\u308b - Hidden in Plain Sight\n\n\u5fc5\u305a1\u5bfe1\u3067\u3042\u308c\u3070\u3001\u308f\u3056\u308f\u3056\u95a2\u9023\u4ed8\u3051\u306a\u304f\u3066\u3082\u3001\u540c\u3058\u5024\u306e\u30d7\u30e9\u30a4\u30de\u30ea\u30ad\u30fc\u3092\u4f7f\u3046\u3068\u3044\u3046\u65b9\u6cd5\n\n\n\u30bd\u30fc\u30b7\u30e3\u30eb\u30b2\u30fc\u30e0\u306e\u305f\u3081\u306eMySQL\u5165\u9580\u305d\u306e\uff12 - Technology of DeNA\n\n# \u3069\u3093\u306a\u3068\u304d\u306b\u6709\u52b9?\n\n- 1\u3064\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u4e2d\u306b\u66f4\u65b0/\u53c2\u7167\u983b\u5ea6\u304c\u9ad8\u3044\u30ab\u30e9\u30e0\u3068\u4f4e\u3044\u30ab\u30e9\u30e0\u304c\u6df7\u5728\u3057\u3066\u3044\u308b\n- 1\u3064\u306emodel\u306b\u5927\u91cf\u306e\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u304c\u3042\u3063\u3066\u53ef\u8aad\u6027\u304c\u4f4e\u3044\n\n# \u30ab\u30e9\u30e0\u3092\u62bd\u51fa\u3059\u308b\u30e1\u30ea\u30c3\u30c8\n\n- memcache \u306a\u3069\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f7f\u3063\u3066\u3044\u308b\u5834\u5408\u306b\u7121\u99c4\u304c\u6e1b\u308b\n    - \u53c2\u7167\u983b\u5ea6\u306e\u9ad8\u3044\u30c7\u30fc\u30bf\u3060\u3051\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u308b\u3079\u304d\n- \u66f4\u65b0\u983b\u5ea6\u306e\u591a\u3044\u60c5\u5831\u306e\u30b5\u30a4\u30ba\u306f\u5c0f\u3055\u3044\u307b\u3046\u304c\u826f\u3044\n    - DB\u306e\u30e1\u30e2\u30ea\u306b\u306a\u308b\u3079\u304f\u4e57\u308b\u3088\u3046\u306b\n\n# \u4f8b\n\nUser model\u306e\u4e2d\u306b\u3001\u66f4\u65b0/\u53c2\u7167\u983b\u5ea6\u304c\u4f4e\u3044 profile \u95a2\u4fc2\u306e\u60c5\u5831\u304c\u3042\u308b\n\n- zipcode\n- prefecture_code\n- city_code\n- address\n\n# User model\n\n```\n$ rails g scaffold user name:string mail:string zipcode:string prefecture_code:integer city_code:integer address:string\n```\n\n```db/schema.rb\n  create_table \"users\", force: :cascade do |t|\n    t.string   \"name\"\n    t.string   \"mail\"\n    t.string   \"zipcode\"\n    t.integer  \"prefecture_code\"\n    t.integer  \"city_code\"\n    t.string   \"address\"\n    t.datetime \"created_at\",      null: false\n    t.datetime \"updated_at\",      null: false\n  end\n```\n\n# \u30c6\u30fc\u30d6\u30eb\u3092\u5206\u5272\u3059\u308b\n\n## 1. Profile \u30e2\u30c7\u30eb\u4f5c\u6210\n\n```\n$ rails g model profile zipcode:string prefecture_code:integer city_code:integer address:string user_id:integer\n```\n\n## 2. Profile \u30e2\u30c7\u30eb\u3068\u3001User\u30e2\u30c7\u30eb\u3092\u95a2\u9023\u4ed8\u3051\n\n```profile.rb\nclass Profile < ActiveRecord::Base\n  belongs_to :user\nend\n```\n\nProfile model \u3092 delegate \u3059\u308b\u3053\u3068\u3067\u3001\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u4fee\u6b63\u304c\u4e0d\u8981\u306b\n\n```user.rb\nclass User < ActiveRecord::Base\n  # delegate\u3059\u308b\u3053\u3068\u3067\u3001Profile \u30e2\u30c7\u30eb\u306e\u4e2d\u8eab\u3092 User \u304b\u3089\u53d6\u5f97\u3067\u304d\u308b \n  delegate :zipcode, :prefecture_code, :city_code, :address, to: :profile\n  has_one :profile\nend\n```\n\n## 3. \u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\n\n1. Profile\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u308b\n1. Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u884c\u3059\u308b\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u304b\u3089\u30b3\u30d4\u30fc\n1. User\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3001Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3063\u305f\u30ab\u30e9\u30e0\u3092\u524a\u9664\n\n```db/migrate/20160619032503_create_profiles.rb\nclass CreateProfiles < ActiveRecord::Migration\n  def up\n    # Profile\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u308b\n    create_table :profiles do |t|\n      t.string :zipcode\n      t.integer :prefecture_code\n      t.integer :city_code\n      t.string :address\n      t.integer :user_id\n\n      t.timestamps null: false\n    end\n\n    # Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u884c\u3059\u308b\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u304b\u3089\u30b3\u30d4\u30fc\n    User.all.each do |user|\n      Profile.create(\n        user:            user,\n        zipcode:         user.zipcode,\n        prefecture_code: user.prefecture_code,\n        city_code:       user.city_code,\n        address:         user.address\n      )\n    end\n\n    # User\u30c6\u30fc\u30d6\u30eb\u304b\u3089\u3001Profile\u30c6\u30fc\u30d6\u30eb\u306b\u79fb\u3063\u305f\u30ab\u30e9\u30e0\u3092\u524a\u9664\n    remove_column :users, :zipcode\n    remove_column :users, :prefecture_code\n    remove_column :users, :city_code\n    remove_column :users, :address\n  end\n\n  def down\n    add_column :users, :zipcode\n    add_column :users, :prefecture_code\n    add_column :users, :city_code\n    add_column :users, :address\n\n    # Profile\u30e2\u30c7\u30eb\u306e\u60c5\u5831\u3092User\u30e2\u30c7\u30eb\u306b\u79fb\u884c\n    Profile.each do |profile|\n      profile.user.update(\n        zipcode:         profile.zipcode,\n        prefecture_code: profile.prefecture_code,\n        city_code:       profile.city_code,\n        address:         profile.address\n      )\n    end\n\n    drop_table :profiles\n  end\nend\n```\n\n# Profile\u60c5\u5831\u304c\u5fc5\u8981\u306a\u6642\u3060\u3051\u3001Profile\u30c6\u30fc\u30d6\u30eb\u3092\u53c2\u7167\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u305f\n\n```\nirb(main):010:0> User.all.first.zipcode\n  User Load (0.3ms)  SELECT  \"users\".* FROM \"users\"  ORDER BY \"users\".\"id\" ASC LIMIT 1\n  Profile Load (0.1ms)  SELECT  \"profiles\".* FROM \"profiles\" WHERE \"profiles\".\"user_id\" = ? LIMIT 1  [[\"user_id\", 1]]\n=> \"419-4284\"\n\nirb(main):011:0> User.all.first.name\n  User Load (0.2ms)  SELECT  \"users\".* FROM \"users\"  ORDER BY \"users\".\"id\" ASC LIMIT 1\n=> \"\u6728\u6751 \u512a\u8863\"\n```\n\n# \u3053\u306e\u5f8c\u3084\u308b\u3079\u304d\u3053\u3068\n\n- \u5fc5\u7136\u6027\u304c\u3042\u307e\u308a\u306a\u3044\u306e\u306b\u3001Profile\u306e\u60c5\u5831\u3092\u53c2\u7167\u3057\u3066\u3044\u308b\u90e8\u5206\u3092\u4fee\u6b63\u3059\u308b\n\n# code\n\n- https://github.com/kasei-san/refactor_model\n\n# \u53c2\u8003\n\n- [\u30d7\u30e9\u30a4\u30de\u30ea\u30ad\u30fc\u3092\u4f7f\u3063\u305f1:1\u95a2\u9023\u3067\u30ab\u30e9\u30e0\u6570\u306e\u591a\u3044\u30c6\u30fc\u30d6\u30eb\u3092\u5206\u5272\u3059\u308b - Hidden in Plain Sight](http://kenn.hatenablog.com/entry/2014/03/05/081525)\n    - \u5fc5\u305a1\u5bfe1\u3067\u3042\u308c\u3070\u3001\u308f\u3056\u308f\u3056\u95a2\u9023\u4ed8\u3051\u306a\u304f\u3066\u3082\u3001\u540c\u3058\u5024\u306e\u30d7\u30e9\u30a4\u30de\u30ea\u30ad\u30fc\u3092\u4f7f\u3046\u3068\u3044\u3046\u65b9\u6cd5\n- [\u30bd\u30fc\u30b7\u30e3\u30eb\u30b2\u30fc\u30e0\u306e\u305f\u3081\u306eMySQL\u5165\u9580\u305d\u306e\uff12 - Technology of DeNA](http://engineer.dena.jp/2011/02/mysql-for-socialgame2.html)\n\n", "tags": ["Rails4", "\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0"]}