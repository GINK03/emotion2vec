{"context": "\n\n\u30b4\u30fc\u30eb\nLaravel\u3092\u4f7f\u3063\u3066\u3001S3\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3002\n\n\u53c2\u8003\u8cc7\u6599\n\nLaravel 5.4 \u516c\u5f0f\u30b5\u30a4\u30c8\nLaravel 5.3\u3000AWS S3\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n\n\u4f5c\u696d\u958b\u59cb\n\nLaravel\u7de8\u96c6\n\ncomposer.json\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \">=5.6.4\",\n        \"laravel/framework\": \"5.4.*\",\n        \"laravel/tinker\": \"~1.0\",\n        \"laravelcollective/html\": \"~5.2\",\n        \"league/flysystem-aws-s3-v3\" : \"~1.0\"\n    },\n...\u7701\u7565\n\n\n\nfilesystems.php\n\nfilesystems.php\n...\u7701\u7565\n    'disks' => [\n\n        'local' => [\n            'driver' => 'local',\n            'root' => storage_path('app'),\n        ],\n\n        'public' => [\n            'driver' => 'local',\n            'root' => storage_path('app/public'),\n            'url' => env('APP_URL').'/storage',\n            'visibility' => 'public',\n        ],\n\n        's3' => [\n            'driver' => 's3',\n            'key' => env('AWS_KEY'),\n            'secret' => env('AWS_SECRET'),\n            'region' => env('AWS_REGION'),\n            'bucket' => env('AWS_BUCKET'),\n        ],\n\n    ],\n\n\nAWS\u8a8d\u8a3c\u60c5\u5831\u306fenv('AWS_SECRET')\u3067\u53d6\u3063\u3066\u3044\u308b\u306e\u3067\u3001.env\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u3002\n\u76f4\u63a5\u3053\u3061\u3089filesystems.php\u306bKey\u3092\u5165\u308c\u305f\u3089NG\u3002\u3053\u308c\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u305a\u3063\u3068Github\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\n.env\n.env\u306b\u4e0b\u8a18\u8a18\u8ff0\u3092\u8ffd\u52a0\uff1a\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5b9c\u306b\u5165\u308c\u3066\u306d\uff09\nAWS_KEY=AKI****\nAWS_SECRET=****\nAWS_REGION=us-east-1\nAWS_BUCKET=***-test\n\n\nLaravel\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\nPhotoController.php\nclass PhotoController extends Controller\n...\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n        echo \"zzzzz01 : aaaaa store 01\";\n        //Save Photo\n        if ($request->hasFile('image_01')) {\n            $path = $request->image_01->store('profiles', 's3');\n            var_dump($path);\n        }\n    }\n\n\n\n\u5b9f\u884c\u7d50\u679c\uff1a\nzzzzz01 : aaaaa store 01string(54) \"profiles/JlaRMuuWdOJYlbV2MWqYBR9k6XlnZ38OOtXHUk91.jpeg\"\n\nS3\u5074\n\n/***-test/profiles/JlaRMuuWdOJYlbV2MWqYBR9k6XlnZ38OOtXHUk91.jpeg\u304c\u751f\u6210\u3055\u308c\u305f\u3002\n\n\u30a8\u30f3\u30cf\u30f3\u30b9\u30e1\u30f3\u30c8\n\u4e0a\u8a18\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u753b\u50cf\u306f\u975e\u516c\u958b\u72b6\u614b\u3002\nWeb\u30b5\u30a4\u30c8\u7528\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306a\u3089\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u516c\u958b\u3067\u8a2d\u5b9a\u3057\u305f\u3044\u3002\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n        echo \"zzzzz01 : aaaaa store 01\";\n        //Save Photo\n        if ($request->hasFile('image_01')) {\n            $path = Storage::disk('s3')->putFile('profiles', $request->image_01, 'public'); // \uff33\uff13\u306b\u30a2\u30c3\u30d7\n            echo \"\\npath=\" . $path;\n            $url = Storage::disk('s3')->url($path);\n            echo \"\\nurl=\" . $url;\n            echo \"\\n\";\n        }\n    }\n\n\nzzzzz01 : aaaaa store 01 \npath=profiles/R9cs2lgM7G***.jpeg \nurl=https://s3.amazonaws.com/***-test/profiles/R9cs2lgM7G***.jpeg\n\nYeah!\nLaravel\u7d20\u6674\u3089\u3057\u3044\n# \u30b4\u30fc\u30eb\nLaravel\u3092\u4f7f\u3063\u3066\u3001S3\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3002\n\n# \u53c2\u8003\u8cc7\u6599\n* [Laravel 5.4 \u516c\u5f0f\u30b5\u30a4\u30c8](https://laravel.com/docs/5.4/filesystem)\n* [Laravel 5.3\u3000AWS S3\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9](http://www.larajapan.com/2016/10/09/laravel-5-3%E3%80%80aws-s3%E3%81%AB%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E3%82%A2%E3%83%83%E3%83%97%E3%83%AD%E3%83%BC%E3%83%89/)\n\n# \u4f5c\u696d\u958b\u59cb\n## Laravel\u7de8\u96c6\n```composer.json\n{\n    \"name\": \"laravel/laravel\",\n    \"description\": \"The Laravel Framework.\",\n    \"keywords\": [\"framework\", \"laravel\"],\n    \"license\": \"MIT\",\n    \"type\": \"project\",\n    \"require\": {\n        \"php\": \">=5.6.4\",\n        \"laravel/framework\": \"5.4.*\",\n        \"laravel/tinker\": \"~1.0\",\n        \"laravelcollective/html\": \"~5.2\",\n        \"league/flysystem-aws-s3-v3\" : \"~1.0\"\n    },\n...\u7701\u7565\n```\n\n### filesystems.php\n```filesystems.php\n...\u7701\u7565\n    'disks' => [\n\n        'local' => [\n            'driver' => 'local',\n            'root' => storage_path('app'),\n        ],\n\n        'public' => [\n            'driver' => 'local',\n            'root' => storage_path('app/public'),\n            'url' => env('APP_URL').'/storage',\n            'visibility' => 'public',\n        ],\n\n        's3' => [\n            'driver' => 's3',\n            'key' => env('AWS_KEY'),\n            'secret' => env('AWS_SECRET'),\n            'region' => env('AWS_REGION'),\n            'bucket' => env('AWS_BUCKET'),\n        ],\n\n    ],\n```\nAWS\u8a8d\u8a3c\u60c5\u5831\u306fenv('AWS_SECRET')\u3067\u53d6\u3063\u3066\u3044\u308b\u306e\u3067\u3001.env\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u3002\n\u76f4\u63a5\u3053\u3061\u3089filesystems.php\u306bKey\u3092\u5165\u308c\u305f\u3089NG\u3002\u3053\u308c\u304b\u3089\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u305a\u3063\u3068Github\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3057\u307e\u3046\u3002\n\n### .env\n.env\u306b\u4e0b\u8a18\u8a18\u8ff0\u3092\u8ffd\u52a0\uff1a\uff08\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u9069\u5b9c\u306b\u5165\u308c\u3066\u306d\uff09\n\n```.env\nAWS_KEY=AKI****\nAWS_SECRET=****\nAWS_REGION=us-east-1\nAWS_BUCKET=***-test\n```\n\n### Laravel\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n```PhotoController.php\nclass PhotoController extends Controller\n...\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request  $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n        echo \"zzzzz01 : aaaaa store 01\";\n        //Save Photo\n        if ($request->hasFile('image_01')) {\n            $path = $request->image_01->store('profiles', 's3');\n            var_dump($path);\n        }\n    }\n```\n\n### \u5b9f\u884c\u7d50\u679c\uff1a\n```\u5b9f\u884c\u7d50\u679c\nzzzzz01 : aaaaa store 01string(54) \"profiles/JlaRMuuWdOJYlbV2MWqYBR9k6XlnZ38OOtXHUk91.jpeg\"\n```\n\nS3\u5074\n<img width=\"623\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2017-03-11 23.26.33.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/133516/c992bc1c-de43-92c5-20aa-581165a4e88c.png\">\n/***-test/profiles/JlaRMuuWdOJYlbV2MWqYBR9k6XlnZ38OOtXHUk91.jpeg\u304c\u751f\u6210\u3055\u308c\u305f\u3002\n\n##\u30a8\u30f3\u30cf\u30f3\u30b9\u30e1\u30f3\u30c8\n\u4e0a\u8a18\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3067\u306f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u305f\u753b\u50cf\u306f\u975e\u516c\u958b\u72b6\u614b\u3002\nWeb\u30b5\u30a4\u30c8\u7528\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306a\u3089\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u516c\u958b\u3067\u8a2d\u5b9a\u3057\u305f\u3044\u3002\n\n```\u516c\u958b\n    /**\n     * Store a newly created resource in storage.\n     *\n     * @param  \\Illuminate\\Http\\Request $request\n     * @return \\Illuminate\\Http\\Response\n     */\n    public function store(Request $request)\n    {\n        echo \"zzzzz01 : aaaaa store 01\";\n        //Save Photo\n        if ($request->hasFile('image_01')) {\n            $path = Storage::disk('s3')->putFile('profiles', $request->image_01, 'public'); // \uff33\uff13\u306b\u30a2\u30c3\u30d7\n            echo \"\\npath=\" . $path;\n            $url = Storage::disk('s3')->url($path);\n            echo \"\\nurl=\" . $url;\n            echo \"\\n\";\n        }\n    }\n\n```\n```Output\nzzzzz01 : aaaaa store 01 \npath=profiles/R9cs2lgM7G***.jpeg \nurl=https://s3.amazonaws.com/***-test/profiles/R9cs2lgM7G***.jpeg\n```\n\n\nYeah!\nLaravel\u7d20\u6674\u3089\u3057\u3044\n", "tags": ["laravel", "5.4", "AWS", "S3"]}