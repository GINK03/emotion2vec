{"tags": ["IoT", "Bluemix", "nosql", "RaspberryPi", "\u30bb\u30f3\u30b5\u30fc"], "context": "\n\n\uff10\uff0e\u306f\u3058\u3081\u306b\n\u524d\u56de\u306e\u7d9a\u304d\u3067\u3059\u3002\u4eca\u56de\u306f\u3001\u304a\u307e\u3051\u6a5f\u80fd\u3068\u3057\u3066Node-RED\u5074\u3067\u6e29\u5ea6\u3092\u5224\u5b9a\u3057\u3001LED\u306e\u70b9\u706f\u8272\u306e\u5236\u5fa1\u3092\u884c\u3044\u307e\u3059\u3002\n[\u4eca\u56de\u306eLED\u5236\u5fa1\u306e\u4ed5\u69d8]\u3057\u3087\u307c\u3044\u4ed5\u69d8\u3067\u3059\u307f\u307e\u305b\u3093\u3002\u3000\nNode-RED\u5074\u3067\u3001\n\uff13\uff10\u5ea6\u4ee5\u4e0a\u306e\u3068\u304d\u306f\u3001\u3000\u3000\u8d64\n\uff12\uff10\u5ea6\u4ee5\u4e0a\uff13\uff10\u5ea6\u672a\u6e80\u306f\u3001\u9ec4\n\uff11\uff10\u5ea6\u4ee5\u4e0a\uff12\uff10\u5ea6\u672a\u6e80\u306f\u3001\u7dd1\n\uff10\u5ea6\u4ee5\u4e0a\uff11\uff10\u5ea6\u672a\u6e80\u306f\u3001\u3000\u9752\n\u305d\u308c\u4ee5\u5916\u306f\u3001\u3000\u3000\u3000\u3000\u3000\u3000\u767d\n\u3068\u306a\u308b\u3088\u3046\u306a\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u3092\u4f5c\u6210\u3059\u308b\u3002\nRaspberryPi\u5074\u3067\u3001\n\uff11\u5206(60\u79d2)\u5468\u671f\u306b\u6e29\u5ea6\u3092\u53d6\u5f97\u3001\u305d\u306e\u9593(59\u79d2\u9593)\u3001Node-RED\u3067\u6307\u5b9a\u3055\u308c\u305f\u8272\u3067LED\u30921\u79d2\u7f6e\u304d\u306b\u70b9\u6ec5\u3055\u305b\u308b\u3002\n\n\uff11\uff0e\u5fc5\u8981\u306a\u3082\u306e\uff08\u4eca\u56de\u6e96\u5099\u3057\u305f\u3082\u306e\uff09\n\n\n\n\u9805\u76ee\n\u6570\u91cf\n\u30e1\u30e2\n\n\n\n\n\n\n\uff12\uff0e\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3068\u3053\u308d\nNodejs & raspberry pi \u3067LED\u3092\u30c1\u30ab\u30c1\u30ab\u3055\u305b\u308b\n\n\uff13\uff0e\u6e29\u5ea6\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\n\u2460Node-RED\u306b\u6e29\u5ea6\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u7528function\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300c\u6e29\u5ea6\u5224\u5b9a\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Function\u9805\u76ee\u306b\u3001\u4e0b\u8a18\u3092\u5165\u529b\u3059\u308b\u3002\n\nfunction\nif (msg.payload.temp >= 30) {\n    msg.payload='{\"LED\": \"RED\"}';\n}else if(msg.payload.temp >= 20 && msg.payload.temp < 30) {\n    msg.payload='{\"LED\": \"YELLOW\"}';\n}else if(msg.payload.temp >= 10 && msg.payload.temp < 20) {\n    msg.payload='{\"LED\": \"GREEN\"}';\n}else if(msg.payload.temp >= 0 && msg.payload.temp < 10) {\n    msg.payload='{\"LED\": \"BLUE\"}';\n}else{\n    msg.payload='{\"LED\": \"WHITE\"}';\n}\n\nreturn msg;\n\n\n\n\u2461Node-RED\u306bibmiot output\u7528\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3000Node-RED\u306eoutput\u306b\u3042\u308bibmiot\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u2462ibmiot output\u7528\u30ce\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\u3000Authentication\u9805\u76ee\u306b\u3001\u300cBluemix Service\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Output Type\u9805\u76ee\u306b\u3001\u300cDevice Command\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Device Type\u9805\u76ee\u306b\u3001\u300craspi01\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Device Id\u9805\u76ee\u306b\u3001\u300csensor001\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Command Type\u9805\u76ee\u306b\u3001\u300cled\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Format\u9805\u76ee\u306b\u3001\u300cjson\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Data\u9805\u76ee\u306b\u3001\u300cmsg\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300cLED\u5236\u5fa1\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\n\u2462\u4f5c\u6210\u3057\u305f\u30ce\u30fc\u30c9\u3092\u4e0b\u56f3\u306e\u3088\u3046\u306b\u63a5\u7d9a\u3059\u308b\u3002\n\n\n\uff14\uff0eLED\u70b9\u706f\u30ed\u30b8\u30c3\u30af\u8ffd\u52a0\n\u2460mqtt.js\u306bLED\u70b9\u706f\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nmqtt.js\nvar f = require('./bme280.js');\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\nvar Gpio = require('onoff').Gpio;\nvar RED   = new Gpio(22, 'out'); \nvar GREEN = new Gpio(23, 'out');\nvar BLUE  = new Gpio(18, 'out');\n\n\nvar config = {\n (\u7701\u7565)\n};\n\nfunction mkJson(callback) {\n   f.bme(function(temp, humid, press){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v =  temp.toFixed(1);\n      var humid_v = humid.toFixed(1);\n      var press_v = press.toFixed(1);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      //console.log(payload);\n      callback(payload);\n   });\n}\n\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   mkJson(function(payload) {\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   });\n   setInterval(function(){\n        mkJson(function(payload) {\n           console.log(payload);\n        });\n        client.publish (\"eid\", \"json\", payload);\n   }, 60000);\n});\n\nclient.on(\"command\", function (commandName,format,payload,topic) {\n   if(commandName === \"led\") {\n      //console.log(JSON.parse(payload));\n      var json = JSON.parse(payload);\n      setColor(json.LED);\n   } else {\n      console.log(\"Command not supported.. \" + commandName);\n   }\n});\n\nfunction setColor (color) {\n   var red = 0, blue = 0, green = 0;\n   switch (color) {\n     case 'RED':\n        red = 1;\n        break;\n     case 'YELLOW':\n        red = green = 1;\n        break;\n     case 'GREEN':\n        green = 1;\n        break;\n     case 'BLUE':\n        blue = 1;\n        break;\n     case 'WHITE':\n        red = green = blue = 1;\n        break;\n    }\n    var iv = setInterval(function(){\n       if (red==1)   {RED.writeSync(RED.readSync() === 0 ? 1 : 0);}\n       if (green==1) {GREEN.writeSync(GREEN.readSync() === 0 ? 1 : 0);}\n       if (blue==1)  {BLUE.writeSync(BLUE.readSync() === 0 ? 1 : 0);}\n     }, 1000);\n     console.log (color + \" red=\" + red + \" green=\" + green + \" blue=\" + blue);\n\n    setTimeout(function() {\n       clearInterval(iv); // \u70b9\u6ec5LED\u3092\u30b9\u30c8\u30c3\u30d7\n       // LED\u6d88\u706f\n       RED.writeSync(0);\n       GREEN.writeSync(0);\n       BLUE.writeSync(0);\n\n    }, 59000);\n}\n\n\n\n\uff15\uff0eLED\u70b9\u706f\u78ba\u8a8d\n\u2460\u6539\u4fee\u3057\u305fmqtt.js\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ sudo node mqtt.js\n\n\n\u2461\u73fe\u5728\u306e\u6e29\u5ea6\u306b\u3042\u3063\u305f\u8272\u3067LED\u304c\u70b9\u6ec5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\u4ee5\u4e0a\u3067LED\u5236\u5fa1\u624b\u9806\u306f\u7d42\u4e86\u3067\u3059\u3002\n\u3053\u308c\u3067\u3001\u4eca\u56de\u4e88\u5b9a\u3057\u3066\u3044\u305f\u300cBluemix\u3067IoT \u6e29\u6e7f\u5ea6\u3001\u6c17\u5727\u3092\u53ce\u96c6\u30fb\u84c4\u7a4d\u30fb\u53ef\u8996\u5316\uff0bLED\u5236\u5fa1\u300d\u306f\u3001\u5168\u3066\u5b8c\u4e86\u3067\u3059\u3002\n##\uff10\uff0e\u306f\u3058\u3081\u306b\n[\u524d\u56de](http://qiita.com/hino9966/items/be8ecca36bd90aa8419a)\u306e\u7d9a\u304d\u3067\u3059\u3002\u4eca\u56de\u306f\u3001\u304a\u307e\u3051\u6a5f\u80fd\u3068\u3057\u3066Node-RED\u5074\u3067\u6e29\u5ea6\u3092\u5224\u5b9a\u3057\u3001LED\u306e\u70b9\u706f\u8272\u306e\u5236\u5fa1\u3092\u884c\u3044\u307e\u3059\u3002\n\n[\u4eca\u56de\u306eLED\u5236\u5fa1\u306e\u4ed5\u69d8]\u3057\u3087\u307c\u3044\u4ed5\u69d8\u3067\u3059\u307f\u307e\u305b\u3093\u3002\u3000\nNode-RED\u5074\u3067\u3001\n\uff13\uff10\u5ea6\u4ee5\u4e0a\u306e\u3068\u304d\u306f\u3001\u3000\u3000\u8d64\n\uff12\uff10\u5ea6\u4ee5\u4e0a\uff13\uff10\u5ea6\u672a\u6e80\u306f\u3001\u9ec4\n\uff11\uff10\u5ea6\u4ee5\u4e0a\uff12\uff10\u5ea6\u672a\u6e80\u306f\u3001\u7dd1\n\uff10\u5ea6\u4ee5\u4e0a\uff11\uff10\u5ea6\u672a\u6e80\u306f\u3001\u3000\u9752\n\u305d\u308c\u4ee5\u5916\u306f\u3001\u3000\u3000\u3000\u3000\u3000\u3000\u767d\n\u3068\u306a\u308b\u3088\u3046\u306a\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nRaspberryPi\u5074\u3067\u3001\n\uff11\u5206(60\u79d2)\u5468\u671f\u306b\u6e29\u5ea6\u3092\u53d6\u5f97\u3001\u305d\u306e\u9593(59\u79d2\u9593)\u3001Node-RED\u3067\u6307\u5b9a\u3055\u308c\u305f\u8272\u3067LED\u30921\u79d2\u7f6e\u304d\u306b\u70b9\u6ec5\u3055\u305b\u308b\u3002\n\n##\uff11\uff0e\u5fc5\u8981\u306a\u3082\u306e\uff08\u4eca\u56de\u6e96\u5099\u3057\u305f\u3082\u306e\uff09\n|\u9805\u76ee|\u6570\u91cf|\u30e1\u30e2|\n|---|:---:|---|\n\n##\uff12\uff0e\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u305f\u3068\u3053\u308d\n[Nodejs & raspberry pi \u3067LED\u3092\u30c1\u30ab\u30c1\u30ab\u3055\u305b\u308b](http://qiita.com/glostuan/items/f8e96564473f8e35a084)\n\n##\uff13\uff0e\u6e29\u5ea6\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\n**\u2460Node-RED\u306b\u6e29\u5ea6\u5224\u5b9a\u30ed\u30b8\u30c3\u30af\u7528function\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\n\u3000Name\u9805\u76ee\u306b\u3001\u300c\u6e29\u5ea6\u5224\u5b9a\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Function\u9805\u76ee\u306b\u3001\u4e0b\u8a18\u3092\u5165\u529b\u3059\u308b\u3002\n\n```js:function\nif (msg.payload.temp >= 30) {\n    msg.payload='{\"LED\": \"RED\"}';\n}else if(msg.payload.temp >= 20 && msg.payload.temp < 30) {\n    msg.payload='{\"LED\": \"YELLOW\"}';\n}else if(msg.payload.temp >= 10 && msg.payload.temp < 20) {\n    msg.payload='{\"LED\": \"GREEN\"}';\n}else if(msg.payload.temp >= 0 && msg.payload.temp < 10) {\n    msg.payload='{\"LED\": \"BLUE\"}';\n}else{\n    msg.payload='{\"LED\": \"WHITE\"}';\n}\n\nreturn msg;\n```\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/57026731-31f7-30d7-74fe-d634026ac8bd.png)\n\n**\u2461Node-RED\u306bibmiot output\u7528\u30ce\u30fc\u30c9\u3092\u8ffd\u52a0\u3059\u308b\u3002**\n\u3000Node-RED\u306eoutput\u306b\u3042\u308bibmiot\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/c5522a34-3bbb-dab0-1bdb-626cc1f2643c.png)\n\n**\u2462ibmiot output\u7528\u30ce\u30fc\u30c9\u3092\u8a2d\u5b9a\u3059\u308b\u3002**\n\u3000Authentication\u9805\u76ee\u306b\u3001\u300cBluemix Service\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Output Type\u9805\u76ee\u306b\u3001\u300cDevice Command\u300d\u3092\u9078\u629e\u3059\u308b\u3002\n\u3000Device Type\u9805\u76ee\u306b\u3001\u300craspi01\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Device Id\u9805\u76ee\u306b\u3001\u300csensor001\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Command Type\u9805\u76ee\u306b\u3001\u300cled\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Format\u9805\u76ee\u306b\u3001\u300cjson\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Data\u9805\u76ee\u306b\u3001\u300cmsg\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n\u3000Name\u9805\u76ee\u306b\u3001\u300cLED\u5236\u5fa1\u300d\u3092\u5165\u529b\u3059\u308b\u3002\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/42fcdb8f-8e79-2f20-3dc0-72e8bfa538f8.png)\n\n**\u2462\u4f5c\u6210\u3057\u305f\u30ce\u30fc\u30c9\u3092\u4e0b\u56f3\u306e\u3088\u3046\u306b\u63a5\u7d9a\u3059\u308b\u3002**\n![image](https://qiita-image-store.s3.amazonaws.com/0/113879/d9f8e419-0a47-d9e5-efa5-d734ea059fb4.png)\n\n##\uff14\uff0eLED\u70b9\u706f\u30ed\u30b8\u30c3\u30af\u8ffd\u52a0\n**\u2460mqtt.js\u306bLED\u70b9\u706f\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b\u3002**\n\n```js:mqtt.js\nvar f = require('./bme280.js');\nvar moment = require('moment');\nvar Client = require(\"ibmiotf\").IotfDevice;\nvar Gpio = require('onoff').Gpio;\nvar RED   = new Gpio(22, 'out'); \nvar GREEN = new Gpio(23, 'out');\nvar BLUE  = new Gpio(18, 'out');\n\n\nvar config = {\n (\u7701\u7565)\n};\n\nfunction mkJson(callback) {\n   f.bme(function(temp, humid, press){\n      var nowtime = moment().format(\"YYYY-MM-DD HH:mm:ss.SSS\");\n      var temp_v =  temp.toFixed(1);\n      var humid_v = humid.toFixed(1);\n      var press_v = press.toFixed(1);\n      payload = JSON.stringify({d : { timestamp : nowtime, temp : temp_v, humid : humid_v, press : press_v }});\n      //console.log(payload);\n      callback(payload);\n   });\n}\n\nvar client = new Client (config);\n\nclient.connect();\n\nclient.on(\"connect\", function () {\n   mkJson(function(payload) {\n      console.log(payload);\n      client.publish (\"eid\", \"json\", payload);\n   });\n   setInterval(function(){\n        mkJson(function(payload) {\n           console.log(payload);\n        });\n        client.publish (\"eid\", \"json\", payload);\n   }, 60000);\n});\n\nclient.on(\"command\", function (commandName,format,payload,topic) {\n   if(commandName === \"led\") {\n      //console.log(JSON.parse(payload));\n      var json = JSON.parse(payload);\n      setColor(json.LED);\n   } else {\n      console.log(\"Command not supported.. \" + commandName);\n   }\n});\n\nfunction setColor (color) {\n   var red = 0, blue = 0, green = 0;\n   switch (color) {\n     case 'RED':\n        red = 1;\n        break;\n     case 'YELLOW':\n        red = green = 1;\n        break;\n     case 'GREEN':\n        green = 1;\n        break;\n     case 'BLUE':\n        blue = 1;\n        break;\n     case 'WHITE':\n        red = green = blue = 1;\n        break;\n    }\n    var iv = setInterval(function(){\n       if (red==1)   {RED.writeSync(RED.readSync() === 0 ? 1 : 0);}\n       if (green==1) {GREEN.writeSync(GREEN.readSync() === 0 ? 1 : 0);}\n       if (blue==1)  {BLUE.writeSync(BLUE.readSync() === 0 ? 1 : 0);}\n     }, 1000);\n     console.log (color + \" red=\" + red + \" green=\" + green + \" blue=\" + blue);\n\n    setTimeout(function() {\n       clearInterval(iv); // \u70b9\u6ec5LED\u3092\u30b9\u30c8\u30c3\u30d7\n       // LED\u6d88\u706f\n       RED.writeSync(0);\n       GREEN.writeSync(0);\n       BLUE.writeSync(0);\n\n    }, 59000);\n}\n```\n\n##\uff15\uff0eLED\u70b9\u706f\u78ba\u8a8d\n**\u2460\u6539\u4fee\u3057\u305fmqtt.js\u3092\u5b9f\u884c\u3059\u308b\u3002**\n\n```text:\u30b3\u30de\u30f3\u30c9\npi@raspberrypi ~ $ sudo node mqtt.js\n```\n\n**\u2461\u73fe\u5728\u306e\u6e29\u5ea6\u306b\u3042\u3063\u305f\u8272\u3067LED\u304c\u70b9\u6ec5\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002**\n\n\n\u4ee5\u4e0a\u3067LED\u5236\u5fa1\u624b\u9806\u306f\u7d42\u4e86\u3067\u3059\u3002\n\n\u3053\u308c\u3067\u3001\u4eca\u56de\u4e88\u5b9a\u3057\u3066\u3044\u305f\u300cBluemix\u3067IoT \u6e29\u6e7f\u5ea6\u3001\u6c17\u5727\u3092\u53ce\u96c6\u30fb\u84c4\u7a4d\u30fb\u53ef\u8996\u5316\uff0bLED\u5236\u5fa1\u300d\u306f\u3001\u5168\u3066\u5b8c\u4e86\u3067\u3059\u3002\n\n\n"}