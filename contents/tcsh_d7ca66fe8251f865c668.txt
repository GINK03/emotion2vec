{"context": "\n\n\u524d\u63d0\u6761\u4ef6\n\nRDS\u3078\u306e\u6a29\u9650\nRDS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\nAWS CLI\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\nAWS CLI 1.11.14\n\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\u7d50\u679c(\u4f8b)\naws-cli/1.11.14 Python/2.7.10 Darwin/15.6.0 botocore/1.4.71\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u30b3\u30de\u30f3\u30c9\nsudo -H pip install -U awscli\n\n\n\n0. \u6e96\u5099\n\n0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n\n\n\n0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n\n\n\u7d50\u679c(\u4f8b)\n        Name                    Value             Type    Location\n        ----                    -----             ----    --------\n     profile       rdsFull-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n  access_key     ****************XXXX shared-credentials-file\n  secret_key     ****************XXXX shared-credentials-file\n      region        ap-northeast-1        env    AWS_DEFAULT_REGION\n\n\n0.3. \u524a\u9664\u3059\u308bDB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6c7a\u5b9a\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_IDENT=\"<\u524a\u9664\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d>\"\n\n\n\n1. \u4e8b\u524d\u4f5c\u696d\n\n1.1. \u524a\u9664\u3059\u308bDB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws rds describe-db-instances \\\n        --db-instance-identifier ${RDS_INSTANCE_IDENT}\n\n\n\u7d50\u679c(\u4f8b)\n  {\n    \"DBInstances\": [\n      {\n          \"PubliclyAccessible\": true,\n          \"MasterUsername\": \"pgadmin\",\n          \"LicenseModel\": \"postgresql-license\",\n          \"VpcSecurityGroups\": [\n              {\n                  \"Status\": \"active\",\n                  \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n              }\n          ],\n          \"InstanceCreateTime\": \"2015-03-16T06:59:18.215Z\",\n          \"OptionGroupMemberships\": [\n              {\n                  \"Status\": \"in-sync\",\n                  \"OptionGroupName\": \"default:postgres-9-3\"\n              }\n          ],\n          \"PendingModifiedValues\": {},\n          \"Engine\": \"postgres\",\n          \"MultiAZ\": false,\n          \"LatestRestorableTime\": \"2015-03-16T08:00:29Z\",\n          \"DBSecurityGroups\": [],\n          \"DBParameterGroups\": [\n              {\n                  \"DBParameterGroupName\": \"default.postgres9.3\",\n                  \"ParameterApplyStatus\": \"in-sync\"\n              }\n          ],\n          \"AutoMinorVersionUpgrade\": true,\n          \"PreferredBackupWindow\": \"14:23-14:53\",\n          \"DBSubnetGroup\": {\n              \"Subnets\": [\n                  {\n                      \"SubnetStatus\": \"Active\",\n                      \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                      \"SubnetAvailabilityZone\": {\n                          \"Name\": \"ap-northeast-1c\"\n                      }\n                  },\n                  {\n                      \"SubnetStatus\": \"Active\",\n                      \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                      \"SubnetAvailabilityZone\": {\n                          \"Name\": \"ap-northeast-1a\"\n                      }\n                  }\n              ],\n              \"DBSubnetGroupName\": \"default\",\n              \"VpcId\": \"vpc-50b34035\",\n              \"DBSubnetGroupDescription\": \"default\",\n              \"SubnetGroupStatus\": \"Complete\"\n          },\n          \"ReadReplicaDBInstanceIdentifiers\": [],\n          \"AllocatedStorage\": 5,\n          \"BackupRetentionPeriod\": 1,\n          \"DBName\": \"handson\",\n          \"PreferredMaintenanceWindow\": \"sat:17:40-sat:18:10\",\n          \"Endpoint\": {\n              \"Port\": 5432,\n              \"Address\": \"postgre-handson-ap-northeast-1.xxxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com\"\n          },\n          \"DBInstanceStatus\": \"available\",\n          \"EngineVersion\": \"9.3.5\",\n          \"AvailabilityZone\": \"ap-northeast-1c\",\n          \"StorageType\": \"standard\",\n          \"DbiResourceId\": \"db-XNOYXXXXXXXXXXXXXXXXXXXXXX\",\n          \"StorageEncrypted\": false,\n          \"DBInstanceClass\": \"db.t1.micro\",\n          \"DBInstanceIdentifier\": \"postgre-handson-ap-northeast-1\"\n      }\n    ]\n  }\n\n\n2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u524a\u9664\n\n2.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u524a\u9664\n\n\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        RDS_INSTANCE_IDENT ${RDS_INSTANCE_IDENT}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-instance \\\n        --db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n        --skip-final-snapshot\n\n\n\u7d50\u679c(\u4f8b)\n  {\n    \"DBInstance\": {\n      \"PubliclyAccessible\": true,\n      \"MasterUsername\": \"pgadmin\",\n      \"LicenseModel\": \"postgresql-license\",\n      \"VpcSecurityGroups\": [\n          {\n              \"Status\": \"active\",\n              \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n          }\n      ],\n      \"InstanceCreateTime\": \"2015-03-16T06:59:18.215Z\",\n      \"OptionGroupMemberships\": [\n          {\n              \"Status\": \"in-sync\",\n              \"OptionGroupName\": \"default:postgres-9-3\"\n          }\n      ],\n      \"PendingModifiedValues\": {},\n      \"Engine\": \"postgres\",\n      \"MultiAZ\": false,\n      \"LatestRestorableTime\": \"2015-03-16T08:00:29Z\",\n      \"DBSecurityGroups\": [],\n      \"DBParameterGroups\": [\n          {\n              \"DBParameterGroupName\": \"default.postgres9.3\",\n              \"ParameterApplyStatus\": \"in-sync\"\n          }\n      ],\n      \"AutoMinorVersionUpgrade\": true,\n      \"PreferredBackupWindow\": \"14:23-14:53\",\n      \"DBSubnetGroup\": {\n          \"Subnets\": [\n              {\n                  \"SubnetStatus\": \"Active\",\n                  \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                  \"SubnetAvailabilityZone\": {\n                      \"Name\": \"ap-northeast-1c\"\n                  }\n              },\n              {\n                  \"SubnetStatus\": \"Active\",\n                  \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                  \"SubnetAvailabilityZone\": {\n                      \"Name\": \"ap-northeast-1a\"\n                  }\n              }\n          ],\n          \"DBSubnetGroupName\": \"default\",\n          \"VpcId\": \"vpc-50b34035\",\n          \"DBSubnetGroupDescription\": \"default\",\n          \"SubnetGroupStatus\": \"Complete\"\n      },\n      \"ReadReplicaDBInstanceIdentifiers\": [],\n      \"AllocatedStorage\": 5,\n      \"BackupRetentionPeriod\": 1,\n      \"DBName\": \"handson\",\n      \"PreferredMaintenanceWindow\": \"sat:17:40-sat:18:10\",\n      \"Endpoint\": {\n          \"Port\": 5432,\n          \"Address\": \"postgre-handson-ap-northeast-1.xxxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com\"\n      },\n      \"DBInstanceStatus\": \"deleting\",\n      \"EngineVersion\": \"9.3.5\",\n      \"AvailabilityZone\": \"ap-northeast-1c\",\n      \"StorageType\": \"standard\",\n      \"DbiResourceId\": \"db-XNOYXXXXXXXXXXXXXXXXXXXXXX\",\n      \"StorageEncrypted\": false,\n      \"DBInstanceClass\": \"db.t1.micro\",\n      \"DBInstanceIdentifier\": \"postgre-handson-ap-northeast-1\"\n    }\n  }\n\n\n2.2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_STATUS=$( \\\n        aws rds describe-db-instances \\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\\\n          --query 'DBInstances[].DBInstanceStatus'\\\n          --output text \\\n) \\\n          && echo ${RDS_INSTANCE_STATUS}\n\n\n\u7d50\u679c\n  deleting\n\n\n3. \u4e8b\u5f8c\u78ba\u8a8d\n\n3.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_STATUS=$( \\\n        aws rds describe-db-instances\\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\\\n          --query 'DBInstances[].DBInstanceStatus'\\\n          --output text \\\n) \\\n        && echo ${RDS_INSTANCE_STATUS}\n\n\n\u7d50\u679c\n  A client error (DBInstanceNotFound) occurred when calling the DescribeDBInstances operation: DBInstance postgre-handson not found.\n\n\n3.2. \u6b8b\u7559\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws rds describe-db-snapshots \\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\n\n\n\u7d50\u679c\n  {\n      \"DBSnapshots\": []\n  }\n\n\n\u5b8c\u4e86\n# \u524d\u63d0\u6761\u4ef6\n\n## RDS\u3078\u306e\u6a29\u9650\n\nRDS\u306b\u5bfe\u3057\u3066\u30d5\u30eb\u6a29\u9650\u304c\u3042\u308b\u3053\u3068\u3002\n\n## AWS CLI\n\n\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u6e08\n\n- AWS CLI 1.11.14\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n\u7d50\u679c(\u4f8b)\n\n    aws-cli/1.11.14 Python/2.7.10 Darwin/15.6.0 botocore/1.4.71\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u53e4\u3044\u5834\u5408\u306f\u6700\u65b0\u7248\u306b\u66f4\u65b0\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\nsudo -H pip install -U awscli\n```\n\n# 0. \u6e96\u5099\n\n## 0.1. \u30ea\u30fc\u30b8\u30e7\u30f3\u306e\u6c7a\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nexport AWS_DEFAULT_REGION='ap-northeast-1'\n```\n\n## 0.2. \u5909\u6570\u306e\u78ba\u8a8d\n\n\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u304c\u60f3\u5b9a\u306e\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d\naws configure list\n```\n\n\u7d50\u679c(\u4f8b)\n\n            Name                    Value             Type    Location\n            ----                    -----             ----    --------\n         profile       rdsFull-prjz-mbp13        env    AWS_DEFAULT_PROFILE\n      access_key     ****************XXXX shared-credentials-file\n      secret_key     ****************XXXX shared-credentials-file\n          region        ap-northeast-1        env    AWS_DEFAULT_REGION\n\n## 0.3. \u524a\u9664\u3059\u308bDB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u6c7a\u5b9a\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_IDENT=\"<\u524a\u9664\u3059\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d>\"\n```\n\n# 1. \u4e8b\u524d\u4f5c\u696d\n\n## 1.1. \u524a\u9664\u3059\u308bDB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws rds describe-db-instances \\\n        --db-instance-identifier ${RDS_INSTANCE_IDENT}\n```\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"DBInstances\": [\n          {\n              \"PubliclyAccessible\": true,\n              \"MasterUsername\": \"pgadmin\",\n              \"LicenseModel\": \"postgresql-license\",\n              \"VpcSecurityGroups\": [\n                  {\n                      \"Status\": \"active\",\n                      \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n                  }\n              ],\n              \"InstanceCreateTime\": \"2015-03-16T06:59:18.215Z\",\n              \"OptionGroupMemberships\": [\n                  {\n                      \"Status\": \"in-sync\",\n                      \"OptionGroupName\": \"default:postgres-9-3\"\n                  }\n              ],\n              \"PendingModifiedValues\": {},\n              \"Engine\": \"postgres\",\n              \"MultiAZ\": false,\n              \"LatestRestorableTime\": \"2015-03-16T08:00:29Z\",\n              \"DBSecurityGroups\": [],\n              \"DBParameterGroups\": [\n                  {\n                      \"DBParameterGroupName\": \"default.postgres9.3\",\n                      \"ParameterApplyStatus\": \"in-sync\"\n                  }\n              ],\n              \"AutoMinorVersionUpgrade\": true,\n              \"PreferredBackupWindow\": \"14:23-14:53\",\n              \"DBSubnetGroup\": {\n                  \"Subnets\": [\n                      {\n                          \"SubnetStatus\": \"Active\",\n                          \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                          \"SubnetAvailabilityZone\": {\n                              \"Name\": \"ap-northeast-1c\"\n                          }\n                      },\n                      {\n                          \"SubnetStatus\": \"Active\",\n                          \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                          \"SubnetAvailabilityZone\": {\n                              \"Name\": \"ap-northeast-1a\"\n                          }\n                      }\n                  ],\n                  \"DBSubnetGroupName\": \"default\",\n                  \"VpcId\": \"vpc-50b34035\",\n                  \"DBSubnetGroupDescription\": \"default\",\n                  \"SubnetGroupStatus\": \"Complete\"\n              },\n              \"ReadReplicaDBInstanceIdentifiers\": [],\n              \"AllocatedStorage\": 5,\n              \"BackupRetentionPeriod\": 1,\n              \"DBName\": \"handson\",\n              \"PreferredMaintenanceWindow\": \"sat:17:40-sat:18:10\",\n              \"Endpoint\": {\n                  \"Port\": 5432,\n                  \"Address\": \"postgre-handson-ap-northeast-1.xxxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com\"\n              },\n              \"DBInstanceStatus\": \"available\",\n              \"EngineVersion\": \"9.3.5\",\n              \"AvailabilityZone\": \"ap-northeast-1c\",\n              \"StorageType\": \"standard\",\n              \"DbiResourceId\": \"db-XNOYXXXXXXXXXXXXXXXXXXXXXX\",\n              \"StorageEncrypted\": false,\n              \"DBInstanceClass\": \"db.t1.micro\",\n              \"DBInstanceIdentifier\": \"postgre-handson-ap-northeast-1\"\n          }\n        ]\n      }\n\n# 2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u524a\u9664\n\n## 2.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u524a\u9664\n\n```bash:\u5909\u6570\u306e\u78ba\u8a8d\ncat << ETX\n\n        RDS_INSTANCE_IDENT ${RDS_INSTANCE_IDENT}\n\nETX\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-instance \\\n        --db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n        --skip-final-snapshot\n```\n\n\u7d50\u679c(\u4f8b)\n\n      {\n        \"DBInstance\": {\n          \"PubliclyAccessible\": true,\n          \"MasterUsername\": \"pgadmin\",\n          \"LicenseModel\": \"postgresql-license\",\n          \"VpcSecurityGroups\": [\n              {\n                  \"Status\": \"active\",\n                  \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n              }\n          ],\n          \"InstanceCreateTime\": \"2015-03-16T06:59:18.215Z\",\n          \"OptionGroupMemberships\": [\n              {\n                  \"Status\": \"in-sync\",\n                  \"OptionGroupName\": \"default:postgres-9-3\"\n              }\n          ],\n          \"PendingModifiedValues\": {},\n          \"Engine\": \"postgres\",\n          \"MultiAZ\": false,\n          \"LatestRestorableTime\": \"2015-03-16T08:00:29Z\",\n          \"DBSecurityGroups\": [],\n          \"DBParameterGroups\": [\n              {\n                  \"DBParameterGroupName\": \"default.postgres9.3\",\n                  \"ParameterApplyStatus\": \"in-sync\"\n              }\n          ],\n          \"AutoMinorVersionUpgrade\": true,\n          \"PreferredBackupWindow\": \"14:23-14:53\",\n          \"DBSubnetGroup\": {\n              \"Subnets\": [\n                  {\n                      \"SubnetStatus\": \"Active\",\n                      \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                      \"SubnetAvailabilityZone\": {\n                          \"Name\": \"ap-northeast-1c\"\n                      }\n                  },\n                  {\n                      \"SubnetStatus\": \"Active\",\n                      \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                      \"SubnetAvailabilityZone\": {\n                          \"Name\": \"ap-northeast-1a\"\n                      }\n                  }\n              ],\n              \"DBSubnetGroupName\": \"default\",\n              \"VpcId\": \"vpc-50b34035\",\n              \"DBSubnetGroupDescription\": \"default\",\n              \"SubnetGroupStatus\": \"Complete\"\n          },\n          \"ReadReplicaDBInstanceIdentifiers\": [],\n          \"AllocatedStorage\": 5,\n          \"BackupRetentionPeriod\": 1,\n          \"DBName\": \"handson\",\n          \"PreferredMaintenanceWindow\": \"sat:17:40-sat:18:10\",\n          \"Endpoint\": {\n              \"Port\": 5432,\n              \"Address\": \"postgre-handson-ap-northeast-1.xxxxxxxxxxxx.ap-northeast-1.rds.amazonaws.com\"\n          },\n          \"DBInstanceStatus\": \"deleting\",\n          \"EngineVersion\": \"9.3.5\",\n          \"AvailabilityZone\": \"ap-northeast-1c\",\n          \"StorageType\": \"standard\",\n          \"DbiResourceId\": \"db-XNOYXXXXXXXXXXXXXXXXXXXXXX\",\n          \"StorageEncrypted\": false,\n          \"DBInstanceClass\": \"db.t1.micro\",\n          \"DBInstanceIdentifier\": \"postgre-handson-ap-northeast-1\"\n        }\n      }\n\n## 2.2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_STATUS=$( \\\n        aws rds describe-db-instances \\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\\\n          --query 'DBInstances[].DBInstanceStatus'\\\n          --output text \\\n) \\\n          && echo ${RDS_INSTANCE_STATUS}\n```\n\n\u7d50\u679c\n\n      deleting\n\n# 3. \u4e8b\u5f8c\u78ba\u8a8d\n\n## 3.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n```bash:\u5909\u6570\u306e\u8a2d\u5b9a\nRDS_INSTANCE_STATUS=$( \\\n        aws rds describe-db-instances\\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\\\n          --query 'DBInstances[].DBInstanceStatus'\\\n          --output text \\\n) \\\n        && echo ${RDS_INSTANCE_STATUS}\n```\n\n\u7d50\u679c\n\n      A client error (DBInstanceNotFound) occurred when calling the DescribeDBInstances operation: DBInstance postgre-handson not found.\n\n## 3.2. \u6b8b\u7559\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws rds describe-db-snapshots \\\n          --db-instance-identifier ${RDS_INSTANCE_IDENT}\n```\n\n\u7d50\u679c\n\n      {\n          \"DBSnapshots\": []\n      }\n\n# \u5b8c\u4e86\n", "tags": ["AWS", "aws-cli", "RDS"]}