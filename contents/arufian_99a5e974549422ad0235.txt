{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u521d\u5fc3\u8005\u7528\u306eSalesforce\u30c8\u30ea\u30ac\u30fc\u306e\u4ed5\u7d44\u307f\u3092\u52c9\u5f37\u3059\u308b\u305f\u3081\u306b\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n\u4f55\u3092\u4f5c\u308b\n\u66f8\u7c4d\u540d\u304c\u5165\u529b\u3055\u308c\u305f\u3089\u3001\u30c8\u30ea\u30ac\u30fc\u3067Google Books API\u4e0a\u306e\u672c\u3092\u691c\u7d22\u3057\u3001\u81ea\u52d5\u7684\u306b\u9805\u76ee\u306b\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\n\u4e8b\u524d\u6e96\u5099\n\nSFDC - \u30c8\u30ea\u30ac\u30fc\u306e\u57fa\u672c\u4e8b\u4f8b\n\n\u4e0a\u8a18\u306eBook\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067Web_Results__c - \u30c7\u30fc\u30bf\u578b\uff1a\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2(32768)\u3001\u3068\u3044\u3046\u30ab\u30b9\u30bf\u30e0\u9805\u76ee\u3092Book\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3059\u308b\nYQL - Google Books API\u7528\u306e\u30af\u30a8\u30ea\n\n\n\n\u5b9f\u88c5\u3057\u305f\u6642\u306b\u8e93\u3044\u305f\u3068\u3053\u308d\n\n\u5916\u90e8API\u3092\u547c\u3076\u305f\u3081\u306e\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306ecallout\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\nYQL\u304b\u3089\u306e\u30c7\u30fc\u30bf\u3092\u975e\u540c\u671f\u3067\u53d6\u5f97\u3059\u308b\u306e\u3067\u3001@future\u3067\u66f8\u304f\n\n@future\u306f\u72ec\u7acb\u30af\u30e9\u30b9\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\nJSONParser\u3067\u3044\u3061\u3044\u3061\u53d6\u5f97\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u3001JSON\u304b\u3089Map\u306b\u5909\u63db\u3002 Stackoverflow\n\n\nBook\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305d\u306e\u307e\u307e\u6e21\u305b\u306a\u3044\u306e\u3067\u3001Id\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u6e21\u3059\u3002\n\nglobal class YQLBridge {\n\n    @future (callout=true)\n    public static void searchGoogleBooks(String bookId) {\n        Book__c book = [SELECT Name, Id FROM Book__c WHERE Id=:bookId];\n        Http http = new Http();\n        HttpRequest req = new HttpRequest();\n        req.setEndpoint('https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20google.books%20WHERE%20q%3D%22'\n            +book.Name+\n            '%22%20AND%20maxResults%3D1&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json');\n        req.setMethod('GET');\n        HttpResponse res = http.send(req);\n\n        Map<String, Object> root = (Map<String, Object>)JSON.deserializeUntyped(res.getBody());\n        Map<String, Object> query = (Map<String, Object>)root.get('query');\n        Map<String, Object> results = (Map<String, Object>)query.get('results');\n        Map<String, Object> jsonItem = (Map<String, Object>)results.get('json');\n        Map<String, Object> items = (Map<String, Object>)jsonItem.get('items');\n        Map<String, Object> volumeInfo = (Map<String, Object>)items.get('volumeInfo');\n        String richStr = 'title :'+volumeInfo.get('title')+'<br >'+\n            'subtitle :'+volumeInfo.get('subtitle')+'<br >'+\n            'author :'+volumeInfo.get('authors')+'<br >'+\n            'thumbnail : <img src=\"'+((Map<String, Object>)volumeInfo.get('imageLinks')).get('thumbnail')+'\" />';\n        book.Web_Results__c = richStr;\n        update book;\n    }\n}\n\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u4ee5\u4e0b\u3067\u5b9f\u88c5\u3059\u308b:\n\npublic static void populateInternetBooks(Book__c book) {\n    YQLBridge.searchGoogleBooks(book.Id);\n}\n\n\n\u30c8\u30ea\u30ac\u30fc\u306b\u306f\u4ee5\u4e0b\u3067\u5b9f\u88c5\u3059\u308b:\n\ntrigger PopulateWebResults on Book__c (before insert, before update) {\n    Book__c[] books = Trigger.new;\n    for (Book__c b :books){\n        if(b.Web_Results__c == NULL || b.Web_Results__c.trim().equals('')) {\n            BookController.populateInternetBooks(b);\n        }\n    }\n}\n\n\n\u5b8c\u6210\u3057\u305f\u30bd\u30fc\u30b9\nGithub\u4e0a\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3054\u81ea\u7531\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nSalesforce\u3067\u306f\u307e\u3060\u4e00\u30f6\u6708\u52c9\u5f37\u3057\u305f\u3070\u304b\u308a\u306e\u521d\u5fc3\u8005\u306a\u306e\u3067\u3001\u3054\u6307\u6458\u304c\u3042\u308c\u3070\u305c\u3072\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n\u6982\u8981\n---\n\u521d\u5fc3\u8005\u7528\u306eSalesforce\u30c8\u30ea\u30ac\u30fc\u306e\u4ed5\u7d44\u307f\u3092\u52c9\u5f37\u3059\u308b\u305f\u3081\u306b\u4f5c\u308a\u307e\u3057\u305f\u3002\n#### \u4f55\u3092\u4f5c\u308b\n\u66f8\u7c4d\u540d\u304c\u5165\u529b\u3055\u308c\u305f\u3089\u3001\u30c8\u30ea\u30ac\u30fc\u3067Google Books API\u4e0a\u306e\u672c\u3092\u691c\u7d22\u3057\u3001\u81ea\u52d5\u7684\u306b\u9805\u76ee\u306b\u30bb\u30c3\u30c8\u3059\u308b\u3002\n\n\u4e8b\u524d\u6e96\u5099\n---\n* SFDC - [\u30c8\u30ea\u30ac\u30fc\u306e\u57fa\u672c\u4e8b\u4f8b](http://bit.ly/sfdctrigger)\n* \u4e0a\u8a18\u306e`Book`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067`Web_Results__c` - \u30c7\u30fc\u30bf\u578b\uff1a`\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2(32768)`\u3001\u3068\u3044\u3046\u30ab\u30b9\u30bf\u30e0\u9805\u76ee\u3092Book\u30ab\u30b9\u30bf\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8ffd\u52a0\u3059\u308b\n* YQL - [Google Books API\u7528\u306e\u30af\u30a8\u30ea](http://bit.ly/yqlbooksapi)\n\n\u5b9f\u88c5\u3057\u305f\u6642\u306b\u8e93\u3044\u305f\u3068\u3053\u308d\n---\n* \u5916\u90e8API\u3092\u547c\u3076\u305f\u3081\u306e\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e[callout](https://developer.salesforce.com/page/Apex_Web_Services_and_Callouts)\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\n* YQL\u304b\u3089\u306e\u30c7\u30fc\u30bf\u3092\u975e\u540c\u671f\u3067\u53d6\u5f97\u3059\u308b\u306e\u3067\u3001[@future](https://www.salesforce.com/us/developer/docs/apexcode/Content/apex_classes_annotation_future.htm)\u3067\u66f8\u304f\n* @future\u306f\u72ec\u7acb\u30af\u30e9\u30b9\u3067\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n* JSONParser\u3067\u3044\u3061\u3044\u3061\u53d6\u5f97\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u3001JSON\u304b\u3089Map\u306b\u5909\u63db\u3002 [Stackoverflow](http://stackoverflow.com/questions/14912599/parsing-json-object-in-salesforce-apex)\n* `Book`\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u305d\u306e\u307e\u307e\u6e21\u305b\u306a\u3044\u306e\u3067\u3001Id\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u6e21\u3059\u3002\n\n```java\nglobal class YQLBridge {\n\t\t\n\t@future (callout=true)\n\tpublic static void searchGoogleBooks(String bookId) {\n\t\tBook__c book = [SELECT Name, Id FROM Book__c WHERE Id=:bookId];\n\t\tHttp http = new Http();\n   \t\tHttpRequest req = new HttpRequest();\n   \t\treq.setEndpoint('https://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20google.books%20WHERE%20q%3D%22'\n   \t\t\t+book.Name+\n   \t\t\t'%22%20AND%20maxResults%3D1&diagnostics=true&env=store%3A%2F%2Fdatatables.org%2Falltableswithkeys&format=json');\n   \t\treq.setMethod('GET');\n   \t\tHttpResponse res = http.send(req);\n\n   \t\tMap<String, Object> root = (Map<String, Object>)JSON.deserializeUntyped(res.getBody());\n   \t\tMap<String, Object> query = (Map<String, Object>)root.get('query');\n   \t\tMap<String, Object> results = (Map<String, Object>)query.get('results');\n   \t\tMap<String, Object> jsonItem = (Map<String, Object>)results.get('json');\n   \t\tMap<String, Object> items = (Map<String, Object>)jsonItem.get('items');\n   \t\tMap<String, Object> volumeInfo = (Map<String, Object>)items.get('volumeInfo');\n   \t\tString richStr = 'title :'+volumeInfo.get('title')+'<br >'+\n   \t\t\t'subtitle :'+volumeInfo.get('subtitle')+'<br >'+\n   \t\t\t'author :'+volumeInfo.get('authors')+'<br >'+\n   \t\t\t'thumbnail : <img src=\"'+((Map<String, Object>)volumeInfo.get('imageLinks')).get('thumbnail')+'\" />';\n   \t\tbook.Web_Results__c = richStr;\n   \t\tupdate book;\n\t}\n}\n```\n\n* \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u4ee5\u4e0b\u3067\u5b9f\u88c5\u3059\u308b:\n\n```java\npublic static void populateInternetBooks(Book__c book) {\n\tYQLBridge.searchGoogleBooks(book.Id);\n}\n```\n\n* \u30c8\u30ea\u30ac\u30fc\u306b\u306f\u4ee5\u4e0b\u3067\u5b9f\u88c5\u3059\u308b:\n\n\n```java\ntrigger PopulateWebResults on Book__c (before insert, before update) {\n\tBook__c[] books = Trigger.new;\n\tfor (Book__c b :books){\n\t\tif(b.Web_Results__c == NULL || b.Web_Results__c.trim().equals('')) {\n\t\t\tBookController.populateInternetBooks(b);\n\t\t}\n\t}\n}\n```\n\n### \u5b8c\u6210\u3057\u305f\u30bd\u30fc\u30b9\n[Github](https://github.com/arufian/mysfdc-playground)\u4e0a\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u3054\u81ea\u7531\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nSalesforce\u3067\u306f\u307e\u3060\u4e00\u30f6\u6708\u52c9\u5f37\u3057\u305f\u3070\u304b\u308a\u306e\u521d\u5fc3\u8005\u306a\u306e\u3067\u3001\u3054\u6307\u6458\u304c\u3042\u308c\u3070\u305c\u3072\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n", "tags": ["Apex", "Salesforce", "YQL"]}