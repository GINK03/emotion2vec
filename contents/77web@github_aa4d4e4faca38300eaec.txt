{"tags": ["BEAR.Sunday", "Doctrine2", "Symfony2"], "context": " \u3053\u306e\u8a18\u4e8b\u306f\u6700\u7d42\u66f4\u65b0\u65e5\u304b\u30891\u5e74\u4ee5\u4e0a\u304c\u7d4c\u904e\u3057\u3066\u3044\u307e\u3059\u3002BEAR.Sunday\u3067Doctrine2\u306eORM\u3092\u4f7f\u3063\u3066\u307f\u305f\nhttp://qiita.com/77web@github/items/7b67e490ac59dcab0ca8\n\u306e\u7d9a\u304d\u3002\n\u524d\u56de\u306fDoctrine2\u306eORM\u3092\u4f7f\u3063\u3066DB\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3067\u7d42\u308f\u3063\u305f\u3002\n\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u3001\u4eca\u5ea6\u306fDB\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u307f\u305f\u3044\u3002\n\nAppResource\u306bonPost()\u3092\u8ffd\u52a0\n\u307e\u305a\u306f\u524d\u56de\u306eMy\\NoteApp\\Resource\\App\\Note\u306b\u65b0\u898f\u767b\u9332\u7528\u306eonPost()\u3092\u8ffd\u52a0\u3002\n// src/Resource/App/Note.php\n\nnamespace My\\NoteApp\\Resource\\App;\n\nuse BEAR\\Resource\\ResourceObject;\nuse Doctrine\\ORM\\EntityManager;\nuse My\\NoteApp\\Entity\\Note as NoteEntity;\nuse Ray\\Di\\Di\\Inject;\n\nclass Note extends ResourceObject\n{\n    /**\n     * @var EntityManager\n     */\n    private $entityManager;\n\n    /**\n     * @param EntityManager $entityManager\n     * @Inject\n     */\n    public function __construct(EntityManager $entityManager)\n    {\n        $this->entityManager = $entityManager;\n    }\n\n    public function onGet($id)\n    {\n        // onGet()\u306f\u524d\u56de\u306e\u307e\u307e\u306a\u306e\u3067\u7701\u7565\n    }\n\n    public function onPost($body)\n    {\n        $note = new NoteEntity();\n        $note->setBody($body);\n\n        $this->entityManager->persist($note);\n        $this->entityManager->flush();\n\n        $this['note'] = [\n            'id' => $note->getId(),\n            'body' => $note->getBody(),\n        ];\n\n        return $this;\n    }\n}\n\n\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\nphp bootstrap/contexts/api.php post 'app://self/note?body=hoge'\n[BODY]\nnote => array(\n    id 3\n    body hoge\n),\n\n[VIEW]\n{\n    \"note\": {\n        \"id\": 3\n        \"body\": \"hoge\"\n    },\n    \"_links\": {\n        \"self\": {\n            \"href\": \"http://localhost/app/note/?body=hoge\"\n        }\n    }\n}\n\n\u3084\u3063\u305f\uff01\u3061\u3083\u3093\u3068\u767b\u9332\u3067\u304d\u305f\uff01\n\n\u767b\u9332\u524d\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u5165\u308c\u305f\u3044\n\u4eca\u306f\u307e\u3060app\u3060\u3051\u3060\u3051\u3069\u3001\u3044\u305a\u308cWEB\u304b\u3089\u53e9\u304fapi\u306b\u306a\u308b\u4e88\u5b9a\uff08\u5922\u306f\u5927\u304d\u304f\uff01\uff09\u306a\u306e\u3067\u5909\u306a\u30c7\u30fc\u30bf\u304c\u5165\u3089\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092if,isset,is_null,\u2026\u3068\u624b\u3067\u66f8\u304f\u306e\u306f\u5730\u7344\u3059\u304e\u308b\u306e\u3067\u3001\\Symfony\\Component\\Validator\u3092\u4f7f\u3046\u3053\u3068\u306b\u3059\u308b\u3002\n\u3061\u306a\u307f\u306bSymfony2\u306eDI\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u3053\u3093\u306a\u98a8\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3002\n$note = new NoteEntity();\n$note->setBody($body);\n\n$violations = $container->get('validator')->validate($note);\n// $violations\u306f\u30a4\u30c6\u30ec\u30fc\u30bf\u30fc\u3067count()\u3057\u30660\u306a\u3089\u30a8\u30e9\u30fc\u306f\u7121\u3044\u3068\u3044\u3046\u3053\u3068\n\n\u3064\u307e\u308a\u3001\u3053\u306e$container->get('validator')\u3068\u540c\u3058\u3082\u306e\u3092\u3001\u524d\u56de\u306eEntityManager\u540c\u69d8Provider\u304b\u3089\u6e21\u3057\u3066\u3084\u308c\u3070\u3001\u540c\u3058\u3088\u3046\u306b\u4f7f\u3048\u308b\u3093\u3058\u3083\u306a\u3044\u304b\uff1f\u3068\u60f3\u5b9a\u3002\n\u306a\u304a\u3001\u5236\u7d04\uff08\u4f55\u3092\u30a8\u30e9\u30fc\u3068\u3057\u3066\u4f55\u3092\u6b63\u5f53\u3068\u3059\u308b\u304b\uff09\u306f\u3001\u666e\u901a\u306bSymfony\u3067\u4f7f\u3046\u6642\u540c\u69d8\u306b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u53c8\u306fgetter\u30e1\u30bd\u30c3\u30c9\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u66f8\u304d\u305f\u3044\u3002\n\nsymfony/validator\u3092\u8ffd\u52a0\ncomposer require symfony/validator:\"~2.5\"\n\n\nValidatorProvider\u3092\u8ffd\u52a0\u2192\u767b\u9332\u2192Inject\n\u524d\u56deDoctrineORMProvider\u3092\u66f8\u3044\u305f\u6642\u3068\u540c\u69d8\u306bValidatorProvider\u3092\u65b0\u3057\u304f\u4f5c\u3063\u3066\u66f8\u304f\u3002\n\u53c2\u8003\u306b\u3057\u305f\u306e\u306fSymfony\\Component\\Validator\u306eREADME\u3002\nhttps://github.com/symfony/Validator#usage\n\u305f\u3063\u305f\u3053\u308c\u3060\u3051\u3067Symfony\u306eDI\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u53d6\u308c\u308bvalidator\u3068\u540c\u3058\u3082\u306e\u304c\u4f5c\u308c\u308b\u3089\u3057\u3044\u3002\u4fbf\u5229\uff01\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304b\u3089validator\u4f5c\u6210\u90e8\u5206\u3092get()\u30e1\u30bd\u30c3\u30c9\u5185\u306b\u30b3\u30d4\u30da\u3002\n// src/Module/Provider/ValidatorProvider.php\n\nnamespace My\\NoteApp\\Module\\Provider;\n\nuse Ray\\Di\\ProviderInterface;\nuse Symfony\\Component\\Validator\\Validation;\n\nclass ValidatorProvider implements ProviderInterface\n{\n    public function get()\n    {\n        return Validation::createValidatorBuilder()->enableAnnotationMapping()->getValidator();\n    }\n} \n\n\u524d\u56de\u540c\u69d8\u3001\u65b0\u3057\u304f\u4f5c\u3063\u305fProvider\u306fBEAR.Sunday\u306eDI\u306b\u767b\u9332\u3002\n// src/Module/AppModule.php\nclass AppModule extends AbstractModule\n{\n    public function configure()\n    {\n        // \u6700\u521d\u304b\u3089\u66f8\u3044\u3066\u3042\u308binstall()\u3084\u3001\u524d\u56de\u8ffd\u52a0\u3057\u305fDoctrineORMProvider\u306ebind()\u304c\u3053\u3053\u306b\u3042\u308b\u306f\u305a\n\n        // validator\u3092bind\n        $this->bind('Symfony\\Component\\Validator\\Validator\\ValidatorInterface')->toProvider('My\\NoteApp\\Module\\Provider\\ValidatorProvider');\n    }\n}\n\n\u524d\u56de\u306eEntityManager\u540c\u69d8\u3001AppResource\u306bInject\u3057\u3066\u304a\u304f\u3002\n\u672c\u5f53\u306fvalidator\u3092\u4f7f\u3046\u4e88\u5b9a\u304c\u3042\u308b\u306e\u306fpost/update\u306e\u307f\u3067\u3001get/delete\u306f\u4f7f\u308f\u306a\u3044\u3093\u3060\u3051\u3069\u3001onPost()\u3068onUpdate()\u3060\u3051\u306b\u6ce8\u5165\u3059\u308b\u306e\u306f\u5f8c\u56de\u3057\u3002\n// src/Resource/App/Note.php\n\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface; //\u8ffd\u52a0\n\nclass Note extends ResourceObject\n{\n    private $entityManager;\n\n    private $validator;\n\n    /**\n     * @Inject\n     */\n    public function __construct(EntityManager $entityManager, ValidatorInterface $validator)\n    {\n        $this->entityManager = $entityManager;\n        $this->validator = $validator; //\u8ffd\u52a0\n    }\n}\n\n\nentity\u306b\u5236\u7d04\u3092\u66f8\u304f\n\u524d\u56de\u4f5c\u3063\u305fNote\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5236\u7d04\u3092\u8ffd\u8a18\u3002\nbody\u3057\u304b\u66f8\u304f\u3068\u3053\u308d\u304c\u7121\u3044\u306e\u3067\u3068\u308a\u3042\u3048\u305abody\u3057\u304b\u66f8\u304f\u3068\u3053\u308d\u304c\u7121\u3044\u306e\u3067\u3068\u308a\u3042\u3048\u305abody\u3092NotBlank\uff08\u7a7a\u767d\u6587\u5b57\u3067\u306a\u3044\uff09\u306b\u3059\u308b\u3002\n// src/Entity/Note.php\n\nnamespace My\\NoteApp\\Entity;\n\nuse Symfony\\Component\\Validator\\Constraints as Assert;\n\n/**\n * @Entity\n * @Table(name=\"note\")\n */\nclass Note\n{\n    /**\n     * @var int\n     * @Id\n     * @Column(type=\"integer\")\n     * @GeneratedValue\n     */\n    private $id;\n\n    /**\n     * @var string\n     * @Column(type=\"text\")\n     * @Assert\\NotBlank()\n     */\n    private $body;\n\n    // getter,setter\u306f\u7701\u7565\n}\n\n\nNote::onPost()\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u3092\u8ffd\u52a0\n// src/Resource/App/Note.php\n\n+use BEAR\\Resource\\Code; //\u8ffd\u52a0\n\n    /**\n     * @param string $body\n     * @return Note\n     */\n    public function onPost($body)\n    {\n        $note = new NoteEntity();\n        $note->setBody($body);\n\n        $violations = $this->validator->validate($note);\n        if (0 !== count($violations)) {\n            $errors = [];\n            foreach ($violations as $violation) {\n                /** @var \\Symfony\\Component\\Validator\\ConstraintViolation $violation */\n                if (!isset($errors[$violation->getPropertyPath()])) {\n                    $errors[$violation->getPropertyPath()] = [];\n                }\n                $errors[$violation->getPropertyPath()][] = $violation->getMessage();\n            }\n            $this['errors'] = $errors;\n            // HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u5909\u66f4\n            $this->code = Code::BAD_REQUEST;\n\n            return $this;\n        }\n\n        $this->entityManager->persist($note);\n        $this->entityManager->flush();\n\n        $this['note'] = [\n          'id' => $note->getId(),\n          'body' => $note->getBody(),\n        ];\n\n        return $this;\n    }\n\n\u3053\u308c\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306f\u305a\uff01\n\nPOST\u3057\u3066\u307f\u308b\n\u6562\u3048\u3066NotBlank\u306b\u9006\u3089\u3063\u305f\u30c7\u30fc\u30bf\uff08body\u3092\u7a7a\u767d\u306b\u3057\u305f\u30c7\u30fc\u30bf\uff09\u3092post\u3057\u3066\u307f\u308b\u3002\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\u671f\u5f85\u306b\u53cd\u3057\u3066\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3067\u306f\u306a\u304fexception\u304c\u51fa\u305f\u3053\u3068\u306b\u3088\u308b\u30a8\u30e9\u30fcorz\n[Semantical Error] The annotation \"@Entity\" in class My\\NoteApp\\Entity\\Note was never imported. Did you maybe forget to add a \"use\" statement for this annotation?\n\nDoctrine\u7cfb\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u3072\u3063\u304b\u304b\u3063\u3066\u3044\u308b\u3063\u307d\u3044\u3002\nNote\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306b\u3001\u666e\u6bb5Symfony\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3067\u3084\u308b\u3088\u3046\u306bDoctrine\\ORM\\Mapping\u306euse\u3092\u8ffd\u52a0\u3057\u3066\u3001ORM\u95a2\u4fc2\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306bORM\u3068\u3044\u3046\u30d7\u30ea\u30d5\u30a3\u30af\u30b9\u3092\u3064\u3051\u3066\u307f\u308b\u3002\n// src/Entity/Note.php\n\nuse Doctrine\\ORM\\Mapping as ORM; \n\n/**\n * @ORM\\Entity()\n * @ORM\\Table(name=\"note\")\n */\nclass Note\n{\n    // \u7701\u7565\n}\n\n\u3042\u3089\uff1f\u7d50\u679c\u7684\u306bSymfony\u3067\u4f7f\u3046\u6642\u3068\u5927\u5dee\u306a\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u72b6\u614b\u3067\u518d\u5ea6POST\u3057\u3066\u307f\u308b\u3002\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n\n\u307e\u305f\u3082exception\u3002\n\u4eca\u5ea6\u306f\u9055\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u305f\u3002\nClass \"My\\NoteApp\\Entity\\Note\" is not a valid entity or mapped super class. \n\nORM\u30d7\u30ea\u30d5\u30a3\u30af\u30b9\u3064\u3051\u306a\u3044\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u3072\u3063\u304b\u304b\u308a\u3001ORM\u3064\u3051\u308b\u3068Doctrine\u5074\u3067\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3068\u3057\u3066\u6b63\u3057\u304f\u306a\u3044\u3068\u8a00\u308f\u308c\u308b\u3002\n\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u72b6\u614b\uff01\nGoogle\u3067\u691c\u7d22\u3002\nsymfony validator annotation reader doctrine entity error \u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3067\u9996\u5c3e\u3088\u304f\u540c\u3058\u72b6\u6cc1\u306e\u4eba\u304c\u898b\u3064\u304b\u3063\u305f\u3002\nTrouble with importing annotations\nhttp://stackoverflow.com/questions/11910147/trouble-with-importing-annotations\nI had a similar issue when using Silex, Doctrine2 and the Symfony-Validator.\n\nThe solution was to avoid using the SimpleAnnotationsReader and instead using the normal AnnotationReader (have a look at Doctrine\\ORM\\Configuration::newDefaultAnnotationDriver). You can then preface every entity with ORM\\ (and of course inserting use Doctrine\\ORM\\Mapping as ORM; in every entity).\n\nSimpleAnnotationReader\u3067\u306f\u306a\u304fAnnotationReader\u3092\u4f7f\u3048\u3070\u3044\u3044\u3089\u3057\u3044\u3002\n\nDoctrineORMProvider\u3092\u4fee\u6b63\n\u6539\u3081\u3066\u524d\u56de\u30b3\u30d4\u30da\u3057\u305f\u66f8\u3044\u305fEntityManager\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\u305f\u3081\u306e\u8a18\u8ff0\u3092\u632f\u308a\u8fd4\u308b\u3068\u3001\n$config = Setup::createAnnotationMetadataConfiguration(...);\n\n\u304b\n$entityManager = EntityManager::create(...);\n\n\u306e\u3069\u3063\u3061\u304b\u304c\u602a\u3057\u3044\u3002\n\u307e\u305a \\Doctrine\\ORM\\Tools\\Setup::createAnnotationMetadataConfiguration() \u306e\u30bd\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/Tools/Setup.php#L69\n$useSimpleAnnotationReader = true \u3068\u3044\u3046\u5f15\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u304ctrue\u306a\u306e\u3067\u3001\u3053\u308c\u3092false\u306b\u3057\u3066\u3084\u308c\u3070\u826f\u3055\u305d\u3046\u3002\n// src/Module/Provider/DoctrineORMProvider\n\nnamespace My\\NoteApp\\Module\\Provider;\n\nuse Doctrine\\ORM\\Tools\\Setup;\nuse Doctrine\\ORM\\EntityManager;\nuse Ray\\Di\\ProviderInterface;\nuse BEAR\\Sunday\\Inject\\AppDirInject;\n\nclass DoctrineORMProvider implements ProviderInterface\n{\n    use AppDirInject;\n\n    public function get()\n    {\n        $config = Setup::createAnnotationMetadataConfiguration(array(__DIR__.\"/../Entity\"), false, null, null, false);\n        $conn = ...;\n        $entityManager = EntityManager::create($conn, $config);\n\n        return $entityManager;\n    }\n} \n\n\n\u518d\u5ea6POST\u3057\u3066\u307f\u308b\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n\n\u5b9f\u884c\u7d50\u679c\u306f\n[BODY]\nerrors => array(\n    body => array(\n        This value should not be blank.,\n    ),\n),\n\n[VIEW]\n{\n    \"errors\": {\n        \"body\": [\n            \"This value should not be blank.\"\n        ]\n    },\n    \"_links\": {\n        \"self\": {\n            \"href\": \"http://localhost/app/note/?body=\"\n        }\n    }\n}\n\n\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u304d\u305f\uff01\n\u6b21\u3078\u306e\u8ab2\u984c\u306f\u4e0b\u8a18\u306e\u901a\u308a\n\n\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7ffb\u8a33\u3055\u308c\u3066\u306a\u3044\nvalidator\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u306a\u304fvalidator\u3092\u4f7f\u3046\u30e1\u30bd\u30c3\u30c9\u3060\u3051\u306bInject\u3057\u305f\u3044\n\n\u3082\u3046\u3061\u3087\u3063\u3068\u3001\u7d9a\u304f\u3093\u3058\u3083\u3088\u2026\u3002\nBEAR.Sunday\u3067Doctrine2\u306eORM\u3092\u4f7f\u3063\u3066\u307f\u305f\nhttp://qiita.com/77web@github/items/7b67e490ac59dcab0ca8\n\u306e\u7d9a\u304d\u3002\n\n\u524d\u56de\u306fDoctrine2\u306eORM\u3092\u4f7f\u3063\u3066DB\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3067\u7d42\u308f\u3063\u305f\u3002\n\u305b\u3063\u304b\u304f\u3060\u304b\u3089\u3001\u4eca\u5ea6\u306fDB\u306b\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u3066\u307f\u305f\u3044\u3002\n\nAppResource\u306bonPost()\u3092\u8ffd\u52a0\n-----------------------------\n\n\u307e\u305a\u306f\u524d\u56de\u306eMy\\NoteApp\\Resource\\App\\Note\u306b\u65b0\u898f\u767b\u9332\u7528\u306eonPost()\u3092\u8ffd\u52a0\u3002\n\n```php\n// src/Resource/App/Note.php\n\nnamespace My\\NoteApp\\Resource\\App;\n\nuse BEAR\\Resource\\ResourceObject;\nuse Doctrine\\ORM\\EntityManager;\nuse My\\NoteApp\\Entity\\Note as NoteEntity;\nuse Ray\\Di\\Di\\Inject;\n\nclass Note extends ResourceObject\n{\n    /**\n     * @var EntityManager\n     */\n    private $entityManager;\n\n    /**\n     * @param EntityManager $entityManager\n     * @Inject\n     */\n    public function __construct(EntityManager $entityManager)\n    {\n        $this->entityManager = $entityManager;\n    }\n\n    public function onGet($id)\n    {\n        // onGet()\u306f\u524d\u56de\u306e\u307e\u307e\u306a\u306e\u3067\u7701\u7565\n    }\n\n    public function onPost($body)\n    {\n        $note = new NoteEntity();\n        $note->setBody($body);\n\n        $this->entityManager->persist($note);\n        $this->entityManager->flush();\n\n        $this['note'] = [\n            'id' => $note->getId(),\n            'body' => $note->getBody(),\n        ];\n\n        return $this;\n    }\n}\n```\n\n\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n\n```bash\nphp bootstrap/contexts/api.php post 'app://self/note?body=hoge'\n[BODY]\nnote => array(\n    id 3\n    body hoge\n),\n\n[VIEW]\n{\n    \"note\": {\n        \"id\": 3\n        \"body\": \"hoge\"\n    },\n    \"_links\": {\n        \"self\": {\n            \"href\": \"http://localhost/app/note/?body=hoge\"\n        }\n    }\n}\n```\n\n\u3084\u3063\u305f\uff01\u3061\u3083\u3093\u3068\u767b\u9332\u3067\u304d\u305f\uff01\n\n\u767b\u9332\u524d\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u5165\u308c\u305f\u3044\n----------------------------\n\n\u4eca\u306f\u307e\u3060app\u3060\u3051\u3060\u3051\u3069\u3001\u3044\u305a\u308cWEB\u304b\u3089\u53e9\u304fapi\u306b\u306a\u308b\u4e88\u5b9a\uff08\u5922\u306f\u5927\u304d\u304f\uff01\uff09\u306a\u306e\u3067\u5909\u306a\u30c7\u30fc\u30bf\u304c\u5165\u3089\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092if,isset,is_null,\u2026\u3068\u624b\u3067\u66f8\u304f\u306e\u306f\u5730\u7344\u3059\u304e\u308b\u306e\u3067\u3001\\Symfony\\Component\\Validator\u3092\u4f7f\u3046\u3053\u3068\u306b\u3059\u308b\u3002\n\n\u3061\u306a\u307f\u306bSymfony2\u306eDI\u30b3\u30f3\u30c6\u30ca\u3067\u306f\u3001\u3053\u3093\u306a\u98a8\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u3067\u304d\u308b\u3002\n\n```php\n$note = new NoteEntity();\n$note->setBody($body);\n\n$violations = $container->get('validator')->validate($note);\n// $violations\u306f\u30a4\u30c6\u30ec\u30fc\u30bf\u30fc\u3067count()\u3057\u30660\u306a\u3089\u30a8\u30e9\u30fc\u306f\u7121\u3044\u3068\u3044\u3046\u3053\u3068\n```\n\n\u3064\u307e\u308a\u3001\u3053\u306e$container->get('validator')\u3068\u540c\u3058\u3082\u306e\u3092\u3001\u524d\u56de\u306eEntityManager\u540c\u69d8Provider\u304b\u3089\u6e21\u3057\u3066\u3084\u308c\u3070\u3001\u540c\u3058\u3088\u3046\u306b\u4f7f\u3048\u308b\u3093\u3058\u3083\u306a\u3044\u304b\uff1f\u3068\u60f3\u5b9a\u3002\n\u306a\u304a\u3001\u5236\u7d04\uff08\u4f55\u3092\u30a8\u30e9\u30fc\u3068\u3057\u3066\u4f55\u3092\u6b63\u5f53\u3068\u3059\u308b\u304b\uff09\u306f\u3001\u666e\u901a\u306bSymfony\u3067\u4f7f\u3046\u6642\u540c\u69d8\u306b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u53c8\u306fgetter\u30e1\u30bd\u30c3\u30c9\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u3057\u3066\u66f8\u304d\u305f\u3044\u3002\n\nsymfony/validator\u3092\u8ffd\u52a0\n------------------------\n\n```bash\ncomposer require symfony/validator:\"~2.5\"\n```\n\nValidatorProvider\u3092\u8ffd\u52a0\u2192\u767b\u9332\u2192Inject\n-----------------------------------\n\n\u524d\u56deDoctrineORMProvider\u3092\u66f8\u3044\u305f\u6642\u3068\u540c\u69d8\u306bValidatorProvider\u3092\u65b0\u3057\u304f\u4f5c\u3063\u3066\u66f8\u304f\u3002\n\u53c2\u8003\u306b\u3057\u305f\u306e\u306fSymfony\\Component\\Validator\u306eREADME\u3002\nhttps://github.com/symfony/Validator#usage\n\u305f\u3063\u305f\u3053\u308c\u3060\u3051\u3067Symfony\u306eDI\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u53d6\u308c\u308bvalidator\u3068\u540c\u3058\u3082\u306e\u304c\u4f5c\u308c\u308b\u3089\u3057\u3044\u3002\u4fbf\u5229\uff01\n\n\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3044\u305f\u3044\u306e\u3067\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304b\u3089validator\u4f5c\u6210\u90e8\u5206\u3092get()\u30e1\u30bd\u30c3\u30c9\u5185\u306b\u30b3\u30d4\u30da\u3002\n\n```php\n// src/Module/Provider/ValidatorProvider.php\n\nnamespace My\\NoteApp\\Module\\Provider;\n\nuse Ray\\Di\\ProviderInterface;\nuse Symfony\\Component\\Validator\\Validation;\n\nclass ValidatorProvider implements ProviderInterface\n{\n    public function get()\n    {\n        return Validation::createValidatorBuilder()->enableAnnotationMapping()->getValidator();\n    }\n} \n```\n\n\u524d\u56de\u540c\u69d8\u3001\u65b0\u3057\u304f\u4f5c\u3063\u305fProvider\u306fBEAR.Sunday\u306eDI\u306b\u767b\u9332\u3002\n\n```php\n// src/Module/AppModule.php\nclass AppModule extends AbstractModule\n{\n    public function configure()\n    {\n        // \u6700\u521d\u304b\u3089\u66f8\u3044\u3066\u3042\u308binstall()\u3084\u3001\u524d\u56de\u8ffd\u52a0\u3057\u305fDoctrineORMProvider\u306ebind()\u304c\u3053\u3053\u306b\u3042\u308b\u306f\u305a\n\n        // validator\u3092bind\n        $this->bind('Symfony\\Component\\Validator\\Validator\\ValidatorInterface')->toProvider('My\\NoteApp\\Module\\Provider\\ValidatorProvider');\n    }\n}\n```\n\n\u524d\u56de\u306eEntityManager\u540c\u69d8\u3001AppResource\u306bInject\u3057\u3066\u304a\u304f\u3002\n\u672c\u5f53\u306fvalidator\u3092\u4f7f\u3046\u4e88\u5b9a\u304c\u3042\u308b\u306e\u306fpost/update\u306e\u307f\u3067\u3001get/delete\u306f\u4f7f\u308f\u306a\u3044\u3093\u3060\u3051\u3069\u3001onPost()\u3068onUpdate()\u3060\u3051\u306b\u6ce8\u5165\u3059\u308b\u306e\u306f\u5f8c\u56de\u3057\u3002\n\n```php\n// src/Resource/App/Note.php\n\nuse Symfony\\Component\\Validator\\Validator\\ValidatorInterface; //\u8ffd\u52a0\n\nclass Note extends ResourceObject\n{\n    private $entityManager;\n\n    private $validator;\n\n    /**\n     * @Inject\n     */\n    public function __construct(EntityManager $entityManager, ValidatorInterface $validator)\n    {\n        $this->entityManager = $entityManager;\n        $this->validator = $validator; //\u8ffd\u52a0\n    }\n}\n```\n\nentity\u306b\u5236\u7d04\u3092\u66f8\u304f\n--------------------\n\n\u524d\u56de\u4f5c\u3063\u305fNote\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u306b\u5236\u7d04\u3092\u8ffd\u8a18\u3002\n$body\u3057\u304b\u66f8\u304f\u3068\u3053\u308d\u304c\u7121\u3044\u306e\u3067\u3068\u308a\u3042\u3048\u305a$body\u3092NotBlank\uff08\u7a7a\u767d\u6587\u5b57\u3067\u306a\u3044\uff09\u306b\u3059\u308b\u3002\n\n```php\n// src/Entity/Note.php\n\nnamespace My\\NoteApp\\Entity;\n\nuse Symfony\\Component\\Validator\\Constraints as Assert;\n\n/**\n * @Entity\n * @Table(name=\"note\")\n */\nclass Note\n{\n    /**\n     * @var int\n     * @Id\n     * @Column(type=\"integer\")\n     * @GeneratedValue\n     */\n    private $id;\n\n    /**\n     * @var string\n     * @Column(type=\"text\")\n     * @Assert\\NotBlank()\n     */\n    private $body;\n\n    // getter,setter\u306f\u7701\u7565\n}\n```\n\nNote::onPost()\u306b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u51e6\u7406\u3092\u8ffd\u52a0\n--------------------------------------\n\n```php\n// src/Resource/App/Note.php\n\n+use BEAR\\Resource\\Code; //\u8ffd\u52a0\n\n    /**\n     * @param string $body\n     * @return Note\n     */\n    public function onPost($body)\n    {\n        $note = new NoteEntity();\n        $note->setBody($body);\n\n        $violations = $this->validator->validate($note);\n        if (0 !== count($violations)) {\n            $errors = [];\n            foreach ($violations as $violation) {\n                /** @var \\Symfony\\Component\\Validator\\ConstraintViolation $violation */\n                if (!isset($errors[$violation->getPropertyPath()])) {\n                    $errors[$violation->getPropertyPath()] = [];\n                }\n                $errors[$violation->getPropertyPath()][] = $violation->getMessage();\n            }\n            $this['errors'] = $errors;\n            // HTTP\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306e\u5909\u66f4\n            $this->code = Code::BAD_REQUEST;\n\n            return $this;\n        }\n\n        $this->entityManager->persist($note);\n        $this->entityManager->flush();\n\n        $this['note'] = [\n          'id' => $note->getId(),\n          'body' => $note->getBody(),\n        ];\n\n        return $this;\n    }\n```\n\n\u3053\u308c\u3067\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306f\u305a\uff01\n\nPOST\u3057\u3066\u307f\u308b\n--------------------\n\n\u6562\u3048\u3066NotBlank\u306b\u9006\u3089\u3063\u305f\u30c7\u30fc\u30bf\uff08body\u3092\u7a7a\u767d\u306b\u3057\u305f\u30c7\u30fc\u30bf\uff09\u3092post\u3057\u3066\u307f\u308b\u3002\n\n```bash\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n```\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\u671f\u5f85\u306b\u53cd\u3057\u3066\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u3067\u306f\u306a\u304fexception\u304c\u51fa\u305f\u3053\u3068\u306b\u3088\u308b\u30a8\u30e9\u30fcorz\n\n```\n[Semantical Error] The annotation \"@Entity\" in class My\\NoteApp\\Entity\\Note was never imported. Did you maybe forget to add a \"use\" statement for this annotation?\n```\n\nDoctrine\u7cfb\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u3072\u3063\u304b\u304b\u3063\u3066\u3044\u308b\u3063\u307d\u3044\u3002\nNote\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306b\u3001\u666e\u6bb5Symfony\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3067\u3084\u308b\u3088\u3046\u306bDoctrine\\ORM\\Mapping\u306euse\u3092\u8ffd\u52a0\u3057\u3066\u3001ORM\u95a2\u4fc2\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306bORM\u3068\u3044\u3046\u30d7\u30ea\u30d5\u30a3\u30af\u30b9\u3092\u3064\u3051\u3066\u307f\u308b\u3002\n\n```php\n// src/Entity/Note.php\n\nuse Doctrine\\ORM\\Mapping as ORM; \n\n/**\n * @ORM\\Entity()\n * @ORM\\Table(name=\"note\")\n */\nclass Note\n{\n    // \u7701\u7565\n}\n```\n\n\u3042\u3089\uff1f\u7d50\u679c\u7684\u306bSymfony\u3067\u4f7f\u3046\u6642\u3068\u5927\u5dee\u306a\u304f\u306a\u3063\u305f\u3002\n\u3053\u306e\u72b6\u614b\u3067\u518d\u5ea6POST\u3057\u3066\u307f\u308b\u3002\n\n```bash\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n```\n\n\u307e\u305f\u3082exception\u3002\n\u4eca\u5ea6\u306f\u9055\u3046\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u305f\u3002\n\n```\nClass \"My\\NoteApp\\Entity\\Note\" is not a valid entity or mapped super class. \n```\n\nORM\u30d7\u30ea\u30d5\u30a3\u30af\u30b9\u3064\u3051\u306a\u3044\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u3072\u3063\u304b\u304b\u308a\u3001ORM\u3064\u3051\u308b\u3068Doctrine\u5074\u3067\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3068\u3057\u3066\u6b63\u3057\u304f\u306a\u3044\u3068\u8a00\u308f\u308c\u308b\u3002\n\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u72b6\u614b\uff01\n\nGoogle\u3067\u691c\u7d22\u3002\n``symfony validator annotation reader doctrine entity error`` \u3068\u3044\u3046\u30ad\u30fc\u30ef\u30fc\u30c9\u3067\u9996\u5c3e\u3088\u304f\u540c\u3058\u72b6\u6cc1\u306e\u4eba\u304c\u898b\u3064\u304b\u3063\u305f\u3002\nTrouble with importing annotations\nhttp://stackoverflow.com/questions/11910147/trouble-with-importing-annotations\n\n```\nI had a similar issue when using Silex, Doctrine2 and the Symfony-Validator.\n\nThe solution was to avoid using the SimpleAnnotationsReader and instead using the normal AnnotationReader (have a look at Doctrine\\ORM\\Configuration::newDefaultAnnotationDriver). You can then preface every entity with ORM\\ (and of course inserting use Doctrine\\ORM\\Mapping as ORM; in every entity).\n```\n\nSimpleAnnotationReader\u3067\u306f\u306a\u304fAnnotationReader\u3092\u4f7f\u3048\u3070\u3044\u3044\u3089\u3057\u3044\u3002\n\nDoctrineORMProvider\u3092\u4fee\u6b63\n---------------------------\n\n\u6539\u3081\u3066\u524d\u56de~~\u30b3\u30d4\u30da\u3057\u305f~~\u66f8\u3044\u305fEntityManager\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u308b\u305f\u3081\u306e\u8a18\u8ff0\u3092\u632f\u308a\u8fd4\u308b\u3068\u3001\n\n```php\n$config = Setup::createAnnotationMetadataConfiguration(...);\n```\n\n\u304b\n\n```php\n$entityManager = EntityManager::create(...);\n```\n\n\u306e\u3069\u3063\u3061\u304b\u304c\u602a\u3057\u3044\u3002\n\n\u307e\u305a ``\\Doctrine\\ORM\\Tools\\Setup::createAnnotationMetadataConfiguration()`` \u306e\u30bd\u30fc\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\nhttps://github.com/doctrine/doctrine2/blob/master/lib/Doctrine/ORM/Tools/Setup.php#L69\n\n``$useSimpleAnnotationReader = true`` \u3068\u3044\u3046\u5f15\u6570\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u304ctrue\u306a\u306e\u3067\u3001\u3053\u308c\u3092false\u306b\u3057\u3066\u3084\u308c\u3070\u826f\u3055\u305d\u3046\u3002\n\n```php\n// src/Module/Provider/DoctrineORMProvider\n\nnamespace My\\NoteApp\\Module\\Provider;\n\nuse Doctrine\\ORM\\Tools\\Setup;\nuse Doctrine\\ORM\\EntityManager;\nuse Ray\\Di\\ProviderInterface;\nuse BEAR\\Sunday\\Inject\\AppDirInject;\n\nclass DoctrineORMProvider implements ProviderInterface\n{\n    use AppDirInject;\n\n    public function get()\n    {\n        $config = Setup::createAnnotationMetadataConfiguration(array(__DIR__.\"/../Entity\"), false, null, null, false);\n        $conn = ...;\n        $entityManager = EntityManager::create($conn, $config);\n\n        return $entityManager;\n    }\n} \n```\n\n\u518d\u5ea6POST\u3057\u3066\u307f\u308b\n--------------------\n\n```bash\nphp bootstrap/contexts/api.php post 'app://self/note?body='\n```\n\n\u5b9f\u884c\u7d50\u679c\u306f\n\n```\n[BODY]\nerrors => array(\n    body => array(\n        This value should not be blank.,\n    ),\n),\n\n[VIEW]\n{\n    \"errors\": {\n        \"body\": [\n            \"This value should not be blank.\"\n        ]\n    },\n    \"_links\": {\n        \"self\": {\n            \"href\": \"http://localhost/app/note/?body=\"\n        }\n    }\n}\n\n```\n\n\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3067\u304d\u305f\uff01\n\n\u6b21\u3078\u306e\u8ab2\u984c\u306f\u4e0b\u8a18\u306e\u901a\u308a\n\n* \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u7ffb\u8a33\u3055\u308c\u3066\u306a\u3044\n* validator\u3092\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u306a\u304fvalidator\u3092\u4f7f\u3046\u30e1\u30bd\u30c3\u30c9\u3060\u3051\u306bInject\u3057\u305f\u3044\n\n\u3082\u3046\u3061\u3087\u3063\u3068\u3001\u7d9a\u304f\u3093\u3058\u3083\u3088\u2026\u3002\n"}