{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nUbuntu14.04\u4e0a\u3067HAProxy1.5.9\u3092\u69cb\u7bc9\u3057\u3066SSL\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u30fc\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u69cb\u6210\nHAProxy\n\u251c\u2500\u2500 Nginx1\n\u2514\u2500\u2500 Nginx2\n\n\n\u74b0\u5883\u60c5\u5831\n\nOS: Ubuntu14.04\nHAProxy: 1.5.9\n\n\nStep1: HAProxy\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306fHAProxy\u306emake\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo apt-get update\n$ sudo apt-get install build-essential make g++ libssl-dev\n\n\u6b21\u306b\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n2014/12/8\u73fe\u5728\u306e\u6700\u65b0\u306e\u5b89\u5b9a\u7248\u306f1.5.9\u3067\u3059\u3002\n$ cd /usr/local/src\n$ sudo wget http://www.haproxy.org/download/1.5/src/haproxy-1.5.9.tar.gz\n$ \n\n\u53d6\u3063\u3066\u304d\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c55\u958b\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo tar zxvf haproxy-1.5.9.tar.gz\n$ cd haproxy-1.5.9\n$ sudo make TARGET=linux2628 USE_OPENSSL=yes \n$ sudo make install # /usr/local/sbin/haproxy\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\n\n\nStep2: haproxy\u30b0\u30eb\u30fc\u30d7\u3001\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n$ sudo groupadd -g 2001 haproxy # haproxy\u7528\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\n$ sudo useradd -u 2001 -g 2001 -s /sbin/nologin haproxy # haproxy\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n\n\nStep3: \u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3084\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3001pid\u30d5\u30a1\u30a4\u30eb\u306e\u7f6e\u304d\u5834\u6240\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo mkdir -p /var/run/haproxy /etc/haproxy/ssl /var/log/haproxy /var/lock/haproxy\n$ sudo chown -R haproxy:haproxy /var/run/haproxy /etc/haproxy /var/log/haproxy\n\n\nStep4: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\n\u3053\u3053\u306f\u5168\u90e8\u3092\u8aad\u307f\u5207\u308c\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u5927\u304d\u304f\u5206\u3051\u308b\u3068\u4ee5\u4e0b\u4e8c\u3064\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\nglobal\u30bb\u30af\u30b7\u30e7\u30f3\nProxies: defaluts\u30bb\u30af\u30b7\u30e7\u30f3\u3001frontend\u30bb\u30af\u30b7\u30e7\u30f3\u3001backend\u30bb\u30af\u30b7\u30e7\u30f3\u3001listen\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u30bb\u30c3\u30c8\u3002\n\n\u5404\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5927\u4f53\u306e\u610f\u5473\u5408\u3044\u306f\u4ee5\u4e0b\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\n\u30bb\u30af\u30b7\u30e7\u30f3\u540d\n\u5f79\u5272\n\n\n\n\nglobal\n\u30d7\u30ed\u30bb\u30b9\u5168\u4f53\u3084OS\u7279\u6709\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u30bb\u30af\u30b7\u30e7\u30f3\u3002\u30d7\u30ed\u30bb\u30b9\u7ba1\u7406\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8abf\u6574\u7528\u306ekeyword\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3\u3002\n\n\ndefaults\n\u305d\u306e\u4ed6\u306e\u30bb\u30af\u30b7\u30e7\u30f3(frontend, backend, listen)\u306e\u305f\u3081\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3\n\n\nfrontend\nlisten\u3057\u3066\u3044\u308b\u30bd\u30b1\u30c3\u30c8\u306e\u5b9a\u7fa9\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3\n\n\nbackend\n\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u3042\u3063\u305f\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u6295\u3052\u5148\u3068\u306a\u308b\u30b5\u30fc\u30d0\u30fc\u60c5\u5831\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3\n\n\nlisten\nfrontend\u3068backend\u306e\u8a2d\u5b9a\u3092\u7d10\u4ed8\u3051\u308b\u30bb\u30af\u30b7\u30e7\u30f3\u3002\n\n\n\n\u3053\u3061\u3089\u305d\u308c\u305e\u308c\u3067\u6307\u5b9a\u53ef\u80fd\u306akeyword\u306fHAProxy\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n/etc/haproxy/haproxy.cfg\nglobal\n    log 127.0.0.1   local0\n    log 127.0.0.1   local1 notice\n    maxconn 4096 # \u4e00\u3064\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u5f35\u308c\u308b\u6700\u5927\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\n    pidfile     /var/run/haproxy.pid\n    user haproxy\n    group haproxy\n    daemon # background\u8a2d\u5b9a\n    ssl-server-verify  none # \u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u306e\u305f\u3081none\u306b\u8a2d\u5b9a\n    tune.ssl.cachesize 20000 # ssl session cache\u306e\u5bb9\u91cf\u3002200B * 20000\u7a0b\u5ea6\u306e\u5bb9\u91cf\n    ssl-default-bind-options no-sslv3\n    tune.ssl.default-dh-param 2048 # \u3053\u3061\u3089\u8a2d\u5b9a\u3057\u306a\u3044\u3068Warning\u51fa\u307e\u3059\u3002\n\n# Proxies #\ndefaults\n    log global # global\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3057\u305f\u65b9\u6cd5\u3067\u30ed\u30b0\u51fa\u529b\u3002\n    mode    http # \u8d77\u52d5\u6642\u306e\u30e2\u30fc\u30c9\u3092\u9078\u629e\u3002tcp|http|heakth\u304c\u9078\u629e\u53ef\u80fd\u3002\n    option  httplog # http\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3002\n    retries 3 # \u63a5\u7d9a\u5931\u6557\u6642\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u56de\u6570\u3002 \n    maxconn 2000 # frontend\u3067\u540c\u6642\u306b\u5f35\u308c\u308b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\n    timeout connect 5000 # \u30ea\u30c8\u30e9\u30a4\u307e\u3067\u306e\u5f85\u3061\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\u3002\n    timeout client  5000 # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306e\u9593\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\n    timeout server  50000 # \u30b5\u30fc\u30d0\u30fc\u3068\u306e\u9593\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\n\nfrontend  ssl_proxy\n    bind *:443 ssl crt /etc/haproxy/ssl/server.pem # fronted\u3067listening\u3057\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u3001\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3002crt\u3067\u306f\u8a3c\u660e\u66f8\u3068private key\u304c\u8a18\u8f09\u3055\u308c\u305fpem\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\n    use_backend      nginx # \u8ee2\u9001\u3059\u308bbackend\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nbackend nginx\n    balance roundrobin # \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b9\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u6307\u5b9a\u3002\n    server nginx1 10.3.0.29:80 check inter 2000 # \u8ee2\u9001\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\u3002check\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067health\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u304f\u308c\u308b\u3002\u3053\u306e\u5834\u5408\u306f2000millisecond\u3002\n    server nginx2 10.3.0.93:80 check inter 2000 # \u8ee2\u9001\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\u3002check\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067health\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u304f\u308c\u308b\u3002\u3053\u306e\u5834\u5408\u306f2000millisecond\u3002\n\n\n\n/etc/init.d/haproxy\n#!/bin/bash\n#\n# chkconfig: - 85 15\n# description: HA-Proxy is a TCP/HTTP reverse proxy which is particularly suited \\\n#              for high availability environments.\n# processname: haproxy\n# config: /etc/haproxy/haproxy.cfg\n# pidfile: /var/run/haproxy.pid\n\n# Source function library.\nif [ -f /etc/init.d/functions ]; then\n  . /etc/init.d/functions\nelif [ -f /etc/rc.d/init.d/functions ] ; then\n  . /etc/rc.d/init.d/functions\nelif [ -f /lib/lsb/init-functions ] ; then\n  # Ubuntu\u7528\n  . /lib/lsb/init-functions\nelse\n  exit 0\nfi\n\n# This is our service name\nBASENAME=`basename $0`\nif [ -L $0 ]; then\n  BASENAME=`find $0 -name $BASENAME -printf %l`\n  BASENAME=`basename $BASENAME`\nfi\n\n[ -f /etc/$BASENAME/$BASENAME.cfg ] || exit 1\n\nRETVAL=0\nLOCK_DIR='/var/lock/haproxy';\nif [ -f /usr/sbin/$BASENAME ] ; then\n  CMD=/usr/sbin/$BASENAME;\nelif [ -f /usr/local/sbin/$BASENAME ] ; then\n  CMD=/usr/local/sbin/$BASENAME;\nfi\nstart() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n\n  echo -n \"Starting $BASENAME: \"\n#  daemon ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid\n  start_daemon ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid\n  RETVAL=$?\n  echo\n  [ $RETVAL -eq 0 ] && touch ${LOCK_DIR}/$BASENAME\n  return $RETVAL\n}\n\nstop() {\n  echo -n \"Shutting down $BASENAME: \"\n  killproc $BASENAME -USR1\n  RETVAL=$?\n  echo\n  [ $RETVAL -eq 0 ] && rm -f ${LOCK_DIR}/$BASENAME\n  [ $RETVAL -eq 0 ] && rm -f /var/run/$BASENAME.pid\n  return $RETVAL\n}\n\nrestart() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n  stop\n  start\n}\n\nreload() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n  ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid -sf $(cat /var/run/$BASENAME.pid)\n}\n\ncheck() {\n  ${CMD} -c -q -V -f /etc/$BASENAME/$BASENAME.cfg\n}\n\nrhstatus() {\n  status $BASENAME\n}\n\ncondrestart() {\n  [ -e ${LOCK_DIR}/$BASENAME ] && restart || :\n}\n\n# See how we were called.\ncase \"$1\" in\n  start)\n    start\n    ;;\n  stop)\n    stop\n    ;;\n  restart)\n    restart\n    ;;\n  reload)\n    reload\n    ;;\n  condrestart)\n    condrestart\n    ;;\n  status)\n    rhstatus\n    ;;\n  check)\n    check\n    ;;\n  *)\n    echo $\"Usage: $BASENAME {start|stop|restart|reload|condrestart|status|check}\"\n    exit 1\nesac\n\nexit $?\n\n\n\n/etc/haproxy/ssl/server.pem\n-----BEGIN PRIVATE KEY-----\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n3fOpcu73aVjofSld6lcAyj3cVd2qfKro8BDsXAtyZGmTDS2VgzqEk+LNUZJtVfwE\n6RzFDjsh2e31hX9RAgZpR1uk9534Hw1YcSBMbgAnW2hTqcV0/mESVYn1+1zPNlfy\n2sHgs2dzAdujp0Cvm6T14SmHKqOgDt6XuexuQRZNonJ4dB04eSVyJVj47CRo6NqX\nZOBBfHN9R6dIRz1BnjUeRttdj13qljhJ0E+u4MnCRNbghpGrzwxLMvWwp320f3AZ\nqrtPEQ8gH97PEwx7baU7Z+wltRzSXGxqEdvNILSdjMnGjFIVwX2iKsXcrKz9A2SK\nRbksYX/hAgMBAAECggEAPvBecxhKMjp+zXuzlVALLxgXJpxD9hUntAwljulci59u\nJZ3LtZ5vQhv1ks36w+34d17APtrkxYBgMHUSB8A3lFSyo/6PWyzTsJ0PRuO53D2p\n08SyfnbrqaVD3Erl4GHRDVcJIzevZqUnMaNSw9XCAKd8YXoiD5wcFkAJ/ZODUVX0\nunsQVSRLVpjP3LxbkLA1behgUbYfe6IgQY3PdgU6ddZgFKMYo901AOAc6GT43c0B\n33ehGO+rZohMPUKLME0LbfsLscPztL2ZNXf6K3iA67bTrOfK+L4LiVnJllf4WWDU\nYyQaE+BP2jqfPBtzidHqtDo5uSowpQx9j6wpupum7QKBgQDeezBt49CZWTyWWfF7\nXkbNC6DIavbtJCtDmxlAiPw+6de8O9UJpe64jXBX1n3C7T2MvZh2hYN+hOxOUS0M\nYMncyxQ8AJpeUn/qxjvdZ82iR96YxZrtw1A9EL66hQQAY1MfLPnlgBRzj9S1KZf7\nBtDkwZIbaY2aNounQSUjo9msswKBgQDDrqVD5c2l2BQZglJ1TRstSLQOwQl/6EbK\nCohi2sOZ+6znL37ta8UCN4OGnV8q+hNnegGc+UUZcPXsx6Omou0qkjy0IKEqepZC\n1On9OXcoyXBn7i5K2kIycJ+Ztw0OBewD8BJzSbKuRB9k1JHOiGAZpszurjpGPJJJ\nw8CudHkTGwKBgFfEhWB0pRA58frmVKt0j73IPo+SEwOOZzrubtHUuJ4hJiht+icq\nPLi1o4Ijbc1+Re/Fw+XN2ggJbCehQoJFlJzzyHG7UyqupSP7PBamIqtIavodynbN\nvFO6zWNLoj588Ie1+IefNXI5ZZJqbDhtge8cpgUGaQRTTFiZDIu40eCdAoGADVNk\nX8ZThdq8K6yLTv+sPR45XNPagMJhp7ql5Q1+yoqwEKJUY3i2VttO8qje5T9YePB/\nEaCMCxp9NN23kE6CFicVSTL7prfoaa60LJFwQu/M3tcCgghw/5xZ0g78LZtLok0E\nBKPdLi7ncGdlcooo+TY5uHtW7peLYsiY44h9AkcCgYArW6zrNr3ASfJ/xjG0FItv\nltzQUa/vBm+H2q0QKq4LWw0u542rymEXpRIyV/67EWxfUBo8xkik7IvNrnzzt/jC\n4mUarfHuRHrXXcvU8joSalaj7/B7h/ps1y43mjOfwgXPtoi2tE8yx2fL4kETvQBP\nTbHkZz8FCRsVN7cEfVUAcg==\n-----END PRIVATE KEY-----\n-----BEGIN CERTIFICATE-----\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nSlAxDjAMBgNVBAgMBVRva3lvMRIwEAYDVQQHDAlTaGluanl1a3UxGjAYBgNVBAoM\nEUlEQyBGcm9udGllcixpbmMuMSkwJwYDVQQLDCBUZWNobmljYWwgRGV2ZWxlcG1l\nbnQgRGVwYXJ0bWVudDETMBEGA1UEAwwKVWVubyBBa2l0bzEcMBoGCSqGSIb3DQEJ\nARYNYXVlbm9AaWRjZi5qcDAeFw0xNDA4MjQwNTQwMTdaFw0xNDA5MjMwNTQwMTda\nMIGrMQswCQYDVQQGEwJKUDEOMAwGA1UECAwFVG9reW8xEjAQBgNVBAcMCVNoaW5q\neXVrdTEaMBgGA1UECgwRSURDIEZyb250aWVyLGluYy4xKTAnBgNVBAsMIFRlY2hu\naWNhbCBEZXZlbGVwbWVudCBEZXBhcnRtZW50MRMwEQYDVQQDDApVZW5vIEFraXRv\nMRwwGgYJKoZIhvcNAQkBFg1hdWVub0BpZGNmLmpwMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAqg+dPwdkKEiKpN3zqXLu92lY6H0pXepXAMo93FXdqnyq\n6PAQ7FwLcmRpkw0tlYM6hJPizVGSbVX8BOkcxQ47Idnt9YV/UQIGaUdbpPed+B8N\nWHEgTG4AJ1toU6nFdP5hElWJ9ftczzZX8trB4LNncwHbo6dAr5uk9eEphyqjoA7e\nl7nsbkEWTaJyeHQdOHklciVY+OwkaOjal2TgQXxzfUenSEc9QZ41HkbbXY9d6pY4\nSdBPruDJwkTW4IaRq88MSzL1sKd9tH9wGaq7TxEPIB/ezxMMe22lO2fsJbUc0lxs\nahHbzSC0nYzJxoxSFcF9oirF3Kys/QNkikW5LGF/4QIDAQABMA0GCSqGSIb3DQEB\nBQUAA4IBAQA+C5SzaN+cRfaMxjWuWlxMLDSQ2jVg9oyS9XY4CfME6GWyU4DWMyhe\nNJ+H4r+MxSJb9nJs1N5weR7hObvZCM/K2qh7P+d+UGa2qfZeq1PJq6HZqVPgzKBc\nrsuFEfDgnx2OS0MsfxWZc4kamZb6W5d46tYaFI0aCutcRQg2wF5+VQvfPYtPG27T\nh7lYMA8Rw4lys55hOiMx1BxJgZX6o1RhV8UJp/+hIAQ9pQ64uU/UzJRm6jvHxAo2\n4iBMw8qoZV42/Oh/ZsKJcS1FEYqCHa9nnr1ogsYijsQxDG2jP/dmoOAXcXt/LCqP\nvPPyDdcONycVadjAWZgVZ0HsquCrHMtb\n-----END CERTIFICATE-----\n\n\n\nStep5: HAProxy\u3092\u8d77\u52d5\u3059\u308b\n$ sudo chmod +x /etc/init.d/haproxy\n$ sudo /etc/init.d/haproxy start\n\n\nStep6: \u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067tcpdump\u3092\u3068\u308a\u3001HTTP\u901a\u4fe1\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n$ sudo tcpdump -i eth0 -s 2048K -w /tmp/tcpdump port 80\n\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n\n\nStep7: \u78ba\u8a8d\u3057\u3066\u307f\u308b\n\u53d6\u5f97\u3057\u305ftcpdump\u3092Wireshark\u3067\u898b\u3066\u307f\u308b\u3002\n10.3.0.93\u306810.3.0.20\u306b\u4ea4\u4e92\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u6295\u3052\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n\n\n\u304a\u308f\u308a\u306b\nHAProxy\u3092\u5229\u7528\u3059\u308c\u3070\u3001\u7d50\u69cb\u7c21\u5358\u306bSSL\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306eLB\u3092\u4f5c\u6210\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u305f\u3060\u8a2d\u5b9a\u3067\u304d\u308bkeyword\u304c\u591a\u304f\u672c\u683c\u7684\u306b\u5229\u7528\u3059\u308b\u306b\u306f\u307e\u305a\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u304c\u5fc5\u8981\u305d\u3046\u3067\u3059^^;\n\u304a\u3057\u307e\u3044\u3002\n\n## \u306f\u3058\u3081\u306b\nUbuntu14.04\u4e0a\u3067HAProxy1.5.9\u3092\u69cb\u7bc9\u3057\u3066SSL\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30bf\u30fc\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n## \u69cb\u6210\n\n```\nHAProxy\n\u251c\u2500\u2500 Nginx1\n\u2514\u2500\u2500 Nginx2\n```\n\n## \u74b0\u5883\u60c5\u5831\n\n* OS: Ubuntu14.04\n* HAProxy: 1.5.9\n\n## Step1: HAProxy\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u307e\u305a\u306fHAProxy\u306emake\u306b\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo apt-get update\n$ sudo apt-get install build-essential make g++ libssl-dev\n```\n\n\u6b21\u306b\u6700\u65b0\u306e\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n2014/12/8\u73fe\u5728\u306e\u6700\u65b0\u306e\u5b89\u5b9a\u7248\u306f1.5.9\u3067\u3059\u3002\n\n```\n$ cd /usr/local/src\n$ sudo wget http://www.haproxy.org/download/1.5/src/haproxy-1.5.9.tar.gz\n$ \n```\n\n\u53d6\u3063\u3066\u304d\u305f\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u5c55\u958b\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ sudo tar zxvf haproxy-1.5.9.tar.gz\n$ cd haproxy-1.5.9\n$ sudo make TARGET=linux2628 USE_OPENSSL=yes \n$ sudo make install # /usr/local/sbin/haproxy\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\n```\n\n## Step2: haproxy\u30b0\u30eb\u30fc\u30d7\u3001\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n```\n$ sudo groupadd -g 2001 haproxy # haproxy\u7528\u30b0\u30eb\u30fc\u30d7\u4f5c\u6210\n$ sudo useradd -u 2001 -g 2001 -s /sbin/nologin haproxy # haproxy\u7528\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\n```\n\n## Step3: \u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3084\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3001pid\u30d5\u30a1\u30a4\u30eb\u306e\u7f6e\u304d\u5834\u6240\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ sudo mkdir -p /var/run/haproxy /etc/haproxy/ssl /var/log/haproxy /var/lock/haproxy\n$ sudo chown -R haproxy:haproxy /var/run/haproxy /etc/haproxy /var/log/haproxy\n```\n\n## Step4: \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\n\n\u3053\u3053\u306f\u5168\u90e8\u3092\u8aad\u307f\u5207\u308c\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u5927\u304d\u304f\u5206\u3051\u308b\u3068\u4ee5\u4e0b\u4e8c\u3064\u3067\u69cb\u6210\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n* global\u30bb\u30af\u30b7\u30e7\u30f3\n* Proxies: defaluts\u30bb\u30af\u30b7\u30e7\u30f3\u3001frontend\u30bb\u30af\u30b7\u30e7\u30f3\u3001backend\u30bb\u30af\u30b7\u30e7\u30f3\u3001listen\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u30bb\u30c3\u30c8\u3002\n\n\n\u5404\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u5927\u4f53\u306e\u610f\u5473\u5408\u3044\u306f\u4ee5\u4e0b\u3068\u306a\u308a\u307e\u3059\u3002\n\n|\u30bb\u30af\u30b7\u30e7\u30f3\u540d|\u5f79\u5272|\n|----------|------------|\n|global|\u30d7\u30ed\u30bb\u30b9\u5168\u4f53\u3084OS\u7279\u6709\u306e\u8a2d\u5b9a\u3092\u884c\u3046\u30bb\u30af\u30b7\u30e7\u30f3\u3002\u30d7\u30ed\u30bb\u30b9\u7ba1\u7406\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u8abf\u6574\u7528\u306ekeyword\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3\u3002|\n|defaults|\u305d\u306e\u4ed6\u306e\u30bb\u30af\u30b7\u30e7\u30f3(frontend, backend, listen)\u306e\u305f\u3081\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3|\n|frontend|listen\u3057\u3066\u3044\u308b\u30bd\u30b1\u30c3\u30c8\u306e\u5b9a\u7fa9\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3|\n|backend|\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u3042\u3063\u305f\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u6295\u3052\u5148\u3068\u306a\u308b\u30b5\u30fc\u30d0\u30fc\u60c5\u5831\u3092\u8a18\u8f09\u3059\u308b\u30bb\u30af\u30b7\u30e7\u30f3|\n|listen|frontend\u3068backend\u306e\u8a2d\u5b9a\u3092\u7d10\u4ed8\u3051\u308b\u30bb\u30af\u30b7\u30e7\u30f3\u3002|\n\n\u3053\u3061\u3089\u305d\u308c\u305e\u308c\u3067\u6307\u5b9a\u53ef\u80fd\u306akeyword\u306f[HAProxy\u30de\u30cb\u30e5\u30a2\u30eb](http://cbonte.github.io/haproxy-dconv/configuration-1.5.html)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n```/etc/haproxy/haproxy.cfg\nglobal\n\tlog 127.0.0.1\tlocal0\n\tlog 127.0.0.1\tlocal1 notice\n\tmaxconn 4096 # \u4e00\u3064\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u5f35\u308c\u308b\u6700\u5927\u306e\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\n\tpidfile     /var/run/haproxy.pid\n\tuser haproxy\n\tgroup haproxy\n\tdaemon # background\u8a2d\u5b9a\n\tssl-server-verify  none # \u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u306e\u305f\u3081none\u306b\u8a2d\u5b9a\n\ttune.ssl.cachesize 20000 # ssl session cache\u306e\u5bb9\u91cf\u3002200B * 20000\u7a0b\u5ea6\u306e\u5bb9\u91cf\n\tssl-default-bind-options no-sslv3\n\ttune.ssl.default-dh-param 2048 # \u3053\u3061\u3089\u8a2d\u5b9a\u3057\u306a\u3044\u3068Warning\u51fa\u307e\u3059\u3002\n\n# Proxies #\ndefaults\n\tlog\tglobal # global\u30bb\u30af\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\u3057\u305f\u65b9\u6cd5\u3067\u30ed\u30b0\u51fa\u529b\u3002\n\tmode\thttp # \u8d77\u52d5\u6642\u306e\u30e2\u30fc\u30c9\u3092\u9078\u629e\u3002tcp|http|heakth\u304c\u9078\u629e\u53ef\u80fd\u3002\n\toption\thttplog # http\u30ea\u30af\u30a8\u30b9\u30c8\u306e\u30ed\u30b0\u3092\u51fa\u529b\u3002\n\tretries\t3 # \u63a5\u7d9a\u5931\u6557\u6642\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u56de\u6570\u3002 \n\tmaxconn\t2000 # frontend\u3067\u540c\u6642\u306b\u5f35\u308c\u308b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\n\ttimeout connect\t5000 # \u30ea\u30c8\u30e9\u30a4\u307e\u3067\u306e\u5f85\u3061\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\u3002\n\ttimeout client\t5000 # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u306e\u9593\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\n\ttimeout server\t50000 # \u30b5\u30fc\u30d0\u30fc\u3068\u306e\u9593\u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u6642\u9593\u3002\u5358\u4f4d\u306fmillisecond\n\nfrontend  ssl_proxy\n\tbind *:443 ssl crt /etc/haproxy/ssl/server.pem # fronted\u3067listening\u3057\u3066\u3044\u308bIP\u30a2\u30c9\u30ec\u30b9\u3001\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3002crt\u3067\u306f\u8a3c\u660e\u66f8\u3068private key\u304c\u8a18\u8f09\u3055\u308c\u305fpem\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\n\tuse_backend      nginx # \u8ee2\u9001\u3059\u308bbackend\u540d\u3092\u6307\u5b9a\u3059\u308b\u3002\n\nbackend nginx\n\tbalance roundrobin # \u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b9\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u6307\u5b9a\u3002\n\tserver nginx1 10.3.0.29:80 check inter 2000 # \u8ee2\u9001\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\u3002check\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067health\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u304f\u308c\u308b\u3002\u3053\u306e\u5834\u5408\u306f2000millisecond\u3002\n\tserver nginx2 10.3.0.93:80 check inter 2000 # \u8ee2\u9001\u5148\u306e\u30b5\u30fc\u30d0\u30fc\u5b9a\u7fa9\u3002check\u3092\u4ed8\u3051\u308b\u3053\u3068\u3067health\u30c1\u30a7\u30c3\u30af\u3092\u3057\u3066\u304f\u308c\u308b\u3002\u3053\u306e\u5834\u5408\u306f2000millisecond\u3002\n```\n\n```/etc/init.d/haproxy\n#!/bin/bash\n#\n# chkconfig: - 85 15\n# description: HA-Proxy is a TCP/HTTP reverse proxy which is particularly suited \\\n#              for high availability environments.\n# processname: haproxy\n# config: /etc/haproxy/haproxy.cfg\n# pidfile: /var/run/haproxy.pid\n\n# Source function library.\nif [ -f /etc/init.d/functions ]; then\n  . /etc/init.d/functions\nelif [ -f /etc/rc.d/init.d/functions ] ; then\n  . /etc/rc.d/init.d/functions\nelif [ -f /lib/lsb/init-functions ] ; then\n  # Ubuntu\u7528\n  . /lib/lsb/init-functions\nelse\n  exit 0\nfi\n\n# This is our service name\nBASENAME=`basename $0`\nif [ -L $0 ]; then\n  BASENAME=`find $0 -name $BASENAME -printf %l`\n  BASENAME=`basename $BASENAME`\nfi\n\n[ -f /etc/$BASENAME/$BASENAME.cfg ] || exit 1\n\nRETVAL=0\nLOCK_DIR='/var/lock/haproxy';\nif [ -f /usr/sbin/$BASENAME ] ; then\n  CMD=/usr/sbin/$BASENAME;\nelif [ -f /usr/local/sbin/$BASENAME ] ; then\n  CMD=/usr/local/sbin/$BASENAME;\nfi\nstart() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n\n  echo -n \"Starting $BASENAME: \"\n#  daemon ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid\n  start_daemon ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid\n  RETVAL=$?\n  echo\n  [ $RETVAL -eq 0 ] && touch ${LOCK_DIR}/$BASENAME\n  return $RETVAL\n}\n\nstop() {\n  echo -n \"Shutting down $BASENAME: \"\n  killproc $BASENAME -USR1\n  RETVAL=$?\n  echo\n  [ $RETVAL -eq 0 ] && rm -f ${LOCK_DIR}/$BASENAME\n  [ $RETVAL -eq 0 ] && rm -f /var/run/$BASENAME.pid\n  return $RETVAL\n}\n\nrestart() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n  stop\n  start\n}\n\nreload() {\n  ${CMD} -c -q -f /etc/$BASENAME/$BASENAME.cfg\n  if [ $? -ne 0 ]; then\n    echo \"Errors found in configuration file, check it with '$BASENAME check'.\"\n    return 1\n  fi\n  ${CMD} -D -f /etc/$BASENAME/$BASENAME.cfg -p /var/run/$BASENAME.pid -sf $(cat /var/run/$BASENAME.pid)\n}\n\ncheck() {\n  ${CMD} -c -q -V -f /etc/$BASENAME/$BASENAME.cfg\n}\n\nrhstatus() {\n  status $BASENAME\n}\n\ncondrestart() {\n  [ -e ${LOCK_DIR}/$BASENAME ] && restart || :\n}\n\n# See how we were called.\ncase \"$1\" in\n  start)\n    start\n    ;;\n  stop)\n    stop\n    ;;\n  restart)\n    restart\n    ;;\n  reload)\n    reload\n    ;;\n  condrestart)\n    condrestart\n    ;;\n  status)\n    rhstatus\n    ;;\n  check)\n    check\n    ;;\n  *)\n    echo $\"Usage: $BASENAME {start|stop|restart|reload|condrestart|status|check}\"\n    exit 1\nesac\n \nexit $?\n```\n\n```/etc/haproxy/ssl/server.pem\n-----BEGIN PRIVATE KEY-----\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n3fOpcu73aVjofSld6lcAyj3cVd2qfKro8BDsXAtyZGmTDS2VgzqEk+LNUZJtVfwE\n6RzFDjsh2e31hX9RAgZpR1uk9534Hw1YcSBMbgAnW2hTqcV0/mESVYn1+1zPNlfy\n2sHgs2dzAdujp0Cvm6T14SmHKqOgDt6XuexuQRZNonJ4dB04eSVyJVj47CRo6NqX\nZOBBfHN9R6dIRz1BnjUeRttdj13qljhJ0E+u4MnCRNbghpGrzwxLMvWwp320f3AZ\nqrtPEQ8gH97PEwx7baU7Z+wltRzSXGxqEdvNILSdjMnGjFIVwX2iKsXcrKz9A2SK\nRbksYX/hAgMBAAECggEAPvBecxhKMjp+zXuzlVALLxgXJpxD9hUntAwljulci59u\nJZ3LtZ5vQhv1ks36w+34d17APtrkxYBgMHUSB8A3lFSyo/6PWyzTsJ0PRuO53D2p\n08SyfnbrqaVD3Erl4GHRDVcJIzevZqUnMaNSw9XCAKd8YXoiD5wcFkAJ/ZODUVX0\nunsQVSRLVpjP3LxbkLA1behgUbYfe6IgQY3PdgU6ddZgFKMYo901AOAc6GT43c0B\n33ehGO+rZohMPUKLME0LbfsLscPztL2ZNXf6K3iA67bTrOfK+L4LiVnJllf4WWDU\nYyQaE+BP2jqfPBtzidHqtDo5uSowpQx9j6wpupum7QKBgQDeezBt49CZWTyWWfF7\nXkbNC6DIavbtJCtDmxlAiPw+6de8O9UJpe64jXBX1n3C7T2MvZh2hYN+hOxOUS0M\nYMncyxQ8AJpeUn/qxjvdZ82iR96YxZrtw1A9EL66hQQAY1MfLPnlgBRzj9S1KZf7\nBtDkwZIbaY2aNounQSUjo9msswKBgQDDrqVD5c2l2BQZglJ1TRstSLQOwQl/6EbK\nCohi2sOZ+6znL37ta8UCN4OGnV8q+hNnegGc+UUZcPXsx6Omou0qkjy0IKEqepZC\n1On9OXcoyXBn7i5K2kIycJ+Ztw0OBewD8BJzSbKuRB9k1JHOiGAZpszurjpGPJJJ\nw8CudHkTGwKBgFfEhWB0pRA58frmVKt0j73IPo+SEwOOZzrubtHUuJ4hJiht+icq\nPLi1o4Ijbc1+Re/Fw+XN2ggJbCehQoJFlJzzyHG7UyqupSP7PBamIqtIavodynbN\nvFO6zWNLoj588Ie1+IefNXI5ZZJqbDhtge8cpgUGaQRTTFiZDIu40eCdAoGADVNk\nX8ZThdq8K6yLTv+sPR45XNPagMJhp7ql5Q1+yoqwEKJUY3i2VttO8qje5T9YePB/\nEaCMCxp9NN23kE6CFicVSTL7prfoaa60LJFwQu/M3tcCgghw/5xZ0g78LZtLok0E\nBKPdLi7ncGdlcooo+TY5uHtW7peLYsiY44h9AkcCgYArW6zrNr3ASfJ/xjG0FItv\nltzQUa/vBm+H2q0QKq4LWw0u542rymEXpRIyV/67EWxfUBo8xkik7IvNrnzzt/jC\n4mUarfHuRHrXXcvU8joSalaj7/B7h/ps1y43mjOfwgXPtoi2tE8yx2fL4kETvQBP\nTbHkZz8FCRsVN7cEfVUAcg==\n-----END PRIVATE KEY-----\n-----BEGIN CERTIFICATE-----\nxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\nSlAxDjAMBgNVBAgMBVRva3lvMRIwEAYDVQQHDAlTaGluanl1a3UxGjAYBgNVBAoM\nEUlEQyBGcm9udGllcixpbmMuMSkwJwYDVQQLDCBUZWNobmljYWwgRGV2ZWxlcG1l\nbnQgRGVwYXJ0bWVudDETMBEGA1UEAwwKVWVubyBBa2l0bzEcMBoGCSqGSIb3DQEJ\nARYNYXVlbm9AaWRjZi5qcDAeFw0xNDA4MjQwNTQwMTdaFw0xNDA5MjMwNTQwMTda\nMIGrMQswCQYDVQQGEwJKUDEOMAwGA1UECAwFVG9reW8xEjAQBgNVBAcMCVNoaW5q\neXVrdTEaMBgGA1UECgwRSURDIEZyb250aWVyLGluYy4xKTAnBgNVBAsMIFRlY2hu\naWNhbCBEZXZlbGVwbWVudCBEZXBhcnRtZW50MRMwEQYDVQQDDApVZW5vIEFraXRv\nMRwwGgYJKoZIhvcNAQkBFg1hdWVub0BpZGNmLmpwMIIBIjANBgkqhkiG9w0BAQEF\nAAOCAQ8AMIIBCgKCAQEAqg+dPwdkKEiKpN3zqXLu92lY6H0pXepXAMo93FXdqnyq\n6PAQ7FwLcmRpkw0tlYM6hJPizVGSbVX8BOkcxQ47Idnt9YV/UQIGaUdbpPed+B8N\nWHEgTG4AJ1toU6nFdP5hElWJ9ftczzZX8trB4LNncwHbo6dAr5uk9eEphyqjoA7e\nl7nsbkEWTaJyeHQdOHklciVY+OwkaOjal2TgQXxzfUenSEc9QZ41HkbbXY9d6pY4\nSdBPruDJwkTW4IaRq88MSzL1sKd9tH9wGaq7TxEPIB/ezxMMe22lO2fsJbUc0lxs\nahHbzSC0nYzJxoxSFcF9oirF3Kys/QNkikW5LGF/4QIDAQABMA0GCSqGSIb3DQEB\nBQUAA4IBAQA+C5SzaN+cRfaMxjWuWlxMLDSQ2jVg9oyS9XY4CfME6GWyU4DWMyhe\nNJ+H4r+MxSJb9nJs1N5weR7hObvZCM/K2qh7P+d+UGa2qfZeq1PJq6HZqVPgzKBc\nrsuFEfDgnx2OS0MsfxWZc4kamZb6W5d46tYaFI0aCutcRQg2wF5+VQvfPYtPG27T\nh7lYMA8Rw4lys55hOiMx1BxJgZX6o1RhV8UJp/+hIAQ9pQ64uU/UzJRm6jvHxAo2\n4iBMw8qoZV42/Oh/ZsKJcS1FEYqCHa9nnr1ogsYijsQxDG2jP/dmoOAXcXt/LCqP\nvPPyDdcONycVadjAWZgVZ0HsquCrHMtb\n-----END CERTIFICATE-----\n```\n\n## Step5: HAProxy\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ sudo chmod +x /etc/init.d/haproxy\n$ sudo /etc/init.d/haproxy start\n```\n\n## Step6: \u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067tcpdump\u3092\u3068\u308a\u3001HTTP\u901a\u4fe1\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3002\n\n```HAProxy\u30b5\u30fc\u30d0\u30fc\n$ sudo tcpdump -i eth0 -s 2048K -w /tmp/tcpdump port 80\n```\n\n```client\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n$ curl -k https://${haproxy_server}\n```\n\n## Step7: \u78ba\u8a8d\u3057\u3066\u307f\u308b\n\n\u53d6\u5f97\u3057\u305ftcpdump\u3092Wireshark\u3067\u898b\u3066\u307f\u308b\u3002\n`10.3.0.93`\u3068`10.3.0.20`\u306b\u4ea4\u4e92\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u6295\u3052\u3089\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u5206\u304b\u308b\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-12-08 20.18.20.png](https://qiita-image-store.s3.amazonaws.com/0/46472/5e1eeb56-8924-afbe-6374-bae9304d7a79.png \"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-12-08 20.18.20.png\")\n\n## \u304a\u308f\u308a\u306b\n`HAProxy`\u3092\u5229\u7528\u3059\u308c\u3070\u3001\u7d50\u69cb\u7c21\u5358\u306bSSL\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306eLB\u3092\u4f5c\u6210\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u305f\u3060\u8a2d\u5b9a\u3067\u304d\u308bkeyword\u304c\u591a\u304f\u672c\u683c\u7684\u306b\u5229\u7528\u3059\u308b\u306b\u306f\u307e\u305a\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u304c\u5fc5\u8981\u305d\u3046\u3067\u3059^^;\n\n\u304a\u3057\u307e\u3044\u3002\n\n\n", "tags": ["Ubuntu", "haproxy", "SSL", "memo"]}