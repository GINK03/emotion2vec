{"context": "\n\n\u306f\u3058\u3081\u306b\n\u3053\u308c\u306f\u3001OpenCV Advent Calendar 2016 6\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\u95a2\u9023\u8a18\u4e8b\u306f\u76ee\u6b21\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001Computer Vision Advent Calendar 2013 \u3067\u306ewosugi\u6c0f\u306e\u30cd\u30bf \u30cf\u30df\u30f3\u30b0\u8ddd\u96e2\u306e\u8a08\u7b97\u306f\u307b\u3093\u3068\u306b\u901f\u3044\u306e\u304b\uff1f \u306e\u713c\u304d\u76f4\u3057\u3067\u3082\u3042\u308a\u307e\u3059\n\n\u80cc\u666f\n\n\u3082\u3068\u306e\u8a18\u4e8b\u3067\u3082\u66f8\u304b\u308c\u3066\u3044\u308b\u901a\u308a\u3001\u30d0\u30a4\u30ca\u30ea\u7279\u5fb4\u91cf\u306b\u304a\u3044\u3066\n\n\n\u30cf\u30df\u30f3\u30b0\u8ddd\u96e2\u306e\u8a08\u7b97\u305d\u306e\u3082\u306e\u304c\u901f\u3044\u306e\u304b\n\u30d0\u30a4\u30ca\u30ea\u5316\u306e\u6b21\u5143\u524a\u6e1b\u306b\u3088\u3063\u3066\u8a08\u7b97\u304c\u901f\u3044\u306e\u304b \n\n\n\u304c\u66d6\u6627\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n2013\u5e74\u7248\u306fSSE\u3092\u4f7f\u3063\u3066\u5b9f\u9a13\u304c\u884c\u308f\u308c\u3001\u7d50\u679cL1\uff08\u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\uff09\u304chamming\u304c\u9ad8\u901f\u306a\u306e\u3067\u306f\u7121\u304f\u3001\u6b21\u5143\u6570\u306e\u524a\u6e1b\u304c\u52b9\u679c\u7684\u3068\u3044\u3046\u7d50\u679c\u304c\u51fa\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001\u305d\u308c\u3092ARM\u306eNEON\u3067\u8a66\u3057\u3066\u307f\u3088\u3046\u3001\u3068\u3044\u3046\u4e3b\u984c\u3067\u3059\n\n\n\u30b3\u30fc\u30c9\n\n\n\u57fa\u672c\u7684\u306b\u306fwosugi\u6c0f\u306e\u30b3\u30fc\u30c9\u3092\u6d41\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u70b9\u304c\u9055\u3044\u307e\u3059\n\n\nNEON\u306epopcount\u3068SSE\u306epopcount\u306e\u9055\u3044\n\nSSE\u3067\u306f64bit\u9577\u3060\u304c\u3001NEON\u3067\u306f128bit\u9577\u306e\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u4ed8\u3051\u3066\u304f\u308c\u308b\u306e\u3067\u30011\u56de\u3060\u3051128bit\u9577\u306epopcount(VCNTQ)\u3092\u5b9f\u884c\u3059\u308b\n\u540c\u69d8\u306b32bit\u3054\u3068\u306epopcount\u3082\u3001\u308f\u3056\u308f\u305632bit\u6bce\u306b\u5206\u5272\u3059\u308b\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u751f\u3058\u3001\u52b9\u679c\u304c\u3046\u3059\u305d\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f\u5272\u611b\n\nSSE\u3067\u306f\u7dcf\u548c\u304c\u5e30\u3063\u3066\u304f\u308b\u304c\u3001NEON\u3067\u306f128bit\u5185\u306e\u30018bit\u3054\u3068\u306epopcount\u547d\u4ee4\u306e\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001reduction\u3067\u7dcf\u548c\u3092\u6c42\u3081\u308b\u5fc5\u8981\u304c\u3042\u308b\n\n\nSSE \u306b\u3088\u308bpopcount \u306f\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\n\nNEON \u306b\u3088\u308bpopcount \u306f\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\n\n\u5168\u4f53\u306e\u30b3\u30fc\u30c9\u306fgithub \u306b\u4e0a\u3052\u3066\u304a\u304d\u307e\u3057\u305f\n\n\n\u5b9f\u884c\u74b0\u5883\n\n\u4ee5\u4e0b\u306e\u30c7\u30d0\u30a4\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\n\n\nODROID-C2 (Cortex A53\u300164bit Ubuntu\u3001gcc 5.4.0)\nRaspberry Pi 3 (Cortex A53\u300132bit Raspbian\u3001gcc 4.9.2)\nJetson TK1 (Cortex A15\u300132bit Ubuntu\u3001gcc 4.8.4)\nJetson TX1 (Cortex A57\u300164bit Ubuntu\u3001gcc 5.4.0)\nODROID-X2 (Cortex A9\u300132bit Ubuntu\u3001gcc 4.8.4)\n\n\ncmake\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b-DCMAKE_BUILD_TYPE=release (O3\u76f8\u5f53)\u306f\u4ed8\u3051\u306a\u3044\u3068\u8f9e\u66f8\u751f\u6210\u306b\u30a2\u30db\u307f\u305f\u3044\u306b\u6642\u9593\u304c\u304b\u304b\u308b\n\n\n\u7d50\u679c\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u884c\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f(\u5358\u4f4d\u306fms)\n\n\n\n\nmethod\nplatform\nw/o SIMD\nw/ SIMD\n\n\n\n\nL2\nRaspberry Pi 3\n482\n419\n\n\nL2\nJetson TK1\n431\n393\n\n\nL2\nJetson TX1\n272\n492\n\n\nL2\nODROID-C2\n556\n927\n\n\nL2\nODROID-X2\n1022\n852\n\n\nL1\nRaspberry Pi 3\n443\n275\n\n\nL1\nJetson TK1\n455\n198\n\n\nL1\nJetson TX1\n335\n153\n\n\nL1\nODROID-C2\n572\n361\n\n\nL1\nODROID-X2\n842\n536\n\n\nhamming\nRaspberry Pi 3\n1254\n279\n\n\nhamming\nJetson TK1\n1109\n184\n\n\nhamming\nJetson TX1\n424\n202\n\n\nhamming\nODROID-C2\n637\n531\n\n\nhamming\nODROID-X2\n1916\n566\n\n\n\n\n\u30dc\u30fc\u30c9\u3054\u3068\u306e\u7d50\u679c\u306b\u307e\u3068\u3081\u305f\u306e\u304c\u3053\u3061\u3089\n\n\n\n\nplatform\nmethod\nw/o SIMD\nw/ SIMD\n\n\n\n\nRaspberry Pi 3\nL2\n482\n419\n\n\nRaspberry Pi 3\nL1\n443\n275\n\n\nRaspberry Pi 3\nhamming\n1254\n279\n\n\nJetson TK1\nL2\n431\n393\n\n\nJetson TK1\nL1\n455\n198\n\n\nJetson TK1\nhamming\n1109\n184\n\n\nJetson TX1\nL2\n272\n492\n\n\nJetson TX1\nL1\n335\n153\n\n\nJetson TX1\nhamming\n424\n202\n\n\nODROID-C2\nL2\n556\n927\n\n\nODROID-C2\nL1\n572\n361\n\n\nODROID-C2\nhamming\n637\n531\n\n\nODROID-X2\nL2\n1022\n852\n\n\nODROID-X2\nL1\n842\n536\n\n\nODROID-X2\nhamming\n1916\n566\n\n\n\n\n\u30b0\u30e9\u30d5\u5316\u3057\u3066\u307f\u305f\n\n\n\n\u6587\u5b57\u304c\u6f70\u308c\u3066\u308b\u306e\u3067\u3001\u5de6\u304b\u3089Raspberry Pi3\u306eL2\u2192L1\u2192hamming\u3001Jetson TK1\u3001Jetson TX1\u3001ODROID-C2\u3001ODROID-X2\u306e\u9806\n\u8d64\u7dda\u304cSIMD\u7121\u3057\u3001\u7dd1\u8272\u306e\u7bb1\u578b\u30b0\u30e9\u30d5\u304cSIMD\u3042\u308a\u306e\u7d50\u679c\n\u7e26\u8ef8\u306f\u5b9f\u884c\u6642\u9593(ms)\u306a\u306e\u3067\u77ed\u3044\u307b\u3069\u9ad8\u901f\u306a\u3053\u3068\u3092\u8868\u3059\n\n\n\uff08\u8ffd\u8a18\uff09\u6b21\u5143\u6570\u3067\u306e\u6b63\u898f\u5316\n\n\nambee_whisper\u3055\u3093\u306b\u6307\u6458\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u3053\u306e\u8a55\u4fa1\u3067\u306fL1\u3068L2\u306f8bit/dimension\u3001hamming\u3067\u306f1bit/dimension\u3067\u3042\u308a\u307e\u3059\n\u3064\u307e\u308a\u3001time/dimension \u3067\u6bd4\u8f03\u3059\u308b\u306e\u304c\u30d5\u30a7\u30a2\u3067\u306f\u306a\u3044\u304b\u3068\u3044\u3046\u6307\u6458\u3067\u3059\n\u3054\u6307\u6458\u306f\u3082\u3063\u3068\u3082\u3067\u3001\u4ee5\u4e0b\u306b\u7d50\u679c\u3092\u307e\u3068\u3081\u305f\u8868\u3092\u518d\u63b2\u3002\u5358\u4f4d\u306fms/dimension\n\nL2/L1\u306f8bit/dimension\u306a\u306e\u3067\u3001128\u3067\u5272\u3063\u305f\u5024\u3092\u3001hamming\u306f1024\u6b21\u5143\u306a\u306e\u30671024\u3067\u5272\u3063\u305f\u5024\u306b\u306a\u3063\u3066\u3044\u307e\u3059\n\n\n\n\nplatform\nmethod\nw/o SIMD\nw/ SIMD\n\n\n\n\nRaspberry Pi 3\nL2\n3.765625\n3.2734375\n\n\nRaspberry Pi 3\nL1\n3.4609375\n2.1484375\n\n\nRaspberry Pi 3\nhamming\n1.224609375\n0.272460938\n\n\nJetson TK1\nL2\n3.3671875\n3.0703125\n\n\nJetson TK1\nL1\n3.5546875\n1.546875\n\n\nJetson TK1\nhamming\n1.083007813\n0.1796875\n\n\nJetson TX1\nL2\n2.125\n3.84375\n\n\nJetson TX1\nL1\n2.6171875\n1.1953125\n\n\nJetson TX1\nhamming\n0.4140625\n0.197265625\n\n\nODROID-C2\nL2\n4.34375\n7.2421875\n\n\nODROID-C2\nL1\n4.46875\n2.8203125\n\n\nODROID-C2\nhamming\n0.622070313\n0.518554688\n\n\nODROID-X2\nL2\n7.984375\n6.65625\n\n\nODROID-X2\nL1\n6.578125\n4.1875\n\n\nODROID-X2\nhamming\n1.87109375\n0.552734375\n\n\n\n\n- \u6587\u5b57\u304c\u6f70\u308c\u3066\u308b\u306e\u3067\u3001\u5de6\u304b\u3089Raspberry Pi3\u306eL2\u2192L1\u2192hamming\u3001Jetson TK1\u3001Jetson TX1\u3001ODROID-C2\u3001ODROID-X2\u306e\u9806\n- \u8d64\u7dda\u304cSIMD\u7121\u3057\u3001\u7dd1\u8272\u306e\u7bb1\u578b\u30b0\u30e9\u30d5\u304cSIMD\u3042\u308a\u306e\u7d50\u679c\n\n\u7d50\u679c\u3092\u773a\u3081\u3066\u898b\u3066\uff08\u3082\u308d\u3082\u308d\u8ffd\u8a18/\u524a\u9664\uff09\n\n\u6982\u306d\u3001SSE\u7248\u3068\u4f3c\u305f\u50be\u5411\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3001\u6b63\u898f\u5316\u3057\u305f\u7d50\u679c\u306fhamming\u5727\u52dd\u3067\u3059\u3002\n\n\nhamming\u3068L1\u306e\u8a08\u7b97\u6642\u9593\u81ea\u4f53\u306f\u304b\u306a\u308a\u63a5\u6226\u306a\u306e\u3067\u3059\u304c\u3001hamming\u306f8\u500d\u306e\u6b21\u5143\u6570\u3092\u6271\u3063\u3066\u308b\u306e\u3067\u3001\u7d50\u679chamming\u306e\u5727\u52dd\u3067\u3059\n\n\n\n\u3057\u304b\u3057\u3001\u3088\u304f\u898b\u308b\u306832bit OS\u304c\u4e57\u3063\u305fARM\u3067\u306fhamming\u304c\u6700\u901f\u3001\u3082\u3057\u304f\u306fL1\u3068\u63a5\u6226\u3092\u7e70\u308a\u5e83\u3052\u3066\u3044\u307e\u3059\n\nRaspberry Pi 3 275ms(L1) VS 279ms(hamming)\nJetson TK1 198ms(L1) VS 184ms(hamming)\nODROID-X2 536ms(L1) VS 566ms(hamming)\n\u3053\u3061\u3089\u306e\u30dc\u30fc\u30c9\u306f\u3044\u305a\u308c\u3082\u308232bit OS\u3067\u3059\u3002(Raspberry Pi 3 \u306eCortex A53\u306f64bit\u5bfe\u5fdc\u3060\u304c\u3001OS\u306eRaspbian\u306f32bit)\nhamming\u3082\u3001L1\u3067\u3082\u3001\u7d50\u679c\u306f8bit\u5358\u4f4d16\u8981\u7d20\u3067\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u7dcf\u548c\u3092\u6c42\u3081\u308b\u305f\u3081\u306breduction\u306e\u5fc5\u8981\u304c\u3042\u308a\u3001\u305d\u3053\u306e\u30b3\u30b9\u30c8\u306fhamming\u3082L1\u3082\u540c\u7b49\u306b\u601d\u3048\u307e\u3059\n\u3068\u3059\u308b\u3068\u3001ARM\u306e popcount(VCNTQ)\u547d\u4ee4\u306fabs diff(ABDQ)\u547d\u4ee4\u3068\u540c\u7b49\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\n\n\n32bit OS\u3067\u306fSIMD\u7121\u3057\u7248\u306ehamming\u304c\u7570\u69d8\u306b\u9045\u304f\u3001SIMD\u5316\u3057\u3066\u4e00\u6c17\u306b\u9ad8\u901f\u5316\u3055\u308c\u3066\u3044\u308b\u306e\u3082\u6c17\u306b\u306a\u308a\u307e\u3059\n\n\n\u3053\u3053\u306e\u5b9f\u88c5\u306fx86\u5411\u3051\u306e\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u6d41\u7528\u306a\u306e\u3067\u3001SIMD\u7121\u3057\u306e\u66f8\u304d\u65b9\u306f\u3082\u3046\u5c11\u3057\u5de5\u592b\u306e\u4f59\u5730\u304c\u3042\u308a\u305d\u3046\u3067\u3059\n\n\n64bit OS\u4e0a\u3067\u306eL2\u8ddd\u96e2\u304c\u306a\u3093\u3068SIMD\u7121\u3057\u306e\u65b9\u304c\u901f\u3044\u3068\u3044\u3046\u5c48\u8fb1\n\nJetson TX1 272ms(SIMD\u7121\u3057) VS 492ms (SIMD\u3042\u308a)\nODROID-C2 556ms(SIMD\u7121\u3057) VS 927ms (SIMD\u3042\u308a)\n\u99ac\u9e7f\u306a\uff01\u30aa\u30fc\u30c8\u30d9\u30af\u30bf\u30e9\u30a4\u30ba\u306e\u65b9\u304c\u9ad8\u901f\u3060\u3068\u3063\uff01\uff1f\n\u7d50\u69cb\u5c48\u8fb1\u3002\u3055\u3089\u3063\u3068\u30a2\u30bb\u30f3\u30d6\u30ea\u3092\u773a\u3081\u305f\u611f\u3058\u3001\u30eb\u30fc\u30d7\u30a2\u30f3\u30ed\u30fc\u30eb\u3055\u308c\u3066\u3044\u3066\u3001\u305d\u308c\u304c\u52b9\u3044\u3066\u3044\u308b\u69d8\u306b\u3082\u898b\u3048\u308b\u3002\n\u3057\u304b\u3057\u7d30\u304b\u3044\u691c\u8a3c\u306f\u3057\u3066\u307e\u305b\u3093\n\n\nJetson TX1\u3001ODROID-C2\u3001\u3068\u3082\u306bL1\u306e\u65b9\u304c\u9ad8\u901f\u3067\u3059\u3002\n\n64bit OS\u3067\u306e\u7d50\u679c\u306f\u3001L1\u306e\u65b9\u304chamming\u3088\u308a\u6709\u610f\u306a\u5dee\u3092\u6301\u3063\u3066\u9ad8\u901f\u306a\u7d50\u679c\u3068\u306a\u308a\u307e\u3057\u305f(SSE\u3068\u540c\u69d8\u306e\u50be\u5411)\n\n\u3053\u3053\u304c\u6700\u5927\u306e\u8b0e\u3002Raspberry Pi 3\u306fCortex A53\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u6c7a\u3057\u306664bit ARM\u304c\u9045\u3044\u3068\u3044\u3046\u8a33\u3067\u306f\u306a\u304f\u300164bit OS\u3067\u5b9f\u884c\u3059\u308b\u3068hamming\u3068L1\u306b\u6709\u610f\u306a\u5dee\u304c\u73fe\u308c\u307e\u3059\n\u305d\u306e\u3046\u306164bit \u306eRaspbian \u3068\u304b\u304c\u51fa\u305f\u3089\uff08\u3082\u3046\u51fa\u3066\u308b\uff1f\uff0932bit/64bit\u306e\u6bd4\u8f03\u3068\u304b\u3057\u3066\u307f\u308b\u3068\u9762\u767d\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\uff08\u305d\u3053\u307e\u3067\u624b\u304c\u56de\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff09\n\n\n64bit \u3067\u3082\u3001ms/dimension\u306e\u7d50\u679c\u3067\u306fhamming \u304c\u6700\u901f\u3068\u306a\u308a\u307e\u3057\u305f\n\u306a\u304a\u3001\u5404CPU\u306f\u30d9\u30fc\u30b9\u30af\u30ed\u30c3\u30af\u3082\u30de\u30c1\u30de\u30c1\u306a\u306e\u3067\u3001\u30dc\u30fc\u30c9\u9593\u306e\u6bd4\u8f03\u306f\u4f59\u308a\u610f\u5473\u304c\u7121\u3044\u3068\u601d\u3044\u307e\u3059\n\n\nOpenCV\u3067\u306e\u4f7f\u3044\u65b9\n\n\u3053\u308c\u3060\u3051\u3060\u3068OpenCV advent calendar \u306bOpenCV\u629c\u304d\u306a\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3057\u307e\u3046\u306e\u3067\u3001OpenCV\u306b\u307e\u3064\u308f\u308b\u60c5\u5831\u3092\u4f55\u304b\u66f8\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\nOpenCV\u306b\u306f\u3001cv::normHamming\u3068\u3044\u3046Hamming\u8ddd\u96e2\u3092\u6c42\u3081\u3066\u304f\u308c\u308b\u95a2\u6570\u304c\u3042\u308a\u307e\u3059\n\n\nstat.cpp\nint normHamming(const uchar* a, int n)\n{\n    int i = 0;\n    int result = 0;\n#if CV_NEON\n    {\n        uint32x4_t bits = vmovq_n_u32(0);\n        for (; i <= n - 16; i += 16) {\n            uint8x16_t A_vec = vld1q_u8 (a + i);\n            uint8x16_t bitsSet = vcntq_u8 (A_vec);\n            uint16x8_t bitSet8 = vpaddlq_u8 (bitsSet);\n            uint32x4_t bitSet4 = vpaddlq_u16 (bitSet8);\n            bits = vaddq_u32(bits, bitSet4);\n        }\n        uint64x2_t bitSet2 = vpaddlq_u32 (bits);\n        result = vgetq_lane_s32 (vreinterpretq_s32_u64(bitSet2),0);\n        result += vgetq_lane_s32 (vreinterpretq_s32_u64(bitSet2),2);\n    }\n#elif CV_AVX2\n    {\n        __m256i _r0 = _mm256_setzero_si256();\n        __m256i _0 = _mm256_setzero_si256();\n        __m256i _popcnt_table = _mm256_setr_epi8(0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,\n                                                 0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4);\n        __m256i _popcnt_mask = _mm256_set1_epi8(0x0F);\n\n        for(; i <= n - 32; i+= 32)\n        {\n            __m256i _a0 = _mm256_loadu_si256((const __m256i*)(a + i));\n\n            __m256i _popc0 = _mm256_shuffle_epi8(_popcnt_table, _mm256_and_si256(_a0, _popcnt_mask));\n            __m256i _popc1 = _mm256_shuffle_epi8(_popcnt_table,\n                             _mm256_and_si256(_mm256_srli_epi16(_a0, 4), _popcnt_mask));\n\n            _r0 = _mm256_add_epi32(_r0, _mm256_sad_epu8(_0, _mm256_add_epi8(_popc0, _popc1)));\n        }\n        _r0 = _mm256_add_epi32(_r0, _mm256_shuffle_epi32(_r0, 2));\n        result = _mm256_extract_epi32_(_mm256_add_epi32(_r0, _mm256_permute2x128_si256(_r0, _r0, 1)), 0);\n    }\n#endif\n    for( ; i <= n - 4; i += 4 )\n        result += popCountTable[a[i]] + popCountTable[a[i+1]] +\n        popCountTable[a[i+2]] + popCountTable[a[i+3]];\n    for( ; i < n; i++ )\n        result += popCountTable[a[i]];\n    return result;\n}\n\n\n\n\u5185\u90e8\u7684\u306b\u306f\u3001CV_NEON\u3068CV_AVX2\u306e\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\n\u6628\u65e5\u66f8\u3044\u305fUniversal Intrinsics \u304c\u4f7f\u308f\u308c\u3066\u306a\u3044\u306e\u3067\u3001PR\u30c1\u30e3\u30f3\u30b9\u3067\u3042\u308b\u3053\u3068\u306b\u4eca\u6c17\u304c\u4ed8\u304d\u307e\u3057\u305f\u3002\u3075\u3080\u3075\u3080\n\u3068\u601d\u3063\u3066PR\u306b\u7740\u624b\u3057\u305f\u3082\u306e\u306e\u3001Universal Intrinsic\u306fSSE2\u307e\u3067\u306e\u7e1b\u308a\u30d7\u30ec\u30a4\u306a\u4e0a\u306b\u3001popcount\u306fSSE4.2\u4ee5\u964d\u306e\u5bfe\u5fdc\u306a\u306e\u3067\u3001\u76f8\u5f53\u306a\u7e1b\u308a\u30d7\u30ec\u30a4\u306b\u3002\n\u8ab0\u5f97\u306aPR\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3069\u3046\u3057\u305f\u3082\u306e\u304b\n\n\n\u305d\u3082\u305d\u3082\u3001x86\u3067\u306f\u3001AVX2\u3067\u3057\u304bintrinsic\u304c\u4f7f\u308f\u308c\u3066\u306a\u3044\u306e\u3067\u3001AVX\u307e\u3067\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u79c1\u306eMBP\u3060\u3068\u305d\u3082\u305d\u3082SIMD\u306e\u6069\u6075\u3092\u53d7\u3051\u3089\u308c\u306a\u3044\u3068\u306f\uff01\n\u304c\u3063\u304b\u308a\u3067\u3059\u3002\u3002\u3002\n(\u8ffd\u8a18:)\u304c\u3063\u304b\u308a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001SSE2\u3067popcount\u3057\u305fPR\u3092\u6295\u3052\u3066\u307f\u307e\u3057\u305f\n\n(\u8ffd\u8a18:)\u9858\u308f\u304f\u30703.2\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u542b\u307e\u308c\u308c\u3070\u3001\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001RC\u304c\u51fa\u305f\u5f8c\u306f\u65b0\u898f\u6a5f\u80fd\u8ffd\u52a0\u306e\u30de\u30fc\u30b8\u306f\u3057\u3066\u304f\u308c\u306a\u3044\u3088\u3046\u3067\u3001\u3042\u3063\u3055\u308a3.2\u306b\u306f\u542b\u3081\u3066\u3082\u3089\u3048\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n(\u8ffd\u8a18:)PR\u304b\u3089\u4e00\u30f6\u6708\u7d4c\u3063\u3066\u3001\u3088\u3046\u3084\u304f\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\uff01\u3002\u7d50\u5c40SSE2\u756a\u3068SSE4.1\u7248\u3092commit\u3057\u307e\u3057\u305f\n\n\n\u304a\u308f\u308a\u306b\n\n\u5148\u65e5\u3070\u3063\u305f\u308a\u3001wosugi\u6c0f\u306b\u304a\u4f1a\u3044\u3057\u3066\u3001\u305f\u307e\u305f\u307e\u3053\u306epopcount\u306e\u8a71\u3067\u76db\u308a\u4e0a\u304c\u3063\u305f\u306e\u3067\u3001Advent Calendar \u306b\u4ed5\u7acb\u3066\u4e0a\u3052\u3066\u307f\u307e\u3057\u305f\u3002\n32bit\u7248\u306eARM\u3067\u306fhamming\u8ddd\u96e2\u306fL1\u8ddd\u96e2\u3068\u540c\u7b49\u306e\u6027\u80fd\u3092\u793a\u3057\u307e\u3059\u304c\u300164bit\u7248\u3067\u306f\u307e\u3060L1\u306b\u5206\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n32bit\u7248\u306eARM\u3067\u306f\u8a08\u7b97\u6642\u9593\u81ea\u4f53\u306fL1\u3068hamming\u3068\u3067\u540c\u7b49\u306e\u6027\u80fd\u3092\u793a\u3057\u307e\u3059\u304c\u3001\u6b63\u898f\u5316\u3057\u305f\u7d50\u679c\u3067\u306f32bit\u7248/64bit\u7248\u306eARM\u3068\u3082\u306bhamming\u5727\u52dd\u3067\u3057\u305f\u3002\npopcount\u306b\u5e78\u3042\u308c\nNEON\u3068SSE\u3092\u7dcf\u3058\u3066\u898b\u308b\u3068\u3001_mm_popcnt_u64\u3060\u3051\u304c\u30a4\u30b1\u3066\u306a\u3044\u3001\u3068\u3044\u3046\u6c17\u304c\u3059\u308b\u3002\n\u660e\u65e5\u306fTaroYamada \u3055\u3093\u306e\u8a18\u4e8b\u3067\u3059\u3002\u304a\u697d\u3057\u307f\u306b\uff01\n\n\n\u88dc\u8db3\n\nOpenCV (git\u7248\u30ea\u30d3\u30b8\u30e7\u30f3ecb8fb964d)\nARM\u306e\u30dc\u30fc\u30c9\u306e\u8a73\u7d30\u306f\u6587\u4e2d\u306b\n\n# \u306f\u3058\u3081\u306b\n\u3053\u308c\u306f\u3001OpenCV Advent Calendar 2016 6\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\u95a2\u9023\u8a18\u4e8b\u306f[\u76ee\u6b21](http://qiita.com/advent-calendar/2016/opencv)\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001Computer Vision Advent Calendar 2013 \u3067\u306ewosugi\u6c0f\u306e\u30cd\u30bf [\u30cf\u30df\u30f3\u30b0\u8ddd\u96e2\u306e\u8a08\u7b97\u306f\u307b\u3093\u3068\u306b\u901f\u3044\u306e\u304b\uff1f](http://wosugi.hatenablog.com/entry/20131208/1386514756) \u306e\u713c\u304d\u76f4\u3057\u3067\u3082\u3042\u308a\u307e\u3059\n\n# \u80cc\u666f\n- \u3082\u3068\u306e\u8a18\u4e8b\u3067\u3082\u66f8\u304b\u308c\u3066\u3044\u308b\u901a\u308a\u3001\u30d0\u30a4\u30ca\u30ea\u7279\u5fb4\u91cf\u306b\u304a\u3044\u3066\n - \u30cf\u30df\u30f3\u30b0\u8ddd\u96e2\u306e\u8a08\u7b97\u305d\u306e\u3082\u306e\u304c\u901f\u3044\u306e\u304b\n - \u30d0\u30a4\u30ca\u30ea\u5316\u306e\u6b21\u5143\u524a\u6e1b\u306b\u3088\u3063\u3066\u8a08\u7b97\u304c\u901f\u3044\u306e\u304b \n- \u304c\u66d6\u6627\u306b\u306a\u3063\u3066\u3044\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n- 2013\u5e74\u7248\u306fSSE\u3092\u4f7f\u3063\u3066\u5b9f\u9a13\u304c\u884c\u308f\u308c\u3001\u7d50\u679c~~L1\uff08\u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\uff09\u304c~~hamming\u304c\u9ad8\u901f\u306a\u306e\u3067\u306f\u7121\u304f\u3001\u6b21\u5143\u6570\u306e\u524a\u6e1b\u304c\u52b9\u679c\u7684\u3068\u3044\u3046\u7d50\u679c\u304c\u51fa\u307e\u3057\u305f\u3002\n- \u4eca\u56de\u306f\u3001\u305d\u308c\u3092```ARM```\u306e```NEON```\u3067\u8a66\u3057\u3066\u307f\u3088\u3046\u3001\u3068\u3044\u3046\u4e3b\u984c\u3067\u3059\n\n# \u30b3\u30fc\u30c9\n- \u57fa\u672c\u7684\u306b\u306fwosugi\u6c0f\u306e\u30b3\u30fc\u30c9\u3092\u6d41\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u70b9\u304c\u9055\u3044\u307e\u3059\n - ```NEON```\u306e```popcount```\u3068```SSE```\u306e```popcount```\u306e\u9055\u3044\n - ```SSE```\u3067\u306f64bit\u9577\u3060\u304c\u3001```NEON```\u3067\u306f128bit\u9577\u306e\u30c7\u30fc\u30bf\u3092\u53d7\u3051\u4ed8\u3051\u3066\u304f\u308c\u308b\u306e\u3067\u30011\u56de\u3060\u3051128bit\u9577\u306e```popcount```(```VCNTQ```)\u3092\u5b9f\u884c\u3059\u308b\n - \u540c\u69d8\u306b32bit\u3054\u3068\u306e```popcount```\u3082\u3001\u308f\u3056\u308f\u305632bit\u6bce\u306b\u5206\u5272\u3059\u308b\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u751f\u3058\u3001\u52b9\u679c\u304c\u3046\u3059\u305d\u3046\u306a\u306e\u3067\u3001\u4eca\u56de\u306f\u5272\u611b\n - ```SSE```\u3067\u306f\u7dcf\u548c\u304c\u5e30\u3063\u3066\u304f\u308b\u304c\u3001```NEON```\u3067\u306f128bit\u5185\u306e\u30018bit\u3054\u3068\u306e```popcount```\u547d\u4ee4\u306e\u7d50\u679c\u3068\u3057\u3066\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001reduction\u3067\u7dcf\u548c\u3092\u6c42\u3081\u308b\u5fc5\u8981\u304c\u3042\u308b\n\n\n- ```SSE``` \u306b\u3088\u308b```popcount``` \u306f\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\n![SSE-popcount.png](https://qiita-image-store.s3.amazonaws.com/0/12162/3ff634dd-6eef-44f1-f904-0b9f7b241c58.png \"SSE\u306epopcount\u306e\u30a4\u30e1\u30fc\u30b8\")\n\n- ```NEON``` \u306b\u3088\u308b```popcount``` \u306f\u3053\u3093\u306a\u30a4\u30e1\u30fc\u30b8\n![NEON-popcount.png](https://qiita-image-store.s3.amazonaws.com/0/12162/fa0b9e39-a1cd-81ff-69c6-dda60f8b2a79.png \"NEON\u306epopcount\u306e\u30a4\u30e1\u30fc\u30b8\")\n\n- \u5168\u4f53\u306e\u30b3\u30fc\u30c9\u306f[github] (https://github.com/tomoaki0705/benchmark-distance) \u306b\u4e0a\u3052\u3066\u304a\u304d\u307e\u3057\u305f\n\n# \u5b9f\u884c\u74b0\u5883\n- \u4ee5\u4e0b\u306e\u30c7\u30d0\u30a4\u30b9\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\n - ODROID-C2 (Cortex A53\u300164bit Ubuntu\u3001gcc 5.4.0)\n - Raspberry Pi 3 (Cortex A53\u300132bit Raspbian\u3001gcc 4.9.2)\n - Jetson TK1 (Cortex A15\u300132bit Ubuntu\u3001gcc 4.8.4)\n - Jetson TX1 (Cortex A57\u300164bit Ubuntu\u3001gcc 5.4.0)\n - ODROID-X2 (Cortex A9\u300132bit Ubuntu\u3001gcc 4.8.4)\n- cmake\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b```-DCMAKE_BUILD_TYPE=release``` (```O3```\u76f8\u5f53)\u306f\u4ed8\u3051\u306a\u3044\u3068\u8f9e\u66f8\u751f\u6210\u306b\u30a2\u30db\u307f\u305f\u3044\u306b\u6642\u9593\u304c\u304b\u304b\u308b\n\n# \u7d50\u679c\n- \u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5b9f\u884c\u7d50\u679c\u306b\u306a\u308a\u307e\u3057\u305f(\u5358\u4f4d\u306f```ms```)\n\nmethod|platform|w/o SIMD|w/ SIMD\n------|--------|--------|--------\nL2|Raspberry Pi 3|482|419\nL2|Jetson TK1|431|393\nL2|Jetson TX1|272|492\nL2|ODROID-C2 |556|927\nL2|ODROID-X2 |1022|852\nL1|Raspberry Pi 3|443|275\nL1|Jetson TK1|455|198\nL1|Jetson TX1|335|153\nL1|ODROID-C2 |572|361\nL1|ODROID-X2 |842|536\nhamming|Raspberry Pi 3|1254|279\nhamming|Jetson TK1|1109|184\nhamming|Jetson TX1|424|202\nhamming|ODROID-C2 |637|531\nhamming|ODROID-X2 |1916|566\n\n- \u30dc\u30fc\u30c9\u3054\u3068\u306e\u7d50\u679c\u306b\u307e\u3068\u3081\u305f\u306e\u304c\u3053\u3061\u3089\n\nplatform|method|w/o SIMD|w/ SIMD\n------|--------|--------|--------\nRaspberry Pi 3|L2|482|419\nRaspberry Pi 3|L1|443|275\nRaspberry Pi 3|hamming|1254|279\nJetson TK1|L2|431|393\nJetson TK1|L1|455|198\nJetson TK1|hamming|1109|184\nJetson TX1|L2|272|492\nJetson TX1|L1|335|153\nJetson TX1|hamming|424|202\nODROID-C2 |L2|556|927\nODROID-C2 |L1|572|361\nODROID-C2 |hamming|637|531\nODROID-X2 |L2|1022|852\nODROID-X2 |L1|842|536\nODROID-X2 |hamming|1916|566\n\n- \u30b0\u30e9\u30d5\u5316\u3057\u3066\u307f\u305f\n\n![result.png](https://qiita-image-store.s3.amazonaws.com/0/12162/46af9879-2982-78ee-02c1-da6c79104a98.png)\n\n- \u6587\u5b57\u304c\u6f70\u308c\u3066\u308b\u306e\u3067\u3001\u5de6\u304b\u3089Raspberry Pi3\u306eL2\u2192L1\u2192hamming\u3001Jetson TK1\u3001Jetson TX1\u3001ODROID-C2\u3001ODROID-X2\u306e\u9806\n- \u8d64\u7dda\u304cSIMD\u7121\u3057\u3001\u7dd1\u8272\u306e\u7bb1\u578b\u30b0\u30e9\u30d5\u304cSIMD\u3042\u308a\u306e\u7d50\u679c\n- \u7e26\u8ef8\u306f\u5b9f\u884c\u6642\u9593(```ms```)\u306a\u306e\u3067\u77ed\u3044\u307b\u3069\u9ad8\u901f\u306a\u3053\u3068\u3092\u8868\u3059\n\n# \uff08\u8ffd\u8a18\uff09\u6b21\u5143\u6570\u3067\u306e\u6b63\u898f\u5316\n- [ambee_whisper\u3055\u3093](https://twitter.com/ambee_whisper/)\u306b[\u6307\u6458\u3055\u308c\u307e\u3057\u305f](https://twitter.com/ambee_whisper/status/805797762872668161)\u304c\u3001\u3053\u306e\u8a55\u4fa1\u3067\u306fL1\u3068L2\u306f8bit/dimension\u3001hamming\u3067\u306f1bit/dimension\u3067\u3042\u308a\u307e\u3059\n- \u3064\u307e\u308a\u3001time/dimension \u3067\u6bd4\u8f03\u3059\u308b\u306e\u304c\u30d5\u30a7\u30a2\u3067\u306f\u306a\u3044\u304b\u3068\u3044\u3046\u6307\u6458\u3067\u3059\n- \u3054\u6307\u6458\u306f\u3082\u3063\u3068\u3082\u3067\u3001\u4ee5\u4e0b\u306b\u7d50\u679c\u3092\u307e\u3068\u3081\u305f\u8868\u3092\u518d\u63b2\u3002\u5358\u4f4d\u306f```ms/dimension```\n- L2/L1\u306f8bit/dimension\u306a\u306e\u3067\u3001128\u3067\u5272\u3063\u305f\u5024\u3092\u3001hamming\u306f1024\u6b21\u5143\u306a\u306e\u30671024\u3067\u5272\u3063\u305f\u5024\u306b\u306a\u3063\u3066\u3044\u307e\u3059\n\nplatform|method|w/o SIMD|w/ SIMD\n------|--------|--------|--------\nRaspberry Pi 3|L2|3.765625|3.2734375\nRaspberry Pi 3|L1|3.4609375|2.1484375\nRaspberry Pi 3|hamming|1.224609375|0.272460938\nJetson TK1|L2|3.3671875|3.0703125\nJetson TK1|L1|3.5546875|1.546875\nJetson TK1|hamming|1.083007813|0.1796875\nJetson TX1|L2|2.125|3.84375\nJetson TX1|L1|2.6171875|1.1953125\nJetson TX1|hamming|0.4140625|0.197265625\nODROID-C2 |L2|4.34375|7.2421875\nODROID-C2 |L1|4.46875|2.8203125\nODROID-C2 |hamming|0.622070313|0.518554688\nODROID-X2 |L2|7.984375|6.65625\nODROID-X2 |L1|6.578125|4.1875\nODROID-X2 |hamming|1.87109375|0.552734375\n![normalized_plot.png](https://qiita-image-store.s3.amazonaws.com/0/12162/a9fa0497-125d-4079-8cf6-8b88ff47c3e9.png)\n- \u6587\u5b57\u304c\u6f70\u308c\u3066\u308b\u306e\u3067\u3001\u5de6\u304b\u3089Raspberry Pi3\u306eL2\u2192L1\u2192hamming\u3001Jetson TK1\u3001Jetson TX1\u3001ODROID-C2\u3001ODROID-X2\u306e\u9806\n- \u8d64\u7dda\u304cSIMD\u7121\u3057\u3001\u7dd1\u8272\u306e\u7bb1\u578b\u30b0\u30e9\u30d5\u304cSIMD\u3042\u308a\u306e\u7d50\u679c\n\n\n# \u7d50\u679c\u3092\u773a\u3081\u3066\u898b\u3066\uff08\u3082\u308d\u3082\u308d\u8ffd\u8a18/\u524a\u9664\uff09\n- \u6982\u306d\u3001```SSE```\u7248\u3068\u4f3c\u305f\u50be\u5411\u304c\u51fa\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3001\u6b63\u898f\u5316\u3057\u305f\u7d50\u679c\u306fhamming\u5727\u52dd\u3067\u3059\u3002\n  - hamming\u3068L1\u306e\u8a08\u7b97\u6642\u9593\u81ea\u4f53\u306f\u304b\u306a\u308a\u63a5\u6226\u306a\u306e\u3067\u3059\u304c\u3001hamming\u306f8\u500d\u306e\u6b21\u5143\u6570\u3092\u6271\u3063\u3066\u308b\u306e\u3067\u3001\u7d50\u679c**hamming**\u306e\u5727\u52dd\u3067\u3059\n- ~~\u3057\u304b\u3057\u3001\u3088\u304f\u898b\u308b\u3068**32bit OS\u304c\u4e57\u3063\u305fARM\u3067\u306fhamming\u304c\u6700\u901f\u3001\u3082\u3057\u304f\u306fL1\u3068\u63a5\u6226**\u3092\u7e70\u308a\u5e83\u3052\u3066\u3044\u307e\u3059~~\n - ~~Raspberry Pi 3 275ms(L1) VS 279ms(hamming)~~\n - ~~Jetson TK1 198ms(L1) VS 184ms(hamming)~~\n - ~~ODROID-X2 536ms(L1) VS 566ms(hamming)~~\n - ~~\u3053\u3061\u3089\u306e\u30dc\u30fc\u30c9\u306f\u3044\u305a\u308c\u3082\u308232bit OS\u3067\u3059\u3002(Raspberry Pi 3 \u306eCortex A53\u306f64bit\u5bfe\u5fdc\u3060\u304c\u3001OS\u306eRaspbian\u306f32bit)~~\n - ~~hamming\u3082\u3001L1\u3067\u3082\u3001\u7d50\u679c\u306f8bit\u5358\u4f4d16\u8981\u7d20\u3067\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u7dcf\u548c\u3092\u6c42\u3081\u308b\u305f\u3081\u306breduction\u306e\u5fc5\u8981\u304c\u3042\u308a\u3001\u305d\u3053\u306e\u30b3\u30b9\u30c8\u306fhamming\u3082L1\u3082\u540c\u7b49\u306b\u601d\u3048\u307e\u3059~~\n - ~~\u3068\u3059\u308b\u3068\u3001ARM\u306e ```popcount```(```VCNTQ```)\u547d\u4ee4\u306f```abs diff```(```ABDQ```)\u547d\u4ee4\u3068\u540c\u7b49\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u6301\u3063\u3066\u3044\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093~~\n- 32bit OS\u3067\u306f**SIMD\u7121\u3057\u7248\u306ehamming\u304c\u7570\u69d8\u306b\u9045\u304f\u3001SIMD\u5316\u3057\u3066\u4e00\u6c17\u306b\u9ad8\u901f\u5316\u3055\u308c\u3066\u3044\u308b**\u306e\u3082\u6c17\u306b\u306a\u308a\u307e\u3059\n - \u3053\u3053\u306e\u5b9f\u88c5\u306f```x86```\u5411\u3051\u306e\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u6d41\u7528\u306a\u306e\u3067\u3001SIMD\u7121\u3057\u306e\u66f8\u304d\u65b9\u306f\u3082\u3046\u5c11\u3057\u5de5\u592b\u306e\u4f59\u5730\u304c\u3042\u308a\u305d\u3046\u3067\u3059\n- 64bit OS\u4e0a\u3067\u306eL2\u8ddd\u96e2\u304c\u306a\u3093\u3068**SIMD\u7121\u3057\u306e\u65b9\u304c\u901f\u3044\u3068\u3044\u3046\u5c48\u8fb1**\n - Jetson TX1 272ms(SIMD\u7121\u3057) VS 492ms (SIMD\u3042\u308a)\n - ODROID-C2 556ms(SIMD\u7121\u3057) VS 927ms (SIMD\u3042\u308a)\n - **\u99ac\u9e7f\u306a\uff01\u30aa\u30fc\u30c8\u30d9\u30af\u30bf\u30e9\u30a4\u30ba\u306e\u65b9\u304c\u9ad8\u901f\u3060\u3068\u3063\uff01\uff1f**\n - \u7d50\u69cb\u5c48\u8fb1\u3002\u3055\u3089\u3063\u3068\u30a2\u30bb\u30f3\u30d6\u30ea\u3092\u773a\u3081\u305f\u611f\u3058\u3001\u30eb\u30fc\u30d7\u30a2\u30f3\u30ed\u30fc\u30eb\u3055\u308c\u3066\u3044\u3066\u3001\u305d\u308c\u304c\u52b9\u3044\u3066\u3044\u308b\u69d8\u306b\u3082\u898b\u3048\u308b\u3002\n - \u3057\u304b\u3057\u7d30\u304b\u3044\u691c\u8a3c\u306f\u3057\u3066\u307e\u305b\u3093\n- ~~Jetson TX1\u3001ODROID-C2\u3001\u3068\u3082\u306b**L1\u306e\u65b9\u304c\u9ad8\u901f**\u3067\u3059\u3002~~\n- ~~64bit OS\u3067\u306e\u7d50\u679c\u306f\u3001L1\u306e\u65b9\u304chamming\u3088\u308a\u6709\u610f\u306a\u5dee\u3092\u6301\u3063\u3066\u9ad8\u901f\u306a\u7d50\u679c\u3068\u306a\u308a\u307e\u3057\u305f(```SSE```\u3068\u540c\u69d8\u306e\u50be\u5411)~~\n - ~~\u3053\u3053\u304c\u6700\u5927\u306e\u8b0e\u3002Raspberry Pi 3\u306fCortex A53\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u306e\u3067\u3001\u6c7a\u3057\u306664bit ARM\u304c\u9045\u3044\u3068\u3044\u3046\u8a33\u3067\u306f\u306a\u304f\u300164bit OS\u3067\u5b9f\u884c\u3059\u308b\u3068hamming\u3068L1\u306b\u6709\u610f\u306a\u5dee\u304c\u73fe\u308c\u307e\u3059~~\n - ~~\u305d\u306e\u3046\u306164bit \u306eRaspbian \u3068\u304b\u304c\u51fa\u305f\u3089\uff08\u3082\u3046\u51fa\u3066\u308b\uff1f\uff0932bit/64bit\u306e\u6bd4\u8f03\u3068\u304b\u3057\u3066\u307f\u308b\u3068\u9762\u767d\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\uff08\u305d\u3053\u307e\u3067\u624b\u304c\u56de\u308a\u307e\u305b\u3093\u3067\u3057\u305f\uff09~~\n- 64bit \u3067\u3082\u3001ms/dimension\u306e\u7d50\u679c\u3067\u306fhamming \u304c\u6700\u901f\u3068\u306a\u308a\u307e\u3057\u305f\n- \u306a\u304a\u3001\u5404CPU\u306f\u30d9\u30fc\u30b9\u30af\u30ed\u30c3\u30af\u3082\u30de\u30c1\u30de\u30c1\u306a\u306e\u3067\u3001\u30dc\u30fc\u30c9\u9593\u306e\u6bd4\u8f03\u306f\u4f59\u308a\u610f\u5473\u304c\u7121\u3044\u3068\u601d\u3044\u307e\u3059\n\n# OpenCV\u3067\u306e\u4f7f\u3044\u65b9\n- \u3053\u308c\u3060\u3051\u3060\u3068OpenCV advent calendar \u306bOpenCV\u629c\u304d\u306a\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u3057\u307e\u3046\u306e\u3067\u3001OpenCV\u306b\u307e\u3064\u308f\u308b\u60c5\u5831\u3092\u4f55\u304b\u66f8\u3044\u3066\u304a\u304d\u307e\u3057\u3087\u3046\n- OpenCV\u306b\u306f\u3001```cv::normHamming```\u3068\u3044\u3046Hamming\u8ddd\u96e2\u3092\u6c42\u3081\u3066\u304f\u308c\u308b\u95a2\u6570\u304c\u3042\u308a\u307e\u3059\n\n```cpp:stat.cpp\nint normHamming(const uchar* a, int n)\n{\n    int i = 0;\n    int result = 0;\n#if CV_NEON\n    {\n        uint32x4_t bits = vmovq_n_u32(0);\n        for (; i <= n - 16; i += 16) {\n            uint8x16_t A_vec = vld1q_u8 (a + i);\n            uint8x16_t bitsSet = vcntq_u8 (A_vec);\n            uint16x8_t bitSet8 = vpaddlq_u8 (bitsSet);\n            uint32x4_t bitSet4 = vpaddlq_u16 (bitSet8);\n            bits = vaddq_u32(bits, bitSet4);\n        }\n        uint64x2_t bitSet2 = vpaddlq_u32 (bits);\n        result = vgetq_lane_s32 (vreinterpretq_s32_u64(bitSet2),0);\n        result += vgetq_lane_s32 (vreinterpretq_s32_u64(bitSet2),2);\n    }\n#elif CV_AVX2\n    {\n        __m256i _r0 = _mm256_setzero_si256();\n        __m256i _0 = _mm256_setzero_si256();\n        __m256i _popcnt_table = _mm256_setr_epi8(0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4,\n                                                 0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4);\n        __m256i _popcnt_mask = _mm256_set1_epi8(0x0F);\n\n        for(; i <= n - 32; i+= 32)\n        {\n            __m256i _a0 = _mm256_loadu_si256((const __m256i*)(a + i));\n\n            __m256i _popc0 = _mm256_shuffle_epi8(_popcnt_table, _mm256_and_si256(_a0, _popcnt_mask));\n            __m256i _popc1 = _mm256_shuffle_epi8(_popcnt_table,\n                             _mm256_and_si256(_mm256_srli_epi16(_a0, 4), _popcnt_mask));\n\n            _r0 = _mm256_add_epi32(_r0, _mm256_sad_epu8(_0, _mm256_add_epi8(_popc0, _popc1)));\n        }\n        _r0 = _mm256_add_epi32(_r0, _mm256_shuffle_epi32(_r0, 2));\n        result = _mm256_extract_epi32_(_mm256_add_epi32(_r0, _mm256_permute2x128_si256(_r0, _r0, 1)), 0);\n    }\n#endif\n    for( ; i <= n - 4; i += 4 )\n        result += popCountTable[a[i]] + popCountTable[a[i+1]] +\n        popCountTable[a[i+2]] + popCountTable[a[i+3]];\n    for( ; i < n; i++ )\n        result += popCountTable[a[i]];\n    return result;\n}\n``` \n- \u5185\u90e8\u7684\u306b\u306f\u3001```CV_NEON```\u3068```CV_AVX2```\u306e\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n - [\u6628\u65e5\u66f8\u3044\u305fUniversal Intrinsics] (http://qiita.com/tomoaki_teshima/items/8195c25a3f0448ce300b) \u304c\u4f7f\u308f\u308c\u3066\u306a\u3044\u306e\u3067\u3001PR\u30c1\u30e3\u30f3\u30b9\u3067\u3042\u308b\u3053\u3068\u306b\u4eca\u6c17\u304c\u4ed8\u304d\u307e\u3057\u305f\u3002\u3075\u3080\u3075\u3080\n - \u3068\u601d\u3063\u3066PR\u306b\u7740\u624b\u3057\u305f\u3082\u306e\u306e\u3001Universal Intrinsic\u306f```SSE2```\u307e\u3067\u306e\u7e1b\u308a\u30d7\u30ec\u30a4\u306a\u4e0a\u306b\u3001```popcount```\u306fSSE4.2\u4ee5\u964d\u306e\u5bfe\u5fdc\u306a\u306e\u3067\u3001\u76f8\u5f53\u306a\u7e1b\u308a\u30d7\u30ec\u30a4\u306b\u3002\n - \u8ab0\u5f97\u306aPR\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3069\u3046\u3057\u305f\u3082\u306e\u304b\n- \u305d\u3082\u305d\u3082\u3001```x86```\u3067\u306f\u3001```AVX2```\u3067\u3057\u304bintrinsic\u304c\u4f7f\u308f\u308c\u3066\u306a\u3044\u306e\u3067\u3001```AVX```\u307e\u3067\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u306a\u3044\u79c1\u306eMBP\u3060\u3068\u305d\u3082\u305d\u3082```SIMD```\u306e\u6069\u6075\u3092\u53d7\u3051\u3089\u308c\u306a\u3044\u3068\u306f\uff01\n- ~~\u304c\u3063\u304b\u308a\u3067\u3059\u3002\u3002\u3002~~\n- (\u8ffd\u8a18:)\u304c\u3063\u304b\u308a\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001```SSE2```\u3067```popcount```\u3057\u305f[PR\u3092\u6295\u3052\u3066\u307f\u307e\u3057\u305f](https://github.com/opencv/opencv/pull/7863)\n- (\u8ffd\u8a18:)\u9858\u308f\u304f\u30703.2\u306e\u30ea\u30ea\u30fc\u30b9\u306b\u542b\u307e\u308c\u308c\u3070\u3001\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001RC\u304c\u51fa\u305f\u5f8c\u306f\u65b0\u898f\u6a5f\u80fd\u8ffd\u52a0\u306e\u30de\u30fc\u30b8\u306f\u3057\u3066\u304f\u308c\u306a\u3044\u3088\u3046\u3067\u3001\u3042\u3063\u3055\u308a3.2\u306b\u306f\u542b\u3081\u3066\u3082\u3089\u3048\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n- (\u8ffd\u8a18:)PR\u304b\u3089\u4e00\u30f6\u6708\u7d4c\u3063\u3066\u3001[\u3088\u3046\u3084\u304f\u30de\u30fc\u30b8\u3055\u308c\u307e\u3057\u305f\uff01](https://github.com/opencv/opencv/pull/7863)\u3002\u7d50\u5c40```SSE2```\u756a\u3068```SSE4.1```\u7248\u3092commit\u3057\u307e\u3057\u305f\n\n\n# \u304a\u308f\u308a\u306b\n- \u5148\u65e5\u3070\u3063\u305f\u308a\u3001wosugi\u6c0f\u306b\u304a\u4f1a\u3044\u3057\u3066\u3001\u305f\u307e\u305f\u307e\u3053\u306epopcount\u306e\u8a71\u3067\u76db\u308a\u4e0a\u304c\u3063\u305f\u306e\u3067\u3001Advent Calendar \u306b\u4ed5\u7acb\u3066\u4e0a\u3052\u3066\u307f\u307e\u3057\u305f\u3002\n- ~~32bit\u7248\u306eARM\u3067\u306fhamming\u8ddd\u96e2\u306fL1\u8ddd\u96e2\u3068\u540c\u7b49\u306e\u6027\u80fd\u3092\u793a\u3057\u307e\u3059\u304c\u300164bit\u7248\u3067\u306f\u307e\u3060L1\u306b\u5206\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002~~\n- 32bit\u7248\u306eARM\u3067\u306f\u8a08\u7b97\u6642\u9593\u81ea\u4f53\u306fL1\u3068hamming\u3068\u3067\u540c\u7b49\u306e\u6027\u80fd\u3092\u793a\u3057\u307e\u3059\u304c\u3001\u6b63\u898f\u5316\u3057\u305f\u7d50\u679c\u3067\u306f32bit\u7248/64bit\u7248\u306eARM\u3068\u3082\u306bhamming\u5727\u52dd\u3067\u3057\u305f\u3002\n- popcount\u306b\u5e78\u3042\u308c\n- NEON\u3068SSE\u3092\u7dcf\u3058\u3066\u898b\u308b\u3068\u3001```_mm_popcnt_u64```\u3060\u3051\u304c\u30a4\u30b1\u3066\u306a\u3044\u3001\u3068\u3044\u3046\u6c17\u304c\u3059\u308b\u3002\n- \u660e\u65e5\u306f[TaroYamada](http://qiita.com/TaroYamada) \u3055\u3093\u306e\u8a18\u4e8b\u3067\u3059\u3002\u304a\u697d\u3057\u307f\u306b\uff01\n\n# \u88dc\u8db3\n- OpenCV (git\u7248\u30ea\u30d3\u30b8\u30e7\u30f3ecb8fb964d)\n- ARM\u306e\u30dc\u30fc\u30c9\u306e\u8a73\u7d30\u306f\u6587\u4e2d\u306b\n\n", "tags": ["OpenCV", "ARM", "neon", "popcount"]}