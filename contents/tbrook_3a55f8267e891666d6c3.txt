{"context": "\n\n\u307e\u305a\u306f\u6328\u62f6\nQiita \u306b\u521d\u6295\u7a3f\u3067\u3059\u3002\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002\n\n\u30b5\u30b9\u30da\u30f3\u30c9\u304c\u51fa\u6765\u306a\u3044\n\u3042\u308b\u6642 Ubuntu \u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5f8c\u306e\u74b0\u5883\u306f\n$ lsb_release -d -r\nDescription:    Ubuntu 14.04.5 LTS\nRelease:        14.04\n\n\u3067\u3059\u3002\n\u3055\u3066\u3001\u5bdd\u3088\u3046\u3068 PC \u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3092\u3057\u305f\u306e\u3067\u3059\u304c\u3059\u3050\u306b\u8d77\u304d\u4e0a\u304c\u308a\u307e\u3059\u3002\u4f55\u304b\u30ad\u30fc\u30dc\u30fc\u30c8\u3092\u62bc\u3057\u305f\u304b\u306a\uff1f \u3068\u3001\u307e\u305f\u30b5\u30b9\u30da\u30f3\u30c9\u3092\u3057\u305f\u306e\u3067\u3059\u304c\u3059\u3050\u306b\u8d77\u304d\u4e0a\u304c\u308a\u307e\u3059\u3002\u5bdd\u308c\u307e\u305b\u3093\u3002(\u3046\u305d\u3002\u5bdd\u307e\u3057\u305f) \u8abf\u3079\u307e\u3059\u3002\u3044\u308d\u3044\u308d\u691c\u7d22\u306b\u639b\u304b\u308a\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u304c ArchWiki \u306b\u66f8\u3044\u3066\u3042\u308b\u89e3\u6c7a\u7b56\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\u66f0\u304f\u3001 /proc/acpi/wakeup \u306e\nLID0 \u4ee5\u5916\u3092 disabled \u306b\u3057\u306a\u3055\u3044\u3002\u4ee5\u4e0b\u306e\u69d8\u306b\u3002\n# echo XHC1 > /proc/acpi/wakeup\n\n\u3001\u3001\u3001\u3048\u3063\uff1f \u4f55\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u306a\u306e\uff1f \u307e\u3001\u307e\u3042 \u7d20\u76f4\u306b\u5f93\u3044\u307e\u3059\u3002\n$ cat /proc/acpi/wakeup\nDevice  S-state   Status   Sysfs node\nUAR1      S4    *disabled  pnp:00:0b\nUSB1      S3    *disabled\nRP01      S4    *disabled  pci:0000:00:1c.0\nRP03      S4    *disabled  pci:0000:00:1c.2\nBR40      S4    *disabled  pci:0000:02:00.0\nRP04      S4    *disabled  pci:0000:00:1c.3\nGLAN      S4    *disabled\nEHC1      S4    *enabled   pci:0000:00:1d.0\nEHC2      S4    *enabled   pci:0000:00:1a.0\nXHC       S4    *enabled   pci:0000:00:14.0\nHDEF      S4    *disabled  pci:0000:00:1b.0\nPEG0      S4    *disabled\nPEGP      S4    *disabled\nPEG1      S4    *disabled\nPEG2      S4    *disabled\n\n(\u4e0a\u8a18\u306e wakeup \u306e\u5185\u5bb9\u306f\u30b5\u30b9\u30da\u30f3\u30c9\u304c\u52b9\u304b\u306a\u3044\u72b6\u6cc1\u3068\u306f\u82e5\u5e72\u9055\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u89e3\u6c7a\u3057\u3066\u304b\u3089\u307e\u305f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u306e\u3067\u3002\u5927\u7b4b\u3068\u3044\u3046\u3053\u3068\u3067)\n\u81ea\u5206\u306e\u74b0\u5883\u3060\u3068 EHC1 \u3068 EHC2 \u3068 XHC \u3092 disabled \u306b\u3059\u308c\u3070\u3044\u3044\u306e\u3060\u306a\u3002\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n$ sudo sh -c \"echo EHC2 > /proc/acpi/wakeup\"\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup\nDevice  S-state   Status   Sysfs node\nUAR1      S4    *disabled  pnp:00:0b\nUSB1      S3    *disabled\nRP01      S4    *disabled  pci:0000:00:1c.0\nRP03      S4    *disabled  pci:0000:00:1c.2\nBR40      S4    *disabled  pci:0000:02:00.0\nRP04      S4    *disabled  pci:0000:00:1c.3\nGLAN      S4    *disabled\nEHC1      S4    *disabled  pci:0000:00:1d.0\nEHC2      S4    *disabled  pci:0000:00:1a.0\nXHC       S4    *disabled  pci:0000:00:14.0\nHDEF      S4    *disabled  pci:0000:00:1b.0\nPEG0      S4    *disabled\nPEGP      S4    *disabled\nPEG1      S4    *disabled\nPEG2      S4    *disabled\n\n\u30b5\u30b9\u30da\u30f3\u30c9\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u3002\u304c\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u984c\u306f\u305d\u3053\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4e3b\u984c\u306f\n\u306a\u305c \u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u3088\u308b /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3067\u7d50\u679c\u304c\u5185\u5bb9\u3068\u9055\u3046\u306e\u304b \n\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\n/proc/acpi/wakeup \u306b\u66f8\u304d\u8fbc\u3080\u3068\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\uff1f\n\u4e0a\u8ff0\u306e\u51fa\u529b\u3092\u898b\u308c\u3070\u5206\u304b\u308b\u3088\u3046\u306b /proc/acpi/wakeup \u306f\u8907\u6570\u884c\u3067\u3059\u3002\u666e\u901a\u306f echo EHC1 > /proc/acpi/wakeup\u306f 1\u884c\u306b\u306a\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n  /proc\u4e0b\u306f \u4eee\u60f3\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0(procfs)\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3001\u30ab\u30fc\u30cd\u30eb\u306b\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5f79\u5272\u3092\u6301\u3064\u3002\u9010\u6b21\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n\n\u3057\u304b\u3057\u3053\u308c\u306f \u524d\u8ff0\u306e\u4f8b\u3067 1\u884c\u306b\u306a\u3089\u306a\u3044\u8aac\u660e\u306b\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n\n  \u60f3\u50cf\u3060\u304c\u3001wakeup \u3092\u6271\u3063\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u304c \u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u306e\u64cd\u4f5c\u3067\u6587\u5b57\u5217\u3092\u53d7\u3051\u5185\u5bb9\u3092\u89e3\u91c8\u3057\u3001wakeup\u30d5\u30a1\u30a4\u30eb\u3092\u9010\u6b21\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n\n\u3053\u308c\u307e\u305f \u307c\u3093\u3084\u308a\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u5bb9\u3092\u89e3\u91c8\u3063\u3066\u5177\u4f53\u7684\u306b\u306f\u306a\u3093\u3060\u308d\u3046\uff1f\n\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u5177\u4f53\u7684\u306b\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nstrace \u3067\u78ba\u8a8d\nstrace \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002 strace \u306f\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3084\u30b7\u30b0\u30ca\u30eb\u3092\u76e3\u8996\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u307e\u305a\u306f EHC1 \u3092 enabled \u306b\u3057\u3066\n$ sudo sh -c \"echo EHC1=enabled > /proc/acpi/wakeup\" \n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n\u3001\u3001\u3001\u5b9f\u306f\u3053\u306e\u5b9f\u884c\u306e\u8a8d\u8b58\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u4e8b\u3092\u5f8c\u3067\u6c17\u4ed8\u304f\u306e\u3067\u3059\u304c\u3002\n\u305d\u3057\u3066 strace \u3002(\u306a\u306e\u3060\u304c\u3001\u3061\u3087\u3063\u3068\u9577\u3044\u4e0a\u306b getcwd(\"/home/xxx\" \u2026 \u306f\u307e\u305a\u3044\u306e\u3067)\n$ sudo -p \"sudo> \" test\nsudo> \n\n$ sudo strace sh -c \"echo EHC1 > /proc/acpi/wakeup\" 2> strace_write_ehc1_to_wakeup.txt\n\n## strace \u306e\u51fa\u529b\u884c\u6570\n$ wc -l strace_write_ehc1_to_wakeup.txt \n50 strace_write_ehc1_to_wakeup.txt\n\n## head -10\n$ head -10 strace_write_ehc1_to_wakeup.txt\nexecve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /proc/acpi/wakeup\"], [/* 18 vars */]) = 0\nbrk(0)                                  = 0x7f03e785b000\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f03e6ed7000\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/etc/ld.so.cache\", O_RDONLY|O_CLOEXEC) = 3\nfstat(3, {st_mode=S_IFREG|0644, st_size=106703, ...}) = 0\nmmap(NULL, 106703, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f03e6ebc000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\n\n## tail -10\n$ tail -10 strace_write_ehc1_to_wakeup.txt\nclose(1)                                = 0\nfcntl(10, F_SETFD, FD_CLOEXEC)          = 0\ndup2(3, 1)                              = 1\nclose(3)                                = 0\nwrite(1, \"EHC1\\n\", 5)                   = 4\nwrite(1, \"\\n\", 1)                       = 1\ndup2(10, 1)                             = 1\nclose(10)                               = 0\nexit_group(0)                           = ?\n+++ exited with 0 +++\n\n## \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u306e\u5c65\u6b74\n$ cat strace_write_ehc1_to_wakeup.txt | cut -s -d \\( -f 1 |paste -d, - - - - - \nexecve,brk,access,mmap,access\nopen,fstat,mmap,close,access\nopen,read,fstat,mmap,mprotect\nmmap,mmap,close,mmap,mmap\narch_prctl,mprotect,mprotect,mprotect,munmap\ngetpid,rt_sigaction,geteuid,brk,brk\ngetppid,getcwd,rt_sigaction,rt_sigaction,rt_sigaction\nrt_sigaction,rt_sigaction,rt_sigaction,open,fcntl\nclose,fcntl,dup2,close,write\nwrite,dup2,close,exit_group,\n\n\u304a\u305d\u3089\u304f tail \u306e\u51fa\u529b\u306b\u73fe\u308c\u3066\u3044\u308b write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u304c /proc/acpi/wakeup\u3078\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306e\u5b9f\u614b\u3067\u3057\u3087\u3046\u3002\u3057\u304b\u3057\u3053\u308c\u3060\u3051\u3067\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u3002\n\u305d\u3053\u3067 /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068 /dev/null \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068\u306e strace \u306e\n\u51fa\u529b\u306e\u6bd4\u8f03\u3092\u3057\u3066\u307f\u307e\u3059\u3002\u3068\u3001\u305d\u306e\u524d\u306b strace \u306e\u51fa\u529b\u3067 0x7f03e785b000 \u306a\u3069\u306e0x(16\u9032\u657012\u6841) \u306e\u6587\u5b57\u5217\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u30a2\u30c9\u30ec\u30b9\u306a\u306e\u3067 0xzzzz \u306b\u7f6e\u63db\u3057\u3066\u6bd4\u8f03\u3057\u307e\u3059\u3002\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ diff -U0 \\\n<(sudo strace sh -c \"echo EHC1 > /dev/null\"         2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g') \\\n<(sudo strace sh -c \"echo EHC1 > /proc/acpi/wakeup\" 2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g')\n--- /proc/self/fd/11    2016-09-28 18:44:26.882716060 +0900\n+++ /proc/self/fd/13    2016-09-28 18:44:26.883716065 +0900\n@@ -1 +1 @@\n-execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /dev/null\"], [/* 18 vars */]) = 0\n+execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /proc/acpi/wakeup\"], [/* 18 vars */]) = 0\n@@ -26 +26 @@\n-getpid()                                = 30419\n+getpid()                                = 30421\n@@ -31 +31 @@\n-getppid()                               = 30414\n+getppid()                               = 30415\n@@ -39 +39 @@\n-open(\"/dev/null\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n+open(\"/proc/acpi/wakeup\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n@@ -45 +45,2 @@\n-write(1, \"EHC1\\n\", 5)                   = 5\n+write(1, \"EHC1\\n\", 5)                   = 4\n+write(1, \"\\n\", 1)                       = 1\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u304b\u3089 \u6587\u5b57\u5217 \"EHC1\\n\" \u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306f\u3001\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u3063\u3066write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u3092\n\n /dev/null(\u901a\u5e38\u30d5\u30a1\u30a4\u30eb\u3082\u304b): 5\u30d0\u30a4\u30c8\u3092\u4e00\u6c17\u306b\u51e6\u7406\n /proc/acpi/wakeup: 4\u30d0\u30a4\u30c8\u51e6\u7406(\u8fd4\u308a\u50241) \u3057\u305f\u5f8c\u3001\u6b8b\u308a\u306e 1\u30d0\u30a4\u30c8\u3092\u51e6\u7406\n\n\u3068\u3044\u3046\u69d8\u306b\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\u3055\u3066\u3001\u3053\u3046\u306a\u308b\u3068\u9577\u3044\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3093\u3060\u6642\u3069\u3046\u306a\u308b\u306e\u304b\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3076\u3093 /proc/acpi/wakeup \u306b\u306f\u4f55\u3092\u66f8\u304d\u8fbc\u3093\u3067\u3082\u3044\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\u305d\u3053\u3067 \u6587\u5b57\u5217 euu45678901234567890 \u3092\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n$ diff -U0 \\\n<(sudo strace sh -c \"echo euu45678901234567890 > /dev/null\"         2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g') \\\n<(sudo strace sh -c \"echo euu45678901234567890 > /proc/acpi/wakeup\" 2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g')\n--- /proc/self/fd/11    2016-09-28 20:57:35.643468246 +0900\n+++ /proc/self/fd/13    2016-09-28 20:57:35.643468246 +0900\n@@ -1 +1 @@\n-execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo euu45678901234567890 > /dev\"...], [/* 18 vars */]) = 0\n+execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo euu45678901234567890 > /pro\"...], [/* 18 vars */]) = 0\n@@ -26 +26 @@\n-getpid()                                = 31593\n+getpid()                                = 31590\n@@ -31 +31 @@\n-getppid()                               = 31586\n+getppid()                               = 31587\n@@ -39 +39 @@\n-open(\"/dev/null\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n+open(\"/proc/acpi/wakeup\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n@@ -45 +45,6 @@\n-write(1, \"euu45678901234567890\\n\", 21)  = 21\n+write(1, \"euu45678901234567890\\n\", 21)  = 4\n+write(1, \"5678901234567890\\n\", 17)      = 4\n+write(1, \"901234567890\\n\", 13)          = 4\n+write(1, \"34567890\\n\", 9)               = 4\n+write(1, \"7890\\n\", 5)                   = 4\n+write(1, \"\\n\", 1)                       = 1\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u304b\u3089 \u6587\u5b57\u5217\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306f\u3001\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u3063\u3066 write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u3092\n\n /dev/null(\u901a\u5e38\u30d5\u30a1\u30a4\u30eb\u3082\u304b): \u6587\u5b57\u5217\u3092\u4e00\u6c17\u306b(\u30ea\u30df\u30c3\u30c8\u3042\u308a1)\u51e6\u7406\n /proc/acpi/wakeup: 4\u30d0\u30a4\u30c8\u305a\u3064\u51e6\u7406\n\n\u3068\u3044\u3046\u69d8\u306b\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n/proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306e\u5b9f\u969b\n\u5148\u7a0b\u3001\u5b9f\u884c\u306e\u8a8d\u8b58\u304c\u9593\u9055\u3063\u3066\u3044\u305f\u3001\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\necho EHC1 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\nEHC1 \u306e\u72b6\u614b: enabled  ->  disabled\n\necho EHC1=disabled \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1=disabled > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled\n\u3088\u3063\u3066 XXX=disabled \u5f62\u5f0f\u306e\u8a2d\u5b9a\u306f\u7121\u52b9\n\necho EHC1=1 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1=1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\nEHC1 \u306e\u72b6\u614b: enabled  ->  disabled\n\u3088\u3063\u3066 XXX=1 \u5f62\u5f0f\u306e\u8a2d\u5b9a\u306f\u7121\u52b9\n\necho EHC1 \u3092\u9023\u7d9a\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled  ->  disabled\n\u30c8\u30b0\u30eb\u51e6\u7406 \u306b\u306a\u308b\n\necho EHC123 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC123 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC\" \nEHC1      S4    *enabled   pci:0000:00:1d.0\nEHC2      S4    *disabled  pci:0000:00:1a.0\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled\n\u5909\u6570 EHC1 \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068\u89e3\u91c8\u3055\u308c\u308b\u3002EHC123 \u3068\u3044\u3046\u5909\u6570\u304c\u51fa\u6765\u308b\u308f\u3051\u3067\u306f\u306a\u3044\n\necho XHC \u3092\u9023\u7d9a\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\" \n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *enabled   pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\nXHC \u306e\u72b6\u614b: disabled  ->  enabled  ->  disabled\n\u30c8\u30b0\u30eb\u51e6\u7406 \u306b\u306a\u308b\n\necho XHC5, echo XHC56 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC5 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC56 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\nXHC \u306e\u72b6\u614b: disabled -> disabled  ->  disabled\nXHC5, XHC56 \u306e\u69d8\u306b \u6700\u521d\u306e 3\u30d0\u30a4\u30c8\u304c XHC \u3067\u3082 \u5909\u6570 XHC \u3068\u89e3\u91c8\u3057\u306a\u3044\n\necho XHC 0 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC 0 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *enabled   pci:0000:00:14.0\n\nXHC \u306e\u72b6\u614b: disabled  ->  enabled\n\u6700\u521d\u306e 4\u30d0\u30a4\u30c8 \u304c \"XHC \" (\u3053\u306e\u5834\u5408\u6700\u5f8c\u306e1\u30d0\u30a4\u30c8\u306f\u30b9\u30da\u30fc\u30b9) \u306e\u6642 \u5909\u6570\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b\u306e\u3060\u308d\u3046\n\n/proc/acpi/wakeup \u306b\u66f8\u304d\u8fbc\u3080\u3068\u306f\n\u4ee5\u4e0a\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u6642\u306e\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3084\u66f8\u304d\u8fbc\u307f\u4f8b\u304b\u3089\u63a8\u5bdf\u3059\u308b\u3068\u3001 /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001 EHC1=enabled \u3068\u3044\u3063\u305f\u69d8\u306b\u5024\u3092\u6307\u5b9a\u51fa\u6765\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u5358\u306b\n\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u9001\u308b\u6587\u5b57\u5217\u306e\u6700\u521d\u306e4\u30d0\u30a4\u30c8\u304c /proc/acpi/wakeup \u5185\u306e\u5909\u6570\u3067\u3042\u3063\u305f\u6642\u3001\u305d\u306e\u5909\u6570\u306e\u30c8\u30b0\u30eb\u51e6\u7406\u304c\u884c\u308f\u308c\u308b \n\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n/proc \u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b echo 1, echo 0 \u3068\u304b\u3092\u30ea\u30c0\u30a4\u30af\u30ec\u30c8\u3059\u308b\u306e\u306f\u3088\u304f\u3084\u308a\u307e\u3059\u304c\u3001\u3053\u306e wakeup\u30d5\u30a1\u30a4\u30eb \u306e\u69d8\u306a\u3001\u6700\u521d\u306e4\u30d0\u30a4\u30c8\u3060\u3051\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30a1\u30a4\u30eb\u3082\u3042\u308b \u3063\u3066\u306e\u306f\u5e38\u8b58\u306a\u306e\u3060\u308d\u3046\u304b\uff1f\n\nwakeup \u306e\u4ed6\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\u3053\u3061\u3089\u306e\u8a18\u4e8b \u306e\u69d8\u306a\u624b\u9806\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\u307e\u305a\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n\u3068 pci:0000:00:1d.0 \u306a\u306e\u3067 /sys/bus/pci/devices/0000:00:1d.0/power/wakeup \n\u3092\u8aad\u307f\u307e\u3059\u3002\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\nenabled\n\n/proc/acpi/wakeup \u306e EHC1 \u3068\u540c\u3058\u304f enabled \u3067\u3059\u3002\u305d\u3053\u3067 disabled\u3092\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n$ sudo sh -c \"echo disabled > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\ndisabled\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n/proc , /sys \u3069\u3061\u3089\u306b\u3082\u53cd\u6620\u3055\u308c\u307e\u3057\u305f\u3002\n\u305f\u3060\u3057\n$ sudo sh -c \"echo enab > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\nsh: echo: I/O error\n$ sudo sh -c \"echo 1 > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\nsh: echo: I/O error\n\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\ndisabled\n\n\u8aa4\u3063\u305f\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3059\u308b\u3068 I/O error (I/O\u30a8\u30e9\u30fc\u306a\u3093\u3060) \u3092\u5410\u304d\u307e\u3059\u3002\u6b63\u78ba\u306a\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n$ sudo sh -c \"echo enabled > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\nenabled\n\n\u305d\u3046\u8003\u3048\u308b\u3068\u3001wakeup \u306b\u95a2\u3057\u3066\u306f procfs \u3078\u306e\u30a2\u30af\u30bb\u30b9\u306e\u65b9\u304c sysfs \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3088\u308a\u3082\u5b89\u5168\u306a\u6c17\u304c\u3057\u307e\u3059\u3002(\u307e\u3042\u3001\u3053\u306e\u8fba\u3092\u5909\u66f4\u3059\u308b\u4eba\u9593\u304c\u5b89\u5168\u306b\u914d\u616e\u3092\u3057\u306a\u3044\u308f\u3051\u304c\u306a\u3044\u306e\u3067\u3059\u304c)\n\n\u3042\u3089\u305f\u3081\u3066\n\u4eca\u5f8c\u3068\u3082\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002\n\n\n\n\nhttps://linuxjm.osdn.jp/html/LDP_man-pages/man2/write.2.html\n\u5358\u306b $ man 2 write \u3060\u3051\u3069\u00a0\u21a9\n\n\n\n# \u307e\u305a\u306f\u6328\u62f6\n\nQiita \u306b\u521d\u6295\u7a3f\u3067\u3059\u3002\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002\n\n# \u30b5\u30b9\u30da\u30f3\u30c9\u304c\u51fa\u6765\u306a\u3044\n\n\u3042\u308b\u6642 Ubuntu \u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u307e\u3057\u305f\u3002\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u5f8c\u306e\u74b0\u5883\u306f\n\n```sh\n$ lsb_release -d -r\nDescription:    Ubuntu 14.04.5 LTS\nRelease:        14.04\n```\n\n\u3067\u3059\u3002\n\n\u3055\u3066\u3001\u5bdd\u3088\u3046\u3068 PC \u3092\u30b5\u30b9\u30da\u30f3\u30c9\u3092\u3057\u305f\u306e\u3067\u3059\u304c\u3059\u3050\u306b\u8d77\u304d\u4e0a\u304c\u308a\u307e\u3059\u3002\u4f55\u304b\u30ad\u30fc\u30dc\u30fc\u30c8\u3092\u62bc\u3057\u305f\u304b\u306a\uff1f \u3068\u3001\u307e\u305f\u30b5\u30b9\u30da\u30f3\u30c9\u3092\u3057\u305f\u306e\u3067\u3059\u304c\u3059\u3050\u306b\u8d77\u304d\u4e0a\u304c\u308a\u307e\u3059\u3002\u5bdd\u308c\u307e\u305b\u3093\u3002(\u3046\u305d\u3002\u5bdd\u307e\u3057\u305f) \u8abf\u3079\u307e\u3059\u3002\u3044\u308d\u3044\u308d\u691c\u7d22\u306b\u639b\u304b\u308a\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u304c [ArchWiki](https://wiki.archlinux.org/index.php/MacBook#Suspend_and_Hibernate) \u306b\u66f8\u3044\u3066\u3042\u308b\u89e3\u6c7a\u7b56\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\u66f0\u304f\u3001 */proc/acpi/wakeup* \u306e\n`LID0` \u4ee5\u5916\u3092 `disabled` \u306b\u3057\u306a\u3055\u3044\u3002\u4ee5\u4e0b\u306e\u69d8\u306b\u3002\n\n```sh\n# echo XHC1 > /proc/acpi/wakeup\n```\n\n\u3001\u3001\u3001\u3048\u3063\uff1f \u4f55\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u306a\u306e\uff1f \u307e\u3001\u307e\u3042 \u7d20\u76f4\u306b\u5f93\u3044\u307e\u3059\u3002\n\n```sh\n$ cat /proc/acpi/wakeup\nDevice  S-state   Status   Sysfs node\nUAR1      S4    *disabled  pnp:00:0b\nUSB1      S3    *disabled\nRP01      S4    *disabled  pci:0000:00:1c.0\nRP03      S4    *disabled  pci:0000:00:1c.2\nBR40      S4    *disabled  pci:0000:02:00.0\nRP04      S4    *disabled  pci:0000:00:1c.3\nGLAN      S4    *disabled\nEHC1      S4    *enabled   pci:0000:00:1d.0\nEHC2      S4    *enabled   pci:0000:00:1a.0\nXHC       S4    *enabled   pci:0000:00:14.0\nHDEF      S4    *disabled  pci:0000:00:1b.0\nPEG0      S4    *disabled\nPEGP      S4    *disabled\nPEG1      S4    *disabled\nPEG2      S4    *disabled\n```\n\n(\u4e0a\u8a18\u306e wakeup \u306e\u5185\u5bb9\u306f\u30b5\u30b9\u30da\u30f3\u30c9\u304c\u52b9\u304b\u306a\u3044\u72b6\u6cc1\u3068\u306f\u82e5\u5e72\u9055\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u89e3\u6c7a\u3057\u3066\u304b\u3089\u307e\u305f\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3057\u305f\u306e\u3067\u3002\u5927\u7b4b\u3068\u3044\u3046\u3053\u3068\u3067)\n\n\u81ea\u5206\u306e\u74b0\u5883\u3060\u3068 `EHC1` \u3068 `EHC2` \u3068 `XHC` \u3092 `disabled` \u306b\u3059\u308c\u3070\u3044\u3044\u306e\u3060\u306a\u3002\n\n```sh\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n$ sudo sh -c \"echo EHC2 > /proc/acpi/wakeup\"\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup\nDevice  S-state   Status   Sysfs node\nUAR1      S4    *disabled  pnp:00:0b\nUSB1      S3    *disabled\nRP01      S4    *disabled  pci:0000:00:1c.0\nRP03      S4    *disabled  pci:0000:00:1c.2\nBR40      S4    *disabled  pci:0000:02:00.0\nRP04      S4    *disabled  pci:0000:00:1c.3\nGLAN      S4    *disabled\nEHC1      S4    *disabled  pci:0000:00:1d.0\nEHC2      S4    *disabled  pci:0000:00:1a.0\nXHC       S4    *disabled  pci:0000:00:14.0\nHDEF      S4    *disabled  pci:0000:00:1b.0\nPEG0      S4    *disabled\nPEGP      S4    *disabled\nPEG1      S4    *disabled\nPEG2      S4    *disabled\n```\n\n\u30b5\u30b9\u30da\u30f3\u30c9\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3081\u3067\u305f\u3057\u3081\u3067\u305f\u3057\u3002\u304c\u3001\u3053\u306e\u8a18\u4e8b\u306e\u4e3b\u984c\u306f\u305d\u3053\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u4e3b\u984c\u306f\n\n**\u306a\u305c \u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u306b\u3088\u308b /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3067\u7d50\u679c\u304c\u5185\u5bb9\u3068\u9055\u3046\u306e\u304b** \n\n\n\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\n# /proc/acpi/wakeup \u306b\u66f8\u304d\u8fbc\u3080\u3068\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u304b\uff1f\n\n\u4e0a\u8ff0\u306e\u51fa\u529b\u3092\u898b\u308c\u3070\u5206\u304b\u308b\u3088\u3046\u306b */proc/acpi/wakeup* \u306f\u8907\u6570\u884c\u3067\u3059\u3002\u666e\u901a\u306f `echo EHC1 > /proc/acpi/wakeup`\u306f 1\u884c\u306b\u306a\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n-   /proc\u4e0b\u306f \u4eee\u60f3\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0(procfs)\u3067\u3001\u30d7\u30ed\u30bb\u30b9\u3001\u30ab\u30fc\u30cd\u30eb\u306b\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5f79\u5272\u3092\u6301\u3064\u3002\u9010\u6b21\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n\n\u3057\u304b\u3057\u3053\u308c\u306f \u524d\u8ff0\u306e\u4f8b\u3067 1\u884c\u306b\u306a\u3089\u306a\u3044\u8aac\u660e\u306b\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n\n-   \u60f3\u50cf\u3060\u304c\u3001wakeup \u3092\u6271\u3063\u3066\u3044\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u304c \u30d5\u30a1\u30a4\u30eb\u30c7\u30a3\u30b9\u30af\u30ea\u30d7\u30bf\u306e\u64cd\u4f5c\u3067\u6587\u5b57\u5217\u3092\u53d7\u3051\u5185\u5bb9\u3092\u89e3\u91c8\u3057\u3001wakeup\u30d5\u30a1\u30a4\u30eb\u3092\u9010\u6b21\u4f5c\u6210\u3057\u3066\u3044\u308b\u3002\n\n\u3053\u308c\u307e\u305f \u307c\u3093\u3084\u308a\u3057\u3066\u3044\u307e\u3059\u3002\u5185\u5bb9\u3092\u89e3\u91c8\u3063\u3066\u5177\u4f53\u7684\u306b\u306f\u306a\u3093\u3060\u308d\u3046\uff1f\n\n\u3088\u304f\u5206\u304b\u3089\u306a\u3044\u306e\u3067\u5177\u4f53\u7684\u306b\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n# strace \u3067\u78ba\u8a8d\n\n`strace` \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002 `strace` \u306f\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3084\u30b7\u30b0\u30ca\u30eb\u3092\u76e3\u8996\u3059\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\n\u307e\u305a\u306f `EHC1` \u3092 `enabled` \u306b\u3057\u3066\n\n```sh\n$ sudo sh -c \"echo EHC1=enabled > /proc/acpi/wakeup\" \n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n```\n\n\u3001\u3001\u3001\u5b9f\u306f\u3053\u306e\u5b9f\u884c\u306e\u8a8d\u8b58\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u4e8b\u3092\u5f8c\u3067\u6c17\u4ed8\u304f\u306e\u3067\u3059\u304c\u3002\n\n\u305d\u3057\u3066 `strace` \u3002(\u306a\u306e\u3060\u304c\u3001\u3061\u3087\u3063\u3068\u9577\u3044\u4e0a\u306b getcwd(\"/home/xxx\" &#x2026; \u306f\u307e\u305a\u3044\u306e\u3067)\n\n```sh\n$ sudo -p \"sudo> \" test\nsudo> \n\n$ sudo strace sh -c \"echo EHC1 > /proc/acpi/wakeup\" 2> strace_write_ehc1_to_wakeup.txt\n\n## strace \u306e\u51fa\u529b\u884c\u6570\n$ wc -l strace_write_ehc1_to_wakeup.txt \n50 strace_write_ehc1_to_wakeup.txt\n\n## head -10\n$ head -10 strace_write_ehc1_to_wakeup.txt\nexecve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /proc/acpi/wakeup\"], [/* 18 vars */]) = 0\nbrk(0)                                  = 0x7f03e785b000\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\nmmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f03e6ed7000\naccess(\"/etc/ld.so.preload\", R_OK)      = -1 ENOENT (No such file or directory)\nopen(\"/etc/ld.so.cache\", O_RDONLY|O_CLOEXEC) = 3\nfstat(3, {st_mode=S_IFREG|0644, st_size=106703, ...}) = 0\nmmap(NULL, 106703, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f03e6ebc000\nclose(3)                                = 0\naccess(\"/etc/ld.so.nohwcap\", F_OK)      = -1 ENOENT (No such file or directory)\n\n## tail -10\n$ tail -10 strace_write_ehc1_to_wakeup.txt\nclose(1)                                = 0\nfcntl(10, F_SETFD, FD_CLOEXEC)          = 0\ndup2(3, 1)                              = 1\nclose(3)                                = 0\nwrite(1, \"EHC1\\n\", 5)                   = 4\nwrite(1, \"\\n\", 1)                       = 1\ndup2(10, 1)                             = 1\nclose(10)                               = 0\nexit_group(0)                           = ?\n+++ exited with 0 +++\n\n## \u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u306e\u5c65\u6b74\n$ cat strace_write_ehc1_to_wakeup.txt | cut -s -d \\( -f 1 |paste -d, - - - - - \nexecve,brk,access,mmap,access\nopen,fstat,mmap,close,access\nopen,read,fstat,mmap,mprotect\nmmap,mmap,close,mmap,mmap\narch_prctl,mprotect,mprotect,mprotect,munmap\ngetpid,rt_sigaction,geteuid,brk,brk\ngetppid,getcwd,rt_sigaction,rt_sigaction,rt_sigaction\nrt_sigaction,rt_sigaction,rt_sigaction,open,fcntl\nclose,fcntl,dup2,close,write\nwrite,dup2,close,exit_group,\n```\n\n\u304a\u305d\u3089\u304f tail \u306e\u51fa\u529b\u306b\u73fe\u308c\u3066\u3044\u308b write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u304c */proc/acpi/wakeup*\u3078\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306e\u5b9f\u614b\u3067\u3057\u3087\u3046\u3002\u3057\u304b\u3057\u3053\u308c\u3060\u3051\u3067\u306f\u3088\u304f\u5206\u304b\u308a\u307e\u305b\u3093\u3002\n\n\u305d\u3053\u3067 */proc/acpi/wakeup* \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068 */dev/null* \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068\u306e `strace` \u306e\n\u51fa\u529b\u306e\u6bd4\u8f03\u3092\u3057\u3066\u307f\u307e\u3059\u3002\u3068\u3001\u305d\u306e\u524d\u306b `strace` \u306e\u51fa\u529b\u3067 `0x7f03e785b000` \u306a\u3069\u306e0x(16\u9032\u657012\u6841) \u306e\u6587\u5b57\u5217\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u30a2\u30c9\u30ec\u30b9\u306a\u306e\u3067 `0xzzzz` \u306b\u7f6e\u63db\u3057\u3066\u6bd4\u8f03\u3057\u307e\u3059\u3002\n\n```diff\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ diff -U0 \\\n<(sudo strace sh -c \"echo EHC1 > /dev/null\"         2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g') \\\n<(sudo strace sh -c \"echo EHC1 > /proc/acpi/wakeup\" 2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g')\n--- /proc/self/fd/11    2016-09-28 18:44:26.882716060 +0900\n+++ /proc/self/fd/13    2016-09-28 18:44:26.883716065 +0900\n@@ -1 +1 @@\n-execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /dev/null\"], [/* 18 vars */]) = 0\n+execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo EHC1 > /proc/acpi/wakeup\"], [/* 18 vars */]) = 0\n@@ -26 +26 @@\n-getpid()                                = 30419\n+getpid()                                = 30421\n@@ -31 +31 @@\n-getppid()                               = 30414\n+getppid()                               = 30415\n@@ -39 +39 @@\n-open(\"/dev/null\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n+open(\"/proc/acpi/wakeup\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n@@ -45 +45,2 @@\n-write(1, \"EHC1\\n\", 5)                   = 5\n+write(1, \"EHC1\\n\", 5)                   = 4\n+write(1, \"\\n\", 1)                       = 1\n```\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u304b\u3089 \u6587\u5b57\u5217 \"EHC1\\n\" \u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306f\u3001\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u3063\u3066write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u3092\n\n-   */dev/null(\u901a\u5e38\u30d5\u30a1\u30a4\u30eb\u3082\u304b)*: 5\u30d0\u30a4\u30c8\u3092\u4e00\u6c17\u306b\u51e6\u7406\n-   */proc/acpi/wakeup*: 4\u30d0\u30a4\u30c8\u51e6\u7406(\u8fd4\u308a\u5024[^fname1]) \u3057\u305f\u5f8c\u3001\u6b8b\u308a\u306e 1\u30d0\u30a4\u30c8\u3092\u51e6\u7406\n\n\u3068\u3044\u3046\u69d8\u306b\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n\u3055\u3066\u3001\u3053\u3046\u306a\u308b\u3068\u9577\u3044\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3093\u3060\u6642\u3069\u3046\u306a\u308b\u306e\u304b\u304c\u6c17\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3076\u3093 */proc/acpi/wakeup* \u306b\u306f\u4f55\u3092\u66f8\u304d\u8fbc\u3093\u3067\u3082\u3044\u3044\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3059\u3002\u305d\u3053\u3067 \u6587\u5b57\u5217 `euu45678901234567890` \u3092\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\n```diff\n$ diff -U0 \\\n<(sudo strace sh -c \"echo euu45678901234567890 > /dev/null\"         2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g') \\\n<(sudo strace sh -c \"echo euu45678901234567890 > /proc/acpi/wakeup\" 2>&1 |sed -E 's/0x[a-fA-F0-9]{12}/0xzzzz/g')\n--- /proc/self/fd/11    2016-09-28 20:57:35.643468246 +0900\n+++ /proc/self/fd/13    2016-09-28 20:57:35.643468246 +0900\n@@ -1 +1 @@\n-execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo euu45678901234567890 > /dev\"...], [/* 18 vars */]) = 0\n+execve(\"/bin/sh\", [\"sh\", \"-c\", \"echo euu45678901234567890 > /pro\"...], [/* 18 vars */]) = 0\n@@ -26 +26 @@\n-getpid()                                = 31593\n+getpid()                                = 31590\n@@ -31 +31 @@\n-getppid()                               = 31586\n+getppid()                               = 31587\n@@ -39 +39 @@\n-open(\"/dev/null\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n+open(\"/proc/acpi/wakeup\", O_WRONLY|O_CREAT|O_TRUNC, 0666) = 3\n@@ -45 +45,6 @@\n-write(1, \"euu45678901234567890\\n\", 21)  = 21\n+write(1, \"euu45678901234567890\\n\", 21)  = 4\n+write(1, \"5678901234567890\\n\", 17)      = 4\n+write(1, \"901234567890\\n\", 13)          = 4\n+write(1, \"34567890\\n\", 9)               = 4\n+write(1, \"7890\\n\", 5)                   = 4\n+write(1, \"\\n\", 1)                       = 1\n```\n\n\u4e0a\u8a18\u306e\u7d50\u679c\u304b\u3089 \u6587\u5b57\u5217\u306e\u66f8\u304d\u8fbc\u307f\u51e6\u7406\u306f\u3001\u5bfe\u8c61\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u3088\u3063\u3066 write\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb \u3092\n\n-   */dev/null(\u901a\u5e38\u30d5\u30a1\u30a4\u30eb\u3082\u304b)*: \u6587\u5b57\u5217\u3092\u4e00\u6c17\u306b(\u30ea\u30df\u30c3\u30c8\u3042\u308a[^fname1])\u51e6\u7406\n-   */proc/acpi/wakeup*: 4\u30d0\u30a4\u30c8\u305a\u3064\u51e6\u7406\n\n\u3068\u3044\u3046\u69d8\u306b\u547c\u3073\u51fa\u3057\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\n\n# /proc/acpi/wakeup \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306e\u5b9f\u969b\n\n\u5148\u7a0b\u3001\u5b9f\u884c\u306e\u8a8d\u8b58\u304c\u9593\u9055\u3063\u3066\u3044\u305f\u3001\u3068\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306b */proc/acpi/wakeup* \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306e\u4f8b\u3092\u793a\u3057\u307e\u3059\u3002\n\n## echo EHC1 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n```\n\nEHC1 \u306e\u72b6\u614b: enabled  ->  disabled\n\n## echo EHC1=disabled \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1=disabled > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n```\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled\n\n\u3088\u3063\u3066 XXX=disabled \u5f62\u5f0f\u306e\u8a2d\u5b9a\u306f\u7121\u52b9\n\n## echo EHC1=1 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1=1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n```\n\nEHC1 \u306e\u72b6\u614b: enabled  ->  disabled\n\n\u3088\u3063\u3066 XXX=1 \u5f62\u5f0f\u306e\u8a2d\u5b9a\u306f\u7121\u52b9\n\n## echo EHC1 \u3092\u9023\u7d9a\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC1 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n```\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled  ->  disabled\n\n\u30c8\u30b0\u30eb\u51e6\u7406 \u306b\u306a\u308b\n\n## echo EHC123 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n\n$ sudo sh -c \"echo EHC123 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^EHC\" \nEHC1      S4    *enabled   pci:0000:00:1d.0\nEHC2      S4    *disabled  pci:0000:00:1a.0\n```\n\nEHC1 \u306e\u72b6\u614b: disabled  ->  enabled\n\n\u5909\u6570 EHC1 \u3078\u306e\u66f8\u304d\u8fbc\u307f\u3068\u89e3\u91c8\u3055\u308c\u308b\u3002EHC123 \u3068\u3044\u3046\u5909\u6570\u304c\u51fa\u6765\u308b\u308f\u3051\u3067\u306f\u306a\u3044\n\n## echo XHC \u3092\u9023\u7d9a\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\" \n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *enabled   pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n```\n\nXHC \u306e\u72b6\u614b: disabled  ->  enabled  ->  disabled\n\n\u30c8\u30b0\u30eb\u51e6\u7406 \u306b\u306a\u308b\n\n## echo XHC5, echo XHC56 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC5 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC56 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n```\n\nXHC \u306e\u72b6\u614b: disabled -> disabled  ->  disabled\n\nXHC5, XHC56 \u306e\u69d8\u306b \u6700\u521d\u306e 3\u30d0\u30a4\u30c8\u304c XHC \u3067\u3082 \u5909\u6570 XHC \u3068\u89e3\u91c8\u3057\u306a\u3044\n\n## echo XHC 0 \u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *disabled  pci:0000:00:14.0\n\n$ sudo sh -c \"echo XHC 0 > /proc/acpi/wakeup\"\n\n$ cat /proc/acpi/wakeup |grep -E \"^XHC\"\nXHC       S4    *enabled   pci:0000:00:14.0\n```\n\nXHC \u306e\u72b6\u614b: disabled  ->  enabled\n\n\u6700\u521d\u306e 4\u30d0\u30a4\u30c8 \u304c \"XHC \" (\u3053\u306e\u5834\u5408\u6700\u5f8c\u306e1\u30d0\u30a4\u30c8\u306f\u30b9\u30da\u30fc\u30b9) \u306e\u6642 \u5909\u6570\u3068\u3057\u3066\u89e3\u91c8\u3059\u308b\u306e\u3060\u308d\u3046\n\n# /proc/acpi/wakeup \u306b\u66f8\u304d\u8fbc\u3080\u3068\u306f\n\n\u4ee5\u4e0a\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u6642\u306e\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb\u3084\u66f8\u304d\u8fbc\u307f\u4f8b\u304b\u3089\u63a8\u5bdf\u3059\u308b\u3068\u3001 */proc/acpi/wakeup* \u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001 `EHC1=enabled` \u3068\u3044\u3063\u305f\u69d8\u306b\u5024\u3092\u6307\u5b9a\u51fa\u6765\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u5358\u306b\n\n**\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067\u9001\u308b\u6587\u5b57\u5217\u306e\u6700\u521d\u306e4\u30d0\u30a4\u30c8\u304c /proc/acpi/wakeup \u5185\u306e\u5909\u6570\u3067\u3042\u3063\u305f\u6642\u3001\u305d\u306e\u5909\u6570\u306e\u30c8\u30b0\u30eb\u51e6\u7406\u304c\u884c\u308f\u308c\u308b** \n\n\n\u3068\u3044\u3046\u4e8b\u3067\u3059\u3002\n\n*/proc* \u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u306b `echo 1`, `echo 0` \u3068\u304b\u3092\u30ea\u30c0\u30a4\u30af\u30ec\u30c8\u3059\u308b\u306e\u306f\u3088\u304f\u3084\u308a\u307e\u3059\u304c\u3001\u3053\u306e wakeup\u30d5\u30a1\u30a4\u30eb \u306e\u69d8\u306a\u3001\u6700\u521d\u306e4\u30d0\u30a4\u30c8\u3060\u3051\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30d5\u30a1\u30a4\u30eb\u3082\u3042\u308b \u3063\u3066\u306e\u306f\u5e38\u8b58\u306a\u306e\u3060\u308d\u3046\u304b\uff1f\n\n# wakeup \u306e\u4ed6\u306e\u8a2d\u5b9a\u65b9\u6cd5\n\n[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://dothiko.hatenablog.com/entry/2014/04/23/201923) \u306e\u69d8\u306a\u624b\u9806\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3082\u51fa\u6765\u307e\u3059\u3002\u307e\u305a\n\n```sh\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *enabled   pci:0000:00:1d.0\n```\n\n\u3068 `pci:0000:00:1d.0` \u306a\u306e\u3067 */sys/bus/pci/devices/0000:00:1d.0/power/wakeup* \n\u3092\u8aad\u307f\u307e\u3059\u3002\n\n```sh\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\nenabled\n```\n\n*/proc/acpi/wakeup* \u306e `EHC1` \u3068\u540c\u3058\u304f `enabled` \u3067\u3059\u3002\u305d\u3053\u3067 `disabled`\u3092\u66f8\u304d\u8fbc\u3093\u3067\u307f\u307e\u3059\u3002\n\n```sh\n$ sudo sh -c \"echo disabled > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\ndisabled\n$ cat /proc/acpi/wakeup |grep -E \"^EHC1\"\nEHC1      S4    *disabled  pci:0000:00:1d.0\n```\n\n*/proc* , */sys* \u3069\u3061\u3089\u306b\u3082\u53cd\u6620\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u305f\u3060\u3057\n\n```sh\n$ sudo sh -c \"echo enab > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\nsh: echo: I/O error\n$ sudo sh -c \"echo 1 > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\nsh: echo: I/O error\n\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\ndisabled\n```\n\n\u8aa4\u3063\u305f\u6587\u5b57\u5217\u3092\u66f8\u304d\u8fbc\u3082\u3046\u3068\u3059\u308b\u3068 `I/O error` (I/O\u30a8\u30e9\u30fc\u306a\u3093\u3060) \u3092\u5410\u304d\u307e\u3059\u3002\u6b63\u78ba\u306a\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u3087\u3046\u3002\n\n```sh\n$ sudo sh -c \"echo enabled > /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\"\n$ cat /sys/bus/pci/devices/0000:00:1d.0/power/wakeup\nenabled\n```\n\n\u305d\u3046\u8003\u3048\u308b\u3068\u3001wakeup \u306b\u95a2\u3057\u3066\u306f `procfs` \u3078\u306e\u30a2\u30af\u30bb\u30b9\u306e\u65b9\u304c `sysfs` \u3078\u306e\u30a2\u30af\u30bb\u30b9\u3088\u308a\u3082\u5b89\u5168\u306a\u6c17\u304c\u3057\u307e\u3059\u3002(\u307e\u3042\u3001\u3053\u306e\u8fba\u3092\u5909\u66f4\u3059\u308b\u4eba\u9593\u304c\u5b89\u5168\u306b\u914d\u616e\u3092\u3057\u306a\u3044\u308f\u3051\u304c\u306a\u3044\u306e\u3067\u3059\u304c)\n\n# \u3042\u3089\u305f\u3081\u3066\n\n\u4eca\u5f8c\u3068\u3082\u3088\u308d\u3057\u304f\u304a\u9858\u3044\u3044\u305f\u3057\u307e\u3059\u3002\n\n\n[^fname1]:\n  https://linuxjm.osdn.jp/html/LDP_man-pages/man2/write.2.html\n  \u5358\u306b `$ man 2 write` \u3060\u3051\u3069\n", "tags": ["Linux", "UNIX", "\u30b7\u30b9\u30c6\u30e0\u30b3\u30fc\u30eb", "procfs"]}