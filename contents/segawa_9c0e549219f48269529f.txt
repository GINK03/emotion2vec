{"context": "\u524d\u56de\u3001 Embulk \u3067 MySQL \u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u30b0\u30e9\u30d5\u3067\u898b\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3084\u308d\u3046\u3084\u308d\u3046\u3068\u601d\u3063\u3066\u3044\u305f ElasticSearch+Kibana \u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\nJava \u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u74b0\u5883\u306f macOs Sierra \u3067\u3059\u3002\n\nJava\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ java -version\njava version \"1.8.0_111\"\nJava(TM) SE Runtime Environment (build 1.8.0_111-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.111-b14, mixed mode)\n\n\n\nElasticsearch\nElasticsearch\u3068\u306f\u3001Wikipedia\u3088\u308a\n\nElasticsearch\u306fLucene\u57fa\u76e4\u306e\u5206\u6563\u51e6\u7406\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u5bfe\u5fdc\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u3067\u3042\u308b\u3002\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3060\u304c\u3001\u73fe\u5728\u306f\u30aa\u30e9\u30f3\u30c0\u30fb\u30a2\u30e0\u30b9\u30c6\u30eb\u30c0\u30e0\u306b\u672c\u793e\u3092\u7f6e\u304fElastic\u793e\u304c\u4e2d\u5fc3\u306b\u306a\u3063\u3066\u958b\u767a\u304c\u9032\u3081\u3089\u308c\u3066\u3044\u308b\n\nJava\u3067\u8a18\u8ff0\u3055\u308c\u305f\u5168\u6587\u691c\u7d22\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e Apache Lucene\uff08\u30a2\u30d1\u30c3\u30c1 \u30eb\u30b7\u30fc\u30f3\uff09\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u308b\u305d\u3046\u3067\u3059\u3002\n\n\u7528\u8a9e\nElasticseach \u306e\u7528\u8a9e\u306e\u7406\u89e3\u3002\n\n\n\n\u7528\u8a9e\n\u8aac\u660e\n\n\n\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\nRDMS\u3067\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u3042\u305f\u308b\u3082\u306e\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nRDMS\u3067\u306e\u30ec\u30b3\u30fc\u30c9\u306b\u3042\u305f\u308b\u3082\u306e\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30bf\u30a4\u30d7\nElasticsearch \u3067\u306f1\u3064\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5185\u306b\u7570\u306a\u308b\u69cb\u9020\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u683c\u7d0d\u3067\u304d\u308b\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30bf\u30a4\u30d7\u306f\u3069\u306e\u69cb\u9020\u304b\u3092\u8b58\u5225\u3059\u308b\u3082\u306e\n\n\n\u30de\u30c3\u30d4\u30f3\u30b0\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u9020\u306e\u5b9a\u7fa9\n\n\n\u30d5\u30a3\u30fc\u30eb\u30c9\nRDMS\u3067\u306e\u30ab\u30e9\u30e0\u306b\u3042\u305f\u308b\u3082\u306e\n\n\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nHomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\n\nElasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ brew install elasticsearch\n  :\nData:    /usr/local/var/elasticsearch/elasticsearch_yutasega/\nLogs:    /usr/local/var/log/elasticsearch/elasticsearch_yutasega.log\nPlugins: /usr/local/Cellar/elasticsearch/5.0.2/libexec/plugins/\nConfig:  /usr/local/etc/elasticsearch/\nplugin script: /usr/local/Cellar/elasticsearch/5.0.2/libexec/bin/plugin\n\nTo have launchd start elasticsearch now and restart at login:\n  brew services start elasticsearch\nOr, if you don't want/need a background service you can just run:\n  elasticsearch\n  :\n\n\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u6a19\u6e96\u51fa\u529b\u306b\u30ed\u30b0\u304c\u51fa\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u898b\u306a\u304c\u3089\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u307e\u3057\u305f\u3002\n\nElasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ elasticsearch\n\n\n\u8d77\u52d5\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u6700\u65b0\u306e 5.0.2 \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u8d77\u52d5\u78ba\u8a8d\n$ curl -X GET http://localhost:9200/ \n{\n  \"name\" : \"ZYNFZGW\",\n  \"cluster_name\" : \"elasticsearch_yutasega\",\n  \"cluster_uuid\" : \"VEGuf46HTfOG0Sl2us8IQg\",\n  \"version\" : {\n    \"number\" : \"5.0.2\",\n    \"build_hash\" : \"f6b4951\",\n    \"build_date\" : \"2016-11-24T10:07:18.101Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"6.2.1\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n\n\n\nKibana\nKibana \u306f Elasticsearch \u3068\u540c\u3058\u304f elastic\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3001Elasticsearch \u306e\u30c7\u30fc\u30bf\u3092\u53ef\u8996\u5316\u3067\u304d\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nKibana \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f node.js \u304c\u5fc5\u8981\u3067\u3057\u305f\u3002\n\nnode.js\n\nnode.js\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.2/install.sh | bash\nsource ~/.bashrc\n\n\n\nkibana\n\u3053\u3053\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nKibana\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget https://artifacts.elastic.co/downloads/kibana/kibana-5.0.2-darwin-x86_64.tar.gz\n$ tar -xzf kibana-5.0.2-darwin-x86_64.tar.gz\n$ cd kibana/\n\n\n\n\u8d77\u52d5\nElasticsearch \u306e\u8d77\u52d5\u3092\u78ba\u8a8d\u5f8c\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nKibana\u306e\u5b9f\u884c\n$ ./bin/kibana\n\n\n\n\u78ba\u8a8d\n\u30d6\u30e9\u30a6\u30b6\u3067\u4e0b\u8a18\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\nhttp://localhost:5601/\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\nEmbulk\u306e\u8a2d\u5b9a\u5909\u66f4\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nEmbulk \u306b Elasticsearch \u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\uff08embulk-output-elasticsearch_ruby\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ embulk gem install embulk-output-elasticsearch_ruby\n\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\nout\u306e\u90e8\u5206\u3092 MySQL \u306e\u3082\u306e\u304b\u3089 Elasticsearch \u306e\u3082\u306e\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\nconfig.yml\nin:\n  type: file\n  path_prefix: try1/access_log/sample.access_\n  decoders:\n  - {type: gzip}\n  parser: \n    type: apache-custom-log\n    format: \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\"\nout:\n  type: elasticsearch_ruby\n  nodes:\n    - {host: localhost, port: 9200}\n  index: access_log\n  index_type: site_a\n\n\naccess_log \u304c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u3067\u3001site_a \u304c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30bf\u30a4\u30d7\u306b\u3042\u305f\u308a\u307e\u3059\u3002\n\n\u30c7\u30fc\u30bf\u306e\u6d41\u3057\u8fbc\u307f\n\nElasticseach\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u767b\u9332\n\u30de\u30c3\u30d4\u30f3\u30b0\uff08=\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u9020\u5b9a\u7fa9\uff09\u3092\u884c\u3044\u307e\u3059\u3002\n\nmapping.json\n{\n  \"mappings\" : {\n    \"site_a\" : {\n      \"properties\" : {\n        \"remote-host\" : { \"type\" : \"string\" },\n        \"remote-log-name\" : { \"type\" : \"string\" },\n        \"request-user\" : { \"type\" : \"string\" },\n        \"request-time\" : { \"type\" : \"date\", \"format\" : \"yyyy-MM-dd HH:mm:ss z\" },\n        \"request-line\" : { \"type\" : \"string\" },\n        \"response-status\" : { \"type\" : \"long\" },\n        \"response-bytes\" : { \"type\" : \"long\" },\n        \"request-header-Referer\" : { \"type\" : \"string\" },\n        \"request-header-User-Agent\" : { \"type\" : \"string\" }\n      }\n    }\n  }\n}\n\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u30de\u30c3\u30d4\u30f3\u30b0\u60c5\u5831\u3092json\u3067\u8a18\u8ff0\u3057\u3001\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u767b\u9332\n$ curl -XPUT 'localhost:9200/access_log' -d @mapping.json\n{\"acknowledged\":true,\"shards_acknowledged\":true}\n\n\ncurl\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002 access_log \u306f\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u767b\u9332\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u3067\u3059\u3002\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\nEmbulk\u3092\u5b9f\u884c\n\nEmbulk\u3092\u5b9f\u884c\n$ embulk run config.yml\n\n\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u8fbc\u307f\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u30c7\u30fc\u30bf\u304c\u7121\u4e8b\u53d6\u308a\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u306f\u3001\u4ee5\u4e0b\u306e URL \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\nElasticsearch\u306e\u30c7\u30fc\u30bf\u78ba\u8a8d\nhttp://localhost:9200/access_log/_search?pretty\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u78ba\u8a8d\u306f\u4e0b\u8a18\u3067\nhttp://localhost:9200/access_log/_mapping?pretty\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u5b9a\u7fa9\u304c\u5834\u9055\u3063\u3066\u3044\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u524a\u9664\u3057\u518d\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u518d\u8a2d\u5b9a\n$ curl -XDELETE 'localhost:9200/access_log'\n$ curl -XPUT localhost:9200/access_log -d @mapping.json\n\n\n\nKibana\u3067\u30b0\u30e9\u30d5\u3092\u898b\u308b\n\nManagement\u3067IndexPattern\u306e\u8a2d\u5b9a\n\n\u5de6\u30ab\u30e9\u30e0\u306e Management > Index Ptterns \u3092\u9078\u629e\u3057\u307e\u3059\nIndex name or pattern \u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d access_log \u3092\u5165\u529b\u3057\u307e\u3059\nTime-field name \u306b date \u578b\u9805\u76ee\u306e request-time \u3092\u9078\u629e\u3057 create\n\n\n\nVisualize\n\n\u30b0\u30e9\u30d5\u306e\u7a2e\u985e\u3092\u9078\u629e\uff08\u5fd8\u308c\u3066\u3057\u307e\u3063\u305f\u3002\u305f\u3057\u304b\u4e00\u756a\u4e0b\u306e\u68d2\u30b0\u30e9\u30d5\u306e\u3084\u3064\uff09\nVisualize \u30e1\u30cb\u30e5\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\nY\u8ef8\u306b Count\u3001X\u8ef8\u306b request-time \u3092\u9078\u629e\u3057\u3066\u3001\u9752\u3044\u518d\u751f\u30dc\u30bf\u30f3\u307f\u305f\u3044\u306a\u3084\u3064\u3092\u62bc\u3057\u307e\u3059\u3002\n\n\nYes\uff01\n\n\u30cf\u30de\u3063\u305f\u70b9\n\n\u3059\u3079\u3066\u6700\u65b0\u7248\u3092\u9078\u629e\u3057\u305f\u305f\u3081\u3001\u610f\u5916\u3068\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u3002\nEmbulk \u304c\u751f\u6210\u3059\u308b\u65e5\u4ed8\u306b\u300c2016-01-05 15:19:56 UTC\u300d\u306e\u3088\u3046\u306b\u300cUTC\u300d\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u30de\u30c3\u30d4\u30f3\u30b0\u306e Date format \u3067\u3069\u3046\u66f8\u3051\u3070\u3044\u3044\u304b\u308f\u304b\u3089\u305a\u4e00\u5411\u306b\u53d6\u308a\u8fbc\u3081\u306a\u304b\u3063\u305f\uff08z\u3060\u3063\u305f\uff09\n\u30de\u30c3\u30d4\u30f3\u30b0\u8a2d\u5b9a\u3092\u5909\u3048\u3066\u8a66\u3057\u3066\u3044\u305f\u3068\u3053\u308d Elasticseach \u3067\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u30c7\u30fc\u30bf\u304c\u53d6\u308a\u8fbc\u3081\u306a\u304f\u306a\u3063\u305f\u3002\n\n[2016-12-09T20:36:44,640][DEBUG][o.e.a.a.i.a.TransportIndicesAliasesAction] [ZYNFZGW] failed to perform aliases\norg.elasticsearch.indices.InvalidAliasNameException: Invalid alias name [access_log], an index exists with the same name as the alias\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5168\u3066\u524a\u9664\u3057\u305f\u3089\u89e3\u6d88\u3057\u305f\u3002\n\u4ee5\u4e0b\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u30a8\u30a4\u30ea\u30a2\u30b9\u3092 .kibana\u4ee5\u5916\u5168\u3066\u524a\u9664\u3057\u305f\u3002\nhttp://localhost:9200/_aliases/\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u4e00\u89a7\n{\n  \"test-access_log-2016.12.09.20.15.37\": {\n    \"aliases\": {}\n  },\n  \"access_log-site_a-2016.12.09.20.36.38\": {\n    \"aliases\": {}\n  },\n  \".kibana\": {\n    \"aliases\": {}\n  },\n  \"sample-access_log-2016.12.09.20.09.43\": {\n    \"aliases\": {}\n  },\n  \"sample-access_log-2016.12.09.20.07.56\": {\n    \"aliases\": {}\n  },\n  \"samplesite-access_log-2016.12.09.20.18.51\": {\n    \"aliases\": {}\n  },\n  \"test-access_log-2016.12.09.20.11.41\": {\n    \"aliases\": {}\n  },\n  \"access_log\": {\n    \"aliases\": {}\n  }\n}\n\n\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u524a\u9664\n$ curl -XDELETE 'localhost:9200/test-access_log-2016.12.09.20.15.37'\n\n\n\n\u53d6\u308a\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u304c2016\u5e741\u6708\u306e\u30c7\u30fc\u30bf\u3067\u3001Kibana \u306e\u65e5\u4ed8\u30d5\u30a3\u30eb\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u304c Last 15 minutes \u306a\u306e\u306b\u6c17\u3065\u304b\u305a\u30c7\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u306a\u3044\u3068\u5c0f\u4e00\u6642\u9593\u60a9\u307f\u307e\u3057\u305f\u3002\n\n[\u524d\u56de](http://qiita.com/segawa/items/3f0aee6aaef6529b3f2e)\u3001 Embulk \u3067 MySQL \u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u30b0\u30e9\u30d5\u3067\u898b\u308c\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u306e\u3067\u3084\u308d\u3046\u3084\u308d\u3046\u3068\u601d\u3063\u3066\u3044\u305f ElasticSearch+Kibana \u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nJava \u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u74b0\u5883\u306f macOs Sierra \u3067\u3059\u3002\n\n```console:Java\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ java -version\njava version \"1.8.0_111\"\nJava(TM) SE Runtime Environment (build 1.8.0_111-b14)\nJava HotSpot(TM) 64-Bit Server VM (build 25.111-b14, mixed mode)\n```\n\n# Elasticsearch\n\n[Elasticsearch](https://www.elastic.co/jp/products/elasticsearch)\u3068\u306f\u3001Wikipedia\u3088\u308a\n\n>Elasticsearch\u306fLucene\u57fa\u76e4\u306e\u5206\u6563\u51e6\u7406\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8\u5bfe\u5fdc\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u3067\u3042\u308b\u3002\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3060\u304c\u3001\u73fe\u5728\u306f\u30aa\u30e9\u30f3\u30c0\u30fb\u30a2\u30e0\u30b9\u30c6\u30eb\u30c0\u30e0\u306b\u672c\u793e\u3092\u7f6e\u304fElastic\u793e\u304c\u4e2d\u5fc3\u306b\u306a\u3063\u3066\u958b\u767a\u304c\u9032\u3081\u3089\u308c\u3066\u3044\u308b\n\nJava\u3067\u8a18\u8ff0\u3055\u308c\u305f\u5168\u6587\u691c\u7d22\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e Apache Lucene\uff08\u30a2\u30d1\u30c3\u30c1 \u30eb\u30b7\u30fc\u30f3\uff09\u3092\u30d9\u30fc\u30b9\u306b\u3057\u3066\u3044\u308b\u305d\u3046\u3067\u3059\u3002\n\n## \u7528\u8a9e\n\nElasticseach \u306e\u7528\u8a9e\u306e\u7406\u89e3\u3002\n\n|\u7528\u8a9e|\u8aac\u660e|\n|:-----|:-----|\n|\u30a4\u30f3\u30c7\u30c3\u30af\u30b9|RDMS\u3067\u306e\u30c6\u30fc\u30d6\u30eb\u306b\u3042\u305f\u308b\u3082\u306e|\n|\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8|RDMS\u3067\u306e\u30ec\u30b3\u30fc\u30c9\u306b\u3042\u305f\u308b\u3082\u306e|\n|\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30bf\u30a4\u30d7|Elasticsearch \u3067\u306f1\u3064\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5185\u306b\u7570\u306a\u308b\u69cb\u9020\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u683c\u7d0d\u3067\u304d\u308b\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30bf\u30a4\u30d7\u306f\u3069\u306e\u69cb\u9020\u304b\u3092\u8b58\u5225\u3059\u308b\u3082\u306e|\n|\u30de\u30c3\u30d4\u30f3\u30b0|\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u9020\u306e\u5b9a\u7fa9|\n|\u30d5\u30a3\u30fc\u30eb\u30c9|RDMS\u3067\u306e\u30ab\u30e9\u30e0\u306b\u3042\u305f\u308b\u3082\u306e|\n\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nHomebrew\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u53ef\u80fd\u3067\u3059\u3002\n\n```console:Elasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ brew install elasticsearch\n  :\nData:    /usr/local/var/elasticsearch/elasticsearch_yutasega/\nLogs:    /usr/local/var/log/elasticsearch/elasticsearch_yutasega.log\nPlugins: /usr/local/Cellar/elasticsearch/5.0.2/libexec/plugins/\nConfig:  /usr/local/etc/elasticsearch/\nplugin script: /usr/local/Cellar/elasticsearch/5.0.2/libexec/bin/plugin\n\nTo have launchd start elasticsearch now and restart at login:\n  brew services start elasticsearch\nOr, if you don't want/need a background service you can just run:\n  elasticsearch\n  :\n```\n\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\u6a19\u6e96\u51fa\u529b\u306b\u30ed\u30b0\u304c\u51fa\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u898b\u306a\u304c\u3089\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3057\u307e\u3057\u305f\u3002\n\n```console:Elasticsearch\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ elasticsearch\n```\n\n\u8d77\u52d5\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u6700\u65b0\u306e 5.0.2 \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n```console:\u8d77\u52d5\u78ba\u8a8d\n$ curl -X GET http://localhost:9200/ \n{\n  \"name\" : \"ZYNFZGW\",\n  \"cluster_name\" : \"elasticsearch_yutasega\",\n  \"cluster_uuid\" : \"VEGuf46HTfOG0Sl2us8IQg\",\n  \"version\" : {\n    \"number\" : \"5.0.2\",\n    \"build_hash\" : \"f6b4951\",\n    \"build_date\" : \"2016-11-24T10:07:18.101Z\",\n    \"build_snapshot\" : false,\n    \"lucene_version\" : \"6.2.1\"\n  },\n  \"tagline\" : \"You Know, for Search\"\n}\n```\n\n# Kibana\n\n[Kibana](https://www.elastic.co/jp/products/kibana) \u306f Elasticsearch \u3068\u540c\u3058\u304f elastic\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3001Elasticsearch \u306e\u30c7\u30fc\u30bf\u3092\u53ef\u8996\u5316\u3067\u304d\u307e\u3059\u3002\n\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nKibana \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306b\u306f node.js \u304c\u5fc5\u8981\u3067\u3057\u305f\u3002\n\n### node.js\n\n```console:node.js\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.31.2/install.sh | bash\nsource ~/.bashrc\n```\n\n\n### kibana\n\n[\u3053\u3053](https://www.elastic.co/guide/en/kibana/5.0/targz.html)\u306b\u8a18\u8f09\u3055\u308c\u3066\u3044\u308b\u65b9\u6cd5\u306b\u5f93\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```console:Kibana\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ wget https://artifacts.elastic.co/downloads/kibana/kibana-5.0.2-darwin-x86_64.tar.gz\n$ tar -xzf kibana-5.0.2-darwin-x86_64.tar.gz\n$ cd kibana/\n```\n\n## \u8d77\u52d5\n\nElasticsearch \u306e\u8d77\u52d5\u3092\u78ba\u8a8d\u5f8c\u3001\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```console:Kibana\u306e\u5b9f\u884c\n$ ./bin/kibana\n```\n\n## \u78ba\u8a8d\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u4e0b\u8a18\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\nhttp://localhost:5601/\n\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n# Embulk\u306e\u8a2d\u5b9a\u5909\u66f4\n\n## \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nEmbulk \u306b Elasticsearch \u7528\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\uff08embulk-output-elasticsearch_ruby\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```console:\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ embulk gem install embulk-output-elasticsearch_ruby\n```\n\n## \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\n\nout\u306e\u90e8\u5206\u3092 MySQL \u306e\u3082\u306e\u304b\u3089 Elasticsearch \u306e\u3082\u306e\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```yaml:config.yml\nin:\n  type: file\n  path_prefix: try1/access_log/sample.access_\n  decoders:\n  - {type: gzip}\n  parser: \n    type: apache-custom-log\n    format: \"%h %l %u %t \\\"%r\\\" %>s %b \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\"\nout:\n  type: elasticsearch_ruby\n  nodes:\n    - {host: localhost, port: 9200}\n  index: access_log\n  index_type: site_a\n```\n\naccess_log \u304c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u3067\u3001site_a \u304c\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30bf\u30a4\u30d7\u306b\u3042\u305f\u308a\u307e\u3059\u3002\n\n\n# \u30c7\u30fc\u30bf\u306e\u6d41\u3057\u8fbc\u307f\n\n## Elasticseach\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u767b\u9332\n\n\u30de\u30c3\u30d4\u30f3\u30b0\uff08=\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u9020\u5b9a\u7fa9\uff09\u3092\u884c\u3044\u307e\u3059\u3002\n\n```json:mapping.json\n{\n  \"mappings\" : {\n    \"site_a\" : {\n      \"properties\" : {\n        \"remote-host\" : { \"type\" : \"string\" },\n        \"remote-log-name\" : { \"type\" : \"string\" },\n        \"request-user\" : { \"type\" : \"string\" },\n        \"request-time\" : { \"type\" : \"date\", \"format\" : \"yyyy-MM-dd HH:mm:ss z\" },\n        \"request-line\" : { \"type\" : \"string\" },\n        \"response-status\" : { \"type\" : \"long\" },\n        \"response-bytes\" : { \"type\" : \"long\" },\n        \"request-header-Referer\" : { \"type\" : \"string\" },\n        \"request-header-User-Agent\" : { \"type\" : \"string\" }\n      }\n    }\n  }\n}\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306a\u30de\u30c3\u30d4\u30f3\u30b0\u60c5\u5831\u3092json\u3067\u8a18\u8ff0\u3057\u3001\n\n```console:\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u767b\u9332\n$ curl -XPUT 'localhost:9200/access_log' -d @mapping.json\n{\"acknowledged\":true,\"shards_acknowledged\":true}\n```\n\ncurl\u3067\u8a2d\u5b9a\u3057\u307e\u3059\u3002 `access_log` \u306f\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u767b\u9332\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u3067\u3059\u3002\n\u3053\u308c\u3067\u6e96\u5099\u5b8c\u4e86\u3067\u3059\u3002\n\n## Embulk\u3092\u5b9f\u884c\n\n```\uff43\uff4f\uff4e\uff53\uff4f\uff4c\uff45:Embulk\u3092\u5b9f\u884c\n$ embulk run config.yml\n```\n\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u308a\u8fbc\u307f\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\n\u30c7\u30fc\u30bf\u304c\u7121\u4e8b\u53d6\u308a\u8fbc\u307e\u308c\u3066\u3044\u308b\u304b\u306f\u3001\u4ee5\u4e0b\u306e URL \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3053\u3068\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\nElasticsearch\u306e\u30c7\u30fc\u30bf\u78ba\u8a8d\nhttp://localhost:9200/access_log/_search?pretty\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u78ba\u8a8d\u306f\u4e0b\u8a18\u3067\nhttp://localhost:9200/access_log/_mapping?pretty\n\n\n\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u5b9a\u7fa9\u304c\u5834\u9055\u3063\u3066\u3044\u305f\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u524a\u9664\u3057\u518d\u8a2d\u5b9a\u53ef\u80fd\u3067\u3059\u3002\n\n```console:\u30de\u30c3\u30d4\u30f3\u30b0\u306e\u518d\u8a2d\u5b9a\n$ curl -XDELETE 'localhost:9200/access_log'\n$ curl -XPUT localhost:9200/access_log -d @mapping.json\n```\n\n# Kibana\u3067\u30b0\u30e9\u30d5\u3092\u898b\u308b\n\n## Management\u3067IndexPattern\u306e\u8a2d\u5b9a\n\n1. \u5de6\u30ab\u30e9\u30e0\u306e Management > Index Ptterns \u3092\u9078\u629e\u3057\u307e\u3059\n2. Index name or pattern \u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d `access_log` \u3092\u5165\u529b\u3057\u307e\u3059\n3. Time-field name \u306b date \u578b\u9805\u76ee\u306e `request-time` \u3092\u9078\u629e\u3057 create\n\n<img width=\"1064\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-09 20.53.32.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/20940/62a2cd69-3343-0041-fe0c-4c61efbb7b92.png\">\n\n## Visualize\n\n1. \u30b0\u30e9\u30d5\u306e\u7a2e\u985e\u3092\u9078\u629e\uff08\u5fd8\u308c\u3066\u3057\u307e\u3063\u305f\u3002\u305f\u3057\u304b\u4e00\u756a\u4e0b\u306e\u68d2\u30b0\u30e9\u30d5\u306e\u3084\u3064\uff09\n2. Visualize \u30e1\u30cb\u30e5\u30fc\u3092\u9078\u629e\u3057\u307e\u3059\n3. Y\u8ef8\u306b Count\u3001X\u8ef8\u306b `request-time` \u3092\u9078\u629e\u3057\u3066\u3001\u9752\u3044\u518d\u751f\u30dc\u30bf\u30f3\u307f\u305f\u3044\u306a\u3084\u3064\u3092\u62bc\u3057\u307e\u3059\u3002\n\n<img width=\"1223\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-09 21.08.43.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/20940/f9393bd1-cecd-fee8-8e21-610d07d6650b.png\">\n\nYes\uff01\n\n\n\n\n\n# \u30cf\u30de\u3063\u305f\u70b9\n\n- \u3059\u3079\u3066\u6700\u65b0\u7248\u3092\u9078\u629e\u3057\u305f\u305f\u3081\u3001\u610f\u5916\u3068\u60c5\u5831\u304c\u5c11\u306a\u304b\u3063\u305f\u3002\n\n- Embulk \u304c\u751f\u6210\u3059\u308b\u65e5\u4ed8\u306b\u300c2016-01-05 15:19:56 UTC\u300d\u306e\u3088\u3046\u306b\u300cUTC\u300d\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u30de\u30c3\u30d4\u30f3\u30b0\u306e Date format \u3067\u3069\u3046\u66f8\u3051\u3070\u3044\u3044\u304b\u308f\u304b\u3089\u305a\u4e00\u5411\u306b\u53d6\u308a\u8fbc\u3081\u306a\u304b\u3063\u305f\uff08`z`\u3060\u3063\u305f\uff09\n\n- \u30de\u30c3\u30d4\u30f3\u30b0\u8a2d\u5b9a\u3092\u5909\u3048\u3066\u8a66\u3057\u3066\u3044\u305f\u3068\u3053\u308d Elasticseach \u3067\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u30c7\u30fc\u30bf\u304c\u53d6\u308a\u8fbc\u3081\u306a\u304f\u306a\u3063\u305f\u3002\n\n```\n[2016-12-09T20:36:44,640][DEBUG][o.e.a.a.i.a.TransportIndicesAliasesAction] [ZYNFZGW] failed to perform aliases\norg.elasticsearch.indices.InvalidAliasNameException: Invalid alias name [access_log], an index exists with the same name as the alias\n```\n\n\u30a8\u30a4\u30ea\u30a2\u30b9\u3092\u5168\u3066\u524a\u9664\u3057\u305f\u3089\u89e3\u6d88\u3057\u305f\u3002\n\u4ee5\u4e0b\u306eURL\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u30a8\u30a4\u30ea\u30a2\u30b9\u3092 .kibana\u4ee5\u5916\u5168\u3066\u524a\u9664\u3057\u305f\u3002\nhttp://localhost:9200/_aliases/\n\n```json:\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u4e00\u89a7\n{\n  \"test-access_log-2016.12.09.20.15.37\": {\n    \"aliases\": {}\n  },\n  \"access_log-site_a-2016.12.09.20.36.38\": {\n    \"aliases\": {}\n  },\n  \".kibana\": {\n    \"aliases\": {}\n  },\n  \"sample-access_log-2016.12.09.20.09.43\": {\n    \"aliases\": {}\n  },\n  \"sample-access_log-2016.12.09.20.07.56\": {\n    \"aliases\": {}\n  },\n  \"samplesite-access_log-2016.12.09.20.18.51\": {\n    \"aliases\": {}\n  },\n  \"test-access_log-2016.12.09.20.11.41\": {\n    \"aliases\": {}\n  },\n  \"access_log\": {\n    \"aliases\": {}\n  }\n}\n```\n\n```console:\u30a8\u30a4\u30ea\u30a2\u30b9\u306e\u524a\u9664\n$ curl -XDELETE 'localhost:9200/test-access_log-2016.12.09.20.15.37'\n```\n\n- \u53d6\u308a\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u304c2016\u5e741\u6708\u306e\u30c7\u30fc\u30bf\u3067\u3001Kibana \u306e\u65e5\u4ed8\u30d5\u30a3\u30eb\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u304c `Last 15 minutes` \u306a\u306e\u306b\u6c17\u3065\u304b\u305a\u30c7\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u306a\u3044\u3068\u5c0f\u4e00\u6642\u9593\u60a9\u307f\u307e\u3057\u305f\u3002\n\n\n", "tags": ["Embulk", "Elasticsearch", "kibana"]}