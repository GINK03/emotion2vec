{"context": "\n\n\u6982\u8981\nBOT API Trial Account \u304c\u307e\u3060\u767b\u9332\u51fa\u6765\u305f\u306e\u3067\u3001\u904a\u3093\u3067\u307f\u307e\u3057\u305f\u3002\nhttp://linecorp.com/ja/pr/news/ja/2016/1320\n\u767a\u8a00\u3059\u308b\u3068\u3001\u5185\u5bb9\u304c\u306a\u3093\u3067\u3042\u308d\u3046\u3068\u304a\u3044\u3057\u305d\u3046\u306a\u3054\u98ef\u306e\u753b\u50cf\u3092\u8fd4\u3057\u3066\u304f\u308b BOT \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u81ea\u9bd6\u306b BOT \u3068\u753b\u50cf\u3092\u4ed5\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n\n\u52d5\u4f5c\u30a4\u30e1\u30fc\u30b8\n\n\n\u51e6\u7406\u30a4\u30e1\u30fc\u30b8\n\n\n\u5fc5\u8981\u306a\u3082\u306e\n\nLine developers \u30a2\u30ab\u30a6\u30f3\u30c8\nPHP \u304c\u52d5\u4f5c\u3057 443\u756a\u30dd\u30fc\u30c8\u3067 https \u304c\u304a\u8a71\u3057\u3067\u304d\u308b\u30b5\u30fc\u30d0\n\n\n\u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u306f NG\nLet's Encrypt \u306f OK \u3067\u3057\u305f\n\n\n\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\nLINE Business Center \u304b\u3089 BOT API Trial Account \u3092\u53d6\u5f97\u3057\u307e\u3057\u3087\u3046\u3002\n\u5148\u77401\u4e07\u4eba\u9650\u5b9a\u3068\u306e\u3053\u3068\u3067\u3059\u304c 2016/05/05 \u3067\u3082\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\u51fa\u6765\u307e\u3057\u305f\u3002\nLINE developers \u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306e Channel ID, Channel Secret, MID \u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\u5f8c\u3005\u5229\u7528\u3057\u307e\u3059\u306e\u3067\u3001\u63a7\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\nCallback URL \u306e\u8a2d\u5b9a\n\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u753b\u9762\u53f3\u4e0b\u306e EDIT \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 Callback URL \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u3053\u306e\u6642 https \u306b\u3059\u308b\u3053\u3068\u306f\u3082\u3061\u308d\u3093\u3001\u30dd\u30fc\u30c8\u756a\u53f7 443 \u3082\u5fd8\u308c\u305a\u306b\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\u5165\u308c\u306a\u3044\u3068 URL or port number not sepcified. \u3068\u306a\u308b\u3089\u3057\u3044\u3067\u3059(\u672a\u691c\u8a3c)\u3002\n\nServer IP Whitelist \u306e\u8a2d\u5b9a\n\u5de6\u30da\u30a4\u30f3\u304b\u3089 Server IP Whitelist \u3092\u30af\u30ea\u30c3\u30af\u3057 API \u3092\u547c\u3073\u51fa\u3059\u6642\u3001\u7279\u5b9a\u30bd\u30fc\u30b9IP\u306e\u307f\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u307e\u3059\u3002\n\u5165\u308c\u306a\u3044\u3068\u5f3e\u304b\u308c\u307e\u3059\u3002\n\n\nBOT \u306e\u4f5c\u6210\n\ncallback.php\n<?php\n// BOT \u306e Channel ID, Channel Secret, MID \u3092\u5165\u529b\n$channel_id = \"< Channel ID >\";\n$channel_secret = \"< Channel Secret >\";\n$bot_mid = \"< MID >\";\n\n//\u5909\u6570\u7fa4\n$log_file = \"< \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9 && \u30d5\u30a1\u30a4\u30eb\u540d >\";\n$server_url = \"< ServerName >\";\n$document_root = \"< Documentroot >\";\n$pic_dir = \"$document_root\" . \"< \u753b\u50cf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea >\";\n\n//time zone\ndate_default_timezone_set('Asia/Tokyo');\n\n// \u95a2\u6570\u7fa4\n//\u30e6\u30fc\u30b6\u60c5\u5831\u53d6\u5f97\u3059\u308b\u95a2\u6570\nfunction getDisplayName($to_mid){\n    global $channel_id;\n    global $channel_secret;\n    global $bot_mid;\n    $user_profiles_url = curl_init(\"https://trialbot-api.line.me/v1/profiles?mids=${to_mid}\");\n    curl_setopt($user_profiles_url, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($user_profiles_url, CURLOPT_HTTPHEADER, array(\n        \"X-Line-ChannelID: $channel_id\",\n        \"X-Line-ChannelSecret: $channel_secret\",\n        \"X-Line-Trusted-User-With-ACL: $bot_mid\"\n    ));\n    $user_profiles_output = curl_exec($user_profiles_url);\n    $user_json_obj = json_decode($user_profiles_output);\n    global $displayname;\n    $displayname = $user_json_obj->contacts{0}->displayName;\n    curl_close($user_profiles_url);\n}\n\n//POST\u3059\u308b\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u95a2\u6570\nfunction create_post_data($to_mid, $post_content){\n    // toChannel\u3068eventType\u306f\u56fa\u5b9a\u5024\u306a\u306e\u3067\u3001\u5909\u66f4\u4e0d\u8981\u3002\n    global $post_data;\n    $post_data = [\n        \"to\"=>[$to_mid],\n        \"toChannel\"=>\"1383378250\",\n        \"eventType\"=>\"138311608800106203\",\n        \"content\"=>$post_content\n    ];\n}\n\n//\u76f8\u624b\u306b\u4f1a\u8a71\u3059\u308b\u5185\u5bb9\u3092POST\u3059\u308b\u95a2\u6570\nfunction post($post_data){\n    global $channel_id;\n    global $channel_secret;\n    global $bot_mid;\n    $post_url = curl_init(\"https://trialbot-api.line.me/v1/events\");\n    curl_setopt($post_url, CURLOPT_POST, true);\n    curl_setopt($post_url, CURLOPT_CUSTOMREQUEST, 'POST');\n    curl_setopt($post_url, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($post_url, CURLOPT_POSTFIELDS, json_encode($post_data));\n    curl_setopt($post_url, CURLOPT_HTTPHEADER, array(\n        'Content-Type: application/json; charser=UTF-8',\n        \"X-Line-ChannelID: $channel_id\",\n        \"X-Line-ChannelSecret: $channel_secret\",\n        \"X-Line-Trusted-User-With-ACL: $bot_mid\"\n    ));\n    $result = curl_exec($post_url);\n    curl_close($post_url);\n}\n\n// \u76f8\u624b\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\n$recieve_json_string = file_get_contents('php://input');\n$recieve_jsonObj = json_decode($recieve_json_string);\n$to = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"from\"};\n$text = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"text\"};\n$content_type = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"contentType\"};\n$location = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"location\"};\n$op_type = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"opType\"};\n$params = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"params\"};\n\n//DisplayName \u53d6\u5f97\n//date, mid, displayName, text, contentType \u3092\u30ed\u30b0\u51fa\u529b\ngetDisplayName($to);\nfile_put_contents($log_file, date(\"Y/m/d H:i:s\") . \" mid:${to}, displayName:${displayname}, text:${text}, contentType:${content_type}\" . PHP_EOL, FILE_APPEND);\n\n//\u4f1a\u8a71\u51e6\u7406\nif( $op_type === 4 ){\n    // \u53cb\u9054\u767b\u9332\u6642\u306b\u4f1a\u8a71\u3059\u308b\n    getDisplayName($params[0]);\n    $response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u98ef\u30c6\u30ed BOT \u306e\u767b\u9332\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059, ${displayname}\u3055\u3093.\"];\n    create_post_data($params[0], $response_format_text);\n    post($post_data);\n} else if( $op_type === 8 ){\n    // \u30d6\u30ed\u30c3\u30af\u6642\u306f\u306a\u306b\u3082\u305b\u305a\u6b63\u5e38\u7d42\u4e86\u3059\u308b\n    exit(0);\n} else {\n    // \u9001\u4fe1\u3059\u308b\u753b\u50cf\u3092\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3076\n    // glob \u3067\u53d6\u5f97\u3057\u305f\u753b\u50cf\u7dcf\u6570\u3092 max \u306b\u4ee3\u5165\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3070\u308c\u305f\u914d\u5217\u756a\u53f7\u3092 num_list \u306b\u4ee3\u5165\n    // \u30d1\u30b9\u3092\u5909\u63db\u3057\u3001\u672b\u5c3e\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8ffd\u52a0\n    $pic_array  = glob (\"${pic_dir}*.jpg\");\n    $max = count($pic_array);\n    $num_list = array_rand(range(1,$max),1);\n    $pic = str_replace($document_root,\"$server_url\",$pic_array[$num_list]);\n\n    $response_format_image = ['contentType'=>2,\"toType\"=>1,'originalContentUrl'=>\"$pic\",\"previewImageUrl\"=>\"$pic\"];\n    create_post_data($to, $response_format_image);\n    post($post_data);\n}\n\n\n\nBOT \u4f5c\u6210\u6642\u306e\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\ncallback URL \u3092\u8a2d\u5b9a\u3057\u305f\u306e\u306b BOT \u304c\u5fdc\u7b54\u3057\u3066\u304f\u308c\u306a\u3044\n\n\ncallback URL \u767b\u9332\u5f8c\u3001\u6570\u6642\u9593\u7d4c\u305f\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\n\nServer IP Whitelist \u3092\u8a2d\u5b9a\u3057\u305f\u306e\u306b BOT \u304c\u5fdc\u7b54\u3057\u3066\u304f\u308c\u306a\u3044\n\n\ncallback URL \u307b\u3069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\u6642\u9593\u7d4c\u904e\u3057\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\u305d\u308c\u3067\u3082\u30c0\u30e1\u306a\u3089 API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\u3002\u30b3\u30fc\u30c9\u306e $result \u5909\u6570\u306e\u4e2d\u8eab\u3092\u898b\u308b\u3068\u304b\u3002\n\n\n\n\n\u62e1\u5f35\u3057\u305f\u304f\u306a\u3063\u305f\u3089\nBOT API \u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u6700\u5f8c\u306b\n\u305f\u3060\u5358\u306b\u30e9\u30f3\u30c0\u30e0\u3067\u753b\u50cf\u3092\u8fd4\u3059 BOT \u306a\u306e\u3067\u3001\u3042\u307e\u308a\u9762\u767d\u307f\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3057\u304b\u3057 PHP \u3092\u521d\u3081\u3066\u89e6\u308b\u306b\u306f\u624b\u9803\u306a\u96e3\u6613\u5ea6\u3067\u3057\u305f\u3002\n\u4eca\u5f8c\u306f\u5bfe\u8a71\u76f8\u624b\u306e\u60c5\u5831\u3084\u3001\u6642\u671f\u306b\u5fdc\u3058\u305f\u5185\u5bb9\u3092\u52a0\u5473\u3057\u5bfe\u8a71\u3059\u308b\u3088\u3046\u306a BOT \u304c\u4f5c\u6210\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30b9\u30bf\u30f3\u30d7\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u3089\u3001\u305d\u308c\u306b\u8fd1\u3044 XXX \u306e\u753b\u50cf\u3092\u8fd4\u3059\uff01\u3068\u304b\u51fa\u6765\u305f\u3089\u3001\u81ea\u5206\u3060\u3063\u305f\u3089\u9762\u767d\u304c\u3063\u3066\u4f55\u5ea6\u3082\u904a\u3093\u3067\u305d\u3046\u3067\u3059\u3002\n\u307e\u305f\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4e0b\u8a18\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\nLINE BOT API\u3092\u5229\u7528\u3057\u305f\u5730\u7344\u306e\u30df\u30b5\u30efBOT\u306e\u4f5c\u308a\u65b9\nLINE BOT API \u3067\u306e\u30cf\u30de\u308a\u3069\u3053\u308d\n\n# \u6982\u8981\nBOT API Trial Account \u304c\u307e\u3060\u767b\u9332\u51fa\u6765\u305f\u306e\u3067\u3001\u904a\u3093\u3067\u307f\u307e\u3057\u305f\u3002\nhttp://linecorp.com/ja/pr/news/ja/2016/1320\n\n\u767a\u8a00\u3059\u308b\u3068\u3001\u5185\u5bb9\u304c\u306a\u3093\u3067\u3042\u308d\u3046\u3068\u304a\u3044\u3057\u305d\u3046\u306a\u3054\u98ef\u306e\u753b\u50cf\u3092\u8fd4\u3057\u3066\u304f\u308b BOT \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\u81ea\u9bd6\u306b BOT \u3068\u753b\u50cf\u3092\u4ed5\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n\n## \u52d5\u4f5c\u30a4\u30e1\u30fc\u30b8\n\n![QS_20160505-194936.png](https://qiita-image-store.s3.amazonaws.com/0/124486/deeb1f42-80ef-5416-ebb8-bf4ed2a932a6.png)\n\n## \u51e6\u7406\u30a4\u30e1\u30fc\u30b8\n![\u30b9\u30e9\u30a4\u30c91.PNG](https://qiita-image-store.s3.amazonaws.com/0/124486/cf74a07a-9a17-2652-069a-02ed20b4f90f.png)\n\n# \u5fc5\u8981\u306a\u3082\u306e\n* Line developers \u30a2\u30ab\u30a6\u30f3\u30c8\n* PHP \u304c\u52d5\u4f5c\u3057 443\u756a\u30dd\u30fc\u30c8\u3067 https \u304c\u304a\u8a71\u3057\u3067\u304d\u308b\u30b5\u30fc\u30d0\n    * \u30aa\u30ec\u30aa\u30ec\u8a3c\u660e\u66f8\u306f NG\n    * Let's Encrypt \u306f OK \u3067\u3057\u305f\n\n# \u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\n[LINE Business Center](https://business.line.me/ja/) \u304b\u3089 BOT API Trial Account \u3092\u53d6\u5f97\u3057\u307e\u3057\u3087\u3046\u3002\n\u5148\u77401\u4e07\u4eba\u9650\u5b9a\u3068\u306e\u3053\u3068\u3067\u3059\u304c 2016/05/05 \u3067\u3082\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\u51fa\u6765\u307e\u3057\u305f\u3002\nLINE developers \u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n![LINE developers.png](https://qiita-image-store.s3.amazonaws.com/0/124486/cd4f9382-bf1e-d44d-ad54-ee4f289e4412.png)\n\n# \u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u306e\u78ba\u8a8d\n\u4f5c\u6210\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306e Channel ID, Channel Secret, MID \u3092\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\u5f8c\u3005\u5229\u7528\u3057\u307e\u3059\u306e\u3067\u3001\u63a7\u3048\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n# Callback URL \u306e\u8a2d\u5b9a\n\u30a2\u30ab\u30a6\u30f3\u30c8\u60c5\u5831\u753b\u9762\u53f3\u4e0b\u306e EDIT \u3092\u30af\u30ea\u30c3\u30af\u3057\u3066 Callback URL \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n![LINE developers2.png](https://qiita-image-store.s3.amazonaws.com/0/124486/1e6ed14b-0352-ff9c-c1ac-ab9d344f355b.png)\n\u3053\u306e\u6642 https \u306b\u3059\u308b\u3053\u3068\u306f\u3082\u3061\u308d\u3093\u3001\u30dd\u30fc\u30c8\u756a\u53f7 443 \u3082\u5fd8\u308c\u305a\u306b\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\n\u5165\u308c\u306a\u3044\u3068 `URL or port number not sepcified.` \u3068\u306a\u308b\u3089\u3057\u3044\u3067\u3059(\u672a\u691c\u8a3c)\u3002\n\n# Server IP Whitelist \u306e\u8a2d\u5b9a\n\u5de6\u30da\u30a4\u30f3\u304b\u3089 Server IP Whitelist \u3092\u30af\u30ea\u30c3\u30af\u3057 API \u3092\u547c\u3073\u51fa\u3059\u6642\u3001\u7279\u5b9a\u30bd\u30fc\u30b9IP\u306e\u307f\u8a31\u53ef\u3059\u308b\u8a2d\u5b9a\u3092\u5165\u308c\u307e\u3059\u3002\n\u5165\u308c\u306a\u3044\u3068\u5f3e\u304b\u308c\u307e\u3059\u3002\n![LINE developers3.png](https://qiita-image-store.s3.amazonaws.com/0/124486/8809f8c4-9f66-4aa2-718d-2f3bd06a16ee.png)\n\n# BOT \u306e\u4f5c\u6210\n```php:callback.php\n<?php\n// BOT \u306e Channel ID, Channel Secret, MID \u3092\u5165\u529b\n$channel_id = \"< Channel ID >\";\n$channel_secret = \"< Channel Secret >\";\n$bot_mid = \"< MID >\";\n\n//\u5909\u6570\u7fa4\n$log_file = \"< \u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9 && \u30d5\u30a1\u30a4\u30eb\u540d >\";\n$server_url = \"< ServerName >\";\n$document_root = \"< Documentroot >\";\n$pic_dir = \"$document_root\" . \"< \u753b\u50cf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea >\";\n\n//time zone\ndate_default_timezone_set('Asia/Tokyo');\n\n// \u95a2\u6570\u7fa4\n//\u30e6\u30fc\u30b6\u60c5\u5831\u53d6\u5f97\u3059\u308b\u95a2\u6570\nfunction getDisplayName($to_mid){\n    global $channel_id;\n    global $channel_secret;\n    global $bot_mid;\n    $user_profiles_url = curl_init(\"https://trialbot-api.line.me/v1/profiles?mids=${to_mid}\");\n    curl_setopt($user_profiles_url, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($user_profiles_url, CURLOPT_HTTPHEADER, array(\n        \"X-Line-ChannelID: $channel_id\",\n        \"X-Line-ChannelSecret: $channel_secret\",\n        \"X-Line-Trusted-User-With-ACL: $bot_mid\"\n    ));\n    $user_profiles_output = curl_exec($user_profiles_url);\n    $user_json_obj = json_decode($user_profiles_output);\n    global $displayname;\n    $displayname = $user_json_obj->contacts{0}->displayName;\n    curl_close($user_profiles_url);\n}\n\n//POST\u3059\u308b\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u95a2\u6570\nfunction create_post_data($to_mid, $post_content){\n    // toChannel\u3068eventType\u306f\u56fa\u5b9a\u5024\u306a\u306e\u3067\u3001\u5909\u66f4\u4e0d\u8981\u3002\n    global $post_data;\n    $post_data = [\n        \"to\"=>[$to_mid],\n        \"toChannel\"=>\"1383378250\",\n        \"eventType\"=>\"138311608800106203\",\n        \"content\"=>$post_content\n    ];\n}\n\n//\u76f8\u624b\u306b\u4f1a\u8a71\u3059\u308b\u5185\u5bb9\u3092POST\u3059\u308b\u95a2\u6570\nfunction post($post_data){\n    global $channel_id;\n    global $channel_secret;\n    global $bot_mid;\n    $post_url = curl_init(\"https://trialbot-api.line.me/v1/events\");\n    curl_setopt($post_url, CURLOPT_POST, true);\n    curl_setopt($post_url, CURLOPT_CUSTOMREQUEST, 'POST');\n    curl_setopt($post_url, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($post_url, CURLOPT_POSTFIELDS, json_encode($post_data));\n    curl_setopt($post_url, CURLOPT_HTTPHEADER, array(\n        'Content-Type: application/json; charser=UTF-8',\n        \"X-Line-ChannelID: $channel_id\",\n        \"X-Line-ChannelSecret: $channel_secret\",\n        \"X-Line-Trusted-User-With-ACL: $bot_mid\"\n    ));\n    $result = curl_exec($post_url);\n    curl_close($post_url);\n}\n\n// \u76f8\u624b\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\n$recieve_json_string = file_get_contents('php://input');\n$recieve_jsonObj = json_decode($recieve_json_string);\n$to = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"from\"};\n$text = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"text\"};\n$content_type = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"contentType\"};\n$location = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"location\"};\n$op_type = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"opType\"};\n$params = $recieve_jsonObj->{\"result\"}[0]->{\"content\"}->{\"params\"};\n\n//DisplayName \u53d6\u5f97\n//date, mid, displayName, text, contentType \u3092\u30ed\u30b0\u51fa\u529b\ngetDisplayName($to);\nfile_put_contents($log_file, date(\"Y/m/d H:i:s\") . \" mid:${to}, displayName:${displayname}, text:${text}, contentType:${content_type}\" . PHP_EOL, FILE_APPEND);\n\n//\u4f1a\u8a71\u51e6\u7406\nif( $op_type === 4 ){\n    // \u53cb\u9054\u767b\u9332\u6642\u306b\u4f1a\u8a71\u3059\u308b\n    getDisplayName($params[0]);\n    $response_format_text = ['contentType'=>1,\"toType\"=>1,\"text\"=>\"\u98ef\u30c6\u30ed BOT \u306e\u767b\u9332\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059, ${displayname}\u3055\u3093.\"];\n    create_post_data($params[0], $response_format_text);\n    post($post_data);\n} else if( $op_type === 8 ){\n    // \u30d6\u30ed\u30c3\u30af\u6642\u306f\u306a\u306b\u3082\u305b\u305a\u6b63\u5e38\u7d42\u4e86\u3059\u308b\n    exit(0);\n} else {\n    // \u9001\u4fe1\u3059\u308b\u753b\u50cf\u3092\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3076\n    // glob \u3067\u53d6\u5f97\u3057\u305f\u753b\u50cf\u7dcf\u6570\u3092 max \u306b\u4ee3\u5165\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u3067\u9078\u3070\u308c\u305f\u914d\u5217\u756a\u53f7\u3092 num_list \u306b\u4ee3\u5165\n    // \u30d1\u30b9\u3092\u5909\u63db\u3057\u3001\u672b\u5c3e\u306b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u8ffd\u52a0\n    $pic_array  = glob (\"${pic_dir}*.jpg\");\n    $max = count($pic_array);\n    $num_list = array_rand(range(1,$max),1);\n    $pic = str_replace($document_root,\"$server_url\",$pic_array[$num_list]);\n    \n    $response_format_image = ['contentType'=>2,\"toType\"=>1,'originalContentUrl'=>\"$pic\",\"previewImageUrl\"=>\"$pic\"];\n    create_post_data($to, $response_format_image);\n    post($post_data);\n}\n```\n\n# BOT \u4f5c\u6210\u6642\u306e\u30cf\u30de\u308a\u30dd\u30a4\u30f3\u30c8\n\u30cf\u30de\u3063\u305f\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u306e\u3067\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n* callback URL \u3092\u8a2d\u5b9a\u3057\u305f\u306e\u306b BOT \u304c\u5fdc\u7b54\u3057\u3066\u304f\u308c\u306a\u3044\n    * callback URL \u767b\u9332\u5f8c\u3001\u6570\u6642\u9593\u7d4c\u305f\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n* Server IP Whitelist \u3092\u8a2d\u5b9a\u3057\u305f\u306e\u306b BOT \u304c\u5fdc\u7b54\u3057\u3066\u304f\u308c\u306a\u3044\n    * callback URL \u307b\u3069\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\u6642\u9593\u7d4c\u904e\u3057\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3088\u3046\u3067\u3059\u3002\u5f85\u3061\u307e\u3057\u3087\u3046\u3002\n\u305d\u308c\u3067\u3082\u30c0\u30e1\u306a\u3089 API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3057\u3087\u3046\u3002\u30b3\u30fc\u30c9\u306e $result \u5909\u6570\u306e\u4e2d\u8eab\u3092\u898b\u308b\u3068\u304b\u3002\n\n# \u62e1\u5f35\u3057\u305f\u304f\u306a\u3063\u305f\u3089\n[BOT API](https://developers.line.me/bot-api/overview) \u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n# \u6700\u5f8c\u306b\n\u305f\u3060\u5358\u306b\u30e9\u30f3\u30c0\u30e0\u3067\u753b\u50cf\u3092\u8fd4\u3059 BOT \u306a\u306e\u3067\u3001\u3042\u307e\u308a\u9762\u767d\u307f\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3057\u304b\u3057 PHP \u3092\u521d\u3081\u3066\u89e6\u308b\u306b\u306f\u624b\u9803\u306a\u96e3\u6613\u5ea6\u3067\u3057\u305f\u3002\n\u4eca\u5f8c\u306f\u5bfe\u8a71\u76f8\u624b\u306e\u60c5\u5831\u3084\u3001\u6642\u671f\u306b\u5fdc\u3058\u305f\u5185\u5bb9\u3092\u52a0\u5473\u3057\u5bfe\u8a71\u3059\u308b\u3088\u3046\u306a BOT \u304c\u4f5c\u6210\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u30b9\u30bf\u30f3\u30d7\u304c\u9001\u3089\u308c\u3066\u304d\u305f\u3089\u3001\u305d\u308c\u306b\u8fd1\u3044 XXX \u306e\u753b\u50cf\u3092\u8fd4\u3059\uff01\u3068\u304b\u51fa\u6765\u305f\u3089\u3001\u81ea\u5206\u3060\u3063\u305f\u3089\u9762\u767d\u304c\u3063\u3066\u4f55\u5ea6\u3082\u904a\u3093\u3067\u305d\u3046\u3067\u3059\u3002\n\n\u307e\u305f\u4f5c\u6210\u306b\u3042\u305f\u308a\u3001\u4e0b\u8a18\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\n\n* [LINE BOT API\u3092\u5229\u7528\u3057\u305f\u5730\u7344\u306e\u30df\u30b5\u30efBOT\u306e\u4f5c\u308a\u65b9](http://qiita.com/srea/items/58ba0f7d870a6ee3da2a)\n* [LINE BOT API \u3067\u306e\u30cf\u30de\u308a\u3069\u3053\u308d](http://yone098.hatenablog.com/entry/2016/04/10/032451)\n", "tags": ["linebot", "Line", "PHP", "bot", "api"]}