{"context": "http://stackoverflow.com/search?q=string.encode%28%3A%3AEncoding%3A%3AUTF_8%2C+%3Aundef+%3D%3E+%3Areplace%29.force_encoding%28%3A%3AEncoding%3A%3ABINARY%29\nhttp://stackoverflow.com/questions/5123993/json-encoding-wrongly-escaped-rails-3-ruby-1-9-2/5124452#5124452\nmodule ActiveSupport::JSON::Encoding\n  class << self\n    def escape(string)\n      if string.respond_to?(:force_encoding)\n        string = string.encode(::Encoding::UTF_8, :undef => :replace).force_encoding(::Encoding::BINARY)\n      end\n      json = string.gsub(escape_regex) { |s| ESCAPED_CHARS[s] }\n      json = %(\"#{json}\")\n      json.force_encoding(::Encoding::UTF_8) if json.respond_to?(:force_encoding)\n      json\n    end\n  end\nend\n\nhttp://stackoverflow.com/search?q=string.encode%28%3A%3AEncoding%3A%3AUTF_8%2C+%3Aundef+%3D%3E+%3Areplace%29.force_encoding%28%3A%3AEncoding%3A%3ABINARY%29\n\nhttp://stackoverflow.com/questions/5123993/json-encoding-wrongly-escaped-rails-3-ruby-1-9-2/5124452#5124452\n\n```rb\nmodule ActiveSupport::JSON::Encoding\n  class << self\n    def escape(string)\n      if string.respond_to?(:force_encoding)\n        string = string.encode(::Encoding::UTF_8, :undef => :replace).force_encoding(::Encoding::BINARY)\n      end\n      json = string.gsub(escape_regex) { |s| ESCAPED_CHARS[s] }\n      json = %(\"#{json}\")\n      json.force_encoding(::Encoding::UTF_8) if json.respond_to?(:force_encoding)\n      json\n    end\n  end\nend\n```\n", "tags": ["activesupport"]}