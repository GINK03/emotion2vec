{"context": "\u3068\u306b\u304b\u304f\u4eca\u3059\u3050 Heroku \u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u65b9\u306f\u3053\u3061\u3089\u3002 (\u8981 LINE BOT API \u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\nLINE BOT API \u306e\u547c\u3073\u51fa\u3057\u306b\u306f Server IP Whitelist \u306b\u63a5\u7d9a\u5143 IP \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3068\u306e\u3053\u3068\u3067\u3001Heroku \u3060\u3068\u96e3\u3057\u3044\u304b\u306a\u30fc\u3001\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u30a2\u30c9\u30aa\u30f3\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\nFixie\n\u3053\u308c\u3092\u4f7f\u3046\u3068 HTTP \u30d7\u30ed\u30ad\u30b7\u306e URL \u304c\u767a\u884c\u3055\u308c\u3001\u305d\u308c\u3092\u901a\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308c\u3070\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9 IP \u3092\u56fa\u5b9a\u3067\u304d\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u7121\u6599\u30d7\u30e9\u30f3\u3082\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u4f7f\u3048\u3070\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067\u8a66\u305b\u307e\u3059\u3002\n(\u6700\u521d\u306b Proximo \u3068\u3044\u3046\u985e\u4f3c\u30a2\u30c9\u30aa\u30f3\u3092\u8a66\u305d\u3046\u3068\u3057\u305f\u3051\u3069\u305d\u3063\u3061\u306f\u7121\u6599\u30d7\u30e9\u30f3\u306a\u304b\u3063\u305f\u306e\u3067\u7121\u99c4\u306b $5 \u53d6\u3089\u308c\u308b\u3063\u307d\u3044\u3002\u3064\u3089\u3044)\n$ heroku addons:create fixie:tricycle\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9 IP \u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092 LINE BOT API \u306e Server IP Whitelist \u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\u5f8c\u304b\u3089\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f Heroku \u4e0a\u3067\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089 Fixie \u306e\u753b\u9762\u3092\u958b\u304f\u3068 Account \u306e\u753b\u9762\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u8a66\u3059\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306f\u3001@masuidrive \u3055\u3093\u306e\u3068\u308a\u3042\u3048\u305aLINE BOT API\u3067\u30aa\u30a6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u305f\u3092\u307b\u307c\u4e38\u30d1\u30af\u30ea\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 (\u3059\u3044\u307e\u305b\u3093)\n\nconfig.ru\n# Mostly taken from http://qiita.com/masuidrive/items/1042d93740a7a72242a3\n\nrequire 'bundler/setup'\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\n\nclass App < Sinatra::Base\n  post '/linebot/callback' do\n    params = JSON.parse(request.body.read)\n\n    params['result'].each do |msg|\n      request_content = {\n        to: [msg['content']['from']],\n        toChannel: 1383378250, # Fixed  value\n        eventType: \"138311608800106203\", # Fixed value\n        content: msg['content']\n      }\n\n      endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n      content_json = request_content.to_json\n\n      RestClient.proxy = ENV[\"FIXIE_URL\"]\n      RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'X-Line-ChannelID' => ENV[\"LINE_CHANNEL_ID\"],\n        'X-Line-ChannelSecret' => ENV[\"LINE_CHANNEL_SECRET\"],\n        'X-Line-Trusted-User-With-ACL' => ENV[\"LINE_CHANNEL_MID\"],\n      })\n    end\n\n    \"OK\"\n  end\nend\n\nrun App\n\n\n\u30bd\u30fc\u30b9\u306f\u3053\u3053\u306b\u7f6e\u3044\u3066\u307e\u3059\u3002 (masuidrive \u3055\u3093\u306b\u6012\u3089\u308c\u305f\u3089\u6d88\u3059)\nhttps://github.com/yuya-takeyama/line-echo\nLINE_CHANNEL_ID \u306e\u74b0\u5883\u5909\u6570\u3068\u304b\u306f\u9069\u5f53\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nLINE developers \u306e\u30da\u30fc\u30b8\u3067\u767b\u9332\u3057\u305f\u3089\u767a\u884c\u3055\u308c\u308b\u306e\u3067\u3002\n\u305d\u3057\u3066\u305d\u306e\u3068\u304d\u306b QR \u3068\u304b\u3082\u51fa\u3066\u304f\u308b\u306e\u3067\u305d\u308c\u3092\u53cb\u9054\u3068\u3057\u3066\u767b\u9332\u3057\u3066\u8a71\u3057\u304b\u3051\u305f\u3089\u8fd4\u3063\u3066\u304d\u307e\u3059 (\u304a\u3057\u307e\u3044)\n\u3068\u306b\u304b\u304f\u4eca\u3059\u3050 Heroku \u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3044\u65b9\u306f\u3053\u3061\u3089\u3002 (\u8981 [LINE BOT API \u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8](https://business.line.me/services/products/4/introduction))\n[![Deploy](https://www.herokucdn.com/deploy/button.png)](https://dashboard.heroku.com/new?button-url=https%3A%2F%2Fgithub.com%2Fyuya-takeyama%2Fline-echo&template=https%3A%2F%2Fgithub.com%2Fyuya-takeyama%2Fline-echo)\n\n---\n\nLINE BOT API \u306e\u547c\u3073\u51fa\u3057\u306b\u306f Server IP Whitelist \u306b\u63a5\u7d9a\u5143 IP \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u3068\u306e\u3053\u3068\u3067\u3001Heroku \u3060\u3068\u96e3\u3057\u3044\u304b\u306a\u30fc\u3001\u3068\u601d\u3044\u307e\u3057\u305f\u304c\u30a2\u30c9\u30aa\u30f3\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\n\n[Fixie](https://elements.heroku.com/addons/fixie)\n\n\u3053\u308c\u3092\u4f7f\u3046\u3068 HTTP \u30d7\u30ed\u30ad\u30b7\u306e URL \u304c\u767a\u884c\u3055\u308c\u3001\u305d\u308c\u3092\u901a\u3057\u3066\u30ea\u30af\u30a8\u30b9\u30c8\u3059\u308c\u3070\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9 IP \u3092\u56fa\u5b9a\u3067\u304d\u308b\u3068\u3044\u3046\u3082\u306e\u3067\u3059\u3002\n\u7121\u6599\u30d7\u30e9\u30f3\u3082\u3042\u308b\u306e\u3067\u305d\u308c\u3092\u4f7f\u3048\u3070\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067\u8a66\u305b\u307e\u3059\u3002\n(\u6700\u521d\u306b [Proximo](https://devcenter.heroku.com/articles/proximo) \u3068\u3044\u3046\u985e\u4f3c\u30a2\u30c9\u30aa\u30f3\u3092\u8a66\u305d\u3046\u3068\u3057\u305f\u3051\u3069\u305d\u3063\u3061\u306f\u7121\u6599\u30d7\u30e9\u30f3\u306a\u304b\u3063\u305f\u306e\u3067\u7121\u99c4\u306b $5 \u53d6\u3089\u308c\u308b\u3063\u307d\u3044\u3002\u3064\u3089\u3044)\n\n```\n$ heroku addons:create fixie:tricycle\n```\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\u30a2\u30a6\u30c8\u30d0\u30a6\u30f3\u30c9 IP \u304c\u51fa\u529b\u3055\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092 LINE BOT API \u306e Server IP Whitelist \u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\n\u5f8c\u304b\u3089\u78ba\u8a8d\u3059\u308b\u5834\u5408\u306f Heroku \u4e0a\u3067\u4f5c\u3063\u305f\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\u753b\u9762\u304b\u3089 Fixie \u306e\u753b\u9762\u3092\u958b\u304f\u3068 Account \u306e\u753b\u9762\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n![Fixie 2016-04-09 11-38-30.png](https://qiita-image-store.s3.amazonaws.com/0/208/d725b717-43e3-12ea-6af7-5d83aaa19c48.png)\n\n\u3068\u308a\u3042\u3048\u305a\u8a66\u3059\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306f\u3001@masuidrive \u3055\u3093\u306e[\u3068\u308a\u3042\u3048\u305aLINE BOT API\u3067\u30aa\u30a6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u305f](http://qiita.com/masuidrive/items/1042d93740a7a72242a3)\u3092\u307b\u307c\u4e38\u30d1\u30af\u30ea\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002 (\u3059\u3044\u307e\u305b\u3093)\n\n```rb:config.ru\n# Mostly taken from http://qiita.com/masuidrive/items/1042d93740a7a72242a3\n\nrequire 'bundler/setup'\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\n\nclass App < Sinatra::Base\n  post '/linebot/callback' do\n    params = JSON.parse(request.body.read)\n\n    params['result'].each do |msg|\n      request_content = {\n        to: [msg['content']['from']],\n        toChannel: 1383378250, # Fixed  value\n        eventType: \"138311608800106203\", # Fixed value\n        content: msg['content']\n      }\n\n      endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n      content_json = request_content.to_json\n\n      RestClient.proxy = ENV[\"FIXIE_URL\"]\n      RestClient.post(endpoint_uri, content_json, {\n        'Content-Type' => 'application/json; charset=UTF-8',\n        'X-Line-ChannelID' => ENV[\"LINE_CHANNEL_ID\"],\n        'X-Line-ChannelSecret' => ENV[\"LINE_CHANNEL_SECRET\"],\n        'X-Line-Trusted-User-With-ACL' => ENV[\"LINE_CHANNEL_MID\"],\n      })\n    end\n\n    \"OK\"\n  end\nend\n\nrun App\n```\n\n\u30bd\u30fc\u30b9\u306f\u3053\u3053\u306b\u7f6e\u3044\u3066\u307e\u3059\u3002 (masuidrive \u3055\u3093\u306b\u6012\u3089\u308c\u305f\u3089\u6d88\u3059)\nhttps://github.com/yuya-takeyama/line-echo\nLINE_CHANNEL_ID \u306e\u74b0\u5883\u5909\u6570\u3068\u304b\u306f\u9069\u5f53\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nLINE developers \u306e\u30da\u30fc\u30b8\u3067\u767b\u9332\u3057\u305f\u3089\u767a\u884c\u3055\u308c\u308b\u306e\u3067\u3002\n\u305d\u3057\u3066\u305d\u306e\u3068\u304d\u306b QR \u3068\u304b\u3082\u51fa\u3066\u304f\u308b\u306e\u3067\u305d\u308c\u3092\u53cb\u9054\u3068\u3057\u3066\u767b\u9332\u3057\u3066\u8a71\u3057\u304b\u3051\u305f\u3089\u8fd4\u3063\u3066\u304d\u307e\u3059 (\u304a\u3057\u307e\u3044)\n", "tags": ["Line", "Heroku"]}