{"tags": ["mruby", "GR-CITRUS", "WA-MIKAN", "Rubic", "mrbgems"], "context": "\u524d\u56de\u306f\u81ea\u529b\u3067NTP\u306b\u63a5\u7d9a\u3057\u3066UnixTime\u3092\u5909\u63db\u3057\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30eamrbgems\u3092\u4f7f\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002GR-CITRUS\u306emruby\u306bmrbgems\u3092\u7d44\u307f\u8fbc\u3080\u305f\u3081\u306b\u306f\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u74b0\u5883\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nmrbgems\u3068\u306f\uff1f\nmruby\u306e\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002Ruby\u306erubygems\u306b\u5bfe\u3057\u3066mruby\u306fmrbgems\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u3001ruby\u306f\u6700\u521d\u304b\u3089\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8c4a\u5bcc\u306b\u4f7f\u3048\u308b\u306e\u306b\u5bfe\u3057\u3066\u3001mruby\u306f\u5fc5\u8981\u6700\u4f4e\u9650\u3068\u3044\u3046\u7cbe\u795e\u306e\u5143\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u6700\u521d\u304b\u3089\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\u4f7f\u3046\u305f\u3081\u306b\u306fmruby\u306bmrbgems\u3092\u7d44\u307f\u8fbc\u3093\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u306a\u304a\u3055\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u74b0\u5883\u69cb\u7bc9\u306e\u4e3b\u306a\u6d41\u308c\nGR-CITRUS\u306emruby\u518d\u69cb\u7bc9\u306b\u306f\u4ee5\u4e0b\u624b\u9806\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306fWindows\u4e0a\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n\u30d3\u30eb\u30c9\u74b0\u5883(Ruby)\u306e\u6e96\u5099\n\u30d3\u30eb\u30c9\u74b0\u5883(Bison)\u306e\u6e96\u5099\n\u30d3\u30eb\u30c9\u74b0\u5883(Mingw)\u306e\u6e96\u5099\nRX\u7528\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30e9\u6e96\u5099\nmruby\u30d3\u30eb\u30c9\uff06GR-CITRUS\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\n\n\u305d\u308c\u3068\u3001git\u3092\u4f7f\u3046\u306e\u3067\u7121\u3044\u65b9\u306f\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u30d3\u30eb\u30c9\u74b0\u5883(Ruby)\u306e\u6e96\u5099\nRubyInstaller\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u3053\u3053\u3067\u306frubyinstaller-2.3.1\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\nruby\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092ON\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://rubyinstaller.org/\n\n\u30d3\u30eb\u30c9\u74b0\u5883(Bison)\u306e\u6e96\u5099\nBison\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3088\u308a\nDownload\u300cComplete package, except sources\u300d\u306e\u300cSetup\u300d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://gnuwin32.sourceforge.net/packages/bison.htm\n\u3053\u3053\u3067\u306f\u3001bison-2.4.1-setup\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n\u300cD:\\tools\\GnuWin32\u300d\n\n\n\u30d3\u30eb\u30c9\u74b0\u5883(Mingw)\u306e\u6e96\u5099\nmruby\u30d3\u30eb\u30c9\u6642\u3068GR-CITRUS\u7528\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\u6642\u306b\u3001Make\u306a\u3069\u306e\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u305f\u3081\u3001Mingw\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002Cygwin\u3067\u3082OK\u3067\u3059\u304c\u3001\u3061\u3063\u3061\u3083\u3044\u6700\u4f4e\u9650\u306eMingw\u306e\u65b9\u304c\u79c1\u306f\u597d\u304d\u3002(\u203b\u3082\u3057Cygwin\u306a\u3069\u3067gcc\u3092\u5165\u308c\u3066\u3042\u308b\u5834\u5408\u306f\u4e0d\u8981\u3067\u3059\u3002)\nhttp://www.mingw.org/ \u304b\u3089Mingw\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\uff08mingw-get-setup.exe\uff09\n\nExe\u5b9f\u884c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3059\u308b\uff08\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306fD:\\tools\\MinGW\\\u3068\u3057\u307e\u3057\u305f\uff09\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d42\u4e86\u5f8c\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u9078\u629e\u753b\u9762\u304c\u51fa\u308b\u306e\u3067\u3001\u300cBasic Setup\u300d\u306emigw32-base, mingw32-gcc-g++ \u306e 2 \u3064\u3092\u9078\u629e(Mark for Installation)\u3002\n\n\u9078\u629e\u5f8c\u3001\u30e1\u30cb\u30e5\u30fc\u306e\u300cInstallation\u300d\u21d2\u300cApply Changes\u300d\u3092\u9078\u629e\n\n\nRX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u666e\u901a\u306e\u65b9\u6cd5\u3060\u3068\n\n\nGNU Tools\u3067\u30e6\u30fc\u30b6\u30fc\u767b\u9332\nGNURXv1403-ELF.exe\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nExe\u5b9f\u884c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3059\u308b\u3002\n\n\u306a\u3093\u3067\u3059\u304c\u3001\u7c21\u5358\u306a\u306e\u3067\u304a\u52e7\u3081\u306ftakjn\u3055\u3093\u306e\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bIDE for GR\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002IDE for GR\u306fArduino\u98a8\u306bGR-CITRUS\u3092\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3059\u308b\u30bd\u30d5\u30c8\u3067\u4e2d\u306bRX\u7528\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u5165\u3063\u3066\u304a\u308a\u3001\u305d\u306e\u307e\u307e\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u305d\u3061\u3089\u306b\u7fd2\u3063\u3066\uff08\u3068\u3044\u3046\u304b\u307b\u3068\u3093\u3069\u305d\u306e\u307e\u307e\uff09\u305d\u306e\u624b\u9806\u3092\u884c\u3044\u307e\u3059\u3002\n\nIDE for GR\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n\u304c\u3058\u3047\u3063\u3068\u308b\u306d\u3055\u3059\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089IDE for GR 0.8.0\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nzip\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u3092\u4efb\u610f\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u89e3\u51cd\n\u3053\u3053\u3067\u306f\u300cD:\\tools\\idegr\\ide4gr-E0.8.0\\\u300d\u306b\u89e3\u51cd\u3057\u307e\u3057\u305f\u3002\n\n\nGNU_RX_elf.bat\u306e\u4fee\u6b63\nIDE for GR \u89e3\u51cd\u5f8c\u306e\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n* D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\GNU_RX_elf.bat\nSet Path\u3092\u4fee\u6b63\u3057\u3001Bison\u3068Mingw\u3068RX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nGNU_RX_elf.bat\n@Echo Off\nREM Set PATH=C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\rx-elf/rx-elf\\bin;C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\OtherU~1;C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\rx-elf/rx-elf\\libexec\\gcc\\rx-elf\\4.8-GNURX_v14.03;%PATH%\nSet PATH=Set PATH=D:\\tools\\GnuWin32\\bin;D:\\tools\\MinGW\\bin;D:\\tools\\MinGW\\msys\\1.0\\bin;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\rx-elf\\rx-elf\\bin;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\Other Utilities;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\rx-elf\\rx-elf\\libexec\\gcc\\rx-elf\\4.8-GNURX_v14.03;%PATH%\n\n\nSet MAKE_MODE=unix\n\nREM cd \"C:\\Program Files\\KPIT\\GNURXv14.03-ELF\"\n\nCmd \"cd\\\" /k\n\n\n\nmruby\u30d3\u30eb\u30c9\uff06GR-CITRUS\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\nmruby\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\ngithub\u304b\u3089\u843d\u3068\u3057\u307e\u3059\u3002\ngit clone https://github.com/mruby/mruby\n\n\u3053\u3053\u3067\u306f\n\n\u300cd:\\work\u300d\u306b\u843d\u3068\u3057\u307e\u3057\u305f\u3002\n\n\nGR-CITRUS\u7528\u306ebuild_config.rb\u306e\u6e96\u5099\nmruby\u306emruby\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3042\u308bbuild_config.rb\u3092takjn\u3055\u3093\u516c\u958b\u306e\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n(takjn\u3055\u3093\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002)\nhttps://github.com/takjn/mruby/blob/rx630/examples/targets/build_config_RX630.rb\n\u203bbuild_config_RX630.rb\u306ftakjn\u3055\u3093\u304c\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u516c\u958b\u3057\u3066\u4e0b\u3055\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3059\u3002\n\u516c\u5f0f\u306emruby\u3084GR-CITRUS\u3068\u306f\u4e00\u5207\u306e\u95a2\u4fc2\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u81ea\u5df1\u8cac\u4efb\u3067\u306e\u5229\u7528\u3068\u306a\u308b\u3053\u3068\u3092\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nbuild_config.rb\u306e\u4fee\u6b63\n\n\u4e0a\u8a18\u3067\u53d6\u5f97\u3057\u305fbuild_config.rb\u306eBIN_PATH\u3092\u81ea\u8eab\u306eRX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u8ffd\u52a0\u3059\u308bmrbgems\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002#gems from core\u306e\u9805\u306e\u6700\u5f8c\u306b\u3001\u300c  conf.gem :core => \"mruby-time\"\u300d\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\nbuild_config.rb\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n  # Linux\n  BIN_PATH = \"D:/tools/idegr/ide4gr-E0.8.0/hardware/tools/gcc-rx/rx-elf/rx-elf/bin\"\n\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n  #gems from core\n  conf.gem :core => \"mruby-sprintf\"\n  conf.gem :core => \"mruby-print\"\n  conf.gem :core => \"mruby-math\"\n  conf.gem :core => \"mruby-enum-ext\"\n  conf.gem :core => \"mruby-numeric-ext\"\n  conf.gem :core => \"mruby-time\" #\u2190\u8ffd\u52a0\n\n\n\n\nGR-CITRUS\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\ngithub\u304b\u3089\u843d\u3068\u3057\u307e\u3059\u3002\ngit clone https://github.com/wakayamarb/wrbb-v2lib-firm/tree/master/firmware_develop\n\n\u3053\u3053\u3067\u306f\n\n\u300cd:\\work\u300d\u306b\u843d\u3068\u3057\u307e\u3057\u305f\u3002\n\n\nmake\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n\n\u300cGNU_PATH := \u300d\u306e\u90e8\u5206\u3092\u81ea\u8eab\u306eRX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nGNU_PATH := D:/tools/idegr/ide4gr-E0.8.0/hardware/tools/gcc-rx/rx-elf/rx-elf/\n\n\nmruby\u30d3\u30eb\u30c9\n\u5148\u306b\u7de8\u96c6\u3057\u305f\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30ebGNU_RX_elf.bat\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nD:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\GNU_RX_elf.bat\n\n\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u5b9f\u884c\u5f8c\u306b\u51fa\u305f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u64cd\u4f5c\u3057\u3066build_config.rb\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nruby ./minirake\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u6210\u529f\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8868\u793a\u304c\u51fa\u3066\u3001mruby/build\u30d5\u30a9\u30eb\u30c0\u306bhost\u30d5\u30a9\u30eb\u30c0\u3068RX630\u30d5\u30a9\u30eb\u30c0\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\uff08\u203b2\u56de\u76ee\u4ee5\u964d\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5834\u5408\u306fbuild\u30d5\u30a9\u30eb\u30c0\u3092\u7a7a\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u524d\u56de\u30b3\u30f3\u30d1\u30a4\u30eb\u5206\u304c\u6b8b\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u524a\u9664\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n================================================\n      Config Name: RX630\n Output Directory: build/RX630\n    Included Gems:\n             mruby-sprintf - standard Kernel#sprintf method\n             mruby-print - standard print/puts/p\n             mruby-math - standard Math module\n             mruby-enum-ext - Enumerable module extension\n             mruby-numeric-ext - Numeric class extension\n             mruby-time - standard Time class\n================================================\n\n\nGR-CITRUS\u306e\u30bd\u30fc\u30b9\u3092\u30d3\u30eb\u30c9\n\nmruby\u3092\u30d3\u30eb\u30c9\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306b\u3042\u308b\u3001mruby\\build\\RX630\\lib\\libmruby.a\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nGR-CITRUS\u306e\u30bd\u30fc\u30b9\u306e\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306b\u3042\u308bwrbb-v2lib-firm\\firmware\\wrbb_mruby\\libmruby.a\u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u3057\u307e\u3059\u3002\nfirmware\u30d5\u30a9\u30eb\u30c0\u306b\u79fb\u52d5\u3057\u3066\u3001make\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nmake\n\u30fb\u30fb\u30fb\u30fb\u4e2d\u7565\u3001\u6b63\u5e38\u7d42\u4e86\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8868\u793a\u3068\u306a\u308b\u30fb\u30fb\u30fb\u30fb\nrx-elf-objcopy -O binary ./gr_build/citrus_sketch.x  citrus_sketch.bin\nrx-elf-objcopy -O srec -I elf32-rx-be-ns ./gr_build/citrus_sketch.x  ./gr_build/\ncitrus_sketch.mot\n\n\ncitrus_sketch.bin\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u305f\u306e\u3092\u78ba\u8a8d\u3002\nGR-CITRUS\u306e\u30ea\u30bb\u30c3\u30c8\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066USB\u30e1\u30e2\u30ea\u3068\u3057\u3066\u8a8d\u8b58\u3055\u305b\u305f\u5f8c\u3001citrus_sketch.bin\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n\n\u3053\u308c\u3067mruby-time\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\nmruby-time\u306e\u30c6\u30b9\u30c8\n\u3067\u306f\u3001Rubic\u3067mruby-time\u3092\u4f7f\u3063\u3066Unix-Time\u3092\u5909\u63db\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u4f7f\u3044\u65b9\u306f\nt = Time.at(UnixTime)\n\n\u3060\u3051\u3067\u3059\u306e\u3067\u5b9f\u306b\u7c21\u5358\u3067\u3059\u3002\nNTP\u3067\u6642\u523b\u60c5\u5831\u3092\u3068\u3063\u3066\u3001Unix-Time\u3092\u901a\u5e38\u6642\u523b\u306b\u5909\u63db\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nmain.rb\n#!mruby\nSSID=\"\u3042\u306a\u305f\u306eSSID\"\nPASS=\"\u3042\u306a\u305f\u306ePASS\"\nNTP_PACKET_SIZE = 48\ntimeServer=\"132.163.4.101\" #time-a.timefreq.bldrdoc.gov\n#timeServer=\"129.6.15.28\"  #time.nist.gov\ntimeZone = 9 #Tokyo\nlocalPort = 8788 #local port to listen for UDP packets\nsendPort = 123 # NTP requests are to port 123\npollIntv = 150      # poll every this many ms\nmaxPoll = 15        # poll up to this many times\n\nUsb = Serial.new(0)\n\n#ESP8266\u3092\u4e00\u5ea6\u505c\u6b62\u3055\u305b\u308b(\u30ea\u30bb\u30c3\u30c8\u3068\u540c\u3058)\npinMode(5,1)\ndigitalWrite(5,0) # LOW:Disable\ndelay 500\ndigitalWrite(5,1) # LOW:Disable\n\nif( System.useWiFi() == 0)then\nUsb.println \"WiFi Card can't use.\"\nSystem.exit() \nend\n\n#WiFi\u63a5\u7d9a\u6e96\u5099\u3092\u3059\u308b\u3002\nUsb.println \"WiFi Ready\"\n\nUsb.println \"WiFi Get Version\"\nUsb.println WiFi.version\n\nUsb.println \"WiFi disconnect\"\nUsb.println WiFi.disconnect\n\nUsb.println \"WiFi Mode Setting\"\nUsb.println WiFi.setMode 3 #Station-Mode & SoftAPI-Mode\n\nUsb.println \"WiFi ipconfig\"\nUsb.println WiFi.ipconfig\n\nUsb.println \"WiFi connecting\"\nUsb.println WiFi.connect(SSID,PASS)\n\nUsb.println \"WiFi ipconfig\"\nUsb.println WiFi.ipconfig\n\nUsb.println \"WiFi multiConnect Set\"\nUsb.println WiFi.multiConnect 1\n\n#NTP\u7528\u8981\u6c42\u30d1\u30b1\u30c3\u30c8\u3092\u4f5c\u308b\npacketBuffer = Array.new(NTP_PACKET_SIZE , 0)\npacketBuffer[0] = 0b11100011   # LI, Version, Mode\npacketBuffer[1] = 0     # Stratum, or type of clock\npacketBuffer[2] = 6     # Polling Interval\npacketBuffer[3] = 0xEC  # Peer Clock Precision\n\nbinary = packetBuffer[0].chr\nfor num in 1..NTP_PACKET_SIZE-1 do\n    binary += packetBuffer[num].chr\nend\n\n#NTP\u30b5\u30fc\u30d0\u30fc\u306bUDP\u63a5\u7d9a\u3057\u3066\u8981\u6c42\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u308b\nUsb.println \"UDP OPEN\"\nUsb.println WiFi.udpOpen(1, timeServer, sendPort, localPort)\nUsb.println \"UDP SEND \" + packetBuffer.length.to_s + \" Data:\" + packetBuffer.to_s\nWiFi.send( 1,binary)\n\n#NTP\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u30d1\u30b1\u30c3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3002\narray = WiFi.recv 1\nmaxPoll.times do\n  delay(pollIntv)    \n  if (array[0] >= 0) then\n      if (array.length == 48) then\n          break\n      end  \n  end\n  array = WiFi.recv 1   \nend\nWiFi.cClose(1)\n\n#\u5fdc\u7b54\u30d1\u30b1\u30c3\u30c8\u304c48\u30d0\u30a4\u30c8\u3067\u306a\u3051\u308c\u3070\u7d42\u4e86\nif array.length != 48 then\n    System.exit() \nend    \n\nUsb.println array.to_s\n\n#40\u304b\u308943\u30d0\u30a4\u30c8\u76ee\u306b\u6642\u523b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\ntime = array[40]\nfor i in 1..3 do\n  time = time << 8 | array[40+i]\nend\n\n#UNIX\u30bf\u30a4\u30e0\u306f1970\u5e741\u67081\u65e50\u6642\u304b\u3089\u59cb\u307e\u308b\n#1900\u5e74\u304b\u30891970\u5e74\u306e70\u5e74\u3092\u79d2\u3067\u8868\u3059\u30682208988800\u79d2\u306b\u306a\u308b\nUnixTime    = time - 2208988800 # convert NTP time to Unix time\nUnixTimeJST = UnixTime + (timeZone * 60 * 60) #\u6771\u4eac\u306e\u6642\u523b\u306b\u5909\u66f4\u3059\u308b\nUsb.println UnixTimeJST.to_s #1970\u5e74\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593(\u79d2)\n\nt = Time.at(UnixTimeJST) #mruby-time\u306b\u3088\u308b\u5909\u63db\nUsb.println t.to_s\n\n\n\u3060\u3044\u3076\u7c21\u5358\u304b\u3064\u3001\u30b3\u30fc\u30c9\u3082\u77ed\u304f\u306a\u308a\u307e\u3057\u305f\u3002mrbgems\u3059\u3070\u3089\u3057\u3044\u3002\n\u3053\u306e\u307b\u304b\u306b\u3082mrbgems\u306f\u8272\u3005\u3042\u308b\u306e\u3067\u7528\u9014\u306b\u5fdc\u3058\u3066\u7d44\u307f\u8fbc\u3093\u3067\u307f\u308b\u306e\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002\u6b21\u56de\u306f\u4eca\u307e\u3067\u306e\u3053\u3068\u3092\u7d44\u307f\u5408\u308f\u305b\u3066Iot\u9ce9\u6642\u8a08\u3089\u3057\u304d\u3082\u306e\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n\u304a\u307e\u3051\n\u73fe\u72b6\u3060\u3068NTP\u304b\u3089\u6642\u523b\u3092\u3068\u3063\u3066\u3044\u308b\u306e\u306b\u3001\uff11\uff5e\uff12\u5206\u6642\u9593\u304c\u305a\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u6642\u523b\u306e\u5909\u63db\u306b\u6b63\u78ba\u6027\u3092\u6c42\u3081\u306a\u304b\u3063\u305f\u7406\u7531\u306fUnixTime\u306e\u6841\u304c\u5927\u304d\u3044\u306e\u3067GR-CITRUS\u3067\u306f\u8868\u73fe\u3057\u304d\u308c\u306a\u304b\u3063\u305f\u305f\u3081\u3067\u3059\u3002mruby\u306fBigNum\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067Int\u3088\u308a\u5927\u304d\u3044\u6570\u5b57\u306f\u6697\u9ed9\u7684\u306bfloat\u306b\u30ad\u30e3\u30b9\u30c8\u3055\u308c\u308b\u4ed5\u69d8\u3067\u3059\u3002\n(\u53c2\u8003)https://github.com/mruby/mruby/issues/2979#issuecomment-146308854\nGR-CITRUS\u306f\u5b9f\u6570\u306e\u53d6\u6271\u3044\u304c\u6a19\u6e96\u3060\u3068FLOAT\u3067\u3042\u308a\u7cbe\u5ea6\u304c\u9ad8\u304f\u3042\u308a\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u3001\u304d\u3061\u3093\u3068UnixTime\u3092\u53d6\u308a\u6271\u3046\u306b\u306f\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306bbuild_config.rb\u306e\u8a2d\u5b9a\u304b\u3089MRB_USE_FLOAT\u3092\u5916\u3057\u3066\u5b9f\u6570\u306e\u7cbe\u5ea6\u3092DOUBLE\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u203b\u901a\u5e38\u3088\u308a\u4f7f\u7528\u30e1\u30e2\u30ea\u7b49\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\uff09\n\nbuild_config.rb\n    #configuration for low memory environment\n    #cc.defines << %w(MRB_USE_FLOAT) #\u7121\u52b9\u306b\u3059\u308b\n\n\n\u3053\u308c\u3067mruby\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\u305d\u306e\u3042\u3068\u3001GR-CITRUS\u3082\u5408\u308f\u305b\u3066\nwrbb-v2lib-firm-master\\firmware\\wrbb_mruby\\include\\mrbconf.h\n\u306eMRB_USE_FLOAT\u3092\u5916\u3057\u307e\u3059\u3002\n\nmrbconf.h\n/* configuration options: */\n/* add -DMRB_USE_FLOAT to use float instead of double for floating point numbers */\n//#define MRB_USE_FLOAT //\u7121\u52b9\u306b\u3059\u308b\n\n\n\u3053\u308c\u3067\u3001GR-CITRUS\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308c\u3070OK\u3067\u3059\u3002\n\u524d\u56de\u306f\u81ea\u529b\u3067NTP\u306b\u63a5\u7d9a\u3057\u3066UnixTime\u3092\u5909\u63db\u3057\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30eamrbgems\u3092\u4f7f\u3044\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002GR-CITRUS\u306emruby\u306bmrbgems\u3092\u7d44\u307f\u8fbc\u3080\u305f\u3081\u306b\u306f\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30eb\u74b0\u5883\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n#mrbgems\u3068\u306f\uff1f\nmruby\u306e\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002Ruby\u306erubygems\u306b\u5bfe\u3057\u3066mruby\u306fmrbgems\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\u3001ruby\u306f\u6700\u521d\u304b\u3089\u62e1\u5f35\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u8c4a\u5bcc\u306b\u4f7f\u3048\u308b\u306e\u306b\u5bfe\u3057\u3066\u3001mruby\u306f\u5fc5\u8981\u6700\u4f4e\u9650\u3068\u3044\u3046\u7cbe\u795e\u306e\u5143\u306b\u4f5c\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u6700\u521d\u304b\u3089\u306f\u4f7f\u3048\u307e\u305b\u3093\u3002\u4f7f\u3046\u305f\u3081\u306b\u306fmruby\u306bmrbgems\u3092\u7d44\u307f\u8fbc\u3093\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u306a\u304a\u3055\u306a\u3044\u3068\u3044\u3051\u307e\u305b\u3093\u3002\n\n#\u74b0\u5883\u69cb\u7bc9\u306e\u4e3b\u306a\u6d41\u308c\nGR-CITRUS\u306emruby\u518d\u69cb\u7bc9\u306b\u306f\u4ee5\u4e0b\u624b\u9806\u304c\u5fc5\u8981\u3068\u306a\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306fWindows\u4e0a\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n\n+ \u30d3\u30eb\u30c9\u74b0\u5883(Ruby)\u306e\u6e96\u5099\n+ \u30d3\u30eb\u30c9\u74b0\u5883(Bison)\u306e\u6e96\u5099\n+ \u30d3\u30eb\u30c9\u74b0\u5883(Mingw)\u306e\u6e96\u5099\n+ RX\u7528\u30af\u30ed\u30b9\u30b3\u30f3\u30d1\u30a4\u30e9\u6e96\u5099\n+ mruby\u30d3\u30eb\u30c9\uff06GR-CITRUS\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\n\n\u305d\u308c\u3068\u3001[git](https://git-for-windows.github.io/)\u3092\u4f7f\u3046\u306e\u3067\u7121\u3044\u65b9\u306f\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n#\u30d3\u30eb\u30c9\u74b0\u5883(Ruby)\u306e\u6e96\u5099\nRubyInstaller\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\u3053\u3053\u3067\u306frubyinstaller-2.3.1\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\nruby\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3078\u306e\u30d1\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092ON\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://rubyinstaller.org/\n\n#\u30d3\u30eb\u30c9\u74b0\u5883(Bison)\u306e\u6e96\u5099\nBison\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306f\u4ee5\u4e0b\u30b5\u30a4\u30c8\u3088\u308a\nDownload\u300cComplete package, except sources\u300d\u306e\u300cSetup\u300d\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://gnuwin32.sourceforge.net/packages/bison.htm\n\n\u3053\u3053\u3067\u306f\u3001bison-2.4.1-setup\u3092\u5229\u7528\u3057\u307e\u3057\u305f\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n+ \u300cD:\\tools\\GnuWin32\u300d\n\n\n#\u30d3\u30eb\u30c9\u74b0\u5883(Mingw)\u306e\u6e96\u5099\nmruby\u30d3\u30eb\u30c9\u6642\u3068GR-CITRUS\u7528\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\u6642\u306b\u3001Make\u306a\u3069\u306e\u30d3\u30eb\u30c9\u30c4\u30fc\u30eb\u3092\u4f7f\u3046\u305f\u3081\u3001Mingw\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002Cygwin\u3067\u3082OK\u3067\u3059\u304c\u3001\u3061\u3063\u3061\u3083\u3044\u6700\u4f4e\u9650\u306eMingw\u306e\u65b9\u304c\u79c1\u306f\u597d\u304d\u3002(\u203b\u3082\u3057Cygwin\u306a\u3069\u3067gcc\u3092\u5165\u308c\u3066\u3042\u308b\u5834\u5408\u306f\u4e0d\u8981\u3067\u3059\u3002)\n\nhttp://www.mingw.org/ \u304b\u3089Mingw\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\uff08mingw-get-setup.exe\uff09\n![image](https://qiita-image-store.s3.amazonaws.com/0/151653/3dd9bd24-8c57-3667-b9d7-558d9d066876.png)\n\nExe\u5b9f\u884c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3059\u308b\uff08\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306fD:\\tools\\MinGW\\\u3068\u3057\u307e\u3057\u305f\uff09\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7d42\u4e86\u5f8c\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u9078\u629e\u753b\u9762\u304c\u51fa\u308b\u306e\u3067\u3001\u300cBasic Setup\u300d\u306emigw32-base, mingw32-gcc-g++ \u306e 2 \u3064\u3092\u9078\u629e(Mark for Installation)\u3002\n![lang_mingw_inst_select.png](https://qiita-image-store.s3.amazonaws.com/0/151653/a1fb1485-500a-62de-6790-02999248d4fd.png)\n\n\u9078\u629e\u5f8c\u3001\u30e1\u30cb\u30e5\u30fc\u306e\u300cInstallation\u300d\u21d2\u300cApply Changes\u300d\u3092\u9078\u629e\n![image](https://qiita-image-store.s3.amazonaws.com/0/151653/e5f7b93e-5448-678e-a681-9195ca6999c0.png)\n\n\n\n#RX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u666e\u901a\u306e\u65b9\u6cd5\u3060\u3068\n\n1. [GNU Tools](https://gcc-renesas.com/ja/)\u3067\u30e6\u30fc\u30b6\u30fc\u767b\u9332\n+ GNURXv1403-ELF.exe\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n+ Exe\u5b9f\u884c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u8d77\u52d5\u3059\u308b\u3002\n\n\u306a\u3093\u3067\u3059\u304c\u3001\u7c21\u5358\u306a\u306e\u3067\u304a\u52e7\u3081\u306f[takjn\u3055\u3093](http://qiita.com/takjn/items/42fa8ad0c61a8840a9c2#_reference-7eace0853ad79f7e59fe)\u306e\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308bIDE for GR\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u3067\u3059\u3002IDE for GR\u306fArduino\u98a8\u306bGR-CITRUS\u3092\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3059\u308b\u30bd\u30d5\u30c8\u3067\u4e2d\u306bRX\u7528\u306e\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u5165\u3063\u3066\u304a\u308a\u3001\u305d\u306e\u307e\u307e\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u305d\u3061\u3089\u306b\u7fd2\u3063\u3066\uff08\u3068\u3044\u3046\u304b\u307b\u3068\u3093\u3069\u305d\u306e\u307e\u307e\uff09\u305d\u306e\u624b\u9806\u3092\u884c\u3044\u307e\u3059\u3002\n\n\n\n##IDE for GR\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n+ \u304c\u3058\u3047\u3063\u3068\u308b\u306d\u3055\u3059\u306eWeb\u30b5\u30a4\u30c8\u304b\u3089[IDE for GR 0.8.0](http://gadget.renesas.com/ja/product/ide4gr.html)\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n+ zip\u30d5\u30a1\u30a4\u30eb\u306e\u4e2d\u8eab\u3092\u4efb\u610f\u306e\u30d5\u30a9\u30eb\u30c0\u306b\u89e3\u51cd\n+ \u3053\u3053\u3067\u306f\u300cD:\\tools\\idegr\\ide4gr-E0.8.0\\\u300d\u306b\u89e3\u51cd\u3057\u307e\u3057\u305f\u3002\n\n##GNU_RX_elf.bat\u306e\u4fee\u6b63\n\nIDE for GR \u89e3\u51cd\u5f8c\u306e\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n* D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\GNU_RX_elf.bat\n\nSet Path\u3092\u4fee\u6b63\u3057\u3001Bison\u3068Mingw\u3068RX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```GNU_RX_elf.bat\n@Echo Off\nREM Set PATH=C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\rx-elf/rx-elf\\bin;C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\OtherU~1;C:\\PROGRA~1\\KPIT\\GNURXV~2.03-\\rx-elf/rx-elf\\libexec\\gcc\\rx-elf\\4.8-GNURX_v14.03;%PATH%\nSet PATH=Set PATH=D:\\tools\\GnuWin32\\bin;D:\\tools\\MinGW\\bin;D:\\tools\\MinGW\\msys\\1.0\\bin;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\rx-elf\\rx-elf\\bin;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\Other Utilities;D:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\rx-elf\\rx-elf\\libexec\\gcc\\rx-elf\\4.8-GNURX_v14.03;%PATH%\n\n\nSet MAKE_MODE=unix\n\nREM cd \"C:\\Program Files\\KPIT\\GNURXv14.03-ELF\"\n\nCmd \"cd\\\" /k\n```\n\n#mruby\u30d3\u30eb\u30c9\uff06GR-CITRUS\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u30d3\u30eb\u30c9\nmruby\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\n\ngithub\u304b\u3089\u843d\u3068\u3057\u307e\u3059\u3002\n\n```\ngit clone https://github.com/mruby/mruby\n```\n\n\u3053\u3053\u3067\u306f\n\n+ \u300cd:\\work\u300d\u306b\u843d\u3068\u3057\u307e\u3057\u305f\u3002\n\n##GR-CITRUS\u7528\u306ebuild_config.rb\u306e\u6e96\u5099\nmruby\u306emruby\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3042\u308bbuild_config.rb\u3092takjn\u3055\u3093\u516c\u958b\u306e\u4ee5\u4e0b\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n(takjn\u3055\u3093\u3001\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\u3002\u5229\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002)\n\nhttps://github.com/takjn/mruby/blob/rx630/examples/targets/build_config_RX630.rb\n\n\u203bbuild_config_RX630.rb\u306ftakjn\u3055\u3093\u304c\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\u516c\u958b\u3057\u3066\u4e0b\u3055\u3063\u3066\u3044\u308b\u3082\u306e\u3067\u3059\u3002\n\u516c\u5f0f\u306emruby\u3084GR-CITRUS\u3068\u306f\u4e00\u5207\u306e\u95a2\u4fc2\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u81ea\u5df1\u8cac\u4efb\u3067\u306e\u5229\u7528\u3068\u306a\u308b\u3053\u3068\u3092\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n##build_config.rb\u306e\u4fee\u6b63\n\n+ \u4e0a\u8a18\u3067\u53d6\u5f97\u3057\u305fbuild_config.rb\u306eBIN_PATH\u3092\u81ea\u8eab\u306eRX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n+ \u8ffd\u52a0\u3059\u308bmrbgems\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002#gems from core\u306e\u9805\u306e\u6700\u5f8c\u306b\u3001\u300c  conf.gem :core => \"mruby-time\"\u300d\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```build_config.rb\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n  # Linux\n  BIN_PATH = \"D:/tools/idegr/ide4gr-E0.8.0/hardware/tools/gcc-rx/rx-elf/rx-elf/bin\"\n\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\n  #gems from core\n  conf.gem :core => \"mruby-sprintf\"\n  conf.gem :core => \"mruby-print\"\n  conf.gem :core => \"mruby-math\"\n  conf.gem :core => \"mruby-enum-ext\"\n  conf.gem :core => \"mruby-numeric-ext\"\n  conf.gem :core => \"mruby-time\" #\u2190\u8ffd\u52a0\n\n```\n\n##GR-CITRUS\u306e\u30bd\u30fc\u30b9\u3092\u53d6\u5f97\ngithub\u304b\u3089\u843d\u3068\u3057\u307e\u3059\u3002\n\n```\ngit clone https://github.com/wakayamarb/wrbb-v2lib-firm/tree/master/firmware_develop\n```\n\u3053\u3053\u3067\u306f\n\n+ \u300cd:\\work\u300d\u306b\u843d\u3068\u3057\u307e\u3057\u305f\u3002\n\n\n##make\u30d5\u30a1\u30a4\u30eb\u306e\u4fee\u6b63\n\n+ \u300cGNU_PATH := \u300d\u306e\u90e8\u5206\u3092\u81ea\u8eab\u306eRX\u7528\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u30d1\u30b9\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\n\n\n```makefile\n#\uff5e\uff5e\uff5e\uff5e\u4e2d\u7565\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nGNU_PATH := D:/tools/idegr/ide4gr-E0.8.0/hardware/tools/gcc-rx/rx-elf/rx-elf/\n```\n\n##mruby\u30d3\u30eb\u30c9\n\n\u5148\u306b\u7de8\u96c6\u3057\u305f\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30ebGNU_RX_elf.bat\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nD:\\tools\\idegr\\ide4gr-E0.8.0\\hardware\\tools\\gcc-rx\\GNU_RX_elf.bat\n```\n\n\n\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u5b9f\u884c\u5f8c\u306b\u51fa\u305f\u30b3\u30de\u30f3\u30c9\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u64cd\u4f5c\u3057\u3066build_config.rb\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3001\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nruby ./minirake\n```\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\u304c\u6210\u529f\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8868\u793a\u304c\u51fa\u3066\u3001mruby/build\u30d5\u30a9\u30eb\u30c0\u306bhost\u30d5\u30a9\u30eb\u30c0\u3068RX630\u30d5\u30a9\u30eb\u30c0\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\uff08\u203b2\u56de\u76ee\u4ee5\u964d\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308b\u5834\u5408\u306fbuild\u30d5\u30a9\u30eb\u30c0\u3092\u7a7a\u306b\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u524d\u56de\u30b3\u30f3\u30d1\u30a4\u30eb\u5206\u304c\u6b8b\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u524a\u9664\u3057\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\n```\n================================================\n      Config Name: RX630\n Output Directory: build/RX630\n    Included Gems:\n             mruby-sprintf - standard Kernel#sprintf method\n             mruby-print - standard print/puts/p\n             mruby-math - standard Math module\n             mruby-enum-ext - Enumerable module extension\n             mruby-numeric-ext - Numeric class extension\n             mruby-time - standard Time class\n================================================\n```\n\n##GR-CITRUS\u306e\u30bd\u30fc\u30b9\u3092\u30d3\u30eb\u30c9\n\n+ mruby\u3092\u30d3\u30eb\u30c9\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306b\u3042\u308b\u3001mruby\\build\\RX630\\lib\\libmruby.a\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n2. GR-CITRUS\u306e\u30bd\u30fc\u30b9\u306e\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306b\u3042\u308bwrbb-v2lib-firm\\firmware\\wrbb_mruby\\libmruby.a\u30d5\u30a1\u30a4\u30eb\u3092\u4e0a\u66f8\u304d\u3057\u307e\u3059\u3002\n3. firmware\u30d5\u30a9\u30eb\u30c0\u306b\u79fb\u52d5\u3057\u3066\u3001make\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nmake\n\u30fb\u30fb\u30fb\u30fb\u4e2d\u7565\u3001\u6b63\u5e38\u7d42\u4e86\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8868\u793a\u3068\u306a\u308b\u30fb\u30fb\u30fb\u30fb\nrx-elf-objcopy -O binary ./gr_build/citrus_sketch.x  citrus_sketch.bin\nrx-elf-objcopy -O srec -I elf32-rx-be-ns ./gr_build/citrus_sketch.x  ./gr_build/\ncitrus_sketch.mot\n```\n\n+ citrus_sketch.bin\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u305f\u306e\u3092\u78ba\u8a8d\u3002\n+ GR-CITRUS\u306e\u30ea\u30bb\u30c3\u30c8\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066USB\u30e1\u30e2\u30ea\u3068\u3057\u3066\u8a8d\u8b58\u3055\u305b\u305f\u5f8c\u3001citrus_sketch.bin\u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\n\n\u3053\u308c\u3067mruby-time\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n#mruby-time\u306e\u30c6\u30b9\u30c8\n\u3067\u306f\u3001Rubic\u3067mruby-time\u3092\u4f7f\u3063\u3066Unix-Time\u3092\u5909\u63db\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u4f7f\u3044\u65b9\u306f\n\n```\nt = Time.at(UnixTime)\n```\n\n\u3060\u3051\u3067\u3059\u306e\u3067\u5b9f\u306b\u7c21\u5358\u3067\u3059\u3002\nNTP\u3067\u6642\u523b\u60c5\u5831\u3092\u3068\u3063\u3066\u3001Unix-Time\u3092\u901a\u5e38\u6642\u523b\u306b\u5909\u63db\u3059\u308b\u306e\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n```main.rb\n#!mruby\nSSID=\"\u3042\u306a\u305f\u306eSSID\"\nPASS=\"\u3042\u306a\u305f\u306ePASS\"\nNTP_PACKET_SIZE = 48\ntimeServer=\"132.163.4.101\" #time-a.timefreq.bldrdoc.gov\n#timeServer=\"129.6.15.28\"  #time.nist.gov\ntimeZone = 9 #Tokyo\nlocalPort = 8788 #local port to listen for UDP packets\nsendPort = 123 # NTP requests are to port 123\npollIntv = 150      # poll every this many ms\nmaxPoll = 15        # poll up to this many times\n\nUsb = Serial.new(0)\n\n#ESP8266\u3092\u4e00\u5ea6\u505c\u6b62\u3055\u305b\u308b(\u30ea\u30bb\u30c3\u30c8\u3068\u540c\u3058)\npinMode(5,1)\ndigitalWrite(5,0) # LOW:Disable\ndelay 500\ndigitalWrite(5,1) # LOW:Disable\n\nif( System.useWiFi() == 0)then\nUsb.println \"WiFi Card can't use.\"\nSystem.exit() \nend\n\n#WiFi\u63a5\u7d9a\u6e96\u5099\u3092\u3059\u308b\u3002\nUsb.println \"WiFi Ready\"\n\nUsb.println \"WiFi Get Version\"\nUsb.println WiFi.version\n\nUsb.println \"WiFi disconnect\"\nUsb.println WiFi.disconnect\n\nUsb.println \"WiFi Mode Setting\"\nUsb.println WiFi.setMode 3 #Station-Mode & SoftAPI-Mode\n\nUsb.println \"WiFi ipconfig\"\nUsb.println WiFi.ipconfig\n\nUsb.println \"WiFi connecting\"\nUsb.println WiFi.connect(SSID,PASS)\n\nUsb.println \"WiFi ipconfig\"\nUsb.println WiFi.ipconfig\n\nUsb.println \"WiFi multiConnect Set\"\nUsb.println WiFi.multiConnect 1\n\n#NTP\u7528\u8981\u6c42\u30d1\u30b1\u30c3\u30c8\u3092\u4f5c\u308b\npacketBuffer = Array.new(NTP_PACKET_SIZE , 0)\npacketBuffer[0] = 0b11100011   # LI, Version, Mode\npacketBuffer[1] = 0     # Stratum, or type of clock\npacketBuffer[2] = 6     # Polling Interval\npacketBuffer[3] = 0xEC  # Peer Clock Precision\n\nbinary = packetBuffer[0].chr\nfor num in 1..NTP_PACKET_SIZE-1 do\n    binary += packetBuffer[num].chr\nend\n\n#NTP\u30b5\u30fc\u30d0\u30fc\u306bUDP\u63a5\u7d9a\u3057\u3066\u8981\u6c42\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u308b\nUsb.println \"UDP OPEN\"\nUsb.println WiFi.udpOpen(1, timeServer, sendPort, localPort)\nUsb.println \"UDP SEND \" + packetBuffer.length.to_s + \" Data:\" + packetBuffer.to_s\nWiFi.send( 1,binary)\n\n#NTP\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u306e\u5fdc\u7b54\u30d1\u30b1\u30c3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3002\narray = WiFi.recv 1\nmaxPoll.times do\n  delay(pollIntv)    \n  if (array[0] >= 0) then\n      if (array.length == 48) then\n          break\n      end  \n  end\n  array = WiFi.recv 1   \nend\nWiFi.cClose(1)\n\n#\u5fdc\u7b54\u30d1\u30b1\u30c3\u30c8\u304c48\u30d0\u30a4\u30c8\u3067\u306a\u3051\u308c\u3070\u7d42\u4e86\nif array.length != 48 then\n    System.exit() \nend    \n\nUsb.println array.to_s\n\n#40\u304b\u308943\u30d0\u30a4\u30c8\u76ee\u306b\u6642\u523b\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\ntime = array[40]\nfor i in 1..3 do\n  time = time << 8 | array[40+i]\nend\n\n#UNIX\u30bf\u30a4\u30e0\u306f1970\u5e741\u67081\u65e50\u6642\u304b\u3089\u59cb\u307e\u308b\n#1900\u5e74\u304b\u30891970\u5e74\u306e70\u5e74\u3092\u79d2\u3067\u8868\u3059\u30682208988800\u79d2\u306b\u306a\u308b\nUnixTime    = time - 2208988800 # convert NTP time to Unix time\nUnixTimeJST = UnixTime + (timeZone * 60 * 60) #\u6771\u4eac\u306e\u6642\u523b\u306b\u5909\u66f4\u3059\u308b\nUsb.println UnixTimeJST.to_s #1970\u5e74\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593(\u79d2)\n\nt = Time.at(UnixTimeJST) #mruby-time\u306b\u3088\u308b\u5909\u63db\nUsb.println t.to_s\n```\n\n\u3060\u3044\u3076\u7c21\u5358\u304b\u3064\u3001\u30b3\u30fc\u30c9\u3082\u77ed\u304f\u306a\u308a\u307e\u3057\u305f\u3002mrbgems\u3059\u3070\u3089\u3057\u3044\u3002\n\u3053\u306e\u307b\u304b\u306b\u3082[mrbgems\u306f\u8272\u3005\u3042\u308b](https://github.com/mruby/mgem-list)\u306e\u3067\u7528\u9014\u306b\u5fdc\u3058\u3066\u7d44\u307f\u8fbc\u3093\u3067\u307f\u308b\u306e\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\u4eca\u56de\u306f\u4ee5\u4e0a\u3068\u306a\u308a\u307e\u3059\u3002[\u6b21\u56de\u306f\u4eca\u307e\u3067\u306e\u3053\u3068\u3092\u7d44\u307f\u5408\u308f\u305b\u3066Iot\u9ce9\u6642\u8a08\u3089\u3057\u304d\u3082\u306e\u3092\u4f5c\u308a\u307e\u3059\u3002](http://qiita.com/shimo_cchi/items/54d9109c39ae6151b272)\n\n#\u304a\u307e\u3051\n\u73fe\u72b6\u3060\u3068NTP\u304b\u3089\u6642\u523b\u3092\u3068\u3063\u3066\u3044\u308b\u306e\u306b\u3001\uff11\uff5e\uff12\u5206\u6642\u9593\u304c\u305a\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u6642\u523b\u306e\u5909\u63db\u306b\u6b63\u78ba\u6027\u3092\u6c42\u3081\u306a\u304b\u3063\u305f\u7406\u7531\u306fUnixTime\u306e\u6841\u304c\u5927\u304d\u3044\u306e\u3067GR-CITRUS\u3067\u306f\u8868\u73fe\u3057\u304d\u308c\u306a\u304b\u3063\u305f\u305f\u3081\u3067\u3059\u3002mruby\u306fBigNum\u304c\u4f7f\u3048\u306a\u3044\u306e\u3067Int\u3088\u308a\u5927\u304d\u3044\u6570\u5b57\u306f\u6697\u9ed9\u7684\u306bfloat\u306b\u30ad\u30e3\u30b9\u30c8\u3055\u308c\u308b\u4ed5\u69d8\u3067\u3059\u3002\n(\u53c2\u8003)https://github.com/mruby/mruby/issues/2979#issuecomment-146308854\n\nGR-CITRUS\u306f\u5b9f\u6570\u306e\u53d6\u6271\u3044\u304c\u6a19\u6e96\u3060\u3068FLOAT\u3067\u3042\u308a\u7cbe\u5ea6\u304c\u9ad8\u304f\u3042\u308a\u307e\u305b\u3093\u3002\n\u305d\u306e\u305f\u3081\u3001\u304d\u3061\u3093\u3068UnixTime\u3092\u53d6\u308a\u6271\u3046\u306b\u306f\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306bbuild_config.rb\u306e\u8a2d\u5b9a\u304b\u3089MRB_USE_FLOAT\u3092\u5916\u3057\u3066\u5b9f\u6570\u306e\u7cbe\u5ea6\u3092DOUBLE\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u203b\u901a\u5e38\u3088\u308a\u4f7f\u7528\u30e1\u30e2\u30ea\u7b49\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u81ea\u5df1\u8cac\u4efb\u3067\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002\uff09\n\n```build_config.rb\n    #configuration for low memory environment\n    #cc.defines << %w(MRB_USE_FLOAT) #\u7121\u52b9\u306b\u3059\u308b\n```\n\n\u3053\u308c\u3067mruby\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u306a\u304a\u3057\u307e\u3059\u3002\n\u305d\u306e\u3042\u3068\u3001GR-CITRUS\u3082\u5408\u308f\u305b\u3066\nwrbb-v2lib-firm-master\\firmware\\wrbb_mruby\\include\\mrbconf.h\n\u306eMRB_USE_FLOAT\u3092\u5916\u3057\u307e\u3059\u3002\n\n```mrbconf.h\n/* configuration options: */\n/* add -DMRB_USE_FLOAT to use float instead of double for floating point numbers */\n//#define MRB_USE_FLOAT //\u7121\u52b9\u306b\u3059\u308b\n```\n\n\u3053\u308c\u3067\u3001GR-CITRUS\u306e\u30d5\u30a1\u30fc\u30e0\u30a6\u30a7\u30a2\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3059\u308c\u3070OK\u3067\u3059\u3002\n"}