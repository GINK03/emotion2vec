{"context": "\n\n\u6982\u8981\n\u4f1a\u54e1\u767b\u9332\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3059\u308b\n\u30ed\u30b0\u30a4\u30f3\u30fb\u30ed\u30b0\u30a2\u30a6\u30c8\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3059\u308b\n\u306b\u7d9a\u3044\u3066\u4eca\u56de\u306f\u6c7a\u6e08\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\u6c7a\u6e08\u306fPayPal\u306e\u5b9a\u671f\u8cfc\u8aad\u51e6\u7406\u3092\u4f7f\u3044\u307e\u3059\u3002PayPal API\u3068\u306e\u3084\u308a\u53d6\u308a\u3092Lambda\u3067\u5b9f\u88c5\u3059\u308b\u5f62\u3067\u3059\u3002\n\n\nPayPal API\u3068\u306e\u3084\u308a\u53d6\u308a\u306e\u6d41\u308c\n\n\u6ce8\u6587\u753b\u9762\u3067SetExpressCheckout\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\nSetExpressCheckout\u3067\u4f5c\u3089\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u4fdd\u5b58\u3057\u3066\u3001\u6ce8\u6587\u5185\u5bb9\u306e\u78ba\u8a8d\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\u30e6\u30fc\u30b6\u304c\u6ce8\u6587\u3092\u78ba\u5b9a\u3059\u308b\u3068CreateRecurringPaymentsProfile\u3092\u4f7f\u7528\u3057\u3066\u5b9a\u671f\u8cfc\u8aad\n\n\n\n\nSetExpressCheckout\npaypal-ec\u306enode\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u6ce8\u6587\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30e6\u30fc\u30b6\u304b\u3089\u9001\u3089\u308c\u308b\u3068API Gateway\u3092\u901a\u3057\u3066\u3053\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306b\u51e6\u7406\u3092\u6295\u3052\u307e\u3059\u3002\n\nSetExpressCheckout.js\nvar cred = {\n  username  : '<API\u30e6\u30fc\u30b6\u540d>',\n  password  : '<API\u30d1\u30b9\u30ef\u30fc\u30c9>',\n  signature : '<API\u7f72\u540d>'\n};\n\nvar opts = {\n  sandbox : true,\n  version : '124.0'\n};\n\nvar PayPalEC = require( 'paypal-ec' );\nvar ec       = new PayPalEC( cred, opts );\n\n\nexports.handler = function(event, context) {\n  var params = {\n    returnUrl : '<\u6ce8\u6587\u78ba\u8a8d\u753b\u9762\u306eURL>',\n    cancelUrl : '<\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u6642\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148>',\n    BILLINGTYPE : 'RecurringPayments',\n    BILLINGAGREEMENTDESCRIPTION : 'elasticommerceservices'\n  };\n\n  ec.set( params, function ( err, data ){\n    if (err) {\n        context.fail(err);\n    } else {\n        context.succeed(data);\n    }\n  });\n};\n\n\n\nCreateRecurringPaymentsProfile\n\u6ce8\u6587\u78ba\u8a8d\u753b\u9762\u3067\u30e6\u30fc\u30b6\u304c\u6700\u7d42\u7684\u306b\u8cfc\u5165\u3092\u6c7a\u5b9a\u3059\u308c\u3070\u3053\u306eAPI\u306b\u51e6\u7406\u3092\u306a\u3052\u3066\u5b9a\u671f\u8cfc\u8aad\u3092\u78ba\u5b9a\u3055\u305b\u307e\u3059\u3002\nSetExpressCheckout\u3067\u767a\u884c\u3057\u305fToken\u3092\u6e21\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nCreateRecurringPaymentsProfile.js\nvar cred = {\n  username  : '<API\u30e6\u30fc\u30b6\u540d>',\n  password  : '<API\u30d1\u30b9\u30ef\u30fc\u30c9>',\n  signature : '<API\u7f72\u540d>'\n};\n\nvar opts = {\n  sandbox : true,\n  version : '124.0'\n};\n\nvar PayPalEC = require( 'paypal-ec' );\nvar ec       = new PayPalEC( cred, opts );\n\n\nexports.handler = function(event, context) {\n  var params = {\n    TOKEN : event.token,\n    PROFILESTARTDATE : '2016-7-1T00:00:00Z',\n    DESC : 'elasticommerceservices',\n    BILLINGPERIOD : 'Month',\n    BILLINGFREQUENCY : 1,\n    AMT : 1,\n    CURRENCYCODE : 'JPY'\n  };\n\n  ec.create_rpp( params, function ( err, data ){\n    if (err) {\n        context.fail(err);\n    } else {\n        context.succeed(data);\n    }\n  });\n};\n\n\n\n\u30e6\u30fc\u30b6\u753b\u9762\n\u30e6\u30fc\u30b6\u753b\u9762\u5074\u306bAPI\u3092\u57cb\u3081\u8fbc\u307f\u307e\u3059\u3002\u4ee5\u4e0b\u306fweb\u30b5\u30a4\u30c8\u3092\u60f3\u5b9a\u3057\u3066JavaScript\u3067\u51e6\u7406\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\norder.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <script src=\"https://code.jquery.com/jquery-2.2.3.min.js\"   integrity=\"sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=\"   crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js\"></script>\n<script type=\"text/javascript\">\n  jQuery(document).ready(function($){\n      if ( !$.cookie('serverless_website_session_id') ) {\n        location.href = \"/login\";\n      }\n\n      $(\"#buy\").on( \"click\", function(){\n        var data = { \n                token:$.cookie('serverless_website_token_id')\n              }\n        $.ajax( {\n                url:'<API Gateway \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8>',\n                method: \"POST\",\n                crossDomain: true,\n                data: JSON.stringify(data),\n                success: function(response) {\n                  console.log(response);\n                  if ( response.ACK === 'Success' ) {\n                    $(\"#message\").text('\u8cfc\u5165\u5b8c\u4e86\u3057\u307e\u3057\u305f')\n                  }\n                }\n              });\n      } );\n    });\n</script>\n    </script>\n  </head>\n  <body>\n    <h1>\u8cfc\u5165\u78ba\u8a8d\u753b\u9762</h1>\n    <p id=\"message\">\u8cfc\u5165\u51e6\u7406\u9032\u3081\u307e\u3059\u3051\u3069\u3001\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\u3088\u308d\u3057\u3051\u308c\u3070\u300c\u306f\u3044\u300d\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044</p>\n    <p ><input type=\"button\" id=\"buy\" value=\"\u306f\u3044\" /></p>\n  </body>\n</html>\n\n\n\n\u7d50\u679c\n\u51fa\u6765\u305fAPI\u3092\u305d\u308c\u305e\u308c\u753b\u9762\u306b\u914d\u7f6e\u3057\u3066\u52d5\u304b\u3057\u305f\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bPayPal\u3067\u5b9a\u671f\u8cfc\u8aad\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n\n\u3055\u308c\u3001\u3053\u308c\u3067\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u4f1a\u54e1\u7ba1\u7406\u3001\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3001\u6c7a\u6e08\u306e\u51e6\u7406\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u3053\u308c\u3067\u6fc0\u5b89EC\u30b5\u30a4\u30c8\u3068\u304b\u4f5c\u308c\u305f\u308a\u51fa\u6765\u305d\u3046\u3067\u3059\u3002\n## \u6982\u8981\n[\u4f1a\u54e1\u767b\u9332\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3059\u308b](http://qiita.com/horike37/items/6f2575d6a061216fe019)\n[\u30ed\u30b0\u30a4\u30f3\u30fb\u30ed\u30b0\u30a2\u30a6\u30c8\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3059\u308b](http://qiita.com/horike37/items/dc81442d5d1b8ea89325)\n\u306b\u7d9a\u3044\u3066\u4eca\u56de\u306f\u6c7a\u6e08\u6a5f\u80fd\u3092\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002\n\n## \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\n\u6c7a\u6e08\u306fPayPal\u306e\u5b9a\u671f\u8cfc\u8aad\u51e6\u7406\u3092\u4f7f\u3044\u307e\u3059\u3002PayPal API\u3068\u306e\u3084\u308a\u53d6\u308a\u3092Lambda\u3067\u5b9f\u88c5\u3059\u308b\u5f62\u3067\u3059\u3002\n![\u6c7a\u6e08.png](https://qiita-image-store.s3.amazonaws.com/0/65478/9d4144b7-2984-4af7-eb76-ec380bba8a11.png)\n\n## PayPal API\u3068\u306e\u3084\u308a\u53d6\u308a\u306e\u6d41\u308c\n- \u6ce8\u6587\u753b\u9762\u3067SetExpressCheckout\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u4fe1\n- SetExpressCheckout\u3067\u4f5c\u3089\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u4fdd\u5b58\u3057\u3066\u3001\u6ce8\u6587\u5185\u5bb9\u306e\u78ba\u8a8d\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n- \u30e6\u30fc\u30b6\u304c\u6ce8\u6587\u3092\u78ba\u5b9a\u3059\u308b\u3068CreateRecurringPaymentsProfile\u3092\u4f7f\u7528\u3057\u3066\u5b9a\u671f\u8cfc\u8aad\n![PayPalAPI.png](https://qiita-image-store.s3.amazonaws.com/0/65478/67cfae0f-ec86-b7df-dbb3-c151d6141264.png)\n\n## SetExpressCheckout\n[paypal-ec](https://www.npmjs.com/package/paypal-ec)\u306enode\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u6ce8\u6587\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u30e6\u30fc\u30b6\u304b\u3089\u9001\u3089\u308c\u308b\u3068API Gateway\u3092\u901a\u3057\u3066\u3053\u306eLambda\u30d5\u30a1\u30f3\u30af\u30b7\u30e7\u30f3\u306b\u51e6\u7406\u3092\u6295\u3052\u307e\u3059\u3002\n\n```js:SetExpressCheckout.js\nvar cred = {\n  username  : '<API\u30e6\u30fc\u30b6\u540d>',\n  password  : '<API\u30d1\u30b9\u30ef\u30fc\u30c9>',\n  signature : '<API\u7f72\u540d>'\n};\n\nvar opts = {\n  sandbox : true,\n  version : '124.0'\n};\n\nvar PayPalEC = require( 'paypal-ec' );\nvar ec       = new PayPalEC( cred, opts );\n\n\nexports.handler = function(event, context) {\n  var params = {\n    returnUrl : '<\u6ce8\u6587\u78ba\u8a8d\u753b\u9762\u306eURL>',\n    cancelUrl : '<\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u6642\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148>',\n    BILLINGTYPE : 'RecurringPayments',\n    BILLINGAGREEMENTDESCRIPTION : 'elasticommerceservices'\n  };\n\n  ec.set( params, function ( err, data ){\n    if (err) {\n    \tcontext.fail(err);\n    } else {\n    \tcontext.succeed(data);\n    }\n  });\n};\n```\n\n## CreateRecurringPaymentsProfile\n\u6ce8\u6587\u78ba\u8a8d\u753b\u9762\u3067\u30e6\u30fc\u30b6\u304c\u6700\u7d42\u7684\u306b\u8cfc\u5165\u3092\u6c7a\u5b9a\u3059\u308c\u3070\u3053\u306eAPI\u306b\u51e6\u7406\u3092\u306a\u3052\u3066\u5b9a\u671f\u8cfc\u8aad\u3092\u78ba\u5b9a\u3055\u305b\u307e\u3059\u3002\nSetExpressCheckout\u3067\u767a\u884c\u3057\u305fToken\u3092\u6e21\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```js:CreateRecurringPaymentsProfile.js\nvar cred = {\n  username  : '<API\u30e6\u30fc\u30b6\u540d>',\n  password  : '<API\u30d1\u30b9\u30ef\u30fc\u30c9>',\n  signature : '<API\u7f72\u540d>'\n};\n\nvar opts = {\n  sandbox : true,\n  version : '124.0'\n};\n\nvar PayPalEC = require( 'paypal-ec' );\nvar ec       = new PayPalEC( cred, opts );\n\n\nexports.handler = function(event, context) {\n  var params = {\n    TOKEN : event.token,\n    PROFILESTARTDATE : '2016-7-1T00:00:00Z',\n    DESC : 'elasticommerceservices',\n    BILLINGPERIOD : 'Month',\n    BILLINGFREQUENCY : 1,\n    AMT : 1,\n    CURRENCYCODE : 'JPY'\n  };\n\n  ec.create_rpp( params, function ( err, data ){\n    if (err) {\n    \tcontext.fail(err);\n    } else {\n    \tcontext.succeed(data);\n    }\n  });\n};\n```\n## \u30e6\u30fc\u30b6\u753b\u9762\n\u30e6\u30fc\u30b6\u753b\u9762\u5074\u306bAPI\u3092\u57cb\u3081\u8fbc\u307f\u307e\u3059\u3002\u4ee5\u4e0b\u306fweb\u30b5\u30a4\u30c8\u3092\u60f3\u5b9a\u3057\u3066JavaScript\u3067\u51e6\u7406\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\n``` html:order.html\n<!DOCTYPE html>\n<html lang=\"ja\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <script src=\"https://code.jquery.com/jquery-2.2.3.min.js\"   integrity=\"sha256-a23g1Nt4dtEYOj7bR+vTu7+T8VP13humZFBJNIYoEJo=\"   crossorigin=\"anonymous\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js\"></script>\n<script type=\"text/javascript\">\n  jQuery(document).ready(function($){\n\t  if ( !$.cookie('serverless_website_session_id') ) {\n\t    location.href = \"/login\";\n\t  }\n\t\n\t  $(\"#buy\").on( \"click\", function(){\n\t    var data = { \n\t\t\t\ttoken:$.cookie('serverless_website_token_id')\n\t\t      }\n\t\t$.ajax( {\n\t\t\t    url:'<API Gateway \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8>',\n\t\t\t    method: \"POST\",\n\t\t\t    crossDomain: true,\n\t\t\t    data: JSON.stringify(data),\n\t\t\t    success: function(response) {\n\t\t\t      console.log(response);\n\t\t\t      if ( response.ACK === 'Success' ) {\n\t\t\t        $(\"#message\").text('\u8cfc\u5165\u5b8c\u4e86\u3057\u307e\u3057\u305f')\n\t\t\t      }\n\t\t\t    }\n\t\t\t  });\n\t  } );\n\t});\n</script>\n    </script>\n  </head>\n  <body>\n    <h1>\u8cfc\u5165\u78ba\u8a8d\u753b\u9762</h1>\n    <p id=\"message\">\u8cfc\u5165\u51e6\u7406\u9032\u3081\u307e\u3059\u3051\u3069\u3001\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\u3088\u308d\u3057\u3051\u308c\u3070\u300c\u306f\u3044\u300d\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044</p>\n    <p ><input type=\"button\" id=\"buy\" value=\"\u306f\u3044\" /></p>\n  </body>\n</html>\n```\n\n## \u7d50\u679c\n\u51fa\u6765\u305fAPI\u3092\u305d\u308c\u305e\u308c\u753b\u9762\u306b\u914d\u7f6e\u3057\u3066\u52d5\u304b\u3057\u305f\u7d50\u679c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bPayPal\u3067\u5b9a\u671f\u8cfc\u8aad\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\n<img width=\"630\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-04-17 13.54.12.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/65478/61bcf9ec-2476-2d4b-c891-4799ec6923f2.png\">\n\n\u3055\u308c\u3001\u3053\u308c\u3067\u30b5\u30fc\u30d0\u30ec\u30b9\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u4f1a\u54e1\u7ba1\u7406\u3001\u30ed\u30b0\u30a4\u30f3\u3001\u30ed\u30b0\u30a2\u30a6\u30c8\u3001\u6c7a\u6e08\u306e\u51e6\u7406\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3057\u305f\u3002\u3053\u308c\u3067\u6fc0\u5b89EC\u30b5\u30a4\u30c8\u3068\u304b\u4f5c\u308c\u305f\u308a\u51fa\u6765\u305d\u3046\u3067\u3059\u3002\n\n\n\n", "tags": ["AWS", "lambda", "APIGateway", "PayPal"]}