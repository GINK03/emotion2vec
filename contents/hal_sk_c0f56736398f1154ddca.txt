{"context": " More than 1 year has passed since last update.\u524d\u56de\u306e\u7d9a\u304d\u3067\u3059\u3002\n\u524d\u56de\u306e\u8a18\u4e8b\u3067\u306f\u3001Devise \u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u62e1\u5f35\u3057\u307e\u3057\u305f\u304c\u3001new \u30e1\u30bd\u30c3\u30c9\u3057\u304b\u5b9f\u88c5\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u306e\u70ba /users/sign_up \u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001\u307e\u305f\u5473\u6c17\u306a\u3044\u753b\u9762\u306b\u623b\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\napp/controllers/users/registration_controller.rb\nclass Users::RegistrationsController < Devise::RegistrationsController\n  include Locomotive::Routing::SiteDispatcher\n  include Locomotive::Render\n  include Locomotive::ActionController::LocaleHelpers\n  before_filter :require_site\n  def new\n    build_resource({})\n    @page ||= self.locomotive_page('/userregistration')\n    respond_to do |format|\n      format.html {\n         render :inline => @page.render(self.locomotive_context({ 'user' => resource}))\n      }\n    end\n  end\n  def create\n    super # \u2190\u3053\u3063\u3061\u3092\u5b9f\u88c5\u3057\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044\n  end\nend\n\n\n\ncreate\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\n\u3044\u304d\u306a\u308a\u7d50\u8ad6\u3067\u3059\u304c\u3001Devise \u5074\u306e\u51e6\u7406\u3068 LocomotiveCMS \u306e\u51e6\u7406\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u6240\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n(2014/04/08\u8ffd\u8a18)\u3082\u3057\u304b\u3057\u305f\u3089\u3001create \u90e8\u5206\u306e\u5b9f\u88c5\u3092\u3044\u3058\u308b\u5fc5\u8981\u306f\u306a\u304f\u3066\u3001\u5358\u7d14\u306b flash \u30e1\u30c3\u30bb\u30fc\u30b8\u3068 after_sign_up_path_for \u3092\u5de5\u592b\u3059\u308c\u3070\u826f\u3044\u6c17\u3082\u3057\u3066\u304d\u307e\u3057\u305f\u3002\u3069\u3046\u3082\u3053\u306e\u8fba\u306f\u6c17\u6301\u3061\u60aa\u304b\u3063\u305f\u3093\u3067\u3059\u3088\u306d\u3002\u5b9f\u88c5\u65b9\u6cd5\u5909\u3048\u305f\u3089\u3042\u3068\u3067\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n/app/controllers/users/registration_controller.rb\n  def create\n    build_resource(params.fetch(resource_name, {})) #\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089 resource \u30af\u30e9\u30b9\u3092\u4f5c\u6210\uff08User\u30af\u30e9\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\uff09\n\n    resource_saved = resource.save #\u4fdd\u5b58\n    yield resource if block_given?\n    if resource_saved   #\u30e6\u30fc\u30b6\u767b\u9332\u6210\u529f\n      if resource.active_for_authentication?\n        # \u30e1\u30fc\u30eb\u306b\u3088\u308b\u78ba\u8a8d\u306a\u3057\n        sign_up(resource_name, resource)\n        respond_with resource, location: after_sign_up_path_for(resource)\n      else\n        # \u30e1\u30fc\u30eb\u306b\u3088\u308b\u78ba\u8a8d\u3042\u308a\n        @page = self.locomotive_page('/registrationconfirm')\n        expire_data_after_sign_in!\n        respond_to do |format|\n          format.html {\n             render :inline => @page.render(self.locomotive_context({}))\n          }\n        end\n      end\n    else\n      # \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\uff08\u518d\u5ea6\u5165\u529b\u30d5\u30a9\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3059\uff09\n      @page ||= self.locomotive_page('/userregistration') \n      clean_up_passwords resource\n      respond_to do |format|\n        format.html {\n           render :inline => @page.render(self.locomotive_context({ 'user' => resource, 'error' => devise_error_messages! }))\n        }\n      end\n    end\n  end\n  # \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u8fd4\u3059\n  def devise_error_messages!\n    return \"\" if resource.errors.empty?\n\n    messages = resource.errors.full_messages.map { |msg| content_tag(:li, msg) }.join\n    html = <<-HTML\n    <div id=\"error_explanation\">\n      <h2>\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f</h2>\n      <ul>#{messages}</ul>\n    </div>\n    HTML\n\n    html.html_safe\n  end\n  # \u30bb\u30c3\u30b7\u30e7\u30f3\u30ad\u30fc\u306e\u524a\u9664\n  def expire_data_after_sign_in!\n    # session.keys will return an empty array if the session is not yet loaded.\n    # This is a bug in both Rack and Rails.\n    # A call to #empty? forces the session to be loaded.\n    session.empty?\n    session.keys.grep(/^devise\\./).each { |k| session.delete(k) }\n  end\n  # \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u5f8c\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\n  def after_sign_up_path_for(resource)\n    '/registrationfinished'\n  end\n\n\n\n\u5165\u529b\u30d5\u30a9\u30fc\u30e0\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4fee\u6b63\ncreate\u30e1\u30bd\u30c3\u30c9\u4e2d\u306e render :inline => @page.render(self.locomotive_context({ 'user' => resource, 'error' => devise_error_messages! })) \u3068\u3044\u3046\u884c\u304c\u91cd\u8981\u3067\u3001\u3053\u306e\u753b\u9762\u3067\u3001\u30e6\u30fc\u30b6\u30fc\u30e2\u30c7\u30eb\u3068\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u524d\u56de\u4f5c\u3063\u305f registration.liquid.haml \u3067\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8868\u793a\u3068\u3001\u30e6\u30fc\u30b6\u30fcID\u3092\u5165\u529b\u753b\u9762\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n/app/views/pages/userregistration.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\nslug: userregistration\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\nposition: 4\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u30da\u30fc\u30b8\n    .error {{error}}\n    %form#new_user.new_user{\"accept-charset\" => \"UTF-8\", :action => \"/users\", :method => \"post\"}\n      .hidden\n        {% csrf_param %}\n        %input{:name => \"utf8\", :type => \"hidden\", :value => \"\u2713\"}/\n      %div\n        %label{:for => \"user_email\"} Email\n        %br/\n        %input#user_email{:autofocus => \"autofocus\", :keyev => \"true\", :mouseev => \"true\", :name => \"user[email]\", :size => \"30\", :type => \"email\", :value => \"{{user.email}}\"}/\n      %div\n        %label{:for => \"user_password\"} Password\n        %br/\n        %input#user_password{:keyev => \"true\", :mouseev => \"true\", :name => \"user[password]\", :size => \"30\", :type => \"password\"}/\n      %div\n        %label{:for => \"user_password_confirmation\"} Password confirmation\n        %br/\n        %input#user_password_confirmation{:keyev => \"true\", :mouseev => \"true\", :name => \"user[password_confirmation]\", :size => \"30\", :type => \"password\"}/\n      %div\n        %input{:name => \"commit\", :type => \"submit\", :value => \"Sign up\"}/\n{% endblock %}\n\n\n.error {{error}} \u3068\u3001%input#user_email \u306e:value => \"{{user.email}}\" \u3068\u3044\u3046\u90e8\u5206\u304c\u8ffd\u52a0\u3057\u305f\u90e8\u5206\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5165\u529b\u3055\u308c\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u5165\u308a\u307e\u3059\u3002\n\u3057\u304b\u3057\u3001\u3053\u306e\u307e\u307e\u3060\u3068 {{user.email}} \u3092\u30d1\u30fc\u30b9\u3059\u308b\u969b\u306b Undefined method \"to_liquid\" \u3068\u8a00\u308f\u308c\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002 liquid \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304b\u3089\u547c\u3079\u308b\u3088\u3046\u306b\u3059\u308b\u70ba\u306b\u3001User \u30af\u30e9\u30b9\u306b Liquid::Drop \u3092\u7d99\u627f\u3055\u305b\u307e\u3059\u3002\n\napp/models/user.rb\nclass User < Liquid::Drop\n  include Mongoid::Document\n\u2026\nend\n\n\n\u3053\u308c\u3067\u3001\u5165\u529b\u6642\u306e\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3001\u5165\u529b\u3057\u305f\u5185\u5bb9\u3082\u5f15\u304d\u7d99\u304c\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\u753b\u9762\n\u3042\u3068\u306f\u3001\u4eee\u767b\u9332\u3067\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\u753b\u9762\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n/app/views/pages/registrationconfirm.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u30e1\u30fc\u30eb\u9001\u4fe1\u6e08\nslug: registrationconfirm\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u4eee\u767b\u9332\u5b8c\u4e86\n    \u5165\u529b\u3055\u308c\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u78ba\u8a8d\u306e\u30e1\u30fc\u30eb\u3092\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u3002\u30e1\u30fc\u30eb\u672c\u6587\u306b\u66f8\u304b\u308c\u3066\u3044\u308bURL\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u767b\u9332\u3092\u5b8c\u4e86\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n{% endblock %}\n\n\n\u3053\u308c\u3067\u3001\u30c7\u30fc\u30bf\u767b\u9332\u5f8c\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\n\u672c\u767b\u9332\u5b8c\u4e86\u753b\u9762\n\u3055\u3066\u3001\u3042\u3068\u4e00\u606f\u3067\u3059\u3002\u30e1\u30fc\u30eb\u3067\u9001\u3089\u308c\u305f\u672c\u767b\u9332URL\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u969b\u306b\u3082\u3001\u3061\u3083\u3093\u3068\u3057\u305f\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u672c\u767b\u9332\u6642\u306b\u4f7f\u308f\u308c\u308b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u3001ConfirmationsController \u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\n\napp/controllers/users/confirmations_controller.rb\nclass Users::ConfirmationsController < Devise::ConfirmationsController\n  protected\n  # The path used after confirmation.\n  def after_confirmation_path_for(resource_name, resource)\n    if signed_in?\n      '/registrationfinished'\n    else\n      new_session_path(resource_name)\n    end\n  end\nend\n\n\n\nafter_confirmation_path_for\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u78ba\u8a8d\u6642\u306b\u3053\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304c\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u3001routes \u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\nconfig/routes.rb\n  devise_for :users, :controllers => {\n    :registrations => 'users/registrations',\n    :confirmations => 'users/confirmations'\n  }\n\n\n\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3068\u306a\u308b\u3001\u672c\u767b\u9332\u5b8c\u4e86\u753b\u9762\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n/app/views/pages/registrationfinished.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u5b8c\u4e86\nslug: registrationfinished\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u767b\u9332\u5b8c\u4e86\n    \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u304c\u5b8c\u4e86\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u6e08\u3067\u3059\u3002\n{% endblock %}\n\n\n\n\u4ee5\u4e0a\u3067\u3001\u5b8c\u4e86\u3067\u3059\uff01\n\u6b21\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u4fee\u6b63\u3057\u307e\u3057\u3087\u3046\u3002\nLocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)\n\nLocomotive \u95a2\u9023\u306e\u8a18\u4e8b\u4e00\u89a7\uff1a\n* Locomotive Engine \u3092 Heroku \u3067\u52d5\u304b\u3059\u307e\u3067\n* LocomotiveCMS \u3067\u30cb\u30e5\u30fc\u30b9\u8a18\u4e8b\u4e00\u89a7\u6a5f\u80fd\u3092\u4f5c\u308b\n* LocomotiveCMS \u306e\u30da\u30fc\u30b8\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\uff08Engine\u306e\u62e1\u5f35\uff09\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(1)\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(2)\n* LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)\n* LocomotiveCMS \u3067\u3001\u8907\u6570\u306e Heroku \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046\n\n[\u524d\u56de](http://qiita.com/hal_sk/items/50c45f764cb95615dd59)\u306e\u7d9a\u304d\u3067\u3059\u3002\n\n\u524d\u56de\u306e\u8a18\u4e8b\u3067\u306f\u3001Devise \u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u62e1\u5f35\u3057\u307e\u3057\u305f\u304c\u3001new \u30e1\u30bd\u30c3\u30c9\u3057\u304b\u5b9f\u88c5\u3057\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u305d\u306e\u70ba /users/sign_up \u304b\u3089\u30d5\u30a9\u30fc\u30e0\u3092\u9001\u4fe1\u3059\u308b\u3068\u3001\u307e\u305f\u5473\u6c17\u306a\u3044\u753b\u9762\u306b\u623b\u3063\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n```ruby:app/controllers/users/registration_controller.rb\nclass Users::RegistrationsController < Devise::RegistrationsController\n  include Locomotive::Routing::SiteDispatcher\n  include Locomotive::Render\n  include Locomotive::ActionController::LocaleHelpers\n  before_filter :require_site\n  def new\n    build_resource({})\n    @page ||= self.locomotive_page('/userregistration')\n    respond_to do |format|\n      format.html {\n         render :inline => @page.render(self.locomotive_context({ 'user' => resource}))\n      }\n    end\n  end\n  def create\n    super # \u2190\u3053\u3063\u3061\u3092\u5b9f\u88c5\u3057\u306a\u304f\u3066\u306f\u306a\u3089\u306a\u3044\n  end\nend\n```\n\n#create\u30e1\u30bd\u30c3\u30c9\u306e\u5b9f\u88c5\n\n\u3044\u304d\u306a\u308a\u7d50\u8ad6\u3067\u3059\u304c\u3001Devise \u5074\u306e\u51e6\u7406\u3068 LocomotiveCMS \u306e\u51e6\u7406\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u6240\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e1\u30bd\u30c3\u30c9\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n(2014/04/08\u8ffd\u8a18)\u3082\u3057\u304b\u3057\u305f\u3089\u3001create \u90e8\u5206\u306e\u5b9f\u88c5\u3092\u3044\u3058\u308b\u5fc5\u8981\u306f\u306a\u304f\u3066\u3001\u5358\u7d14\u306b flash \u30e1\u30c3\u30bb\u30fc\u30b8\u3068 after_sign_up_path_for \u3092\u5de5\u592b\u3059\u308c\u3070\u826f\u3044\u6c17\u3082\u3057\u3066\u304d\u307e\u3057\u305f\u3002\u3069\u3046\u3082\u3053\u306e\u8fba\u306f\u6c17\u6301\u3061\u60aa\u304b\u3063\u305f\u3093\u3067\u3059\u3088\u306d\u3002\u5b9f\u88c5\u65b9\u6cd5\u5909\u3048\u305f\u3089\u3042\u3068\u3067\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n```ruby:/app/controllers/users/registration_controller.rb\n  def create\n    build_resource(params.fetch(resource_name, {})) #\u30d1\u30e9\u30e1\u30fc\u30bf\u304b\u3089 resource \u30af\u30e9\u30b9\u3092\u4f5c\u6210\uff08User\u30af\u30e9\u30b9\u304c\u5165\u3063\u3066\u3044\u308b\uff09\n\n    resource_saved = resource.save #\u4fdd\u5b58\n    yield resource if block_given?\n    if resource_saved   #\u30e6\u30fc\u30b6\u767b\u9332\u6210\u529f\n      if resource.active_for_authentication?\n        # \u30e1\u30fc\u30eb\u306b\u3088\u308b\u78ba\u8a8d\u306a\u3057\n        sign_up(resource_name, resource)\n        respond_with resource, location: after_sign_up_path_for(resource)\n      else\n        # \u30e1\u30fc\u30eb\u306b\u3088\u308b\u78ba\u8a8d\u3042\u308a\n        @page = self.locomotive_page('/registrationconfirm')\n        expire_data_after_sign_in!\n        respond_to do |format|\n          format.html {\n             render :inline => @page.render(self.locomotive_context({}))\n          }\n        end\n      end\n    else\n      # \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\uff08\u518d\u5ea6\u5165\u529b\u30d5\u30a9\u30fc\u30e0\u3092\u547c\u3073\u51fa\u3059\uff09\n      @page ||= self.locomotive_page('/userregistration') \n      clean_up_passwords resource\n      respond_to do |format|\n        format.html {\n           render :inline => @page.render(self.locomotive_context({ 'user' => resource, 'error' => devise_error_messages! }))\n        }\n      end\n    end\n  end\n  # \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u4f5c\u3063\u3066\u8fd4\u3059\n  def devise_error_messages!\n    return \"\" if resource.errors.empty?\n\n    messages = resource.errors.full_messages.map { |msg| content_tag(:li, msg) }.join\n    html = <<-HTML\n    <div id=\"error_explanation\">\n      <h2>\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f</h2>\n      <ul>#{messages}</ul>\n    </div>\n    HTML\n\n    html.html_safe\n  end\n  # \u30bb\u30c3\u30b7\u30e7\u30f3\u30ad\u30fc\u306e\u524a\u9664\n  def expire_data_after_sign_in!\n    # session.keys will return an empty array if the session is not yet loaded.\n    # This is a bug in both Rack and Rails.\n    # A call to #empty? forces the session to be loaded.\n    session.empty?\n    session.keys.grep(/^devise\\./).each { |k| session.delete(k) }\n  end\n  # \u30b5\u30a4\u30f3\u30a2\u30c3\u30d7\u5f8c\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\n  def after_sign_up_path_for(resource)\n    '/registrationfinished'\n  end\n```\n\n# \u5165\u529b\u30d5\u30a9\u30fc\u30e0\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u4fee\u6b63\n\ncreate\u30e1\u30bd\u30c3\u30c9\u4e2d\u306e `render :inline => @page.render(self.locomotive_context({ 'user' => resource, 'error' => devise_error_messages! }))` \u3068\u3044\u3046\u884c\u304c\u91cd\u8981\u3067\u3001\u3053\u306e\u753b\u9762\u3067\u3001\u30e6\u30fc\u30b6\u30fc\u30e2\u30c7\u30eb\u3068\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30bb\u30c3\u30c8\u3057\u3066\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u524d\u56de\u4f5c\u3063\u305f registration.liquid.haml \u3067\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8868\u793a\u3068\u3001\u30e6\u30fc\u30b6\u30fcID\u3092\u5165\u529b\u753b\u9762\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n```haml:/app/views/pages/userregistration.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\nslug: userregistration\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\nposition: 4\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u30da\u30fc\u30b8\n    .error {{error}}\n    %form#new_user.new_user{\"accept-charset\" => \"UTF-8\", :action => \"/users\", :method => \"post\"}\n      .hidden\n        {% csrf_param %}\n        %input{:name => \"utf8\", :type => \"hidden\", :value => \"\u2713\"}/\n      %div\n        %label{:for => \"user_email\"} Email\n        %br/\n        %input#user_email{:autofocus => \"autofocus\", :keyev => \"true\", :mouseev => \"true\", :name => \"user[email]\", :size => \"30\", :type => \"email\", :value => \"{{user.email}}\"}/\n      %div\n        %label{:for => \"user_password\"} Password\n        %br/\n        %input#user_password{:keyev => \"true\", :mouseev => \"true\", :name => \"user[password]\", :size => \"30\", :type => \"password\"}/\n      %div\n        %label{:for => \"user_password_confirmation\"} Password confirmation\n        %br/\n        %input#user_password_confirmation{:keyev => \"true\", :mouseev => \"true\", :name => \"user[password_confirmation]\", :size => \"30\", :type => \"password\"}/\n      %div\n        %input{:name => \"commit\", :type => \"submit\", :value => \"Sign up\"}/\n{% endblock %}\n```\n\n`.error {{error}}` \u3068\u3001%input#user_email \u306e`:value => \"{{user.email}}\"` \u3068\u3044\u3046\u90e8\u5206\u304c\u8ffd\u52a0\u3057\u305f\u90e8\u5206\u3067\u3059\u3002\u305d\u308c\u305e\u308c\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u5165\u529b\u3055\u308c\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u5165\u308a\u307e\u3059\u3002\n\n\u3057\u304b\u3057\u3001\u3053\u306e\u307e\u307e\u3060\u3068 {{user.email}} \u3092\u30d1\u30fc\u30b9\u3059\u308b\u969b\u306b Undefined method \"to_liquid\" \u3068\u8a00\u308f\u308c\u3066\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002 liquid \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u304b\u3089\u547c\u3079\u308b\u3088\u3046\u306b\u3059\u308b\u70ba\u306b\u3001User \u30af\u30e9\u30b9\u306b Liquid::Drop \u3092\u7d99\u627f\u3055\u305b\u307e\u3059\u3002\n\n```ruby:app/models/user.rb\nclass User < Liquid::Drop\n  include Mongoid::Document\n\u2026\nend\n```\n\n\u3053\u308c\u3067\u3001\u5165\u529b\u6642\u306e\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u3001\u5165\u529b\u3057\u305f\u5185\u5bb9\u3082\u5f15\u304d\u7d99\u304c\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n![user_registration2.png](https://qiita-image-store.s3.amazonaws.com/0/1399/74b7c441-4000-6036-24cd-4844138964a5.png \"user_registration2.png\")\n\n#\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\u753b\u9762\n\n\u3042\u3068\u306f\u3001\u4eee\u767b\u9332\u3067\u306e\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u78ba\u8a8d\u753b\u9762\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n\n```HAML:/app/views/pages/registrationconfirm.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u30e1\u30fc\u30eb\u9001\u4fe1\u6e08\nslug: registrationconfirm\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u4eee\u767b\u9332\u5b8c\u4e86\n    \u5165\u529b\u3055\u308c\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u78ba\u8a8d\u306e\u30e1\u30fc\u30eb\u3092\u304a\u9001\u308a\u3057\u307e\u3057\u305f\u3002\u30e1\u30fc\u30eb\u672c\u6587\u306b\u66f8\u304b\u308c\u3066\u3044\u308bURL\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u767b\u9332\u3092\u5b8c\u4e86\u3055\u305b\u3066\u304f\u3060\u3055\u3044\u3002\n{% endblock %}\n```\n\n\u3053\u308c\u3067\u3001\u30c7\u30fc\u30bf\u767b\u9332\u5f8c\u3001\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n![registrationconfirm.png](https://qiita-image-store.s3.amazonaws.com/0/1399/bd79d0c6-86ed-e484-0a4b-679735de8e66.png \"registrationconfirm.png\")\n\n#\u672c\u767b\u9332\u5b8c\u4e86\u753b\u9762\n\n\u3055\u3066\u3001\u3042\u3068\u4e00\u606f\u3067\u3059\u3002\u30e1\u30fc\u30eb\u3067\u9001\u3089\u308c\u305f\u672c\u767b\u9332URL\u3092\u30af\u30ea\u30c3\u30af\u3057\u305f\u969b\u306b\u3082\u3001\u3061\u3083\u3093\u3068\u3057\u305f\u30da\u30fc\u30b8\u3092\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u672c\u767b\u9332\u6642\u306b\u4f7f\u308f\u308c\u308b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u306f\u3001ConfirmationsController \u3067\u3059\u306e\u3067\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```ruby:app/controllers/users/confirmations_controller.rb\nclass Users::ConfirmationsController < Devise::ConfirmationsController\n  protected\n  # The path used after confirmation.\n  def after_confirmation_path_for(resource_name, resource)\n    if signed_in?\n      '/registrationfinished'\n    else\n      new_session_path(resource_name)\n    end\n  end\nend\n\n```\n\nafter_confirmation_path_for\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u78ba\u8a8d\u6642\u306b\u3053\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u304c\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u3001routes \u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```config/routes.rb\n  devise_for :users, :controllers => {\n    :registrations => 'users/registrations',\n    :confirmations => 'users/confirmations'\n  }\n```\n\n\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u5148\u3068\u306a\u308b\u3001\u672c\u767b\u9332\u5b8c\u4e86\u753b\u9762\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```HAML:/app/views/pages/registrationfinished.liquid.haml\n---\ntitle: \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u5b8c\u4e86\nslug: registrationfinished\nlisted: false\npublished: true\ncache_strategy: none\nresponse_type: text/html\n---\n{% extends 'parent' %}\n{% block main %}\n.row\n  .large-8.columns\n    %h1 \u767b\u9332\u5b8c\u4e86\n    \u30e6\u30fc\u30b6\u30fc\u767b\u9332\u304c\u5b8c\u4e86\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u6e08\u3067\u3059\u3002\n{% endblock %}\n```\n\n![registrationfinished.png](https://qiita-image-store.s3.amazonaws.com/0/1399/b2b6024a-1a76-ec43-df64-ba5868915adc.png \"registrationfinished.png\")\n\n\u4ee5\u4e0a\u3067\u3001\u5b8c\u4e86\u3067\u3059\uff01\n\u6b21\u306f\u3001\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3092\u4fee\u6b63\u3057\u307e\u3057\u3087\u3046\u3002\n\n[LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)](http://qiita.com/hal_sk/items/92d653f47ddadb6d879c)\n\n---\nLocomotive \u95a2\u9023\u306e\u8a18\u4e8b\u4e00\u89a7\uff1a\n* [Locomotive Engine \u3092 Heroku \u3067\u52d5\u304b\u3059\u307e\u3067](http://qiita.com/hal_sk/items/0512a4a9cb215fb016f5)\n* [LocomotiveCMS \u3067\u30cb\u30e5\u30fc\u30b9\u8a18\u4e8b\u4e00\u89a7\u6a5f\u80fd\u3092\u4f5c\u308b](http://qiita.com/hal_sk/items/b72db4a288566e92096c)\n* [LocomotiveCMS \u306e\u30da\u30fc\u30b8\u306b\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u6a5f\u80fd\u3092\u7d44\u307f\u8fbc\u3080\uff08Engine\u306e\u62e1\u5f35\uff09](http://qiita.com/hal_sk/items/c6d4f5582d23bc4dd415)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(1)](http://qiita.com/hal_sk/items/50c45f764cb95615dd59)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(2)](http://qiita.com/hal_sk/items/c0f56736398f1154ddca)\n* [LocomotiveCMS + Devise \u3092\u4f7f\u3063\u3066\u4f5c\u3063\u305f\u30ed\u30b0\u30a4\u30f3\u30da\u30fc\u30b8\u306e\u30c7\u30b6\u30a4\u30f3\u3092CMS\u5074\u3067\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b(3)](http://qiita.com/hal_sk/items/92d653f47ddadb6d879c)\n* [LocomotiveCMS \u3067\u3001\u8907\u6570\u306e Heroku \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u3046](http://qiita.com/hal_sk/items/aba8d324638d205b2ce1)", "tags": ["locomotivecms", "Ruby", "devise", "raila"]}