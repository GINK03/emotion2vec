{"context": "\u30c7\u30e2\uff1ahttp://mo49.tokyo/qiita/20160505/\n\u30b9\u30de\u30db\u5bfe\u5fdc\u3002\n\u8272\u3001\u30b5\u30a4\u30ba\u3001\u7d75\u6587\u5b57\u306e\u5909\u66f4\u3001\u6d88\u3057\u30b4\u30e0\u3001\u30c7\u30d0\u30a4\u30b9\u3092\u50be\u3051\u308b\u3068\u5168\u6d88\u53bb\u6a5f\u80fd\u3064\u304d\u3002\n<canvas style=\"background: #f3f3f3\" id=\"canvas\"></canvas>\n<div id=\"container\">\n    <ul>\n        <li><input id=\"btn-color\" type=\"color\"></li>\n        <li id=\"btn-eraser\" class=\"btn btn-color\" data-color=\"\"><i class=\"fa fa-eraser\" aria-hidden=\"true\"></i></li>\n    </ul>\n    <ul>\n        <li class=\"btn btn-size\" data-size=\"1\">1</li>\n        <li class=\"btn btn-size\" data-size=\"5\">5</li>\n        <li class=\"btn btn-size\" data-size=\"10\">10</li>\n    </ul>\n    <ul>\n        <li class=\"btn btn-emoji\" data-emoji=\"\"></li>\n        <li class=\"btn btn-emoji\" data-emoji=\"\u2b50\ufe0f\">\u2b50\ufe0f</li>\n        <li class=\"btn btn-emoji\" data-emoji=\"\ud83c\udf40\">\ud83c\udf40</li>\n        <li class=\"btn btn-emoji\" data-emoji=\"\ud83d\ude0a\">\ud83d\ude0a</li>\n    </ul>\n</div>\n\nvar old_x = 0;\nvar old_y = 0;\nvar x;\nvar y;\nvar globalCompositeOperation  = 'source-over';\nvar selectColor = '#000';\nvar selectSize = 1;\nvar selectEmoji = '';\n\nvar canvas = document.getElementById(\"canvas\");\nvar ctx = canvas.getContext('2d');\n\nwindow.onload = function() {\n    canvas.height = canvas.width = 300;\n    canvas.addEventListener(\"touchstart\", touchStart, false);\n    canvas.addEventListener(\"touchmove\", touchMove, false);\n    canvas.addEventListener(\"orientationchange\", canvasDelete, true);\n}\n\nfunction touchStart(e) {\n    old_x = e.touches[0].pageX;\n    old_y = e.touches[0].pageY;\n}\n\nfunction touchMove(e) {\n    e.preventDefault();\n\n    x = e.touches[0].pageX;\n    y = e.touches[0].pageY;\n\n    drawLine(old_x, old_y, x, y);\n    old_x = x;\n    old_y = y;\n}\n\nfunction drawLine(x1, y1, x2, y2) {\n    ctx.globalCompositeOperation = globalCompositeOperation;\n    ctx.strokeStyle = selectColor;\n    ctx.beginPath();\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    ctx.lineWidth = selectSize;\n    ctx.moveTo(x1, y1);\n    ctx.lineTo(x2, y2);\n    ctx.fillStyle = selectColor;\n    ctx.font = \"20px sans\";\n    ctx.fillText(selectEmoji, x2-30, y2);\n    ctx.closePath();\n    ctx.stroke();\n}\n\n// \u5de6\u306b\u50be\u3051\u308b\u3068\u6d88\u53bb\nfunction canvasDelete(e) {\n    if (window.orientation >= 90) { // \u5de6\u306b90\u5ea6 \u53f3\u306a\u3089-90\u5ea6\n        var alert = confirm(\"\u6d88\u53bb\u3057\u307e\u3059\u304b\uff1f\");\n        if (alert == false) {return;}\n        var ctx = canvas.getContext('2d');\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n    }\n}\n\n// \u8272\u306e\u5909\u66f4\n$('#btn-color').on('change', function(){\n    selectColor = $(this).val();\n});\n\n// \u6d88\u3057\u30b4\u30e0\nvar flag_eraser = true;\n$(\"#btn-eraser\").on('click', function(){\n    if ( flag_eraser ) {\n        globalCompositeOperation = 'destination-out';\n        flag_eraser = false;\n    } else {\n        globalCompositeOperation = 'source-over';\n        flag_eraser = true; \n    }\n});\n\n// \u30b5\u30a4\u30ba\u306e\u5909\u66f4\n$('.btn-size').on('touchstart', function(){\n    selectSize = $(this).data('size');\n});\n\n// \u7d75\u6587\u5b57\u306e\u5909\u66f4\n$('.btn-emoji').on('touchstart', function(){\n    selectEmoji = $(this).data('emoji');\n});\n\nglobalCompositeOperation \u30d7\u30ed\u30d1\u30c6\u30a3\n\n\u30c7\u30e2\uff1ahttp://mo49.tokyo/qiita/20160505/\n\n\u30b9\u30de\u30db\u5bfe\u5fdc\u3002\n\u8272\u3001\u30b5\u30a4\u30ba\u3001\u7d75\u6587\u5b57\u306e\u5909\u66f4\u3001\u6d88\u3057\u30b4\u30e0\u3001\u30c7\u30d0\u30a4\u30b9\u3092\u50be\u3051\u308b\u3068\u5168\u6d88\u53bb\u6a5f\u80fd\u3064\u304d\u3002\n\n```html\n<canvas style=\"background: #f3f3f3\" id=\"canvas\"></canvas>\n<div id=\"container\">\n\t<ul>\n\t\t<li><input id=\"btn-color\" type=\"color\"></li>\n\t\t<li id=\"btn-eraser\" class=\"btn btn-color\" data-color=\"\"><i class=\"fa fa-eraser\" aria-hidden=\"true\"></i></li>\n\t</ul>\n\t<ul>\n\t\t<li class=\"btn btn-size\" data-size=\"1\">1</li>\n\t\t<li class=\"btn btn-size\" data-size=\"5\">5</li>\n\t\t<li class=\"btn btn-size\" data-size=\"10\">10</li>\n\t</ul>\n\t<ul>\n\t\t<li class=\"btn btn-emoji\" data-emoji=\"\"></li>\n\t\t<li class=\"btn btn-emoji\" data-emoji=\"\u2b50\ufe0f\">\u2b50\ufe0f</li>\n\t\t<li class=\"btn btn-emoji\" data-emoji=\"\ud83c\udf40\">\ud83c\udf40</li>\n\t\t<li class=\"btn btn-emoji\" data-emoji=\"\ud83d\ude0a\">\ud83d\ude0a</li>\n\t</ul>\n</div>\n```\n\n\n```javascript\nvar old_x = 0;\nvar old_y = 0;\nvar x;\nvar y;\nvar globalCompositeOperation  = 'source-over';\nvar selectColor = '#000';\nvar selectSize = 1;\nvar selectEmoji = '';\n\nvar canvas = document.getElementById(\"canvas\");\nvar ctx = canvas.getContext('2d');\n\nwindow.onload = function() {\n\tcanvas.height = canvas.width = 300;\n\tcanvas.addEventListener(\"touchstart\", touchStart, false);\n\tcanvas.addEventListener(\"touchmove\", touchMove, false);\n\tcanvas.addEventListener(\"orientationchange\", canvasDelete, true);\n}\n\nfunction touchStart(e) {\n\told_x = e.touches[0].pageX;\n\told_y = e.touches[0].pageY;\n}\n\nfunction touchMove(e) {\n\te.preventDefault();\n\n\tx = e.touches[0].pageX;\n\ty = e.touches[0].pageY;\n\n\tdrawLine(old_x, old_y, x, y);\n\told_x = x;\n\told_y = y;\n}\n\nfunction drawLine(x1, y1, x2, y2) {\n    ctx.globalCompositeOperation = globalCompositeOperation;\n    ctx.strokeStyle = selectColor;\n\tctx.beginPath();\n    ctx.lineJoin = \"round\";\n    ctx.lineCap = \"round\";\n    ctx.lineWidth = selectSize;\n\tctx.moveTo(x1, y1);\n\tctx.lineTo(x2, y2);\n\tctx.fillStyle = selectColor;\n    ctx.font = \"20px sans\";\n    ctx.fillText(selectEmoji, x2-30, y2);\n\tctx.closePath();\n\tctx.stroke();\n}\n\n// \u5de6\u306b\u50be\u3051\u308b\u3068\u6d88\u53bb\nfunction canvasDelete(e) {\n\tif (window.orientation >= 90) { // \u5de6\u306b90\u5ea6 \u53f3\u306a\u3089-90\u5ea6\n\t\tvar alert = confirm(\"\u6d88\u53bb\u3057\u307e\u3059\u304b\uff1f\");\n\t\tif (alert == false) {return;}\n\t\tvar ctx = canvas.getContext('2d');\n\t\tctx.clearRect(0, 0, canvas.width, canvas.height);\n\t}\n}\n\n// \u8272\u306e\u5909\u66f4\n$('#btn-color').on('change', function(){\n\tselectColor = $(this).val();\n});\n\n// \u6d88\u3057\u30b4\u30e0\nvar flag_eraser = true;\n$(\"#btn-eraser\").on('click', function(){\n\tif ( flag_eraser ) {\n\t\tglobalCompositeOperation = 'destination-out';\n\t\tflag_eraser = false;\n\t} else {\n\t\tglobalCompositeOperation = 'source-over';\n\t\tflag_eraser = true; \n\t}\n});\n\n// \u30b5\u30a4\u30ba\u306e\u5909\u66f4\n$('.btn-size').on('touchstart', function(){\n\tselectSize = $(this).data('size');\n});\n\n// \u7d75\u6587\u5b57\u306e\u5909\u66f4\n$('.btn-emoji').on('touchstart', function(){\n\tselectEmoji = $(this).data('emoji');\n});\n```\n\n[globalCompositeOperation \u30d7\u30ed\u30d1\u30c6\u30a3](http://www.html5.jp/canvas/ref/property/globalCompositeOperation.html)\n", "tags": ["JavaScript", "canvas"]}