{"context": "\n\n\u6982\u8981\nPHP \u7b49\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30fc\u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650\u3092\u6c17\u306b\u3059\u308b\u74b0\u5883\u306e\u305f\u3081\u306b\u3001 Redhat Software Collection (RHSCL) \u306e CentOS \u7248\u306e SCLo \u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\n\n\u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u4f8b\n\nCentOS 7.2.1511 (1610-01)\nApache 2.4.18 (RHSCL)\nMySQL 5.6.26 (RHSCL)\nPHP 5.6.5 (RHSCL)\n\n\n\u74b0\u5883\u69cb\u7bc9\n\nSCLo \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\nyum install centos-release-scl scl-utils\n\n\nApache 2.4 / PHP 5.6 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install rh-php56 rh-php56-php rh-php56-php-{gd,intl,mbstring,mysqlnd,opcache,process,xml}\n\nsource scl_source enable rh-php56\ncat << \"_EOF_\" > /etc/profile.d/rh-php56.sh\n#!/bin/bash\nsource scl_source enable rh-php56\n_EOF_\n\nsource scl_source enable httpd24\ncat << \"_EOF_\" > /etc/profile.d/httpd24.sh\n#!/bin/bash\nsource scl_source enable httpd24\n_EOF_\n\nsed -i.org 's|;date.timezone =|date.timezone = Asia/Tokyo|' /etc/opt/rh/rh-php56/php.ini\nsed -i '/memory_limit/ s/128M/256M/' /etc/opt/rh/rh-php56/php.ini\nsystemctl start httpd24-httpd && systemctl enable httpd24-httpd\n\n\nMySQL 5.6 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum install rh-mysql56-mysql-server\n\nsource scl_source enable rh-mysql56\ncat << \"_EOF_\" > /etc/profile.d/rh-mysql56.sh\n#!/bin/bash\nsource scl_source enable rh-mysql56\n_EOF_\n\ncat << \"_EOF_\" > /etc/my.cnf.d/ezpublish.cnf\ncharacter-set-server = utf8\ninnodb_buffer_pool_size = 128M\n_EOF_\nsystemctl start rh-mysql56-mysqld && systemctl enable rh-mysql56-mysqld\n\nmysql_secure_installation \n\n\nFirewallD \u306e\u8a2d\u5b9a\nfirewall-cmd --add-service={http,https,mysql} --permanent && firewall-cmd --reload\nfirewall-cmd --list-services\n\n\neZ Publish\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068DB\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\ncat << \"_EOQ_\" | mysql -u root -p\nCREATE DATABASE `ezpublish` CHARACTER SET 'utf8';\nCREATE USER 'ezpublish'@'localhost' IDENTIFIED BY 'ezpublish';\nGRANT ALL ON ezpublish.* TO 'ezpublish'@'localhost';\n_EOQ_\n\n\n\u30d5\u30a1\u30a4\u30eb\u306e\u5c55\u958b\u3068\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\ntar xf ezpublish5-5.4.0-ee-bul-full.tar.gz -C /opt/rh/httpd24/root/var/www\nchown apache:apache -R /opt/rh/httpd24/root/var/www/ezpublish5/*\ncd /opt/rh/httpd24/root/var/www/ezpublish5/\nsetfacl -R -m u:apache:rwx -m u:apache:rwx ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\nsetfacl -dR -m u:apache:rwx -m u:apache:rwx ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\nchcon -R -t httpd_sys_script_rw_t ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\n\n\n\u30b9\u30ef\u30c3\u30d7\u9818\u57df\u306e\u4f5c\u6210\ndd if=/dev/zero of=/var/tmp/swap bs=1M count=1024\nmkswap /var/tmp/swap\nchmod 600 /var/tmp/swap\nswapon /var/tmp/swap\n\n\nComposer\nhttps://doc.ez.no/display/EZP/Using+Composer\nhttps://doc.ez.no/display/EZP/5.4.x+Update+Instructions\nphp -r \"copy('https://getcomposer.org/download/1.0.3/composer.phar', 'composer.phar');\"\nphp -d memory_limit=-1 composer.phar config http-basic.updates.ez.no <installation-key> <token-password>\nphp -d memory_limit=-1 composer.phar update --no-dev --prefer-dist --no-scripts ezsystems/ezpublish-legacy-installer\nphp -d memory_limit=-1 composer.phar selfupdate \nphp -d memory_limit=-1 composer.phar remove --no-update --dev behat/mink-selenium-driver\nphp -d memory_limit=-1 composer.phar require --no-update symfony/symfony:~2.7.0 sensio/distribution-bundle:~3.0\nphp -d memory_limit=-1 composer.phar install --no-dev --prefer-dist\nsed -i '/LegacyBundle;/i use eZ\\\\Bundle\\\\EzPublishLegacySearchEngineBundle\\\\EzPublishLegacySearchEngineBundle;' /opt/rh/httpd24/root/var/www/ezpublish5/ezpublish/EzPublishKernel.php\nsed -i '/LegacyBundle(/i \\            new EzPublishLegacySearchEngineBundle(),' /opt/rh/httpd24/root/var/www/ezpublish5/ezpublish/EzPublishKernel.php\n\n\nVirtualHost \u306e\u8a2d\u5b9a\nhttps://github.com/ezsystems/ezpublish-community/tree/master/doc/apache2\ncp -a /opt/rh/httpd24/root/var/www/ezpublish5/doc/apache2/vhost.template /opt/rh/httpd24/root/etc/httpd/conf.d/ezpublish.conf\nsed -i \\\n-e 's/%IP_ADDRESS%:%PORT%>/*:80>/' \\\n-e 's/ServerName %HOST%/ServerName www.example.com/' \\\n-e 's/ServerAlias %HOST_ALIAS%/ServerAlias localhost/' \\\n-e 's/%BASEDIR%\\/web/\\/opt\\/rh\\/httpd24\\/root\\/var\\/www\\/ezpublish5\\/web/' \\\n-e 's/=%ENV%/=dev/' /opt/rh/httpd24/root/etc/httpd/conf.d/ezpublish.conf\n\n## \u6982\u8981\nPHP \u7b49\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30fc\u306e\u30b5\u30dd\u30fc\u30c8\u671f\u9650\u3092\u6c17\u306b\u3059\u308b\u74b0\u5883\u306e\u305f\u3081\u306b\u3001 Redhat Software Collection (RHSCL) \u306e CentOS \u7248\u306e SCLo \u306b\u3088\u308b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\n\n## \u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u4f8b\n* CentOS 7.2.1511 (1610-01)\n* Apache 2.4.18 (RHSCL)\n* MySQL 5.6.26 (RHSCL)\n* PHP 5.6.5 (RHSCL)\n\n## \u74b0\u5883\u69cb\u7bc9\n### SCLo \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u8ffd\u52a0\n```bash\nyum install centos-release-scl scl-utils\n```\n\n### Apache 2.4 / PHP 5.6 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash\nyum install rh-php56 rh-php56-php rh-php56-php-{gd,intl,mbstring,mysqlnd,opcache,process,xml}\n```\n```bash\nsource scl_source enable rh-php56\ncat << \"_EOF_\" > /etc/profile.d/rh-php56.sh\n#!/bin/bash\nsource scl_source enable rh-php56\n_EOF_\n```\n```bash\nsource scl_source enable httpd24\ncat << \"_EOF_\" > /etc/profile.d/httpd24.sh\n#!/bin/bash\nsource scl_source enable httpd24\n_EOF_\n```\n```bash\nsed -i.org 's|;date.timezone =|date.timezone = Asia/Tokyo|' /etc/opt/rh/rh-php56/php.ini\nsed -i '/memory_limit/ s/128M/256M/' /etc/opt/rh/rh-php56/php.ini\nsystemctl start httpd24-httpd && systemctl enable httpd24-httpd\n```\n\n### MySQL 5.6 \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```bash\nyum install rh-mysql56-mysql-server\n```\n```\nsource scl_source enable rh-mysql56\ncat << \"_EOF_\" > /etc/profile.d/rh-mysql56.sh\n#!/bin/bash\nsource scl_source enable rh-mysql56\n_EOF_\n```\n```bash\ncat << \"_EOF_\" > /etc/my.cnf.d/ezpublish.cnf\ncharacter-set-server = utf8\ninnodb_buffer_pool_size = 128M\n_EOF_\nsystemctl start rh-mysql56-mysqld && systemctl enable rh-mysql56-mysqld\n```\n```\nmysql_secure_installation \n```\n### FirewallD \u306e\u8a2d\u5b9a\n```bash\nfirewall-cmd --add-service={http,https,mysql} --permanent && firewall-cmd --reload\nfirewall-cmd --list-services\n```\n\n## eZ Publish\n### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068DB\u30e6\u30fc\u30b6\u30fc\u306e\u4f5c\u6210\n```bash\ncat << \"_EOQ_\" | mysql -u root -p\nCREATE DATABASE `ezpublish` CHARACTER SET 'utf8';\nCREATE USER 'ezpublish'@'localhost' IDENTIFIED BY 'ezpublish';\nGRANT ALL ON ezpublish.* TO 'ezpublish'@'localhost';\n_EOQ_\n```\n### \u30d5\u30a1\u30a4\u30eb\u306e\u5c55\u958b\u3068\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n```bash\ntar xf ezpublish5-5.4.0-ee-bul-full.tar.gz -C /opt/rh/httpd24/root/var/www\nchown apache:apache -R /opt/rh/httpd24/root/var/www/ezpublish5/*\ncd /opt/rh/httpd24/root/var/www/ezpublish5/\nsetfacl -R -m u:apache:rwx -m u:apache:rwx ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\nsetfacl -dR -m u:apache:rwx -m u:apache:rwx ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\nchcon -R -t httpd_sys_script_rw_t ezpublish/{cache,logs,config,sessions} ezpublish_legacy/{design,extension,settings,var} web\n```\n\n### \u30b9\u30ef\u30c3\u30d7\u9818\u57df\u306e\u4f5c\u6210\n```bash\ndd if=/dev/zero of=/var/tmp/swap bs=1M count=1024\nmkswap /var/tmp/swap\nchmod 600 /var/tmp/swap\nswapon /var/tmp/swap\n```\n\n### Composer\nhttps://doc.ez.no/display/EZP/Using+Composer\nhttps://doc.ez.no/display/EZP/5.4.x+Update+Instructions\n\n```bash\nphp -r \"copy('https://getcomposer.org/download/1.0.3/composer.phar', 'composer.phar');\"\nphp -d memory_limit=-1 composer.phar config http-basic.updates.ez.no <installation-key> <token-password>\nphp -d memory_limit=-1 composer.phar update --no-dev --prefer-dist --no-scripts ezsystems/ezpublish-legacy-installer\nphp -d memory_limit=-1 composer.phar selfupdate \nphp -d memory_limit=-1 composer.phar remove --no-update --dev behat/mink-selenium-driver\nphp -d memory_limit=-1 composer.phar require --no-update symfony/symfony:~2.7.0 sensio/distribution-bundle:~3.0\nphp -d memory_limit=-1 composer.phar install --no-dev --prefer-dist\nsed -i '/LegacyBundle;/i use eZ\\\\Bundle\\\\EzPublishLegacySearchEngineBundle\\\\EzPublishLegacySearchEngineBundle;' /opt/rh/httpd24/root/var/www/ezpublish5/ezpublish/EzPublishKernel.php\nsed -i '/LegacyBundle(/i \\            new EzPublishLegacySearchEngineBundle(),' /opt/rh/httpd24/root/var/www/ezpublish5/ezpublish/EzPublishKernel.php\n```\n### VirtualHost \u306e\u8a2d\u5b9a\nhttps://github.com/ezsystems/ezpublish-community/tree/master/doc/apache2\n\n```\ncp -a /opt/rh/httpd24/root/var/www/ezpublish5/doc/apache2/vhost.template /opt/rh/httpd24/root/etc/httpd/conf.d/ezpublish.conf\nsed -i \\\n-e 's/%IP_ADDRESS%:%PORT%>/*:80>/' \\\n-e 's/ServerName %HOST%/ServerName www.example.com/' \\\n-e 's/ServerAlias %HOST_ALIAS%/ServerAlias localhost/' \\\n-e 's/%BASEDIR%\\/web/\\/opt\\/rh\\/httpd24\\/root\\/var\\/www\\/ezpublish5\\/web/' \\\n-e 's/=%ENV%/=dev/' /opt/rh/httpd24/root/etc/httpd/conf.d/ezpublish.conf\n```\n", "tags": ["eZPublish5.4", "CentOS7", "CMS"]}