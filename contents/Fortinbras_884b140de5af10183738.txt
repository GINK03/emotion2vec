{"context": "\n\nex1)\u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3092\u4efb\u610f\u306e\u30c6\u30fc\u30d6\u30eb\u306bInsert\u51e6\u7406\u3059\u308b\uff08\u305d\u306e\uff11\uff09\n\u3000\u6700\u521d\u306e\u9803\u306f\u4e0d\u672c\u610f\u306a\u304c\u3089\u3001\u611a\u76f4\uff1f\u306bmyobject\u306b\u5404\u5217\u306e\u5024\u3092\u30bb\u30c3\u30c8\u3057\u3066session.add(myobject)\u3059\u308b\u51e6\u7406\u3092for\u30eb\u30fc\u30d7\u3067\u7e70\u308a\u8fd4\u3059\u65b9\u6cd5\u3067\u30c6\u30fc\u30d6\u30eb\u306b\uff11\u884c\u305a\u3064\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3057\u3066\u304a\u308a\u307e\u3057\u305forz\n\nsql_insert_old.py\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\nclass Hogega_tmp(Base):\n    __tablename__ = 'hogega_tmps'\n    id = sqlalchemy.Column(sqlalchemy.Integer, primary_key=True)\n    y = sqlalchemy.Column(sqlalchemy.String(10))\n    m = sqlalchemy.Column(sqlalchemy.String(10))\n    d = sqlalchemy.Column(sqlalchemy.String(10))\n    dim4 = sqlalchemy.Column(sqlalchemy.String(100))\n    pv = sqlalchemy.Column(sqlalchemy.String(50))\n    rsf = sqlalchemy.Column(sqlalchemy.String(10))\n    fld = sqlalchemy.Column(sqlalchemy.String(10))\n\ndef orm(data,fld):\n\n    # SQLAlchemy\u306e\u521d\u671f\u5316\n    CONNECT_INFO = 'mssql+pyodbc://hogehoge'\n    engine = sqlalchemy.create_engine(CONNECT_INFO, encoding='utf-8')\n\n    # \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\n    Session = sqlalchemy.orm.sessionmaker(bind=engine)\n    session = Session()\n\n    #\u7121\u4f5c\u70ba\u62bd\u51fa\u6a5f\u80fd\u6709\u7121\n    if data[\"containsSampledData\"]:\n       rsf=1\n    else:\n       rsf=0\n    cnt=data[\"totalResults\"]\n    print(ref)\n\n    #\u30eb\u30fc\u30d7\u51e6\u7406\u30671\u4ef6\u305a\u3064\u30c6\u30fc\u30d6\u30eb\u306b\u30ec\u30b3\u30fc\u30c9\u633f\u5165\n    if cnt!=0: \n       for i,n in enumerate(data[\"rows\"]): \n           print(i)\n           if fld.find(\"source\")!= -1: \n               myobject = Hogega_tmp(y=n[0],m=n[1],d=n[2],dim4=n[3],pv=n[4]\n                                     rsf=rsf,fld=fld)\n\n           session.add(myobject) #\u884c\u633f\u5165\n           if fld.find(\"source\")!= -1 and i>=24: #\u633f\u5165\u4ef6\u6570\u3092\u9650\u5b9a\n                  break\n       session.commit() #\u30b3\u30df\u30c3\u30c8\n    session.close() #\u30bb\u30c3\u30b7\u30e7\u30f3\u9589\u3058\u308b\n\n\n\n\u6ce8\uff09\u4e0a\u8a18\u3067\u306f\u4f8b\u3048\u3070Google Analytics\u306eAPI\u3092\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3092\u3001SQL Server\u306b\u683c\u7d0d\u3059\u308b\u30b7\u30fc\u30f3\u3092\u60f3\u5b9a\n\nex2)\u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3092\u4efb\u610f\u306e\u30c6\u30fc\u30d6\u30eb\u306bInsert\u51e6\u7406\u3059\u308b\uff08\u305d\u306e\uff12\uff09\n\u30001\u4ef6\u305a\u3064\u884c\u633f\u5165\u3092\u7e70\u308a\u8fd4\u3059\u306e\u306f\u3084\u306f\u308a\u30a4\u30b1\u3066\u306a\u3044\u3068\u3044\u3046\u304b\u3001SQL\u3067\u3082\u8907\u6570\u30c7\u30fc\u30bf\u30921\u56de\u306eInsert\u6587\u3067\u307e\u3068\u3081\u3066\u884c\u633f\u5165\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u304cSqlalchemy\u3067\u5b9f\u73fe\u3067\u304d\u306a\u3044\u3082\u306e\u304b\u6a21\u7d22\u3057\u305f\u306e\u304c\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\nsql_insert_new.py\n\ndef orm2(data,fld):\n\n    # SQLAlchemy\u306e\u521d\u671f\u5316\n    CONNECT_INFO = 'mssql+pyodbc://hogehoge'\n    engine = sqlalchemy.create_engine(CONNECT_INFO, encoding='utf-8')\n\n    # \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\n    Session = sqlalchemy.orm.sessionmaker(bind=engine)\n    session = Session()\n\n    #\u7121\u4f5c\u70ba\u62bd\u51fa\u6a5f\u80fd\u6709\u7121\n    if data[\"containsSampledData\"]:\n       rsf=1\n    else:\n       rsf=0\n\n\n    clm =[\"y\",\"m\",\"d\",\"dim4\",\"pv\",\"rsf\",\"fld\"]\n    ex=[rsf,fld]\n    cnt=data[\"totalResults\"]\n\n    if cnt!=0: \n       rws = data[\"rows\"]   \n       if fld.find(\"source\")!= -1: \n          rws = rws[:25] #\u633f\u5165\u4ef6\u6570\u3092\u9650\u5b9a\n\n       #\u884c\u633f\u5165\n       lst = [dict(zip(clm,r+ex)) for r in rws ] #value\u53e5\u751f\u6210\n       ins_statement = Hogega_tmp.__table__.insert().values(lst)\n       session.execute(ins_statement)   \n       session.commit()\n       session.close()\n\n\n\n\n\u88dc\u8db3\n\u3000Insert\u6587\u3092\u5f15\u6570\uff08lst\uff09\u306e\u90e8\u5206\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u300c\u8907\u6570\u306e\u8f9e\u66f8\u3092\u5185\u5305\u3057\u3066\u3044\u308b\u30ea\u30b9\u30c8\u300d\u3092\u8a18\u8ff0\u3059\u308c\u3070\u3001for\u30eb\u30fc\u30d7\u3067\uff11\u4ef6\u305a\u3064\u633f\u5165\u51e6\u7406\u3092\u7e70\u308a\u8fd4\u3057\u3057\u306a\u304f\u3066\u3082\u3001\u8907\u6570\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067\u30c6\u30fc\u30d6\u30eb\u884c\u633f\u5165\u304c\u3067\u304d\u308b\u6a21\u69d8\u3002\uff08\u3064\u307e\u308aSQL\u306e\u300cInsert Into ... Values ...\u300d\u306eValues\u53e5\u306e\u90e8\u5206\u306b\u76f8\u5f53\uff09\n\nsql_insert_apdx1.py\n[{y:2016,m:5,d:1,dim4:yahoo,pv:100},\n {y:2016,m:5,d:1,dim4:google,pv:200},\n    ...\n {y:2016,m:5,d:1,dim4:smartnews,pv:300}]\n\n\n\u3000\u306a\u304a\u4e0a\u8a18\u306esql_insert_new.py\u3067\u306f\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306elst\u306f\u3001\u51e6\u7406\u306e\u610f\u5473\u3092\u304b\u307f\u7815\u304f\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a4\u30e1\u30fc\u30b8\u306b\u306a\u308b\u3002\n\nsql_insert_apdx2.py\nlst = list()\nfor r in rws:\n    vle = r+ex\n    y = dict(zip(clm,vle)\n    lst.append(y)\n\n\n\uff08vle\u304c\u30c6\u30fc\u30d6\u30eb\u306b\u683c\u7d0d\u3059\u308b\u5024\u3001clm\u304c\u30c6\u30fc\u30d6\u30eb\u5217\u540d\u306b\u76f8\u5f53\u3057\u3001\u305d\u308c\u3089\uff12\u3064\u306e\u30b7\u30fc\u30b1\u30f3\u30b7\u30e3\u30eb\u3092ZIP()\u3067\u30ea\u30b9\u30c8\u5316\u3057\u3066\u8f9e\u66f8\u578by\u306b\u3057\u305f\u3082\u306e\u3092\u3001\u30ea\u30b9\u30c8lst\u306b\u9806\u6b21\u8ffd\u8a18\u3059\u308b\u51e6\u7406\u3092for\u30eb\u30fc\u30d7\u3067\u7e70\u308a\u8fd4\u3059\u7684\u306a\u610f\u5473\u5408\u3044\uff09\n###ex1)\u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3092\u4efb\u610f\u306e\u30c6\u30fc\u30d6\u30eb\u306bInsert\u51e6\u7406\u3059\u308b\uff08\u305d\u306e\uff11\uff09\n\n\u3000\u6700\u521d\u306e\u9803\u306f\u4e0d\u672c\u610f\u306a\u304c\u3089\u3001\u611a\u76f4\uff1f\u306bmyobject\u306b\u5404\u5217\u306e\u5024\u3092\u30bb\u30c3\u30c8\u3057\u3066session.add(myobject)\u3059\u308b\u51e6\u7406\u3092for\u30eb\u30fc\u30d7\u3067\u7e70\u308a\u8fd4\u3059\u65b9\u6cd5\u3067\u30c6\u30fc\u30d6\u30eb\u306b\uff11\u884c\u305a\u3064\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3057\u3066\u304a\u308a\u307e\u3057\u305forz\n\n```py3:sql_insert_old.py\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\nclass Hogega_tmp(Base):\n    __tablename__ = 'hogega_tmps'\n    id = sqlalchemy.Column(sqlalchemy.Integer, primary_key=True)\n    y = sqlalchemy.Column(sqlalchemy.String(10))\n    m = sqlalchemy.Column(sqlalchemy.String(10))\n    d = sqlalchemy.Column(sqlalchemy.String(10))\n    dim4 = sqlalchemy.Column(sqlalchemy.String(100))\n    pv = sqlalchemy.Column(sqlalchemy.String(50))\n    rsf = sqlalchemy.Column(sqlalchemy.String(10))\n    fld = sqlalchemy.Column(sqlalchemy.String(10))\n\ndef orm(data,fld):\n    \n    # SQLAlchemy\u306e\u521d\u671f\u5316\n    CONNECT_INFO = 'mssql+pyodbc://hogehoge'\n    engine = sqlalchemy.create_engine(CONNECT_INFO, encoding='utf-8')\n\n    # \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\n    Session = sqlalchemy.orm.sessionmaker(bind=engine)\n    session = Session()\n\n    #\u7121\u4f5c\u70ba\u62bd\u51fa\u6a5f\u80fd\u6709\u7121\n    if data[\"containsSampledData\"]:\n       rsf=1\n    else:\n       rsf=0\n    cnt=data[\"totalResults\"]\n    print(ref)\n\n    #\u30eb\u30fc\u30d7\u51e6\u7406\u30671\u4ef6\u305a\u3064\u30c6\u30fc\u30d6\u30eb\u306b\u30ec\u30b3\u30fc\u30c9\u633f\u5165\n    if cnt!=0: \n       for i,n in enumerate(data[\"rows\"]): \n           print(i)\n           if fld.find(\"source\")!= -1: \n               myobject = Hogega_tmp(y=n[0],m=n[1],d=n[2],dim4=n[3],pv=n[4]\n                                     rsf=rsf,fld=fld)\n       \n           session.add(myobject) #\u884c\u633f\u5165\n           if fld.find(\"source\")!= -1 and i>=24: #\u633f\u5165\u4ef6\u6570\u3092\u9650\u5b9a\n                  break\n       session.commit() #\u30b3\u30df\u30c3\u30c8\n    session.close() #\u30bb\u30c3\u30b7\u30e7\u30f3\u9589\u3058\u308b\n\n```\n\u6ce8\uff09\u4e0a\u8a18\u3067\u306f\u4f8b\u3048\u3070Google Analytics\u306eAPI\u3092\u5b9f\u884c\u3057\u305f\u7d50\u679c\u3092\u3001SQL Server\u306b\u683c\u7d0d\u3059\u308b\u30b7\u30fc\u30f3\u3092\u60f3\u5b9a\n\n###ex2)\u8907\u6570\u30ec\u30b3\u30fc\u30c9\u3092\u4efb\u610f\u306e\u30c6\u30fc\u30d6\u30eb\u306bInsert\u51e6\u7406\u3059\u308b\uff08\u305d\u306e\uff12\uff09\n\n\u30001\u4ef6\u305a\u3064\u884c\u633f\u5165\u3092\u7e70\u308a\u8fd4\u3059\u306e\u306f\u3084\u306f\u308a\u30a4\u30b1\u3066\u306a\u3044\u3068\u3044\u3046\u304b\u3001SQL\u3067\u3082\u8907\u6570\u30c7\u30fc\u30bf\u30921\u56de\u306eInsert\u6587\u3067\u307e\u3068\u3081\u3066\u884c\u633f\u5165\u3067\u304d\u308b\u306e\u3067\u3001\u305d\u308c\u304cSqlalchemy\u3067\u5b9f\u73fe\u3067\u304d\u306a\u3044\u3082\u306e\u304b\u6a21\u7d22\u3057\u305f\u306e\u304c\u4ee5\u4e0b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3002\n\n```py3:sql_insert_new.py\n\ndef orm2(data,fld):\n    \n    # SQLAlchemy\u306e\u521d\u671f\u5316\n    CONNECT_INFO = 'mssql+pyodbc://hogehoge'\n    engine = sqlalchemy.create_engine(CONNECT_INFO, encoding='utf-8')\n\n    # \u30bb\u30c3\u30b7\u30e7\u30f3\u4f5c\u6210\n    Session = sqlalchemy.orm.sessionmaker(bind=engine)\n    session = Session()\n\n    #\u7121\u4f5c\u70ba\u62bd\u51fa\u6a5f\u80fd\u6709\u7121\n    if data[\"containsSampledData\"]:\n       rsf=1\n    else:\n       rsf=0\n\n\n    clm =[\"y\",\"m\",\"d\",\"dim4\",\"pv\",\"rsf\",\"fld\"]\n    ex=[rsf,fld]\n    cnt=data[\"totalResults\"]\n\n    if cnt!=0: \n       rws = data[\"rows\"]   \n       if fld.find(\"source\")!= -1: \n          rws = rws[:25] #\u633f\u5165\u4ef6\u6570\u3092\u9650\u5b9a\n\n       #\u884c\u633f\u5165\n       lst = [dict(zip(clm,r+ex)) for r in rws ] #value\u53e5\u751f\u6210\n       ins_statement = Hogega_tmp.__table__.insert().values(lst)\n       session.execute(ins_statement)   \n       session.commit()\n       session.close()\n\n```\n\n### \u88dc\u8db3\n\u3000Insert\u6587\u3092\u5f15\u6570\uff08lst\uff09\u306e\u90e8\u5206\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u300c\u8907\u6570\u306e\u8f9e\u66f8\u3092\u5185\u5305\u3057\u3066\u3044\u308b\u30ea\u30b9\u30c8\u300d\u3092\u8a18\u8ff0\u3059\u308c\u3070\u3001for\u30eb\u30fc\u30d7\u3067\uff11\u4ef6\u305a\u3064\u633f\u5165\u51e6\u7406\u3092\u7e70\u308a\u8fd4\u3057\u3057\u306a\u304f\u3066\u3082\u3001\u8907\u6570\u30c7\u30fc\u30bf\u3092\u4e00\u62ec\u3067\u30c6\u30fc\u30d6\u30eb\u884c\u633f\u5165\u304c\u3067\u304d\u308b\u6a21\u69d8\u3002\uff08\u3064\u307e\u308aSQL\u306e\u300cInsert Into ... Values ...\u300d\u306eValues\u53e5\u306e\u90e8\u5206\u306b\u76f8\u5f53\uff09\n\n```py3:sql_insert_apdx1.py\n[{y:2016,m:5,d:1,dim4:yahoo,pv:100},\n {y:2016,m:5,d:1,dim4:google,pv:200},\n    ...\n {y:2016,m:5,d:1,dim4:smartnews,pv:300}]\n```\n\n\u3000\u306a\u304a\u4e0a\u8a18\u306e`sql_insert_new.py`\u3067\u306f\u30ea\u30b9\u30c8\u5185\u5305\u8868\u8a18\u306elst\u306f\u3001\u51e6\u7406\u306e\u610f\u5473\u3092\u304b\u307f\u7815\u304f\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a4\u30e1\u30fc\u30b8\u306b\u306a\u308b\u3002\n\n```py3:sql_insert_apdx2.py\nlst = list()\nfor r in rws:\n    vle = r+ex\n    y = dict(zip(clm,vle)\n    lst.append(y)\n```\n\uff08vle\u304c\u30c6\u30fc\u30d6\u30eb\u306b\u683c\u7d0d\u3059\u308b\u5024\u3001clm\u304c\u30c6\u30fc\u30d6\u30eb\u5217\u540d\u306b\u76f8\u5f53\u3057\u3001\u305d\u308c\u3089\uff12\u3064\u306e\u30b7\u30fc\u30b1\u30f3\u30b7\u30e3\u30eb\u3092ZIP()\u3067\u30ea\u30b9\u30c8\u5316\u3057\u3066\u8f9e\u66f8\u578by\u306b\u3057\u305f\u3082\u306e\u3092\u3001\u30ea\u30b9\u30c8lst\u306b\u9806\u6b21\u8ffd\u8a18\u3059\u308b\u51e6\u7406\u3092for\u30eb\u30fc\u30d7\u3067\u7e70\u308a\u8fd4\u3059\u7684\u306a\u610f\u5473\u5408\u3044\uff09\n", "tags": ["Python", "python3", "sqlalchemy", "SQLServer"]}