{"context": "\u3044\u308d\u3044\u308d\u3084\u3063\u3061\u3083\u3063\u3066\u30ab\u30fc\u30cd\u30eb\u3092\u3088\u304f\u843d\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\u306e\u30e1\u30e2\u3067\u3059\u3002\n# etherswitchcfg\netherswitch0: VLAN mode: DOT1Q\nport0:\n        pvid: 2\n        flags=0<>\n        media: Ethernet autoselect (Trap cause = 2 (TLB miss (load or instr. fet\nch) - kernel mode)\n[ thread pid 58 tid 100052 ]\nStopped at      mii_attach_proxy+0x1714:        lw      a0,300(s0)\ndb> \n\n\u3053\u3093\u306a\u30d0\u30b0\u304c\u3042\u3063\u305f\u6642\u306b\u3068\u308a\u3042\u3048\u305a\u30ab\u30fc\u30cd\u30eb\u3092\u9006\u30a2\u30bb\u30f3\u30d6\u30e9\u3057\u307e\u3059\u3002\nmips.mips\u306e\u30af\u30ed\u30b9\u306e\u30d3\u30eb\u30c9\u306a\u306e\u3067\u30af\u30ed\u30b9\u7528\u306eobjdump\u3067\u9006\u30a2\u30bb\u30f3\u30d6\u30e9\u3057\u307e\u3059\u3002ZRouter\u306e\u30d3\u30eb\u30c9\u3067\u306fkernel\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306etmp\u306e\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\nmicroserver % `find tmp/mips.mips -name objdump -type f | head -1` -d Buffalo_WZ\nR-HP-G301NH_kernel | more\n\nmii_attach_proxy\u3092\u63a2\u3057\u307e\u3059\u3002\nmii_attach_proxy\u306f\u3042\u304f\u307e\u3067\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u30b9\u30bf\u30fc\u30c8\u30dd\u30b8\u30b7\u30e7\u30f3\u3067\u3001\u3053\u306e\u95a2\u6570\u304c\u539f\u56e0\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n8008eb3c <mii_attach_proxy>:\n8008eb3c:       27bdffd0        addiu   sp,sp,-48\n8008eb40:       afb30024        sw      s3,36(sp)\n8008eb44:       00809821        move    s3,a0\n8008eb48:       afbf002c        sw      ra,44(sp)\n8008eb4c:       afb00018        sw      s0,24(sp)\n8008eb50:       afb40028        sw      s4,40(sp)\n8008eb54:       afb20020        sw      s2,32(sp)\n8008eb58:       0c062d23        jal     8018b48c <device_get_name>\n\n0x8008eb3c+0x1714=0x80090250\u3092\u63a2\u3057\u307e\u3059\u3002\u4f59\u8ac7\u3067\u3059\u304cMac OS X\u306e\u8a08\u7b97\u6a5f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f16\u9032\u3082\u8a08\u7b97\u3067\u304d\u3066\u4fbf\u5229\u3067\u3059\u3002\n\n800901fc <rtl_getvgroup>:\n800901fc:       27bdffd0        addiu   sp,sp,-48\n80090200:       afb30024        sw      s3,36(sp)\n80090204:       afb20020        sw      s2,32(sp)\n80090208:       afb1001c        sw      s1,28(sp)\n8009020c:       afb00018        sw      s0,24(sp)\n80090210:       00809821        move    s3,a0\n80090214:       00a09021        move    s2,a1\n80090218:       27b10010        addiu   s1,sp,16\n8009021c:       00008021        move    s0,zero\n80090220:       08024094        j       80090250 <rtl_getvgroup+0x54>\n80090224:       afbf0028        sw      ra,40(sp)\n80090228:       8e420000        lw      v0,0(s2)\n8009022c:       26030020        addiu   v1,s0,32\n80090230:       24050003        li      a1,3\n80090234:       70452002        mul     a0,v0,a1\n80090238:       26100001        addiu   s0,s0,1\n8009023c:       00832821        addu    a1,a0,v1\n80090240:       0c024074        jal     800901d0 <rtl_readreg>\n80090244:       02602021        move    a0,s3\n80090248:       a6220000        sh      v0,0(s1)\n8009024c:       26310002        addiu   s1,s1,2\n80090250:       8e04012c        lw      a0,300(s0)\n80090254:       24030002        li      v1,2\n80090258:       24020003        li      v0,3\n\nrtl_getvgroup()\u3067\u306e\u5909\u6570\u306e\u521d\u671f\u5fd8\u308c\u3067\u3057\u305f\u3002\n\u30b0\u30ed\u30fc\u30d0\u30eb\u3067\u78ba\u4fdd\u3057\u305f\u5909\u6570\u3092softc\u306b\u3044\u308c\u305f\u65b9\u304c\u826f\u3044\u3063\u3066\u30ec\u30d3\u30e5\u30fc\u304c\u3042\u308a\u3001\u4fee\u6b63\u3057\u305f\u3068\u3053\u308d\u95a2\u6570\u5185\u3067softc\u3092\u521d\u671f\u5316\u3059\u308b\u524d\u306b\u305d\u306e\u5024\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3002\u3002\n\u843d\u3061\u306a\u3044\u3069\u3051\u8abf\u3079\u305f\u3044\u4e8b\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u306e\u30d6\u30ec\u30fc\u30af\u3092\u9001\u308b\u65b9\u6cd5\u3084kdb_break(),panic()\u3092\u30ab\u30fc\u30cd\u30eb\u5185\u306b\u653e\u308a\u8fbc\u3080\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u30e6\u30fc\u30b6\u30e9\u30f3\u30c9\u304b\u3089\u843d\u3068\u3059\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u3067\u304d\u307e\u3059\u3002\nsysctl debug.kdb.enter=1\nor\nsysctl debug.kdb.panic=1\n\nvm_fault(0xc12868e8, 30000, 2, 0) -> 1\nFatal kernel mode data abort: 'Translation Fault (P)'\ntrapframe: 0xc289cd30\nFSR=00000017, FAR=00030000, spsr=20000013\nr0 =00030000, r1 =c1669010, r2 =000007e0, r3 =736e6f63\nr4 =09656c6f, r5 =00000800, r6 =00000000, r7 =00005bc0\nr8 =00000000, r9 =c164b7e0, r10=c164e940, r11=00000040\nr12=73752f22, ssp=c289cd84, slr=696c2f72, pc =c11d8650\n\n[ thread pid 12 tid 100007 ]\nStopped at      memcpy+0x80:    stmia   r0!, {r3-r4, r12, r14}\ndb>\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u843d\u3061\u305f\u6642\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3002\ndb> show proc 12      \nProcess 12 (geom) at 0xc150ec80:\n state: NORMAL\n uid: 0  gids: 0\n parent: pid 0 at 0xc12862b8\n ABI: null\n threads: 3\n100008                   D       -        0xc1285e50 [g_down]\n100007                   Run     CPU 0               [g_up]\n100006                   D       -        0xc1285e44 [g_event]\ndb> show thread 100007\nThread 100007 at 0xc1511330:\n proc (pid 12): 0xc150ec80\n name: g_up\n stack: 0xc289b000-0xc289cfff\n flags: 0x4010004  pflags: 0x200000\n state: RUNNING (CPU 0)\n priority: 92\n container lock: sched lock 0 (0xc1296300)\n\n\n\u843d\u3061\u305a\u306b\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u3057\u3066\u3001\u30d6\u30ec\u30fc\u30af\u3082\u52b9\u304b\u306a\u3044\u306e\u304c\u4e00\u756a\u5384\u4ecb\u3067\u3059\u3002\u3002\u3002\n\n\u53c2\u8003\u8cc7\u6599\nFreeBSD Developers' Handbook Kernel Debugging\nIntroduction to Debugging the FreeBSD Kernel\nDebugging Kernel Problems\n\u3044\u308d\u3044\u308d\u3084\u3063\u3061\u3083\u3063\u3066\u30ab\u30fc\u30cd\u30eb\u3092\u3088\u304f\u843d\u3068\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u30c7\u30d0\u30c3\u30b0\u65b9\u6cd5\u306e\u30e1\u30e2\u3067\u3059\u3002\n\n```\n# etherswitchcfg\netherswitch0: VLAN mode: DOT1Q\nport0:\n        pvid: 2\n        flags=0<>\n        media: Ethernet autoselect (Trap cause = 2 (TLB miss (load or instr. fet\nch) - kernel mode)\n[ thread pid 58 tid 100052 ]\nStopped at      mii_attach_proxy+0x1714:        lw      a0,300(s0)\ndb> \n```\n\n\u3053\u3093\u306a\u30d0\u30b0\u304c\u3042\u3063\u305f\u6642\u306b\u3068\u308a\u3042\u3048\u305a\u30ab\u30fc\u30cd\u30eb\u3092\u9006\u30a2\u30bb\u30f3\u30d6\u30e9\u3057\u307e\u3059\u3002\n\nmips.mips\u306e\u30af\u30ed\u30b9\u306e\u30d3\u30eb\u30c9\u306a\u306e\u3067\u30af\u30ed\u30b9\u7528\u306eobjdump\u3067\u9006\u30a2\u30bb\u30f3\u30d6\u30e9\u3057\u307e\u3059\u3002ZRouter\u306e\u30d3\u30eb\u30c9\u3067\u306fkernel\u304c\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306etmp\u306e\u4e0b\u306b\u3042\u308a\u307e\u3059\u3002\n\n```\nmicroserver % `find tmp/mips.mips -name objdump -type f | head -1` -d Buffalo_WZ\nR-HP-G301NH_kernel | more\n```\n\nmii_attach_proxy\u3092\u63a2\u3057\u307e\u3059\u3002\n\nmii_attach_proxy\u306f\u3042\u304f\u307e\u3067\u30aa\u30d5\u30bb\u30c3\u30c8\u306e\u30b9\u30bf\u30fc\u30c8\u30dd\u30b8\u30b7\u30e7\u30f3\u3067\u3001\u3053\u306e\u95a2\u6570\u304c\u539f\u56e0\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n```\n8008eb3c <mii_attach_proxy>:\n8008eb3c:       27bdffd0        addiu   sp,sp,-48\n8008eb40:       afb30024        sw      s3,36(sp)\n8008eb44:       00809821        move    s3,a0\n8008eb48:       afbf002c        sw      ra,44(sp)\n8008eb4c:       afb00018        sw      s0,24(sp)\n8008eb50:       afb40028        sw      s4,40(sp)\n8008eb54:       afb20020        sw      s2,32(sp)\n8008eb58:       0c062d23        jal     8018b48c <device_get_name>\n```\n\n0x8008eb3c+0x1714=0x80090250\u3092\u63a2\u3057\u307e\u3059\u3002\u4f59\u8ac7\u3067\u3059\u304cMac OS X\u306e\u8a08\u7b97\u6a5f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f16\u9032\u3082\u8a08\u7b97\u3067\u304d\u3066\u4fbf\u5229\u3067\u3059\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\uff082016-08-04 12.52.01\uff09.png](https://qiita-image-store.s3.amazonaws.com/0/104066/8dc91377-05c1-af6f-92d6-b1404f0a0083.png)\n\n```\n800901fc <rtl_getvgroup>:\n800901fc:       27bdffd0        addiu   sp,sp,-48\n80090200:       afb30024        sw      s3,36(sp)\n80090204:       afb20020        sw      s2,32(sp)\n80090208:       afb1001c        sw      s1,28(sp)\n8009020c:       afb00018        sw      s0,24(sp)\n80090210:       00809821        move    s3,a0\n80090214:       00a09021        move    s2,a1\n80090218:       27b10010        addiu   s1,sp,16\n8009021c:       00008021        move    s0,zero\n80090220:       08024094        j       80090250 <rtl_getvgroup+0x54>\n80090224:       afbf0028        sw      ra,40(sp)\n80090228:       8e420000        lw      v0,0(s2)\n8009022c:       26030020        addiu   v1,s0,32\n80090230:       24050003        li      a1,3\n80090234:       70452002        mul     a0,v0,a1\n80090238:       26100001        addiu   s0,s0,1\n8009023c:       00832821        addu    a1,a0,v1\n80090240:       0c024074        jal     800901d0 <rtl_readreg>\n80090244:       02602021        move    a0,s3\n80090248:       a6220000        sh      v0,0(s1)\n8009024c:       26310002        addiu   s1,s1,2\n80090250:       8e04012c        lw      a0,300(s0)\n80090254:       24030002        li      v1,2\n80090258:       24020003        li      v0,3\n```\n\nrtl_getvgroup()\u3067\u306e\u5909\u6570\u306e\u521d\u671f\u5fd8\u308c\u3067\u3057\u305f\u3002\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u3067\u78ba\u4fdd\u3057\u305f\u5909\u6570\u3092softc\u306b\u3044\u308c\u305f\u65b9\u304c\u826f\u3044\u3063\u3066\u30ec\u30d3\u30e5\u30fc\u304c\u3042\u308a\u3001\u4fee\u6b63\u3057\u305f\u3068\u3053\u308d\u95a2\u6570\u5185\u3067softc\u3092\u521d\u671f\u5316\u3059\u308b\u524d\u306b\u305d\u306e\u5024\u3092\u4f7f\u3063\u3066\u3057\u307e\u3063\u3066\u3044\u307e\u3057\u305f\u3002\u3002\u3002\n\n\u843d\u3061\u306a\u3044\u3069\u3051\u8abf\u3079\u305f\u3044\u4e8b\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089\u306e\u30d6\u30ec\u30fc\u30af\u3092\u9001\u308b\u65b9\u6cd5\u3084kdb_break(),panic()\u3092\u30ab\u30fc\u30cd\u30eb\u5185\u306b\u653e\u308a\u8fbc\u3080\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u30e6\u30fc\u30b6\u30e9\u30f3\u30c9\u304b\u3089\u843d\u3068\u3059\u5834\u5408\u306f\u4ee5\u4e0b\u3067\u3067\u304d\u307e\u3059\u3002\n\n```\nsysctl debug.kdb.enter=1\nor\nsysctl debug.kdb.panic=1\n```\n\n```\nvm_fault(0xc12868e8, 30000, 2, 0) -> 1\nFatal kernel mode data abort: 'Translation Fault (P)'\ntrapframe: 0xc289cd30\nFSR=00000017, FAR=00030000, spsr=20000013\nr0 =00030000, r1 =c1669010, r2 =000007e0, r3 =736e6f63\nr4 =09656c6f, r5 =00000800, r6 =00000000, r7 =00005bc0\nr8 =00000000, r9 =c164b7e0, r10=c164e940, r11=00000040\nr12=73752f22, ssp=c289cd84, slr=696c2f72, pc =c11d8650\n\n[ thread pid 12 tid 100007 ]\nStopped at      memcpy+0x80:    stmia   r0!, {r3-r4, r12, r14}\ndb>\n```\n\u3053\u3093\u306a\u611f\u3058\u3067\u843d\u3061\u305f\u6642\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u78ba\u8a8d\u3059\u308b\u3002\n\n```\ndb> show proc 12      \nProcess 12 (geom) at 0xc150ec80:\n state: NORMAL\n uid: 0  gids: 0\n parent: pid 0 at 0xc12862b8\n ABI: null\n threads: 3\n100008                   D       -        0xc1285e50 [g_down]\n100007                   Run     CPU 0               [g_up]\n100006                   D       -        0xc1285e44 [g_event]\ndb> show thread 100007\nThread 100007 at 0xc1511330:\n proc (pid 12): 0xc150ec80\n name: g_up\n stack: 0xc289b000-0xc289cfff\n flags: 0x4010004  pflags: 0x200000\n state: RUNNING (CPU 0)\n priority: 92\n container lock: sched lock 0 (0xc1296300)\n\n```\n\n\n\u843d\u3061\u305a\u306b\u30cf\u30f3\u30b0\u30a2\u30c3\u30d7\u3057\u3066\u3001\u30d6\u30ec\u30fc\u30af\u3082\u52b9\u304b\u306a\u3044\u306e\u304c\u4e00\u756a\u5384\u4ecb\u3067\u3059\u3002\u3002\u3002\n\n### \u53c2\u8003\u8cc7\u6599\n\n[FreeBSD Developers' Handbook Kernel Debugging](https://www.freebsd.org/doc/en_US.ISO8859-1/books/developers-handbook/kerneldebug.html)\n[Introduction to Debugging the FreeBSD Kernel](http://www.bsdcan.org/2008/schedule/attachments/45_article.pdf)\n[Debugging Kernel Problems](http://www.lemis.com/papers/Taiwan/tutorial.pdf)\n", "tags": ["FreeBSD"]}