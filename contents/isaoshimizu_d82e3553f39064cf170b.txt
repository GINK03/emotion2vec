{"context": " More than 1 year has passed since last update.Mac OS X\u304b\u3089Samba\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u3059\u308b\u969b\u3001Windows\u3088\u308a\u3082\u5727\u5012\u7684\u306b\u4e0d\u5b89\u5b9a\u3001\u4f4e\u901f\u3060\u3063\u305f\u308a\u3001\u30de\u30a6\u30f3\u30c8\u304c\u304a\u304b\u3057\u304f\u306a\u3063\u305f\u308a\u3059\u308b\u554f\u984c\u306e\u89e3\u6d88\u65b9\u6cd5\u3067\u3059\u3002\nMac OS X Yosemite 10.10.4\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u826f\u3044\u8a2d\u5b9a\u3084\u3053\u306e\u8a2d\u5b9a\u306f\u30c0\u30e1\u3068\u304b\u3042\u308c\u3070\u305c\u3072\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\nMac OS X\u5074\u306e\u8a2d\u5b9a\n\nnsmb.conf\n\u3053\u308c\u306b\u3088\u3063\u3066Mavericks\u4ee5\u964d\u306eSMB2\u5bfe\u5fdc\u3092\u3084\u3081\u3066SMB1\u5229\u7528\u3092\u5f37\u5236\u3057\u307e\u3059\u3002\u30b9\u30ea\u30fc\u30d7\u304b\u3089\u5fa9\u5e30\u3057\u305f\u3042\u3068\u306e\u63a5\u7d9a\u6027\u3084\u901f\u5ea6\u304c\u6539\u5584\u3059\u308b\u3088\u3046\u3067\u3059\u3002\necho \"[default]\" >> ~/Library/Preferences/nsmb.conf; echo \"smb_neg=smb1_only\" >> ~/Library/Preferences/nsmb.conf\n\n\u203b\u74b0\u5883\u306b\u3088\u3063\u3066\u306f/etc/nsmb.conf\u306b\u4f5c\u3089\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\nNAS\u4e0a\u306bDS_store\u3092\u4f5c\u3089\u306a\u3044\ndefaults write com.apple.desktopservices DSDontWriteNetworkStores true\n\n\nsysctl\nsudo sysctl -w net.inet.tcp.delayed_ack=0\n\n/etc/sysctl.conf\u306bnet.inet.tcp.delayed_ack=0\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u5316\u3055\u308c\u307e\u3059\u3002\n\nSamba\u5074\u306e\u8a2d\u5b9a\n\u3042\u304f\u307e\u3067\u3082\u4f8b\u3067\u3059\u304c\u3001\u79c1\u306e\u74b0\u5883\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b/etc/samba/smb.conf\u3067\u3059\u3002\n[global]\nworkgroup = WORKGROUP\nserver string = %h server (Samba, Ubuntu)\nunix charset = UTF-8\ndos charset = CP932\nsocket options = IPTOS_LOWDELAY TCP_NODELAY SO_RCVBUF=131072 SO_SNDBUF=131072\nmax connections = 20\nstrict sync = no\nsync always = no\nuse sendfile = yes\nwrite cache size = 2097152\nmin receivefile size = 16384\ngetwd cache = true\naio read size = 16384\naio write size = 16384\nea support = no\ngetwd cache = yes\nload printers = no\nprintcap name = /dev/null\nprinting = bsd\n\n\n\u5404\u7a2e\u8a2d\u5b9a\u5f8c\u3001\u5229\u7528\u3055\u308c\u3066\u3044\u308bSMB\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u78ba\u8a8d\nMac OS X\u5074\u3067Samba\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u5f8c\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n$ smbutil statshares -a\n\n==================================================================================================\nSHARE                         ATTRIBUTE TYPE                VALUE\n==================================================================================================\nshare\n                              SERVER_NAME                   nas\n                              USER_ID                       501\n                              SMB_NEGOTIATE                 SMBV_NEG_SMB1_ONLY\n                              SMB_VERSION                   SMB_1\n                              SMB_SHARE_TYPE                UNKNOWN\n                              EXTENDED_SECURITY_SUPPORTED   TRUE\n                              UNIX_SUPPORT                  TRUE\n                              LARGE_FILE_SUPPORTED          TRUE\n\n\n\u53c2\u8003\n\nhttp://blog.djmnet.org/2009/02/09/macs-needing-unix-network-geekery/\nhttp://www.zdnet.com/article/mavericks-smb2-problem-and-fixes/\nhttp://superuser.com/questions/144327/mac-os-cant-connect-to-smb-shares-after-sleep\nhttp://www.atmarkit.co.jp/ait/articles/1503/17/news032.html\n\n\nMac OS X\u304b\u3089Samba\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u3059\u308b\u969b\u3001Windows\u3088\u308a\u3082\u5727\u5012\u7684\u306b\u4e0d\u5b89\u5b9a\u3001\u4f4e\u901f\u3060\u3063\u305f\u308a\u3001\u30de\u30a6\u30f3\u30c8\u304c\u304a\u304b\u3057\u304f\u306a\u3063\u305f\u308a\u3059\u308b\u554f\u984c\u306e\u89e3\u6d88\u65b9\u6cd5\u3067\u3059\u3002\nMac OS X Yosemite 10.10.4\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\u3082\u3063\u3068\u826f\u3044\u8a2d\u5b9a\u3084\u3053\u306e\u8a2d\u5b9a\u306f\u30c0\u30e1\u3068\u304b\u3042\u308c\u3070\u305c\u3072\u6559\u3048\u3066\u4e0b\u3055\u3044\u3002\n\n## Mac OS X\u5074\u306e\u8a2d\u5b9a\n\n\n#### nsmb.conf\n\n\u3053\u308c\u306b\u3088\u3063\u3066Mavericks\u4ee5\u964d\u306eSMB2\u5bfe\u5fdc\u3092\u3084\u3081\u3066SMB1\u5229\u7528\u3092\u5f37\u5236\u3057\u307e\u3059\u3002\u30b9\u30ea\u30fc\u30d7\u304b\u3089\u5fa9\u5e30\u3057\u305f\u3042\u3068\u306e\u63a5\u7d9a\u6027\u3084\u901f\u5ea6\u304c\u6539\u5584\u3059\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\necho \"[default]\" >> ~/Library/Preferences/nsmb.conf; echo \"smb_neg=smb1_only\" >> ~/Library/Preferences/nsmb.conf\n```\n\n\u203b\u74b0\u5883\u306b\u3088\u3063\u3066\u306f`/etc/nsmb.conf`\u306b\u4f5c\u3089\u306a\u3044\u3068\u53cd\u6620\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n#### NAS\u4e0a\u306bDS_store\u3092\u4f5c\u3089\u306a\u3044\n\n```\ndefaults write com.apple.desktopservices DSDontWriteNetworkStores true\n```\n\n#### sysctl\n\n```\nsudo sysctl -w net.inet.tcp.delayed_ack=0\n```\n\n`/etc/sysctl.conf`\u306b`net.inet.tcp.delayed_ack=0`\u3092\u66f8\u3044\u3066\u304a\u304f\u3068\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u5316\u3055\u308c\u307e\u3059\u3002\n\n## Samba\u5074\u306e\u8a2d\u5b9a\n\n\u3042\u304f\u307e\u3067\u3082\u4f8b\u3067\u3059\u304c\u3001\u79c1\u306e\u74b0\u5883\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b`/etc/samba/smb.conf`\u3067\u3059\u3002\n\n```\n[global]\nworkgroup = WORKGROUP\nserver string = %h server (Samba, Ubuntu)\nunix charset = UTF-8\ndos charset = CP932\nsocket options = IPTOS_LOWDELAY TCP_NODELAY SO_RCVBUF=131072 SO_SNDBUF=131072\nmax connections = 20\nstrict sync = no\nsync always = no\nuse sendfile = yes\nwrite cache size = 2097152\nmin receivefile size = 16384\ngetwd cache = true\naio read size = 16384\naio write size = 16384\nea support = no\ngetwd cache = yes\nload printers = no\nprintcap name = /dev/null\nprinting = bsd\n```\n\n## \u5404\u7a2e\u8a2d\u5b9a\u5f8c\u3001\u5229\u7528\u3055\u308c\u3066\u3044\u308bSMB\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u78ba\u8a8d\n\nMac OS X\u5074\u3067Samba\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u5f8c\u306b\u5b9f\u884c\u3057\u3066\u307f\u308b\u3002\n\n```\n$ smbutil statshares -a\n\n==================================================================================================\nSHARE                         ATTRIBUTE TYPE                VALUE\n==================================================================================================\nshare\n                              SERVER_NAME                   nas\n                              USER_ID                       501\n                              SMB_NEGOTIATE                 SMBV_NEG_SMB1_ONLY\n                              SMB_VERSION                   SMB_1\n                              SMB_SHARE_TYPE                UNKNOWN\n                              EXTENDED_SECURITY_SUPPORTED   TRUE\n                              UNIX_SUPPORT                  TRUE\n                              LARGE_FILE_SUPPORTED          TRUE\n```\n\n## \u53c2\u8003\n\n- http://blog.djmnet.org/2009/02/09/macs-needing-unix-network-geekery/\n- http://www.zdnet.com/article/mavericks-smb2-problem-and-fixes/\n- http://superuser.com/questions/144327/mac-os-cant-connect-to-smb-shares-after-sleep\n- http://www.atmarkit.co.jp/ait/articles/1503/17/news032.html\n", "tags": ["MacOSX", "samba"]}