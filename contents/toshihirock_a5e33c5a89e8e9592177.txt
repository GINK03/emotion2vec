{"context": " More than 1 year has passed since last update.logrotate\u306f\u3068\u3066\u3082\u4fbf\u5229\u3067\u3059\u304c\u3001\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u5468\u671f\u306b\u4eca\u307e\u3067\u4e00\u756a\u5c0f\u3055\u3044\u5358\u4f4d\u3067\u3082daily\uff08\u65e5\u6bce\uff09\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u305d\u306e\u305f\u3081\u3001\u6642\u9593\u3054\u3068\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u884c\u3046\u969b\u306b\u306fpostrotate\u306a\u3069\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3057\u305f\u308a\u3001cron\u306a\u3069\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u3002\u3002\n/var/log/nginx/*log {\n    create 0644 nginx nginx\n    daily\n    rotate 10\n    missingok\n    notifempty\n    #compress\n    size 1\n    nodateext\n    sharedscripts\n    postrotate\n        EXT=`date +%Y%m%d%H%M`\n        for f in $1\n        do\n          ls $f.1 >/dev/null 2>&1\n          if [ $? -eq 0 ] ; then\n            mv $f.1 $f.$EXT\n            gzip $f.$EXT\n          fi\n        done\n        /etc/init.d/nginx reopen_logs\n    endscript\n}\n\n\u305f\u3060\u3057\u3001\u4e0b\u8a18\u81ea\u5206\u306eblog\u306b\u3082\u66f8\u3044\u305f\u306e\u3067\u3059\u304c\u3001logrotate3.8.5\u4ee5\u964d\u306fhourly\uff08\u6642\u9593\u3054\u3068\uff09\u30ed\u30fc\u30c6\u30fc\u30c8\u306b\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306a\u4e8b\u3092\u3057\u306a\u304f\u3066\u3082\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\uff01\nlogrotate\u3067nginx\u306e\u30ed\u30b0\u30921\u6642\u9593\u3054\u3068\u306b\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u3059\u308b\n\u4e00\u5ea6\u6700\u65b0\u306elogorotate\u3092\u4f7f\u3063\u3066nginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092hourly\u30ed\u30fc\u30c6\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n\u7d50\u8ad6\n\n\u6700\u65b0\u306elogrotate\u3092\u4f7f\u3048\u3070anacron\u306e\u8a2d\u5b9a\u3068logrotate\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u8a2d\u5b9a\u3092hourly\u3068\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3067\u304d\u308b\n\n\n\u6700\u65b0\u306elogrotate\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u81ea\u5206\u306e\u8a66\u3057\u305fAmazonLinux(2015.10.09)\u3067\u306flogrotate3.7.8\u3068\u306a\u3063\u3066\u304a\u308a\u3001hourly\u306e\u5bfe\u5fdc\u304c\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3002\u3002\n\u306a\u306e\u3067\u3001rpmbuild\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001rpm\u3092\u4f5c\u6210\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nrpmbuild\u3092\u4f7f\u3046\u969b\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$sudo yum groupinstall \"Development Tools\"\n\nlogrotate\u3067\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$sudo yum install popt-devel libselinux-devel\n\n\u3044\u307e\u3055\u3089\u805e\u3051\u306a\u3044rpmbuild\u3053\u3068\u306f\u3058\u3081\n\u4e0a\u8a18\u3092\u53c2\u8003\u306brpmbuild\u3092\u884c\u3046\u305f\u3081\u306e\u6e96\u5099\u3092\u884c\u3044\u307e\u3059\u3002HOME\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7fa4\u306e\u4f5c\u6210\u3068~/.spmmacros\u3092\u4f5c\u6210\u3057\u3066\u3001rpmbuild\u5b9f\u884c\u6642\u306bHOME\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f7f\u3046\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u624b\u52d5\u3067\u3084\u3063\u3066\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u3001rpmdev-setuptree\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u3070\u3088\u3044\u3089\u3057\u3044\u306e\u3067\u3053\u308c\u3067\u3084\u308a\u307e\u3059\u3002\n\u304a\u307e\u3048\u3089 rpmdev-setuptree \u3092\u4f7f\u3048\u3068\u3044\u3046\u8a71\n$sudo yum install rpmdevtools\n$rpmdev-setuptree\n\n\u3061\u306a\u307f\u306b\u624b\u52d5\u3067\u3084\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002(rpmdev-setuptree\u3092\u5b9f\u884c\u3057\u3066\u3044\u308c\u3070\u3084\u308b\u5fc5\u8981\u306a\u3057\uff09\n$mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}  \n$echo '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros  \n\n\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067logrotate\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\u3057\u3001spec\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u914d\u7f6e\u3092\u884c\u3046\u3002\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u53d6\u5f97\n$wget https://fedorahosted.org/releases/l/o/logrotate/logrotate-3.9.1.tar.gz\n\n# tar\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092SOURCES\u914d\u4e0b\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u308b\n$cp logrotate-3.9.1.tar.gz rpmbuild/SOURCES/\n\n# \u89e3\u51cd\n$tar -zxvf logrotate-3.9.1.tar.gz\n\n# \u30d3\u30eb\u30c9\u624b\u9806\u304c\u66f8\u304b\u308c\u305f\u3001spec\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n$ cp logrotate-3.9.1/logrotate.spec rpmbuild/SPECS\n\n# spec\u30d5\u30a1\u30a4\u30eb\u306b\u5f93\u3044\u3001rpm\u3092\u4f5c\u6210\n$rpmbuild -bb rpmbuild/SPECS/logrotate.spec\n\n\u30d3\u30eb\u30c9\u304c\u6210\u529f\u3059\u308c\u3070~/rpmbuild/RPMS/x86_64\u30d5\u30a9\u30eb\u30c0\u914d\u4e0b\u306b\u4ee5\u4e0b\u306e2\u3064\u306erpm\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002(x86_64\u306f\u5b9f\u884c\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u308f\u308b\uff09\n\nlogrotate-3.9.1-1.x86_64.rpm\nlogrotate-debuginfo-3.9.1-1.x86_64.rpm\n\n\u751f\u6210\u3055\u308c\u305frpm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$cd rpmbuild/RPMS/x86_64/\n$sudo rpm -Uvh logrotate-3.9.1-1.x86_64.rpm\n$logrotate\nlogrotate 3.9.1 - Copyright (C) 1995-2001 Red Hat, Inc.\nThis may be freely redistributed under the terms of the GNU Public License\n\nUsage: logrotate [-dfv?] [-d|--debug] [-f|--force] [-m|--mail command] [-s|--state statefile] [-v|--verbose] [-l|--log STRING] [--version] [-?|--help] [--usage] [OPTION...] <configfile>\n\n\u7121\u4e8b\u6700\u65b0\u306elogrotate\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3057\u305f\u3002\n\nnginx\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3092hourly\u306b\u3057\u3066\u307f\u308b\n\u65e9\u901f\u3001nginx\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304chourly\u306b\u306a\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\n\u3068\u3001\u305d\u306e\u524d\u306banacron\u3067\u5b9f\u884c\u3055\u308c\u308blogrotate\u30b3\u30de\u30f3\u30c9\u3092daily\u3067\u306a\u304f\u3001houlry\u3067\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u305d\u3082\u305d\u3082logrotate\u306f\u3069\u3046\u3084\u3063\u3066\u52d5\u3044\u3066\u3044\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f/etc/cron.daily/\u30d5\u30a9\u30eb\u30c0\u914d\u4e0b\u306blogrotate\u306e\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u4e8b\u30671\u65e5\u30671\u56de\u306e\u307f\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305b\u3063\u304b\u304f\u8a2d\u5b9a\u3067hourly\u3068\u3057\u3066\u3082\u5b9f\u884c\u304c1\u65e51\u56de\u3067\u306f\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u306e\u3067cron.hourly\u914d\u4e0b\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u30671\u6642\u9593\u6bce\u306blogrotate\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n$sudo mv /etc/cron.daily/logrotate /etc/cron.hourly/\n\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u304c\u3044\u3064\u30ed\u30fc\u30c6\u30fc\u30c8\u3055\u308c\u305f\u304b\u306b\u3064\u3044\u3066\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3042\u308c\u3070/var/lib/logrotate.status\u306b\u8a18\u61b6\u3057\u3066\u304a\u308a\u3001daily\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u8a2d\u5b9a\u30671\u6642\u9593\u6bce\u306blogrotate\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u3066\u3082\u3001\u4e0d\u5fc5\u8981\u306b\u30ed\u30fc\u30c6\u30fc\u30c8\u3059\u308b\u4e8b\u306f\u306a\u3044\u305f\u3081\u3001\u65e2\u5b58\u306e\u3082\u306e\u306b\u3082\u5f71\u97ff\u3057\u307e\u305b\u3093\u3002\n\u6b21\u306b\u5bfe\u8c61\u306enginx\u306elogrotate\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u5909\u66f4\u70b9\u306f\u4ee5\u4e0b\u3067\u3059\u3002rotate\u306f\u4efb\u610f\u306e\u8a2d\u5b9a\u3067\u3002\n\ndaily\u3092hourly\u306b\u5909\u66f4(\u6642\u9593\u30ed\u30fc\u30c6\u30fc\u30c8)\nrotate\u3092240\u306b\u5909\u66f4\uff0824*10=240\u306710\u65e5\u5206)\n\n\n/etc/logrotate.d/nginx\n/var/log/nginx/*log {\n    create 0644 nginx nginx\n    hourly\n    rotate 240\n    missingok\n    notifempty\n    compress\n    sharedscripts\n    postrotate\n        /etc/init.d/nginx reopen_logs\n    endscript\n}\n\n\n\n\u9069\u5f53\u306bWeb\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u5f8c\u30011\u6642\u9593\u7a0b\u5ea6\u7d4c\u904e\u5f8c\u3001\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$sudo ls /var/log/nginx/\naccess.log  access.log-2015102003.gz  error.log  error.log-2015102003.gz\n\n\u304a\u304a\u30fc\u3001\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3067\u304d\u3066\u308b\u30fc\uff01man\u3092\u898b\u308b\u611f\u3058hourly\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f-%Y%m%d%H\u3068\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u3001dateformat\u3092\u4f7f\u3048\u3070\u5909\u66f4\u3067\u304d\u305d\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\u8a66\u3057\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u3066-\u3092_\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n/etc/logrotate.d/nginx\ndateformat _%Y%m%d%H\n\n\n\u7121\u4e8b\u3067\u304d\u3066\u307e\u3059\uff01\n$sudo ls /var/log/nginx/\naccess.log  access.log-2015102003.gz  access.log_2015102004.gz  access.log_2015102005.gz  error.log  error.log-2015102003.gz\n\n\n[\u304a\u307e\u3051]logrotate\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u308b\nrpm\u4f5c\u6210\u3067\u306a\u304f\u3001\u30d3\u30eb\u30c9\u306f\u4ee5\u4e0b\u3067\u53ef\u80fd\u3067\u3059\u3002\n$git cloen https://github.com/logrotate/logrotate.git\n$cd logrotate\n$./autogen.sh\n$./configure\n$make\n$sudo make install\n\nlogrotate\u306f\u3068\u3066\u3082\u4fbf\u5229\u3067\u3059\u304c\u3001\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u5468\u671f\u306b\u4eca\u307e\u3067\u4e00\u756a\u5c0f\u3055\u3044\u5358\u4f4d\u3067\u3082daily\uff08\u65e5\u6bce\uff09\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u305d\u306e\u305f\u3081\u3001\u6642\u9593\u3054\u3068\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u884c\u3046\u969b\u306b\u306fpostrotate\u306a\u3069\u3067\u3054\u306b\u3087\u3054\u306b\u3087\u3057\u305f\u308a\u3001cron\u306a\u3069\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u3002\u3002\n\n```\n/var/log/nginx/*log {\n    create 0644 nginx nginx\n    daily\n    rotate 10\n    missingok\n    notifempty\n    #compress\n    size 1\n    nodateext\n    sharedscripts\n    postrotate\n        EXT=`date +%Y%m%d%H%M`\n        for f in $1\n        do\n          ls $f.1 >/dev/null 2>&1\n          if [ $? -eq 0 ] ; then\n            mv $f.1 $f.$EXT\n            gzip $f.$EXT\n          fi\n        done\n        /etc/init.d/nginx reopen_logs\n    endscript\n}\n```\n\n\u305f\u3060\u3057\u3001\u4e0b\u8a18\u81ea\u5206\u306eblog\u306b\u3082\u66f8\u3044\u305f\u306e\u3067\u3059\u304c\u3001logrotate3.8.5\u4ee5\u964d\u306fhourly\uff08\u6642\u9593\u3054\u3068\uff09\u30ed\u30fc\u30c6\u30fc\u30c8\u306b\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306a\u4e8b\u3092\u3057\u306a\u304f\u3066\u3082\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\uff01\n\n[logrotate\u3067nginx\u306e\u30ed\u30b0\u30921\u6642\u9593\u3054\u3068\u306b\u30ed\u30fc\u30c6\u30fc\u30c8\u3092\u3059\u308b](http://toshihirock.blogspot.jp/2015/01/logrotatenginx.html)\n\n\n\u4e00\u5ea6\u6700\u65b0\u306elogorotate\u3092\u4f7f\u3063\u3066nginx\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092hourly\u30ed\u30fc\u30c6\u30fc\u30c8\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n# \u7d50\u8ad6\n\n+ \u6700\u65b0\u306elogrotate\u3092\u4f7f\u3048\u3070anacron\u306e\u8a2d\u5b9a\u3068logrotate\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u8a2d\u5b9a\u3092hourly\u3068\u5909\u66f4\u3059\u308b\u3060\u3051\u3067\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3067\u304d\u308b\n\n\n# \u6700\u65b0\u306elogrotate\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n\u81ea\u5206\u306e\u8a66\u3057\u305fAmazonLinux(2015.10.09)\u3067\u306flogrotate3.7.8\u3068\u306a\u3063\u3066\u304a\u308a\u3001hourly\u306e\u5bfe\u5fdc\u304c\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u3002\u3002\n\n\u306a\u306e\u3067\u3001rpmbuild\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001rpm\u3092\u4f5c\u6210\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nrpmbuild\u3092\u4f7f\u3046\u969b\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$sudo yum groupinstall \"Development Tools\"\n```\n\nlogrotate\u3067\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$sudo yum install popt-devel libselinux-devel\n``` \n\n[\u3044\u307e\u3055\u3089\u805e\u3051\u306a\u3044rpmbuild\u3053\u3068\u306f\u3058\u3081](http://blog.tnmt.info/2011/04/29/rpmbuild-for-beginner/)\n\n\u4e0a\u8a18\u3092\u53c2\u8003\u306brpmbuild\u3092\u884c\u3046\u305f\u3081\u306e\u6e96\u5099\u3092\u884c\u3044\u307e\u3059\u3002HOME\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306b\u5fc5\u8981\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u7fa4\u306e\u4f5c\u6210\u3068`~/.spmmacros`\u3092\u4f5c\u6210\u3057\u3066\u3001rpmbuild\u5b9f\u884c\u6642\u306bHOME\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u914d\u4e0b\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f7f\u3046\u3088\u3046\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u624b\u52d5\u3067\u3084\u3063\u3066\u3082\u826f\u3044\u306e\u3067\u3059\u304c\u3001`rpmdev-setuptree`\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3048\u3070\u3088\u3044\u3089\u3057\u3044\u306e\u3067\u3053\u308c\u3067\u3084\u308a\u307e\u3059\u3002\n\n[\u304a\u307e\u3048\u3089 rpmdev-setuptree \u3092\u4f7f\u3048\u3068\u3044\u3046\u8a71](http://blog.gachapin-sensei.com/blog-entry-1282.html)\n\n```bash\n$sudo yum install rpmdevtools\n$rpmdev-setuptree\n```\n\n\u3061\u306a\u307f\u306b\u624b\u52d5\u3067\u3084\u308b\u5834\u5408\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002(rpmdev-setuptree\u3092\u5b9f\u884c\u3057\u3066\u3044\u308c\u3070\u3084\u308b\u5fc5\u8981\u306a\u3057\uff09\n\n```bash\n$mkdir -p ~/rpmbuild/{BUILD,RPMS,SOURCES,SPECS,SRPMS}  \n$echo '%_topdir %(echo $HOME)/rpmbuild' > ~/.rpmmacros  \n```\n\n\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067logrotate\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\u3057\u3001spec\u30d5\u30a1\u30a4\u30eb\u306e\u914d\u7f6e\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u914d\u7f6e\u3092\u884c\u3046\u3002\n\n```bash\n# \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u53d6\u5f97\n$wget https://fedorahosted.org/releases/l/o/logrotate/logrotate-3.9.1.tar.gz\n\n# tar\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092SOURCES\u914d\u4e0b\u306b\u914d\u7f6e\u3059\u308b\u5fc5\u8981\u304c\u308b\n$cp logrotate-3.9.1.tar.gz rpmbuild/SOURCES/\n\n# \u89e3\u51cd\n$tar -zxvf logrotate-3.9.1.tar.gz\n\n# \u30d3\u30eb\u30c9\u624b\u9806\u304c\u66f8\u304b\u308c\u305f\u3001spec\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\n$ cp logrotate-3.9.1/logrotate.spec rpmbuild/SPECS\n\n# spec\u30d5\u30a1\u30a4\u30eb\u306b\u5f93\u3044\u3001rpm\u3092\u4f5c\u6210\n$rpmbuild -bb rpmbuild/SPECS/logrotate.spec\n```\n\n\u30d3\u30eb\u30c9\u304c\u6210\u529f\u3059\u308c\u3070`~/rpmbuild/RPMS/x86_64`\u30d5\u30a9\u30eb\u30c0\u914d\u4e0b\u306b\u4ee5\u4e0b\u306e2\u3064\u306erpm\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002(x86_64\u306f\u5b9f\u884c\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u308f\u308b\uff09\n\n+ logrotate-3.9.1-1.x86_64.rpm\n+ logrotate-debuginfo-3.9.1-1.x86_64.rpm\n\n\n\u751f\u6210\u3055\u308c\u305frpm\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\n$cd rpmbuild/RPMS/x86_64/\n$sudo rpm -Uvh logrotate-3.9.1-1.x86_64.rpm\n$logrotate\nlogrotate 3.9.1 - Copyright (C) 1995-2001 Red Hat, Inc.\nThis may be freely redistributed under the terms of the GNU Public License\n\nUsage: logrotate [-dfv?] [-d|--debug] [-f|--force] [-m|--mail command] [-s|--state statefile] [-v|--verbose] [-l|--log STRING] [--version] [-?|--help] [--usage] [OPTION...] <configfile>\n```\n\n\u7121\u4e8b\u6700\u65b0\u306elogrotate\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3057\u305f\u3002\n\n\n# nginx\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3092hourly\u306b\u3057\u3066\u307f\u308b\n\n\u65e9\u901f\u3001nginx\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u304chourly\u306b\u306a\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3068\u3001\u305d\u306e\u524d\u306banacron\u3067\u5b9f\u884c\u3055\u308c\u308blogrotate\u30b3\u30de\u30f3\u30c9\u3092daily\u3067\u306a\u304f\u3001houlry\u3067\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u305d\u3082\u305d\u3082logrotate\u306f\u3069\u3046\u3084\u3063\u3066\u52d5\u3044\u3066\u3044\u308b\u306e\u304b\u3068\u3044\u3046\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f/etc/cron.daily/\u30d5\u30a9\u30eb\u30c0\u914d\u4e0b\u306blogrotate\u306e\u5b9f\u884c\u30b3\u30de\u30f3\u30c9\u304c\u8a18\u8f09\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u7f6e\u3059\u308b\u4e8b\u30671\u65e5\u30671\u56de\u306e\u307f\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305b\u3063\u304b\u304f\u8a2d\u5b9a\u3067hourly\u3068\u3057\u3066\u3082\u5b9f\u884c\u304c1\u65e51\u56de\u3067\u306f\u30ed\u30fc\u30c6\u30fc\u30c8\u304c\u3046\u307e\u304f\u3044\u304b\u306a\u3044\u306e\u3067cron.hourly\u914d\u4e0b\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u30671\u6642\u9593\u6bce\u306blogrotate\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```\n$sudo mv /etc/cron.daily/logrotate /etc/cron.hourly/\n```\n\n\u5bfe\u8c61\u30d5\u30a1\u30a4\u30eb\u304c\u3044\u3064\u30ed\u30fc\u30c6\u30fc\u30c8\u3055\u308c\u305f\u304b\u306b\u3064\u3044\u3066\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3042\u308c\u3070`/var/lib/logrotate.status`\u306b\u8a18\u61b6\u3057\u3066\u304a\u308a\u3001daily\u30ed\u30fc\u30c6\u30fc\u30c8\u306e\u8a2d\u5b9a\u30671\u6642\u9593\u6bce\u306blogrotate\u30b3\u30de\u30f3\u30c9\u304c\u5b9f\u884c\u3055\u308c\u3066\u3082\u3001\u4e0d\u5fc5\u8981\u306b\u30ed\u30fc\u30c6\u30fc\u30c8\u3059\u308b\u4e8b\u306f\u306a\u3044\u305f\u3081\u3001\u65e2\u5b58\u306e\u3082\u306e\u306b\u3082\u5f71\u97ff\u3057\u307e\u305b\u3093\u3002\n\n\u6b21\u306b\u5bfe\u8c61\u306enginx\u306elogrotate\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u5909\u66f4\u70b9\u306f\u4ee5\u4e0b\u3067\u3059\u3002rotate\u306f\u4efb\u610f\u306e\u8a2d\u5b9a\u3067\u3002\n\n+ daily\u3092hourly\u306b\u5909\u66f4(\u6642\u9593\u30ed\u30fc\u30c6\u30fc\u30c8)\n+ rotate\u3092240\u306b\u5909\u66f4\uff0824*10=240\u306710\u65e5\u5206)\n\n```/etc/logrotate.d/nginx\n/var/log/nginx/*log {\n    create 0644 nginx nginx\n    hourly\n    rotate 240\n    missingok\n    notifempty\n    compress\n    sharedscripts\n    postrotate\n        /etc/init.d/nginx reopen_logs\n    endscript\n}\n\n```\n\n\u9069\u5f53\u306bWeb\u30b5\u30fc\u30d0\u30fc\u306b\u30a2\u30af\u30bb\u30b9\u5f8c\u30011\u6642\u9593\u7a0b\u5ea6\u7d4c\u904e\u5f8c\u3001\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$sudo ls /var/log/nginx/\naccess.log  access.log-2015102003.gz  error.log  error.log-2015102003.gz\n```\n\n\u304a\u304a\u30fc\u3001\u6642\u9593\u6bce\u306e\u30ed\u30fc\u30c6\u30fc\u30c8\u3067\u304d\u3066\u308b\u30fc\uff01man\u3092\u898b\u308b\u611f\u3058hourly\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306f-%Y%m%d%H\u3068\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5909\u3048\u305f\u3044\u5834\u5408\u3001dateformat\u3092\u4f7f\u3048\u3070\u5909\u66f4\u3067\u304d\u305d\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n\u8a66\u3057\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u3066`-`\u3092`_`\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```/etc/logrotate.d/nginx\ndateformat _%Y%m%d%H\n```\n\n\u7121\u4e8b\u3067\u304d\u3066\u307e\u3059\uff01\n\n```bash\n$sudo ls /var/log/nginx/\naccess.log  access.log-2015102003.gz  access.log_2015102004.gz  access.log_2015102005.gz  error.log  error.log-2015102003.gz\n```\n\n\n# [\u304a\u307e\u3051]logrotate\u3092\u30d3\u30eb\u30c9\u3057\u3066\u307f\u308b\n\nrpm\u4f5c\u6210\u3067\u306a\u304f\u3001\u30d3\u30eb\u30c9\u306f\u4ee5\u4e0b\u3067\u53ef\u80fd\u3067\u3059\u3002\n\n```\n$git cloen https://github.com/logrotate/logrotate.git\n$cd logrotate\n$./autogen.sh\n$./configure\n$make\n$sudo make install\n```\n", "tags": ["Linux", "logrotate", "nginx", "rpmbuild"]}