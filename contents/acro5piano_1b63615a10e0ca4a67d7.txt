{"context": "\n\n\u6982\u8981\nSinatra\u3067\u4f5c\u3063\u305fWEB\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092Thin + Nginx\u3067\u904b\u7528\u3059\u308b\u3002\n\u672c\u5f53\u306fUnicorn\u306e\u65b9\u304c\u65e9\u3044\u3089\u3057\u3044\u304c\u3001Sinatra\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067Thin\u304c\u7d39\u4ecb\u3055\u308c\u3066\u304a\u308a\u3001\u624b\u8efd\u3055\u3092\u91cd\u8996\u3057Thin\u3067\u69cb\u7bc9\u3057\u305f\u3002\n\u307e\u305f\u3001Thin\u5358\u4f53\u3067\u52d5\u304b\u3059\u3068\u306a\u305c\u304bSSL\u901a\u4fe1\u6642\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u7dad\u6301\u3055\u308c\u306a\u3044\u3068\u3044\u3046\u73fe\u8c61\u306b\u76f4\u9762\u3057\u305f\u306e\u3067\u3001Nginx\u3092\u30d5\u30ed\u30f3\u30c8\u3001Thin\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u52d5\u304b\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n\n\u74b0\u5883\n\nUbuntu 14.04.2 LTS \nRuby 2.0.0-p645\nNginx 1.4.6\nSinatra 1.4.6\nThin 1.6.4\n\n\n\u8a2d\u5b9a\n\u6700\u5c0f\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u3002\n.\n|-- Gemfile\n|-- app.rb\n|-- config.ru\n\n\nSinatra\u306e\u8a2d\u5b9a\nconfig.ru\u3092\u8a18\u8ff0\u3057\u3001Sinatra\u3092\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\nconfig.ru\nrequire './app'\nrun Application\n\n\n\napp.rb\nrequire 'bundler/setup'\nrequire 'sinatra/base'\n\nclass Application < Sinatra::Base\n  get '/' do\n    'hello,world!'\n  end\nend\n\n\n\nThin\u306e\u8a2d\u5b9a\nGemfile\u306bThin\u3092\u66f8\u3044\u3066\u304a\u304f\u3002\n\nGemfile\ngem 'sinatra' , '1.4.6'\ngroup :production do\n  gem 'thin'\nend\n\n\nbundle install\u306e\u5f8c\u306b\u3001Thin\u3092\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nroot\u3067\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u74b0\u5883\u5909\u6570PATH\u3092\u5f15\u304d\u7d99\u3050\u8a2d\u5b9a\u306b\u3059\u308b\u304b\u3001bundle\u3092\u76f4\u63a5\u53e9\u304f\u3002\n$ which bundle\n/home/kazuya/.rbenv/shims/bundle\n$ sudo /home/kazuya/.rbenv/shims/bundle exec thin install\nInstalling thin service at /etc/init.d/thin ...\nmkdir -p /etc/init.d\nwriting /etc/init.d/thin\nchmod +x /etc/init.d/thin\nmkdir -p /etc/thin\n\nTo configure thin to start at system boot:\non RedHat like systems:\n  sudo /sbin/chkconfig --level 345 thin on\non Debian-like systems (Ubuntu):\n  sudo /usr/sbin/update-rc.d -f thin defaults\non Gentoo:\n  sudo rc-update add thin default\n$ sudo /usr/sbin/update-rc.d -f thin defaults\n\n\u3053\u308c\u3067Thin\u304c\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u6b21\u306bThin\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n/etc/thin/hoge.yml\n---\nchdir: /path/to/your/application\nenvironment: production\ntimeout: 30\nlog: log/thin.log\npid: tmp/pids/thin.pid\nmax_conns: 1024\nmax_persistent_conns: 100 \nrequire: []\nwait: 30\nthreadpool_size: 20\nsocket: /tmp/hoge.1.sock\ndaemonize: true\n\n\n\u3053\u308c\u3067Thin\u8d77\u52d5\u6642\u306b\u4e0a\u8a18\u306e\u8a2d\u5b9a\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\n\nNginx\u306e\u8a2d\u5b9a\nThin\u3068\u306f/tmp/hoge.1.sock\u3092\u901a\u3058\u3066\u3084\u308a\u3068\u308a\u3059\u308b\u3002\nSSL\u5468\u308a\u306e\u8a73\u7d30\u306a\u8a2d\u5b9a\u306f\u3001\u307e\u305f\u5225\u306e\u6a5f\u4f1a\u306b\u3002\n\n/etc/nginx/sites-available/hoge-service.com\nupstream backend {\n    server unix:/tmp/hoge.1.sock;\n    ip_hash;\n}\n\nserver {\n    listen       80;\n    listen       443;\n    server_name hoge-service.com;\n\n    ssl on;\n    ssl_certificate /etc/nginx/ssl-files/server.crt;\n    ssl_certificate_key /etc/nginx/ssl-files/server.key;\n\n    location / {\n        proxy_pass http://backend;\n    }\n}\n\n\n\u4ee5\u4e0a\u3067\u5b8c\u4e86\u3002\n\u3061\u3083\u3093\u3068\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u904b\u7528\u3059\u308b\u306b\u306f\u3001\u8ca0\u8377\u3092\u8003\u3048Thin\u306e\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u7b49\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3059\u3079\u304d\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n#\u6982\u8981\nSinatra\u3067\u4f5c\u3063\u305fWEB\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092Thin + Nginx\u3067\u904b\u7528\u3059\u308b\u3002\n\u672c\u5f53\u306fUnicorn\u306e\u65b9\u304c\u65e9\u3044\u3089\u3057\u3044\u304c\u3001Sinatra\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3067Thin\u304c\u7d39\u4ecb\u3055\u308c\u3066\u304a\u308a\u3001\u624b\u8efd\u3055\u3092\u91cd\u8996\u3057Thin\u3067\u69cb\u7bc9\u3057\u305f\u3002\n\u307e\u305f\u3001Thin\u5358\u4f53\u3067\u52d5\u304b\u3059\u3068\u306a\u305c\u304bSSL\u901a\u4fe1\u6642\u306b\u30bb\u30c3\u30b7\u30e7\u30f3\u304c\u7dad\u6301\u3055\u308c\u306a\u3044\u3068\u3044\u3046\u73fe\u8c61\u306b\u76f4\u9762\u3057\u305f\u306e\u3067\u3001Nginx\u3092\u30d5\u30ed\u30f3\u30c8\u3001Thin\u3092\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u30b5\u30fc\u30d0\u30fc\u3068\u3057\u3066\u52d5\u304b\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n\n#\u74b0\u5883\n+ Ubuntu 14.04.2 LTS \n+ Ruby 2.0.0-p645\n+ Nginx 1.4.6\n+ Sinatra 1.4.6\n+ Thin 1.6.4\n\n#\u8a2d\u5b9a\n\n\u6700\u5c0f\u306e\u30d5\u30a1\u30a4\u30eb\u69cb\u9020\u3002\n\n```bash\n.\n|-- Gemfile\n|-- app.rb\n|-- config.ru\n```\n\n# Sinatra\u306e\u8a2d\u5b9a\n`config.ru`\u3092\u8a18\u8ff0\u3057\u3001Sinatra\u3092\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u8d77\u52d5\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n```rb:config.ru\nrequire './app'\nrun Application\n```\n\n```rb:app.rb\nrequire 'bundler/setup'\nrequire 'sinatra/base'\n\nclass Application < Sinatra::Base\n  get '/' do\n    'hello,world!'\n  end\nend\n```\n\n## Thin\u306e\u8a2d\u5b9a\nGemfile\u306bThin\u3092\u66f8\u3044\u3066\u304a\u304f\u3002\n\n```rb:Gemfile\ngem 'sinatra' , '1.4.6'\ngroup :production do\n  gem 'thin'\nend\n```\n`bundle install`\u306e\u5f8c\u306b\u3001Thin\u3092\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u8a2d\u5b9a\u3092\u884c\u3046\u3002\nroot\u3067\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u74b0\u5883\u5909\u6570PATH\u3092\u5f15\u304d\u7d99\u3050\u8a2d\u5b9a\u306b\u3059\u308b\u304b\u3001bundle\u3092\u76f4\u63a5\u53e9\u304f\u3002\n\n```bash\n$ which bundle\n/home/kazuya/.rbenv/shims/bundle\n$ sudo /home/kazuya/.rbenv/shims/bundle exec thin install\nInstalling thin service at /etc/init.d/thin ...\nmkdir -p /etc/init.d\nwriting /etc/init.d/thin\nchmod +x /etc/init.d/thin\nmkdir -p /etc/thin\n\nTo configure thin to start at system boot:\non RedHat like systems:\n  sudo /sbin/chkconfig --level 345 thin on\non Debian-like systems (Ubuntu):\n  sudo /usr/sbin/update-rc.d -f thin defaults\non Gentoo:\n  sudo rc-update add thin default\n$ sudo /usr/sbin/update-rc.d -f thin defaults\n```\n\u3053\u308c\u3067Thin\u304c\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u81ea\u52d5\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u6b21\u306bThin\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```yaml:/etc/thin/hoge.yml\n---\nchdir: /path/to/your/application\nenvironment: production\ntimeout: 30\nlog: log/thin.log\npid: tmp/pids/thin.pid\nmax_conns: 1024\nmax_persistent_conns: 100 \nrequire: []\nwait: 30\nthreadpool_size: 20\nsocket: /tmp/hoge.1.sock\ndaemonize: true\n```\n\u3053\u308c\u3067Thin\u8d77\u52d5\u6642\u306b\u4e0a\u8a18\u306e\u8a2d\u5b9a\u304c\u8aad\u307f\u8fbc\u307e\u308c\u308b\u3002\n\n# Nginx\u306e\u8a2d\u5b9a\nThin\u3068\u306f/tmp/hoge.1.sock\u3092\u901a\u3058\u3066\u3084\u308a\u3068\u308a\u3059\u308b\u3002\nSSL\u5468\u308a\u306e\u8a73\u7d30\u306a\u8a2d\u5b9a\u306f\u3001\u307e\u305f\u5225\u306e\u6a5f\u4f1a\u306b\u3002\n\n```nginx:/etc/nginx/sites-available/hoge-service.com\nupstream backend {\n    server unix:/tmp/hoge.1.sock;\n    ip_hash;\n}\n\nserver {\n    listen       80;\n    listen       443;\n    server_name hoge-service.com;\n\n    ssl on;\n    ssl_certificate /etc/nginx/ssl-files/server.crt;\n    ssl_certificate_key /etc/nginx/ssl-files/server.key;\n\n    location / {\n        proxy_pass http://backend;\n    }\n}\n```\n\n\n\n\u4ee5\u4e0a\u3067\u5b8c\u4e86\u3002\n\u3061\u3083\u3093\u3068\u3057\u305f\u30b5\u30fc\u30d3\u30b9\u3068\u3057\u3066\u904b\u7528\u3059\u308b\u306b\u306f\u3001\u8ca0\u8377\u3092\u8003\u3048Thin\u306e\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u7b49\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3059\u3079\u304d\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n", "tags": ["Sinatra", "thin", "nginx", "Ruby", "Ubuntu"]}