{"tags": ["java8", "spring-boot", "Thymeleaf"], "context": "\n\n\u6982\u8981\nEnum\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u3082\u3063\u305fJavaBean\u3092RequestBody\u3068\u3057\u3066\u9001\u308a\nController\u3067\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3055\u308c\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\n\u74b0\u5883\n\u203b Thymeleaf\u304c\u5c11\u3057\u53e4\u3044\u3067\u3059\n\n\n\nModule\nVersion\n\n\n\n\nspring-boot\n1.5.1.RELEASE\n\n\nthymeleaf\n3.0.1.RELEASE\n\n\nthymeleaf-layout-dialect\n2.0.1\n\n\n\n\n\u3069\u3046\u3084\u3063\u305f\u304b\n\nEnum\u3092\u4f5c\u308b\n\u4eca\u56de\u306fOFF/ON\u5b9a\u6570\u3092\u6301\u3063\u305fFlag\u3068\u3044\u3046Enum\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u6570\u5024\u30d5\u30a3\u30fc\u30eb\u30c90/1\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u6570\u5024\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304b\u3089\u5b9a\u6570\u3092\u5224\u5225\u30e1\u30bd\u30c3\u30c9\u3082\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\npublic enum Flag {\n    OFF(0),\n    ON(1);\n\n    private int value;\n\n    Flag(int value) {\n        this.value = value;\n    }\n\n    public int getValue() {\n        return value;\n    }\n\n    public void setValue(int value) {\n        this.value = value;\n    }\n\n    public static Flag parse(int value) {\n        return Arrays.stream(Flag.values())\n                .filter(flag -> flag.getValue() == value)\n                .findFirst()\n                .orElseGet(() -> Flag.OFF);\n    }\n}\n\n\nModel\u3092\u4f5c\u308b\n\u524d\u8ff0\u306eEnum\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u3082\u3063\u305fModel\u3067\u3059\u3002\npublic class Sample {\n    private String hoge;\n    private Long fuga;\n    private Flag flag;\n\n    // \u30a2\u30af\u30bb\u30b5\u30e1\u30bd\u30c3\u30c9\u306f\u7701\u7565\n}\n\n\nController\u3092\u4f5c\u308b\n\u4f5c\u6210\u3057\u305fModel\u3092RequestBody\u3068\u3057\u3066\u53d7\u3051\u53d6\u308bController\u3067\u3059\u3002\n/\u306bGET\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u5f8c\u8ff0\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8868\u793a\u3057\u3001\n/log\u306bPOST\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001RequestBody\u306e\u5024\u3092System.out\u3057\u3066\u3044\u307e\u3059\u3002\n@Controller\n@RequestMapping(\"/\")\npublic class SampleController {\n    @GetMapping\n    public String index() {\n        return \"sample\";\n    }\n\n    @PostMapping(\"log\")\n    public String log(@RequestBody Sample sample) {\n        System.out.println(\"hoge = \" + sample.getHoge());\n        System.out.println(\"fuga = \" + sample.getFuga());\n        System.out.println(\"flag = \" + sample.getFlag());\n\n        return \"redirect:sample\";\n    }\n}\n\n\nDeserializer\u3092\u4f5c\u308b\n\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u3002Request\u3067\u53d7\u3051\u53d6\u3063\u305f\u5024\u304b\u3089Object\u306b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u51e6\u7406\u3092\u66f8\u304f\u3068\u3053\u308d\u3067\u3059\u3002\n\u53d7\u3051\u53d6\u3063\u305f\u5024\u3092\u5b9f\u969b\u306b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u51e6\u7406\u3092com.fasterxml.jackson.databind.JsonDeserializer\u3092\u7d99\u627f\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\nclass FlagDeserializer extends JsonDeserializer<Flag> {\n\n    @Override\n    public Flag deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n            throws IOException {\n        final int jsonValue = jsonParser.getIntValue();\n        return Flag.parse(jsonValue);\n    }\n}\n\n\u305d\u3057\u3066\u4f5c\u6210\u3057\u305fDeserializer\u3092Bean\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n@Configuration\npublic class JsonConfiguration {\n    /**\n     * JSON<->Enum\u9593\u306e\u5909\u63dbModule\u3092\u767b\u9332\u3057\u307e\u3059\n     * @return {@link ObjectMapper}\n     */\n    @Bean\n    public ObjectMapper jsonObjectMapper() {\n        ObjectMapper mapper = new ObjectMapper();\n        mapper.registerModule(generateFlagModule());\n        return mapper;\n    }\n\n    private Module generateFlagModule() {\n        SimpleModule simpleModule = new SimpleModule();\n        simpleModule.addDeserializer(Flag.class, new FlagDeserializer());\n        return simpleModule;\n    }\n}\n\n\n\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308b\nRequest\u3092\u9001\u308b\u305f\u3081\u3060\u3051\u306eThymeleaf\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u306b\u306fsend\u30dc\u30bf\u30f3\u3060\u3051\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:th=\"http://www.thymeleaf.org\" xml:lang=\"ja\" lang=\"ja\">\n<head>\n</head>\n<body>\n<input type=\"button\" value=\"send\" id=\"send\" name=\"send\">\n<script type=\"text/javascript\" src=\"//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n    $(function () {\n        $('#send').on('click', function () {\n            $.ajax({\n                type: 'post',\n                url: '/log',\n                data: JSON.stringify(\n                        {\n                            \"hoge\": \"hoge\",\n                            \"fuga\": 123,\n                            \"flag\": 1\n                        }\n                ),\n                dataType: 'json',\n                contentType: 'application/JSON',\n                scriptCharset: 'utf-8'\n            }).done(function (data) {\n                console.log(data);\n            });\n        })\n    });\n</script>\n</body>\n</html>\n\n\n\u7d50\u679c\n\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067send\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u6b21\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\nhoge = hoge\nfuga = 123\nflag = ON\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u3053\u3053\u306b\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/panage/enum-serialize-demo\n# \u6982\u8981\nEnum\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u3082\u3063\u305fJavaBean\u3092RequestBody\u3068\u3057\u3066\u9001\u308a\nController\u3067\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3055\u308c\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\n# \u74b0\u5883\n\u203b Thymeleaf\u304c\u5c11\u3057\u53e4\u3044\u3067\u3059\n\n|Module|Version|\n|---|---|\n|spring-boot|1.5.1.RELEASE|\n|thymeleaf|3.0.1.RELEASE|\n|thymeleaf-layout-dialect|2.0.1|\n\n# \u3069\u3046\u3084\u3063\u305f\u304b\n## Enum\u3092\u4f5c\u308b\n\u4eca\u56de\u306f`OFF/ON`\u5b9a\u6570\u3092\u6301\u3063\u305fFlag\u3068\u3044\u3046Enum\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u305d\u308c\u305e\u308c\u6570\u5024\u30d5\u30a3\u30fc\u30eb\u30c9`0/1`\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u6570\u5024\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u5024\u304b\u3089\u5b9a\u6570\u3092\u5224\u5225\u30e1\u30bd\u30c3\u30c9\u3082\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\n\n```java\npublic enum Flag {\n    OFF(0),\n    ON(1);\n\n    private int value;\n\n    Flag(int value) {\n        this.value = value;\n    }\n\n    public int getValue() {\n        return value;\n    }\n\n    public void setValue(int value) {\n        this.value = value;\n    }\n\n    public static Flag parse(int value) {\n        return Arrays.stream(Flag.values())\n                .filter(flag -> flag.getValue() == value)\n                .findFirst()\n                .orElseGet(() -> Flag.OFF);\n    }\n}\n```\n\n## Model\u3092\u4f5c\u308b\n\u524d\u8ff0\u306eEnum\u3092\u30e1\u30f3\u30d0\u30fc\u306b\u3082\u3063\u305fModel\u3067\u3059\u3002\n\n```java\npublic class Sample {\n    private String hoge;\n    private Long fuga;\n    private Flag flag;\n\n    // \u30a2\u30af\u30bb\u30b5\u30e1\u30bd\u30c3\u30c9\u306f\u7701\u7565\n}\n```\n\n## Controller\u3092\u4f5c\u308b\n\u4f5c\u6210\u3057\u305fModel\u3092RequestBody\u3068\u3057\u3066\u53d7\u3051\u53d6\u308bController\u3067\u3059\u3002\n`/`\u306bGET\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u5f8c\u8ff0\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u8868\u793a\u3057\u3001\n`/log`\u306bPOST\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001RequestBody\u306e\u5024\u3092`System.out`\u3057\u3066\u3044\u307e\u3059\u3002\n\n```java\n@Controller\n@RequestMapping(\"/\")\npublic class SampleController {\n    @GetMapping\n    public String index() {\n        return \"sample\";\n    }\n\n    @PostMapping(\"log\")\n    public String log(@RequestBody Sample sample) {\n        System.out.println(\"hoge = \" + sample.getHoge());\n        System.out.println(\"fuga = \" + sample.getFuga());\n        System.out.println(\"flag = \" + sample.getFlag());\n\n        return \"redirect:sample\";\n    }\n}\n```\n\n## Deserializer\u3092\u4f5c\u308b\n\u4eca\u56de\u306e\u30e1\u30a4\u30f3\u3002Request\u3067\u53d7\u3051\u53d6\u3063\u305f\u5024\u304b\u3089Object\u306b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u51e6\u7406\u3092\u66f8\u304f\u3068\u3053\u308d\u3067\u3059\u3002\n\u53d7\u3051\u53d6\u3063\u305f\u5024\u3092\u5b9f\u969b\u306b\u30c7\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3059\u308b\u51e6\u7406\u3092`com.fasterxml.jackson.databind.JsonDeserializer`\u3092\u7d99\u627f\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```java\nclass FlagDeserializer extends JsonDeserializer<Flag> {\n\n    @Override\n    public Flag deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n            throws IOException {\n        final int jsonValue = jsonParser.getIntValue();\n        return Flag.parse(jsonValue);\n    }\n}\n```\n\n\u305d\u3057\u3066\u4f5c\u6210\u3057\u305fDeserializer\u3092Bean\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```java\n@Configuration\npublic class JsonConfiguration {\n    /**\n     * JSON<->Enum\u9593\u306e\u5909\u63dbModule\u3092\u767b\u9332\u3057\u307e\u3059\n     * @return {@link ObjectMapper}\n     */\n    @Bean\n    public ObjectMapper jsonObjectMapper() {\n        ObjectMapper mapper = new ObjectMapper();\n        mapper.registerModule(generateFlagModule());\n        return mapper;\n    }\n\n    private Module generateFlagModule() {\n        SimpleModule simpleModule = new SimpleModule();\n        simpleModule.addDeserializer(Flag.class, new FlagDeserializer());\n        return simpleModule;\n    }\n}\n```\n\n## \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4f5c\u308b\nRequest\u3092\u9001\u308b\u305f\u3081\u3060\u3051\u306eThymeleaf\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3067\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u306b\u306f`send`\u30dc\u30bf\u30f3\u3060\u3051\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```html\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:th=\"http://www.thymeleaf.org\" xml:lang=\"ja\" lang=\"ja\">\n<head>\n</head>\n<body>\n<input type=\"button\" value=\"send\" id=\"send\" name=\"send\">\n<script type=\"text/javascript\" src=\"//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js\"></script>\n<script type=\"text/javascript\">\n    $(function () {\n        $('#send').on('click', function () {\n            $.ajax({\n                type: 'post',\n                url: '/log',\n                data: JSON.stringify(\n                        {\n                            \"hoge\": \"hoge\",\n                            \"fuga\": 123,\n                            \"flag\": 1\n                        }\n                ),\n                dataType: 'json',\n                contentType: 'application/JSON',\n                scriptCharset: 'utf-8'\n            }).done(function (data) {\n                console.log(data);\n            });\n        })\n    });\n</script>\n</body>\n</html>\n```\n\n# \u7d50\u679c\n\u30a2\u30d7\u30ea\u3092\u8d77\u52d5\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067`send`\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u6b21\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n```\nhoge = hoge\nfuga = 123\nflag = ON\n```\n\n# \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n\u3053\u3053\u306b\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/panage/enum-serialize-demo\n"}