{"context": "\n\n[\u6982\u8981]\nMonit\u306b\u3088\u308bcrond\u306e\u76e3\u8996\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n\n[\u4e8b\u524d\u6e96\u5099]\n\nCentos7\u306bmoni\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\n\n\nCentOS7\u306bmonit\u3092\u5c0e\u5165\u3057\u3066\u307f\u308b\n\n\n\n\n[\u4f5c\u696d\u5185\u5bb9]\n\n\u76e3\u8996\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\u901a\u4f8b\u3067\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u300c*.rc\u300d\u3068\u3059\u308b\u3002\n$ sudo vim /etc/monit.d/crond.rc\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\nif 5 restarts within 5 cycles then unmonitor \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u518d\u8d77\u52d5\u30925\u56de\u3084\u3063\u305f\u3089\u8ae6\u3081\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u4f55\u304b\u3057\u3089\u306e\u539f\u56e0\u3067\u8d77\u52d5->\u5931\u6557->\u8d77\u52d5->\u5931\u6557 \u3092\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3082\u56f0\u308b\u306e\u3067  \n\n/etc/monit.d/crond.rc\ncheck process cron with pidfile /var/run/crond.pid\n  group system\n  start program = \"/bin/systemctl start crond\"\n  stop  program = \"/bin/systemctl stop crond\"\n  if 5 restarts within 5 cycles then unmonitor # 5\u56de\u306e\u76e3\u8996\u4e2d\u306b\u30015\u56de\u518d\u8d77\u52d5\u3092\u5b9f\u65bd\u3057\u3066\u76e3\u8996\u3092\u505c\u6b62\u3059\u308b\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d(CLI)\n$ sudo monit status\nThe Monit daemon 5.14 uptime: 0m\n\nProcess 'cron'\n  status                            Running\n  monitoring status                 Monitored\n  pid                               14122\n  parent pid                        1\n  uid                               0\n  effective uid                     0\n  gid                               0\n  uptime                            4h 2m\n  children                          0\n  memory                            1.6 MB\n  memory total                      1.6 MB\n  memory percent                    0.3%\n  memory percent total              0.3%\n  cpu percent                       0.0%\n  cpu percent total                 0.0%\n  data collected                    Sun, 27 Nov 2016 10:02:49\n\nSystem 'server1'\n  status                            Running\n  monitoring status                 Monitored\n  load average                      [0.00] [0.01] [0.05]\n  cpu                               0.0%us 0.0%sy 0.0%wa\n  memory usage                      81.4 MB [16.6%]\n  swap usage                        1.2 MB [0.1%]\n  data collected                    Sun, 27 Nov 2016 10:02:49\n\n\n\u52d5\u4f5c\u78ba\u8a8d(Web)\nWeb\u753b\u9762\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u308b\n - http://{Monit Server IP}:2812/\n\ncron \u304b\u3089\u30d7\u30ed\u30bb\u30b9\u306e\u8a73\u7d30\u3082\u78ba\u8a8d\u53ef\u80fd\u3067\u3059\u3002\n\u753b\u9762\u4e0b\u306e\u65b9\u306b\u3042\u308b\u3001\u4e0b\u8a18\u306e\u30dc\u30bf\u30f3\u304b\u3089\u30d7\u30ed\u30bb\u30b9\u3092\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306broot\u6a29\u9650\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\nStart service\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\n\n\nStop service\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u505c\u6b62\n\n\nRestart service\n\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u518d\u8d77\u52d5\n\n\nDisable monitoring\n\n\n\u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u306e\u505c\u6b62\n\n\n\n\n\n\u30d7\u30ed\u30bb\u30b9kill\u3055\u308c\u3066\u3082\u8d77\u52d5\u3059\u308b\u304b\u78ba\u8a8d\n\n\u30d7\u30ed\u30bb\u30b9\u306e\u78ba\u8a8d\n$ ps -aef | grep crond\nroot     31217     1  0 10:08 ?        00:00:00 /usr/sbin/crond -n\nvagrant  31316 18008  0 11:05 pts/0    00:00:00 grep --color=auto crond\n\n\n\u30d7\u30ed\u30bb\u30b9\u3092kill\u3059\u308b\n$ sudo kill -9 31217\n\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u6b7b\u3093\u3067\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n$ $ ps -aef | grep crond\nvagrant  31322 18008  0 11:06 pts/0    00:00:00 grep --color=auto crond\n\n\nmonit\u304b\u3089kill\u3055\u308c\u305f\u304b\u78ba\u8a8d(CLI)\n$ sudo monit status cron\nThe Monit daemon 5.14 uptime: 1h 4m\n\nProcess 'cron'\n  status                            Does not exist\n  monitoring status                 Monitored\n  data collected                    Sun, 27 Nov 2016 11:07:20\n\n\nmonit\u304b\u3089kill\u3055\u308c\u305f\u304b\u78ba\u8a8d(web)\n\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u8fd4\u308b\u304b\u78ba\u8a8d(CLI)\nuptime \u304c 0m \u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4eca\u3055\u3063\u304d\u8d77\u52d5\u3057\u305f\u306e\u304c\u308f\u304b\u308b\u3002\n$ sudo monit status cron\nThe Monit daemon 5.14 uptime: 1h 12m\n\nProcess 'cron'\n  status                            Running\n  monitoring status                 Monitored\n  pid                               31354\n  parent pid                        1\n  uid                               0\n  effective uid                     0\n  gid                               0\n  uptime                            0m\n  children                          0\n  memory                            1.5 MB\n  memory total                      1.5 MB\n  memory percent                    0.3%\n  memory percent total              0.3%\n  cpu percent                       0.0%\n  cpu percent total                 0.0%\n  data collected                    Sun, 27 Nov 2016 11:15:26\n\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u8fd4\u308b\u304b\u78ba\u8a8d(web)\nUptime \u304c 0m \u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4eca\u3055\u3063\u304d\u8d77\u52d5\u3057\u305f\u306e\u304c\u308f\u304b\u308b\u3002\n\n\n[\u4e8b\u5f8c\u78ba\u8a8d\u30fb\u4f5c\u696d]\n# [\u6982\u8981]\nMonit\u306b\u3088\u308bcrond\u306e\u76e3\u8996\u65b9\u6cd5\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n# [\u4e8b\u524d\u6e96\u5099]\n* Centos7\u306bmoni\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\n - [CentOS7\u306bmonit\u3092\u5c0e\u5165\u3057\u3066\u307f\u308b](http://qiita.com/ghfdjk/items/2c132921c9ff5617dc8e)\n\n# [\u4f5c\u696d\u5185\u5bb9]\n## \u76e3\u8996\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\u901a\u4f8b\u3067\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u300c*.rc\u300d\u3068\u3059\u308b\u3002\n\n```bash\n$ sudo vim /etc/monit.d/crond.rc\n```\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n`if 5 restarts within 5 cycles then unmonitor` \u3092\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u518d\u8d77\u52d5\u30925\u56de\u3084\u3063\u305f\u3089\u8ae6\u3081\u3066\u304f\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u4f55\u304b\u3057\u3089\u306e\u539f\u56e0\u3067\u8d77\u52d5->\u5931\u6557->\u8d77\u52d5->\u5931\u6557 \u3092\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3082\u56f0\u308b\u306e\u3067 :sweat_smile:  \n\n```/etc/monit.d/crond.rc\ncheck process cron with pidfile /var/run/crond.pid\n  group system\n  start program = \"/bin/systemctl start crond\"\n  stop  program = \"/bin/systemctl stop crond\"\n  if 5 restarts within 5 cycles then unmonitor # 5\u56de\u306e\u76e3\u8996\u4e2d\u306b\u30015\u56de\u518d\u8d77\u52d5\u3092\u5b9f\u65bd\u3057\u3066\u76e3\u8996\u3092\u505c\u6b62\u3059\u308b\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d(CLI)\n```\n$ sudo monit status\nThe Monit daemon 5.14 uptime: 0m\n\nProcess 'cron'\n  status                            Running\n  monitoring status                 Monitored\n  pid                               14122\n  parent pid                        1\n  uid                               0\n  effective uid                     0\n  gid                               0\n  uptime                            4h 2m\n  children                          0\n  memory                            1.6 MB\n  memory total                      1.6 MB\n  memory percent                    0.3%\n  memory percent total              0.3%\n  cpu percent                       0.0%\n  cpu percent total                 0.0%\n  data collected                    Sun, 27 Nov 2016 10:02:49\n\nSystem 'server1'\n  status                            Running\n  monitoring status                 Monitored\n  load average                      [0.00] [0.01] [0.05]\n  cpu                               0.0%us 0.0%sy 0.0%wa\n  memory usage                      81.4 MB [16.6%]\n  swap usage                        1.2 MB [0.1%]\n  data collected                    Sun, 27 Nov 2016 10:02:49\n```\n\n\n## \u52d5\u4f5c\u78ba\u8a8d(Web)\nWeb\u753b\u9762\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u308b\n - http://{Monit Server IP}:2812/\n\n![monit_process_cron](http://drive.google.com/uc?export=view&id=0Byh1aAqbAigJTzNFMXR1OVhSQlU)\n\n`cron` \u304b\u3089\u30d7\u30ed\u30bb\u30b9\u306e\u8a73\u7d30\u3082\u78ba\u8a8d\u53ef\u80fd\u3067\u3059\u3002\n\u753b\u9762\u4e0b\u306e\u65b9\u306b\u3042\u308b\u3001\u4e0b\u8a18\u306e\u30dc\u30bf\u30f3\u304b\u3089\u30d7\u30ed\u30bb\u30b9\u3092\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b`root`\u6a29\u9650\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n* Start service\n - \u30d7\u30ed\u30bb\u30b9\u306e\u8d77\u52d5\n* Stop service\n - \u30d7\u30ed\u30bb\u30b9\u306e\u505c\u6b62\n* Restart service\n - \u30d7\u30ed\u30bb\u30b9\u306e\u518d\u8d77\u52d5\n* Disable monitoring\n - \u30d7\u30ed\u30bb\u30b9\u76e3\u8996\u306e\u505c\u6b62\n\n![monit_process_status_cron](http://drive.google.com/uc?export=view&id=0Byh1aAqbAigJVE5XZmpkZ2ItZ1U)\n\n\n### \u30d7\u30ed\u30bb\u30b9kill\u3055\u308c\u3066\u3082\u8d77\u52d5\u3059\u308b\u304b\u78ba\u8a8d\n#### \u30d7\u30ed\u30bb\u30b9\u306e\u78ba\u8a8d\n```bash\n$ ps -aef | grep crond\nroot     31217     1  0 10:08 ?        00:00:00 /usr/sbin/crond -n\nvagrant  31316 18008  0 11:05 pts/0    00:00:00 grep --color=auto crond\n```\n\n#### \u30d7\u30ed\u30bb\u30b9\u3092kill\u3059\u308b\n```bash\n$ sudo kill -9 31217\n```\n\n#### \u30d7\u30ed\u30bb\u30b9\u304c\u6b7b\u3093\u3067\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n```bash\n$ $ ps -aef | grep crond\nvagrant  31322 18008  0 11:06 pts/0    00:00:00 grep --color=auto crond\n```\n\n#### monit\u304b\u3089kill\u3055\u308c\u305f\u304b\u78ba\u8a8d(CLI)\n```bash\n$ sudo monit status cron\nThe Monit daemon 5.14 uptime: 1h 4m\n\nProcess 'cron'\n  status                            Does not exist\n  monitoring status                 Monitored\n  data collected                    Sun, 27 Nov 2016 11:07:20\n```\n\n#### monit\u304b\u3089kill\u3055\u308c\u305f\u304b\u78ba\u8a8d(web)\n![monit_process_does_not_exist](http://drive.google.com/uc?export=view&id=0Byh1aAqbAigJVHYtSktkSzRvaGs)\n\n#### \u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u8fd4\u308b\u304b\u78ba\u8a8d(CLI)\n`uptime` \u304c `0m` \u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4eca\u3055\u3063\u304d\u8d77\u52d5\u3057\u305f\u306e\u304c\u308f\u304b\u308b\u3002\n\n```bash\n$ sudo monit status cron\nThe Monit daemon 5.14 uptime: 1h 12m\n\nProcess 'cron'\n  status                            Running\n  monitoring status                 Monitored\n  pid                               31354\n  parent pid                        1\n  uid                               0\n  effective uid                     0\n  gid                               0\n  uptime                            0m\n  children                          0\n  memory                            1.5 MB\n  memory total                      1.5 MB\n  memory percent                    0.3%\n  memory percent total              0.3%\n  cpu percent                       0.0%\n  cpu percent total                 0.0%\n  data collected                    Sun, 27 Nov 2016 11:15:26\n```\n\n#### \u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u8fd4\u308b\u304b\u78ba\u8a8d(web)\n`Uptime` \u304c `0m` \u306b\u306a\u3063\u3066\u304a\u308a\u3001\u4eca\u3055\u3063\u304d\u8d77\u52d5\u3057\u305f\u306e\u304c\u308f\u304b\u308b\u3002\n\n![monit_process_running](http://drive.google.com/uc?export=view&id=0Byh1aAqbAigJaTFOUUhEY0JUS1k)\n\n\n## [\u4e8b\u5f8c\u78ba\u8a8d\u30fb\u4f5c\u696d]\n", "tags": ["monit"]}