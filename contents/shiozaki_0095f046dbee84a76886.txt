{"context": "\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5404\u8981\u7d20\u304c\u914d\u5217\u306b\u306a\u3063\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3001\u914d\u5217\u5185\u306e\u5404\u8981\u7d20\u306b+1\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u307e\u3059\u3002\n\n\n\narr\n\n\n\n\n[1, 2, 3, 4, 5]\n\n\n[6, 7, 8, 9, 10]\n\n\n\n\u5358\u7d14\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u3057\u307e\u3046\u3068\u3001ARRAY<INT64>\u3068INT64\u306e\u9593\u3067\u52a0\u7b97\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3059\u3002\nWITH T AS(\n  SELECT [1, 2, 3, 4, 5] AS arr UNION ALL\n  SELECT [6, 7, 8, 9, 10]\n)\nSELECT arr + 1 FROM T\n\n\u306a\u306e\u3067\u3001\u4e00\u65e6\u3001UNNEST\u3057\u3066\u30b9\u30ab\u30e9\u30fc\u578b\u306b\u3057\u305f\u5f8c\u306b\u52a0\u7b97\u3057\u3001\u305d\u308c\u3089\u3092ARRAY\u3067\u914d\u5217\u306b\u3059\u308c\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u5404\u8981\u7d20\u5bfe\u3057\u3066+1\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nWITH T AS(\n  SELECT [1, 2, 3, 4, 5] AS arr UNION ALL\n  SELECT [6, 7, 8, 9, 10]\n)\nSELECT ARRAY(SELECT elem + 1 FROM UNNEST(T.arr) AS elem) AS mapped FROM T\n\n\n2016/11/15 \u8ffd\u8a18\nyancya\u3055\u3093\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306aUDF\u3092\u4f5c\u308b\u3068\u3001SQL\u672c\u4f53\u304c\u3059\u3063\u304d\u308a\u3057\u3066\u975e\u5e38\u306b\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n#standardSQL\nCREATE TEMPORARY FUNCTION MAP_ADD(ary ARRAY<INT64>, n INT64)\nRETURNS ARRAY<INT64> AS ((SELECT ARRAY_AGG(_n + n) FROM UNNEST(ary) AS _n));\n\nWITH T AS(\nSELECT [1, 2, 3, 4, 5] AS arr UNION ALL\nSELECT [6, 7, 8, 9, 10]\n)\nSELECT MAP_ADD(arr, 1) AS mapped FROM T\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5404\u8981\u7d20\u304c\u914d\u5217\u306b\u306a\u3063\u3066\u3044\u308b\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3057\u3066\u3001\u914d\u5217\u5185\u306e\u5404\u8981\u7d20\u306b+1\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u307e\u3059\u3002\n\n| arr              |\n|------------------|\n| [1, 2, 3, 4, 5]  |\n| [6, 7, 8, 9, 10] |\n\n\n\u5358\u7d14\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u3057\u307e\u3046\u3068\u3001ARRAY\\<INT64\\>\u3068INT64\u306e\u9593\u3067\u52a0\u7b97\u304c\u3067\u304d\u306a\u3044\u3068\u3044\u3046\u30a8\u30e9\u30fc\u304c\u51fa\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n```sql\nWITH T AS(\n  SELECT [1, 2, 3, 4, 5] AS arr UNION ALL\n  SELECT [6, 7, 8, 9, 10]\n)\nSELECT arr + 1 FROM T\n```\n\n\u306a\u306e\u3067\u3001\u4e00\u65e6\u3001UNNEST\u3057\u3066\u30b9\u30ab\u30e9\u30fc\u578b\u306b\u3057\u305f\u5f8c\u306b\u52a0\u7b97\u3057\u3001\u305d\u308c\u3089\u3092ARRAY\u3067\u914d\u5217\u306b\u3059\u308c\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306b\u3059\u308c\u3070\u3001\u554f\u984c\u306a\u304f\u5404\u8981\u7d20\u5bfe\u3057\u3066+1\u3092\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```sql\nWITH T AS(\n  SELECT [1, 2, 3, 4, 5] AS arr UNION ALL\n  SELECT [6, 7, 8, 9, 10]\n)\nSELECT ARRAY(SELECT elem + 1 FROM UNNEST(T.arr) AS elem) AS mapped FROM T\n```\n# 2016/11/15 \u8ffd\u8a18\nyancya\u3055\u3093\u304b\u3089\u30b3\u30e1\u30f3\u30c8\u304c\u3042\u308a\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306aUDF\u3092\u4f5c\u308b\u3068\u3001SQL\u672c\u4f53\u304c\u3059\u3063\u304d\u308a\u3057\u3066\u975e\u5e38\u306b\u898b\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\n```sql\n#standardSQL\nCREATE TEMPORARY FUNCTION MAP_ADD(ary ARRAY<INT64>, n INT64)\nRETURNS ARRAY<INT64> AS ((SELECT ARRAY_AGG(_n + n) FROM UNNEST(ary) AS _n));\n\nWITH T AS(\nSELECT [1, 2, 3, 4, 5] AS arr UNION ALL\nSELECT [6, 7, 8, 9, 10]\n)\nSELECT MAP_ADD(arr, 1) AS mapped FROM T\n```\n", "tags": ["gcp", "google", "bigquery", "GoogleCloudPlatform", "SQL"]}