{"context": " More than 1 year has passed since last update.clz \u304c SIMD \u306b\u306a\u308a\u307e\u3057\u305f\u300216\u4e26\u5217\u3067 32bit clz \u3057\u307e\u3059\u3002\nclz \u306f\u4e0a\u306e\u307b\u3046\u304b\u3089\u898b\u307e\u3059\u30020 \u306e\u5834\u5408\u306f32\u306b\u306a\u308a\u307e\u3059\u3002\n\u50d5\u306f\u3044\u3064\u307e\u3067\u305f\u3063\u3066\u3082\u3001clz, ctz \u3069\u3063\u3061\u304c\u3069\u3063\u3061\u3067\u3001bsr, bsf \u304c\u3069\u3063\u3061\u306a\u306e\u304b\u5fd8\u308c\u307e\u3059\u306d\u3002(\u3069\u3046\u3067\u3082\u3044\u3044\u60c5\u5831\u3002)\nhttp://en.wikipedia.org/wiki/Find_first_set#Hardware_support \u306a\u308b\u307b\u3069\uff1f\n#include <immintrin.h>\n#include <stdio.h>\n\nunsigned int in[16] = {\n    1,\n    1<<31,\n    (1<<31) | 1,\n    (1<<16),\n\n    0xaaaaaaaa,\n    0x55555555,\n\n    ~0,\n    0,\n};\n\nunsigned int out[16];\n\nvoid\ndump_bits32(unsigned int a)\n{\n    for (int i=0; i<32; i++) {\n        if (a & (1<<(31-i))) {\n            putchar('1');\n        } else {\n            putchar('0');\n        }\n    }\n    putchar(':');\n}\n\n\n\nint\nmain()\n{\n    __m512i v0 = _mm512_loadu_si512(in);\n    v0 = _mm512_lzcnt_epi32(v0);\n\n    _mm512_storeu_si512(out, v0);\n\n    for (int i=0; i<8; i++) {\n        dump_bits32(in[i]);\n        printf(\"%d\\n\", out[i]);\n    }\n}\n\n00000000000000000000000000000001:31\n10000000000000000000000000000000:0\n10000000000000000000000000000001:0\n00000000000000010000000000000000:15\n10101010101010101010101010101010:0\n01010101010101010101010101010101:1\n11111111111111111111111111111111:0\n00000000000000000000000000000000:32\n\n\u4f55\u6545\u304b\u3001AVX-512CD(conflict detection)\u62e1\u5f35\u3067\u3059\u3002\n\u660e\u65e5\u306f\u3001@tanakmura \u304c vrangeps \u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\nclz \u304c SIMD \u306b\u306a\u308a\u307e\u3057\u305f\u300216\u4e26\u5217\u3067 32bit clz \u3057\u307e\u3059\u3002\n\nclz \u306f\u4e0a\u306e\u307b\u3046\u304b\u3089\u898b\u307e\u3059\u30020 \u306e\u5834\u5408\u306f32\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u50d5\u306f\u3044\u3064\u307e\u3067\u305f\u3063\u3066\u3082\u3001clz, ctz \u3069\u3063\u3061\u304c\u3069\u3063\u3061\u3067\u3001bsr, bsf \u304c\u3069\u3063\u3061\u306a\u306e\u304b\u5fd8\u308c\u307e\u3059\u306d\u3002(\u3069\u3046\u3067\u3082\u3044\u3044\u60c5\u5831\u3002)\n\nhttp://en.wikipedia.org/wiki/Find_first_set#Hardware_support \u306a\u308b\u307b\u3069\uff1f\n\n```cpp\n#include <immintrin.h>\n#include <stdio.h>\n\nunsigned int in[16] = {\n    1,\n    1<<31,\n    (1<<31) | 1,\n    (1<<16),\n\n    0xaaaaaaaa,\n    0x55555555,\n\n    ~0,\n    0,\n};\n\nunsigned int out[16];\n\nvoid\ndump_bits32(unsigned int a)\n{\n    for (int i=0; i<32; i++) {\n        if (a & (1<<(31-i))) {\n            putchar('1');\n        } else {\n            putchar('0');\n        }\n    }\n    putchar(':');\n}\n\n\n\nint\nmain()\n{\n    __m512i v0 = _mm512_loadu_si512(in);\n    v0 = _mm512_lzcnt_epi32(v0);\n\n    _mm512_storeu_si512(out, v0);\n\n    for (int i=0; i<8; i++) {\n        dump_bits32(in[i]);\n        printf(\"%d\\n\", out[i]);\n    }\n}\n```\n\n```\n00000000000000000000000000000001:31\n10000000000000000000000000000000:0\n10000000000000000000000000000001:0\n00000000000000010000000000000000:15\n10101010101010101010101010101010:0\n01010101010101010101010101010101:1\n11111111111111111111111111111111:0\n00000000000000000000000000000000:32\n```\n\n\u4f55\u6545\u304b\u3001AVX-512CD(conflict detection)\u62e1\u5f35\u3067\u3059\u3002\n\n\n\u660e\u65e5\u306f\u3001@tanakmura \u304c vrangeps \u306b\u3064\u3044\u3066\u66f8\u304d\u307e\u3059\u3002\n", "tags": ["avx512"]}