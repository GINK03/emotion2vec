{"context": "\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3055\u305b\u308b\u6642\u306b\u547c\u3070\u308c\u308b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570 stop/1 \u3067 application:stop/1 \u3092\u547c\u3073\u51fa\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n\u52d5\u6a5f\n\u81ea\u8eab\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3055\u305b\u308b\u6642\u3001\u4ed6\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u7d42\u4e86\u3055\u305b\u3066\u304b\u3089\u7d42\u308f\u3063\u305f\u307b\u3046\u304c\u7dba\u9e97\u306b\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3067\u304d\u308b\u304b\u306a\u3068\u601d\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\nmyapp_app.erl\n-module(myapp_app).\n\n-behaviour(application).\n\n...\n\n-spec stop(_) -> ok.\nstop(_State) ->\n    application:stop(cowboy),\n    application:stop(hackney),\n    %% \u305d\u306e\u4ed6\u8d77\u52d5\u3057\u3066\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3059\u308b\n    ok.\n\n\n\n\u4f55\u304c\u8d77\u304d\u308b\u304b\n\u7d42\u4e86\u3057\u306a\u3044\n\n\u4f55\u304c\u8d77\u304d\u3066\u3044\u308b\u304b\n\napplication.erl\nstop(Application) ->\n    application_controller:stop_application(Application).\n\n\napplication:stop/1 \u306f application_controller:stop_application/1 \u3092\u547c\u3093\u3067\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\napplication_controller.erl\nstop_application(AppName) ->\n    gen_server:call(?AC, {stop_application, AppName}, infinity).\n\n\n\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7e8f\u3081\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b gen_server:call/3\u3001\u3057\u304b\u3082 infinity \u3067\u540c\u671f\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u6642\u70b9\u3067\u5927\u5206\u5acc\u306a\u4e88\u611f\u304c\u3057\u307e\u3059\u306d\u3002\n\napplication_controller.erl\nhandle_call({stop_application, AppName}, _From, S) ->\n    ...\n    stop_appl(AppName, Id, Type),\n    ...\n\n\nstop_appl/3 \u3092\u547c\u3073\u51fa\u3057\u2026\n\napplication_controller.erl\nstop_appl(AppName, Id, Type) when is_pid(Id) ->\n    ...\n    application_master:stop(Id),\n    ...\n\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u5b58\u5728\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30de\u30b9\u30bf\u30fc\u306e application_master:stop/1 \u3092\u547c\u3073\u51fa\u3057\u2026\n\napplication_master.erl\nstop(AppMaster) -> call(AppMaster, stop).\n\ncall(AppMaster, Req) ->\n    Tag = make_ref(),\n    Ref = erlang:monitor(process, AppMaster),\n    AppMaster ! {Req, Tag, self()},\n    receive \n        {'DOWN', Ref, process, _, _Info} ->\n            ok;\n        {Tag, Res} ->\n            erlang:demonitor(Ref, [flush]),\n            Res\n    end.\n\n\nAppMaster\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u76f4\u5f8c\u306b receive \u3057\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u306f\u540c\u671f\u51e6\u7406\u3067\u3059\u3002\n\napplication_master.erl\nhandle_msg({stop, Tag, From}, State) ->\n    catch terminate(normal, State),\n    ...\n\nterminate(Reason, State = #state{child=Child, children=Children, req=Reqs}) ->\n    ...\n    terminate_child(Child, State),\n    ...\n\nterminate_child(Child, State) ->\n    terminate_child_i(Child, State).\n\nterminate_child_i(Child, State) ->\n    Child ! {self(), terminate},\n    terminate_loop(Child, State).\n\nterminate_loop(Child, State) ->\n    receive\n        IoReq when element(1, IoReq) =:= io_request ->\n            State#state.gleader ! IoReq,\n            terminate_loop(Child, State);\n        {'EXIT', Child, _} ->\n            ok;\n        Other ->\n            NewState = handle_msg(Other, State),\n            terminate_loop(Child, NewState)\n    end.\n\n\nterminate_child_i/2 \u3067 Child ! {self(), terminate} \u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u76f4\u5f8c terminate_loop/2 \u3067 receive \u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u308c\u3082\u540c\u671f\u51e6\u7406\u3067\u3059\u3002\n\napplication_master.erl\nloop_it(Parent, Child, Mod, AppState) ->\n    receive\n        ...\n        {Parent, terminate} ->\n            ...\n            catch Mod:stop(NewAppState),\n            exit(normal);\n        ...\n    end.\n\n\n\u305d\u3057\u3066\u3053\u3053\u3067\u3000Mod:stop/1 \u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u304c\u6700\u521d\u306b\u66f8\u3044\u305f application \u30d3\u30d8\u30a4\u30d3\u30a2\u306e stop/1 \u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002\n\u3069\u308c\u3082\u5168\u90e8\u540c\u671f\u51e6\u7406\u3067\u3042\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f Mod:stop/1 \u306e\u51e6\u7406\u304c\u7d42\u308f\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059\u3002\n\u3067\u3001\u305d\u306e\u4e2d\u3067\u66f4\u306b application:stop/1 \u3092\u547c\u3073\u51fa\u3059\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f\u65e2\u306b Mod:stop/1 \u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3001\u30c7\u30c3\u30c9\u30ed\u30c3\u30af \u304c\u767a\u751f\u3057\u3001\u6c38\u9060\u306b\u5f85\u3061\u7d9a\u3051\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u6559\u8a13\nstop/1 \u306e\u4e2d\u3067\u306f\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u308f\u3089\u305b\u308b\u3053\u3068\u306b\u6ce8\u529b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u53c2\u8003\n\notp/lib/kernel/src at maint \u00b7 erlang/otp\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3055\u305b\u308b\u6642\u306b\u547c\u3070\u308c\u308b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570 `stop/1` \u3067 `application:stop/1` \u3092\u547c\u3073\u51fa\u3057\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002\n\n## \u52d5\u6a5f\n\n\u81ea\u8eab\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3055\u305b\u308b\u6642\u3001\u4ed6\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3082\u7d42\u4e86\u3055\u305b\u3066\u304b\u3089\u7d42\u308f\u3063\u305f\u307b\u3046\u304c\u7dba\u9e97\u306b\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u3067\u304d\u308b\u304b\u306a\u3068\u601d\u3063\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u307e\u3057\u305f\u3002\n\n```erlang:myapp_app.erl\n-module(myapp_app).\n\n-behaviour(application).\n\n...\n\n-spec stop(_) -> ok.\nstop(_State) ->\n    application:stop(cowboy),\n    application:stop(hackney),\n    %% \u305d\u306e\u4ed6\u8d77\u52d5\u3057\u3066\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u4e86\u3059\u308b\n    ok.\n```\n\n## \u4f55\u304c\u8d77\u304d\u308b\u304b\n\n**\u7d42\u4e86\u3057\u306a\u3044**\n\n## \u4f55\u304c\u8d77\u304d\u3066\u3044\u308b\u304b\n\n```erlang:application.erl\nstop(Application) ->\n    application_controller:stop_application(Application).\n```\n\n`application:stop/1` \u306f `application_controller:stop_application/1` \u3092\u547c\u3093\u3067\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n```erlang:application_controller.erl\nstop_application(AppName) ->\n    gen_server:call(?AC, {stop_application, AppName}, infinity).\n```\n\n\u8907\u6570\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7e8f\u3081\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306b `gen_server:call/3`\u3001\u3057\u304b\u3082 `infinity` \u3067\u540c\u671f\u547c\u3073\u51fa\u3057\u3092\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u6642\u70b9\u3067\u5927\u5206\u5acc\u306a\u4e88\u611f\u304c\u3057\u307e\u3059\u306d\u3002\n\n```erlang:application_controller.erl\nhandle_call({stop_application, AppName}, _From, S) ->\n    ...\n    stop_appl(AppName, Id, Type),\n    ...\n```\n\n`stop_appl/3` \u3092\u547c\u3073\u51fa\u3057\u2026\n\n```erlang:application_controller.erl\nstop_appl(AppName, Id, Type) when is_pid(Id) ->\n    ...\n    application_master:stop(Id),\n    ...\n```\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3054\u3068\u306b\u5b58\u5728\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30de\u30b9\u30bf\u30fc\u306e `application_master:stop/1` \u3092\u547c\u3073\u51fa\u3057\u2026\n\n```erlang:application_master.erl\nstop(AppMaster) -> call(AppMaster, stop).\n\ncall(AppMaster, Req) ->\n    Tag = make_ref(),\n    Ref = erlang:monitor(process, AppMaster),\n    AppMaster ! {Req, Tag, self()},\n    receive \n        {'DOWN', Ref, process, _, _Info} ->\n            ok;\n        {Tag, Res} ->\n            erlang:demonitor(Ref, [flush]),\n            Res\n    end.\n```\n\n`AppMaster`\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u76f4\u5f8c\u306b `receive` \u3057\u3066\u3044\u308b\u306e\u3067\u3053\u308c\u306f\u540c\u671f\u51e6\u7406\u3067\u3059\u3002\n\n```erlang:application_master.erl\nhandle_msg({stop, Tag, From}, State) ->\n    catch terminate(normal, State),\n    ...\n\nterminate(Reason, State = #state{child=Child, children=Children, req=Reqs}) ->\n    ...\n    terminate_child(Child, State),\n    ...\n\nterminate_child(Child, State) ->\n    terminate_child_i(Child, State).\n\nterminate_child_i(Child, State) ->\n    Child ! {self(), terminate},\n    terminate_loop(Child, State).\n\nterminate_loop(Child, State) ->\n    receive\n        IoReq when element(1, IoReq) =:= io_request ->\n            State#state.gleader ! IoReq,\n            terminate_loop(Child, State);\n        {'EXIT', Child, _} ->\n            ok;\n        Other ->\n            NewState = handle_msg(Other, State),\n            terminate_loop(Child, NewState)\n    end.\n```\n\n`terminate_child_i/2` \u3067 `Child ! {self(), terminate}` \u3057\u3066\u3044\u307e\u3059\u304c\u3001\u305d\u306e\u76f4\u5f8c `terminate_loop/2` \u3067 `receive` \u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3053\u308c\u3082\u540c\u671f\u51e6\u7406\u3067\u3059\u3002\n\n```erlang:application_master.erl\nloop_it(Parent, Child, Mod, AppState) ->\n    receive\n        ...\n        {Parent, terminate} ->\n            ...\n            catch Mod:stop(NewAppState),\n            exit(normal);\n        ...\n    end.\n```\n\n\u305d\u3057\u3066\u3053\u3053\u3067\u3000`Mod:stop/1` \u3092\u547c\u3073\u51fa\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u304c\u6700\u521d\u306b\u66f8\u3044\u305f `application` \u30d3\u30d8\u30a4\u30d3\u30a2\u306e `stop/1` \u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3069\u308c\u3082\u5168\u90e8\u540c\u671f\u51e6\u7406\u3067\u3042\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f `Mod:stop/1` \u306e\u51e6\u7406\u304c\u7d42\u308f\u308b\u306e\u3092\u5f85\u3063\u3066\u3044\u307e\u3059\u3002\n\u3067\u3001\u305d\u306e\u4e2d\u3067\u66f4\u306b `application:stop/1` \u3092\u547c\u3073\u51fa\u3059\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306f\u65e2\u306b `Mod:stop/1` \u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u306a\u306e\u3067\u3001**\u30c7\u30c3\u30c9\u30ed\u30c3\u30af** \u304c\u767a\u751f\u3057\u3001\u6c38\u9060\u306b\u5f85\u3061\u7d9a\u3051\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n## \u6559\u8a13\n\n`stop/1` \u306e\u4e2d\u3067\u306f\u81ea\u5206\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7d42\u308f\u3089\u305b\u308b\u3053\u3068\u306b\u6ce8\u529b\u3057\u307e\u3057\u3087\u3046\u3002\n\n## \u53c2\u8003\n\n- [otp/lib/kernel/src at maint \u00b7 erlang/otp](https://github.com/erlang/otp/tree/maint/lib/kernel/src)\n", "tags": ["Erlang"]}