{"context": " More than 1 year has passed since last update.\u793e\u5185\u3067drone&docker\u304c\u76db\u308a\u4e0a\u304c\u3063\u3066\u304d\u307e\u3057\u305f\uff01\n\u5f0a\u793e @sadapon2008 \u304cdrone\u74b0\u5883\u3092\u6574\u5099\u3057\u3066\u304f\u308c\u305f\u306e\u3067\u3001Rails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092CI\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u65e2\u5b58\u306edocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u306e\u3067\u306f\u306a\u304f\u3001docker\u30a4\u30e1\u30fc\u30b8\u30921\u304b\u3089\u3064\u304f\u3063\u3066\u307f\u3066\u307e\u3059\u3002\n\ndocker\u30a4\u30e1\u30fc\u30b8\u5185\u5bb9\nCentos6.7+Ruby2.2.3+Postgres9.4\nrspec\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u306f\u3082\u3061\u308d\u3093\u3001turnip+capybara+poltergeist\u3067\u306eE2E\u30c6\u30b9\u30c8\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u307e\u3059\u3002\n\nDockerfile\nhttps://github.com/kawahiro311/drone-rails\nFROM centos:6.7\n\n# Install packages for building ruby\nRUN yum -y update\nRUN yum install -y git gcc gcc-c++ make tar wget openssl-devel readline-devel sqlite-devel zlib zlib-devel file\nRUN yum install -y libcurl-devel libyaml-devel libffi-devel bzip2 autoconf automake libtool bison libxml2-devel libxslt-devel\nRUN yum clean all\n\n# Install rbenv and ruby-build\nRUN git clone https://github.com/sstephenson/rbenv.git /root/.rbenv\nRUN git clone https://github.com/sstephenson/ruby-build.git /root/.rbenv/plugins/ruby-build\nRUN ./root/.rbenv/plugins/ruby-build/install.sh\nENV PATH /root/.rbenv/bin:$PATH\nRUN echo 'export PATH=/root/.rbenv/bin:$PATH' >> /root/.bashrc\nRUN echo 'eval \"$(rbenv init -)\"' >> /root/.bashrc\n\n# Install ruby\nENV CONFIGURE_OPTS --disable-install-doc\nRUN rbenv install 2.2.3\nRUN rbenv global 2.2.3\n\n# Install Bundler for ruby\nRUN echo 'gem: --no-rdoc --no-ri' >> /.gemrc\nRUN rbenv exec gem install bundler\n\n# Install node.js\nRUN rpm -ivh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\nRUN yum -y install nodejs npm --enablerepo=epel\nRUN yum clean all\nRUN npm install -g bower\n\n# Install postgres\nRUN rpm -ivh http://yum.postgresql.org/9.4/redhat/rhel-6-x86_64/pgdg-centos94-9.4-1.noarch.rpm\nRUN yum -y install postgresql94 postgresql94-devel postgresql94-server\nRUN yum clean all\nRUN ./etc/init.d/postgresql-9.4 initdb -E UNICODE --no-locale\nCOPY pg_hba.conf /var/lib/pgsql/9.4/data/pg_hba.conf\nRUN echo \"listen_addresses = '*'\" >> /var/lib/pgsql/9.4/data/postgresql.conf\n\n# Install packages for ImageMagick\nRUN yum -y install libjpeg-devel libpng-devel\nRUN yum -y install ImageMagick ImageMagick-devel\nRUN yum clean all\n\n# Install packages for poltergeist\nRUN cd /usr/local/src/ && wget https://phantomjs.googlecode.com/files/phantomjs-1.9.2-linux-x86_64.tar.bz2\nRUN tar jxfv /usr/local/src/phantomjs-1.9.2-linux-x86_64.tar.bz2\nRUN cp phantomjs-1.9.2-linux-x86_64/bin/phantomjs /usr/bin/\n\n\n\u30b5\u30f3\u30d7\u30eb .drone.yml\nbuild:\n  image: kawahiro311/centos6.7-ruby2.3-postgres9.4\n  commands:\n    - service postgresql-9.4 start\n    - export PATH=$PATH:/root/.rbenv/shims\n    - bundle config build.nokogiri --use-system-libraries\n    - bundle config build.pg --with-pg-config=/usr/pgsql-9.4/bin/pg_config\n    - bundle install -j4\n    - RAILS_ENV=test bundle exec rake db:create db:migrate\n    - bundle exec rspec\nnotify:\n  slack:\n    webhook_url: https://hooks.slack.com/services/YOUR WEBHOOK URL\n    channel: YOUR CHANNEL\n    username: drone\n\n\nGitLab&Slack\u9023\u643a\n  \n\n\n\n\u307e\u3068\u3081\ndrone\u3044\u3044\u3063\u3059\u306a\n\u521ddocker&drone\u306a\u306e\u3067\u3001\u3082\u3063\u3068\u826f\u3044\u66f8\u304d\u65b9\u7b49\u3042\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\uff01\n\n\u793e\u5185\u3067drone&docker\u304c\u76db\u308a\u4e0a\u304c\u3063\u3066\u304d\u307e\u3057\u305f\uff01\n\u5f0a\u793e @sadapon2008 \u304cdrone\u74b0\u5883\u3092\u6574\u5099\u3057\u3066\u304f\u308c\u305f\u306e\u3067\u3001Rails\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092CI\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u4eca\u56de\u306f\u65e2\u5b58\u306edocker\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3046\u306e\u3067\u306f\u306a\u304f\u3001docker\u30a4\u30e1\u30fc\u30b8\u30921\u304b\u3089\u3064\u304f\u3063\u3066\u307f\u3066\u307e\u3059\u3002\n\n## docker\u30a4\u30e1\u30fc\u30b8\u5185\u5bb9\n\nCentos6.7+Ruby2.2.3+Postgres9.4\n\nrspec\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u306f\u3082\u3061\u308d\u3093\u3001turnip+capybara+poltergeist\u3067\u306eE2E\u30c6\u30b9\u30c8\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u307e\u3059\u3002\n\n## Dockerfile\n\nhttps://github.com/kawahiro311/drone-rails\n\n```\nFROM centos:6.7\n\n# Install packages for building ruby\nRUN yum -y update\nRUN yum install -y git gcc gcc-c++ make tar wget openssl-devel readline-devel sqlite-devel zlib zlib-devel file\nRUN yum install -y libcurl-devel libyaml-devel libffi-devel bzip2 autoconf automake libtool bison libxml2-devel libxslt-devel\nRUN yum clean all\n\n# Install rbenv and ruby-build\nRUN git clone https://github.com/sstephenson/rbenv.git /root/.rbenv\nRUN git clone https://github.com/sstephenson/ruby-build.git /root/.rbenv/plugins/ruby-build\nRUN ./root/.rbenv/plugins/ruby-build/install.sh\nENV PATH /root/.rbenv/bin:$PATH\nRUN echo 'export PATH=/root/.rbenv/bin:$PATH' >> /root/.bashrc\nRUN echo 'eval \"$(rbenv init -)\"' >> /root/.bashrc\n\n# Install ruby\nENV CONFIGURE_OPTS --disable-install-doc\nRUN rbenv install 2.2.3\nRUN rbenv global 2.2.3\n\n# Install Bundler for ruby\nRUN echo 'gem: --no-rdoc --no-ri' >> /.gemrc\nRUN rbenv exec gem install bundler\n\n# Install node.js\nRUN rpm -ivh http://ftp.iij.ad.jp/pub/linux/fedora/epel/6/x86_64/epel-release-6-8.noarch.rpm\nRUN yum -y install nodejs npm --enablerepo=epel\nRUN yum clean all\nRUN npm install -g bower\n\n# Install postgres\nRUN rpm -ivh http://yum.postgresql.org/9.4/redhat/rhel-6-x86_64/pgdg-centos94-9.4-1.noarch.rpm\nRUN yum -y install postgresql94 postgresql94-devel postgresql94-server\nRUN yum clean all\nRUN ./etc/init.d/postgresql-9.4 initdb -E UNICODE --no-locale\nCOPY pg_hba.conf /var/lib/pgsql/9.4/data/pg_hba.conf\nRUN echo \"listen_addresses = '*'\" >> /var/lib/pgsql/9.4/data/postgresql.conf\n\n# Install packages for ImageMagick\nRUN yum -y install libjpeg-devel libpng-devel\nRUN yum -y install ImageMagick ImageMagick-devel\nRUN yum clean all\n\n# Install packages for poltergeist\nRUN cd /usr/local/src/ && wget https://phantomjs.googlecode.com/files/phantomjs-1.9.2-linux-x86_64.tar.bz2\nRUN tar jxfv /usr/local/src/phantomjs-1.9.2-linux-x86_64.tar.bz2\nRUN cp phantomjs-1.9.2-linux-x86_64/bin/phantomjs /usr/bin/\n```\n\n## \u30b5\u30f3\u30d7\u30eb .drone.yml\n\n```\nbuild:\n  image: kawahiro311/centos6.7-ruby2.3-postgres9.4\n  commands:\n    - service postgresql-9.4 start\n    - export PATH=$PATH:/root/.rbenv/shims\n    - bundle config build.nokogiri --use-system-libraries\n    - bundle config build.pg --with-pg-config=/usr/pgsql-9.4/bin/pg_config\n    - bundle install -j4\n    - RAILS_ENV=test bundle exec rake db:create db:migrate\n    - bundle exec rspec\nnotify:\n  slack:\n    webhook_url: https://hooks.slack.com/services/YOUR WEBHOOK URL\n    channel: YOUR CHANNEL\n    username: drone\n```\n\n## GitLab&Slack\u9023\u643a\n\n:blush: :blush: :blush:\n\n![Slack.png](https://qiita-image-store.s3.amazonaws.com/0/19035/e480efb6-81b0-8353-c6bb-8457970d3098.png)\n\n\n![_WIP__bootstrap\u306e\u30c6\u3099\u30b5\u3099\u30a4\u30f3\u3042\u3066___5____Merge_Requests___mikaidoku___mikaidoku___GitLab.png](https://qiita-image-store.s3.amazonaws.com/0/19035/1e6faad9-151f-9e3b-b9a1-149007bc90b0.png)\n\n## \u307e\u3068\u3081\n\ndrone\u3044\u3044\u3063\u3059\u306a\n\u521ddocker&drone\u306a\u306e\u3067\u3001\u3082\u3063\u3068\u826f\u3044\u66f8\u304d\u65b9\u7b49\u3042\u308c\u3070\u6559\u3048\u3066\u304f\u3060\u3055\u3044\uff01\n", "tags": ["Rails", "drone.io", "docker", "Ruby"]}