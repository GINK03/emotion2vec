{"context": " More than 1 year has passed since last update.@gg_hatano \u3055\u3093\u306e\u3053\u3046\u3044\u3046\u8a71\u304c\u3042\u308b\u3002\n\nSQL\u3067\u7d20\u6570\u5217\u6319\n\n\u3053\u308c\u3092 dplyr \u3067\u3084\u3063\u3066\u307f\u308b\u3002\n\u307e\u305a\u306f DB \u30c6\u30fc\u30d6\u30eb\u306e\u7528\u610f\u3002\n\nR\nlibrary(dplyr)\n\ndf <- data.frame(num=1:100)\nsrcs <- temp_srcs(\"sqlite\")\ntbls <- dplyr:::temp_load(srcs, list(df=df))\ntemp_tbl <- tbls$sqlite$df\n\nprint(temp_tbl)\n\n\n\n\u7d50\u679c\nSource: sqlite 3.8.6\nFrom: tvjegatmvj [100 x 1]\n\n   num\n1    1\n2    2\n3    3\n4    4\n5    5\n6    6\n7    7\n8    8\n9    9\n10  10\n.. ...\n\n\n\u3053\u3046\u3057\u3066\u4f5c\u3089\u308c\u305f\u4e00\u6642\u30c6\u30fc\u30d6\u30eb tvjegatmvj \u304b\u3089\u3001\u7d20\u6570\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u305f\u3044\u3002\n\u6226\u7565\u306f\u5143\u8a18\u4e8b\u3068\u540c\u3058\u306a\u306e\u3067\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\ndplyr \u3067\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u76f4\u63a5\u66f8\u3051\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u307e\u305a\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f5c\u3063\u3066 SQL \u3092\u53d6\u308a\u51fa\u3059\u3002\n\nR\nsubq <- temp_tbl %>% \n  rename(s2.num=num) %>%\n  collapse %>%\n  filter(num >= s2.num * s2.num) %>% \n  filter(s2.num > 1) %>%\n  filter(num %% s2.num == 0) %>%\n  { .$query$sql }\n\nprint(subq)\n\n\n\n\u7d50\u679c\n<SQL> SELECT \"s2.num\"\nFROM (SELECT \"num\" AS \"s2.num\"\nFROM \"tvjegatmvj\") AS \"_W19\"\nWHERE \"num\" >= \"s2.num\" * \"s2.num\" AND \"s2.num\" > 1.0 AND \"num\" % \"s2.num\" = 0.0\n\n\n\u3053\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nR\nq <- temp_tbl %>%\n  filter(num > 1) %>%\n  filter(`not exists`(subq))\n\nprint(q$query)\n\n\n\n\u7d50\u679c\n<Query> SELECT \"num\"\nFROM \"tvjegatmvj\"\nWHERE \"num\" > 1.0 AND NOT EXISTS(SELECT \"s2.num\"\nFROM (SELECT \"num\" AS \"s2.num\"\nFROM \"tvjegatmvj\") AS \"_W25\"\nWHERE \"num\" >= \"s2.num\" * \"s2.num\" AND \"s2.num\" > 1.0 AND \"num\" % \"s2.num\" = 0.0)\n<SQLiteConnection>\n\n\n\u3053\u308c\u3092\u5b9f\u884c\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u3002\n\nR\nprime_nums <- q %>% collect\n\nprint(prime_nums)\n\n\n\n\u7d50\u679c\nSource: local data frame [25 x 1]\n\n   num\n1    2\n2    3\n3    5\n4    7\n5   11\n6   13\n7   17\n8   19\n9   23\n10  29\n.. ...\n\n\n\u7121\u4e8b\u3001\u7d20\u6570\u304c\u53d6\u308a\u51fa\u305b\u305f\u3002\nEnjoy!\n\n\u95a2\u9023\n\ndplyr \u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u6271\u3046\u3068\u304d\u306e\u60c5\u5831\u3092\u305d\u308d\u305d\u308d\u307e\u3068\u3081\u3066\u304a\u304f\n\n@gg_hatano \u3055\u3093\u306e\u3053\u3046\u3044\u3046\u8a71\u304c\u3042\u308b\u3002\n\n- [SQL\u3067\u7d20\u6570\u5217\u6319](http://qiita.com/gg_hatano/items/9127e3a3b2dd25defcb1)\n\n\u3053\u308c\u3092 dplyr \u3067\u3084\u3063\u3066\u307f\u308b\u3002\n\n\u307e\u305a\u306f DB \u30c6\u30fc\u30d6\u30eb\u306e\u7528\u610f\u3002\n\n```r:R\nlibrary(dplyr)\n\ndf <- data.frame(num=1:100)\nsrcs <- temp_srcs(\"sqlite\")\ntbls <- dplyr:::temp_load(srcs, list(df=df))\ntemp_tbl <- tbls$sqlite$df\n\nprint(temp_tbl)\n```\n\n```:\u7d50\u679c\nSource: sqlite 3.8.6\nFrom: tvjegatmvj [100 x 1]\n\n   num\n1    1\n2    2\n3    3\n4    4\n5    5\n6    6\n7    7\n8    8\n9    9\n10  10\n.. ...\n```\n\n\u3053\u3046\u3057\u3066\u4f5c\u3089\u308c\u305f\u4e00\u6642\u30c6\u30fc\u30d6\u30eb `tvjegatmvj` \u304b\u3089\u3001\u7d20\u6570\u3060\u3051\u3092\u53d6\u308a\u51fa\u3057\u305f\u3044\u3002\n\n\u6226\u7565\u306f\u5143\u8a18\u4e8b\u3068\u540c\u3058\u306a\u306e\u3067\u305d\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\ndplyr \u3067\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u76f4\u63a5\u66f8\u3051\u306a\u3044\u3088\u3046\u306a\u306e\u3067\u3001\u307e\u305a\u306f\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f5c\u3063\u3066 SQL \u3092\u53d6\u308a\u51fa\u3059\u3002\n\n```r:R\nsubq <- temp_tbl %>% \n  rename(s2.num=num) %>%\n  collapse %>%\n  filter(num >= s2.num * s2.num) %>% \n  filter(s2.num > 1) %>%\n  filter(num %% s2.num == 0) %>%\n  { .$query$sql }\n\nprint(subq)\n```\n\n```:\u7d50\u679c\n<SQL> SELECT \"s2.num\"\nFROM (SELECT \"num\" AS \"s2.num\"\nFROM \"tvjegatmvj\") AS \"_W19\"\nWHERE \"num\" >= \"s2.num\" * \"s2.num\" AND \"s2.num\" > 1.0 AND \"num\" % \"s2.num\" = 0.0\n```\n\n\u3053\u306e\u30b5\u30d6\u30af\u30a8\u30ea\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```r:R\nq <- temp_tbl %>%\n  filter(num > 1) %>%\n  filter(`not exists`(subq))\n\nprint(q$query)\n```\n\n```:\u7d50\u679c\n<Query> SELECT \"num\"\nFROM \"tvjegatmvj\"\nWHERE \"num\" > 1.0 AND NOT EXISTS(SELECT \"s2.num\"\nFROM (SELECT \"num\" AS \"s2.num\"\nFROM \"tvjegatmvj\") AS \"_W25\"\nWHERE \"num\" >= \"s2.num\" * \"s2.num\" AND \"s2.num\" > 1.0 AND \"num\" % \"s2.num\" = 0.0)\n<SQLiteConnection>\n```\n\n\u3053\u308c\u3092\u5b9f\u884c\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97\u3059\u308b\u3002\n\n```r:R\nprime_nums <- q %>% collect\n\nprint(prime_nums)\n```\n\n```:\u7d50\u679c\nSource: local data frame [25 x 1]\n\n   num\n1    2\n2    3\n3    5\n4    7\n5   11\n6   13\n7   17\n8   19\n9   23\n10  29\n.. ...\n```\n\n\u7121\u4e8b\u3001\u7d20\u6570\u304c\u53d6\u308a\u51fa\u305b\u305f\u3002\n\nEnjoy!\n\n## \u95a2\u9023\n\n- [dplyr \u3067\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u6271\u3046\u3068\u304d\u306e\u60c5\u5831\u3092\u305d\u308d\u305d\u308d\u307e\u3068\u3081\u3066\u304a\u304f](http://qiita.com/hoxo_m/items/341f499eb4117eec41df)\n", "tags": ["R", "SQLite3"]}