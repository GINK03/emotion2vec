{"context": "\n\u52d5\u4f5c\u78ba\u8a8d\nC++ Builder XE4\n\n\n\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u3044\u3002\n\u53c2\u8003 @ \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306f\u9053\u9023\u308c\n\u4e0a\u8a18\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u5b9f\u88c5\u3002\n//---------------------------------------------------------------------------\nbool __fastcall TForm1::CreateShortcutLink(String srcFile, String dstDir, String shortcutBaseName)\n{\n\n    IShellLink *pShellLink = NULL;\n    IPersistFile *pPersistFile = NULL;\n    String shortcutPath;\n\n    if (FileExists(srcFile) == false) {\n        OutputDebugString(L\"27\");\n        return false;\n    }\n\n    CoInitialize(NULL);\n\n    bool res;\n\n    HRESULT hRes = CoCreateInstance( CLSID_ShellLink, NULL, CLSCTX_INPROC_SERVER, IID_IShellLink, (void**)&pShellLink );\n    if (SUCCEEDED(hRes)) {\n        hRes = pShellLink->QueryInterface(IID_IPersistFile, (void**)&pPersistFile);\n\n        pShellLink->SetPath(srcFile.c_str());\n        pShellLink->SetWorkingDirectory(dstDir.c_str());\n\n        if (shortcutBaseName.Length() > 0) {\n            shortcutPath = IncludeTrailingPathDelimiter(dstDir) + shortcutBaseName + L\".lnk\";\n        } else {\n            shortcutPath = IncludeTrailingPathDelimiter(dstDir) + ExtractFileName(srcFile) + L\" - Shortcut.lnk\";\n        }\n\n        if (pPersistFile->Save(shortcutPath.c_str(), /* fRemember=*/false) != S_OK) {\n            OutputDebugString(L\"52\");\n\n            res = false;\n        } else {\n            res = true;\n        }\n    }\n\n    pPersistFile->Release();\n    pShellLink->Release();\n    CoUninitialize();\n\n    return res;\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n    String srcFile = L\"D:\\\\WORK\\\\151026_shortcut\\\\dat.txt\";\n    String dstDir = L\"D:\\\\WORK\\\\151026_shortcut\";\n    String shortcutName = L\"\";\n\n    CreateShortcutLink(srcFile, dstDir, shortcutName);\n}\n//---------------------------------------------------------------------------\n\ndat.txt - Shortcut\u3068\u3044\u3046\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u304c\u4f5c\u6210\u3067\u304d\u308b\u3002\n```txt:\u52d5\u4f5c\u78ba\u8a8d\nC++ Builder XE4\n```\n\n\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u305f\u3044\u3002\n\n[\u53c2\u8003 @ \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306f\u9053\u9023\u308c](http://park6.wakwak.com/~wmasa/prog/srclib/0008.htm)\n\n\u4e0a\u8a18\u3092\u53c2\u8003\u306b\u4ee5\u4e0b\u306e\u5b9f\u88c5\u3002\n\n```cpp\n//---------------------------------------------------------------------------\nbool __fastcall TForm1::CreateShortcutLink(String srcFile, String dstDir, String shortcutBaseName)\n{\n\n\tIShellLink *pShellLink = NULL;\n\tIPersistFile *pPersistFile = NULL;\n\tString shortcutPath;\n\n\tif (FileExists(srcFile) == false) {\n\t\tOutputDebugString(L\"27\");\n\t\treturn false;\n\t}\n\n\tCoInitialize(NULL);\n\n\tbool res;\n\n\tHRESULT hRes = CoCreateInstance( CLSID_ShellLink, NULL, CLSCTX_INPROC_SERVER, IID_IShellLink, (void**)&pShellLink );\n\tif (SUCCEEDED(hRes)) {\n\t\thRes = pShellLink->QueryInterface(IID_IPersistFile, (void**)&pPersistFile);\n\n\t\tpShellLink->SetPath(srcFile.c_str());\n\t\tpShellLink->SetWorkingDirectory(dstDir.c_str());\n\n\t\tif (shortcutBaseName.Length() > 0) {\n\t\t\tshortcutPath = IncludeTrailingPathDelimiter(dstDir) + shortcutBaseName + L\".lnk\";\n\t\t} else {\n\t\t\tshortcutPath = IncludeTrailingPathDelimiter(dstDir) + ExtractFileName(srcFile) + L\" - Shortcut.lnk\";\n\t\t}\n\n\t\tif (pPersistFile->Save(shortcutPath.c_str(), /* fRemember=*/false) != S_OK) {\n\t\t\tOutputDebugString(L\"52\");\n\n\t\t\tres = false;\n\t\t} else {\n\t\t\tres = true;\n\t\t}\n\t}\n\n\tpPersistFile->Release();\n\tpShellLink->Release();\n\tCoUninitialize();\n\n\treturn res;\n}\n//---------------------------------------------------------------------------\nvoid __fastcall TForm1::Button1Click(TObject *Sender)\n{\n\tString srcFile = L\"D:\\\\WORK\\\\151026_shortcut\\\\dat.txt\";\n\tString dstDir = L\"D:\\\\WORK\\\\151026_shortcut\";\n\tString shortcutName = L\"\";\n\n\tCreateShortcutLink(srcFile, dstDir, shortcutName);\n}\n//---------------------------------------------------------------------------\n```\n\n`dat.txt - Shortcut`\u3068\u3044\u3046\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u304c\u4f5c\u6210\u3067\u304d\u308b\u3002\n\n", "tags": ["cppBuilder", "fileIO"]}