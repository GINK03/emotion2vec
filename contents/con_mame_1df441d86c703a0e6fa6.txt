{"context": " More than 1 year has passed since last update.\n\nAmazon EC2 Container Service\n\u5185\u5bb9\u306f\u3042\u304f\u307e\u3067\u73fe\u5728\u306ePreview\u3092\u5143\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4eca\u5f8c\u3082\u4ed5\u69d8\u306a\u3069\u304c\u5909\u66f4\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u5927\u304d\u304f\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3054\u5229\u7528\u306e\u969b\u306f\u5fc5\u305a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nECS\u306fDocker\u30d9\u30fc\u30b9\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d3\u30eb\u30c9\u3001\u5b9f\u884c\u3068\u305d\u3057\u3066\u30b9\u30b1\u30fc\u30eb\u3092\u52a9\u3051\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\u5229\u70b9\u3068\u3057\u3066\u3001\u3088\u308a\u7c21\u5358\u306a\u30af\u30e9\u30b9\u30bf\u30fc\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u3001\u30cf\u30a4\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3001\u67d4\u8edf\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3001\u62e1\u5f35\u6027\u3001\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u3001\u305d\u3057\u3066AWS\u306e\u4ed6\u30b5\u30fc\u30d3\u30b9\u3084\u6a5f\u80fd\u3068\u306e\u7d71\u5408\u304c\u3042\u308a\u307e\u3059\u3002ECS\u306f\u8ad6\u7406\u7684\u306aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u5185\u304b\u3089\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u51fa\u6765\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u5236\u5fa1\u3092\u884c\u3044\u307e\u3059\u3002ECS\u306fDocker\u30d9\u30fc\u30b9\u306e\u305f\u3081\u65e2\u5b58\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u53ef\u80fd\u3067\u3001Docker Hub\u3084\u4efb\u610f\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001ECS\u3067\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306fAWS\u306e\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u540c\u69d8\u306bVPC\u5185\u3067\u8d77\u52d5\u53ef\u80fd\u306a\u306e\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u3092\u5b89\u5168\u306b\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002ECS\u3067\u306f1 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3067\u30b7\u30a7\u30a2\u51fa\u6765\u308b\u305f\u3081\u52b9\u7387\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\nDocker\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f7f\u7528\u4e2d\u30fb\u6b8b\u308aCPU/\u30e1\u30e2\u30ea\u3084\u30dd\u30fc\u30c8\u756a\u53f7\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u306fECS\u304c\u884c\u3046\u305f\u3081\u3001\u3069\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u6b8b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u30e6\u30fc\u30b6\u304c\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u30ea\u30bd\u30fc\u30b9\u304c\u4e0d\u8db3\u3057\u305f\u5834\u5408\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30fc\u30eb\u306b\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u81ea\u52d5\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\nDocker\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u524d\u3067EC2\u4e0a\u3067\u8d77\u52d5\u3057\u3001\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u5404EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u73fe\u5728\u4f7f\u3048\u308bCPU\u3084\u30e1\u30e2\u30ea\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u3068\u3044\u3063\u305f\u30cf\u30fc\u30c9\u30a6\u30a8\u30a2\u30ea\u30bd\u30fc\u30b9\u306e\u7a7a\u304d\u72b6\u6cc1\u3084Docker\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u3001\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306a\u3069\u3001Docker\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u4f5c\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306a\u3069\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002ECS\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u308c\u3089\u306e\u30cf\u30fc\u30c9\u30a6\u30a8\u30a2\u30ea\u30bd\u30fc\u30b9\u3084\u8a2d\u5b9a\u60c5\u5831\u306e\u7ba1\u7406\u3092ECS\u306b\u4efb\u305b\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u306e\u4ed6\u306e\u7279\u5fb4\u3068\u3057\u3066\u3001\u65e2\u5b58\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u53ef\u80fd\u306a\u305f\u3081\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3068\u30af\u30e9\u30a6\u30c9\u306e\u9593\u3067\u30b7\u30fc\u30e0\u30ec\u30b9\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002ECS\u7279\u6709\u306e\u6a5f\u80fd\u3068\u3057\u3066AWS\u306e\u30b5\u30fc\u30d3\u30b9\u3084\u6a5f\u80fd\u3068\u306e\u9023\u643a\u304c\u884c\u3044\u6613\u304fECS API\u3092\u4f7f\u7528\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30de\u30d6\u30eb\u306bECS\u74b0\u5883\u3092\u6271\u3046\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u7528\u8a9e\u306e\u89e3\u8aac\n\nTask Definition: Task Definition\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u96c6\u5408\u306e\u5b9a\u7fa9\u30021\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u3092\u5b9a\u7fa9\u3057\u3001CPU\u3084\u30e1\u30e2\u30ea\u5272\u5f53\u3084Container\u9593\u306eLink\u306a\u3069\u3092\u8a2d\u5b9a\u3059\u308b\u30021\u3064\u306eTask Definition\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u540c\u4e00\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u7a3c\u50cd\u3059\u308b\nTask - Task Definition\u306e\u5b9f\u4f53\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9: ECS\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3001\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3002\u30af\u30e9\u30b9\u30bf\u5185\u3067\u52d5\u3044\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96c6\u5408\u306fTask\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u6271\u308f\u308c\u308b\u3002Multi-AZ\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u8907\u6570\u306e\u30a2\u30d9\u30a4\u30e9\u30d3\u30ea\u30c6\u30a3\u30be\u30fc\u30f3\u306bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u969c\u5bb3\u8010\u6027\u3092\u9ad8\u3081\u308b\u3053\u3068\u3082\u53ef\u80fd\nCluster: Task\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ad6\u7406\u7684\u306a\u30b0\u30eb\u30fc\u30d7\nContainer: Task\u306b\u3088\u308a\u751f\u6210\u3055\u308c\u305fDocker\u30b3\u30f3\u30c6\u30ca\n\n\nECS Container Agent\nECS Container Agent\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u52d5\u304f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u3059\u3002\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u901a\u3057\u3066Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067\u7a3c\u50cd\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3084\u505c\u6b62\u306a\u3069\u306e\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\u4ed6\u306e\u6a5f\u80fd\u3068\u3057\u3066\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u8d77\u52d5\u3057\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3001\u3069\u306eECS Cluster\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\u304b\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eCPU\u3084\u30e1\u30e2\u30ea\u306e\u60c5\u5831\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u72b6\u6cc1\u306a\u3069\u3082ECS\u306e\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u3078\u901a\u77e5\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002ECS Container Agent\u304cECS API\u7d4c\u7531\u3067\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u969b\u306b\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308bIAM Role(\u8a8d\u8a3c\u60c5\u5831)\u3092\u4f7f\u7528\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3092\u884c\u3046\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u306b\u8a8d\u8a3c\u60c5\u5831\u3092\u6e21\u3059\u5fc5\u8981\u304c\u7121\u304f\u3001ECS API\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3082Agent\u304b\u3089\u884c\u3046\u305f\u3081\u30dd\u30fc\u30c8\u3092EXPOSE\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\u5b9f\u306f\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u81ea\u8eab\u3082Docker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001Docker Hub\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306a\u3069\u306fgithub\u306b\u3066Apache 2.0\u30e9\u30a4\u30bb\u30f3\u30b9\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u662f\u975e\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\n\nECS\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\n\u305d\u308c\u3067\u306f\u65e9\u901fECS\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u73fe\u5728\u306e\u3068\u3053\u308dPreview\u7248\u306eECS\u3067\u306fAWS Management Console\u306f\u7528\u610f\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\nECS\u306fLinux AMI(\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8)\u306bECS Container Agent\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u5229\u7528\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u304c\u3001AWS\u3067\u306f\u73fe\u5728Amazon Linux\u3092\u30d9\u30fc\u30b9\u3068\u3057\u305fECS\u306b\u6700\u9069\u5316\u3055\u308c\u305f\u8efd\u91cf\u306aAMI\u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eAMI\u306b\u306f\u65e2\u306bECS Container Agent\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3059\u3050\u306bECS\u3092\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4ed6\u306b\u3082\u3001CoreOS\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u516c\u5f0f\u30b5\u30a4\u30c8\u306b\u63b2\u8f09\u3055\u308c\u3066\u3044\u308bcloud-init\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u7c21\u5358\u306bECS Container Agent\u3092\u5c0e\u5165\u53ef\u80fd\u3067\u3059\u3002\n\nECS\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u4eca\u56de\u306fAWS\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u3001ECS\u7528\u306eAMI\u3092\u5229\u7528\u3057\u3066ECS\u304c\u3069\u306e\u3088\u3046\u306a\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u304b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nCLI\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nECS\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u3001AWS CLI\u30c4\u30fc\u30eb\u3092\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305f\u3001CLI\u64cd\u4f5c\u7528\u306bIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002IAM\u30e6\u30fc\u30b6\u306bECS\u306e\u64cd\u4f5c\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u6bce\u306bAWS\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u7d30\u304b\u304f\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002IAM\u30e6\u30fc\u30b6\u4f5c\u6210\u306e\u8a73\u7d30\u306f\u3053\u3061\u3089\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002ECS\u3067\u306f\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u30fbTask\u306e\u767b\u9332\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u30fb\u505c\u6b62\u306a\u3069\u7d30\u304b\u304f\u6a29\u9650\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3001\u7279\u5b9a\u306eIAM\u30e6\u30fc\u30b6\u306b\u7279\u5b9a\u306e\u30af\u30e9\u30b9\u30bf\u306e\u64cd\u4f5c\u3084\u7279\u5b9a\u30bf\u30b9\u30af\u306e\u64cd\u4f5c\u306e\u307f\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u7d30\u304b\u304f\u6a29\u9650\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u3067\u6a29\u9650\u304c\u5206\u96e2\u3067\u304dECS\u306e\u904b\u7528\u3092\u5b89\u5168\u306b\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u8a73\u7d30\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306f\u3001IAM\u30e6\u30fc\u30b6\u306fCLI\u64cd\u4f5c\u306b\u5229\u7528\u3057\u3066\u3001IAM Role\u306fECS Container Agent\u304c\u4f7f\u7528\u3057\u307e\u3059\u3002\n$ pip install awscli\n\n\u3067\u884c\u3048\u307e\u3059\u3002 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306f\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081 aws configure\u3092\u5b9f\u884c\u3057\u3001IAM\u30e6\u30fc\u30b6\u306e\u60c5\u5831\u3092\u767b\u9332\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Default Region\u3092Virginia\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305f\u3001--profile\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001ECS Preview\u7528\u306eProfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002--profile\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u4e00\u6642\u7684\u306bdefault\u306eProfile\u3068Profile\u60c5\u5831\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n$ aws configure --profile ecs-preview\nAWS Access Key ID []:****************\nAWS Secret Access Key []:****************\nDefault region name []:us-east-1\nDefault output format []:\n\n\u65e2\u306b\u3001awscli\u3092\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f--region\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u4e00\u6642\u7684\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002Virginia\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001--region us-east-1\u3068\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ aws ecs aws ecs list-container-instances --cluster default --region us-east-1 --profile ecs-preview\n\n\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\u672c\u7ae0\u3067\u306fECS Cluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u304b\u3089\u8a2d\u5b9a\u307e\u3067\u3092\u884c\u3044\u307e\u3059\u3002ECS Cluster\u306b\u6240\u5c5e\u3055\u305b\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u3092\u884c\u3046\u524d\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u306eECS Container Agent\u304cECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u6a29\u9650(IAM Role)\u4ed8\u4e0e\u3084Security Group(\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb)\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\u4e8b\u524d\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089Cluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002AWS\u304c\u7528\u610f\u3057\u3066\u3044\u308b2015\u5e744\u6708\u73fe\u5728\u6700\u65b0\u306e preview\u7528AMI \u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001Management Console \u2192 EC2 \u2192 Launch Instance \u2192 Community AMIs\u304b\u3089\u300cami-801544e8\u300d\u3067\u691c\u7d22\u3057\u3066\u30d2\u30c3\u30c8\u3057\u305f\u3082\u306e\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3061\u3089\u306fVirginia\u30ea\u30fc\u30b8\u30e7\u30f3\u306eAMI\u3067\u3059\u306e\u3067\u3001Oregon\u306f\u300cami-801544e8\u300d\u3001Ireland\u306f\u300cami-519a0a26\u300d\u3092\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002\n\u3053\u3061\u3089\u306eAMI\u306fpreview\u7528\u3067\u3059\u306e\u3067\u3001\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u6642\u306f\u30ea\u30ea\u30fc\u30b9\u6642\u306e\u6848\u5185\u306b\u3057\u305f\u304c\u3063\u3066\u9069\u5207\u306aAMI\u3092\u3054\u5229\u7528\u4e0b\u3055\u3044\n\n\u4f7f\u7528\u3059\u308bAMI\u3092\u9078\u629e\u5f8c\u3001\u4f7f\u7528\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u3067\u6307\u5b9a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5404Docker\u30b3\u30f3\u30c6\u30ca\u3067\u30b7\u30a7\u30a2\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\u5f8c\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u4f7f\u7528\u3067\u304d\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5229\u7528\u72b6\u6cc1\u3092\u898b\u306a\u304c\u3089\u6700\u521d\u306f\u5c0f\u3055\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3092\u4f7f\u7528\u3057\u3001\u7528\u9014\u304c\u5897\u3048\u3066\u304d\u305f\u6bb5\u968e\u3067\u30b9\u30da\u30c3\u30af\u306e\u9ad8\u3044EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3055\u305b\u308b\u3053\u3068\u3067\u30b3\u30b9\u30c8\u3092\u6291\u3048\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\nECS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Cluster\u306b\u53c2\u52a0\u3055\u305b\u308b\nECS\u306fCluster\u3068\u3044\u3046\u5358\u4f4d\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u3069\u306eECS Cluster\u306b\u53c2\u52a0\u3055\u305b\u308b\u304b\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306fdefault Cluster\u306b\u6240\u5c5e\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u30af\u30e9\u30b9\u30bf\u540d\u3092\u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6642\u306e\u8a2d\u5b9a\u3067Advanced Details\u5185\u306eUser Data\u306b\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n#!/bin/bash\necho ECS_CLUSTER=\u30af\u30e9\u30b9\u30bf\u540d >> /etc/ecs/ecs.config\n\n\nECS\u3067\u306f\u3001ECS_CLUSTER\u306b\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u540d\u304c\u540c\u4e00\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30921\u3064\u306eECS\u30af\u30e9\u30b9\u30bf\u3068\u3057\u3066\u6271\u3044\u3001\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCPU\u3084\u30e1\u30e2\u30ea\u306a\u3069\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30bd\u30fc\u30b9\u3092\u5404\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u306e\u78ba\u8a8d\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3059\u308b\u3068\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3057\u305f(\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070default)\u30af\u30e9\u30b9\u30bf\u306b\u81ea\u52d5\u3067\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n$ aws ecs list-container-instances --cluster \u30af\u30e9\u30b9\u30bf\u540d --profile ecs-preview\n\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n{\n  \"containerInstanceArns\": [\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/29f000f6-73ed-4b2f-9a79-4fc7209d6730\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/d79fbdc9-7099-4c5c-863f-62ebea76cdba\"\n  ]\n}\n\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\u5b9f\u884c\u7d50\u679c\u4e2d\u306earn\u306fAmazon Resource Name\u306e\u7565\u79f0\u3067\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3084Task\u306a\u3069\u306eAWS\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4e00\u610f\u306b\u8b58\u5225\u3059\u308b\u305f\u3081\u306eID\u3067\u3059\u3002\n\u5404\u30af\u30e9\u30b9\u30bf\u306e\u8a73\u7d30\u60c5\u5831\u306f\n$ aws ecs describe-container-instances --cluster default --container-instances 29f000f6-73ed-4b2f-9a79-4fc7209d6730 d79fbdc9-7099-4c5c-863f-62ebea76cdba --profile ecs-preview\n\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\n{\n  \"failures\": [],\n  \"containerInstances\": [\n    {\n      \"status\": \"ACTIVE\",\n      \"registeredResources\": [\n       {\n          \"integerValue\": 1024,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"CPU\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"integerValue\": 2004,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"MEMORY\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"name\": \"PORTS\",\n          \"longValue\": 0,\n          \"doubleValue\": 0.0,\n          \"stringSetValue\": [\n            \"2376\",\n            \"22\",\n            \"51678\",\n            \"2375\"\n          ],\n          \"type\": \"STRINGSET\",\n          \"integerValue\": 0\n       }\n  ],\n  \"ec2InstanceId\": \"i-a9b8f552\",\n  \"agentConnected\": true,\n  \"containerInstanceArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/29f000f6-73ed-4b2f-9a79-4fc7209d6730\",\n      \"remainingResources\": [\n       {\n          \"integerValue\": 1024,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"CPU\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"integerValue\": 2004,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"MEMORY\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"name\": \"PORTS\",\n          \"longValue\": 0,\n          \"doubleValue\": 0.0,\n          \"stringSetValue\": [\n            \"2376\",\n            \"22\",\n            \"51678\",\n            \"2375\"\n          ],\n          \"type\": \"STRINGSET\",\n          \"integerValue\": 0\n       }\n  ],\n\u301c\u301c\u301c\u301c\u301c \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u5206 \u301c\u301c\u301c\u301c\u301c\n\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\n\n\n\nValue\n\u8aac\u660e\n\n\n\n\nstatus\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\n\n\nagentConnected\nECS Container Agent\u304cECS API\u3068\u901a\u4fe1\u51fa\u6765\u3066\u3044\u308b\u304b\u3002true\u306b\u306a\u3063\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u307f\u4f7f\u7528\u53ef\u80fd\n\n\nregisteredResources\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4f7f\u7528\u3067\u304d\u308b\u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8)\n\n\nremainingResources\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4f7f\u7528\u3067\u304d\u308b\u5168\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8)\n\n\nec2InstanceId\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\n\n\ncontainerInstanceArn\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u610f\u306b\u8868\u3059AWS\u306e\u30ea\u30bd\u30fc\u30b9ID\n\n\n\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\ndescribe-container-instances API\u3092\u4f7f\u7528\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\u5404Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6240\u6301\u3057\u3066\u3044\u308b\u3001CPU Unit\u30fb\u30e1\u30e2\u30ea\u30fc\u30fb\u30dd\u30fc\u30c8\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3068\u73fe\u5728\u6b8b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3001Instance ID\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u3060\u4f55\u3082\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u6240\u6301\u30ea\u30bd\u30fc\u30b9\u3068\u6b8b\u308a\u30ea\u30bd\u30fc\u30b9\u304c\u540c\u4e00\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002Instance ID: i-a9b8f552\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fCPU\u304c1 Core\u306a\u306e\u3067CPU Unit\u304c1024\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001ECS Container Agent\u306emetadata API\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6240\u5c5e\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u30bf\u3084ContainerInstanceArn\u3092\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n$ curl http://localhost:51678/v1/metadata\n\n{\n  \"ClusterArn\":\"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/default\",\n  \"ContainerInstanceArn\":\"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/db2cc682-a63c-47b7-9d66-fd9269fc8f56\"\n}\n\nECS Container Agent metadata\u53d6\u5f97\n\nECS\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n\nTask\u306e\u8a18\u8ff0\nTask\u306fJson\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3001\u5404Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCPU\u3084\u30e1\u30e2\u30ea\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u3084\u74b0\u5883\u5909\u6570\u3001Dokcer\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u306a\u3069\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001Task\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u5272\u308a\u5f53\u3066\u3060\u3051\u3067\u306f\u306a\u304f\u3001Task\u5185\u3067\u5b9f\u969b\u306b\u8d77\u52d5\u3059\u308bDocker\u30b3\u30f3\u30c6\u30ca\u3092\u6307\u5b9a\u3057\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u304c\u5168\u3066\u63d0\u4f9b\u53ef\u80fd\u306aCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092ECS\u304c\u81ea\u52d5\u7684\u306b\u9078\u629e\u3057\u3001\u305d\u306eCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u3084Docker\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u30fb\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306a\u3069\u3082\u884c\u308f\u308c\u307e\u3059\u3002\n\n\n\nValue\nType\n\u8aac\u660e\n\n\n\n\nname\nstring\n\u30b3\u30f3\u30c6\u30ca\u3092\u8b58\u5225\u3059\u308b\u540d\u524d\u3002\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092\u63a5\u7d9a\u3059\u308blink\u6a5f\u80fd\u3067\u6307\u5b9a\u3055\u308c\u308b\n\n\nimage\nstring\nDocker\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\u3002\u6a19\u6e96\u3067\u306fDocker Hub\u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001repository-url/image:tag\u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u4f7f\u7528\u53ef\u80fd\n\n\ncpu\ninteger\n\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u308bCPU Unit\u3092\u6307\u5b9a\u3002\u5404EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f1\u30b3\u30a2\u5f53\u305f\u308a1024 CPU Units\u3092\u6301\u3063\u3066\u3044\u308b\n\n\nmemory\ninteger\n\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u308b\u30e1\u30e2\u30ea\u3092MiB\u5358\u4f4d\u3067\u6307\u5b9a\u3002Docker\u306f\u6700\u4f4e4MiB\u3092\u5272\u5f53\u3066\u308b\n\n\nlinks\nstring array\nlinks\u3067\u6307\u5b9a\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092\u63a5\u7d9a\u3002links\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u306a\u3069\u306e\u8a2d\u5b9a\u304c\u4e0d\u8981\u3002\u8a73\u7d30: https://docs.docker.com/userguide/dockerlinks/\n\n\n\nportMappings\nobject array\nEXPOSE\u3059\u308b\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3002\n\n\nessential\nboolean\ntrue\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3059\u308b\u3068Task\u304c\u5931\u6557\u3059\u308b\u304c\u3001false\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3057\u3066\u3082Task\u306e\u51e6\u7406\u3092\u7d99\u7d9a\u30021\u3064\u306eTask Definishon\u306b\u306f\u6700\u4f4e\u3067\u30821\u3064essential\u304ctrue\u306a\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981\n\n\nentryPoint\nstring\nENTRYPOINT\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u8a73\u7d30: https://docs.docker.com/reference/builder/#entrypoint\n\n\n\ncommand\nstring\nCMD\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u8a73\u7d30: https://docs.docker.com/reference/builder/#cmd\n\n\n\nenvironment\nobject array\n\u74b0\u5883\u5909\u6570\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u5f62\u5f0f\u306f\u3001{ \"name\" : \"\u74b0\u5883\u5909\u6570\", \"value\" : \"\u5024\" }\n\n\n\nTask\u3067\u6307\u5b9a\u3067\u304d\u308b\u9805\u76ee\nlinks\u3067\u6307\u5b9a\u3067\u304d\u308b\u30b3\u30f3\u30c6\u30ca\u306f\u73fe\u5728\u3001\u540c\u4e00\u306eTask Definishon\u5185\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u540c\u4e00\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067\u7a3c\u50cd\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u3068\u3044\u3046\u5236\u7d04\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u4f7f\u7528\u3059\u308bTask Definition\n\u4eca\u56de\u306fWordPress\u3068MySQL\u3092\u5225\u3005\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u8d77\u52d5\u3057\u3001Links\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u30662\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u63a5\u7d9a\u3059\u308bTask\u3092\u4f5c\u6210\u3057ECS\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\nWordPress\u3068MySQL\u306eimage\u306f\u516c\u5f0f\u30ec\u30dd\u30b8\u30c8\u30ea\u306e https://registry.hub.docker.com/_/wordpress/ https://registry.hub.docker.com/_/mysql/ \u3092\u305d\u308c\u305e\u308c\u4f7f\u7528\u3057\u307e\u3059\u3002\n[\n  {\n    \"environment\": [\n      { \"name\" : \"WORDPRESS_DB_USER\", \"value\" : \"wpuser\" },\n      { \"name\" : \"WORDPRESS_DB_PASSWORD\", \"value\" : \"wppass\" },\n      { \"name\" : \"WORDPRESS_DB_NAME\", \"value\" : \"wpdb\" }\n    ],\n    \"name\": \"wp\",\n    \"image\": \"wordpress:latest\",\n    \"cpu\": 100,\n    \"portMappings\": [\n      {\n        \"containerPort\": 80,\n        \"hostPort\": 80\n      }\n    ],\n    \"links\": [\"mysql:mysql\"],\n    \"memory\": 1024,\n    \"essential\": false\n  },\n  {\n    \"environment\": [\n      { \"name\" : \"MYSQL_ROOT_PASSWORD\", \"value\" : \"rootwppass\" },\n      { \"name\" : \"MYSQL_USER\", \"value\" : \"wpuser\" },\n      { \"name\" : \"MYSQL_PASSWORD\", \"value\" : \"wppass\" },\n      { \"name\" : \"MYSQL_DATABASE\", \"value\" : \"wpdb\" }\n    ],\n    \"name\": \"mysql\",\n    \"image\": \"mysql\",\n    \"cpu\": 200,\n    \"memory\": 2048,\n    \"essential\": true\n  }\n]\n\n\u3053\u306eTask\u3067\u306f\u3001WordPress\u306e\u30b3\u30f3\u30c6\u30ca\u3092wp\u3068\u3044\u3046\u540d\u524d\u3067CPU 100Units\u3001Memory 1024MiB\u3092\u5272\u5f53\u3001links\u3067mysql\u3068name\u5c5e\u6027\u3067\u6307\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306bLink\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001essential\u304cfalse\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001WordPress\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u304c\u5931\u6557\u3057\u3066\u3082Task\u306f\u5931\u6557\u305b\u305a\u7d99\u7d9a\u3057\u3066\u52d5\u4f5c\u3057\u307e\u3059\u3002MySQL\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u3001CPU 200Units\u3001Memory 2048MiB\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u306f\u3001essential\u3092true\u306b\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u304c\u5931\u6557\u3059\u308b\u3068Task\u5168\u4f53\u304c\u5931\u6557\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u30b3\u30f3\u30c6\u30ca\u3067enviroment\u306b\u3088\u308a\u74b0\u5883\u3092\u6e21\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30e6\u30fc\u30b6\u3084\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\nTask\u306e\u767b\u9332\nTask Definishon\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001ECS\u306bTask\u306e\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002Task Definishon\u304b\u3089Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u306f\u3001ECS\u306b\u767b\u9332\u3057\u305fTask\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u306e\u5148\u306e\u4f8b\u3067\u306f\u3001\u5148\u307b\u3069\u306eTask\u3092wordpress.json\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066ECS\u3078\u767b\u9332\u3057\u307e\u3059\u3002\n$ aws ecs register-task-definition --family wordpress --container-definitions file://./wordpress.json --profile ecs-preview\n\n{\n  \"taskDefinition\": {\n    \"taskDefinitionArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n    \"containerDefinitions\": [\n      {\n        \"environment\": [\n          {\n            \"name\": \"WORDPRESS_DB_USER\",\n            \"value\": \"wpuser\"\n          },\n          {\n            \"name\": \"WORDPRESS_DB_PASSWORD\",\n            \"value\": \"wppass\"\n          },\n          {\n            \"name\": \"WORDPRESS_DB_NAME\",\n            \"value\": \"wpdb\"\n           }\n       ],\n       \"name\": \"wp\",\n       \"links\": [\n         \"mysql:mysql\"\n       ],\n       \"image\": \"wordpress:latest\",\n       \"essential\": false,\n       \"portMappings\": [\n         {\n           \"containerPort\": 80,\n           \"hostPort\": 80\n         }\n       ],\n       \"memory\": 1024,\n       \"cpu\": 100\n     },\n     {\n       \"environment\": [\n         {\n           \"name\": \"MYSQL_DATABASE\",\n           \"value\": \"wpdb\"\n         },\n         {\n           \"name\": \"MYSQL_PASSWORD\",\n           \"value\": \"wppass\"\n          },\n          {\n            \"name\": \"MYSQL_USER\",\n            \"value\": \"wpuser\"\n          },\n          {\n            \"name\": \"MYSQL_ROOT_PASSWORD\",\n            \"value\": \"rootwppass\"\n          }\n        ],\n        \"name\": \"mysql\",\n        \"image\": \"mysql\",\n        \"cpu\": 200,\n        \"portMappings\": [],\n        \"memory\": 2048,\n        \"essential\": true\n        }\n   ],\n   \"family\": \"wordpress\",\n   \"revision\": 1\n   }\n }\n\ncontainer-definitions\u306b\u306fJSON\u3092\u305d\u306e\u307e\u307e\u6e21\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\u30b3\u30de\u30f3\u30c9\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308bfamily\u306fTask\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3001Task Definition\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3057\u3001\u540c\u4e00\u306efamily\u3067Task\u3092\u767b\u9332\u3059\u308b\u3068revision\u304c\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002Task\u306fwordpress:1\u3084wordpress:2\u306e\u3088\u3046\u306bTask\u540d\u3068revision\u306e\u7d44\u307f\u5408\u308f\u305b\u3067ECS\u5185\u3067\u8b58\u5225\u3055\u308c\u308b\u305f\u3081\u3001\u8d77\u52d5\u6642\u306brevision\u3092\u6307\u5b9a\u3057\u3001CPU\u3084\u30e1\u30e2\u30ea\u306e\u5272\u5f53\u3092\u5909\u3048\u305fTask\u3092\u8907\u6570\u7528\u610f\u3057\u3066\u7528\u9014\u306b\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u307e\u305f\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\u3082\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n$ aws ecs list-task-definitions\u3000--profile ecs-preview\n\n\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\n{\n  \"taskDefinitionArns\": [\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:2\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/redis:1\",\n    ......\n  ]\n}\n\n\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\n\nTask\u306e\u5b9f\u884c\n\u3067\u306f\u5b9f\u969b\u306b\u5148\u307b\u3069\u767b\u9332\u3057\u305fTask\u3092\u5b9f\u884c\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nECS\u3067\u306f\u3001Task\u306e\u5b9f\u884c\u65b9\u6cd5\u304c\u73fe\u57282\u7a2e\u985e\u5b58\u5728\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30b9\u30bf\u5185\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30e9\u30f3\u30c0\u30e0 (run-task\u30b3\u30de\u30f3\u30c9)\nTask\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3057\u305f\u7279\u5b9a\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528 (start-task\u30b3\u30de\u30f3\u30c9)\n\nstart-task\u30b3\u30de\u30f3\u30c9\u306f\u72ec\u81ea\u306eECS\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u3088\u308aContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ca0\u8377\u72b6\u6cc1\u3084Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306b\u3088\u308a\u7279\u5b9a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001ECS\u3068\u306e\u9023\u643a\u90e8\u5206\u3092\u72ec\u81ea\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8ca0\u8377\u72b6\u6cc1\u306b\u5f71\u97ff\u3092\u53d7\u3051\u306b\u304f\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u306frun-task\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30ea\u30bd\u30fc\u30b9\u306e\u7a7a\u3044\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u7684\u306bECS\u304c\u30af\u30e9\u30b9\u30bf\u5185\u304b\u3089\u63a2\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u304c\u697d\u306b\u306a\u308a\u307e\u3059\u3002\n$ aws ecs run-task --cluster \u30af\u30e9\u30b9\u30bf\u540d --task-definition wordpress:1 --count 1\u3000--profile ecs-preview\n\n{\n  \"failures\": [],\n  \"tasks\": [\n    {\n     \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n     \"overrides\": {\n       \"containerOverrides\": [\n         {\n           \"name\": \"wp\"\n         },\n         {\n            \"name\": \"mysql\"\n         }\n       ]\n     },\n     \"lastStatus\": \"PENDING\",\n     \"containerInstanceArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/d79fbdc9-7099-4c5c-863f-62ebea76cdba\",\n     \"desiredStatus\": \"RUNNING\",\n     \"taskDefinitionArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n     \"containers\": [\n       {\n         \"containerArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container/fbb9f38f-45b5-460b-921d-459f3fd05c31\",\n         \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n          \"lastStatus\": \"PENDING\",\n          \"name\": \"wp\"\n       },\n       {\n          \"containerArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container/7d7a9f81-9201-49b5-8379-6bba6ce905ae\",\n          \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n          \"lastStatus\": \"PENDING\",\n          \"name\": \"mysql\"\n         }\n       ]\n     }\n  ]\n}\n\n$ aws ecs start-task --cluster \u30af\u30e9\u30b9\u30bf\u540d --task-definition wordpress:1 --container-instances\u300029f000f6-73ed-4b2f-9a79-4fc7209d6730 d79fbdc9-7099-4c5c-863f-62ebea76cdba --profile ecs-preview\n\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u76f4\u5f8c\u306f\"desiredStatus\": \"RUNNING\"\u30fb\"lastStatus\": \"PENDING\"\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304b\u3089\u8d77\u52d5\u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002describe-tasks\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u73fe\u5728\u306e\u8d77\u52d5\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059(\u30b3\u30de\u30f3\u30c97)\u3002\"lastStatus\": \"RUNNING\"\u306b\u5909\u308f\u3063\u3066\u3044\u308b\u3068Task\u306e\u8d77\u52d5\u304c\u6210\u529f\u3057\u3066\u3044\u307e\u3059\u3002\n(--tasks\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u3066\u3044\u308bID\u306f\u4eca\u56de\u306e\u5834\u5408\u306e\u4f8b\u3067\u3059)\n$ aws ecs describe-tasks --cluster default --tasks 3f638959-cea0-402a-a1f6-017d3bd324fb --profile ecs-preview\n\nWordPress\u30fbMySQL\u306eTask\u306e\u8d77\u52d5\u304c\u6b63\u5e38\u306b\u5b8c\u4e86\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306ePublic IP\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068WordPress\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u3055\u3089\u306b\u8d77\u52d5\u3057\u3066\u8ca0\u8377\u5206\u6563\u3092\u884c\u3046\u5834\u5408\u306a\u3069\u306f\u3001\u65b0\u898f\u306b\u8d77\u52d5\u3057\u305f\u3044\u30b3\u30f3\u30c6\u30ca\u6570\u3092\u6307\u5b9a\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306b\u7a7a\u304d\u30ea\u30bd\u30fc\u30b9\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306f\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u65b0\u305f\u306bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3055\u305b\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u5897\u52a0\u3055\u305b\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u554f\u984c\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f\u3001start-task\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5065\u5168\u306aContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u660e\u793a\u7684\u306b\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u969c\u5bb3\u3078\u306e\u5bfe\u5fdc\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u5404\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u72b6\u6cc1\u3084\u505c\u6b62\u51e6\u7406\u306a\u3069\u306fECS Container Agent\u3092\u901a\u3057\u3066ECS\u306e\u30b7\u30b9\u30c6\u30e0\u3068\u3084\u308a\u53d6\u308a\u304c\u884c\u308f\u308c\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u6b63\u5e38\u3082\u3057\u304f\u306f\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7570\u5e38\u7d42\u4e86\u3057\u305f\u5834\u5408\u3082\u691c\u77e5\u3057ECS\u306e\u30b7\u30b9\u30c6\u30e0\u3078\u901a\u77e5\u3055\u308c\u308b\u306e\u3067\u3001 describe-tasks\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u5bfe\u51e6\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\nTask\u5b9f\u884c\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u8981\u6c42\u6570\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4e0d\u8db3\u3057\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u51fa\u6765\u306a\u3044\u5834\u5408\u306ffailures\u3068\u3057\u3066API\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u5374\u3055\u308c\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u4e2d\u306b\u4e0d\u8db3\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n{\n    \"failures\": [\n        {\n            \"reason\": \"AGENT\",\u3000//ECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        },\n        {\n            \"reason\": \"RESOURCE:MEMORY\",  //\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        },\n        {\n            \"reason\": \"RESOURCE:CPU\",  //CPU\u304c\u4e0d\u8db3\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        }\n    ],\n    \"tasks\": []\n}\n\n\nTask\u306e\u505c\u6b62\n\u4f7f\u7528\u304c\u7d42\u4e86\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u958b\u653e\u3059\u308b\u306b\u306f\u3001\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3092stop-task\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u505c\u6b62\u3055\u305b\u307e\u3059\u3002\n$ aws ecs stop-task --cluster default --task 3f638959-cea0-402a-a1f6-017d3bd324fb\n\nTask\u306e\u7d42\u4e86\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5373\u5ea7\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3055\u308c\u308b\u305f\u3081\u3001\u7d42\u4e86\u524d\u306e\u51e6\u7406\u304c\u5fc5\u8981\u3067\u3042\u308c\u3070\u8003\u616e\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u304b\u3089\u5916\u3059\n\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u305fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u505c\u6b62\u30fb\u30bf\u30fc\u30df\u30cd\u30fc\u30c8\u3057\u3066\u3082\u30af\u30e9\u30b9\u30bf\u304b\u3089\u81ea\u52d5\u3067\u767b\u9332\u306f\u89e3\u9664\u3055\u308c\u307e\u305b\u3093\u3002\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u6709\u52b9\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(ECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u3066\u3044\u308b)\u306e\u307f\u4f7f\u7528\u3055\u308c\u308b\u305f\u3081\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u306b\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u53ef\u80fd\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3069\u3046\u304b\u306fdescribe-container-instancesAPI\u306e\u7d50\u679c\u3067\u5224\u65ad\u51fa\u6765\u307e\u3059\u3002\u30ec\u30b9\u30dd\u30f3\u30b9\u4e2d\u306e\"agentConnected\": false`\u3068\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306fECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u306a\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u305f\u3081\u30b3\u30f3\u30c6\u30ca\u306e\u914d\u7f6e\u306f\u884c\u308f\u308c\u306a\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u304b\u3089\u767b\u9332\u3092\u89e3\u9664\u3059\u308b\u5834\u5408\u306fderegister-container-instanceAPI\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u304b\u3089Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u308a\u9664\u304d\u307e\u3059\u3002\u3053\u306e\u6642\u3001\u53d6\u308a\u9664\u3053\u3046\u3068\u3057\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u3067\u30b3\u30f3\u30c6\u30ca\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u5b9f\u884c\u304c\u5931\u6557\u3057\u307e\u3059\u3002\u5f37\u5236\u7684\u306b\u53d6\u308a\u5916\u3059\u5834\u5408\u306f--force\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n$ aws ecs deregister-container-instance --container-instance db2cc682-a63c-47b7-9d66-fd9269fc8f56\n\n$ aws ecs deregister-container-instance --container-instance db2cc682-a63c-47b7-9d66-fd9269fc8f56 --force --profile ecs-preview\n\n\nlog\nECS Container Agent\u306e\u30ed\u30b0\u306f /var/log/ecs/\u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u52d5\u4f5c\u306e\u78ba\u8a8d\u3084\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306a\u3069\u306b\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002ECS Container Agent\u3068ECS API\u3068\u306e\u30cf\u30fc\u30c8\u30d3\u30fc\u30c8\u30fb\u5236\u5fa1\u60c5\u5831\u306e\u3084\u308a\u3068\u308a\u306e\u30ed\u30b0\u3082\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u306e\u3067\u3001\u3069\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304cECS API\u3068\u3084\u308a\u3068\u308a\u3055\u308c\u3066\u3044\u308b\u304b\u3001Dcoker\u30b3\u30f3\u30c6\u30ca\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u9032\u884c\u72b6\u6cc1\u30fb\u8d77\u52d5\u30fb\u505c\u6b62\u51e6\u7406\u3067\u51fa\u529b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u30a8\u30e9\u30fc\u60c5\u5831\u3082\u3053\u3053\u3067\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Task change event\" module=TaskEngine state=3\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Container change event\" module=TaskEngine event=\"{TaskArn:arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb ContainerName:mysql Status:3 Reason: ExitCode:<nil> PortBindings:[] TaskStatus:3}\"\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Top of ApplyTaskState\" module=TaskEngine task=\"wp-5 arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb, Overrides: {} Status: CREATED(R\nUNNING) Containers: mysql,wp,\"\nt=2015-03-02T01:30:02+0000 lvl=info msg=\"MinContainerStatus is RUNNING\" module=TaskEngine\n\nECS\u3092\u4f7f\u7528\u3057\u305f\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u4ee5\u4e0b\u306e2\u70b9\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u30af\u30e9\u30b9\u30bf\u5185\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30dd\u30fc\u30c8)\n\u30b3\u30f3\u30c6\u30ca\u5185\u306e\u30ed\u30b0\u306e\u7ba1\u7406\n\n\u30af\u30e9\u30b9\u30bf\u5185\u3067\u4f7f\u7528\u3067\u304d\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u7dcf\u91cf\u3092\u76e3\u8996\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u65b0\u898f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u8ca0\u8377\u5206\u6563\u3092\u3059\u308b\u5834\u5408\u3084\u65b0\u898f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u30b5\u30fc\u30d3\u30b9\u3092\u62e1\u5145\u3055\u305b\u308b\u5834\u5408\u306b\u30ea\u30bd\u30fc\u30b9\u4e0d\u8db3\u3067\u8ffd\u52a0\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u51fa\u6765\u306a\u3044\u3068\u3044\u3063\u305f\u3053\u3068\u3092\u56de\u907f\u51fa\u6765\u307e\u3059\u3002AWS Command Line Interface\u306edescribe-container-instances\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5404Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eCPU\u3084\u30e1\u30e2\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3092\u53d6\u5f97\u3057\u76e3\u8996\u30c4\u30fc\u30eb\u3084Amazon CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3057\u30ea\u30bd\u30fc\u30b9\u306e\u6b8b\u91cf\u304c\u95be\u5024\u3092\u4e0b\u56de\u3063\u305f\u7279\u306b\u30a2\u30e9\u30fc\u30c8\u306e\u767a\u5831\u3084\u3001Auto Scaling\u3092\u4f7f\u7528\u3057Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u6b8b\u30ea\u30bd\u30fc\u30b9\u3092\u4e00\u5b9a\u306b\u4fdd\u3061Task\u3092\u3044\u3064\u3067\u3082\u5b9f\u884c\u51fa\u6765\u308b\u72b6\u614b\u306b\u4fdd\u3066\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f8b\u306fAWS Command Line Interface\u3092\u4f7f\u7528\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30ea\u30bd\u30fc\u30b9\u306e\u53d6\u5f97\u304b\u3089CoudWatch\u3078\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u767b\u9332\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u3059\u3002\u3053\u306e\u69d8\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092CRON\u3067\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067CloudWatch\u3067\u30af\u30e9\u30b9\u30bf\u304c\u73fe\u5728\u6301\u3063\u3066\u3044\u308bCPU\u3068\u30e1\u30e2\u30ea\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u6cc1\u3092\u76e3\u8996\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\nTask\u3067\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u3001stop-task\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u5373\u5ea7\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3055\u308c\u308b\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u751f\u6210\u3055\u308c\u53d6\u5f97\u3044\u3066\u304a\u304d\u305f\u3044\u30ed\u30b0\u306fAmazon CloudWatch logs\u3084Fluentd\u306a\u3069\u3092\u4f7f\u7528\u3057Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5916\u90e8\u306b\u53ce\u96c6\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30ed\u30b0\u306e\u4fdd\u5168\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u7d42\u4e86\u5f8c\u3082\u30ed\u30b0\u306e\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\nECS\u306e\u7ba1\u7406\u3067\u306f\u3001Cluster\u5185\u306b\u5b58\u5728\u3059\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3092\u628a\u63e1\u3057\u3001\u3044\u3064\u3067\u3082Task\u304c\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3057\u305f\u3042\u3068\u3082\u5927\u5207\u306a\u30ed\u30b0\u3084\u30d5\u30a1\u30a4\u30eb\u306f\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u4e2d\u306b\u30b3\u30f3\u30c6\u30ca\u5916\u90e8\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002\n#!/bin/sh\n\nprofile=ecs-preview\necs_clusters=($(aws ecs list-clusters --profile ${profile} | jq -r '.clusterArns[]'| sed -e 's/^.\\+\\/\\(.\\+\\)$/\\1/'))\n\nfor cluster in ${ecs_clusters[@]}; do\n  remaining_cpu=0\n  remaining_memory=0\n  cluster_instances=($(aws ecs list-container-instances --cluster ${cluster} --profile ${profile} | jq -r '.containerInstanceArns[]'))\n\n  for instance_arn in ${cluster_instances[@]}; do\n    cpu=($(aws ecs describe-container-instances --cluster ${cluster}  --container-instances ${instance_arn} --profile ${profile} | jq -r '.containerInstances[].remainingResources[]|select(.name == \"CPU\")|.integerValue'))\n    remaining_cpu=$((remaining_cpu + cpu))\n\n    memory=($(aws ecs describe-container-instances --cluster ${cluster} --container-instances ${instance_arn} --profile ${profile} | jq -r '.containerInstances[].remainingResources[]|select(.name == \"MEMORY\")|.integerValue'))\n    remaining_memory=$((remaining_memory + memory))\n  done\n\n  ($(aws cloudwatch put-metric-data --namespace 'ECS Cluster/CPU' --dimensions ClusterName=${cluster} --metric-name 'Remaining CPU' --value ${remaining_cpu} --unit Count))\n\n  ($(aws cloudwatch put-metric-data --namespace 'ECS Cluster/MEMORY' --dimensions ClusterName=${cluster} --metric-name 'Remaining MEMORY' --value ${remaining_memory} --unit Megabits))\ndone\n\n\n\n\n\u307e\u3068\u3081\nAWS\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u4f7f\u7528\u3057\u305f\u65b0\u3057\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308bAmazon EC2 Container Service\u306b\u3064\u3044\u3066\u6982\u8981\u3092\u304a\u4f1d\u3048\u3057\u307e\u3057\u305f\u3002Amazon EC2 Container Service\u306e\u767b\u5834\u306b\u3088\u3063\u3066EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4eca\u307e\u3067\u3088\u308a\u3082\u67d4\u8edf\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d3\u30b9\u3084\u74b0\u5883\u3054\u3068\u306bDocker\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u7528\u9014\u306b\u5408\u308f\u305b\u305f\u30af\u30e9\u30b9\u30bf\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u3001\u958b\u767a\u30fb\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u96c6\u7d04\u5ea6\u3092\u3042\u3052\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3057\u3001\u672c\u756a\u74b0\u5883\u3067\u306f\u6f64\u6ca2\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u884c\u3046\u306a\u3069\u3082AWS\u3067\u5bb9\u6613\u306b\u5b9f\u73fe\u53ef\u80fd\u3067\u3059\u3002AWS CLI\u30c4\u30fc\u30eb\u3092\u6d3b\u7528\u3057\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306e\u30d3\u30eb\u30c9\u30fbCI\u304c\u901a\u904e\u3057\u305f\u3089\u81ea\u52d5\u7684\u306bTask\u30fb\u30af\u30e9\u30b9\u30bf\u306e\u767b\u9332\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u505c\u6b62\u3082\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n\u304a\u307e\u3051\nECS Container Agent\u306b\u306f\u3044\u304f\u3064\u304b\u8a2d\u5b9a\u51fa\u6765\u308b\u9805\u76ee\u304c\u3042\u308a\u307e\u3059\u3002\u8a2d\u5b9a\u306fecs.config\u306b\u74b0\u5883\u5909\u6570\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002ecs.config\u3078\u306e\u74b0\u5883\u5909\u6570\u306e\u8a18\u8ff0\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306bUser Data\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u3068\u7c21\u5358\u3067\u3059\u3002\n\u8a8d\u8a3c\u60c5\u5831\u306f\u57fa\u672c\u7684\u306b\u306fEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3059\u308b\u306e\u3067\u3001ECS API\u30a2\u30af\u30bb\u30b9\u7528\u306eAWS_ACCESS_KEY_ID\u3084AWS_SECRET_ACCESS_KEY\u306a\u3069\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a18\u8ff0\u3059\u308b\u306e\u3067\u306f\u306a\u304fIAM Role\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u5b89\u5168\u306b\u8a8d\u8a3c\u60c5\u5831\u3092ECS Container Agent\u306b\u6e21\u305b\u308b\u305f\u3081IAM Role\u306e\u4f7f\u7528\u3092\u63a8\u85a6\u3057\u307e\u3059\u3002ECS_RESERVED_PORTS\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306b\u76e3\u8996\u30c4\u30fc\u30eb\u306a\u3069\u306e\u72ec\u81ea\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5c0e\u5165\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u306b\u4e8b\u524d\u306b\u4f7f\u7528\u30dd\u30fc\u30c8\u3092\u4e88\u7d04\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001Task\u3067\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3068\u30dd\u30fc\u30c8\u304c\u91cd\u8907\u3057\u3066Task\u304c\u5931\u6557\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u9632\u3050\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\n\n\u74b0\u5883\u5909\u6570\n\u8aac\u660e\nDefault\u5024\n\n\n\n\nECS_CLUSTER\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6240\u5c5e\u3055\u305b\u308b\u30af\u30e9\u30b9\u30bf\u540d\ndefault\n\n\nECS_RESERVED_PORTS\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4e88\u3081\u4f7f\u7528\u4e88\u5b9a\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u4e00\u89a7\n[22, 2375, 2376, 51678]\n\n\nAWS_DEFAULT_REGION\nECS Container Agent\u304c\u30a2\u30af\u30bb\u30b9\u3059\u308bECS API\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\nEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97\n\n\nAWS_ACCESS_KEY_ID\nECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\nEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97\n\n\nAWS_SECRET_ACCESS_KEY\nECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\nEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97\n\n\nDOCKER_HOST\nDocker\u30c7\u30fc\u30e2\u30f3\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u3084\u308a\u3068\u308a\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b\u30db\u30b9\u30c8\nunix:///var/run/docker.sock\n\n\nECS_LOGLEVEL\n\u30ed\u30b0\u30ec\u30d9\u30eb (,,,,)\nwarn\n\n\nECS_LOGFILE\n\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\u30d1\u30b9\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\u3053\u306e\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3068ECS_LOGLEVEL\u3092\u7121\u8996\u3057\u3066\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\nblank\n\n\nECS_BACKEND_HOST\nECS API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30db\u30b9\u30c8\u540d\necs.REGION.amazonaws.com\n\n\nECS_BACKEND_PORT\nECS API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30dd\u30fc\u30c8\u756a\u53f7\n443\n\n\nAWS_SESSION_TOKEN\n\u4e00\u6642\u7684\u306a\u8a8d\u8a3c\u306b\u4f7f\u7528\u3059\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u30c8\u30fc\u30af\u30f3\nEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97\n\n\n\n\n\u6700\u65b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nPreview\u4e2d\u306eECS\u3067\u3059\u304c\u3001\u4eca\u56de\u89e6\u308c\u306a\u304b\u3063\u305f\u6a5f\u80fd\u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\n\n\nMesos Scheduler\u5bfe\u5fdc\n\nhttps://aws.amazon.com/blogs/compute/cluster-management-with-amazon-ecs/\nhttps://github.com/awslabs/ecs-mesos-scheduler-driver\n\n\n\nPrivate repository\u5bfe\u5fdc / Volume mount\u5bfe\u5fdc\n\nhttps://aws.amazon.com/blogs/aws/ec2-container-service-ecs-update-access-private-docker-repos-mount-volumes-in-containers/\n\n\n\n\n\u304a\u7d04\u675f\n\u3053\u3061\u3089\u306f\u500b\u4eba\u306e\u610f\u898b\u3067\u4f1a\u793e\u3068\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\u304a\u7d04\u675f\u3067\u3059\u3002\n# Amazon EC2 Container Service\n**\u5185\u5bb9\u306f\u3042\u304f\u307e\u3067\u73fe\u5728\u306ePreview\u3092\u5143\u306b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4eca\u5f8c\u3082\u4ed5\u69d8\u306a\u3069\u304c\u5909\u66f4\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u5927\u304d\u304f\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u3054\u5229\u7528\u306e\u969b\u306f\u5fc5\u305a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002**\n\nECS\u306fDocker\u30d9\u30fc\u30b9\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d3\u30eb\u30c9\u3001\u5b9f\u884c\u3068\u305d\u3057\u3066\u30b9\u30b1\u30fc\u30eb\u3092\u52a9\u3051\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\n\u5229\u70b9\u3068\u3057\u3066\u3001\u3088\u308a\u7c21\u5358\u306a\u30af\u30e9\u30b9\u30bf\u30fc\u30de\u30cd\u30fc\u30b8\u30e1\u30f3\u30c8\u3001\u30cf\u30a4\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3001\u67d4\u8edf\u306a\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3001\u62e1\u5f35\u6027\u3001\u30dd\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u3001\u305d\u3057\u3066AWS\u306e\u4ed6\u30b5\u30fc\u30d3\u30b9\u3084\u6a5f\u80fd\u3068\u306e\u7d71\u5408\u304c\u3042\u308a\u307e\u3059\u3002ECS\u306f\u8ad6\u7406\u7684\u306aEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b0\u30eb\u30fc\u30d7\u5185\u304b\u3089\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u306b\u5fc5\u8981\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u63d0\u4f9b\u51fa\u6765\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u5236\u5fa1\u3092\u884c\u3044\u307e\u3059\u3002ECS\u306fDocker\u30d9\u30fc\u30b9\u306e\u305f\u3081\u65e2\u5b58\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u4f7f\u7528\u53ef\u80fd\u3067\u3001Docker Hub\u3084\u4efb\u610f\u306e\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u3082\u3061\u308d\u3093\u3001ECS\u3067\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306fAWS\u306e\u4ed6\u306e\u30b5\u30fc\u30d3\u30b9\u3068\u540c\u69d8\u306bVPC\u5185\u3067\u8d77\u52d5\u53ef\u80fd\u306a\u306e\u3067\u3001\u30b7\u30b9\u30c6\u30e0\u3092\u5b89\u5168\u306b\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002ECS\u3067\u306f1 EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u8907\u6570\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3067\u30b7\u30a7\u30a2\u51fa\u6765\u308b\u305f\u3081\u52b9\u7387\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\nDocker\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f7f\u7528\u4e2d\u30fb\u6b8b\u308aCPU/\u30e1\u30e2\u30ea\u3084\u30dd\u30fc\u30c8\u756a\u53f7\u306e\u3088\u3046\u306a\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u306fECS\u304c\u884c\u3046\u305f\u3081\u3001\u3069\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u6b8b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u30e6\u30fc\u30b6\u304c\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u30ea\u30bd\u30fc\u30b9\u304c\u4e0d\u8db3\u3057\u305f\u5834\u5408\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30fc\u30eb\u306b\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u81ea\u52d5\u7684\u306b\u30ea\u30bd\u30fc\u30b9\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\nDocker\u30b3\u30f3\u30c6\u30ca\u3092\u81ea\u524d\u3067EC2\u4e0a\u3067\u8d77\u52d5\u3057\u3001\u7ba1\u7406\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u5404EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u73fe\u5728\u4f7f\u3048\u308bCPU\u3084\u30e1\u30e2\u30ea\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u3068\u3044\u3063\u305f\u30cf\u30fc\u30c9\u30a6\u30a8\u30a2\u30ea\u30bd\u30fc\u30b9\u306e\u7a7a\u304d\u72b6\u6cc1\u3084Docker\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u3001\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306a\u3069\u3001Docker\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u52d5\u4f5c\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306a\u3069\u306b\u5fc5\u8981\u306a\u60c5\u5831\u3092\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002ECS\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001\u3053\u308c\u3089\u306e\u30cf\u30fc\u30c9\u30a6\u30a8\u30a2\u30ea\u30bd\u30fc\u30b9\u3084\u8a2d\u5b9a\u60c5\u5831\u306e\u7ba1\u7406\u3092ECS\u306b\u4efb\u305b\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u306e\u4ed6\u306e\u7279\u5fb4\u3068\u3057\u3066\u3001\u65e2\u5b58\u306eDocker\u30a4\u30e1\u30fc\u30b8\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u53ef\u80fd\u306a\u305f\u3081\u3001\u30aa\u30f3\u30d7\u30ec\u30df\u30b9\u3068\u30af\u30e9\u30a6\u30c9\u306e\u9593\u3067\u30b7\u30fc\u30e0\u30ec\u30b9\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002ECS\u7279\u6709\u306e\u6a5f\u80fd\u3068\u3057\u3066AWS\u306e\u30b5\u30fc\u30d3\u30b9\u3084\u6a5f\u80fd\u3068\u306e\u9023\u643a\u304c\u884c\u3044\u6613\u304fECS API\u3092\u4f7f\u7528\u3057\u3066\u30d7\u30ed\u30b0\u30e9\u30de\u30d6\u30eb\u306bECS\u74b0\u5883\u3092\u6271\u3046\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u0001\n\n## \u7528\u8a9e\u306e\u89e3\u8aac\n- Task Definition: Task Definition\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u96c6\u5408\u306e\u5b9a\u7fa9\u30021\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u3092\u5b9a\u7fa9\u3057\u3001CPU\u3084\u30e1\u30e2\u30ea\u5272\u5f53\u3084Container\u9593\u306eLink\u306a\u3069\u3092\u8a2d\u5b9a\u3059\u308b\u30021\u3064\u306eTask Definition\u5185\u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u540c\u4e00\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u7a3c\u50cd\u3059\u308b\n- Task - Task Definition\u306e\u5b9f\u4f53\n- Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9: ECS\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u7a3c\u50cd\u3057\u3066\u3044\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3001\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3002\u30af\u30e9\u30b9\u30bf\u5185\u3067\u52d5\u3044\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96c6\u5408\u306fTask\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3068\u3057\u3066\u6271\u308f\u308c\u308b\u3002Multi-AZ\u306b\u3082\u5bfe\u5fdc\u3057\u3066\u3044\u308b\u305f\u3081\u8907\u6570\u306e\u30a2\u30d9\u30a4\u30e9\u30d3\u30ea\u30c6\u30a3\u30be\u30fc\u30f3\u306bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u969c\u5bb3\u8010\u6027\u3092\u9ad8\u3081\u308b\u3053\u3068\u3082\u53ef\u80fd\n- Cluster: Task\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ad6\u7406\u7684\u306a\u30b0\u30eb\u30fc\u30d7\n- Container: Task\u306b\u3088\u308a\u751f\u6210\u3055\u308c\u305fDocker\u30b3\u30f3\u30c6\u30ca\n\n## ECS Container Agent\nECS Container Agent\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e2d\u3067\u52d5\u304f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u3059\u3002\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u901a\u3057\u3066Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067\u7a3c\u50cd\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u958b\u59cb\u3084\u505c\u6b62\u306a\u3069\u306e\u7ba1\u7406\u3092\u884c\u3044\u307e\u3059\u3002\u4ed6\u306e\u6a5f\u80fd\u3068\u3057\u3066\u3001\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u8d77\u52d5\u3057\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u3001\u3069\u306eECS Cluster\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\u304b\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eCPU\u3084\u30e1\u30e2\u30ea\u306e\u60c5\u5831\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u72b6\u6cc1\u306a\u3069\u3082ECS\u306e\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0\u3078\u901a\u77e5\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002ECS Container Agent\u304cECS API\u7d4c\u7531\u3067\u30c7\u30fc\u30bf\u3092\u9001\u4fe1\u3059\u308b\u969b\u306b\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u3042\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308bIAM Role(\u8a8d\u8a3c\u60c5\u5831)\u3092\u4f7f\u7528\u3057\u3066\u30a2\u30af\u30bb\u30b9\u3092\u884c\u3046\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u306b\u8a8d\u8a3c\u60c5\u5831\u3092\u6e21\u3059\u5fc5\u8981\u304c\u7121\u304f\u3001ECS API\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3082Agent\u304b\u3089\u884c\u3046\u305f\u3081\u30dd\u30fc\u30c8\u3092EXPOSE\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u5b9f\u306f\u3053\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u81ea\u8eab\u3082Docker\u30b3\u30f3\u30c6\u30ca\u3068\u3057\u3066\u7a3c\u50cd\u3057\u3066\u304a\u308a\u3001[Docker Hub](https://registry.hub.docker.com/u/amazon/amazon-ecs-agent/)\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306a\u3069\u306f[github](https://github.com/aws/amazon-ecs-agent)\u306b\u3066Apache 2.0\u30e9\u30a4\u30bb\u30f3\u30b9\u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u662f\u975e\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n![ecs-image](https://qiita-image-store.s3.amazonaws.com/0/4769/3a5d2adf-7dfa-2dcb-8436-2fdc27154782.png)\n\n# ECS\u3092\u52d5\u304b\u3057\u3066\u307f\u308b\n\u305d\u308c\u3067\u306f\u65e9\u901fECS\u3092\u4f7f\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u73fe\u5728\u306e\u3068\u3053\u308dPreview\u7248\u306eECS\u3067\u306fAWS Management Console\u306f\u7528\u610f\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u64cd\u4f5c\u3092\u884c\u3044\u307e\u3059\u3002\n\nECS\u306fLinux AMI(\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8)\u306bECS Container Agent\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u5229\u7528\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u304c\u3001AWS\u3067\u306f\u73fe\u5728Amazon Linux\u3092\u30d9\u30fc\u30b9\u3068\u3057\u305fECS\u306b\u6700\u9069\u5316\u3055\u308c\u305f\u8efd\u91cf\u306aAMI\u3092\u7528\u610f\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306eAMI\u306b\u306f\u65e2\u306bECS Container Agent\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3059\u3050\u306bECS\u3092\u5229\u7528\u3067\u304d\u307e\u3059\u3002\u4ed6\u306b\u3082\u3001CoreOS\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a[\u516c\u5f0f\u30b5\u30a4\u30c8](https://coreos.com/docs/running-coreos/cloud-providers/ecs/)\u306b\u63b2\u8f09\u3055\u308c\u3066\u3044\u308bcloud-init\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067\u7c21\u5358\u306bECS Container Agent\u3092\u5c0e\u5165\u53ef\u80fd\u3067\u3059\u3002\n\n## ECS\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u4eca\u56de\u306fAWS\u3067\u63d0\u4f9b\u3057\u3066\u3044\u308b\u3001ECS\u7528\u306eAMI\u3092\u5229\u7528\u3057\u3066ECS\u304c\u3069\u306e\u3088\u3046\u306a\u30b5\u30fc\u30d3\u30b9\u306a\u306e\u304b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n### CLI\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nECS\u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306b\u3001AWS CLI\u30c4\u30fc\u30eb\u3092[\u516c\u5f0f\u30b5\u30a4\u30c8](http://aws.amazon.com/cli/)\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\u307e\u305f\u3001CLI\u64cd\u4f5c\u7528\u306bIAM\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002IAM\u30e6\u30fc\u30b6\u306bECS\u306e\u64cd\u4f5c\u6a29\u9650\u3092\u4ed8\u4e0e\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u6bce\u306bAWS\u30ea\u30bd\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u7d30\u304b\u304f\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002IAM\u30e6\u30fc\u30b6\u4f5c\u6210\u306e\u8a73\u7d30\u306f[\u3053\u3061\u3089](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/get-set-up-for-amazon-ecs.html#create-an-iam-user)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002ECS\u3067\u306f\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u30fbTask\u306e\u767b\u9332\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u30fb\u505c\u6b62\u306a\u3069\u7d30\u304b\u304f\u6a29\u9650\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3001\u7279\u5b9a\u306eIAM\u30e6\u30fc\u30b6\u306b\u7279\u5b9a\u306e\u30af\u30e9\u30b9\u30bf\u306e\u64cd\u4f5c\u3084\u7279\u5b9a\u30bf\u30b9\u30af\u306e\u64cd\u4f5c\u306e\u307f\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\u7d30\u304b\u304f\u6a29\u9650\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u3067\u6a29\u9650\u304c\u5206\u96e2\u3067\u304dECS\u306e\u904b\u7528\u3092\u5b89\u5168\u306b\u884c\u3046\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002[\u8a73\u7d30](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/IAM_policies.html)\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\n\n\u4eca\u56de\u306f\u3001IAM\u30e6\u30fc\u30b6\u306fCLI\u64cd\u4f5c\u306b\u5229\u7528\u3057\u3066\u3001IAM Role\u306fECS Container Agent\u304c\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```shell-session\n$ pip install awscli\n```\n\u3067\u884c\u3048\u307e\u3059\u3002 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306f\u8a8d\u8a3c\u60c5\u5831\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081 `aws configure`\u3092\u5b9f\u884c\u3057\u3001IAM\u30e6\u30fc\u30b6\u306e\u60c5\u5831\u3092\u767b\u9332\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Default Region\u3092Virginia\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u307e\u305f\u3001`--profile`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001ECS Preview\u7528\u306eProfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002--profile\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u4e00\u6642\u7684\u306bdefault\u306eProfile\u3068Profile\u60c5\u5831\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n```shell-session\n$ aws configure --profile ecs-preview\nAWS Access Key ID []:****************\nAWS Secret Access Key []:****************\nDefault region name []:us-east-1\nDefault output format []:\n```\n\n\u65e2\u306b\u3001awscli\u3092\u304a\u4f7f\u3044\u306e\u5834\u5408\u306f`--region`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u4e00\u6642\u7684\u306b\u4f7f\u7528\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002Virginia\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001`--region us-east-1`\u3068\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs aws ecs list-container-instances --cluster default --region us-east-1 --profile ecs-preview\n```\n\n### Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\u672c\u7ae0\u3067\u306fECS Cluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u304b\u3089\u8a2d\u5b9a\u307e\u3067\u3092\u884c\u3044\u307e\u3059\u3002ECS Cluster\u306b\u6240\u5c5e\u3055\u305b\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u3092\u884c\u3046\u524d\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u306eECS Container Agent\u304cECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u6a29\u9650(IAM Role)\u4ed8\u4e0e\u3084Security Group(\u30a2\u30af\u30bb\u30b9\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb)\u3092\u8a2d\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u8a73\u7d30\u306f[\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_GetStarted.html)\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n\u4e8b\u524d\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3057\u305f\u3089Cluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002AWS\u304c\u7528\u610f\u3057\u3066\u3044\u308b2015\u5e744\u6708\u73fe\u5728\u6700\u65b0\u306e **preview\u7528AMI** \u3092\u4f7f\u7528\u3059\u308b\u306b\u306f\u3001Management Console \u2192 EC2 \u2192 Launch Instance \u2192 Community AMIs\u304b\u3089\u300cami-801544e8\u300d\u3067\u691c\u7d22\u3057\u3066\u30d2\u30c3\u30c8\u3057\u305f\u3082\u306e\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u3061\u3089\u306fVirginia\u30ea\u30fc\u30b8\u30e7\u30f3\u306eAMI\u3067\u3059\u306e\u3067\u3001Oregon\u306f\u300cami-801544e8\u300d\u3001Ireland\u306f\u300cami-519a0a26\u300d\u3092\u3054\u5229\u7528\u4e0b\u3055\u3044\u3002\n **\u3053\u3061\u3089\u306eAMI\u306fpreview\u7528\u3067\u3059\u306e\u3067\u3001\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u6642\u306f\u30ea\u30ea\u30fc\u30b9\u6642\u306e\u6848\u5185\u306b\u3057\u305f\u304c\u3063\u3066\u9069\u5207\u306aAMI\u3092\u3054\u5229\u7528\u4e0b\u3055\u3044**\n\n![ecs-ami](https://qiita-image-store.s3.amazonaws.com/0/4769/e6c37f1c-9c96-b455-f120-33ef396a7596.png)\n\n\n\u4f7f\u7528\u3059\u308bAMI\u3092\u9078\u629e\u5f8c\u3001\u4f7f\u7528\u3059\u308bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u3067\u6307\u5b9a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u5404Docker\u30b3\u30f3\u30c6\u30ca\u3067\u30b7\u30a7\u30a2\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\u5f8c\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3057\u3066\u4f7f\u7528\u3067\u304d\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u306a\u306e\u3067\u3001\u30ea\u30bd\u30fc\u30b9\u306e\u5229\u7528\u72b6\u6cc1\u3092\u898b\u306a\u304c\u3089\u6700\u521d\u306f\u5c0f\u3055\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u3092\u4f7f\u7528\u3057\u3001\u7528\u9014\u304c\u5897\u3048\u3066\u304d\u305f\u6bb5\u968e\u3067\u30b9\u30da\u30c3\u30af\u306e\u9ad8\u3044EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3055\u305b\u308b\u3053\u3068\u3067\u30b3\u30b9\u30c8\u3092\u6291\u3048\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n### ECS\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092Cluster\u306b\u53c2\u52a0\u3055\u305b\u308b\nECS\u306fCluster\u3068\u3044\u3046\u5358\u4f4d\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u3069\u306eECS Cluster\u306b\u53c2\u52a0\u3055\u305b\u308b\u304b\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3057\u307e\u3059\u3002\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306fdefault Cluster\u306b\u6240\u5c5e\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30af\u30e9\u30b9\u30bf\u540d\u3092\u660e\u793a\u7684\u306b\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u6642\u306e\u8a2d\u5b9a\u3067Advanced Details\u5185\u306eUser Data\u306b\u4ee5\u4e0b\u306e\u60c5\u5831\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```shell-session\n#!/bin/bash\necho ECS_CLUSTER=\u30af\u30e9\u30b9\u30bf\u540d >> /etc/ecs/ecs.config\n```\n\n![ecs-cluster-setup](https://qiita-image-store.s3.amazonaws.com/0/4769/068c61a1-11e9-52b7-442e-cb61fd1f5449.png)\n\nECS\u3067\u306f\u3001ECS_CLUSTER\u306b\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u540d\u304c\u540c\u4e00\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30921\u3064\u306eECS\u30af\u30e9\u30b9\u30bf\u3068\u3057\u3066\u6271\u3044\u3001\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCPU\u3084\u30e1\u30e2\u30ea\u306a\u3069\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30bd\u30fc\u30b9\u3092\u5404\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n## Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8d77\u52d5\u306e\u78ba\u8a8d\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6b63\u3057\u304f\u8d77\u52d5\u3059\u308b\u3068\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3057\u305f(\u6307\u5b9a\u304c\u306a\u3051\u308c\u3070default)\u30af\u30e9\u30b9\u30bf\u306b\u81ea\u52d5\u3067\u767b\u9332\u3055\u308c\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs list-container-instances --cluster \u30af\u30e9\u30b9\u30bf\u540d --profile ecs-preview\n```\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n\n```json\n{\n  \"containerInstanceArns\": [\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/29f000f6-73ed-4b2f-9a79-4fc7209d6730\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/d79fbdc9-7099-4c5c-863f-62ebea76cdba\"\n  ]\n}\n```\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u78ba\u8a8d\n\n2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\u4e2d\u306earn\u306fAmazon Resource Name\u306e\u7565\u79f0\u3067\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3084Task\u306a\u3069\u306eAWS\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4e00\u610f\u306b\u8b58\u5225\u3059\u308b\u305f\u3081\u306eID\u3067\u3059\u3002\n\n\u5404\u30af\u30e9\u30b9\u30bf\u306e\u8a73\u7d30\u60c5\u5831\u306f\n\n```shell-session\n$ aws ecs describe-container-instances --cluster default --container-instances 29f000f6-73ed-4b2f-9a79-4fc7209d6730 d79fbdc9-7099-4c5c-863f-62ebea76cdba --profile ecs-preview\n```\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\n\n```json\n{\n  \"failures\": [],\n  \"containerInstances\": [\n    {\n      \"status\": \"ACTIVE\",\n      \"registeredResources\": [\n       {\n          \"integerValue\": 1024,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"CPU\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"integerValue\": 2004,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"MEMORY\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"name\": \"PORTS\",\n          \"longValue\": 0,\n          \"doubleValue\": 0.0,\n          \"stringSetValue\": [\n            \"2376\",\n            \"22\",\n            \"51678\",\n            \"2375\"\n          ],\n          \"type\": \"STRINGSET\",\n          \"integerValue\": 0\n       }\n  ],\n  \"ec2InstanceId\": \"i-a9b8f552\",\n  \"agentConnected\": true,\n  \"containerInstanceArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/29f000f6-73ed-4b2f-9a79-4fc7209d6730\",\n      \"remainingResources\": [\n       {\n          \"integerValue\": 1024,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"CPU\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"integerValue\": 2004,\n          \"longValue\": 0,\n          \"type\": \"INTEGER\",\n          \"name\": \"MEMORY\",\n          \"doubleValue\": 0.0\n       },\n       {\n          \"name\": \"PORTS\",\n          \"longValue\": 0,\n          \"doubleValue\": 0.0,\n          \"stringSetValue\": [\n            \"2376\",\n            \"22\",\n            \"51678\",\n            \"2375\"\n          ],\n          \"type\": \"STRINGSET\",\n          \"integerValue\": 0\n       }\n  ],\n\u301c\u301c\u301c\u301c\u301c \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u6570\u5206 \u301c\u301c\u301c\u301c\u301c\n```\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\n\n| Value        | \u8aac\u660e                                                              |\n|--------------|------------------------------------------------------------------|\n| status       | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b         |\n| agentConnected       | ECS Container Agent\u304cECS API\u3068\u901a\u4fe1\u51fa\u6765\u3066\u3044\u308b\u304b\u3002true\u306b\u306a\u3063\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u307f\u4f7f\u7528\u53ef\u80fd         |\n| registeredResources       | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4f7f\u7528\u3067\u304d\u308b\u5168\u3066\u306e\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8)         |\n| remainingResources       | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4f7f\u7528\u3067\u304d\u308b\u5168\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30dd\u30fc\u30c8)         |\n| ec2InstanceId       | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID         |\n| containerInstanceArn       | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4e00\u610f\u306b\u8868\u3059AWS\u306e\u30ea\u30bd\u30fc\u30b9ID        |\nCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u8a73\u7d30\n\n\n`describe-container-instances` API\u3092\u4f7f\u7528\u3057\u3066\u8868\u793a\u3057\u307e\u3059\u3002\u5404Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6240\u6301\u3057\u3066\u3044\u308b\u3001CPU Unit\u30fb\u30e1\u30e2\u30ea\u30fc\u30fb\u30dd\u30fc\u30c8\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3068\u73fe\u5728\u6b8b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3001Instance ID\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u3060\u4f55\u3082\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u3001\u6240\u6301\u30ea\u30bd\u30fc\u30b9\u3068\u6b8b\u308a\u30ea\u30bd\u30fc\u30b9\u304c\u540c\u4e00\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002`Instance ID: i-a9b8f552`\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306fCPU\u304c1 Core\u306a\u306e\u3067CPU Unit\u304c1024\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\nContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3001ECS Container Agent\u306emetadata API\u3092\u4f7f\u7528\u3057\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6240\u5c5e\u3057\u3066\u3044\u308b\u30af\u30e9\u30b9\u30bf\u3084ContainerInstanceArn\u3092\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n```shell-session\n$ curl http://localhost:51678/v1/metadata\n```\n\n```json\n{\n  \"ClusterArn\":\"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:cluster/default\",\n  \"ContainerInstanceArn\":\"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/db2cc682-a63c-47b7-9d66-fd9269fc8f56\"\n}\n```\nECS Container Agent metadata\u53d6\u5f97\n\n## ECS\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\n### Task\u306e\u8a18\u8ff0\nTask\u306fJson\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3001\u5404Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u5fc5\u8981\u306aCPU\u3084\u30e1\u30e2\u30ea\u3001\u30dd\u30fc\u30c8\u756a\u53f7\u306a\u3069\u306e\u30ea\u30bd\u30fc\u30b9\u5272\u5f53\u3084\u74b0\u5883\u5909\u6570\u3001Dokcer\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u306a\u3069\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\u307e\u305f\u3001Task\u306f\u30ea\u30bd\u30fc\u30b9\u306e\u5272\u308a\u5f53\u3066\u3060\u3051\u3067\u306f\u306a\u304f\u3001Task\u5185\u3067\u5b9f\u969b\u306b\u8d77\u52d5\u3059\u308bDocker\u30b3\u30f3\u30c6\u30ca\u3092\u6307\u5b9a\u3057\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30ea\u30bd\u30fc\u30b9\u304c\u5168\u3066\u63d0\u4f9b\u53ef\u80fd\u306aCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092ECS\u304c\u81ea\u52d5\u7684\u306b\u9078\u629e\u3057\u3001\u305d\u306eCluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u8d77\u52d5\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u3084Docker\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u306e\u63a5\u7d9a\u30fb\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u306a\u3069\u3082\u884c\u308f\u308c\u307e\u3059\u3002\n\n| Value        | Type         | \u8aac\u660e                                                                                                                                                                                          |\n|--------------|--------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| name         | string       | \u30b3\u30f3\u30c6\u30ca\u3092\u8b58\u5225\u3059\u308b\u540d\u524d\u3002\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092\u63a5\u7d9a\u3059\u308blink\u6a5f\u80fd\u3067\u6307\u5b9a\u3055\u308c\u308b                                                                                                                          |\n| image        | string       | Docker\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\u3002\u6a19\u6e96\u3067\u306fDocker Hub\u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001repository-url/image:tag\u3068\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u4efb\u610f\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u3092\u4f7f\u7528\u53ef\u80fd                                                                  |\n| cpu          | integer      | \u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u308bCPU Unit\u3092\u6307\u5b9a\u3002\u5404EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f1\u30b3\u30a2\u5f53\u305f\u308a1024 CPU Units\u3092\u6301\u3063\u3066\u3044\u308b                                                                                                |\n| memory       | integer      | \u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u308b\u30e1\u30e2\u30ea\u3092MiB\u5358\u4f4d\u3067\u6307\u5b9a\u3002Docker\u306f\u6700\u4f4e4MiB\u3092\u5272\u5f53\u3066\u308b                                                                                                                       |\n| links        | string array | links\u3067\u6307\u5b9a\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u540c\u58eb\u3092\u63a5\u7d9a\u3002links\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u30dd\u30fc\u30c8\u30de\u30c3\u30d4\u30f3\u30b0\u306a\u3069\u306e\u8a2d\u5b9a\u304c\u4e0d\u8981\u3002\u8a73\u7d30: https://docs.docker.com/userguide/dockerlinks/                                      |\n| portMappings | object array | EXPOSE\u3059\u308b\u30dd\u30fc\u30c8\u3092\u6307\u5b9a\u3002                                                                                                                                                                      |\n| essential    | boolean      | true\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3059\u308b\u3068Task\u304c\u5931\u6557\u3059\u308b\u304c\u3001false\u306b\u8a2d\u5b9a\u3059\u308b\u3068\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3057\u3066\u3082Task\u306e\u51e6\u7406\u3092\u7d99\u7d9a\u30021\u3064\u306eTask Definishon\u306b\u306f\u6700\u4f4e\u3067\u30821\u3064essential\u304ctrue\u306a\u30b3\u30f3\u30c6\u30ca\u304c\u5fc5\u8981 |\n| entryPoint   | string       | ENTRYPOINT\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u8a73\u7d30: https://docs.docker.com/reference/builder/#entrypoint                                                                                         |\n| command      | string       | CMD\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u8a73\u7d30: https://docs.docker.com/reference/builder/#cmd                                                                                                       |\n| environment  | object array | \u74b0\u5883\u5909\u6570\u3068\u3057\u3066Docker\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u308c\u308b\u3002\u5f62\u5f0f\u306f\u3001{ \"name\" : \"\u74b0\u5883\u5909\u6570\", \"value\" : \"\u5024\" }                                                                                                       |\nTask\u3067\u6307\u5b9a\u3067\u304d\u308b\u9805\u76ee\n\nlinks\u3067\u6307\u5b9a\u3067\u304d\u308b\u30b3\u30f3\u30c6\u30ca\u306f\u73fe\u5728\u3001\u540c\u4e00\u306eTask Definishon\u5185\u306b\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u540c\u4e00\u306eEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067\u7a3c\u50cd\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u3044\u3051\u306a\u3044\u3068\u3044\u3046\u5236\u7d04\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u6ce8\u610f\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n### \u4f7f\u7528\u3059\u308bTask Definition\n\u4eca\u56de\u306fWordPress\u3068MySQL\u3092\u5225\u3005\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u8d77\u52d5\u3057\u3001Links\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u30662\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u63a5\u7d9a\u3059\u308bTask\u3092\u4f5c\u6210\u3057ECS\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nWordPress\u3068MySQL\u306eimage\u306f\u516c\u5f0f\u30ec\u30dd\u30b8\u30c8\u30ea\u306e https://registry.hub.docker.com/_/wordpress/ https://registry.hub.docker.com/_/mysql/ \u3092\u305d\u308c\u305e\u308c\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```json\n[\n  {\n    \"environment\": [\n      { \"name\" : \"WORDPRESS_DB_USER\", \"value\" : \"wpuser\" },\n      { \"name\" : \"WORDPRESS_DB_PASSWORD\", \"value\" : \"wppass\" },\n      { \"name\" : \"WORDPRESS_DB_NAME\", \"value\" : \"wpdb\" }\n    ],\n    \"name\": \"wp\",\n    \"image\": \"wordpress:latest\",\n    \"cpu\": 100,\n    \"portMappings\": [\n      {\n        \"containerPort\": 80,\n        \"hostPort\": 80\n      }\n    ],\n    \"links\": [\"mysql:mysql\"],\n    \"memory\": 1024,\n    \"essential\": false\n  },\n  {\n    \"environment\": [\n      { \"name\" : \"MYSQL_ROOT_PASSWORD\", \"value\" : \"rootwppass\" },\n      { \"name\" : \"MYSQL_USER\", \"value\" : \"wpuser\" },\n      { \"name\" : \"MYSQL_PASSWORD\", \"value\" : \"wppass\" },\n      { \"name\" : \"MYSQL_DATABASE\", \"value\" : \"wpdb\" }\n    ],\n    \"name\": \"mysql\",\n    \"image\": \"mysql\",\n    \"cpu\": 200,\n    \"memory\": 2048,\n    \"essential\": true\n  }\n]\n```\n\n\u3053\u306eTask\u3067\u306f\u3001WordPress\u306e\u30b3\u30f3\u30c6\u30ca\u3092`wp`\u3068\u3044\u3046\u540d\u524d\u3067CPU 100Units\u3001Memory 1024MiB\u3092\u5272\u5f53\u3001`links`\u3067mysql\u3068name\u5c5e\u6027\u3067\u6307\u5b9a\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ca\u306bLink\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\u307e\u305f\u3001essential\u304cfalse\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001WordPress\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u304c\u5931\u6557\u3057\u3066\u3082Task\u306f\u5931\u6557\u305b\u305a\u7d99\u7d9a\u3057\u3066\u52d5\u4f5c\u3057\u307e\u3059\u3002MySQL\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u3001CPU 200Units\u3001Memory 2048MiB\u3092\u5272\u308a\u5f53\u3066\u3066\u3044\u307e\u3059\u3002\u3053\u3061\u3089\u306f\u3001`essential`\u3092true\u306b\u6307\u5b9a\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u304c\u5931\u6557\u3059\u308b\u3068Task\u5168\u4f53\u304c\u5931\u6557\u3057\u307e\u3059\u3002\u305d\u308c\u305e\u308c\u306e\u30b3\u30f3\u30c6\u30ca\u3067`enviroment`\u306b\u3088\u308a\u74b0\u5883\u3092\u6e21\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30e6\u30fc\u30b6\u3084\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n## Task\u306e\u767b\u9332\nTask Definishon\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001ECS\u306bTask\u306e\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002Task Definishon\u304b\u3089Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5185\u3067Docker\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u305f\u3081\u306b\u306f\u3001ECS\u306b\u767b\u9332\u3057\u305fTask\u3092\u6307\u5b9a\u3057\u3066\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u306e\u5148\u306e\u4f8b\u3067\u306f\u3001\u5148\u307b\u3069\u306eTask\u3092`wordpress.json`\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3066ECS\u3078\u767b\u9332\u3057\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs register-task-definition --family wordpress --container-definitions file://./wordpress.json --profile ecs-preview\n```\n\n```json\n{\n  \"taskDefinition\": {\n    \"taskDefinitionArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n    \"containerDefinitions\": [\n      {\n        \"environment\": [\n          {\n            \"name\": \"WORDPRESS_DB_USER\",\n            \"value\": \"wpuser\"\n          },\n          {\n            \"name\": \"WORDPRESS_DB_PASSWORD\",\n            \"value\": \"wppass\"\n          },\n          {\n            \"name\": \"WORDPRESS_DB_NAME\",\n            \"value\": \"wpdb\"\n           }\n       ],\n       \"name\": \"wp\",\n       \"links\": [\n         \"mysql:mysql\"\n       ],\n       \"image\": \"wordpress:latest\",\n       \"essential\": false,\n       \"portMappings\": [\n         {\n           \"containerPort\": 80,\n           \"hostPort\": 80\n         }\n       ],\n       \"memory\": 1024,\n       \"cpu\": 100\n     },\n     {\n       \"environment\": [\n         {\n           \"name\": \"MYSQL_DATABASE\",\n           \"value\": \"wpdb\"\n         },\n         {\n           \"name\": \"MYSQL_PASSWORD\",\n           \"value\": \"wppass\"\n          },\n          {\n            \"name\": \"MYSQL_USER\",\n            \"value\": \"wpuser\"\n          },\n          {\n            \"name\": \"MYSQL_ROOT_PASSWORD\",\n            \"value\": \"rootwppass\"\n          }\n        ],\n        \"name\": \"mysql\",\n        \"image\": \"mysql\",\n        \"cpu\": 200,\n        \"portMappings\": [],\n        \"memory\": 2048,\n        \"essential\": true\n        }\n   ],\n   \"family\": \"wordpress\",\n   \"revision\": 1\n   }\n }\n```\n\n`container-definitions`\u306b\u306fJSON\u3092\u305d\u306e\u307e\u307e\u6e21\u3059\u4e8b\u304c\u51fa\u6765\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\u30b3\u30de\u30f3\u30c9\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b`family`\u306fTask\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u3082\u306e\u3067\u3001Task Definition\u306e\u5b9a\u7fa9\u3092\u5909\u66f4\u3057\u3001\u540c\u4e00\u306efamily\u3067Task\u3092\u767b\u9332\u3059\u308b\u3068`revision`\u304c\u66f4\u65b0\u3055\u308c\u307e\u3059\u3002Task\u306f`wordpress:1`\u3084`wordpress:2`\u306e\u3088\u3046\u306bTask\u540d\u3068revision\u306e\u7d44\u307f\u5408\u308f\u305b\u3067ECS\u5185\u3067\u8b58\u5225\u3055\u308c\u308b\u305f\u3081\u3001\u8d77\u52d5\u6642\u306brevision\u3092\u6307\u5b9a\u3057\u3001CPU\u3084\u30e1\u30e2\u30ea\u306e\u5272\u5f53\u3092\u5909\u3048\u305fTask\u3092\u8907\u6570\u7528\u610f\u3057\u3066\u7528\u9014\u306b\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3068\u3044\u3063\u305f\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u307e\u305f\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\u3082\u53c2\u7167\u3067\u304d\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs list-task-definitions\u3000--profile ecs-preview\n```\n\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\n\n```json\n{\n  \"taskDefinitionArns\": [\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:2\",\n    \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/redis:1\",\n    ......\n  ]\n}\n```\n\u767b\u9332\u3055\u308c\u3066\u3044\u308bTask\u4e00\u89a7\n\n## Task\u306e\u5b9f\u884c\n\u3067\u306f\u5b9f\u969b\u306b\u5148\u307b\u3069\u767b\u9332\u3057\u305fTask\u3092\u5b9f\u884c\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nECS\u3067\u306f\u3001Task\u306e\u5b9f\u884c\u65b9\u6cd5\u304c\u73fe\u57282\u7a2e\u985e\u5b58\u5728\u3057\u307e\u3059\u3002\n\n- \u30af\u30e9\u30b9\u30bf\u5185\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u30ea\u30bd\u30fc\u30b9\u3092\u6301\u3063\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u30e9\u30f3\u30c0\u30e0 (`run-task`\u30b3\u30de\u30f3\u30c9)\n- Task\u5b9f\u884c\u6642\u306b\u6307\u5b9a\u3057\u305f\u7279\u5b9a\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f7f\u7528 (`start-task`\u30b3\u30de\u30f3\u30c9)\n\n`start-task`\u30b3\u30de\u30f3\u30c9\u306f\u72ec\u81ea\u306eECS\u306e\u30ab\u30b9\u30bf\u30e0\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u306b\u3088\u308aContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ca0\u8377\u72b6\u6cc1\u3084Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306b\u3088\u308a\u7279\u5b9a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001ECS\u3068\u306e\u9023\u643a\u90e8\u5206\u3092\u72ec\u81ea\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8ca0\u8377\u72b6\u6cc1\u306b\u5f71\u97ff\u3092\u53d7\u3051\u306b\u304f\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u5834\u5408\u306f`run-task`\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u30ea\u30bd\u30fc\u30b9\u306e\u7a7a\u3044\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u7684\u306bECS\u304c\u30af\u30e9\u30b9\u30bf\u5185\u304b\u3089\u63a2\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3055\u305b\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u304c\u697d\u306b\u306a\u308a\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs run-task --cluster \u30af\u30e9\u30b9\u30bf\u540d --task-definition wordpress:1 --count 1\u3000--profile ecs-preview\n```\n\n```json\n{\n  \"failures\": [],\n  \"tasks\": [\n    {\n     \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n     \"overrides\": {\n       \"containerOverrides\": [\n         {\n           \"name\": \"wp\"\n         },\n         {\n            \"name\": \"mysql\"\n         }\n       ]\n     },\n     \"lastStatus\": \"PENDING\",\n     \"containerInstanceArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container-instance/d79fbdc9-7099-4c5c-863f-62ebea76cdba\",\n     \"desiredStatus\": \"RUNNING\",\n     \"taskDefinitionArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task-definition/wordpress:1\",\n     \"containers\": [\n       {\n         \"containerArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container/fbb9f38f-45b5-460b-921d-459f3fd05c31\",\n         \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n          \"lastStatus\": \"PENDING\",\n          \"name\": \"wp\"\n       },\n       {\n          \"containerArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:container/7d7a9f81-9201-49b5-8379-6bba6ce905ae\",\n          \"taskArn\": \"arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb\",\n          \"lastStatus\": \"PENDING\",\n          \"name\": \"mysql\"\n         }\n       ]\n     }\n  ]\n}\n```\n\n```shell-session\n$ aws ecs start-task --cluster \u30af\u30e9\u30b9\u30bf\u540d --task-definition wordpress:1 --container-instances\u300029f000f6-73ed-4b2f-9a79-4fc7209d6730 d79fbdc9-7099-4c5c-863f-62ebea76cdba --profile ecs-preview\n```\n\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u76f4\u5f8c\u306f`\"desiredStatus\": \"RUNNING\"`\u30fb`\"lastStatus\": \"PENDING\"`\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304b\u3089\u8d77\u52d5\u3092\u5f85\u3063\u3066\u3044\u308b\u72b6\u614b\u3067\u3059\u3002`describe-tasks`\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u73fe\u5728\u306e\u8d77\u52d5\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059(\u30b3\u30de\u30f3\u30c97)\u3002`\"lastStatus\": \"RUNNING\"`\u306b\u5909\u308f\u3063\u3066\u3044\u308b\u3068Task\u306e\u8d77\u52d5\u304c\u6210\u529f\u3057\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\n(--tasks\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3057\u3066\u3044\u308bID\u306f\u4eca\u56de\u306e\u5834\u5408\u306e\u4f8b\u3067\u3059)\n$ aws ecs describe-tasks --cluster default --tasks 3f638959-cea0-402a-a1f6-017d3bd324fb --profile ecs-preview\n```\n\nWordPress\u30fbMySQL\u306eTask\u306e\u8d77\u52d5\u304c\u6b63\u5e38\u306b\u5b8c\u4e86\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306ePublic IP\u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068WordPress\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\u65e2\u306b\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u3055\u3089\u306b\u8d77\u52d5\u3057\u3066\u8ca0\u8377\u5206\u6563\u3092\u884c\u3046\u5834\u5408\u306a\u3069\u306f\u3001\u65b0\u898f\u306b\u8d77\u52d5\u3057\u305f\u3044\u30b3\u30f3\u30c6\u30ca\u6570\u3092\u6307\u5b9a\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u6307\u5b9a\u3057\u305f\u30af\u30e9\u30b9\u30bf\u306b\u7a7a\u304d\u30ea\u30bd\u30fc\u30b9\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306f\u5931\u6557\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u305d\u306e\u5834\u5408\u306f\u65b0\u305f\u306bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3055\u305b\u308b\u3053\u3068\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u5897\u52a0\u3055\u305b\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u3044\u308b\u3001Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u554f\u984c\u304c\u767a\u751f\u3057\u305f\u5834\u5408\u306f\u3001start-task\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5065\u5168\u306aContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e0a\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u660e\u793a\u7684\u306b\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u969c\u5bb3\u3078\u306e\u5bfe\u5fdc\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u5404\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u72b6\u6cc1\u3084\u505c\u6b62\u51e6\u7406\u306a\u3069\u306fECS Container Agent\u3092\u901a\u3057\u3066ECS\u306e\u30b7\u30b9\u30c6\u30e0\u3068\u3084\u308a\u53d6\u308a\u304c\u884c\u308f\u308c\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u6b63\u5e38\u3082\u3057\u304f\u306f\u4f55\u3089\u304b\u306e\u7406\u7531\u3067\u7570\u5e38\u7d42\u4e86\u3057\u305f\u5834\u5408\u3082\u691c\u77e5\u3057ECS\u306e\u30b7\u30b9\u30c6\u30e0\u3078\u901a\u77e5\u3055\u308c\u308b\u306e\u3067\u3001 describe-tasks\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u6cc1\u3092\u78ba\u8a8d\u3057\u5bfe\u51e6\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\nTask\u5b9f\u884c\u6642\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u8981\u6c42\u6570\u8d77\u52d5\u3059\u308b\u305f\u3081\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u4e0d\u8db3\u3057\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u51fa\u6765\u306a\u3044\u5834\u5408\u306f`failures`\u3068\u3057\u3066API\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u5374\u3055\u308c\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u4e2d\u306b\u4e0d\u8db3\u3057\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\n\n```json\n{\n    \"failures\": [\n        {\n            \"reason\": \"AGENT\",\u3000//ECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u3066\u3044\u306a\u3044\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        },\n        {\n            \"reason\": \"RESOURCE:MEMORY\",  //\u30e1\u30e2\u30ea\u304c\u4e0d\u8db3\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        },\n        {\n            \"reason\": \"RESOURCE:CPU\",  //CPU\u304c\u4e0d\u8db3\n            \"arn\": \"\u301c\u301c\u301c\u30b3\u30f3\u30c6\u30ca\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9arn\u301c\u301c\u301c\u301c\"\n        }\n    ],\n    \"tasks\": []\n}\n```\n\n## Task\u306e\u505c\u6b62\n\u4f7f\u7528\u304c\u7d42\u4e86\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u505c\u6b62\u3057\u3066\u30ea\u30bd\u30fc\u30b9\u3092\u958b\u653e\u3059\u308b\u306b\u306f\u3001\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u3092`stop-task`\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u505c\u6b62\u3055\u305b\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs stop-task --cluster default --task 3f638959-cea0-402a-a1f6-017d3bd324fb\n```\n\nTask\u306e\u7d42\u4e86\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5373\u5ea7\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3055\u308c\u308b\u305f\u3081\u3001\u7d42\u4e86\u524d\u306e\u51e6\u7406\u304c\u5fc5\u8981\u3067\u3042\u308c\u3070\u8003\u616e\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n## Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u304b\u3089\u5916\u3059\n\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u305fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u505c\u6b62\u30fb\u30bf\u30fc\u30df\u30cd\u30fc\u30c8\u3057\u3066\u3082\u30af\u30e9\u30b9\u30bf\u304b\u3089\u81ea\u52d5\u3067\u767b\u9332\u306f\u89e3\u9664\u3055\u308c\u307e\u305b\u3093\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306b\u81ea\u52d5\u7684\u306b\u6709\u52b9\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(ECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u3066\u3044\u308b)\u306e\u307f\u4f7f\u7528\u3055\u308c\u308b\u305f\u3081\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u306b\u554f\u984c\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u53ef\u80fd\u306a\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3069\u3046\u304b\u306f`describe-container-instances`API\u306e\u7d50\u679c\u3067\u5224\u65ad\u51fa\u6765\u307e\u3059\u3002\u30ec\u30b9\u30dd\u30f3\u30b9\u4e2d\u306e\"agentConnected\": false`\u3068\u306a\u3063\u3066\u3044\u308b\u5834\u5408\u306fECS Container Agent\u3068\u901a\u4fe1\u304c\u51fa\u6765\u306a\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306a\u305f\u3081\u30b3\u30f3\u30c6\u30ca\u306e\u914d\u7f6e\u306f\u884c\u308f\u308c\u306a\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30af\u30e9\u30b9\u30bf\u304b\u3089\u767b\u9332\u3092\u89e3\u9664\u3059\u308b\u5834\u5408\u306f`deregister-container-instance`API\u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30b9\u30bf\u304b\u3089Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u308a\u9664\u304d\u307e\u3059\u3002\u3053\u306e\u6642\u3001\u53d6\u308a\u9664\u3053\u3046\u3068\u3057\u3066\u3044\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u3067\u30b3\u30f3\u30c6\u30ca\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u5b9f\u884c\u304c\u5931\u6557\u3057\u307e\u3059\u3002\u5f37\u5236\u7684\u306b\u53d6\u308a\u5916\u3059\u5834\u5408\u306f`--force`\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```shell-session\n$ aws ecs deregister-container-instance --container-instance db2cc682-a63c-47b7-9d66-fd9269fc8f56\n```\n\n```shell-session\n$ aws ecs deregister-container-instance --container-instance db2cc682-a63c-47b7-9d66-fd9269fc8f56 --force --profile ecs-preview\n```\n\n## log\nECS Container Agent\u306e\u30ed\u30b0\u306f `/var/log/ecs/`\u4ee5\u4e0b\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u52d5\u4f5c\u306e\u78ba\u8a8d\u3084\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306a\u3069\u306b\u306f\u3001EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002ECS Container Agent\u3068ECS API\u3068\u306e\u30cf\u30fc\u30c8\u30d3\u30fc\u30c8\u30fb\u5236\u5fa1\u60c5\u5831\u306e\u3084\u308a\u3068\u308a\u306e\u30ed\u30b0\u3082\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u306a\u306e\u3067\u3001\u3069\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u304cECS API\u3068\u3084\u308a\u3068\u308a\u3055\u308c\u3066\u3044\u308b\u304b\u3001Dcoker\u30b3\u30f3\u30c6\u30ca\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u9032\u884c\u72b6\u6cc1\u30fb\u8d77\u52d5\u30fb\u505c\u6b62\u51e6\u7406\u3067\u51fa\u529b\u3055\u308c\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3084\u30a8\u30e9\u30fc\u60c5\u5831\u3082\u3053\u3053\u3067\u78ba\u8a8d\u51fa\u6765\u307e\u3059\u3002\n\n```shell-session\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Task change event\" module=TaskEngine state=3\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Container change event\" module=TaskEngine event=\"{TaskArn:arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb ContainerName:mysql Status:3 Reason: ExitCode:<nil> PortBindings:[] TaskStatus:3}\"\nt=2015-03-02T01:30:01+0000 lvl=info msg=\"Top of ApplyTaskState\" module=TaskEngine task=\"wp-5 arn:aws:ecs:us-east-1:xxxxxxxxxxxx:task/3f638959-cea0-402a-a1f6-017d3bd324fb, Overrides: {} Status: CREATED(R\nUNNING) Containers: mysql,wp,\"\nt=2015-03-02T01:30:02+0000 lvl=info msg=\"MinContainerStatus is RUNNING\" module=TaskEngine\n```\n\nECS\u3092\u4f7f\u7528\u3057\u305f\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u4ee5\u4e0b\u306e2\u70b9\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n- \u30af\u30e9\u30b9\u30bf\u5185\u306eContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30ea\u30bd\u30fc\u30b9(CPU/\u30e1\u30e2\u30ea/\u30dd\u30fc\u30c8)\n- \u30b3\u30f3\u30c6\u30ca\u5185\u306e\u30ed\u30b0\u306e\u7ba1\u7406\n\n\u30af\u30e9\u30b9\u30bf\u5185\u3067\u4f7f\u7528\u3067\u304d\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u306e\u7dcf\u91cf\u3092\u76e3\u8996\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u65b0\u898f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u8ca0\u8377\u5206\u6563\u3092\u3059\u308b\u5834\u5408\u3084\u65b0\u898f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u30b5\u30fc\u30d3\u30b9\u3092\u62e1\u5145\u3055\u305b\u308b\u5834\u5408\u306b\u30ea\u30bd\u30fc\u30b9\u4e0d\u8db3\u3067\u8ffd\u52a0\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u51fa\u6765\u306a\u3044\u3068\u3044\u3063\u305f\u3053\u3068\u3092\u56de\u907f\u51fa\u6765\u307e\u3059\u3002AWS Command Line Interface\u306edescribe-container-instances\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u5404Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eCPU\u3084\u30e1\u30e2\u30ea\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3092\u53d6\u5f97\u3057\u76e3\u8996\u30c4\u30fc\u30eb\u3084Amazon CloudWatch\u306e\u30ab\u30b9\u30bf\u30e0\u30e1\u30c8\u30ea\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3057\u30ea\u30bd\u30fc\u30b9\u306e\u6b8b\u91cf\u304c\u95be\u5024\u3092\u4e0b\u56de\u3063\u305f\u7279\u306b\u30a2\u30e9\u30fc\u30c8\u306e\u767a\u5831\u3084\u3001Auto Scaling\u3092\u4f7f\u7528\u3057Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u81ea\u52d5\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u6b8b\u30ea\u30bd\u30fc\u30b9\u3092\u4e00\u5b9a\u306b\u4fdd\u3061Task\u3092\u3044\u3064\u3067\u3082\u5b9f\u884c\u51fa\u6765\u308b\u72b6\u614b\u306b\u4fdd\u3066\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u4f8b\u306fAWS Command Line Interface\u3092\u4f7f\u7528\u3057\u3066\u3001\u30af\u30e9\u30b9\u30bf\u30ea\u30bd\u30fc\u30b9\u306e\u53d6\u5f97\u304b\u3089CoudWatch\u3078\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u767b\u9332\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3067\u3059\u3002\u3053\u306e\u69d8\u306a\u30b9\u30af\u30ea\u30d7\u30c8\u3092CRON\u3067\u5b9a\u671f\u5b9f\u884c\u3059\u308b\u3053\u3068\u3067CloudWatch\u3067\u30af\u30e9\u30b9\u30bf\u304c\u73fe\u5728\u6301\u3063\u3066\u3044\u308bCPU\u3068\u30e1\u30e2\u30ea\u30ea\u30bd\u30fc\u30b9\u306e\u72b6\u6cc1\u3092\u76e3\u8996\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\nTask\u3067\u8d77\u52d5\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u306f\u3001stop-task\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u5373\u5ea7\u306b\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3055\u308c\u308b\u305f\u3081\u3001\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u751f\u6210\u3055\u308c\u53d6\u5f97\u3044\u3066\u304a\u304d\u305f\u3044\u30ed\u30b0\u306fAmazon CloudWatch logs\u3084[Fluentd](http://www.fluentd.org/)\u306a\u3069\u3092\u4f7f\u7528\u3057Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5916\u90e8\u306b\u53ce\u96c6\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001\u30ed\u30b0\u306e\u4fdd\u5168\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u7d42\u4e86\u5f8c\u3082\u30ed\u30b0\u306e\u78ba\u8a8d\u304c\u53ef\u80fd\u3067\u3059\u3002\n\nECS\u306e\u7ba1\u7406\u3067\u306f\u3001Cluster\u5185\u306b\u5b58\u5728\u3059\u308bContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u72b6\u6cc1\u3092\u628a\u63e1\u3057\u3001\u3044\u3064\u3067\u3082Task\u304c\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3053\u3068\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3057\u305f\u3042\u3068\u3082\u5927\u5207\u306a\u30ed\u30b0\u3084\u30d5\u30a1\u30a4\u30eb\u306f\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u4e2d\u306b\u30b3\u30f3\u30c6\u30ca\u5916\u90e8\u306b\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002\n\n```bash\n#!/bin/sh\n\nprofile=ecs-preview\necs_clusters=($(aws ecs list-clusters --profile ${profile} | jq -r '.clusterArns[]'| sed -e 's/^.\\+\\/\\(.\\+\\)$/\\1/'))\n\nfor cluster in ${ecs_clusters[@]}; do\n  remaining_cpu=0\n  remaining_memory=0\n  cluster_instances=($(aws ecs list-container-instances --cluster ${cluster} --profile ${profile} | jq -r '.containerInstanceArns[]'))\n\n  for instance_arn in ${cluster_instances[@]}; do\n    cpu=($(aws ecs describe-container-instances --cluster ${cluster}  --container-instances ${instance_arn} --profile ${profile} | jq -r '.containerInstances[].remainingResources[]|select(.name == \"CPU\")|.integerValue'))\n    remaining_cpu=$((remaining_cpu + cpu))\n\n    memory=($(aws ecs describe-container-instances --cluster ${cluster} --container-instances ${instance_arn} --profile ${profile} | jq -r '.containerInstances[].remainingResources[]|select(.name == \"MEMORY\")|.integerValue'))\n    remaining_memory=$((remaining_memory + memory))\n  done\n\n  ($(aws cloudwatch put-metric-data --namespace 'ECS Cluster/CPU' --dimensions ClusterName=${cluster} --metric-name 'Remaining CPU' --value ${remaining_cpu} --unit Count))\n\n  ($(aws cloudwatch put-metric-data --namespace 'ECS Cluster/MEMORY' --dimensions ClusterName=${cluster} --metric-name 'Remaining MEMORY' --value ${remaining_memory} --unit Megabits))\ndone\n```\n\n![rcpu](https://qiita-image-store.s3.amazonaws.com/0/4769/4ca0342a-5a0a-70ee-5120-953e9a14fb0d.png)\n\n![rmemory](https://qiita-image-store.s3.amazonaws.com/0/4769/021afb76-4584-2a84-8bdc-1673b583fa32.png)\n\n\n# \u307e\u3068\u3081\nAWS\u306eDocker\u30b3\u30f3\u30c6\u30ca\u3092\u4f7f\u7528\u3057\u305f\u65b0\u3057\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308bAmazon EC2 Container Service\u306b\u3064\u3044\u3066\u6982\u8981\u3092\u304a\u4f1d\u3048\u3057\u307e\u3057\u305f\u3002Amazon EC2 Container Service\u306e\u767b\u5834\u306b\u3088\u3063\u3066EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u4eca\u307e\u3067\u3088\u308a\u3082\u67d4\u8edf\u306b\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u30b5\u30fc\u30d3\u30b9\u3084\u74b0\u5883\u3054\u3068\u306bDocker\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u7528\u9014\u306b\u5408\u308f\u305b\u305f\u30af\u30e9\u30b9\u30bf\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u3067\u3001\u958b\u767a\u30fb\u30c6\u30b9\u30c8\u74b0\u5883\u3067\u306f\u96c6\u7d04\u5ea6\u3092\u3042\u3052\u3066\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3057\u3001\u672c\u756a\u74b0\u5883\u3067\u306f\u6f64\u6ca2\u306a\u30ea\u30bd\u30fc\u30b9\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5272\u308a\u5f53\u3066\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u884c\u3046\u306a\u3069\u3082AWS\u3067\u5bb9\u6613\u306b\u5b9f\u73fe\u53ef\u80fd\u3067\u3059\u3002AWS CLI\u30c4\u30fc\u30eb\u3092\u6d3b\u7528\u3057\u3001Docker\u30b3\u30f3\u30c6\u30ca\u306e\u30d3\u30eb\u30c9\u30fbCI\u304c\u901a\u904e\u3057\u305f\u3089\u81ea\u52d5\u7684\u306bTask\u30fb\u30af\u30e9\u30b9\u30bf\u306e\u767b\u9332\u3084\u30b3\u30f3\u30c6\u30ca\u306e\u8d77\u52d5\u505c\u6b62\u3082\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002\n\n# \u304a\u307e\u3051\nECS Container Agent\u306b\u306f\u3044\u304f\u3064\u304b\u8a2d\u5b9a\u51fa\u6765\u308b\u9805\u76ee\u304c\u3042\u308a\u307e\u3059\u3002\u8a2d\u5b9a\u306f`ecs.config`\u306b\u74b0\u5883\u5909\u6570\u3092\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u5909\u66f4\u53ef\u80fd\u3067\u3059\u3002ecs.config\u3078\u306e\u74b0\u5883\u5909\u6570\u306e\u8a18\u8ff0\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u6642\u306bUser Data\u3067\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u3068\u7c21\u5358\u3067\u3059\u3002\n\n\u8a8d\u8a3c\u60c5\u5831\u306f\u57fa\u672c\u7684\u306b\u306fEC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u7684\u306b\u53d6\u5f97\u3059\u308b\u306e\u3067\u3001ECS API\u30a2\u30af\u30bb\u30b9\u7528\u306e`AWS_ACCESS_KEY_ID`\u3084`AWS_SECRET_ACCESS_KEY`\u306a\u3069\u306f\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u8a18\u8ff0\u3059\u308b\u306e\u3067\u306f\u306a\u304fIAM Role\u3067\u8a2d\u5b9a\u3059\u308b\u3053\u3068\u3067\u5b89\u5168\u306b\u8a8d\u8a3c\u60c5\u5831\u3092ECS Container Agent\u306b\u6e21\u305b\u308b\u305f\u3081IAM Role\u306e\u4f7f\u7528\u3092\u63a8\u85a6\u3057\u307e\u3059\u3002`ECS_RESERVED_PORTS`\u306fContainer\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306b\u76e3\u8996\u30c4\u30fc\u30eb\u306a\u3069\u306e\u72ec\u81ea\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5c0e\u5165\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u306b\u4e8b\u524d\u306b\u4f7f\u7528\u30dd\u30fc\u30c8\u3092\u4e88\u7d04\u3057\u3066\u304a\u304f\u3053\u3068\u3067\u3001Task\u3067\u8d77\u52d5\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3068\u30dd\u30fc\u30c8\u304c\u91cd\u8907\u3057\u3066Task\u304c\u5931\u6557\u3059\u308b\u3068\u3044\u3046\u3053\u3068\u3092\u9632\u3050\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n| \u74b0\u5883\u5909\u6570              | \u8aac\u660e                                                                                                           | Default\u5024                         |\n|-----------------------|----------------------------------------------------------------------------------------------------------------|-----------------------------------|\n| ECS_CLUSTER           | Cluster\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6240\u5c5e\u3055\u305b\u308b\u30af\u30e9\u30b9\u30bf\u540d                                                                      | default                           |\n| ECS_RESERVED_PORTS    | Container\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u4e88\u3081\u4f7f\u7528\u4e88\u5b9a\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u4e00\u89a7                                                            | [22, 2375, 2376, 51678]           |\n| AWS_DEFAULT_REGION    | ECS Container Agent\u304c\u30a2\u30af\u30bb\u30b9\u3059\u308bECS API\u306e\u30ea\u30fc\u30b8\u30e7\u30f3                                                           | EC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97 |\n| AWS_ACCESS_KEY_ID     | ECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc                                                                        | EC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97 |\n| AWS_SECRET_ACCESS_KEY | ECS API\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc                                                                    | EC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97 |\n| DOCKER_HOST           | Docker\u30c7\u30fc\u30e2\u30f3\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u3084\u308a\u3068\u308a\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b\u30db\u30b9\u30c8                                               | unix:///var/run/docker.sock       |\n| ECS_LOGLEVEL          | \u30ed\u30b0\u30ec\u30d9\u30eb (<crit>,<error>,<warn>,<info>,<debug>\\)                                                             | warn                              |\n| ECS_LOGFILE           | \u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\u3092\u66f8\u304d\u51fa\u3059\u30d1\u30b9\u3068\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\u3002\u3053\u306e\u5024\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3068ECS_LOGLEVEL\u3092\u7121\u8996\u3057\u3066\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b | blank                             |\n| ECS_BACKEND_HOST      | ECS API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30db\u30b9\u30c8\u540d                                                                                  | ecs.REGION.amazonaws.com          |\n| ECS_BACKEND_PORT      | ECS API\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30dd\u30fc\u30c8\u756a\u53f7                                                                                | 443                               |\n| AWS_SESSION_TOKEN     | \u4e00\u6642\u7684\u306a\u8a8d\u8a3c\u306b\u4f7f\u7528\u3059\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u30c8\u30fc\u30af\u30f3                                                                       | EC2\u30e1\u30bf\u30c7\u30fc\u30bf\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u81ea\u52d5\u53d6\u5f97 |\n\n## \u6700\u65b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\nPreview\u4e2d\u306eECS\u3067\u3059\u304c\u3001\u4eca\u56de\u89e6\u308c\u306a\u304b\u3063\u305f\u6a5f\u80fd\u3067\u4ee5\u4e0b\u306e\u69d8\u306a\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\n\n- Mesos Scheduler\u5bfe\u5fdc\n    - https://aws.amazon.com/blogs/compute/cluster-management-with-amazon-ecs/\n    - https://github.com/awslabs/ecs-mesos-scheduler-driver\n\n- Private repository\u5bfe\u5fdc / Volume mount\u5bfe\u5fdc\n    - https://aws.amazon.com/blogs/aws/ec2-container-service-ecs-update-access-private-docker-repos-mount-volumes-in-containers/\n\n# \u304a\u7d04\u675f\n\u3053\u3061\u3089\u306f\u500b\u4eba\u306e\u610f\u898b\u3067\u4f1a\u793e\u3068\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\u304a\u7d04\u675f\u3067\u3059\u3002\n", "tags": ["AWS", "ECS", "docker"]}