{"context": "\n\n\u7d4c\u7def\n\u666e\u6bb5rails\u3067mongodb\u3092\u4f7f\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001sharding\u5468\u308a\u3092\u5168\u304f\u308f\u304b\u3063\u3068\u3089\u3093\u306e\u3067\u3001\ndocker-compose\u3092\u5229\u7528\u3057\u3066\u691c\u8a3c\u3002\n\u73fe\u72b6\u306e\u904b\u7528\u4e0a\u306e\u554f\u984c\u89e3\u6c7a\u304c\u3067\u304d\u308b\u304b\u8abf\u67fb\u3057\u3066\u307f\u305f\u3002\n\uff08\u9593\u9055\u3063\u305f\u3053\u3068\u3092\u66f8\u3044\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u7de8\u96c6\u30ea\u30af\u30a8\u30b9\u30c8\u3084\u6307\u6458\u3057\u3066\u3082\u3089\u3048\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\uff09\n\n\u73fe\u72b6\u306e\u69cb\u6210\u3068\u8ab2\u984c\n\n\u69cb\u6210\nmongodb\u306b\u9650\u3089\u305asharding\u3057\u305f\u6642\u306e\u904b\u7528\u306f\u8f9b\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3001\n\u73fe\u72b6sharding\u306f\u5229\u7528\u305b\u305a\u3001\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3060\u3051\u7d44\u3093\u3067\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nrails\u306eodm\u3068\u3057\u3066\u6709\u540d\u306amongoid\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u63a5\u7d9a\u60c5\u5831\u304c\u3053\u3093\u306a\u611f\u3058\u3067\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nconfig/mongoid.yml\nproduction:\n  clients:\n    default:\n      database: mongodb_database\n      hosts:\n        - primary:27017\n        - secondary1:27017\n        - secondary2:27017\n\n\n\n\n\u8ab2\u984c\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3084\u3001AWS\u306e\u57fa\u76e4\u30e1\u30f3\u30c6\u306b\u3076\u3061\u5f53\u305f\u3063\u305f\u6642\u306b\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u5165\u308c\u66ff\u3048\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\n\u5165\u308c\u66ff\u3048\u4f5c\u696d\u3092\u884c\u3046\u6642\u306a\u3069\u306b\u63a5\u7d9a\u60c5\u5831\u3092\u66f4\u65b0\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5fc5\u8981\u306b\u306a\u308a\u3081\u3093\u3069\u304f\u3055\u3044\u3057\u3001\u30df\u30b9\u308a\u305d\u3046\u3002\n\n\u89e3\u6c7a\u7b56\nsharding\u30921\u7cfb\u7d71\u3060\u3051\u5229\u7528\u3057\u3066\u3001mongod\u306e\u63a5\u7d9a\u3092mongos\u7d4c\u7531\u306e\u63a5\u7d9a\u306b\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001db\u306e\u63a5\u7d9a\u5148\u306e\u60c5\u5831\u306a\u3069\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u6301\u305f\u306a\u304f\u3066\u3088\u304f\u3059\u308b\u3002\n\nconfig/mongoid.yml\nproduction:\n  clients:\n    default:\n      database: mongodb_database\n      hosts:\n        - localhost:27017\n\n\n(\u56f3\u304c\u5168\u90e8primary\u306b\u306a\u3063\u3066\u3066\u304a\u304b\u3057\u3044\u3067\u3059\u304c\u3001\u5f8c\u3067\u5dee\u3057\u66ff\u3048\u3068\u304d\u307e\u3059)\n\nmongos\u306fmonit\u306a\u3069\u3067\u76e3\u8996\u518d\u8d77\u52d5\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u8003\u3048\u308b\n\n\u691c\u8a3c\u74b0\u5883\nmac\ndocker-for-mac\nrails\u30a2\u30d7\u30ea\u306fhost\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3001\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306fdocker\u4e0a\u3067\u52d5\u304b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\nmongodb\n\u2514\u2500\u2500 docker-compose.yml\n\nmongodb\u4ee5\u5916\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306frails\u306eapp\u306e\u65b9\u306edocker-compose\u306b\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u691c\u8a3c\u7528\u306brails app \u306edocker-compose\u306emongodb\u306e\u8a18\u8ff0\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3001\n\u5225\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u3063\u3066mongodb\u3060\u3051\u5225\u9014\u691c\u8a3c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\ndocker-compose.yml\nversion: '2'\nservices:\n  s1:\n    image: mongo:3.2\n    ports:\n      - \"27017:27017\"\n    command: mongos --configdb confRep1/c1:27019,c2:27019,c3:27019\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c1\n      - c2\n      - c3\n  s2:\n    image: mongo:3.2\n    ports:\n      - \"27018:27017\"\n    command: mongos --configdb confRep1/c1:27019,c2:27019,c3:27019\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c1\n      - c2\n      - c3\n  c1:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c2\n      - c3\n  c2:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c3\n  c3:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n  d1:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n  d2:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d3\n      - d4\n      - d5\n      - d6\n  d3:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d4\n      - d5\n      - d6\n  d4:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d5\n      - d6\n  d5:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d6\n  d6:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n\n\n\n\u691c\u8a3c\u5185\u5bb9\nd1,d2,d3\u3067\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u7d44\u307f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u8fbc\u3080\u3002\nd4,d5,d6\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u53c2\u52a0\u3055\u305b\u3001d4\u3092primary\u306b\u6607\u683c\u3055\u305b\u308b\u3002\nd1,d2,d3\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304b\u3089\u5916\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u63a5\u7d9a\u60c5\u5831\u304c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u304c\u554f\u984c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u691c\u8a3c\u624b\u9806\ndocker-compose up\n\nconfig server\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304c\u7d44\u3081\u3066\u306a\u3044\u306e\u3067\u3001\nmongos\u30b5\u30fc\u30d0\u30fc\u304c\u8352\u3076\u3063\u3066log\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\nconfig\u30b5\u30fc\u30d0\u30fc\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\ndocker exec -it mongodb_c1_1 mongo --port 27019\n\n# mongo shell\nrs.initiate()\nrs.add(\"c2:27019\")\nrs.add(\"c3:27019\")\n# config\u30b5\u30fc\u30d0\u30fc\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067port:27019\u3092\u4f7f\u3046\u3089\u3057\u3044\n\n\n\nmongod\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\n\ndocker exec -it mongodb_d1_1 mongo\n\n# mongo shell\nrs.initiate()\nrs.add(\"d2\")\nrs.add(\"c3\")\n\n\nmongos\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066shard\u3092\u767b\u9332\u3059\u308b\n\ndocker exec -it mongodb_s1_1 mongo\n\n# mongo shell\nsh.addShard(\"rep1/d2\")\n#\u3000\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u6240\u5c5e\u3057\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3092\uff11\u53f0\u6307\u5b9a\u3059\u308c\u3070\u3044\u3044\u611f\u3058\u306b\u3084\u3063\u3066\u304f\u308c\u308b\n\n\nrails\u30a2\u30d7\u30ea\u306e\u65b9\u3067\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u6295\u5165\n\u63a5\u7d9a\u60c5\u5831\n\nconfig/mongoid.yml\ndevelopment:\n  clients:\n    default:\n      database: development\n      hosts:\n        - localhost:27017\n\n\n\u30c7\u30fc\u30bf\u6295\u5165\u304c\u7d42\u308f\u3063\u305f\u3068\u3053\u308d\u3067mongos2\u306e\u65b9\u3067\u63a5\u7d9a\u3057\u3066\u307f\u308b\n\u63a5\u7d9a\u60c5\u5831\n\nconfig/mongoid.yml\ndevelopment:\n  clients:\n    default:\n      database: development\n      hosts:\n        - localhost:27018 #\u2190port\u3092\u5909\u3048\u305f\n\n\n\nbin/spring stop\nbin/rails c\n\n\n\u3061\u3083\u3093\u3068\u7e4b\u304c\u308a\u307e\u3057\u305f\u3002\n\u4eca\u307e\u3067\u5225\u306emongos\u3067\u4f5c\u696d\u3057\u3066\u3044\u3066\u3082\u3001mongoc\u3067\u60c5\u5831\u304c\u5171\u6709\u3055\u308c\u308b\u306e\u3067\u540c\u3058\u3088\u3046\u306b\u52d5\u304f\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\nshard status\u3092\u78ba\u8a8d\u3059\u308b\u3068\u30a2\u30af\u30c6\u30a3\u30d6\u306amongos\u306e\u6570\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\nmongos> sh.status()\n--- Sharding Status ---\n  sharding version: {\n        \"_id\" : 1,\n        \"minCompatibleVersion\" : 5,\n        \"currentVersion\" : 6,\n        \"clusterId\" : ObjectId(\"585d48811b8e027da3d3da28\")\n}\n  shards:\n        {  \"_id\" : \"rep1\",  \"host\" : \"rep1/8d106239ab63:27017,d2:27017,d3:27017\" }\n  active mongoses:\n        \"3.2.11\" : 2\n  balancer:\n        Currently enabled:  yes\n        Currently running:  no\n        Failed balancer rounds in last 5 attempts:  0\n        Migration Results for the last 24 hours:\n                No recent migrations\n  databases:\n        {  \"_id\" : \"development\",  \"primary\" : \"rep1\",  \"partitioned\" : false }\n\n\u3053\u3053\u304b\u3089\u3001\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306e\u4e2d\u8eab\u3092\u5165\u308c\u66ff\u3048\u3066\u3082\u3001\nrails console\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u4fdd\u3063\u305f\u307e\u307e\u64cd\u4f5c\u304c\u3067\u304d\u308b\u304b\u3092\u691c\u8a3c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\ndocker exec -it mongodb_d1_1 mongo\n\n# mongo shell\n# \u672c\u756a\u74b0\u5883\u3067\u306f\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u8ffd\u52a0\u3059\u308b\u6642\u306b\u53c2\u7167\u3055\u308c\u306a\u3044\u3088\u3046\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n# \u30c7\u30fc\u30bf\u304c\u8ffd\u3044\u3064\u3044\u3066\u306a\u3044\u306e\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u6574\u5408\u6027\u304c\u306a\u3044\u30c7\u30fc\u30bf\u304c\u53c2\u7167\u3055\u308c\u3066\u3057\u307e\u3046\u304b\u3089\u3067\u3059\u3002\n# \u30c7\u30fc\u30bf\u304c\u8ffd\u3044\u3064\u3044\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3001\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u60c5\u5831\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u4eca\u56de\u306f\u691c\u8a3c\u306a\u306e\u3067\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u3084\u3063\u3066\u3044\u307e\u305b\u3093\u3002\nrs.add(\"d4\")\nrs.add(\"d5\")\nrs.add(\"d6\")\n\n\nprimary\u30b5\u30fc\u30d0\u30fc\u3092\u5165\u308c\u66ff\u3048\u307e\u3059\n# mongo shell\nconf = rs.conf()\nconf.members[3].priority = 2\nrs.reconfig(conf)\n\n\nmongod d1,d2,d3\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304b\u3089\u5916\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u305f\u5165\u308c\u7269\u306f\u7dcf\u5165\u308c\u66ff\u3048\u306b\u306a\u308a\u307e\u3057\u305f\u3002\ndocker exec -it mongodb_d4_1 mongo\n\n# mongo shell\nrs.remove(\"8d106239ab63:27017\")\nrs.remove(\"d2:27017\")\nrs.remove(\"d3:27017\")\n\n\nrails console\u306e\u72b6\u6cc1\u306f\u3069\u3046\u304b\n\n\u8aad\u307f\u8fbc\u307f\u3001\u66f8\u304d\u8fbc\u307f\u5171\u306b\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\n\u6700\u5f8c\u306b\u904b\u7528\u5468\u308a\u3067shard\u304c\uff11\u3064\u306e\u6642\u306bconfig\u30b5\u30fc\u30d0\u30fc\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306f\u5fc5\u8981\u306a\u306e\u304b\u3092\u691c\u8a3c\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nmongos,confg\u30b5\u30fc\u30d0\u30fc\u3092kill\u3057\u3066\u69cb\u7bc9\u3057\u76f4\u3057\u305f\u6642\u306b\u3061\u3083\u3093\u3068\u53c2\u7167\u3067\u304d\u308b\u306e\u304b\u3002\n(mongod\u30b5\u30fc\u30d0\u30fc\u306e\u30c7\u30fc\u30bf\u3060\u3051\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u308c\u3070\u3044\u3044\u72b6\u614b\u3067\u3042\u308c\u3070\u5b09\u3057\u3044)\n\nzsh\n# {}\u306e\u90e8\u5206\u306f\u4ed6\u306eshell\u3067\u3067\u304d\u305f\u304b\u81ea\u4fe1\u306a\u3044\u3067\u3059\u3002\ndocker kill mongodb_s{1,2}_1\ndocker rm mongodb_s{1,2}_1\ndocker kill mongodb_c{1,2,3}_1\ndocker rm mongodb_c{1,2,3}_1\n\n\n\n\nmongos\u3068config\u30b5\u30fc\u30d0\u30fc\u3092\u65b0\u3057\u304f\u7acb\u3066\u76f4\u3059\ndocker-compose up -d\n\nconfig\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3057\u306a\u304a\u3059\ndocker exec -it mongodb_c1_1 mongo --port 27019\n\n# mongo shell\nrs.initiate()\nrs.add(\"c2:27019\")\nrs.add(\"c3:27019\")\n\n\n\n\ndocker exec -it mongodb_s1_1 mongo\n\n# mongo shell\nsh.addShard(\"rep1/d4\")\n\n\nrails console\u3067\u78ba\u8a8d\n\n\u8aad\u307f\u8fbc\u307f\u3082\u66f8\u304d\u8fbc\u307f\u3082\u53ef\u80fd\u3002\nrails server\u306e\u65b9\u3067\u3082\u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n\u3000\u307e\u3068\u3081\n1.mongodb\u3067sharding\u30921\u306b\u3057\u3066\u4f7f\u3048\u3070\u3001\u30a2\u30d7\u30ea\u5074\u3067\u63a5\u7d9a\u60c5\u5831\u3092\u5909\u3048\u305a(\u30c7\u30d7\u30ed\u30a4\u306a\u3057)\u306bmongodb\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u3067\u304d\u305d\u3046\u3002\n2.shard1\u306b\u3057\u3066\u304a\u3051\u3070\u3001config\u30b5\u30fc\u30d0\u30fc\u304c\u3076\u3063\u58ca\u308c\u3066\u3082\u4f5c\u308a\u76f4\u305b\u3070\u306a\u3093\u3068\u304b\u306a\u308a\u305d\u3046\u3002(mongoc\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u4e0d\u8981)\n(2\u306b\u95a2\u3057\u3066\u306f\u81ea\u4fe1\u304c\u306a\u3044\u306e\u3067\u3001\u3084\u308b\u306a\u3089\u81ea\u5df1\u8cac\u4efb\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002)\ndocker-compose\u4fbf\u5229\n\u30ed\u30fc\u30ab\u30eb\u3067\u624b\u8efd\u306b\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3068\u304b\u3092docker-compose\u3092\u4f7f\u3048\u3070\u691c\u8a3c\u3067\u304d\u3066\u4fbf\u5229\u3060\u306a\u3068\u611f\u3058\u307e\u3057\u305f\u3002\nelastic search\u3084redis,memcached\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u691c\u8a3c\u306b\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nmongodb\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306e\u691c\u8a3c\u306a\u3069\u306b\u306f\u3068\u3066\u3082\u5411\u3044\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\uff083.2=>3.4\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306f\u624b\u9806\u304c\u591a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u4eca\u56de\u306e\u8a18\u4e8b\u3067\u306f\u898b\u9001\u308a\u307e\u3057\u305f\u3002replica set\u306e\u307f\u3060\u3063\u305f\u3089\u697d\u305d\u3046\u3067\u3059\u3002\uff09\n\u3068\u304f\u306b\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u3068\u5404docker\u306e\u51fa\u529b\u304c\u89b3\u308c\u3066\u308f\u304b\u308a\u3084\u3059\u3044\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n\u3042\u3068\u5168\u7136\u95a2\u4fc2\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u3001mac\u3092\u65b0\u3057\u304f\u3057\u3066\u3001gif\u30a2\u30cb\u30e1\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u30bd\u30d5\u30c8\u3092\u65b0\u3057\u304f\u3057\u305f\u3093\u3067\u3059\u304c\u3001\nGIPHY Capture\u3063\u3066\u30a2\u30d7\u30ea\u304c\u3059\u3054\u304f\u826f\u304b\u3063\u305f\u3067\u3059\u3002\n\u7121\u6599\u3067\u3001\u6700\u521d\u3068\u6700\u5f8c\u30ab\u30c3\u30c8\u3067\u304d\u305f\u308a\u3001\u30d5\u30ec\u30fc\u30e0\u30ec\u30fc\u30c8\u3084\u89e3\u50cf\u5ea6\u3092\u5909\u66f4\u3067\u304d\u305f\u306e\u3067\u3001\u624b\u9806\u66f8\u3068\u304bqiita\u3068\u304b\u306b\u8cbc\u308b\u7528\u9014\u306b\u3044\u3044\u304b\u3068\u3002\n\n## \u7d4c\u7def\n\n\u666e\u6bb5rails\u3067mongodb\u3092\u4f7f\u3046\u3053\u3068\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001sharding\u5468\u308a\u3092\u5168\u304f\u308f\u304b\u3063\u3068\u3089\u3093\u306e\u3067\u3001\ndocker-compose\u3092\u5229\u7528\u3057\u3066\u691c\u8a3c\u3002\n\u73fe\u72b6\u306e\u904b\u7528\u4e0a\u306e\u554f\u984c\u89e3\u6c7a\u304c\u3067\u304d\u308b\u304b\u8abf\u67fb\u3057\u3066\u307f\u305f\u3002\n\uff08\u9593\u9055\u3063\u305f\u3053\u3068\u3092\u66f8\u3044\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u7de8\u96c6\u30ea\u30af\u30a8\u30b9\u30c8\u3084\u6307\u6458\u3057\u3066\u3082\u3089\u3048\u308b\u3068\u5b09\u3057\u3044\u3067\u3059\u3002\uff09\n\n\n## \u73fe\u72b6\u306e\u69cb\u6210\u3068\u8ab2\u984c\n\n### \u69cb\u6210\nmongodb\u306b\u9650\u3089\u305asharding\u3057\u305f\u6642\u306e\u904b\u7528\u306f\u8f9b\u3044\u3068\u3044\u3046\u3053\u3068\u3067\u3001\n\u73fe\u72b6sharding\u306f\u5229\u7528\u305b\u305a\u3001\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3060\u3051\u7d44\u3093\u3067\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nrails\u306eodm\u3068\u3057\u3066\u6709\u540d\u306amongoid\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u63a5\u7d9a\u60c5\u5831\u304c\u3053\u3093\u306a\u611f\u3058\u3067\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```yml:config/mongoid.yml\nproduction:\n  clients:\n    default:\n      database: mongodb_database\n      hosts:\n        - primary:27017\n        - secondary1:27017\n        - secondary2:27017\n```\n\n![image](https://qiita-image-store.s3.amazonaws.com/0/31015/14606c0b-1989-7e5f-0655-ed19337f0698.png)\n\n### \u8ab2\u984c\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30c3\u30d7\u3084\u3001AWS\u306e\u57fa\u76e4\u30e1\u30f3\u30c6\u306b\u3076\u3061\u5f53\u305f\u3063\u305f\u6642\u306b\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306e\u30e1\u30f3\u30d0\u30fc\u306e\u5165\u308c\u66ff\u3048\u3092\u884c\u3046\u306e\u3067\u3059\u304c\u3001\n\u5165\u308c\u66ff\u3048\u4f5c\u696d\u3092\u884c\u3046\u6642\u306a\u3069\u306b\u63a5\u7d9a\u60c5\u5831\u3092\u66f4\u65b0\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u304c\u5fc5\u8981\u306b\u306a\u308a\u3081\u3093\u3069\u304f\u3055\u3044\u3057\u3001\u30df\u30b9\u308a\u305d\u3046\u3002\n\n### \u89e3\u6c7a\u7b56\nsharding\u30921\u7cfb\u7d71\u3060\u3051\u5229\u7528\u3057\u3066\u3001mongod\u306e\u63a5\u7d9a\u3092mongos\u7d4c\u7531\u306e\u63a5\u7d9a\u306b\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u3001db\u306e\u63a5\u7d9a\u5148\u306e\u60c5\u5831\u306a\u3069\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u6301\u305f\u306a\u304f\u3066\u3088\u304f\u3059\u308b\u3002\n\n```yml:config/mongoid.yml\nproduction:\n  clients:\n    default:\n      database: mongodb_database\n      hosts:\n        - localhost:27017\n```\n(\u56f3\u304c\u5168\u90e8primary\u306b\u306a\u3063\u3066\u3066\u304a\u304b\u3057\u3044\u3067\u3059\u304c\u3001\u5f8c\u3067\u5dee\u3057\u66ff\u3048\u3068\u304d\u307e\u3059:bow:)\n![IMG_4668.JPG](https://qiita-image-store.s3.amazonaws.com/0/31015/34a63c0e-799c-cd40-443a-13ef758840f4.jpeg)\n\nmongos\u306fmonit\u306a\u3069\u3067\u76e3\u8996\u518d\u8d77\u52d5\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u8003\u3048\u308b\n\n\n## \u691c\u8a3c\u74b0\u5883\nmac\ndocker-for-mac\nrails\u30a2\u30d7\u30ea\u306fhost\u30de\u30b7\u30f3\u3067\u52d5\u4f5c\u3057\u3001\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306fdocker\u4e0a\u3067\u52d5\u304b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n### \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n```\nmongodb\n\u2514\u2500\u2500 docker-compose.yml\n```\n\nmongodb\u4ee5\u5916\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306frails\u306eapp\u306e\u65b9\u306edocker-compose\u306b\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u691c\u8a3c\u7528\u306brails app \u306edocker-compose\u306emongodb\u306e\u8a18\u8ff0\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u3001\n\u5225\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5207\u3063\u3066mongodb\u3060\u3051\u5225\u9014\u691c\u8a3c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n```yaml:docker-compose.yml\nversion: '2'\nservices:\n  s1:\n    image: mongo:3.2\n    ports:\n      - \"27017:27017\"\n    command: mongos --configdb confRep1/c1:27019,c2:27019,c3:27019\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c1\n      - c2\n      - c3\n  s2:\n    image: mongo:3.2\n    ports:\n      - \"27018:27017\"\n    command: mongos --configdb confRep1/c1:27019,c2:27019,c3:27019\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c1\n      - c2\n      - c3\n  c1:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c2\n      - c3\n  c2:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n      - c3\n  c3:\n    image: mongo:3.2\n    command: mongod --configsvr --replSet confRep1\n    links:\n      - d1\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n  d1:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d2\n      - d3\n      - d4\n      - d5\n      - d6\n  d2:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d3\n      - d4\n      - d5\n      - d6\n  d3:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d4\n      - d5\n      - d6\n  d4:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d5\n      - d6\n  d5:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n    links:\n      - d6\n  d6:\n    image: mongo:3.2\n    command: mongod --replSet rep1\n```\n\n### \u691c\u8a3c\u5185\u5bb9\nd1,d2,d3\u3067\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u7d44\u307f\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u3092\u6d41\u3057\u8fbc\u3080\u3002\nd4,d5,d6\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u53c2\u52a0\u3055\u305b\u3001d4\u3092primary\u306b\u6607\u683c\u3055\u305b\u308b\u3002\nd1,d2,d3\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304b\u3089\u5916\u3057\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u63a5\u7d9a\u60c5\u5831\u304c\u5909\u308f\u3063\u3066\u3044\u306a\u3044\u304c\u554f\u984c\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n### \u691c\u8a3c\u624b\u9806\n\n`docker-compose up`\n![docker-compose-up.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/f881539a-d12f-cda5-8c86-7765df70fae1.gif)\n\nconfig server\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304c\u7d44\u3081\u3066\u306a\u3044\u306e\u3067\u3001\nmongos\u30b5\u30fc\u30d0\u30fc\u304c\u8352\u3076\u3063\u3066log\u3092\u51fa\u529b\u3057\u3066\u3044\u308b\n\nconfig\u30b5\u30fc\u30d0\u30fc\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\n\n```bash\ndocker exec -it mongodb_c1_1 mongo --port 27019\n\n# mongo shell\nrs.initiate()\nrs.add(\"c2:27019\")\nrs.add(\"c3:27019\")\n# config\u30b5\u30fc\u30d0\u30fc\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067port:27019\u3092\u4f7f\u3046\u3089\u3057\u3044\n```\n![config1.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/2f23b0d2-fe40-a82c-c064-ae129b27e282.gif)\n\n![config2.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/11068f29-941b-fa15-2b95-3a3bd6d269c5.gif)\n\nmongod\u306e\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b\n\n```bash\n\ndocker exec -it mongodb_d1_1 mongo\n\n# mongo shell\nrs.initiate()\nrs.add(\"d2\")\nrs.add(\"c3\")\n```\n![mongod.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/193880b8-017e-0979-c892-2e38549c7045.gif)\n\n\n\nmongos\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066shard\u3092\u767b\u9332\u3059\u308b\n\n```bash\n\ndocker exec -it mongodb_s1_1 mongo\n\n# mongo shell\nsh.addShard(\"rep1/d2\")\n#\u3000\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u6240\u5c5e\u3057\u3044\u308b\u30b5\u30fc\u30d0\u30fc\u3092\uff11\u53f0\u6307\u5b9a\u3059\u308c\u3070\u3044\u3044\u611f\u3058\u306b\u3084\u3063\u3066\u304f\u308c\u308b\n```\n![mongos.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/ab23b97b-d639-63ce-e3c2-2832e402d1a7.gif)\n\nrails\u30a2\u30d7\u30ea\u306e\u65b9\u3067\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\u6295\u5165\n\u63a5\u7d9a\u60c5\u5831\n\n```yml:config/mongoid.yml\ndevelopment:\n  clients:\n    default:\n      database: development\n      hosts:\n        - localhost:27017\n```\n\n\u30c7\u30fc\u30bf\u6295\u5165\u304c\u7d42\u308f\u3063\u305f\u3068\u3053\u308d\u3067mongos2\u306e\u65b9\u3067\u63a5\u7d9a\u3057\u3066\u307f\u308b\n\u63a5\u7d9a\u60c5\u5831\n\n```yml:config/mongoid.yml\ndevelopment:\n  clients:\n    default:\n      database: development\n      hosts:\n        - localhost:27018 #\u2190port\u3092\u5909\u3048\u305f\n```\n\n```bash\n\nbin/spring stop\nbin/rails c\n```\n\n![rails_c_1.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/12494226-a387-6438-8562-1665434a0621.gif)\n\n\u3061\u3083\u3093\u3068\u7e4b\u304c\u308a\u307e\u3057\u305f\u3002\n\u4eca\u307e\u3067\u5225\u306emongos\u3067\u4f5c\u696d\u3057\u3066\u3044\u3066\u3082\u3001mongoc\u3067\u60c5\u5831\u304c\u5171\u6709\u3055\u308c\u308b\u306e\u3067\u540c\u3058\u3088\u3046\u306b\u52d5\u304f\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u306d\u3002\nshard status\u3092\u78ba\u8a8d\u3059\u308b\u3068\u30a2\u30af\u30c6\u30a3\u30d6\u306amongos\u306e\u6570\u3082\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```bash\nmongos> sh.status()\n--- Sharding Status ---\n  sharding version: {\n        \"_id\" : 1,\n        \"minCompatibleVersion\" : 5,\n        \"currentVersion\" : 6,\n        \"clusterId\" : ObjectId(\"585d48811b8e027da3d3da28\")\n}\n  shards:\n        {  \"_id\" : \"rep1\",  \"host\" : \"rep1/8d106239ab63:27017,d2:27017,d3:27017\" }\n  active mongoses:\n        \"3.2.11\" : 2\n  balancer:\n        Currently enabled:  yes\n        Currently running:  no\n        Failed balancer rounds in last 5 attempts:  0\n        Migration Results for the last 24 hours:\n                No recent migrations\n  databases:\n        {  \"_id\" : \"development\",  \"primary\" : \"rep1\",  \"partitioned\" : false }\n```\n\n\u3053\u3053\u304b\u3089\u3001\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306e\u4e2d\u8eab\u3092\u5165\u308c\u66ff\u3048\u3066\u3082\u3001\nrails console\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u4fdd\u3063\u305f\u307e\u307e\u64cd\u4f5c\u304c\u3067\u304d\u308b\u304b\u3092\u691c\u8a3c\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n```bash\ndocker exec -it mongodb_d1_1 mongo\n\n# mongo shell\n# \u672c\u756a\u74b0\u5883\u3067\u306f\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u306b\u8ffd\u52a0\u3059\u308b\u6642\u306b\u53c2\u7167\u3055\u308c\u306a\u3044\u3088\u3046\u306a\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n# \u30c7\u30fc\u30bf\u304c\u8ffd\u3044\u3064\u3044\u3066\u306a\u3044\u306e\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089\u6574\u5408\u6027\u304c\u306a\u3044\u30c7\u30fc\u30bf\u304c\u53c2\u7167\u3055\u308c\u3066\u3057\u307e\u3046\u304b\u3089\u3067\u3059\u3002\n# \u30c7\u30fc\u30bf\u304c\u8ffd\u3044\u3064\u3044\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u3001\u53c2\u7167\u3067\u304d\u308b\u3088\u3046\u306b\u60c5\u5831\u3092\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u4eca\u56de\u306f\u691c\u8a3c\u306a\u306e\u3067\u3081\u3093\u3069\u304f\u3055\u3044\u306e\u3067\u3084\u3063\u3066\u3044\u307e\u305b\u3093\u3002\nrs.add(\"d4\")\nrs.add(\"d5\")\nrs.add(\"d6\")\n```\n\n![mongod2.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/7679240d-689c-33da-d189-fce2e242d9f5.gif)\n\nprimary\u30b5\u30fc\u30d0\u30fc\u3092\u5165\u308c\u66ff\u3048\u307e\u3059\n\n```bash\n# mongo shell\nconf = rs.conf()\nconf.members[3].priority = 2\nrs.reconfig(conf)\n```\n\n![mongod3.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/a3d4319f-eeda-84cd-2d0e-d61c5969954f.gif)\n\nmongod d1,d2,d3\u3092\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u304b\u3089\u5916\u3057\u307e\u3059\u3002\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u305f\u5165\u308c\u7269\u306f\u7dcf\u5165\u308c\u66ff\u3048\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```bash\ndocker exec -it mongodb_d4_1 mongo\n\n# mongo shell\nrs.remove(\"8d106239ab63:27017\")\nrs.remove(\"d2:27017\")\nrs.remove(\"d3:27017\")\n```\n\n![mongod4.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/bf6566aa-114e-7ffd-4f57-20bb46c6ea9a.gif)\n\n\nrails console\u306e\u72b6\u6cc1\u306f\u3069\u3046\u304b\n![rails-c2.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/499d79c8-12eb-3e0e-2af3-6b7577566d79.gif)\n\n\u8aad\u307f\u8fbc\u307f\u3001\u66f8\u304d\u8fbc\u307f\u5171\u306b\u3046\u307e\u304f\u3044\u304d\u307e\u3057\u305f\u3002\n\n\u6700\u5f8c\u306b\u904b\u7528\u5468\u308a\u3067shard\u304c\uff11\u3064\u306e\u6642\u306bconfig\u30b5\u30fc\u30d0\u30fc\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306f\u5fc5\u8981\u306a\u306e\u304b\u3092\u691c\u8a3c\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nmongos,confg\u30b5\u30fc\u30d0\u30fc\u3092kill\u3057\u3066\u69cb\u7bc9\u3057\u76f4\u3057\u305f\u6642\u306b\u3061\u3083\u3093\u3068\u53c2\u7167\u3067\u304d\u308b\u306e\u304b\u3002\n(mongod\u30b5\u30fc\u30d0\u30fc\u306e\u30c7\u30fc\u30bf\u3060\u3051\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u308c\u3070\u3044\u3044\u72b6\u614b\u3067\u3042\u308c\u3070\u5b09\u3057\u3044)\n\n```zsh:zsh\n# {}\u306e\u90e8\u5206\u306f\u4ed6\u306eshell\u3067\u3067\u304d\u305f\u304b\u81ea\u4fe1\u306a\u3044\u3067\u3059\u3002\ndocker kill mongodb_s{1,2}_1\ndocker rm mongodb_s{1,2}_1\ndocker kill mongodb_c{1,2,3}_1\ndocker rm mongodb_c{1,2,3}_1\n```\n\n![d-kill1.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/75175a5c-a5c3-96c8-b8b6-07a778e80617.gif)\n\n![d-kill2.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/5bf920fc-d2a1-a8c0-a6a2-5e6826d7768b.gif)\n\n\nmongos\u3068config\u30b5\u30fc\u30d0\u30fc\u3092\u65b0\u3057\u304f\u7acb\u3066\u76f4\u3059\n`docker-compose up -d`\n\n![dc-up-d.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/c1690f9e-f47b-7985-8458-e9a0e1946be6.gif)\n\nconfig\u30b5\u30fc\u30d0\u30fc\u3092\u69cb\u7bc9\u3057\u306a\u304a\u3059\n\n```bash\ndocker exec -it mongodb_c1_1 mongo --port 27019\n\n# mongo shell\nrs.initiate()\nrs.add(\"c2:27019\")\nrs.add(\"c3:27019\")\n```\n![mongos3.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/5e85cc16-45c4-4ee9-c788-482b75793630.gif)\n![mongos4.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/0de2bf07-df60-e076-9f7e-48aced99f07d.gif)\n\n```bash\n\ndocker exec -it mongodb_s1_1 mongo\n\n# mongo shell\nsh.addShard(\"rep1/d4\")\n```\n![mongos5.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/f7b3405a-439e-9e4a-c4f1-a8bb27986e07.gif)\n\nrails console\u3067\u78ba\u8a8d\n![rails-c3.gif](https://qiita-image-store.s3.amazonaws.com/0/31015/543377ac-887e-1e37-6a2c-43c4200a7b6e.gif)\n\u8aad\u307f\u8fbc\u307f\u3082\u66f8\u304d\u8fbc\u307f\u3082\u53ef\u80fd\u3002\nrails server\u306e\u65b9\u3067\u3082\u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n#\u3000\u307e\u3068\u3081\n\n1.mongodb\u3067sharding\u30921\u306b\u3057\u3066\u4f7f\u3048\u3070\u3001\u30a2\u30d7\u30ea\u5074\u3067\u63a5\u7d9a\u60c5\u5831\u3092\u5909\u3048\u305a(\u30c7\u30d7\u30ed\u30a4\u306a\u3057)\u306bmongodb\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u304c\u3067\u304d\u305d\u3046\u3002\n2.shard1\u306b\u3057\u3066\u304a\u3051\u3070\u3001config\u30b5\u30fc\u30d0\u30fc\u304c\u3076\u3063\u58ca\u308c\u3066\u3082\u4f5c\u308a\u76f4\u305b\u3070\u306a\u3093\u3068\u304b\u306a\u308a\u305d\u3046\u3002(mongoc\u306e\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u4e0d\u8981)\n(2\u306b\u95a2\u3057\u3066\u306f\u81ea\u4fe1\u304c\u306a\u3044\u306e\u3067\u3001\u3084\u308b\u306a\u3089\u81ea\u5df1\u8cac\u4efb\u3067\u304a\u9858\u3044\u3057\u307e\u3059\u3002)\n\ndocker-compose\u4fbf\u5229\n\u30ed\u30fc\u30ab\u30eb\u3067\u624b\u8efd\u306b\u30ec\u30d7\u30ea\u30ab\u30bb\u30c3\u30c8\u3068\u304b\u3092docker-compose\u3092\u4f7f\u3048\u3070\u691c\u8a3c\u3067\u304d\u3066\u4fbf\u5229\u3060\u306a\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n`elastic search`\u3084`redis`,`memcached`\u306e\u30af\u30e9\u30b9\u30bf\u30fc\u691c\u8a3c\u306b\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n`mongodb`\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306e\u691c\u8a3c\u306a\u3069\u306b\u306f\u3068\u3066\u3082\u5411\u3044\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\uff083.2=>3.4\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u306f\u624b\u9806\u304c\u591a\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u4eca\u56de\u306e\u8a18\u4e8b\u3067\u306f\u898b\u9001\u308a\u307e\u3057\u305f\u3002replica set\u306e\u307f\u3060\u3063\u305f\u3089\u697d\u305d\u3046\u3067\u3059\u3002\uff09\n\u3068\u304f\u306b\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\u5b9f\u884c\u3059\u308b\u3068\u5404docker\u306e\u51fa\u529b\u304c\u89b3\u308c\u3066\u308f\u304b\u308a\u3084\u3059\u3044\u3068\u611f\u3058\u307e\u3057\u305f\u3002\n\n\u3042\u3068\u5168\u7136\u95a2\u4fc2\u306a\u3044\u3093\u3067\u3059\u3051\u3069\u3001mac\u3092\u65b0\u3057\u304f\u3057\u3066\u3001gif\u30a2\u30cb\u30e1\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u30bd\u30d5\u30c8\u3092\u65b0\u3057\u304f\u3057\u305f\u3093\u3067\u3059\u304c\u3001\n[GIPHY Capture](https://itunes.apple.com/jp/app/giphy-capture.-the-gif-maker/id668208984?mt=12)\u3063\u3066\u30a2\u30d7\u30ea\u304c\u3059\u3054\u304f\u826f\u304b\u3063\u305f\u3067\u3059\u3002\n\u7121\u6599\u3067\u3001\u6700\u521d\u3068\u6700\u5f8c\u30ab\u30c3\u30c8\u3067\u304d\u305f\u308a\u3001\u30d5\u30ec\u30fc\u30e0\u30ec\u30fc\u30c8\u3084\u89e3\u50cf\u5ea6\u3092\u5909\u66f4\u3067\u304d\u305f\u306e\u3067\u3001\u624b\u9806\u66f8\u3068\u304bqiita\u3068\u304b\u306b\u8cbc\u308b\u7528\u9014\u306b\u3044\u3044\u304b\u3068\u3002\n\n[![image](https://qiita-image-store.s3.amazonaws.com/0/31015/f3eef562-0912-5488-5239-abfb1262419b.png)](https://itunes.apple.com/jp/app/giphy-capture.-the-gif-maker/id668208984?mt=12)\n\n\n\n", "tags": ["MongoDB", "Rails", "mongoid", "docker-compose"]}