{"context": "\n\n\u8981\u4ef6\n\n\u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306e\u30e1\u30fc\u30eb\u304c\u53d7\u4fe1\u3067\u304d\u308b\u3002\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u6bce\u306bUNIX User\u306f\u4f5c\u6210\u3057\u306a\u3044\u3002\nSMTP,POP3,IMAP\u3067\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306eMUA\u304b\u3089\u9001\u53d7\u4fe1\u53ef\u80fd\u3002\n\u30e1\u30fc\u30eb\u306e\u5bb9\u91cf\u5236\u9650\u3092\u30e6\u30fc\u30b6\u6bce\u306b\u8a2d\u5b9a\u53ef\u80fd\u306b\u3059\u308b\u3002\nMUA\u3067\u306e\u9001\u4fe1\u3001\u53d7\u4fe1\u306f\u8a8d\u8a3c\u5fc5\u9808\u3002\u8a8d\u8a3c\u306f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9+\u30d1\u30b9\u30ef\u30fc\u30c9\nSTARTTLS\u3067\u9001\u53d7\u4fe1\u306f\u6697\u53f7\u5316\u3059\u308b\nMUA\u3067\u306e\u9001\u4fe1\u3068\u53d7\u4fe1\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u540c\u3058\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3067\u304d\u308b\u3002\n\n\n\u6982\u8981\n\nMTA\u306fsendmail\u304b\u3089postfix\u306b\u5909\u66f4\n\u30e1\u30fc\u30eb\u914d\u9001\u306fMaildir\u65b9\u5f0f\u306b\u3059\u308b\u3002\npostfix\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u3001\u5404\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u306e\u53d7\u4fe1\u3092\u53ef\u80fd\u306b\u3059\u308b\u3002\n\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u7ba1\u7406\u7528UI\u306bpostfix Admin\u3092\u63a1\u7528\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u7ba1\u7406\u306fMySQL\nPOP3,IMAP\u3067\u306e\u53d7\u4fe1\u306fdovecot\u3092\u4f7f\u7528\u3059\u308b\u3002\nOB25\u5bfe\u7b56\u3092\u3057\u3066\u3001\u901a\u5e38\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u63a5\u7d9a\u3067\u3082\u9001\u4fe1\u53ef\u80fd\u306b\u3059\u308b\u3002\n\n\n\u69cb\u7bc9\u6e96\u5099\n\n\u74b0\u5883\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306b\u3059\u308b\u4e88\u5b9a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bElastic IP\u3092\u5272\u308a\u5f53\u3066\u3066\u304a\u304f\u3002\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u6c7a\u3081\u3066\u304a\u304f\u3002\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u4e0a\u3067\u3001web\u30b5\u30fc\u30d0\u3068php5\u4ee5\u4e0a\u304c\u52d5\u304f\u3088\u3046\u306b\u3057\u3066\u304a\u304f\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u304b\u3089MySQL\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u3059\u308b\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\uff1amail.example.jp\nPostfixAdmin\u306eURL: http://mail.example.jp\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\uff1a localhost\n\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u3068\u3059\u308b\u3002\u69cb\u7bc9\u306b\u4f7f\u7528\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\n\npostfix 2.6.6\ndovecot 2.0.9\npostfixAdmin 2.3.7\nMySQL 5.6\nApache 2.4\nPHP 5.5\n\n\n\u30e1\u30fc\u30eb\u9001\u4fe1\u5236\u9650\u306e\u89e3\u9664\u3068DNS\u9006\u5f15\u304d\u7533\u8acb\n\u6a19\u6e96\u3067\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u306e1\u65e5\u3042\u305f\u308a\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u6570\u306f\u5236\u9650\u3055\u308c\u3066\u3044\u308b\u306e\u3068\u3001\nElastic IP\u3067\u5272\u308a\u5f53\u3066\u305fIP\u30a2\u30c9\u30ec\u30b9\u3092\u9006\u5f15\u304d\u3057\u305f\u5834\u5408\u3001\u30a2\u30de\u30be\u30f3\u306e\u30c9\u30e1\u30a4\u30f3\u3068\u306a\u308b\u305f\u3081\u30b9\u30d1\u30e0\u5224\u5b9a\u3055\u308c\u308b\u4e8b\u304c\u3042\u308b\u3002\n\u5236\u9650\u89e3\u9664\u517c\u3001\u9006\u5f15\u304d\u8a2d\u5b9a\u306e\u4f9d\u983c\u3092\u884c\u3046\u30d5\u30a9\u30fc\u30e0\u304c\u3042\u308b\u306e\u3067\u305d\u3053\u304b\u3089\u7533\u8acb\u3059\u308b\u3002\nRequest to Remove Email Sending Limitations\nhttps://portal.aws.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request\n\u7533\u8acb\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u3001Amazon\u65e5\u672c\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttp://www.slideshare.net/AmazonWebServicesJapan/aws-42885668\n\u3067\u78ba\u8a8d\u3067\u304d\u308b\n\u30b5\u30fc\u30d0\u306e\u4f7f\u7528\u7528\u9014\u306f\u3001\u81ea\u793e\u7528\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u7b49\u3001\u7d20\u76f4\u306b\u66f8\u3051\u3070OK\u3002\u305f\u3060\u3057\u82f1\u8a9e\u3067\u8a18\u8f09\u3057\u306a\u3044\u3068\u7121\u8996\u3055\u308c\u308b\u3002\nElastic IP Address : 123.123.123.123 (\u4f7f\u7528\u3059\u308b Elastic IP)\nReverse DNS Record for EIP 1  : mail.example.jp (\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3)\n\u3092\u9001\u4fe1\u3002\u6570\u55b6\u696d\u5f8c\u306b\u8fd4\u7b54\u304c\u6c7a\u307e\u3059\u3002\n\nsendmail\u304b\u3089postfix\u3078\u306e\u5dee\u3057\u5909\u3048\n\npostifx\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# yum install postfix\n\nMTA\u306e\u5207\u308a\u5909\u3048\n# alternatives --config mta\n\u73fe\u5728\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bMTA\u4e00\u89a7\u304c\u51fa\u308b\u306e\u3067\u3001postfix\u3092\u9078\u629e\n\nsendmail\u306e\u505c\u6b62\u3068\u3001postfix\u306e\u8d77\u52d5\n# service sendmail stop\n# chkconfig sendmail off\n# service postfix start\n# chkconfig postfix on\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u5916\u90e8\u304b\u3089\u306e\u30e1\u30fc\u30eb\u306f\u3059\u3079\u3066\u62d2\u5426\u3055\u308c\u308b\u72b6\u614b\u3002\n\u52d5\u4f5c\u304c\u78ba\u8a8d\u3067\u304d\u308b\u307e\u3067\u62d2\u5426\u8a2d\u5b9a\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3002\nsendmail\u306f\u524a\u9664\u3057\u3066\u3082OK\n\ndovecot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npostfixAdmin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u524d\u306b\u5fc5\u8981\u3002pop3,imap\u306e\u30dd\u30fc\u30c8\u306f\u9589\u3058\u305f\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3002\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406\u306bMySQL\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001mysql backend\u3082\u5c0e\u5165\u3002\n# yum install dovecot dovecot-mysql\n\npostfix Admin \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\npostfixAdmin\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30e1\u30fc\u30eb\u30dc\u30c3\u30af\u30b9\u540d\u3092DB\u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u306eWeb\u30a2\u30d7\u30ea\u3002\nMTA\u306b\u306fpostfix\u3001pop3,imap\u30b5\u30fc\u30d0\u306fdovecot\u306e\u5229\u7528\u304c\u60f3\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002postfixAdmin\u81ea\u4f53\u306f\u3001postfix\u3068dovecot\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u306e\u3067\u3001\u81ea\u5206\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\u307e\u305a\u3001postfixAdmin\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u767b\u9332\u3067\u304d\u308b\u72b6\u614b\u306b\u3059\u308b\u3002\n\npostfix Admin\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u306a\u3044\u306e\u3067\u516c\u5f0f\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\npostfixadmin-2.3.7\u3092\u4f7f\u7528\u3057\u305f\u3002\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fpostfixadmin\u3092web\u30b5\u30fc\u30d0\u304b\u3089\u898b\u3048\u308b\u6240\u306b\u5c55\u958b\u3059\u308b\u3002\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067Web\u5074\u306b\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u3064\u3051\u3066\u304a\u304f\u3002\u5c55\u958b\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3042\u308bINSTALL.txt\u3092\u53c2\u7167\u3057\u3066\u8a2d\u5b9a\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\nmysql\u306b\u63a5\u7d9a\u3057\u3001postfix\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u306fhogehoge\nCREATE DATABASE postfix CHARSET utf8\nCREATE USER 'postfix'@'%' IDENTIFIED BY 'hogehoge'\nGRANT ALL PRIVILEGES ON postfix.* TO postfix@%\nFLUSH PRIVILEGES\n\npostfixadmin\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\nconfig.local.php\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u3002\nconfig.local.php\u306f\u3001config.inc.php\u306e\u8a2d\u5b9a\u5185\u5bb9\u3092\u4e0a\u66f8\u304d\u3059\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\n\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3059\u308b\u5024\u306e\u307f\u3092confic.local.php\u3078\u8a18\u8f09\u3059\u308b\u3002\nconfig.inc.php\u3092\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u4e0b\u90e8\u306b\u3042\u308bconfig.local.php\u306e\u8aad\u307f\u8fbc\u307f\u90e8\u5206\u3092\u6d88\u3055\u306a\u3044\u3068\u7121\u9650\u30eb\u30fc\u30d7\u3059\u308b\u3002\n\nconfig.local.php\n// \u8a2d\u5b9a\u5b8c\u4e86\u30d5\u30e9\u30b0\n$CONF['configured'] = true;\n// postfixAdmin\u306eURL\n$CONF['postfix_admin_url'] = 'http://mail.example.jp';\n//\u65e5\u672c\u8a9e\u8868\u793a\u306b\u3059\u308b\n$CONF['default_language'] = 'ja';\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u60c5\u5831\n$CONF['database_type'] = 'mysqli';       // mysql\u304b\u3089mysqli\u306b\u5909\u66f4\n$CONF['database_host'] = 'localhost';    // mysql\u306e\u30db\u30b9\u30c8\u540d\n$CONF['database_user'] = 'postfix';      // postfixAdmin\u3067\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30e6\u30fc\u30b6\n$CONF['database_password'] = 'hogehoge'; // \u30d1\u30b9\u30ef\u30fc\u30c9\n$CONF['database_name'] = 'postfix';      // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\n\n// \u7ba1\u7406\u8005\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n$CONF['admin_email'] = 'postmaster@example.jp';\n\n// postfix\u304c\u7a3c\u52d5\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u3068\u30dd\u30fc\u30c8\n// \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u4f5c\u6210\u6642\u306bwelcome\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u306e\u306b\u4f7f\u3046\u3002\n// welcome\u30e1\u30fc\u30eb\u3092\u9001\u3063\u3066\u304a\u304b\u306a\u3044\u3068mailbox\u304c\u4f5c\u6210\u3055\u308c\u306a\u3044\u305f\u3081\u3001pop3\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n$CONF['smtp_server'] = 'localhost';\n$CONF['smtp_port'] = '25';\n\n//\u6a19\u6e96\u306e\u7ba1\u7406\u8005\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n$CONF['default_aliases'] = array (\n    'abuse' => 'abuse@example.jp',\n    'hostmaster' => 'hostmaster@example.jp',\n    'postmaster' => 'postmaster@example.jp',\n    'webmaster' => 'webmaster@example.jp'\n);\n\n// username@domain.tld\u306e\u30e1\u30fc\u30eb\u306e\u914d\u9001\u3092\u3001domain.tld/username \u306b\u3059\u308b\u3002\n$CONF['domain_path'] = 'YES';\n$CONF['domain_in_mailbox'] = 'NO';\n\n// \u81ea\u52d5\u5fdc\u7b54\u30c9\u30e1\u30a4\u30f3\u3002DNS\u306b\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082\u3088\u3044\n$CONF['vacation_domain'] = 'autoreply.example.jp';\n\n//main\u30e1\u30cb\u30e5\u30fc\u3078\u306e\u30ea\u30f3\u30af\n$CONF['user_footer_link'] = \"http://mail.example.jp/main.php\";\n\n// \u30da\u30fc\u30b8\u4e0b\u90e8\u306b\u30c8\u30c3\u30d7\u3078\u623b\u308b\u30ea\u30f3\u30af\u8a2d\u5b9a\n$CONF['footer_text'] = 'Return to mail.example.jp';\n$CONF['footer_link'] = 'http://mail.example.jp';\n\n\n\n\u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u306e\u767b\u9332\nhttp://mail.example.jp/setup.php \u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\u521d\u56de\u30a2\u30af\u30bb\u30b9\u6642\u306b\u7ba1\u7406\u7528\u30c6\u30fc\u30d6\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\u52d5\u4f5c\u306b\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8db3\u308a\u306a\u3044\u5834\u5408\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3002\n\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u306a\u304f\u306a\u3063\u305f\u3089\u3001\u753b\u9762\u306b\u5f93\u3044\u7ba1\u7406\u8005\u3092\u767b\u9332\u3002\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\nconfig.local.php\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\nconfig.local.php\n$CONF['setup_password'] = '\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u305f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9'\n\n\nhttp://mail.example.jp \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u305f\u3089setup.php\u306f\u524a\u9664\u3059\u308b\u304b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u843d\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u4e0d\u53ef\u306b\u3057\u3066\u304a\u304f\u3002\n\n\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u767b\u9332\nhttp://mail.example.jp \u306b\u7ba1\u7406\u8005\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u753b\u9762\u306b\u5f93\u3063\u3066\u30c6\u30b9\u30c8\u7528\u306e\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u306eMX\u30ec\u30b3\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u3001\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3078\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\npostfix\u306e\u8a2d\u5b9a\npostfixAdmin\u306e\u8a2d\u5b9a\u306b\u5408\u308f\u305b\u308b\u3002\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u5b9b\u306e\u30e1\u30fc\u30eb\u306f /var/spool/virtual/ \u4ee5\u4e0b\u306b\u914d\u9001\u3057\u3001user@domain.ltd\u306e\u30e1\u30fc\u30eb\u914d\u9001\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001/var/spool/virtual/domain.ltd/user/ \u306b\u3059\u308b\n\nMailDir\u5f62\u5f0f\u3078\u306e\u5909\u66f4\n\n/etc/postfix/main.cf\nhome_mailbox = Maildir/ \n\n\n\u30e1\u30fc\u30eb\u306e\u914d\u9001\u65b9\u6cd5\u3092mbox\u5f62\u5f0f\u304b\u3089MailDir\u5f62\u5f0f\u306b\u5909\u66f4\u3059\u308b\u3002\n\u3064\u3044\u3067\u306b\u3001/etc/skel \u3078Maildir\u3092\u4f5c\u6210\u3057\u3001\u65b0\u898f\u30e6\u30fc\u30b6\u3067\u3082\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306e\u8a2d\u5b9a\nPostfix \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u30db\u30b9\u30c6\u30a3\u30f3\u30b0 Howto\u3092\u53c2\u8003\u306b\u4f5c\u6210\u3002\n\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u7528\u306e\u30e6\u30fc\u30b6\u3068\u30e1\u30fc\u30eb\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u306e\u6240\u6709\u8005\u3068\u4fdd\u5b58\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3002\n\u30e6\u30fc\u30b6\u306fuid:10000\u3067\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n# adduser -u 10000 vmailuser\n# mkdir /var/spool/virtual\n# chmown 10000.10000 /var/spool/virtual\n\nDB\u3078\u306e\u30a2\u30af\u30bb\u30b9\u7528\u30af\u30a8\u30ea\u8a2d\u5b9a\npostfixadmin\u306eDOCUMENTS/POSTFIX_CONF.txt\u3092\u53c2\u8003\u306b\u3001postfixAdmin\u3067\u767b\u9332\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u306e\u60c5\u5831\u3092\u3001postfix\u304b\u3089MySQL\u306b\u63a5\u7d9a\u3057\u3066\u53d6\u5f97\u3059\u308b\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002 /etc/postfix/sql \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\n\n/etc/postfix/sql/mysql_virtual_domains_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery          = SELECT domain FROM domain WHERE domain='%s' AND active = '1'\n#query          = SELECT domain FROM domain WHERE domain='%s'\n#optional query to use when relaying for backup MX\n#query           = SELECT domain FROM domain WHERE domain='%s' AND backupmx = '0' AND active = '1'\n#expansion_limit = 100\n\n\n\n/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\n# handles catch-all settings of target-domain\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery  = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('@', alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active='1'\n\n\n\n/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT maildir FROM mailbox,alias_domain WHERE alias_domain.alias_domain = '%d' and mailbox.username = CONCAT('%u', '@', alias_domain.target_domain) AND mailbox.active = 1 AND alias_domain.active='1'\n\n\n\n/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('%u', '@', alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active='1'\n\n\n\n/etc/postfix/sql/mysql_virtual_alias_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias WHERE address='%s' AND active = '1'\n#expansion_limit = 100\n\n\n\n/etc/postfix/sql/mysql_virtual_mailbox_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery           = SELECT maildir FROM mailbox WHERE username='%s' AND active = '1'\n#expansion_limit = 100\n\n\n\u30e1\u30fc\u30eb\u5bb9\u91cf\u5236\u9650\u53d6\u5f97\u3002\u5bb9\u91cf\u5236\u9650\u3092\u884c\u308f\u306a\u3044\u306a\u3089\u4e0d\u8981\n\n/etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT quota FROM mailbox WHERE username='%s' AND active = '1'\n\n\n\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u7528\u30e1\u30fc\u30eb\u30dc\u30c3\u30af\u30b9\u306e\u8a2d\u5b9a\n\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306e\u30e1\u30fc\u30eb\u3092\u914d\u9001\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n/etc/postfix/main.cf\n# Virtual mailbox \u57fa\u672c\u8a2d\u5b9a\nvirtual_mailbox_base = /var/spool/virtual\nvirtual_minimum_uid = 100\nvirtual_uid_maps = static:10000\nvirtual_gid_maps = static:10000\n\n# \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306e\u53d6\u5f97\nvirtual_mailbox_domains = proxy:mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cf\nvirtual_alias_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\nvirtual_mailbox_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\n\n# quota(\u5bb9\u91cf\u5236\u9650)\u30b5\u30dd\u30fc\u30c8\u8a2d\u5b9a\u3002\u5bb9\u91cf\u5236\u9650\u3092\u3057\u306a\u3044\u306a\u3089\u4e0d\u8981\n# \u5bb9\u91cf\u5236\u9650\u3092\u8d8a\u3048\u305f\u5834\u5408\u3001\u9001\u4fe1\u5143\u306b\u30a8\u30e9\u30fc\u30e1\u30fc\u30eb\u3092\u8fd4\u4fe1\u3059\u308b\u3002\nvirtual_create_maildirsize = yes\nvirtual_mailbox_extended = yes\nvirtual_mailbox_limit_maps = mysql:/etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf\nvirtual_mailbox_limit_override = yes\nvirtual_maildir_limit_message = Sorry, the user's maildir has overdrawn his diskspace quota, please try again later.\nvirtual_overquota_bounce = yes \n\n\n\u3053\u306e\u6642\u70b9\u3067postfix\u3092\u518d\u8d77\u52d5\u3057\u3001mail\u30b3\u30de\u30f3\u30c9\u3067\u30c6\u30b9\u30c8\u7528\u306b\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u5b9b\u3066\u306b\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3002user@domain.ltd\u306b\u9001\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u304c\u3001/var/spool/virtual/domain.ltd/user/new \u4ee5\u4e0b\u306b\u914d\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070OK\n\ndovecot\u306e\u8a2d\u5b9a\npostfixAdmin\u3067\u767b\u9332\u3057\u305f\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3002\u4ee5\u4e0b\u306e\u540d\u524d\u3067\u65b0\u898f\u4f5c\u6210\u3059\u308b\u3002\nconnect = \u306e\u90e8\u5206\u306f\u6539\u884c\u3059\u308b\u3068\u30c0\u30e1\u3002\n\n/etc/dovecot/dovecot-sql.conf.ext\n#\n# for postfixadmin\n#\nconnect = host=localhost dbname=postfix user=postfix password=hogehoge\ndriver = mysql\n\n# Default password scheme.\n# depends on your $CONF['encrypt'] setting:\n# md5crypt  -&gt; MD5-CRYPT\n# md5       -&gt; PLAIN-MD5\n# cleartext -&gt; PLAIN\ndefault_pass_scheme = MD5-CRYPT\n\npassword_query = SELECT username AS user,password FROM mailbox WHERE username = '%u' AND active='1'\nuser_query = SELECT CONCAT('/var/spool/virtual/', maildir) AS mail, 10000 AS uid, 10000 AS gid, CONCAT('*:bytes=', quota) AS quota_rule FROM mailbox WHERE username = '%u' AND active='1'\n\n\n\n\u8a8d\u8a3c\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9+\u30d1\u30b9\u30ef\u30fc\u30c9\u3067POP3,IMAP\u8a8d\u8a3c\u53ef\u80fd\u306b\u3057\u3001PAM\u3067\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306f\u7121\u52b9\u306b\u3059\u308b\u3002\n/etc/dovecot/conf.d/10-auth.conf\u3092\u5909\u66f4\u3059\u308b\u3002\n\n/etc/dovecot/conf.d/10-auth.conf\n...\n# STARTTLS\u3067\u6697\u53f7\u5316\u3059\u308b\u306e\u3067\u3001plaintext\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3059\u308b\ndisable_plaintext_auth = no\n...\n\n#\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n#!include auth-system.conf.ext\n\n#\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3059\n!include auth-sql.conf.ext\n...\n\n\n/etc/dovecot/conf.d/auth-sql.conf.ext\u3092\u5909\u66f4\u3059\u308b\n\n/etc/dovecot/conf.d/auth-sql.conf.ext\n# Authentication for SQL users. Included from auth.conf.\n#\n# <doc/wiki/AuthDatabase.SQL.txt>\n\npassdb {\n  driver = sql\n\n  # Path for SQL configuration file, see example-config/dovecot-sql.conf.ext\n  # \u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  args = /etc/dovecot/dovecot-sql.conf.ext\n}\n\n# \"prefetch\" user database means that the passdb already provided the\n# needed information and there's no need to do a separate userdb lookup.\n# <doc/wiki/UserDatabase.Prefetch.txt>\n#userdb {\n#  driver = prefetch\n#}\n\nuserdb {\n  driver = sql\n  # \u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  args = /etc/dovecot/dovecot-sql.conf.ext\n}\n\n# If you don't have any user-specific settings, you can avoid the user_query\n# by using userdb static instead of userdb sql, for example:\n# <doc/wiki/UserDatabase.Static.txt>\n#userdb {\n  #driver = static\n  #args = uid=vmail gid=vmail home=/var/vmail/%u\n#}\n\n\nSSL/TLS\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\n\n/etc/dovecot/conf.d/10-ssl.conf\n # SSL/TLS support: yes, no, required. <doc/wiki/SSL.txt>\n ssl = yes\n\n\n\n\u30ed\u30fc\u30ab\u30eb\u30e1\u30fc\u30eb\u306e\u8a2d\u5b9a\npostfix\u3067\u306e\u30e1\u30fc\u30eb\u914d\u9001\u3092Maidir\u5f62\u5f0f\u306b\u3057\u305f\u306e\u3067\u3001dovecot\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3082Maidir\u5f62\u5f0f\u306b\u3059\u308b\u3002\nmail_location\u306f\u30ed\u30fc\u30ab\u30eb\u30e6\u30fc\u30b6\u5411\u3051\u306e\u8a2d\u5b9a\u306a\u306e\u3067\u3001\u5404\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3002\n\n/etc/dovect/conf.d/10-mail.conf\nmail_location = maildir:~/Maildir\n\n\n\u3053\u3053\u307e\u3067\u8a2d\u5b9a\u3059\u308c\u3070\u3001pop3,imap\u306f\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u304c\u3001\nMUA\u304cThunderBird\u306e\u5834\u5408\u3001\u9001\u4fe1\u30b5\u30fc\u30d0\u306e\u8a8d\u8a3c\u304c\u3067\u304d\u306a\u3044\u3068\u30e1\u30fc\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\n\nPostfix\u7528\u306eSMTP\u8a8d\u8a3c\u7528\u8a2d\u5b9a\nPostfix\u3067Dovecot\u306e\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3002\n\u8a2d\u5b9a\u5f8c\u3001dovecot\u3092\u518d\u8d77\u52d5\u3057 /var/spool/postfix/private/auth \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\ndovecot\u5074\u306e\u8a2d\u5b9a\n\n/etc/dovecot/conf.d/10-master.conf\n   # Postfix smtp-auth\n   unix_listener /var/spool/postfix/private/auth {\n      mode = 0666\n      user = postfix\n      group = postfix\n   }\n\n\n\npostfix\u5074\u306e\u8a2d\u5b9a\n\n/etc/postfix/main.cf\n\nmyhostname = mail.example.jp\nmyorigin = $myhostname\n// \u5916\u90e8\u304b\u3089\u306e\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u53ef\u80fd\u306b\u3059\u308b\ninet_interfaces = all\n\n#\n# SASL(SMTP\u8a8d\u8a3c) \u6709\u52b9\u5316\n#\nsmtpd_sasl_auth_enable = yes\nsmtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated reject_unauth_destination\n# \u8a8d\u8a3c\u306bdovecot\u3092\u4f7f\u7528\nsmtpd_sasl_type = dovecot\n# \u8a8d\u8a3c\u7528\u30bd\u30b1\u30c3\u30c8\u3002/var/spool/postfix \u304b\u3089\u306e\u76f8\u5bfe\u30d1\u30b9\nsmtpd_sasl_path = private/auth\n# \u4e00\u90e8MUA\u3082\u30b5\u30dd\u30fc\u30c8\nbroken_sasl_auth_clients = yes\n\n#\n# TLS(STARTTLS) \u6709\u52b9\u5316\n#\nsmtpd_use_tls = yes\nsmtld_tls_loglevel = 1\n# dovecot\u306e\u8a3c\u660e\u66f8\u3092\u6d41\u7528.\u6b63\u5f0f\u306a\u8a3c\u660e\u66f8\u304c\u3042\u308b\u306a\u3089\u305d\u3061\u3089\u3092\u6307\u5b9a\u3059\u308b\u3002\nsmtpd_tls_cert_file = /etc/pki/dovecot/certs/dovecot.pem\nsmtpd_tls_key_file = /etc/pki/dovecot/private/dovecot.pem\nsmtpd_tls_session_cache_database = btree:/etc/postfix/smtpd_scache\nsmtpd_tls_session_cache_timeout = 3600s\n\n\n\u901a\u5e38\u3001\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306f\u3001$mydestination\u306b\u6307\u5b9a\u3059\u308b\u304c\u3001\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u4f7f\u7528\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306f\u3001$mydestination \u306b\u8ffd\u52a0\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\nOB25\u5bfe\u7b56\n\u30d7\u30ed\u30d0\u30a4\u30c0\u306b\u3088\u3063\u3066\u306fOB25\u306b\u3088\u308a\u300125\u756a\u30dd\u30fc\u30c8\u3067\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\u3002\n\n/etc/postfix/master.cf\nsubmission inet n       -       n       -       -       smtpd\n#  -o smtpd_tls_security_level=encrypt\n   -o smtpd_sasl_auth_enable=yes\n   -o smtpd_client_restrictions=permit_sasl_authenticated,reject\n\n\nSASL\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u3001\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u306e\u9001\u4fe1\u306f\u8a8d\u8a3c\u6210\u529f\u4ee5\u5916\u306f\u9001\u4fe1\u62d2\u5426\u3068\u3059\u308b\u3002\n# \u8981\u4ef6\n* \u8907\u6570\u30c9\u30e1\u30a4\u30f3\u306e\u30e1\u30fc\u30eb\u304c\u53d7\u4fe1\u3067\u304d\u308b\u3002\n* \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u6bce\u306bUNIX User\u306f\u4f5c\u6210\u3057\u306a\u3044\u3002\n* SMTP,POP3,IMAP\u3067\u5916\u90e8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306eMUA\u304b\u3089\u9001\u53d7\u4fe1\u53ef\u80fd\u3002\n* \u30e1\u30fc\u30eb\u306e\u5bb9\u91cf\u5236\u9650\u3092\u30e6\u30fc\u30b6\u6bce\u306b\u8a2d\u5b9a\u53ef\u80fd\u306b\u3059\u308b\u3002\n* MUA\u3067\u306e\u9001\u4fe1\u3001\u53d7\u4fe1\u306f\u8a8d\u8a3c\u5fc5\u9808\u3002\u8a8d\u8a3c\u306f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9+\u30d1\u30b9\u30ef\u30fc\u30c9\n* STARTTLS\u3067\u9001\u53d7\u4fe1\u306f\u6697\u53f7\u5316\u3059\u308b\n* MUA\u3067\u306e\u9001\u4fe1\u3068\u53d7\u4fe1\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u306f\u540c\u3058\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u4f7f\u7528\u3067\u304d\u308b\u3002\n\n\n# \u6982\u8981\n* MTA\u306fsendmail\u304b\u3089postfix\u306b\u5909\u66f4\n* \u30e1\u30fc\u30eb\u914d\u9001\u306fMaildir\u65b9\u5f0f\u306b\u3059\u308b\u3002\n* postfix\u306b\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3092\u8a2d\u5b9a\u3057\u3066\u3001\u5404\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u306e\u53d7\u4fe1\u3092\u53ef\u80fd\u306b\u3059\u308b\u3002\n* \u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u7ba1\u7406\u7528UI\u306b[postfix Admin](http://postfixadmin.sourceforge.net/)\u3092\u63a1\u7528\n* \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u7ba1\u7406\u306fMySQL\n* POP3,IMAP\u3067\u306e\u53d7\u4fe1\u306fdovecot\u3092\u4f7f\u7528\u3059\u308b\u3002\n* OB25\u5bfe\u7b56\u3092\u3057\u3066\u3001\u901a\u5e38\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u63a5\u7d9a\u3067\u3082\u9001\u4fe1\u53ef\u80fd\u306b\u3059\u308b\u3002\n\n# \u69cb\u7bc9\u6e96\u5099\n## \u74b0\u5883\n* \u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306b\u3059\u308b\u4e88\u5b9a\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306bElastic IP\u3092\u5272\u308a\u5f53\u3066\u3066\u304a\u304f\u3002\n* \u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u6c7a\u3081\u3066\u304a\u304f\u3002\n* \u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u4e0a\u3067\u3001web\u30b5\u30fc\u30d0\u3068php5\u4ee5\u4e0a\u304c\u52d5\u304f\u3088\u3046\u306b\u3057\u3066\u304a\u304f\n* \u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u304b\u3089MySQL\u30b5\u30fc\u30d0\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306b\u3059\u308b\n\n\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\uff1amail.example.jp\nPostfixAdmin\u306eURL: http://mail.example.jp\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b5\u30fc\u30d0\uff1a localhost\n\n\u3068\u3057\u3066\u4f5c\u6210\u3057\u305f\u3068\u3059\u308b\u3002\u69cb\u7bc9\u306b\u4f7f\u7528\u3057\u305f\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u3001\n\n* postfix 2.6.6\n* dovecot 2.0.9\n* postfixAdmin 2.3.7\n* MySQL 5.6\n* Apache 2.4\n* PHP 5.5\n\n\n## \u30e1\u30fc\u30eb\u9001\u4fe1\u5236\u9650\u306e\u89e3\u9664\u3068DNS\u9006\u5f15\u304d\u7533\u8acb\n\u6a19\u6e96\u3067\u306fEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u306e1\u65e5\u3042\u305f\u308a\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u6570\u306f\u5236\u9650\u3055\u308c\u3066\u3044\u308b\u306e\u3068\u3001\nElastic IP\u3067\u5272\u308a\u5f53\u3066\u305fIP\u30a2\u30c9\u30ec\u30b9\u3092\u9006\u5f15\u304d\u3057\u305f\u5834\u5408\u3001\u30a2\u30de\u30be\u30f3\u306e\u30c9\u30e1\u30a4\u30f3\u3068\u306a\u308b\u305f\u3081\u30b9\u30d1\u30e0\u5224\u5b9a\u3055\u308c\u308b\u4e8b\u304c\u3042\u308b\u3002\n\u5236\u9650\u89e3\u9664\u517c\u3001\u9006\u5f15\u304d\u8a2d\u5b9a\u306e\u4f9d\u983c\u3092\u884c\u3046\u30d5\u30a9\u30fc\u30e0\u304c\u3042\u308b\u306e\u3067\u305d\u3053\u304b\u3089\u7533\u8acb\u3059\u308b\u3002\n\n\nRequest to Remove Email Sending Limitations\nhttps://portal.aws.amazon.com/gp/aws/html-forms-controller/contactus/ec2-email-limit-rdns-request\n\n\u7533\u8acb\u624b\u9806\u306b\u3064\u3044\u3066\u306f\u3001Amazon\u65e5\u672c\u516c\u5f0f\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\nhttp://www.slideshare.net/AmazonWebServicesJapan/aws-42885668\n\u3067\u78ba\u8a8d\u3067\u304d\u308b\n\n\u30b5\u30fc\u30d0\u306e\u4f7f\u7528\u7528\u9014\u306f\u3001\u81ea\u793e\u7528\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u7b49\u3001\u7d20\u76f4\u306b\u66f8\u3051\u3070OK\u3002\u305f\u3060\u3057\u82f1\u8a9e\u3067\u8a18\u8f09\u3057\u306a\u3044\u3068\u7121\u8996\u3055\u308c\u308b\u3002\n\nElastic IP Address : 123.123.123.123 (\u4f7f\u7528\u3059\u308b Elastic IP)\nReverse DNS Record for EIP 1  : mail.example.jp (\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3)\n\n\u3092\u9001\u4fe1\u3002\u6570\u55b6\u696d\u5f8c\u306b\u8fd4\u7b54\u304c\u6c7a\u307e\u3059\u3002\n\n\n\n# sendmail\u304b\u3089postfix\u3078\u306e\u5dee\u3057\u5909\u3048\n## postifx\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n`# yum install postfix`\n\n## MTA\u306e\u5207\u308a\u5909\u3048\n`# alternatives --config mta`\n\u73fe\u5728\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308bMTA\u4e00\u89a7\u304c\u51fa\u308b\u306e\u3067\u3001postfix\u3092\u9078\u629e\n\n## sendmail\u306e\u505c\u6b62\u3068\u3001postfix\u306e\u8d77\u52d5\n`# service sendmail stop`\n`# chkconfig sendmail off`\n`# service postfix start`\n`# chkconfig postfix on`\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u5916\u90e8\u304b\u3089\u306e\u30e1\u30fc\u30eb\u306f\u3059\u3079\u3066\u62d2\u5426\u3055\u308c\u308b\u72b6\u614b\u3002\n\u52d5\u4f5c\u304c\u78ba\u8a8d\u3067\u304d\u308b\u307e\u3067\u62d2\u5426\u8a2d\u5b9a\u306e\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3002\nsendmail\u306f\u524a\u9664\u3057\u3066\u3082OK\n\n# dovecot\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npostfixAdmin\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u524d\u306b\u5fc5\u8981\u3002pop3,imap\u306e\u30dd\u30fc\u30c8\u306f\u9589\u3058\u305f\u307e\u307e\u306b\u3057\u3066\u304a\u304f\u3002\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u7ba1\u7406\u306bMySQL\u3092\u4f7f\u7528\u3059\u308b\u306e\u3067\u3001mysql backend\u3082\u5c0e\u5165\u3002\n`# yum install dovecot dovecot-mysql`\n\n# postfix Admin \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\npostfixAdmin\u306f\u3001\u30c9\u30e1\u30a4\u30f3\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3001\u30d1\u30b9\u30ef\u30fc\u30c9\u3001\u30e1\u30fc\u30eb\u30dc\u30c3\u30af\u30b9\u540d\u3092DB\u3067\u7ba1\u7406\u3059\u308b\u305f\u3081\u306eWeb\u30a2\u30d7\u30ea\u3002\nMTA\u306b\u306fpostfix\u3001pop3,imap\u30b5\u30fc\u30d0\u306fdovecot\u306e\u5229\u7528\u304c\u60f3\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002postfixAdmin\u81ea\u4f53\u306f\u3001postfix\u3068dovecot\u306e\u8a2d\u5b9a\u306f\u884c\u308f\u306a\u3044\u306e\u3067\u3001\u81ea\u5206\u3067\u8a2d\u5b9a\u3059\u308b\u3002\n\n\u307e\u305a\u3001postfixAdmin\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u767b\u9332\u3067\u304d\u308b\u72b6\u614b\u306b\u3059\u308b\u3002\n\n## postfix Admin\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306f\u306a\u3044\u306e\u3067\u516c\u5f0f\u3088\u308a\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002\n[postfixadmin-2.3.7](http://sourceforge.net/projects/postfixadmin/files/postfixadmin/postfixadmin-2.3.7/)\u3092\u4f7f\u7528\u3057\u305f\u3002\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305fpostfixadmin\u3092web\u30b5\u30fc\u30d0\u304b\u3089\u898b\u3048\u308b\u6240\u306b\u5c55\u958b\u3059\u308b\u3002\u8a2d\u5b9a\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067Web\u5074\u306b\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3092\u3064\u3051\u3066\u304a\u304f\u3002\u5c55\u958b\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u3042\u308bINSTALL.txt\u3092\u53c2\u7167\u3057\u3066\u8a2d\u5b9a\n\n## \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u4f5c\u6210\nmysql\u306b\u63a5\u7d9a\u3057\u3001postfix\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3002\u30d1\u30b9\u30ef\u30fc\u30c9\u306fhogehoge\n`CREATE DATABASE postfix CHARSET utf8`\n`CREATE USER 'postfix'@'%' IDENTIFIED BY 'hogehoge'`\n`GRANT ALL PRIVILEGES ON postfix.* TO postfix@%`\n`FLUSH PRIVILEGES`\n\n## postfixadmin\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u5909\u66f4\nconfig.local.php\u3092\u65b0\u898f\u4f5c\u6210\u3059\u308b\u3002\nconfig.local.php\u306f\u3001config.inc.php\u306e\u8a2d\u5b9a\u5185\u5bb9\u3092\u4e0a\u66f8\u304d\u3059\u308b\u4ed5\u7d44\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\n\u30c7\u30d5\u30a9\u30eb\u30c8\u304b\u3089\u5909\u66f4\u3059\u308b\u5024\u306e\u307f\u3092confic.local.php\u3078\u8a18\u8f09\u3059\u308b\u3002\n\nconfig.inc.php\u3092\u30b3\u30d4\u30fc\u3057\u3066\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u4e0b\u90e8\u306b\u3042\u308bconfig.local.php\u306e\u8aad\u307f\u8fbc\u307f\u90e8\u5206\u3092\u6d88\u3055\u306a\u3044\u3068\u7121\u9650\u30eb\u30fc\u30d7\u3059\u308b\u3002\n\n```php:config.local.php\n// \u8a2d\u5b9a\u5b8c\u4e86\u30d5\u30e9\u30b0\n$CONF['configured'] = true;\n// postfixAdmin\u306eURL\n$CONF['postfix_admin_url'] = 'http://mail.example.jp';\n//\u65e5\u672c\u8a9e\u8868\u793a\u306b\u3059\u308b\n$CONF['default_language'] = 'ja';\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u60c5\u5831\n$CONF['database_type'] = 'mysqli';       // mysql\u304b\u3089mysqli\u306b\u5909\u66f4\n$CONF['database_host'] = 'localhost';    // mysql\u306e\u30db\u30b9\u30c8\u540d\n$CONF['database_user'] = 'postfix';      // postfixAdmin\u3067\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30e6\u30fc\u30b6\n$CONF['database_password'] = 'hogehoge'; // \u30d1\u30b9\u30ef\u30fc\u30c9\n$CONF['database_name'] = 'postfix';      // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\n\n// \u7ba1\u7406\u8005\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n$CONF['admin_email'] = 'postmaster@example.jp';\n\n// postfix\u304c\u7a3c\u52d5\u3057\u3066\u3044\u308b\u30db\u30b9\u30c8\u3068\u30dd\u30fc\u30c8\n// \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u4f5c\u6210\u6642\u306bwelcome\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u306e\u306b\u4f7f\u3046\u3002\n// welcome\u30e1\u30fc\u30eb\u3092\u9001\u3063\u3066\u304a\u304b\u306a\u3044\u3068mailbox\u304c\u4f5c\u6210\u3055\u308c\u306a\u3044\u305f\u3081\u3001pop3\u3067\u30a8\u30e9\u30fc\u306b\u306a\u308b\u3002\n$CONF['smtp_server'] = 'localhost';\n$CONF['smtp_port'] = '25';\n\n//\u6a19\u6e96\u306e\u7ba1\u7406\u8005\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n$CONF['default_aliases'] = array (\n    'abuse' => 'abuse@example.jp',\n    'hostmaster' => 'hostmaster@example.jp',\n    'postmaster' => 'postmaster@example.jp',\n    'webmaster' => 'webmaster@example.jp'\n);\n\n// username@domain.tld\u306e\u30e1\u30fc\u30eb\u306e\u914d\u9001\u3092\u3001domain.tld/username \u306b\u3059\u308b\u3002\n$CONF['domain_path'] = 'YES';\n$CONF['domain_in_mailbox'] = 'NO';\n\n// \u81ea\u52d5\u5fdc\u7b54\u30c9\u30e1\u30a4\u30f3\u3002DNS\u306b\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082\u3088\u3044\n$CONF['vacation_domain'] = 'autoreply.example.jp';\n\n//main\u30e1\u30cb\u30e5\u30fc\u3078\u306e\u30ea\u30f3\u30af\n$CONF['user_footer_link'] = \"http://mail.example.jp/main.php\";\n\n// \u30da\u30fc\u30b8\u4e0b\u90e8\u306b\u30c8\u30c3\u30d7\u3078\u623b\u308b\u30ea\u30f3\u30af\u8a2d\u5b9a\n$CONF['footer_text'] = 'Return to mail.example.jp';\n$CONF['footer_link'] = 'http://mail.example.jp';\n```\n\n## \u30b7\u30b9\u30c6\u30e0\u7ba1\u7406\u8005\u306e\u767b\u9332\nhttp://mail.example.jp/setup.php \u306b\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\u521d\u56de\u30a2\u30af\u30bb\u30b9\u6642\u306b\u7ba1\u7406\u7528\u30c6\u30fc\u30d6\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u3002\n\u52d5\u4f5c\u306b\u5fc5\u8981\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8db3\u308a\u306a\u3044\u5834\u5408\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u30ea\u30ed\u30fc\u30c9\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3002\n\u30a8\u30e9\u30fc\u304c\u8868\u793a\u3055\u308c\u306a\u304f\u306a\u3063\u305f\u3089\u3001\u753b\u9762\u306b\u5f93\u3044\u7ba1\u7406\u8005\u3092\u767b\u9332\u3002\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\nconfig.local.php\u306b\u4ee5\u4e0b\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\n```php:config.local.php\n$CONF['setup_password'] = '\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u305f\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30d1\u30b9\u30ef\u30fc\u30c9'\n```\n\nhttp://mail.example.jp \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u305f\u3089setup.php\u306f\u524a\u9664\u3059\u308b\u304b\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u843d\u3068\u3057\u3066\u30a2\u30af\u30bb\u30b9\u4e0d\u53ef\u306b\u3057\u3066\u304a\u304f\u3002\n\n\n## \u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u767b\u9332\nhttp://mail.example.jp \u306b\u7ba1\u7406\u8005\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u753b\u9762\u306b\u5f93\u3063\u3066\u30c6\u30b9\u30c8\u7528\u306e\u30c9\u30e1\u30a4\u30f3\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u306eMX\u30ec\u30b3\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u3001\u30e1\u30fc\u30eb\u30b5\u30fc\u30d0\u3078\u30e1\u30fc\u30eb\u304c\u9001\u4fe1\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3002\n\n# postfix\u306e\u8a2d\u5b9a\npostfixAdmin\u306e\u8a2d\u5b9a\u306b\u5408\u308f\u305b\u308b\u3002\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u5b9b\u306e\u30e1\u30fc\u30eb\u306f /var/spool/virtual/ \u4ee5\u4e0b\u306b\u914d\u9001\u3057\u3001user@domain.ltd\u306e\u30e1\u30fc\u30eb\u914d\u9001\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u3001/var/spool/virtual/domain.ltd/user/ \u306b\u3059\u308b\n\n## MailDir\u5f62\u5f0f\u3078\u306e\u5909\u66f4\n\n```/etc/postfix/main.cf\nhome_mailbox = Maildir/ \n```\n\u30e1\u30fc\u30eb\u306e\u914d\u9001\u65b9\u6cd5\u3092mbox\u5f62\u5f0f\u304b\u3089MailDir\u5f62\u5f0f\u306b\u5909\u66f4\u3059\u308b\u3002\n\u3064\u3044\u3067\u306b\u3001/etc/skel \u3078Maildir\u3092\u4f5c\u6210\u3057\u3001\u65b0\u898f\u30e6\u30fc\u30b6\u3067\u3082\u81ea\u52d5\u4f5c\u6210\u3055\u308c\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\n## \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306e\u8a2d\u5b9a\n[Postfix \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u30db\u30b9\u30c6\u30a3\u30f3\u30b0 Howto](http://www.postfix-jp.info/trans-2.3/jhtml/VIRTUAL_README.html)\u3092\u53c2\u8003\u306b\u4f5c\u6210\u3002\n\n### \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u7528\u306e\u30e6\u30fc\u30b6\u3068\u30e1\u30fc\u30eb\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u53d7\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u306e\u6240\u6709\u8005\u3068\u4fdd\u5b58\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3002\n\u30e6\u30fc\u30b6\u306fuid:10000\u3067\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n\n`# adduser -u 10000 vmailuser`\n`# mkdir /var/spool/virtual`\n`# chmown 10000.10000 /var/spool/virtual`\n\n### DB\u3078\u306e\u30a2\u30af\u30bb\u30b9\u7528\u30af\u30a8\u30ea\u8a2d\u5b9a\npostfixadmin\u306eDOCUMENTS/POSTFIX_CONF.txt\u3092\u53c2\u8003\u306b\u3001postfixAdmin\u3067\u767b\u9332\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u306e\u60c5\u5831\u3092\u3001postfix\u304b\u3089MySQL\u306b\u63a5\u7d9a\u3057\u3066\u53d6\u5f97\u3059\u308b\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002 /etc/postfix/sql \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u898f\u4f5c\u6210\n\n```/etc/postfix/sql/mysql_virtual_domains_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery          = SELECT domain FROM domain WHERE domain='%s' AND active = '1'\n#query          = SELECT domain FROM domain WHERE domain='%s'\n#optional query to use when relaying for backup MX\n#query           = SELECT domain FROM domain WHERE domain='%s' AND backupmx = '0' AND active = '1'\n#expansion_limit = 100\n```\n\n```/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\n# handles catch-all settings of target-domain\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery  = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('@', alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active='1'\n```\n\n```/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT maildir FROM mailbox,alias_domain WHERE alias_domain.alias_domain = '%d' and mailbox.username = CONCAT('%u', '@', alias_domain.target_domain) AND mailbox.active = 1 AND alias_domain.active='1'\n```\n\n```/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias,alias_domain WHERE alias_domain.alias_domain = '%d' and alias.address = CONCAT('%u', '@', alias_domain.target_domain) AND alias.active = 1 AND alias_domain.active='1'\n```\n\n```/etc/postfix/sql/mysql_virtual_alias_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT goto FROM alias WHERE address='%s' AND active = '1'\n#expansion_limit = 100\n```\n\n\n```/etc/postfix/sql/mysql_virtual_mailbox_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery           = SELECT maildir FROM mailbox WHERE username='%s' AND active = '1'\n#expansion_limit = 100\n```\n\n\u30e1\u30fc\u30eb\u5bb9\u91cf\u5236\u9650\u53d6\u5f97\u3002\u5bb9\u91cf\u5236\u9650\u3092\u884c\u308f\u306a\u3044\u306a\u3089\u4e0d\u8981\n\n```/etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf\nuser = postfix\npassword = hogehoge\nhosts = localhost\ndbname = postfix\nquery = SELECT quota FROM mailbox WHERE username='%s' AND active = '1'\n```\n\n\n### \u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u7528\u30e1\u30fc\u30eb\u30dc\u30c3\u30af\u30b9\u306e\u8a2d\u5b9a\n\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u3001\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u306e\u30e1\u30fc\u30eb\u3092\u914d\u9001\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n\n\n```/etc/postfix/main.cf\n# Virtual mailbox \u57fa\u672c\u8a2d\u5b9a\nvirtual_mailbox_base = /var/spool/virtual\nvirtual_minimum_uid = 100\nvirtual_uid_maps = static:10000\nvirtual_gid_maps = static:10000\n\n# \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u95a2\u9023\u60c5\u5831\u306e\u53d6\u5f97\nvirtual_mailbox_domains = proxy:mysql:/etc/postfix/sql/mysql_virtual_domains_maps.cf\nvirtual_alias_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\nvirtual_mailbox_maps =\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_mailbox_maps.cf,\n   proxy:mysql:/etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\n\n# quota(\u5bb9\u91cf\u5236\u9650)\u30b5\u30dd\u30fc\u30c8\u8a2d\u5b9a\u3002\u5bb9\u91cf\u5236\u9650\u3092\u3057\u306a\u3044\u306a\u3089\u4e0d\u8981\n# \u5bb9\u91cf\u5236\u9650\u3092\u8d8a\u3048\u305f\u5834\u5408\u3001\u9001\u4fe1\u5143\u306b\u30a8\u30e9\u30fc\u30e1\u30fc\u30eb\u3092\u8fd4\u4fe1\u3059\u308b\u3002\nvirtual_create_maildirsize = yes\nvirtual_mailbox_extended = yes\nvirtual_mailbox_limit_maps = mysql:/etc/postfix/sql/mysql_virtual_mailbox_limit_maps.cf\nvirtual_mailbox_limit_override = yes\nvirtual_maildir_limit_message = Sorry, the user's maildir has overdrawn his diskspace quota, please try again later.\nvirtual_overquota_bounce = yes \n```\n\n\u3053\u306e\u6642\u70b9\u3067postfix\u3092\u518d\u8d77\u52d5\u3057\u3001mail\u30b3\u30de\u30f3\u30c9\u3067\u30c6\u30b9\u30c8\u7528\u306b\u4f5c\u6210\u3057\u305f\u30c9\u30e1\u30a4\u30f3\u5b9b\u3066\u306b\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3057\u3066\u30c1\u30a7\u30c3\u30af\u3002user@domain.ltd\u306b\u9001\u4fe1\u3057\u305f\u30e1\u30fc\u30eb\u304c\u3001/var/spool/virtual/domain.ltd/user/new \u4ee5\u4e0b\u306b\u914d\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070OK\n\n\n# dovecot\u306e\u8a2d\u5b9a\n\n## \npostfixAdmin\u3067\u767b\u9332\u3057\u305f\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306e\u30af\u30a8\u30ea\u3092\u4f5c\u6210\u3002\u4ee5\u4e0b\u306e\u540d\u524d\u3067\u65b0\u898f\u4f5c\u6210\u3059\u308b\u3002\nconnect = \u306e\u90e8\u5206\u306f\u6539\u884c\u3059\u308b\u3068\u30c0\u30e1\u3002\n\n```/etc/dovecot/dovecot-sql.conf.ext\n#\n# for postfixadmin\n#\nconnect = host=localhost dbname=postfix user=postfix password=hogehoge\ndriver = mysql\n\n# Default password scheme.\n# depends on your $CONF['encrypt'] setting:\n# md5crypt  -&gt; MD5-CRYPT\n# md5       -&gt; PLAIN-MD5\n# cleartext -&gt; PLAIN\ndefault_pass_scheme = MD5-CRYPT\n\npassword_query = SELECT username AS user,password FROM mailbox WHERE username = '%u' AND active='1'\nuser_query = SELECT CONCAT('/var/spool/virtual/', maildir) AS mail, 10000 AS uid, 10000 AS gid, CONCAT('*:bytes=', quota) AS quota_rule FROM mailbox WHERE username = '%u' AND active='1'\n```\n\n## \u8a8d\u8a3c\n\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9+\u30d1\u30b9\u30ef\u30fc\u30c9\u3067POP3,IMAP\u8a8d\u8a3c\u53ef\u80fd\u306b\u3057\u3001PAM\u3067\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306f\u7121\u52b9\u306b\u3059\u308b\u3002\n/etc/dovecot/conf.d/10-auth.conf\u3092\u5909\u66f4\u3059\u308b\u3002\n\n```/etc/dovecot/conf.d/10-auth.conf\n...\n# STARTTLS\u3067\u6697\u53f7\u5316\u3059\u308b\u306e\u3067\u3001plaintext\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3059\u308b\ndisable_plaintext_auth = no\n...\n\n#\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n#!include auth-system.conf.ext\n\n#\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3059\n!include auth-sql.conf.ext\n...\n```\n/etc/dovecot/conf.d/auth-sql.conf.ext\u3092\u5909\u66f4\u3059\u308b\n\n```/etc/dovecot/conf.d/auth-sql.conf.ext\n# Authentication for SQL users. Included from auth.conf.\n#\n# <doc/wiki/AuthDatabase.SQL.txt>\n\npassdb {\n  driver = sql\n\n  # Path for SQL configuration file, see example-config/dovecot-sql.conf.ext\n  # \u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  args = /etc/dovecot/dovecot-sql.conf.ext\n}\n\n# \"prefetch\" user database means that the passdb already provided the\n# needed information and there's no need to do a separate userdb lookup.\n# <doc/wiki/UserDatabase.Prefetch.txt>\n#userdb {\n#  driver = prefetch\n#}\n\nuserdb {\n  driver = sql\n  # \u5148\u7a0b\u4f5c\u6210\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6307\u5b9a\n  args = /etc/dovecot/dovecot-sql.conf.ext\n}\n\n# If you don't have any user-specific settings, you can avoid the user_query\n# by using userdb static instead of userdb sql, for example:\n# <doc/wiki/UserDatabase.Static.txt>\n#userdb {\n  #driver = static\n  #args = uid=vmail gid=vmail home=/var/vmail/%u\n#}\n```\n\nSSL/TLS\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\n\n```/etc/dovecot/conf.d/10-ssl.conf\n # SSL/TLS support: yes, no, required. <doc/wiki/SSL.txt>\n ssl = yes\n```\n\n## \u30ed\u30fc\u30ab\u30eb\u30e1\u30fc\u30eb\u306e\u8a2d\u5b9a\npostfix\u3067\u306e\u30e1\u30fc\u30eb\u914d\u9001\u3092Maidir\u5f62\u5f0f\u306b\u3057\u305f\u306e\u3067\u3001dovecot\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3082Maidir\u5f62\u5f0f\u306b\u3059\u308b\u3002\nmail_location\u306f\u30ed\u30fc\u30ab\u30eb\u30e6\u30fc\u30b6\u5411\u3051\u306e\u8a2d\u5b9a\u306a\u306e\u3067\u3001\u5404\u30e6\u30fc\u30b6\u306e\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3002\n\n```/etc/dovect/conf.d/10-mail.conf\nmail_location = maildir:~/Maildir\n```\n\n\u3053\u3053\u307e\u3067\u8a2d\u5b9a\u3059\u308c\u3070\u3001pop3,imap\u306f\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u304c\u3001\nMUA\u304cThunderBird\u306e\u5834\u5408\u3001\u9001\u4fe1\u30b5\u30fc\u30d0\u306e\u8a8d\u8a3c\u304c\u3067\u304d\u306a\u3044\u3068\u30e1\u30fc\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u767b\u9332\u3067\u30a8\u30e9\u30fc\u3068\u306a\u308b\u3002\n\n\n\n## Postfix\u7528\u306eSMTP\u8a8d\u8a3c\u7528\u8a2d\u5b9a\n\nPostfix\u3067Dovecot\u306e\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3002\n\u8a2d\u5b9a\u5f8c\u3001dovecot\u3092\u518d\u8d77\u52d5\u3057 /var/spool/postfix/private/auth \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n### dovecot\u5074\u306e\u8a2d\u5b9a\n```/etc/dovecot/conf.d/10-master.conf\n   # Postfix smtp-auth\n   unix_listener /var/spool/postfix/private/auth {\n      mode = 0666\n      user = postfix\n      group = postfix\n   }\n```\n\n### postfix\u5074\u306e\u8a2d\u5b9a\n\n```/etc/postfix/main.cf\n\nmyhostname = mail.example.jp\nmyorigin = $myhostname\n// \u5916\u90e8\u304b\u3089\u306e\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u53ef\u80fd\u306b\u3059\u308b\ninet_interfaces = all\n\n#\n# SASL(SMTP\u8a8d\u8a3c) \u6709\u52b9\u5316\n#\nsmtpd_sasl_auth_enable = yes\nsmtpd_recipient_restrictions = permit_mynetworks permit_sasl_authenticated reject_unauth_destination\n# \u8a8d\u8a3c\u306bdovecot\u3092\u4f7f\u7528\nsmtpd_sasl_type = dovecot\n# \u8a8d\u8a3c\u7528\u30bd\u30b1\u30c3\u30c8\u3002/var/spool/postfix \u304b\u3089\u306e\u76f8\u5bfe\u30d1\u30b9\nsmtpd_sasl_path = private/auth\n# \u4e00\u90e8MUA\u3082\u30b5\u30dd\u30fc\u30c8\nbroken_sasl_auth_clients = yes\n\n#\n# TLS(STARTTLS) \u6709\u52b9\u5316\n#\nsmtpd_use_tls = yes\nsmtld_tls_loglevel = 1\n# dovecot\u306e\u8a3c\u660e\u66f8\u3092\u6d41\u7528.\u6b63\u5f0f\u306a\u8a3c\u660e\u66f8\u304c\u3042\u308b\u306a\u3089\u305d\u3061\u3089\u3092\u6307\u5b9a\u3059\u308b\u3002\nsmtpd_tls_cert_file = /etc/pki/dovecot/certs/dovecot.pem\nsmtpd_tls_key_file = /etc/pki/dovecot/private/dovecot.pem\nsmtpd_tls_session_cache_database = btree:/etc/postfix/smtpd_scache\nsmtpd_tls_session_cache_timeout = 3600s\n```\n\n\u901a\u5e38\u3001\u30e1\u30fc\u30eb\u3092\u53d7\u4fe1\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306f\u3001$mydestination\u306b\u6307\u5b9a\u3059\u308b\u304c\u3001\n\u30d0\u30fc\u30c1\u30e3\u30eb\u30c9\u30e1\u30a4\u30f3\u3067\u4f7f\u7528\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306f\u3001$mydestination \u306b**\u8ffd\u52a0\u3057\u3066\u306f\u3044\u3051\u306a\u3044**\u3002\n\n\n# OB25\u5bfe\u7b56\n\u30d7\u30ed\u30d0\u30a4\u30c0\u306b\u3088\u3063\u3066\u306f[OB25](http://www.atmarkit.co.jp/fsecurity/column/ueno/32.html)\u306b\u3088\u308a\u300125\u756a\u30dd\u30fc\u30c8\u3067\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u304c\u3067\u304d\u306a\u3044\u306e\u3067\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8\u3092\u4f7f\u7528\u53ef\u80fd\u306b\u3059\u308b\u3002\n\n```/etc/postfix/master.cf\nsubmission inet n       -       n       -       -       smtpd\n#  -o smtpd_tls_security_level=encrypt\n   -o smtpd_sasl_auth_enable=yes\n   -o smtpd_client_restrictions=permit_sasl_authenticated,reject\n```\n\nSASL\u8a8d\u8a3c\u3092\u6709\u52b9\u306b\u3057\u3001\u30b5\u30d6\u30df\u30c3\u30b7\u30e7\u30f3\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3057\u3066\u306e\u9001\u4fe1\u306f\u8a8d\u8a3c\u6210\u529f\u4ee5\u5916\u306f\u9001\u4fe1\u62d2\u5426\u3068\u3059\u308b\u3002\n", "tags": ["EC2", "postfix", "AWS", "postfixadmin"]}