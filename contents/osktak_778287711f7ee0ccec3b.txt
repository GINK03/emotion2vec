{"context": "\u3053\u306e\u8a18\u4e8b\u306f\u3001\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u69cb\u6210\u3057\u3066\u3044\u308b\u8a18\u4e8b\u306e\u3072\u3068\u3064\u3067\u3059\u3002\n\u3055\u304f\u3089\u306eVPS \u3068 Debian 8 Jessie \u3067\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u306eWeb\u30b5\u30a4\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u624b\u9806\n\u30fb\u3055\u304f\u3089\u306eVPS\uff08\u30d7\u30e9\u30f3512\uff09\n\u30fbDebian 8 Jessie\uff08\u3055\u304f\u3089\u306eVPS \u30ab\u30b9\u30bf\u30e0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff09\n\u306e\u74b0\u5883\u3092\u524d\u63d0\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306eiptables\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\n\n[hoge]$\nsudo iptables -L\n\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\n\u3064\u307e\u308a\u3001\u3059\u3079\u3066\u8a31\u53ef\u3057\u307e\u3059\u3088\u30fc\u3002\u3063\u3066\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306b\u516c\u958b\u30b5\u30fc\u30d0\u3092\u7acb\u3066\u308b\u4ee5\u4e0a\u3001\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u306f\u3057\u3066\u304a\u304f\u3079\u304d\u3067\u3059\u3002\n\niptables-persistent \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\niptables\u3092\u7ba1\u7406\u3059\u308b\u3001iptables-persistent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n[hoge]$\nsudo aptitude -y install iptables-persistent\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b\u3001IPv4\u3068\u3001IPv6\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u304b\u805e\u304b\u308c\u308b\u306e\u3067\u3001\u3069\u3063\u3061\u3082Yes\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\n\niptables(IPv4)\u306e\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\nIPv4\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u4e0b\u8a18\u306e\u5185\u5bb9\u3067\u3059\u3079\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\n\n[hoge]$\nsudo cp /etc/iptables/rules.v4 /etc/iptables/rules.v4.backup\nsudo vi /etc/iptables/rules.v4\n\n\n\n/etc/iptables/rules.v4\n*filter\n\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u306f\u8a31\u53ef\u3059\u308b\u3002\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u4ee5\u5916\u306e127.0.0.0/8\u3078\u306e\u63a5\u7d9a\u306f\u62d2\u5426\u3059\u308b\u3002\n-A INPUT -i lo -j ACCEPT\n-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT\n\n# \u78ba\u7acb\u6e08\u306e\u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# \u5185\u90e8\u304b\u3089\u5916\u90e8\u3078\u306e\u63a5\u7d9a\u306f\u3059\u3079\u3066\u8a31\u53ef\u3059\u308b\n-A OUTPUT -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eHTTP(80)\u3068HTTPS(443)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -p tcp --dport 80 -j ACCEPT\n-A INPUT -p tcp --dport 443 -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eSSH\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n# \u30dd\u30fc\u30c8\u756a\u53f7\u306f\u3001/etc/ssh/sshd_config \u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u306b\u3059\u308b\n-A INPUT -p tcp -m state --state NEW --dport 1234 -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eping\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT\n\n# log iptables denied calls (access via 'dmesg' command)\n-A INPUT -m limit --limit 5/min -j LOG --log-prefix \"iptables denied: \" --log-level 7\n\n# \u305d\u306e\u4ed6\u306e\u63a5\u7d9a\u3092\u62d2\u5426\u3059\u308b\n-A INPUT -j REJECT\n-A FORWARD -j REJECT\n\nCOMMIT\n\n\n\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\u3002\n\n[hoge]$\nsudo netfilter-persistent reload\n\n\n\niptables(IPv6)\u306e\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\nIPv6\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u4e0b\u8a18\u306e\u5185\u5bb9\u3067\u3059\u3079\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\nIPv6\u3067\u306e\u63a5\u7d9a\u306f\u3001\u3059\u3079\u3066\u62d2\u5426\u3059\u308b\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n\n[hoge]$\nsudo cp /etc/iptables/rules.v6 /etc/iptables/rules.v6.backup\nsudo vi /etc/iptables/rules.v6\n\n\n\n/etc/iptables/rules.v6\n*filter\n:INPUT DROP [0:0]\n:FORWARD DROP [0:0]\n:OUTPUT DROP [0:0]\nCOMMIT\n\n\n\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\u3002\n\n[hoge]$\nsudo netfilter-persistent reload\n\n\n\u3053\u306e\u8a18\u4e8b\u306f\u3001\u4e0b\u8a18\u306e\u8a18\u4e8b\u3092\u69cb\u6210\u3057\u3066\u3044\u308b\u8a18\u4e8b\u306e\u3072\u3068\u3064\u3067\u3059\u3002\n[\u3055\u304f\u3089\u306eVPS \u3068 Debian 8 Jessie \u3067\u72ec\u81ea\u30c9\u30e1\u30a4\u30f3\u306eWeb\u30b5\u30a4\u30c8\u3092\u7acb\u3061\u4e0a\u3052\u308b\u624b\u9806](http://qiita.com/osktak/items/7224bd263288b40b4b98)\n\n\u30fb\u3055\u304f\u3089\u306eVPS\uff08\u30d7\u30e9\u30f3512\uff09\n\u30fbDebian 8 Jessie\uff08\u3055\u304f\u3089\u306eVPS \u30ab\u30b9\u30bf\u30e0\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff09\n\u306e\u74b0\u5883\u3092\u524d\u63d0\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u76f4\u5f8c\u306eiptables\u306e\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\n\n```tarminal:[hoge]$\nsudo iptables -L\n```\n```\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n```\n\n\u3064\u307e\u308a\u3001\u3059\u3079\u3066\u8a31\u53ef\u3057\u307e\u3059\u3088\u30fc\u3002\u3063\u3066\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u3044\u308b\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306b\u516c\u958b\u30b5\u30fc\u30d0\u3092\u7acb\u3066\u308b\u4ee5\u4e0a\u3001\u6700\u4f4e\u9650\u306e\u8a2d\u5b9a\u306f\u3057\u3066\u304a\u304f\u3079\u304d\u3067\u3059\u3002\n\n# iptables-persistent \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\niptables\u3092\u7ba1\u7406\u3059\u308b\u3001iptables-persistent\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```tarminal:[hoge]$\nsudo aptitude -y install iptables-persistent\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b\u3001IPv4\u3068\u3001IPv6\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u304b\u805e\u304b\u308c\u308b\u306e\u3067\u3001\u3069\u3063\u3061\u3082Yes\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n![iptables01.png](https://qiita-image-store.s3.amazonaws.com/0/162149/0af3f97f-84d9-307c-a91c-d6f5b793738a.png)\n\n![iptables02.png](https://qiita-image-store.s3.amazonaws.com/0/162149/10e64af3-85f3-f401-a153-073657dca82c.png)\n\n# iptables(IPv4)\u306e\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\nIPv4\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u4e0b\u8a18\u306e\u5185\u5bb9\u3067\u3059\u3079\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\n\n```tarminal:[hoge]$\nsudo cp /etc/iptables/rules.v4 /etc/iptables/rules.v4.backup\nsudo vi /etc/iptables/rules.v4\n```\n```Bash:/etc/iptables/rules.v4\n*filter\n\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u306f\u8a31\u53ef\u3059\u308b\u3002\n# \u30eb\u30fc\u30d7\u30d0\u30c3\u30af\u4ee5\u5916\u306e127.0.0.0/8\u3078\u306e\u63a5\u7d9a\u306f\u62d2\u5426\u3059\u308b\u3002\n-A INPUT -i lo -j ACCEPT\n-A INPUT ! -i lo -d 127.0.0.0/8 -j REJECT\n\n# \u78ba\u7acb\u6e08\u306e\u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n# \u5185\u90e8\u304b\u3089\u5916\u90e8\u3078\u306e\u63a5\u7d9a\u306f\u3059\u3079\u3066\u8a31\u53ef\u3059\u308b\n-A OUTPUT -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eHTTP(80)\u3068HTTPS(443)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -p tcp --dport 80 -j ACCEPT\n-A INPUT -p tcp --dport 443 -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eSSH\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n# \u30dd\u30fc\u30c8\u756a\u53f7\u306f\u3001/etc/ssh/sshd_config \u3067\u8a2d\u5b9a\u3057\u305f\u3082\u306e\u3068\u540c\u3058\u306b\u3059\u308b\n-A INPUT -p tcp -m state --state NEW --dport 1234 -j ACCEPT\n\n# \u5916\u90e8\u304b\u3089\u5185\u90e8\u3078\u306eping\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\n-A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT\n\n# log iptables denied calls (access via 'dmesg' command)\n-A INPUT -m limit --limit 5/min -j LOG --log-prefix \"iptables denied: \" --log-level 7\n\n# \u305d\u306e\u4ed6\u306e\u63a5\u7d9a\u3092\u62d2\u5426\u3059\u308b\n-A INPUT -j REJECT\n-A FORWARD -j REJECT\n\nCOMMIT\n```\n\n\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\u3002\n\n```tarminal:[hoge]$\nsudo netfilter-persistent reload\n```\n\n# iptables(IPv6)\u306e\u30eb\u30fc\u30eb\u3092\u8a2d\u5b9a\u3059\u308b\nIPv6\u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u4e0b\u8a18\u306e\u5185\u5bb9\u3067\u3059\u3079\u3066\u66f8\u304d\u63db\u3048\u308b\u3002\nIPv6\u3067\u306e\u63a5\u7d9a\u306f\u3001\u3059\u3079\u3066\u62d2\u5426\u3059\u308b\u8a2d\u5b9a\u306b\u3057\u307e\u3059\u3002\n\n```tarminal:[hoge]$\nsudo cp /etc/iptables/rules.v6 /etc/iptables/rules.v6.backup\nsudo vi /etc/iptables/rules.v6\n```\n```Bash:/etc/iptables/rules.v6\n*filter\n:INPUT DROP [0:0]\n:FORWARD DROP [0:0]\n:OUTPUT DROP [0:0]\nCOMMIT\n```\n\n\u8a2d\u5b9a\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u518d\u8aad\u307f\u8fbc\u307f\u3059\u308b\u3002\n\n```tarminal:[hoge]$\nsudo netfilter-persistent reload\n```\n", "tags": ["Linux", "Debian", "iptables", "IPv6"]}