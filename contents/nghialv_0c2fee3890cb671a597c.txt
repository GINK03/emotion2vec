{"context": " More than 1 year has passed since last update.\u3053\u306e\u8a18\u4e8b\u306fCyberAgent\u30a8\u30f3\u30b8\u30cb\u30a2Advent Calendar 2015\u306e\uff12\uff10\u65e5\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n\u306f\u3058\u3081\u306b\n\u3053\u3093\u306b\u3061\u306f\u3002\u30b5\u30a4\u30d0\u30fc\u30a8\u30b8\u30a7\u30f3\u30c8\u306e\u65b0\u5352\u306e\u30ae\u30a2@nghialv\u3068\u7533\u3057\u307e\u3059\u3002\u73fe\u5728\uff0cAmebaFRESH!\u3068\u3044\u3046\u65b0\u898f\u751f\u653e\u9001\u30b5\u30fc\u30d3\u30b9\u306e\u30c1\u30fc\u30e0\u306biOS\u30a8\u30f3\u30b8\u30cb\u30a2\u3084\u3063\u3066\u3044\u307e\u3059\u3002\n\u79c1\u306f\u5165\u793e\u3057\u305f\u6642\u306b\uff0c\u591a\u304f\u306e\u30e6\u30fc\u30b6\u30fc\u306b\u4f7f\u308f\u308c\u3066\u3044\u308bAmeba\u30a2\u30d7\u30ea\u30c1\u30fc\u30e0\u306b\u5165\u308a\u307e\u3057\u305f\u3002Ameba\u30a2\u30d7\u30ea\u306f\u306a\u3093\u5e74\u524d\u304b\u3089\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u306e\u3067\uff0c\u4eca\u307e\u3067\u306e\u4ed6\u306eiOS\u30a2\u30d7\u30ea\u3068\u540c\u3058\u3067MVC\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\uff0c\u30a2\u30d7\u30ea\u304c\u3069\u3093\u3069\u3093\u5927\u304d\u304f\u3057\u3066MVC\u30e2\u30c7\u30eb\u306e\u554f\u984c\u70b9\u3092\u611f\u3058\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\uff14\u30f6\u6708\u524d\u306bAmebaFRESH!\u306e\u65b0\u898f\u30b5\u30fc\u30d3\u30b9\u306b\u79fb\u52d5\u3057\u3066\uff0cMVVM\u30e2\u30c7\u30eb\u3068ReactiveCocoa\u3092\u691c\u8a0e\u3057\u3066\uff0c\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u4eca\u65e5MVVM\u30e2\u30c7\u30eb\u3068ReactiveCocoa\u306b\u3064\u3044\u3066\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\n\u76ee\u6b21\n\nMVC\u304b\u3089MVVM\u306b\u79fb\u52d5\nWater pipes\u304b\u3089ReactiveCocoa\u3092\u7406\u89e3\nReactiveCocoa\u3068MVVM\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u30b5\u30f3\u30d7\u30eb\n\n\nMVC\u304b\u3089MVVM\u306b\u79fb\u52d5\n\n\n\n\u4e0a\u306e\u56f3\u306f\u4e00\u822c\u7684\u306aMVC\u30e2\u30c7\u30eb\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002MVC\u30e2\u30c7\u30eb\u306fModel, View, ViewController\u306e\uff13\u3064\u306e\u90e8\u5206\u306b\u5206\u5272\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30e2\u30c7\u30eb\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u554f\u984c\u70b9\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u307e\u305a\u306f\uff0cViewController\u306fModel\u3068View\u3092\u6301\u3063\u3066\u3044\u3066\uff0c\u30ed\u30b8\u30c3\u30af\u306e\u51e6\u7406\u306f\u57fa\u672c\u7684\u306bViewController\u306b\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30a2\u30d7\u30ea\u306e\u6210\u9577\u3068\u5171\u306b\u5927\u898f\u6a21\u306aViewController\u304c\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u304d\u307e\u3059\u3002\uff08\u3053\u306e\u7406\u7531\u3067\u7686\u3093\u306a\u3088\u304fMVC\u306fMassive ViewController\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u306d\uff09iOS\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u7686\u3055\u3093\u306f\u3053\u306e\u554f\u984c\u3092\u3042\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u306d\u3002\n\u6b21\u306f\uff0cViewController\u306fView\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\uff0cView\u306b\u4f9d\u5b58\u3057\u3066\u3044\u3066\uff0cViewController\u306e\u30c6\u30b9\u30c8\u66f8\u304f\u306e\u306f\u306a\u304b\u306a\u304b\u96e3\u3057\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\uff0c\u30c6\u30b9\u30c8\u66f8\u3051\u308b\u90e8\u5206\u306f\u4e3b\u306bModel\u3068Utility\u306e\u5468\u308a\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002\n\u305d\u308c\u3089\u306e\u554f\u984c\u70b9\u3067MVVM\u30e2\u30c7\u30eb\u306e\u5c0e\u5165\u3092\u691c\u8a0e\u3057\u307e\u3057\u305f\u3002\n\n\n\n\u4e0a\u306e\u56f3\u306b\u3088\u308a\uff0cViewModel\u306e\u90e8\u5206\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\nViewModel\u306fModel\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30fc\u30bf\u3092\u57fa\u306bView\u306b\u98df\u308f\u305b\u308b\u5024\u3092\u751f\u6210\u3059\u308b\u30ed\u30b8\u30c3\u30af(\u30d7\u30ec\u30bc\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af)\u3084View\u306e\u72b6\u614b\u3092\u6301\u3061\u307e\u3059\u3002\niOS\u306eViewController\u306fView\u3068\u540c\u3058\u5f79\u5272\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3055\u3089\u306b\uff0cMVC\u3068\u7570\u306a\u3063\u3066\uff0cdata binding\u6982\u5ff5\u3092\u5165\u3063\u3066\u3044\u307e\u3059\u3002\nViewModel\u306fView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6301\u3061\u3067\u306f\u306a\u304f\uff0cdata binding\u3067ViewModel\u5074\u306f\u30c7\u30fc\u30bf\u306e\u5909\u66f4\u304c\u3042\u308a\u307e\u3057\u305f\u3089\uff0cView\u306b\u901a\u77e5\u3092\u9001\u308a\u307e\u3059\u3002\n\u3058\u3083\u3001MVVM\u30e2\u30c7\u30eb\u306e\u826f\u3044\u70b9?\n- ViewModel\u306f\u3088\u304f\u5909\u308f\u308c\u308bView\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u306e\u3067\uff0c\u30e2\u30c7\u30eb\u307f\u305f\u3044\u306b\u30c6\u30b9\u30c8\u66f8\u304f\u3053\u3068\u306f\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n- \u5927\u898f\u6a21\u306aViewController\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n- View\u306fViewModel\u306b\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u4ed5\u7d44\u307f\u306a\u306e\u3067\uff0cView\u306e\u30ea\u30bb\u30c3\u30c8\u306a\u3069\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306f\u5358\u7d14\u65b0\u3057\u3044ViewModel\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\uff0c\u518d\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u3053\u3068\u3067\uff0cView\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30c8\u306e\u7ba1\u7406\u304c\u697d\u306b\u306a\u308a\u307e\u3059\u3002\n(\u3053\u308c\u306f\u81ea\u5206\u304c\u611f\u3058\u3067\u304d\u305f\u826f\u3044\u70b9\u3067\u3059\u304c\uff0c\u3082\u3057\u4f55\u304b\u308f\u304b\u308a\u307e\u3057\u305f\u3089\uff0c\u8ffd\u52a0\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002)\n\u4e0a\u306f\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u306b\u3064\u3044\u3066\u4f55\u56de\u3082\u8a00\u3044\u307e\u3057\u305f\u304c\uff0c\u5177\u4f53\u7684\u306f\u3069\u3093\u306a\u611f\u3058\u3063\u3066\u7591\u554f\u3057\u3066\u3044\u308b\u4eba\u3082\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\u305d\u308c\u306fReactiveCocoa\u306e\u5f79\u5272\u3067\u3059\u306d\u3002\n\nWater pipes\u304b\u3089ReactiveCocoa\u7406\u89e3\nReactiveCocoa\u306e\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u306d\u3002\n\nReactiveCocoa (RAC) is a Cocoa framework inspired by Functional Reactive Programming. It provides APIs for composing and transforming streams of values over time.\n\n\u5b9f\u306f\u6700\u521d\u79c1\u306f\u3053\u306e\u5b9a\u7fa9\u3092\u547c\u3093\u3060\u6642\u306b\uff0cReactiveCocoa\u306f\u306a\u3093\u306e\u3082\u306e\u304b\u60f3\u50cf\u3067\u304d\u306a\u304b\u3063\u305f\u3067\u3059\u3002\n\u3057\u304b\u3057\uff0c\u4f7f\u3063\u3066\u307f\u3066\uff0c\u3053\u306e\u5b9a\u7fa9\u306e\u6587\u306f\u5b8c\u74a7\u3060\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u307e\u305f\uff0cReactiveCocoa\u306e\u4ed5\u7d44\u307f\u306fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u5168\u304f\u540c\u3058\u304b\u306a\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3088\u3002\n\u3058\u3083\u6b21\u306fReactiveCocoa\u306e\u5b9a\u7fa9\u306e\u6587\u3068Water pipes\u3092\u7528\u3044\u3066\uff0cReactiveCocoa\u3092\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u8aad\u3093\u3060\u5f8c\u306b\u7d76\u5bfeReactiveCocoa\u306f\u306a\u3093\u306e\u3082\u306e\u304b\u60f3\u50cf\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b9a\u7fa9\u306e\u6587\u306b\u6ce8\u76ee\u3057\u305f\u3044\u306e\u306f\u300cStream\u300d\u300cTransforming\u300d\u300cComposing\u300d\u306e\uff13\u3064\u306e\u8a00\u8449\u3067\u3059\u3002\n\nStream\n\n\n\n\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n    .observe { event in\n        // hi\n    }\n\nsink.sendNext(\"hi\")\n\n\u4e0a\u306e\u56f3\u3092\u307f\u308b\u3068\u8aac\u660e\u304c\u306a\u304f\u3066\u3082\u306a\u3093\u3068\u306a\u304f\u30a4\u30e1\u30fc\u30b8\u3067\u304d\u307e\u3057\u305f\u306d\u3002\nevent\u3092sink\u306b\u5165\u308c\u3066\uff0cobserver\u304c\u305d\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\n\n\n\u3082\u3061\u308d\u3093\uff0c\u6c34\u306f\u4e0a\u306b\u6d41\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3067\u3059\u304c\uff0c\u30a4\u30d9\u30f3\u30c8\u306f\u3059\u3079\u3066\u306e\u65b9\u5411\u306b\u884c\u3051\u307e\u3059\u3002\uff08\u7b11\uff09\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n    .observe { event in\n        // hi\n    }\n\nsignal\n    .observe { event in\n        // hi\n    }\n\nsink.sendNext(\"hi\")\n\n\u3082\u3046\u4e00\u70b9\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u306e\u306f\uff0cobserve\u3059\u308b\u524d\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3067\u3059\u3002\n\nTransforming\n\n\u6b21\u306ftransform\u3067\u3059\u306d\u3002\u307e\u305f\uff0c\u4ee5\u4e0b\u306e\u56f3\u3092\u307f\u308b\u3068\u8aac\u660e\u306f\u4f55\u3082\u306a\u304f\u3066\u3082\u3059\u3050\u308f\u304b\u308a\u307e\u3059\u3002\n\n\n\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n    .map { str in str.uppercaseString }\n    .observe { event in\n        // \u201cHI\"\n    }\n\nsink.sendNext(\"hi\")\n\nTransforming\u306fsignal\u304b\u3089\u5225\u306esignal\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\nReactiveCocoa\u306f\u3044\u308d\u3044\u308d\u306atransform\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u79c1\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u3088\u304f\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\nmap, flatMap, filter, reduce, collect, takeUntil, mapError, skipRepeats, throttle, skip, observeOn...\n\u3082\u3061\u308d\u3093\uff0c\u81ea\u5206\u306f\u65b0\u3057\u3044transform\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306f\u7c21\u5358\u3067\u3059\u3002\n\nComposing\n\n\u6570\u5b66\u306bcompose\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\u2022 compose  <A, B, C> (A -> B, B -> C) -> A -> C\n\nf1:  A -> B\nf2:  B -> C\nf3:  C -> D\n\nf = f1\u30fbf2\u30fbf3\n=> f: A -> D\n\n\n\n\nlet searchResults = searchStrings\n    .flatMap(.Latest) { (query: String) -> SignalProducer<(NSData, NSURLResponse), NSError> in\n        let URLRequest = self.searchRequestWithEscapedQuery(query)\n        return NSURLSession.sharedSession().rac_dataWithRequest(URLRequest)\n    }\n    .map { (data, URLResponse) -> String in\n        let string = String(data: data, encoding: NSUTF8StringEncoding)!\n        return self.parseJSONResultsFromString(string)\n    }\n    .observeOn(UIScheduler())\n    .startWithNext { results in\n        print(\"Search results: \\(results)\")\n    }\n\n\u540c\u3058\u610f\u5473\u3067\uff0cReactiveCocoa\u306fsignal\u3068transform\u3092\u4f55\u56de\u3082\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3042\u308a\uff0c\u65b0\u3057\u3044signal\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\nReactiveCocoa\u3092\u4f7f\u3046\u3068\u3042\u308b\u6642\u306b\u30a2\u30d7\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u304b\u3093\u3058\u306b\u306a\u308a\u307e\u3059\u306d\u3002\uff08\u7b11\uff09\n\n\n\n\u306f\u3044\uff0c\u3053\u3053\u307e\u3067\uff0cWater pipes\u3092\u4f7f\u3063\u3066ReactiveCocoa\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u3082\u3061\u308d\u3093\uff0cReactiveCocoa\u306f\u4ed6\u306e\u6982\u5ff5\u3082\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\u304c\uff0c\u57fa\u76e4\u306e\u6982\u5ff5\u306f\u4e0a\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\nReactiveCocoa\u3068MVVM\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u30b5\u30f3\u30d7\u30eb\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3067\u306f\u3088\u304f\u3042\u308b\u30ea\u30b9\u30c8\u753b\u9762\u3092ReactiveCocoa\u3068MVVM\u30e2\u30c7\u30eb\u3067\u306e\u5b9f\u88c5\u3092\u7d39\u4ecb\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\u5b9f\u306f\u4eca\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Cell\u306b\u5bfe\u3059\u308bCellModel\u3068\u3044\u3046\u6982\u5ff5\u3082\u5c0e\u5165\u3057\u3066\u3044\u3066\uff0cTableView\u3084CollectionView\u306eCell\u3068CellModel\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\uff0c\u81ea\u5206\u304c\u958b\u767a\u3057\u3066\u3044\u308bHakuba\u3001Sapporo\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nclass ProgramsViewModel {\n    private var offset = 0\n\n    private (set) lazy var refreshAction: Action<Int, [ProgramCellModel], ApiError> = { [unowned self] in\n\n        return Action { count in\n            Api.Programs\n                .getPrograms(count: count)\n                .map(ProgramCellModel.init)\n        }\n    }()\n\n    private (set) lazy var loadmoreAction: Action<(Int, Int), [ProgramCellModel], ApiError> = { [unowned self] in\n\n        return Action { offset, count in\n            Api.Programs\n                .getPrograms(offset: offset, count: count)\n                .map(ProgramCellModel.init)\n        }\n    }()\n\n    func refresh() {\n        refreshAction\n            .apply(25)\n            .takeUntil(willDeinitProducer)\n            .on { [unowned self] in\n                self.offset = $0.count\n            }\n            .start()\n    }\n\n    func loadmore() {\n        loadmoreAction\n            .apply(offset, 25)\n            .takeUntil(willDeinitProducer)\n            .on { [unowned self] in\n                self.offset += $0.count\n            }\n            .start()\n    }\n}\n\nclass ProgramsViewController: UIViewController {\n    @IBOutlet private weak var collectionView: UICollectionView!\n\n    private lazy var sapporo: Sapporo = Sapporo(collectionView: self.collectionView)\n    let viewmodel = ProgramViewModel()\n    let viewmodelDisposable = ScopedCompositeDisposable()\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n\n        bindViewModelSignals()\n        sapporo.loadmoreHandler = { [weak self] in\n            self?.viewmodel.loadmore()\n        }\n\n        viewmodel.refresh()\n    }\n}\n\n// MARK: - Private methods\n\nprivate extension ProgramsViewController {\n    func bindViewModelSignals() {\n        viewmodelDisposable += viewmodel.refreshAction.values\n            .observeOn(uiScheduler)\n            .observeNext { [unowned self] cellmodels in\n                self.sapporo[ProgramsSection]\n                    .reset(cellmodels)\n                    .bump()\n            }\n\n        viewmodelDisposable += viewmodel.loadmoreAction.values\n            .observeOn(uiScheduler)\n            .observeNext { [unowned self] cellmodels in\n                self.sapporo[ProgramsSection]\n                    .append(cellmodels)\n                    .bump()\n            }\n\n        viewmodelDisposable += viewmodel.refreshAction.errors\n            .observeOn(uiScheduler)\n            .observeNext { [unowned self] error in\n                // show a reloadable error view\n            }\n\n        viewmodelDisposable += viewmodel.loadmoreAction.errors\n            .observeOn(uiScheduler)\n            .observerNext { [unowned self] error in \n                // show an error message\n            }\n\n        viewmodelDisposable += combineLatest(viewmodel.refreshAction.executing.producer, viewmodel.loadmoreAction.executing.producer)\n            .observeOn(uiScheduler)\n            .map { $0 || $1 }\n            .observerNext { [unowned self] loading in \n                // show or hide loading indicator\n            }\n    }\n}\n\n\n\u6700\u5f8c\u306b\n\u4eca\u65e5\u3001\u81ea\u5206\u306e\u7406\u89e3\u3067ReactiveCocoa\u3068MVVM\u30e2\u30c7\u30eb\u3092\u8efd\u304f\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\nMVVM\u30e2\u30c7\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3084\u30d6\u30ed\u30b0\u306f\u307e\u3060\u307e\u3060\u591a\u304f\u306a\u3044\u306e\u3067\uff0c\u6642\u3005\u56f0\u308a\u307e\u3057\u305f\u70b9\u3082\u3042\u308a\u307e\u3057\u305f\u304c\uff0c\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u5c0e\u5165\u3057\u3066\u307f\u3066\uff0c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u8a08\u304c\u7dba\u9e97\u306b\u306a\u3063\u3066\u3044\u3066\uff0c\u6bce\u65e5\u697d\u3057\u304f\u958b\u767a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n\u660e\u65e5\u306fk66dango\u3055\u3093\u3067\u3059\u3002\n\u3053\u306e\u8a18\u4e8b\u306f[CyberAgent\u30a8\u30f3\u30b8\u30cb\u30a2Advent Calendar 2015](http://www.adventar.org/calendars/863)\u306e\uff12\uff10\u65e5\b\u76ee\u306e\u8a18\u4e8b\u3067\u3059\u3002\n\n## \u306f\u3058\u3081\u306b\n\n\u3053\u3093\u306b\u3061\u306f\u3002\u30b5\u30a4\u30d0\u30fc\u30a8\u30b8\u30a7\u30f3\u30c8\u306e\u65b0\u5352\u306e\u30ae\u30a2[@nghialv](https://github.com/nghialv)\u3068\u7533\u3057\u307e\u3059\u3002\u73fe\u5728\uff0c[AmebaFRESH!](https://amebafresh.tv/pc/index.html)\u3068\u3044\u3046\u65b0\u898f\u751f\u653e\u9001\u30b5\u30fc\u30d3\u30b9\u306e\u30c1\u30fc\u30e0\u306biOS\u30a8\u30f3\u30b8\u30cb\u30a2\u3084\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u79c1\u306f\u5165\u793e\u3057\u305f\u6642\u306b\uff0c\u591a\u304f\u306e\u30e6\u30fc\u30b6\u30fc\u306b\u4f7f\u308f\u308c\u3066\u3044\u308bAmeba\u30a2\u30d7\u30ea\u30c1\u30fc\u30e0\u306b\u5165\u308a\u307e\u3057\u305f\u3002Ameba\u30a2\u30d7\u30ea\u306f\u306a\u3093\u5e74\u524d\u304b\u3089\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u306e\u3067\uff0c\u4eca\u307e\u3067\u306e\u4ed6\u306eiOS\u30a2\u30d7\u30ea\u3068\u540c\u3058\u3067MVC\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3057\u304b\u3057\uff0c\u30a2\u30d7\u30ea\u304c\u3069\u3093\u3069\u3093\u5927\u304d\u304f\u3057\u3066MVC\u30e2\u30c7\u30eb\u306e\u554f\u984c\u70b9\u3092\u611f\u3058\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\uff14\u30f6\u6708\u524d\u306b[AmebaFRESH!](https://amebafresh.tv/pc/index.html)\u306e\u65b0\u898f\u30b5\u30fc\u30d3\u30b9\u306b\u79fb\u52d5\u3057\u3066\uff0cMVVM\u30e2\u30c7\u30eb\u3068ReactiveCocoa\u3092\u691c\u8a0e\u3057\u3066\uff0c\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\n\u4eca\u65e5MVVM\u30e2\u30c7\u30eb\u3068ReactiveCocoa\u306b\u3064\u3044\u3066\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\n## \u76ee\u6b21\n\n- MVC\u304b\u3089MVVM\u306b\u79fb\u52d5\n- Water pipes\u304b\u3089ReactiveCocoa\u3092\u7406\u89e3\n- ReactiveCocoa\u3068MVVM\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u30b5\u30f3\u30d7\u30eb\n\n## MVC\u304b\u3089MVVM\u306b\u79fb\u52d5\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/6bafb8ec-9b33-2908-2a8f-4f893b6b40cd.png\" height=\"150\">\n</p>\n\n\u4e0a\u306e\u56f3\u306f\u4e00\u822c\u7684\u306aMVC\u30e2\u30c7\u30eb\u306e\u4ed5\u7d44\u307f\u3067\u3059\u3002MVC\u30e2\u30c7\u30eb\u306fModel, View, ViewController\u306e\uff13\u3064\u306e\u90e8\u5206\u306b\u5206\u5272\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30e2\u30c7\u30eb\u306f\u4ee5\u4e0b\u306e\uff12\u3064\u554f\u984c\u70b9\u304c\u5b58\u5728\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n\u307e\u305a\u306f\uff0cViewController\u306fModel\u3068View\u3092\u6301\u3063\u3066\u3044\u3066\uff0c\u30ed\u30b8\u30c3\u30af\u306e\u51e6\u7406\u306f\u57fa\u672c\u7684\u306bViewController\u306b\b\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30a2\u30d7\u30ea\u306e\u6210\u9577\u3068\u5171\u306b\u5927\u898f\u6a21\u306aViewController\u304c\u3069\u3093\u3069\u3093\u5897\u3048\u3066\u3044\u304d\u307e\u3059\u3002\uff08\u3053\u306e\u7406\u7531\u3067\u7686\u3093\u306a\u3088\u304fMVC\u306fMassive ViewController\u3068\u547c\u3093\u3067\u3044\u307e\u3059\u306d\uff09iOS\u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u7686\u3055\u3093\u306f\u3053\u306e\u554f\u984c\u3092\u3042\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u306d\u3002\n\n\u6b21\u306f\uff0cViewController\u306fView\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u306e\u3067\uff0cView\u306b\u4f9d\u5b58\u3057\u3066\u3044\u3066\uff0cViewController\u306e\u30c6\u30b9\u30c8\u66f8\u304f\u306e\u306f\u306a\u304b\u306a\u304b\u96e3\u3057\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3053\u3067\uff0c\u30c6\u30b9\u30c8\u66f8\u3051\u308b\u90e8\u5206\u306f\u4e3b\u306bModel\u3068Utility\u306e\u5468\u308a\u3060\u3051\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u305d\u308c\u3089\u306e\u554f\u984c\u70b9\u3067MVVM\u30e2\u30c7\u30eb\u306e\u5c0e\u5165\u3092\u691c\u8a0e\u3057\u307e\u3057\u305f\u3002\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/4c487e9b-37fc-b809-9b09-b5f8b77b64dd.png\" height=\"85\">\n</p>\n\n\u4e0a\u306e\u56f3\u306b\u3088\u308a\uff0cViewModel\u306e\u90e8\u5206\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3057\u305f\u3002\nViewModel\u306fModel\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30c7\u30fc\u30bf\u3092\u57fa\u306bView\u306b\u98df\u308f\u305b\u308b\u5024\u3092\u751f\u6210\u3059\u308b\u30ed\u30b8\u30c3\u30af(\u30d7\u30ec\u30bc\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af)\u3084View\u306e\u72b6\u614b\u3092\u6301\u3061\u307e\u3059\u3002\niOS\u306eViewController\u306fView\u3068\u540c\u3058\u5f79\u5272\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3055\u3089\u306b\uff0cMVC\u3068\u7570\u306a\u3063\u3066\b\uff0cdata binding\u6982\u5ff5\u3092\u5165\u3063\u3066\u3044\u307e\u3059\u3002\nViewModel\u306fView\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u6301\u3061\u3067\u306f\u306a\u304f\uff0cdata binding\u3067ViewModel\u5074\u306f\u30c7\u30fc\u30bf\u306e\u5909\u66f4\u304c\u3042\u308a\u307e\u3057\u305f\u3089\uff0cView\u306b\u901a\u77e5\u3092\u9001\u308a\u307e\u3059\u3002\n\n*\u3058\u3083\u3001MVVM\u30e2\u30c7\u30eb\u306e\u826f\u3044\u70b9?*\n- ViewModel\u306f\u3088\u304f\u5909\u308f\u308c\u308bView\u3092\u6301\u3063\u3066\u3044\u306a\u3044\u306e\u3067\uff0c\u30e2\u30c7\u30eb\u307f\u305f\u3044\u306b\u30c6\u30b9\u30c8\u66f8\u304f\u3053\u3068\u306f\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n- \u5927\u898f\u6a21\u306aViewController\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n- View\u306fViewModel\u306b\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u4ed5\u7d44\u307f\u306a\u306e\u3067\uff0cView\u306e\u30ea\u30bb\u30c3\u30c8\u306a\u3069\u3092\u884c\u3044\u305f\u3044\u5834\u5408\u306f\u5358\u7d14\u65b0\u3057\u3044ViewModel\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\u3057\u3066\uff0c\u518d\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u3053\u3068\u3067\uff0cView\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002\u30b9\u30c6\u30fc\u30c8\u306e\u7ba1\u7406\u304c\u697d\u306b\u306a\u308a\u307e\u3059\u3002\n\n(\u3053\u308c\u306f\u81ea\u5206\u304c\u611f\u3058\u3067\u304d\u305f\u826f\u3044\u70b9\u3067\u3059\u304c\uff0c\u3082\u3057\u4f55\u304b\u308f\u304b\u308a\u307e\u3057\u305f\u3089\uff0c\u8ffd\u52a0\u304a\u9858\u3044\u81f4\u3057\u307e\u3059\u3002)\n\u4e0a\u306f\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u306b\u3064\u3044\u3066\u4f55\u56de\u3082\u8a00\u3044\u307e\u3057\u305f\u304c\uff0c\u5177\u4f53\u7684\u306f\u3069\u3093\u306a\u611f\u3058\u3063\u3066\u7591\u554f\u3057\u3066\u3044\u308b\u4eba\u3082\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\u305d\u308c\u306fReactiveCocoa\u306e\u5f79\u5272\u3067\u3059\u306d\u3002\n\n## Water pipes\u304b\u3089ReactiveCocoa\u7406\u89e3\n\nReactiveCocoa\u306e\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u3067\u3059\u306d\u3002\n> ReactiveCocoa (RAC) is a Cocoa framework inspired by Functional Reactive Programming. It provides APIs for composing and transforming streams of values over time.\n\n\u5b9f\u306f\u6700\u521d\u79c1\u306f\u3053\u306e\u5b9a\u7fa9\u3092\u547c\u3093\u3060\u6642\u306b\uff0cReactiveCocoa\u306f\u306a\u3093\u306e\u3082\u306e\u304b\u60f3\u50cf\u3067\u304d\u306a\u304b\u3063\u305f\u3067\u3059\u3002\n\u3057\u304b\u3057\uff0c\u4f7f\u3063\u3066\u307f\u3066\uff0c\u3053\u306e\u5b9a\u7fa9\u306e\u6587\u306f\u5b8c\u74a7\u3060\u3068\u308f\u304b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u307e\u305f\uff0cReactiveCocoa\u306e\u4ed5\u7d44\u307f\u306fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u5168\u304f\u540c\u3058\u304b\u306a\u3068\u8003\u3048\u3066\u3044\u307e\u3059\u3088\u3002\n\n\u3058\u3083\u6b21\u306fReactiveCocoa\u306e\u5b9a\u7fa9\u306e\u6587\u3068Water pipes\u3092\u7528\u3044\u3066\uff0cReactiveCocoa\u3092\u8aac\u660e\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\u3053\u308c\u3092\u8aad\u3093\u3060\u5f8c\u306b\u7d76\u5bfeReactiveCocoa\u306f\u306a\u3093\u306e\u3082\u306e\u304b\u60f3\u50cf\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b9a\u7fa9\u306e\u6587\u306b\u6ce8\u76ee\u3057\u305f\u3044\u306e\u306f\u300cStream\u300d\u300cTransforming\u300d\u300cComposing\u300d\u306e\uff13\u3064\u306e\u8a00\u8449\u3067\u3059\u3002\n>Stream\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/badc8a57-845c-1d60-7c52-7317c4c6a143.png\" height=\"250\">\n</p>\n\n``` swift\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n    .observe { event in\n\t\t// hi\n\t}\n\t\nsink.sendNext(\"hi\")\n```\n\n\u4e0a\u306e\u56f3\u3092\u307f\u308b\u3068\u8aac\u660e\u304c\u306a\u304f\u3066\u3082\u306a\u3093\u3068\u306a\u304f\u30a4\u30e1\u30fc\u30b8\u3067\u304d\u307e\u3057\u305f\u306d\u3002\nevent\u3092sink\u306b\u5165\u308c\u3066\uff0cobserver\u304c\u305d\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/d0978987-54be-a7b9-7191-23ad98e80037.png\" height=\"200\">\n</p>\n\n\u3082\u3061\u308d\u3093\uff0c\u6c34\u306f\u4e0a\u306b\u6d41\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3067\u3059\u304c\uff0c\u30a4\u30d9\u30f3\u30c8\u306f\u3059\u3079\u3066\u306e\u65b9\u5411\u306b\u884c\u3051\u307e\u3059\u3002\uff08\u7b11\uff09\n\n``` swift\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n    .observe { event in\n\t\t// hi\n\t}\n\t\nsignal\n    .observe { event in\n\t\t// hi\n\t}\n\nsink.sendNext(\"hi\")\n```\n\n\u3082\u3046\u4e00\u70b9\u6ce8\u610f\u304c\u5fc5\u8981\u306a\u306e\u306f\uff0cobserve\u3059\u308b\u524d\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3067\u3059\u3002\n\n\n>Transforming\n\n\u6b21\u306f`transform`\u3067\u3059\u306d\u3002\u307e\u305f\uff0c\u4ee5\u4e0b\u306e\u56f3\u3092\u307f\u308b\u3068\u8aac\u660e\u306f\u4f55\u3082\u306a\u304f\u3066\u3082\u3059\u3050\u308f\u304b\u308a\u307e\u3059\u3002\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/ea2863cf-4ca7-a717-b756-048e47a00078.png\" height=\"250\">\n</p>\n\n``` swift\nlet (signal, sink) = Signal<String, ErrorType>.pipe()\n\nsignal\n\t.map { str in str.uppercaseString }\n\t.observe { event in\n\t\t// \u201cHI\"\n\t}\n\nsink.sendNext(\"hi\")\n```\n\n`Transforming`\u306f`signal`\u304b\u3089\u5225\u306e`signal`\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\nReactiveCocoa\u306f\u3044\u308d\u3044\u308d\u306atransform\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002\u79c1\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u3082\u306e\u3092\u3088\u304f\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n`map`, `flatMap`, `filter`, `reduce`, `collect`, `takeUntil`, `mapError`, `skipRepeats`, `throttle`, `skip`, `observeOn`...\n\u3082\u3061\u308d\u3093\uff0c\u81ea\u5206\u306f\u65b0\u3057\u3044transform\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306f\u7c21\u5358\u3067\u3059\u3002\n\n\n>Composing\n\n\u6570\u5b66\u306b`compose`\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u306d\u3002\n\n```\n\u2022\tcompose  <A, B, C> (A -> B, B -> C) -> A -> C\n\nf1:  A -> B\nf2:  B -> C\nf3:  C -> D\n\nf = f1\u30fbf2\u30fbf3\n=> f: A -> D\n```\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/b7611cf2-f135-229f-d8c9-f716b35857c4.png\" height=\"250\">\n</p>\n\n``` swift\nlet searchResults = searchStrings\n    .flatMap(.Latest) { (query: String) -> SignalProducer<(NSData, NSURLResponse), NSError> in\n        let URLRequest = self.searchRequestWithEscapedQuery(query)\n        return NSURLSession.sharedSession().rac_dataWithRequest(URLRequest)\n    }\n    .map { (data, URLResponse) -> String in\n        let string = String(data: data, encoding: NSUTF8StringEncoding)!\n        return self.parseJSONResultsFromString(string)\n    }\n    .observeOn(UIScheduler())\n    .startWithNext { results in\n    \tprint(\"Search results: \\(results)\")\n\t}\n```\n\n\u540c\u3058\u610f\u5473\u3067\uff0cReactiveCocoa\u306f`signal`\u3068`transform`\u3092\u4f55\u56de\u3082\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3042\u308a\uff0c\u65b0\u3057\u3044`signal`\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u5168\u304fWater pipes\u306e\u4ed5\u7d44\u307f\u3068\u4f3c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\u3002\nReactiveCocoa\u3092\u4f7f\u3046\u3068\u3042\u308b\u6642\u306b\u30a2\u30d7\u30ea\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u304b\u3093\u3058\u306b\u306a\u308a\u307e\u3059\u306d\u3002\uff08\u7b11\uff09\n\n<p align=\"center\">\n<img src=\"https://qiita-image-store.s3.amazonaws.com/0/18907/60a22e7d-297c-17b7-0ab3-adc91586d49a.png\" height=\"250\">\n</p>\n\n\u306f\u3044\uff0c\u3053\u3053\u307e\u3067\uff0cWater pipes\u3092\u4f7f\u3063\u3066ReactiveCocoa\u3092\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\n\u3082\u3061\u308d\u3093\uff0cReactiveCocoa\u306f\u4ed6\u306e\u6982\u5ff5\u3082\u3044\u3063\u3071\u3044\u3042\u308a\u307e\u3059\u304c\uff0c\u57fa\u76e4\u306e\u6982\u5ff5\u306f\u4e0a\u306e\u3068\u304a\u308a\u3067\u3059\u3002\n\n\n## ReactiveCocoa\u3068MVVM\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u30b5\u30f3\u30d7\u30eb\n\n\u30e2\u30d0\u30a4\u30eb\u30a2\u30d7\u30ea\u3067\u306f\u3088\u304f\u3042\u308b\u30ea\u30b9\u30c8\u753b\u9762\u3092ReactiveCocoa\u3068MVVM\u30e2\u30c7\u30eb\u3067\u306e\u5b9f\u88c5\u3092\u7d39\u4ecb\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059\u3002\n\u5b9f\u306f\u4eca\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067Cell\u306b\u5bfe\u3059\u308bCellModel\u3068\u3044\u3046\u6982\u5ff5\u3082\u5c0e\u5165\u3057\u3066\u3044\u3066\uff0cTableView\u3084CollectionView\u306eCell\u3068CellModel\u3092\u7ba1\u7406\u3059\u308b\u305f\u3081\uff0c\u81ea\u5206\u304c\u958b\u767a\u3057\u3066\u3044\u308b[Hakuba](https://github.com/nghialv/Hakuba)\u3001[Sapporo](https://github.com/nghialv/Sapporo)\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n``` swift\n\nclass ProgramsViewModel {\n    private var offset = 0\n\n\tprivate (set) lazy var refreshAction: Action<Int, [ProgramCellModel], ApiError> = { [unowned self] in\n        \n        return Action { count in\n        \tApi.Programs\n        \t\t.getPrograms(count: count)\n        \t\t.map(ProgramCellModel.init)\n        }\n    }()\n    \n    private (set) lazy var loadmoreAction: Action<(Int, Int), [ProgramCellModel], ApiError> = { [unowned self] in\n        \n        return Action { offset, count in\n            Api.Programs\n            \t.getPrograms(offset: offset, count: count)\n            \t.map(ProgramCellModel.init)\n        }\n    }()\n    \n    func refresh() {\n    \trefreshAction\n    \t\t.apply(25)\n    \t\t.takeUntil(willDeinitProducer)\n    \t\t.on { [unowned self] in\n    \t\t\tself.offset = $0.count\n    \t\t}\n    \t\t.start()\n    }\n    \n    func loadmore() {\n    \tloadmoreAction\n    \t\t.apply(offset, 25)\n    \t\t.takeUntil(willDeinitProducer)\n    \t\t.on { [unowned self] in\n    \t\t\tself.offset += $0.count\n    \t\t}\n    \t\t.start()\n    }\n}\n```\n\n``` swift\nclass ProgramsViewController: UIViewController {\n\t@IBOutlet private weak var collectionView: UICollectionView!\n\n\tprivate lazy var sapporo: Sapporo = Sapporo(collectionView: self.collectionView)\n\tlet viewmodel = ProgramViewModel()\n\tlet viewmodelDisposable = ScopedCompositeDisposable()\n\t\n\toverride func viewDidLoad() {\n\t\tsuper.viewDidLoad()\n\t\t\n\t\tbindViewModelSignals()\n\t\tsapporo.loadmoreHandler = { [weak self] in\n            self?.viewmodel.loadmore()\n        }\n        \n\t\tviewmodel.refresh()\n\t}\n}\n\n// MARK: - Private methods\n\nprivate extension ProgramsViewController {\n\tfunc bindViewModelSignals() {\n\t\tviewmodelDisposable += viewmodel.refreshAction.values\n\t\t\t.observeOn(uiScheduler)\n\t\t\t.observeNext { [unowned self] cellmodels in\n\t\t\t\tself.sapporo[ProgramsSection]\n\t\t\t\t\t.reset(cellmodels)\n\t\t\t\t\t.bump()\n\t\t\t}\n\t\t\t\n\t\tviewmodelDisposable += viewmodel.loadmoreAction.values\n\t\t\t.observeOn(uiScheduler)\n\t\t\t.observeNext { [unowned self] cellmodels in\n\t\t\t\tself.sapporo[ProgramsSection]\n\t\t\t\t\t.append(cellmodels)\n\t\t\t\t\t.bump()\n\t\t\t}\n\t\t\t\n\t\tviewmodelDisposable += viewmodel.refreshAction.errors\n\t\t\t.observeOn(uiScheduler)\n\t\t\t.observeNext { [unowned self] error in\n\t\t\t\t// show a reloadable error view\n\t\t\t}\n\t\t\t\n\t\tviewmodelDisposable += viewmodel.loadmoreAction.errors\n\t\t\t.observeOn(uiScheduler)\n\t\t\t.observerNext { [unowned self] error in \n\t\t\t\t// show an error message\n\t\t\t}\n\t\t\n\t\tviewmodelDisposable += combineLatest(viewmodel.refreshAction.executing.producer, viewmodel.loadmoreAction.executing.producer)\n\t\t\t.observeOn(uiScheduler)\n\t\t\t.map { $0 || $1 }\n\t\t\t.observerNext { [unowned self] loading in \n\t\t\t\t// show or hide loading indicator\n\t\t\t}\n\t}\n}\n```\n\n## \u6700\u5f8c\u306b\n\n\u4eca\u65e5\u3001\u81ea\u5206\u306e\u7406\u89e3\u3067ReactiveCocoa\u3068MVVM\u30e2\u30c7\u30eb\u3092\u8efd\u304f\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\nMVVM\u30e2\u30c7\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3084\u30d6\u30ed\u30b0\u306f\u307e\u3060\u307e\u3060\u591a\u304f\u306a\u3044\u306e\u3067\uff0c\u6642\u3005\u56f0\u308a\u307e\u3057\u305f\u70b9\u3082\u3042\u308a\u307e\u3057\u305f\u304c\uff0c\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b\u5c0e\u5165\u3057\u3066\u307f\u3066\uff0c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u8a2d\u8a08\u304c\u7dba\u9e97\u306b\u306a\u3063\u3066\u3044\u3066\uff0c\u6bce\u65e5\u697d\u3057\u304f\u958b\u767a\u3067\u304d\u3066\u3044\u307e\u3059\u3002\n\n\n-----\n\u660e\u65e5\u306fk66dango\u3055\u3093\u3067\u3059\u3002\n", "tags": ["Swift", "iOS", "ReactiveCocoa", "MVVM", "FRP"]}