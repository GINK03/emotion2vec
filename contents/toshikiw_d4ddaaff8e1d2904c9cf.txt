{"context": " More than 1 year has passed since last update.XFS\u306f\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u7e2e\u5c0f\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u7e2e\u5c0f\u3092\u3059\u308b\u306b\u306f\u524a\u9664\u2192\u4f5c\u6210\u306e\u624b\u9806\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u3061\u3087\u3063\u3068\u691c\u7d22\u3057\u3066\u3082\u624b\u9806\u304c\u307f\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u74b0\u5883\nVirtualBox\u306bCentOS 7\u3092\u6700\u5c0f\u69cb\u6210\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nlvm\u3067home\u306broot\u4ee5\u5916\u306e\u5168\u3066\u306e\u9818\u57df\u3092\u5272\u5f53\u3066\u305f\u5f8c\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u7e2e\u5c0f\u3092\u3059\u308b\u624b\u9806\n\u30aa\u30f3\u30e9\u30a4\u30f3\u30fb\u30ea\u30e2\u30fc\u30c8\u3067\u306e\u4f5c\u696d\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3002\n\u5bfe\u8c61\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u3044\u5834\u5408\u3001\u30b7\u30f3\u30b0\u30eb\u30e6\u30fc\u30b6\u30fc\u30e2\u30fc\u30c9\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u70ba\u3001\u3053\u306e\u624b\u9806\u306f\u4f7f\u3048\u306a\u3044\u3002\n(\u505c\u6b62\u3067\u304d\u306a\u3044\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308b\u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u3069)\n$ uname -s -r -v -m -o\nLinux 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 GNU/Linux\n$ cat /etc/redhat-release \nCentOS Linux release 7.1.1503 (Core) \n$ df -h\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9            \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/mapper/centos-root   2.0G  924M  1.1G   46% /\ndevtmpfs                  236M     0  236M    0% /dev\ntmpfs                     245M     0  245M    0% /dev/shm\ntmpfs                     245M  4.3M  241M    2% /run\ntmpfs                     245M     0  245M    0% /sys/fs/cgroup\n/dev/mapper/centos-home   4.7G   33M  4.7G    1% /home\n/dev/sda1                 497M  119M  379M   24% /boot\n\n\n\u53c2\u8003\n\nLVM \u306e\u30b5\u30a4\u30ba\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u5909\u66f4\u3059\u308b\u3002\nLVM\u306e\u4f7f\u3044\u65b9\nxfsdump,xfsrestore\u3067XFS\u306e\u30c7\u30a3\u30b9\u30af\u30b3\u30d4\u30fc\nLinux \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30b5\u30a4\u30ba\u3092\u5909\u66f4\u3059\u308b: \u7b2c 2 \u56de \u9ad8\u5ea6\u306a\u30b5\u30a4\u30ba\u5909\u66f4\n\n\n\u30ea\u30b5\u30a4\u30ba\u624b\u9806\n/home \u3092\u30ea\u30b5\u30a4\u30ba\u3059\u308b\u70ba\u306b\u30ea\u30b5\u30a4\u30ba\u7528\u30e6\u30fc\u30b6\u30fc\u3092/home\u4ee5\u5916\u306b\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6301\u3064\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u30ea\u30b5\u30a4\u30ba\u4f5c\u696d\u3092\u884c\u3046\n\n\u624b\u9806\u6982\u8981\n\n/home\u4ee5\u5916\u306b\u30db\u30fc\u30e0\u3092\u6301\u3064wheel\u306b\u6240\u5c5e\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\n\u4f5c\u696d\u30e6\u30fc\u30b6\u30fc\u3067ssh\n/home \u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n/home\u3092\u7e2e\u5c0f\n\u7a7a\u9818\u57df\u3092\u65b0\u898f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u3059\u308b\n\n\n\u624b\u9806\u8a73\u7d30\n\u4f5c\u696d\u7528\u30db\u30fc\u30e0\u3092\u4f5c\u308a\u4f5c\u696d\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\n\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u5f8c\u3001ssh\u306e\u9375\u3092\u8a2d\u7f6e\u3059\u308b\nselinux\u304c\u6709\u52b9\u306a\u5834\u5408\u3001\u30e9\u30d9\u30eb\u306e\u8a2d\u5b9a\u3082\u304a\u3053\u306a\u3046\n$ cd /\n$ sudo mkdir work\n$ sudo useradd -d /work/resize -m -G wheel -p resize resize\n$ sudo passwd resize\n$ cd /work\n$ sudo -u resize mkdir resize/.ssh\n$ sudo -u resize vi resize/.ssh/authorized_keys\n$ sudo -u resize chmod 700 resize/.ssh\n$ sudo -u resize chmod 600 resize/.ssh/authorized_keys\n$ sudo chcon -t ssh_home_t resize/.ssh\n$ sudo chcon -t ssh_home_t resize/.ssh/authorized_keys\n$ exit\n\n\u30ea\u30b5\u30a4\u30ba\u7528\u30e6\u30fc\u30b6\u30fc(resize)\u3067\u30ed\u30b0\u30a4\u30f3\nlocal$ ssh -l resize srv1\n\nxfsdump \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ sudo yum install xfsdump\n\n\u30c0\u30f3\u30d7\u4f5c\u6210\n$ cd /work\n$ sudo xfsdump -J -L home -M drive -f home.dump /home\nxfsdump: using file dump (drive_simple) strategy\nxfsdump: version 3.1.4 (dump format 3.0) - type ^C for status and control\nxfsdump: level 0 dump of srv1.localdomain:/home\nxfsdump: dump date: Fri Apr 10 21:29:26 2015\nxfsdump: session id: 397ff781-1fe4-4799-b5d4-6c4948bb807a\nxfsdump: session label: \"home\"\nxfsdump: ino map phase 1: constructing initial dump list\nxfsdump: ino map phase 2: skipping (no pruning necessary)\nxfsdump: ino map phase 3: skipping (only one dump stream)\nxfsdump: ino map construction complete\nxfsdump: estimated dump size: 47936 bytes\nxfsdump: creating dump session media file 0 (media 0, file 0)\nxfsdump: dumping ino map\nxfsdump: dumping directories\nxfsdump: dumping non-directory files\nxfsdump: ending media file\nxfsdump: media file size 32928 bytes\nxfsdump: dump size (non-dir files) : 6336 bytes\nxfsdump: dump complete: 0 seconds elapsed\nxfsdump: Dump Summary:\nxfsdump:   stream 0 /work/home.dump OK (success)\nxfsdump: Dump Status: SUCCESS\n\n/home \u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n$ sudo umount /dev/mapper/centos-home\n\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u60c5\u5831\u53d6\u5f97\nVG name \u304c\u5fc5\u8981\u306b\u306a\u308b\n$ sudo lvdisplay\n\n\u5229\u7528\u505c\u6b62 \u2192 \u524a\u9664\n$ sudo lvscan\n$ sudo lvchange -an /dev/centos/home\n$ sudo lvremove /dev/centos/home\n\n\u65b0/home \u4f5c\u6210\n$ sudo lvcreate -L 1.7G -n home centos\n$ sudo mkfs.xfs /dev/centos/home\n$ sudo mount /dev/centos/home\n$ sudo xfsrestore -J -L home -f home.dump /home\n\n\u6b8b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\n$ sudo lvcreate -l 100%FREE -n drbd centos\n$ sudo mkfs.xfs /dev/centos/drbd\n$ sudo mkdir /drbd\n$ sudo vi /etc/fstab\n# drbd\u306e\u30de\u30a6\u30f3\u30c8\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\n/dev/mapper/centos-drbd /drbd                   xfs     defaults        0 0\n$ sudo mount /dev/centos/drbd\n\nXFS\u306f\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u7e2e\u5c0f\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u305b\u3093\u3002\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u7e2e\u5c0f\u3092\u3059\u308b\u306b\u306f\u524a\u9664\u2192\u4f5c\u6210\u306e\u624b\u9806\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u3061\u3087\u3063\u3068\u691c\u7d22\u3057\u3066\u3082\u624b\u9806\u304c\u307f\u3064\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u3066\u304a\u304d\u307e\u3059\u3002\n\n# \u74b0\u5883\n\nVirtualBox\u306bCentOS 7\u3092\u6700\u5c0f\u69cb\u6210\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nlvm\u3067home\u306broot\u4ee5\u5916\u306e\u5168\u3066\u306e\u9818\u57df\u3092\u5272\u5f53\u3066\u305f\u5f8c\u3001\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u7e2e\u5c0f\u3092\u3059\u308b\u624b\u9806\n\n\u30aa\u30f3\u30e9\u30a4\u30f3\u30fb\u30ea\u30e2\u30fc\u30c8\u3067\u306e\u4f5c\u696d\u3092\u60f3\u5b9a\u3057\u3066\u3044\u308b\u3002\n\u5bfe\u8c61\u306e\u30dc\u30ea\u30e5\u30fc\u30e0\u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\u3067\u304d\u306a\u3044\u5834\u5408\u3001\u30b7\u30f3\u30b0\u30eb\u30e6\u30fc\u30b6\u30fc\u30e2\u30fc\u30c9\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u70ba\u3001\u3053\u306e\u624b\u9806\u306f\u4f7f\u3048\u306a\u3044\u3002\n(\u505c\u6b62\u3067\u304d\u306a\u3044\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308b\u30dc\u30ea\u30e5\u30fc\u30e0\u306a\u3069)\n\n```\n$ uname -s -r -v -m -o\nLinux 3.10.0-229.el7.x86_64 #1 SMP Fri Mar 6 11:36:42 UTC 2015 x86_64 GNU/Linux\n$ cat /etc/redhat-release \nCentOS Linux release 7.1.1503 (Core) \n$ df -h\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9            \u30b5\u30a4\u30ba  \u4f7f\u7528  \u6b8b\u308a \u4f7f\u7528% \u30de\u30a6\u30f3\u30c8\u4f4d\u7f6e\n/dev/mapper/centos-root   2.0G  924M  1.1G   46% /\ndevtmpfs                  236M     0  236M    0% /dev\ntmpfs                     245M     0  245M    0% /dev/shm\ntmpfs                     245M  4.3M  241M    2% /run\ntmpfs                     245M     0  245M    0% /sys/fs/cgroup\n/dev/mapper/centos-home   4.7G   33M  4.7G    1% /home\n/dev/sda1                 497M  119M  379M   24% /boot\n```\n\n## \u53c2\u8003\n\n* [LVM \u306e\u30b5\u30a4\u30ba\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u306e\u307e\u307e\u5909\u66f4\u3059\u308b\u3002](http://d.hatena.ne.jp/Naruhodius/20120116/1326658909)\n* [LVM\u306e\u4f7f\u3044\u65b9](http://d.hatena.ne.jp/kt_hiro/20120117/1326764520)\n* [xfsdump,xfsrestore\u3067XFS\u306e\u30c7\u30a3\u30b9\u30af\u30b3\u30d4\u30fc](http://blog.livedoor.jp/hakin/archives/51578266.html)\n* [Linux \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30b5\u30a4\u30ba\u3092\u5909\u66f4\u3059\u308b: \u7b2c 2 \u56de \u9ad8\u5ea6\u306a\u30b5\u30a4\u30ba\u5909\u66f4](http://www.ibm.com/developerworks/jp/linux/library/l-resizing-partitions-2/)\n\n## \u30ea\u30b5\u30a4\u30ba\u624b\u9806\n\n/home \u3092\u30ea\u30b5\u30a4\u30ba\u3059\u308b\u70ba\u306b\u30ea\u30b5\u30a4\u30ba\u7528\u30e6\u30fc\u30b6\u30fc\u3092/home\u4ee5\u5916\u306b\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6301\u3064\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308a\u30ea\u30b5\u30a4\u30ba\u4f5c\u696d\u3092\u884c\u3046\n\n## \u624b\u9806\u6982\u8981\n\n1. /home\u4ee5\u5916\u306b\u30db\u30fc\u30e0\u3092\u6301\u3064wheel\u306b\u6240\u5c5e\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\n2. \u4f5c\u696d\u30e6\u30fc\u30b6\u30fc\u3067ssh\n3. /home \u3092\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n4. /home\u3092\u7e2e\u5c0f\n5. \u7a7a\u9818\u57df\u3092\u65b0\u898f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u3059\u308b\n\n## \u624b\u9806\u8a73\u7d30\n\n\u4f5c\u696d\u7528\u30db\u30fc\u30e0\u3092\u4f5c\u308a\u4f5c\u696d\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u308b\n\u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\u5f8c\u3001ssh\u306e\u9375\u3092\u8a2d\u7f6e\u3059\u308b\nselinux\u304c\u6709\u52b9\u306a\u5834\u5408\u3001\u30e9\u30d9\u30eb\u306e\u8a2d\u5b9a\u3082\u304a\u3053\u306a\u3046\n\n```\n$ cd /\n$ sudo mkdir work\n$ sudo useradd -d /work/resize -m -G wheel -p resize resize\n$ sudo passwd resize\n$ cd /work\n$ sudo -u resize mkdir resize/.ssh\n$ sudo -u resize vi resize/.ssh/authorized_keys\n$ sudo -u resize chmod 700 resize/.ssh\n$ sudo -u resize chmod 600 resize/.ssh/authorized_keys\n$ sudo chcon -t ssh_home_t resize/.ssh\n$ sudo chcon -t ssh_home_t resize/.ssh/authorized_keys\n$ exit\n```\n\n\u30ea\u30b5\u30a4\u30ba\u7528\u30e6\u30fc\u30b6\u30fc(resize)\u3067\u30ed\u30b0\u30a4\u30f3\n\n```\nlocal$ ssh -l resize srv1\n```\n\nxfsdump \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo yum install xfsdump\n```\n\n\u30c0\u30f3\u30d7\u4f5c\u6210\n\n```\n$ cd /work\n$ sudo xfsdump -J -L home -M drive -f home.dump /home\nxfsdump: using file dump (drive_simple) strategy\nxfsdump: version 3.1.4 (dump format 3.0) - type ^C for status and control\nxfsdump: level 0 dump of srv1.localdomain:/home\nxfsdump: dump date: Fri Apr 10 21:29:26 2015\nxfsdump: session id: 397ff781-1fe4-4799-b5d4-6c4948bb807a\nxfsdump: session label: \"home\"\nxfsdump: ino map phase 1: constructing initial dump list\nxfsdump: ino map phase 2: skipping (no pruning necessary)\nxfsdump: ino map phase 3: skipping (only one dump stream)\nxfsdump: ino map construction complete\nxfsdump: estimated dump size: 47936 bytes\nxfsdump: creating dump session media file 0 (media 0, file 0)\nxfsdump: dumping ino map\nxfsdump: dumping directories\nxfsdump: dumping non-directory files\nxfsdump: ending media file\nxfsdump: media file size 32928 bytes\nxfsdump: dump size (non-dir files) : 6336 bytes\nxfsdump: dump complete: 0 seconds elapsed\nxfsdump: Dump Summary:\nxfsdump:   stream 0 /work/home.dump OK (success)\nxfsdump: Dump Status: SUCCESS\n```\n\n/home \u30a2\u30f3\u30de\u30a6\u30f3\u30c8\n\n```\n$ sudo umount /dev/mapper/centos-home\n```\n\n\u8ad6\u7406\u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u60c5\u5831\u53d6\u5f97\nVG name \u304c\u5fc5\u8981\u306b\u306a\u308b\n\n```\n$ sudo lvdisplay\n```\n\n\u5229\u7528\u505c\u6b62 \u2192 \u524a\u9664\n\n```\n$ sudo lvscan\n$ sudo lvchange -an /dev/centos/home\n$ sudo lvremove /dev/centos/home\n```\n\n\u65b0/home \u4f5c\u6210\n\n```\n$ sudo lvcreate -L 1.7G -n home centos\n$ sudo mkfs.xfs /dev/centos/home\n$ sudo mount /dev/centos/home\n$ sudo xfsrestore -J -L home -f home.dump /home\n```\n\n\u6b8b\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\n\n```\n$ sudo lvcreate -l 100%FREE -n drbd centos\n$ sudo mkfs.xfs /dev/centos/drbd\n$ sudo mkdir /drbd\n$ sudo vi /etc/fstab\n# drbd\u306e\u30de\u30a6\u30f3\u30c8\u60c5\u5831\u3092\u8ffd\u52a0\u3059\u308b\n/dev/mapper/centos-drbd /drbd                   xfs     defaults        0 0\n$ sudo mount /dev/centos/drbd\n```\n", "tags": ["CentOS", "xfs", "lvm"]}