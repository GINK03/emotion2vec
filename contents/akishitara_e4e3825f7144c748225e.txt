{"tags": ["alluxio", "Spark"], "context": "\u3061\u3087\u3063\u3068\u6c17\u306b\u306a\u3063\u305f\u8a18\u4e8b\u3060\u3063\u305f\u306e\u3067\u3055\u308f\u3063\u3066\u307f\u305f\u3002\n\nhttp://www.nttdata.com/jp/ja/insights/trend_keyword/2016042101.html (Apache Spark\u3088\u308a100\u500d\u901f\u3044\uff1f\uff1f)\n\u5370\u8c61\u3068\u3057\u3066\u306fHDFS\u3092\u305d\u306e\u307e\u307e\u30a4\u30f3\u30e1\u30e2\u30ea\u306b\u3057\u305f\u611f\u3058\uff1f\nHDFS\u3082RAID0\u306b\u3057\u3066\u30bd\u30d5\u30c8\u4e0a\u3067\u5197\u9577\u62c5\u4fdd\u3059\u308b\u307f\u305f\u3044\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u30a4\u30f3\u30e1\u30e2\u30ea\u3067\u30c7\u30fc\u30bf\u3068\u3093\u3067\u3082\u5927\u4e08\u592b\u3063\u3066\u3053\u3068\u304b\u306a\uff1f\n\u6700\u8fd1\u30e1\u30e2\u30ea\u3082\u5b89\u3044\u3057\u307b\u3093\u3068\u306b100\u500d\u65e9\u3044\u306a\u3089\u5b9f\u7528\u7684\u304b\u3082\n\u203b amazon \u8a08\u7b97\u306732GB\u304c \u00a516,500 = 1TB\u3067 \u00a5515,625 \u304f\u3089\u3044\n\n\u203b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u304b\u8aad\u307e\u306a\u3044\u6d3e\u3067QuickStart\u3057\u304b\u8aad\u3093\u3067\u306a\u3044\u306e\u3067\u52d8\u9055\u3044\u306f\u8a31\u3057\u3066\u304f\u3060\u3055\u3044mm\n\nalluxio SetUp\n\u30ed\u30fc\u30ab\u30eb\u306bSpark\u304c\u3044\u3066sample\u306bSpark\u304c\u3042\u3063\u305f\u306e\u3067Spark\u3068\u3064\u306a\u3052\u3066\u307f\u308b\nhttp://www.alluxio.org/docs/1.3/en/Running-Spark-on-Alluxio.html\n\nalluxio\u8d77\u52d5\u307e\u3067\n$ wget http://alluxio.org/downloads/files/1.3.0/alluxio-1.3.0-bin.tar.gz\n$ tar xfvz alluxio-1.3.0-bin.tar.gz\n$ ln -s alluxio-1.3.0 alluxio\n$ cd alluxio\n$ mvn clean package -Pspark -DskipTests\n$ ./bin/alluxio-start.sh local\n\nhttp://IP:19999/ \u3067\u305d\u308c\u3063\u307d\u3044\u753b\u9762\u304c\u3067\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\n\n500\u4e07\u884c\u306e1G\u304f\u3089\u3044\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3063\u307d\u3044\u30c7\u30fc\u30bf\n\n$ wc -l /var/tmp/work/*\n  1695360 log1.txt\n  1692365 log2.txt\n  1705114 log3.txt\n  5092839 total\n$ ll -h /var/tmp/work/*\n-rw-r--r-- 1 root root 303M Oct 25 22:17 /var/tmp/work/log1.txt\n-rw-r--r-- 1 root root 303M Oct 25 22:17 /var/tmp/work/log2.txt\n-rw-r--r-- 1 root root 305M Oct 25 22:17 /var/tmp/work/log3.txt\n\n\n\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u308b\n$ ./bin/alluxio fs copyFromLocal /var/tmp/work /work\nCopied /var/tmp/work to /work\n$\n\nhttp://IP:19999/ \u3092\u307f\u3066\u307f\u308b\n\n\n\u5165\u3063\u305f\u3063\u307d\u3044\n\u3061\u306a\u307f\u306bHDFS\u3063\u307d\u304fls\u3068\u304brm\u3068\u304bcat\u3068\u304b\u3082\u3064\u304b\u3048\u308b\n$ ./bin/alluxio fs cat /work/* |wc -l\n5092839\n$\n\n\nSpark\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\nSpark SetUp\n$ wget http://apache.mirrors.pair.com/spark/spark-2.0.1/spark-2.0.0.tgz\n$ tar xfvz spark-2.0.0.tgz\n$ ln -s spark-2.0.0.tgz spark\n$ cd spark\n$ mvn clean package -Pspark -DskipTests\n$ ./sbin/start-all.sh # ssh localhost\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\n$ vi conf/spark-defaults.conf # \u3055\u3063\u304dalluxio\u3092build\u3057\u305fclient\u306ejar\u3092\u6307\u5b9a\u3059\u308b\nspark.driver.extraClassPath /root/alluxio/core/client/target/alluxio-core-client-1.3.0-jar-with-dependencies.jar\nspark.executor.extraClassPath /root/alluxio/core/client/target/alluxio-core-client-1.3.0-jar-with-dependencies.jar\n\n\ncount\u3057\u3066\u307f\u308b\n$ ./bin/spark-shell\nscala> val s = sc.textFile(\"alluxio://localhost:19998/work/*\")\ns: org.apache.spark.rdd.RDD[String] = alluxio://localhost:19998/work/* MapPartitionsRDD[1] at textFile at <console>:24\n\nscala> s.count()\n[Stage 2:=======================================>                   (2 + 1) / 3]\nres0: Long = 5092839                                                            \n\nscala>\n\n\u3061\u3083\u3093\u3068\u3046\u3054\u3044\u3066\u308b\u3063\u307d\u3044\n\n\u3061\u306a\u307f\u306b1G\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u307f\u305f\u6642\u9593\n\nalluxio\nscala> val start = System.currentTimeMillis(); val s = sc.textFile(\"alluxio://localhost:19998/work/*\"); s.count(); val end = System.currentTimeMillis(); val interval = end - start;\nstart: Long = 1477907300034                                                     \ns: org.apache.spark.rdd.RDD[String] = alluxio://localhost:19998/work/* MapPartitionsRDD[1] at textFile at <console>:30\nend: Long = 1477907304488\ninterval: Long = 4454\n\nscala> \n\n\n\nlocal\nscala> val start = System.currentTimeMillis(); val s = sc.textFile(\"/var/tmp/work/*\"); s.count(); val end = System.currentTimeMillis(); val interval = end - start;\nstart: Long = 1477907405639                                                     \ns: org.apache.spark.rdd.RDD[String] = /var/tmp/work/* MapPartitionsRDD[5] at textFile at <console>:32\nend: Long = 1477907409010\ninterval: Long = 3371\n\nscala> \n\n\n\u307e\u30411G\u304f\u3089\u3044\u3060\u3068\u5bfe\u3057\u3066\u5909\u308f\u3089\u3093\uff1f(1TB\u3068\u304b\u306e\u30e1\u30e2\u30ea\u7528\u610f\u3067\u304d\u308c\u3070\u3061\u3083\u3093\u3068\u8a08\u6e2c\u3067\u304d\u308b\u3093\u3060\u3051\u3069\u304a\u304b\u306d\u306a\u3044;;)\n\u3061\u3087\u3063\u3068\u6c17\u306b\u306a\u3063\u305f\u8a18\u4e8b\u3060\u3063\u305f\u306e\u3067\u3055\u308f\u3063\u3066\u307f\u305f\u3002\n\n* http://www.nttdata.com/jp/ja/insights/trend_keyword/2016042101.html (Apache Spark\u3088\u308a100\u500d\u901f\u3044\uff1f\uff1f)\n\n- \u5370\u8c61\u3068\u3057\u3066\u306fHDFS\u3092\u305d\u306e\u307e\u307e\u30a4\u30f3\u30e1\u30e2\u30ea\u306b\u3057\u305f\u611f\u3058\uff1f\n- HDFS\u3082RAID0\u306b\u3057\u3066\u30bd\u30d5\u30c8\u4e0a\u3067\u5197\u9577\u62c5\u4fdd\u3059\u308b\u307f\u305f\u3044\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u306e\u3067\u3001\u30a4\u30f3\u30e1\u30e2\u30ea\u3067\u30c7\u30fc\u30bf\u3068\u3093\u3067\u3082\u5927\u4e08\u592b\u3063\u3066\u3053\u3068\u304b\u306a\uff1f\n- \u6700\u8fd1\u30e1\u30e2\u30ea\u3082\u5b89\u3044\u3057\u307b\u3093\u3068\u306b100\u500d\u65e9\u3044\u306a\u3089\u5b9f\u7528\u7684\u304b\u3082\n\u203b [amazon](https://www.amazon.co.jp/s/ref=sr_nr_p_n_feature_fifteen__mrr_3?fst=as%3Aoff&rh=n%3A2127209051%2Cn%3A%212127210051%2Cn%3A2151901051%2Cn%3A2151941051%2Cp_n_feature_four_browse-bin%3A2225478051%2Cp_n_feature_fifteen_browse-bin%3A3958567051&bbn=2151941051&ie=UTF8&qid=1479972388&rnid=2510054051) \u8a08\u7b97\u306732GB\u304c \u00a516,500 = 1TB\u3067 \u00a5515,625 \u304f\u3089\u3044\n\n\u203b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u304b\u8aad\u307e\u306a\u3044\u6d3e\u3067QuickStart\u3057\u304b\u8aad\u3093\u3067\u306a\u3044\u306e\u3067\u52d8\u9055\u3044\u306f\u8a31\u3057\u3066\u304f\u3060\u3055\u3044mm\n\n## alluxio SetUp\n\n\u30ed\u30fc\u30ab\u30eb\u306bSpark\u304c\u3044\u3066sample\u306bSpark\u304c\u3042\u3063\u305f\u306e\u3067Spark\u3068\u3064\u306a\u3052\u3066\u307f\u308b\nhttp://www.alluxio.org/docs/1.3/en/Running-Spark-on-Alluxio.html\n\n### alluxio\u8d77\u52d5\u307e\u3067\n\n```bash\n$ wget http://alluxio.org/downloads/files/1.3.0/alluxio-1.3.0-bin.tar.gz\n$ tar xfvz alluxio-1.3.0-bin.tar.gz\n$ ln -s alluxio-1.3.0 alluxio\n$ cd alluxio\n$ mvn clean package -Pspark -DskipTests\n$ ./bin/alluxio-start.sh local\n```\n\nhttp://IP:19999/ \u3067\u305d\u308c\u3063\u307d\u3044\u753b\u9762\u304c\u3067\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n### \u30b5\u30f3\u30d7\u30eb\u30c7\u30fc\u30bf\n\n* 500\u4e07\u884c\u306e1G\u304f\u3089\u3044\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3063\u307d\u3044\u30c7\u30fc\u30bf\n\n```bash\n$ wc -l /var/tmp/work/*\n  1695360 log1.txt\n  1692365 log2.txt\n  1705114 log3.txt\n  5092839 total\n$ ll -h /var/tmp/work/*\n-rw-r--r-- 1 root root 303M Oct 25 22:17 /var/tmp/work/log1.txt\n-rw-r--r-- 1 root root 303M Oct 25 22:17 /var/tmp/work/log2.txt\n-rw-r--r-- 1 root root 305M Oct 25 22:17 /var/tmp/work/log3.txt\n```\n\n## \u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u308b\n\n```bash\n$ ./bin/alluxio fs copyFromLocal /var/tmp/work /work\nCopied /var/tmp/work to /work\n$\n```\n\nhttp://IP:19999/ \u3092\u307f\u3066\u307f\u308b\n\n![alluxio.png](https://qiita-image-store.s3.amazonaws.com/0/63102/11e00caf-c35d-3603-bfff-01f4f0b4056a.png)\n\n![alluxio2.png](https://qiita-image-store.s3.amazonaws.com/0/63102/e7dbe631-10ee-d605-a8ae-830ebac76297.png)\n\n\n\u5165\u3063\u305f\u3063\u307d\u3044\n\n\u3061\u306a\u307f\u306bHDFS\u3063\u307d\u304fls\u3068\u304brm\u3068\u304bcat\u3068\u304b\u3082\u3064\u304b\u3048\u308b\n\n```\n$ ./bin/alluxio fs cat /work/* |wc -l\n5092839\n$\n```\n\n## Spark\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\n\n### Spark SetUp\n\n```bash\n$ wget http://apache.mirrors.pair.com/spark/spark-2.0.1/spark-2.0.0.tgz\n$ tar xfvz spark-2.0.0.tgz\n$ ln -s spark-2.0.0.tgz spark\n$ cd spark\n$ mvn clean package -Pspark -DskipTests\n$ ./sbin/start-all.sh # ssh localhost\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\n$ vi conf/spark-defaults.conf # \u3055\u3063\u304dalluxio\u3092build\u3057\u305fclient\u306ejar\u3092\u6307\u5b9a\u3059\u308b\nspark.driver.extraClassPath /root/alluxio/core/client/target/alluxio-core-client-1.3.0-jar-with-dependencies.jar\nspark.executor.extraClassPath /root/alluxio/core/client/target/alluxio-core-client-1.3.0-jar-with-dependencies.jar\n```\n\n### count\u3057\u3066\u307f\u308b\n\n```bash\n$ ./bin/spark-shell\nscala> val s = sc.textFile(\"alluxio://localhost:19998/work/*\")\ns: org.apache.spark.rdd.RDD[String] = alluxio://localhost:19998/work/* MapPartitionsRDD[1] at textFile at <console>:24\n\nscala> s.count()\n[Stage 2:=======================================>                   (2 + 1) / 3]\nres0: Long = 5092839                                                            \n\nscala>\n```\n\n\u3061\u3083\u3093\u3068\u3046\u3054\u3044\u3066\u308b\u3063\u307d\u3044\n\n## \u3061\u306a\u307f\u306b1G\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u3066\u307f\u305f\u6642\u9593\n\n```bash:alluxio\nscala> val start = System.currentTimeMillis(); val s = sc.textFile(\"alluxio://localhost:19998/work/*\"); s.count(); val end = System.currentTimeMillis(); val interval = end - start;\nstart: Long = 1477907300034                                                     \ns: org.apache.spark.rdd.RDD[String] = alluxio://localhost:19998/work/* MapPartitionsRDD[1] at textFile at <console>:30\nend: Long = 1477907304488\ninterval: Long = 4454\n\nscala> \n```\n\n```bash:local\nscala> val start = System.currentTimeMillis(); val s = sc.textFile(\"/var/tmp/work/*\"); s.count(); val end = System.currentTimeMillis(); val interval = end - start;\nstart: Long = 1477907405639                                                     \ns: org.apache.spark.rdd.RDD[String] = /var/tmp/work/* MapPartitionsRDD[5] at textFile at <console>:32\nend: Long = 1477907409010\ninterval: Long = 3371\n\nscala> \n```\n\n\u307e\u30411G\u304f\u3089\u3044\u3060\u3068\u5bfe\u3057\u3066\u5909\u308f\u3089\u3093\uff1f(1TB\u3068\u304b\u306e\u30e1\u30e2\u30ea\u7528\u610f\u3067\u304d\u308c\u3070\u3061\u3083\u3093\u3068\u8a08\u6e2c\u3067\u304d\u308b\u3093\u3060\u3051\u3069\u304a\u304b\u306d\u306a\u3044;;)\n"}