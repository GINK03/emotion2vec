{"context": "\n\n\u4e8b\u524d\u306bProxmox VE\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4e00\u3064\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3060\u3051\u66f8\u304d\u623b\u3059\u65b9\u6cd5\uff08\u6210\u529f\uff09\n# NAS4Free\nzpool import -f -d /dev/gptid -R /mnt/rpool rpool\n\nzfs destroy -f rpool/ROOT/pve-1\nzfs snapshot <tank>/pve-1@temp\nzfs send     <tank>/pve-1@temp | zfs recv rpool/ROOT/pve-1\nzfs destroy  <tank>/pve-1@temp\nzfs destroy  rpool/ROOT/pve-1@temp\n\nzfs set mountpoint=/ rpool/ROOT/pve-1\nzpool export rpool\n\n# Proxmox VE(ext4 root)\n# \u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u308b\u30d7\u30fc\u30eb\u3092\u78ba\u8a8d\nzpool import\n\n# rpool\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u30fb\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\nzpool import -f -R /mnt/rpool rpool && zfs unmount rpool\n\n# ACL\u3092\u6709\u52b9\u306b\u3059\u308b\nzfs set acltype=posixacl rpool/ROOT && zfs set xattr=sa rpool/ROOT\n\n# rpool/ROOT/pve-1\u3092\u524a\u9664\nzfs destroy rpool/ROOT/pve-1\n\n# \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089rpool/ROOT/pve-1\u3092\u5fa9\u65e7\nzfs send tank20160418/pve-1@rpool_to_tank20160418 | zfs recv rpool/ROOT/pve-1\n\n# \u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\nzfs set mountpoint=/ rpool/ROOT/pve-1\n\n# rpool\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nzpool export rpool\n\n\n\u4e00\u304b\u3089\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u65b9\u6cd5\uff08\u5931\u6557\uff09\n\u3082\u3068\u3082\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067Proxmox VE\u306eZFS Root\u306e\u8907\u88fd\u304c\u3067\u304d\u308b\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001zpool\u306eguid\u304c\u5909\u308f\u308b\u3068\u30d6\u30fc\u30c8\u3067\u304d\u306a\u304f\u306a\u308b\u3088\u3046\u3067\u3057\u305f\u3002\nZFS Root\u3067\u30d6\u30fc\u30c8\u4e2d\u306b\u3084\u308d\u3046\u3068\u3059\u308b\u3068rpool\u304c\u91cd\u8907\u3059\u308b\u305f\u3081\u3001MBR\u3001BIOS boot partition\u304a\u3088\u3073rpool/ROOT/pve-1\u3092\u4e00\u5ea6HDD\u306b\u30b3\u30d4\u30fc\u3057\u3001NAS4Free\u3067\u30d6\u30fc\u30c8\u3059\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u3059\u3002\n#NAS4Free\n#\u8abf\u67fb\ngeom disk list\ngpart list\ngpart show da1\n\n#\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u6d88\u53bb\u30fb\u4f5c\u6210\ngpart destroy da1\ngpart create -s gpt da1\ngpart add -t bios-boot      -b 34 -s 2014    da1\ngpart add -t '\\!<partuuid>' -b 2048 -l 'zfs' da1\ngpart set -a bootme -i 1 da1\n\n#zpool\u4f5c\u6210\ngnop create -S 4096 da1p2\nzpool create rpool da1p2.nop\nzfs set compression=lz4 rpool\nzfs set atime=off rpool\nzfs set sync=standard rpool\n\n#zfs\u4f5c\u6210\nzfs create rpool/ROOT\nzfs create -V 2G -b 4K -o primarycache=metadata -o sync=always -o com.sun:auto-snapshot=false rpool/swap\n\n#zpool\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30fb\u30a4\u30f3\u30dd\u30fc\u30c8\nzpool export rpool\ngnop destroy da1p2.nop\nzpool import -d /dev/gptid -R /mnt/rpool rpool\n\n#\u672c\u4f53zfs\u30b3\u30d4\u30fc\nzfs snapshot <tank>/<fs>@temp\nzfs send     <tank>/<fs>@temp | zfs recv rpool/ROOT/pve-1\nzfs destroy  <tank>/<fs>@temp\nzfs destroy  rpool/ROOT/pve-1@temp\n\n#\u78ba\u8a8d\nzpool list\nzfs list\n\n#zpool\u30fbzfs\u8a2d\u5b9a\nzpool set bootfs=rpool/ROOT/pve-1 rpool\nzfs set mountpoint=/ rpool/ROOT/pve-1\nzfs set mountpoint=/rpool rpool\n\n#zpool\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nzpool export rpool\n\n#mbr\u30fbbios_boot\u30b3\u30d4\u30fc\ndd if=/mbr1 of=/dev/da1 bs=512 count=1\ndd if=/bios_boot1 of=/dev/da1p1\n\n#\u4e8b\u524d\u306bProxmox VE\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4e00\u3064\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3060\u3051\u66f8\u304d\u623b\u3059\u65b9\u6cd5\uff08\u6210\u529f\uff09\n```\n# NAS4Free\nzpool import -f -d /dev/gptid -R /mnt/rpool rpool\n\nzfs destroy -f rpool/ROOT/pve-1\nzfs snapshot <tank>/pve-1@temp\nzfs send     <tank>/pve-1@temp | zfs recv rpool/ROOT/pve-1\nzfs destroy  <tank>/pve-1@temp\nzfs destroy  rpool/ROOT/pve-1@temp\n\nzfs set mountpoint=/ rpool/ROOT/pve-1\nzpool export rpool\n\n# Proxmox VE(ext4 root)\n# \u30a4\u30f3\u30dd\u30fc\u30c8\u3067\u304d\u308b\u30d7\u30fc\u30eb\u3092\u78ba\u8a8d\nzpool import\n\n# rpool\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u30fb\u30a2\u30f3\u30de\u30a6\u30f3\u30c8\nzpool import -f -R /mnt/rpool rpool && zfs unmount rpool\n\n# ACL\u3092\u6709\u52b9\u306b\u3059\u308b\nzfs set acltype=posixacl rpool/ROOT && zfs set xattr=sa rpool/ROOT\n\n# rpool/ROOT/pve-1\u3092\u524a\u9664\nzfs destroy rpool/ROOT/pve-1\n\n# \u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u304b\u3089rpool/ROOT/pve-1\u3092\u5fa9\u65e7\nzfs send tank20160418/pve-1@rpool_to_tank20160418 | zfs recv rpool/ROOT/pve-1\n\n# \u30de\u30a6\u30f3\u30c8\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\nzfs set mountpoint=/ rpool/ROOT/pve-1\n\n# rpool\u3092\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nzpool export rpool\n```\n\n#\u4e00\u304b\u3089\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u65b9\u6cd5\uff08\u5931\u6557\uff09\n\u3082\u3068\u3082\u3068\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067Proxmox VE\u306eZFS Root\u306e\u8907\u88fd\u304c\u3067\u304d\u308b\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001zpool\u306eguid\u304c\u5909\u308f\u308b\u3068\u30d6\u30fc\u30c8\u3067\u304d\u306a\u304f\u306a\u308b\u3088\u3046\u3067\u3057\u305f\u3002\n\nZFS Root\u3067\u30d6\u30fc\u30c8\u4e2d\u306b\u3084\u308d\u3046\u3068\u3059\u308b\u3068rpool\u304c\u91cd\u8907\u3059\u308b\u305f\u3081\u3001MBR\u3001BIOS boot partition\u304a\u3088\u3073rpool/ROOT/pve-1\u3092\u4e00\u5ea6HDD\u306b\u30b3\u30d4\u30fc\u3057\u3001NAS4Free\u3067\u30d6\u30fc\u30c8\u3059\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u3059\u3002\n\n```\n#NAS4Free\n#\u8abf\u67fb\ngeom disk list\ngpart list\ngpart show da1\n\n#\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u6d88\u53bb\u30fb\u4f5c\u6210\ngpart destroy da1\ngpart create -s gpt da1\ngpart add -t bios-boot      -b 34 -s 2014    da1\ngpart add -t '\\!<partuuid>' -b 2048 -l 'zfs' da1\ngpart set -a bootme -i 1 da1\n\n#zpool\u4f5c\u6210\ngnop create -S 4096 da1p2\nzpool create rpool da1p2.nop\nzfs set compression=lz4 rpool\nzfs set atime=off rpool\nzfs set sync=standard rpool\n\n#zfs\u4f5c\u6210\nzfs create rpool/ROOT\nzfs create -V 2G -b 4K -o primarycache=metadata -o sync=always -o com.sun:auto-snapshot=false rpool/swap\n\n#zpool\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\u30fb\u30a4\u30f3\u30dd\u30fc\u30c8\nzpool export rpool\ngnop destroy da1p2.nop\nzpool import -d /dev/gptid -R /mnt/rpool rpool\n\n#\u672c\u4f53zfs\u30b3\u30d4\u30fc\nzfs snapshot <tank>/<fs>@temp\nzfs send     <tank>/<fs>@temp | zfs recv rpool/ROOT/pve-1\nzfs destroy  <tank>/<fs>@temp\nzfs destroy  rpool/ROOT/pve-1@temp\n\n#\u78ba\u8a8d\nzpool list\nzfs list\n\n#zpool\u30fbzfs\u8a2d\u5b9a\nzpool set bootfs=rpool/ROOT/pve-1 rpool\nzfs set mountpoint=/ rpool/ROOT/pve-1\nzfs set mountpoint=/rpool rpool\n\n#zpool\u30a8\u30af\u30b9\u30dd\u30fc\u30c8\nzpool export rpool\n\n#mbr\u30fbbios_boot\u30b3\u30d4\u30fc\ndd if=/mbr1 of=/dev/da1 bs=512 count=1\ndd if=/bios_boot1 of=/dev/da1p1\n```\n", "tags": ["proxmox"]}