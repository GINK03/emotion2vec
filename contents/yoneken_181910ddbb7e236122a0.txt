{"context": " More than 1 year has passed since last update.\u6771\u4eac\u8a3c\u5238\u53d6\u5f15\u6240\u306e\u516c\u5f0f\u30da\u30fc\u30b8\u304b\u3089\uff0cExcel\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3057\uff0cpandas\u306b\u683c\u7d0d\u3057\u307e\u3059\uff0e\n\u3064\u3044\u3067\u306bCSV\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3082\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u304b\u306d\uff0e\n\ngetStockNameYJ.py\n# -*- coding: utf-8 -*-\nfrom urllib2 import *\nfrom lxml import html\nimport numpy as np\nimport pandas as pd\n\nbase_url = 'http://www.tse.or.jp'\n\ndef getTosyo1DataURI():\n    contents = urlopen(base_url + '/market/data/listed_companies/index.html').read()\n    dom = html.fromstring(contents)\n\n    ep = dom.xpath(u'.//td[contains(text(), \"\u5e02\u5834\u7b2c\u4e00\u90e8 \uff08\u5185\u56fd\u682a\uff09 \")]')[0].getparent()\n    e = ep.xpath('.//a')[0]\n\n    return base_url + e.attrib['href']\n\ndef getStockNameDF():\n    ds = np.DataSource(None)\n    f = ds.open(getTosyo1DataURI())\n    df = pd.ExcelFile(f).parse('Sheet1')\n    f.close()\n\n    return pd.DataFrame({'code': df[u\"\u30b3\u30fc\u30c9\"].astype('int64'), 'name': df[u\"\u9298\u67c4\u540d\"]})\n\ndef saveCSV(df):\n    df[['code','name']].to_csv('tosyo1.csv', index=False, encoding='utf-8')\n\nif __name__ == '__main__':\n    df = getStockNameDF()\n    #df.save('stock_name.pdpy')\n    #df = pd.DataFrame.load('stock_name.pdpy')\n    saveCSV(df)\n\n\n\n[\u6771\u4eac\u8a3c\u5238\u53d6\u5f15\u6240](http://www.tse.or.jp/market/data/listed_companies/ \"\u6771\u4eac\u8a3c\u5238\u53d6\u5f15\u6240\")\u306e\u516c\u5f0f\u30da\u30fc\u30b8\u304b\u3089\uff0cExcel\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\u3057\uff0c[pandas](http://pandas.pydata.org/ \"pandas\")\u306b\u683c\u7d0d\u3057\u307e\u3059\uff0e\n\u3064\u3044\u3067\u306bCSV\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3082\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u304b\u306d\uff0e\n\n```python:getStockNameYJ.py\n# -*- coding: utf-8 -*-\nfrom urllib2 import *\nfrom lxml import html\nimport numpy as np\nimport pandas as pd\n\nbase_url = 'http://www.tse.or.jp'\n\ndef getTosyo1DataURI():\n\tcontents = urlopen(base_url + '/market/data/listed_companies/index.html').read()\n\tdom = html.fromstring(contents)\n\n\tep = dom.xpath(u'.//td[contains(text(), \"\u5e02\u5834\u7b2c\u4e00\u90e8 \uff08\u5185\u56fd\u682a\uff09 \")]')[0].getparent()\n\te = ep.xpath('.//a')[0]\n\n\treturn base_url + e.attrib['href']\n\ndef getStockNameDF():\n\tds = np.DataSource(None)\n\tf = ds.open(getTosyo1DataURI())\n\tdf = pd.ExcelFile(f).parse('Sheet1')\n\tf.close()\n\n\treturn pd.DataFrame({'code': df[u\"\u30b3\u30fc\u30c9\"].astype('int64'), 'name': df[u\"\u9298\u67c4\u540d\"]})\n\ndef saveCSV(df):\n\tdf[['code','name']].to_csv('tosyo1.csv', index=False, encoding='utf-8')\n\nif __name__ == '__main__':\n\tdf = getStockNameDF()\n\t#df.save('stock_name.pdpy')\n\t#df = pd.DataFrame.load('stock_name.pdpy')\n\tsaveCSV(df)\n```\n\n", "tags": ["stock", "pandas", "Python", "numpy", "scraping"]}