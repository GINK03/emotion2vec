{"context": " More than 1 year has passed since last update.Docker\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u306e\u306b\u3001SSH\u7d4c\u7531\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3068\u4fbf\u5229\u3067\u3059\u304c\u3001openssh-server\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u8a2d\u5b9a\u3001sshd_config\u306e\u5909\u66f4\u7b49\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u4e0b\u8a18\u306f\u3001SSH\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306aDocker\u30a4\u30e1\u30fc\u30b8\u3092Packer\u3067\u751f\u6210\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002\n\ndocker.json\n{\n  \"builders\": [\n    {\n      \"name\": \"centos6-docker\",\n      \"type\": \"docker\",\n      \"image\": \"centos\",\n      \"export_path\": \"centos6-docker.tar\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"inline\": [\n        \"yum -y update\",\n        \"yum install -y openssh-server\",\n        \"echo 'root:PASSWORD' | chpasswd\",\n        \"ssh-keygen -q -N '' -t dsa -f /etc/ssh/ssh_host_dsa_key\",\n        \"ssh-keygen -q -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key\",\n        \"sed -i 's/UsePAM.*/UsePAM no/g' /etc/ssh/sshd_config\",\n        \"sed -i 's/#PermitRootLogin.*/PermitRootLogin yes/g' /etc/ssh/sshd_config\"\n      ]\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"docker-import\",\n      \"repository\": \"centos6\",\n      \"tag\": \"latest\",\n      \"only\": [\n        \"centos6-docker\"\n      ]\n    }\n  ]\n}\n\n\n\u4e0a\u8a18\u3067\u306f\u3001root\u30ed\u30b0\u30a4\u30f3\u3092PASSWORD\u3067\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\u9375\u7b49\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u5225\u9014File Provisioner\u7b49\u3092\u4f7f\u7528\u3057\u3066\u3001\u8a2d\u5b9a\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4e0a\u8a18\u8a2d\u5b9a\u3092\u4f7f\u7528\u3057\u3066Packer\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n$ packer build docker.json\n\n\n\u30d3\u30eb\u30c9\u3057\u305f\u30a4\u30e1\u30fc\u30b8centos6\u3092sshd\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n$ sudo docker run -p 2222:22 centos6 /usr/sbin/sshd -D\n\n\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u6b63\u3057\u304fSSH\u306b\u63a5\u7d9a\u3067\u304d\u305f\u304b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n$ ssh -p 2222 127.0.0.1\n\n\nDocker\u3092\u4f7f\u7528\u3059\u308b\u969b\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u72b6\u6cc1\u3092\u78ba\u8a8d\u3059\u308b\u306e\u306b\u3001SSH\u7d4c\u7531\u3067\u63a5\u7d9a\u3067\u304d\u308b\u3068\u4fbf\u5229\u3067\u3059\u304c\u3001`openssh-server`\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3084\u8a2d\u5b9a\u3001`sshd_config`\u306e\u5909\u66f4\u7b49\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4e0b\u8a18\u306f\u3001SSH\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306aDocker\u30a4\u30e1\u30fc\u30b8\u3092[Packer](http://www.packer.io/)\u3067\u751f\u6210\u3059\u308b\u8a2d\u5b9a\u3067\u3059\u3002\n\n```json:docker.json\n{\n  \"builders\": [\n    {\n      \"name\": \"centos6-docker\",\n      \"type\": \"docker\",\n      \"image\": \"centos\",\n      \"export_path\": \"centos6-docker.tar\"\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"inline\": [\n        \"yum -y update\",\n        \"yum install -y openssh-server\",\n        \"echo 'root:PASSWORD' | chpasswd\",\n        \"ssh-keygen -q -N '' -t dsa -f /etc/ssh/ssh_host_dsa_key\",\n        \"ssh-keygen -q -N '' -t rsa -f /etc/ssh/ssh_host_rsa_key\",\n        \"sed -i 's/UsePAM.*/UsePAM no/g' /etc/ssh/sshd_config\",\n        \"sed -i 's/#PermitRootLogin.*/PermitRootLogin yes/g' /etc/ssh/sshd_config\"\n      ]\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"docker-import\",\n      \"repository\": \"centos6\",\n      \"tag\": \"latest\",\n      \"only\": [\n        \"centos6-docker\"\n      ]\n    }\n  ]\n}\n```\n\n\u4e0a\u8a18\u3067\u306f\u3001root\u30ed\u30b0\u30a4\u30f3\u3092PASSWORD\u3067\u8a31\u53ef\u3057\u3066\u3044\u307e\u3059\u3002\u9375\u7b49\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306b\u306f\u3001\u5225\u9014[File Provisioner](http://www.packer.io/docs/provisioners/file.html)\u7b49\u3092\u4f7f\u7528\u3057\u3066\u3001\u8a2d\u5b9a\u3092\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n* \u4e0a\u8a18\u8a2d\u5b9a\u3092\u4f7f\u7528\u3057\u3066Packer\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\n\n```\n$ packer build docker.json\n```\n\n* \u30d3\u30eb\u30c9\u3057\u305f\u30a4\u30e1\u30fc\u30b8`centos6`\u3092sshd\u3092\u6307\u5b9a\u3057\u3066\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ sudo docker run -p 2222:22 centos6 /usr/sbin/sshd -D\n```\n\n* \u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u6b63\u3057\u304fSSH\u306b\u63a5\u7d9a\u3067\u304d\u305f\u304b\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n```\n$ ssh -p 2222 127.0.0.1\n```\n", "tags": ["CentOS", "docker", "packer"]}