{"context": " More than 1 year has passed since last update.Nginx\u3067\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u3059\u308b\u6642\u306b\uff0c\u30bb\u30c3\u30b7\u30e7\u30f3\u7dad\u6301\u554f\u984c\u306b\u3076\u3064\u304b\u3063\u305f\u306e\u3067\uff0c\u305d\u306e\u6642\u306e\u30e1\u30e2\uff0e\n\u5143\u3005Nginx\u306b\u3042\u308bip_hash\u3092\u4f7f\u3063\u3066\u3082\uff0c\u304d\u308c\u3044\u306b\u632f\u308a\u5206\u3051\u3089\u308c\u3066\u3044\u308b\u3068\u601d\u3048\u306a\u304b\u3063\u305f\u306e\u3067\u56f0\u3063\u3066\u3044\u305f\uff0e\nUsing nginx as HTTP load balancer\n\u8abf\u3079\u3066\u307f\u308b\u3068\uff0c\u795e\u69d8\u304c\u3059\u3067\u306b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u3063\u3066\u4e0b\u3055\u3063\u3066\u305f\uff0e\nnginx-goodies / nginx-sticky-module-ng   \u2014 Bitbucket\n\nNginx\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n\u4eca\u56de\u306froot\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\uff0e\u6700\u5f8c\u306e--add-module\u306e\u3068\u3053\u308d\u306f\u7d76\u5bfe\u30d1\u30b9\u3067\uff0e\nconfigure\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5404\u81ea\u306b\u4efb\u305b\u307e\u3059\uff0e\uff08\u3068\u308a\u3042\u3048\u305a\u3044\u3063\u3071\u3044\u4ed8\u3044\u3066\u3044\u308b\uff09\n[root@vagrant-centos65 ~]$ cd ~\n[root@vagrant-centos65 ~]$ yum remove nginx #\u3082\u3057\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306a\u3089\n[root@vagrant-centos65 ~]$ yum install git wget pcre pcre-devel zlib zlib-devel openssl openssl-devel\n[root@vagrant-centos65 ~]$ wget http://nginx.org/download/nginx-1.7.10.tar.gz\n[root@vagrant-centos65 ~]$ tar zxvf nginx-1.7.10.tar.gz\n[root@vagrant-centos65 nginx-1.7.10]$ cd nginx-1.7.10\n[root@vagrant-centos65 nginx-1.7.10]$ git clone https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng.git\n[root@vagrant-centos65 nginx-1.7.10]$ ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-http_spdy_module --with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' --add-module=/root/nginx-1.7.10/nginx-sticky-module-ng\n[root@vagrant-centos65 nginx-1.7.10]$ make\n[root@vagrant-centos65 nginx-1.7.10]$ make install\n[root@vagrant-centos65 nginx-1.7.10]$ nginx -v\nnginx version: nginx/1.7.10\n\n\nService\u3092\u767b\u9332\nservice\u30b3\u30de\u30f3\u30c9\u3067Nginx\u3092\u6271\u3044\u305f\u304b\u3063\u305f\u3067\u3059\uff01\n[root@vagrant-centos65 ~]$ cd /etc/init.d\n[root@vagrant-centos65 init.d]$ vim nginx\n\n\n/etc/init.d/nginx\n#!/bin/sh\n#\n# nginx        Startup script for nginx\n#\n# chkconfig: - 85 15\n# processname: nginx\n# config: /etc/nginx/nginx.conf\n# config: /etc/sysconfig/nginx\n# pidfile: /var/run/nginx.pid\n# description: nginx is an HTTP and reverse proxy server\n#\n### BEGIN INIT INFO\n# Provides: nginx\n# Required-Start: $local_fs $remote_fs $network\n# Required-Stop: $local_fs $remote_fs $network\n# Default-Start: 2 3 4 5\n# Default-Stop: 0 1 6\n# Short-Description: start and stop nginx\n### END INIT INFO\n\n# Source function library.\n. /etc/rc.d/init.d/functions\n\nif [ -L $0 ]; then\n    initscript=`/bin/readlink -f $0`\nelse\n    initscript=$0\nfi\n\nsysconfig=`/bin/basename $initscript`\n\nif [ -f /etc/sysconfig/$sysconfig ]; then\n    . /etc/sysconfig/$sysconfig\nfi\n\nnginx=${NGINX-/usr/sbin/nginx}\nprog=`/bin/basename $nginx`\nconffile=${CONFFILE-/etc/nginx/nginx.conf}\nlockfile=${LOCKFILE-/var/lock/subsys/nginx}\npidfile=${PIDFILE-/var/run/nginx.pid}\nSLEEPMSEC=${SLEEPMSEC-200000}\nUPGRADEWAITLOOPS=${UPGRADEWAITLOOPS-5}\nRETVAL=0\n\nstart() {\n    echo -n $\"Starting $prog: \"\n\n    daemon --pidfile=${pidfile} ${nginx} -c ${conffile}\n    RETVAL=$?\n    echo\n    [ $RETVAL = 0 ] && touch ${lockfile}\n    return $RETVAL\n}\n\nstop() {\n    echo -n $\"Stopping $prog: \"\n    killproc -p ${pidfile} ${prog}\n    RETVAL=$?\n    echo\n    [ $RETVAL = 0 ] && rm -f ${lockfile} ${pidfile}\n}\n\nreload() {\n    echo -n $\"Reloading $prog: \"\n    killproc -p ${pidfile} ${prog} -HUP\n    RETVAL=$?\n    echo\n}\n\nupgrade() {\n    oldbinpidfile=${pidfile}.oldbin\n\n    configtest -q || return\n    echo -n $\"Starting new master $prog: \"\n    killproc -p ${pidfile} ${prog} -USR2\n    echo\n\n    for i in `/usr/bin/seq $UPGRADEWAITLOOPS`; do\n        /bin/usleep $SLEEPMSEC\n        if [ -f ${oldbinpidfile} -a -f ${pidfile} ]; then\n            echo -n $\"Graceful shutdown of old $prog: \"\n            killproc -p ${oldbinpidfile} ${prog} -QUIT\n            RETVAL=$?\n            echo\n            return\n        fi\n    done\n\n    echo $\"Upgrade failed!\"\n    RETVAL=1\n}\n\nconfigtest() {\n    if [ \"$#\" -ne 0 ] ; then\n        case \"$1\" in\n            -q)\n                FLAG=$1\n                ;;\n            *)\n                ;;\n        esac\n        shift\n    fi\n    ${nginx} -t -c ${conffile} $FLAG\n    RETVAL=$?\n    return $RETVAL\n}\n\nrh_status() {\n    status -p ${pidfile} ${nginx}\n}\n\n# See how we were called.\ncase \"$1\" in\n    start)\n        rh_status >/dev/null 2>&1 && exit 0\n        start\n        ;;\n    stop)\n        stop\n        ;;\n    status)\n        rh_status\n        RETVAL=$?\n        ;;\n    restart)\n        configtest -q || exit $RETVAL\n        stop\n        start\n        ;;\n    upgrade)\n        rh_status >/dev/null 2>&1 || exit 0\n        upgrade\n        ;;\n    condrestart|try-restart)\n        if rh_status >/dev/null 2>&1; then\n            stop\n            start\n        fi\n        ;;\n    force-reload|reload)\n        reload\n        ;;\n    configtest)\n        configtest\n        ;;\n    *)\n        echo $\"Usage: $prog {start|stop|restart|condrestart|try-restart|force-reload|upgrade|reload|status|help|configtest}\"\n        RETVAL=2\nesac\n\nexit $RETVAL\n\n\n[root@vagrant-centos65 init.d]$ chmod 755 nginx\n[root@vagrant-centos65 init.d]$ chkconfig --add nginx\n[root@vagrant-centos65 init.d]$ service nginx status\nnginx is stopped\n\n\u3067\u304d\u305f\uff01\n\nNginx\u3067\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u3059\u308b\u6642\u306b\uff0c\u30bb\u30c3\u30b7\u30e7\u30f3\u7dad\u6301\u554f\u984c\u306b\u3076\u3064\u304b\u3063\u305f\u306e\u3067\uff0c\u305d\u306e\u6642\u306e\u30e1\u30e2\uff0e\n\n\u5143\u3005Nginx\u306b\u3042\u308bip_hash\u3092\u4f7f\u3063\u3066\u3082\uff0c\u304d\u308c\u3044\u306b\u632f\u308a\u5206\u3051\u3089\u308c\u3066\u3044\u308b\u3068\u601d\u3048\u306a\u304b\u3063\u305f\u306e\u3067\u56f0\u3063\u3066\u3044\u305f\uff0e\n[Using nginx as HTTP load balancer](http://nginx.org/en/docs/http/load_balancing.html \"Using nginx as HTTP load balancer\")\n\n\u8abf\u3079\u3066\u307f\u308b\u3068\uff0c\u795e\u69d8\u304c\u3059\u3067\u306b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f5c\u3063\u3066\u4e0b\u3055\u3063\u3066\u305f\uff0e\n[nginx-goodies / nginx-sticky-module-ng   \u2014 Bitbucket](https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng \"\n  nginx-goodies / nginx-sticky-module-ng   \u2014 Bitbucket\")\n\n\n#Nginx\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n\u4eca\u56de\u306froot\u3067\u5b9f\u884c\u3057\u3066\u3044\u307e\u3059\uff0e\u6700\u5f8c\u306e--add-module\u306e\u3068\u3053\u308d\u306f\u7d76\u5bfe\u30d1\u30b9\u3067\uff0e\nconfigure\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306f\u5404\u81ea\u306b\u4efb\u305b\u307e\u3059\uff0e\uff08\u3068\u308a\u3042\u3048\u305a\u3044\u3063\u3071\u3044\u4ed8\u3044\u3066\u3044\u308b\uff09\n\n```\n[root@vagrant-centos65 ~]$ cd ~\n[root@vagrant-centos65 ~]$ yum remove nginx #\u3082\u3057\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u306a\u3089\n[root@vagrant-centos65 ~]$ yum install git wget pcre pcre-devel zlib zlib-devel openssl openssl-devel\n[root@vagrant-centos65 ~]$ wget http://nginx.org/download/nginx-1.7.10.tar.gz\n[root@vagrant-centos65 ~]$ tar zxvf nginx-1.7.10.tar.gz\n[root@vagrant-centos65 nginx-1.7.10]$ cd nginx-1.7.10\n[root@vagrant-centos65 nginx-1.7.10]$ git clone https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng.git\n[root@vagrant-centos65 nginx-1.7.10]$ ./configure --prefix=/etc/nginx --sbin-path=/usr/sbin/nginx --conf-path=/etc/nginx/nginx.conf --error-log-path=/var/log/nginx/error.log --http-log-path=/var/log/nginx/access.log --pid-path=/var/run/nginx.pid --lock-path=/var/run/nginx.lock --http-client-body-temp-path=/var/cache/nginx/client_temp --http-proxy-temp-path=/var/cache/nginx/proxy_temp --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp --http-scgi-temp-path=/var/cache/nginx/scgi_temp --user=nginx --group=nginx --with-http_ssl_module --with-http_realip_module --with-http_addition_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_random_index_module --with-http_secure_link_module --with-http_stub_status_module --with-http_auth_request_module --with-mail --with-mail_ssl_module --with-file-aio --with-ipv6 --with-http_spdy_module --with-cc-opt='-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector --param=ssp-buffer-size=4 -m64 -mtune=generic' --add-module=/root/nginx-1.7.10/nginx-sticky-module-ng\n[root@vagrant-centos65 nginx-1.7.10]$ make\n[root@vagrant-centos65 nginx-1.7.10]$ make install\n[root@vagrant-centos65 nginx-1.7.10]$ nginx -v\nnginx version: nginx/1.7.10\n```\n\n\n\n#Service\u3092\u767b\u9332\nservice\u30b3\u30de\u30f3\u30c9\u3067Nginx\u3092\u6271\u3044\u305f\u304b\u3063\u305f\u3067\u3059\uff01\n\n```\n[root@vagrant-centos65 ~]$ cd /etc/init.d\n[root@vagrant-centos65 init.d]$ vim nginx\n```\n\n```bash:/etc/init.d/nginx\n#!/bin/sh\n#\n# nginx        Startup script for nginx\n#\n# chkconfig: - 85 15\n# processname: nginx\n# config: /etc/nginx/nginx.conf\n# config: /etc/sysconfig/nginx\n# pidfile: /var/run/nginx.pid\n# description: nginx is an HTTP and reverse proxy server\n#\n### BEGIN INIT INFO\n# Provides: nginx\n# Required-Start: $local_fs $remote_fs $network\n# Required-Stop: $local_fs $remote_fs $network\n# Default-Start: 2 3 4 5\n# Default-Stop: 0 1 6\n# Short-Description: start and stop nginx\n### END INIT INFO\n\n# Source function library.\n. /etc/rc.d/init.d/functions\n\nif [ -L $0 ]; then\n    initscript=`/bin/readlink -f $0`\nelse\n    initscript=$0\nfi\n\nsysconfig=`/bin/basename $initscript`\n\nif [ -f /etc/sysconfig/$sysconfig ]; then\n    . /etc/sysconfig/$sysconfig\nfi\n\nnginx=${NGINX-/usr/sbin/nginx}\nprog=`/bin/basename $nginx`\nconffile=${CONFFILE-/etc/nginx/nginx.conf}\nlockfile=${LOCKFILE-/var/lock/subsys/nginx}\npidfile=${PIDFILE-/var/run/nginx.pid}\nSLEEPMSEC=${SLEEPMSEC-200000}\nUPGRADEWAITLOOPS=${UPGRADEWAITLOOPS-5}\nRETVAL=0\n\nstart() {\n    echo -n $\"Starting $prog: \"\n\n    daemon --pidfile=${pidfile} ${nginx} -c ${conffile}\n    RETVAL=$?\n    echo\n    [ $RETVAL = 0 ] && touch ${lockfile}\n    return $RETVAL\n}\n\nstop() {\n    echo -n $\"Stopping $prog: \"\n    killproc -p ${pidfile} ${prog}\n    RETVAL=$?\n    echo\n    [ $RETVAL = 0 ] && rm -f ${lockfile} ${pidfile}\n}\n\nreload() {\n    echo -n $\"Reloading $prog: \"\n    killproc -p ${pidfile} ${prog} -HUP\n    RETVAL=$?\n    echo\n}\n\nupgrade() {\n    oldbinpidfile=${pidfile}.oldbin\n\n    configtest -q || return\n    echo -n $\"Starting new master $prog: \"\n    killproc -p ${pidfile} ${prog} -USR2\n    echo\n\n    for i in `/usr/bin/seq $UPGRADEWAITLOOPS`; do\n        /bin/usleep $SLEEPMSEC\n        if [ -f ${oldbinpidfile} -a -f ${pidfile} ]; then\n            echo -n $\"Graceful shutdown of old $prog: \"\n            killproc -p ${oldbinpidfile} ${prog} -QUIT\n            RETVAL=$?\n            echo\n            return\n        fi\n    done\n\n    echo $\"Upgrade failed!\"\n    RETVAL=1\n}\n\nconfigtest() {\n    if [ \"$#\" -ne 0 ] ; then\n        case \"$1\" in\n            -q)\n                FLAG=$1\n                ;;\n            *)\n                ;;\n        esac\n        shift\n    fi\n    ${nginx} -t -c ${conffile} $FLAG\n    RETVAL=$?\n    return $RETVAL\n}\n\nrh_status() {\n    status -p ${pidfile} ${nginx}\n}\n\n# See how we were called.\ncase \"$1\" in\n    start)\n        rh_status >/dev/null 2>&1 && exit 0\n        start\n        ;;\n    stop)\n        stop\n        ;;\n    status)\n        rh_status\n        RETVAL=$?\n        ;;\n    restart)\n        configtest -q || exit $RETVAL\n        stop\n        start\n        ;;\n    upgrade)\n        rh_status >/dev/null 2>&1 || exit 0\n        upgrade\n        ;;\n    condrestart|try-restart)\n        if rh_status >/dev/null 2>&1; then\n            stop\n            start\n        fi\n        ;;\n    force-reload|reload)\n        reload\n        ;;\n    configtest)\n        configtest\n        ;;\n    *)\n        echo $\"Usage: $prog {start|stop|restart|condrestart|try-restart|force-reload|upgrade|reload|status|help|configtest}\"\n        RETVAL=2\nesac\n\nexit $RETVAL\n```\n\n```\n[root@vagrant-centos65 init.d]$ chmod 755 nginx\n[root@vagrant-centos65 init.d]$ chkconfig --add nginx\n[root@vagrant-centos65 init.d]$ service nginx status\nnginx is stopped\n``` \n\n\u3067\u304d\u305f\uff01\n", "tags": ["nginx", "session", "Sticky"]}