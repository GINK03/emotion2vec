{"tags": ["HTML5", "websocket"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nHTML5\u306eWebSocket\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n\u30c1\u30e3\u30c3\u30c8\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u6642\u306b\u63a5\u7d9a\u306b\u884c\u304d\u307e\u3059\u3002\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001ws://\u304b\u3089\u59cb\u307e\u308b\u3001URL\u3067\u3059\u3002\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u5f8c\u3001\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\n\n\u540d\u79f0\n\u8aac\u660e\n\n\n\n\nonopen\n\u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n\n\nonclose\n\u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n\n\nonmessage\n\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n\n\nonerror\n\u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n\n\n\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\n\n\n\n\u30e1\u30bd\u30c3\u30c9\n\u8aac\u660e\n\n\n\n\nsend\n\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\n\nclose\n\u5207\u65ad\n\n\n\n\nwebsocket01.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/chat\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30dc\u30bf\u30f3\u62bc\u4e0b\u30a4\u30d9\u30f3\u30c8\u8a2d\u5b9a\n            $(\"[data-name='message']\").keypress(press);\n            // \u63a5\u7d9a\n            open();\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            chat(\"\u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\");\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                chat(event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            //chat(\"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            chat(\"\u5207\u65ad\u3057\u307e\u3057\u305f\u30023\u79d2\u5f8c\u306b\u518d\u63a5\u7d9a\u3057\u307e\u3059\u3002(\" + event.code + \")\");\n            webSocket = null;\n            setTimeout(\"open()\", 3000);\n        }\n\n        // \u30ad\u30fc\u62bc\u4e0b\u6642\n        function press(event) {\n            // \u30ad\u30fc\u304cEnter\u304b\u5224\u5b9a\n            if (event && event.which == 13) {\n                // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\n                var message = $(\"[data-name='message']\").val();\n                // \u5b58\u5728\u30c1\u30a7\u30c3\u30af\n                if (message && webSocket) {\n                    // \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n                    webSocket.send(\"\" + message);\n                    // \u30e1\u30c3\u30bb\u30fc\u30b8\u521d\u671f\u5316\n                    $(\"[data-name='message']\").val(\"\");\n                }\n            }\n        }\n\n        // \u30c1\u30e3\u30c3\u30c8\u306b\u8868\u793a\n        function chat(message) {\n            // 100\u4ef6\u307e\u3067\u6b8b\u3059\n            var chats = $(\"[data-name='chat']\").find(\"div\");\n            while (chats.length >= 100) {\n                chats = chats.last().remove();\n            }\n            // \u30e1\u30c3\u30bb\u30fc\u30b8\u8868\u793a\n            var msgtag = $(\"<div>\").text(message);\n            $(\"[data-name='chat']\").prepend(msgtag);\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <input type=\"text\" data-name=\"message\" size=\"100\" />\n    <hr />\n    <div data-name=\"chat\"></div>\n</body>\n</html>\n\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u306eWebSocket\u306b\u9001\u4fe1\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u3082\u306e\u3067\u3059\u3002\n\nWebSocketChat.java\npackage sample;\n\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/chat\")\npublic class WebSocketChat {\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config) {\n        String id = session.getId();\n        echo(\"(\" + id + \")\u304c\u5165\u5ba4\u3057\u307e\u3057\u305f\u3002\", session);\n    }\n\n    @OnMessage\n    public void onMessage(String message, Session session) {\n        String id = session.getId();\n        echo(\"(\" + id + \") \" + message, session);\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        String id = session.getId();\n        echo(\"(\" + id + \")\u304c\u9000\u51fa\u3057\u307e\u3057\u305f\u3002\", session);\n    }\n\n    @OnError\n    public void onError(Session session, Throwable throwable) {\n        throwable.printStackTrace();\n    }\n\n    /**\n     * \u30e1\u30c3\u30bb\u30fc\u30b8\u30a8\u30b3\u30fc\n     * \n     * @param message \u30e1\u30c3\u30bb\u30fc\u30b8\n     * @param session \u30bb\u30c3\u30b7\u30e7\u30f3\n     */\n    private void echo(String message, Session session) {\n        System.out.println(message);\n        // \u958b\u3044\u3066\u3044\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97\n        Set<Session> sessions = session.getOpenSessions();\n        // \u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5206\u30eb\u30fc\u30d7\n        for (Session tmp : sessions) {\n            try {\n                // \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n                tmp.getBasicRemote().sendText(message);\n            } catch (Exception e) {\n                // \u4f8b\u5916\u306e\u5834\u5408\n                e.printStackTrace();\n            }\n        }\n    }\n}\n\n\n\nJSON\u30c7\u30fc\u30bf\n\u30c6\u30ad\u30b9\u30c8\u9001\u4fe1\u51fa\u6765\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307eJson\u30c7\u30fc\u30bf\u3092\u9001\u53d7\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\njquery-ui\u306edraggable\u3092\u5229\u7528\u3057\u3066\u3001\u30dc\u30fc\u30eb\u3092\u52d5\u304b\u3059\u3088\u3046\u306a\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\uff11\u30d6\u30e9\u30a6\u30b6\u3060\u3051\u3067\u3084\u3063\u3066\u308b\u3068\u610f\u5473\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u30d6\u30e9\u30a6\u30b6\u3067\u3084\u308b\u3068\u5168\u90e8\u540c\u3058\u52d5\u304d\u3092\u3057\u307e\u3059\u3002\n\nwebsocket02.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\" src=\"./jquery-ui.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/json\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u30dc\u30fc\u30eb\n        var balls = null;\n\n        // \u30dc\u30fc\u30eb\u306e\u5834\u6240\n        var ballpos = { t: 0, l: 0 };\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30dc\u30fc\u30eb\u751f\u6210\n            ball = $(\"<div>\").width(20).height(20)\n                .css(\"background-color\", \"#f00\").css(\"border-radius\", \"10px\");\n            // \u30dc\u30fc\u30eb\u306e\u53ef\u52d5\u7bc4\u56f2\u8a2d\u5b9a\n            ball.draggable({ containment: \"[data-name='square']\" });\n            // \u30dc\u30fc\u30eb\u306e\u30a4\u30d9\u30f3\u30c8\u8a2d\u5b9a\n            ball.on(\"drag\", dragball);\n            // \u30dc\u30fc\u30eb\u63cf\u5199\n            $(\"[data-name='square']\").append(ball);\n            // \u30dc\u30fc\u30eb\u79fb\u52d5\uff08\u65e9\u3055\uff10\uff09\n            move(0);\n            // \u63a5\u7d9a\n            open();\n        }\n\n        // \u30dc\u30fc\u30eb\u79fb\u52d5\n        function move(spped) {\n            // \u5404\u30dc\u30fc\u30eb\u79fb\u52d5\n            ball.stop();\n            ball.animate({ top: ballpos.t, left: ballpos.l }, spped);\n        }\n\n        // \u30dc\u30fc\u30eb\u79fb\u52d5\u30a4\u30d9\u30f3\u30c8\n        function dragball(event, ui) {\n            // \u30dc\u30fc\u30eb\u4f4d\u7f6e\u8a2d\u5b9a\n            ballpos.t = ui.position.top.toFixed(0);\n            ballpos.l = ui.position.left.toFixed(0);\n            // \u30dc\u30fc\u30eb\u4f4d\u7f6e\u8a2d\u5b9a\n            var msg = JSON.stringify(ballpos);\n            if (webSocket) {\n                webSocket.send(msg);\n            }\n            $(\"[data-name='status']\").text(msg);\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            $(\"[data-name='status']\").text(\"OPEN\");\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                var pos = JSON.parse(event.data);\n                ballpos = pos;\n                move(5);\n                $(\"[data-name='status']\").text(event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            $(\"[data-name='status']\").text(\"ERROR\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            $(\"[data-name='status']\").text(\"CLOSE\");\n            webSocket = null;\n            setTimeout(\"open()\", 3000);\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <div data-name=\"status\">&nbsp;</div>\n    <div data-name=\"square\" style=\"width: 400px; height: 300px; background-color: gray\"></div>\n</body>\n</html>\n\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001static\u3067\u4fdd\u6301\u3057\u3066\u3044\u308bJSON\u30c7\u30fc\u30bf\u3092\u63a5\u7d9a\u6642onOpen\u306b\u306f\u3001\u63a5\u7d9a\u3057\u305f\u76f8\u624b\u3078\u3001\n\u30c7\u30fc\u30bf\u53d7\u4fe1\u6642onMessage\u306f\u3001\u30c7\u30fc\u30bf\u9001\u4fe1\u8005\u4ee5\u5916\u306b\u914d\u5e03\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\uff08\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u8907\u96d1\u306b\u306a\u308b\u3068\u3001JSON\u30c7\u30fc\u30bf\u3092\u89e3\u6790\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u30dc\u30fc\u30eb\u304c\uff14\u3064\u306b\u306a\u3063\u305f\u6642\u306a\u3069\uff09\n\nWebSocketJson.java\npackage sample;\n\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/json\")\npublic class WebSocketJson {\n\n    private static String json = \"\";\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config) {\n        if (json.length() > 0) {\n            try {\n                session.getAsyncRemote().sendText(json);\n            } catch (Exception e) {\n                // \u4f8b\u5916\u306e\u5834\u5408\n                System.out.println(\"\" + e.getMessage());\n            }\n        }\n    }\n\n    @OnMessage\n    public void onMessage(String message, Session session) {\n        String id = session.getId();\n        synchronized (json) {\n            json = message;\n            // \u958b\u3044\u3066\u3044\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97\n            Set<Session> sessions = session.getOpenSessions();\n            // \u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5206\u30eb\u30fc\u30d7\n            for (Session tmp : sessions) {\n                if (!tmp.getId().equals(id)) {\n                    try {\n                        // \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n                        tmp.getAsyncRemote().sendText(json);\n                    } catch (Exception e) {\n                        // \u4f8b\u5916\u306e\u5834\u5408\n                        System.out.println(\"\" + e.getMessage());\n                    }\n                }\n            }\n        }\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        // \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n    }\n\n    @OnError\n    public void onError(Session session, Throwable throwable) {\n        // \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n    }\n}\n\n\n\n\u30d5\u30a1\u30a4\u30eb\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001send\u30e1\u30bd\u30c3\u30c9\u3067Blob\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092WebSocket\u3067\u9001\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\ninput\u30bf\u30b0\u306evalue\u5c5e\u6027\u304c\u5909\u66f4\u306b\u306a\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u5951\u6a5f\u306b\u3001File\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nWebSocket\u3092\u63a5\u7d9a\u3057\u3001File\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\nwebsocket03.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/blob\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u30d5\u30a1\u30a4\u30eb\n        var file = null;\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30d5\u30a1\u30a4\u30eb\u9078\u629e\u6642\n            $(\"[data-name='sendfile']\").change(filechange);\n        }\n\n        // \u30d5\u30a1\u30a4\u30eb\u9078\u629e\u6642\n        function filechange() {\n            // \u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u30c1\u30a7\u30c3\u30af\n            if (file == null) {\n                // \u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\n                var files = $(this).get(0).files;\n                if (files.length > 0) {\n                    file = files[0];\n                    // \u63a5\u7d9a\n                    open();\n                }\n            }\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            $(\"[data-name='status']\").text(\"OPEN\");\n            try {\n                // WebSoket\u5b58\u5728\u5224\u5b9a\n                if (webSocket != null) {\n                    // \u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u5224\u5b9a\n                    if (file != null) {\n                        // \u30d5\u30a1\u30a4\u30eb\u9001\u4fe1\n                        webSocket.send(file);\n                        file = null;\n                    }\n                    // \u5207\u65ad\n                    webSocket.close();\n                    webSocket = null;\n                }\n            } catch (e) {\n                $(\"[data-name='status']\").text(\"Error:\" + e.message);\n\n            }\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                $(\"[data-name='status']\").text(\"MESSAGE:\" + event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            $(\"[data-name='status']\").text(\"ERROR\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            $(\"[data-name='status']\").text(\"CLOSE\");\n            webSocket = null;\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <div data-name=\"status\">&nbsp;</div>\n    <input type=\"file\" data-name=\"sendfile\" />\n</body>\n</html>\n\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001onMessage(byte[] bs, boolean last, Session session)\u30e1\u30bd\u30c3\u30c9\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u307e\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u30c7\u30fc\u30bf\u3092\u5206\u5272\u9001\u4fe1\u3057\u3066\u3044\u308b\u70ba\u3001\u7b2c\u4e8c\u5f15\u6570\u306elast\u5909\u6570\u304ctrue\u306b\u306a\u308b\u307e\u3067\u3001\u30c7\u30fc\u30bf\u3092\u6e9c\u3081\u8fbc\u307f\u307e\u3059\u3002\n\u6e9c\u3081\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u306f\u3068\u308a\u3042\u3048\u305a\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u51fa\u529b\u3057\u307e\u3059\u3002\n\nWebSocketBlob.java\npackage sample;\n\nimport java.io.ByteArrayOutputStream;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/blob\")\npublic class WebSocketBlob {\n\n    // \u30d0\u30c3\u30d5\u30a1\n    private ByteArrayOutputStream baos = null;\n\n    @OnOpen\n    public void onOpen(Session session, EndpointConfig config) {\n        // \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n    }\n\n    @OnMessage\n    public void onMessage(byte[] bs, boolean last, Session session) {\n        try {\n            System.out.println(session.getId() + \"/\" + bs.length + \"/\" + last);\n            // \u30d0\u30c3\u30d5\u30a1\u5b58\u5728\u30c1\u30a7\u30c3\u30af\n            if (baos == null) {\n                // \u30d0\u30c3\u30d5\u30a1\u751f\u6210\n                baos = new ByteArrayOutputStream();\n            }\n            // \u66f8\u304d\u8fbc\u307f\n            baos.write(bs);\n            baos.flush();\n            // \u6700\u5f8c\u3067\u3042\u308b\u304b\u5224\u5b9a\n            if (last) {\n                // \u6700\u5f8c\u306a\u306e\u3067\u3001byte\u914d\u5217\u5316\n                byte[] data = baos.toByteArray();\n                // \u3068\u308a\u3042\u3048\u305a\u3001\u6587\u5b57\u5217\u306b\u3057\u3066\u51fa\u529b\n                System.out.println(new String(data));\n                // \u30d0\u30c3\u30d5\u30a1\u5f8c\u51e6\u7406\n                baos.close();\n                baos = null;\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n\n    @OnClose\n    public void onClose(Session session, CloseReason reason) {\n        // \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n    }\n\n    @OnError\n    public void onError(Session session, Throwable throwable) {\n        // \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n    }\n}\n\n\n\n\u611f\u60f3\n\u30b5\u30fc\u30d0\u5074\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u51fa\u6765\u308b\u4ed5\u7d44\u307f\u306f\u7d20\u6674\u3089\u3057\u3044\u3068\u601d\u3044\u3064\u3064\u3082\u3001\n\u4f7f\u3046\u5834\u6240\u306f\u9650\u5b9a\u3055\u308c\u308b\u3093\u3060\u308d\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n## \u306f\u3058\u3081\u306b\n\nHTML5\u306eWebSocket\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n## \u30c1\u30e3\u30c3\u30c8\n\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u6642\u306b\u63a5\u7d9a\u306b\u884c\u304d\u307e\u3059\u3002\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u3001`ws://`\u304b\u3089\u59cb\u307e\u308b\u3001URL\u3067\u3059\u3002\n\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u5f8c\u3001\u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n|\u540d\u79f0|\u8aac\u660e|\n|:--|:--|\n|onopen|\u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8|\n|onclose|\u5207\u65ad\u30a4\u30d9\u30f3\u30c8|\n|onmessage|\u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8|\n|onerror|\u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8|\n\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30e1\u30bd\u30c3\u30c9\n\n|\u30e1\u30bd\u30c3\u30c9|\u8aac\u660e|\n|:--|:--|\n|send|\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1|\n|close|\u5207\u65ad|\n\n```html:websocket01.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/chat\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30dc\u30bf\u30f3\u62bc\u4e0b\u30a4\u30d9\u30f3\u30c8\u8a2d\u5b9a\n            $(\"[data-name='message']\").keypress(press);\n            // \u63a5\u7d9a\n            open();\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            chat(\"\u63a5\u7d9a\u3057\u307e\u3057\u305f\u3002\");\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                chat(event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            //chat(\"\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            chat(\"\u5207\u65ad\u3057\u307e\u3057\u305f\u30023\u79d2\u5f8c\u306b\u518d\u63a5\u7d9a\u3057\u307e\u3059\u3002(\" + event.code + \")\");\n            webSocket = null;\n            setTimeout(\"open()\", 3000);\n        }\n\n        // \u30ad\u30fc\u62bc\u4e0b\u6642\n        function press(event) {\n            // \u30ad\u30fc\u304cEnter\u304b\u5224\u5b9a\n            if (event && event.which == 13) {\n                // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\n                var message = $(\"[data-name='message']\").val();\n                // \u5b58\u5728\u30c1\u30a7\u30c3\u30af\n                if (message && webSocket) {\n                    // \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n                    webSocket.send(\"\" + message);\n                    // \u30e1\u30c3\u30bb\u30fc\u30b8\u521d\u671f\u5316\n                    $(\"[data-name='message']\").val(\"\");\n                }\n            }\n        }\n\n        // \u30c1\u30e3\u30c3\u30c8\u306b\u8868\u793a\n        function chat(message) {\n            // 100\u4ef6\u307e\u3067\u6b8b\u3059\n            var chats = $(\"[data-name='chat']\").find(\"div\");\n            while (chats.length >= 100) {\n                chats = chats.last().remove();\n            }\n            // \u30e1\u30c3\u30bb\u30fc\u30b8\u8868\u793a\n            var msgtag = $(\"<div>\").text(message);\n            $(\"[data-name='chat']\").prepend(msgtag);\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <input type=\"text\" data-name=\"message\" size=\"100\" />\n    <hr />\n    <div data-name=\"chat\"></div>\n</body>\n</html>\n```\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001\u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u30aa\u30f3\u30e9\u30a4\u30f3\u306eWebSocket\u306b\u9001\u4fe1\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u3082\u306e\u3067\u3059\u3002\n\n```java:WebSocketChat.java\npackage sample;\n\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/chat\")\npublic class WebSocketChat {\n\n\t@OnOpen\n\tpublic void onOpen(Session session, EndpointConfig config) {\n\t\tString id = session.getId();\n\t\techo(\"(\" + id + \")\u304c\u5165\u5ba4\u3057\u307e\u3057\u305f\u3002\", session);\n\t}\n\n\t@OnMessage\n\tpublic void onMessage(String message, Session session) {\n\t\tString id = session.getId();\n\t\techo(\"(\" + id + \") \" + message, session);\n\t}\n\n\t@OnClose\n\tpublic void onClose(Session session, CloseReason reason) {\n\t\tString id = session.getId();\n\t\techo(\"(\" + id + \")\u304c\u9000\u51fa\u3057\u307e\u3057\u305f\u3002\", session);\n\t}\n\n\t@OnError\n\tpublic void onError(Session session, Throwable throwable) {\n\t\tthrowable.printStackTrace();\n\t}\n\t\n\t/**\n\t * \u30e1\u30c3\u30bb\u30fc\u30b8\u30a8\u30b3\u30fc\n\t * \n\t * @param message \u30e1\u30c3\u30bb\u30fc\u30b8\n\t * @param session \u30bb\u30c3\u30b7\u30e7\u30f3\n\t */\n\tprivate void echo(String message, Session session) {\n\t\tSystem.out.println(message);\n\t\t// \u958b\u3044\u3066\u3044\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97\n\t\tSet<Session> sessions = session.getOpenSessions();\n\t\t// \u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5206\u30eb\u30fc\u30d7\n\t\tfor (Session tmp : sessions) {\n\t\t\ttry {\n\t\t\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\t\t\t\ttmp.getBasicRemote().sendText(message);\n\t\t\t} catch (Exception e) {\n\t\t\t\t// \u4f8b\u5916\u306e\u5834\u5408\n\t\t\t\te.printStackTrace();\n\t\t\t}\n\t\t}\n\t}\n}\n```\n\n## JSON\u30c7\u30fc\u30bf\n\n\u30c6\u30ad\u30b9\u30c8\u9001\u4fe1\u51fa\u6765\u308b\u306e\u3067\u3001\u305d\u306e\u307e\u307eJson\u30c7\u30fc\u30bf\u3092\u9001\u53d7\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\n`jquery-ui`\u306e`draggable`\u3092\u5229\u7528\u3057\u3066\u3001\u30dc\u30fc\u30eb\u3092\u52d5\u304b\u3059\u3088\u3046\u306a\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\uff11\u30d6\u30e9\u30a6\u30b6\u3060\u3051\u3067\u3084\u3063\u3066\u308b\u3068\u610f\u5473\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u30d6\u30e9\u30a6\u30b6\u3067\u3084\u308b\u3068\u5168\u90e8\u540c\u3058\u52d5\u304d\u3092\u3057\u307e\u3059\u3002\n\n```html:websocket02.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\" src=\"./jquery-ui.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/json\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u30dc\u30fc\u30eb\n        var balls = null;\n\n        // \u30dc\u30fc\u30eb\u306e\u5834\u6240\n        var ballpos = { t: 0, l: 0 };\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30dc\u30fc\u30eb\u751f\u6210\n            ball = $(\"<div>\").width(20).height(20)\n                .css(\"background-color\", \"#f00\").css(\"border-radius\", \"10px\");\n            // \u30dc\u30fc\u30eb\u306e\u53ef\u52d5\u7bc4\u56f2\u8a2d\u5b9a\n            ball.draggable({ containment: \"[data-name='square']\" });\n            // \u30dc\u30fc\u30eb\u306e\u30a4\u30d9\u30f3\u30c8\u8a2d\u5b9a\n            ball.on(\"drag\", dragball);\n            // \u30dc\u30fc\u30eb\u63cf\u5199\n            $(\"[data-name='square']\").append(ball);\n            // \u30dc\u30fc\u30eb\u79fb\u52d5\uff08\u65e9\u3055\uff10\uff09\n            move(0);\n            // \u63a5\u7d9a\n            open();\n        }\n\n        // \u30dc\u30fc\u30eb\u79fb\u52d5\n        function move(spped) {\n            // \u5404\u30dc\u30fc\u30eb\u79fb\u52d5\n            ball.stop();\n            ball.animate({ top: ballpos.t, left: ballpos.l }, spped);\n        }\n\n        // \u30dc\u30fc\u30eb\u79fb\u52d5\u30a4\u30d9\u30f3\u30c8\n        function dragball(event, ui) {\n            // \u30dc\u30fc\u30eb\u4f4d\u7f6e\u8a2d\u5b9a\n            ballpos.t = ui.position.top.toFixed(0);\n            ballpos.l = ui.position.left.toFixed(0);\n            // \u30dc\u30fc\u30eb\u4f4d\u7f6e\u8a2d\u5b9a\n            var msg = JSON.stringify(ballpos);\n            if (webSocket) {\n                webSocket.send(msg);\n            }\n            $(\"[data-name='status']\").text(msg);\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            $(\"[data-name='status']\").text(\"OPEN\");\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                var pos = JSON.parse(event.data);\n                ballpos = pos;\n                move(5);\n                $(\"[data-name='status']\").text(event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            $(\"[data-name='status']\").text(\"ERROR\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            $(\"[data-name='status']\").text(\"CLOSE\");\n            webSocket = null;\n            setTimeout(\"open()\", 3000);\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <div data-name=\"status\">&nbsp;</div>\n    <div data-name=\"square\" style=\"width: 400px; height: 300px; background-color: gray\"></div>\n</body>\n</html>\n```\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001`static`\u3067\u4fdd\u6301\u3057\u3066\u3044\u308bJSON\u30c7\u30fc\u30bf\u3092\u63a5\u7d9a\u6642`onOpen`\u306b\u306f\u3001\u63a5\u7d9a\u3057\u305f\u76f8\u624b\u3078\u3001\n\u30c7\u30fc\u30bf\u53d7\u4fe1\u6642`onMessage`\u306f\u3001\u30c7\u30fc\u30bf\u9001\u4fe1\u8005\u4ee5\u5916\u306b\u914d\u5e03\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\uff08\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u8907\u96d1\u306b\u306a\u308b\u3068\u3001JSON\u30c7\u30fc\u30bf\u3092\u89e3\u6790\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u30dc\u30fc\u30eb\u304c\uff14\u3064\u306b\u306a\u3063\u305f\u6642\u306a\u3069\uff09\n\n```java:WebSocketJson.java\npackage sample;\n\nimport java.util.Set;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/json\")\npublic class WebSocketJson {\n\t\n\tprivate static String json = \"\";\n\n\t@OnOpen\n\tpublic void onOpen(Session session, EndpointConfig config) {\n\t\tif (json.length() > 0) {\n\t\t\ttry {\n\t\t\t\tsession.getAsyncRemote().sendText(json);\n\t\t\t} catch (Exception e) {\n\t\t\t\t// \u4f8b\u5916\u306e\u5834\u5408\n\t\t\t\tSystem.out.println(\"\" + e.getMessage());\n\t\t\t}\n\t\t}\n\t}\n\n\t@OnMessage\n\tpublic void onMessage(String message, Session session) {\n\t\tString id = session.getId();\n\t\tsynchronized (json) {\n\t\t\tjson = message;\n\t\t\t// \u958b\u3044\u3066\u3044\u308b\u30bb\u30c3\u30b7\u30e7\u30f3\u53d6\u5f97\n\t\t\tSet<Session> sessions = session.getOpenSessions();\n\t\t\t// \u30bb\u30c3\u30b7\u30e7\u30f3\u6570\u5206\u30eb\u30fc\u30d7\n\t\t\tfor (Session tmp : sessions) {\n\t\t\t\tif (!tmp.getId().equals(id)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\n\t\t\t\t\t\ttmp.getAsyncRemote().sendText(json);\n\t\t\t\t\t} catch (Exception e) {\n\t\t\t\t\t\t// \u4f8b\u5916\u306e\u5834\u5408\n\t\t\t\t\t\tSystem.out.println(\"\" + e.getMessage());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t@OnClose\n\tpublic void onClose(Session session, CloseReason reason) {\n\t\t// \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\t}\n\n\t@OnError\n\tpublic void onError(Session session, Throwable throwable) {\n\t\t// \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\t}\n}\n```\n\n## \u30d5\u30a1\u30a4\u30eb\n\nWebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u3001`send`\u30e1\u30bd\u30c3\u30c9\u3067Blob\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9001\u4fe1\u3067\u304d\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092WebSocket\u3067\u9001\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\n\n`input`\u30bf\u30b0\u306e`value`\u5c5e\u6027\u304c\u5909\u66f4\u306b\u306a\u3063\u305f\u30a4\u30d9\u30f3\u30c8\u3092\u5951\u6a5f\u306b\u3001File\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\nWebSocket\u3092\u63a5\u7d9a\u3057\u3001File\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u9001\u4fe1\u3057\u307e\u3059\u3002\n\n```html:websocket03.html\n<!DOCTYPE html>\n<html>\n<head>\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n    <title>WebSocket Sample</title>\n    <script type=\"text/javascript\" src=\"./jquery.js\"></script>\n    <script type=\"text/javascript\">\n        // \u63a5\u7d9a\u5148URI\n        var uri = \"ws://\" + location.host + \"/sample/blob\";\n\n        // WebSocket\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n        var webSocket = null;\n\n        // \u30d5\u30a1\u30a4\u30eb\n        var file = null;\n\n        // \u521d\u671f\u51e6\u7406\n        function init() {\n            // \u30d5\u30a1\u30a4\u30eb\u9078\u629e\u6642\n            $(\"[data-name='sendfile']\").change(filechange);\n        }\n\n        // \u30d5\u30a1\u30a4\u30eb\u9078\u629e\u6642\n        function filechange() {\n            // \u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u30c1\u30a7\u30c3\u30af\n            if (file == null) {\n                // \u30d5\u30a1\u30a4\u30eb\u53d6\u5f97\n                var files = $(this).get(0).files;\n                if (files.length > 0) {\n                    file = files[0];\n                    // \u63a5\u7d9a\n                    open();\n                }\n            }\n        }\n\n        // \u63a5\u7d9a\n        function open() {\n            if (webSocket == null) {\n                // WebSocket \u306e\u521d\u671f\u5316\n                webSocket = new WebSocket(uri);\n                // \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u306e\u8a2d\u5b9a\n                webSocket.onopen = onOpen;\n                webSocket.onmessage = onMessage;\n                webSocket.onclose = onClose;\n                webSocket.onerror = onError;\n            }\n        }\n\n        // \u63a5\u7d9a\u30a4\u30d9\u30f3\u30c8\n        function onOpen(event) {\n            $(\"[data-name='status']\").text(\"OPEN\");\n            try {\n                // WebSoket\u5b58\u5728\u5224\u5b9a\n                if (webSocket != null) {\n                    // \u30d5\u30a1\u30a4\u30eb\u5b58\u5728\u5224\u5b9a\n                    if (file != null) {\n                        // \u30d5\u30a1\u30a4\u30eb\u9001\u4fe1\n                        webSocket.send(file);\n                        file = null;\n                    }\n                    // \u5207\u65ad\n                    webSocket.close();\n                    webSocket = null;\n                }\n            } catch (e) {\n                $(\"[data-name='status']\").text(\"Error:\" + e.message);\n\n            }\n        }\n\n        // \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u30a4\u30d9\u30f3\u30c8\n        function onMessage(event) {\n            if (event && event.data) {\n                $(\"[data-name='status']\").text(\"MESSAGE:\" + event.data);\n            }\n        }\n\n        // \u30a8\u30e9\u30fc\u30a4\u30d9\u30f3\u30c8\n        function onError(event) {\n            $(\"[data-name='status']\").text(\"ERROR\");\n        }\n\n        // \u5207\u65ad\u30a4\u30d9\u30f3\u30c8\n        function onClose(event) {\n            $(\"[data-name='status']\").text(\"CLOSE\");\n            webSocket = null;\n        }\n\n        // \u521d\u671f\u51e6\u7406\u767b\u9332\n        $(init);\n    </script>\n</head>\n<body>\n    <div data-name=\"status\">&nbsp;</div>\n    <input type=\"file\" data-name=\"sendfile\" />\n</body>\n</html>\n```\n\n\u30b5\u30fc\u30d0\u5074\u306f\u3001`onMessage(byte[] bs, boolean last, Session session)`\u30e1\u30bd\u30c3\u30c9\u3067\u30c7\u30fc\u30bf\u3092\u53d7\u4fe1\u3057\u307e\u3059\u3002\n\u30d6\u30e9\u30a6\u30b6\u5074\u3067\u30c7\u30fc\u30bf\u3092\u5206\u5272\u9001\u4fe1\u3057\u3066\u3044\u308b\u70ba\u3001\u7b2c\u4e8c\u5f15\u6570\u306e`last`\u5909\u6570\u304c`true`\u306b\u306a\u308b\u307e\u3067\u3001\u30c7\u30fc\u30bf\u3092\u6e9c\u3081\u8fbc\u307f\u307e\u3059\u3002\n\u6e9c\u3081\u8fbc\u3093\u3060\u30c7\u30fc\u30bf\u306f\u3068\u308a\u3042\u3048\u305a\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u51fa\u529b\u3057\u307e\u3059\u3002\n\n```java:WebSocketBlob.java\npackage sample;\n\nimport java.io.ByteArrayOutputStream;\n\nimport javax.websocket.CloseReason;\nimport javax.websocket.EndpointConfig;\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n@ServerEndpoint(\"/blob\")\npublic class WebSocketBlob {\n\t\n\t// \u30d0\u30c3\u30d5\u30a1\n\tprivate ByteArrayOutputStream baos = null;\n\n\t@OnOpen\n\tpublic void onOpen(Session session, EndpointConfig config) {\n\t\t// \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\t}\n\n\t@OnMessage\n\tpublic void onMessage(byte[] bs, boolean last, Session session) {\n\t\ttry {\n\t\t\tSystem.out.println(session.getId() + \"/\" + bs.length + \"/\" + last);\n\t\t\t// \u30d0\u30c3\u30d5\u30a1\u5b58\u5728\u30c1\u30a7\u30c3\u30af\n\t\t\tif (baos == null) {\n\t\t\t\t// \u30d0\u30c3\u30d5\u30a1\u751f\u6210\n\t\t\t\tbaos = new ByteArrayOutputStream();\n\t\t\t}\n\t\t\t// \u66f8\u304d\u8fbc\u307f\n\t\t\tbaos.write(bs);\n\t\t\tbaos.flush();\n\t\t\t// \u6700\u5f8c\u3067\u3042\u308b\u304b\u5224\u5b9a\n\t\t\tif (last) {\n\t\t\t\t// \u6700\u5f8c\u306a\u306e\u3067\u3001byte\u914d\u5217\u5316\n\t\t\t\tbyte[] data = baos.toByteArray();\n\t\t\t\t// \u3068\u308a\u3042\u3048\u305a\u3001\u6587\u5b57\u5217\u306b\u3057\u3066\u51fa\u529b\n\t\t\t\tSystem.out.println(new String(data));\n\t\t\t\t// \u30d0\u30c3\u30d5\u30a1\u5f8c\u51e6\u7406\n\t\t\t\tbaos.close();\n\t\t\t\tbaos = null;\n\t\t\t}\n\t\t} catch (Exception e) {\n\t\t\te.printStackTrace();\n\t\t}\n\t}\n\n\t@OnClose\n\tpublic void onClose(Session session, CloseReason reason) {\n\t\t// \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\t}\n\n\t@OnError\n\tpublic void onError(Session session, Throwable throwable) {\n\t\t// \u4f55\u3082\u3057\u307e\u305b\u3093\u3002\n\t}\n}\n```\n\n## \u611f\u60f3\n\n\u30b5\u30fc\u30d0\u5074\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u51fa\u6765\u308b\u4ed5\u7d44\u307f\u306f\u7d20\u6674\u3089\u3057\u3044\u3068\u601d\u3044\u3064\u3064\u3082\u3001\n\u4f7f\u3046\u5834\u6240\u306f\u9650\u5b9a\u3055\u308c\u308b\u3093\u3060\u308d\u3046\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n"}