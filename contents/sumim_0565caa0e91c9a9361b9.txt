{"context": " More than 1 year has passed since last update.\u3082\u3061\u308d\u3093\u51fa\u6765\u30ec\u30fc\u30b9\u3067\u3059\u3002Ruby \u306b\u306f\u8ca0\u3051\u3066\u3082\u3089\u3044\u307e\u3059\u3002\uff57\n\nSmalltalk\u3068Ruby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u52d5\u7684\u6027\u6bd4\u8f03\u3068\u305d\u306e\u304b\u3089\u304f\u308a\nSmalltalk\u30fbPHP\u306e\u30c8\u30ec\u30a4\u30c8\u3068Ruby\u30fbScala\u306e\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u306e\u9055\u3044\n\n\nRuby \u3067\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u3001\u305d\u308c\u3092\u7d99\u627f\u3055\u305b\u305f\u3044\u30af\u30e9\u30b9\u306b include \u3059\u308b\u3053\u3068\u3067\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\nmodule M1\n  def m1; p \"M1#m1\" end\nend\n\nclass C\n  include M1\nend\n\nC.new.m1   #=> M1#m1\n\n\u30aa\u30fc\u30d7\u30f3\u30af\u30e9\u30b9\u6a5f\u69cb\u3092\u6709\u3059\u308b Ruby \u306f include \u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u30e1\u30bd\u30c3\u30c9\u3092\u5f8c\u304b\u3089\u8ffd\u52a0\u3057\u3066\u3082\u3001\u305d\u306e\u5909\u66f4\u306f\u5373\u5ea7\u306b\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\u3055\u3059\u304c Ruby \u3002\u3059\u3054\u304f\u52d5\u7684\u3067\u3059\u306d\u3002\nmodule M1\n  def m2; p \"M1#m2\" end\nend\n\nC.new.m2   #=> M1#m2\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306f\u5225\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\u5f53\u7136\u3001\u305d\u306e\u7d50\u679c\u306f\u3059\u3067\u306b\u5f53\u8a72\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 include \u6e08\u307f\u306e\u30af\u30e9\u30b9\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u3082\u53cd\u6620\u3055\u308c\u308b\u306f\u305a\u2026\u2026\u3093\uff1f\nmodule M2\n  def m3; p \"M2#m3\" end\nend\n\nmodule M1\n  include M2\nend\n\nC.new.m3  #=> NoMethodError: undefined method `m3'\n\n\u306a\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u3084\u3089\u305d\u3046\u306f\u306a\u3089\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\u306a\u305c\u304b Ruby \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001\u3044\u3063\u305f\u3093 include \u3059\u308b\u3068\u3001\u305d\u308c\u306b\u5225\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 include \u3057\u3066\u3082\u305d\u306e\u7d50\u679c\u306f\u65e2\u306b include \u6e08\u307f\u306e\u30af\u30e9\u30b9\u7b49\u306b\u5bfe\u3057\u3066\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\u4ed5\u69d8\u306b\u306a\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\n\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u6539\u3081\u3066 include \u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\nclass C\n  include M1\nend\n\nC.new.m1  #=> M1#m1\nC.new.m2  #=> M1#m2\nC.new.m3  #=> M2#m3\n\n\n\u5bfe\u3057\u3066 Squeak Smalltalk \u306e\u30c8\u30ec\u30a4\u30c8\u3082\u3001\u30af\u30e9\u30b9\u306b use \u3055\u308c\u308b\u306e\u306f\u3042\u304f\u307e\u3067\u305d\u306e\u6642\u70b9\u3067\u306e\u30e1\u30bd\u30c3\u30c9\u7fa4\u3067\u3001\u305d\u306e\u5f8c use \u3057\u305f\u30c8\u30ec\u30a4\u30c8\u306b\u5909\u66f4\u304c\u3042\u3063\u3066\u3082\u8ffd\u5f93\u3067\u304d\u308b\u3057\u304f\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u306f\u898b\u3048\u307e\u305b\u3093\u3002\nClassDescription >> installTraitsFrom: aTraitComposition\u00a0\u00a0\u00a0\u00a0\"Install the traits from the given composition. This method implements\u00a0\u00a0\u00a0\u00a0the core composition method - all others are just optimizations for\u00a0\u00a0\u00a0\u00a0particular cases. Consequently, the optimized versions can always fall\u00a0\u00a0\u00a0\u00a0back to this method when things get too hairy.\"\u00a0\u00a0\u00a0\u00a0| allTraits methods |\u00a0\u00a0\u00a0\u00a0(self traitComposition isEmpty and: [aTraitComposition isEmpty]) ifTrue: [^self].\u00a0\u00a0\u00a0\u00a0\"Check for cycles\"\u00a0\u00a0\u00a0\u00a0allTraits := aTraitComposition gather: [:t | t allTraits copyWith: t].\u00a0\u00a0\u00a0\u00a0(allTraits includes: self) ifTrue:[^self error: 'Cyclic trait definition detected'].\u00a0\u00a0\u00a0\u00a0self traitComposition: aTraitComposition.\u00a0\u00a0\u00a0\u00a0methods := self assembleTraitMethodsFrom: aTraitComposition.\u00a0\u00a0\u00a0\u00a0self installTraitMethodDict: methods.\u00a0\u00a0\u00a0\u00a0self isMeta ifFalse:[self classSide updateTraitsFrom: aTraitComposition].\n\n\n\u304c\u3057\u304b\u3057\u3001\u5b9f\u969b\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u307f\u308b\u3068\u2026\n| T1 C T2 |\nT1 := Trait named: #T1 uses: {} category: 'UserObjects'.\nT1 compile: 'm1 ^''T1>>#m1'''.\n\nC := Object newSubclass uses: T1; rename: #C.\nC new m1.  \"=> 'T1>>#m1 ' \"\n\nT1 compile: 'm2 ^''T1>>#m2'''.\nC new m2.  \"=> 'T1>>#m2' \"\n\nT2 := Trait named: #T2 uses: {} category: 'UserObjects'.\nT2 compile: 'm3 ^''T2>>#m3'''.\nT1 uses: T2.\n\nC new m3.  \"=> 'T2>>#m3' \"\n\n{C. T1. T2} do: #removeFromSystem \"for clean up\"\n\n\u3068\u3001\u666e\u901a\u306b\u52d5\u7684\u306b\u53cd\u6620\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u52dd\u8ca0\u3042\u308a\u307e\u3057\u305f\u306d\uff08\u51fa\u6765\u30ec\u30fc\u30b9\u4e59\uff09\u3002\n\u3082\u3061\u308d\u3093 Smalltalk \u306e\u3053\u3068\u3067\u3059\u304b\u3089\u3001\u6ce5\u81ed\u304f\u4e00\u751f\u61f8\u547d\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u3053\u306e\u52d5\u7684\u6027\u3092\u5b9f\u73fe\u3057\u3066\u3044\u308b\u3053\u3068\u306f\u8a00\u3046\u307e\u3067\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u5b9f\u306b\u3051\u306a\u3052\u3067\u3059\u306d\u3002\n\u3082\u3061\u308d\u3093\u51fa\u6765\u30ec\u30fc\u30b9\u3067\u3059\u3002Ruby \u306b\u306f\u8ca0\u3051\u3066\u3082\u3089\u3044\u307e\u3059\u3002\uff57\n\n- [Smalltalk\u3068Ruby\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u52d5\u7684\u6027\u6bd4\u8f03\u3068\u305d\u306e\u304b\u3089\u304f\u308a](http://qiita.com/sumim/items/2607988633e0df5bb817)\n- [Smalltalk\u30fbPHP\u306e\u30c8\u30ec\u30a4\u30c8\u3068Ruby\u30fbScala\u306e\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u306e\u9055\u3044](http://qiita.com/sumim/items/a53b4f0cd6db353ec0f3)\n\n</br>\nRuby \u3067\u306f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u3001\u305d\u308c\u3092\u7d99\u627f\u3055\u305b\u305f\u3044\u30af\u30e9\u30b9\u306b include \u3059\u308b\u3053\u3068\u3067\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\n\n```rb\nmodule M1\n  def m1; p \"M1#m1\" end\nend\n\nclass C\n  include M1\nend\n\nC.new.m1   #=> M1#m1\n```\n\n\u30aa\u30fc\u30d7\u30f3\u30af\u30e9\u30b9\u6a5f\u69cb\u3092\u6709\u3059\u308b Ruby \u306f include \u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u30e1\u30bd\u30c3\u30c9\u3092\u5f8c\u304b\u3089\u8ffd\u52a0\u3057\u3066\u3082\u3001\u305d\u306e\u5909\u66f4\u306f\u5373\u5ea7\u306b\u53cd\u6620\u3055\u308c\u307e\u3059\u3002\u3055\u3059\u304c Ruby \u3002\u3059\u3054\u304f\u52d5\u7684\u3067\u3059\u306d\u3002\n\n```rb\nmodule M1\n  def m2; p \"M1#m2\" end\nend\n\nC.new.m2   #=> M1#m2\n```\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306f\u5225\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u30df\u30c3\u30af\u30b9\u30a4\u30f3\u3067\u304d\u307e\u3059\u3002\u5f53\u7136\u3001\u305d\u306e\u7d50\u679c\u306f\u3059\u3067\u306b\u5f53\u8a72\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 include \u6e08\u307f\u306e\u30af\u30e9\u30b9\u3084\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u3082\u53cd\u6620\u3055\u308c\u308b\u306f\u305a\u2026\u2026\u3093\uff1f\n\n```rb\nmodule M2\n  def m3; p \"M2#m3\" end\nend\n\nmodule M1\n  include M2\nend\n\nC.new.m3  #=> NoMethodError: undefined method `m3'\n```\n\n\u306a\u306e\u3067\u3059\u304c\u3001\u3069\u3046\u3084\u3089\u305d\u3046\u306f\u306a\u3089\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u306d\u3002\n\n\u306a\u305c\u304b Ruby \u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306f\u3001\u3044\u3063\u305f\u3093 include \u3059\u308b\u3068\u3001\u305d\u308c\u306b\u5225\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 include \u3057\u3066\u3082\u305d\u306e\u7d50\u679c\u306f\u65e2\u306b include \u6e08\u307f\u306e\u30af\u30e9\u30b9\u7b49\u306b\u5bfe\u3057\u3066\u306f\u53cd\u6620\u3055\u308c\u306a\u3044\u4ed5\u69d8\u306b\u306a\u3063\u3066\u3044\u308b\u6a21\u69d8\u3002\n\n\u53cd\u6620\u3055\u305b\u308b\u305f\u3081\u306b\u306f\u6539\u3081\u3066 include \u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n```\nclass C\n  include M1\nend\n\nC.new.m1  #=> M1#m1\nC.new.m2  #=> M1#m2\nC.new.m3  #=> M2#m3\n```\n\n</br>\n\u5bfe\u3057\u3066 Squeak Smalltalk \u306e\u30c8\u30ec\u30a4\u30c8\u3082\u3001\u30af\u30e9\u30b9\u306b use \u3055\u308c\u308b\u306e\u306f\u3042\u304f\u307e\u3067\u305d\u306e\u6642\u70b9\u3067\u306e\u30e1\u30bd\u30c3\u30c9\u7fa4\u3067\u3001\u305d\u306e\u5f8c use \u3057\u305f\u30c8\u30ec\u30a4\u30c8\u306b\u5909\u66f4\u304c\u3042\u3063\u3066\u3082\u8ffd\u5f93\u3067\u304d\u308b\u3057\u304f\u307f\u306b\u306a\u3063\u3066\u3044\u308b\u3088\u3046\u306b\u306f\u898b\u3048\u307e\u305b\u3093\u3002\n\n<blockquote>ClassDescription >> <b>installTraitsFrom:</b><font color=\"#000000\"> </font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#007F7F\">&quot;Install the traits from the given composition. This method implements<br>&nbsp;&nbsp;&nbsp;&nbsp;the core composition method - all others are just optimizations for<br>&nbsp;&nbsp;&nbsp;&nbsp;particular cases. Consequently, the optimized versions can always fall<br>&nbsp;&nbsp;&nbsp;&nbsp;back to this method when things get too hairy.&quot;</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#7F7F7F\">|</font><font color=\"#000000\"> </font><font color=\"#6B6B6B\">allTraits</font><font color=\"#000000\"> </font><font color=\"#6B6B6B\">methods</font><font color=\"#000000\"> </font><font color=\"#7F7F7F\">|</font><font color=\"#000000\"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#000000\">(</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">traitComposition</font><font color=\"#000000\"> </font><font color=\"#00007F\">isEmpty</font><font color=\"#000000\"> </font><font color=\"#00007F\">and:</font><font color=\"#000000\"> </font><font color=\"#007F00\">[</font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\"> </font><font color=\"#00007F\">isEmpty</font><font color=\"#007F00\">]</font><font color=\"#000000\">)</font><font color=\"#000000\"> </font><font color=\"#00007F\">ifTrue:</font><font color=\"#000000\"> </font><font color=\"#000000\">[</font><font color=\"#7F0000\">^</font><font color=\"#7F0000\">self</font><font color=\"#000000\">]</font><font color=\"#000000\">.</font><font color=\"#000000\"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#007F7F\">&quot;Check for cycles&quot;</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#6B6B6B\">allTraits</font><font color=\"#000000\"> </font><b>:=</b><font color=\"#000000\"> </font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\"> </font><font color=\"#00007F\">gather:</font><font color=\"#000000\"> </font><font color=\"#000000\">[</font><font color=\"#000000\">:</font><font color=\"#00007F\">t</font><font color=\"#000000\"> </font><font color=\"#7F7F7F\">|</font><font color=\"#000000\"> </font><font color=\"#00007F\">t</font><font color=\"#000000\"> </font><font color=\"#00007F\">allTraits</font><font color=\"#000000\"> </font><font color=\"#00007F\">copyWith:</font><font color=\"#000000\"> </font><font color=\"#00007F\">t</font><font color=\"#000000\">]</font><font color=\"#000000\">.</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#000000\">(</font><font color=\"#6B6B6B\">allTraits</font><font color=\"#000000\"> </font><font color=\"#00007F\">includes:</font><font color=\"#000000\"> </font><font color=\"#7F0000\">self</font><font color=\"#000000\">)</font><font color=\"#000000\"> </font><font color=\"#00007F\">ifTrue:</font><font color=\"#000000\">[</font><font color=\"#7F0000\">^</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">error:</font><font color=\"#000000\"> </font><font color=\"#7F007F\">'Cyclic trait definition detected'</font><font color=\"#000000\">]</font><font color=\"#000000\">.</font><font color=\"#000000\"><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">traitComposition:</font><font color=\"#000000\"> </font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\">.</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#6B6B6B\">methods</font><font color=\"#000000\"> </font><b>:=</b><font color=\"#000000\"> </font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">assembleTraitMethodsFrom:</font><font color=\"#000000\"> </font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\">.</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">installTraitMethodDict:</font><font color=\"#000000\"> </font><font color=\"#6B6B6B\">methods</font><font color=\"#000000\">.</font><font color=\"#000000\"><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">isMeta</font><font color=\"#000000\"> </font><font color=\"#00007F\">ifFalse:</font><font color=\"#000000\">[</font><font color=\"#7F0000\">self</font><font color=\"#000000\"> </font><font color=\"#00007F\">classSide</font><font color=\"#000000\"> </font><font color=\"#00007F\">updateTraitsFrom:</font><font color=\"#000000\"> </font><font color=\"#00007F\">aTraitComposition</font><font color=\"#000000\">]</font><font color=\"#000000\">.</font><font color=\"#000000\"><br></font></blockquote>\n\n</br>\n\u304c\u3057\u304b\u3057\u3001\u5b9f\u969b\u306b\u5909\u66f4\u3092\u52a0\u3048\u3066\u307f\u308b\u3068\u2026\n\n```smalltalk\n| T1 C T2 |\nT1 := Trait named: #T1 uses: {} category: 'UserObjects'.\nT1 compile: 'm1 ^''T1>>#m1'''.\n\nC := Object newSubclass uses: T1; rename: #C.\nC new m1.  \"=> 'T1>>#m1 ' \"\n\nT1 compile: 'm2 ^''T1>>#m2'''.\nC new m2.  \"=> 'T1>>#m2' \"\n\nT2 := Trait named: #T2 uses: {} category: 'UserObjects'.\nT2 compile: 'm3 ^''T2>>#m3'''.\nT1 uses: T2.\n\nC new m3.  \"=> 'T2>>#m3' \"\n\n{C. T1. T2} do: #removeFromSystem \"for clean up\"\n```\n\n\u3068\u3001\u666e\u901a\u306b\u52d5\u7684\u306b\u53cd\u6620\u3057\u3066\u304f\u308c\u307e\u3059\u3002\u52dd\u8ca0\u3042\u308a\u307e\u3057\u305f\u306d\uff08\u51fa\u6765\u30ec\u30fc\u30b9\u4e59\uff09\u3002\n\n\u3082\u3061\u308d\u3093 Smalltalk \u306e\u3053\u3068\u3067\u3059\u304b\u3089\u3001\u6ce5\u81ed\u304f\u4e00\u751f\u61f8\u547d\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u3001\u3053\u306e\u52d5\u7684\u6027\u3092\u5b9f\u73fe\u3057\u3066\u3044\u308b\u3053\u3068\u306f\u8a00\u3046\u307e\u3067\u3082\u3042\u308a\u307e\u305b\u3093\u3002\n\n![updateTraits.png](https://qiita-image-store.s3.amazonaws.com/0/49275/f32f070a-64c2-69d6-b13c-ce3c0885d1e2.png)\n\n\u5b9f\u306b\u3051\u306a\u3052\u3067\u3059\u306d\u3002\n", "tags": ["Smalltalk", "Ruby"]}