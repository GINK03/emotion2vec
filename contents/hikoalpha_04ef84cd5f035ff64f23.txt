{"context": "Google App Engine for PHP(GAE/PHP)\u3067\u306f\u6b8b\u5ff5\u306a\u304c\u3089Blobstore\u306e\u5229\u7528\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u3053\u3067Google\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308bGoogle Drive\u3068API\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7528\u3044\u3066GAE/PHP\u304b\u3089Google Drive\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n(2016.07.07 Google Cloud Platform\u304c\u5237\u65b0\u3055\u308c\u305f\u305f\u3081\u60c5\u5831\u304c\u53e4\u304f\u306a\u3063\u3066\u3044\u307e\u3059)\n\n1. API\u5229\u7528\u8a2d\u5b9a\nDevelopers Console\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001API\u306e\u8a2d\u5b9a\u304b\u3089Drive API\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n\n\n\n2. OAuth\u306e\u8a2d\u5b9a\nDevelopers Console\u306e[\u8a8d\u8a3c\u60c5\u5831]\u304b\u3089OAuth\u8a8d\u8a3c\u306b\u3088\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u306e\u53d6\u5f97\u3092\u884c\u3044\u307e\u3059\u3002[\u65b0\u3057\u3044\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u8a2d\u5b9a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u7a2e\u985e\u306f[\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3]\u3092\u9078\u629e\u3057\u3001[\u540c\u610f\u753b\u9762\u3092\u8a2d\u5b9a]\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\n\u540c\u610f\u753b\u9762\u3067\u30b5\u30fc\u30d3\u30b9\u540d\u306b\u4efb\u610f\u306e\u5024\u3092\u8a18\u5165\u3057\u3066[\u4fdd\u5b58]\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u4f5c\u6210\u753b\u9762\u306b\u623b\u308a\u307e\u3059\u3002\u627f\u8a8d\u6e08\u307f\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u5165\u529b\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u306b\u306fOAuth\u8a8d\u8a3c\u5f8c\u306b\u623b\u3063\u3066\u304f\u308bURL\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n\n\u3053\u308c\u304b\u3089\u4f5c\u6210\u3059\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3053\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n3. Google APIs Client Library for PHP\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nPHP\u304b\u3089Google\u306eAPI\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u30e9\u30a4\u30d6\u30e9\u30ea\u306fGoogle\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u4e0b\u8a18\u306e\u30ea\u30f3\u30af\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002API\u306b\u95a2\u3059\u308b\u60c5\u5831\u3084\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306fDevelopers Documentation\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\ngoogle/google-api-php-client \u00b7 GitHub\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n4. \u30d7\u30ed\u30b0\u30e9\u30e0\n\n4.1 OAuth\u8a8d\u8a3c\nGoogle Drive API\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306fOAuth\u8a8d\u8a3c\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u30022. OAuth\u306e\u8a2d\u5b9a\u3067\u53d6\u5f97\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u4e0b\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nsample.php\n<?php\n// \u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\nrequire_once('./google-api-php-client/src/Google/autoload.php');\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30bf\u30fc\u30c8\nsession_start();\n$client = new Google_Client();\n// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\n$client->setClientId('\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID');\n// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\n$client->setClientSecret('\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8');\n// \u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\n$client->setRedirectUri('\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI');\n\n// \u8a31\u53ef\u3055\u308c\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\u3068 URL \u306b code \u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u308b\n// code \u304c\u3042\u3063\u305f\u3089\u53d7\u3051\u53d6\u3063\u3066\u3001\u8a8d\u8a3c\u3059\u308b\nif (isset($_GET['code'])) {\n    // \u8a8d\u8a3c\n    $client->authenticate($_GET['code']);\n    $_SESSION['token'] = $client->getAccessToken();\n    // \u30ea\u30c0\u30a4\u30ec\u30af\u30c8 GET\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u898b\u3048\u306a\u304f\u3059\u308b\u305f\u3081\uff08\u3057\u306a\u304f\u3066\u3082OK\uff09\n    header('Location: http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF']);\n    exit;\n}\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\nif (isset($_SESSION['token'])) {\n    // \u30c8\u30fc\u30af\u30f3\u30bb\u30c3\u30c8\n    $client->setAccessToken($_SESSION['token']);\n}\n\n// \u30c8\u30fc\u30af\u30f3\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u305f\u3089\nif ($client->getAccessToken()) {\n    try {\n        echo \"Google Drive Api \u9023\u643a\u5b8c\u4e86\uff01<br>\";\n        $_SESSION['client'] = $client;\n    } catch (Google_Exception $e) {\n        echo $e->getMessage();\n    }\n} else {\n    // \u8a8d\u8a3c\u7528URL\u53d6\u5f97\n    $client->setScopes(Google_Service_Drive::DRIVE);\n    $authUrl = $client->createAuthUrl();\n    echo '<a href=\"'.$authUrl.'\">\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u304f\u3060\u3055\u3044\u3002</a>';\n    exit;\n}\n\n?>\n<a href=\"list.php\">\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7</a><br>\n<a href=\"imageview.php\">\u753b\u50cf\u8868\u793a</a><br>\n<a href=\"upload.php\">\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9</a>\n\n\n\n\n4.2 \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\nGoogle Drive\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\nlist.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n//$client\u5909\u6570\u306e\u578b\u3092\u660e\u793a\u3055\u305b\u308b\u305f\u3081session_start()\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u306e\u5f8c\u306b\u8a18\u8ff0\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\ntry {\n    // \u89aa\u30d5\u30a9\u30eb\u30c0\n    // root \u3067\u30de\u30a4\u30c9\u30e9\u30a4\u30d6, root \u4ee5\u5916\u306f\u540d\u524d\u3067\u306f\u306a\u304f ID \u3092\u6307\u5b9a\n    $parents = 'root';\n    if (isset($_GET['parents'])) {\n        $parents = htmlspecialchars($_GET['parents'], ENT_QUOTES);\n    }\n    // \u6b21\u30da\u30fc\u30b8\u306b\u79fb\u52d5\u3059\u308b\u5834\u5408\u306b\u6e21\u3059\u30c8\u30fc\u30af\u30f3\n    $pageToken = null;\n    if (isset($_GET['pageToken'])) {\n        $pageToken = $_GET['pageToken'];\n    }\n    $parameters = array('q' => \"'{$parents}' in parents\", 'maxResults' => 20);\n    if ($pageToken) {\n        $parameters['pageToken'] =$pageToken;\n    }\n    // \u30d5\u30a1\u30a4\u30eb\u30ea\u30b9\u30c8\u53d6\u5f97, Google_Service_Drive_FileList \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u8fd4\u3063\u3066\u304f\u308b\n    $files = $service->files->listFiles($parameters);\n    // \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u30c7\u30fc\u30bf\n    $results = $files->getItems();\n    // \u6b21\u30da\u30fc\u30b8\u306e\u30c8\u30fc\u30af\u30f3\u53d6\u5f97, \u306a\u3044\u5834\u5408\u306f NULL\n    $pageToken = $files->getNextPageToken();\n    // \u7d50\u679c\u8868\u793a\n    foreach ($results as $result) {\n        if ($result->mimeType == 'application/vnd.google-apps.folder') {\n            echo '\u30d5\u30a9\u30eb\u30c0 \uff1a<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($result->id).'\">'.$result->title.'</a> ID:'.$result->id.'<br />';\n        } else {\n            echo '\u30d5\u30a1\u30a4\u30eb \uff1a<a href=\"read.php?id='.$result->id.'\"\">'.$result->title.'</a> ID\uff1a'.$result->id.'<br />';\n        }\n    }\n    // pageToken \u304c\u3042\u3063\u305f\u3089\u6b21\u30da\u30fc\u30b8\u30d8\u306e\u30ea\u30f3\u30af\u8868\u793a\n    if ($pageToken) {\n        echo '<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($parents).'&pageToken='.urlencode($pageToken).'\">\u6b21\u30da\u30fc\u30b8</a>';\n    }\n}catch(Google_Exception $e){\n    echo $e->getMessage();\n}\n\n\n\n4.3 \u753b\u50cf\u8868\u793a\nGoogle Drive\u306b\u4fdd\u5b58\u3057\u3066\u3042\u308b\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\nimageview.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\ntry {\n    // \u89aa\u30d5\u30a9\u30eb\u30c0\n    // root \u3067\u30de\u30a4\u30c9\u30e9\u30a4\u30d6, root \u4ee5\u5916\u306f\u540d\u524d\u3067\u306f\u306a\u304f ID \u3092\u6307\u5b9a\n    $parents = 'root';\n    if (isset($_GET['parents'])) {\n        $parents = htmlspecialchars($_GET['parents'], ENT_QUOTES);\n    }\n    // \u6b21\u30da\u30fc\u30b8\u306b\u79fb\u52d5\u3059\u308b\u5834\u5408\u306b\u6e21\u3059\u30c8\u30fc\u30af\u30f3\n    $pageToken = null;\n    if (isset($_GET['pageToken'])) {\n        $pageToken = $_GET['pageToken'];\n    }\n    $parameters = array('q' => \"'{$parents}' in parents\", 'maxResults' => 20);\n    if ($pageToken) {\n        $parameters['pageToken'] =$pageToken;\n    }\n    // \u30d5\u30a1\u30a4\u30eb\u30ea\u30b9\u30c8\u53d6\u5f97, Google_Service_Drive_FileList \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u8fd4\u3063\u3066\u304f\u308b\n    $files = $service->files->listFiles($parameters);\n    // \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u30c7\u30fc\u30bf\n    $results = $files->getItems();\n    // \u6b21\u30da\u30fc\u30b8\u306e\u30c8\u30fc\u30af\u30f3\u53d6\u5f97, \u306a\u3044\u5834\u5408\u306f NULL\n    $pageToken = $files->getNextPageToken();\n    // \u7d50\u679c\u8868\u793a\n    foreach ($results as $result) {\n        // \u62e1\u5f35\u5b50\u304cjpg\u3067\u3042\u308c\u3070\u8868\u793a\n        if ($result->fileExtension == 'jpg') {\n            echo \"<img border=0 src={$result->webContentLink}><img border=0 src={$result->thumbnailLink}><br>\";\n        }\n    }\n    // pageToken \u304c\u3042\u3063\u305f\u3089\u6b21\u30da\u30fc\u30b8\u30d8\u306e\u30ea\u30f3\u30af\u8868\u793a\n    if ($pageToken) {\n        echo '<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($parents).'&pageToken='.urlencode($pageToken).'\">\u6b21\u30da\u30fc\u30b8</a>';\n    }\n}catch(Google_Exception $e){\n    echo $e->getMessage();\n}\n\n\n\u30de\u30a4\u30c9\u30e9\u30a4\u30d6\u306e\u76f4\u4e0b\u3067\u3042\u308c\u3070\u89aa\u30d5\u30a9\u30eb\u30c0\u306froot\u3001\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u30d5\u30a9\u30eb\u30c0ID\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a9\u30eb\u30c0ID\u306f4.2 \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u304b\u3001\u30d6\u30e9\u30a6\u30b6\u3067Google Drive\u3078\u30a2\u30af\u30bb\u30b9\u3057\u5bfe\u8c61\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3059\u308b\u3068URL\u304b\u3089ID\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nhttps://drive.google.com/drive/#folders/{\u30d5\u30a9\u30eb\u30c0ID}\n\n\u307e\u305f\u30d5\u30a1\u30a4\u30eb\u306fFiles\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u62e1\u5f35\u5b50\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u30ea\u30f3\u30af\u3001web\u53c2\u7167\u30ea\u30f3\u30af\u306a\u3069\u3092\u8fd4\u3059\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u62e1\u5f35\u5b50\u306ejpg\u3092\u5224\u65ad\u3057\u3066\u8868\u793a\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\n4.4 \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306finsert\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u6ce8\u610f\u70b9\u3068\u3057\u3066insert\u30e1\u30bd\u30c3\u30c9\u306e\u7b2c2\u5f15\u6570\u306earray()\u306b\u306f 'uploadType' => 'multipart'\u3092\u8a18\u8ff0\u3057\u306a\u3044\u3068\u7a7a\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\nupload.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n//session_start()\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u306e\u5f8c\u306b\u8a18\u8ff0\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\n// \u8ffd\u52a0\u3057\u305f\u3044\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n$file = new Google_Service_Drive_DriveFile();\n$file->setTitle('new_test.txt');\n$file->setDescription('PhpTest');\n$file->setMimeType('text/plain');\n\n$data = 'aaaaaaaaaaaaaaabbbbbbbbbbbbbbbbccccccccccccc';\n//$data = file_get_contents(\"./new_test.txt\");\n\n// \u89aa\u30d5\u30a9\u30eb\u30c0\u306e ID\n$parentId = 'root';\n// \u89aa\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n$parent = new Google_Service_Drive_ParentReference();\n$parent->setId($parentId);\n$file->setParents(array($parent));\n\ntry {\n    $result = $service->files->insert($file, array(\n        'data' => $data,\n        'mimeType' => 'text/plain',\n        'uploadType' => 'multipart'\n    ));\n\n    if($result) {\n        echo \"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5b8c\u4e86\";\n    } else {\n        echo \"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5931\u6557\";\n    }\n} catch (Exception $e) {\n    print \"An error occurred: \" . $e->getMessage();\n}\n\n\n\n4.5 \u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\nread.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n$id = $_GET['id'];\n\necho \"\u30d5\u30a1\u30a4\u30ebID\uff1a{$id}<br>\";\n\ntry {\n    $file = $service->files->get($id);\n    $downloadUrl = $file->getDownloadUrl();\n    $request = new Google_Http_Request($downloadUrl, 'GET', null, null);\n    $httpRequest = $service->getClient()->getAuth()->authenticatedRequest($request);\n    if ($httpRequest->getResponseHttpCode() == 200) {\n        echo \"\u30d5\u30a1\u30a4\u30eb\u5185\u5bb9<br>\";\n        echo $httpRequest->getResponseBody();\n    } else {\n        // An error occurred.\n        return null;\n    }\n} catch(Google_Exception $e) {\n    echo $e->getMessage();\n}\n\n\n\u53c2\u8003\nPHP\u3067Google Drive Api\u3092\u4f7f\u7528\u3059\u308b | ScrapEngineer\n[PHP] Google Drive API \u3092\u4f7f\u3063\u3066 Google Drive \u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u53d6\u5f97\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u8ffd\u52a0\u3092\u884c\u3046 | unlinked log\nGoogle Developers\nGoogle App Engine for PHP(GAE/PHP)\u3067\u306f\u6b8b\u5ff5\u306a\u304c\u3089Blobstore\u306e\u5229\u7528\u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u305d\u3053\u3067Google\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308bGoogle Drive\u3068API\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u7528\u3044\u3066GAE/PHP\u304b\u3089Google Drive\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n(2016.07.07 Google Cloud Platform\u304c\u5237\u65b0\u3055\u308c\u305f\u305f\u3081\u60c5\u5831\u304c\u53e4\u304f\u306a\u3063\u3066\u3044\u307e\u3059)\n\n## 1. API\u5229\u7528\u8a2d\u5b9a\n[Developers Console](https://console.developers.google.com/)\u3078\u30a2\u30af\u30bb\u30b9\u3057\u3001API\u306e\u8a2d\u5b9a\u304b\u3089Drive API\u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n![api.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/8a42fb76-72d1-18a2-df99-d01a9b773f4e.jpeg)\n\n\n![driveapi.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/b26d118e-f5fd-4a62-d6a3-fbe75da36888.jpeg)\n\n<A NAME=OAuth />\n## 2. OAuth\u306e\u8a2d\u5b9a\nDevelopers Console\u306e[\u8a8d\u8a3c\u60c5\u5831]\u304b\u3089OAuth\u8a8d\u8a3c\u306b\u3088\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u306e\u53d6\u5f97\u3092\u884c\u3044\u307e\u3059\u3002[\u65b0\u3057\u3044\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u8a2d\u5b9a\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u7a2e\u985e\u306f[\u30a6\u30a7\u30d6\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3]\u3092\u9078\u629e\u3057\u3001[\u540c\u610f\u753b\u9762\u3092\u8a2d\u5b9a]\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n![client.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/9b42b4de-5f62-ac00-b02c-be386d256ba6.jpeg)\n\n\u540c\u610f\u753b\u9762\u3067\u30b5\u30fc\u30d3\u30b9\u540d\u306b\u4efb\u610f\u306e\u5024\u3092\u8a18\u5165\u3057\u3066[\u4fdd\u5b58]\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u307e\u3059\u3002\n![mail.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/6a482614-ea87-10ac-81a0-d0e82b8f1ed9.jpeg)\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u4f5c\u6210\u753b\u9762\u306b\u623b\u308a\u307e\u3059\u3002\u627f\u8a8d\u6e08\u307f\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u5165\u529b\u3059\u308b\u30d5\u30a9\u30fc\u30e0\u306b\u306fOAuth\u8a8d\u8a3c\u5f8c\u306b\u623b\u3063\u3066\u304f\u308bURL\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n![client2.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/1afdb74a-cf4b-ed6f-e274-155178542df7.jpeg)\n\n[\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3092\u4f5c\u6210]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\n![secret.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/0657663e-b0aa-6e7a-dd29-9ce7b142d4a4.jpeg)\n\u3053\u308c\u304b\u3089\u4f5c\u6210\u3059\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u3053\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n## 3. Google APIs Client Library for PHP\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\nPHP\u304b\u3089Google\u306eAPI\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u30e9\u30a4\u30d6\u30e9\u30ea\u306fGoogle\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u4e0b\u8a18\u306e\u30ea\u30f3\u30af\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002API\u306b\u95a2\u3059\u308b\u60c5\u5831\u3084\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u306f[Developers Documentation](https://developers.google.com/api-client-library/php/start/get_started)\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3059\u3002\n\n[google/google-api-php-client \u00b7 GitHub](https://github.com/google/google-api-php-client)\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30a4\u30eb\u3068\u540c\u3058\u30d5\u30a9\u30eb\u30c0\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\n\n## 4. \u30d7\u30ed\u30b0\u30e9\u30e0\n### 4.1 OAuth\u8a8d\u8a3c\nGoogle Drive API\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306fOAuth\u8a8d\u8a3c\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u3002<A HREF=#OAuth>2. OAuth\u306e\u8a2d\u5b9a</A>\u3067\u53d6\u5f97\u3057\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u3001\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\u3092\u4e0b\u8a18\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n``` php:sample.php\n<?php\n// \u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\nrequire_once('./google-api-php-client/src/Google/autoload.php');\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u30b9\u30bf\u30fc\u30c8\nsession_start();\n$client = new Google_Client();\n// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID\n$client->setClientId('\u30af\u30e9\u30a4\u30a2\u30f3\u30c8ID');\n// \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\n$client->setClientSecret('\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b7\u30fc\u30af\u30ec\u30c3\u30c8');\n// \u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI\n$client->setRedirectUri('\u30ea\u30c0\u30a4\u30ec\u30af\u30c8URI');\n\n// \u8a31\u53ef\u3055\u308c\u3066\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\u3068 URL \u306b code \u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u308b\n// code \u304c\u3042\u3063\u305f\u3089\u53d7\u3051\u53d6\u3063\u3066\u3001\u8a8d\u8a3c\u3059\u308b\nif (isset($_GET['code'])) {\n    // \u8a8d\u8a3c\n    $client->authenticate($_GET['code']);\n    $_SESSION['token'] = $client->getAccessToken();\n    // \u30ea\u30c0\u30a4\u30ec\u30af\u30c8 GET\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u898b\u3048\u306a\u304f\u3059\u308b\u305f\u3081\uff08\u3057\u306a\u304f\u3066\u3082OK\uff09\n    header('Location: http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF']);\n    exit;\n}\n\n// \u30bb\u30c3\u30b7\u30e7\u30f3\u304b\u3089\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\nif (isset($_SESSION['token'])) {\n    // \u30c8\u30fc\u30af\u30f3\u30bb\u30c3\u30c8\n    $client->setAccessToken($_SESSION['token']);\n}\n\n// \u30c8\u30fc\u30af\u30f3\u304c\u30bb\u30c3\u30c8\u3055\u308c\u3066\u3044\u305f\u3089\nif ($client->getAccessToken()) {\n    try {\n        echo \"Google Drive Api \u9023\u643a\u5b8c\u4e86\uff01<br>\";\n        $_SESSION['client'] = $client;\n    } catch (Google_Exception $e) {\n        echo $e->getMessage();\n    }\n} else {\n    // \u8a8d\u8a3c\u7528URL\u53d6\u5f97\n    $client->setScopes(Google_Service_Drive::DRIVE);\n    $authUrl = $client->createAuthUrl();\n    echo '<a href=\"'.$authUrl.'\">\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u53ef\u3057\u3066\u304f\u3060\u3055\u3044\u3002</a>';\n    exit;\n}\n\n?>\n<a href=\"list.php\">\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7</a><br>\n<a href=\"imageview.php\">\u753b\u50cf\u8868\u793a</a><br>\n<a href=\"upload.php\">\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9</a>\n```\n\n<A NAME=list />\n### 4.2 \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\nGoogle Drive\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n``` php:list.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n//$client\u5909\u6570\u306e\u578b\u3092\u660e\u793a\u3055\u305b\u308b\u305f\u3081session_start()\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u306e\u5f8c\u306b\u8a18\u8ff0\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\ntry {\n    // \u89aa\u30d5\u30a9\u30eb\u30c0\n    // root \u3067\u30de\u30a4\u30c9\u30e9\u30a4\u30d6, root \u4ee5\u5916\u306f\u540d\u524d\u3067\u306f\u306a\u304f ID \u3092\u6307\u5b9a\n    $parents = 'root';\n    if (isset($_GET['parents'])) {\n        $parents = htmlspecialchars($_GET['parents'], ENT_QUOTES);\n    }\n    // \u6b21\u30da\u30fc\u30b8\u306b\u79fb\u52d5\u3059\u308b\u5834\u5408\u306b\u6e21\u3059\u30c8\u30fc\u30af\u30f3\n    $pageToken = null;\n    if (isset($_GET['pageToken'])) {\n        $pageToken = $_GET['pageToken'];\n    }\n    $parameters = array('q' => \"'{$parents}' in parents\", 'maxResults' => 20);\n    if ($pageToken) {\n        $parameters['pageToken'] =$pageToken;\n    }\n    // \u30d5\u30a1\u30a4\u30eb\u30ea\u30b9\u30c8\u53d6\u5f97, Google_Service_Drive_FileList \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u8fd4\u3063\u3066\u304f\u308b\n    $files = $service->files->listFiles($parameters);\n    // \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u30c7\u30fc\u30bf\n    $results = $files->getItems();\n    // \u6b21\u30da\u30fc\u30b8\u306e\u30c8\u30fc\u30af\u30f3\u53d6\u5f97, \u306a\u3044\u5834\u5408\u306f NULL\n    $pageToken = $files->getNextPageToken();\n    // \u7d50\u679c\u8868\u793a\n    foreach ($results as $result) {\n        if ($result->mimeType == 'application/vnd.google-apps.folder') {\n            echo '\u30d5\u30a9\u30eb\u30c0 \uff1a<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($result->id).'\">'.$result->title.'</a> ID:'.$result->id.'<br />';\n        } else {\n            echo '\u30d5\u30a1\u30a4\u30eb \uff1a<a href=\"read.php?id='.$result->id.'\"\">'.$result->title.'</a> ID\uff1a'.$result->id.'<br />';\n        }\n    }\n    // pageToken \u304c\u3042\u3063\u305f\u3089\u6b21\u30da\u30fc\u30b8\u30d8\u306e\u30ea\u30f3\u30af\u8868\u793a\n    if ($pageToken) {\n        echo '<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($parents).'&pageToken='.urlencode($pageToken).'\">\u6b21\u30da\u30fc\u30b8</a>';\n    }\n}catch(Google_Exception $e){\n    echo $e->getMessage();\n}\n```\n\n### 4.3 \u753b\u50cf\u8868\u793a\nGoogle Drive\u306b\u4fdd\u5b58\u3057\u3066\u3042\u308b\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\n``` php:imageview.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\ntry {\n    // \u89aa\u30d5\u30a9\u30eb\u30c0\n    // root \u3067\u30de\u30a4\u30c9\u30e9\u30a4\u30d6, root \u4ee5\u5916\u306f\u540d\u524d\u3067\u306f\u306a\u304f ID \u3092\u6307\u5b9a\n    $parents = 'root';\n    if (isset($_GET['parents'])) {\n        $parents = htmlspecialchars($_GET['parents'], ENT_QUOTES);\n    }\n    // \u6b21\u30da\u30fc\u30b8\u306b\u79fb\u52d5\u3059\u308b\u5834\u5408\u306b\u6e21\u3059\u30c8\u30fc\u30af\u30f3\n    $pageToken = null;\n    if (isset($_GET['pageToken'])) {\n        $pageToken = $_GET['pageToken'];\n    }\n    $parameters = array('q' => \"'{$parents}' in parents\", 'maxResults' => 20);\n    if ($pageToken) {\n        $parameters['pageToken'] =$pageToken;\n    }\n    // \u30d5\u30a1\u30a4\u30eb\u30ea\u30b9\u30c8\u53d6\u5f97, Google_Service_Drive_FileList \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u8fd4\u3063\u3066\u304f\u308b\n    $files = $service->files->listFiles($parameters);\n    // \u30d5\u30a1\u30a4\u30eb\u306e\u4e00\u89a7\u30c7\u30fc\u30bf\n    $results = $files->getItems();\n    // \u6b21\u30da\u30fc\u30b8\u306e\u30c8\u30fc\u30af\u30f3\u53d6\u5f97, \u306a\u3044\u5834\u5408\u306f NULL\n    $pageToken = $files->getNextPageToken();\n    // \u7d50\u679c\u8868\u793a\n    foreach ($results as $result) {\n        // \u62e1\u5f35\u5b50\u304cjpg\u3067\u3042\u308c\u3070\u8868\u793a\n        if ($result->fileExtension == 'jpg') {\n            echo \"<img border=0 src={$result->webContentLink}><img border=0 src={$result->thumbnailLink}><br>\";\n        }\n    }\n    // pageToken \u304c\u3042\u3063\u305f\u3089\u6b21\u30da\u30fc\u30b8\u30d8\u306e\u30ea\u30f3\u30af\u8868\u793a\n    if ($pageToken) {\n        echo '<a href=\"http://'.$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'].'?parents='.urlencode($parents).'&pageToken='.urlencode($pageToken).'\">\u6b21\u30da\u30fc\u30b8</a>';\n    }\n}catch(Google_Exception $e){\n    echo $e->getMessage();\n}\n```\n\n\u30de\u30a4\u30c9\u30e9\u30a4\u30d6\u306e\u76f4\u4e0b\u3067\u3042\u308c\u3070\u89aa\u30d5\u30a9\u30eb\u30c0\u306froot\u3001\u30d5\u30a9\u30eb\u30c0\u3092\u6307\u5b9a\u3059\u308b\u5834\u5408\u306f\u30d5\u30a9\u30eb\u30c0ID\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u30d5\u30a9\u30eb\u30c0ID\u306f<A HREF=#list>4.2 \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7</A>\u304b\u3001\u30d6\u30e9\u30a6\u30b6\u3067Google Drive\u3078\u30a2\u30af\u30bb\u30b9\u3057\u5bfe\u8c61\u306e\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3059\u308b\u3068URL\u304b\u3089ID\u3092\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n`https://drive.google.com/drive/#folders/{\u30d5\u30a9\u30eb\u30c0ID}`\n\n![url.jpg](https://qiita-image-store.s3.amazonaws.com/0/70925/44b59029-a021-4f50-fabd-a48753fdf59d.jpeg)\n\n\u307e\u305f\u30d5\u30a1\u30a4\u30eb\u306f[Files](https://developers.google.com/drive/v2/reference/files)\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u62e1\u5f35\u5b50\u3001\u30b5\u30e0\u30cd\u30a4\u30eb\u30ea\u30f3\u30af\u3001web\u53c2\u7167\u30ea\u30f3\u30af\u306a\u3069\u3092\u8fd4\u3059\u30e1\u30bd\u30c3\u30c9\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u30d5\u30a1\u30a4\u30eb\u62e1\u5f35\u5b50\u306ejpg\u3092\u5224\u65ad\u3057\u3066\u8868\u793a\u3055\u305b\u3066\u3044\u307e\u3059\u3002\n\n### 4.4 \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306finsert\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u6ce8\u610f\u70b9\u3068\u3057\u3066insert\u30e1\u30bd\u30c3\u30c9\u306e\u7b2c2\u5f15\u6570\u306earray()\u306b\u306f 'uploadType' => 'multipart'\u3092\u8a18\u8ff0\u3057\u306a\u3044\u3068\u7a7a\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n``` php:upload.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\n//session_start()\u306f\u30e9\u30a4\u30d6\u30e9\u30ea\u8aad\u307f\u8fbc\u307f\u306e\u5f8c\u306b\u8a18\u8ff0\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n\n// \u8ffd\u52a0\u3057\u305f\u3044\u30d5\u30a1\u30a4\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n$file = new Google_Service_Drive_DriveFile();\n$file->setTitle('new_test.txt');\n$file->setDescription('PhpTest');\n$file->setMimeType('text/plain');\n\n$data = 'aaaaaaaaaaaaaaabbbbbbbbbbbbbbbbccccccccccccc';\n//$data = file_get_contents(\"./new_test.txt\");\n\n// \u89aa\u30d5\u30a9\u30eb\u30c0\u306e ID\n$parentId = 'root';\n// \u89aa\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n$parent = new Google_Service_Drive_ParentReference();\n$parent->setId($parentId);\n$file->setParents(array($parent));\n\ntry {\n    $result = $service->files->insert($file, array(\n        'data' => $data,\n        'mimeType' => 'text/plain',\n        'uploadType' => 'multipart'\n    ));\n\n    if($result) {\n        echo \"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5b8c\u4e86\";\n    } else {\n        echo \"\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5931\u6557\";\n    }\n} catch (Exception $e) {\n    print \"An error occurred: \" . $e->getMessage();\n}\n```\n\n### 4.5 \u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\n\u30c6\u30ad\u30b9\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u5185\u5bb9\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n``` php:read.php\n<?php\nrequire_once('./google-api-php-client/src/Google/autoload.php');\nrequire_once('./google-api-php-client/src/Google/Service/Drive.php');\nsession_start();\n\n$client = $_SESSION['client'];\n$service = new Google_Service_Drive($client);\n$id = $_GET['id'];\n\necho \"\u30d5\u30a1\u30a4\u30ebID\uff1a{$id}<br>\";\n\ntry {\n    $file = $service->files->get($id);\n    $downloadUrl = $file->getDownloadUrl();\n    $request = new Google_Http_Request($downloadUrl, 'GET', null, null);\n    $httpRequest = $service->getClient()->getAuth()->authenticatedRequest($request);\n    if ($httpRequest->getResponseHttpCode() == 200) {\n        echo \"\u30d5\u30a1\u30a4\u30eb\u5185\u5bb9<br>\";\n        echo $httpRequest->getResponseBody();\n    } else {\n        // An error occurred.\n        return null;\n    }\n} catch(Google_Exception $e) {\n    echo $e->getMessage();\n}\n```\n\u53c2\u8003\n[PHP\u3067Google Drive Api\u3092\u4f7f\u7528\u3059\u308b | ScrapEngineer](http://scrap.php.xdomain.jp/google_drive_api/)\n[[PHP] Google Drive API \u3092\u4f7f\u3063\u3066 Google Drive \u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u53d6\u5f97\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u8ffd\u52a0\u3092\u884c\u3046 | unlinked log](http://log.noiretaya.com/193)\n[Google Developers](https://developers.google.com/drive/web/quickstart/quickstart-php)\n", "tags": ["GoogleAppEngine", "PHP"]}