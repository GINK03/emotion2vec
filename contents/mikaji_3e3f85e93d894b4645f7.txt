{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nQiita Advent Calendar 2015\u3063\u3066\u306e\u3092\u6700\u8fd1\u77e5\u3063\u3066\u3001\u66f8\u304d\u305f\u3044\u306a\u3042\u3063\u3066\u601d\u3063\u305f\u3051\u3069\u305d\u3082\u305d\u3082Qiita\u6295\u7a3f\u3057\u305f\u3053\u3068\u306d\u3048\u308f\u3063\u3066\u306a\u3063\u305f\u306e\u3067\u3001\u307e\u305a\u306f\u521d\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u6765\u5e74\u306fAdvent Calendar\u66f8\u304d\u305f\u3044\uff01\n\u3068\u3044\u3046\u308f\u3051\u3067\u5185\u5bb9\u306f\u753b\u50cf\u51e6\u7406\u7cfb\u306e\u8a71\u3067\u3059\u3002\n\u753b\u50cf\u51e6\u7406\u3084\u3063\u3066\u308b\u3068\u3001\u753b\u50cf\u304b\u3089\u4eba\u691c\u51fa\u3084\u52d5\u4f53\u691c\u51fa\u3092\u3059\u308b\u306e\u3063\u3066\u5272\u3068\u8ab0\u3067\u3082\u3084\u308a\u307e\u3059\u3088\u306d\u3002\n\u305d\u306e\u306a\u304b\u3067\u691c\u51fa\u7cbe\u5ea6\u3092\u9ad8\u3081\u308b\u306b\u306f\u7279\u5fb4\u91cf\u306e\u9078\u5b9a\u304c\u91cd\u8981\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\u3068\u3044\u3046\u308f\u3051\u3067\u4eca\u56de\u306fHOG\u7279\u5fb4\u91cf\u3092\u5b9f\u969b\u306b\u62bd\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\n\u4eca\u56de\u306f\u753b\u50cf\u306e\u985e\u4f3c\u5ea6\u306e\u7cbe\u5ea6\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3057\u307e\u3057\u305f\u3002\n\u3042\u304f\u307e\u3067\u7279\u5fb4\u91cf\u306e\u62bd\u51fa\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u30ab\u30d0\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\n\nHOG\u7279\u5fb4\u91cf\u3068\u306f\n\u305d\u3082\u305d\u3082HOG\u7279\u5fb4\u91cf\u3063\u3066\u306a\u3093\u3084\u306d\u3093\uff01\u3063\u3066\u65b9\u3082\u591a\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u307e\u305a\u306f\u8aac\u660e\u3092\u3002\nHOG(Histograms of Oriented Gradients)\u3068\u306f\u5c40\u6240\u9818\u57df (\u30bb\u30eb) \u306e\u8f1d\u5ea6\u306e\u52fe\u914d\u65b9\u5411\u3092\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u5316\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\u30e1\u30ea\u30c3\u30c8\u3068\u3057\u3066\u306f\u3001\u52fe\u914d\u60c5\u5831\u3092\u3082\u3068\u306b\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u7570\u306a\u308b\u30b5\u30a4\u30ba\u306e\u753b\u50cf\u3092\u5bfe\u8c61\u3068\u3059\u308b\u969b\u3082\u540c\u3058\u30b5\u30a4\u30ba\u306b\u30ea\u30b5\u30a4\u30ba\u3059\u308b\u3053\u3068\u3067\u6bd4\u8f03\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\nHOG\u7279\u5fb4\u91cf\u3092\u5f97\u308b\u305f\u3081\u306e\u30d7\u30ed\u30bb\u30b9\nHOG\u7279\u5fb4\u91cf\u3092\u5f97\u308b\u305f\u3081\u306e\u30d7\u30ed\u30bb\u30b9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3042\u308b\u753b\u50cf\u306b\u3064\u3044\u3066\u9069\u5f53\u306a\u30b5\u30a4\u30ba[pixel]\u306b\u30ea\u30b5\u30a4\u30ba\u3057\u3001\u30b0\u30ec\u30a4\u30b9\u30b1\u30fc\u30eb\u3067\u8aad\u307f\u8fbc\u3080\u3002\n\u5404pixel\u306e\u8f1d\u5ea6\u304b\u3089\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u3092\u6c42\u3081\u308b\u3002\n\u30bb\u30eb\u9818\u57df\u3054\u3068\u306b\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u6c42\u3081\u308b(\u4eca\u56de\u306f5\u00d75[pixel])\u3002\n\u30d6\u30ed\u30c3\u30af(3\u00d73[\u30bb\u30eb])\u3054\u3068\u306b\u6b63\u898f\u5316\u3057\u3001\u7279\u5fb4\u91cf\u3092\u62bd\u51fa\u3059\u308b\u3002\n\n\n\u753b\u50cf,\u30bb\u30eb,\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u95a2\u4fc2\n\u753b\u50cf\u3084\u30bb\u30eb,\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u95a2\u4fc2\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\n\nHOG\u7279\u5fb4\u91cf\u306e\u8a08\u7b97\u5f0f\n\u7279\u5fb4\u91cf\u306e\u6b21\u5143\u6570\u3092\u6c42\u3081\u308b\u305f\u3081\u306e\u5f0f\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nOrientation\u306f\u7279\u5fb4\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u4f7f\u7528\u3059\u308b\u52fe\u914d\u65b9\u5411\u306e\u91cf\u5b50\u5316\u6570\u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u306f\u6b21\u306e\u5f0f\u3067\u6c42\u3081\u307e\u3059\u3002\n\n\n\u5b9f\u88c5\u7de8\n\u3068\u3044\u3046\u308f\u3051\u3067\u4e0a\u8a18\u306e\u5f0f\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u4eca\u56de\u306fC++\u3068\u753b\u50cf\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066OpenCV\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nhog.cpp\n#include <iostream>\n#include <string>\n#include <fstream>\n#include <vector>\n#include \"opencv_lib.h\"\n\n\n#include <opencv/cv.h>\n#include <opencv2/core/core.hpp>\n#include <opencv2/highgui/highgui.hpp>\n#include <opencv2/imgproc/imgproc.hpp>\n\ntypedef struct _HOG_FEATURE{\n    int bX;             //\u30d6\u30ed\u30c3\u30af\u9818\u57df\u306e\u5de6\u4e0a\u306e x \u5ea7\u6a19\n    int bY;             //\u30d6\u30ed\u30c3\u30af\u9818\u57df\u306e\u5de6\u4e0a\u306e y \u5ea7\u6a19\n    int cX;             //\u30bb\u30eb\u9818\u57df\u306e\u5de6\u4e0a\u306e x \u5ea7\u6a19\n    int cY;             //\u30bb\u30eb\u9818\u57df\u306e\u5de6\u4e0a\u306e y \u5ea7\u6a19\n    int ori;    //\u52fe\u914d\u306e\u65b9\u5411\n    double dVal;        //\u7279\u5fb4\u91cf\n}HOG_FEATURE;\n\nIplImage* Img;              //\u5165\u529b\u753b\u50cf\nIplImage* LowImg;           //\u30ea\u30b5\u30a4\u30ba\u5f8c\u306e\u5165\u529b\u753b\u50cf    \n#define CELL_SIZE   5       //\u30bb\u30eb\u30b5\u30a4\u30ba (pixel)\n#define BLOCK_SIZE  3       //\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba (\u30bb\u30eb)\n#define SET_Y_SIZE  40      //\u30d1\u30c3\u30c1\u306e\u7e26\u5e45 (pixel)\n#define SET_X_SIZE  30      //\u30d1\u30c3\u30c1\u306e\u6a2a\u5e45 (pixel)\n\n#define ORIENTATION 9       //\u52fe\u914d\u65b9\u5411\n\n#define PI          3.14\n#define LN_E        1.0\n\n\n//HOG \u7279\u5fb4\u91cf\u306e\u66f8\u304d\u51fa\u3057\nint OutputHOGFeature(int nFeatureNum, HOG_FEATURE *pHOGFeatures, char* File){\n\n    FILE *fp;\n    int  i;\n\n    if(NULL == (fp=fopen(File, \"w\"))){\n        printf(\"Can not open the outfile.\\n\");\n        return(1);  \n    }\n\n    for(i=0; i<nFeatureNum; i++){\n        fprintf(fp, \"%lf\\n\", pHOGFeatures[i].dVal);\n    }\n\n    fclose(fp);\n\n    return(0);\n}\n\n\n//\u914d\u5217\u78ba\u4fdd\u306e\u305f\u3081\u306b\u3042\u3089\u304b\u3058\u3081\u7279\u5fb4\u91cf\u306e\u6570\u3092\u7b97\u51fa\nint CountHOGFeature(){\n\n    int i,j,k,x,y;\n    int fCount = 0;     //\u7279\u5fb4\u91cf\u306e\u6570\n\n    //\u30d6\u30ed\u30c3\u30af\u306e\u79fb\u52d5\n    for(y=0; y<((SET_Y_SIZE/CELL_SIZE)-BLOCK_SIZE+1); y++){\n        for(x=0; x<((SET_X_SIZE/CELL_SIZE)-BLOCK_SIZE+1); x++){     \n            //\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n            for(j=0; j<BLOCK_SIZE; j++){\n                for(i=0; i<BLOCK_SIZE; i++){\n                    //\u52fe\u914d\u65b9\u5411\u6570\n                    for(k=0; k<ORIENTATION; k++){\n                        //\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n                        fCount++;\n                    }\n                }\n            }\n        }\n    }\n\n    return (fCount);\n}\n\n//\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u7b97\u51fa\nint CompHistogram(double cell_hist[]){\n\n    int x,y;\n    int num1,num2;      //\u914d\u5217\u306e\u8981\u7d20\u6570\u306e\u8a08\u7b97\n\n    int xDelta,yDelta;          //\u5404\u65b9\u5411\u306e\u8f1d\u5ea6\u306e\u5dee\u5206\n    double magnitude;           //\u52fe\u914d\u5f37\u5ea6\n\n    double angle = 180.0/(double)ORIENTATION;   //\u91cf\u5b50\u5316\u3059\u308b\u6642\u306e\u89d2\u5ea6\n    double gradient;\n\n    //\u753b\u50cf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u69cb\u9020\u4f53\u304b\u3089\u8f1d\u5ea6\u5024\u3060\u3051\u30b3\u30d4\u30fc\n    unsigned char* imgSource = (unsigned char*)LowImg->imageData;\n    //\u753b\u50cf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u69cb\u9020\u4f53\u306e\u6c34\u5e73\u65b9\u5411\u306e\u30c7\u30fc\u30bf\u6570\n    int wStep = LowImg->widthStep;\n    //1\u30d4\u30af\u30bb\u30eb\u3042\u305f\u308a\u306e\u30d3\u30c3\u30c8\u6570\n    int bpp   = ((LowImg->depth&255)/8)*LowImg->nChannels;\n\n    //\u30d1\u30c3\u30c1\u5185\u306e\u79fb\u52d5\n    for(y=0; y<SET_Y_SIZE; y++){\n        for(x=0; x<SET_X_SIZE; x++){\n\n            //\u6a2a\u65b9\u5411\u306e\u5dee\u5206\n            if(x == 0){\n                num1 = y*wStep+(x+0)*bpp;\n                num2 = y*wStep+(x+1)*bpp;\n                xDelta = imgSource[num1]-imgSource[num2];\n            }else if(x == LowImg->width-1){\n                num1 = y*wStep+(x-1)*bpp;\n                num2 = y*wStep+(x+0)*bpp;\n                xDelta = imgSource[num1]-imgSource[num2];\n            }else{\n                num1 = y*wStep+(x-1)*bpp;\n                num2 = y*wStep+(x+1)*bpp;\n                xDelta = imgSource[num1]-imgSource[num2];\n            }\n\n            //\u7e26\u65b9\u5411\u306e\u5dee\u5206\n            if(y == 0){\n                num1 = (y+0)*wStep+x*bpp;\n                num2 = (y+1)*wStep+x*bpp;\n                yDelta = imgSource[num1]-imgSource[num2];\n            }else if(y == LowImg->height-1){\n                num1 = (y-1)*wStep+x*bpp;\n                num2 = (y+0)*wStep+x*bpp;\n                yDelta = imgSource[num1]-imgSource[num2];\n            }else{\n                num1 = (y-1)*wStep+x*bpp;\n                num2 = (y+1)*wStep+x*bpp;\n                yDelta = imgSource[num1]-imgSource[num2];\n            }\n\n            //\u52fe\u914d\u5f37\u5ea6\u306e\u7b97\u51fa\n            magnitude = sqrt((double)xDelta*(double)xDelta+(double)yDelta*(double)yDelta);\n\n            //\u52fe\u914d\u65b9\u5411\u306e\u7b97\u51fa\n            gradient = atan2((double)yDelta, (double)xDelta);\n            //\u30e9\u30b8\u30a2\u30f3\u304b\u3089\u89d2\u5ea6\u3078\u5909\u63db\n            gradient = (gradient*180.0)/PI;\n            //\u7b26\u53f7\u304c\u8ca0\u3067\u3042\u308b\u5834\u5408\u306f\u53cd\u8ee2\n            if(gradient < 0.0){\n                gradient += 360.0;\n            }\n            //0~360\u5ea6\u304b\u3089 0~180\u5ea6\u306b\u5909\u63db\n            if(gradient > 180.0){\n                gradient -= 180.0;\n            }\n            //20\u5ea6\u305a\u3064,9\u5206\u5272\n            gradient = gradient/angle;\n\n            //\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u84c4\u7a4d\n            num1 = (int)((y/CELL_SIZE)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(x/CELL_SIZE)*ORIENTATION+(int)gradient);\n            cell_hist[num1] += magnitude;\n        }\n    }\n    return(0);\n}\n\n//HOG \u7279\u5fb4\u91cf\u306e\u7b97\u51fa\u3068\u6b63\u898f\u5316\nint CompHOG(HOG_FEATURE *pHOGFeatures, double cell_hist[]){\n\n    int x,y,i,j,k,f;\n    int num;                //\u914d\u5217\u306e\u8981\u7d20\u6570\u306e\u8a08\u7b97\n\n    double sum_magnitude;   //\u30d6\u30ed\u30c3\u30af\u9818\u57df\u5185\u306e\n    int    fCount = 0;      //\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n\n    //\u7279\u5fb4\u91cf\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7b97\u51fa\n    //\u30d6\u30ed\u30c3\u30af\u306e\u79fb\u52d5\n    for(y=0; y<((SET_Y_SIZE/CELL_SIZE)-BLOCK_SIZE+1); y++){\n        for(x=0; x<((SET_X_SIZE/CELL_SIZE)-BLOCK_SIZE+1); x++){ \n            //\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n            for(j=0; j<BLOCK_SIZE; j++){\n                for(i=0; i<BLOCK_SIZE; i++){\n                    //\u52fe\u914d\u65b9\u5411\u00b8\n                    for(k=0; k<ORIENTATION; k++){\n                        //\u7279\u5fb4\u91cf\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\n                        pHOGFeatures[fCount].bX = x;\n                        pHOGFeatures[fCount].bY = y;\n                        pHOGFeatures[fCount].cX = i;\n                        pHOGFeatures[fCount].cY = j;\n                        pHOGFeatures[fCount].ori = k;\n\n                        //\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n                        fCount++;\n                    }\n                }\n            }\n        }\n    }\n\n    //\u7279\u5fb4\u91cf\u306e\u7b97\u51fa\u3068\u6b63\u898f\u5316\n    for(f=0; f<fCount; f++){\n        //\u7279\u5fb4\u91cf\u91cf\u3092\u6b63\u898f\u5316\u3059\u308b\u6642\u306b\u4f7f\u7528\u3059\u308b\u7279\u5fb4\u91cf\u306e\u4e8c\u4e57\u548c\u3092\u6b63\u898f\u5316\n        sum_magnitude = 0.0;\n        //\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n        for(j=0; j<BLOCK_SIZE; j++){\n            for(i=0; i<BLOCK_SIZE; i++){\n\n                //\u52fe\u914d\u65b9\u5411\n                for(k=0; k<ORIENTATION; k++){\n                    //\u6b63\u898f\u5316\u306e\u305f\u3081\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u7dcf\u548c\u306e\u4e8c\u4e57\u3092\u7b97\u51fa\n                    num = (int)((pHOGFeatures[f].bY+j)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(pHOGFeatures[f].bX+i)*ORIENTATION+k);\n                    sum_magnitude += cell_hist[num]*cell_hist[num];\n                }\n            }\n        }\n\n        //\u7279\u5fb4\u91cf\u306e\u6b63\u898f\u5316\n        num = (int)((pHOGFeatures[f].bY+pHOGFeatures[f].cY)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(pHOGFeatures[f].bX+pHOGFeatures[f].cX)*ORIENTATION+pHOGFeatures[f].ori);\n        if(sum_magnitude==0) pHOGFeatures[f].dVal=0;\n        else if(sum_magnitude!=0)pHOGFeatures[f].dVal = cell_hist[num] / sum_magnitude;\n    }\n\n    return (0);\n}\n\n//\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u3092\u7b97\u51fa\u3057\u3066 HOG \u7279\u5fb4\u91cf\u3092\u62bd\u51fa\nint HOG(HOG_FEATURE *pHOGFeatures){\n\n    int    i,j,k;\n    int    num;\n    double *cell_hist;\n\n    //\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u4fdd\u5b58\u3059\u308b\u9818\u57df\u3092\u78ba\u4fdd\n    num = (SET_Y_SIZE/CELL_SIZE)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION;\n    cell_hist = new double[num];\n\n    //0\u3092\u4ee3\u5165\u3057\u3066\u521d\u671f\u5316\n    for(j=0; j<(SET_Y_SIZE/CELL_SIZE); j++){\n        for(i=0; i<(SET_X_SIZE/CELL_SIZE); i++){\n            for(k=0; k<ORIENTATION; k++){\n                num = j*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+i*ORIENTATION+k;\n                cell_hist[num] = 0.0;\n            }\n        }\n    }\n\n    //\u52fe\u914d\u65b9\u5411\u3068\u52fe\u914d\u5f37\u5ea6\u304b\u3089\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u7b97\u51fa\n    CompHistogram(cell_hist);\n\n    //HOG \u7279\u5fb4\u91cf\u306e\u7b97\u51fa\n    CompHOG(pHOGFeatures, cell_hist);\n\n    //\u78ba\u4fdd\u3057\u3066\u3044\u305f\u9ad8\u7c73\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u9818\u57df\u3092\u89e3\u653e\n    delete []cell_hist;\n\n    return (0);\n}\n\n\nint main(int argc, char** argv){\n\n    int         nHOGFeatureNum;\n    HOG_FEATURE *pHOGFeatures;\n    char FileName[256];\n    char buffer[256];\n\n    //\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\n    if(NULL == (Img=cvLoadImage(argv[1], CV_LOAD_IMAGE_GRAYSCALE))){\n        printf(\"Can not open the file.\\n\");\n        return(1);\n    }\n\n    //\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u4e00\u5b9a\u306b\u3059\u308b\u305f\u3081\u306e\u69cb\u9020\u4f53\n    CvSize r_size = cvSize((int)SET_X_SIZE, (int)SET_Y_SIZE);\n    LowImg        = cvCreateImage(r_size, IPL_DEPTH_8U, 1);\n\n    //\u30d1\u30c3\u30c1\u30b5\u30a4\u30ba\u306b\u30ea\u30b5\u30a4\u30ba\n    cvResize(Img, LowImg, CV_INTER_LINEAR);\n\n    //\u3042\u3089\u304b\u3058\u3081\u7279\u5fb4\u91cf\u306e\u6570\u3092\u7b97\u51fa\n    nHOGFeatureNum = CountHOGFeature();\n    //\u6271\u3046\u7279\u5fb4\u91cf\u306e\u6570\u3060\u3051\u69cb\u9020\u4f53\u3092\u78ba\u4fdd\n    pHOGFeatures = new HOG_FEATURE[nHOGFeatureNum];\n    //HOG \u7279\u5fb4\u62bd\u51fa\n    HOG(pHOGFeatures);\n\n    sscanf(argv[1],\"%s.png\",buffer);\n    sprintf(FileName,\"%s.hog\",buffer);\n\n    //\u7279\u5fb4\u91cf\u306e\u66f8\u304d\u51fa\u3057\n    OutputHOGFeature(nHOGFeatureNum, pHOGFeatures, FileName);\n\n    //\u753b\u50cf\u306e\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u308b\u69cb\u9020\u4f53\u3092\u89e3\u653e\n    cvReleaseImage(&LowImg);\n    cvReleaseImage(&Img);\n\n    //\u7279\u5fb4\u91cf\u306e\u69cb\u9020\u4f53\u3092\u89e3\u653e\n    delete []pHOGFeatures;\n\n    return (0);\n}\n\n\n\u3068\u307e\u3042\u3060\u3089\u301c\u3063\u3068\u66f8\u3044\u3066\u307e\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u3092\u4f7f\u3048\u3070\u7279\u5fb4\u62bd\u51fa\u304c\u3067\u304d\u307e\u3059\u3002\u3042\u3068\u306f\u8907\u6570\u753b\u50cf\u306b\u5bfe\u3057\u3066\u540c\u69d8\u306b\u62bd\u51fa\u3057\u3066\u3044\u304d\u3001\u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\u306a\u3069\u3092\u7528\u3044\u3066\u985e\u4f3c\u5ea6\u306e\u6bd4\u8f03\u3084\u3001\u52d5\u4f53\u691c\u51fa\u306a\u3093\u304b\u306b\u5229\u7528\u3057\u3066\u3044\u3051\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u304a\u308f\u308a\u306b\n\u4eca\u56de\u306f\u3042\u308b\u753b\u50cf\u304b\u3089HOG\u7279\u5fb4\u91cf\u306e\u62bd\u51fa\u6cd5\u306b\u3064\u3044\u3066\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002Python\u3067\u3082OpenCV\u4f7f\u3048\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u305d\u3063\u3061\u4f7f\u3063\u3066\u3082\u9762\u767d\u3044\u304b\u3082\u3002\n## \u306f\u3058\u3081\u306b\n[Qiita Advent Calendar 2015](http://qiita.com/advent-calendar/2015)\u3063\u3066\u306e\u3092\u6700\u8fd1\u77e5\u3063\u3066\u3001\u66f8\u304d\u305f\u3044\u306a\u3042\u3063\u3066\u601d\u3063\u305f\u3051\u3069\u305d\u3082\u305d\u3082Qiita\u6295\u7a3f\u3057\u305f\u3053\u3068\u306d\u3048\u308f\u3063\u3066\u306a\u3063\u305f\u306e\u3067\u3001\u307e\u305a\u306f\u521d\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u6765\u5e74\u306fAdvent Calendar\u66f8\u304d\u305f\u3044\uff01\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u5185\u5bb9\u306f\u753b\u50cf\u51e6\u7406\u7cfb\u306e\u8a71\u3067\u3059\u3002\n\u753b\u50cf\u51e6\u7406\u3084\u3063\u3066\u308b\u3068\u3001\u753b\u50cf\u304b\u3089\u4eba\u691c\u51fa\u3084\u52d5\u4f53\u691c\u51fa\u3092\u3059\u308b\u306e\u3063\u3066\u5272\u3068\u8ab0\u3067\u3082\u3084\u308a\u307e\u3059\u3088\u306d\u3002\n\u305d\u306e\u306a\u304b\u3067\u691c\u51fa\u7cbe\u5ea6\u3092\u9ad8\u3081\u308b\u306b\u306f\u7279\u5fb4\u91cf\u306e\u9078\u5b9a\u304c\u91cd\u8981\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u4eca\u56de\u306fHOG\u7279\u5fb4\u91cf\u3092\u5b9f\u969b\u306b\u62bd\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n### \u3061\u306a\u307f\u306b\n\u4eca\u56de\u306f\u753b\u50cf\u306e\u985e\u4f3c\u5ea6\u306e\u7cbe\u5ea6\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3057\u307e\u3057\u305f\u3002\n\u3042\u304f\u307e\u3067\u7279\u5fb4\u91cf\u306e\u62bd\u51fa\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3092\u30ab\u30d0\u30fc\u3057\u3066\u3044\u307e\u3059\u3002\n\n\n## HOG\u7279\u5fb4\u91cf\u3068\u306f\n\u305d\u3082\u305d\u3082HOG\u7279\u5fb4\u91cf\u3063\u3066\u306a\u3093\u3084\u306d\u3093\uff01\u3063\u3066\u65b9\u3082\u591a\u3044\u3068\u601d\u3046\u306e\u3067\u3001\u307e\u305a\u306f\u8aac\u660e\u3092\u3002\n\nHOG(Histograms of Oriented Gradients)\u3068\u306f\u5c40\u6240\u9818\u57df (\u30bb\u30eb) \u306e\u8f1d\u5ea6\u306e\u52fe\u914d\u65b9\u5411\u3092\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u5316\u3057\u305f\u3082\u306e\u3067\u3059\u3002\n\u30e1\u30ea\u30c3\u30c8\u3068\u3057\u3066\u306f\u3001\u52fe\u914d\u60c5\u5831\u3092\u3082\u3068\u306b\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u7570\u306a\u308b\u30b5\u30a4\u30ba\u306e\u753b\u50cf\u3092\u5bfe\u8c61\u3068\u3059\u308b\u969b\u3082\u540c\u3058\u30b5\u30a4\u30ba\u306b\u30ea\u30b5\u30a4\u30ba\u3059\u308b\u3053\u3068\u3067\u6bd4\u8f03\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\n### HOG\u7279\u5fb4\u91cf\u3092\u5f97\u308b\u305f\u3081\u306e\u30d7\u30ed\u30bb\u30b9\nHOG\u7279\u5fb4\u91cf\u3092\u5f97\u308b\u305f\u3081\u306e\u30d7\u30ed\u30bb\u30b9\u306f\u4ee5\u4e0b\u306e\u3068\u304a\u308a\u306b\u306a\u308a\u307e\u3059\u3002\n\n1. \u3042\u308b\u753b\u50cf\u306b\u3064\u3044\u3066\u9069\u5f53\u306a\u30b5\u30a4\u30ba[pixel]\u306b\u30ea\u30b5\u30a4\u30ba\u3057\u3001\u30b0\u30ec\u30a4\u30b9\u30b1\u30fc\u30eb\u3067\u8aad\u307f\u8fbc\u3080\u3002\n2. \u5404pixel\u306e\u8f1d\u5ea6\u304b\u3089\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u3092\u6c42\u3081\u308b\u3002\n3. \u30bb\u30eb\u9818\u57df\u3054\u3068\u306b\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u6c42\u3081\u308b(\u4eca\u56de\u306f5\u00d75[pixel])\u3002\n4. \u30d6\u30ed\u30c3\u30af(3\u00d73[\u30bb\u30eb])\u3054\u3068\u306b\u6b63\u898f\u5316\u3057\u3001\u7279\u5fb4\u91cf\u3092\u62bd\u51fa\u3059\u308b\u3002\n\n\n\n### \u753b\u50cf,\u30bb\u30eb,\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u95a2\u4fc2\n\u753b\u50cf\u3084\u30bb\u30eb,\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba\u306e\u95a2\u4fc2\u3092\u4ee5\u4e0b\u306b\u793a\u3057\u307e\u3059\u3002\n\n![size.png](https://qiita-image-store.s3.amazonaws.com/0/95807/d665c07b-50f8-7e4f-e4c7-2d771acf2fd9.png \"size.png\")\n\n### HOG\u7279\u5fb4\u91cf\u306e\u8a08\u7b97\u5f0f\n\u7279\u5fb4\u91cf\u306e\u6b21\u5143\u6570\u3092\u6c42\u3081\u308b\u305f\u3081\u306e\u5f0f\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\n![Tex2Img_1450808428.jpg](https://qiita-image-store.s3.amazonaws.com/0/95807/658206e2-d85e-a813-8b07-58a9ae16b4b6.jpeg)\n\nOrientation\u306f\u7279\u5fb4\u306e\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u4f7f\u7528\u3059\u308b\u52fe\u914d\u65b9\u5411\u306e\u91cf\u5b50\u5316\u6570\u306e\u3053\u3068\u3092\u6307\u3057\u307e\u3059\u3002\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u306f\u6b21\u306e\u5f0f\u3067\u6c42\u3081\u307e\u3059\u3002\n\n![Tex2Img_1450808513.jpg](https://qiita-image-store.s3.amazonaws.com/0/95807/01d9f701-8661-b7ba-ffa1-80c95fe8afff.jpeg)\n\n\n## \u5b9f\u88c5\u7de8\n\u3068\u3044\u3046\u308f\u3051\u3067\u4e0a\u8a18\u306e\u5f0f\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u4eca\u56de\u306fC++\u3068\u753b\u50cf\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u3057\u3066OpenCV\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```hog.cpp\n#include <iostream>\n#include <string>\n#include <fstream>\n#include <vector>\n#include \"opencv_lib.h\"\n\n\n#include <opencv/cv.h>\n#include <opencv2/core/core.hpp>\n#include <opencv2/highgui/highgui.hpp>\n#include <opencv2/imgproc/imgproc.hpp>\n\ntypedef struct _HOG_FEATURE{\n\tint bX;\t\t\t\t//\u30d6\u30ed\u30c3\u30af\u9818\u57df\u306e\u5de6\u4e0a\u306e x \u5ea7\u6a19\n\tint bY;\t\t\t\t//\u30d6\u30ed\u30c3\u30af\u9818\u57df\u306e\u5de6\u4e0a\u306e y \u5ea7\u6a19\n\tint cX;\t\t\t\t//\u30bb\u30eb\u9818\u57df\u306e\u5de6\u4e0a\u306e x \u5ea7\u6a19\n\tint cY;\t\t\t\t//\u30bb\u30eb\u9818\u57df\u306e\u5de6\u4e0a\u306e y \u5ea7\u6a19\n\tint ori;\t//\u52fe\u914d\u306e\u65b9\u5411\n\tdouble dVal;\t\t//\u7279\u5fb4\u91cf\n}HOG_FEATURE;\n\nIplImage* Img;\t\t\t\t//\u5165\u529b\u753b\u50cf\nIplImage* LowImg;\t\t\t//\u30ea\u30b5\u30a4\u30ba\u5f8c\u306e\u5165\u529b\u753b\u50cf\t\n#define CELL_SIZE   5\t\t//\u30bb\u30eb\u30b5\u30a4\u30ba (pixel)\n#define BLOCK_SIZE\t3\t\t//\u30d6\u30ed\u30c3\u30af\u30b5\u30a4\u30ba (\u30bb\u30eb)\n#define SET_Y_SIZE\t40\t\t//\u30d1\u30c3\u30c1\u306e\u7e26\u5e45 (pixel)\n#define SET_X_SIZE\t30\t\t//\u30d1\u30c3\u30c1\u306e\u6a2a\u5e45 (pixel)\n\n#define ORIENTATION\t9\t\t//\u52fe\u914d\u65b9\u5411\n\n#define PI\t\t\t3.14\n#define LN_E\t\t1.0\n\n\n//HOG \u7279\u5fb4\u91cf\u306e\u66f8\u304d\u51fa\u3057\nint OutputHOGFeature(int nFeatureNum, HOG_FEATURE *pHOGFeatures, char* File){\n\n\tFILE *fp;\n\tint\t i;\n\n\tif(NULL == (fp=fopen(File, \"w\"))){\n\t\tprintf(\"Can not open the outfile.\\n\");\n\t\treturn(1);\t\n\t}\n\n\tfor(i=0; i<nFeatureNum; i++){\n\t\tfprintf(fp, \"%lf\\n\", pHOGFeatures[i].dVal);\n\t}\n\n\tfclose(fp);\n\n\treturn(0);\n}\n\n\n//\u914d\u5217\u78ba\u4fdd\u306e\u305f\u3081\u306b\u3042\u3089\u304b\u3058\u3081\u7279\u5fb4\u91cf\u306e\u6570\u3092\u7b97\u51fa\nint CountHOGFeature(){\n\n\tint i,j,k,x,y;\n\tint fCount = 0;\t\t//\u7279\u5fb4\u91cf\u306e\u6570\n\n\t//\u30d6\u30ed\u30c3\u30af\u306e\u79fb\u52d5\n\tfor(y=0; y<((SET_Y_SIZE/CELL_SIZE)-BLOCK_SIZE+1); y++){\n\t\tfor(x=0; x<((SET_X_SIZE/CELL_SIZE)-BLOCK_SIZE+1); x++){\t\t\n\t\t\t//\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n\t\t\tfor(j=0; j<BLOCK_SIZE; j++){\n\t\t\t\tfor(i=0; i<BLOCK_SIZE; i++){\n\t\t\t\t\t//\u52fe\u914d\u65b9\u5411\u6570\n\t\t\t\t\tfor(k=0; k<ORIENTATION; k++){\n\t\t\t\t\t\t//\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n\t\t\t\t\t\tfCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn (fCount);\n}\n\n//\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u7b97\u51fa\nint CompHistogram(double cell_hist[]){\n\n\tint x,y;\n\tint num1,num2;\t\t//\u914d\u5217\u306e\u8981\u7d20\u6570\u306e\u8a08\u7b97\n\n\tint xDelta,yDelta;\t\t\t//\u5404\u65b9\u5411\u306e\u8f1d\u5ea6\u306e\u5dee\u5206\n\tdouble magnitude;\t\t\t//\u52fe\u914d\u5f37\u5ea6\n\n\tdouble angle = 180.0/(double)ORIENTATION;\t//\u91cf\u5b50\u5316\u3059\u308b\u6642\u306e\u89d2\u5ea6\n\tdouble gradient;\n\n\t//\u753b\u50cf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u69cb\u9020\u4f53\u304b\u3089\u8f1d\u5ea6\u5024\u3060\u3051\u30b3\u30d4\u30fc\n\tunsigned char* imgSource = (unsigned char*)LowImg->imageData;\n\t//\u753b\u50cf\u3092\u683c\u7d0d\u3057\u3066\u3044\u308b\u69cb\u9020\u4f53\u306e\u6c34\u5e73\u65b9\u5411\u306e\u30c7\u30fc\u30bf\u6570\n\tint\twStep = LowImg->widthStep;\n\t//1\u30d4\u30af\u30bb\u30eb\u3042\u305f\u308a\u306e\u30d3\u30c3\u30c8\u6570\n\tint\tbpp   = ((LowImg->depth&255)/8)*LowImg->nChannels;\n\n\t//\u30d1\u30c3\u30c1\u5185\u306e\u79fb\u52d5\n\tfor(y=0; y<SET_Y_SIZE; y++){\n\t\tfor(x=0; x<SET_X_SIZE; x++){\n\n\t\t\t//\u6a2a\u65b9\u5411\u306e\u5dee\u5206\n\t\t\tif(x == 0){\n\t\t\t\tnum1 = y*wStep+(x+0)*bpp;\n\t\t\t\tnum2 = y*wStep+(x+1)*bpp;\n\t\t\t\txDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}else if(x == LowImg->width-1){\n\t\t\t\tnum1 = y*wStep+(x-1)*bpp;\n\t\t\t\tnum2 = y*wStep+(x+0)*bpp;\n\t\t\t\txDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}else{\n\t\t\t\tnum1 = y*wStep+(x-1)*bpp;\n\t\t\t\tnum2 = y*wStep+(x+1)*bpp;\n\t\t\t\txDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}\n\t\t\t\n\t\t\t//\u7e26\u65b9\u5411\u306e\u5dee\u5206\n\t\t\tif(y == 0){\n\t\t\t\tnum1 = (y+0)*wStep+x*bpp;\n\t\t\t\tnum2 = (y+1)*wStep+x*bpp;\n\t\t\t\tyDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}else if(y == LowImg->height-1){\n\t\t\t\tnum1 = (y-1)*wStep+x*bpp;\n\t\t\t\tnum2 = (y+0)*wStep+x*bpp;\n\t\t\t\tyDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}else{\n\t\t\t\tnum1 = (y-1)*wStep+x*bpp;\n\t\t\t\tnum2 = (y+1)*wStep+x*bpp;\n\t\t\t\tyDelta = imgSource[num1]-imgSource[num2];\n\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t//\u52fe\u914d\u5f37\u5ea6\u306e\u7b97\u51fa\n\t\t\tmagnitude = sqrt((double)xDelta*(double)xDelta+(double)yDelta*(double)yDelta);\n\t\t\t\n\t\t\t//\u52fe\u914d\u65b9\u5411\u306e\u7b97\u51fa\n\t\t\tgradient = atan2((double)yDelta, (double)xDelta);\n\t\t\t//\u30e9\u30b8\u30a2\u30f3\u304b\u3089\u89d2\u5ea6\u3078\u5909\u63db\n\t\t\tgradient = (gradient*180.0)/PI;\n\t\t\t//\u7b26\u53f7\u304c\u8ca0\u3067\u3042\u308b\u5834\u5408\u306f\u53cd\u8ee2\n\t\t\tif(gradient < 0.0){\n\t\t\t\tgradient += 360.0;\n\t\t\t}\n\t\t\t//0~360\u5ea6\u304b\u3089 0~180\u5ea6\u306b\u5909\u63db\n\t\t\tif(gradient > 180.0){\n\t\t\t\tgradient -= 180.0;\n\t\t\t}\n\t\t\t//20\u5ea6\u305a\u3064,9\u5206\u5272\n\t\t\tgradient = gradient/angle;\n\t\t\t\t\t\t\t\t\t\n\t\t\t//\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306b\u84c4\u7a4d\n\t\t\tnum1 = (int)((y/CELL_SIZE)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(x/CELL_SIZE)*ORIENTATION+(int)gradient);\n\t\t\tcell_hist[num1] += magnitude;\n\t\t}\n\t}\n\treturn(0);\n}\n\n//HOG \u7279\u5fb4\u91cf\u306e\u7b97\u51fa\u3068\u6b63\u898f\u5316\nint CompHOG(HOG_FEATURE *pHOGFeatures, double cell_hist[]){\n\n\tint\tx,y,i,j,k,f;\n\tint num;\t\t\t\t//\u914d\u5217\u306e\u8981\u7d20\u6570\u306e\u8a08\u7b97\n\n\tdouble sum_magnitude;\t//\u30d6\u30ed\u30c3\u30af\u9818\u57df\u5185\u306e\n\tint    fCount = 0;\t\t//\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n\n\t//\u7279\u5fb4\u91cf\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u7b97\u51fa\n\t//\u30d6\u30ed\u30c3\u30af\u306e\u79fb\u52d5\n\tfor(y=0; y<((SET_Y_SIZE/CELL_SIZE)-BLOCK_SIZE+1); y++){\n\t\tfor(x=0; x<((SET_X_SIZE/CELL_SIZE)-BLOCK_SIZE+1); x++){\t\n\t\t\t//\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n\t\t\tfor(j=0; j<BLOCK_SIZE; j++){\n\t\t\t\tfor(i=0; i<BLOCK_SIZE; i++){\n\t\t\t\t\t//\u52fe\u914d\u65b9\u5411\u00b8\n\t\t\t\t\tfor(k=0; k<ORIENTATION; k++){\n\t\t\t\t\t\t//\u7279\u5fb4\u91cf\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\n\t\t\t\t\t\tpHOGFeatures[fCount].bX = x;\n\t\t\t\t\t\tpHOGFeatures[fCount].bY = y;\n\t\t\t\t\t\tpHOGFeatures[fCount].cX = i;\n\t\t\t\t\t\tpHOGFeatures[fCount].cY = j;\n\t\t\t\t\t\tpHOGFeatures[fCount].ori = k;\n\t\t\t\t\t\t\n\t\t\t\t\t\t//\u7279\u5fb4\u91cf\u6570\u306e\u30ab\u30a6\u30f3\u30c8\n\t\t\t\t\t\tfCount++;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t//\u7279\u5fb4\u91cf\u306e\u7b97\u51fa\u3068\u6b63\u898f\u5316\n\tfor(f=0; f<fCount; f++){\n\t\t//\u7279\u5fb4\u91cf\u91cf\u3092\u6b63\u898f\u5316\u3059\u308b\u6642\u306b\u4f7f\u7528\u3059\u308b\u7279\u5fb4\u91cf\u306e\u4e8c\u4e57\u548c\u3092\u6b63\u898f\u5316\n\t\tsum_magnitude = 0.0;\n\t\t//\u30bb\u30eb\u5185\u306e\u79fb\u52d5\n\t\tfor(j=0; j<BLOCK_SIZE; j++){\n\t\t\tfor(i=0; i<BLOCK_SIZE; i++){\n\t\n\t\t\t\t//\u52fe\u914d\u65b9\u5411\n\t\t\t\tfor(k=0; k<ORIENTATION; k++){\n\t\t\t\t\t//\u6b63\u898f\u5316\u306e\u305f\u3081\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u7dcf\u548c\u306e\u4e8c\u4e57\u3092\u7b97\u51fa\n\t\t\t\t\tnum = (int)((pHOGFeatures[f].bY+j)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(pHOGFeatures[f].bX+i)*ORIENTATION+k);\n\t\t\t\t\tsum_magnitude += cell_hist[num]*cell_hist[num];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t//\u7279\u5fb4\u91cf\u306e\u6b63\u898f\u5316\n\t\tnum = (int)((pHOGFeatures[f].bY+pHOGFeatures[f].cY)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+(pHOGFeatures[f].bX+pHOGFeatures[f].cX)*ORIENTATION+pHOGFeatures[f].ori);\n\t\tif(sum_magnitude==0) pHOGFeatures[f].dVal=0;\n\t\telse if(sum_magnitude!=0)pHOGFeatures[f].dVal = cell_hist[num] / sum_magnitude;\n\t}\n\n\treturn (0);\n}\n\n//\u52fe\u914d\u5f37\u5ea6\u3068\u52fe\u914d\u65b9\u5411\u3092\u7b97\u51fa\u3057\u3066 HOG \u7279\u5fb4\u91cf\u3092\u62bd\u51fa\nint HOG(HOG_FEATURE *pHOGFeatures){\n\n\tint    i,j,k;\n\tint\t   num;\n\tdouble *cell_hist;\n\n\t//\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u4fdd\u5b58\u3059\u308b\u9818\u57df\u3092\u78ba\u4fdd\n\tnum = (SET_Y_SIZE/CELL_SIZE)*(SET_X_SIZE/CELL_SIZE)*ORIENTATION;\n\tcell_hist = new double[num];\n\n\t//0\u3092\u4ee3\u5165\u3057\u3066\u521d\u671f\u5316\n\tfor(j=0; j<(SET_Y_SIZE/CELL_SIZE); j++){\n\t\tfor(i=0; i<(SET_X_SIZE/CELL_SIZE); i++){\n\t\t\tfor(k=0; k<ORIENTATION; k++){\n\t\t\t\tnum = j*(SET_X_SIZE/CELL_SIZE)*ORIENTATION+i*ORIENTATION+k;\n\t\t\t\tcell_hist[num] = 0.0;\n\t\t\t}\n\t\t}\n\t}\n\n\t//\u52fe\u914d\u65b9\u5411\u3068\u52fe\u914d\u5f37\u5ea6\u304b\u3089\u52fe\u914d\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u7b97\u51fa\n\tCompHistogram(cell_hist);\n\n\t//HOG \u7279\u5fb4\u91cf\u306e\u7b97\u51fa\n\tCompHOG(pHOGFeatures, cell_hist);\n\n\t//\u78ba\u4fdd\u3057\u3066\u3044\u305f\u9ad8\u7c73\u65b9\u5411\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u9818\u57df\u3092\u89e3\u653e\n\tdelete []cell_hist;\n\n\treturn (0);\n}\n\n\nint main(int argc, char** argv){\n\t\n\tint \t\tnHOGFeatureNum;\n\tHOG_FEATURE\t*pHOGFeatures;\n\tchar FileName[256];\n    char buffer[256];\n\n\t//\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\n\tif(NULL == (Img=cvLoadImage(argv[1], CV_LOAD_IMAGE_GRAYSCALE))){\n\t\tprintf(\"Can not open the file.\\n\");\n\t\treturn(1);\n\t}\n\n\t//\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u4e00\u5b9a\u306b\u3059\u308b\u305f\u3081\u306e\u69cb\u9020\u4f53\n\tCvSize r_size = cvSize((int)SET_X_SIZE, (int)SET_Y_SIZE);\n\tLowImg        = cvCreateImage(r_size, IPL_DEPTH_8U, 1);\n\n\t//\u30d1\u30c3\u30c1\u30b5\u30a4\u30ba\u306b\u30ea\u30b5\u30a4\u30ba\n\tcvResize(Img, LowImg, CV_INTER_LINEAR);\n\n\t//\u3042\u3089\u304b\u3058\u3081\u7279\u5fb4\u91cf\u306e\u6570\u3092\u7b97\u51fa\n\tnHOGFeatureNum = CountHOGFeature();\n\t//\u6271\u3046\u7279\u5fb4\u91cf\u306e\u6570\u3060\u3051\u69cb\u9020\u4f53\u3092\u78ba\u4fdd\n\tpHOGFeatures = new HOG_FEATURE[nHOGFeatureNum];\n\t//HOG \u7279\u5fb4\u62bd\u51fa\n\tHOG(pHOGFeatures);\n\n\tsscanf(argv[1],\"%s.png\",buffer);\n    sprintf(FileName,\"%s.hog\",buffer);\n\n\t//\u7279\u5fb4\u91cf\u306e\u66f8\u304d\u51fa\u3057\n\tOutputHOGFeature(nHOGFeatureNum, pHOGFeatures, FileName);\n\n\t//\u753b\u50cf\u306e\u30c7\u30fc\u30bf\u304c\u5165\u3063\u3066\u3044\u308b\u69cb\u9020\u4f53\u3092\u89e3\u653e\n\tcvReleaseImage(&LowImg);\n\tcvReleaseImage(&Img);\n\n\t//\u7279\u5fb4\u91cf\u306e\u69cb\u9020\u4f53\u3092\u89e3\u653e\n\tdelete []pHOGFeatures;\n\n\treturn (0);\n}\n```\n\n\u3068\u307e\u3042\u3060\u3089\u301c\u3063\u3068\u66f8\u3044\u3066\u307e\u3059\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u3053\u308c\u3092\u4f7f\u3048\u3070\u7279\u5fb4\u62bd\u51fa\u304c\u3067\u304d\u307e\u3059\u3002\u3042\u3068\u306f\u8907\u6570\u753b\u50cf\u306b\u5bfe\u3057\u3066\u540c\u69d8\u306b\u62bd\u51fa\u3057\u3066\u3044\u304d\u3001\u30de\u30f3\u30cf\u30c3\u30bf\u30f3\u8ddd\u96e2\u306a\u3069\u3092\u7528\u3044\u3066\u985e\u4f3c\u5ea6\u306e\u6bd4\u8f03\u3084\u3001\u52d5\u4f53\u691c\u51fa\u306a\u3093\u304b\u306b\u5229\u7528\u3057\u3066\u3044\u3051\u3070\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## \u304a\u308f\u308a\u306b\n\u4eca\u56de\u306f\u3042\u308b\u753b\u50cf\u304b\u3089HOG\u7279\u5fb4\u91cf\u306e\u62bd\u51fa\u6cd5\u306b\u3064\u3044\u3066\u5b9f\u88c5\u3057\u307e\u3057\u305f\u3002Python\u3067\u3082OpenCV\u4f7f\u3048\u308b\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u305d\u3063\u3061\u4f7f\u3063\u3066\u3082\u9762\u767d\u3044\u304b\u3082\u3002\n", "tags": ["C++", "OpenCV", "\u521d\u5fc3\u8005", "\u753b\u50cf\u51e6\u7406"]}