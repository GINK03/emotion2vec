{"context": "\n\u57fa\u672c\u306fsvnadmin\u306edump&load\nsvndumpfilter\u3067\u30c0\u30f3\u30d7\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u7d5e\u308a\u8fbc\u307f\nsed\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u66f8\u304d\u63db\u3048\n\n\u66f8\u304d\u63db\u3048\u5f8c\u306e\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f'svn mkdir'\u3059\u308b\u305f\u3081\u30b3\u30d4\u30fc\u5148\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u3042\u308b\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u3002\n\nrepocopy.sh\n#!/bin/sh\nexport LANG=\nexport LC_ALL=\nexport LC_CTYPE=\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5834\u6240\nSVN_ROOT=/usr/local/svn\n\n# svndumpfilter\u306e\u30aa\u30d7\u30b7\u30e7\u30f3(\u9069\u5b9c\u8abf\u6574\u3059\u308b\u3053\u3068)\nFILTER_OPT=\"--drop-empty-revs --renumber-revs\"\n\nif [ $# -ne 4 -a $# -ne 5 ]; then\n echo 'Usage: $0 <user name> <src repo> <src dir> <dst repo> [dst dir]'\n echo ''\n echo '<user name>\u306f<dst repo>\u306e\u66f8\u304d\u8fbc\u307f\u53ef\u80fd\u306a\u30a2\u30ab\u30a6\u30f3\u30c8'\n echo '<src repo>\u5185\u306e[src dir]\u3092<dst repo>\u306b\u30b3\u30d4\u30fc'\n echo '[dst dir]\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306f[src dir]\u3092\u30ea\u30cd\u30fc\u30e0'\n echo ''\n echo '\u203bsrc dir/dst dir \u5171\u306b\"#\"\u3092\u542b\u3080\u30d1\u30b9\u306f\u4e0d\u53ef'\n echo ''\n exit 1\nfi\n\nusername=$1\nsrc_repo=$2\nsrc_dir=$3\ndst_repo=$4\nif [ $# -ne 5 ]; then\n dst_dir=$src_dir\nelse\n dst_dir=$5\nfi\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\nsvnadmin lslocks $SVN_ROOT/$src_repo > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n echo \"\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093($src_repo)\"\n exit 2\nfi\nsvnadmin lslocks $SVN_ROOT/$dst_repo > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n echo \"\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093($dst_repo)\"\n exit 3\nfi\n\n# \u30b3\u30d4\u30fc\u5148\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\ndst_base=`dirname $dst_dir`\nif [ \"$dst_base\" != \"\" ]; then\n svn mkdir --parents -m \"create base directory\" --username $username svn://localhost/$dst_repo/$dst_base\nfi\n\n# dump -> filter -> change path -> load\nsvnadmin dump $SVN_ROOT/$src_repo | svndumpfilter include $FILTER_OPT \"$src_dir\" | sed -e \"s#Node-path: $src_dir#Node-path: $dst_dir#\" | svnadmin load $SVN_ROOT/$dst_repo\n\n\n- \u57fa\u672c\u306fsvnadmin\u306edump&load\n- svndumpfilter\u3067\u30c0\u30f3\u30d7\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u7d5e\u308a\u8fbc\u307f\n- sed\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u66f8\u304d\u63db\u3048\n\n\u66f8\u304d\u63db\u3048\u5f8c\u306e\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f'svn mkdir'\u3059\u308b\u305f\u3081\u30b3\u30d4\u30fc\u5148\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u304c\u3042\u308b\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5fc5\u8981\u3002\n\n```sh:repocopy.sh\n#!/bin/sh\nexport LANG=\nexport LC_ALL=\nexport LC_CTYPE=\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5834\u6240\nSVN_ROOT=/usr/local/svn\n\n# svndumpfilter\u306e\u30aa\u30d7\u30b7\u30e7\u30f3(\u9069\u5b9c\u8abf\u6574\u3059\u308b\u3053\u3068)\nFILTER_OPT=\"--drop-empty-revs --renumber-revs\"\n\nif [ $# -ne 4 -a $# -ne 5 ]; then\n echo 'Usage: $0 <user name> <src repo> <src dir> <dst repo> [dst dir]'\n echo ''\n echo '<user name>\u306f<dst repo>\u306e\u66f8\u304d\u8fbc\u307f\u53ef\u80fd\u306a\u30a2\u30ab\u30a6\u30f3\u30c8'\n echo '<src repo>\u5185\u306e[src dir]\u3092<dst repo>\u306b\u30b3\u30d4\u30fc'\n echo '[dst dir]\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306f[src dir]\u3092\u30ea\u30cd\u30fc\u30e0'\n echo ''\n echo '\u203bsrc dir/dst dir \u5171\u306b\"#\"\u3092\u542b\u3080\u30d1\u30b9\u306f\u4e0d\u53ef'\n echo ''\n exit 1\nfi\n\nusername=$1\nsrc_repo=$2\nsrc_dir=$3\ndst_repo=$4\nif [ $# -ne 5 ]; then\n dst_dir=$src_dir\nelse\n dst_dir=$5\nfi\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u5b58\u5728\u30c1\u30a7\u30c3\u30af\nsvnadmin lslocks $SVN_ROOT/$src_repo > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n echo \"\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093($src_repo)\"\n exit 2\nfi\nsvnadmin lslocks $SVN_ROOT/$dst_repo > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n echo \"\u30ea\u30dd\u30b8\u30c8\u30ea\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093($dst_repo)\"\n exit 3\nfi\n\n# \u30b3\u30d4\u30fc\u5148\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u89aa\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\ndst_base=`dirname $dst_dir`\nif [ \"$dst_base\" != \"\" ]; then\n svn mkdir --parents -m \"create base directory\" --username $username svn://localhost/$dst_repo/$dst_base\nfi\n\n# dump -> filter -> change path -> load\nsvnadmin dump $SVN_ROOT/$src_repo | svndumpfilter include $FILTER_OPT \"$src_dir\" | sed -e \"s#Node-path: $src_dir#Node-path: $dst_dir#\" | svnadmin load $SVN_ROOT/$dst_repo\n```\n", "tags": ["Subversion"]}