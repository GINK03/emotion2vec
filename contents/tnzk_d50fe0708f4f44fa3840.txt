{"context": "\u793e\u5185\u5411\u3051\u306b Kubernetes \u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3068\u3057\u3066\u66f8\u3044\u305f\u8a18\u4e8b\u30022016\u5e743\u6708\u306b\u66f8\u3044\u305f\u3082\u306e\u306a\u306e\u3067 ReplicaSet \u4f7f\u3063\u3066\u306a\u304b\u3063\u305f\u308a\u3068\u3061\u3087\u3063\u3068\u53e4\u3044\u90e8\u5206\u3042\u308a\u307e\u3059\u3002\n\n\u3084\u308b\u3053\u3068\nHTTP2 \u30b5\u30fc\u30d0\u306e\u5b9f\u88c5\u3067\u3042\u308b H2O \u3092 Google Container Engine (\u4ee5\u4e0b GKE)\u4e0a\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5c55\u958b\u3057\u3001\u4f55\u3089\u304b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u914d\u4fe1\u3059\u308b\u3002 JSON \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u914d\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u672a\u5b9f\u88c5\u306e\u4f55\u3089\u304b\u306e API \u306e\u30e2\u30c3\u30af\u3068\u3057\u3066\u4f7f\u3048\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\nGKE \u3068 Kubenetes \u306e\u57fa\u672c\u7684\u306a\u6982\u5ff5\nGKE \u306f Google Cloud Platform \u4e0a\u3067\u30de\u30cd\u30fc\u30b8\u30c9\u306a Kubenetes \u30af\u30e9\u30b9\u30bf\u3092\u63d0\u4f9b\u3059\u308b\u3002\nKubernetes (\"helmsman\" \u3084 \"pilot\" \u3092\u610f\u5473\u3059\u308b\u30ae\u30ea\u30b7\u30a2\u8a9e\u3002\u300c\u30af\u30fc\u30d9\u30eb\u30cd\u30a4\u30c6\u30b9\u300d)\u306f\n\u3001 Google \u304c\u958b\u767a\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u30de\u30cd\u30fc\u30b8\u30e3\u3002 Docker \u306a\u3069\u306b\u3088\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3057\u3001\u305d\u308c\u305e\u308c\u306e\u3084\u308a\u3068\u308a\u3092\u8abf\u6574\u3059\u308b orchestration \u3068\u3044\u3046\u5f79\u5272\u3092\u62c5\u3046\u3002\nDocker \u30b3\u30f3\u30c6\u30ca\u306e orchestration \u30c4\u30fc\u30eb\u306b\u306f Docker Swarm \u3082\u5b58\u5728\u3059\u308b\u304c\u3001 Kubernetes \u306f Docker \u30b3\u30f3\u30c6\u30ca\u4ee5\u5916\u306e\u30e9\u30f3\u30bf\u30a4\u30e0\u3082\u5bfe\u8c61\u306b\u3057\u3066\u3044\u308b\u70b9\u3067\u9055\u3044\u304c\u3042\u308b(\u73fe\u6642\u70b9\u3067\u306f Docker \u304c\u3082\u3063\u3068\u3082\u4e00\u822c\u7684\u306a\u9078\u629e\u80a2\u3067\u3042\u308b\u3068\u3082\u8a8d\u8b58\u3057\u3066\u3044\u308b\u3088\u3046\u3060)\u3002\nKubernetes \u3067\u306f\u3001\u30c7\u30d7\u30ed\u30a4\u53ef\u80fd\u306a\u6700\u5c0f\u5358\u4f4d\u3092 pod \u3068\u547c\u3076\u3002 Pod \u306f\u3001\u3072\u3068\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30b0\u30eb\u30fc\u30d7\u3067\u3001\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u7269\u7406\u7684\u306b\u914d\u7f6e\u3055\u308c\u305f\u308a\u3001\u5171\u6709\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3002 Pod \u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\"\u8ad6\u7406\u7684\u30db\u30b9\u30c8\"\u3092\u30e2\u30c7\u30eb\u5316\u3057\u305f\u3082\u306e\u3067\u3082\u3042\u308a\u3001\u6bd4\u8f03\u7684\u5bc6\u306b\u7d50\u5408\u3057\u305f\u3072\u3068\u3064\u4ee5\u4e0a\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u3092\u542b\u3093\u3067\u3044\u308b\u3002 Pod \u306f\u9be8\u306a\u3069\u306e(\u4e3b\u306b\u6d77\u6d0b\u751f\u7269\u306e\uff1f)\u7fa4\u308c\u3092\u610f\u5473\u3059\u308b\u3002\n\u540c\u3058\u30a2\u30d7\u30ea\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8907\u6570\u7acb\u3061\u4e0a\u3052\u3066\u8ca0\u8377\u5206\u6563\u3092\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u304c\u3042\u308b\u3002\u3053\u306e\u5834\u5408\u306b\u306f\u3001\u540c\u3058\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u8d77\u52d5\u3057\u305f\u8907\u6570\u306e pod \u3092\u7d71\u62ec\u3057\u3001\u3042\u308b\u77ac\u9593\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308b pod \u3092\u4e00\u5b9a\u306b\u4fdd\u3063\u305f\u308a\u3001\u305d\u306e\u6570\u3092\u5897\u6e1b\uff08\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\uff09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u306e\u5f79\u5272\u3092 Replication controllers (\u4ee5\u4e0b RC)\u304c\u62c5\u3046\u3002\nPod \u306b\u3088\u3063\u3066\u63d0\u4f9b\u3055\u308c\u308b\u6a5f\u80fd\u3092\u62bd\u8c61\u5316\u3057\u3001\u8ad6\u7406\u7684\u306a\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9\u3059\u308b\u5f79\u5272\u3092\u30b5\u30fc\u30d3\u30b9\u304c\u62c5\u3046\u3002\u30b5\u30fc\u30d3\u30b9\u306f pod \u306e\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u96c6\u7d04\u3057\u3001\u4ed6\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308b pod \u306b\u305d\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u3002\u8a2d\u5b9a\u306b\u3088\u3063\u3066\u3001\u5916\u90e8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u3082\u306a\u308a\u3001\u3053\u306e\u5834\u5408\u306b\u306f\u8ca0\u8377\u5206\u6563\u306e\u6a5f\u80fd\u3082\u63d0\u4f9b\u3059\u308b\u3002\n\n\u6307\u91dd\n\nH2O \u3068\u3001\u305d\u308c\u306b\u3088\u3063\u3066\u914d\u4fe1\u3057\u305f\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u542b\u3093\u3060 Docker \u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n(1) \u304b\u3089 Docker \u30b3\u30f3\u30c6\u30ca\u3092 pod \u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3002 pod \u306f RC \u306b\u3088\u308a\u5e38\u66422\u3064\u7a3c\u50cd\u3055\u305b\u308b\u3002\n(2) \u3067\u7a3c\u50cd\u3057\u3066\u3044\u308b pod \u306b\u3001\u5916\u90e8\u304b\u3089\u306e\u901a\u4fe1\u3092\u53d7\u3051\u3064\u3051\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n## \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\nREPO_ROOT\n |\n +-- Dockerfile\n |\n +-- html\n |    |\n |    +-- index.html\n |\n +-- deploy\n      |\n      +-- h2o-controller.yaml\n      |\n      +-- h2o-service.yaml\n\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b html \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001 H2O \u3067\u914d\u4fe1\u3057\u305f\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n$ mkdir html\n$ echo \"Served by h2o\" > html/index.html\n\n\nDockerfile \u3092\u4f5c\u6210\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\nDockerfile \u306f\u3001 DockerHub \u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b h2o \u306e\u30a4\u30e1\u30fc\u30b8\u3092\u307b\u307c\u305d\u306e\u307e\u307e\u4f7f\u3046\u3002\nDockerHub \u306e Dockerfile \u306b\u3088\u3063\u3066\u4f5c\u6210\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u542b\u3093\u3067\u3044\u306a\u3044\u3002\u30db\u30b9\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3055\u305b\u308b\u3053\u3068\u3092\u610f\u56f3\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u65b9\u6cd5\u306f Kubernetes \u3067\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5148\u306b\u4f5c\u6210\u3057\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u3001\u30a4\u30e1\u30fc\u30b8\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n$ cat > Dockerfile\nFROM lkwg82/h2o-http2-server\n\nCOPY html /var/www/html\n^D\n\n\ngcloud \u306e\u8a2d\u5b9a\u3002\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30af\u30e9\u30b9\u30bf\u306b get-credentials \u3059\u308b\nGCP \u4e0a\u3067\u306e\u64cd\u4f5c\u306b\u306a\u308b\u306e\u3067\u7c21\u5358\u306b\u307e\u3068\u3081\u3066\u304a\u304f\u306b\u7559\u3081\u308b\u3002\n\nGCP \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\nGKE \u30bf\u30d6\u3067\u65b0\u305f\u306a\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n\ngcloud \u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n\n\nproject\ncontainer/clusters\nzone\n\n\n\ngcloud container clusters get-credentials \u30af\u30e9\u30b9\u30bf\u540d \u3057\u3066\u304a\u304f\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u3001 kubectl \u30b3\u30de\u30f3\u30c9\u304c\u64cd\u4f5c\u306e\u5bfe\u8c61\u3068\u3059\u308b\u30af\u30e9\u30b9\u30bf\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3002\n\n\nGKE \u306e Container Registry \u306b\u30a4\u30e1\u30fc\u30b8\u3092 push\npod \u306e\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30a4\u30e1\u30fc\u30b8\u306f\u3001\u5f53\u7136 Kubernetes \u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u5834\u6240\u306b\u5b58\u5728\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002 \u30d1\u30d6\u30ea\u30c3\u30af\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u3089\u3001 DockerHub \u3067\u30db\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nGKE \u3067\u306f Container Registry \u3068\u3044\u3046\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306a Docker \u30a4\u30e1\u30fc\u30b8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u63d0\u4f9b\u3057\u3066\u304a\u308a\u3001\u624b\u5143\u306e docker \u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u8ee2\u9001\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\nDockerfile \u3082\u307e\u3060\u30d3\u30eb\u30c9\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30bf\u30b0\u540d\u306f \"//foobar\" \u3068\u3044\u3046\u5f62\u5f0f\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u30db\u30b9\u30c8\u540d\u306f\u3001\u30af\u30e9\u30b9\u30bf\u304c\u5b58\u5728\u3059\u308b\u30be\u30fc\u30f3\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u3001\u7c73\u56fd\u306a\u3089 us.gcr.io, \u6b27\u5dde\u306a\u3089 eu.gcr.io, \u30a2\u30b8\u30a2\u306a\u3089 asia.gcr.io \u306b\u306a\u308b\u3002\n$ docker build . -t asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u30a4\u30e1\u30fc\u30b8\u306f\u30ed\u30fc\u30ab\u30eb\u306b\u3057\u304b\u5b58\u5728\u3057\u306a\u3044\u3002\u3053\u306e\u6bb5\u968e\u3067\u3068\u308a\u3042\u3048\u305a h2o \u304c\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f:\n$ docker run -p \"8080:80\" -it asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n$ curl 104.155.228.73\nServed by h2o\n\n\u554f\u984c\u306a\u3051\u308c\u3070 Container Registry \u306b push \u3059\u308b:\n$ gcloud docker push asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n\n\nRC \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\nRC \u306f\u3001 Kubernetes \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e kubectl \u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u308a\u3001\u524a\u9664\u3057\u305f\u308a\u3067\u304d\u308b\u3002 RC \u306e\u8a73\u7d30\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001 YAML \u3067\u66f8\u304f\u3053\u3068\u3082\u3067\u304d\u308b\u3002\u4eca\u56de\u306f YAML \u3067\u66f8\u304f\u3002\nRC \u306f\u3001\u540c\u3058\u6a5f\u80fd\u3092\u5099\u3048\u305f pod \u304c\u4e00\u5b9a\u6570\u7a3c\u50cd\u3059\u308b\u3053\u3068\u3092\u62c5\u4fdd\u3059\u308b\u3002\u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u306e\u306f\u305d\u306e\u305f\u3081\u306e\u60c5\u5831\u3060\u3002\u307e\u305f\u3001\u305d\u308c\u3089\u306e pod \u306f\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3092\u5272\u308a\u632f\u308a\u305f\u3044\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u305f\u3081\u306e\u8b58\u5225\u60c5\u5831\u3082\u6307\u5b9a\u3057\u3066\u3044\u308b\u3002\nYAML \u306f\u4e3b\u306b\u3001 RC \u81ea\u8eab\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3059\u308b metadata \u30bb\u30af\u30b7\u30e7\u30f3\u3068\u3001 RC \u306b\u3088\u3063\u3066\u4f5c\u6210\u3059\u308b pod \u306e\u60c5\u5831\u3084\u7ba1\u7406\u306e\u305f\u3081\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3059\u308b spec \u30bb\u30af\u30b7\u30e7\u30f3\u304b\u3089\u306a\u308b\u3002\nKubernetes \u306b\u306f\u3001\u300c\u30e9\u30d9\u30eb\u300d\u3068\u300c\u30bb\u30ec\u30af\u30bf\u300d\u3068\u3044\u3046\u8003\u3048\u65b9\u304c\u305f\u3073\u305f\u3073\u767b\u5834\u3059\u308b\u3002\n\u300c\u30e9\u30d9\u30eb\u300d\u306f pod, RC, \u30b5\u30fc\u30d3\u30b9\u3068\u3044\u3063\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\u3067\u304d\u308b key-value \u30da\u30a2\u306e\u96c6\u5408\u3067\u3001 key \u306b\u3082 value \u306b\u3082\u4efb\u610f\u306e\u6587\u5b57\u5217\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3002 key \u3084 value \u306b\u3069\u3093\u306a\u5185\u5bb9\u304c\u6307\u5b9a\u3055\u308c\u3066\u3082\u3001\u305d\u308c\u305d\u306e\u3082\u306e\u304c\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u632f\u308b\u821e\u3044\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u3002\u305d\u308c\u306f\u305f\u3060\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u3060\u3051\u4f7f\u7528\u3055\u308c\u308b\u3002\n\u300c\u30bb\u30ec\u30af\u30bf\u300d\u306f\u3001\u30e9\u30d9\u30eb\u3068\u540c\u3058\u3067\u4efb\u610f\u306e\u5185\u5bb9\u3092\u8a2d\u5b9a\u3067\u304d\u308b key-value \u30da\u30a2\u306e\u96c6\u5408\u3067\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u64cd\u4f5c\u5bfe\u8c61\u3092\u30e9\u30d9\u30eb\u306e AND \u691c\u7d22\u3067\u7d5e\u308a\u8fbc\u3080\u305f\u3081\u306b\u4f7f\u7528\u3059\u308b\u3002\napiVersion: v1\nkind: ReplicationController # \u3053\u306e YAML \u3067\u4f5c\u6210\u3059\u308b\u3082\u306e\u304c RC \u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002\nmetadata:\n  name: h2o-example-r1      # RC \u306e\u540d\u524d\u3002 r1 \u306a\u3069\u306e\u9023\u756a\u3092\u63a5\u5c3e\u3057\u3066\u304a\u304f\u3002\n  labels:                   # RC \u81ea\u8eab\u306e\u30e9\u30d9\u30eb\u3002 RC \u81ea\u8eab\u3084\u30b5\u30fc\u30d3\u30b9\u304c\u3053\u306e\u60c5\u5831\u3092\u4f7f\u3046\u3053\u3068\n    app: h2o-example        # \u306f\u306a\u304f\u3001 CI/CD \u30c4\u30fc\u30eb\u304c\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u60f3\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n    tier: frontend\nspec:\n  replicas: 2               # \u3053\u306e RC \u306f\u3001 pod \u306e\u6570\u3092 2 \u306b\u4fdd\u3064\u3002\n  selector:                 # \u3053\u306e RC \u306f\u3001\u3053\u306e\u30bb\u30ec\u30af\u30bf\u3067\u6307\u5b9a\u3055\u308c\u305f\u30e9\u30d9\u30eb\u3092\u6301\u3064\n    app: h2o-example        # pod \u3092\u7ba1\u7406\u306e\u5bfe\u8c61\u3068\u3059\u308b\u3002\u30bb\u30ec\u30af\u30bf\u304c\u30de\u30c3\u30c1\u3059\u308b pod\n    revision: \"1\"           # \u306a\u3089\u3001\u3053\u306e RC \u304c\u4f5c\u6210\u3057\u305f\u3082\u306e\u3067\u3082\u3001\u4e3b\u52d5\u3067\u4f5c\u6210\u3057\u305f\n    tier: frontend          # \u3082\u306e\u3067\u3082\u540c\u69d8\u306b\u6271\u3046\u3002\n  template:                 # \u3053\u306e RC \u304c\u4f5c\u6210\u3059\u308b pod \u306e\u8a2d\u5b9a\u3002\n    metadata:\n      labels:               # \u3053\u306e RC \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305f pod \u306b\u306f\u3001\u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\n        app: h2o-example    # \u30e9\u30d9\u30eb\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3002\u3053\u308c\u306f\u5f53\u7136\u3001 spec.selector \u3067\u306e\n        revision: \"1\"       # \u6307\u5b9a\u306b\u30de\u30c3\u30c1\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n        tier: frontend\n    spec:\n      containers:           # Pod \u306b\u542b\u3081\u308b\u30b3\u30f3\u30c6\u30ca\u3002\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u308b\u3002\n        - name: h2o-example # \u30b3\u30f3\u30c6\u30ca\u306e\u540d\u524d\u3002\n          image: asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o:latest # \u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3002\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:              # \u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\u4efb\u610f\u306e key-value \u30da\u30a2\u3002\n          ports:            # \u30b3\u30f3\u30c6\u30ca\u304b\u3089\u5916\u90e8\u306b\u958b\u304f\u30dd\u30fc\u30c8\u3002\n            - containerPort: 80\n\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\n\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\u3082\u3001 kubectl \u306b YAML \u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u3057\u3066\u884c\u3046\u3002\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u305d\u306e IP \u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u3064\u3051\u308b\u3068\u3001\u30bb\u30ec\u30af\u30bf\u3067\u7d5e\u308a\u8fbc\u3093\u3060 pod \u306b\u5272\u308a\u632f\u308b\u3002\napiVersion: v1\nkind: Service         # \u3053\u306e YAML \u3067\u4f5c\u6210\u3059\u308b\u3082\u306e\u304c\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002\nmetadata:\n  name: h2o-example   # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u540d\u524d\u3002\n  labels:             # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u8a2d\u5b9a\u3059\u308b\u30e9\u30d9\u30eb\u3002\n    app: h2o-example\n    tier: frontend\nspec:\n  type: LoadBalancer  # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u304c LoadBalancer \u7a2e\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002 LoadBalancer\n  ports:              # \u7a2e\u306f\u5916\u90e8\u306b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u3059\u3002 ClusterIP \u7a2e\u306f\u305d\u3046\u3067\u306a\u3044\u3002\n  - port: 80          # \u30b5\u30fc\u30d3\u30b9\u306e IP \u30a2\u30c9\u30ec\u30b9\u306e80\u756a\u306b\u53d7\u3051\u4ed8\u3051\u305f\u30a2\u30af\u30bb\u30b9\u3092\u3001\n    targetPort: 80    # pod \u306e80\u756a\u306b\u5272\u308a\u632f\u308b\u3002\n  selector:           # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30af\u30bb\u30b9\u306e\u5272\u308a\u632f\u308a\u5148\u3068\u306a\u308b pod \u3092\u30bb\u30ec\u30af\u30bf\u3067\u6307\u5b9a\u3059\u308b\u3002\n    app: h2o-example\n    tier: frontend\n\n\nRC \u3068\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\nkubectl \u306e\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308c\u3070\u3053\u308c\u306f\u77ac\u6bba:\n$ kubectl create -f deploy/h2o-controller.yaml\n$ kubectl create -f deploy/h2o-service.yaml\n\n\u4f5c\u6210\u3057\u305f\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b:\n$ kubectl get svcNAME          CLUSTER_IP      EXTERNAL_IP      PORT(S)   SELECTOR                        AGE\nh2o-example   10.59.255.187   104.155.228.73   80/TCP    app=h2o-example,tier=frontend   9h\nkubernetes    10.59.240.1     <none>           443/TCP   <none>                          9h\n$ kubectl describe svc h2o-example\nName:                   h2o-example\nNamespace:              default\nLabels:                 app=h2o-example,tier=frontend\nSelector:               app=h2o-example,tier=frontend\nType:                   LoadBalancer\nIP:                     10.59.255.187\nLoadBalancer Ingress:   104.155.228.73\nPort:                   <unnamed>       80/TCP\nNodePort:               <unnamed>       30092/TCP\nEndpoints:              10.56.0.9:80\nSession Affinity:       None\nNo events.\n\nLoadBalancer Ingress \u306b\u66f8\u3044\u3066\u3042\u308b\u306e\u304c\u5916\u90e8\u306b\u516c\u958b\u3055\u308c\u3066\u3044\u308b IP \u30a2\u30c9\u30ec\u30b9\u306a\u306e\u3067\u3001\u3053\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n$ curl 104.155.228.73\nServed by h2o\n\nLoadBalancer Ingress \u306e\u9805\u76ee\u304c\u8868\u793a\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u3002\u3053\u306e\u3068\u304d\u306f\u5c11\u3057\u5f85\u3064\u3002\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\u306f\u3059\u3050\u306b\u5b8c\u4e86\u3059\u308b\u304c\u3001\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306e\u5272\u308a\u5f53\u3066\u306b1\u5206\u304f\u3089\u3044\u304b\u304b\u308b\u3002\n\nAPI \u30e2\u30c3\u30af\u3063\u307d\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\n\u3082\u3046\u5c11\u3057\u305d\u308c\u3063\u307d\u3044\u51fa\u529b\u3092\u898b\u305f\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u305d\u308c\u3063\u307d\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\nhtml/auth.json \u3092\u4f5c\u6210\u3057\u3066\u6b21\u306e\u3088\u3046\u306b\u3059\u308b:\n{\n  \"succeeded\": true,\n  \"auth\": {\n    \"token\": \"3e4adf1599a4b42ea9cc18a90fac4dad\",\n    \"message\": \"You are allowed to be yourself. We guarantee.\",\n    \"expire\": \"2016-03-19 11:21:44\"\n  }\n}\n\nDockerfile \u3092\u30d3\u30eb\u30c9\u3057\u306a\u304a\u3057\u3066\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30e1\u30fc\u30b8\u306b\u542b\u3081\u308b:\n$ docker build . -t asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n$ gcloud docker push asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\u30b7\u30b9\u30c6\u30e0\u3092\u505c\u6b62\u305b\u305a\u306b\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u306b\u3001 RC \u306b\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u6a5f\u80fd\u304c\u5099\u308f\u3063\u3066\u3044\u308b\u3002\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3046\u3068\u3001 RC \u306e\u7ba1\u7406\u4e0b\u306b\u3042\u308b pod \u3092\u3072\u3068\u3064\u305a\u3064\u65b0\u3057\u3044\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u8d77\u52d5\u3057\u305f pod \u306b\u7f6e\u304d\u63db\u3048\u3066\u3044\u304f\u3002\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u65b0\u3057\u304f\u6307\u5b9a\u3055\u308c\u308b RC \u306e YAML \u30d5\u30a1\u30a4\u30eb\u304c\u6b21\u306e\u8981\u4ef6\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b:\n\nRC \u306e metadata.name \u304c\u7570\u306a\u308b\nRC \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u308b pod \u306e\u305f\u3081\u306e spec.selector \u306e\u5185\u5bb9\u304c\u3001\u3044\u305a\u308c\u304b\u3072\u3068\u3064\u306f\u53e4\u3044\u3082\u306e\u3068\u7570\u306a\u308b\n\nspec.template.metadata.labels \u306b\u3082\u540c\u69d8\u306b\u3001\u53e4\u3044\u3082\u306e\u3068\u7570\u306a\u308b\u90e8\u5206\u304c\u3042\u308b\n\n\u3053\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3059\u305f\u3081\u306b\u3001 metadata.name \u306b\u306f\u3042\u3089\u304b\u3058\u3081\u30ea\u30d3\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u542b\u3081\u3066\u304a\u3044\u305f\u3057\u3001 spec.selector, spec.template.metadata.labels \u306b\u306f\u305d\u308c\u305e\u308c revision \u3092\u542b\u3081\u3066\u304a\u3044\u305f\u3002\u3053\u306e\u6570\u5b57\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308c\u3070\u826f\u3044\u3002\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: h2o-example-r2\n  labels:\n    app: h2o-example\n    tier: frontend\nspec:\n  replicas: 1\n  selector:\n    app: h2o-example\n    revision: \"2\"\n    tier: frontend\n  template:\n    metadata:\n      labels:\n        app: h2o-example\n        revision: \"2\"\n        tier: frontend\n    spec:\n      containers:\n        - name: h2o-example\n          image: asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o:latest\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n          ports:\n            - containerPort: 80\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u5b9f\u884c\u6642\u306b\u306f\u3001\u53e4\u3044 RC \u306e\u540d\u524d\u3082\u6307\u5b9a\u3059\u308b:\n$ kubectl rolling-update h2o-example-r1 -f deploy/h2o-controller.yaml\nCreated h2o-example-r2\nScaling up h2o-example-r2 from 0 to 1, scaling down h2o-example-r1 from 1 to 0 (keep 1 pods available, don't exceed 2 pods)\nScaling h2o-example-r2 up to 1\n\nScaling h2o-example-r1 down to 0\nUpdate succeeded. Deleting h2o-example-r1\nreplicationcontroller \"h2o-example-r1\" rolling updated to \"h2o-example-r2\"\n\n\u3059\u3079\u3066\u306e pod \u304c\u7f6e\u304d\u63db\u308f\u308b\u307e\u3067\u306b1\u5206\u304f\u3089\u3044\u304b\u304b\u308b\u3002\n\u78ba\u8a8d\u3057\u3066\u307f\u308b:\n$ curl 104.155.228.73/auth.json\n{\n  \"succeeded\": true,\n  \"auth\": {\n    \"token\": \"3e4adf1599a4b42ea9cc18a90fac4dad\",\n    \"message\": \"You are allowed to be yourself. We guarantee.\",\n    \"expire\": \"2016-03-19 11:21:44\"\n  }\n}\n\n\u307e\u308b\u3067\u8a8d\u8a3c API \u306e\u3088\u3046\u3060\u3002\n\n\u307e\u3068\u3081\nGKE \u3067\u306e H2O \u306e\u5c55\u958b\u306f\u3001 Dockerfile \u304c\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u30e1\u30f3\u30c6\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u3063\u3066\u5bb9\u6613\u3060\u3063\u305f\u3002 Apache \u3084 nginx \u306b\u6bd4\u3079\u3066\u69cb\u6210\u30d5\u30a1\u30a4\u30eb\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u306e\u3067 Docker \u3068\u76f8\u6027\u304c\u826f\u3055\u305d\u3046\u3002\nHTML \u3084 JSON \u3092\u914d\u4fe1\u3057\u3001\u69cb\u6210\u306b\u5909\u66f4\u304c\u3042\u308c\u3070\u30db\u30c3\u30c8\u306b\u66f4\u65b0\u3067\u304d\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3057\u305f\u3002\n\u3057\u304b\u3057 SSL \u304c\u6709\u52b9\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u7a32\u59bb\u306f\u9752\u304f\u306a\u3089\u306a\u304b\u3063\u305f\u3002\n\n\u793e\u5185\u5411\u3051\u306b Kubernetes \u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3068\u3057\u3066\u66f8\u3044\u305f\u8a18\u4e8b\u30022016\u5e743\u6708\u306b\u66f8\u3044\u305f\u3082\u306e\u306a\u306e\u3067 ReplicaSet \u4f7f\u3063\u3066\u306a\u304b\u3063\u305f\u308a\u3068\u3061\u3087\u3063\u3068\u53e4\u3044\u90e8\u5206\u3042\u308a\u307e\u3059\u3002\n\n## \u3084\u308b\u3053\u3068\n\nHTTP2 \u30b5\u30fc\u30d0\u306e\u5b9f\u88c5\u3067\u3042\u308b H2O \u3092 Google Container Engine (\u4ee5\u4e0b GKE)\u4e0a\u306e\u30af\u30e9\u30b9\u30bf\u306b\u5c55\u958b\u3057\u3001\u4f55\u3089\u304b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u914d\u4fe1\u3059\u308b\u3002 JSON \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u914d\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u3001\u672a\u5b9f\u88c5\u306e\u4f55\u3089\u304b\u306e API \u306e\u30e2\u30c3\u30af\u3068\u3057\u3066\u4f7f\u3048\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n## GKE \u3068 Kubenetes \u306e\u57fa\u672c\u7684\u306a\u6982\u5ff5\n\nGKE \u306f Google Cloud Platform \u4e0a\u3067\u30de\u30cd\u30fc\u30b8\u30c9\u306a Kubenetes \u30af\u30e9\u30b9\u30bf\u3092\u63d0\u4f9b\u3059\u308b\u3002\n\nKubernetes ([\"helmsman\" \u3084 \"pilot\" \u3092\u610f\u5473\u3059\u308b\u30ae\u30ea\u30b7\u30a2\u8a9e](https://en.wikipedia.org/wiki/Kubernetes)\u3002\u300c\u30af\u30fc\u30d9\u30eb\u30cd\u30a4\u30c6\u30b9\u300d)\u306f\n\u3001 Google \u304c\u958b\u767a\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u30af\u30e9\u30b9\u30bf\u30de\u30cd\u30fc\u30b8\u30e3\u3002 Docker \u306a\u3069\u306b\u3088\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u7ba1\u7406\u3057\u3001\u305d\u308c\u305e\u308c\u306e\u3084\u308a\u3068\u308a\u3092\u8abf\u6574\u3059\u308b orchestration \u3068\u3044\u3046\u5f79\u5272\u3092\u62c5\u3046\u3002\n\nDocker \u30b3\u30f3\u30c6\u30ca\u306e orchestration \u30c4\u30fc\u30eb\u306b\u306f [Docker Swarm](https://www.docker.com/products/docker-swarm) \u3082\u5b58\u5728\u3059\u308b\u304c\u3001 Kubernetes \u306f Docker \u30b3\u30f3\u30c6\u30ca\u4ee5\u5916\u306e\u30e9\u30f3\u30bf\u30a4\u30e0\u3082\u5bfe\u8c61\u306b\u3057\u3066\u3044\u308b\u70b9\u3067\u9055\u3044\u304c\u3042\u308b(\u73fe\u6642\u70b9\u3067\u306f Docker \u304c\u3082\u3063\u3068\u3082\u4e00\u822c\u7684\u306a\u9078\u629e\u80a2\u3067\u3042\u308b\u3068\u3082\u8a8d\u8b58\u3057\u3066\u3044\u308b\u3088\u3046\u3060)\u3002\n\nKubernetes \u3067\u306f\u3001\u30c7\u30d7\u30ed\u30a4\u53ef\u80fd\u306a\u6700\u5c0f\u5358\u4f4d\u3092 [pod](http://kubernetes.io/docs/user-guide/pods/) \u3068\u547c\u3076\u3002 Pod \u306f\u3001\u3072\u3068\u3064\u4ee5\u4e0a\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u30b0\u30eb\u30fc\u30d7\u3067\u3001\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u30b3\u30f3\u30c6\u30ca\u306f\u7269\u7406\u7684\u306b\u914d\u7f6e\u3055\u308c\u305f\u308a\u3001\u5171\u6709\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u3042\u3063\u305f\u308a\u3059\u308b\u3002 Pod \u306f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u56fa\u6709\u306e\"\u8ad6\u7406\u7684\u30db\u30b9\u30c8\"\u3092\u30e2\u30c7\u30eb\u5316\u3057\u305f\u3082\u306e\u3067\u3082\u3042\u308a\u3001\u6bd4\u8f03\u7684\u5bc6\u306b\u7d50\u5408\u3057\u305f\u3072\u3068\u3064\u4ee5\u4e0a\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b3\u30f3\u30c6\u30ca\u3092\u542b\u3093\u3067\u3044\u308b\u3002 Pod \u306f\u9be8\u306a\u3069\u306e(\u4e3b\u306b\u6d77\u6d0b\u751f\u7269\u306e\uff1f)\u7fa4\u308c\u3092\u610f\u5473\u3059\u308b\u3002\n\n\u540c\u3058\u30a2\u30d7\u30ea\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8907\u6570\u7acb\u3061\u4e0a\u3052\u3066\u8ca0\u8377\u5206\u6563\u3092\u3059\u308b\u3088\u3046\u306a\u5834\u5408\u304c\u3042\u308b\u3002\u3053\u306e\u5834\u5408\u306b\u306f\u3001\u540c\u3058\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u8d77\u52d5\u3057\u305f\u8907\u6570\u306e pod \u3092\u7d71\u62ec\u3057\u3001\u3042\u308b\u77ac\u9593\u306b\u7a3c\u50cd\u3057\u3066\u3044\u308b pod \u3092\u4e00\u5b9a\u306b\u4fdd\u3063\u305f\u308a\u3001\u305d\u306e\u6570\u3092\u5897\u6e1b\uff08\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\uff09\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u3053\u306e\u5f79\u5272\u3092 [Replication controllers](http://kubernetes.io/docs/user-guide/replication-controller/) (\u4ee5\u4e0b RC)\u304c\u62c5\u3046\u3002\n\nPod \u306b\u3088\u3063\u3066\u63d0\u4f9b\u3055\u308c\u308b\u6a5f\u80fd\u3092\u62bd\u8c61\u5316\u3057\u3001\u8ad6\u7406\u7684\u306a\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9\u3059\u308b\u5f79\u5272\u3092[\u30b5\u30fc\u30d3\u30b9](http://kubernetes.io/docs/user-guide/services/)\u304c\u62c5\u3046\u3002\u30b5\u30fc\u30d3\u30b9\u306f pod \u306e\u30b0\u30eb\u30fc\u30d7\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u96c6\u7d04\u3057\u3001\u4ed6\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308b pod \u306b\u305d\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3059\u308b\u3002\u8a2d\u5b9a\u306b\u3088\u3063\u3066\u3001\u5916\u90e8\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u3078\u306e\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u4ed8\u3051\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306b\u3082\u306a\u308a\u3001\u3053\u306e\u5834\u5408\u306b\u306f\u8ca0\u8377\u5206\u6563\u306e\u6a5f\u80fd\u3082\u63d0\u4f9b\u3059\u308b\u3002\n## \u6307\u91dd\n1. H2O \u3068\u3001\u305d\u308c\u306b\u3088\u3063\u3066\u914d\u4fe1\u3057\u305f\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u542b\u3093\u3060 Docker \u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u6210\u3059\u308b\u3002\n2. (1) \u304b\u3089 Docker \u30b3\u30f3\u30c6\u30ca\u3092 pod \u3068\u3057\u3066\u8d77\u52d5\u3059\u308b\u3002 pod \u306f RC \u306b\u3088\u308a\u5e38\u66422\u3064\u7a3c\u50cd\u3055\u305b\u308b\u3002\n3. (2) \u3067\u7a3c\u50cd\u3057\u3066\u3044\u308b pod \u306b\u3001\u5916\u90e8\u304b\u3089\u306e\u901a\u4fe1\u3092\u53d7\u3051\u3064\u3051\u308b\u305f\u3081\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3002\n## \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\n```\nREPO_ROOT\n |\n +-- Dockerfile\n |\n +-- html\n |    |\n |    +-- index.html\n |\n +-- deploy\n      |\n      +-- h2o-controller.yaml\n      |\n      +-- h2o-service.yaml\n```\n## \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u6210\n\n\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b `html` \u3068\u3044\u3046\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3001 H2O \u3067\u914d\u4fe1\u3057\u305f\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6e96\u5099\u3057\u3066\u304a\u304f\u3002\n\n``` sh\n$ mkdir html\n$ echo \"Served by h2o\" > html/index.html\n```\n## Dockerfile \u3092\u4f5c\u6210\u3057\u3066\u30a4\u30e1\u30fc\u30b8\u3092\u30d3\u30eb\u30c9\n\nDockerfile \u306f\u3001 [DockerHub \u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308b h2o \u306e\u30a4\u30e1\u30fc\u30b8](https://github.com/lkwg82/h2o.docker)\u3092\u307b\u307c\u305d\u306e\u307e\u307e\u4f7f\u3046\u3002\n\nDockerHub \u306e Dockerfile \u306b\u3088\u3063\u3066\u4f5c\u6210\u3059\u308b\u30a4\u30e1\u30fc\u30b8\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u542b\u3093\u3067\u3044\u306a\u3044\u3002\u30db\u30b9\u30c8\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306b\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3055\u305b\u308b\u3053\u3068\u3092\u610f\u56f3\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u65b9\u6cd5\u306f Kubernetes \u3067\u306f\u4f7f\u7528\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u5148\u306b\u4f5c\u6210\u3057\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u3001\u30a4\u30e1\u30fc\u30b8\u306b\u30b3\u30d4\u30fc\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n``` sh\n$ cat > Dockerfile\nFROM lkwg82/h2o-http2-server\n\nCOPY html /var/www/html\n^D\n```\n## gcloud \u306e\u8a2d\u5b9a\u3002\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30af\u30e9\u30b9\u30bf\u306b get-credentials \u3059\u308b\n\nGCP \u4e0a\u3067\u306e\u64cd\u4f5c\u306b\u306a\u308b\u306e\u3067\u7c21\u5358\u306b\u307e\u3068\u3081\u3066\u304a\u304f\u306b\u7559\u3081\u308b\u3002\n\n* GCP \u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n* GKE \u30bf\u30d6\u3067\u65b0\u305f\u306a\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f\u3002\n* `gcloud` \u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n    * project\n    * container/clusters\n    * zone\n* `gcloud container clusters get-credentials \u30af\u30e9\u30b9\u30bf\u540d` \u3057\u3066\u304a\u304f\u3002\u3053\u308c\u306b\u3088\u3063\u3066\u3001 `kubectl` \u30b3\u30de\u30f3\u30c9\u304c\u64cd\u4f5c\u306e\u5bfe\u8c61\u3068\u3059\u308b\u30af\u30e9\u30b9\u30bf\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3002\n\n## GKE \u306e Container Registry \u306b\u30a4\u30e1\u30fc\u30b8\u3092 push\n\npod \u306e\u30d9\u30fc\u30b9\u3068\u306a\u308b\u30a4\u30e1\u30fc\u30b8\u306f\u3001\u5f53\u7136 Kubernetes \u304b\u3089\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u5834\u6240\u306b\u5b58\u5728\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002 \u30d1\u30d6\u30ea\u30c3\u30af\u306a\u30a4\u30e1\u30fc\u30b8\u306a\u3089\u3001 DockerHub \u3067\u30db\u30b9\u30c8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nGKE \u3067\u306f Container Registry \u3068\u3044\u3046\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306a Docker \u30a4\u30e1\u30fc\u30b8\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u63d0\u4f9b\u3057\u3066\u304a\u308a\u3001\u624b\u5143\u306e docker \u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u8ee2\u9001\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\nDockerfile \u3082\u307e\u3060\u30d3\u30eb\u30c9\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3053\u3053\u3067\u30d3\u30eb\u30c9\u3059\u308b\u3002\u3053\u306e\u3068\u304d\u3001\u30bf\u30b0\u540d\u306f \"<gci.io\u306e\u30db\u30b9\u30c8\u540d>/<GCP\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d>/foobar\" \u3068\u3044\u3046\u5f62\u5f0f\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u30db\u30b9\u30c8\u540d\u306f\u3001\u30af\u30e9\u30b9\u30bf\u304c\u5b58\u5728\u3059\u308b\u30be\u30fc\u30f3\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u3001\u7c73\u56fd\u306a\u3089 `us.gcr.io`, \u6b27\u5dde\u306a\u3089 `eu.gcr.io`, \u30a2\u30b8\u30a2\u306a\u3089 `asia.gcr.io` \u306b\u306a\u308b\u3002\n\n``` sh\n$ docker build . -t asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n```\n\n\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u307e\u3060\u30a4\u30e1\u30fc\u30b8\u306f\u30ed\u30fc\u30ab\u30eb\u306b\u3057\u304b\u5b58\u5728\u3057\u306a\u3044\u3002\u3053\u306e\u6bb5\u968e\u3067\u3068\u308a\u3042\u3048\u305a h2o \u304c\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f:\n\n``` sh\n$ docker run -p \"8080:80\" -it asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n$ curl 104.155.228.73\nServed by h2o\n```\n\n\u554f\u984c\u306a\u3051\u308c\u3070 Container Registry \u306b push \u3059\u308b:\n\n``` sh\n$ gcloud docker push asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n```\n## RC \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\n\nRC \u306f\u3001 Kubernetes \u3092\u64cd\u4f5c\u3059\u308b\u305f\u3081\u306e `kubectl` \u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u308a\u3001\u524a\u9664\u3057\u305f\u308a\u3067\u304d\u308b\u3002 RC \u306e\u8a73\u7d30\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u304c\u3001 YAML \u3067\u66f8\u304f\u3053\u3068\u3082\u3067\u304d\u308b\u3002\u4eca\u56de\u306f YAML \u3067\u66f8\u304f\u3002\n\nRC \u306f\u3001\u540c\u3058\u6a5f\u80fd\u3092\u5099\u3048\u305f pod \u304c\u4e00\u5b9a\u6570\u7a3c\u50cd\u3059\u308b\u3053\u3068\u3092\u62c5\u4fdd\u3059\u308b\u3002\u3053\u3053\u3067\u6307\u5b9a\u3059\u308b\u306e\u306f\u305d\u306e\u305f\u3081\u306e\u60c5\u5831\u3060\u3002\u307e\u305f\u3001\u305d\u308c\u3089\u306e pod \u306f\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3092\u5272\u308a\u632f\u308a\u305f\u3044\u5834\u5408\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u306e\u305f\u3081\u306e\u8b58\u5225\u60c5\u5831\u3082\u6307\u5b9a\u3057\u3066\u3044\u308b\u3002\n\nYAML \u306f\u4e3b\u306b\u3001 RC \u81ea\u8eab\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3059\u308b `metadata` \u30bb\u30af\u30b7\u30e7\u30f3\u3068\u3001 RC \u306b\u3088\u3063\u3066\u4f5c\u6210\u3059\u308b pod \u306e\u60c5\u5831\u3084\u7ba1\u7406\u306e\u305f\u3081\u306e\u60c5\u5831\u3092\u8a18\u8ff0\u3059\u308b `spec` \u30bb\u30af\u30b7\u30e7\u30f3\u304b\u3089\u306a\u308b\u3002\n\nKubernetes \u306b\u306f\u3001\u300c\u30e9\u30d9\u30eb\u300d\u3068\u300c\u30bb\u30ec\u30af\u30bf\u300d\u3068\u3044\u3046\u8003\u3048\u65b9\u304c\u305f\u3073\u305f\u3073\u767b\u5834\u3059\u308b\u3002\n\n\u300c\u30e9\u30d9\u30eb\u300d\u306f pod, RC, \u30b5\u30fc\u30d3\u30b9\u3068\u3044\u3063\u305f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a2d\u5b9a\u3067\u304d\u308b key-value \u30da\u30a2\u306e\u96c6\u5408\u3067\u3001 key \u306b\u3082 value \u306b\u3082\u4efb\u610f\u306e\u6587\u5b57\u5217\u3092\u8a2d\u5b9a\u3067\u304d\u308b\u3002 key \u3084 value \u306b\u3069\u3093\u306a\u5185\u5bb9\u304c\u6307\u5b9a\u3055\u308c\u3066\u3082\u3001\u305d\u308c\u305d\u306e\u3082\u306e\u304c\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u632f\u308b\u821e\u3044\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u308f\u3051\u3067\u306f\u306a\u3044\u3002\u305d\u308c\u306f\u305f\u3060\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u3060\u3051\u4f7f\u7528\u3055\u308c\u308b\u3002\n\n\u300c\u30bb\u30ec\u30af\u30bf\u300d\u306f\u3001\u30e9\u30d9\u30eb\u3068\u540c\u3058\u3067\u4efb\u610f\u306e\u5185\u5bb9\u3092\u8a2d\u5b9a\u3067\u304d\u308b key-value \u30da\u30a2\u306e\u96c6\u5408\u3067\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u64cd\u4f5c\u5bfe\u8c61\u3092\u30e9\u30d9\u30eb\u306e AND \u691c\u7d22\u3067\u7d5e\u308a\u8fbc\u3080\u305f\u3081\u306b\u4f7f\u7528\u3059\u308b\u3002\n\n``` yaml\napiVersion: v1\nkind: ReplicationController # \u3053\u306e YAML \u3067\u4f5c\u6210\u3059\u308b\u3082\u306e\u304c RC \u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002\nmetadata:\n  name: h2o-example-r1      # RC \u306e\u540d\u524d\u3002 r1 \u306a\u3069\u306e\u9023\u756a\u3092\u63a5\u5c3e\u3057\u3066\u304a\u304f\u3002\n  labels:                   # RC \u81ea\u8eab\u306e\u30e9\u30d9\u30eb\u3002 RC \u81ea\u8eab\u3084\u30b5\u30fc\u30d3\u30b9\u304c\u3053\u306e\u60c5\u5831\u3092\u4f7f\u3046\u3053\u3068\n    app: h2o-example        # \u306f\u306a\u304f\u3001 CI/CD \u30c4\u30fc\u30eb\u304c\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u60f3\u5b9a\u3055\u308c\u3066\u3044\u308b\u3002\n    tier: frontend\nspec:\n  replicas: 2               # \u3053\u306e RC \u306f\u3001 pod \u306e\u6570\u3092 2 \u306b\u4fdd\u3064\u3002\n  selector:                 # \u3053\u306e RC \u306f\u3001\u3053\u306e\u30bb\u30ec\u30af\u30bf\u3067\u6307\u5b9a\u3055\u308c\u305f\u30e9\u30d9\u30eb\u3092\u6301\u3064\n    app: h2o-example        # pod \u3092\u7ba1\u7406\u306e\u5bfe\u8c61\u3068\u3059\u308b\u3002\u30bb\u30ec\u30af\u30bf\u304c\u30de\u30c3\u30c1\u3059\u308b pod\n    revision: \"1\"           # \u306a\u3089\u3001\u3053\u306e RC \u304c\u4f5c\u6210\u3057\u305f\u3082\u306e\u3067\u3082\u3001\u4e3b\u52d5\u3067\u4f5c\u6210\u3057\u305f\n    tier: frontend          # \u3082\u306e\u3067\u3082\u540c\u69d8\u306b\u6271\u3046\u3002\n  template:                 # \u3053\u306e RC \u304c\u4f5c\u6210\u3059\u308b pod \u306e\u8a2d\u5b9a\u3002\n    metadata:\n      labels:               # \u3053\u306e RC \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u305f pod \u306b\u306f\u3001\u3053\u3053\u3067\u6307\u5b9a\u3057\u305f\n        app: h2o-example    # \u30e9\u30d9\u30eb\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u3002\u3053\u308c\u306f\u5f53\u7136\u3001 spec.selector \u3067\u306e\n        revision: \"1\"       # \u6307\u5b9a\u306b\u30de\u30c3\u30c1\u3057\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044\u3002\n        tier: frontend\n    spec:\n      containers:           # Pod \u306b\u542b\u3081\u308b\u30b3\u30f3\u30c6\u30ca\u3002\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u308b\u3002\n        - name: h2o-example # \u30b3\u30f3\u30c6\u30ca\u306e\u540d\u524d\u3002\n          image: asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o:latest # \u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3002\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:              # \u74b0\u5883\u5909\u6570\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\u4efb\u610f\u306e key-value \u30da\u30a2\u3002\n          ports:            # \u30b3\u30f3\u30c6\u30ca\u304b\u3089\u5916\u90e8\u306b\u958b\u304f\u30dd\u30fc\u30c8\u3002\n            - containerPort: 80\n```\n## \u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\n\n\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\u3082\u3001 `kubectl` \u306b YAML \u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u3057\u3066\u884c\u3046\u3002\u30b5\u30fc\u30d3\u30b9\u306f\u3001\u305d\u306e IP \u30a2\u30c9\u30ec\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3092\u53d7\u3051\u3064\u3051\u308b\u3068\u3001\u30bb\u30ec\u30af\u30bf\u3067\u7d5e\u308a\u8fbc\u3093\u3060 pod \u306b\u5272\u308a\u632f\u308b\u3002\n\n``` yaml\napiVersion: v1\nkind: Service         # \u3053\u306e YAML \u3067\u4f5c\u6210\u3059\u308b\u3082\u306e\u304c\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002\nmetadata:\n  name: h2o-example   # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u540d\u524d\u3002\n  labels:             # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306b\u8a2d\u5b9a\u3059\u308b\u30e9\u30d9\u30eb\u3002\n    app: h2o-example\n    tier: frontend\nspec:\n  type: LoadBalancer  # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u304c LoadBalancer \u7a2e\u3067\u3042\u308b\u3053\u3068\u3092\u793a\u3059\u3002 LoadBalancer\n  ports:              # \u7a2e\u306f\u5916\u90e8\u306b\u30a2\u30af\u30bb\u30b9\u3092\u8a31\u3059\u3002 ClusterIP \u7a2e\u306f\u305d\u3046\u3067\u306a\u3044\u3002\n  - port: 80          # \u30b5\u30fc\u30d3\u30b9\u306e IP \u30a2\u30c9\u30ec\u30b9\u306e80\u756a\u306b\u53d7\u3051\u4ed8\u3051\u305f\u30a2\u30af\u30bb\u30b9\u3092\u3001\n    targetPort: 80    # pod \u306e80\u756a\u306b\u5272\u308a\u632f\u308b\u3002\n  selector:           # \u3053\u306e\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30af\u30bb\u30b9\u306e\u5272\u308a\u632f\u308a\u5148\u3068\u306a\u308b pod \u3092\u30bb\u30ec\u30af\u30bf\u3067\u6307\u5b9a\u3059\u308b\u3002\n    app: h2o-example\n    tier: frontend\n```\n## RC \u3068\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3059\u308b\n\n`kubectl` \u306e\u8a2d\u5b9a\u304c\u3067\u304d\u3066\u3044\u308c\u3070\u3053\u308c\u306f\u77ac\u6bba:\n\n``` sh\n$ kubectl create -f deploy/h2o-controller.yaml\n$ kubectl create -f deploy/h2o-service.yaml\n```\n\n\u4f5c\u6210\u3057\u305f\u3089\u3001\u30b5\u30fc\u30d3\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b:\n\n``` sh\n$ kubectl get svcNAME          CLUSTER_IP      EXTERNAL_IP      PORT(S)   SELECTOR                        AGE\nh2o-example   10.59.255.187   104.155.228.73   80/TCP    app=h2o-example,tier=frontend   9h\nkubernetes    10.59.240.1     <none>           443/TCP   <none>                          9h\n$ kubectl describe svc h2o-example\nName:                   h2o-example\nNamespace:              default\nLabels:                 app=h2o-example,tier=frontend\nSelector:               app=h2o-example,tier=frontend\nType:                   LoadBalancer\nIP:                     10.59.255.187\nLoadBalancer Ingress:   104.155.228.73\nPort:                   <unnamed>       80/TCP\nNodePort:               <unnamed>       30092/TCP\nEndpoints:              10.56.0.9:80\nSession Affinity:       None\nNo events.\n```\n\n`LoadBalancer Ingress` \u306b\u66f8\u3044\u3066\u3042\u308b\u306e\u304c\u5916\u90e8\u306b\u516c\u958b\u3055\u308c\u3066\u3044\u308b IP \u30a2\u30c9\u30ec\u30b9\u306a\u306e\u3067\u3001\u3053\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002\n\n``` sh\n$ curl 104.155.228.73\nServed by h2o\n```\n\nLoadBalancer Ingress \u306e\u9805\u76ee\u304c\u8868\u793a\u3055\u308c\u306a\u3044\u5834\u5408\u304c\u3042\u308b\u3002\u3053\u306e\u3068\u304d\u306f\u5c11\u3057\u5f85\u3064\u3002\u30b5\u30fc\u30d3\u30b9\u306e\u4f5c\u6210\u306f\u3059\u3050\u306b\u5b8c\u4e86\u3059\u308b\u304c\u3001\u30b0\u30ed\u30fc\u30d0\u30ebIP\u306e\u5272\u308a\u5f53\u3066\u306b1\u5206\u304f\u3089\u3044\u304b\u304b\u308b\u3002\n## API \u30e2\u30c3\u30af\u3063\u307d\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\n\n\u3082\u3046\u5c11\u3057\u305d\u308c\u3063\u307d\u3044\u51fa\u529b\u3092\u898b\u305f\u3044\u306e\u3067\u3001\u3082\u3046\u5c11\u3057\u305d\u308c\u3063\u307d\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n`html/auth.json` \u3092\u4f5c\u6210\u3057\u3066\u6b21\u306e\u3088\u3046\u306b\u3059\u308b:\n\n``` json\n{\n  \"succeeded\": true,\n  \"auth\": {\n    \"token\": \"3e4adf1599a4b42ea9cc18a90fac4dad\",\n    \"message\": \"You are allowed to be yourself. We guarantee.\",\n    \"expire\": \"2016-03-19 11:21:44\"\n  }\n}\n```\n\nDockerfile \u3092\u30d3\u30eb\u30c9\u3057\u306a\u304a\u3057\u3066\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u30a4\u30e1\u30fc\u30b8\u306b\u542b\u3081\u308b:\n\n``` sh\n$ docker build . -t asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n$ gcloud docker push asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o\n```\n## \u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u5b9f\u884c\u3059\u308b\n\n\u30b7\u30b9\u30c6\u30e0\u3092\u505c\u6b62\u305b\u305a\u306b\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u66f4\u65b0\u3067\u304d\u308b\u3088\u3046\u306b\u3001 [RC \u306b\u306f\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u6a5f\u80fd\u304c\u5099\u308f\u3063\u3066\u3044\u308b](http://kubernetes.io/docs/user-guide/replication-controller/#rolling-updates)\u3002\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u884c\u3046\u3068\u3001 RC \u306e\u7ba1\u7406\u4e0b\u306b\u3042\u308b pod \u3092\u3072\u3068\u3064\u305a\u3064\u65b0\u3057\u3044\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u8d77\u52d5\u3057\u305f pod \u306b\u7f6e\u304d\u63db\u3048\u3066\u3044\u304f\u3002\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3092\u3059\u308b\u305f\u3081\u306b\u306f\u3001\u65b0\u3057\u304f\u6307\u5b9a\u3055\u308c\u308b RC \u306e YAML \u30d5\u30a1\u30a4\u30eb\u304c\u6b21\u306e\u8981\u4ef6\u3092\u6e80\u305f\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308b:\n\n* RC \u306e `metadata.name` \u304c\u7570\u306a\u308b\n* RC \u306b\u3088\u308a\u4f5c\u6210\u3055\u308c\u308b pod \u306e\u305f\u3081\u306e `spec.selector` \u306e\u5185\u5bb9\u304c\u3001\u3044\u305a\u308c\u304b\u3072\u3068\u3064\u306f\u53e4\u3044\u3082\u306e\u3068\u7570\u306a\u308b\n* `spec.template.metadata.labels` \u306b\u3082\u540c\u69d8\u306b\u3001\u53e4\u3044\u3082\u306e\u3068\u7570\u306a\u308b\u90e8\u5206\u304c\u3042\u308b\n\n\u3053\u306e\u6761\u4ef6\u3092\u6e80\u305f\u3059\u305f\u3081\u306b\u3001 `metadata.name` \u306b\u306f\u3042\u3089\u304b\u3058\u3081\u30ea\u30d3\u30b8\u30e7\u30f3\u756a\u53f7\u3092\u542b\u3081\u3066\u304a\u3044\u305f\u3057\u3001 `spec.selector`, `spec.template.metadata.labels` \u306b\u306f\u305d\u308c\u305e\u308c `revision` \u3092\u542b\u3081\u3066\u304a\u3044\u305f\u3002\u3053\u306e\u6570\u5b57\u3092\u30a4\u30f3\u30af\u30ea\u30e1\u30f3\u30c8\u3059\u308c\u3070\u826f\u3044\u3002\n\n``` yaml\napiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: h2o-example-r2\n  labels:\n    app: h2o-example\n    tier: frontend\nspec:\n  replicas: 1\n  selector:\n    app: h2o-example\n    revision: \"2\"\n    tier: frontend\n  template:\n    metadata:\n      labels:\n        app: h2o-example\n        revision: \"2\"\n        tier: frontend\n    spec:\n      containers:\n        - name: h2o-example\n          image: asia.gcr.io/\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d/h2o:latest\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n          ports:\n            - containerPort: 80\n```\n\n\u30ed\u30fc\u30ea\u30f3\u30b0\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u306e\u5b9f\u884c\u6642\u306b\u306f\u3001\u53e4\u3044 RC \u306e\u540d\u524d\u3082\u6307\u5b9a\u3059\u308b:\n\n``` sh\n$ kubectl rolling-update h2o-example-r1 -f deploy/h2o-controller.yaml\nCreated h2o-example-r2\nScaling up h2o-example-r2 from 0 to 1, scaling down h2o-example-r1 from 1 to 0 (keep 1 pods available, don't exceed 2 pods)\nScaling h2o-example-r2 up to 1\n\nScaling h2o-example-r1 down to 0\nUpdate succeeded. Deleting h2o-example-r1\nreplicationcontroller \"h2o-example-r1\" rolling updated to \"h2o-example-r2\"\n```\n\n\u3059\u3079\u3066\u306e pod \u304c\u7f6e\u304d\u63db\u308f\u308b\u307e\u3067\u306b1\u5206\u304f\u3089\u3044\u304b\u304b\u308b\u3002\n\n\u78ba\u8a8d\u3057\u3066\u307f\u308b:\n\n``` sh\n$ curl 104.155.228.73/auth.json\n{\n  \"succeeded\": true,\n  \"auth\": {\n    \"token\": \"3e4adf1599a4b42ea9cc18a90fac4dad\",\n    \"message\": \"You are allowed to be yourself. We guarantee.\",\n    \"expire\": \"2016-03-19 11:21:44\"\n  }\n}\n```\n\n\u307e\u308b\u3067\u8a8d\u8a3c API \u306e\u3088\u3046\u3060\u3002\n## \u307e\u3068\u3081\n\nGKE \u3067\u306e H2O \u306e\u5c55\u958b\u306f\u3001 Dockerfile \u304c\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u30e1\u30f3\u30c6\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3082\u3042\u3063\u3066\u5bb9\u6613\u3060\u3063\u305f\u3002 Apache \u3084 nginx \u306b\u6bd4\u3079\u3066\u69cb\u6210\u30d5\u30a1\u30a4\u30eb\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u306e\u3067 Docker \u3068\u76f8\u6027\u304c\u826f\u3055\u305d\u3046\u3002\n\nHTML \u3084 JSON \u3092\u914d\u4fe1\u3057\u3001\u69cb\u6210\u306b\u5909\u66f4\u304c\u3042\u308c\u3070\u30db\u30c3\u30c8\u306b\u66f4\u65b0\u3067\u304d\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3057\u305f\u3002\n\n\u3057\u304b\u3057 SSL \u304c\u6709\u52b9\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u7a32\u59bb\u306f\u9752\u304f\u306a\u3089\u306a\u304b\u3063\u305f\u3002\n\n<img width=\"488\" alt=\"2016-03-12 22 58 47\" src=\"https://cloud.githubusercontent.com/assets/135082/13723383/7d2a4be6-e8a6-11e5-87c6-414b7505a2d0.png\">\n", "tags": ["GoogleContainerEngine", "h2o", "kubernetes"]}