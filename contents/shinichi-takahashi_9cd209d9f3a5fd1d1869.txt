{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u8ffd\u8a18\u578b\u3067\u3069\u3093\u3069\u3093\u30a2\u30d7\u30c7\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u7528\u8a9e\u304c\u591a\u304f\u3066\u30eb\u30fc\u5927\u67f4\u307f\u305f\u3044\u306b\u306a\u308a\u307e\u3059\u3002\n\u4f5c\u696d\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u3053\u3061\u3089\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5229\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f\u3053\u3061\u3089\n2\u65e5\u76ee\u3067\u304d\u307e\u3057\u305f \u3053\u3061\u3089\n\n\u76ee\u7684\n\n\u30aa\u30fc\u30ca\u30fc\u30ba\u30b9\u30c8\u30a2\u306b\u5546\u54c1\u3092\u5897\u3084\u3057\u305f\u3044\u3002\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u958b\u767a\u8005\u306b\u5411\u3051\u3066\u3001\u624b\u52a9\u3051\u306b\u306a\u308b\u8a18\u4e8b\u306b\u3057\u305f\u3044\u3002\nEC-CUBE3\u672c\u4f53\u3067\u3001\u8db3\u308a\u306a\u3044\u7b87\u6240\u3092\u6d17\u3044\u51fa\u3057\u305f\u3044\u3002\n\n\nEC-CUBE3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\uff12\u65e5\u3067\u3064\u304f\u308b - 1\u65e5\u76ee\n\u3068\u3044\u3046\u308f\u3051\u3067\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3069\u3093\u306a\u3082\u306e\u4f5c\u308b\u304b\u3063\u3066\u3068\u3053\u308d\u304b\u3089\u3002\n\n\u69cb\u60f3\n\u30ab\u30c6\u30b4\u30ea\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u3044\u3046EC-CUBE2\u7cfb\u3067\u3042\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092ver.3\u306b\u3042\u308f\u305b\u3066\u4f5c\u308a\u5909\u3048\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u8a2d\u8a08\u3068\u3044\u3046\u307b\u3069\u306e\u3082\u306e\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u5229\u7528\u3059\u308bEvent\u306f\u304a\u304a\u307e\u304b\u306b\u306f\u4ee5\u4e0b\u306a\u611f\u3058\u3002\n\nEntity\u62e1\u5f35\uff1a\u72ec\u81ea\u306e\u3082\u306e\u3092\u5b9a\u7fa9\nView\u62e1\u5f35\uff1aSymfony/kernel.response\n\n\u3053\u308c\u3089\u3092\u8ef8\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u8089\u4ed8\u3051\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30ab\u30c6\u30b4\u30ea\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306f\uff1f\n\u30ab\u30c6\u30b4\u30ea\u3054\u3068\u306b\u30c7\u30b6\u30a4\u30f3\u3092\u5909\u3048\u305f\u3044\uff01\u305d\u3093\u306a\u3042\u306a\u305f\u306b\uff01\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\u5b8c\u6210\u5f8c\u306b\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\nEntity\u62e1\u5f35\n\u4f55\u3092\u3084\u308b\u306b\u3082\u307e\u305a\u306fEntity\u304b\u3089\u4f5c\u308a\u307e\u3059\u3002\n\uff08\u4f5c\u308b\u9806\u756a\u306f\u597d\u307f\u3067\u3059\uff09\n\nEntity\nRepository\nForm\\Type, Form\\Extension\nTwig\n\n\u306e\u9806\u3067\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\u30ab\u30c6\u30b4\u30ea\u30da\u30fc\u30b8( http://example.com/products/list?category_id=X )\u306b\u7d10\u3065\u304f\u62e1\u5f35\u306a\u306e\u3067\u3001\n\u30ab\u30c6\u30b4\u30ea\u7de8\u96c6\u753b\u9762\u5074\u304b\u3089\u3064\u304f\u308a\u307e\u3059\u3002\n\u753b\u50cf\u306e\u77e2\u5370\u306e\u4f4d\u7f6e\u306b\u5165\u308c\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u30df\u30cb\u30de\u30e0\u306b\u3002\u30ab\u30c6\u30b4\u30eaID\u306b\u7d10\u3065\u304ftextarea\u3092\u3064\u3051\u308b\u3060\u3051\u306e\u30b7\u30f3\u30d7\u30eb\u306a\u62e1\u5f35\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u610f\u3002\nMetadata\u306eYaml\u3082\u4e00\u7dd2\u306b\u4f5c\u3063\u305f\u65b9\u304c\u5b89\u5168\u3067\u3059\u3002\n# app/Plugin/CategoryContent/Entity/CategoryContent.php\n<?php\n\nnamespace Plugin\\CatgeoryContent\\Entity;\n\nuse Eccube\\Entity\\Category;\n\nclass CategoryContent extends \\Eccube\\Entity\\AbstractEntity\n{\n    private $Category;\n\n    private $content;\n\n    public function setCategory(Category $Category)\n    {\n        $this->Category = $Category;\n\n        return $this;\n    }\n\n    public function getCategory()\n    {\n        return $this->Category;\n    }\n\n    public function setContent($content)\n    {\n        $this->content = $content;\n\n        return $this;\n    }\n\n    public function getContent()\n    {\n        return $this->content;\n    }\n}\n\n# app/Plugin/CategoryContent/Resource/doctrine/Plugin.CategoryContent.Entity.CategoryContent.dcm.yml\nPlugin\\CategoryContent\\Entity\\CategoryContent:\n    type: entity\n    table: category_content\n    repositoryClass: Plugin\\CategoryContent\\Repository\\CategoryContent\n    id:\n        category_id:\n            type: smallint\n            nullable: false\n            unsigned: false\n            id: true\n            generator:\n                strategy: NONE\n    fields:\n        content:\n            type: text\n            nullable: false\n        create_date:\n            type: datetime\n            nullable: false\n        update_date:\n            type: datetime\n            nullable: true\n    oneToOne:\n        Category:\n            targetEntity: Category\n            joinColumn:\n                name: category_id\n                referencedColumnName: category_id\n    lifecycleCallbacks: {  }\n\n\nRepository\u3092\u7528\u610f\n\u3064\u3065\u3044\u3066Repository\u3002\u3053\u3061\u3089\u306f\u6700\u521d\u306e\u3046\u3061\u306fEntity\u3067\u6307\u5b9a\u3057\u305fClass\u3092\u66f8\u3044\u3066\u304a\u304f\u3060\u3051\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\n# app/Plugin/CategoryContent/Repository/CatgeoryContentRepository.php\n<?php\n\nnamespace Plugin\\CategoryContent\\Repository;\n\nuse Doctrine\\ORM\\EntityRepository;\n\nclass CategoryContentRepository extends EntityRepository\n{\n}\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u7fa9\n\u3055\u3066\u3001\u62e1\u5f35\u3057\u305fEntity\u3092DB\u306b\u767b\u9332\u3059\u308b\u305f\u3081\u306b\u3001PluginManager\u3068Migration\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u3066\u3001DB\u3068\u306e\u758e\u901a\u30c6\u30b9\u30c8\uff0b\u767b\u9332\u3092\u304a\u3053\u306a\u3044\u307e\u3059\u3002\n\u3056\u3063\u3068\u3072\u306a\u5f62\u3092\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n<?php\n\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Plugin\\AbstractPluginManager;\n\nclass PluginManager extends AbstractPluginManager\n{\n\n    public function install($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code']);\n    }\n\n    public function uninstall($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code'], 0);\n    }\n\n    public function enable($config, $app)\n    {\n    }\n\n    public function disable($config, $app)\n    {\n    }\n\n    public function update($config, $app)\n    {\n    }\n}\n\n<?php\n# app/Plugin/CategoryContent/Migration/Version20150706204400.php\n\nnamespace DoctrineMigrations;\n\nuse Doctrine\\DBAL\\Migrations\\AbstractMigration;\nuse Doctrine\\DBAL\\Schema\\Schema;\n\nclass Version20150706204400 extends AbstractMigration\n{\n\n    public function up(Schema $schema)\n    {\n        $this->createDtbCategoyContentPlugin($schema);\n    }\n\n    public function down(Schema $schema)\n    {\n        $schema->dropTable('category_content');\n    }\n\n    protected function createDtbCategoryContentPlugin(Schema $schema)\n    {\n        $table = $schema->createTable(\"category_contnet\");\n        $table\n            ->addColumn('category_id', 'integer', array(\n                'notnull' => true,\n            ))\n            ->addColumn('content', 'text')\n        ;\n    }\n}\n\n\u3053\u3061\u3089\u3092\u7528\u610f\u3057\u3066\u3001tar.gz\u3092\u4f5c\u3063\u305f\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nForm\\Extension\u306e\u4f5c\u6210\n\u7d9a\u3044\u3066\u3001\u30ab\u30c6\u30b4\u30ea\u767b\u9332\u30da\u30fc\u30b8\u306e\u3001\u3055\u304d\u307b\u3069\u306e\u753b\u50cf\u306e\u3068\u3053\u308d\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3001 Form\\Extension \u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u3061\u3089\u3082\uff11\u30ab\u30e9\u30e0\u8ffd\u52a0\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u3002\ngetExtendedType() \u306b\u306f\u3001Extend\u3057\u305f\u3044\u3084\u3064\u3092\u6307\u5b9a\u3057\u3066\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n\u6307\u5b9a\u3057\u305f\u3068\u3053\u308d\u304c\u52dd\u624b\u306b\u62e1\u5f35\u3055\u308c\u307e\u3059\u3002\n\u3067\u3082\u89aa\u5074\u3067bind\u3055\u308c\u305f\u304f\u306a\u3044\u306e\u3067 'mapped' => false \u306b\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\n# app/Plugin/CategoryContent/Form/Extension/CategoryContentExtension.php\n<?php\n\nnamespace Plugin\\CategoryContent\\Form\\Extension;\n\nuse Symfony\\Component\\Form\\AbstractTypeExtension;\nuse Symfony\\Component\\Form\\FormBuilderInterface;\n\nclass CategoryContentExtension extends AbstractTypeExtension\n{\n    public function buildForm(FormBuilderInterface $builder)\n    {\n        $builder\n            ->add('content', 'textarea', array(\n                'lable' => '\u30ab\u30c6\u30b4\u30ea\u5225\u8868\u793a\u7528\u30b3\u30f3\u30c6\u30f3\u30c4',\n                'mapped' => false,\n            ))\n        ;\n    }\n\n    public function getExtendedType()\n    {\n        return 'category';\n    }\n}\n\n\u5fd8\u308c\u306a\u3044\u3046\u3061\u306b ServiceProvider \u306b\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u5fd8\u308c\u3066\u305f\u306e\u3067\u3001Repository\u3082\u767b\u9332\u3057\u307e\u3059\u3002\n\u767b\u9332\u3057\u3066\u306a\u3044\u306e\u306b\u300c\u52d5\u304b\u306a\u3044\uff01\uff91\uff77\uff70\u300d\u3063\u3066\u306a\u308b\u3053\u3068\u7d50\u69cb\u3042\u308a\u307e\u3059\u3002\u30de\u30b8\u3067\u3002\u304a\u306f\u3084\u3081\u306e\u767b\u9332\u3092\u3002\n# app/Plugin/CategoryContent/ServiceProvider/CategoryContentServiceProvider.php\n<?php\n\nnamespace Plugin\\CategoryContent\\ServiceProvider;\n\nuse Eccube\\Application;\nuse Silex\\Application as BaseApplication;\nuse Silex\\ServiceProviderInterface;\n\nclass CategoryContentServiceProvider implements ServiceProviderInterface\n{\n    public function register(BaseApplication $app)\n    {\n        // Form/Extension\n        $app['form.type.extensions'] = $app->share($app->extend('form.type.extensions', function ($extensions) {\n            $extensions[] = new \\Plugin\\CategoryContent\\Form\\Extension\\CategoryContentExtension();\n\n            return $extensions;\n        }));\n\n        //Repository\n        $app['category_content.repository.category_content'] = $app->share(function () use ($app) {\n            return $app['orm.em']->getRepository('Plugin\\CategoryContent\\Entity\\CategoryContent');\n        });\n\n\n    }\n\n    public function boot(BaseApplication $app)\n    {\n    }\n}\n\n\u3055\u3063\u304d\u304b\u3089\u601d\u3063\u3066\u307e\u3059\u304c\u3001 category_content \u3063\u3066\u9577\u3044\u3002\n\nView\u306e\u62e1\u5f35\n\u3055\u3066\u3001 {{ form_widget(form) }} \u3067\u51fa\u529b\u3057\u3066\u308b\u5834\u5408\u306f\u3001View\u306e\u62e1\u5f35\u304c\u307b\u3068\u3093\u3069\u3044\u3089\u306a\u3044\u3093\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306f\u30c7\u30b6\u30a4\u30ca\u306b\u898b\u3048\u306a\u304f\u306a\u308b\u3053\u3068\u3092\u9632\u3050\u305f\u3081\u306b\u3001\u4e00\u500b\u4e00\u500b\u5206\u89e3\u3057\u3066\u8a18\u8ff0\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u8ffd\u52a0\u3057\u305fForm\u3092Render\u3057\u3066\u3042\u3052\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\nevent.yml \u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5b9a\u7fa9\u3057\u3066\u3001 kernel.response \u306b\u30a4\u30d9\u30f3\u30c8\u3092\u77e5\u3089\u305b\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\n\u66f8\u304d\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n# app/Plugin/CategoryContent/event.yml\neccube.event.render.admin_product_category_edit.before:\n    - [onRenderAdminProductCategoryEditBefore, NORMAL]\n\n\u9577\u3044!!\n\u3053\u308c\u3067\u3001 admin_product_category_edit \u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3067\u304d\u305f\u3068\u304d\u306bRender\u30a4\u30d9\u30f3\u30c8\u304c\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\n\u308f\u305f\u3063\u3066\u304f\u308b\u5f15\u6570\u306f Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent \u578b\u3067\u3059\u3002\n\u3053\u3044\u3064\u304b\u3089Response\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u3055\u3089\u306b\u305d\u3053\u304b\u3089HTML\u306e\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u308a\u3060\u3057\u3066\u304d\u307e\u3059\u3002\n$event->getResponse()->getContent()\n\u305d\u3057\u3066\u66f4\u306b\u3001\u30b3\u30cd\u30b3\u30cd\u3057\u307e\u3059\u3002\n\u30b3\u30cd\u30b3\u30cd\u306e\u4ed5\u65b9\u306fSymfony/DomCrawler\u3064\u304b\u3063\u3066\u3082\u3088\u3057\u3001DomDocument\u4f7f\u3063\u3066\u3082\u3088\u3057\u3001replace\u3057\u3066\u3082\u3088\u3057\u3002\uff08replace\u306f\u30aa\u30b9\u30b9\u30e1\u3067\u304d\u307e\u305b\u3093\uff09\n<?php\n\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Event\\RenderEvent;\nuse Eccube\\Event\\ShoppingEvent;\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\nuse Symfony\\Component\\CssSelector\\CssSelector;\n\nclass CategoryContent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function onRenderAdminProductCategoryEditBefore(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n\n        // DomCrawler\u306bHTML\u3092\u98df\u308f\u305b\u308b\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n        $form->handleRequest($request);\n        $twig = $app->renderView(\n            'CategoryContent/Resource/template/Admin/category.twig',\n            array('form' => $form->createView())\n        );\n\n        $oldHtml = $crawler\n            ->filter('form')\n            ->first()\n            ->html()\n        ;\n        $newHtml = $oldHtml . $twig;\n\n        // DomCrawler\u304b\u3089HTML\u3092\u5410\u304d\u51fa\u3059\n        $html = $crawler->html();\n        $html = str_replace($oldHtml, $newHtml, $html);\n\n        $response->setContent($html);\n        $event->setResponse($response);\n    }\n\n}\n\n\u30b3\u30cd\u30b3\u30cd\u3059\u308b\u524d\u306b\u9069\u5f53\u306b\u52a0\u5de5\u3057\u3066\u3001\u8868\u793a\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\u3055\u3089\u306b\u3001\u8aad\u307f\u8fbc\u3080View\u3092\u3053\u3093\u306a\u611f\u3058\u306b\u5b9a\u7fa9\u3057\u3068\u304d\u307e\u3059\u3002\n<!-- app/Plugin/CategoryContent/Resource/template/admin/category.twig -->\n<br />\n<div class=\"form-group\">\n    {{ form_label(form.content) }}\n    <div class=\"col-sm-9 col-lg-10\" style=\"margin-top: 20px;\">\n        {{ form_widget(form.content, { attr : { 'rows' : 15, style : 'font-size:12px' } }) }}\n        {{ form_errors(form.content) }}\n    </div>\n</div>\n\n\u3053\u3053\u307e\u3067\u3067\u3060\u3044\u305f\u3044\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u753b\u9762\u306fBootstrap\u3092\u5d29\u3057\u3066HTML\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\n\u3042\u307e\u308a\u3044\u3044\u611f\u3058\u3058\u3083\u306a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u7ba1\u7406\u753b\u9762\u306f\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u767b\u9332\u3059\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\n\u5f8c\u51e6\u7406\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u8ffd\u52a0\n\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u30c7\u30fc\u30bf\u4fdd\u7ba1\u3059\u308b\u305f\u3081\u306b\u3001\u5f8c\u51e6\u7406\u7528\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u4f7f\u3044\u307e\u3059\u3002\nevent.yml \u306b\u8ffd\u8a18\u3057\u3066\u3042\u3052\u307e\u3059\u3002\neccube.event.controller.admin_product_category.after:\n    - [onAdminProductCategoryEditAfter, NORMAL]\neccube.event.controller.admin_product_category_edit.after:\n    - [onAdminProductCategoryEditAfter, NORMAL]\n\n\u305d\u3057\u3066\u3001\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\uff12\u65e5\u3057\u304b\u306a\u3044\u306e\u3067\u30bd\u30fc\u30b9\u304c\u6c5a\u3044\u306e\u306f\u52d8\u5f01\u3057\u3066\u304f\u3060\u3055\u3044m(_ _)m\n<?php\n# app/Plugin/CategoryContent/CategoryContent.php\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Event\\RenderEvent;\nuse Eccube\\Event\\ShoppingEvent;\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\nuse Symfony\\Component\\CssSelector\\CssSelector;\n\nclass CategoryContent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function onRenderAdminProductCategoryEditBefore(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n        $id = $request->attributes->get('id');\n\n        // DomCrawler\u306bHTML\u3092\u98df\u308f\u305b\u308b\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $CategoryContent = $app['category_content.repository.category_content']->find($id);\n        if (is_null($CategoryContent)) {\n            $CategoryContent = new \\Plugin\\CategoryContent\\Entity\\CategoryContent();\n        }\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n        $form->get('content')->setData($CategoryContent->getContent());\n        $form->handleRequest($request);\n\n        $twig = $app->renderView(\n            'CategoryContent/Resource/template/Admin/category.twig',\n            array('form' => $form->createView())\n        );\n\n        $oldCrawler = $crawler\n            ->filter('form')\n            ->first();\n\n        // DomCrawler\u304b\u3089HTML\u3092\u5410\u304d\u51fa\u3059\n        $html = $crawler->html();\n        $oldHtml = '';\n        $newHtml = '';\n        if (count($oldCrawler) > 0) {\n            $oldHtml = $oldCrawler->html();\n            $newHtml = $oldHtml . $twig;\n        }\n\n        $html = str_replace($oldHtml, $newHtml, $html);\n\n        $response->setContent($html);\n        $event->setResponse($response);\n    }\n\n    public function onAdminProductCategoryEditAfter()\n    {\n        $app = $this->app;\n        $id = $app['request']->attributes->get('id');\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n\n        $CategoryContent = $app['category_content.repository.category_content']->find($id);\n        if (is_null($CategoryContent)) {\n            $CategoryContent = new \\Plugin\\CategoryContent\\Entity\\CategoryContent();\n        }\n        $form->get('content')->setData($CategoryContent->getContent());\n\n        $form->handleRequest($app['request']);\n\n        if ('POST' === $app['request']->getMethod()) {\n            if ($form->isValid()) {\n                $content = $form->get('content')->getData();\n\n                $Category = $app['eccube.repository.category']->find($id);\n\n                $CategoryContent\n                    ->setCategoryId($Category->getId())\n                    ->setCategory($Category)\n                    ->setContent($content);\n\n                $app['orm.em']->persist($CategoryContent);\n                $app['orm.em']->flush();\n            }\n        }\n    }\n\n}\n\n\u7ba1\u7406\u753b\u9762\u306f\u8352\u524a\u308a\u3067\u3059\u304c\u3001\u4ee5\u4e0a\u3067\u3059\u3002\n\uff12\u65e5\u76ee\u306f\u30d5\u30ed\u30f3\u30c8\u753b\u9762\u306e\u62e1\u5f35\u3092\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u691c\u8a3c\u4ee5\u5916\u3067\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u62e1\u5f35\u304c\u521d\u3081\u3066\u3001\u304b\u3064\u3001\u4eca\u56de\u3082\u691c\u8a3c\u306e\u610f\u5473\u5408\u3044\u304c\u5927\u304d\u3044\u306e\u3067\u30bd\u30fc\u30b9\u304c\u591a\u5c11\u8352\u3063\u307d\u3044\u306e\u306f\u3054\u4e86\u627f\u306d\u304c\u3044\u307e\u3059\uff4d\uff4d\n# \u306f\u3058\u3081\u306b\n\n_\u8ffd\u8a18\u578b\u3067\u3069\u3093\u3069\u3093\u30a2\u30d7\u30c7\u3057\u3066\u3044\u304d\u307e\u3059\u3002_\n_\u7528\u8a9e\u304c\u591a\u304f\u3066\u30eb\u30fc\u5927\u67f4\u307f\u305f\u3044\u306b\u306a\u308a\u307e\u3059\u3002_\n\n\u4f5c\u696d\u30ea\u30dd\u30b8\u30c8\u30ea\u306f[\u3053\u3061\u3089](https://github.com/shinichi-takahashi/eccube3-sample-plugin/tree/CategoryContent/CategoryContent)\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u5229\u7528\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306f[\u3053\u3061\u3089](http://qiita.com/shinichi-takahashi/items/042e88ac37e635e925b2)\n\n_2\u65e5\u76ee\u3067\u304d\u307e\u3057\u305f_ [\u3053\u3061\u3089](http://qiita.com/shinichi-takahashi/items/edab0ded969860af58cb)\n\n## \u76ee\u7684\n\n* \u30aa\u30fc\u30ca\u30fc\u30ba\u30b9\u30c8\u30a2\u306b\u5546\u54c1\u3092\u5897\u3084\u3057\u305f\u3044\u3002\n* \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\u958b\u767a\u8005\u306b\u5411\u3051\u3066\u3001\u624b\u52a9\u3051\u306b\u306a\u308b\u8a18\u4e8b\u306b\u3057\u305f\u3044\u3002\n* EC-CUBE3\u672c\u4f53\u3067\u3001\u8db3\u308a\u306a\u3044\u7b87\u6240\u3092\u6d17\u3044\u51fa\u3057\u305f\u3044\u3002\n\n# EC-CUBE3\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\uff12\u65e5\u3067\u3064\u304f\u308b - 1\u65e5\u76ee\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u4f5c\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u307e\u305a\u306f\u3069\u3093\u306a\u3082\u306e\u4f5c\u308b\u304b\u3063\u3066\u3068\u3053\u308d\u304b\u3089\u3002\n\n## \u69cb\u60f3\n\n\u30ab\u30c6\u30b4\u30ea\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u3044\u3046EC-CUBE2\u7cfb\u3067\u3042\u3063\u305f\u30d7\u30e9\u30b0\u30a4\u30f3\u3092ver.3\u306b\u3042\u308f\u305b\u3066\u4f5c\u308a\u5909\u3048\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u8a2d\u8a08\u3068\u3044\u3046\u307b\u3069\u306e\u3082\u306e\u3067\u306f\u306a\u3044\u3067\u3059\u304c\u3001\u5229\u7528\u3059\u308bEvent\u306f\u304a\u304a\u307e\u304b\u306b\u306f\u4ee5\u4e0b\u306a\u611f\u3058\u3002\n\n* Entity\u62e1\u5f35\uff1a\u72ec\u81ea\u306e\u3082\u306e\u3092\u5b9a\u7fa9\n* View\u62e1\u5f35\uff1aSymfony/kernel.response\n\n\u3053\u308c\u3089\u3092\u8ef8\u306b\u5fc5\u8981\u306a\u3082\u306e\u3092\u8089\u4ed8\u3051\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n### \u30ab\u30c6\u30b4\u30ea\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306f\uff1f\n\n\u30ab\u30c6\u30b4\u30ea\u3054\u3068\u306b\u30c7\u30b6\u30a4\u30f3\u3092\u5909\u3048\u305f\u3044\uff01\u305d\u3093\u306a\u3042\u306a\u305f\u306b\uff01\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\n\u5b8c\u6210\u5f8c\u306b\u753b\u50cf\u3092\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\n\n### Entity\u62e1\u5f35\n\n\u4f55\u3092\u3084\u308b\u306b\u3082\u307e\u305a\u306fEntity\u304b\u3089\u4f5c\u308a\u307e\u3059\u3002\n\uff08\u4f5c\u308b\u9806\u756a\u306f\u597d\u307f\u3067\u3059\uff09\n\n1. Entity\n2. Repository\n3. Form\\Type, Form\\Extension\n4. Twig\n\n\u306e\u9806\u3067\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30ab\u30c6\u30b4\u30ea\u30da\u30fc\u30b8( http://example.com/products/list?category_id=X )\u306b\u7d10\u3065\u304f\u62e1\u5f35\u306a\u306e\u3067\u3001\n\u30ab\u30c6\u30b4\u30ea\u7de8\u96c6\u753b\u9762\u5074\u304b\u3089\u3064\u304f\u308a\u307e\u3059\u3002\n\n\u753b\u50cf\u306e\u77e2\u5370\u306e\u4f4d\u7f6e\u306b\u5165\u308c\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n![Screen Shot 2015-07-06 at 13.56.54.png](https://qiita-image-store.s3.amazonaws.com/0/73113/4ef126f3-5e7d-0384-06a8-9893543a0bf7.png)\n\n\u307e\u305a\u306f\u30df\u30cb\u30de\u30e0\u306b\u3002\u30ab\u30c6\u30b4\u30eaID\u306b\u7d10\u3065\u304ftextarea\u3092\u3064\u3051\u308b\u3060\u3051\u306e\u30b7\u30f3\u30d7\u30eb\u306a\u62e1\u5f35\u30c6\u30fc\u30d6\u30eb\u3092\u7528\u610f\u3002\nMetadata\u306eYaml\u3082\u4e00\u7dd2\u306b\u4f5c\u3063\u305f\u65b9\u304c\u5b89\u5168\u3067\u3059\u3002\n\n```php\n# app/Plugin/CategoryContent/Entity/CategoryContent.php\n<?php\n\nnamespace Plugin\\CatgeoryContent\\Entity;\n\nuse Eccube\\Entity\\Category;\n\nclass CategoryContent extends \\Eccube\\Entity\\AbstractEntity\n{\n    private $Category;\n\n    private $content;\n\n    public function setCategory(Category $Category)\n    {\n        $this->Category = $Category;\n\n        return $this;\n    }\n\n    public function getCategory()\n    {\n        return $this->Category;\n    }\n\n    public function setContent($content)\n    {\n        $this->content = $content;\n\n        return $this;\n    }\n\n    public function getContent()\n    {\n        return $this->content;\n    }\n}\n```\n\n```yaml\n# app/Plugin/CategoryContent/Resource/doctrine/Plugin.CategoryContent.Entity.CategoryContent.dcm.yml\nPlugin\\CategoryContent\\Entity\\CategoryContent:\n    type: entity\n    table: category_content\n    repositoryClass: Plugin\\CategoryContent\\Repository\\CategoryContent\n    id:\n        category_id:\n            type: smallint\n            nullable: false\n            unsigned: false\n            id: true\n            generator:\n                strategy: NONE\n    fields:\n        content:\n            type: text\n            nullable: false\n        create_date:\n            type: datetime\n            nullable: false\n        update_date:\n            type: datetime\n            nullable: true\n    oneToOne:\n        Category:\n            targetEntity: Category\n            joinColumn:\n                name: category_id\n                referencedColumnName: category_id\n    lifecycleCallbacks: {  }\n```\n\n### Repository\u3092\u7528\u610f\n\n\u3064\u3065\u3044\u3066Repository\u3002\u3053\u3061\u3089\u306f\u6700\u521d\u306e\u3046\u3061\u306fEntity\u3067\u6307\u5b9a\u3057\u305fClass\u3092\u66f8\u3044\u3066\u304a\u304f\u3060\u3051\u3067\u5927\u4e08\u592b\u3067\u3059\u3002\n\n```php\n# app/Plugin/CategoryContent/Repository/CatgeoryContentRepository.php\n<?php\n\nnamespace Plugin\\CategoryContent\\Repository;\n\nuse Doctrine\\ORM\\EntityRepository;\n\nclass CategoryContentRepository extends EntityRepository\n{\n}\n```\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u7528\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u7fa9\n\n\u3055\u3066\u3001\u62e1\u5f35\u3057\u305fEntity\u3092DB\u306b\u767b\u9332\u3059\u308b\u305f\u3081\u306b\u3001PluginManager\u3068Migration\u30d5\u30a1\u30a4\u30eb\u3092\u8a18\u8f09\u3057\u3066\u3001DB\u3068\u306e\u758e\u901a\u30c6\u30b9\u30c8\uff0b\u767b\u9332\u3092\u304a\u3053\u306a\u3044\u307e\u3059\u3002\n\n\u3056\u3063\u3068\u3072\u306a\u5f62\u3092\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n```php\n<?php\n\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Plugin\\AbstractPluginManager;\n\nclass PluginManager extends AbstractPluginManager\n{\n\n    public function install($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code']);\n    }\n\n    public function uninstall($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code'], 0);\n    }\n\n    public function enable($config, $app)\n    {\n    }\n\n    public function disable($config, $app)\n    {\n    }\n\n    public function update($config, $app)\n    {\n    }\n}\n```\n\n```php\n<?php\n# app/Plugin/CategoryContent/Migration/Version20150706204400.php\n\nnamespace DoctrineMigrations;\n\nuse Doctrine\\DBAL\\Migrations\\AbstractMigration;\nuse Doctrine\\DBAL\\Schema\\Schema;\n\nclass Version20150706204400 extends AbstractMigration\n{\n\n    public function up(Schema $schema)\n    {\n        $this->createDtbCategoyContentPlugin($schema);\n    }\n\n    public function down(Schema $schema)\n    {\n        $schema->dropTable('category_content');\n    }\n\n    protected function createDtbCategoryContentPlugin(Schema $schema)\n    {\n        $table = $schema->createTable(\"category_contnet\");\n        $table\n            ->addColumn('category_id', 'integer', array(\n                'notnull' => true,\n            ))\n            ->addColumn('content', 'text')\n        ;\n    }\n}\n```\n\n\u3053\u3061\u3089\u3092\u7528\u610f\u3057\u3066\u3001tar.gz\u3092\u4f5c\u3063\u305f\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n### Form\\Extension\u306e\u4f5c\u6210\n\n\u7d9a\u3044\u3066\u3001\u30ab\u30c6\u30b4\u30ea\u767b\u9332\u30da\u30fc\u30b8\u306e\u3001\u3055\u304d\u307b\u3069\u306e\u753b\u50cf\u306e\u3068\u3053\u308d\u306b\u30c7\u30fc\u30bf\u3092\u5165\u308c\u305f\u3044\u306e\u3067\u3001 `Form\\Extension` \u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\u3053\u3061\u3089\u3082\uff11\u30ab\u30e9\u30e0\u8ffd\u52a0\u3059\u308b\u3060\u3051\u306a\u306e\u3067\u30b7\u30f3\u30d7\u30eb\u306b\u3002\n`getExtendedType()` \u306b\u306f\u3001Extend\u3057\u305f\u3044\u3084\u3064\u3092\u6307\u5b9a\u3057\u3066\u3084\u308a\u307e\u3057\u3087\u3046\u3002\n\u6307\u5b9a\u3057\u305f\u3068\u3053\u308d\u304c\u52dd\u624b\u306b\u62e1\u5f35\u3055\u308c\u307e\u3059\u3002\n\u3067\u3082\u89aa\u5074\u3067bind\u3055\u308c\u305f\u304f\u306a\u3044\u306e\u3067 `'mapped' => false` \u306b\u3057\u3066\u304a\u3044\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\n\n```php\n# app/Plugin/CategoryContent/Form/Extension/CategoryContentExtension.php\n<?php\n\nnamespace Plugin\\CategoryContent\\Form\\Extension;\n\nuse Symfony\\Component\\Form\\AbstractTypeExtension;\nuse Symfony\\Component\\Form\\FormBuilderInterface;\n\nclass CategoryContentExtension extends AbstractTypeExtension\n{\n    public function buildForm(FormBuilderInterface $builder)\n    {\n        $builder\n            ->add('content', 'textarea', array(\n                'lable' => '\u30ab\u30c6\u30b4\u30ea\u5225\u8868\u793a\u7528\u30b3\u30f3\u30c6\u30f3\u30c4',\n                'mapped' => false,\n            ))\n        ;\n    }\n\n    public function getExtendedType()\n    {\n        return 'category';\n    }\n}\n```\n\n\u5fd8\u308c\u306a\u3044\u3046\u3061\u306b `ServiceProvider` \u306b\u8a18\u8f09\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u5fd8\u308c\u3066\u305f\u306e\u3067\u3001Repository\u3082\u767b\u9332\u3057\u307e\u3059\u3002\n\n_\u767b\u9332\u3057\u3066\u306a\u3044\u306e\u306b\u300c\u52d5\u304b\u306a\u3044\uff01\uff91\uff77\uff70\u300d\u3063\u3066\u306a\u308b\u3053\u3068\u7d50\u69cb\u3042\u308a\u307e\u3059\u3002\u30de\u30b8\u3067\u3002\u304a\u306f\u3084\u3081\u306e\u767b\u9332\u3092\u3002_\n\n```php\n# app/Plugin/CategoryContent/ServiceProvider/CategoryContentServiceProvider.php\n<?php\n\nnamespace Plugin\\CategoryContent\\ServiceProvider;\n\nuse Eccube\\Application;\nuse Silex\\Application as BaseApplication;\nuse Silex\\ServiceProviderInterface;\n\nclass CategoryContentServiceProvider implements ServiceProviderInterface\n{\n    public function register(BaseApplication $app)\n    {\n        // Form/Extension\n        $app['form.type.extensions'] = $app->share($app->extend('form.type.extensions', function ($extensions) {\n            $extensions[] = new \\Plugin\\CategoryContent\\Form\\Extension\\CategoryContentExtension();\n\n            return $extensions;\n        }));\n\n        //Repository\n        $app['category_content.repository.category_content'] = $app->share(function () use ($app) {\n            return $app['orm.em']->getRepository('Plugin\\CategoryContent\\Entity\\CategoryContent');\n        });\n\n\n    }\n\n    public function boot(BaseApplication $app)\n    {\n    }\n}\n```\n\u3055\u3063\u304d\u304b\u3089\u601d\u3063\u3066\u307e\u3059\u304c\u3001 `category_content` \u3063\u3066\u9577\u3044\u3002\n\n\n### View\u306e\u62e1\u5f35\n\n\u3055\u3066\u3001 `{{ form_widget(form) }}` \u3067\u51fa\u529b\u3057\u3066\u308b\u5834\u5408\u306f\u3001View\u306e\u62e1\u5f35\u304c\u307b\u3068\u3093\u3069\u3044\u3089\u306a\u3044\u3093\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306f\u30c7\u30b6\u30a4\u30ca\u306b\u898b\u3048\u306a\u304f\u306a\u308b\u3053\u3068\u3092\u9632\u3050\u305f\u3081\u306b\u3001\u4e00\u500b\u4e00\u500b\u5206\u89e3\u3057\u3066\u8a18\u8ff0\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u8ffd\u52a0\u3057\u305fForm\u3092Render\u3057\u3066\u3042\u3052\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\n`event.yml` \u306b\u30a4\u30d9\u30f3\u30c8\u3092\u5b9a\u7fa9\u3057\u3066\u3001 `kernel.response` \u306b\u30a4\u30d9\u30f3\u30c8\u3092\u77e5\u3089\u305b\u3066\u3042\u3052\u307e\u3057\u3087\u3046\u3002\n\u66f8\u304d\u65b9\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\u3002\n\n```yaml\n# app/Plugin/CategoryContent/event.yml\neccube.event.render.admin_product_category_edit.before:\n    - [onRenderAdminProductCategoryEditBefore, NORMAL]\n```\n\n**\u9577\u3044!!**\n\n\u3053\u308c\u3067\u3001 `admin_product_category_edit` \u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3067\u304d\u305f\u3068\u304d\u306bRender\u30a4\u30d9\u30f3\u30c8\u304c\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002\n\u308f\u305f\u3063\u3066\u304f\u308b\u5f15\u6570\u306f `Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent` \u578b\u3067\u3059\u3002\n\n\u3053\u3044\u3064\u304b\u3089Response\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3001\u3055\u3089\u306b\u305d\u3053\u304b\u3089HTML\u306e\u30c7\u30fc\u30bf\u3092\u5f15\u3063\u5f35\u308a\u3060\u3057\u3066\u304d\u307e\u3059\u3002\n`$event->getResponse()->getContent()`\n\n\u305d\u3057\u3066\u66f4\u306b\u3001\u30b3\u30cd\u30b3\u30cd\u3057\u307e\u3059\u3002\n\u30b3\u30cd\u30b3\u30cd\u306e\u4ed5\u65b9\u306fSymfony/DomCrawler\u3064\u304b\u3063\u3066\u3082\u3088\u3057\u3001DomDocument\u4f7f\u3063\u3066\u3082\u3088\u3057\u3001replace\u3057\u3066\u3082\u3088\u3057\u3002\uff08replace\u306f\u30aa\u30b9\u30b9\u30e1\u3067\u304d\u307e\u305b\u3093\uff09\n\n```php\n<?php\n\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Event\\RenderEvent;\nuse Eccube\\Event\\ShoppingEvent;\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\nuse Symfony\\Component\\CssSelector\\CssSelector;\n\nclass CategoryContent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function onRenderAdminProductCategoryEditBefore(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n\n        // DomCrawler\u306bHTML\u3092\u98df\u308f\u305b\u308b\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n        $form->handleRequest($request);\n        $twig = $app->renderView(\n            'CategoryContent/Resource/template/Admin/category.twig',\n            array('form' => $form->createView())\n        );\n\n        $oldHtml = $crawler\n            ->filter('form')\n            ->first()\n            ->html()\n        ;\n        $newHtml = $oldHtml . $twig;\n\n        // DomCrawler\u304b\u3089HTML\u3092\u5410\u304d\u51fa\u3059\n        $html = $crawler->html();\n        $html = str_replace($oldHtml, $newHtml, $html);\n\n        $response->setContent($html);\n        $event->setResponse($response);\n    }\n\n}\n```\n\n\u30b3\u30cd\u30b3\u30cd\u3059\u308b\u524d\u306b\u9069\u5f53\u306b\u52a0\u5de5\u3057\u3066\u3001\u8868\u793a\u3067\u304d\u308b\u304b\u3069\u3046\u304b\u306e\u30c6\u30b9\u30c8\u3092\u3057\u3066\u304a\u304f\u3068\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3055\u3089\u306b\u3001\u8aad\u307f\u8fbc\u3080View\u3092\u3053\u3093\u306a\u611f\u3058\u306b\u5b9a\u7fa9\u3057\u3068\u304d\u307e\u3059\u3002\n\n```html\n<!-- app/Plugin/CategoryContent/Resource/template/admin/category.twig -->\n<br />\n<div class=\"form-group\">\n    {{ form_label(form.content) }}\n    <div class=\"col-sm-9 col-lg-10\" style=\"margin-top: 20px;\">\n        {{ form_widget(form.content, { attr : { 'rows' : 15, style : 'font-size:12px' } }) }}\n        {{ form_errors(form.content) }}\n    </div>\n</div>\n```\n\n\u3053\u3053\u307e\u3067\u3067\u3060\u3044\u305f\u3044\u3053\u3093\u306a\u611f\u3058\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u3053\u306e\u753b\u9762\u306fBootstrap\u3092\u5d29\u3057\u3066HTML\u304c\u8a18\u8ff0\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\n\u3042\u307e\u308a\u3044\u3044\u611f\u3058\u3058\u3083\u306a\u3044\u3067\u3059\u304c\u3001\u4eca\u56de\u306f\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\n\n![Screen Shot 2015-07-06 at 20.28.32.png](https://qiita-image-store.s3.amazonaws.com/0/73113/8d510c4d-8fae-5dc8-1ff1-4d0f78ab45a6.png)\n\n\u3053\u3053\u307e\u3067\u304d\u305f\u3089\u7ba1\u7406\u753b\u9762\u306f\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u767b\u9332\u3059\u308b\u3060\u3051\u3067\u3059\u306d\u3002\n\n\n### \u5f8c\u51e6\u7406\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306e\u8ffd\u52a0\n\n\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u30c7\u30fc\u30bf\u4fdd\u7ba1\u3059\u308b\u305f\u3081\u306b\u3001\u5f8c\u51e6\u7406\u7528\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u4f7f\u3044\u307e\u3059\u3002\n`event.yml` \u306b\u8ffd\u8a18\u3057\u3066\u3042\u3052\u307e\u3059\u3002\n\n```yaml\neccube.event.controller.admin_product_category.after:\n    - [onAdminProductCategoryEditAfter, NORMAL]\neccube.event.controller.admin_product_category_edit.after:\n    - [onAdminProductCategoryEditAfter, NORMAL]\n```\n\n\u305d\u3057\u3066\u3001\u4e2d\u8eab\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\uff12\u65e5\u3057\u304b\u306a\u3044\u306e\u3067\u30bd\u30fc\u30b9\u304c\u6c5a\u3044\u306e\u306f\u52d8\u5f01\u3057\u3066\u304f\u3060\u3055\u3044m(_ _)m\n\n```php\n<?php\n# app/Plugin/CategoryContent/CategoryContent.php\nnamespace Plugin\\CategoryContent;\n\nuse Eccube\\Event\\RenderEvent;\nuse Eccube\\Event\\ShoppingEvent;\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\nuse Symfony\\Component\\CssSelector\\CssSelector;\n\nclass CategoryContent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function onRenderAdminProductCategoryEditBefore(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n        $id = $request->attributes->get('id');\n\n        // DomCrawler\u306bHTML\u3092\u98df\u308f\u305b\u308b\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $CategoryContent = $app['category_content.repository.category_content']->find($id);\n        if (is_null($CategoryContent)) {\n            $CategoryContent = new \\Plugin\\CategoryContent\\Entity\\CategoryContent();\n        }\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n        $form->get('content')->setData($CategoryContent->getContent());\n        $form->handleRequest($request);\n\n        $twig = $app->renderView(\n            'CategoryContent/Resource/template/Admin/category.twig',\n            array('form' => $form->createView())\n        );\n\n        $oldCrawler = $crawler\n            ->filter('form')\n            ->first();\n\n        // DomCrawler\u304b\u3089HTML\u3092\u5410\u304d\u51fa\u3059\n        $html = $crawler->html();\n        $oldHtml = '';\n        $newHtml = '';\n        if (count($oldCrawler) > 0) {\n            $oldHtml = $oldCrawler->html();\n            $newHtml = $oldHtml . $twig;\n        }\n\n        $html = str_replace($oldHtml, $newHtml, $html);\n\n        $response->setContent($html);\n        $event->setResponse($response);\n    }\n\n    public function onAdminProductCategoryEditAfter()\n    {\n        $app = $this->app;\n        $id = $app['request']->attributes->get('id');\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_category')\n            ->getForm();\n\n        $CategoryContent = $app['category_content.repository.category_content']->find($id);\n        if (is_null($CategoryContent)) {\n            $CategoryContent = new \\Plugin\\CategoryContent\\Entity\\CategoryContent();\n        }\n        $form->get('content')->setData($CategoryContent->getContent());\n\n        $form->handleRequest($app['request']);\n\n        if ('POST' === $app['request']->getMethod()) {\n            if ($form->isValid()) {\n                $content = $form->get('content')->getData();\n\n                $Category = $app['eccube.repository.category']->find($id);\n\n                $CategoryContent\n                    ->setCategoryId($Category->getId())\n                    ->setCategory($Category)\n                    ->setContent($content);\n\n                $app['orm.em']->persist($CategoryContent);\n                $app['orm.em']->flush();\n            }\n        }\n    }\n\n}\n```\n\n\u7ba1\u7406\u753b\u9762\u306f\u8352\u524a\u308a\u3067\u3059\u304c\u3001\u4ee5\u4e0a\u3067\u3059\u3002\n\uff12\u65e5\u76ee\u306f\u30d5\u30ed\u30f3\u30c8\u753b\u9762\u306e\u62e1\u5f35\u3092\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n_\u691c\u8a3c\u4ee5\u5916\u3067\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u62e1\u5f35\u304c\u521d\u3081\u3066\u3001\u304b\u3064\u3001\u4eca\u56de\u3082\u691c\u8a3c\u306e\u610f\u5473\u5408\u3044\u304c\u5927\u304d\u3044\u306e\u3067\u30bd\u30fc\u30b9\u304c\u591a\u5c11\u8352\u3063\u307d\u3044\u306e\u306f\u3054\u4e86\u627f\u306d\u304c\u3044\u307e\u3059\uff4d\uff4d_\n", "tags": ["EC-CUBE3"]}