{"context": "\nArticle (has-many notifications)\nComment (has-many notifications)\nMention (has-many notifications)\nNotification (belongs-to something)\n\n\u306e\u3088\u3046\u306a\u30e2\u30c7\u30eb\u3068\u305d\u308c\u3089\u306e\u95a2\u9023\u6027\u304c\u3042\u308b\u3068\u304d\u3001notifications\u30c6\u30fc\u30d6\u30eb\u306b\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ab\u30e9\u30e0\u304c\u3042\u308c\u3070\u3001Notification.belongs_to :source, polymorphic: true \u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067Polymorphic association\u304c\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nsource_id\nsource_type\n\n\u3057\u304b\u3057Notification\u306e\u8981\u4ef6\u304c\u5927\u304d\u304f\u306a\u308b\u306b\u3064\u308c\u3001\u95a2\u9023\u3059\u308b\u30e2\u30c7\u30eb\u306e\u7a2e\u985e\u306b\u3088\u3063\u3066\u6761\u4ef6\u5206\u5c90\u304c\u5897\u3048\u3066\u304f\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001Article\u306b\u95a2\u9023\u3059\u308bNotification\u3067\u306f\u3053\u306eValidation\u304c\u5fc5\u8981\u3060\u304c\u3001Comment\u306b\u95a2\u9023\u3059\u308bNotification\u3067\u306f\u4e0d\u8981\u3001\u306a\u3069\u3067\u3059\u3002\u305d\u3046\u3057\u305f\u5834\u5408\u3001Notification\u30af\u30e9\u30b9\u81ea\u4f53\u306btype\u30ab\u30e9\u30e0\u304c\u3042\u308c\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bSingle-Table-Inheritance\u3092\u5229\u7528\u3057\u306a\u304c\u3089\u5225\u3005\u306e\u30af\u30e9\u30b9\u3092\u7528\u610f\u3059\u308b\u3053\u3068\u3067\u3001\u5b9f\u88c5\u306e\u5b9a\u7fa9\u5834\u6240\u3092\u7dba\u9e97\u306b\u5206\u3051\u3089\u308c\u3066\u4fbf\u5229\u3067\u3059\u3002\n\nNotification\nArticleNotification < Notification\nCommentNotification < Notification\nMentionNotification < Notification\n\n\u3055\u3066\u3001\u3053\u3046\u306a\u308b\u3068 source_type \u306e\u5185\u5bb9\u3068 type \u306e\u5185\u5bb9\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001source_type \u30ab\u30e9\u30e0\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u307e\u3059\u3002ActiveRecord\u304c source_type \u306e\u5024\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u3092Override\u3059\u308b\u3053\u3068\u3067\u3001\u52d5\u7684\u306b\u5024\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002#[] \u306e\u5909\u66f4\u3060\u3051\u3067\u826f\u3044\u3088\u3046\u306b\u601d\u308f\u308c\u304c\u3061\u3067\u3059\u304c\u3001#_read_attribute \u306e\u5024\u304cActiveRecord\u5185\u90e8\u3067\u95a2\u9023\u30ec\u30b3\u30fc\u30c9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u7528\u306b\u5229\u7528\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3082\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nclass Notification < ActiveRecord::Base\n  # @note Override\n  def [](attribute_name)\n    if attribute_name.to_s == \"source_type\"\n      type.gsub(/Notification\\z/, \"\")\n    else\n      super\n    end\n  end\n\n  # @note Override\n  def _read_attribute(attribute_name)\n    if attribute_name == \"source_type\"\n      self[attribute_name]\n    else\n      super\n    end\n  end\nend\n\n\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u3001notifications\u30c6\u30fc\u30d6\u30eb\u306btype\u30ab\u30e9\u30e0\u3060\u3051\u3092\u7528\u610f\u3057\u306a\u304c\u3089\u3001STI\u3068Polymorphic association\u3092\u4f75\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u307e\u3042\u5b50\u30af\u30e9\u30b9\u3054\u3068\u306b belongs_to \u3092\u66f8\u3051\u3070Polymorphic association\u3068\u304b\u3084\u308b\u5fc5\u8981\u306a\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u4e00\u5fdc\u3053\u3046\u3044\u3046\u3084\u308a\u65b9\u3082\u3042\u308b\u3088\u3068\u3044\u3046\u3053\u3068\u3067\u3053\u3053\u306f\u3069\u3046\u304b\u2026\u3002\u4e0a\u4f8b\u306e\u5834\u5408\u3001\u53d7\u3051\u53d6\u3063\u305f\u901a\u77e5\u4e00\u89a7\u306a\u3069\u3067\u306eN+1\u30af\u30a8\u30ea\u304c\u554f\u984c\u306b\u306a\u308b\u3053\u3068\u304c\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u826f\u3051\u308c\u3070 ActiveRecord\u3067Polymorphic\u306bPreload\u3059\u308b - Qiita \u3082\u53c2\u8003\u306b\u3069\u3046\u305e\u3002\n- Article (has-many notifications)\n- Comment (has-many notifications)\n- Mention (has-many notifications)\n- Notification (belongs-to something)\n\n\u306e\u3088\u3046\u306a\u30e2\u30c7\u30eb\u3068\u305d\u308c\u3089\u306e\u95a2\u9023\u6027\u304c\u3042\u308b\u3068\u304d\u3001notifications\u30c6\u30fc\u30d6\u30eb\u306b\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ab\u30e9\u30e0\u304c\u3042\u308c\u3070\u3001`Notification.belongs_to :source, polymorphic: true` \u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067Polymorphic association\u304c\u5b9f\u73fe\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n- source_id\n- source_type\n\n\u3057\u304b\u3057Notification\u306e\u8981\u4ef6\u304c\u5927\u304d\u304f\u306a\u308b\u306b\u3064\u308c\u3001\u95a2\u9023\u3059\u308b\u30e2\u30c7\u30eb\u306e\u7a2e\u985e\u306b\u3088\u3063\u3066\u6761\u4ef6\u5206\u5c90\u304c\u5897\u3048\u3066\u304f\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001Article\u306b\u95a2\u9023\u3059\u308bNotification\u3067\u306f\u3053\u306eValidation\u304c\u5fc5\u8981\u3060\u304c\u3001Comment\u306b\u95a2\u9023\u3059\u308bNotification\u3067\u306f\u4e0d\u8981\u3001\u306a\u3069\u3067\u3059\u3002\u305d\u3046\u3057\u305f\u5834\u5408\u3001Notification\u30af\u30e9\u30b9\u81ea\u4f53\u306btype\u30ab\u30e9\u30e0\u304c\u3042\u308c\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306bSingle-Table-Inheritance\u3092\u5229\u7528\u3057\u306a\u304c\u3089\u5225\u3005\u306e\u30af\u30e9\u30b9\u3092\u7528\u610f\u3059\u308b\u3053\u3068\u3067\u3001\u5b9f\u88c5\u306e\u5b9a\u7fa9\u5834\u6240\u3092\u7dba\u9e97\u306b\u5206\u3051\u3089\u308c\u3066\u4fbf\u5229\u3067\u3059\u3002\n\n- Notification\n- ArticleNotification < Notification\n- CommentNotification < Notification\n- MentionNotification < Notification\n\n\u3055\u3066\u3001\u3053\u3046\u306a\u308b\u3068 source_type \u306e\u5185\u5bb9\u3068 type \u306e\u5185\u5bb9\u304c\u91cd\u8907\u3057\u3066\u3057\u307e\u3046\u3053\u3068\u306b\u306a\u308b\u306e\u3067\u3001source_type \u30ab\u30e9\u30e0\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u3092\u8003\u3048\u307e\u3059\u3002ActiveRecord\u304c source_type \u306e\u5024\u3092\u53c2\u7167\u3057\u3088\u3046\u3068\u3057\u305f\u3068\u304d\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b2\u3064\u306e\u30e1\u30bd\u30c3\u30c9\u3092Override\u3059\u308b\u3053\u3068\u3067\u3001\u52d5\u7684\u306b\u5024\u3092\u7d44\u307f\u7acb\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002`#[]` \u306e\u5909\u66f4\u3060\u3051\u3067\u826f\u3044\u3088\u3046\u306b\u601d\u308f\u308c\u304c\u3061\u3067\u3059\u304c\u3001`#_read_attribute` \u306e\u5024\u304cActiveRecord\u5185\u90e8\u3067\u95a2\u9023\u30ec\u30b3\u30fc\u30c9\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u7528\u306b\u5229\u7528\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u308c\u3082\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```rb\nclass Notification < ActiveRecord::Base\n  # @note Override\n  def [](attribute_name)\n    if attribute_name.to_s == \"source_type\"\n      type.gsub(/Notification\\z/, \"\")\n    else\n      super\n    end\n  end\n\n  # @note Override\n  def _read_attribute(attribute_name)\n    if attribute_name == \"source_type\"\n      self[attribute_name]\n    else\n      super\n    end\n  end\nend\n```\n\n\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u3001notifications\u30c6\u30fc\u30d6\u30eb\u306btype\u30ab\u30e9\u30e0\u3060\u3051\u3092\u7528\u610f\u3057\u306a\u304c\u3089\u3001STI\u3068Polymorphic association\u3092\u4f75\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u307e\u3042\u5b50\u30af\u30e9\u30b9\u3054\u3068\u306b `belongs_to` \u3092\u66f8\u3051\u3070Polymorphic association\u3068\u304b\u3084\u308b\u5fc5\u8981\u306a\u3055\u305d\u3046\u3067\u3059\u304c\u3001\u4e00\u5fdc\u3053\u3046\u3044\u3046\u3084\u308a\u65b9\u3082\u3042\u308b\u3088\u3068\u3044\u3046\u3053\u3068\u3067\u3053\u3053\u306f\u3069\u3046\u304b\u2026\u3002\u4e0a\u4f8b\u306e\u5834\u5408\u3001\u53d7\u3051\u53d6\u3063\u305f\u901a\u77e5\u4e00\u89a7\u306a\u3069\u3067\u306eN+1\u30af\u30a8\u30ea\u304c\u554f\u984c\u306b\u306a\u308b\u3053\u3068\u304c\u3042\u308b\u3068\u601d\u3046\u306e\u3067\u3001\u826f\u3051\u308c\u3070 [ActiveRecord\u3067Polymorphic\u306bPreload\u3059\u308b - Qiita](http://qiita.com/r7kamura/items/7a31b79f855d7af581ec) \u3082\u53c2\u8003\u306b\u3069\u3046\u305e\u3002\n", "tags": ["ActiveRecord", "Ruby", "Rails"]}