{"context": "\n\n\u76ee\u7684\netcd\u89e6\u3063\u305f\u3053\u3068\u306a\u304b\u3063\u305f\u306e\u3067\u89e6\u3063\u3066\u307f\u308b\u3002\n\u30af\u30e9\u30b9\u30bf\u306e\u52d5\u304d\u3050\u3089\u3044\u898b\u3048\u308b\u3068\u3044\u3044\u3068\u601d\u3063\u3066\u3044\u308b\u3002\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\n\u3084\u308b\u3053\u3068\nMac\u306bVagrant\u30673node\u7acb\u3066\u3066\u3001etcd\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\n\u203b\u3000vargrantfile\u3067\u69cb\u7bc9\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u7d20\u306e\u72b6\u614b\u3067\u89e6\u3063\u3066\u307e\u3059\u3002\n\u203b API\u30f4\u30a1\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u5099\u5fd8\u9332\u306a\u306e\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u307e\u3067\u628a\u63e1\u3057\u3066\u307e\u305b\u3093\n\n\u74b0\u5883\nVagrant Box \u306f\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306a\u3069\u53c2\u8003\u306b3\u3064\u7acb\u3066\u308b\n\u53c2\u8003 \uff1a http://qiita.com/kidach1/items/e63c1607705178aa257c\nip\u306f\u9023\u756a\u3067\u632f\u3063\u3066\u307e\u3059 192.168.33.2[1-3]\n$ cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\netcd\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\n\n$ etcd --version\netcd Version: 2.3.7\nGit SHA: fd17c91\nGo Version: go1.6.3\nGo OS/Arch: linux/amd64\n\n\netcd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u308b\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u65b0\u7248\u3092\u4f7f\u3044\u305f\u3044\u3068\u304b\u306f\u306a\u304b\u3063\u305f\u306e\u3067\u3001yum\u3067\u5165\u308b\u3082\u306e\u3092\u5229\u7528\n$ sudo yum install etcd -y\n\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067etcd\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u52d5\u4f5c\u3092\u898b\u308b\u3002\n$ etcd &\n[1] 4133\n2016-10-10 11:35:27.478358 I | etcdmain: etcd Version: 2.3.7\n2016-10-10 11:35:27.478444 I | etcdmain: Git SHA: fd17c91\n2016-10-10 11:35:27.478448 I | etcdmain: Go Version: go1.6.3\n2016-10-10 11:35:27.478452 I | etcdmain: Go OS/Arch: linux/amd64\n2016-10-10 11:35:27.478457 I | etcdmain: setting maximum number of CPUs to 1, total number of available CPUs is 1\n2016-10-10 11:35:27.478464 W | etcdmain: no data-dir provided, using default data-dir ./default.etcd\n2016-10-10 11:35:27.478496 N | etcdmain: the server is already initialized as member before, starting as etcd member...\n2016-10-10 11:35:27.479501 I | etcdmain: listening for peers on http://localhost:2380\n2016-10-10 11:35:27.479682 I | etcdmain: listening for peers on http://localhost:7001\n2016-10-10 11:35:27.479750 I | etcdmain: listening for client requests on http://localhost:2379\n2016-10-10 11:35:27.479864 I | etcdmain: listening for client requests on http://localhost:4001\n2016-10-10 11:35:27.480145 I | etcdserver: name = default\n2016-10-10 11:35:27.480152 I | etcdserver: data dir = default.etcd\n2016-10-10 11:35:27.480157 I | etcdserver: member dir = default.etcd/member\n2016-10-10 11:35:27.480161 I | etcdserver: heartbeat = 100ms\n2016-10-10 11:35:27.480164 I | etcdserver: election = 1000ms\n2016-10-10 11:35:27.480167 I | etcdserver: snapshot count = 10000\n2016-10-10 11:35:27.480176 I | etcdserver: advertise client URLs = http://localhost:2379,http://localhost:4001\n2016-10-10 11:35:27.507513 I | etcdserver: restarting member ce2a822cea30bfca in cluster 7e27652122e8b2ae at commit index 8835\n2016-10-10 11:35:27.512631 I | raft: ce2a822cea30bfca became follower at term 5\n2016-10-10 11:35:27.512715 I | raft: newRaft ce2a822cea30bfca [peers: [], term: 5, commit: 8835, applied: 0, lastindex: 8835, lastterm: 5]\n2016-10-10 11:35:27.521440 I | etcdserver: starting server... [version: 2.3.7, cluster version: to_be_decided]\n2016-10-10 11:35:27.522939 E | etcdmain: failed to notify systemd for readiness: No socket\n2016-10-10 11:35:27.523071 E | etcdmain: forgot to set Type=notify in systemd service file?\n2016-10-10 11:35:27.525169 N | etcdserver: added local member ce2a822cea30bfca [http://localhost:2380 http://localhost:7001] to cluster 7e27652122e8b2ae\n2016-10-10 11:35:27.525615 N | etcdserver: set the initial cluster version to 2.3\n2016-10-10 11:35:28.828638 I | raft: ce2a822cea30bfca is starting a new election at term 5\n2016-10-10 11:35:28.828730 I | raft: ce2a822cea30bfca became candidate at term 6\n2016-10-10 11:35:28.828743 I | raft: ce2a822cea30bfca received vote from ce2a822cea30bfca at term 6\n2016-10-10 11:35:28.828762 I | raft: ce2a822cea30bfca became leader at term 6\n2016-10-10 11:35:28.828776 I | raft: raft.node: ce2a822cea30bfca elected leader ce2a822cea30bfca at term 6\n2016-10-10 11:35:28.840528 I | etcdserver: published {Name:default ClientURLs:[http://localhost:2379 http://localhost:4001]} to cluster 7e27652122e8b2ae\n\n\u8d77\u52d5\u3067\u304d\u308c\u3070 etcdctl\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u614b\u304c\u78ba\u8a8d\u51fa\u6765\u308b\n$ etcdctl cluster-health\nmember ce2a822cea30bfca is healthy: got healthy result from http://localhost:2379\ncluster is healthy\n\n\nkey\u306e\u767b\u9332\u3068\u53d6\u5f97\n\nvalue\u306e\u767b\u9332\nfoge\u3068\u3044\u3046key\u306bhuga\u3092\u767b\u9332\u3059\u308b\n# set\u3067\u767b\u9332\u3055\u308c\u308b\n$ etcdctl set foge huga\nhuga\n\n\nvalue\u306e\u53d6\u5f97\n$ etcdctl get foge\nhuga\n\n\nvalue\u306e\u524a\u9664\n$ etcdctl rm foge\nPrevNode.Value: huga\n\n# \u6d88\u3048\u308c\u3070\u53d6\u5f97\u3067\u304d\u306a\u304f\u306a\u308b\n$ etcdctl get foge\nError:  100: Key not found (/foge) [11]\n\n\n\u968e\u5c64\u7684\u306a\u4fdd\u5b58\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u968e\u5c64\u7684\u306bkey\u3092\u4fdd\u5b58\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3001\n\u968e\u5c64\u3054\u3068\u306b\u30e6\u30cb\u30fc\u30af\u306akey\u3092\u7f6e\u304f\u3053\u3068\u304c\u3067\u304d\u308b\n$ etcdctl mkdir piyo\n$ etcdctl ls\n/foge\n/piyo\n\n# \u968e\u5c64\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f/\u306b\u306a\u3063\u3066\u3044\u308b\n$ etcdctl set piyo/fuga hoge\nhoge\n\n$ etcdctl ls --recursive\n/foge\n/piyo\n/piyo/fuga  <<<< \u3053\u3053\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\n\n\netcdctl\u306eexec-watch\u3092\u89e6\u3063\u3066\u307f\u308b\nexec-watch\u306f\u683c\u7d0d\u3059\u308bkey\u3092\u76e3\u8996\u3057\u3066\u51e6\u7406\u3092\u5b9f\u884c\u3067\u304d\u308b\n\u3053\u306e\u6642\u4e0e\u3048\u305fkey\u3068value\u3092\u53d6\u5f97\u3067\u304d\u308b\n$ etcdctl exec-watch --recursive /test -- sh -c 'echo \" set key \\\"$ETCD_WATCH_KEY\\\" , set value \\\"$ETCD_WATCH_VALUE\\\" \"'\nset key \"/test/foge\" , set value \"huga\"\n\n\n\n\u30af\u30e9\u30b9\u30bf\u5316\u3092\u8a66\u3059\n# node1\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node1' \\\n     --listen-peer-urls http://192.168.33.21:2380 \\\n     --listen-client-urls http://192.168.33.21:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.21:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.21:2380\n\n# node2\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node2' \\\n     --listen-peer-urls http://192.168.33.22:2380 \\\n     --listen-client-urls http://192.168.33.22:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.22:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.22:2380\n\n# node3\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node3' \\\n     --listen-peer-urls http://192.168.33.23:2380 \\\n     --listen-client-urls http://192.168.33.23:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.23:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.23:2380\n\n3\u53f0\u3068\u3082\u8d77\u52d5\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n$ etcdctl member list\n56042ab014c6ac8e: name=node1 peerURLs=http://192.168.33.21:2380 clientURLs=http://192.168.33.21:2379 isLeader=false\neeec403fa07e9432: name=node3 peerURLs=http://192.168.33.23:2380 clientURLs=http://192.168.33.23:2379 isLeader=true\nfbd7ce486ae9e974: name=node2 peerURLs=http://192.168.33.22:2380 clientURLs=http://192.168.33.22:2379 isLeader=false\n\n\u3053\u306e\u72b6\u614b\u3067\u30ea\u30fc\u30c0\u30fc\u3092kill\u3059\u308b\u3068\u3001\u30ea\u30fc\u30c0\u304c\u5909\u308f\u308b\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u898b\u308b\u3068\uff11\u53f0\u6b7b\u3093\u3067\u304a\u308a\u3001\u6b8b\u308a\u306f\u751f\u304d\u3066\u3044\u308b\n```\n$ etcdctl cluster-health\nmember 56042ab014c6ac8e is healthy: got healthy result from http://192.168.33.21:2379\nfailed to check the health of member eeec403fa07e9432 on http://192.168.33.23:2379: Get http://192.168.33.23:2379/health: dial tcp 192.168.33.23:2379: getsockopt: connection refused\nmember eeec403fa07e9432 is unreachable: [http://192.168.33.23:2379] are all unreachable\nmember fbd7ce486ae9e974 is healthy: got healthy result from http://192.168.33.22:2379\ncluster is healthy\n$ etcdctl member list\n56042ab014c6ac8e: name=node1 peerURLs=http://192.168.33.21:2380 clientURLs=http://192.168.33.21:2379 isLeader=true\u3000 <<< \u30ea\u30fc\u30c0\u304c\u5909\u308f\u3063\u3066\u3044\u308b\neeec403fa07e9432: name=node3 peerURLs=http://192.168.33.23:2380 clientURLs=http://192.168.33.23:2379 isLeader=false\nfbd7ce486ae9e974: name=node2 peerURLs=http://192.168.33.22:2380 clientURLs=http://192.168.33.22:2379 isLeader=false\n```\n\u3053\u306e\u72b6\u614b\u3067\u3001set\u3084get\u3092\u884c\u3046\u3068\u4e92\u3044\u306e\u5024\u3092\u540c\u671f\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u308f\u304b\u308a\u306b\u304f\u3044\u3067\u3059\u304c\u3001node1\u3067\u5165\u308c\u305f\u3082\u306e\u304cnode3\u3067\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n#### node1\u5074\u3067\u30bb\u30c3\u30c8\n[vagrant@localhost ~]$ ifconfig |grep 192.168.33.21\n        inet 192.168.33.21  netmask 255.255.255.0  broadcast 192.168.33.255\n[vagrant@localhost ~]$ etcdctl set node1 192.168.33.21\n192.168.33.21\n\n#### node3\u5074\u3067\u30b2\u30c3\u30c8\n[vagrant@localhost ~]$ ifconfig | grep 192.168.33.23\n        inet 192.168.33.23  netmask 255.255.255.0  broadcast 192.168.33.255\n[vagrant@localhost ~]$ etcdctl get node1\n192.168.33.21\n\n\n\u307e\u3068\u3081\n\nCentOS7\u3067etcd\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\n\u4e92\u3044\u306e\u30b5\u30fc\u30d0\u3092\u77e5\u3063\u3066\u3044\u308c\u3070\u3001\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306e\u8a2d\u5b9a\u306f\u4e0d\u8981\u306a\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\u6027\u80fd\u8a08\u6e2c\u3057\u3066\u306a\u3044\u304c\u3001etcd\u306e\u30af\u30e9\u30b9\u30bf\u3068\u3057\u3066\u540c\u671f\u3057\u3066\u3044\u308c\u3070value\u306e\u76e3\u8996\u3067\u4f55\u304b\u3067\u304d\u305d\u3046\u306a\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n\u4eca\u306e\u6240\u4f7f\u3044\u9053\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u304c\u3001\u3042\u307e\u308aCentOS7\u3067\u7acb\u3061\u4e0a\u3052\u3066\u308b\u8cc7\u6599\u304c\u306a\u3055\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u8ab0\u304b\u306e\u5f79\u306b\u7acb\u3066\u3070\u5b09\u3057\u3044\u3067\u3059\n# \u76ee\u7684\n\netcd\u89e6\u3063\u305f\u3053\u3068\u306a\u304b\u3063\u305f\u306e\u3067\u89e6\u3063\u3066\u307f\u308b\u3002\n\u30af\u30e9\u30b9\u30bf\u306e\u52d5\u304d\u3050\u3089\u3044\u898b\u3048\u308b\u3068\u3044\u3044\u3068\u601d\u3063\u3066\u3044\u308b\u3002\n\n[\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://coreos.com/etcd/docs/latest/getting-started-with-etcd.html)\n\n# \u3084\u308b\u3053\u3068\n\nMac\u306bVagrant\u30673node\u7acb\u3066\u3066\u3001etcd\u306e\u30af\u30e9\u30b9\u30bf\u3092\u69cb\u7bc9\u3059\u308b\n\u203b\u3000vargrantfile\u3067\u69cb\u7bc9\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u7d20\u306e\u72b6\u614b\u3067\u89e6\u3063\u3066\u307e\u3059\u3002\n\u203b API\u30f4\u30a1\u30fc\u30b8\u30e7\u30f3\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u304c\u5099\u5fd8\u9332\u306a\u306e\u3067\u30d0\u30fc\u30b8\u30e7\u30f3\u307e\u3067\u628a\u63e1\u3057\u3066\u307e\u305b\u3093\n\n# \u74b0\u5883\n\nVagrant Box \u306f\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306a\u3069\u53c2\u8003\u306b3\u3064\u7acb\u3066\u308b\n\u53c2\u8003 \uff1a http://qiita.com/kidach1/items/e63c1607705178aa257c\n\nip\u306f\u9023\u756a\u3067\u632f\u3063\u3066\u307e\u3059 192.168.33.2[1-3]\n\n```\n$ cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n```\n\netcd\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\n```\n$ etcd --version\netcd Version: 2.3.7\nGit SHA: fd17c91\nGo Version: go1.6.3\nGo OS/Arch: linux/amd64\n```\n\n# etcd\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u308b\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u6700\u65b0\u7248\u3092\u4f7f\u3044\u305f\u3044\u3068\u304b\u306f\u306a\u304b\u3063\u305f\u306e\u3067\u3001yum\u3067\u5165\u308b\u3082\u306e\u3092\u5229\u7528\n\n```\n$ sudo yum install etcd -y\n```\n\n## \u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u8d77\u52d5\u3057\u3066\u52d5\u4f5c\u78ba\u8a8d\n\n\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067etcd\u3092\u8d77\u52d5\u3057\u3066\u304a\u304d\u52d5\u4f5c\u3092\u898b\u308b\u3002\n\n```\n$ etcd &\n[1] 4133\n2016-10-10 11:35:27.478358 I | etcdmain: etcd Version: 2.3.7\n2016-10-10 11:35:27.478444 I | etcdmain: Git SHA: fd17c91\n2016-10-10 11:35:27.478448 I | etcdmain: Go Version: go1.6.3\n2016-10-10 11:35:27.478452 I | etcdmain: Go OS/Arch: linux/amd64\n2016-10-10 11:35:27.478457 I | etcdmain: setting maximum number of CPUs to 1, total number of available CPUs is 1\n2016-10-10 11:35:27.478464 W | etcdmain: no data-dir provided, using default data-dir ./default.etcd\n2016-10-10 11:35:27.478496 N | etcdmain: the server is already initialized as member before, starting as etcd member...\n2016-10-10 11:35:27.479501 I | etcdmain: listening for peers on http://localhost:2380\n2016-10-10 11:35:27.479682 I | etcdmain: listening for peers on http://localhost:7001\n2016-10-10 11:35:27.479750 I | etcdmain: listening for client requests on http://localhost:2379\n2016-10-10 11:35:27.479864 I | etcdmain: listening for client requests on http://localhost:4001\n2016-10-10 11:35:27.480145 I | etcdserver: name = default\n2016-10-10 11:35:27.480152 I | etcdserver: data dir = default.etcd\n2016-10-10 11:35:27.480157 I | etcdserver: member dir = default.etcd/member\n2016-10-10 11:35:27.480161 I | etcdserver: heartbeat = 100ms\n2016-10-10 11:35:27.480164 I | etcdserver: election = 1000ms\n2016-10-10 11:35:27.480167 I | etcdserver: snapshot count = 10000\n2016-10-10 11:35:27.480176 I | etcdserver: advertise client URLs = http://localhost:2379,http://localhost:4001\n2016-10-10 11:35:27.507513 I | etcdserver: restarting member ce2a822cea30bfca in cluster 7e27652122e8b2ae at commit index 8835\n2016-10-10 11:35:27.512631 I | raft: ce2a822cea30bfca became follower at term 5\n2016-10-10 11:35:27.512715 I | raft: newRaft ce2a822cea30bfca [peers: [], term: 5, commit: 8835, applied: 0, lastindex: 8835, lastterm: 5]\n2016-10-10 11:35:27.521440 I | etcdserver: starting server... [version: 2.3.7, cluster version: to_be_decided]\n2016-10-10 11:35:27.522939 E | etcdmain: failed to notify systemd for readiness: No socket\n2016-10-10 11:35:27.523071 E | etcdmain: forgot to set Type=notify in systemd service file?\n2016-10-10 11:35:27.525169 N | etcdserver: added local member ce2a822cea30bfca [http://localhost:2380 http://localhost:7001] to cluster 7e27652122e8b2ae\n2016-10-10 11:35:27.525615 N | etcdserver: set the initial cluster version to 2.3\n2016-10-10 11:35:28.828638 I | raft: ce2a822cea30bfca is starting a new election at term 5\n2016-10-10 11:35:28.828730 I | raft: ce2a822cea30bfca became candidate at term 6\n2016-10-10 11:35:28.828743 I | raft: ce2a822cea30bfca received vote from ce2a822cea30bfca at term 6\n2016-10-10 11:35:28.828762 I | raft: ce2a822cea30bfca became leader at term 6\n2016-10-10 11:35:28.828776 I | raft: raft.node: ce2a822cea30bfca elected leader ce2a822cea30bfca at term 6\n2016-10-10 11:35:28.840528 I | etcdserver: published {Name:default ClientURLs:[http://localhost:2379 http://localhost:4001]} to cluster 7e27652122e8b2ae\n```\n\n\u8d77\u52d5\u3067\u304d\u308c\u3070 etcdctl\u30b3\u30de\u30f3\u30c9\u3067\u72b6\u614b\u304c\u78ba\u8a8d\u51fa\u6765\u308b\n\n```\n$ etcdctl cluster-health\nmember ce2a822cea30bfca is healthy: got healthy result from http://localhost:2379\ncluster is healthy\n```\n\n\n## key\u306e\u767b\u9332\u3068\u53d6\u5f97\n\n#### value\u306e\u767b\u9332\nfoge\u3068\u3044\u3046key\u306bhuga\u3092\u767b\u9332\u3059\u308b\n\n```\n# set\u3067\u767b\u9332\u3055\u308c\u308b\n$ etcdctl set foge huga\nhuga\n```\n### value\u306e\u53d6\u5f97\n\n```\n$ etcdctl get foge\nhuga\n```\n\n### value\u306e\u524a\u9664\n\n```\n$ etcdctl rm foge\nPrevNode.Value: huga\n\n# \u6d88\u3048\u308c\u3070\u53d6\u5f97\u3067\u304d\u306a\u304f\u306a\u308b\n$ etcdctl get foge\nError:  100: Key not found (/foge) [11]\n```\n\n### \u968e\u5c64\u7684\u306a\u4fdd\u5b58\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u968e\u5c64\u7684\u306bkey\u3092\u4fdd\u5b58\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3001\n\u968e\u5c64\u3054\u3068\u306b\u30e6\u30cb\u30fc\u30af\u306akey\u3092\u7f6e\u304f\u3053\u3068\u304c\u3067\u304d\u308b\n\n```\n$ etcdctl mkdir piyo\n$ etcdctl ls\n/foge\n/piyo\n\n# \u968e\u5c64\u3092\u6307\u5b9a\u3067\u304d\u308b\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306f/\u306b\u306a\u3063\u3066\u3044\u308b\n$ etcdctl set piyo/fuga hoge\nhoge\n\n$ etcdctl ls --recursive\n/foge\n/piyo\n/piyo/fuga  <<<< \u3053\u3053\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\n```\n\n## etcdctl\u306eexec-watch\u3092\u89e6\u3063\u3066\u307f\u308b\n\nexec-watch\u306f\u683c\u7d0d\u3059\u308bkey\u3092\u76e3\u8996\u3057\u3066\u51e6\u7406\u3092\u5b9f\u884c\u3067\u304d\u308b\n\u3053\u306e\u6642\u4e0e\u3048\u305fkey\u3068value\u3092\u53d6\u5f97\u3067\u304d\u308b\n\n```\n$ etcdctl exec-watch --recursive /test -- sh -c 'echo \" set key \\\"$ETCD_WATCH_KEY\\\" , set value \\\"$ETCD_WATCH_VALUE\\\" \"'\nset key \"/test/foge\" , set value \"huga\"\n```\n\n---\n\n# \u30af\u30e9\u30b9\u30bf\u5316\u3092\u8a66\u3059\n\n```\n# node1\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node1' \\\n     --listen-peer-urls http://192.168.33.21:2380 \\\n     --listen-client-urls http://192.168.33.21:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.21:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.21:2380\n\n# node2\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node2' \\\n     --listen-peer-urls http://192.168.33.22:2380 \\\n     --listen-client-urls http://192.168.33.22:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.22:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.22:2380\n\n# node3\n$ etcd --initial-cluster-state 'new' \\\n     --initial-cluster-token 'etcd-cluster-1' \\\n     --name 'node3' \\\n     --listen-peer-urls http://192.168.33.23:2380 \\\n     --listen-client-urls http://192.168.33.23:2379,http://127.0.0.1:2379 \\\n     --advertise-client-urls http://192.168.33.23:2379 \\\n     --initial-cluster node1=http://192.168.33.21:2380,node2=http://192.168.33.22:2380,node3=http://192.168.33.23:2380 \\\n     --initial-advertise-peer-urls http://192.168.33.23:2380\n```\n\n3\u53f0\u3068\u3082\u8d77\u52d5\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n```\n$ etcdctl member list\n56042ab014c6ac8e: name=node1 peerURLs=http://192.168.33.21:2380 clientURLs=http://192.168.33.21:2379 isLeader=false\neeec403fa07e9432: name=node3 peerURLs=http://192.168.33.23:2380 clientURLs=http://192.168.33.23:2379 isLeader=true\nfbd7ce486ae9e974: name=node2 peerURLs=http://192.168.33.22:2380 clientURLs=http://192.168.33.22:2379 isLeader=false\n```\n\u3053\u306e\u72b6\u614b\u3067\u30ea\u30fc\u30c0\u30fc\u3092kill\u3059\u308b\u3068\u3001\u30ea\u30fc\u30c0\u304c\u5909\u308f\u308b\n\n\u30af\u30e9\u30b9\u30bf\u30fc\u306e\u72b6\u614b\u3092\u898b\u308b\u3068\uff11\u53f0\u6b7b\u3093\u3067\u304a\u308a\u3001\u6b8b\u308a\u306f\u751f\u304d\u3066\u3044\u308b\n```\n$ etcdctl cluster-health\nmember 56042ab014c6ac8e is healthy: got healthy result from http://192.168.33.21:2379\nfailed to check the health of member eeec403fa07e9432 on http://192.168.33.23:2379: Get http://192.168.33.23:2379/health: dial tcp 192.168.33.23:2379: getsockopt: connection refused\nmember eeec403fa07e9432 is unreachable: [http://192.168.33.23:2379] are all unreachable\nmember fbd7ce486ae9e974 is healthy: got healthy result from http://192.168.33.22:2379\ncluster is healthy\n\n$ etcdctl member list\n56042ab014c6ac8e: name=node1 peerURLs=http://192.168.33.21:2380 clientURLs=http://192.168.33.21:2379 isLeader=true\u3000 <<< \u30ea\u30fc\u30c0\u304c\u5909\u308f\u3063\u3066\u3044\u308b\neeec403fa07e9432: name=node3 peerURLs=http://192.168.33.23:2380 clientURLs=http://192.168.33.23:2379 isLeader=false\nfbd7ce486ae9e974: name=node2 peerURLs=http://192.168.33.22:2380 clientURLs=http://192.168.33.22:2379 isLeader=false\n```\n\n\u3053\u306e\u72b6\u614b\u3067\u3001set\u3084get\u3092\u884c\u3046\u3068\u4e92\u3044\u306e\u5024\u3092\u540c\u671f\u3057\u3066\u307f\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\n\u308f\u304b\u308a\u306b\u304f\u3044\u3067\u3059\u304c\u3001node1\u3067\u5165\u308c\u305f\u3082\u306e\u304cnode3\u3067\u53d6\u308a\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\n\n```\n#### node1\u5074\u3067\u30bb\u30c3\u30c8\n[vagrant@localhost ~]$ ifconfig |grep 192.168.33.21\n        inet 192.168.33.21  netmask 255.255.255.0  broadcast 192.168.33.255\n[vagrant@localhost ~]$ etcdctl set node1 192.168.33.21\n192.168.33.21\n\n#### node3\u5074\u3067\u30b2\u30c3\u30c8\n[vagrant@localhost ~]$ ifconfig | grep 192.168.33.23\n        inet 192.168.33.23  netmask 255.255.255.0  broadcast 192.168.33.255\n[vagrant@localhost ~]$ etcdctl get node1\n192.168.33.21\n```\n\n# \u307e\u3068\u3081\n\n- CentOS7\u3067etcd\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\n- \u4e92\u3044\u306e\u30b5\u30fc\u30d0\u3092\u77e5\u3063\u3066\u3044\u308c\u3070\u3001\u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u306e\u8a2d\u5b9a\u306f\u4e0d\u8981\u306a\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n- \u6027\u80fd\u8a08\u6e2c\u3057\u3066\u306a\u3044\u304c\u3001etcd\u306e\u30af\u30e9\u30b9\u30bf\u3068\u3057\u3066\u540c\u671f\u3057\u3066\u3044\u308c\u3070value\u306e\u76e3\u8996\u3067\u4f55\u304b\u3067\u304d\u305d\u3046\u306a\u3053\u3068\u304c\u308f\u304b\u3063\u305f\n\n\u4eca\u306e\u6240\u4f7f\u3044\u9053\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u304c\u3001\u3042\u307e\u308aCentOS7\u3067\u7acb\u3061\u4e0a\u3052\u3066\u308b\u8cc7\u6599\u304c\u306a\u3055\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u8ab0\u304b\u306e\u5f79\u306b\u7acb\u3066\u3070\u5b09\u3057\u3044\u3067\u3059\n", "tags": ["etcd", "centos7"]}