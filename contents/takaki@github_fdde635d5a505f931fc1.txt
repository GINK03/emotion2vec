{"tags": ["Java", "JAX-RS", "spock"], "context": "JAX-RS\u306eBean Validation\u306e\u3044\u304f\u3064\u304b\u306e\u4f8b\u3092\u4e0a\u3052\u308b\u3002\nvalidator\u306fjavax.validation.constraints\u306b\u3042\u308b\u3002\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n@DecimalMax\u3068@DecimalMin\u306f\u540d\u524d\u306e\u901a\u308a\u6574\u6570\u5024\u306e\u4e0b\u9650\u30fb\u4e0a\u9650\u3092\u5b9a\u3081\u308b\u3002@Pattern\u306f\u6b63\u898f\u8868\u73fe\u3067\u6587\u5b57\u5217\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5b9a\u3081\u308b\u3002\n\nimport javax.validation.constraints.DecimalMax;\nimport javax.validation.constraints.DecimalMin;\nimport javax.validation.constraints.NotNull;\nimport javax.validation.constraints.Pattern;\n\n// ...\n// ......\n// ...\n\n@Path(\"/\")\npublic class HelloValidateSampleResource {\n    @GET\n    @Path(\"minmax\")\n    public String minmax(\n            @NotNull @DecimalMax(value = \"10\") @DecimalMin(value = \"3\") @QueryParam(\"number\") int number) {\n        return Integer.toString(number * 10);\n    }\n\n    @GET\n    @Path(\"pattern\")\n    public String pattern(\n            @NotNull @Pattern(regexp = \"a+b*c\") @QueryParam(\"pattern\") String pattern) {\n        return \"pattern = \" + pattern;\n    }\n}\n\n\u5b9f\u969b\u306b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b\u3002\nclass HelloValidateSampleResourceTest extends Specification {\n    @Shared\n    def jerseyTest = new JerseyTest() {\n        @Override\n        protected Application configure() {\n            return new ResourceConfig(HelloValidateSampleResource.class).\n                    property(ServerProperties.BV_DISABLE_VALIDATE_ON_EXECUTABLE_OVERRIDE_CHECK, true)\n        }\n    }\n\n    def setupSpec() {\n        jerseyTest.setUp()\n    }\n\n    def cleanupSpec() {\n        jerseyTest.tearDown()\n    }\n\n    def \"test minmax\"() {\n        when:\n        def response = jerseyTest.target(\"/minmax\").queryParam(\"number\", \"5\").request().get()\n\n        then:\n        response.getStatus() == 200\n        response.readEntity(String.class) == \"50\"\n\n        expect:\n        jerseyTest.target(\"/minmax\").request().get().getStatus() != 200\n        jerseyTest.target(\"/minmax\").queryParam(\"number\", \"20\").request().get().getStatus() != 200\n        jerseyTest.target(\"/minmax\").queryParam(\"number\", \"1\").request().get().getStatus() != 200\n    }\n\n    def \"test pattern\" () {\n        expect:\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"abc\").request().get().getStatus() == 200\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"aac\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"xxx\").request().get().getStatus() != 200\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"xabc\").request().get().getStatus() != 200\n    }\n}\n\n\u307e\u305forg.hibernate.validator.constraints\u306b\u3082validator\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002\u305d\u306e\u4f8b\u3002\nimport org.hibernate.validator.constraints.Email;\nimport org.hibernate.validator.constraints.Length;\n\n// ...\n// ......\n// ...\n\n    @GET\n    @Path(\"length\")\n    public String length(@NotNull @Length(min = 3, max = 10) @QueryParam(\"str\") String str) {\n        return str;\n    }\n\n    @GET\n    @Path(\"email\")\n    public String email(@NotNull @Email @QueryParam(\"email\") String email) {\n        return email;\n    }\n}\n\n\n\u30c6\u30b9\u30c8\u306f\u6b21\u306e\u901a\u308a\u3002\n    def \"test length\" () {\n        expect:\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"1234567\").request().get().getStatus() == 200\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"123\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"abcdefghijk\").request().get().getStatus() != 200\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"aa\").request().get().getStatus() != 200\n    }\n\n    def \"test email\" () {\n        expect:\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test@example.org\").request().get().getStatus() == 200\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test@localhost\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test\").request().get().getStatus() != 200\n    }\n\n\nhttp://qiita.com/takaki@github/items/40f8bc02dc06a0e2848b\n\nJAX-RS\u306eBean Validation\u306e\u3044\u304f\u3064\u304b\u306e\u4f8b\u3092\u4e0a\u3052\u308b\u3002\n\nvalidator\u306f`javax.validation.constraints`\u306b\u3042\u308b\u3002\u4f8b\u3048\u3070\u6b21\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n`@DecimalMax`\u3068`@DecimalMin`\u306f\u540d\u524d\u306e\u901a\u308a\u6574\u6570\u5024\u306e\u4e0b\u9650\u30fb\u4e0a\u9650\u3092\u5b9a\u3081\u308b\u3002`@Pattern`\u306f\u6b63\u898f\u8868\u73fe\u3067\u6587\u5b57\u5217\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5b9a\u3081\u308b\u3002\n\n```java\n\nimport javax.validation.constraints.DecimalMax;\nimport javax.validation.constraints.DecimalMin;\nimport javax.validation.constraints.NotNull;\nimport javax.validation.constraints.Pattern;\n\n// ...\n// ......\n// ...\n\n@Path(\"/\")\npublic class HelloValidateSampleResource {\n    @GET\n    @Path(\"minmax\")\n    public String minmax(\n            @NotNull @DecimalMax(value = \"10\") @DecimalMin(value = \"3\") @QueryParam(\"number\") int number) {\n        return Integer.toString(number * 10);\n    }\n\n    @GET\n    @Path(\"pattern\")\n    public String pattern(\n            @NotNull @Pattern(regexp = \"a+b*c\") @QueryParam(\"pattern\") String pattern) {\n        return \"pattern = \" + pattern;\n    }\n}\n```\n\n\u5b9f\u969b\u306b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u308b\u3002\n\n```groovy\nclass HelloValidateSampleResourceTest extends Specification {\n    @Shared\n    def jerseyTest = new JerseyTest() {\n        @Override\n        protected Application configure() {\n            return new ResourceConfig(HelloValidateSampleResource.class).\n                    property(ServerProperties.BV_DISABLE_VALIDATE_ON_EXECUTABLE_OVERRIDE_CHECK, true)\n        }\n    }\n\n    def setupSpec() {\n        jerseyTest.setUp()\n    }\n\n    def cleanupSpec() {\n        jerseyTest.tearDown()\n    }\n\n    def \"test minmax\"() {\n        when:\n        def response = jerseyTest.target(\"/minmax\").queryParam(\"number\", \"5\").request().get()\n\n        then:\n        response.getStatus() == 200\n        response.readEntity(String.class) == \"50\"\n\n        expect:\n        jerseyTest.target(\"/minmax\").request().get().getStatus() != 200\n        jerseyTest.target(\"/minmax\").queryParam(\"number\", \"20\").request().get().getStatus() != 200\n        jerseyTest.target(\"/minmax\").queryParam(\"number\", \"1\").request().get().getStatus() != 200\n    }\n\n    def \"test pattern\" () {\n        expect:\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"abc\").request().get().getStatus() == 200\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"aac\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"xxx\").request().get().getStatus() != 200\n        jerseyTest.target(\"/pattern\").queryParam(\"pattern\", \"xabc\").request().get().getStatus() != 200\n    }\n}\n```\n\n\u307e\u305f`org.hibernate.validator.constraints`\u306b\u3082validator\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3002\u305d\u306e\u4f8b\u3002\n\n```java\nimport org.hibernate.validator.constraints.Email;\nimport org.hibernate.validator.constraints.Length;\n\n// ...\n// ......\n// ...\n\n    @GET\n    @Path(\"length\")\n    public String length(@NotNull @Length(min = 3, max = 10) @QueryParam(\"str\") String str) {\n        return str;\n    }\n\n    @GET\n    @Path(\"email\")\n    public String email(@NotNull @Email @QueryParam(\"email\") String email) {\n        return email;\n    }\n}\n\n```\n\n\u30c6\u30b9\u30c8\u306f\u6b21\u306e\u901a\u308a\u3002\n\n```groovy\n    def \"test length\" () {\n        expect:\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"1234567\").request().get().getStatus() == 200\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"123\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"abcdefghijk\").request().get().getStatus() != 200\n        jerseyTest.target(\"/length\").queryParam(\"str\", \"aa\").request().get().getStatus() != 200\n    }\n\n    def \"test email\" () {\n        expect:\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test@example.org\").request().get().getStatus() == 200\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test@localhost\").request().get().getStatus() == 200\n\n        jerseyTest.target(\"/email\").queryParam(\"email\", \"test\").request().get().getStatus() != 200\n    }\n```\n\n* http://qiita.com/takaki@github/items/40f8bc02dc06a0e2848b\n"}