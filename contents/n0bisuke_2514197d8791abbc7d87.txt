{"context": " More than 1 year has passed since last update.Node.js\u3067\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4f7f\u3044\u65b9\u306e\u52c9\u5f37\u3067\u3059\uff0e\njade\u3067\u3084\u3063\u3066\u308b\u30b5\u30f3\u30d7\u30eb\u304c\u591a\u3044\u3067\u3059\u304c\uff0cjade\u306f\u30a4\u30de\u30a4\u30c1\u76f4\u611f\u7684\u306b\u66f8\u3051\u306a\u3044(\u6163\u308c\u306a\u3044)\u306e\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306fejs\u3092\u4f7f\u3044\u307e\u3059\uff0e\n\u52c9\u5f37\u4e2d\u306a\u306e\u3067\u81ea\u5206\u304c\u7406\u89e3\u51fa\u6765\u308b\u3088\u3046\u306b\u89e3\u8aac\u3057\u3066\u307f\u307e\u3059\uff0e\n\u53c2\u8003: Express\u3067\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4f5c\u308b - uchida75cm\u306e\u65e5\u8a18\n\u53c2\u8003: Node.js + Express \u3067\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b - Devlog\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\nnode v0.10.23\nexpress 3.4.8\nnpm 1.3.17\nMongoDB shell version: 2.4.8\n\n\u307e\u305a\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n$ express -e login\n$ cd login\n$ npm install\n$ node app.js\n\u3068\u308a\u3042\u3048\u305a\u30d6\u30e9\u30a6\u30b6\u304b\u3089http://lobalhost:3000\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff0e\u30a8\u30e9\u30fc\u304c\u7121\u304f\uff0cExpress\u306e\u6587\u5b57\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\uff0e\n\n\nMongoDB\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nMongoDB\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\uff0e\u8abf\u3079\u308b\u3068\u51fa\u3066\u304d\u307e\u3059\u304cmongoose\u306f\u3088\u304f\u4f7f\u308f\u308c\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\uff0e\n$ npm install mongoose\n$ npm install connect-mongo\n\n\nMongoDB\u8d77\u52d5\n\u30bf\u30fc\u30df\u30ca\u30eb\u3092node.js\u3068\u306f\u5225\u30d7\u30ed\u30bb\u30b9(\u5225\u306a\u30bf\u30d6\u3084\u30a6\u30a3\u30f3\u30c9\u30a6)\u3067\u8d77\u52d5\u3057\u307e\u3057\u3087\u3046\uff0e\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\u5185\u306bdb\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\uff0c--dbpath\u30aa\u30d7\u30b7\u30e7\u30f3\u3067db\u30d5\u30a9\u30eb\u30c0\u3092\u4fdd\u5b58\u5148\u306b\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\uff0e\n$ mkdir db\n$ mongod --nojournal --noprealloc --dbpath db\n\n\napp.js\n\nconnect-mongo\u306e\u8aad\u307f\u8fbc\u307f\napp.js\u306e\u4e0a\u90e8\u306erequire()\u306e\u90e8\u5206\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff0e\nvar MongoStore = require('connect-mongo')(express);\n\n\n\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u6e96\u5099\nsession\u3092\u4f7f\u3046\u305f\u3081\u306b\u306fcookie\u3092\u8aad\u307f\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308b\u3089\u3057\u3044\u306e\u3067app.use(app.router);\u306e\u524d\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff0e\napp.use(express.cookieParser()); //\u8ffd\u52a0\napp.use(express.session({\n    secret: 'secret',\n    store: new MongoStore({\n        db: 'session',\n        host: 'localhost',\n        clear_interval: 60 * 60\n    }),\n    cookie: {\n        httpOnly: false,\n        maxAge: new Date(Date.now() + 60 * 60 * 1000)\n    }\n})); //\u8ffd\u52a0\n\n\n\u8a8d\u8a3c\u7528\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u95a2\u6570\n\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5024\u304c\u7121\u3051\u308c\u3070/login\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u307e\u3059\uff0e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\u306e\u524d\u306b\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\uff0e\nvar loginCheck = function(req, res, next) {\n    if(req.session.user){\n      next();\n    }else{\n      res.redirect('/login');\n    }\n};\n\n\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\uff0e\u2191\u3067\u8a18\u8ff0\u3057\u305floginCheck\u95a2\u6570\u3092\u54ac\u307e\u3059\u3053\u3068\u3067\u8a8d\u8a3c\u5fc5\u9808\u306e\u30da\u30fc\u30b8\u3068\u8a8d\u8a3c\u7121\u3057\u3067\u898b\u308c\u308b\u30da\u30fc\u30b8\u3092\u5207\u308a\u5206\u3051\u307e\u3059\uff0e\napp.get('/', loginCheck, routes.index);\napp.get('/login', routes.login);\napp.post('/add', routes.add);\napp.get('/logout', function(req, res){\n  req.session.destroy();\n  console.log('deleted sesstion');\n  res.redirect('/');\n});\n\n\nmodel\napp.js\u3068\u540c\u3058\u968e\u5c64\u306bmodel.js\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\uff0e\nModel\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u307e\u3059\uff0e\n-db\u540d:user\n-collection\u540d:info(UserSchema)\n\u6700\u5f8c\u306e\u884c\u306eexports.User\u3067\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u304b\u3089Model\u3092\u547c\u3073\u51fa\u305b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\uff0e\nvar mongoose = require('mongoose');\nvar url = 'mongodb://localhost/user';\nvar db  = mongoose.createConnection(url, function(err, res){\n    if(err){\n        console.log('Error connected: ' + url + ' - ' + err);\n    }else{\n        console.log('Success connected: ' + url);\n    }\n});\n\n// Model\u306e\u5b9a\u7fa9\nvar UserSchema = new mongoose.Schema({\n    email    : String,\n    password  : String\n},{collection: 'info'});\n\nexports.User = db.model('User', UserSchema);\n\n\ncontroller\n\nroutes/index.js\nvar model = require('../model.js')\u3067\u2191\u3067\u5b9a\u7fa9\u3057\u305fmodel\u306e\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\uff0e\nUser  = model.User;\u3068\u3059\u308b\u3053\u3068\u3067\u2191\u306eUserSchema\u304croutes/index.js\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff0e\n\u307e\u305f\uff0csession\u306e\u60c5\u5831\u306freq.session\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u3067console.log()\u306a\u3069\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\n/*\u30e2\u30c7\u30eb\u8aad\u307f\u8fbc\u307f*/\nvar model = require('../model.js'),\n    User  = model.User;\n\n/*\u30ed\u30b0\u30a4\u30f3\u5f8c\u30da\u30fc\u30b8*/\nexports.index = function(req, res){\n    res.render('index', { user: req.session.user});\n    console.log(req.session.user);\n};\n\n/*\u30e6\u30fc\u30b6\u30fc\u767b\u9332\u6a5f\u80fd*/\nexports.add = function(req, res){\n    var newUser = new User(req.body);\n    newUser.save(function(err){\n        if(err){\n            console.log(err);\n            res.redirect('back');\n        }else{\n            res.redirect('/');\n        }\n    });\n};\n\n/*\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd*/\nexports.login = function(req, res){\n    var email    = req.query.email;\n    var password = req.query.password;\n    var query = { \"email\": email, \"password\": password };\n    User.find(query, function(err, data){\n        if(err){\n            console.log(err);\n        }\n        if(data == \"\"){\n            res.render('login');\n        }else{\n            req.session.user = email;\n            res.redirect('/');\n        }\n    });\n};\n\n\nview\n\u3042\u3068\u306f\u30d5\u30a9\u30fc\u30e0\u306a\u3069\u3092\u4f5c\u308c\u3070OK\u3067\u3059\uff0e\n\nviews/login.ejs\n\u30ed\u30b0\u30a4\u30f3\u524d\u306e\u30da\u30fc\u30b8\u3067\u3059\uff0e\n<!doctype html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>\u30ed\u30b0\u30a4\u30f3\u524d</title>\n</head>\n<body>\n  <h2>\u30ed\u30b0\u30a4\u30f3</h2>\n  <form action=\"/login\" method=\"GET\">\n    <input type=\"text\" name=\"email\" placeholder=\"Email\"/>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"/>\n    <input type=\"submit\">\u30ed\u30b0\u30a4\u30f3</button>\n  </form>\n\n  <h2>\u65b0\u898f\u767b\u9332</h2>\n  <form action=\"/add\" method=\"POST\">\n    <input type=\"text\" name=\"email\" placeholder=\"Email\"/>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"/>\n    <input type=\"submit\">\u65b0\u898f\u767b\u9332</button>\n  </form>\n</body>\n</html>\n\n\n\u753b\u9762\u4f8b /login\n\n\nviews/index.ejs\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u30da\u30fc\u30b8\u3067\u3059\uff0e\n<!doctype html>\n<html lang=\"ja\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>\u30ed\u30b0\u30a4\u30f3\u5f8c</title>\n</head>\n<body>\n    <h1>My Site</h1>\n    <p>Welcome to My Site</p>\n    <%= user %> \u3055\u3093\u3088\u3046\u3053\u305d\u3002\n    <p>\n        <a href=\"/logout\">\u30ed\u30b0\u30a2\u30a6\u30c8</a>\n    </p>\n</body>\n</html>\n\n\n\u753b\u9762\u4f8b /index\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u30ed\u30b0\u30a4\u30f3\u524d\u306b/ or /index\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067/login\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\u65b0\u898f\u767b\u9332(\u7279\u306b\u4f55\u3082\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u304c)\u3092\u3057\u3066\u304b\u3089\u65b0\u898f\u767b\u9332\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068/\u3092\u898b\u308c\u308b\u306f\u305a\u3067\u3059\uff0e\u307e\u305f,\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u30ea\u30f3\u30af\u3092\u62bc\u3059\u3068session\u304c\u7834\u68c4\u3055\u308c/logoin\u306b\u623b\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u301c\uff0e\n\nNode.js\u3067\u306e\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4f7f\u3044\u65b9\u306e\u52c9\u5f37\u3067\u3059\uff0e\njade\u3067\u3084\u3063\u3066\u308b\u30b5\u30f3\u30d7\u30eb\u304c\u591a\u3044\u3067\u3059\u304c\uff0cjade\u306f\u30a4\u30de\u30a4\u30c1\u76f4\u611f\u7684\u306b\u66f8\u3051\u306a\u3044(\u6163\u308c\u306a\u3044)\u306e\u3067\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30a8\u30f3\u30b8\u30f3\u306fejs\u3092\u4f7f\u3044\u307e\u3059\uff0e\n\n\u52c9\u5f37\u4e2d\u306a\u306e\u3067\u81ea\u5206\u304c\u7406\u89e3\u51fa\u6765\u308b\u3088\u3046\u306b\u89e3\u8aac\u3057\u3066\u307f\u307e\u3059\uff0e\n\u53c2\u8003: [Express\u3067\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4f5c\u308b - uchida75cm\u306e\u65e5\u8a18](http://uchida75cm.hatenablog.com/entry/20110712/1310469113)\n\u53c2\u8003: [Node.js + Express \u3067\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b - Devlog](http://kkurahar.github.io/blog/2013/05/10/node-express-session/)\n\n##\u30d0\u30fc\u30b8\u30e7\u30f3\nnode v0.10.23\nexpress 3.4.8\nnpm 1.3.17\nMongoDB shell version: 2.4.8\n\n##\u307e\u305a\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\n$ express -e login\n$ cd login\n$ npm install\n$ node app.js\n\n\u3068\u308a\u3042\u3048\u305a\u30d6\u30e9\u30a6\u30b6\u304b\u3089`http://lobalhost:3000`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff0e\u30a8\u30e9\u30fc\u304c\u7121\u304f\uff0cExpress\u306e\u6587\u5b57\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\uff0e\n![](http://gyazo.com/b56d60a15ce131e17c3627770cfda865.png)\n\n##MongoDB\u95a2\u9023\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nMongoDB\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\uff0e\u8abf\u3079\u308b\u3068\u51fa\u3066\u304d\u307e\u3059\u304cmongoose\u306f\u3088\u304f\u4f7f\u308f\u308c\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\uff0e\n\n```\n$ npm install mongoose\n$ npm install connect-mongo\n```\n\n##MongoDB\u8d77\u52d5\n\u30bf\u30fc\u30df\u30ca\u30eb\u3092node.js\u3068\u306f\u5225\u30d7\u30ed\u30bb\u30b9(\u5225\u306a\u30bf\u30d6\u3084\u30a6\u30a3\u30f3\u30c9\u30a6)\u3067\u8d77\u52d5\u3057\u307e\u3057\u3087\u3046\uff0e\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30d5\u30a9\u30eb\u30c0\u5185\u306bdb\u30d5\u30a9\u30eb\u30c0\u3092\u4f5c\u6210\u3057\uff0c`--dbpath\u30aa\u30d7\u30b7\u30e7\u30f3`\u3067db\u30d5\u30a9\u30eb\u30c0\u3092\u4fdd\u5b58\u5148\u306b\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\uff0e\n\n```\n$ mkdir db\n$ mongod --nojournal --noprealloc --dbpath db\n```\n\n\n##app.js\n###connect-mongo\u306e\u8aad\u307f\u8fbc\u307f\napp.js\u306e\u4e0a\u90e8\u306erequire()\u306e\u90e8\u5206\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff0e\n\n```\nvar MongoStore = require('connect-mongo')(express);\n```\n\n###\u30bb\u30c3\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u6e96\u5099\nsession\u3092\u4f7f\u3046\u305f\u3081\u306b\u306fcookie\u3092\u8aad\u307f\u8fbc\u3080\u5fc5\u8981\u304c\u3042\u308b\u3089\u3057\u3044\u306e\u3067`app.use(app.router);`\u306e\u524d\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\uff0e\n\n\n```js:\napp.use(express.cookieParser()); //\u8ffd\u52a0\napp.use(express.session({\n    secret: 'secret',\n    store: new MongoStore({\n        db: 'session',\n        host: 'localhost',\n        clear_interval: 60 * 60\n    }),\n    cookie: {\n        httpOnly: false,\n        maxAge: new Date(Date.now() + 60 * 60 * 1000)\n    }\n})); //\u8ffd\u52a0\n```\n\n###\u8a8d\u8a3c\u7528\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u95a2\u6570\n\u30bb\u30c3\u30b7\u30e7\u30f3\u306b\u5024\u304c\u7121\u3051\u308c\u3070/login\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u307e\u3059\uff0e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\u306e\u524d\u306b\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\uff0e\n\n```js:\nvar loginCheck = function(req, res, next) {\n    if(req.session.user){\n      next();\n    }else{\n      res.redirect('/login');\n    }\n};\n```\n\n###\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\n\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u8a2d\u5b9a\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3059\uff0e\u2191\u3067\u8a18\u8ff0\u3057\u305floginCheck\u95a2\u6570\u3092\u54ac\u307e\u3059\u3053\u3068\u3067\u8a8d\u8a3c\u5fc5\u9808\u306e\u30da\u30fc\u30b8\u3068\u8a8d\u8a3c\u7121\u3057\u3067\u898b\u308c\u308b\u30da\u30fc\u30b8\u3092\u5207\u308a\u5206\u3051\u307e\u3059\uff0e\n\n```js:\napp.get('/', loginCheck, routes.index);\napp.get('/login', routes.login);\napp.post('/add', routes.add);\napp.get('/logout', function(req, res){\n  req.session.destroy();\n  console.log('deleted sesstion');\n  res.redirect('/');\n});\n```\n\n##model\napp.js\u3068\u540c\u3058\u968e\u5c64\u306bmodel.js\u3092\u4f5c\u6210\u3057\u307e\u3057\u3087\u3046\uff0e\nModel\u5b9a\u7fa9\u3092\u3057\u3066\u3044\u307e\u3059\uff0e\n-db\u540d:user\n-collection\u540d:info(UserSchema)\n\n\u6700\u5f8c\u306e\u884c\u306e`exports.User`\u3067\u4ed6\u306e\u30d5\u30a1\u30a4\u30eb\u304b\u3089Model\u3092\u547c\u3073\u51fa\u305b\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\uff0e\n\n```js:\nvar mongoose = require('mongoose');\nvar url = 'mongodb://localhost/user';\nvar db  = mongoose.createConnection(url, function(err, res){\n    if(err){\n        console.log('Error connected: ' + url + ' - ' + err);\n    }else{\n        console.log('Success connected: ' + url);\n    }\n});\n\n// Model\u306e\u5b9a\u7fa9\nvar UserSchema = new mongoose.Schema({\n    email    : String,\n    password  : String\n},{collection: 'info'});\n \nexports.User = db.model('User', UserSchema);\n```\n\n##controller\n###routes/index.js\n`var model = require('../model.js')`\u3067\u2191\u3067\u5b9a\u7fa9\u3057\u305fmodel\u306e\u60c5\u5831\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\uff0e\n`User  = model.User;`\u3068\u3059\u308b\u3053\u3068\u3067\u2191\u306eUserSchema\u304c`routes/index.js`\u3067\u3082\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\uff0e\n\n\u307e\u305f\uff0csession\u306e\u60c5\u5831\u306f`req.session`\u306b\u5165\u3063\u3066\u3044\u308b\u306e\u3067console.log()\u306a\u3069\u3067\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u308f\u304b\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\n\n```js:\n/*\u30e2\u30c7\u30eb\u8aad\u307f\u8fbc\u307f*/\nvar model = require('../model.js'),\n    User  = model.User;\n\n/*\u30ed\u30b0\u30a4\u30f3\u5f8c\u30da\u30fc\u30b8*/\nexports.index = function(req, res){\n    res.render('index', { user: req.session.user});\n    console.log(req.session.user);\n};\n\n/*\u30e6\u30fc\u30b6\u30fc\u767b\u9332\u6a5f\u80fd*/\nexports.add = function(req, res){\n\tvar newUser = new User(req.body);\n\tnewUser.save(function(err){\n\t\tif(err){\n\t\t\tconsole.log(err);\n\t\t\tres.redirect('back');\n\t\t}else{\n\t\t\tres.redirect('/');\n\t\t}\n\t});\n};\n\n/*\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd*/\nexports.login = function(req, res){\n\tvar email    = req.query.email;\n\tvar password = req.query.password;\n\tvar query = { \"email\": email, \"password\": password };\n\tUser.find(query, function(err, data){\n\t\tif(err){\n\t\t\tconsole.log(err);\n\t\t}\n\t\tif(data == \"\"){\n\t\t\tres.render('login');\n\t\t}else{\n\t\t\treq.session.user = email;\n\t\t\tres.redirect('/');\n\t\t}\n\t});\n};\n```\n\n\n##view\n\u3042\u3068\u306f\u30d5\u30a9\u30fc\u30e0\u306a\u3069\u3092\u4f5c\u308c\u3070OK\u3067\u3059\uff0e\n###views/login.ejs\n\u30ed\u30b0\u30a4\u30f3\u524d\u306e\u30da\u30fc\u30b8\u3067\u3059\uff0e\n\n```html:\n<!doctype html>\n<html lang=\"ja\">\n<head>\n  <meta charset=\"UTF-8\">\n  <title>\u30ed\u30b0\u30a4\u30f3\u524d</title>\n</head>\n<body>\n  <h2>\u30ed\u30b0\u30a4\u30f3</h2>\n  <form action=\"/login\" method=\"GET\">\n    <input type=\"text\" name=\"email\" placeholder=\"Email\"/>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"/>\n    <input type=\"submit\">\u30ed\u30b0\u30a4\u30f3</button>\n  </form>\n\n  <h2>\u65b0\u898f\u767b\u9332</h2>\n  <form action=\"/add\" method=\"POST\">\n    <input type=\"text\" name=\"email\" placeholder=\"Email\"/>\n    <input type=\"password\" name=\"password\" placeholder=\"Password\"/>\n    <input type=\"submit\">\u65b0\u898f\u767b\u9332</button>\n  </form>\n</body>\n</html>\n```\n###\u753b\u9762\u4f8b /login\n![](http://gyazo.com/ea4513ce614f3f4bc73971c5b00e8e6b.png)\n\n###views/index.ejs\n\u30ed\u30b0\u30a4\u30f3\u5f8c\u306e\u30da\u30fc\u30b8\u3067\u3059\uff0e\n\n```html:\n<!doctype html>\n<html lang=\"ja\">\n<head>\n\t<meta charset=\"UTF-8\">\n\t<title>\u30ed\u30b0\u30a4\u30f3\u5f8c</title>\n</head>\n<body>\n\t<h1>My Site</h1>\n    <p>Welcome to My Site</p>\n    <%= user %> \u3055\u3093\u3088\u3046\u3053\u305d\u3002\n    <p>\n    \t<a href=\"/logout\">\u30ed\u30b0\u30a2\u30a6\u30c8</a>\n    </p>\n</body>\n</html>\n```\n###\u753b\u9762\u4f8b /index\n![](http://gyazo.com/88e3b2db0ba42ce265c34bc63e97440d.png)\n\n##\u52d5\u4f5c\u78ba\u8a8d\n\u30ed\u30b0\u30a4\u30f3\u524d\u306b`/` or `/index`\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3067`/login`\u304c\u8868\u793a\u3055\u308c\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\u65b0\u898f\u767b\u9332(\u7279\u306b\u4f55\u3082\u8868\u793a\u3055\u308c\u307e\u305b\u3093\u304c)\u3092\u3057\u3066\u304b\u3089\u65b0\u898f\u767b\u9332\u3057\u305f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3092\u3059\u308b\u3068`/`\u3092\u898b\u308c\u308b\u306f\u305a\u3067\u3059\uff0e\u307e\u305f,\u30ed\u30b0\u30a2\u30a6\u30c8\u306e\u30ea\u30f3\u30af\u3092\u62bc\u3059\u3068session\u304c\u7834\u68c4\u3055\u308c`/logoin`\u306b\u623b\u308b\u3068\u601d\u3044\u307e\u3059\uff0e\n\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u301c\uff0e\n", "tags": ["Express", "Node.js", "MongoDB"]}