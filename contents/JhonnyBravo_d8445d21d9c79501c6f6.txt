{"context": "\n\n\u524d\u63d0\u3068\u3059\u308b\u74b0\u5883\n\n\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2: Raspberry Pi 3 Model B\nOS: Raspbian\n\u6709\u7dda LAN \u304b\u3089\u7121\u7dda LAN \u3078\u30d1\u30b1\u30c3\u30c8\u8ee2\u9001\u3092\u884c\u3046\u3002\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\napt-get install hostapd isc-dhcp-server haveged iw\n\niw \u306b\u3064\u3044\u3066\u306f Raspbian \u306b\u6a19\u6e96\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u69d8\u5b50\u3002\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u69cb\u7bc9\n/etc/network/interfaces \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/network/interfaces\nallow-hotplug wlan0\niface wlan0 inet manual\n    # wpa-conf / etc/wpa_supplicant/wpa_supplicant.conf\n\n\nwpa-conf / etc/wpa_supplicant/wpa_supplicant.conf \u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3002\nubuntu \u3067\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u308b\u5834\u5408\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5b9a\u7fa9\u3092\n/etc/network/interfaces \u306b\u8a18\u8ff0\u3059\u308b\u304c\u3001 Raspbian \u306e\u5834\u5408\u306f\u4e0d\u8981\u3002\n/etc/dhcpcd.conf \u3092\u7de8\u96c6\u3059\u308b\u3002\n\u5f8c\u8ff0\u306e /etc/dhcp/dhcpd.conf \u3068\u9593\u9055\u3048\u305d\u3046\u306b\u306a\u308b\u304c\u3001\n\u5168\u304f\u5225\u7269\u306a\u306e\u3067\u8981\u6ce8\u610f\u3002\n\n/etc/dhcpcd.conf\ninterface wlan0\nstatic ip_address=192.168.2.1/24\n\n\n\n\u30d1\u30b1\u30c3\u30c8\u306e\u8ee2\u9001\u8a2d\u5b9a\n/etc/sysctl.conf \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/sysctl.conf\n# \u306a\u308a\u3059\u307e\u3057\u653b\u6483\u3092\u9632\u6b62\u3059\u308b\u3002\nnet.ipv4.conf.default.rp_filter=1\nnet.ipv4.conf.all.rp_filter=1\n\n# TCP/IP SYN \u30af\u30c3\u30ad\u30fc\u3092\u7121\u52b9\u306b\u3059\u308b\u3002\nnet.ipv4.tcp_syncookies=0\n\n# IPv4 \u30d1\u30b1\u30c3\u30c8\u8ee2\u9001\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\nnet.ipv4.ip_forward=1\n\n# ICMP \u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u53d7\u4fe1\u3057\u306a\u3044\u3002(MITM \u653b\u6483\u306e\u9632\u6b62)\nnet.ipv4.conf.all.accept_redirects=0\nnet.ipv6.conf.all.accept_redirects=0\n\n# IP \u30bd\u30fc\u30b9\u30eb\u30fc\u30c8\u30d1\u30b1\u30c3\u30c8\u3092\u53d7\u4fe1\u3057\u306a\u3044\u3002\nnet.ipv4.conf.all.accept_source_route=0\nnet.ipv6.conf.all.accept_source_route=0\n\n# \u6709\u308a\u5f97\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u8a18\u9332\u3057\u306a\u3044\u3002\nnet.ipv4.conf.all.log_martians=0\n\n\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\nsh -c \"echo 1 > /proc/sys/net/ipv4/ip_forward\"\n\niptables \u3092\u8a2d\u5b9a\u3059\u308b\u3002\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\niptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT\nsh -c \"iptables-save > /etc/iptables.ipv4.nat\"\n\n\u8ee2\u9001\u8a2d\u5b9a\u304c\u7dad\u6301\u3055\u308c\u308b\u3088\u3046\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u3001\n/etc/network/if-pre-up.d/iptables \u3068\u547d\u540d\u3059\u308b\u3002\n\n/etc/network/if-pre-up.d/iptables\n#!/bin/sh\niptables-restore < /etc/iptables.ipv4.nat\nexit 0\n\n\n\nisc-dhcp-server \u306e\u8a2d\u5b9a\n/etc/dhcp/dhcpd.conf \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/dhcp/dhcpd.conf\nauthoritative;\n\nsubnet 192.168.2.0 netmask 255.255.255.0{\n  range 192.168.2.10 192.168.2.50;\n  option routers 192.168.2.1\n  default-lease-time 600;\n  max-lease-time 7200;\n  option domain-name \"\u4efb\u610f\u306e\u30c9\u30e1\u30a4\u30f3\u540d\";\n  option domain-name-servers 8.8.8.8,8.8.4.4;\n}\n\n\n/etc/default/isc-dhcp-server \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/default/isc-dhcp-server\nINTERFACES=\"wlan0\"\n\n\n\nhostapd \u306e\u8a2d\u5b9a\n/etc/hostapd/hostapd.conf \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/hostapd/hostapd.conf\ninterface=wlan0\ndriver=nl80211\nssid=\u4efb\u610f\u306e ssid\ncountry_code=JP\nhw_mode=g\nieee80211d=1\nchannel=6\nauth_algs=1\nignore_broadcast_ssid=0\ndisassoc_low_ack=1\nieee80211n=1\nht_capab=[HT40] [SHORT-GI-20] [DSSS_CCK-40]\nrequire_ht=0\nwpa=2\nwpa_passphrase=\u4efb\u610f\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\nwpa_key_mgmt=WPA-PSK\nrsn_pairwise=CCMP\nwpa_group_rekey=86400\nmax_num_sta=3\n\n\n/etc/default/hostapd \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n/etc/default/hostapd\nDAEMON_CONF=\"/etc/hostapd/hostapd.conf\"\nDAEMON_OPTS=\"-dd\"\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nRaspberrry Pi 3 \u3092\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\nservice hostapd status\nservice isc-dhcp-server status\n\nhostapd \u3082 isc-dhcp-server \u3082\u30b9\u30c6\u30fc\u30bf\u30b9\u304c active(running) \u306b\u306a\u3063\u3066\u304a\u308a\u3001\n\u4ed6\u306e\u7aef\u672b\u304b\u3089 WiFi \u3078\u63a5\u7d9a\u3067\u304d\u308c\u3070\u6210\u529f\u3002\n\n\u53c2\u8003\u6587\u732e\n\nRaspberry Pi 3 \u3067\u3001 Wi-Fi \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u30eb\u30fc\u30bf\nInstall software | Setting up a Raspberry Pi as a WiFi access point | Adafruit Learning System\nQckTech: Raspberry Pi as a Router\nhostapd \u8a2d\u5b9a \u899a\u66f8\n\n#\u524d\u63d0\u3068\u3059\u308b\u74b0\u5883\n\n* \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2: Raspberry Pi 3 Model B\n* OS: Raspbian\n* \u6709\u7dda LAN \u304b\u3089\u7121\u7dda LAN \u3078\u30d1\u30b1\u30c3\u30c8\u8ee2\u9001\u3092\u884c\u3046\u3002\n\n#\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```bash\napt-get install hostapd isc-dhcp-server haveged iw\n```\n\niw \u306b\u3064\u3044\u3066\u306f Raspbian \u306b\u6a19\u6e96\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u69d8\u5b50\u3002\n\n#\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u69cb\u7bc9\n\n``/etc/network/interfaces`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/network/interfaces\nallow-hotplug wlan0\niface wlan0 inet manual\n    # wpa-conf / etc/wpa_supplicant/wpa_supplicant.conf\n```\n\nwpa-conf / etc/wpa_supplicant/wpa_supplicant.conf \u306e\u884c\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3059\u308b\u3060\u3051\u3002\nubuntu \u3067\u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u3092\u4f5c\u308b\u5834\u5408\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5b9a\u7fa9\u3092\n``/etc/network/interfaces`` \u306b\u8a18\u8ff0\u3059\u308b\u304c\u3001 Raspbian \u306e\u5834\u5408\u306f\u4e0d\u8981\u3002\n\n``/etc/dhcpcd.conf`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\u5f8c\u8ff0\u306e ``/etc/dhcp/dhcpd.conf`` \u3068\u9593\u9055\u3048\u305d\u3046\u306b\u306a\u308b\u304c\u3001\n\u5168\u304f\u5225\u7269\u306a\u306e\u3067\u8981\u6ce8\u610f\u3002\n\n```/etc/dhcpcd.conf\ninterface wlan0\nstatic ip_address=192.168.2.1/24\n```\n\n#\u30d1\u30b1\u30c3\u30c8\u306e\u8ee2\u9001\u8a2d\u5b9a\n\n``/etc/sysctl.conf`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/sysctl.conf\n# \u306a\u308a\u3059\u307e\u3057\u653b\u6483\u3092\u9632\u6b62\u3059\u308b\u3002\nnet.ipv4.conf.default.rp_filter=1\nnet.ipv4.conf.all.rp_filter=1\n\n# TCP/IP SYN \u30af\u30c3\u30ad\u30fc\u3092\u7121\u52b9\u306b\u3059\u308b\u3002\nnet.ipv4.tcp_syncookies=0\n\n# IPv4 \u30d1\u30b1\u30c3\u30c8\u8ee2\u9001\u3092\u6709\u52b9\u306b\u3059\u308b\u3002\nnet.ipv4.ip_forward=1\n\n# ICMP \u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3092\u53d7\u4fe1\u3057\u306a\u3044\u3002(MITM \u653b\u6483\u306e\u9632\u6b62)\nnet.ipv4.conf.all.accept_redirects=0\nnet.ipv6.conf.all.accept_redirects=0\n\n# IP \u30bd\u30fc\u30b9\u30eb\u30fc\u30c8\u30d1\u30b1\u30c3\u30c8\u3092\u53d7\u4fe1\u3057\u306a\u3044\u3002\nnet.ipv4.conf.all.accept_source_route=0\nnet.ipv6.conf.all.accept_source_route=0\n\n# \u6709\u308a\u5f97\u306a\u3044\u30d1\u30b1\u30c3\u30c8\u3092\u8a18\u9332\u3057\u306a\u3044\u3002\nnet.ipv4.conf.all.log_martians=0\n```\n\n\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```bash:\nsh -c \"echo 1 > /proc/sys/net/ipv4/ip_forward\"\n```\n\niptables \u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```bash:\niptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\niptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT\nsh -c \"iptables-save > /etc/iptables.ipv4.nat\"\n```\n\n\u8ee2\u9001\u8a2d\u5b9a\u304c\u7dad\u6301\u3055\u308c\u308b\u3088\u3046\u306b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u308a\u3001\n``/etc/network/if-pre-up.d/iptables`` \u3068\u547d\u540d\u3059\u308b\u3002\n\n```bash:/etc/network/if-pre-up.d/iptables\n#!/bin/sh\niptables-restore < /etc/iptables.ipv4.nat\nexit 0\n```\n\n#isc-dhcp-server \u306e\u8a2d\u5b9a\n\n``/etc/dhcp/dhcpd.conf`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/dhcp/dhcpd.conf\nauthoritative;\n\nsubnet 192.168.2.0 netmask 255.255.255.0{\n  range 192.168.2.10 192.168.2.50;\n  option routers 192.168.2.1\n  default-lease-time 600;\n  max-lease-time 7200;\n  option domain-name \"\u4efb\u610f\u306e\u30c9\u30e1\u30a4\u30f3\u540d\";\n  option domain-name-servers 8.8.8.8,8.8.4.4;\n}\n```\n\n``/etc/default/isc-dhcp-server`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/default/isc-dhcp-server\nINTERFACES=\"wlan0\"\n```\n\n#hostapd \u306e\u8a2d\u5b9a\n\n``/etc/hostapd/hostapd.conf`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/hostapd/hostapd.conf\ninterface=wlan0\ndriver=nl80211\nssid=\u4efb\u610f\u306e ssid\ncountry_code=JP\nhw_mode=g\nieee80211d=1\nchannel=6\nauth_algs=1\nignore_broadcast_ssid=0\ndisassoc_low_ack=1\nieee80211n=1\nht_capab=[HT40] [SHORT-GI-20] [DSSS_CCK-40]\nrequire_ht=0\nwpa=2\nwpa_passphrase=\u4efb\u610f\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\nwpa_key_mgmt=WPA-PSK\nrsn_pairwise=CCMP\nwpa_group_rekey=86400\nmax_num_sta=3\n```\n\n``/etc/default/hostapd`` \u3092\u7de8\u96c6\u3059\u308b\u3002\n\n```bash:/etc/default/hostapd\nDAEMON_CONF=\"/etc/hostapd/hostapd.conf\"\nDAEMON_OPTS=\"-dd\"\n```\n\n#\u52d5\u4f5c\u78ba\u8a8d\n\nRaspberrry Pi 3 \u3092\u518d\u8d77\u52d5\u3057\u305f\u5f8c\u3001\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```bash\nservice hostapd status\nservice isc-dhcp-server status\n```\n\nhostapd \u3082 isc-dhcp-server \u3082\u30b9\u30c6\u30fc\u30bf\u30b9\u304c active(running) \u306b\u306a\u3063\u3066\u304a\u308a\u3001\n\u4ed6\u306e\u7aef\u672b\u304b\u3089 WiFi \u3078\u63a5\u7d9a\u3067\u304d\u308c\u3070\u6210\u529f\u3002\n\n#\u53c2\u8003\u6587\u732e\n\n* [Raspberry Pi 3 \u3067\u3001 Wi-Fi \u30a2\u30af\u30bb\u30b9\u30dd\u30a4\u30f3\u30c8\u30eb\u30fc\u30bf](http://qiita.com/mt08/items/f2e4f9d3b1ed00849e23)\n* [Install software | Setting up a Raspberry Pi as a WiFi access point | Adafruit Learning System](https://learn.adafruit.com/setting-up-a-raspberry-pi-as-a-wifi-access-point/install-software)\n* [QckTech: Raspberry Pi as a Router](http://qcktech.blogspot.jp/2012/08/raspberry-pi-as-router.html)\n* [hostapd \u8a2d\u5b9a \u899a\u66f8](http://qiita.com/JhonnyBravo/items/947e480f7f3eb0728e19)\n", "tags": ["RaspberryPi", "raspbian", "hostapd", "isc-dhcp-server", "WiFi"]}