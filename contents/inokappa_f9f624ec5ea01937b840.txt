{"tags": ["serverspec", "Infrataster", "\u30cf\u30f3\u30ba\u30aa\u30f3", "Jenkins"], "context": "\n\n\u306f\u3058\u3081\u306b\n\n\u3084\u308b\u3053\u3068\n\n\nJenkins \u3092\u4f7f\u3063\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u81ea\u52d5\u5316\n\u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092 push\n\n\n\u5fc5\u8981\u306a\u3082\u306e\n\u4ee5\u4e0b\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u65e2\u306b\u304a\u6301\u3061\u3067\u3042\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u8cc7\u6599\u3092\u9032\u3081\u308b\u3002\n\nDocker Hub \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\nGitHub \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\n\u4e0a\u8a18\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7121\u3044\u65b9\u306f\u4e8b\u524d\u306b\u53d6\u5f97\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\uff08\u203b \u53d6\u3063\u3066\u304a\u3044\u3066\u640d\u306f\u7121\u3044\u3068\u601d\u3044\u307e\u3059\uff09\n\n\u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u6d41\u308c\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306b Jenkins \u3092\u5c0e\u5165\nJenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\nGitHub \u4e0a\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 fork \u3059\u308b\nfork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3068 Jenkins \u3092\u9023\u643a\u3055\u305b\u308b\n\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b push \u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 B\uff09\u3092\u4f5c\u6210\u3059\u308b\nDockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 A\uff09\u3092\u4f5c\u6210\u3059\u308b\n\u30d3\u30e5\u30fc\u306b\u3066\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8868\u793a\u3092\u8a2d\u5b9a\u3059\u308b\n\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3092\u5f04\u3063\u305f\u308a\u3001Spec \u30d5\u30a1\u30a4\u30eb\u3092\u5f04\u3063\u3066\u3001\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5b9f\u884c\u7b49\u3092\u4f53\u611f\u3059\u308b\n\n\n\n\u624b\u9806\n\n1. \u4eee\u60f3\u30de\u30b7\u30f3\u306b Jenkins \u3092\u5c0e\u5165\n\nJenkins \u306e\u5c0e\u5165\n\ncommand\nsudo apt-get update\nsudo apt-get -y install openjdk-7-jre openjdk-7-jdk\nwget -q -O - https://jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -\nsudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'\nsudo apt-get update\nsudo apt-get -y install jenkins\n\n\n\nJenkins \u30e6\u30fc\u30b6\u30fc\u304c Docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u3059\u308b\n\ncommand\nsudo usermod -G docker jenkins\n\n\n\u5ff5\u306e\u305f\u3081\u306b\u78ba\u8a8d\u3002\n\ncommand\nsudo -u jenkins docker version\n\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\ncommand\nClient:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\n\n\n2. Jenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\n\u4ee5\u4e0b\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3059\u308b\u3002\n\nBuild Pipeline Plugin\nCloudBees Docker Build and Publish plugin\nGitHub plugin\n\n\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 Jenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3059\u308b\u3002\n\ncommand\nwget http://localhost:8080/jnlpJars/jenkins-cli.jar\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin github\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin build-pipeline-plugin\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin docker-build-publish\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u305f\u3089 Jenkins \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\ncommand\nsudo service jenkins restart\n\n\n\n3. GitHub \u4e0a\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 fork \u3059\u308b\n\nGitHub \u4e0a\u3067 https://github.com/inokappa/handson-serverspec \u3092 fork \u3059\u308b\n\n\n4. fork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 Jenkins \u3092\u9023\u643a\u3055\u305b\u308b\n\nfork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u306e Webhooks & services \u306b\u3066 Add services \u3092\u9078\u629e\u3001[Add Jenkins (GitHub plugin)] \u3092\u9078\u629e\n\n\n\nGitHub \u304b\u3089 Jenkins \u306e webhook URL \u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u4e0b\u56f3\u306e\u3088\u3046\u306bGitHub \u306e IP \u30a2\u30c9\u30ec\u30b9\u306f https://api.github.com/meta \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u78ba\u8a8d\u3001hooks \u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u5229\u7528\u3059\u308b\u3002\n\n\n5. \u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b push \u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 B\uff09\u3092\u4f5c\u6210\u3059\u308b\n\n\u30b8\u30e7\u30d6\u8a2d\u5b9a\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d ... Docker_Build_Push\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7ba1\u7406 ... \u306a\u3057\n\u30d3\u30eb\u30c9 ... Docker Build and Publish \u3092\u9078\u629e\n\n\nDocker Build and Publish \u306e\u8a2d\u5b9a\n\n\nRepository Name ... ${your_dockerhub_account}/serverspec-handson\nTag ... latest\nRegistry credentials ... \u8ffd\u52a0\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4e0b\u56f3\u306e\u3088\u3046\u306b Docker Hub \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\n\n\n\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u3068 ${JENKINS_HOME}/credentials.xml \u306b\u8a2d\u5b9a\u3057\u305f\u8a8d\u8a3c\u60c5\u5831\u304c\u8ffd\u8a18\u3055\u308c\u308b\u3002\n\u7d9a\u3044\u3066\u3001\u300c\u9ad8\u5ea6\u306a\u8a2d\u5b9a...\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n\nNo Cache ... \u30c1\u30a7\u30c3\u30af\uff08--nocache \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u308b\uff09\nBuild Context ... /var/lib/jenkins/jobs/Serverspec_Handson/workspace/docker/ \u3092\u8a2d\u5b9a\nDockerfile Path ... /var/lib/jenkins/jobs/Serverspec_Handson/workspace/docker/Dockerfile \u3092\u8a2d\u5b9a\n\n\n6. Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 A\uff09\u3092\u4f5c\u6210\u3059\u308b\n\n\u30b8\u30e7\u30d6\u8a2d\u5b9a\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d ... Serverspec_Handson\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7ba1\u7406 ... Git \u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\n\n\nRepository URL \u306b\u306f https://github.com/${your_account}/handson-serverspec.git \u3092\u6307\u5b9a\n\n\n\u30d3\u30eb\u30c9\u30c8\u30ea\u30ac ... Build when a change is pushed to GitHub \u3092\u9078\u629e\n\u30d3\u30eb\u30c9 ... \u300c\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u300d\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u3066\u304a\u304f\n\n\nscript\nPATH=\"/var/lib/jenkins/.rbenv/bin:$PATH\"\neval \"$(rbenv init -)\"\ncd /var/lib/jenkins/workspace/$JOB_NAME\nbundle install\nbundle exec rspec spec/docker_*_spec.rb\n\n\n\n\u30d3\u30eb\u30c9\u5f8c\u306e\u51e6\u7406 ... \u300c\u4ed6\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d3\u30eb\u30c9\u300d\u3092\u9078\u629e\n\n\n\u30d3\u30eb\u30c9\u5f8c\u306e\u51e6\u7406\u300c\u4ed6\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d3\u30eb\u30c9\u300d\u306e\u8a2d\u5b9a\n\n\u5bfe\u8c61\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b Docker_Build_Push \u3092\u6307\u5b9a\n\u5b89\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u8d77\u52d5\u306b\u30c1\u30a7\u30c3\u30af\n\n\n7. \u30d3\u30e5\u30fc\u306b\u3066\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8868\u793a\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u30b8\u30e7\u30d6\u4e00\u89a7\u3088\u308a \uff0b \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n\n\u30d3\u30e5\u30fc\u540d\u3092\u5165\u529b\u3057\u3066 Build Pipeline View \u306b\u30c1\u30a7\u30c3\u30af\n\n\nBuild Pipeline View \u306e\u8a2d\u5b9a\n\n\n\u540d\u524d ... Serverspec_Handson\nLayout \u306e Select Initial Job ... Serverspec_Handson\nNo Of Displayed Builds ... 5\n\n\n8. \u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3092\u5f04\u3063\u305f\u308a\u3001Spec \u30d5\u30a1\u30a4\u30eb\u3092\u5f04\u3063\u3066\u3001\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5b9f\u884c\u7b49\u3092\u4f53\u611f\u3059\u308b\n\nbuild ship run\n\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3084 Spec \u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u3066 GitHub \u306b push \u3059\u308b\u5ea6\u306b Jenkins \u3067\u30c6\u30b9\u30c8\u3001\u30d3\u30eb\u30c9\u3001Docker Hub \u3078\u306e push \u304c\u884c\u308f\u308c\u308b\u3002\n\u307e\u3055\u306b build ship run!!\uff08run \u307e\u3067\u306f\u3084\u3063\u3066\u306a\u3044\u3051\u3069\uff09\n\nJenkins \u306e\u30d3\u30eb\u30c9\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\n\n\ngit clone \u2192 Test\n\n\nBuild \u2192 Push\n\n\nDocker Hub\n\n\n\n\u3068\u3044\u3046\u3053\u3068\u3067\n\u660e\u65e5\u304b\u3089\u306e\u7686\u3055\u3093\u306e\u696d\u52d9\u306e\u304a\u5f79\u306b\u7acb\u3066\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n\n## \u306f\u3058\u3081\u306b\n\n### \u3084\u308b\u3053\u3068\n\n![2016070101.png](https://qiita-image-store.s3.amazonaws.com/0/87189/9cf7b23e-4650-4fb5-57e8-3e49086d039c.png \"2016070101.png\")\n\n- Jenkins \u3092\u4f7f\u3063\u3066 Dockerfile \u306e\u30c6\u30b9\u30c8\u3092\u81ea\u52d5\u5316\n- \u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092 push\n\n### \u5fc5\u8981\u306a\u3082\u306e\n\n\u4ee5\u4e0b\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u65e2\u306b\u304a\u6301\u3061\u3067\u3042\u308b\u3068\u3044\u3046\u524d\u63d0\u3067\u8cc7\u6599\u3092\u9032\u3081\u308b\u3002\n\n- Docker Hub \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n- GitHub \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\n\n\u4e0a\u8a18\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7121\u3044\u65b9\u306f\u4e8b\u524d\u306b\u53d6\u5f97\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\uff08\u203b \u53d6\u3063\u3066\u304a\u3044\u3066\u640d\u306f\u7121\u3044\u3068\u601d\u3044\u307e\u3059\uff09\n\n### \u30cf\u30f3\u30ba\u30aa\u30f3\u306e\u6d41\u308c\n\n1. \u4eee\u60f3\u30de\u30b7\u30f3\u306b Jenkins \u3092\u5c0e\u5165\n2. Jenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\n3. GitHub \u4e0a\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 fork \u3059\u308b\n4. fork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3068 Jenkins \u3092\u9023\u643a\u3055\u305b\u308b\n5. \u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b push \u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 B\uff09\u3092\u4f5c\u6210\u3059\u308b\n6. Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 A\uff09\u3092\u4f5c\u6210\u3059\u308b\n7. \u30d3\u30e5\u30fc\u306b\u3066\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8868\u793a\u3092\u8a2d\u5b9a\u3059\u308b\n8. \u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3092\u5f04\u3063\u305f\u308a\u3001Spec \u30d5\u30a1\u30a4\u30eb\u3092\u5f04\u3063\u3066\u3001\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5b9f\u884c\u7b49\u3092\u4f53\u611f\u3059\u308b\n\n***\n\n## \u624b\u9806\n\n### 1. \u4eee\u60f3\u30de\u30b7\u30f3\u306b Jenkins \u3092\u5c0e\u5165\n\n#### Jenkins \u306e\u5c0e\u5165\n\n~~~sh:command\nsudo apt-get update\nsudo apt-get -y install openjdk-7-jre openjdk-7-jdk\nwget -q -O - https://jenkins-ci.org/debian/jenkins-ci.org.key | sudo apt-key add -\nsudo sh -c 'echo deb http://pkg.jenkins-ci.org/debian-stable binary/ > /etc/apt/sources.list.d/jenkins.list'\nsudo apt-get update\nsudo apt-get -y install jenkins\n~~~\n\n#### Jenkins \u30e6\u30fc\u30b6\u30fc\u304c Docker \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u51fa\u6765\u308b\u3088\u3046\u3059\u308b\n\n~~~sh:command\nsudo usermod -G docker jenkins\n~~~\n\n\u5ff5\u306e\u305f\u3081\u306b\u78ba\u8a8d\u3002\n\n~~~sh:command\nsudo -u jenkins docker version\n~~~\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n~~~sh:command\nClient:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.11.2\n API version:  1.23\n Go version:   go1.5.4\n Git commit:   b9f10c9\n Built:        Wed Jun  1 21:47:50 2016\n OS/Arch:      linux/amd64\n~~~\n\n### 2. Jenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\n\n\u4ee5\u4e0b\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3059\u308b\u3002\n\n- Build Pipeline Plugin\n- CloudBees Docker Build and Publish plugin\n- GitHub plugin\n\n\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u3066\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 Jenkins \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3059\u308b\u3002\n\n~~~sh:command\nwget http://localhost:8080/jnlpJars/jenkins-cli.jar\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin github\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin build-pipeline-plugin\njava -jar jenkins-cli.jar -s http://localhost:8080 install-plugin docker-build-publish\n~~~\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u305f\u3089 Jenkins \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n~~~sh:command\nsudo service jenkins restart\n~~~\n\n### 3. GitHub \u4e0a\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 fork \u3059\u308b\n\n- GitHub \u4e0a\u3067 https://github.com/inokappa/handson-serverspec \u3092 fork \u3059\u308b\n\n### 4. fork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u3092 Jenkins \u3092\u9023\u643a\u3055\u305b\u308b\n\n- fork \u3057\u305f\u30ea\u30dd\u30b8\u30c8\u30ea\u306e Webhooks & services \u306b\u3066 Add services \u3092\u9078\u629e\u3001[Add Jenkins (GitHub plugin)] \u3092\u9078\u629e\n\n![2016070102.png](https://qiita-image-store.s3.amazonaws.com/0/87189/a2fca1e4-4cf0-d756-c7f1-718f241e118a.png \"2016070102.png\")\n\n- GitHub \u304b\u3089 Jenkins \u306e webhook URL \u306b\u30a2\u30af\u30bb\u30b9\u51fa\u6765\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3092\u884c\u3046\n\n\u4e0b\u56f3\u306e\u3088\u3046\u306bGitHub \u306e IP \u30a2\u30c9\u30ec\u30b9\u306f https://api.github.com/meta \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u78ba\u8a8d\u3001hooks \u306e IP \u30a2\u30c9\u30ec\u30b9\u3092\u5229\u7528\u3059\u308b\u3002\n\n![2016070302.png](https://qiita-image-store.s3.amazonaws.com/0/87189/cc13dbf5-8fc3-1418-7168-d33c3c3c6ab2.png \"2016070302.png\")\n\n### 5. \u30b3\u30f3\u30c6\u30ca\u3092\u30d3\u30eb\u30c9\u3057\u3066 Docker Hub \u306b push \u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 B\uff09\u3092\u4f5c\u6210\u3059\u308b\n\n#### \u30b8\u30e7\u30d6\u8a2d\u5b9a\n\n- \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d ... Docker_Build_Push\n- \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7ba1\u7406 ... \u306a\u3057\n- \u30d3\u30eb\u30c9 ... Docker Build and Publish \u3092\u9078\u629e\n\n#### Docker Build and Publish \u306e\u8a2d\u5b9a\n\n![2016062902.png](https://qiita-image-store.s3.amazonaws.com/0/87189/8c4d6cd7-917a-29e2-4a2f-fd64a36e3227.png \"2016062902.png\")\n\n- Repository Name ... ${your_dockerhub_account}/serverspec-handson\n- Tag ... latest\n- Registry credentials ... \u8ffd\u52a0\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4e0b\u56f3\u306e\u3088\u3046\u306b Docker Hub \u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\n\n![2016062903.png](https://qiita-image-store.s3.amazonaws.com/0/87189/2c40c237-cae5-3029-efb4-e906f03cf098.png \"2016062903.png\")\n\n\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u3068 ${JENKINS_HOME}/credentials.xml \u306b\u8a2d\u5b9a\u3057\u305f\u8a8d\u8a3c\u60c5\u5831\u304c\u8ffd\u8a18\u3055\u308c\u308b\u3002\n\n\u7d9a\u3044\u3066\u3001\u300c\u9ad8\u5ea6\u306a\u8a2d\u5b9a...\u300d\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n\n![2016070301.png](https://qiita-image-store.s3.amazonaws.com/0/87189/03b63a5b-451d-0e41-b585-d4c5f5733fac.png \"2016070301.png\")\n\n- No Cache ... \u30c1\u30a7\u30c3\u30af\uff08`--nocache` \u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9\u306b\u306a\u308b\uff09\n- Build Context ... `/var/lib/jenkins/jobs/Serverspec_Handson/workspace/docker/` \u3092\u8a2d\u5b9a\n- Dockerfile Path ... `/var/lib/jenkins/jobs/Serverspec_Handson/workspace/docker/Dockerfile` \u3092\u8a2d\u5b9a\n\n### 6. Dockerfile \u3092\u30c6\u30b9\u30c8\u3059\u308b\u30b8\u30e7\u30d6\uff08\u30b8\u30e7\u30d6 A\uff09\u3092\u4f5c\u6210\u3059\u308b\n\n#### \u30b8\u30e7\u30d6\u8a2d\u5b9a\n\n- \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d ... Serverspec_Handson\n- \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u7ba1\u7406 ... Git \u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\n - Repository URL \u306b\u306f https://github.com/${your_account}/handson-serverspec.git \u3092\u6307\u5b9a\n- \u30d3\u30eb\u30c9\u30c8\u30ea\u30ac ... Build when a change is pushed to GitHub \u3092\u9078\u629e\n- \u30d3\u30eb\u30c9 ... \u300c\u30b7\u30a7\u30eb\u306e\u5b9f\u884c\u300d\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u3066\u304a\u304f\n\n~~~sh:script\nPATH=\"/var/lib/jenkins/.rbenv/bin:$PATH\"\neval \"$(rbenv init -)\"\ncd /var/lib/jenkins/workspace/$JOB_NAME\nbundle install\nbundle exec rspec spec/docker_*_spec.rb\n~~~\n\n- \u30d3\u30eb\u30c9\u5f8c\u306e\u51e6\u7406 ... \u300c\u4ed6\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d3\u30eb\u30c9\u300d\u3092\u9078\u629e\n\n#### \u30d3\u30eb\u30c9\u5f8c\u306e\u51e6\u7406\u300c\u4ed6\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30d3\u30eb\u30c9\u300d\u306e\u8a2d\u5b9a\n\n- \u5bfe\u8c61\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b Docker_Build_Push \u3092\u6307\u5b9a\n- \u5b89\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u307f\u8d77\u52d5\u306b\u30c1\u30a7\u30c3\u30af\n\n### 7. \u30d3\u30e5\u30fc\u306b\u3066\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8868\u793a\u3092\u8a2d\u5b9a\u3059\u308b\n\n#### \u30b8\u30e7\u30d6\u4e00\u89a7\u3088\u308a \uff0b \u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\n\n![2016062905.png](https://qiita-image-store.s3.amazonaws.com/0/87189/76a780d4-19c8-a1e7-6575-0ad8ffddd74b.png \"2016062905.png\")\n\n#### \u30d3\u30e5\u30fc\u540d\u3092\u5165\u529b\u3057\u3066 Build Pipeline View \u306b\u30c1\u30a7\u30c3\u30af\n\n![2016062906.png](https://qiita-image-store.s3.amazonaws.com/0/87189/1b94c113-657c-b043-89fa-f5166056fc82.png \"2016062906.png\")\n\n#### Build Pipeline View \u306e\u8a2d\u5b9a\n\n![2016062907.png](https://qiita-image-store.s3.amazonaws.com/0/87189/bfeeb55a-a61a-306d-439d-ea274406885a.png \"2016062907.png\")\n\n- \u540d\u524d ... Serverspec_Handson\n- Layout \u306e Select Initial Job ... Serverspec_Handson\n- No Of Displayed Builds ... 5\n\n### 8. \u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3092\u5f04\u3063\u305f\u308a\u3001Spec \u30d5\u30a1\u30a4\u30eb\u3092\u5f04\u3063\u3066\u3001\u30c6\u30b9\u30c8\u306e\u81ea\u52d5\u5b9f\u884c\u7b49\u3092\u4f53\u611f\u3059\u308b\n\n#### build ship run\n\n\u30ed\u30fc\u30ab\u30eb\u30de\u30b7\u30f3\u3067 Dockerfile \u3084 Spec \u30d5\u30a1\u30a4\u30eb\u3092\u4fee\u6b63\u3057\u3066 GitHub \u306b push \u3059\u308b\u5ea6\u306b Jenkins \u3067\u30c6\u30b9\u30c8\u3001\u30d3\u30eb\u30c9\u3001Docker Hub \u3078\u306e push \u304c\u884c\u308f\u308c\u308b\u3002\n\n\u307e\u3055\u306b build ship run!!\uff08run \u307e\u3067\u306f\u3084\u3063\u3066\u306a\u3044\u3051\u3069\uff09\n\n#### Jenkins \u306e\u30d3\u30eb\u30c9\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\n\n![2016070103.png](https://qiita-image-store.s3.amazonaws.com/0/87189/4c7648da-1b5f-957c-244d-3d858f34de4f.png \"2016070103.png\")\n\n#### git clone \u2192 Test\n\n![2016070105.png](https://qiita-image-store.s3.amazonaws.com/0/87189/1139790c-7ee8-ce99-bd63-d4523708cd5b.png \"2016070105.png\")\n\n#### Build \u2192 Push\n\n![2016070106.png](https://qiita-image-store.s3.amazonaws.com/0/87189/c7a1a873-918b-96e8-1494-10f616f8ea7e.png \"2016070106.png\")\n\n#### Docker Hub\n\n![2016070104.png](https://qiita-image-store.s3.amazonaws.com/0/87189/f36639b7-0715-f0f9-a5cc-8c9d4243ab3a.png \"2016070104.png\")\n\n***\n\n## \u3068\u3044\u3046\u3053\u3068\u3067\n\n\u660e\u65e5\u304b\u3089\u306e\u7686\u3055\u3093\u306e\u696d\u52d9\u306e\u304a\u5f79\u306b\u7acb\u3066\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\u304a\u75b2\u308c\u69d8\u3067\u3057\u305f\u3002\n"}