{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\nmon-put-instance-data.pl \u304c\u6025\u306b The Auto Scaling metrics will not be reported this time. \u3068\u304b\u8a00\u3044\u51fa\u3057\u305f\nAMI \u4f5c\u308a\u5909\u3048\u305f\u3068\u304d\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u539f\u56e0\u3067 /var/tmp/aws-mon \u306b\u53e4\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u304c\u6b8b\u3063\u3066\u305f\n\n\n/var/tmp/aws-mon/instance-id \u66f8\u304d\u63db\u3048\u305f\u3089\u76f4\u3063\u305f\n\n\n\u80cc\u666f\n\u8907\u6570\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 AutoScaling \u3067\u4e0a\u3052\u305f\u308a\u4e0b\u3052\u305f\u308a\u3059\u308b\u3068\u304d\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u306e\u5168\u53f0\u6570\u5e73\u5747\u3068\u304b\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3068\u304b\u3092 AutoScalingGroup \u5358\u4f4d\u3067\u307e\u3068\u3081\u305f\u3044\u3063\u3066\u601d\u3044\u307e\u3059\u3088\u306d\uff1f\n\u305d\u3093\u306a\u3068\u304d\u3069\u3046\u3059\u308b\u304b\u3063\u3066\u8a00\u3063\u305f\u3089\u3084\u3063\u3071\u308aAmazon CloudWatch Monitoring Scripts for Linux\u3067\u3059\u3088\u306d\u3002\nWindows? \u77e5\u3089\u3093\n\n\u4e8b\u8c61\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u69cb\u6210\u306b\u5909\u66f4\u304c\u3042\u3063\u305f\u304b\u3089 AutoScaling \u7528\u306e AMI \u66f4\u65b0\u3057\u306a\u304d\u3083\u306a\u30fc\u3001\u3068\u3044\u3064\u3082\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7acb\u3061\u4e0a\u3052\u3066\u8272\u3005\u8a2d\u5b9a\u3057\u3066 AMI \u3092\u4f5c\u6210\u3057\u3066 LaunchConfig \u66f4\u65b0\u3057\u3066\u3001\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3082\u7acb\u3061\u4e0a\u304c\u3063\u3066\u7121\u4e8b\u5165\u308c\u66ff\u3048\u5b8c\u4e86\u308f\u30fc\u3088\u304b\u3063\u305f\u3088\u304b\u3063\u305f\n\u3068\u601d\u3063\u305f10\u5206\u5f8c\u3001\u5927\u91cf\u306e INSUFFICIENT_DATA \u30a2\u30e9\u30fc\u30c8\u304c\u304c\u304c\u304c\u3002\n\n\u203b\u753b\u50cf\u306f\u30a4\u30e1\u30fc\u30b8\u3067\u3059\n\u30a2\u30e9\u30fc\u30e0\u5143\u3092\u3088\u304f\u898b\u3066\u307f\u308b\u3068\u5168\u90e8 AutoScaling \u306e\u30a2\u30e9\u30fc\u30c8\u3002\u3088\u3082\u3084\u66f4\u65b0\u3057\u305f\u6642\u306b cron \u8a2d\u5b9a\u6d88\u3048\u308b\u3068\u304b\u305d\u3093\u306a\u99ac\u9e7f\u306a\u3053\u3068\u304c\u3068 cron \u306e\u30ed\u30b0\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3082\u52d5\u3044\u3066\u3044\u308b\u30fb\u30fb\u30fb\u3002\n\u3053\u3093\u306a\u6642\u306f\u624b\u52d5\u3067\u8d70\u3089\u305b\u3066\u307f\u308b\u306b\u9650\u308b\u3068\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\n# /usr/local/aws-scripts-mon/mon-put-instance-data.pl --mem-util --disk-space-util --disk-path=/ --auto-scaling=only\n\nThe Auto Scaling metrics will not be reported this time.\n\n\n\u3042\u308c\uff1f\u4f55\u6545\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u3002\n\u8a66\u3057\u306b --auto-scaling=only \u5916\u3057\u3066 ASG \u304b\u3089\u5916\u3057\u3066\u307f\u308b\u3068\u9001\u4fe1\u3055\u308c\u308b\u3002\nIAM \u5909\u308f\u3063\u3066\u306a\u3044\u304b\u3089\u6a29\u9650\u3082\u554f\u984c\u306a\u3044\u306f\u305a\uff08\u9001\u4fe1\u3067\u304d\u3066\u308b\u3057\uff09\u3002\n--verbose \u30aa\u30d7\u30b7\u30e7\u30f3\u3064\u3051\u3066\u307f\u3066\u3082 HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30b3\u30fc\u30c9\u306f 200 \u3067\u4f55\u306e\u554f\u984c\u3082\u306a\u3044\u3002\n\u3057\u304b\u3057\u306a\u305c\u304b AutoScalingGroup \u3068\u3057\u3066\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u53d6\u308c\u306a\u3044\u3002\n\u539f\u56e0\u304c\u5168\u304f\u601d\u3044\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u3086\u3068\u308a\u3089\u3057\u304f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u305d\u306e\u307e\u307e\u3067 Google \u5148\u751f\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u3057\u305f\u3068\u3053\u308d\u3044\u304d\u306a\u308a\u30b8\u30e3\u30b9\u30c8\u306a\u30c8\u30d4\u30c3\u30af\u304c\u3002\nIAM \u306f\u3061\u3083\u3093\u3068\u3057\u3066\u308b\u3093\u3060\u3088\u30fc --verbose \u3064\u3051\u3066\u3082\u308f\u304b\u3089\u306a\u3044\u3093\u3060\u3088\u30fc\u3068\u601d\u3044\u306a\u304c\u3089\u4e0b\u307e\u3067\u898b\u306b\u884c\u3063\u3066\u307f\u305f\u3089\n\nI came across this same issue. For me the reason was that my AMI was created from an instance that also ran this monitoring script previously. \nWhen the monitoring script runs it caches the instance_id under /var/tmp/aws-mon. One of the filters it uses when getting the auto scaling group name is the instance id. The TTL on this is 6 hours, so if your AMI has this cache, the query will use the wrong instance id for up to 6 hours after the instance is created which results in it failing to retrieve the auto scaling group name.\nHope that helps! Make sure your AMI doesn't have this cache in it.\n-Avi\n\nAMI \u4f5c\u308b\u524d\u306b\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30b9\u30af\u30ea\u30d7\u30c8\u8d70\u3089\u305b\u3066\u308b\u3068 /var/tmp/aws-mon \u306b\u53e4\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3061\u3083\u3093\u3068\u52d5\u304b\u306a\u304f\u306a\u308b\u3088\u3002\u3053\u308c 6 \u6642\u9593\u751f\u304d\u3066\u308b\u304b\u3089\u6c17\u3092\u3064\u3051\u3066\u306d\uff08\u7b11\uff09\uff08\u3086\u3068\u308a\u610f\u8a33\uff09\n\u3068\u306e\u3053\u3068\u3002\n/var/tmp/aws-mon/instance-id \u898b\u3066\u307f\u305f\u3089\u307e\u3055\u306b AMI \u66f4\u65b0\u306e\u305f\u3081\u306b\u4f7f\u3063\u3066\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u304c\u8a18\u8f09\u3055\u308c\u3066\u307e\u3057\u305f\u3002\n\u4e00\u5fdc\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u3063\u3066\u73fe\u884c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u306b\u66f8\u304d\u63db\u3048\u3066\u5b9f\u884c\u3057\u305f\u3068\u3053\u308d\n$ /usr/local/aws-scripts-mon/mon-put-instance-data.pl --mem-util --disk-space-util --disk-path=/ --auto-scaling=only\n\nSuccessfully reported metrics to CloudWatch. Reference Id: hogehoge\n\n\u3084\u3063\u305f\u30fc\uff01\n# \u6982\u8981\n\n* mon-put-instance-data.pl \u304c\u6025\u306b `The Auto Scaling metrics will not be reported this time.` \u3068\u304b\u8a00\u3044\u51fa\u3057\u305f\n* AMI \u4f5c\u308a\u5909\u3048\u305f\u3068\u304d\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u304c\u539f\u56e0\u3067 `/var/tmp/aws-mon` \u306b[\u53e4\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u304c\u6b8b\u3063\u3066\u305f](https://forums.aws.amazon.com/message.jspa?messageID=473077)\n* `/var/tmp/aws-mon/instance-id` \u66f8\u304d\u63db\u3048\u305f\u3089\u76f4\u3063\u305f\n\n# \u80cc\u666f\n\n\u8907\u6570\u53f0\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092 AutoScaling \u3067\u4e0a\u3052\u305f\u308a\u4e0b\u3052\u305f\u308a\u3059\u308b\u3068\u304d\u3001\u30e1\u30e2\u30ea\u4f7f\u7528\u7387\u306e\u5168\u53f0\u6570\u5e73\u5747\u3068\u304b\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u3068\u304b\u3092 AutoScalingGroup \u5358\u4f4d\u3067\u307e\u3068\u3081\u305f\u3044\u3063\u3066\u601d\u3044\u307e\u3059\u3088\u306d\uff1f\n\u305d\u3093\u306a\u3068\u304d\u3069\u3046\u3059\u308b\u304b\u3063\u3066\u8a00\u3063\u305f\u3089\u3084\u3063\u3071\u308a[Amazon CloudWatch Monitoring Scripts for Linux](http://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/DeveloperGuide/mon-scripts.html)\u3067\u3059\u3088\u306d\u3002\n~~Windows? \u77e5\u3089\u3093~~\n\n# \u4e8b\u8c61\n\n\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u69cb\u6210\u306b\u5909\u66f4\u304c\u3042\u3063\u305f\u304b\u3089 AutoScaling \u7528\u306e AMI \u66f4\u65b0\u3057\u306a\u304d\u3083\u306a\u30fc\u3001\u3068\u3044\u3064\u3082\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u7acb\u3061\u4e0a\u3052\u3066\u8272\u3005\u8a2d\u5b9a\u3057\u3066 AMI \u3092\u4f5c\u6210\u3057\u3066 LaunchConfig \u66f4\u65b0\u3057\u3066\u3001\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3082\u7acb\u3061\u4e0a\u304c\u3063\u3066\u7121\u4e8b\u5165\u308c\u66ff\u3048\u5b8c\u4e86\u308f\u30fc\u3088\u304b\u3063\u305f\u3088\u304b\u3063\u305f\n\n\u3068\u601d\u3063\u305f10\u5206\u5f8c\u3001\u5927\u91cf\u306e INSUFFICIENT_DATA \u30a2\u30e9\u30fc\u30c8\u304c\u304c\u304c\u304c\u3002\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-01-29 19.15.24.png](https://qiita-image-store.s3.amazonaws.com/0/88428/d641144e-797c-41dd-e616-e0d3a15960f0.png)\n\u203b\u753b\u50cf\u306f\u30a4\u30e1\u30fc\u30b8\u3067\u3059\n\n\u30a2\u30e9\u30fc\u30e0\u5143\u3092\u3088\u304f\u898b\u3066\u307f\u308b\u3068\u5168\u90e8 AutoScaling \u306e\u30a2\u30e9\u30fc\u30c8\u3002\u3088\u3082\u3084\u66f4\u65b0\u3057\u305f\u6642\u306b cron \u8a2d\u5b9a\u6d88\u3048\u308b\u3068\u304b\u305d\u3093\u306a\u99ac\u9e7f\u306a\u3053\u3068\u304c\u3068 cron \u306e\u30ed\u30b0\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3082\u52d5\u3044\u3066\u3044\u308b\u30fb\u30fb\u30fb\u3002\n\n\u3053\u3093\u306a\u6642\u306f\u624b\u52d5\u3067\u8d70\u3089\u305b\u3066\u307f\u308b\u306b\u9650\u308b\u3068\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\n\n```\n# /usr/local/aws-scripts-mon/mon-put-instance-data.pl --mem-util --disk-space-util --disk-path=/ --auto-scaling=only\n\nThe Auto Scaling metrics will not be reported this time.\n\n```\n\n\u3042\u308c\uff1f\u4f55\u6545\u304b\u53d6\u308c\u3066\u3044\u306a\u3044\u3002\n\n\u8a66\u3057\u306b `--auto-scaling=only` \u5916\u3057\u3066 ASG \u304b\u3089\u5916\u3057\u3066\u307f\u308b\u3068\u9001\u4fe1\u3055\u308c\u308b\u3002\nIAM \u5909\u308f\u3063\u3066\u306a\u3044\u304b\u3089\u6a29\u9650\u3082\u554f\u984c\u306a\u3044\u306f\u305a\uff08\u9001\u4fe1\u3067\u304d\u3066\u308b\u3057\uff09\u3002\n`--verbose` \u30aa\u30d7\u30b7\u30e7\u30f3\u3064\u3051\u3066\u307f\u3066\u3082 HTTP \u30ec\u30b9\u30dd\u30f3\u30b9\u30b3\u30fc\u30c9\u306f 200 \u3067\u4f55\u306e\u554f\u984c\u3082\u306a\u3044\u3002\n\u3057\u304b\u3057\u306a\u305c\u304b AutoScalingGroup \u3068\u3057\u3066\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u53d6\u308c\u306a\u3044\u3002\n\n\u539f\u56e0\u304c\u5168\u304f\u601d\u3044\u5f53\u305f\u3089\u306a\u3044\u306e\u3067\u3086\u3068\u308a\u3089\u3057\u304f\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u305d\u306e\u307e\u307e\u3067 Google \u5148\u751f\u306b\u304a\u554f\u3044\u5408\u308f\u305b\u3057\u305f\u3068\u3053\u308d\u3044\u304d\u306a\u308a[\u30b8\u30e3\u30b9\u30c8\u306a\u30c8\u30d4\u30c3\u30af\u304c\u3002](https://forums.aws.amazon.com/message.jspa?messageID=473077)\n\nIAM \u306f\u3061\u3083\u3093\u3068\u3057\u3066\u308b\u3093\u3060\u3088\u30fc `--verbose` \u3064\u3051\u3066\u3082\u308f\u304b\u3089\u306a\u3044\u3093\u3060\u3088\u30fc\u3068\u601d\u3044\u306a\u304c\u3089\u4e0b\u307e\u3067\u898b\u306b\u884c\u3063\u3066\u307f\u305f\u3089\n\n> I came across this same issue. For me the reason was that my AMI was created from an instance that also ran this monitoring script previously. \n\n> When the monitoring script runs it caches the instance_id under /var/tmp/aws-mon. One of the filters it uses when getting the auto scaling group name is the instance id. The TTL on this is 6 hours, so if your AMI has this cache, the query will use the wrong instance id for up to 6 hours after the instance is created which results in it failing to retrieve the auto scaling group name.\n\n> Hope that helps! Make sure your AMI doesn't have this cache in it.\n\n> -Avi\n\n**AMI \u4f5c\u308b\u524d\u306b\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30b9\u30af\u30ea\u30d7\u30c8\u8d70\u3089\u305b\u3066\u308b\u3068 `/var/tmp/aws-mon` \u306b\u53e4\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3061\u3083\u3093\u3068\u52d5\u304b\u306a\u304f\u306a\u308b\u3088\u3002\u3053\u308c 6 \u6642\u9593\u751f\u304d\u3066\u308b\u304b\u3089\u6c17\u3092\u3064\u3051\u3066\u306d\uff08\u7b11\uff09**~~\uff08\u3086\u3068\u308a\u610f\u8a33\uff09~~\n\n\u3068\u306e\u3053\u3068\u3002\n`/var/tmp/aws-mon/instance-id` \u898b\u3066\u307f\u305f\u3089\u307e\u3055\u306b AMI \u66f4\u65b0\u306e\u305f\u3081\u306b\u4f7f\u3063\u3066\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u304c\u8a18\u8f09\u3055\u308c\u3066\u307e\u3057\u305f\u3002\n\u4e00\u5fdc\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3068\u3063\u3066\u73fe\u884c\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 ID \u306b\u66f8\u304d\u63db\u3048\u3066\u5b9f\u884c\u3057\u305f\u3068\u3053\u308d\n\n```\n$ /usr/local/aws-scripts-mon/mon-put-instance-data.pl --mem-util --disk-space-util --disk-path=/ --auto-scaling=only\n\nSuccessfully reported metrics to CloudWatch. Reference Id: hogehoge\n```\n\n\u3084\u3063\u305f\u30fc\uff01\n", "tags": ["AWS", "AutoScaling", "CloudWatch"]}