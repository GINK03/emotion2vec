{"context": " More than 1 year has passed since last update.IAM\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u304c\u3082\u3084\u3063\u3068\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u6cbf\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u30b7\u30ca\u30ea\u30aa\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eAmazon S3\u30d0\u30b1\u30c3\u30c8\u306bAWS\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3001\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u3067\u3059\u3002IAM\u30ed\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u3068\u30ea\u30bd\u30fc\u30b9\u30d9\u30fc\u30b9\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u3092\u305d\u308c\u305e\u308c\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\nIAM\u30ed\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\n\n\u6e96\u5099\n\n\u30c6\u30b9\u30c8\u7528\u306b2\u3064\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n\n\u30c6\u30b9\u30c8\u7528\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\u5185\u306b\u30d0\u30b1\u30c3\u30c8(samplexxxx)\u3092\u4f5c\u6210\n\n\u30c6\u30b9\u30c8\u7528\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3068IAM\u30b0\u30eb\u30fc\u30d7\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B\u5185\u306bIAM\u30e6\u30fc\u30b6\u30fc(User01),\u30b0\u30eb\u30fc\u30d7(Developers)\u3092\u4f5c\u6210\n\u30fbIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306f\u6307\u5b9a\u306a\u3057\n\u30fb\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3092\u6307\u5b9a\n\n\n\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u30a2\u30ab\u30a6\u30f3\u30c8A\u3067\u3001\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\nRole Name : UpdateApp\nSelect Role Type : Role for Cross-Account Access-Provide access between AWS \u3000\u3000\naccount ID : \u30a2\u30ab\u30a6\u30f3\u30c8B\u306eID\nCustom Policy : \u4ee5\u4e0b\u3092\u6307\u5b9a\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:ListBucket\",\n      \"Resource\": \"arn:aws:s3:::samplexxxx\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:GetObject\",\n        \"s3:PutObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::samplexxxx/*\"\n    }\n  ]\n}\n\n\nIAM\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eDevelopers\u30b0\u30eb\u30fc\u30d7\u3078\u3001\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eUpdateAPP\u30ed\u30fc\u30eb\u304c\u53d6\u5f97(AssumeRole)\u3067\u304d\u308b\u3088\u3046\u4ee5\u4e0b\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": {\n    \"Effect\": \"Allow\",\n    \"Action\": \"sts:AssumeRole\",\n    \"Resource\": \"arn:aws:iam::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:role/UpdateAPP\"\n  }\n}\n\n\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAmazon CLI\u3092\u4f7f\u7528\u3057\u3066\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u3066\u307f\u308b\n$ export AWS_ACCESS_KEY_ID=User1\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\n$ export AWS_SECRET_ACCESS_KEY=User1\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n$ aws sts assume-role --role-arn arn:aws:iam::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:role/UpdateApp --role-session-name session1(\u2190\u4efb\u610f)\n{\n    \"AssumedRoleUser\": {\n        \"AssumedRoleId\": \"xxxxxxxxxxxx:session1\",\n        \"Arn\": \"arn:aws:sts::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:assumed-role/UpdateApp/session1\"\n    },\n    \"Credentials\": {\n        \"SecretAccessKey\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n        \"SessionToken\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n        \"Expiration\": \"2015-01-12T10:10:31Z\",\n        \"AccessKeyId\": \"xxxxxxxxxxxxxxxxx\"\n    }\n}\n\u2191assume-role\u3067\u4e00\u6642\u7684\u306a\u30a2\u30af\u30bb\u30b9\u60c5\u5831\u304c\u53d6\u5f97\u3055\u308c\u308b(AccessKeyId,SecretAccessKey,SessionToken)\n$ export AWS_ACCESS_KEY_ID=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fAccessKeyId\u3092\u6307\u5b9a\n$ export AWS_SECRET_ACCESS_KEY=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fSecretAccessKey\u3092\u6307\u5b9a\n$ export AWS_SECURITY_TOKEN=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fSessionToken\u3092\u6307\u5b9a\n$ aws s3 ls s3://samplexxxx\n2015-01-12 09:04:39     142164 event.jpg\n\u2191\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3044\u308b\n\n\nSwitch Role\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAWS management console\u304b\u3089Switch Role\u6a5f\u80fd\u306b\u3088\u308a\u5225\u30a2\u30ab\u30a6\u30f3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3082\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n1.\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001[User01@accountID]-[Switch Role]\u3092\u9078\u629e\n2.\u30a2\u30ab\u30a6\u30f3\u30c8A\u306e\u30a2\u30ab\u30a6\u30f3\u30c8ID\u304a\u3088\u3073Role\u540d(UpdateApp)\u3068Display Name(\u4efb\u610f)\u3092\u5165\u529b\n\n3.\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ed\u30fc\u30eb\u306e\u5207\u308a\u304b\u3048\n\n\u30ed\u30fc\u30eb\u3092\u5207\u308a\u304b\u3048\u305f\u5834\u5408\u3001\u3053\u306e\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u306f\u30ed\u30fc\u30eb\u3067\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u64cd\u4f5c\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\u4eca\u56de\u306f\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u306e\u307f\u64cd\u4f5c\u3067\u304d\u308b\u3068\u3044\u3046\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u76f8\u5f53\u4fbf\u5229\u306a\u306e\u3067\u306f\u3002\n\n\u30ea\u30bd\u30fc\u30b9\u30d9\u30fc\u30b9\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\n\n\u6e96\u5099\n\n\u30c6\u30b9\u30c8\u7528\u306b2\u3064\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n\n\u30c6\u30b9\u30c8\u7528\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\u5185\u306b\u30d0\u30b1\u30c3\u30c8(samplexxxx2)\u3092\u4f5c\u6210\n\n\u30c6\u30b9\u30c8\u7528\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3068IAM\u30b0\u30eb\u30fc\u30d7\u3092\u6e96\u5099\n\u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B\u5185\u306bIAM\u30e6\u30fc\u30b6\u30fc(User02),\u30b0\u30eb\u30fc\u30d7(Testers)\u3092\u4f5c\u6210\n\u30fbIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306f\u6307\u5b9a\u306a\u3057\n\u30fb\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3092\u6307\u5b9a\n\n\n\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\n\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u3078\u4ee5\u4e0b\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc(samplexxxx2\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u30a2\u30ab\u30a6\u30f3\u30c8B\u306b\u4ed8\u4e0e)\u3092\u8a2d\u5b9a\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": {\n    \"Sid\": \"AccountBAccess1\",\n    \"Effect\": \"Allow\",\n    \"Principal\": {\"AWS\": \"\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eID\"},\n    \"Action\": \"s3:*\",\n    \"Resource\": [\n      \"arn:aws:s3:::samplexxxx2\",\n      \"arn:aws:s3:::samplexxxx2/*\"\n    ]\n  }\n}\n\n\nIAM\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30b0\u30eb\u30fc\u30d7\u3078\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u5185\u3092List*\u3067\u304d\u308b\u3088\u3046\u4ee5\u4e0b\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"s3:List*\",\n            \"Resource\": [\n                \"arn:aws:s3:::samplexxxx2\",\n                \"arn:aws:s3:::samplexxxx2/\"\n            ]\n        },\n        {\n            \"Effect\": \"Deny\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\",\n                \"s3:DeleteObject\"\n            ],\n            \"Resource\": \"arn:aws:s3:::samplexxxx2/\"\n        }\n    ]\n}\n\u2191\u3053\u3053\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308bsamplexxxx2\u306f\u30a2\u30ab\u30a6\u30f3\u30c8A\u306e\u30d0\u30b1\u30c3\u30c8\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306b\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u306e\u306fS3\u306b\u5bfe\u3059\u308b\u5168\u64cd\u4f5c\u6a29\u9650\u3060\u304c\u3001\u30b0\u30eb\u30fc\u30d7\u306e\u6a29\u9650\u3068\u3057\u3066\u306fList*\u306e\u307f\u306b\u5236\u9650\n\n\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser02\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAmazon CLI\u3092\u4f7f\u7528\u3057\u3066\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u3066\u307f\u308b\n$ export AWS_ACCESS_KEY_ID=User02\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\n$ export AWS_SECRET_ACCESS_KEY=User02\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n$ aws s3 ls s3://samplexxxx2/\n2015-01-12 10:20:18     142164 event2.jpg\n\u2191\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3044\u308b\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u3046\u3080\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3069\u304a\u308a\u306a\u306e\u3067\u5f53\u7136\u306a\u306e\u3067\u3059\u304c\u3001IAM\u304c\u601d\u3044\u3069\u304a\u308a\u52d5\u304f\u3068\u5b09\u3057\u3044\u304b\u304e\u308a\u3002\u305d\u3057\u3066CLI\u4fbf\u5229\u3067\u3059\u306d\u3002\nIAM\u306e\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\u304c\u3082\u3084\u3063\u3068\u3057\u3066\u3044\u305f\u306e\u3067\u3001[\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/delegation-cross-acct-access.html)\u306b\u6cbf\u3063\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n##\u30b7\u30ca\u30ea\u30aa\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eAmazon S3\u30d0\u30b1\u30c3\u30c8\u306bAWS\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u308b\u3001\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u3067\u3059\u3002**IAM\u30ed\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9**\u3068**\u30ea\u30bd\u30fc\u30b9\u30d9\u30fc\u30b9\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9**\u3092\u305d\u308c\u305e\u308c\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n##IAM\u30ed\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\n\n###\u6e96\u5099\n* \u30c6\u30b9\u30c8\u7528\u306b2\u3064\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n<br>\n\n* \u30c6\u30b9\u30c8\u7528\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\u5185\u306b\u30d0\u30b1\u30c3\u30c8(samplexxxx)\u3092\u4f5c\u6210\n<br>\n\n* \u30c6\u30b9\u30c8\u7528\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3068IAM\u30b0\u30eb\u30fc\u30d7\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B\u5185\u306bIAM\u30e6\u30fc\u30b6\u30fc(User01),\u30b0\u30eb\u30fc\u30d7(Developers)\u3092\u4f5c\u6210\n \u30fbIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306f\u6307\u5b9a\u306a\u3057\n \u30fb\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3092\u6307\u5b9a\n\n###\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u30a2\u30ab\u30a6\u30f3\u30c8A\u3067\u3001\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u306a\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\nRole Name : UpdateApp\nSelect Role Type : Role for Cross-Account Access-Provide access between AWS \u3000\u3000\naccount ID : \u30a2\u30ab\u30a6\u30f3\u30c8B\u306eID\nCustom Policy : \u4ee5\u4e0b\u3092\u6307\u5b9a\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": \"s3:ListBucket\",\n      \"Resource\": \"arn:aws:s3:::samplexxxx\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"s3:GetObject\",\n        \"s3:PutObject\",\n        \"s3:DeleteObject\"\n      ],\n      \"Resource\": \"arn:aws:s3:::samplexxxx/*\"\n    }\n  ]\n}\n</pre></div></div>\n\n###IAM\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eDevelopers\u30b0\u30eb\u30fc\u30d7\u3078\u3001\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eUpdateAPP\u30ed\u30fc\u30eb\u304c\u53d6\u5f97(AssumeRole)\u3067\u304d\u308b\u3088\u3046\u4ee5\u4e0b\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": {\n    \"Effect\": \"Allow\",\n    \"Action\": \"sts:AssumeRole\",\n    \"Resource\": \"arn:aws:iam::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:role/UpdateAPP\"\n  }\n}\n</pre></div></div>\n\n###\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAmazon CLI\u3092\u4f7f\u7528\u3057\u3066\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u3066\u307f\u308b\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n$ export AWS_ACCESS_KEY_ID=User1\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\n$ export AWS_SECRET_ACCESS_KEY=User1\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n$ aws sts assume-role --role-arn arn:aws:iam::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:role/UpdateApp --role-session-name session1(\u2190\u4efb\u610f)\n{\n    \"AssumedRoleUser\": {\n        \"AssumedRoleId\": \"xxxxxxxxxxxx:session1\",\n        \"Arn\": \"arn:aws:sts::\u30a2\u30ab\u30a6\u30f3\u30c8A\u306eID:assumed-role/UpdateApp/session1\"\n    },\n    \"Credentials\": {\n        \"SecretAccessKey\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n        \"SessionToken\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n        \"Expiration\": \"2015-01-12T10:10:31Z\",\n        \"AccessKeyId\": \"xxxxxxxxxxxxxxxxx\"\n    }\n}\n\u2191assume-role\u3067\u4e00\u6642\u7684\u306a\u30a2\u30af\u30bb\u30b9\u60c5\u5831\u304c\u53d6\u5f97\u3055\u308c\u308b(AccessKeyId,SecretAccessKey,SessionToken)\n$ export AWS_ACCESS_KEY_ID=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fAccessKeyId\u3092\u6307\u5b9a\n$ export AWS_SECRET_ACCESS_KEY=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fSecretAccessKey\u3092\u6307\u5b9a\n$ export AWS_SECURITY_TOKEN=assume-role\u3067\u53d6\u5f97\u3055\u308c\u305fSessionToken\u3092\u6307\u5b9a\n$ aws s3 ls s3://samplexxxx\n2015-01-12 09:04:39     142164 event.jpg\n\u2191\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3044\u308b\n</pre></div></div>\n\n###Switch Role\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAWS management console\u304b\u3089Switch Role\u6a5f\u80fd\u306b\u3088\u308a\u5225\u30a2\u30ab\u30a6\u30f3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u3068\u3044\u3046\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3061\u3089\u3082\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n1.\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser01\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001[User01@accountID]-[Switch Role]\u3092\u9078\u629e\n2.\u30a2\u30ab\u30a6\u30f3\u30c8A\u306e\u30a2\u30ab\u30a6\u30f3\u30c8ID\u304a\u3088\u3073Role\u540d(UpdateApp)\u3068Display Name(\u4efb\u610f)\u3092\u5165\u529b\n![switchrole.jpg](https://qiita-image-store.s3.amazonaws.com/0/60916/1e920aee-e07c-2585-8cfb-122298fa7b9b.jpeg)\n\n3.\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u30ed\u30fc\u30eb\u306e\u5207\u308a\u304b\u3048\n![switchrole2.jpg](https://qiita-image-store.s3.amazonaws.com/0/60916/98eeeaab-c376-e6cb-56de-5148741c0080.jpeg)\n\n\n\u30ed\u30fc\u30eb\u3092\u5207\u308a\u304b\u3048\u305f\u5834\u5408\u3001\u3053\u306e\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u306f\u30ed\u30fc\u30eb\u3067\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u64cd\u4f5c\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\u4eca\u56de\u306f\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u306e\u307f\u64cd\u4f5c\u3067\u304d\u308b\u3068\u3044\u3046\u72b6\u614b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u6a5f\u80fd\u76f8\u5f53\u4fbf\u5229\u306a\u306e\u3067\u306f\u3002\n\n##\u30ea\u30bd\u30fc\u30b9\u30d9\u30fc\u30b9\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u4f7f\u7528\u3057\u305f\u30af\u30ed\u30b9\u30a2\u30ab\u30a6\u30f3\u30c8\u30a2\u30af\u30bb\u30b9\n\n###\u6e96\u5099\n* \u30c6\u30b9\u30c8\u7528\u306b2\u3064\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B(\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3092\u63a7\u3048\u3066\u304a\u304f)\n<br>\n\n* \u30c6\u30b9\u30c8\u7528\u306b\u30d0\u30b1\u30c3\u30c8\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8A\u5185\u306b\u30d0\u30b1\u30c3\u30c8(samplexxxx2)\u3092\u4f5c\u6210\n<br>\n\n* \u30c6\u30b9\u30c8\u7528\u306bIAM\u30e6\u30fc\u30b6\u30fc\u3068IAM\u30b0\u30eb\u30fc\u30d7\u3092\u6e96\u5099\n \u30fb\u30a2\u30ab\u30a6\u30f3\u30c8B\u5185\u306bIAM\u30e6\u30fc\u30b6\u30fc(User02),\u30b0\u30eb\u30fc\u30d7(Testers)\u3092\u4f5c\u6210\n \u30fbIAM\u30e6\u30fc\u30b6\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306f\u6307\u5b9a\u306a\u3057\n \u30fb\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u306fPowerUserAccess\u3092\u6307\u5b9a\n\n###\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc\u3092\u8a2d\u5b9a\n\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u3078\u4ee5\u4e0b\u30d0\u30b1\u30c3\u30c8\u30dd\u30ea\u30b7\u30fc(samplexxxx2\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6a29\u9650\u3092\u30a2\u30ab\u30a6\u30f3\u30c8B\u306b\u4ed8\u4e0e)\u3092\u8a2d\u5b9a\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": {\n    \"Sid\": \"AccountBAccess1\",\n    \"Effect\": \"Allow\",\n    \"Principal\": {\"AWS\": \"\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eID\"},\n    \"Action\": \"s3:\\*\",\n    \"Resource\": [\n      \"arn:aws:s3:::samplexxxx2\",\n      \"arn:aws:s3:::samplexxxx2/*\"\n    ]\n  }\n}\n</pre></div></div>\n\n###IAM\u30b0\u30eb\u30fc\u30d7\u306e\u30a2\u30af\u30bb\u30b9\u30dd\u30ea\u30b7\u30fc\u3092\u5909\u66f4\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30b0\u30eb\u30fc\u30d7\u3078\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u5185\u3092List\\*\u3067\u304d\u308b\u3088\u3046\u4ee5\u4e0b\u306e\u30dd\u30ea\u30b7\u30fc\u3092\u8ffd\u52a0\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"s3:List*\",\n            \"Resource\": [\n                \"arn:aws:s3:::samplexxxx2\",\n                \"arn:aws:s3:::samplexxxx2/*\"\n            ]\n        },\n        {\n            \"Effect\": \"Deny\",\n            \"Action\": [\n                \"s3:GetObject\",\n                \"s3:PutObject\",\n                \"s3:DeleteObject\"\n            ],\n            \"Resource\": \"arn:aws:s3:::samplexxxx2/*\"\n        }\n    ]\n}\n\u2191\u3053\u3053\u3067\u6307\u5b9a\u3055\u308c\u3066\u3044\u308bsamplexxxx2\u306f\u30a2\u30ab\u30a6\u30f3\u30c8A\u306e\u30d0\u30b1\u30c3\u30c8\n\u30a2\u30ab\u30a6\u30f3\u30c8B\u306b\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u306e\u306fS3\u306b\u5bfe\u3059\u308b\u5168\u64cd\u4f5c\u6a29\u9650\u3060\u304c\u3001\u30b0\u30eb\u30fc\u30d7\u306e\u6a29\u9650\u3068\u3057\u3066\u306fList*\u306e\u307f\u306b\u5236\u9650\n</pre></div></div>\n\n###\u30a2\u30ab\u30a6\u30f3\u30c8B\u306eIAM\u30e6\u30fc\u30b6\u30fcUser02\u304b\u3089\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx2\u30d0\u30b1\u30c3\u30c8\u3078\u30a2\u30af\u30bb\u30b9\nAmazon CLI\u3092\u4f7f\u7528\u3057\u3066\u3055\u304f\u3063\u3068\u78ba\u8a8d\u3057\u3066\u307f\u308b\n<div class=\"code-frame\" data-lang=\"text\"><div class=\"highlight\"><pre>\n$ export AWS_ACCESS_KEY_ID=User02\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fcID\n$ export AWS_SECRET_ACCESS_KEY=User02\u306e\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n$ aws s3 ls s3://samplexxxx2/\n2015-01-12 10:20:18     142164 event2.jpg\n\u2191\u30a2\u30ab\u30a6\u30f3\u30c8A\u306esamplexxxx\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3066\u3044\u308b\n</pre></div></div>\n\n\u4ee5\u4e0a\u3067\u3059\u3002\n\u3046\u3080\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3069\u304a\u308a\u306a\u306e\u3067\u5f53\u7136\u306a\u306e\u3067\u3059\u304c\u3001IAM\u304c\u601d\u3044\u3069\u304a\u308a\u52d5\u304f\u3068\u5b09\u3057\u3044\u304b\u304e\u308a\u3002\u305d\u3057\u3066CLI\u4fbf\u5229\u3067\u3059\u306d\u3002\n", "tags": ["AWS", "IAM"]}