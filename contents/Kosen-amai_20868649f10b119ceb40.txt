{"tags": ["WPF", "C#", "async", "\u975e\u540c\u671f\u51e6\u7406", "GUI"], "context": "\n\n \u6982\u8981\n\u753b\u9762\u3067\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u3092\u975e\u540c\u671f\u3067\u5b9f\u884c\u3001\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n\n \u753b\u9762\u30a4\u30e1\u30fc\u30b8\n\u300c\u958b\u59cb\u300d\u30dc\u30bf\u30f3\u3067\u300c\u63a2\u7d22\u30d1\u30b9\u300d\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3002\n\u5de6\u53f3\u306e\u9055\u3044\u306f\u30ad\u30e3\u30f3\u30bb\u30eb\u51e6\u7406\u306e\u5b9f\u88c5\u3002\n\u5de6\u5074\u306f\u30d5\u30e9\u30b0\u3001\u53f3\u5074\u306f\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3002\n\n\n \u30b3\u30fc\u30c9\n\nMainWindow.xaml\n<Window x:Class=\"WpfAsyncAwaitCancelSample.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WpfAsyncAwaitCancelSample\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\" MinWidth=\"500\" ResizeMode=\"CanResizeWithGrip\">\n    <Grid>\n        <Grid.RowDefinitions>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"*\"/>\n        </Grid.RowDefinitions>\n        <Grid.ColumnDefinitions>\n            <ColumnDefinition/>\n            <ColumnDefinition/>\n        </Grid.ColumnDefinitions>\n\n        <StackPanel Grid.ColumnSpan=\"2\" Orientation=\"Horizontal\">\n            <Label Content=\"\u63a2\u7d22\u30d1\u30b9\"/>\n            <TextBox x:Name=\"searchPath\" Text=\"C:\\Work\" Width=\"400\" VerticalAlignment=\"Center\"/>\n        </StackPanel>\n\n        <!--#region \u5de6\u5074-->\n\n        <!-- \u30dc\u30bf\u30f3 -->\n        <StackPanel Grid.Row=\"1\" Orientation=\"Horizontal\">\n            <Button x:Name=\"startButtonL\" Content=\"\u958b\u59cb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"startButtonL_Click\"/>\n            <Button x:Name=\"cancelButtonL\" Content=\"\u30ad\u30e3\u30f3\u30bb\u30eb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"cancelButtonL_Click\" />\n        </StackPanel>\n\n        <!-- \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a -->\n        <TextBlock Grid.Row=\"2\" x:Name=\"statusLabelL\" Text=\"-\" Margin=\"5\"/>\n\n        <!-- \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7 -->\n        <ListBox Grid.Row=\"3\" x:Name=\"fileListL\"/>\n\n        <!--#endregion -->\n\n        <!--#region \u53f3\u5074-->\n\n        <!-- \u30dc\u30bf\u30f3 -->\n        <StackPanel Grid.Row=\"1\" Grid.Column=\"1\" Orientation=\"Horizontal\">\n            <Button x:Name=\"startButtonR\" Content=\"\u958b\u59cb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"startButtonR_Click\"/>\n            <Button x:Name=\"cancelButtonR\" Content=\"\u30ad\u30e3\u30f3\u30bb\u30eb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"cancelButtonR_Click\" />\n        </StackPanel>\n\n        <!-- \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a -->\n        <StackPanel Grid.Row=\"2\" Grid.Column=\"1\">\n            <TextBlock x:Name=\"statusLabelR1\" Text=\"-\" Margin=\"5,5,5,0\"/>\n            <TextBlock x:Name=\"statusLabelR2\" Text=\"-\" Margin=\"5\"/>\n        </StackPanel>\n\n        <!-- \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7 -->\n        <ListBox Grid.Row=\"3\" Grid.Column=\"1\" x:Name=\"fileListR\"/>\n\n        <!--#endregion-->\n    </Grid>\n</Window>\n\n\n\nMainWindow.xaml.cs\nusing System.IO;\nusing System.Threading.Tasks;\nusing System.Windows;\n\nnamespace WpfAsyncAwaitCancelSample\n{\n    /// <summary>\n    /// MainWindow.xaml \u306e\u76f8\u4e92\u4f5c\u7528\u30ed\u30b8\u30c3\u30af\n    /// </summary>\n    public partial class MainWindow : Window\n    {\n        /// <summary>\n        /// \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n        /// </summary>\n        public MainWindow()\n        {\n            InitializeComponent();\n        }\n\n        #region \u5de6\u5074\u306e\u51e6\u7406\uff08\u30ad\u30e3\u30f3\u30bb\u30eb\u62bc\u3057\u3066\u304b\u3089\u7d42\u4e86\u3059\u308b\u307e\u3067\u306b\u30bf\u30a4\u30e0\u30e9\u30b0\u3042\u308a\uff09\n\n        /// <summary>\n        /// \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\n        /// </summary>\n        private bool isCanceled = false;\n\n        /// <summary>\n        /// \u5de6\u306e\u958b\u59cb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private async void startButtonL_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30dc\u30bf\u30f3\u7121\u52b9\u5316\n            startButtonL.IsEnabled = false;\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\u521d\u671f\u5316\n            isCanceled = false;\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelL.Text = \"\u51e6\u7406\u4e2d...\";\n\n            // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30a2\n            fileListL.Items.Clear();\n\n            // \u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u547c\u3073\u51fa\u3057\n            bool complete = await TimeConsumingProcessLAsync();\n\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelL.Text = complete ? \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" : \"\u51e6\u7406\u3092\u4e2d\u65ad\u3057\u307e\u3057\u305f\u3002\";\n\n            // \u30dc\u30bf\u30f3\u6709\u52b9\u5316\n            startButtonL.IsEnabled = true;\n        }\n\n        /// <summary>\n        /// \u5de6\u306e\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\n        /// </summary>\n        /// <returns>\u51e6\u7406\u3092\u9014\u4e2d\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089false</returns>\n        private async Task<bool> TimeConsumingProcessLAsync()\n        {\n            var files = Directory.EnumerateFiles(\n                searchPath.Text, \"*\", SearchOption.AllDirectories);\n\n            foreach (string item in files)\n            {\n                if (isCanceled)\n                {\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089\u7d42\u4e86\n                    return false;\n                }\n\n                // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u8ffd\u52a0\n                fileListL.Items.Add(item);\n\n                // \uff08\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\uff091500\u30df\u30ea\u79d2\u5f85\u3064\n                await Task.Delay(1500);\n            }\n\n            return true;\n        }\n\n        /// <summary>\n        /// \u5de6\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private void cancelButtonL_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\u8a2d\u5b9a\n            isCanceled = true;\n        }\n\n        #endregion\n\n        #region \u53f3\u5074\u306e\u51e6\u7406\n\n        /// <summary>\n        /// \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\n        /// </summary>\n        private System.Threading.CancellationTokenSource cts = null;\n\n        /// <summary>\n        /// \u53f3\u306e\u958b\u59cb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private async void startButtonR_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30dc\u30bf\u30f3\u7121\u52b9\u5316\n            startButtonR.IsEnabled = false;\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelR1.Text = \"\u51e6\u7406\u4e2d...\";\n            statusLabelR2.Text = \"-\";\n\n            // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30a2\n            fileListR.Items.Clear();\n\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\u751f\u6210\n            cts = new System.Threading.CancellationTokenSource();\n\n            // \u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u547c\u3073\u51fa\u3057\n            bool complete = await TimeConsumingProcessRAsync(cts.Token);\n\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelR1.Text = complete ? \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" : \"\u51e6\u7406\u3092\u4e2d\u65ad\u3057\u307e\u3057\u305f\u3002\";\n\n            // \u30dc\u30bf\u30f3\u6709\u52b9\u5316\n            startButtonR.IsEnabled = true;\n        }\n\n        /// <summary>\n        /// \u53f3\u306e\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\n        /// </summary>\n        /// <param name=\"token\">\u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3</param>\n        /// <returns>\u51e6\u7406\u3092\u9014\u4e2d\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089false</returns>\n        private async Task<bool> TimeConsumingProcessRAsync(System.Threading.CancellationToken token)\n        {\n            var files = Directory.EnumerateFiles(\n                searchPath.Text, \"*\", SearchOption.AllDirectories);\n\n            foreach (string item in files)\n            {\n                try\n                {\n                    // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u8ffd\u52a0\n                    fileListR.Items.Add(item);\n\n                    // \uff08\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\uff091500\u30df\u30ea\u79d2\u5f85\u3064\n                    await Task.Delay(1500, token);\n\n                }\n                catch (System.OperationCanceledException ex)\n                {\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\n\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\u89e3\u653e\n                    cts?.Dispose();\n                    cts = null;\n                    // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n                    statusLabelR2.Text = $\"\u4f8b\u5916\u3001OperationCanceledException:{ex.Message}\";\n\n                    // \u7d42\u4e86\n                    return false;\n                }\n                catch (System.Exception ex)\n                {\n                    // \u4f8b\u5916\u767a\u751f\n                    MessageBox.Show(ex.Message);\n                    return false;\n                }\n            }\n\n            return true;\n        }\n\n        /// <summary>\n        /// \u53f3\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private void cancelButtonR_Click(object sender, RoutedEventArgs e)\n        {\n            // \u307e\u3060\u30ad\u30e3\u30f3\u30bb\u30eb\u8981\u6c42\u3055\u308c\u3066\u3044\u306a\u3044\uff1f\n            if (cts?.IsCancellationRequested == false)\n            {\n                // \u30ad\u30e3\u30f3\u30bb\u30eb\u8981\u6c42\n                cts.Cancel();\n            }\n        }\n\n        #endregion\n\n    }\n}\n\n\n\n \u74b0\u5883\n\nWindows 10\nVisual Studio Community 2015 Update 3\n\n# <i class=\"fa fa-cubes\" style=\"font-size:1em;\"></i> \u6982\u8981\n\u753b\u9762\u3067\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u3092\u975e\u540c\u671f\u3067\u5b9f\u884c\u3001\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3002\n\n# <i class=\"fa fa-cubes\" style=\"font-size:1em;\"></i> \u753b\u9762\u30a4\u30e1\u30fc\u30b8\n\u300c\u958b\u59cb\u300d\u30dc\u30bf\u30f3\u3067\u300c\u63a2\u7d22\u30d1\u30b9\u300d\u306e\u30d5\u30a1\u30a4\u30eb\u4e00\u89a7\u3092\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3002\n\u5de6\u53f3\u306e\u9055\u3044\u306f\u30ad\u30e3\u30f3\u30bb\u30eb\u51e6\u7406\u306e\u5b9f\u88c5\u3002\n\u5de6\u5074\u306f\u30d5\u30e9\u30b0\u3001\u53f3\u5074\u306f\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3002\n![async_await01.png](https://qiita-image-store.s3.amazonaws.com/0/142879/73241aaa-c43c-0a0f-9a4d-096743bcdc15.png)\n\n# <i class=\"fa fa-file-text-o\" style=\"font-size:1em;\"></i> \u30b3\u30fc\u30c9\n\n```Xml:MainWindow.xaml\n<Window x:Class=\"WpfAsyncAwaitCancelSample.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WpfAsyncAwaitCancelSample\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"350\" Width=\"525\" MinWidth=\"500\" ResizeMode=\"CanResizeWithGrip\">\n    <Grid>\n        <Grid.RowDefinitions>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"auto\"/>\n            <RowDefinition Height=\"*\"/>\n        </Grid.RowDefinitions>\n        <Grid.ColumnDefinitions>\n            <ColumnDefinition/>\n            <ColumnDefinition/>\n        </Grid.ColumnDefinitions>\n\n        <StackPanel Grid.ColumnSpan=\"2\" Orientation=\"Horizontal\">\n            <Label Content=\"\u63a2\u7d22\u30d1\u30b9\"/>\n            <TextBox x:Name=\"searchPath\" Text=\"C:\\Work\" Width=\"400\" VerticalAlignment=\"Center\"/>\n        </StackPanel>\n        \n        <!--#region \u5de6\u5074-->\n        \n        <!-- \u30dc\u30bf\u30f3 -->\n        <StackPanel Grid.Row=\"1\" Orientation=\"Horizontal\">\n            <Button x:Name=\"startButtonL\" Content=\"\u958b\u59cb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"startButtonL_Click\"/>\n            <Button x:Name=\"cancelButtonL\" Content=\"\u30ad\u30e3\u30f3\u30bb\u30eb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"cancelButtonL_Click\" />\n        </StackPanel>\n\n        <!-- \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a -->\n        <TextBlock Grid.Row=\"2\" x:Name=\"statusLabelL\" Text=\"-\" Margin=\"5\"/>\n        \n        <!-- \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7 -->\n        <ListBox Grid.Row=\"3\" x:Name=\"fileListL\"/>\n\n        <!--#endregion -->\n        \n        <!--#region \u53f3\u5074-->\n        \n        <!-- \u30dc\u30bf\u30f3 -->\n        <StackPanel Grid.Row=\"1\" Grid.Column=\"1\" Orientation=\"Horizontal\">\n            <Button x:Name=\"startButtonR\" Content=\"\u958b\u59cb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"startButtonR_Click\"/>\n            <Button x:Name=\"cancelButtonR\" Content=\"\u30ad\u30e3\u30f3\u30bb\u30eb\" Width=\"100\" Height=\"30\" Margin=\"5\" Click=\"cancelButtonR_Click\" />\n        </StackPanel>\n\n        <!-- \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a -->\n        <StackPanel Grid.Row=\"2\" Grid.Column=\"1\">\n            <TextBlock x:Name=\"statusLabelR1\" Text=\"-\" Margin=\"5,5,5,0\"/>\n            <TextBlock x:Name=\"statusLabelR2\" Text=\"-\" Margin=\"5\"/>\n        </StackPanel>\n\n        <!-- \u30d5\u30a1\u30a4\u30eb\u4e00\u89a7 -->\n        <ListBox Grid.Row=\"3\" Grid.Column=\"1\" x:Name=\"fileListR\"/>\n\n        <!--#endregion-->\n    </Grid>\n</Window>\n```\n\n```MainWindow.xaml.cs\nusing System.IO;\nusing System.Threading.Tasks;\nusing System.Windows;\n\nnamespace WpfAsyncAwaitCancelSample\n{\n    /// <summary>\n    /// MainWindow.xaml \u306e\u76f8\u4e92\u4f5c\u7528\u30ed\u30b8\u30c3\u30af\n    /// </summary>\n    public partial class MainWindow : Window\n    {\n        /// <summary>\n        /// \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n        /// </summary>\n        public MainWindow()\n        {\n            InitializeComponent();\n        }\n\n        #region \u5de6\u5074\u306e\u51e6\u7406\uff08\u30ad\u30e3\u30f3\u30bb\u30eb\u62bc\u3057\u3066\u304b\u3089\u7d42\u4e86\u3059\u308b\u307e\u3067\u306b\u30bf\u30a4\u30e0\u30e9\u30b0\u3042\u308a\uff09\n\n        /// <summary>\n        /// \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\n        /// </summary>\n        private bool isCanceled = false;\n\n        /// <summary>\n        /// \u5de6\u306e\u958b\u59cb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private async void startButtonL_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30dc\u30bf\u30f3\u7121\u52b9\u5316\n            startButtonL.IsEnabled = false;\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\u521d\u671f\u5316\n            isCanceled = false;\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelL.Text = \"\u51e6\u7406\u4e2d...\";\n\n            // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30a2\n            fileListL.Items.Clear();\n\n            // \u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u547c\u3073\u51fa\u3057\n            bool complete = await TimeConsumingProcessLAsync();\n\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelL.Text = complete ? \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" : \"\u51e6\u7406\u3092\u4e2d\u65ad\u3057\u307e\u3057\u305f\u3002\";\n\n            // \u30dc\u30bf\u30f3\u6709\u52b9\u5316\n            startButtonL.IsEnabled = true;\n        }\n\n        /// <summary>\n        /// \u5de6\u306e\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\n        /// </summary>\n        /// <returns>\u51e6\u7406\u3092\u9014\u4e2d\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089false</returns>\n        private async Task<bool> TimeConsumingProcessLAsync()\n        {\n            var files = Directory.EnumerateFiles(\n                searchPath.Text, \"*\", SearchOption.AllDirectories);\n\n            foreach (string item in files)\n            {\n                if (isCanceled)\n                {\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089\u7d42\u4e86\n                    return false;\n                }\n\n                // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u8ffd\u52a0\n                fileListL.Items.Add(item);\n\n                // \uff08\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\uff091500\u30df\u30ea\u79d2\u5f85\u3064\n                await Task.Delay(1500);\n            }\n\n            return true;\n        }\n\n        /// <summary>\n        /// \u5de6\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private void cancelButtonL_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u30d5\u30e9\u30b0\u8a2d\u5b9a\n            isCanceled = true;\n        }\n\n        #endregion\n\n        #region \u53f3\u5074\u306e\u51e6\u7406\n\n        /// <summary>\n        /// \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\n        /// </summary>\n        private System.Threading.CancellationTokenSource cts = null;\n\n        /// <summary>\n        /// \u53f3\u306e\u958b\u59cb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private async void startButtonR_Click(object sender, RoutedEventArgs e)\n        {\n            // \u30dc\u30bf\u30f3\u7121\u52b9\u5316\n            startButtonR.IsEnabled = false;\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelR1.Text = \"\u51e6\u7406\u4e2d...\";\n            statusLabelR2.Text = \"-\";\n\n            // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u30af\u30ea\u30a2\n            fileListR.Items.Clear();\n\n            // \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\u751f\u6210\n            cts = new System.Threading.CancellationTokenSource();\n\n            // \u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\u547c\u3073\u51fa\u3057\n            bool complete = await TimeConsumingProcessRAsync(cts.Token);\n\n            // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n            statusLabelR1.Text = complete ? \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" : \"\u51e6\u7406\u3092\u4e2d\u65ad\u3057\u307e\u3057\u305f\u3002\";\n\n            // \u30dc\u30bf\u30f3\u6709\u52b9\u5316\n            startButtonR.IsEnabled = true;\n        }\n\n        /// <summary>\n        /// \u53f3\u306e\u6642\u9593\u306e\u304b\u304b\u308b\u51e6\u7406\n        /// </summary>\n        /// <param name=\"token\">\u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3</param>\n        /// <returns>\u51e6\u7406\u3092\u9014\u4e2d\u3067\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\u3089false</returns>\n        private async Task<bool> TimeConsumingProcessRAsync(System.Threading.CancellationToken token)\n        {\n            var files = Directory.EnumerateFiles(\n                searchPath.Text, \"*\", SearchOption.AllDirectories);\n\n            foreach (string item in files)\n            {\n                try\n                {\n                    // \u30ea\u30b9\u30c8\u30dc\u30c3\u30af\u30b9\u306b\u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u8ffd\u52a0\n                    fileListR.Items.Add(item);\n\n                    // \uff08\u52d5\u4f5c\u78ba\u8a8d\u306e\u305f\u3081\uff091500\u30df\u30ea\u79d2\u5f85\u3064\n                    await Task.Delay(1500, token);\n\n                }\n                catch (System.OperationCanceledException ex)\n                {\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u305f\n\n                    // \u30ad\u30e3\u30f3\u30bb\u30eb\u7528\u30c8\u30fc\u30af\u30f3\u30bd\u30fc\u30b9\u89e3\u653e\n                    cts?.Dispose();\n                    cts = null;\n                    // \u30b9\u30c6\u30fc\u30bf\u30b9\u8868\u793a\u66f4\u65b0\n                    statusLabelR2.Text = $\"\u4f8b\u5916\u3001OperationCanceledException:{ex.Message}\";\n\n                    // \u7d42\u4e86\n                    return false;\n                }\n                catch (System.Exception ex)\n                {\n                    // \u4f8b\u5916\u767a\u751f\n                    MessageBox.Show(ex.Message);\n                    return false;\n                }\n            }\n\n            return true;\n        }\n\n        /// <summary>\n        /// \u53f3\u306e\u30ad\u30e3\u30f3\u30bb\u30eb\u30dc\u30bf\u30f3\u51e6\u7406\n        /// </summary>\n        /// <param name=\"sender\"></param>\n        /// <param name=\"e\"></param>\n        private void cancelButtonR_Click(object sender, RoutedEventArgs e)\n        {\n            // \u307e\u3060\u30ad\u30e3\u30f3\u30bb\u30eb\u8981\u6c42\u3055\u308c\u3066\u3044\u306a\u3044\uff1f\n            if (cts?.IsCancellationRequested == false)\n            {\n                // \u30ad\u30e3\u30f3\u30bb\u30eb\u8981\u6c42\n                cts.Cancel();\n            }\n        }\n\n        #endregion\n\n    }\n}\n```\n\n# <i class=\"fa fa-cubes\" style=\"font-size:1em;\"></i> \u74b0\u5883\n* Windows 10\n* Visual Studio Community 2015 Update 3\n"}