{"context": "\n\n\u306f\u3058\u3081\u306b\nVBA-PowerShell\u9593\u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3084\u308a\u3068\u308a\u3057\u305f\u3044\u5834\u5408\u306e\u4e00\u3064\u306e\u624b\u6bb5\u3068\u3057\u3066\u3001\nApplication.Run\u7d4c\u7531\u3067VBA\u306e\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u547c\u3076PowerShell\u306e\u95a2\u6570\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\nVBA\u5074\u304b\u3089\u300cPublicNotCreatable\u300d\u3092\u8a2d\u5b9a\u3057\u305f\u81ea\u4f5c\u30af\u30e9\u30b9\u306a\u3069\u3092\u8fd4\u3057\u3066\u3042\u3052\u308c\u3070\u3001VBA\u3068PowerShell\u9593\u3067\u540c\u3058\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53c2\u7167\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3068\u306a\u308b\u3002\n\u591a\u7528\u3059\u308b\u3082\u306e\u3067\u306f\u7121\u3044\u304c\u3001VBA\u3060\u3051\u3067\u5b8c\u7d50\u3067\u304d\u306a\u3044\u5834\u5408\u306e\u4e00\u624b\u6bb5\u3068\u3057\u3066\u3002\n\n\u30b3\u30fc\u30c9\nFunction Invoke-VBAProc\n{\n    <#\n    .SYNOPSIS\n    \u6307\u5b9a\u3055\u308c\u305fVBA\u306e\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u5b9f\u884c\u7d50\u679c\u3092\u8fd4\u3057\u307e\u3059\u3002\n    #>\n\n    [CmdletBinding()]\n    Param(\n\n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u542b\u3080Office\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        \u672a\u4fdd\u5b58\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3082\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$Path,\n\n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u542b\u3080\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$ModuleName,\n\n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$ProcName\n    )\n\n    # \u5909\u6570\u306e\u5ba3\u8a00\u3092\u5f37\u5236\n    Set-StrictMode -Version 1\n\n    # Try\u30d6\u30ed\u30c3\u30af\u306b\u5165\u308b\u524d\u306b\u5909\u6570\u3092\u7528\u610f\u3057\u3066\u304a\u304f\n    [__ComObject]$docOffice = $null\n    [__ComObject]$appOffice = $null\n\n    Try\n    {\n        # Office\u53d6\u5f97Try\n        Try\n        {\n            $docOffice = [Runtime.InteropServices.Marshal]::BindToMoniker($Path)\n            $appOffice = $docOffice.Application\n        }\n        Catch\n        {\n            Write-Error -Message Office\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n            Throw\n        }\n\n        # Application.Run Try\n        Try\n        {\n            <#\n            Application.Run\u3067\u6307\u5b9a\u3059\u308b\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u540d\u6587\u5b57\u5217\u3002\n            \u540c\u540d\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u304c\u3042\u3063\u3066\u3082\u7279\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u300c'\u30d5\u30a1\u30a4\u30eb\u540d'!\u30e2\u30b8\u30e5\u30fc\u30eb\u540d.\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u540d\u300d\u306e\u5f62\u5f0f\u306b\u3059\u308b\u3002\n            #>\n            $appRunProc = \n                \"'{0}'!{1}.{2}\" -f \n                    ([IO.Path]::GetFileName($Path)),\n                    $ModuleName,\n                    $ProcName\n\n            Write-Verbose -Message ('Exec:{0}' -f $appRunProc)\n\n            Return $appOffice.Run($appRunProc)\n        }\n        Catch\n        {\n            Write-Error -Message Application.Run\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n            Throw\n        }\n    }\n    Finally\n    {\n        # COM\u5f8c\u59cb\u672b\u3002\n        If ($null -Ne $docOffice)\n        {\n            [Runtime.InteropServices.Marshal]::FinalReleaseComObject($docOffice) > $null\n            $docOffice = $null\n        }\n\n        If ($null -Ne $appOffice)\n        {\n            [Runtime.InteropServices.Marshal]::FinalReleaseComObject($appOffice) > $null\n            $appOffice = $null\n        }\n    }\n}\n\n\n\u30b5\u30f3\u30d7\u30eb\n\nVBA\n\u65b0\u898f\u30d6\u30c3\u30af\u3092\u4f5c\u6210\u3057\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051\u308b\u3002\n\u30d6\u30c3\u30af\u306f\u672a\u4fdd\u5b58\u3067\u540d\u524d\u306fBook1\u3067\u3042\u308b\u3053\u3068\u3002\n\n\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\n\nModule1\nOption Explicit\n\nPrivate shareClass As Class1\n\nFunction CallByPowerShell() As Class1\n    Set shareClass = New Class1\n    shareClass.Msg = \"VBA\"\n    shareClass.Col.Add \"XYZ\"\n    Set CallByPowerShell = shareClass\nEnd Function\n\n\n\n\u30af\u30e9\u30b9\u30e2\u30b8\u30e5\u30fc\u30eb\n\u540d\u524d\u306f\u305d\u306e\u307e\u307e\uff08Class1\uff09\u3067\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30922 - PublicNotCreatable\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n\nClass1\nOption Explicit\n\nPublic Msg As String\nPublic Col As VBA.Collection\n\nPrivate Sub Class_Initialize()\n    Set Col = New VBA.Collection\nEnd Sub\n\n\n\nPowerShell\n\u4e0a\u8a18\u306eInvoke-VBAProc\u95a2\u6570\u3092\u5b9a\u7fa9\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3002\n\nSample.ps1\n[Object]$retVal = Invoke-VBAProc -Path Book1 -ModuleName Module1 -ProcName CallByPowerShell\n\nWrite-Host \u6700\u521d\u306eMsg\n$retVal.Msg\nWrite-Host \u6700\u521d\u306eCol\n$retVal.Col\n\n# \u5909\u66f4\n$retVal.Msg = 'PowerShell'\n$retVal.Col.Add(\"ABC\")\n\nWrite-Host \u5909\u66f4\u5f8cMsg\n$retVal.Msg\nWrite-Host \u5909\u66f4\u5f8cCol\n$retVal.Col\n\n# \u5f8c\u59cb\u672b\nIf ([Runtime.InteropServices.Marshal]::IsComObject($retVal))\n{\n    Write-Host ReleaseCOM\n    [Runtime.InteropServices.Marshal]::FinalReleaseComObject($retVal) > $null\n}\n$retVal = $null\n\n\n\n\u7d50\u679c\nPowerShell\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\u6700\u521d\u306eMsg\nVBA\n\u6700\u521d\u306eCol\nXYZ\n\u5909\u66f4\u5f8cMsg\nPowerShell\n\u5909\u66f4\u5f8cCol\nXYZ\nABC\nReleaseCOM\n\n\u307e\u305fVBA\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3082\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3042\u308b\u3002\n# \u306f\u3058\u3081\u306b\n\nVBA-PowerShell\u9593\u3067\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u3084\u308a\u3068\u308a\u3057\u305f\u3044\u5834\u5408\u306e\u4e00\u3064\u306e\u624b\u6bb5\u3068\u3057\u3066\u3001\nApplication.Run\u7d4c\u7531\u3067VBA\u306e\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u547c\u3076PowerShell\u306e\u95a2\u6570\u3092\u4f5c\u3063\u3066\u307f\u305f\u3002\n\nVBA\u5074\u304b\u3089\u300cPublicNotCreatable\u300d\u3092\u8a2d\u5b9a\u3057\u305f\u81ea\u4f5c\u30af\u30e9\u30b9\u306a\u3069\u3092\u8fd4\u3057\u3066\u3042\u3052\u308c\u3070\u3001VBA\u3068PowerShell\u9593\u3067\u540c\u3058\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u53c2\u7167\u3055\u305b\u308b\u3053\u3068\u304c\u53ef\u80fd\u3068\u306a\u308b\u3002\n\n\u591a\u7528\u3059\u308b\u3082\u306e\u3067\u306f\u7121\u3044\u304c\u3001VBA\u3060\u3051\u3067\u5b8c\u7d50\u3067\u304d\u306a\u3044\u5834\u5408\u306e\u4e00\u624b\u6bb5\u3068\u3057\u3066\u3002\n\n\n# \u30b3\u30fc\u30c9\n\n```ps1\nFunction Invoke-VBAProc\n{\n    <#\n    .SYNOPSIS\n    \u6307\u5b9a\u3055\u308c\u305fVBA\u306e\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u5b9f\u884c\u3057\u3001\u305d\u306e\u5b9f\u884c\u7d50\u679c\u3092\u8fd4\u3057\u307e\u3059\u3002\n    #>\n\n    [CmdletBinding()]\n    Param(\n        \n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u542b\u3080Office\u30d5\u30a1\u30a4\u30eb\u306e\u30d5\u30eb\u30d1\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        \u672a\u4fdd\u5b58\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u3082\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$Path,\n\n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u3092\u542b\u3080\u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$ModuleName,\n\n        <#\n        \u5b9f\u884c\u3057\u305f\u3044\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u306e\u540d\u524d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n        #>\n        [parameter(Mandatory=$true)]\n        [String]$ProcName\n    )\n    \n    # \u5909\u6570\u306e\u5ba3\u8a00\u3092\u5f37\u5236\n    Set-StrictMode -Version 1\n\n    # Try\u30d6\u30ed\u30c3\u30af\u306b\u5165\u308b\u524d\u306b\u5909\u6570\u3092\u7528\u610f\u3057\u3066\u304a\u304f\n    [__ComObject]$docOffice = $null\n    [__ComObject]$appOffice = $null\n\n    Try\n    {\n        # Office\u53d6\u5f97Try\n        Try\n        {\n            $docOffice = [Runtime.InteropServices.Marshal]::BindToMoniker($Path)\n            $appOffice = $docOffice.Application\n        }\n        Catch\n        {\n            Write-Error -Message Office\u3078\u306e\u63a5\u7d9a\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n            Throw\n        }\n\n        # Application.Run Try\n        Try\n        {\n            <#\n            Application.Run\u3067\u6307\u5b9a\u3059\u308b\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u540d\u6587\u5b57\u5217\u3002\n            \u540c\u540d\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u304c\u3042\u3063\u3066\u3082\u7279\u5b9a\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u300c'\u30d5\u30a1\u30a4\u30eb\u540d'!\u30e2\u30b8\u30e5\u30fc\u30eb\u540d.\u30d7\u30ed\u30b7\u30fc\u30b8\u30e3\u540d\u300d\u306e\u5f62\u5f0f\u306b\u3059\u308b\u3002\n            #>\n            $appRunProc = \n                \"'{0}'!{1}.{2}\" -f \n                    ([IO.Path]::GetFileName($Path)),\n                    $ModuleName,\n                    $ProcName\n            \n            Write-Verbose -Message ('Exec:{0}' -f $appRunProc)\n\n            Return $appOffice.Run($appRunProc)\n        }\n        Catch\n        {\n            Write-Error -Message Application.Run\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n            Throw\n        }\n    }\n    Finally\n    {\n        # COM\u5f8c\u59cb\u672b\u3002\n        If ($null -Ne $docOffice)\n        {\n            [Runtime.InteropServices.Marshal]::FinalReleaseComObject($docOffice) > $null\n            $docOffice = $null\n        }\n\n        If ($null -Ne $appOffice)\n        {\n            [Runtime.InteropServices.Marshal]::FinalReleaseComObject($appOffice) > $null\n            $appOffice = $null\n        }\n    }\n}\n```\n\n# \u30b5\u30f3\u30d7\u30eb\n\n## VBA\n\n\u65b0\u898f\u30d6\u30c3\u30af\u3092\u4f5c\u6210\u3057\u3001\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u3092\u8cbc\u308a\u4ed8\u3051\u308b\u3002\n\u30d6\u30c3\u30af\u306f\u672a\u4fdd\u5b58\u3067\u540d\u524d\u306f`Book1`\u3067\u3042\u308b\u3053\u3068\u3002\n\n## \u6a19\u6e96\u30e2\u30b8\u30e5\u30fc\u30eb\n\n```vbnet:Module1\nOption Explicit\n\nPrivate shareClass As Class1\n\nFunction CallByPowerShell() As Class1\n    Set shareClass = New Class1\n    shareClass.Msg = \"VBA\"\n    shareClass.Col.Add \"XYZ\"\n    Set CallByPowerShell = shareClass\nEnd Function\n```\n\n## \u30af\u30e9\u30b9\u30e2\u30b8\u30e5\u30fc\u30eb\n\n\u540d\u524d\u306f\u305d\u306e\u307e\u307e\uff08`Class1`\uff09\u3067\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u3092`2 - PublicNotCreatable`\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304f\u3002\n\n```vbnet:Class1\nOption Explicit\n\nPublic Msg As String\nPublic Col As VBA.Collection\n\nPrivate Sub Class_Initialize()\n    Set Col = New VBA.Collection\nEnd Sub\n```\n\n\n## PowerShell\n\n\u4e0a\u8a18\u306eInvoke-VBAProc\u95a2\u6570\u3092\u5b9a\u7fa9\u5f8c\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```ps1:Sample.ps1\n[Object]$retVal = Invoke-VBAProc -Path Book1 -ModuleName Module1 -ProcName CallByPowerShell\n\nWrite-Host \u6700\u521d\u306eMsg\n$retVal.Msg\nWrite-Host \u6700\u521d\u306eCol\n$retVal.Col\n\n# \u5909\u66f4\n$retVal.Msg = 'PowerShell'\n$retVal.Col.Add(\"ABC\")\n\nWrite-Host \u5909\u66f4\u5f8cMsg\n$retVal.Msg\nWrite-Host \u5909\u66f4\u5f8cCol\n$retVal.Col\n\n# \u5f8c\u59cb\u672b\nIf ([Runtime.InteropServices.Marshal]::IsComObject($retVal))\n{\n    Write-Host ReleaseCOM\n    [Runtime.InteropServices.Marshal]::FinalReleaseComObject($retVal) > $null\n}\n$retVal = $null\n```\n\n## \u7d50\u679c\n\nPowerShell\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308b\u3002\n\n```text\n\u6700\u521d\u306eMsg\nVBA\n\u6700\u521d\u306eCol\nXYZ\n\u5909\u66f4\u5f8cMsg\nPowerShell\n\u5909\u66f4\u5f8cCol\nXYZ\nABC\nReleaseCOM\n```\n\n\u307e\u305fVBA\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3082\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u306f\u305a\u3067\u3042\u308b\u3002\n", "tags": ["VBA", "PowerShell"]}