{"context": "\u30e6\u30fc\u30b6\u306e\u64cd\u4f5c\u624b\u9806\u3092\u8ffd\u8de1\u3059\u308b\u305f\u3081\u306b\u3001IP\u30a2\u30c9\u30ec\u30b9\u3092\u30ed\u30b0\u51fa\u529b\u3057\u305f\u3044\u306a\u3093\u3066\u8a71\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u8981\u4ef6\u306eSpring Boot\u3067\u306e\u5b9f\u88c5\u624b\u9806\u3067\u3059\u3002\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\nSpring Boot:1.3.6\n\n\u53c2\u8003\nSpring Boot\u306e\u30ed\u30b0\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306e\u5909\u66f4\u65b9\u6cd5\u306a\u3069\u304c\u7c21\u6f54\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\nLogback \u4f7f\u3044\u65b9\u30e1\u30e2\n\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u304b\u3001\u6b32\u3057\u3044\u60c5\u5831\u304c\u307e\u3068\u307e\u3063\u3066\u3044\u3066\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\nlogback \u30de\u30cb\u30e5\u30a2\u30eb-\u7b2c8\u7ae0 \u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\nlobback\u306f\u548c\u8a33\u304c\u3042\u308b\u306e\u3067\u3059\u306d\u3002\u7d20\u6674\u3089\u3057\u3044\u3002\u3002\nhttp://logback.qos.ch/manual/index_ja.html\n\n\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\nLogSettingFilter.java\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\u3001logback.xml\u3067\u51fa\u529b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u2514\u2500\u2500 src\n\u00a0\u00a0\u00a0 \u00a0\u2514\u2500\u2500 main\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u251c\u2500\u2500 java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 AppConfig.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 LogSettingFilter.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 SampleController.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 SpringbootLogApplication.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0     \u2514\u2500\u2500 logback.xml\n\n\n\n\u5b9f\u88c5\nlogback.xml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nspring-boot.jar\u914d\u4e0b\u306edefaults.xml\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n\u30d1\u30bf\u30fc\u30f3\u306e\u5185\u5bb9\u306fLogback \u4f7f\u3044\u65b9\u30e1\u30e2-\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u6307\u5b9a\u3059\u308b\u306b\u3042\u308a\u307e\u3059\u3002\n%X{client} \u306f\u5f8c\u8ff0\u306e\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u7b87\u6240\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\u306e\u307f\u3057\u3066\u3044\u307e\u3059\u3002\n\nlobback.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE logback>\n<configuration>\n    <include resource=\"org/springframework/boot/logging/logback/defaults.xml\"/>\n\n    <appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <layout class=\"ch.qos.logback.classic.PatternLayout\">\n            <Pattern>%d %p %t %c %X{client} - %m%n</Pattern>\n        </layout>\n    </appender>\n</configuration>\n\n\nJavaEE\u306eFilter\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3001MDC(\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8)\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nMDC\u306b\u306f\u30b9\u30ec\u30c3\u30c9\u30ed\u30fc\u30ab\u30eb\u3067\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\nLogSettingFiler.java\npackage com.example;\n\nimport org.slf4j.MDC;\n\nimport javax.servlet.*;\nimport java.io.IOException;\n\n/**\n * \u30ed\u30b0\u51fa\u529b\u7528\u306e\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3059\u308bFilter\u30af\u30e9\u30b9.\n */\npublic class LogSettingFilter implements Filter {\n\n    String CLIENT = \"client\";\n\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n\n    }\n\n    /**\n     * \u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059.\n     * @param servletRequest\n     * @param servletResponse\n     * @param filterChain\n     * @throws IOException\n     * @throws ServletException\n     */\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n\n        try {\n            MDC.put(CLIENT, servletRequest.getRemoteAddr());\n            filterChain.doFilter(servletRequest, servletResponse);\n        } finally {\n            MDC.remove(CLIENT);\n        }\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n}\n\n\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fFilter\u30af\u30e9\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\nAppConfig.java\npackage com.example;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n\n@Configuration\npublic class AppConfig {\n\n    @Bean\n    LogSettingFilter logSettingFilterFilter() {\n\n        LogSettingFilter filter = new LogSettingFilter();\n        return filter;\n    }\n\n}\n\n\n\u9069\u5f53\u306a\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u6210\u3057\u3066\u30ed\u30b0\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\nSampleController\npackage com.example;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\n@RequestMapping(\"/web/sample\")\npublic class SampleController {\n\n    private static Logger logger = LoggerFactory.getLogger(SampleController.class);\n\n    @RequestMapping(method = RequestMethod.GET)\n    public int logSample() {\n\n        logger.info(\"IP\u30a2\u30c9\u30ec\u30b9\u51fa\u529b\");\n        return 1;\n    }\n\n}\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n\u5b9f\u884c\u7d50\u679c\n2016-07-18 16:39:04,522 INFO http-nio-8080-exec-1 com.example.SampleController 0:0:0:0:0:0:0:1 - IP\u30a2\u30c9\u30ec\u30b9\u51fa\u529b\n\n\n\n\n\u30e6\u30fc\u30b6\u306e\u64cd\u4f5c\u624b\u9806\u3092\u8ffd\u8de1\u3059\u308b\u305f\u3081\u306b\u3001IP\u30a2\u30c9\u30ec\u30b9\u3092\u30ed\u30b0\u51fa\u529b\u3057\u305f\u3044\u306a\u3093\u3066\u8a71\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u8981\u4ef6\u306eSpring Boot\u3067\u306e\u5b9f\u88c5\u624b\u9806\u3067\u3059\u3002\n#\u30d0\u30fc\u30b8\u30e7\u30f3\nSpring Boot:1.3.6\n\n#\u53c2\u8003\n[Spring Boot\u306e\u30ed\u30b0\u8a2d\u5b9a\u3092\u5909\u66f4\u3059\u308b](http://qiita.com/tag1216/items/b898b8fb58920bf335b2)\n\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306e\u5909\u66f4\u65b9\u6cd5\u306a\u3069\u304c\u7c21\u6f54\u306b\u307e\u3068\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\n[Logback \u4f7f\u3044\u65b9\u30e1\u30e2](http://qiita.com/opengl-8080/items/49719f2d35171f017aa9)\n\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3068\u304b\u3001\u6b32\u3057\u3044\u60c5\u5831\u304c\u307e\u3068\u307e\u3063\u3066\u3044\u3066\u3042\u308a\u304c\u305f\u3044\u3067\u3059\u3002\n\n[logback \u30de\u30cb\u30e5\u30a2\u30eb-\u7b2c8\u7ae0 \u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8](http://logback.qos.ch/manual/mdc_ja.html)\nlobback\u306f\u548c\u8a33\u304c\u3042\u308b\u306e\u3067\u3059\u306d\u3002\u7d20\u6674\u3089\u3057\u3044\u3002\u3002\nhttp://logback.qos.ch/manual/index_ja.html\n\n#\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\n LogSettingFilter.java\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u53d6\u5f97\u3001logback.xml\u3067\u51fa\u529b\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\u30d5\u30a9\u30eb\u30c0\u69cb\u6210\n\u2514\u2500\u2500 src\n\u00a0\u00a0\u00a0 \u00a0\u2514\u2500\u2500 main\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u251c\u2500\u2500 java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 com\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 example\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 AppConfig.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 LogSettingFilter.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u251c\u2500\u2500 SampleController.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2502\u00a0\u00a0         \u2514\u2500\u2500 SpringbootLogApplication.java\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0 \u2514\u2500\u2500 resources\n\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0     \u2514\u2500\u2500 logback.xml\n\n```\n\n#\u5b9f\u88c5\nlogback.xml\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nspring-boot.jar\u914d\u4e0b\u306edefaults.xml\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002\n\u30d1\u30bf\u30fc\u30f3\u306e\u5185\u5bb9\u306f[Logback \u4f7f\u3044\u65b9\u30e1\u30e2-\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u6307\u5b9a\u3059\u308b](http://qiita.com/opengl-8080/items/49719f2d35171f017aa9#%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%AE%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B)\u306b\u3042\u308a\u307e\u3059\u3002\n%X{client} \u306f\u5f8c\u8ff0\u306e\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u3067IP\u30a2\u30c9\u30ec\u30b9\u306e\u8a2d\u5b9a\u7b87\u6240\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u30b3\u30f3\u30bd\u30fc\u30eb\u51fa\u529b\u306e\u307f\u3057\u3066\u3044\u307e\u3059\u3002\n\n```xml:lobback.xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE logback>\n<configuration>\n    <include resource=\"org/springframework/boot/logging/logback/defaults.xml\"/>\n\n    <appender name=\"CONSOLE\" class=\"ch.qos.logback.core.ConsoleAppender\">\n        <layout class=\"ch.qos.logback.classic.PatternLayout\">\n            <Pattern>%d %p %t %c %X{client} - %m%n</Pattern>\n        </layout>\n    </appender>\n</configuration>\n```\n\nJavaEE\u306eFilter\u3092\u5b9f\u88c5\u3057\u305f\u30af\u30e9\u30b9\u3092\u4f5c\u6210\u3057\u3001MDC(\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8)\u306bIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nMDC\u306b\u306f\u30b9\u30ec\u30c3\u30c9\u30ed\u30fc\u30ab\u30eb\u3067\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\n\n```java:LogSettingFiler.java\npackage com.example;\n\nimport org.slf4j.MDC;\n\nimport javax.servlet.*;\nimport java.io.IOException;\n\n/**\n * \u30ed\u30b0\u51fa\u529b\u7528\u306e\u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3059\u308bFilter\u30af\u30e9\u30b9.\n */\npublic class LogSettingFilter implements Filter {\n\n    String CLIENT = \"client\";\n\n    @Override\n    public void init(FilterConfig filterConfig) throws ServletException {\n\n    }\n\n    /**\n     * \u8a3a\u65ad\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059.\n     * @param servletRequest\n     * @param servletResponse\n     * @param filterChain\n     * @throws IOException\n     * @throws ServletException\n     */\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n\n        try {\n            MDC.put(CLIENT, servletRequest.getRemoteAddr());\n            filterChain.doFilter(servletRequest, servletResponse);\n        } finally {\n            MDC.remove(CLIENT);\n        }\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n}\n```\n\n\u4e0a\u8a18\u3067\u4f5c\u6210\u3057\u305fFilter\u30af\u30e9\u30b9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```java:AppConfig.java\npackage com.example;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n\n@Configuration\npublic class AppConfig {\n\n    @Bean\n    LogSettingFilter logSettingFilterFilter() {\n\n        LogSettingFilter filter = new LogSettingFilter();\n        return filter;\n    }\n\n}\n```\n\n\u9069\u5f53\u306a\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u6210\u3057\u3066\u30ed\u30b0\u51fa\u529b\u3057\u3066\u307f\u307e\u3059\u3002\n\n```java:SampleController\npackage com.example;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.web.bind.annotation.RequestMapping;\nimport org.springframework.web.bind.annotation.RequestMethod;\nimport org.springframework.web.bind.annotation.RestController;\n\n@RestController\n@RequestMapping(\"/web/sample\")\npublic class SampleController {\n\n    private static Logger logger = LoggerFactory.getLogger(SampleController.class);\n\n    @RequestMapping(method = RequestMethod.GET)\n    public int logSample() {\n\n        logger.info(\"IP\u30a2\u30c9\u30ec\u30b9\u51fa\u529b\");\n        return 1;\n    }\n\n}\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```:\u5b9f\u884c\u7d50\u679c\n2016-07-18 16:39:04,522 INFO http-nio-8080-exec-1 com.example.SampleController 0:0:0:0:0:0:0:1 - IP\u30a2\u30c9\u30ec\u30b9\u51fa\u529b\n\n```\n\n\n", "tags": ["spring-boot", "spring"]}