{"context": " More than 1 year has passed since last update.\n\nRedshift\u8d77\u52d5\n\u30d0\u30fc\u30b8\u30cb\u30a2Region\u306b\u4f5c\u6210\u3059\u308b\u3002\n\nNode Type: dw.hs1.xlarge\nCluster Type: Single Node\n\n2TB\u306e\u5bb9\u91cf\u3067OnDemand\u306a\u306e\u3067 $0.85/hour\u3002\n\u3060\u3044\u305f\u3044\uff11\uff10\u5206\u304f\u3089\u3044\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u7d42\u308f\u3063\u3066\u305f\u304b\u306a\uff1f\uff1f\n\nClient\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nAmazon Linux\u3067\u3002\nredshift\u306ePostgresql\u306e\u8fd1\u3057\u3044Version\u306f\uff18\u3089\u3057\u3044\u306e\u3067\u3001\uff18\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5165\u308c\u308b\uff08\u305d\u308c\u3067\u826f\u3044\u306e\u304b\u306f\u3088\u304f\u77e5\u3089\u306a\u3044\uff09\u3002\nsudo yum install postgresql8-devel  \n\nredshift\u5074\u306eSecurityGroup\u3067 \u3053\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30de\u30b7\u30f3\u306eIP\u304b\u3089\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\u305d\u306e\u5f8c\u3053\u3093\u306a\u611f\u3058\u3067\u63a5\u7d9a\u3067\u304d\u308b\npsql -h *******.us-east-1.redshift.amazonaws.com -p 5439 -d mydb -U root     \n\u30e6\u30fc\u30b6 root \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:  ******************\npsql (8.4.13, \u30b5\u30fc\u30d0 8.0.2)\n\u6ce8\u610f\uff1a psql \u30d0\u30fc\u30b8\u30e7\u30f3 8.4, \u30b5\u30fc\u30d0\u30d0\u30fc\u30b8\u30e7\u30f3 8.0.\n         psql \u306e\u6a5f\u80fd\u306e\u4e2d\u3067\u3001\u52d5\u4f5c\u3057\u306a\u3044\u3082\u306e\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nSSL \u63a5\u7d9a (\u6697\u53f7\u5316\u65b9\u5f0f: DHE-RSA-AES256-SHA, \u30d3\u30c3\u30c8\u9577: 256)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\nmydb=# \n\n\n\u7c21\u5358\u306a\u30c7\u30fc\u30bf\u5165\u308c\u3066\u307f\u308b\n\u8a66\u3057\u306b\u3053\u3046\u3044\u3046\u30c7\u30fc\u30bf\u3092\u8003\u3048\u308b\n\nid: int\ntype: varchar(32)\npoint: int\nevent_datetime: datetime  # UTC\n\n-\nSQL\u306e\u6587\u6cd5\u306f\u3053\u306e\u8fba\u3092\u53c2\u7167\u3002\u898b\u6163\u308c\u306a\u3044\u30ad\u30fc\u30ef\u30fc\u30c9\u3082\u51fa\u3066\u304d\u3066\u3044\u307e\u3059\u306d\u3002\nCreate Table sample1 (\n  id BIGINT IDENTITY(1,1) PRIMARY KEY,\n  type VARCHAR(32) ENCODE TEXT255,\n  point INT,\n  event_datetime TIMESTAMP\n)\nDISTSTYLE EVEN\nSORTKEY (event_datetime);\n\n\n\nDISTSTYLE: \u306f\u5206\u6563\u306e\u30dd\u30ea\u30b7\u30fc\u3002KEY \u304b EVEN \u3067\u3042\u308b\u3002EVEN \u306fRoundRobin\u7684\u306b\u5206\u6563\u3055\u305b\u308b\u3002KEY\u306a\u3089\u5206\u6563\u306b\u4f7f\u3046\u5217\u3092\u6307\u5b9a\u3059\u308b\u3002\u307e\u3042\u3001\u4eca\u56de\u306f Single Node \u3060\u304b\u3089\u3042\u307e\u308a\u95a2\u4fc2\u306a\u3044\u3002\n\nSORTKEY: \u306fRange\u3067\u691c\u7d22\u3059\u308b\u3068\u304d\u306b\u3088\u304f\u4f7f\u3046\u5217\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3063\u307d\u3044\u3002\n\n\u3053\u306e\u8fba\u306e\u30c6\u30fc\u30d6\u30eb\u8a2d\u8a08\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u306f\u3053\u306e\u8fba\u3092\u53c2\u7167\n\nIDENTITY: AUTO_INCREMENT \u307f\u305f\u3044\u306a\u3082\u306e\u304b\u306a\u3002\nENCODE \u306f\u5217\u5727\u7e2e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\u540c\u69d8\u306e\u6587\u5b57\u5217\u304c\u51fa\u3066\u304f\u308b\u3088\u3046\u306a\u5834\u5408\u306f TEXT255 \u3068\u304b\u3092\u4f7f\u3046\u3063\u307d\u3044\u3002\u5727\u7e2e\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8a73\u7d30 \u306f\u3053\u3061\u3089\u3002\n\n\nInsert \u3068\u304b Select \u3068\u304b\n\u666e\u901a\u306b Insert \u3067\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u308b\u3002\nmydb=# insert into sample1(type, point, event_datetime) values('hoge', 10, '2013/5/10 10:10:00');\nINSERT 0 1\n\nSelect \u3068\u304b\u3057\u3066\u307f\u308b\u3002\nmydb=# select * from sample1 where event_datetime > '2013-5-2';\n id | type | point |   event_datetime    \n----+------+-------+---------------------\n  1 | hoge |    10 | 2013-05-10 10:10:00\n(1 \u884c)\n\nmydb=# select * from sample1 where event_datetime < '2013-5-2';\n id | type | point | event_datetime \n----+------+-------+----------------\n(0 \u884c)\n\n\nS3\u304b\u3089\u30c7\u30fc\u30bf\u306eImport\nS3\u306b\u30c7\u30fc\u30bf\u3092Upload\u3059\u308b\u305f\u3081\u306b s3cmd \u3092 Install\u3057\u3066\u304a\u304f\nsudo yum -y --enablerepo epel install s3cmd \ns3cmd --configure\n# ACCESS_KEY \u3068\u304b SECRET \u3068\u304b\u3092\u5165\u529b\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u4f7f\u3046\u3063\u307d\u3044\u3002\ns3cmd ls s3://BUCKET/  \ns3cmd put FILE FILE... s3://BUCKET/redshift/  \n\n\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u304b\u304f\u3002\n\nmake_data.rb\n# coding: utf-8\n# make_data.rb\n\nnum = ARGV.shift.to_i\nDELI = \"\\001\"\n\nTYPES = [\"cat\", \"dog\", \"cow\", \"horse\"]\n\nnum.times do |i|\n  type = TYPES[i % TYPES.size]\n  point = Random.rand(10) + 1\n  dt = Time.now.utc\n  puts [type, point, dt].join(DELI)\nend\n\n\n\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3001S3\u306bUpload\u3059\u308b\u3002\n    ruby make_data.rb 20000 > 20000.data\n    gzip 20000.data\n    s3cmd put 20000.data.gz s3://BUCKET/redshift/sample1/  \n\n\u30c7\u30fc\u30bf\u3092COPY\u3067\u53d6\u308a\u8fbc\u3093\u3067\u307f\u308b\u3002\nCOPY sample1\nFROM 's3://BUCKET/redshift/sample1/20000.data.gz'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=***********;aws_secret_access_key=************'\n;\nERROR:  S3ServiceException:The bucket you are attempting to access must be addressed using the specified endpoint. Please send all future requests to this endpoint.,StatusCode 301,ErrorCode PermanentRedirect,RequestId EC14D5D1453E517A,ExtendedRequestId QjHhcX8gv0D\nDETAIL:\n...\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u3002\n\u305d\u3046\u3044\u3048\u3070\u3001\u305d\u306eBucket\u306f\u6771\u4eacRegion\u306e\u3082\u306e\u3060\u3063\u305f\u306e\u3067\u3001US Standard\u306b\u5225\u306bBucket\u3092\u4f5c\u308a\u76f4\u3059\n(COPY\u30b3\u30de\u30f3\u30c9\u3067S3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u3080\u3068\u304d\u306f\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306a\u3044\u3068\u3044\u3051\u306a\u3044\uff09\n\nImportant: The Amazon S3 bucket that holds the data files must be created in the same region as your cluster.\n\n\u518d\u5ea6\u30c7\u30fc\u30bf\u3092Upload\u3057\u76f4\u3057\u3066\u3001COPY\u3092\u518d\u5b9f\u884c\u3059\u308b\u3068\u4eca\u5ea6\u306f\u6210\u529f\u3002\u3044\u304f\u3064\u304b select \u3092\u8a66\u3059\u3002\nmydb=# select count(*) from sample1;\n count\n-------\n 20001\n(1 \u884c)\n\nmydb=# select * from sample1 limit 4;\n id |  type  | point |   event_datetime\n----+--------+-------+---------------------\n  1 | hoge   |    10 | 2013-05-10 10:10:00\n  4 | dog    |     9 | 2013-05-10 06:20:32\n  8 | horse  |     4 | 2013-05-10 06:20:32\n 12 | dog    |     4 | 2013-05-10 06:20:32\n(4 \u884c)\n\n\nmydb=# select type, count(*), sum(point) from sample1 group by type;\n  type  | count |  sum  \n--------+-------+-------\n hoge   |     1 |    10\n hourse |  5000 | 27270\n cat    |  5000 | 27386\n cow    |  5000 | 27529\n dog    |  5000 | 27501\n(5 \u884c)\n\n3~4\u79d2\u3082\u3057\u306a\u3044\u3046\u3061\u306b\u7d50\u679c\u304c\u623b\u3063\u3066\u304f\u308b\u3002\n\u5168\u304f\u540c\u3058Query\uff08Limit\u3092\u5909\u5316\u3055\u305b\u305f\u7a0b\u5ea6\u3067\u306f\u540c\u3058\u3001\u3088\u3046\u306a\u6271\u3044\uff09\u3092\u6295\u3052\u308b\u3068\u76f4\u5f8c\u306b\u623b\u3063\u3066\u304f\u308b\u3002\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u306a\u3002\n\nRedshift\u8d77\u52d5\n--------------\n\n\u30d0\u30fc\u30b8\u30cb\u30a2Region\u306b\u4f5c\u6210\u3059\u308b\u3002\n\n* Node Type: dw.hs1.xlarge\n* Cluster Type: Single Node\n\n2TB\u306e\u5bb9\u91cf\u3067OnDemand\u306a\u306e\u3067 $0.85/hour\u3002\n\u3060\u3044\u305f\u3044\uff11\uff10\u5206\u304f\u3089\u3044\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u7d42\u308f\u3063\u3066\u305f\u304b\u306a\uff1f\uff1f\n\nClient\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n-------------------\n\nAmazon Linux\u3067\u3002\nredshift\u306ePostgresql\u306e\u8fd1\u3057\u3044Version\u306f\uff18\u3089\u3057\u3044\u306e\u3067\u3001\uff18\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5165\u308c\u308b\uff08\u305d\u308c\u3067\u826f\u3044\u306e\u304b\u306f\u3088\u304f\u77e5\u3089\u306a\u3044\uff09\u3002\n\n\tsudo yum install postgresql8-devel  \n\nredshift\u5074\u306eSecurityGroup\u3067 \u3053\u306e\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30de\u30b7\u30f3\u306eIP\u304b\u3089\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n\u305d\u306e\u5f8c\u3053\u3093\u306a\u611f\u3058\u3067\u63a5\u7d9a\u3067\u304d\u308b\n\n```\npsql -h *******.us-east-1.redshift.amazonaws.com -p 5439 -d mydb -U root     \n\u30e6\u30fc\u30b6 root \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:  ******************\npsql (8.4.13, \u30b5\u30fc\u30d0 8.0.2)\n\u6ce8\u610f\uff1a psql \u30d0\u30fc\u30b8\u30e7\u30f3 8.4, \u30b5\u30fc\u30d0\u30d0\u30fc\u30b8\u30e7\u30f3 8.0.\n         psql \u306e\u6a5f\u80fd\u306e\u4e2d\u3067\u3001\u52d5\u4f5c\u3057\u306a\u3044\u3082\u306e\u304c\u3042\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\nSSL \u63a5\u7d9a (\u6697\u53f7\u5316\u65b9\u5f0f: DHE-RSA-AES256-SHA, \u30d3\u30c3\u30c8\u9577: 256)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\t\nmydb=# \n```\n\n\u7c21\u5358\u306a\u30c7\u30fc\u30bf\u5165\u308c\u3066\u307f\u308b\n--------\n\n\u8a66\u3057\u306b\u3053\u3046\u3044\u3046\u30c7\u30fc\u30bf\u3092\u8003\u3048\u308b\n\n* id: int\n* type: varchar(32)\n* point: int\n* event_datetime: datetime  # UTC\n\n-\nSQL\u306e\u6587\u6cd5\u306f[\u3053\u306e\u8fba](http://docs.aws.amazon.com/redshift/latest/dg/c_SQL_commands.html)\u3092\u53c2\u7167\u3002\u898b\u6163\u308c\u306a\u3044\u30ad\u30fc\u30ef\u30fc\u30c9\u3082\u51fa\u3066\u304d\u3066\u3044\u307e\u3059\u306d\u3002\n\n\n```SQL\nCreate Table sample1 (\n  id BIGINT IDENTITY(1,1) PRIMARY KEY,\n  type VARCHAR(32) ENCODE TEXT255,\n  point INT,\n  event_datetime TIMESTAMP\n)\nDISTSTYLE EVEN\nSORTKEY (event_datetime);\n```\n\n* **DISTSTYLE**: \u306f\u5206\u6563\u306e\u30dd\u30ea\u30b7\u30fc\u3002*KEY* \u304b *EVEN* \u3067\u3042\u308b\u3002*EVEN* \u306fRoundRobin\u7684\u306b\u5206\u6563\u3055\u305b\u308b\u3002KEY\u306a\u3089\u5206\u6563\u306b\u4f7f\u3046\u5217\u3092\u6307\u5b9a\u3059\u308b\u3002\u307e\u3042\u3001\u4eca\u56de\u306f Single Node \u3060\u304b\u3089\u3042\u307e\u308a\u95a2\u4fc2\u306a\u3044\u3002\n* **SORTKEY**: \u306fRange\u3067\u691c\u7d22\u3059\u308b\u3068\u304d\u306b\u3088\u304f\u4f7f\u3046\u5217\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u3068\u826f\u3044\u3063\u307d\u3044\u3002\n\n\u3053\u306e\u8fba\u306e\u30c6\u30fc\u30d6\u30eb\u8a2d\u8a08\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u306f[\u3053\u306e\u8fba](http://docs.aws.amazon.com/redshift/latest/dg/t_Creating_tables.html)\u3092\u53c2\u7167\n\n* **IDENTITY**: AUTO_INCREMENT \u307f\u305f\u3044\u306a\u3082\u306e\u304b\u306a\u3002\n\n* **ENCODE** \u306f\u5217\u5727\u7e2e\u30aa\u30d7\u30b7\u30e7\u30f3\u3002\u540c\u69d8\u306e\u6587\u5b57\u5217\u304c\u51fa\u3066\u304f\u308b\u3088\u3046\u306a\u5834\u5408\u306f TEXT255 \u3068\u304b\u3092\u4f7f\u3046\u3063\u307d\u3044\u3002[\u5727\u7e2e\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u8a73\u7d30](http://docs.aws.amazon.com/redshift/latest/dg/c_Compression_encodings.html) \u306f\u3053\u3061\u3089\u3002\n\nInsert \u3068\u304b Select \u3068\u304b\n---\n\n\u666e\u901a\u306b Insert \u3067\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u308b\u3002\n\n```\nmydb=# insert into sample1(type, point, event_datetime) values('hoge', 10, '2013/5/10 10:10:00');\nINSERT 0 1\n```\n\nSelect \u3068\u304b\u3057\u3066\u307f\u308b\u3002\n\n```\nmydb=# select * from sample1 where event_datetime > '2013-5-2';\n id | type | point |   event_datetime    \n----+------+-------+---------------------\n  1 | hoge |    10 | 2013-05-10 10:10:00\n(1 \u884c)\n\nmydb=# select * from sample1 where event_datetime < '2013-5-2';\n id | type | point | event_datetime \n----+------+-------+----------------\n(0 \u884c)\n```\n\n\nS3\u304b\u3089\u30c7\u30fc\u30bf\u306eImport\n-----------\n\nS3\u306b\u30c7\u30fc\u30bf\u3092Upload\u3059\u308b\u305f\u3081\u306b s3cmd \u3092 Install\u3057\u3066\u304a\u304f\n\n\n```shell\nsudo yum -y --enablerepo epel install s3cmd \ns3cmd --configure\n# ACCESS_KEY \u3068\u304b SECRET \u3068\u304b\u3092\u5165\u529b\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u4f7f\u3046\u3063\u307d\u3044\u3002\n\n```\ns3cmd ls s3://BUCKET/  \ns3cmd put FILE FILE... s3://BUCKET/redshift/  \n```\n\n\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u304b\u304f\u3002\n\n```make_data.rb\n# coding: utf-8\n# make_data.rb\n\nnum = ARGV.shift.to_i\nDELI = \"\\001\"\n\t\nTYPES = [\"cat\", \"dog\", \"cow\", \"horse\"]\n\nnum.times do |i|\n  type = TYPES[i % TYPES.size]\n  point = Random.rand(10) + 1\n  dt = Time.now.utc\n  puts [type, point, dt].join(DELI)\nend\n```\n\n\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u3066\u3001S3\u306bUpload\u3059\u308b\u3002\n\n```\t\n\truby make_data.rb 20000 > 20000.data\n\tgzip 20000.data\n\ts3cmd put 20000.data.gz s3://BUCKET/redshift/sample1/  \n```\n\n\u30c7\u30fc\u30bf\u3092COPY\u3067\u53d6\u308a\u8fbc\u3093\u3067\u307f\u308b\u3002\n\n```psql\nCOPY sample1\nFROM 's3://BUCKET/redshift/sample1/20000.data.gz'\nGZIP\nDELIMITER '\\001'\nCREDENTIALS 'aws_access_key_id=***********;aws_secret_access_key=************'\n;\nERROR:  S3ServiceException:The bucket you are attempting to access must be addressed using the specified endpoint. Please send all future requests to this endpoint.,StatusCode 301,ErrorCode PermanentRedirect,RequestId EC14D5D1453E517A,ExtendedRequestId QjHhcX8gv0D\nDETAIL:\n...\n```\n\n\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u3002\n\n\u305d\u3046\u3044\u3048\u3070\u3001\u305d\u306eBucket\u306f\u6771\u4eacRegion\u306e\u3082\u306e\u3060\u3063\u305f\u306e\u3067\u3001US Standard\u306b\u5225\u306bBucket\u3092\u4f5c\u308a\u76f4\u3059\n(COPY\u30b3\u30de\u30f3\u30c9\u3067S3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u3080\u3068\u304d\u306f\u540c\u4e00\u30ea\u30fc\u30b8\u30e7\u30f3\u3067\u306a\u3044\u3068\u3044\u3051\u306a\u3044\uff09\n\n> Important: The Amazon S3 bucket that holds the data files must be created in the same region as your cluster.\n\n\n\u518d\u5ea6\u30c7\u30fc\u30bf\u3092Upload\u3057\u76f4\u3057\u3066\u3001COPY\u3092\u518d\u5b9f\u884c\u3059\u308b\u3068\u4eca\u5ea6\u306f\u6210\u529f\u3002\u3044\u304f\u3064\u304b select \u3092\u8a66\u3059\u3002\n\n```psql\nmydb=# select count(*) from sample1;\n count\n-------\n 20001\n(1 \u884c)\n\nmydb=# select * from sample1 limit 4;\n id |  type  | point |   event_datetime\n----+--------+-------+---------------------\n  1 | hoge   |    10 | 2013-05-10 10:10:00\n  4 | dog    |     9 | 2013-05-10 06:20:32\n  8 | horse  |     4 | 2013-05-10 06:20:32\n 12 | dog    |     4 | 2013-05-10 06:20:32\n(4 \u884c)\n\n\nmydb=# select type, count(*), sum(point) from sample1 group by type;\n  type  | count |  sum  \n--------+-------+-------\n hoge   |     1 |    10\n hourse |  5000 | 27270\n cat    |  5000 | 27386\n cow    |  5000 | 27529\n dog    |  5000 | 27501\n(5 \u884c)\n```\n\n3~4\u79d2\u3082\u3057\u306a\u3044\u3046\u3061\u306b\u7d50\u679c\u304c\u623b\u3063\u3066\u304f\u308b\u3002\n\u5168\u304f\u540c\u3058Query\uff08Limit\u3092\u5909\u5316\u3055\u305b\u305f\u7a0b\u5ea6\u3067\u306f\u540c\u3058\u3001\u3088\u3046\u306a\u6271\u3044\uff09\u3092\u6295\u3052\u308b\u3068\u76f4\u5f8c\u306b\u623b\u3063\u3066\u304f\u308b\u3002\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u306e\u304b\u306a\u3002\n", "tags": ["redshift"]}