{"context": "\n\n\u73fe\u8c61\n\u3053\u3093\u306a\u611f\u3058\u3067\u4f5c\u3063\u3066\u3044\u305f\u3089\u3001create\u3060\u3051invalid\u306b\u306a\u308b\u3002\nupdate\u306fOK\u3002\u4f55\u6545\u3060\uff1f\uff1f\n\nModel\n\napp/model/product.rb\nclass Product < ApplicationRecord\n  has_one :image\n  accepts_nested_attributes_for :image,\n                                allow_destroy: true\nend\n\n\n\napp/model/image.rb\nclass Image < ApplicationRecord\n  belongs_to :product\nend\n\n\n\nController\n\napp/controller/products_controller.rb\n  def new\n    @product = Product.new\n  end\n\n  def create\n    @product = Product.new(product_params)\n\n    respond_to do |format|\n      # \u3053\u3053\u3067save\u304c\u5fc5\u305a\u5931\u6557\u3059\u308b\n      if @product.save\n        format.html { redirect_to @product, notice: '\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3057\u305f' }\n        format.json { render :show, status: :created, location: @product }\n      else\n        format.html { render :new }\n        format.json { render json: @product.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n\n\n\nView\n  <%= f.fields_for :image, @product.image || @product.build_image do |image| %>\n    <%= f.file_field :path %>\n  <% end %>\n\n\n\u539f\u56e0\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u591a\u5206\u3053\u308c\u306e\u305b\u3044\u3058\u3083\u306a\u3044\u304b\u306a\u30fc\u3068\u3002\nbelongs_to should default to required: true\n\u4e0a\u8a18\u306e\u4f8b\u3067\u8a00\u3046\u3068\n\u2460Product\u306fImage\u304c\u7121\u3044\u3068invalid\u306b\u306a\u308a\u3001\n\u2461Image\u306fProduct\u4fdd\u5b58\u5f8c\u3067\u306a\u3044\u3068\u89aa\u30ec\u30b3\u30fc\u30c9\u306eID\u304c\u6c7a\u307e\u3089\u306a\u3044\u306e\u3067\u4fdd\u5b58\u3067\u304d\u306a\u3044\u3002\n\n\u5bfe\u7b56\n\u4ee5\u4e0b\u306e\u69d8\u306b\u3057\u3066\u3001required\u3092\u89e3\u9664\u3057\u3066\u2460\u3092\u89e3\u6d88\u3059\u308c\u3070\u4fdd\u5b58\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\n\napp/model/image.rb\nclass Image < ApplicationRecord\n  belongs_to :product, optional: true\nend\n\n\n# \u73fe\u8c61\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u4f5c\u3063\u3066\u3044\u305f\u3089\u3001create\u3060\u3051invalid\u306b\u306a\u308b\u3002\nupdate\u306fOK\u3002\u4f55\u6545\u3060\uff1f\uff1f\n\n### Model\n\n```app/model/product.rb\nclass Product < ApplicationRecord\n  has_one :image\n  accepts_nested_attributes_for :image,\n                                allow_destroy: true\nend\n```\n\n```app/model/image.rb\nclass Image < ApplicationRecord\n  belongs_to :product\nend\n```\n\n### Controller\n\n``` app/controller/products_controller.rb\n  def new\n    @product = Product.new\n  end\n\n  def create\n    @product = Product.new(product_params)\n\n    respond_to do |format|\n      # \u3053\u3053\u3067save\u304c\u5fc5\u305a\u5931\u6557\u3059\u308b\n      if @product.save\n        format.html { redirect_to @product, notice: '\u65b0\u898f\u4f5c\u6210\u3057\u307e\u3057\u305f' }\n        format.json { render :show, status: :created, location: @product }\n      else\n        format.html { render :new }\n        format.json { render json: @product.errors, status: :unprocessable_entity }\n      end\n    end\n  end\n```\n\n### View\n\n```\n  <%= f.fields_for :image, @product.image || @product.build_image do |image| %>\n    <%= f.file_field :path %>\n  <% end %>\n```\n\n# \u539f\u56e0\n\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u591a\u5206\u3053\u308c\u306e\u305b\u3044\u3058\u3083\u306a\u3044\u304b\u306a\u30fc\u3068\u3002\n[belongs_to should default to required: true](https://github.com/rails/rails/issues/18233)\n\n\u4e0a\u8a18\u306e\u4f8b\u3067\u8a00\u3046\u3068\n\u2460Product\u306fImage\u304c\u7121\u3044\u3068invalid\u306b\u306a\u308a\u3001\n\u2461Image\u306fProduct\u4fdd\u5b58\u5f8c\u3067\u306a\u3044\u3068\u89aa\u30ec\u30b3\u30fc\u30c9\u306eID\u304c\u6c7a\u307e\u3089\u306a\u3044\u306e\u3067\u4fdd\u5b58\u3067\u304d\u306a\u3044\u3002\n\n\n\n# \u5bfe\u7b56\n\n\u4ee5\u4e0b\u306e\u69d8\u306b\u3057\u3066\u3001required\u3092\u89e3\u9664\u3057\u3066\u2460\u3092\u89e3\u6d88\u3059\u308c\u3070\u4fdd\u5b58\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\n\n```app/model/image.rb\nclass Image < ApplicationRecord\n  belongs_to :product, optional: true\nend\n```\n", "tags": ["Rails5"]}