{"context": " More than 1 year has passed since last update.CoreOS \u3067\u306f NTP \u304c\u5229\u7528\u3055\u308c\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30de\u30b7\u30f3\u5168\u4f53\u3067\u6642\u523b\u304c\u540c\u671f\u3055\u308c\u308b\u3002\n\nNTP \u306e\u8a2d\u5b9a\n\nntpd \u306e\u72b6\u614b\u78ba\u8a8d\n$ systemctl status ntpd\n\n\nNTP \u30b5\u30fc\u30d0\u306e\u5909\u66f4\n\n\u76f4\u63a5\u5909\u66f4\u3059\u308b\nNTP \u30b5\u30fc\u30d0\u306e\u5909\u66f4\u306f /etc/ntp.conf \u3092\u7de8\u96c6\u3059\u308b\u3002\u3057\u304b\u3057\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068 /etc/ntp.conf \u306f /usr/share/ntp/ntp.conf \u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7de8\u96c6\u304c\u3067\u304d\u306a\u3044\u3002\ncore@core-01 ~ $ ls -l /etc/ntp.conf\nlrwxrwxrwx 1 root root 23 Aug 29 08:20 /etc/ntp.conf -> /usr/share/ntp/ntp.conf\n\n\u4e00\u65e6 /etc/ntp.conf \u3092\u6d88\u3057\u3066\u3057\u307e\u3063\u3066\u518d\u5ea6\u4f5c\u6210\u3059\u308b\ncore@core-01 ~ $ sudo rm /etc/ntp.conf\ncore@core-01 ~ $ sudo vi /etc/ntp.conf\n\n/etc/ntp.conf\n# Common pool\nntp.nict.jp\nntp.jst.mfeed.ad.jp\n\n# Warning: Using default NTP settings will leave your NTP\n# server accessible to all hosts on the Internet.\n\n# If you want to deny all machines (including your own)\n# from accessing the NTP server, uncomment:\n#restrict default ignore\n\n# Default configuration:\n# - Allow only time queries, at a limited rate, sending KoD when in excess.\n# - Allow all local queries (IPv4, IPv6)\nrestrict default nomodify nopeer noquery limited kod\nrestrict 127.0.0.1\nrestrict [::1]\n\ncore@core-01 ~ $ sudo systemctl restart ntpd\n\nNTP \u3092\u6709\u52b9\u306b\u3059\u308b\ncore@core-01 ~ $ sudo timedatectl set-ntp true\ncore@core-01 ~ $ timedatectl\n      Local time: Tue 2014-09-02 22:25:55 JST\n  Universal time: Tue 2014-09-02 13:25:55 UTC\n        RTC time: Tue 2014-09-02 13:25:51\n       Time zone: Asia/Tokyo (JST, +0900)\n     NTP enabled: yes # -> yes \u306b\u306a\u308b\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n\n\ncloud-config \u7d4c\u7531\u3067\u8a2d\u5b9a\u3059\u308b\n#cloud-config\n\ncoreos:\n  ...\nwrite_files:\n  - path: /etc/ntp.conf\n    content: |\n      # Common pool\n      server 0.pool.ntp.org\n      server 1.pool.ntp.org\n\n      # - Allow only time queries, at a limited rate.\n      # - Allow all local queries (IPv4, IPv6)\n      restrict default nomodify nopeer noquery limited kod\n      restrict 127.0.0.1\n      restrict [::1]\n\n\nCoreOS \u306e\u63a8\u5968\u8a2d\u5b9a\n\u3088\u307b\u3069\u9ad8\u3044\u53ef\u7528\u6027\u3092\u6c42\u3081\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u306a\u3051\u308c\u3070 CoreOS \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e ntp.org \u306e\u30b5\u30fc\u30d0\u7fa4\u3092\u4f7f\u3046\u3053\u3068\u3092\u63a8\u5968\u3057\u3066\u3044\u308b\nserver 0.pool.ntp.org\nserver 1.pool.ntp.org\nserver 2.pool.ntp.org\nserver 3.pool.ntp.org\n\n\n\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\n\n\u73fe\u5728\u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u78ba\u8a8d\u3059\u308b\ncore@core-01 ~ $ timedatectl status\n      Local time: Tue 2014-09-02 13:18:39 UTC\n  Universal time: Tue 2014-09-02 13:18:39 UTC\n        RTC time: Tue 2014-09-02 13:18:32\n       Time zone: n/a (UTC, +0000)\n     NTP enabled: no\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n\n\n\u30b3\u30de\u30f3\u30c9\u304b\u3089\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u5909\u66f4\u3059\u308b\ncore@core-01 ~ $ timedatectl list-timezones | grep Tokyo\nAsia/Tokyo\ncore@core-01 ~ $ sudo timedatectl set-timezone Asia/Tokyo\ncore@core-01 ~ $ timedatectl status\n      Local time: Tue 2014-09-02 22:22:50 JST\n  Universal time: Tue 2014-09-02 13:22:50 UTC\n        RTC time: Tue 2014-09-02 13:22:48\n       Time zone: Asia/Tokyo (JST, +0900)\n     NTP enabled: no\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\ncore@core-01 ~ $ date\nTue Sep  2 22:23:56 JST 2014\n\n\ncloud-config \u304b\u3089\u8a2d\u5b9a\u3059\u308b\n#cloud-config\n\ncoreos:\n  units:\n    - name: settimezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=Set the timezone\n\n        [Service]\n        ExecStart=/usr/bin/timedatectl set-timezone UTC\n        RemainAfterExit=yes\n        Type=oneshot\n\n\nCoreOS \u306e\u63a8\u5968\u8a2d\u5b9a\nUTC \u3092\u4f7f\u3046\u306e\u304c\u63a8\u5968\n$ sudo timedatectl set-timezone UTC\n\n\n\u30e1\u30e2\u3068\u611f\u60f3\n\nUTC \u63a8\u5968\u3068\u3042\u308b\u3051\u3069\u3044\u307e\u3044\u3061\u7406\u7531\u304c\u3061\u3083\u3093\u3068\u308f\u304b\u3063\u3066\u306a\u3044\ncloud-config \u306e yml \u30df\u30b9\u308b\u3068\u8a2d\u5b9a\u307e\u308b\u3063\u3068\u5168\u90e8\u52b9\u3044\u3066\u306a\u3044\u3053\u3068\u306b\u306a\u308b\n\nwrite_files \u306e /etc/ntp.conf \u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u30df\u30b9\u3063\u305f\u3089\u3001etcd discovery \u3082\u3001 timezone \u306e\u8a2d\u5b9a\u3082\u4f55\u3082\u53cd\u6620\u3055\u308c\u3066\u306a\u304b\u3063\u305f\u3002\n\nREF\n\nConfiguring Date and Timezone\n\n\nCoreOS \u3067\u306f NTP \u304c\u5229\u7528\u3055\u308c\u3001\u30af\u30e9\u30b9\u30bf\u5185\u306e\u30de\u30b7\u30f3\u5168\u4f53\u3067\u6642\u523b\u304c\u540c\u671f\u3055\u308c\u308b\u3002\n\n## NTP \u306e\u8a2d\u5b9a\n### ntpd \u306e\u72b6\u614b\u78ba\u8a8d\n\n```bash\n$ systemctl status ntpd\n```\n\n### NTP \u30b5\u30fc\u30d0\u306e\u5909\u66f4\n#### \u76f4\u63a5\u5909\u66f4\u3059\u308b\nNTP \u30b5\u30fc\u30d0\u306e\u5909\u66f4\u306f `/etc/ntp.conf` \u3092\u7de8\u96c6\u3059\u308b\u3002\u3057\u304b\u3057\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068 `/etc/ntp.conf` \u306f `/usr/share/ntp/ntp.conf` \u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u7de8\u96c6\u304c\u3067\u304d\u306a\u3044\u3002\n\n```bash\ncore@core-01 ~ $ ls -l /etc/ntp.conf\nlrwxrwxrwx 1 root root 23 Aug 29 08:20 /etc/ntp.conf -> /usr/share/ntp/ntp.conf\n```\n\n\u4e00\u65e6 `/etc/ntp.conf` \u3092\u6d88\u3057\u3066\u3057\u307e\u3063\u3066\u518d\u5ea6\u4f5c\u6210\u3059\u308b\n\n```bash\ncore@core-01 ~ $ sudo rm /etc/ntp.conf\ncore@core-01 ~ $ sudo vi /etc/ntp.conf\n```\n\n`/etc/ntp.conf`\n\n```\n# Common pool\nntp.nict.jp\nntp.jst.mfeed.ad.jp\n\n# Warning: Using default NTP settings will leave your NTP\n# server accessible to all hosts on the Internet.\n\n# If you want to deny all machines (including your own)\n# from accessing the NTP server, uncomment:\n#restrict default ignore\n\n# Default configuration:\n# - Allow only time queries, at a limited rate, sending KoD when in excess.\n# - Allow all local queries (IPv4, IPv6)\nrestrict default nomodify nopeer noquery limited kod\nrestrict 127.0.0.1\nrestrict [::1]\n```\n\n```bash\ncore@core-01 ~ $ sudo systemctl restart ntpd\n```\n\nNTP \u3092\u6709\u52b9\u306b\u3059\u308b\n\n```bash\ncore@core-01 ~ $ sudo timedatectl set-ntp true\ncore@core-01 ~ $ timedatectl\n      Local time: Tue 2014-09-02 22:25:55 JST\n  Universal time: Tue 2014-09-02 13:25:55 UTC\n        RTC time: Tue 2014-09-02 13:25:51\n       Time zone: Asia/Tokyo (JST, +0900)\n     NTP enabled: yes # -> yes \u306b\u306a\u308b\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n```\n\n\n#### cloud-config \u7d4c\u7531\u3067\u8a2d\u5b9a\u3059\u308b\n\n```yaml\n#cloud-config\n\ncoreos:\n  ...\nwrite_files:\n  - path: /etc/ntp.conf\n    content: |\n      # Common pool\n      server 0.pool.ntp.org\n      server 1.pool.ntp.org\n\n      # - Allow only time queries, at a limited rate.\n      # - Allow all local queries (IPv4, IPv6)\n      restrict default nomodify nopeer noquery limited kod\n      restrict 127.0.0.1\n      restrict [::1]\n```\n\n### CoreOS \u306e\u63a8\u5968\u8a2d\u5b9a\n\u3088\u307b\u3069\u9ad8\u3044\u53ef\u7528\u6027\u3092\u6c42\u3081\u3089\u308c\u3066\u3044\u308b\u306e\u3067\u306a\u3051\u308c\u3070 CoreOS \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306e ntp.org \u306e\u30b5\u30fc\u30d0\u7fa4\u3092\u4f7f\u3046\u3053\u3068\u3092\u63a8\u5968\u3057\u3066\u3044\u308b\n\n```\nserver 0.pool.ntp.org\nserver 1.pool.ntp.org\nserver 2.pool.ntp.org\nserver 3.pool.ntp.org\n```\n\n## \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u306e\u8a2d\u5b9a\n### \u73fe\u5728\u306e\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u78ba\u8a8d\u3059\u308b\n\n```bash\ncore@core-01 ~ $ timedatectl status\n      Local time: Tue 2014-09-02 13:18:39 UTC\n  Universal time: Tue 2014-09-02 13:18:39 UTC\n        RTC time: Tue 2014-09-02 13:18:32\n       Time zone: n/a (UTC, +0000)\n     NTP enabled: no\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\n```\n\n### \u30b3\u30de\u30f3\u30c9\u304b\u3089\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u3092\u5909\u66f4\u3059\u308b\n\n```\ncore@core-01 ~ $ timedatectl list-timezones | grep Tokyo\nAsia/Tokyo\ncore@core-01 ~ $ sudo timedatectl set-timezone Asia/Tokyo\ncore@core-01 ~ $ timedatectl status\n      Local time: Tue 2014-09-02 22:22:50 JST\n  Universal time: Tue 2014-09-02 13:22:50 UTC\n        RTC time: Tue 2014-09-02 13:22:48\n       Time zone: Asia/Tokyo (JST, +0900)\n     NTP enabled: no\nNTP synchronized: yes\n RTC in local TZ: no\n      DST active: n/a\ncore@core-01 ~ $ date\nTue Sep  2 22:23:56 JST 2014\n```\n\n### cloud-config \u304b\u3089\u8a2d\u5b9a\u3059\u308b\n\n```yaml\n#cloud-config\n\ncoreos:\n  units:\n    - name: settimezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=Set the timezone\n\n        [Service]\n        ExecStart=/usr/bin/timedatectl set-timezone UTC\n        RemainAfterExit=yes\n        Type=oneshot\n```\n\n### CoreOS \u306e\u63a8\u5968\u8a2d\u5b9a\nUTC \u3092\u4f7f\u3046\u306e\u304c\u63a8\u5968\n\n```bash\n$ sudo timedatectl set-timezone UTC\n```\n\n## \u30e1\u30e2\u3068\u611f\u60f3\n\n* UTC \u63a8\u5968\u3068\u3042\u308b\u3051\u3069\u3044\u307e\u3044\u3061\u7406\u7531\u304c\u3061\u3083\u3093\u3068\u308f\u304b\u3063\u3066\u306a\u3044\n\n* cloud-config \u306e yml \u30df\u30b9\u308b\u3068\u8a2d\u5b9a\u307e\u308b\u3063\u3068\u5168\u90e8\u52b9\u3044\u3066\u306a\u3044\u3053\u3068\u306b\u306a\u308b\n\n`write_files` \u306e `/etc/ntp.conf` \u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u30df\u30b9\u3063\u305f\u3089\u3001etcd discovery \u3082\u3001 timezone \u306e\u8a2d\u5b9a\u3082\u4f55\u3082\u53cd\u6620\u3055\u308c\u3066\u306a\u304b\u3063\u305f\u3002\n\n## REF\n\n* [Configuring Date and Timezone](https://coreos.com/docs/cluster-management/setup/configuring-date-and-timezone/)\n", "tags": ["ntp", "CoreOS"]}