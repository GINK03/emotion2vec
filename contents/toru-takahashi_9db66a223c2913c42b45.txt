{"context": " More than 1 year has passed since last update.\n\nRank\u4ed8\u3051\nRANK\u95a2\u6570\u3067\u9806\u5e8f\u3092\u3064\u3051\u308b\u3068\u304d\u306e\u9806\u5e8f\u306e\u4ed8\u3051\u65b9\u3063\u3066\u4f55\u304c\u30d9\u30b9\u30c8\u306a\u306e\u304b\u3001\u306b\u3064\u3044\u3066\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u3002\nRANK\u4ed8\u3051\u306b\u306f\uff12\u7a2e\u985e\u304c\u6709\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n1. \u540c\u4e00\u306e\u5024\u306e\u5834\u5408\u306b\u306f\u3001\u540c\u3058\u756a\u53f7\u3092\u4ed8\u4e0e\u3059\u308b\n2. \u540c\u4e00\u306e\u5024\u306e\u5834\u5408\u306b\u306f\u3001\u5225\u306e\u756a\u53f7\u3092\u4ed8\u4e0e\u3059\u308b\n1\u306e\u4f8b(user_id\u3068\u30a2\u30af\u30bb\u30b9\u6642\u9593\u3067Rank):\n\n\n\nnumber\nuser_id\ndate\n\n\n\n\n1\nuserA\n2014-01-01\n\n\n2\nuserA\n2014-01-02\n\n\n2\nuserA\n2014-01-02\n\n\n4\nuserB\n2014-01-01\n\n\n\n2\u306e\u4f8b(user_id\u3068\u30a2\u30af\u30bb\u30b9\u6642\u9593\u3067Rank):\n\n\n\nnumber\nuser_id\ndate\n\n\n\n\n1\nuserA\n2014-01-01\n\n\n2\nuserA\n2014-01-02\n\n\n3\nuserA\n2014-01-02\n\n\n4\nuserB\n2014-01-01\n\n\n\n\n\u306a\u305c\u6c17\u306b\u306a\u3063\u305f\u306e\u304b\nTreasureData\u306b\u306f\u3001TD_X_RANK\u3068\u3044\u3046\u72ec\u81eaUDF\u306eRANK\u95a2\u6570\u304c\u3067\u306f\u30012\u3092\u63a1\u7528\u3057\u3066\u3044\u308b\u304c\u3001\nPresto\u306eRANK\u95a2\u6570\u3067\u306f1\u3092\u63a1\u7528\u3057\u3066\u304a\u308a\u3001\u4e00\u822c\u7684\u306b\u3069\u3061\u3089\u304c\u597d\u307e\u308c\u308b\u306e\u304b\u306a\uff1f\u3068\u7591\u554f\u306b\u601d\u3063\u305f\u305f\u3081\u3002\n\nTreasureData\u306eTD_X_RANK\u3092\u8a66\u3057\u3066\u307f\u308b\nhttp://docs.treasuredata.com/articles/udfs#tdxrank\nSELECT \n  TD_X_RANK(USER) AS rank,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM (\n    SELECT \n      USER,\n      time\n    FROM\n      www_access\n    CLUSTER BY USER, time\n  ) t\n\n\n\nPresto\u306eRANK\u3092\u8a66\u3057\u3066\u307f\u308b\nhttp://prestodb.io/docs/current/functions/window.html\nSELECT \n  RANK(\n  ) OVER(\n    PARTITION BY USER\n  ORDER BY\n    time\n  ) AS rnk,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM\n  www_access\nORDER BY\n  USER,\n  rnk\n\n\n\n\u304a\u308f\u308a\u306b\n\u66f8\u3044\u3066\u3066\u304a\u3082\u3063\u305f\u306e\u3067\u3059\u304c\u3001TD_X_RANK\u306f\u3001Presto\u306erow_number\u95a2\u6570\u3068\u540c\u3058\u3060\u3068\u601d\u3048\u3070\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u306d\u3002\n\u306a\u308b\u307b\u3069\u306a\u308b\u307b\u3069\u3002\n\nPresto\u306eROW_NUMBER\u3092\u8a66\u3057\u3066\u307f\u308b\nSELECT \n  ROW_NUMBER(\n  ) OVER(\n    PARTITION BY USER\n  ORDER BY\n    time\n  ) AS rnk,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM\n  www_access\nORDER BY\n  USER,\n  rnk\n\n\n\n\u304a\u308f\u308a\u306bpart.2\nHive\u3067row_number\u304c\u306a\u304b\u3063\u305f\u3063\u3051\uff1f\u3068\u304a\u3082\u3063\u305f\u3089\u30010.11\u4ee5\u4e0a\u304b\u3089\u3067\u3057\u305f\u3002\n\u306a\u308b\u307b\u3069\u306a\u308b\u307b\u3069\u3002\n# Rank\u4ed8\u3051\nRANK\u95a2\u6570\u3067\u9806\u5e8f\u3092\u3064\u3051\u308b\u3068\u304d\u306e\u9806\u5e8f\u306e\u4ed8\u3051\u65b9\u3063\u3066\u4f55\u304c\u30d9\u30b9\u30c8\u306a\u306e\u304b\u3001\u306b\u3064\u3044\u3066\u6c17\u306b\u306a\u3063\u305f\u306e\u3067\u3002\nRANK\u4ed8\u3051\u306b\u306f\uff12\u7a2e\u985e\u304c\u6709\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n1. \u540c\u4e00\u306e\u5024\u306e\u5834\u5408\u306b\u306f\u3001\u540c\u3058\u756a\u53f7\u3092\u4ed8\u4e0e\u3059\u308b\n2. \u540c\u4e00\u306e\u5024\u306e\u5834\u5408\u306b\u306f\u3001\u5225\u306e\u756a\u53f7\u3092\u4ed8\u4e0e\u3059\u308b\n\n1\u306e\u4f8b(user_id\u3068\u30a2\u30af\u30bb\u30b9\u6642\u9593\u3067Rank):\n\n| number | user_id | date         |\n|-------:|--------:|-------------:|\n| 1      | userA   | 2014-01-01   |\n| 2      | userA   | 2014-01-02   |\n| 2      | userA   | 2014-01-02   |\n| 4      | userB   | 2014-01-01   |\n\n2\u306e\u4f8b(user_id\u3068\u30a2\u30af\u30bb\u30b9\u6642\u9593\u3067Rank):\n\n| number | user_id | date         |\n|-------:|--------:|-------------:|\n| 1      | userA   | 2014-01-01   |\n| 2      | userA   | 2014-01-02   |\n| 3      | userA   | 2014-01-02   |\n| 4      | userB   | 2014-01-01   |\n\n# \u306a\u305c\u6c17\u306b\u306a\u3063\u305f\u306e\u304b\nTreasureData\u306b\u306f\u3001TD_X_RANK\u3068\u3044\u3046\u72ec\u81eaUDF\u306eRANK\u95a2\u6570\u304c\u3067\u306f\u30012\u3092\u63a1\u7528\u3057\u3066\u3044\u308b\u304c\u3001\nPresto\u306eRANK\u95a2\u6570\u3067\u306f1\u3092\u63a1\u7528\u3057\u3066\u304a\u308a\u3001\u4e00\u822c\u7684\u306b\u3069\u3061\u3089\u304c\u597d\u307e\u308c\u308b\u306e\u304b\u306a\uff1f\u3068\u7591\u554f\u306b\u601d\u3063\u305f\u305f\u3081\u3002\n\n# TreasureData\u306eTD_X_RANK\u3092\u8a66\u3057\u3066\u307f\u308b\nhttp://docs.treasuredata.com/articles/udfs#tdxrank\n\n```sql\nSELECT \n  TD_X_RANK(USER) AS rank,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM (\n    SELECT \n      USER,\n      time\n    FROM\n      www_access\n    CLUSTER BY USER, time\n  ) t\n```\n![hive.png](https://qiita-image-store.s3.amazonaws.com/0/34543/cdfc3789-3146-7919-9a64-641ad6b38f50.png)\n\n\n\n# Presto\u306eRANK\u3092\u8a66\u3057\u3066\u307f\u308b\nhttp://prestodb.io/docs/current/functions/window.html\n\n```\nSELECT \n  RANK(\n  ) OVER(\n    PARTITION BY USER\n  ORDER BY\n    time\n  ) AS rnk,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM\n  www_access\nORDER BY\n  USER,\n  rnk\n```\n\n![presto.png](https://qiita-image-store.s3.amazonaws.com/0/34543/bc6af8b3-9659-0142-dbea-d17b9d4b0ad5.png)\n\n\n# \u304a\u308f\u308a\u306b\n\u66f8\u3044\u3066\u3066\u304a\u3082\u3063\u305f\u306e\u3067\u3059\u304c\u3001TD_X_RANK\u306f\u3001Presto\u306erow_number\u95a2\u6570\u3068\u540c\u3058\u3060\u3068\u601d\u3048\u3070\u3088\u304b\u3063\u305f\u306e\u3067\u3059\u306d\u3002\n\u306a\u308b\u307b\u3069\u306a\u308b\u307b\u3069\u3002\n\n# Presto\u306eROW_NUMBER\u3092\u8a66\u3057\u3066\u307f\u308b\n```sql\nSELECT \n  ROW_NUMBER(\n  ) OVER(\n    PARTITION BY USER\n  ORDER BY\n    time\n  ) AS rnk,\n  USER,\n  TD_TIME_FORMAT(time,\n    'yyyy-MM-dd HH:mm:ss',\n    'JST') AS time\nFROM\n  www_access\nORDER BY\n  USER,\n  rnk\n```\n![row_number.png](https://qiita-image-store.s3.amazonaws.com/0/34543/dc3a2794-9605-8db4-91c8-4e71a335fad1.png)\n\n\n# \u304a\u308f\u308a\u306bpart.2\nHive\u3067row_number\u304c\u306a\u304b\u3063\u305f\u3063\u3051\uff1f\u3068\u304a\u3082\u3063\u305f\u3089\u30010.11\u4ee5\u4e0a\u304b\u3089\u3067\u3057\u305f\u3002\n\u306a\u308b\u307b\u3069\u306a\u308b\u307b\u3069\u3002\n", "tags": ["TreasureData", "Presto"]}