{"context": "[\u901f\u5831]Amazon Linux AMI 2016.09 \u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\uff01\nPHP7.0\u304c\u5165\u3063\u3066Nginx 1.10\u306b\u306a\u3063\u305f\u3002\n\u3088\u3063\u3066\u4ee5\u524d\u66f8\u3044\u305f\u30a8\u30f3\u30c8\u30ea\u306f\u4f7f\u3044\u7269\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u6539\u3081\u3066\u66f8\u304d\u76f4\u3059\u3002\n\u305d\u306e\u5206\u3044\u308d\u3044\u308d\u624b\u9593\u304c\u7701\u3051\u3066\u697d\u306b\u306a\u3063\u305f\u3067\u3044\u3044\u3051\u3069\u3002\nsudo\u7565\u3002\n\nAWS\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3089\u901f\u653b\u3067\u3084\u3063\u3066\u304a\u304f\u3079\u304d\u521d\u671f\u8a2d\u5b9a\u307e\u3068\u3081\n\nEC2(VPC)\n0\u304b\u3089\u59cb\u3081\u308bAWS\u5165\u9580\u2460\uff1aVPC\u7de8\n\n\u8a2d\u5b9a\n$ passwd ec2-user\n\n#\u30ed\u30fc\u30ab\u30eb\u30bf\u30a4\u30e0\u5909\u66f4\n$ cp -rp /etc/localtime /etc/localtime.org\n$ cp -rp /usr/share/zoneinfo/Japan /etc/localtime\n\n\n/etc/sysconfig/clock\n#yum update\u306a\u3069\u3067UTC\u306b\u3082\u3069\u308b\u306e\u3092\u9632\u3050\n-ZONE=\"UTC\"\n-UTC=true\n+ZONE=\"Asia/Tokyo\"\n+UTC=false\n\n\n\n/etc/sysconfig/i18n\n-LANG=en_US.UTF-8\n+LANG=ja_JP.UTF-8\n\n\n\nFTP\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y vsftpd\n$ cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.org\n\n\n\u8a2d\u5b9a\n\n/etc/vsftpd/vsftpd.conf\n+pasv_enable=YES\n+pasv_addr_resolve=YES\n+pasv_min_port=60001\n+pasv_max_port=60100\n\n\n#\u8d77\u52d5\n$ service vsftpd start\n$ chkconfig vsftpd on\n\n\nPHP7.0\n$ yum install -y php70 php70-fpm php70-gd php70-mbstring php70-mcrypt php70-mysqlnd php70-zip\n$ php -v\n# PHP 7.0.11 \n$ cp /etc/php-fpm-7.0.d/www.conf /etc/php-fpm-7.0.d/www.conf.org\n\n\n/etc/php-fpm-7.0.d/www.conf\n-user = apache\n+user = nginx\n-group = apache\n+group = nginx\n\n\n\n/etc/php-7.0.ini\n+date.timezone = \"Asia/Tokyo\"\n\n\n\nnginx\n$ yum install -y nginx\n$ nginx -v\n# nginx version: nginx/1.10.1\n$ cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org\n\n\n/etc/nginx/nginx.conf\n    server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  localhost;\n        root         /var/www/html;\n        index       index.php;\n\n        include /etc/nginx/default.d/*.conf;\n\n        location ~ \\.php$ {\n            fastcgi_pass 127.0.0.1:9000;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $fastcgi_script_name;\n            include fastcgi_params;\n        }\n    }\n\n\n$ chown -R nginx:nginx /var/lib/php/7.0/session\n$ chown -R nginx:nginx /var/www/html\n\n$ service nginx start\n$ service php-fpm-7.0 start\n\n$ chkconfig nginx on\n$ chkconfig php-fpm-7.0 on\n\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\n\n/var/www/html/phpinfo.php\n<?php echo phpinfo();?>\n\n\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u4e0a\u9650\n\u591a\u5206\u30c7\u30d5\u30a9\u30eb\u30c8\u30671M\u306a\u306e\u3067\u5897\u3084\u3059\n\n/etc/nginx/nginx.conf\n    server {\n        client_max_body_size 4M;\n    }\n\n\n\nGitHub\n\nGit\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u53d6\u308a\u6025\u304e\u30ac\u30d0\u30ac\u30d0\u306a\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u6ce8\u610f\u306d\n$ yum install -y git\n\n$ git config --global user.email \"[GitHub\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9]\"\n$ git config --global user.name \"[GitHub\u30e6\u30fc\u30b6\u30fc\u540d]\"\n\n# GitHub \u30af\u30ed\u30fc\u30f3\n$ cd /var/wwww/\n$ mv /var/www/html /var/www/_html\n$ git clone https://github.com/[path_to_git].git html\n#\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u5165\u529b\n\n# \u4ee5\u964d\u306f\u30d7\u30eb\u3067\n$ cd /var/www/html\n$ git pull origin master\n# \u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u5165\u529b\n# root\u306e\u5834\u5408\u306f/var/wwww/html\u6240\u6709\u8005\u3092\u90fd\u5ea6nginx\u306b\u3059\u308b\u306e\u304c\u826f\u3044\u3068\u601d\u308f\u308c\n\n\n\n\u3060\u304b\u3089FTP\u306f\u3044\u3089\u306a\u3044\u306d\u3002\n\nMySQL\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y mysql56 mysql56-server\n$ service mysqld start\n$ chkconfig mysqld on\n\n$ mysql -u root\n\n> SET PASSWORD FOR root@localhost=PASSWORD('root');\n\n$ service mysqld restart\n\n\nphpMyAdmin\n\u6700\u65b0\u7248\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ cd /var/www/\n$ wget https://files.phpmyadmin.net/phpMyAdmin/4.6.4/phpMyAdmin-4.6.4-all-languages.tar.gz\n$ tar zxvf phpMyAdmin-4.6.4-all-languages.tar.gz\n$ rm phpMyAdmin-4.6.4-all-languages.tar.gz\n$ mv phpMyAdmin-4.6.4-all-languages phpmyadmin\n$ cd /var/www/phpmyadmin/\n$ cp config.sample.inc.php config.inc.php\n\n\n\u8a2d\u5b9a\n\n/var/www/phpmyadmin/config.inc.php\n/* Authentication type */\n$cfg['Servers'][$i]['auth_type'] = 'http';//BASIC\u8a8d\u8a3c\n\n/* Server parameters */\n$cfg['Servers'][$i]['host'] = 'localhost';\n\n\n\n/etc/nginx/nginx.conf\nserver {\n        #For phpMyAdmin\n        location ^~ /phpmyadmin {\n                allow 0.0.0.0;#IP\u5236\u9650\n                deny all;\n\n                alias /var/www/phpmyadmin;\n                index index.php;\n\n                location ~ \\.php$  {\n                        fastcgi_pass    127.0.0.1:9000;\n                        fastcgi_index   index.php;\n                        fastcgi_split_path_info ^/phpmyadmin(.+\\.php)(.*)$;\n                        fastcgi_param   SCRIPT_FILENAME /var/www/phpmyadmin$fastcgi_script_name;\n                        include         /etc/nginx/fastcgi_params;\n                }\n        }\n}\n\n\n$ service nginx reload\n\n\nBASIC\u8a8d\u8a3c\n$ yum install -y httpd-tools\n$ cd /etc/nginx\n$ htpasswd -c .htpasswd [\u30e6\u30fc\u30b6\u30fc\u540d]\n\n\n/etc/nginx/nginx.conf\nserver {\n    location / {\n        auth_basic \"Restricted\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n}\n\n\n\nSSL\n\n/etc/nginx/nginx.conf\nserver {\n        listen       443 ssl;\n        listen       [::]:443 ssl;\n        server_name  localhost;\n        root         /var/www/html;\n        index        index.php;\n\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:60m;\n\n        include /etc/nginx/default.d/*.conf;\n}\n\n\n\nLet's Encrypt\n\u8272\u3005\u3042\u304c\u3044\u305f\u3051\u3069\nAmazon Linux\u3067Let's Encrypt\u306f\u3042\u304d\u3089\u3081\u308d\u3001\u3068\u3044\u3046\nAmazon\u69d8\u306e\u610f\u601d\u3092\u611f\u3058\u305f\u306e\u3067\u5f93\u3046\u3053\u3068\u306b\u3057\u305f\u3002\n\u3057\u3083\u30fc\u306a\u3044\u306e\u3067\u624b\u52d5\u66f4\u65b0\u3081\u3093\u3069\u304f\u3055\u3044\u3051\u3069 SSL\u30dc\u30c3\u30af\u30b9 \u3067Let's Encrypt\u767a\u884c\u3059\u308b\u3002\n\u8a3c\u660e\u66f8: server.pem\n\u4e2d\u9593\u8a3c\u660e\u66f8: chain.pem\n\u79d8\u5bc6\u9375: key.pem\n\u3068\u3059\u308b\u306a\u3089\u3070\n$ cat server.pem chain.pem > cert.pem\n\n\u3063\u3066\u3084\u3063\u3066\u4e2d\u9593\u8a3c\u660e\u66f8\u7d50\u5408\u3059\u308b\u3002\n\u4e2d\u9593\u8a3c\u660e\u66f8\u3044\u308c\u306a\u3044\u3068Chrome\u3068Firefox\u304c\u3046\u308b\u3055\u3044\u304b\u3089\u306d\u3002\n\n/etc/nginx/nginx.conf\nserver {\n    listen       443 ssl;\n\n    ssl_certificate /etc/nginx/ssl/cert.pem;\n    ssl_certificate_key /etc/nginx/ssl/key.pem;\n\n}\n\n\n\nhttp\u2192https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u5834\u5408\n\n/etc/nginx/nginx.conf\nserver {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  localhost;\n    return 301 https://$host$request_uri;\n}\n\n\n\nWordPress\n\u30db\u30fc\u30e0URL\u3001WordPressURL\u3092\u5909\u66f4\n\nsql\n$ UPDATE `wp_options` SET `option_value` = 'https://host' WHERE `wp_options`.`option_name` = 'siteurl' OR `wp_options`.`option_name` = 'home';\n\n\n\n/var/www/html/wp-config.php\n//\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\ndefine('FORCE_SSL_ADMIN', true);\n\nif ( isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === \"https\" ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n\n\n\nHSTS\n\n/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        #HTTPS\u306e\u307f\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u306e\u307f\n        add_header Strict-Transport-Security max-age=15768000;\n\n}\n\n\n\nPerfect Forward Security (PFS)\n$ cd /etc/nginx/ssl\n$ openssl dhparam 2048 -out dhparam.pem\n\n\n/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        ssl_dhparam /etc/nginx/ssl/dhparam.pem;\n\n}\n\n\n\nHTTP/2\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n}\n\n\n\nTLS/SSL\nSSLv1.0,SSLv2.0,SSLv3.0\u306f\u7121\u52b9\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n\n}\n\n\n\n\u6697\u53f7\u30b9\u30a4\u30fc\u30c8\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';\n\n}\n\n\n\nOCSP Stapling\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    resolver 8.8.8.8;\n\n}\n\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\nQualys SSL Report\n\n\u307e\u3042\u3084\u3063\u3066\u308b\u3053\u3068\u306f\u5909\u308f\u3089\u306a\u3044\u306e\u3067\u4eca\u56de\u3082\u3055\u3059\u304c\u306bA+\u3002\n[[\u901f\u5831]Amazon Linux AMI 2016.09 \u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\uff01](http://dev.classmethod.jp/cloud/amazon-linux-ami-2016-09/)\n\nPHP7.0\u304c\u5165\u3063\u3066Nginx 1.10\u306b\u306a\u3063\u305f\u3002\n\u3088\u3063\u3066\u4ee5\u524d\u66f8\u3044\u305f[\u30a8\u30f3\u30c8\u30ea](http://qiita.com/ki6ool/items/a9798792590fa2a5c9c8)\u306f\u4f7f\u3044\u7269\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u6539\u3081\u3066\u66f8\u304d\u76f4\u3059\u3002\n\u305d\u306e\u5206\u3044\u308d\u3044\u308d\u624b\u9593\u304c\u7701\u3051\u3066\u697d\u306b\u306a\u3063\u305f\u3067\u3044\u3044\u3051\u3069\u3002\n\n\nsudo\u7565\u3002\n\n# AWS\n\n#### \u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\n\n[AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3089\u901f\u653b\u3067\u3084\u3063\u3066\u304a\u304f\u3079\u304d\u521d\u671f\u8a2d\u5b9a\u307e\u3068\u3081](http://qiita.com/tmknom/items/303db2d1d928db720888)\n\n#### EC2(VPC)\n[0\u304b\u3089\u59cb\u3081\u308bAWS\u5165\u9580\u2460\uff1aVPC\u7de8](http://qiita.com/hiroshik1985/items/9de2dd02c9c2f6911f3b)\n\n##### \u8a2d\u5b9a\n\n```console\n$ passwd ec2-user\n\n#\u30ed\u30fc\u30ab\u30eb\u30bf\u30a4\u30e0\u5909\u66f4\n$ cp -rp /etc/localtime /etc/localtime.org\n$ cp -rp /usr/share/zoneinfo/Japan /etc/localtime\n```\n\n```diff:/etc/sysconfig/clock\n#yum update\u306a\u3069\u3067UTC\u306b\u3082\u3069\u308b\u306e\u3092\u9632\u3050\n-ZONE=\"UTC\"\n-UTC=true\n+ZONE=\"Asia/Tokyo\"\n+UTC=false\n```\n\n```diff:/etc/sysconfig/i18n\n-LANG=en_US.UTF-8\n+LANG=ja_JP.UTF-8\n```\n\n# FTP\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ yum install -y vsftpd\n$ cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.org\n```\n\n#### \u8a2d\u5b9a\n```diff:/etc/vsftpd/vsftpd.conf\n+pasv_enable=YES\n+pasv_addr_resolve=YES\n+pasv_min_port=60001\n+pasv_max_port=60100\n```\n\n```console\n#\u8d77\u52d5\n$ service vsftpd start\n$ chkconfig vsftpd on\n```\n\n# PHP7.0\n\n```console\n$ yum install -y php70 php70-fpm php70-gd php70-mbstring php70-mcrypt php70-mysqlnd php70-zip\n$ php -v\n# PHP 7.0.11 \n$ cp /etc/php-fpm-7.0.d/www.conf /etc/php-fpm-7.0.d/www.conf.org\n```\n\n```diff:/etc/php-fpm-7.0.d/www.conf\n-user = apache\n+user = nginx\n-group = apache\n+group = nginx\n```\n\n```diff:/etc/php-7.0.ini\n+date.timezone = \"Asia/Tokyo\"\n```\n\n# nginx\n\n```console\n$ yum install -y nginx\n$ nginx -v\n# nginx version: nginx/1.10.1\n$ cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org\n```\n\n```nginx:/etc/nginx/nginx.conf\n    server {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  localhost;\n        root         /var/www/html;\n        index       index.php;\n\n        include /etc/nginx/default.d/*.conf;\n\n        location ~ \\.php$ {\n            fastcgi_pass 127.0.0.1:9000;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $fastcgi_script_name;\n            include fastcgi_params;\n        }\n    }\n```\n\n```\n$ chown -R nginx:nginx /var/lib/php/7.0/session\n$ chown -R nginx:nginx /var/www/html\n```\n\n```\n$ service nginx start\n$ service php-fpm-7.0 start\n\n$ chkconfig nginx on\n$ chkconfig php-fpm-7.0 on\n```\n\n#### \u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\n```php:/var/www/html/phpinfo.php\n<?php echo phpinfo();?>\n```\n\n#### \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u4e0a\u9650\n\u591a\u5206\u30c7\u30d5\u30a9\u30eb\u30c8\u30671M\u306a\u306e\u3067\u5897\u3084\u3059\n\n\n```nginx:/etc/nginx/nginx.conf\n    server {\n        client_max_body_size 4M;\n    }\n```\n\n# GitHub\n\n#### Git\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u53d6\u308a\u6025\u304e\u30ac\u30d0\u30ac\u30d0\u306a\u306e\u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u6ce8\u610f\u306d\n\n```console\n$ yum install -y git\n\n$ git config --global user.email \"[GitHub\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9]\"\n$ git config --global user.name \"[GitHub\u30e6\u30fc\u30b6\u30fc\u540d]\"\n\n# GitHub \u30af\u30ed\u30fc\u30f3\n$ cd /var/wwww/\n$ mv /var/www/html /var/www/_html\n$ git clone https://github.com/[path_to_git].git html\n#\u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u5165\u529b\n\n# \u4ee5\u964d\u306f\u30d7\u30eb\u3067\n$ cd /var/www/html\n$ git pull origin master\n# \u30e6\u30fc\u30b6\u30fc\u540d\u3068\u30d1\u30b9\u5165\u529b\n# root\u306e\u5834\u5408\u306f/var/wwww/html\u6240\u6709\u8005\u3092\u90fd\u5ea6nginx\u306b\u3059\u308b\u306e\u304c\u826f\u3044\u3068\u601d\u308f\u308c\n\n\n```\n\n\u3060\u304b\u3089FTP\u306f\u3044\u3089\u306a\u3044\u306d\u3002\n\n# MySQL\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ yum install -y mysql56 mysql56-server\n$ service mysqld start\n$ chkconfig mysqld on\n\n$ mysql -u root\n```\n\n```mysql\n> SET PASSWORD FOR root@localhost=PASSWORD('root');\n```\n\n```console\n$ service mysqld restart\n```\n\n# phpMyAdmin\n[\u6700\u65b0\u7248](https://www.phpmyadmin.net/downloads/)\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ cd /var/www/\n$ wget https://files.phpmyadmin.net/phpMyAdmin/4.6.4/phpMyAdmin-4.6.4-all-languages.tar.gz\n$ tar zxvf phpMyAdmin-4.6.4-all-languages.tar.gz\n$ rm phpMyAdmin-4.6.4-all-languages.tar.gz\n$ mv phpMyAdmin-4.6.4-all-languages phpmyadmin\n$ cd /var/www/phpmyadmin/\n$ cp config.sample.inc.php config.inc.php\n```\n\n#### \u8a2d\u5b9a\n\n```php:/var/www/phpmyadmin/config.inc.php \n/* Authentication type */\n$cfg['Servers'][$i]['auth_type'] = 'http';//BASIC\u8a8d\u8a3c\n\n/* Server parameters */\n$cfg['Servers'][$i]['host'] = 'localhost';\n```\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        #For phpMyAdmin\n        location ^~ /phpmyadmin {\n                allow 0.0.0.0;#IP\u5236\u9650\n                deny all;\n\n                alias /var/www/phpmyadmin;\n                index index.php;\n\n                location ~ \\.php$  {\n                        fastcgi_pass    127.0.0.1:9000;\n                        fastcgi_index   index.php;\n                        fastcgi_split_path_info ^/phpmyadmin(.+\\.php)(.*)$;\n                        fastcgi_param   SCRIPT_FILENAME /var/www/phpmyadmin$fastcgi_script_name;\n                        include         /etc/nginx/fastcgi_params;\n                }\n        }\n}\n```\n\n```console\n$ service nginx reload\n```\n\n#### BASIC\u8a8d\u8a3c\n\n```console\n$ yum install -y httpd-tools\n$ cd /etc/nginx\n$ htpasswd -c .htpasswd [\u30e6\u30fc\u30b6\u30fc\u540d]\n```\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    location / {\n        auth_basic \"Restricted\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n}\n```\n\n# SSL\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen       443 ssl;\n        listen       [::]:443 ssl;\n        server_name  localhost;\n        root         /var/www/html;\n        index        index.php;\n\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:60m;\n\n        include /etc/nginx/default.d/*.conf;\n}\n```\n\n#### Let's Encrypt\n\n\u8272\u3005\u3042\u304c\u3044\u305f\u3051\u3069\nAmazon Linux\u3067Let's Encrypt\u306f\u3042\u304d\u3089\u3081\u308d\u3001\u3068\u3044\u3046\nAmazon\u69d8\u306e\u610f\u601d\u3092\u611f\u3058\u305f\u306e\u3067\u5f93\u3046\u3053\u3068\u306b\u3057\u305f\u3002\n\n\u3057\u3083\u30fc\u306a\u3044\u306e\u3067\u624b\u52d5\u66f4\u65b0\u3081\u3093\u3069\u304f\u3055\u3044\u3051\u3069 <a href=\"https://px.a8.net/svt/ejp?a8mat=1TQFPV+1L5PXU+1WTI+TVQUQ\" target=\"_blank\">SSL\u30dc\u30c3\u30af\u30b9</a><img border=\"0\" width=\"1\" height=\"1\" src=\"https://www12.a8.net/0.gif?a8mat=1TQFPV+1L5PXU+1WTI+TVQUQ\"> \u3067Let's Encrypt\u767a\u884c\u3059\u308b\u3002\n\n\u8a3c\u660e\u66f8: server.pem\n\u4e2d\u9593\u8a3c\u660e\u66f8: chain.pem\n\u79d8\u5bc6\u9375: key.pem\n\u3068\u3059\u308b\u306a\u3089\u3070\n\n```console\n$ cat server.pem chain.pem > cert.pem\n```\n\n\u3063\u3066\u3084\u3063\u3066\u4e2d\u9593\u8a3c\u660e\u66f8\u7d50\u5408\u3059\u308b\u3002\n\u4e2d\u9593\u8a3c\u660e\u66f8\u3044\u308c\u306a\u3044\u3068Chrome\u3068Firefox\u304c\u3046\u308b\u3055\u3044\u304b\u3089\u306d\u3002\n\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen       443 ssl;\n\n    ssl_certificate /etc/nginx/ssl/cert.pem;\n    ssl_certificate_key /etc/nginx/ssl/key.pem;\n\n}\n```\n\n#### http\u2192https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u5834\u5408\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  localhost;\n    return 301 https://$host$request_uri;\n}\n```\n\n#### WordPress\n\n\u30db\u30fc\u30e0URL\u3001WordPressURL\u3092\u5909\u66f4\n\n```sql:sql\n$ UPDATE `wp_options` SET `option_value` = 'https://host' WHERE `wp_options`.`option_name` = 'siteurl' OR `wp_options`.`option_name` = 'home';\n```\n\n```php:/var/www/html/wp-config.php\n//\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\ndefine('FORCE_SSL_ADMIN', true);\n\nif ( isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === \"https\" ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n```\n\n#### HSTS\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        #HTTPS\u306e\u307f\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u306e\u307f\n        add_header Strict-Transport-Security max-age=15768000;\n\n}\n```\n\n#### Perfect Forward Security (PFS)\n\n```\n$ cd /etc/nginx/ssl\n$ openssl dhparam 2048 -out dhparam.pem\n```\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        ssl_dhparam /etc/nginx/ssl/dhparam.pem;\n\n}\n```\n\n#### HTTP/2\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n}\n```\n\n#### TLS/SSL\n\nSSLv1.0,SSLv2.0,SSLv3.0\u306f\u7121\u52b9\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n\n}\n```\n\n#### \u6697\u53f7\u30b9\u30a4\u30fc\u30c8\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';\n\n}\n```\n\n#### OCSP Stapling\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    resolver 8.8.8.8;\n\n}\n```\n\n#### \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\n[Qualys SSL Report](https://www.ssllabs.com/ssltest/)\n<img width=\"981\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-10-18 1.46.09.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/97451/10c0ae72-60e1-6d36-00d4-3af04c48c11c.png\">\n\n\u307e\u3042\u3084\u3063\u3066\u308b\u3053\u3068\u306f\u5909\u308f\u3089\u306a\u3044\u306e\u3067\u4eca\u56de\u3082\u3055\u3059\u304c\u306bA+\u3002\n", "tags": ["nginx", "WordPress", "PHP7", "AmazonLinux"]}