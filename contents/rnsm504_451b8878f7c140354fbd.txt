{"context": " More than 1 year has passed since last update.\u30d5\u30ea\u30c3\u30d7\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3067\u5199\u771f\u306e\u5207\u308a\u66ff\u3048\u3092\u884c\u3046\u3002\n\u30fb\u30fb\u30fb\u672c\u5f53\u306f\u3082\u3063\u3068\u6ed1\u3089\u304b\u306b\u52d5\u304b\u3059\u4e88\u5b9a\u3060\u3063\u305f\u3093\u3060\u3051\u3069\u3053\u3053\u3089\u3067\u632b\u6298\u3002\n\u305b\u3081\u3066\u5076\u6570\u3068\u5947\u6570\u3067\u52d5\u304d\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u5909\u3048\u3066\u307f\u305f\u3051\u3069\u3001\u5c0f\u624b\u5148\u304b\u306a\u3042\u3002\n\u3061\u306a\u307f\u306b\u5199\u771f\u306f\u5e73\u5b89\u795e\u5bae\u524d\u3067\u306e\u5b9f\u7269\u5927\u30d1\u30c8\u30ec\u30a4\u30d0\u30fc\u304c\u6765\u305f\u3068\u304d\u306e\u3082\u306e\u3067\u3059\u3002\n\u30d5\u30ea\u30c3\u30d7\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u306f\u3053\u3053\u3089\u3067\u4e00\u65e6\u6b62\u3081\u3066\u6b21\u56de\u304b\u3089\u5225\u306e\u3082\u306e\u306b\u6311\u6226\n\n\nViewController.swift\n\nimport UIKit\nimport QuartzCore\n\nclass ParaparaLayer : CALayer {\n    var panelNumber : Int = 0\n}\n\nclass ViewController: UIViewController {\n    var front : Bool = true\n    var touch : Bool  = false\n    var myView : UIView = UIView()\n    var layerKaisou : CGFloat = 0\n    let photos : [String] = [\"IMG_0695.jpg\", \"IMG_0704.jpg\", \"IMG_0720.jpg\", \"IMG_0723.jpg\"]\n    var index : Int = 0\n\n    override func viewDidLoad() {\n        super.viewDidLoad()\n        // Do any additional setup after loading the view, typically from a nib.\n\n        myView = UIView(frame: self.view.frame)\n        front = !front\n        self.addImage(photos[index])\n        front = !front\n        self.addImage(photos[++index])\n        self.view.addSubview(myView)\n\n      }\n\n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n        // Dispose of any resources that can be recreated.\n    }\n\n\n override func touchesBegan(touches: NSSet, withEvent event: UIEvent) {\n        super.touchesBegan(touches, withEvent: event)\n\n        if(touch){\n            return\n        }\n\n        touch = true\n\n        self.front = !self.front\n        var transform : CATransform3D = CATransform3DIdentity\n        transform.m34 = 1.0 / -420.0\n\n        transform = CATransform3DMakeRotation(CGFloat(M_PI),  0.0, 1.0, 0.0)\n\n        var rl : CFRunLoopRef = CFRunLoopGetCurrent()\n        let distantFuture = NSDate.distantFuture() as? NSDate\n        var timer : CFRunLoopTimerRef = CFRunLoopTimerCreate(nil, CFDateGetAbsoluteTime(distantFuture),0,0,0, nil, nil)\n\n        CFRunLoopAddTimer(rl, timer, kCFRunLoopDefaultMode)\n\n        var name : String\n        if(front){\n            name = \"front\"\n        } else {\n            name = \"back\"\n        }\n\n\n        let ary = myView.layer.sublayers\n        if(ary.count > 0){\n\n            for (var v : CGFloat = 0; v < 4; v++) {\n                for (var h : CGFloat = 0; h < 4; h++) {\n                    for(var i : Int = 0; i < ary.count; i++) {\n                        var tile : ParaparaLayer = ary[i] as ParaparaLayer\n\n                        if((v%2 == 0 && tile.panelNumber%2 == 0)\n                            || (v%2 == 1 && tile.panelNumber%2 == 1)) {\n                                if(tile.name != name){\n                                    CATransaction.begin()\n                                    CATransaction.setValue(kCFBooleanFalse, forKeyPath: kCATransactionDisableActions)\n                                    CATransaction.setCompletionBlock{\n                                        CFRunLoopStop(rl)\n                                    }\n\n                                    CATransaction.setAnimationDuration(0.7)\n                                    tile.transform = transform\n\n                                    CATransaction.commit()\n                                    CFRunLoopRun()\n\n                                }\n                        }\n                    }\n                }\n            }\n        }\n\n        ++index\n        if(index >= photos.count){\n            index  = 0\n        }\n        self.addImage(photos[index])\n        self.touch = false        \n\n    }\n\n    func addImage(photo : String) {\n        var r : CGRect = CGRectZero;\n        let image = UIImage(named: photo)\n        var divCount : CGFloat = 4.0\n\n        r.size.width = myView.bounds.size.width/divCount\n        r.size.height = myView.bounds.size.height/divCount\n\n        var name : String\n        if(!front){\n            name = \"front\"\n        } else {\n            name = \"back\"\n        }\n\n        var kisu :Int = 1\n        var gusu :Int = 0\n        for (var v : CGFloat = 0; v < divCount; v++) {\n            for (var h : CGFloat = 0; h < divCount; h++) {\n                var tile = ParaparaLayer()\n                if (v%2) == 0 {\n                    gusu = gusu + 2\n                    tile.panelNumber = gusu\n                } else {\n                    kisu = kisu + 2\n                    tile.panelNumber = kisu\n                }\n                tile.contents = image.CGImage\n                tile.frame = r;\n\n                //\u63cf\u753b\u9818\u57df\u6307\u5b9a\n                tile.contentsRect = CGRectMake(h/divCount, v/divCount, (CGFloat)(1.0/divCount), (CGFloat)(1.0/divCount))\n                tile.doubleSided = false\n                tile.zPosition = layerKaisou\n                tile.name = name\n                myView.layer.addSublayer(tile)\n                r = CGRectOffset(r, r.size.width, 0);   //  \u6b21\u306e\u4f4d\u7f6e\u3078\n            }\n            //  \u77e9\u5f62\u3092\u5de6\u7aef\u306b\u623b\u3057\u3001\u7e26\u4f4d\u7f6e\u3092\u4e00\u6bb5\u305a\u3089\u305a\n            r.origin.x = myView.bounds.origin.x;\n            r = CGRectOffset(r, 0, r.size.height);\n        }\n\n        layerKaisou = layerKaisou - 1\n    }\n\n}\n\n\n\n\n\u4eca\u56de\u3082\u4f5c\u308b\u306b\u5f53\u305f\u3063\u3066\u53c2\u8003\u306b\u3055\u305b\u3066\u8cb0\u3063\u305f\u30da\u30fc\u30b8\nCFRunLoop\u306b\u3088\u308bCore Animation\u306e\u9010\u6b21\u7684\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\n\n\u30d5\u30ea\u30c3\u30d7\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3067\u5199\u771f\u306e\u5207\u308a\u66ff\u3048\u3092\u884c\u3046\u3002\n\u30fb\u30fb\u30fb\u672c\u5f53\u306f\u3082\u3063\u3068\u6ed1\u3089\u304b\u306b\u52d5\u304b\u3059\u4e88\u5b9a\u3060\u3063\u305f\u3093\u3060\u3051\u3069\u3053\u3053\u3089\u3067\u632b\u6298\u3002\n\u305b\u3081\u3066\u5076\u6570\u3068\u5947\u6570\u3067\u52d5\u304d\u306e\u30bf\u30a4\u30df\u30f3\u30b0\u3067\u5909\u3048\u3066\u307f\u305f\u3051\u3069\u3001\u5c0f\u624b\u5148\u304b\u306a\u3042\u3002\n\u3061\u306a\u307f\u306b\u5199\u771f\u306f\u5e73\u5b89\u795e\u5bae\u524d\u3067\u306e\u5b9f\u7269\u5927\u30d1\u30c8\u30ec\u30a4\u30d0\u30fc\u304c\u6765\u305f\u3068\u304d\u306e\u3082\u306e\u3067\u3059\u3002\n\n\u30d5\u30ea\u30c3\u30d7\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u306f\u3053\u3053\u3089\u3067\u4e00\u65e6\u6b62\u3081\u3066\u6b21\u56de\u304b\u3089\u5225\u306e\u3082\u306e\u306b\u6311\u6226\n\n![iphonePlay3.gif](https://qiita-image-store.s3.amazonaws.com/0/40693/80713f09-695c-6463-1b0c-59ee8de4455f.gif \"iphonePlay3.gif\")\n\n\n```ViewController.swift\n\nimport UIKit\nimport QuartzCore\n\nclass ParaparaLayer : CALayer {\n    var panelNumber : Int = 0\n}\n\nclass ViewController: UIViewController {\n    var front : Bool = true\n    var touch : Bool  = false\n    var myView : UIView = UIView()\n    var layerKaisou : CGFloat = 0\n    let photos : [String] = [\"IMG_0695.jpg\", \"IMG_0704.jpg\", \"IMG_0720.jpg\", \"IMG_0723.jpg\"]\n    var index : Int = 0\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n        // Do any additional setup after loading the view, typically from a nib.\n\n        myView = UIView(frame: self.view.frame)\n        front = !front\n        self.addImage(photos[index])\n        front = !front\n        self.addImage(photos[++index])\n        self.view.addSubview(myView)\n        \n      }\n    \n    override func didReceiveMemoryWarning() {\n        super.didReceiveMemoryWarning()\n        // Dispose of any resources that can be recreated.\n    }\n    \n    \n override func touchesBegan(touches: NSSet, withEvent event: UIEvent) {\n        super.touchesBegan(touches, withEvent: event)\n        \n        if(touch){\n            return\n        }\n        \n        touch = true\n        \n        self.front = !self.front\n        var transform : CATransform3D = CATransform3DIdentity\n        transform.m34 = 1.0 / -420.0\n        \n        transform = CATransform3DMakeRotation(CGFloat(M_PI),  0.0, 1.0, 0.0)\n        \n        var rl : CFRunLoopRef = CFRunLoopGetCurrent()\n        let distantFuture = NSDate.distantFuture() as? NSDate\n        var timer : CFRunLoopTimerRef = CFRunLoopTimerCreate(nil, CFDateGetAbsoluteTime(distantFuture),0,0,0, nil, nil)\n        \n        CFRunLoopAddTimer(rl, timer, kCFRunLoopDefaultMode)\n        \n        var name : String\n        if(front){\n            name = \"front\"\n        } else {\n            name = \"back\"\n        }\n        \n        \n        let ary = myView.layer.sublayers\n        if(ary.count > 0){\n        \n            for (var v : CGFloat = 0; v < 4; v++) {\n                for (var h : CGFloat = 0; h < 4; h++) {\n                    for(var i : Int = 0; i < ary.count; i++) {\n                        var tile : ParaparaLayer = ary[i] as ParaparaLayer\n                        \n                        if((v%2 == 0 && tile.panelNumber%2 == 0)\n                            || (v%2 == 1 && tile.panelNumber%2 == 1)) {\n                                if(tile.name != name){\n                                    CATransaction.begin()\n                                    CATransaction.setValue(kCFBooleanFalse, forKeyPath: kCATransactionDisableActions)\n                                    CATransaction.setCompletionBlock{\n                                        CFRunLoopStop(rl)\n                                    }\n                                    \n                                    CATransaction.setAnimationDuration(0.7)\n                                    tile.transform = transform\n                                    \n                                    CATransaction.commit()\n                                    CFRunLoopRun()\n                                    \n                                }\n                        }\n                    }\n                }\n            }\n        }\n\n        ++index\n        if(index >= photos.count){\n            index  = 0\n        }\n        self.addImage(photos[index])\n        self.touch = false        \n \n    }\n       \n    func addImage(photo : String) {\n        var r : CGRect = CGRectZero;\n        let image = UIImage(named: photo)\n        var divCount : CGFloat = 4.0\n        \n        r.size.width = myView.bounds.size.width/divCount\n        r.size.height = myView.bounds.size.height/divCount\n\n        var name : String\n        if(!front){\n            name = \"front\"\n        } else {\n            name = \"back\"\n        }\n        \n        var kisu :Int = 1\n        var gusu :Int = 0\n        for (var v : CGFloat = 0; v < divCount; v++) {\n            for (var h : CGFloat = 0; h < divCount; h++) {\n                var tile = ParaparaLayer()\n                if (v%2) == 0 {\n                    gusu = gusu + 2\n                    tile.panelNumber = gusu\n                } else {\n                    kisu = kisu + 2\n                    tile.panelNumber = kisu\n                }\n                tile.contents = image.CGImage\n                tile.frame = r;\n                \n                //\u63cf\u753b\u9818\u57df\u6307\u5b9a\n                tile.contentsRect = CGRectMake(h/divCount, v/divCount, (CGFloat)(1.0/divCount), (CGFloat)(1.0/divCount))\n                tile.doubleSided = false\n                tile.zPosition = layerKaisou\n                tile.name = name\n                myView.layer.addSublayer(tile)\n                r = CGRectOffset(r, r.size.width, 0);   //  \u6b21\u306e\u4f4d\u7f6e\u3078\n            }\n            //  \u77e9\u5f62\u3092\u5de6\u7aef\u306b\u623b\u3057\u3001\u7e26\u4f4d\u7f6e\u3092\u4e00\u6bb5\u305a\u3089\u305a\n            r.origin.x = myView.bounds.origin.x;\n            r = CGRectOffset(r, 0, r.size.height);\n        }\n        \n        layerKaisou = layerKaisou - 1\n    }\n    \n}\n\n```\n\n####\u4eca\u56de\u3082\u4f5c\u308b\u306b\u5f53\u305f\u3063\u3066\u53c2\u8003\u306b\u3055\u305b\u3066\u8cb0\u3063\u305f\u30da\u30fc\u30b8\n\n\n[CFRunLoop\u306b\u3088\u308bCore Animation\u306e\u9010\u6b21\u7684\u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3](http://qiita.com/icecocoa6/items/6d5c023ada5e30eb209c)\n\n\n", "tags": ["Swift", "flip", "animation"]}