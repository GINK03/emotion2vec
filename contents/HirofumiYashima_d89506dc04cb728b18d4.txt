{"context": " More than 1 year has passed since last update.\n\n\u300cgame_event\u00d7\u30e6\u30fc\u30b6\u300d\u5225\u306e\u30a4\u30d9\u30f3\u30c8\u9593\u9694\u6642\u9593\u30c7\u30fc\u30bf\uff08\u8907\u6570\u30ec\u30b3\u30fc\u30c9\uff09\u306e\u4e2d\u592e\u5024\uff08\u5404\u30e6\u30fc\u30b6\u304c\u5404\u76ee\u7684\u3067\u8d77\u3053\u3057\u305f\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u9593\u306e\u9593\u9694\u6642\u9593\uff08\u8907\u6570\u3042\u308b\uff09\u306e\u300c\u4e2d\u592e\u5024\u300d\uff09\u304c\u3001\u5404\u300cgame_event\u300d\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u5168\u30e6\u30fc\u30b6\u306e\u4e2d\u592e\u5024\u3000\u306e\u3046\u3061\u3001\u4f55\u756a\u76ee\u306e\u77ed\u3055\u304b\u3092\u3001\u30e9\u30f3\u30af\uff08\u6607\u9806\uff09\u4ed8\u3051\u308b\u3002\n\n\n\u3010 \u60f3\u5b9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30fbDB\u30c6\u30fc\u30d6\u30eb \u3011\n\n\n\u30c6\u30fc\u30d6\u30eb\u7269\u7406\u540d\uff1agame_event_item_log\n\n\n\u30ab\u30e9\u30e0\u7269\u7406\u540d\n\n\ngame_event\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\uff08\u540d or ID\uff09\nuser_id \uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u30e6\u30fc\u30b6ID\ndatetime \uff1a\u305d\u306e\u300c\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u300d\u306b\u3001\u305d\u306e\u300c\u30e6\u30fc\u30b6ID\u300d\u306e\u30e6\u30fc\u30b6\u304c\u3001\u53c2\u52a0\u3057\u305f\u6642\u523b\uff08YYYY-MM-DD HH24:MI:SS\uff09\n\n\n\n\uff1c \u4e3b\u554f\u3044\u5408\u308f\u305b\u6587\u306e select \u53e5 \u3067 \u53c2\u7167\u3055\u308c\u3066\u5f97\u3089\u308c\u308b\u30ab\u30e9\u30e0 \uff1e\n\n\ngame_event\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\uff08\u540d or ID\uff09\nuser_id\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u30e6\u30fc\u30b6ID\nMEDIAN_event_interval_per_game_event_user\uff1a\u4e0a\u8a18\u30e6\u30fc\u30b6\u306e\uff08\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u306b\u518d\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306b\u304b\u304b\u3063\u305f\u500b\u3005\u306e\u6642\u9593\u9593\u9694\uff08\u5206\u5358\u4f4d\uff09\u306e\uff09\u4e2d\u592e\u5024\uff08\u771f\u3093\u4e2d\u306e\u9577\u3055\u306e\u6570\u5b57\uff09\nrank_time_interval_in_game_event\uff1a\u4e0a\u8a18 \u518d\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306e\u9577\u3055\u306e\u300c\u771f\u3093\u4e2d\u306e\u9577\u3055\u300d\uff08\u4e2d\u592e\u5024\uff09\u304c\u3001\u305d\u306e\u30b2\u30fc\u30e0\u5168\u53c2\u52a0UU\u306e\u300c\u4e2d\u592e\u5024\u300d\u306e\u306a\u304b\u3067\u4f55\u756a\u76ee\u306b\u77ed\u304b\u3063\u305f\u304b\u306e\u9806\u4f4d\nmax_rank_in_game_event\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u306e\u30de\u30c3\u30af\u30b9\u9806\u4f4d\uff08\u3053\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u5185\u306e\u9806\u4f4d\u306f\u3001\u5168\u90e8\u3067\u4f55\u4f4d\u307e\u3067\u3042\u308b\u306e\u304b\u3092\u610f\u5473\u3059\u308b\uff09\nrecord_num_of_this_rank\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u3000\u5168UU \u7d2f\u8a08\u306e\u9000\u51fa\u30fb\u518d\u30ed\u30b0\u30a4\u30f3\u56de\u6570\nmax_median_score_in_game_event\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u53c2\u52a0UU\u306e\u306a\u304b\u3067\u3001\u6700\u3082\uff08\u305d\u306e\u30a4\u30d9\u30f3\u30c8\u3078\u306e\u518d\u30ed\u30b0\u30a4\u30f3\u307e\u3067\u306e\u7d4c\u904e\u6642\u9593\u306e\u4e2d\u592e\u5024\u304c\uff09\u9577\u304b\u3063\u305f\u30e6\u30fc\u30b6\u306e\u4e2d\u592e\u5024\n\n\n\uff1c \u30ec\u30b3\u30fc\u30c9\u8868\u793a\u9806 \uff1e\n\ngame_event, rank_time_interval_in_game_event, user_id\n\n\uff1c \uff33\uff31\uff2c \uff1e\n\n\n\u4e3b\u306b\u4f7f\u3063\u305fSQL\u6a5f\u80fd\u306f\u3001\u4ee5\u4e0b\u306e\uff13\u3064\u3067\u3059\u3002\n\n\n\nWith\u53e5\u3000\uff08\u4e3b\u554f\u3044\u5408\u308f\u305b\u6587 \u306b\u305f\u3069\u308a\u3064\u304f\u307e\u3067\u306e\u4e2d\u9593\u4f5c\u696d\u30c6\u30fc\u30d6\u30eb\uff08View\u306e\u3088\u3046\u306a\u3082\u306e\uff09\u3092\u4f55\u56de\u304b\u3001\u3064\u3065\u3051\u3066\u751f\u6210\uff09\n\n\u76f8\u95a2\u30b5\u30d6\u30af\u30a8\u30ea\uff08\u30ed\u30b0\u30a4\u30f3\u6642\u9593 \u524d\u5f8c\u3059\u308b\uff12\u30ec\u30b3\u30fc\u30c9\u306e\u30ed\u30b0\u30a4\u30f3\u6642\u523b\u3092\u5f15\u304d\u7b97\u3057\u3066\u7d4c\u904e\u6642\u9593\u3092\u7b97\u51fa\uff09\n\ndense_rank\u95a2\u6570 \uff08dense_rank( ) ,max(), median(), stddev() \u95a2\u6570\u3068\u3001over(partition by column_name order by column_name \u3067\u3001\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u3068\u30e6\u30fc\u30b6ID\u6bce\u306e\uff08\u518d\u30ed\u30b0\u30a4\u30f3\u6240\u8981\u6642\u9593\u306e\u77ed\u3055\uff09\u9806\u4f4d\u3068\u6700\u5927\u30fb\u4e2d\u592e\u5024\u30fb\u6a19\u6e96\u504f\u5dee \u77ed\u3055\u3092\u7b97\u51fa)\n\n\nSQL\nWith temp AS (\nSELECT tbl_0.game_event,\n       tbl_0.user_id, \n       tbl_0.datetime,\n        (SELECT MAX(datetime)\n         FROM game_event_item_log tbl_1\n         where tbl_1.datetime < tbl_0.datetime) AS latest\nFROM game_event_item_log tbl_0\ngroup by tbl_0.game_event, tbl_0.user_id, tbl_0.datetime\norder by tbl_0.game_event, tbl_0.user_id, tbl_0.datetime desc\n), temp_2 AS (\nSELECT  game_event,\n        user_id,\n        datetime,\n        latest, \n        abs(datediff(minute,datetime, latest)) AS time_interval\nFROM temp\norder by game_event, user_id, datetime desc\n), temp_3 AS (\nSELECT game_event,\n       user_id,\n       median(time_interval) over(partition by game_event, user_id)AS MEDIAN_event_interval_per_game_event_user\nfrom temp_2\n), temp_4 AS (\nselect *\nfrom temp_3\ngroup by game_event, user_id, MEDIAN_event_interval_per_game_event_user\norder by game_event, MEDIAN_event_interval_per_game_event_user\n), temp_5 AS (\nselect *,\n       dense_rank() over(partition by game_event order by MEDIAN_event_interval_per_game_event_user) AS rank_time_interval_in_game_event\nfrom temp_4\norder by game_event, rank_time_interval_in_game_event\n)\nselect game_event,\n       user_id,\n       MEDIAN_event_interval_per_game_event_user,\n       rank_time_interval_in_game_event,\n       max(rank_time_interval_in_game_event) over(partition by game_event) AS max_rank_in_game_event,\n       count(*) over(partition by game_event, rank_time_interval_in_game_event) AS record_num_of_this_rank,\n       max(MEDIAN_event_interval_per_game_event_user) over(partition by game_event) AS max_median_score_in_game_event\nfrom temp_5\norder by game_event, rank_time_interval_in_game_event, user_id\n;      \n\n\n# __\u300cgame_event\u00d7\u30e6\u30fc\u30b6\u300d\u5225\u306e\u30a4\u30d9\u30f3\u30c8\u9593\u9694\u6642\u9593\u30c7\u30fc\u30bf\uff08\u8907\u6570\u30ec\u30b3\u30fc\u30c9\uff09\u306e\u4e2d\u592e\u5024\uff08\u5404\u30e6\u30fc\u30b6\u304c\u5404\u76ee\u7684\u3067\u8d77\u3053\u3057\u305f\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u9593\u306e\u9593\u9694\u6642\u9593\uff08\u8907\u6570\u3042\u308b\uff09\u306e\u300c\u4e2d\u592e\u5024\u300d\uff09\u304c\u3001\u5404\u300cgame_event\u300d\u30b0\u30eb\u30fc\u30d7\u5185\u306e\u5168\u30e6\u30fc\u30b6\u306e\u4e2d\u592e\u5024\u3000\u306e\u3046\u3061\u3001\u4f55\u756a\u76ee\u306e\u77ed\u3055\u304b\u3092\u3001\u30e9\u30f3\u30af\uff08\u6607\u9806\uff09\u4ed8\u3051\u308b\u3002__ \n\n### __\u3010 \u60f3\u5b9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30fbDB\u30c6\u30fc\u30d6\u30eb \u3011__\n\n#### __\u30c6\u30fc\u30d6\u30eb\u7269\u7406\u540d\uff1agame_event_item_log__\n\n#### __\u30ab\u30e9\u30e0\u7269\u7406\u540d__ \n\n- game_event\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\uff08\u540d or ID\uff09\n- user_id \uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u30e6\u30fc\u30b6ID\n- datetime \uff1a\u305d\u306e\u300c\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u300d\u306b\u3001\u305d\u306e\u300c\u30e6\u30fc\u30b6ID\u300d\u306e\u30e6\u30fc\u30b6\u304c\u3001\u53c2\u52a0\u3057\u305f\u6642\u523b\uff08YYYY-MM-DD HH24:MI:SS\uff09\n\n___\n\n### __\uff1c \u4e3b\u554f\u3044\u5408\u308f\u305b\u6587\u306e select \u53e5 \u3067 \u53c2\u7167\u3055\u308c\u3066\u5f97\u3089\u308c\u308b\u30ab\u30e9\u30e0 \uff1e__\n\n- game_event\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\uff08\u540d or ID\uff09\n- user_id\uff1a\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u30e6\u30fc\u30b6ID\n- MEDIAN_event_interval_per_game_event_user\uff1a\u4e0a\u8a18\u30e6\u30fc\u30b6\u306e\uff08\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u306b\u518d\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306b\u304b\u304b\u3063\u305f\u500b\u3005\u306e\u6642\u9593\u9593\u9694\uff08\u5206\u5358\u4f4d\uff09\u306e\uff09\u4e2d\u592e\u5024\uff08\u771f\u3093\u4e2d\u306e\u9577\u3055\u306e\u6570\u5b57\uff09\n- rank_time_interval_in_game_event\uff1a\u4e0a\u8a18 \u518d\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306e\u9577\u3055\u306e\u300c\u771f\u3093\u4e2d\u306e\u9577\u3055\u300d\uff08\u4e2d\u592e\u5024\uff09\u304c\u3001\u305d\u306e\u30b2\u30fc\u30e0\u5168\u53c2\u52a0UU\u306e\u300c\u4e2d\u592e\u5024\u300d\u306e\u306a\u304b\u3067\u4f55\u756a\u76ee\u306b\u77ed\u304b\u3063\u305f\u304b\u306e\u9806\u4f4d\n- max_rank_in_game_event\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u306e\u30de\u30c3\u30af\u30b9\u9806\u4f4d\uff08\u3053\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u5185\u306e\u9806\u4f4d\u306f\u3001\u5168\u90e8\u3067\u4f55\u4f4d\u307e\u3067\u3042\u308b\u306e\u304b\u3092\u610f\u5473\u3059\u308b\uff09\n- record_num_of_this_rank\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u53c2\u52a0\u3000\u5168UU \u7d2f\u8a08\u306e\u9000\u51fa\u30fb\u518d\u30ed\u30b0\u30a4\u30f3\u56de\u6570\n- max_median_score_in_game_event\uff1a\u305d\u306e\u30b2\u30fc\u30e0\u53c2\u52a0UU\u306e\u306a\u304b\u3067\u3001\u6700\u3082\uff08\u305d\u306e\u30a4\u30d9\u30f3\u30c8\u3078\u306e\u518d\u30ed\u30b0\u30a4\u30f3\u307e\u3067\u306e\u7d4c\u904e\u6642\u9593\u306e\u4e2d\u592e\u5024\u304c\uff09\u9577\u304b\u3063\u305f\u30e6\u30fc\u30b6\u306e\u4e2d\u592e\u5024\n\n### __\uff1c \u30ec\u30b3\u30fc\u30c9\u8868\u793a\u9806 \uff1e__\n\ngame_event, rank_time_interval_in_game_event, user_id\n\n\n### __\uff1c \uff33\uff31\uff2c \uff1e__\n\n#### __\u4e3b\u306b\u4f7f\u3063\u305fSQL\u6a5f\u80fd\u306f\u3001\u4ee5\u4e0b\u306e\uff13\u3064\u3067\u3059\u3002__\n\n* __With\u53e5__\u3000\uff08\u4e3b\u554f\u3044\u5408\u308f\u305b\u6587 \u306b\u305f\u3069\u308a\u3064\u304f\u307e\u3067\u306e\u4e2d\u9593\u4f5c\u696d\u30c6\u30fc\u30d6\u30eb\uff08View\u306e\u3088\u3046\u306a\u3082\u306e\uff09\u3092\u4f55\u56de\u304b\u3001\u3064\u3065\u3051\u3066\u751f\u6210\uff09\n* __\u76f8\u95a2\u30b5\u30d6\u30af\u30a8\u30ea__\uff08\u30ed\u30b0\u30a4\u30f3\u6642\u9593 \u524d\u5f8c\u3059\u308b\uff12\u30ec\u30b3\u30fc\u30c9\u306e\u30ed\u30b0\u30a4\u30f3\u6642\u523b\u3092\u5f15\u304d\u7b97\u3057\u3066\u7d4c\u904e\u6642\u9593\u3092\u7b97\u51fa\uff09\n* __dense_rank\u95a2\u6570__ \uff08dense_rank( ) ,max(), median(), stddev() \u95a2\u6570\u3068\u3001over(partition by column_name order by column_name \u3067\u3001\u30b2\u30fc\u30e0\u30a4\u30d9\u30f3\u30c8\u3068\u30e6\u30fc\u30b6ID\u6bce\u306e\uff08\u518d\u30ed\u30b0\u30a4\u30f3\u6240\u8981\u6642\u9593\u306e\u77ed\u3055\uff09\u9806\u4f4d\u3068\u6700\u5927\u30fb\u4e2d\u592e\u5024\u30fb\u6a19\u6e96\u504f\u5dee \u77ed\u3055\u3092\u7b97\u51fa)\n\n```{SQL:SQL}\nWith temp AS (\nSELECT tbl_0.game_event,\n       tbl_0.user_id, \n       tbl_0.datetime,\n        (SELECT MAX(datetime)\n\t\t FROM game_event_item_log tbl_1\n\t\t where tbl_1.datetime < tbl_0.datetime) AS latest\nFROM game_event_item_log tbl_0\ngroup by tbl_0.game_event, tbl_0.user_id, tbl_0.datetime\norder by tbl_0.game_event, tbl_0.user_id, tbl_0.datetime desc\n), temp_2 AS (\nSELECT  game_event,\n        user_id,\n        datetime,\n\t\tlatest,\t\n\t\tabs(datediff(minute,datetime, latest)) AS time_interval\nFROM temp\norder by game_event, user_id, datetime desc\n), temp_3 AS (\nSELECT game_event,\n       user_id,\n\t   median(time_interval) over(partition by game_event, user_id)AS MEDIAN_event_interval_per_game_event_user\nfrom temp_2\n), temp_4 AS (\nselect *\nfrom temp_3\ngroup by game_event, user_id, MEDIAN_event_interval_per_game_event_user\norder by game_event, MEDIAN_event_interval_per_game_event_user\n), temp_5 AS (\nselect *,\n       dense_rank() over(partition by game_event order by MEDIAN_event_interval_per_game_event_user) AS rank_time_interval_in_game_event\nfrom temp_4\norder by game_event, rank_time_interval_in_game_event\n)\nselect game_event,\n       user_id,\n\t   MEDIAN_event_interval_per_game_event_user,\n       rank_time_interval_in_game_event,\n\t   max(rank_time_interval_in_game_event) over(partition by game_event) AS max_rank_in_game_event,\n\t   count(*) over(partition by game_event, rank_time_interval_in_game_event) AS record_num_of_this_rank,\n\t   max(MEDIAN_event_interval_per_game_event_user) over(partition by game_event) AS max_median_score_in_game_event\nfrom temp_5\norder by game_event, rank_time_interval_in_game_event, user_id\n;\t   \n```\n", "tags": ["SQL", "\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0", "\u30c7\u30fc\u30bf\u5206\u6790", "\u30b9\u30de\u30db\u30b2\u30fc\u30e0", "\u30a2\u30af\u30bb\u30b9\u89e3\u6790"]}