{"context": " More than 1 year has passed since last update.\u3061\u3083\u3093\u3068\u666e\u901a\u306b\u8003\u3048\u305f\u3089\u5f53\u305f\u308a\u524d\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u666e\u6bb5SELinux\u304c\u7121\u52b9\u306a\u74b0\u5883\u3067\u4f5c\u696d\u3057\u3066\u3044\u308b\u3068\u3001\u8efd\u304f\u306f\u307e\u308b\u306e\u3067\u5099\u5fd8\u3067\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nApache\u3092\u8a2d\u5b9a\u3059\u308b\u6b21\u306e\u3088\u3046\u306a\u7d20\u6734\u306a\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3068\u3057\u307e\u3057\u3087\u3046\u3002\n\nroles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- service: name=httpd state=running enabled=yes\n\n\n\u5b9f\u884c\u3059\u308b\u3068Apache\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3001\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ ansible-playbook -i hosts.ini vagrant.yml\n\nPLAY [web] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [192.168.33.12]\n\nTASK: [yum name=httpd state=installed] ****************************************\nchanged: [192.168.33.12]\n\nTASK: [service name=httpd state=running enabled=yes] **************************\nchanged: [192.168.33.12]\n\nPLAY RECAP ********************************************************************\n192.168.33.12              : ok=3    changed=2    unreachable=0    failed=0\n\n\u3053\u306e\u5f8c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u304f\u306a\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\nroles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- template: dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644\n  notify: restart httpd\n- service: name=httpd state=running enabled=yes\n\n\n\u3053\u308c\u306f\u5931\u6557\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n$ ansible-playbook -i hosts.ini vagrant.yml\n\nPLAY [web] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [192.168.33.12]\n\nTASK: [yum name=httpd state=installed] ****************************************\nok: [192.168.33.12]\n\nTASK: [template dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2] ***\nchanged: [192.168.33.12]\n\nTASK: [service name=httpd state=running enabled=yes] **************************\nok: [192.168.33.12]\n\nNOTIFIED: [restart httpd] *****************************************************\nfailed: [192.168.33.12] => {\"failed\": true, \"item\": \"\"}\nmsg: httpd: Syntax error on line 221 of /etc/httpd/conf/httpd.conf: Could not open configuration file /etc/httpd/conf.d/ltsv.conf: Permission denied\n\n\nPLAY RECAP ********************************************************************\n           to retry, use: --limit @/var/tmp/ansible/vagrant.retry\n\n192.168.33.12              : ok=4    changed=1    unreachable=0    failed=1\n\n\u300cPermission denied\u300d\u3063\u3066\u8a00\u308f\u308c\u3066\u610f\u5473\u304c\u5206\u304b\u3089\u306a\u304f\u306a\u308a\u307e\u3059\u304c\u3001ls -Z\u3068\u3057\u3066\u307f\u308b\u3068\u5206\u304b\u308a\u307e\u3059\u3002\n $ vagrant ssh -- ls -Z /etc/httpd/conf.d\n -rw-r--r--. root root system_u:object_r:httpd_config_t:s0 README\n -rw-r--r--. root root unconfined_u:object_r:user_home_t:s0 ltsv.conf\n -rw-r--r--. root root system_u:object_r:httpd_config_t:s0 welcome.conf\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u304c\u3088\u308d\u3057\u304f\u306a\u3044\u3067\u3059\u306d\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u308a\u8ffd\u52a0\u3057\u305f\u6642\u306b\u306frestorecon\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nroles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- template: dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644\n  notify:\n    - restorecon /etc/httpd/conf.d\n    - restart httpd\n- service: name=httpd state=running enabled=yes\n\n\n\nroles/web/handlers/main.yml\n---\n- name: restorecon /etc/httpd/conf.d\n  command: /sbin/restorecon -R /etc/httpd/conf.d\n- name: restart httpd\n  service: name=httpd state=restarted\n\n\nhanlers/main.yml\u306e\u4e2d\u8eab\u306f\u66f8\u3044\u305f\u9806\u756a\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3001\u3064\u307e\u308a\u3001restart httpd\u3088\u308a \u5148\u306b restorecon\u3092\u66f8\u304b\u306a\u304f\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002restorecon\u3092\u5f8c\u304b\u3089\u4ed8\u3051\u8db3\u3059\u6642\u306a\u3093\u304b\u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\u3002\n\u3053\u308c\u3067\u3046\u307e\u304f\u3044\u304d\u307e\u3059\u3002\n$ ansible-playbook -i hosts.ini vagrant.yml\n\nPLAY [web] ******************************************************************** \n\nGATHERING FACTS *************************************************************** \nok: [192.168.33.12]\n\nTASK: [yum name=httpd state=installed] **************************************** \nok: [192.168.33.12]\n\nTASK: [template dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644] *** \nchanged: [192.168.33.12]\n\nTASK: [service name=httpd state=running enabled=yes] ************************** \nok: [192.168.33.12]\n\nNOTIFIED: [restorecon /etc/httpd/conf.d] ************************************** \nchanged: [192.168.33.12]\n\nNOTIFIED: [restart httpd] ***************************************************** \nchanged: [192.168.33.12]\n\nPLAY RECAP ******************************************************************** \n192.168.33.12              : ok=6    changed=3    unreachable=0    failed=0   \n\nAnsible\u306efile\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u306fselevel\u3001serole\u3001setype\u3001seuser\u3068\u3044\u3046SELinux\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308a\u307e\u3059\u304c\u3001\uff08\u666e\u901a\uff09/etc/httpd\u5168\u4f53\u3068\u3057\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u306e\u8a2d\u5b9a\u304c\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u4ee5\u4e0b\u3067\u3042\u308c\u3070\u308f\u3056\u308f\u3056\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\n$ vagrant ssh -- grep /etc/httpd /etc/selinux/targeted/contexts/files/file_contexts\n/etc/httpd(/.*)?    system_u:object_r:httpd_config_t:s0\n/etc/httpd/alias(/.*)?  system_u:object_r:cert_t:s0\n/etc/httpd/logs system_u:object_r:httpd_log_t:s0\n/etc/httpd/modules  system_u:object_r:httpd_modules_t:s0\n/etc/httpd/conf/keytab  --  system_u:object_r:httpd_keytab_t:s0\n\n\u3061\u3083\u3093\u3068\u666e\u901a\u306b\u8003\u3048\u305f\u3089\u5f53\u305f\u308a\u524d\u306a\u3093\u3067\u3059\u3051\u3069\u3001\u666e\u6bb5SELinux\u304c\u7121\u52b9\u306a\u74b0\u5883\u3067\u4f5c\u696d\u3057\u3066\u3044\u308b\u3068\u3001\u8efd\u304f\u306f\u307e\u308b\u306e\u3067\u5099\u5fd8\u3067\u6b8b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nApache\u3092\u8a2d\u5b9a\u3059\u308b\u6b21\u306e\u3088\u3046\u306a\u7d20\u6734\u306a\u30bf\u30b9\u30af\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3068\u3057\u307e\u3057\u3087\u3046\u3002\n\n```:roles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- service: name=httpd state=running enabled=yes\n```\n\n\u5b9f\u884c\u3059\u308b\u3068Apache\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3001\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n    $ ansible-playbook -i hosts.ini vagrant.yml\n    \n    PLAY [web] ********************************************************************\n    \n    GATHERING FACTS ***************************************************************\n    ok: [192.168.33.12]\n    \n    TASK: [yum name=httpd state=installed] ****************************************\n    changed: [192.168.33.12]\n    \n    TASK: [service name=httpd state=running enabled=yes] **************************\n    changed: [192.168.33.12]\n    \n    PLAY RECAP ********************************************************************\n    192.168.33.12              : ok=3    changed=2    unreachable=0    failed=0\n\n\u3053\u306e\u5f8c\u3001\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u304f\u306a\u3063\u305f\u3068\u3057\u307e\u3059\u3002\n\n```yaml:roles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- template: dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644\n  notify: restart httpd\n- service: name=httpd state=running enabled=yes\n```\n\n\u3053\u308c\u306f\u5931\u6557\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n    $ ansible-playbook -i hosts.ini vagrant.yml\n    \n    PLAY [web] ********************************************************************\n    \n    GATHERING FACTS ***************************************************************\n    ok: [192.168.33.12]\n    \n    TASK: [yum name=httpd state=installed] ****************************************\n    ok: [192.168.33.12]\n    \n    TASK: [template dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2] ***\n    changed: [192.168.33.12]\n    \n    TASK: [service name=httpd state=running enabled=yes] **************************\n    ok: [192.168.33.12]\n    \n    NOTIFIED: [restart httpd] *****************************************************\n    failed: [192.168.33.12] => {\"failed\": true, \"item\": \"\"}\n    msg: httpd: Syntax error on line 221 of /etc/httpd/conf/httpd.conf: Could not open configuration file /etc/httpd/conf.d/ltsv.conf: Permission denied\n    \n    \n    PLAY RECAP ********************************************************************\n               to retry, use: --limit @/var/tmp/ansible/vagrant.retry\n    \n    192.168.33.12              : ok=4    changed=1    unreachable=0    failed=1\n\n\u300cPermission denied\u300d\u3063\u3066\u8a00\u308f\u308c\u3066\u610f\u5473\u304c\u5206\u304b\u3089\u306a\u304f\u306a\u308a\u307e\u3059\u304c\u3001`ls -Z`\u3068\u3057\u3066\u307f\u308b\u3068\u5206\u304b\u308a\u307e\u3059\u3002\n\n     $ vagrant ssh -- ls -Z /etc/httpd/conf.d\n     -rw-r--r--. root root system_u:object_r:httpd_config_t:s0 README\n     -rw-r--r--. root root unconfined_u:object_r:user_home_t:s0 ltsv.conf\n     -rw-r--r--. root root system_u:object_r:httpd_config_t:s0 welcome.conf\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u304c\u3088\u308d\u3057\u304f\u306a\u3044\u3067\u3059\u306d\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u3001\u30d5\u30a1\u30a4\u30eb\u3092\u5909\u66f4\u3057\u305f\u308a\u8ffd\u52a0\u3057\u305f\u6642\u306b\u306f`restorecon`\u30b3\u30de\u30f3\u30c9\u3092\u547c\u3073\u51fa\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```yaml:roles/web/tasks/main.yml\n---\n- yum: name=httpd state=installed\n- template: dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644\n  notify:\n    - restorecon /etc/httpd/conf.d\n    - restart httpd\n- service: name=httpd state=running enabled=yes\n```\n\n```yaml:roles/web/handlers/main.yml\n---\n- name: restorecon /etc/httpd/conf.d\n  command: /sbin/restorecon -R /etc/httpd/conf.d\n- name: restart httpd\n  service: name=httpd state=restarted\n```\n\n`hanlers/main.yml`\u306e\u4e2d\u8eab\u306f\u66f8\u3044\u305f\u9806\u756a\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3001\u3064\u307e\u308a\u3001`restart httpd`\u3088\u308a **\u5148\u306b** `restorecon`\u3092\u66f8\u304b\u306a\u304f\u3066\u306f\u3044\u3051\u307e\u305b\u3093\u3002`restorecon`\u3092\u5f8c\u304b\u3089\u4ed8\u3051\u8db3\u3059\u6642\u306a\u3093\u304b\u5fd8\u308c\u304c\u3061\u306a\u306e\u3067\u6ce8\u610f\u3002\n\n\u3053\u308c\u3067\u3046\u307e\u304f\u3044\u304d\u307e\u3059\u3002\n\n    $ ansible-playbook -i hosts.ini vagrant.yml\n    \n    PLAY [web] ******************************************************************** \n    \n    GATHERING FACTS *************************************************************** \n    ok: [192.168.33.12]\n    \n    TASK: [yum name=httpd state=installed] **************************************** \n    ok: [192.168.33.12]\n    \n    TASK: [template dest=/etc/httpd/conf.d/ltsv.conf src=etc/httpd/conf.d/ltsv.conf.j2 owner=root group=root mode=0644] *** \n    changed: [192.168.33.12]\n    \n    TASK: [service name=httpd state=running enabled=yes] ************************** \n    ok: [192.168.33.12]\n    \n    NOTIFIED: [restorecon /etc/httpd/conf.d] ************************************** \n    changed: [192.168.33.12]\n    \n    NOTIFIED: [restart httpd] ***************************************************** \n    changed: [192.168.33.12]\n    \n    PLAY RECAP ******************************************************************** \n    192.168.33.12              : ok=6    changed=3    unreachable=0    failed=0   \n\nAnsible\u306e[file\u30e2\u30b8\u30e5\u30fc\u30eb][filemodule]\u306b\u306f`selevel`\u3001`serole`\u3001`setype`\u3001`seuser`\u3068\u3044\u3046SELinux\u7528\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u3042\u308a\u307e\u3059\u304c\u3001\uff08\u666e\u901a\uff09`/etc/httpd`\u5168\u4f53\u3068\u3057\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b3\u30f3\u30c6\u30af\u30b9\u30c8\u306e\u8a2d\u5b9a\u304c\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u305d\u308c\u4ee5\u4e0b\u3067\u3042\u308c\u3070\u308f\u3056\u308f\u3056\u8a2d\u5b9a\u3057\u306a\u304f\u3066\u3082\u5927\u4e08\u592b\u3067\u3059\u3002\n\n    $ vagrant ssh -- grep /etc/httpd /etc/selinux/targeted/contexts/files/file_contexts\n    /etc/httpd(/.*)?\tsystem_u:object_r:httpd_config_t:s0\n    /etc/httpd/alias(/.*)?\tsystem_u:object_r:cert_t:s0\n    /etc/httpd/logs\tsystem_u:object_r:httpd_log_t:s0\n    /etc/httpd/modules\tsystem_u:object_r:httpd_modules_t:s0\n    /etc/httpd/conf/keytab\t--\tsystem_u:object_r:httpd_keytab_t:s0\n\n[filemodule]: http://docs.ansible.com/file_module.html\n", "tags": ["Ansible", "SELinux"]}