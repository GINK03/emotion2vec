{"context": " More than 1 year has passed since last update.Android\u3067DB\u95a2\u4fc2\u3092\u5b9f\u88c5\u3059\u308b\u3068\u304d\u306b\u3088\u304f\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u52c9\u5f37\u3057\u305f\u3053\u3068\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n\u81ea\u5206\u306fjava\u306f\u89e6\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u304cAndroid\u306f\u521d\u3081\u3066\u3068\u3044\u3046\u4eba\u306a\u306e\u3067\u7d50\u69cb\u57fa\u672c\u7684\u306a\u3053\u3068\u304b\u3089\u66f8\u3044\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u3053\u3068\u77e5\u3063\u3066\u308b\u308f\uff01\u3063\u3066\u4eba\u306f\u6700\u521d\u306e\u65b9\u3092\u98db\u3070\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nContent Provider\u3068\u306f\u4f55\u304b\nAndroid\u3067DB\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97/\u4fdd\u5b58\u3059\u308b\u6642\u306b\u5229\u7528\u3059\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u3053\u306e\u30af\u30e9\u30b9\u3092\u4f7f\u3048\u3070\u3001\u3042\u308b\u30a2\u30d7\u30ea\u304c\u6301\u3063\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u4ed6\u306e\u30a2\u30d7\u30ea\u3082\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u3082\u3068\u3082\u3068\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u306f\u3001\u7740\u4fe1\u30ed\u30b0\u3084\u96fb\u8a71\u5e33\u3001\u30d6\u30e9\u30a6\u30b6\u306e\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u7570\u306a\u308b\u30a2\u30d7\u30ea\u3067\u540c\u3058DB\u3092\u89e6\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3042\u305f\u308a\u3001\u69d8\u3005\u5229\u7528\u3067\u304d\u305d\u3046\u3067\u5922\u304c\u81a8\u3089\u307f\u307e\u3059\u3002\n\u3053\u308c\u3089\u306e\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u306fgetContentResolver().query()\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u793a\u3059URI\u3092\u6307\u5b9a\u3057\u3066Cursor\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305d\u3046\u3067\u3059\u3002\n\nURI\nURI\u3068\u306f\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u793a\u3059\u305f\u3081\u306b\u4f7f\u308f\u308c\u308b\u3082\u306e\u3067\u3059\u3002PC\u3067\u3042\u308c\u3070\u30d5\u30a1\u30a4\u30eb\u3092\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u6307\u5b9a\u3059\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001Andoroid\u3067\u306fURI\u3067\u6307\u5b9a\u3059\u308b\u3068\u3044\u3063\u305f\u611f\u3058\u3060\u3068\u601d\u3044\u307e\u3059(\u9069\u5f53)\u3002\nContent Provider\u306eURI\u306f3\u3064\u306e\u8981\u7d20\u304b\u3089\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n(\u4f8b) content://packagename.providername/sample\n\nprefix\uff1a\"content://\"\nauthority(\u30d1\u30c3\u30b1\u30fc\u30b8\u540d+\u4efb\u610f\u306eprovider\u540d)\uff1a\"packagename.providername\"\ntable\uff1a\"sample\"\n\nauthority\u306f\u4e16\u754c\u3067\u552f\u4e00\u306e\u540d\u524d\u306b\u306a\u308b\u306e\u304c\u597d\u307e\u3057\u3044\u3089\u3057\u304f\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u540d+provider\u540d\u3067\u3064\u3051\u308b\u306e\u304c\u826f\u3044\u3089\u3057\u3044\u3067\u3059\u3002\n\nSQLiteOpenHelper, BaseColumns\nContent Provider\u3092\u4f5c\u6210\u3059\u308b\u524d\u306bDB\u304c\u7121\u3044\u3068\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3082\u4fdd\u5b58\u3082\u305d\u3082\u305d\u3082\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5143\u3068\u306a\u308bDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u308c\u306b\u306fSQLiteOpenHelper\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nDB\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306fDB\u306e\u540d\u524d\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u540d\u524d\u3001\u30ab\u30e9\u30e0\u306a\u3069\u3092BaseColumns\u3092implements\u3057\u305f\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3066\u66f8\u304f\u306e\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u6271\u3046DB\u3092\u8003\u3048\u307e\u3059\u3002\u540d\u524d\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3060\u3051\u306e\u30b7\u30f3\u30d7\u30eb\u306aDB\u3067\u3059\u3002\n\nColumns\npublic class UserColumns implements BaseColumns{\n    // URI\u30d1\u30b9\n    public static final String PATH = \"user\";\n    // \u30b3\u30f3\u30c6\u30f3\u30c8URI\n    public static final Uri CONTENT_URI = Uri.parse(\"content://\" + MyContentProvider.AUTHORITY + \"/\" + PATH);\n    // \u30c6\u30fc\u30d6\u30eb\u6307\u5b9a\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\n    public static final String CONTENT_TYPE = \"vnd.android.cursor.item/vnd.example.users\";\n    // \u30ec\u30b3\u30fc\u30c9\u500b\u5225\u6307\u5b9a\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\n    public static final String CONTENT_ITEM_TYPE = \"vnd.android.cursor.dir/vnd.example.users\";\n\n    // \u30c6\u30fc\u30d6\u30eb\u540d\n    public static final String TABLE = \"users\";\n    // \u30ab\u30e9\u30e0 \u540d\u524d\n    public static final String NAME = \"name\";\n    // \u30ab\u30e9\u30e0 \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n    public static final String EMAIL = \"email\";\n\n    // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf(\u547c\u3070\u308c\u308b\u3053\u3068\u306f\u7121\u3044)\n    private RecordColumns() {}\n}\n\n\n\nSQLiteOpenHelper\npublic class UserDBHelper extends SQLiteOpenHelper{\n    // DB\u540d\u3068\u30d0\u30fc\u30b8\u30e7\u30f3\n    private static final String DB_NAME = \"database\";\n    private static final int DB_VERSION = 1;\n\n    // \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n    public UserDBHelper(Context context){\n        super(context, DB_NAME, null, DB_VERSION);\n    }\n\n    @Override\n    public void onCreate(SQLiteDatabase sqLiteDatabase) {\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n        sqLiteDatabase.execSQL(/* TODO */);\n    }\n\n    @Override\n    public void onUpgrade(SQLiteDatabase sqLiteDatabase, int i, int i2) {\n        // DB\u306b\u5909\u66f4\u304c\u3042\u3063\u305f\u3068\u304d\u306b\u547c\u3070\u308c\u308b\n    }\n}\n\n\n\nContent Provider\nDB\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u3044\u3088\u3044\u3088Content Provider\u306e\u8aac\u660e\u306b\u5165\u308a\u307e\u3059\u3002\nContent Provider\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u306f\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n- onCreate() .. \u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u521d\u671f\u5316\n- query() .. \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3002\u623b\u308a\u5024\u306fCursor\n- insert() .. \u884c\u3092\u8ffd\u52a0\u3002\u623b\u308a\u5024\u306f\u65b0\u305f\u306b\u8ffd\u52a0\u3055\u308c\u305f\u884c\u306eURI\n- update() .. \u5404\u884c\u3092\u66f4\u65b0\u3002\u623b\u308a\u5024\u306f\u66f4\u65b0\u3057\u305f\u884c\u306e\u6570\n- delete() .. \u884c\u3092\u524a\u9664\u3002\u623b\u308a\u5024\u306f\u524a\u9664\u3057\u305f\u884c\u306e\u6570\n- getType() .. ContentURI\u306b\u5bfe\u5fdc\u3059\u308bMIME\u30bf\u30a4\u30d7\u3092\u8fd4\u3059\n\u3060\u3044\u305f\u3044\u306e\u5f62\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306b\u306f\u53d7\u3051\u53d6\u3063\u305fUri\u3092UriMatcher\u3092\u7528\u3044\u3066\u30de\u30c3\u30c1\u30f3\u30b0\u3057\u3001\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092switch\u6587\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002UriMatcher\u30af\u30e9\u30b9\u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u30d7\u30ed\u30d0\u30a4\u30c0\u306eURI\u306e\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30af\u30e9\u30b9\u3067\u3059\u3002\n\nContentProvider\npublic class UserContentProvider extends ContentProider{\n    // Authority\n    public static final String AUTHORITY = \"com.example\";\n\n    // USERS \u30c6\u30fc\u30d6\u30eb URI ID\n    private static final int USERS = 1;\n    // USERS \u30c6\u30fc\u30d6\u30eb \u500b\u5225 URI ID\n    private static final int USER_ID = 2;\n\n    // \u5229\u7528\u8005\u304c\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u305fURI\u306b\u5bfe\u5fdc\u3059\u308b\u51e6\u7406\u3092\u5224\u5b9a\u51e6\u7406\u306b\u4f7f\u7528\u3057\u307e\u3059\n    private static UriMatcher sUriMatcher;\n    static {\n        sUriMatcher = new UriMatcher(UriMatcher.NO_MATCH);\n        sUriMatcher.addURI(AUTHORITY, UserColumns.PATH, USERS);\n        sUriMatcher.addURI(AUTHORITY, UserColumns.PATH + \"/#\", USER_ID);\n    }\n\n    // DBHelper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n    private UserDBHelper mDBHelper;\n\n    // \u30b3\u30f3\u30c6\u30f3\u30c4\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u4f5c\u6210\n    @Override\n    public boolean onCreate() {\n        mDBHelper = new UserDBHelper(getContext());\n        return true;\n    }\n\n    // query\u5b9f\u884c\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {\n        SQLiteQueryBuilder queryBuilder = new SQLiteQueryBuilder();\n        switch (sUriMatcher.match(uri)) {\n            case USERS:\n            case USER_ID:\n                queryBuilder.setTables(UserColumns.TABLE);\n                break;\n            default:\n                throw new IllegalArgumentException(\"Unknown URI \" + uri);\n        }\n\n        SQLiteDatabase db = mDBHelper.getReadableDatabase();\n        Cursor cursor = queryBuilder.query(db, projection, selection, selectionArgs, null, null, sortOrder);\n        return cursor;\n    }\n\n    // insert\u5b9f\u884c\n    @Override\n    public Uri insert(Uri uri, ContentValues values) {\n        String insertTable;\n        Uri contentUri;\n        switch (sUriMatcher.match(uri)) {\n            case USERS:\n                insertTable = UserColumns.TABLE;\n                contentUri = UserColumns.CONTENT_URI;\n                break;\n            default:\n                throw new IllegalArgumentException(\"Unknown URI \" + uri);\n        }\n\n        SQLiteDatabase db = mDBHelper.getWritableDatabase();\n        long rowId = db.insert(insertTable, null, values);\n        if (rowId > 0) {\n            Uri returnUri = ContentUris.withAppendedId(contentUri, rowId);\n            getContext().getContentResolver().notifyChange(returnUri, null);\n            return returnUri;\n        } else {\n            throw new IllegalArgumentException(\"Failed to insert row into \" + uri);\n        }\n    }\n\n    // update\u5b9f\u884c\n    @Override\n    public int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) {\n        SQLiteDatabase db = mDBHelper.getWritableDatabase();\n        int count;\n        String id = uri.getPathSegments().get(1);\n        count = db.update(RecordColumns.TABLE, values, selection, selectionArgs);\n        getContext().getContentResolver().notifyChange(uri, null);\n        return count;\n    }\n\n    // delete\u5b9f\u884c\n    @Override\n    public int delete(Uri uri, String selection, String[] selectionArgs) {\n        SQLiteDatabase db = mDBHelper.getWritableDatabase();\n        int count;\n        switch (sUriMatcher.match(uri)) {\n            case USERS:\n            case USER_ID:\n                count = db.delete(RecordColumns.TABLE, selection, selectionArgs);\n                break;\n            default:\n                throw new IllegalArgumentException(\"Unknown URI \" + uri);\n        }\n        getContext().getContentResolver().notifyChange(uri, null);\n        return count;\n    }\n\n    // \u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\u53d6\u5f97\n    @Override\n    public String getType(Uri uri) {\n        switch(sUriMatcher.match(uri)) {\n            case USERS:\n                return UserColumns.CONTENT_TYPE;\n            case USER_ID:\n                return UserColumns.CONTENT_ITEM_TYPE;\n            default:\n                throw new IllegalArgumentException(\"Unknown URI \" + uri);\n        }\n    }\n}   \n\n\n\u307e\u305f\u3001Content Provider\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bAndroidManifest\u306b\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n<provider\n    android:authorities=\"com.example\" // URI\u306e\u5b9a\u7fa9\u3067\u5b9a\u7fa9\u3057\u305fauthorities\n    android:name=\"UserContentProvider\" // ContentProvider\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u306e\u540d\u524d\n    android:exported=\"false\"> // \u4ed6\u30a2\u30d7\u30ea\u3078\u306e\u516c\u958b/\u975e\u516c\u958b\u8a2d\u5b9a\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306ftrue\n</provider>\n\n\nContent Resolver\u306b\u3064\u3044\u3066\n\u3053\u308c\u3067Content Provider\u3092\u5229\u7528\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u305f\u308a\u4fdd\u5b58\u3057\u305f\u308a\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nContent Provider\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306b\u306fContent Resolver\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\nMainActibvity\npublic final class MainActivity extends Activity {\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        // \u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30fc\u30bf\u6295\u5165.\n        ContentValues values = new ContentValues();\n        for (int i = 0; i < 3; i++) {\n            values.clear();\n            values.put(UserColumns.NAME, \"name\" + i);\n            values.put(UserColumns.EMAIL, \"email\" + i);\n            getContentResolver().insert(UserColumns.CONTENT_URI, values);\n        }\n\n        // \u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u5168\u4ef6\u691c\u7d22. \u8868\u793a.\n        Cursor c = getContentResolver().query(UserColumns.CONTENT_URI, null, null, null, null);\n        startManagingCursor(c);\n        while (c.moveToNext()) {\n            for (int i = 0; i < c.getColumnCount(); i++) {\n                Log.d(getClass().getSimpleName(), c.getColumnName(i) + \" : \" + c.getString(i));\n            }\n        }\n    }\n}\n\n\n Android\u3067DB\u95a2\u4fc2\u3092\u5b9f\u88c5\u3059\u308b\u3068\u304d\u306b\u3088\u304f\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u52c9\u5f37\u3057\u305f\u3053\u3068\u3092\u307e\u3068\u3081\u307e\u3059\u3002\n\u81ea\u5206\u306fjava\u306f\u89e6\u3063\u305f\u3053\u3068\u304c\u3042\u308b\u304cAndroid\u306f\u521d\u3081\u3066\u3068\u3044\u3046\u4eba\u306a\u306e\u3067\u7d50\u69cb\u57fa\u672c\u7684\u306a\u3053\u3068\u304b\u3089\u66f8\u3044\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u3093\u306a\u3053\u3068\u77e5\u3063\u3066\u308b\u308f\uff01\u3063\u3066\u4eba\u306f\u6700\u521d\u306e\u65b9\u3092\u98db\u3070\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n## Content Provider\u3068\u306f\u4f55\u304b\nAndroid\u3067DB\u306b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97/\u4fdd\u5b58\u3059\u308b\u6642\u306b\u5229\u7528\u3059\u308b\u30af\u30e9\u30b9\u3067\u3059\u3002\n\u3053\u306e\u30af\u30e9\u30b9\u3092\u4f7f\u3048\u3070\u3001\u3042\u308b\u30a2\u30d7\u30ea\u304c\u6301\u3063\u3066\u3044\u308b\u30c7\u30fc\u30bf\u3092\u4ed6\u306e\u30a2\u30d7\u30ea\u3082\u4f7f\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u3082\u3068\u3082\u3068\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u306f\u3001\u7740\u4fe1\u30ed\u30b0\u3084\u96fb\u8a71\u5e33\u3001\u30d6\u30e9\u30a6\u30b6\u306e\u30d6\u30c3\u30af\u30de\u30fc\u30af\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002\n\u7570\u306a\u308b\u30a2\u30d7\u30ea\u3067\u540c\u3058DB\u3092\u89e6\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3042\u305f\u308a\u3001\u69d8\u3005\u5229\u7528\u3067\u304d\u305d\u3046\u3067\u5922\u304c\u81a8\u3089\u307f\u307e\u3059\u3002\n\u3053\u308c\u3089\u306e\u30c7\u30fc\u30bf\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u306fgetContentResolver().query()\u30e1\u30bd\u30c3\u30c9\u3067\u3001\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u793a\u3059URI\u3092\u6307\u5b9a\u3057\u3066Cursor\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305d\u3046\u3067\u3059\u3002\n\n## URI\nURI\u3068\u306f\u76ee\u7684\u306e\u30c7\u30fc\u30bf\u3092\u793a\u3059\u305f\u3081\u306b\u4f7f\u308f\u308c\u308b\u3082\u306e\u3067\u3059\u3002PC\u3067\u3042\u308c\u3070\u30d5\u30a1\u30a4\u30eb\u3092\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u6307\u5b9a\u3059\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001Andoroid\u3067\u306fURI\u3067\u6307\u5b9a\u3059\u308b\u3068\u3044\u3063\u305f\u611f\u3058\u3060\u3068\u601d\u3044\u307e\u3059(\u9069\u5f53)\u3002\n\nContent Provider\u306eURI\u306f3\u3064\u306e\u8981\u7d20\u304b\u3089\u69cb\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n(\u4f8b) content://packagename.providername/sample\n\n1. prefix\uff1a\"content://\"\n2. authority(\u30d1\u30c3\u30b1\u30fc\u30b8\u540d+\u4efb\u610f\u306eprovider\u540d)\uff1a\"packagename.providername\"\n3. table\uff1a\"sample\"\n\nauthority\u306f\u4e16\u754c\u3067\u552f\u4e00\u306e\u540d\u524d\u306b\u306a\u308b\u306e\u304c\u597d\u307e\u3057\u3044\u3089\u3057\u304f\u3001\u30d1\u30c3\u30b1\u30fc\u30b8\u540d+provider\u540d\u3067\u3064\u3051\u308b\u306e\u304c\u826f\u3044\u3089\u3057\u3044\u3067\u3059\u3002\n\n## SQLiteOpenHelper, BaseColumns\n\nContent Provider\u3092\u4f5c\u6210\u3059\u308b\u524d\u306bDB\u304c\u7121\u3044\u3068\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3082\u4fdd\u5b58\u3082\u305d\u3082\u305d\u3082\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u30c7\u30fc\u30bf\u63d0\u4f9b\u5143\u3068\u306a\u308bDB\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u3053\u308c\u306b\u306fSQLiteOpenHelper\u30af\u30e9\u30b9\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\nDB\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306fDB\u306e\u540d\u524d\u3084\u30c6\u30fc\u30d6\u30eb\u306e\u540d\u524d\u3001\u30ab\u30e9\u30e0\u306a\u3069\u3092BaseColumns\u3092implements\u3057\u305f\u30af\u30e9\u30b9\u306b\u307e\u3068\u3081\u3066\u66f8\u304f\u306e\u304c\u826f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067\u306f\u4f8b\u3068\u3057\u3066\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u6271\u3046DB\u3092\u8003\u3048\u307e\u3059\u3002\u540d\u524d\u3068\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3060\u3051\u306e\u30b7\u30f3\u30d7\u30eb\u306aDB\u3067\u3059\u3002\n\n```java:Columns\npublic class UserColumns implements BaseColumns{\n\t// URI\u30d1\u30b9\n\tpublic static final String PATH = \"user\";\n\t// \u30b3\u30f3\u30c6\u30f3\u30c8URI\n\tpublic static final Uri CONTENT_URI = Uri.parse(\"content://\" + MyContentProvider.AUTHORITY + \"/\" + PATH);\n\t// \u30c6\u30fc\u30d6\u30eb\u6307\u5b9a\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\n\tpublic static final String CONTENT_TYPE = \"vnd.android.cursor.item/vnd.example.users\";\n\t// \u30ec\u30b3\u30fc\u30c9\u500b\u5225\u6307\u5b9a\u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\n\tpublic static final String CONTENT_ITEM_TYPE = \"vnd.android.cursor.dir/vnd.example.users\";\n\n\t// \u30c6\u30fc\u30d6\u30eb\u540d\n\tpublic static final String TABLE = \"users\";\n\t// \u30ab\u30e9\u30e0 \u540d\u524d\n\tpublic static final String NAME = \"name\";\n\t// \u30ab\u30e9\u30e0 \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\n\tpublic static final String EMAIL = \"email\";\n\n\t// \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf(\u547c\u3070\u308c\u308b\u3053\u3068\u306f\u7121\u3044)\n\tprivate RecordColumns() {}\n}\n```\n\n```java:SQLiteOpenHelper\npublic class UserDBHelper extends SQLiteOpenHelper{\n\t// DB\u540d\u3068\u30d0\u30fc\u30b8\u30e7\u30f3\n\tprivate static final String DB_NAME = \"database\";\n\tprivate static final int DB_VERSION = 1;\n\n\t// \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n\tpublic UserDBHelper(Context context){\n\t\tsuper(context, DB_NAME, null, DB_VERSION);\n\t}\n\n\t@Override\n\tpublic void onCreate(SQLiteDatabase sqLiteDatabase) {\n\t\t// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\t\tsqLiteDatabase.execSQL(/* TODO */);\n\t}\n\n\t@Override\n\tpublic void onUpgrade(SQLiteDatabase sqLiteDatabase, int i, int i2) {\n\t\t// DB\u306b\u5909\u66f4\u304c\u3042\u3063\u305f\u3068\u304d\u306b\u547c\u3070\u308c\u308b\n\t}\n}\n```\n\n\n## Content Provider\nDB\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u3044\u3088\u3044\u3088Content Provider\u306e\u8aac\u660e\u306b\u5165\u308a\u307e\u3059\u3002\n\nContent Provider\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u306f\u4ee5\u4e0b\u306e\u30e1\u30bd\u30c3\u30c9\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n- onCreate() .. \u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u521d\u671f\u5316\n- query() .. \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3002\u623b\u308a\u5024\u306fCursor\n- insert() .. \u884c\u3092\u8ffd\u52a0\u3002\u623b\u308a\u5024\u306f\u65b0\u305f\u306b\u8ffd\u52a0\u3055\u308c\u305f\u884c\u306eURI\n- update() .. \u5404\u884c\u3092\u66f4\u65b0\u3002\u623b\u308a\u5024\u306f\u66f4\u65b0\u3057\u305f\u884c\u306e\u6570\n- delete() .. \u884c\u3092\u524a\u9664\u3002\u623b\u308a\u5024\u306f\u524a\u9664\u3057\u305f\u884c\u306e\u6570\n- getType() .. ContentURI\u306b\u5bfe\u5fdc\u3059\u308bMIME\u30bf\u30a4\u30d7\u3092\u8fd4\u3059\n\n\u3060\u3044\u305f\u3044\u306e\u5f62\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u57fa\u672c\u7684\u306b\u306f\u53d7\u3051\u53d6\u3063\u305fUri\u3092UriMatcher\u3092\u7528\u3044\u3066\u30de\u30c3\u30c1\u30f3\u30b0\u3057\u3001\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092switch\u6587\u3067\u8a18\u8ff0\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002UriMatcher\u30af\u30e9\u30b9\u306f\u30b3\u30f3\u30c6\u30f3\u30c4\u30d7\u30ed\u30d0\u30a4\u30c0\u306eURI\u306e\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30af\u30e9\u30b9\u3067\u3059\u3002\n\n\n```java:ContentProvider\npublic class UserContentProvider extends ContentProider{\n\t// Authority\n\tpublic static final String AUTHORITY = \"com.example\";\n\n\t// USERS \u30c6\u30fc\u30d6\u30eb URI ID\n\tprivate static final int USERS = 1;\n\t// USERS \u30c6\u30fc\u30d6\u30eb \u500b\u5225 URI ID\n\tprivate static final int USER_ID = 2;\n\t\n\t// \u5229\u7528\u8005\u304c\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u305fURI\u306b\u5bfe\u5fdc\u3059\u308b\u51e6\u7406\u3092\u5224\u5b9a\u51e6\u7406\u306b\u4f7f\u7528\u3057\u307e\u3059\n    private static UriMatcher sUriMatcher;\n    static {\n\t\tsUriMatcher = new UriMatcher(UriMatcher.NO_MATCH);\n\t\tsUriMatcher.addURI(AUTHORITY, UserColumns.PATH, USERS);\n\t\tsUriMatcher.addURI(AUTHORITY, UserColumns.PATH + \"/#\", USER_ID);\n    }\n\n\t// DBHelper\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\tprivate UserDBHelper mDBHelper;\n\n\t// \u30b3\u30f3\u30c6\u30f3\u30c4\u30d7\u30ed\u30d0\u30a4\u30c0\u306e\u4f5c\u6210\n\t@Override\n\tpublic boolean onCreate() {\n\t\tmDBHelper = new UserDBHelper(getContext());\n\t\treturn true;\n\t}\n\n\t// query\u5b9f\u884c\n\t@Override\n\tpublic Cursor query(Uri uri, String[] projection, String selection, String[] selectionArgs, String sortOrder) {\n\t\tSQLiteQueryBuilder queryBuilder = new SQLiteQueryBuilder();\n\t\tswitch (sUriMatcher.match(uri)) {\n\t\t\tcase USERS:\n\t\t\tcase USER_ID:\n\t\t\t\tqueryBuilder.setTables(UserColumns.TABLE);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new IllegalArgumentException(\"Unknown URI \" + uri);\n\t\t}\n\n\t\tSQLiteDatabase db = mDBHelper.getReadableDatabase();\n\t\tCursor cursor = queryBuilder.query(db, projection, selection, selectionArgs, null, null, sortOrder);\n\t\treturn cursor;\n\t}\n\n\t// insert\u5b9f\u884c\n\t@Override\n\tpublic Uri insert(Uri uri, ContentValues values) {\n\t\tString insertTable;\n\t\tUri contentUri;\n\t\tswitch (sUriMatcher.match(uri)) {\n\t\t\tcase USERS:\n\t\t\t\tinsertTable = UserColumns.TABLE;\n\t\t\t\tcontentUri = UserColumns.CONTENT_URI;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new IllegalArgumentException(\"Unknown URI \" + uri);\n\t\t}\n\n\t\tSQLiteDatabase db = mDBHelper.getWritableDatabase();\n\t\tlong rowId = db.insert(insertTable, null, values);\n\t\tif (rowId > 0) {\n\t\t\tUri returnUri = ContentUris.withAppendedId(contentUri, rowId);\n\t\t\tgetContext().getContentResolver().notifyChange(returnUri, null);\n\t\t\treturn returnUri;\n\t\t} else {\n\t\t\tthrow new IllegalArgumentException(\"Failed to insert row into \" + uri);\n\t\t}\n\t}\n\n\t// update\u5b9f\u884c\n\t@Override\n\tpublic int update(Uri uri, ContentValues values, String selection, String[] selectionArgs) {\n\t\tSQLiteDatabase db = mDBHelper.getWritableDatabase();\n\t\tint count;\n\t\tString id = uri.getPathSegments().get(1);\n\t\tcount = db.update(RecordColumns.TABLE, values, selection, selectionArgs);\n\t\tgetContext().getContentResolver().notifyChange(uri, null);\n\t\treturn count;\n\t}\n\n\t// delete\u5b9f\u884c\n\t@Override\n\tpublic int delete(Uri uri, String selection, String[] selectionArgs) {\n\t\tSQLiteDatabase db = mDBHelper.getWritableDatabase();\n\t\tint count;\n\t\tswitch (sUriMatcher.match(uri)) {\n\t\t\tcase USERS:\n\t\t\tcase USER_ID:\n\t\t\t\tcount = db.delete(RecordColumns.TABLE, selection, selectionArgs);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new IllegalArgumentException(\"Unknown URI \" + uri);\n\t\t}\n\t\tgetContext().getContentResolver().notifyChange(uri, null);\n\t\treturn count;\n\t}\n\n\t// \u30b3\u30f3\u30c6\u30f3\u30c8\u30bf\u30a4\u30d7\u53d6\u5f97\n\t@Override\n\tpublic String getType(Uri uri) {\n\t\tswitch(sUriMatcher.match(uri)) {\n\t\t\tcase USERS:\n\t\t\t\treturn UserColumns.CONTENT_TYPE;\n\t\t\tcase USER_ID:\n\t\t\t\treturn UserColumns.CONTENT_ITEM_TYPE;\n\t\t\tdefault:\n\t\t\t\tthrow new IllegalArgumentException(\"Unknown URI \" + uri);\n\t\t}\n\t}\n}\t\n```\n\n\n\u307e\u305f\u3001Content Provider\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306bAndroidManifest\u306b\u5b9a\u7fa9\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```AndroidManifest\n<provider\n\tandroid:authorities=\"com.example\" // URI\u306e\u5b9a\u7fa9\u3067\u5b9a\u7fa9\u3057\u305fauthorities\n\tandroid:name=\"UserContentProvider\" // ContentProvider\u3092\u7d99\u627f\u3057\u305f\u30af\u30e9\u30b9\u306e\u540d\u524d\n\tandroid:exported=\"false\"> // \u4ed6\u30a2\u30d7\u30ea\u3078\u306e\u516c\u958b/\u975e\u516c\u958b\u8a2d\u5b9a\u3002\u30c7\u30d5\u30a9\u30eb\u30c8\u306ftrue\n</provider>\n```\n\n\n## Content Resolver\u306b\u3064\u3044\u3066\n\u3053\u308c\u3067Content Provider\u3092\u5229\u7528\u3059\u308b\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u305f\u308a\u4fdd\u5b58\u3057\u305f\u308a\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nContent Provider\u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u305f\u3081\u306b\u306fContent Resolver\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```java:MainActibvity\npublic final class MainActivity extends Activity {\n    @Override\n    public void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.main);\n\n        // \u30c6\u30fc\u30d6\u30eb\u306b\u30c7\u30fc\u30bf\u6295\u5165.\n        ContentValues values = new ContentValues();\n        for (int i = 0; i < 3; i++) {\n            values.clear();\n            values.put(UserColumns.NAME, \"name\" + i);\n            values.put(UserColumns.EMAIL, \"email\" + i);\n            getContentResolver().insert(UserColumns.CONTENT_URI, values);\n        }\n\n        // \u30c6\u30fc\u30d6\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u5168\u4ef6\u691c\u7d22. \u8868\u793a.\n        Cursor c = getContentResolver().query(UserColumns.CONTENT_URI, null, null, null, null);\n        startManagingCursor(c);\n        while (c.moveToNext()) {\n            for (int i = 0; i < c.getColumnCount(); i++) {\n                Log.d(getClass().getSimpleName(), c.getColumnName(i) + \" : \" + c.getString(i));\n            }\n        }\n    }\n}\n```\n", "tags": ["Android", "ContentProvider", "sqlite", "android\u958b\u767a", "URI"]}