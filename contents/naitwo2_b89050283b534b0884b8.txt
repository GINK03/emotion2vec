{"context": "\n\n\u306f\u3058\u3081\u306b\n\u5c11\u3057\u524d\u306e\u60c5\u5831\u3067\u3059\u304c\u3001\u682a\u5f0f\u4f1a\u793e\u30e9\u30c3\u30af\u793e\u304b\u3089DNS\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30a6\u30a3\u30eb\u30b9\u306b\u3064\u3044\u3066\u306e\u6ce8\u610f\u559a\u8d77\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u25a0\u9060\u9694\u64cd\u4f5c\u30a6\u30a4\u30eb\u30b9\u306e\u5236\u5fa1\u306bDNS\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u6848\u3078\u306e\u6ce8\u610f\u559a\u8d77\nhttp://www.lac.co.jp/security/alert/2016/02/01_alert_01.html\n\u8a18\u4e8b\u4e2d\u306b\u305d\u306e\u30a6\u30a3\u30eb\u30b9\u3078\u306e\u5bfe\u5fdc\u6cd5\u306b\u3064\u3044\u3066\u8a18\u8f09\u304c\u3042\u308a\u3001\u305d\u306e1\u3064\u306b\u300c\u5185\u90e8DNS\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304b\u3089\u4e0d\u6b63\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u767a\u898b\u3059\u308b\uff08\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\uff09\u300d\u304c\u3042\u3052\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u672c\u4e8b\u6848\u4ee5\u5916\u3067\u3082\u3001\u591a\u304f\u306e\u30de\u30eb\u30a6\u30a7\u30a2\u306f\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3044C\uff06C\u30b5\u30fc\u30d0\u3068\u3084\u308a\u53d6\u308a\u3092\u884c\u3046\u305f\u3081\u3001DNS\u901a\u4fe1\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u306f\u3001\u8abf\u67fb\u306b\u304a\u3044\u3066\u91cd\u8981\u306a\u60c5\u5831\u306b\u306a\u308b\u3068\u8003\u3048\u307e\u3059\u3002\nDNS\u901a\u4fe1\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\u3068\u3044\u3063\u3066\u3082\u3001\u5358\u7d14\u306a\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u3060\u3068\u3001\u95b2\u89a7\u3057\u306b\u304f\u3044\uff08\u5f8c\u3067\u60c5\u5831\u3092\u8ffd\u3046\u6642\u306b\u6642\u9593\u304c\u639b\u304b\u308b\uff09\u7b49\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u30aa\u30fc\u30d7\u30f3\u30fb\u30bd\u30fc\u30b9\u30d7\u30ed\u30c0\u30af\u30c8\u3092\u4f7f\u7528\u3057\u3066\u3001\u95b2\u89a7\u304c\u3057\u3084\u3059\u3044\u4ed5\u7d44\u307f\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nPacketbeat\nElasticsearch\nKibana\n\n\n\u30d7\u30ed\u30c0\u30af\u30c8\u8aac\u660e\n\"Packetbeat\"\u306f\u3001elastic\u793e\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30d1\u30b1\u30c3\u30c8\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u300cBeats\u300d\u3068\u3044\u3046\u30d7\u30ed\u30c0\u30af\u30c8\u90e1\u306e1\u3064\u3067\u3001\"Packetbeat\"\u306e\u4ed6\u306b\"Filebeat\"\u3001\"Metricbeat\"\u3001\"Topbeat\"\u3001\"Winlogbeat\"\u304c\u3042\u308a\u307e\u3059\u3002\nhttps://www.elastic.co/products/beats/packetbeat\n\"Elasticsearch\"\u3001\"Kibana\"\u3082elastic\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3001\"Elasticsearch\"\u306f\u5168\u6587\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u3001\"Kibana\"\u306f\u30ed\u30b0\u53ef\u8996\u5316\u30c4\u30fc\u30eb\u3067\u3059\u3002\nhttps://www.elastic.co/products/elasticsearch\nhttps://www.elastic.co/products/kibana\n\n\u69cb\u6210\n\n\u9752\u3044\u77e2\u5370\uff1aDNS\u30af\u30a8\u30ea\u3001\u5fdc\u7b54\u901a\u4fe1\n\u8d64\u3044\u77e2\u5370\uff1aPacketbeat\u304b\u3089Elasticsearch\u3078\u306e\u30ed\u30b0\u8ee2\u9001\u901a\u4fe1\n\u7dd1\u306e\u77e2\u5370\uff1a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089Kibana\uff08WebUI\uff09\u3078\u306e\u30a2\u30af\u30bb\u30b9\u901a\u4fe1\n\n\u25cfDNS Server\n CentOS 7.2\n Packetbeat 1.2.3\n\u25cfElasticsearch/Kibana Server\n CentOS 7.2\n Elasticsearch 2.3.5\n Kibana 2.5.4\n\n\u4eca\u56de\u691c\u8a3c\u306f\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30b9\u30a4\u30c3\u30c1\u3067\u30df\u30e9\u30fc\u30dd\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u3001Packetbeat Server\u3078\u30d1\u30b1\u30c3\u30c8\u3092\u6d41\u3057\u3066\u3042\u3052\u308c\u3070\u3001\u4e0a\u306e\u69cb\u6210\u3068\u540c\u3058\u304fDNS\u901a\u4fe1\u306e\u53ef\u8996\u5316\u304c\u53ef\u80fd\u306a\u306f\u305a\u3067\u3059\u3002DNS\u30b5\u30fc\u30d0\u306e\u8ca0\u8377\u3092\u8003\u3048\u308b\u3068\u3053\u306e\u69cb\u6210\u306e\u307b\u3046\u304c\u73fe\u5b9f\u7684\u3067\u3059\u306d\u3002\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30fb \u4eca\u56de\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u7d30\u304b\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574\u306f\u5272\u611b\u3057\u3066\u3044\u307e\u3059\u3002\n\u30fb Firewalld\u306f\u505c\u6b62\u3055\u305b\u3066\u3044\u308b\u60f3\u5b9a\u3067\u3059\u3002\uff08systemctl stop firewalld\uff09\n\n\nPacketbeat\n\"DNS Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nsudo yum install libpcap\ncurl -L -O https://download.elastic.co/beats/packetbeat/packetbeat-1.2.3-x86_64.rpm\nsudo rpm -vi packetbeat-1.2.3-x86_64.rpm\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n/etc/packetbeat/packetbeat.yml\n\nProtocols\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u201d ports: [53]\u201d\u304c\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fDNS\u4ee5\u5916\u306e\u30ed\u30b0\u306f\u53d6\u5f97\u3057\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u4ed6\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u884c\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\u203bports: [80, 8080, 8000, 5000, 8002]\u7b49\n<\u7565>\n############################# Protocols #######################################\nprotocols:\n  dns:\n    # Configure the ports where to listen for DNS traffic. You can disable\n    # the DNS protocol by commenting out the list of ports.\n    ports: [53]\n<\u7565>\n  http:\n    # Configure the ports where to listen for HTTP traffic. You can disable\n    # the HTTP protocol by commenting out the list of ports.\n    #ports: [80, 8080, 8000, 5000, 8002]\n<\u7565>\n  memcache:\n    # Configure the ports where to listen for memcache traffic. You can disable\n    # the Memcache protocol by commenting out the list of ports.\n    #ports: [11211]\n<\u7565>\n  mysql:\n    # Configure the ports where to listen for MySQL traffic. You can disable\n    # the MySQL protocol by commenting out the list of ports.\n    #ports: [3306]\n\n  pgsql:\n    # Configure the ports where to listen for Pgsql traffic. You can disable\n    # the Pgsql protocol by commenting out the list of ports.\n    #ports: [5432]\n\n  redis:\n    # Configure the ports where to listen for Redis traffic. You can disable\n    # the Redis protocol by commenting out the list of ports.\n    #ports: [6379]\n\n  thrift:\n    # Configure the ports where to listen for Thrift-RPC traffic. You can disable\n    # the Thrift-RPC protocol by commenting out the list of ports.\n    #ports: [9090]\n\n  mongodb:\n    # Configure the ports where to listen for MongoDB traffic. You can disable\n    # the MongoDB protocol by commenting out the list of ports.\n    #ports: [27017]\n\n\u6b21\u306b\u3001Output\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u60c5\u5831\u9001\u4fe1\u5148\uff08Elasticsearch\uff09\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u9001\u4fe1\u5148\u3068\u3057\u3066\u3001Elasticsearch/Kibana Server\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n<\u7565>\n############################# Output ##########################################\n\n# Configure what outputs to use when sending the data collected by the beat.\n# Multiple outputs may be used.\noutput:\n\n  ### Elasticsearch as output\n  elasticsearch:\n    # Array of hosts to connect to.\n    # Scheme and port can be left out and will be set to the default (http and 9200)\n    # In case you specify and additional path, the scheme is required: http://localhost:9200/path\n    # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200\n    #hosts: [\"localhost:9200\"]\n    hosts: [\"192.168.1.18:9200\"]\n\n<\u7565>\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Packetbeat\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nsudo systemctl start packetbeat\n\n\nElasticsearch\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nsudo yum install -y java\n\nsudo cat <<EOF> /etc/yum.repos.d/elasticsearch.repo\n[elasticsearch-2.x]\nname=Elasticsearch repository for 2.x packages\nbaseurl=http://packages.elastic.co/elasticsearch/2.x/centos\ngpgcheck=1\ngpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nEOF\n\nsudo yum install elasticsearch-2.3.5\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n/etc/elasticsearch/elasticsearch.yml\n\nNetwork\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u201dnetwork.host\u201d\u306b\"Elasticsearch/Kibana Server\"\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n<\u7565>\n# ---------------------------------- Network -----------------------------------\n#\n# Set the bind address to a specific IP (IPv4 or IPv6):\n#\nnetwork.host: 192.168.1.18\n#\n# Set a custom port for HTTP:\n#\n# http.port: 9200\n#\n# For more information, see the documentation at:\n# <http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html>\n<\u7565>\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Elasticsearch\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nsudo systemctl start elasticsearch\n\n\nKibana\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nsudo cat <<EOF> /etc/yum.repos.d/kibana.repo\n[kibana-4.5]\nname=Kibana repository for 4.5.x packages\nbaseurl=http://packages.elastic.co/kibana/4.5/centos\ngpgcheck=1\ngpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nEOF\n\nsudo yum install kibana-4.5.4\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n/opt/kibana/config/kibana.yml\n\n\"elasticsearch.url\"\u306b\"Elasticsearch/Kibana Server\"\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n<\u7565>\n# The Elasticsearch instance to use for all your queries.\nelasticsearch.url: \"http://192.168.1.18:9200\"\n\n# preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,\n# then the host you use to connect to *this* Kibana instance will be sent.\n# elasticsearch.preserveHost: true\n<\u7565>\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Kibana\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\nsudo systemctl start kibana\n\n\nElasticsearch\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5b9a\u7fa9\nElasticsearch\u3067\u3001Packetbeat\u3067\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092\u6271\u3046\u305f\u3081\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\"DNS Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\ncurl -XPUT 'http://192.168.1.18:9200/_template/packetbeat' -d@/etc/packetbeat/packetbeat.template.json\n\n{\"acknowledged\":true}\n\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u304c\u201d{\"acknowledged\":true}\u201d\u3068\u306a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nKibana\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u5b9a\u7fa9\nKibana\u3067\u30ed\u30b0\u53ef\u8996\u5316\u306b\u4f7f\u7528\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\u203bElastic\u793e\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\ncurl -L -O http://download.elastic.co/beats/dashboards/beats-dashboards-1.2.3.zip\nunzip beats-dashboards-1.2.3.zip\ncd beats-dashboards-1.2.3/\n./load.sh\n\n\u203bPacketbeat\u4ee5\u5916\u306eBeats\u30b7\u30ea\u30fc\u30ba\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\n\nKibana\u3078\u30a2\u30af\u30bb\u30b9\nKibana\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\nhttp://192.168.1.18:5601/\n\n\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5de6\u30e1\u30cb\u30e5\u30fc\u304b\u3089\"packetbeat-*\"\u3092\u9078\u629e\u3057\u3001\u53f3\u30e1\u30cb\u30e5\u30fc\u306b\u8868\u793a\u3055\u308c\u308b\u753b\u9762\u3067\u30b9\u30bf\u30fc\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n\u4e0a\u30e1\u30cb\u30e5\u30fc\u306e\"Discover\"\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\"DNS Server\"\u304b\u3089\u306e\u30ed\u30b0\u3092\u53d7\u4fe1\u3001\u683c\u7d0d\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u53d7\u4fe1\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\"DNS Server\"\u304cDNS\u30af\u30a8\u30ea\u3092\u53d7\u4fe1\u3067\u304d\u3066\u3044\u308b\u304b\u3001\u201dPacketbeat\u201d\u304b\u3089\"Elasticsearch/Kibana Server\"\u306b\u30ed\u30b0\u304c\u8ee2\u9001\u3055\u308c\u3066\u3044\u308b\u304b\u7b49\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\n\u6b21\u306b\u3001\u4e0a\u30e1\u30cb\u30e5\u30fc\u306e\"Dashbord\"\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u753b\u9762\u306e\u53f3\u4e0a\u306b\u3042\u308b\u30d5\u30a9\u30eb\u30c0\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n\nDashbord\u306e\u9078\u629e\u30e1\u30cb\u30e5\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u201dPacketbeat Dashboard\u201d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n\u201dPacketbeat Dashboard\u201d\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\n\nDNS\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u308b\n\u201dPacketbeat Dashboard\u201d\u306fDNS\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306f\u306a\u3044\u305f\u3081\u3001\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u203b\u7d9a\u304d\u306f\u6b21\u56de\u306e\u8a18\u4e8b\u3067\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u306f\u3058\u3081\u306b\n\u5c11\u3057\u524d\u306e\u60c5\u5831\u3067\u3059\u304c\u3001\u682a\u5f0f\u4f1a\u793e\u30e9\u30c3\u30af\u793e\u304b\u3089DNS\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u305f\u30a6\u30a3\u30eb\u30b9\u306b\u3064\u3044\u3066\u306e\u6ce8\u610f\u559a\u8d77\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\n\u25a0\u9060\u9694\u64cd\u4f5c\u30a6\u30a4\u30eb\u30b9\u306e\u5236\u5fa1\u306bDNS\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3059\u308b\u4e8b\u6848\u3078\u306e\u6ce8\u610f\u559a\u8d77\nhttp://www.lac.co.jp/security/alert/2016/02/01_alert_01.html\n\n\u8a18\u4e8b\u4e2d\u306b\u305d\u306e\u30a6\u30a3\u30eb\u30b9\u3078\u306e\u5bfe\u5fdc\u6cd5\u306b\u3064\u3044\u3066\u8a18\u8f09\u304c\u3042\u308a\u3001\u305d\u306e1\u3064\u306b\u300c\u5185\u90e8DNS\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304b\u3089\u4e0d\u6b63\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u767a\u898b\u3059\u308b\uff08\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\uff09\u300d\u304c\u3042\u3052\u3089\u308c\u3066\u3044\u307e\u3059\u3002\n\u672c\u4e8b\u6848\u4ee5\u5916\u3067\u3082\u3001\u591a\u304f\u306e\u30de\u30eb\u30a6\u30a7\u30a2\u306f\u540d\u524d\u89e3\u6c7a\u3092\u884c\u3044C\uff06C\u30b5\u30fc\u30d0\u3068\u3084\u308a\u53d6\u308a\u3092\u884c\u3046\u305f\u3081\u3001DNS\u901a\u4fe1\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u306f\u3001\u8abf\u67fb\u306b\u304a\u3044\u3066\u91cd\u8981\u306a\u60c5\u5831\u306b\u306a\u308b\u3068\u8003\u3048\u307e\u3059\u3002\n\nDNS\u901a\u4fe1\u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3059\u308b\u3068\u3044\u3063\u3066\u3082\u3001\u5358\u7d14\u306a\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3\u3060\u3068\u3001\u95b2\u89a7\u3057\u306b\u304f\u3044\uff08\u5f8c\u3067\u60c5\u5831\u3092\u8ffd\u3046\u6642\u306b\u6642\u9593\u304c\u639b\u304b\u308b\uff09\u7b49\u306e\u554f\u984c\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4eca\u56de\u306f\u3001\u4ee5\u4e0b\u306e\u30aa\u30fc\u30d7\u30f3\u30fb\u30bd\u30fc\u30b9\u30d7\u30ed\u30c0\u30af\u30c8\u3092\u4f7f\u7528\u3057\u3066\u3001\u95b2\u89a7\u304c\u3057\u3084\u3059\u3044\u4ed5\u7d44\u307f\u3092\u4f5c\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n* Packetbeat\n* Elasticsearch\n* Kibana\n\n# \u30d7\u30ed\u30c0\u30af\u30c8\u8aac\u660e\n\n\n\"Packetbeat\"\u306f\u3001elastic\u793e\u304c\u63d0\u4f9b\u3057\u3066\u3044\u308b\u30d1\u30b1\u30c3\u30c8\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\u300cBeats\u300d\u3068\u3044\u3046\u30d7\u30ed\u30c0\u30af\u30c8\u90e1\u306e1\u3064\u3067\u3001\"Packetbeat\"\u306e\u4ed6\u306b\"Filebeat\"\u3001\"Metricbeat\"\u3001\"Topbeat\"\u3001\"Winlogbeat\"\u304c\u3042\u308a\u307e\u3059\u3002\n\n\nhttps://www.elastic.co/products/beats/packetbeat\n\n\"Elasticsearch\"\u3001\"Kibana\"\u3082elastic\u793e\u306e\u30d7\u30ed\u30c0\u30af\u30c8\u3067\u3001\"Elasticsearch\"\u306f\u5168\u6587\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u3001\"Kibana\"\u306f\u30ed\u30b0\u53ef\u8996\u5316\u30c4\u30fc\u30eb\u3067\u3059\u3002\n\nhttps://www.elastic.co/products/elasticsearch\nhttps://www.elastic.co/products/kibana\n\n# \u69cb\u6210\n\n![Packetbeat_\u69cb\u6210.png](https://qiita-image-store.s3.amazonaws.com/0/34809/1165a3b8-5534-a6ac-3074-8652c62d0ae5.png)\n\n\u9752\u3044\u77e2\u5370\uff1aDNS\u30af\u30a8\u30ea\u3001\u5fdc\u7b54\u901a\u4fe1\n\u8d64\u3044\u77e2\u5370\uff1aPacketbeat\u304b\u3089Elasticsearch\u3078\u306e\u30ed\u30b0\u8ee2\u9001\u901a\u4fe1\n\u7dd1\u306e\u77e2\u5370\uff1a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8PC\u304b\u3089Kibana\uff08WebUI\uff09\u3078\u306e\u30a2\u30af\u30bb\u30b9\u901a\u4fe1\n<br>\n\n\u25cfDNS Server\n CentOS 7.2\n Packetbeat 1.2.3\n\n\u25cfElasticsearch/Kibana Server\n CentOS 7.2\n Elasticsearch 2.3.5\n Kibana 2.5.4\n\n<br>\n\u4eca\u56de\u691c\u8a3c\u306f\u3057\u3066\u3044\u307e\u305b\u3093\u304c\u3001\u30b9\u30a4\u30c3\u30c1\u3067\u30df\u30e9\u30fc\u30dd\u30fc\u30c8\u3092\u8a2d\u5b9a\u3057\u3001Packetbeat Server\u3078\u30d1\u30b1\u30c3\u30c8\u3092\u6d41\u3057\u3066\u3042\u3052\u308c\u3070\u3001\u4e0a\u306e\u69cb\u6210\u3068\u540c\u3058\u304fDNS\u901a\u4fe1\u306e\u53ef\u8996\u5316\u304c\u53ef\u80fd\u306a\u306f\u305a\u3067\u3059\u3002DNS\u30b5\u30fc\u30d0\u306e\u8ca0\u8377\u3092\u8003\u3048\u308b\u3068\u3053\u306e\u69cb\u6210\u306e\u307b\u3046\u304c\u73fe\u5b9f\u7684\u3067\u3059\u306d\u3002\n![Packetbeat_\u69cb\u6210_\u30df\u30e9\u30fc\u30dd\u30fc\u30c8.png](https://qiita-image-store.s3.amazonaws.com/0/34809/c726d670-850a-3ec2-d551-eda79d857054.png)\n\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\n\u30fb \u4eca\u56de\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u7d30\u304b\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574\u306f\u5272\u611b\u3057\u3066\u3044\u307e\u3059\u3002\n\u30fb Firewalld\u306f\u505c\u6b62\u3055\u305b\u3066\u3044\u308b\u60f3\u5b9a\u3067\u3059\u3002\uff08systemctl stop firewalld\uff09\n```\n\n## Packetbeat\n\n\"DNS Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\nsudo yum install libpcap\ncurl -L -O https://download.elastic.co/beats/packetbeat/packetbeat-1.2.3-x86_64.rpm\nsudo rpm -vi packetbeat-1.2.3-x86_64.rpm\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```\n/etc/packetbeat/packetbeat.yml\n```\nProtocols\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u201d ports: [53]\u201d\u304c\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fDNS\u4ee5\u5916\u306e\u30ed\u30b0\u306f\u53d6\u5f97\u3057\u306a\u3044\u306e\u3067\u3001\u305d\u306e\u4ed6\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u884c\u306f\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3057\u307e\u3059\u3002\n\u203bports: [80, 8080, 8000, 5000, 8002]\u7b49\n\n```yaml\n<\u7565>\n############################# Protocols #######################################\nprotocols:\n  dns:\n    # Configure the ports where to listen for DNS traffic. You can disable\n    # the DNS protocol by commenting out the list of ports.\n    ports: [53]\n<\u7565>\n  http:\n    # Configure the ports where to listen for HTTP traffic. You can disable\n    # the HTTP protocol by commenting out the list of ports.\n    #ports: [80, 8080, 8000, 5000, 8002]\n<\u7565>\n  memcache:\n    # Configure the ports where to listen for memcache traffic. You can disable\n    # the Memcache protocol by commenting out the list of ports.\n    #ports: [11211]\n<\u7565>\n  mysql:\n    # Configure the ports where to listen for MySQL traffic. You can disable\n    # the MySQL protocol by commenting out the list of ports.\n    #ports: [3306]\n\n  pgsql:\n    # Configure the ports where to listen for Pgsql traffic. You can disable\n    # the Pgsql protocol by commenting out the list of ports.\n    #ports: [5432]\n\n  redis:\n    # Configure the ports where to listen for Redis traffic. You can disable\n    # the Redis protocol by commenting out the list of ports.\n    #ports: [6379]\n\n  thrift:\n    # Configure the ports where to listen for Thrift-RPC traffic. You can disable\n    # the Thrift-RPC protocol by commenting out the list of ports.\n    #ports: [9090]\n\n  mongodb:\n    # Configure the ports where to listen for MongoDB traffic. You can disable\n    # the MongoDB protocol by commenting out the list of ports.\n    #ports: [27017]\n```\n\n\u6b21\u306b\u3001Output\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u60c5\u5831\u9001\u4fe1\u5148\uff08Elasticsearch\uff09\u306e\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\u9001\u4fe1\u5148\u3068\u3057\u3066\u3001Elasticsearch/Kibana Server\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```yaml\n<\u7565>\n############################# Output ##########################################\n\n# Configure what outputs to use when sending the data collected by the beat.\n# Multiple outputs may be used.\noutput:\n\n  ### Elasticsearch as output\n  elasticsearch:\n    # Array of hosts to connect to.\n    # Scheme and port can be left out and will be set to the default (http and 9200)\n    # In case you specify and additional path, the scheme is required: http://localhost:9200/path\n    # IPv6 addresses should always be defined as: https://[2001:db8::1]:9200\n    #hosts: [\"localhost:9200\"]\n    hosts: [\"192.168.1.18:9200\"]\n    \n<\u7565>\n```\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Packetbeat\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\nsudo systemctl start packetbeat\n```\n\n## Elasticsearch\n\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\nsudo yum install -y java\n```\n\n```bash\nsudo cat <<EOF> /etc/yum.repos.d/elasticsearch.repo\n[elasticsearch-2.x]\nname=Elasticsearch repository for 2.x packages\nbaseurl=http://packages.elastic.co/elasticsearch/2.x/centos\ngpgcheck=1\ngpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nEOF\n```\n\n```bash\nsudo yum install elasticsearch-2.3.5\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```\n/etc/elasticsearch/elasticsearch.yml\n```\n\nNetwork\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3001\u201dnetwork.host\u201d\u306b\"Elasticsearch/Kibana Server\"\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```yaml\n<\u7565>\n# ---------------------------------- Network -----------------------------------\n#\n# Set the bind address to a specific IP (IPv4 or IPv6):\n#\nnetwork.host: 192.168.1.18\n#\n# Set a custom port for HTTP:\n#\n# http.port: 9200\n#\n# For more information, see the documentation at:\n# <http://www.elastic.co/guide/en/elasticsearch/reference/current/modules-network.html>\n<\u7565>\n```\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Elasticsearch\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\nsudo systemctl start elasticsearch\n```\n\n## Kibana\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\nsudo cat <<EOF> /etc/yum.repos.d/kibana.repo\n[kibana-4.5]\nname=Kibana repository for 4.5.x packages\nbaseurl=http://packages.elastic.co/kibana/4.5/centos\ngpgcheck=1\ngpgkey=http://packages.elastic.co/GPG-KEY-elasticsearch\nenabled=1\nEOF\n```\n\n```bash\nsudo yum install kibana-4.5.4\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5b8c\u4e86\u5f8c\u3001\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```yaml\n/opt/kibana/config/kibana.yml\n```\n\n\"elasticsearch.url\"\u306b\"Elasticsearch/Kibana Server\"\u306eIP\u30a2\u30c9\u30ec\u30b9\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n```yaml\n<\u7565>\n# The Elasticsearch instance to use for all your queries.\nelasticsearch.url: \"http://192.168.1.18:9200\"\n\n# preserve_elasticsearch_host true will send the hostname specified in `elasticsearch`. If you set it to false,\n# then the host you use to connect to *this* Kibana instance will be sent.\n# elasticsearch.preserveHost: true\n<\u7565>\n```\n\n\n\u8a2d\u5b9a\u5b8c\u4e86\u5f8c\u3001\"Kibana\"\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\nsudo systemctl start kibana\n```\n\n# Elasticsearch\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5b9a\u7fa9\n\nElasticsearch\u3067\u3001Packetbeat\u3067\u53d6\u5f97\u3057\u305f\u60c5\u5831\u3092\u6271\u3046\u305f\u3081\u306b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n\n\"DNS Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\ncurl -XPUT 'http://192.168.1.18:9200/_template/packetbeat' -d@/etc/packetbeat/packetbeat.template.json\n\n{\"acknowledged\":true}\n```\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u7d50\u679c\u304c\u201d{\"acknowledged\":true}\u201d\u3068\u306a\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n# Kibana\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u306e\u5b9a\u7fa9\n\nKibana\u3067\u30ed\u30b0\u53ef\u8996\u5316\u306b\u4f7f\u7528\u3059\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n\"Elasticsearch/Kibana Server\"\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\u203bElastic\u793e\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\n\n```bash\ncurl -L -O http://download.elastic.co/beats/dashboards/beats-dashboards-1.2.3.zip\nunzip beats-dashboards-1.2.3.zip\ncd beats-dashboards-1.2.3/\n./load.sh\n```\n\u203bPacketbeat\u4ee5\u5916\u306eBeats\u30b7\u30ea\u30fc\u30ba\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3059\n\n\n# Kibana\u3078\u30a2\u30af\u30bb\u30b9\n\nKibana\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n```http\nhttp://192.168.1.18:5601/\n```\n\n\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u5de6\u30e1\u30cb\u30e5\u30fc\u304b\u3089\"packetbeat-*\"\u3092\u9078\u629e\u3057\u3001\u53f3\u30e1\u30cb\u30e5\u30fc\u306b\u8868\u793a\u3055\u308c\u308b\u753b\u9762\u3067\u30b9\u30bf\u30fc\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n![Kibana_2.5.4.jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/e4873367-7794-29ae-4a63-1f1628e84d13.jpeg)\n<br>\n\u4e0a\u30e1\u30cb\u30e5\u30fc\u306e\"Discover\"\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\"DNS Server\"\u304b\u3089\u306e\u30ed\u30b0\u3092\u53d7\u4fe1\u3001\u683c\u7d0d\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\u53d7\u4fe1\u3067\u304d\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\"DNS Server\"\u304cDNS\u30af\u30a8\u30ea\u3092\u53d7\u4fe1\u3067\u304d\u3066\u3044\u308b\u304b\u3001\u201dPacketbeat\u201d\u304b\u3089\"Elasticsearch/Kibana Server\"\u306b\u30ed\u30b0\u304c\u8ee2\u9001\u3055\u308c\u3066\u3044\u308b\u304b\u7b49\u3092\u78ba\u8a8d\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\n\n![Kibana_2.5.4..jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/c9ab80b8-ab77-0c09-a33b-c2d1951a33da.jpeg)\n\n<br>\n\u6b21\u306b\u3001\u4e0a\u30e1\u30cb\u30e5\u30fc\u306e\"Dashbord\"\u3092\u30af\u30ea\u30c3\u30af\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u753b\u9762\u306e\u53f3\u4e0a\u306b\u3042\u308b\u30d5\u30a9\u30eb\u30c0\u30a2\u30a4\u30b3\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_081516_072415_PM.jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/d6712bf6-cc1c-bff6-5f29-34599f0d2db3.jpeg)\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8_081516_072505_PM.jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/c924f5cf-d9f7-b3f1-a9b0-b8d7b8305552.jpeg)\n\n\n<br>\nDashbord\u306e\u9078\u629e\u30e1\u30cb\u30e5\u30fc\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u201dPacketbeat Dashboard\u201d\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n![Kibana_2.5.4.jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/deb09d80-00bb-f5a0-6ae8-f0287c8132ed.jpeg)\n<br>\n\u201dPacketbeat Dashboard\u201d\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n![Kibana_2.5.4.jpg](https://qiita-image-store.s3.amazonaws.com/0/34809/dea9002a-0bde-a68b-c169-6ee27e3fa140.jpeg)\n\n\n# DNS\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u308b\n\n\u201dPacketbeat Dashboard\u201d\u306fDNS\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067\u306f\u306a\u3044\u305f\u3081\u3001\u5c02\u7528\u306e\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u203b\u7d9a\u304d\u306f\u6b21\u56de\u306e\u8a18\u4e8b\u3067\u66f8\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n", "tags": ["Elasticsearch", "Packetbeat", "kibana", "dns", "Security"]}