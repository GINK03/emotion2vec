{"tags": ["Node.js", "bot", "Hubot", "FacebookMessengerBot", "Heroku"], "context": "\n\n\u74b0\u5883\u69cb\u7bc9\n\n\u52d5\u304b\u3059\u74b0\u5883\u3092\u69cb\u7bc9\n\u57fa\u672c\u7684\u306a\u3068\u3053\u308d\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044 (Facebook Messenger Bot \u3092 Hubot \u3067\u69cb\u7bc9\u3057\u3066 Heroku \u3067\u52d5\u304b\u3059)\n\u305f\u3060\u3057\u3001\u524d\u8a18\u4e8b\u306e Adapter \u3067\u306f\u3001\u30ea\u30c3\u30c1\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u306f hubot-fb\u3092\u4f7f\u3044\u307e\u3059\n\nAdpter \u3092 Install\n$ npm install hubot-fb --save\n\n\nProcfile \u66f8\u304d\u63db\u3048\nHeroku \u3067\u5b9f\u884c\u3055\u305b\u308b\u969b\u306e Adapter \u306e\u6307\u5b9a\u3092\u5909\u66f4\u3059\u308b\u305f\u3081 Procefile \u3092\u66f8\u304d\u63db\u3048\u307e\u3059\n\nProcfile\nweb: bin/hubot -a fb\n\n\n\n\u5fc5\u8981\u306a\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\n\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059 (\u4ed6\u306b\u3082\u6709\u308a\u307e\u3059\u304c\u6700\u4f4e\u9650\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059 \u305d\u306e\u4ed6\u306f\u3053\u3061\u3089\u53c2\u7167)\n\n\n\nconfig variable\ntype\ndefault\ndescription\n\n\n\n\nFB_PAGE_ID\nstring\n-\nFacebook Page \u306e ID \u53f3\u306eURL\u304b\u3089\u53c2\u7167 https://www.facebook.com/<YOUR PAGE USERNAME>/info?tab=page_info.\n\n\nFB_APP_ID, FB_APP_SECRET\nstring\n-\nAPP ID \u3068\u3001APP Secret \u53f3\u306eURL\u304b\u3089\u53c2\u7167 https://developers.facebook.com/apps/.\n\n\nFB_WEBHOOK_BASE\nstring\n-\nWebhook \u306e \u30d9\u30fc\u30b9URL \u3053\u306e\u5024\u3068 FB_ROUTE_URL \u3092\u63a5\u7d9a\u3059\u308b\u3068 Webhook URL \u306b\u306a\u308b, [\u4f8b] FB_WEBHOOK_BASE=https://mybot.com \u3068 FB_ROUTE_URL=/webhook \u3092\u63a5\u7d9a\u3059\u308b\u3068 Webhook URL \u306f 'https://mybot.com/webhook' \u3068\u306a\u308b\n\n\nFB_PAGE_TOKEN\nstring\n-\n\nPage access token. \u3092\u53f3\u306eURL\u304b\u3089\u53d6\u5f97\u3059\u308b https://developers.facebook.com/apps/<YOUR APP ID>/messenger/.\n\n\nFB_ROUTE_URL\nstring\n/hubot/fb\nWebhook \u306e Root Path \u4eca\u56de\u306f '/webhook' \u3092\u8a2d\u5b9a\u3059\u308b\n\n\nFB_VERIFY_TOKEN\nstring\n-\nWebhook \u3092\u8a2d\u5b9a\u3057\u305f\u969b\u306e Veryfy Token \u3092\u6307\u5b9a\u3059\u308b \u4eca\u56de\u306f 'botapp' \u3092\u6307\u5b9a\u3059\u308b\n\n\n\n$ heroku config:set FB_PAGE_ID=<FB_PAGE_ID \u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_APP_ID=<FB_APP_ID\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_APP_SECRET=<FB_APP_SECRET\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_WEBHOOK_BASE=http://mybot.com\n$ heroku config:set FB_PAGE_TOKEN=<FB_PAGE_TOKEN\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_ROUTE_URL=/webhook\n$ heroku config:set FB_VERIFY_TOKEN=botapp\n\n\nScript \u3092\u66f8\u304f\n\n\u6587\u5b57\u5217\u3092\u8868\u793a\u3059\u308b\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    res.send '\u3061\u306f\u3053\u3093'\n\n\n\nButton \u5f62\u5f0f\u3067\u8868\u793a\u3059\u308b (Postback)\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306eButton Template\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    # attatchment \u306e\u69cb\u9020\u3092 richMsg \u4ee5\u4e0b\u306b\u5b9a\u7fa9\u3059\u308b\n    res.envelope.fb = {\n      richMsg: {\n      attachment: {\n        type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"\u304a\u304b\u3063\u3061\u306e\u4eca\u306e\u6c17\u5206\u3092\u6559\u3048\u3066\u307b\u3057\u3044\u3058\u3087\u3093\u3074\u30fc\",\n            buttons: [\n              {\n                type: \"payload\",\n                title: \"\u6700\u9ad8\"\n                payload: \"FEELING_SAIKOU\"\n              },\n              {\n                type: \"payload\",\n                title: \"\u3044\u3044\u611f\u3058\"\n                payload: \"FEELING_IIKANJI\"\n              },\n              {\n                type: \"payload\",\n                title: \"\u3044\u307e\u3044\u3061\"\n                payload: \"FEELING_IMAICHI\"\n              },\n            ]\n          }\n        }\n      }\n    }\n\n    res.send()\n\n\n\nButton \u5f62\u5f0f\u3067\u8868\u793a\u3059\u308b (URL Link)\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306eButton Template\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    # attatchment \u306e\u69cb\u9020\u3092 richMsg \u4ee5\u4e0b\u306b\u5b9a\u7fa9\u3059\u308b\n    res.envelope.fb = {\n      richMsg: {\n      attachment: {\n        type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"\u304a\u304b\u3063\u3061\u306e\u4eca\u306e\u6c17\u5206\u3092\u6559\u3048\u3066\u307b\u3057\u3044\u3058\u3087\u3093\u3074\u30fc\",\n            buttons: [\n              {\n                type: \"web_url\",\n                title: \"Gmo-research\"\n                url: \"http://gmo-research.jp\"\n              },\n              {\n                type: \"web_url\",\n                title: \"infoq.jp\"\n                url: \"http://infoq.jp\"\n              },\n            ]\n          }\n        }\n      }\n    }\n\n    res.send()\n\n\n\n\u753b\u50cf\u3092\u8868\u793a\u3059\u308b (URL\u6307\u5b9a)\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306eImage Attachment\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n    res.envelope.fb = {\n      richMsg: {\n        attachment: {\n          type: \"image\",\n          payload: {\n            url: \"(\u753b\u50cf\u3078\u306eURL)\"\n          }\n        }\n      }\n    }\n\n\n\n\n\u305d\u306e\u4ed6\n\u4ed6\u306b\u3082\u611f\u306a\u3082\u306e\u3082\u6709\u308a\u307e\u3059\n\n\nAudio Attachment (\u97f3\u58f0\u3092\u518d\u751f\u3055\u305b\u305f\u3044\u6642)\n\nVideo Attachment (\u6620\u50cf\u3092\u518d\u751f\u3055\u305b\u305f\u3044\u6642)\n\nGeneric Template (\u753b\u50cf\u3084\u30dc\u30bf\u30f3\u3092\u6df7\u5728\u3055\u305b\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3057\u305f\u3044\u6642)\n\nAirline Itinerary Template (\u30d5\u30e9\u30a4\u30c8\u30d7\u30e9\u30f3\u3092\u8868\u793a\u3059\u308b\u7684\u306a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff09\n\u306a\u3069\u306a\u3069\n\n\n## \u74b0\u5883\u69cb\u7bc9\n\n### \u52d5\u304b\u3059\u74b0\u5883\u3092\u69cb\u7bc9\n\u57fa\u672c\u7684\u306a\u3068\u3053\u308d\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u304f\u3060\u3055\u3044 **[(Facebook Messenger Bot \u3092 Hubot \u3067\u69cb\u7bc9\u3057\u3066 Heroku \u3067\u52d5\u304b\u3059)](http://qiita.com/okakam/items/882e76d863743105ee0e)**\n\u305f\u3060\u3057\u3001\u524d\u8a18\u4e8b\u306e Adapter \u3067\u306f\u3001\u30ea\u30c3\u30c1\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u306f **[hubot-fb](https://github.com/chen-ye/hubot-fb)**\u3092\u4f7f\u3044\u307e\u3059\n\n### Adpter \u3092 Install\n\n```bash\n$ npm install hubot-fb --save\n```\n\n### Procfile \u66f8\u304d\u63db\u3048\nHeroku \u3067\u5b9f\u884c\u3055\u305b\u308b\u969b\u306e Adapter \u306e\u6307\u5b9a\u3092\u5909\u66f4\u3059\u308b\u305f\u3081 Procefile \u3092\u66f8\u304d\u63db\u3048\u307e\u3059\n\n```text:Procfile\nweb: bin/hubot -a fb\n```\n\n### \u5fc5\u8981\u306a\u74b0\u5883\u5909\u6570\u3092\u8ffd\u52a0\n\n\u4ee5\u4e0b\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u307e\u3059 (\u4ed6\u306b\u3082\u6709\u308a\u307e\u3059\u304c\u6700\u4f4e\u9650\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059 \u305d\u306e\u4ed6\u306f**[\u3053\u3061\u3089](https://github.com/chen-ye/hubot-fb#configuration)**\u53c2\u7167)\n\n| config variable | type | default | description |\n|:-----|:------|:------|:-------|\n| **`FB_PAGE_ID`** | string | - | Facebook Page \u306e ID \u53f3\u306eURL\u304b\u3089\u53c2\u7167 `https://www.facebook.com/<YOUR PAGE USERNAME>/info?tab=page_info`. |\n| **`FB_APP_ID`, `FB_APP_SECRET`** | string | - | APP ID \u3068\u3001APP Secret \u53f3\u306eURL\u304b\u3089\u53c2\u7167 `https://developers.facebook.com/apps/`. |\n| **`FB_WEBHOOK_BASE`** | string | - | Webhook \u306e \u30d9\u30fc\u30b9URL \u3053\u306e\u5024\u3068 `FB_ROUTE_URL` \u3092\u63a5\u7d9a\u3059\u308b\u3068 Webhook URL \u306b\u306a\u308b, [\u4f8b] `FB_WEBHOOK_BASE=https://mybot.com` \u3068 `FB_ROUTE_URL=/webhook` \u3092\u63a5\u7d9a\u3059\u308b\u3068 Webhook URL \u306f 'https://mybot.com/webhook' \u3068\u306a\u308b |\n| **`FB_PAGE_TOKEN`** | string | - | [Page access token](https://developers.facebook.com/docs/messenger-platform/implementation#page_access_token). \u3092\u53f3\u306eURL\u304b\u3089\u53d6\u5f97\u3059\u308b `https://developers.facebook.com/apps/<YOUR APP ID>/messenger/`. |\n| FB_ROUTE_URL | string | /hubot/fb | Webhook \u306e Root Path \u4eca\u56de\u306f '/webhook' \u3092\u8a2d\u5b9a\u3059\u308b |\n| FB_VERIFY_TOKEN| string | - | Webhook \u3092\u8a2d\u5b9a\u3057\u305f\u969b\u306e Veryfy Token \u3092\u6307\u5b9a\u3059\u308b \u4eca\u56de\u306f 'botapp' \u3092\u6307\u5b9a\u3059\u308b |\n\n```bash\n$ heroku config:set FB_PAGE_ID=<FB_PAGE_ID \u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_APP_ID=<FB_APP_ID\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_APP_SECRET=<FB_APP_SECRET\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_WEBHOOK_BASE=http://mybot.com\n$ heroku config:set FB_PAGE_TOKEN=<FB_PAGE_TOKEN\u3092\u6307\u5b9a\u3059\u308b>\n$ heroku config:set FB_ROUTE_URL=/webhook\n$ heroku config:set FB_VERIFY_TOKEN=botapp\n```\n\n## Script \u3092\u66f8\u304f\n\n### \u6587\u5b57\u5217\u3092\u8868\u793a\u3059\u308b\n\n```coffeescript\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    res.send '\u3061\u306f\u3053\u3093'\n```\n\n![TextMesage.jpg](https://qiita-image-store.s3.amazonaws.com/0/9906/792e4aa7-3816-c65a-b6a4-b3c6f02b63ca.jpeg)\n\n\n### Button \u5f62\u5f0f\u3067\u8868\u793a\u3059\u308b (Postback)\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306e**[Button Template](https://developers.facebook.com/docs/messenger-platform/send-api-reference/button-template)**\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n\n```coffeescript\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    # attatchment \u306e\u69cb\u9020\u3092 richMsg \u4ee5\u4e0b\u306b\u5b9a\u7fa9\u3059\u308b\n    res.envelope.fb = {\n      richMsg: {\n      attachment: {\n        type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"\u304a\u304b\u3063\u3061\u306e\u4eca\u306e\u6c17\u5206\u3092\u6559\u3048\u3066\u307b\u3057\u3044\u3058\u3087\u3093\u3074\u30fc\",\n            buttons: [\n              {\n                type: \"payload\",\n                title: \"\u6700\u9ad8\"\n                payload: \"FEELING_SAIKOU\"\n              },\n              {\n                type: \"payload\",\n                title: \"\u3044\u3044\u611f\u3058\"\n                payload: \"FEELING_IIKANJI\"\n              },\n              {\n                type: \"payload\",\n                title: \"\u3044\u307e\u3044\u3061\"\n                payload: \"FEELING_IMAICHI\"\n              },\n            ]\n          }\n        }\n      }\n    }\n\n    res.send()\n```\n\n![ButtonTemplate.jpg](https://qiita-image-store.s3.amazonaws.com/0/9906/f93d4c99-ec4a-9646-a356-1493b95cf0a2.jpeg)\n\n### Button \u5f62\u5f0f\u3067\u8868\u793a\u3059\u308b (URL Link)\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306e**[Button Template](https://developers.facebook.com/docs/messenger-platform/send-api-reference/button-template)**\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n\n```coffeescript\n  robot.hear /\u3053\u3093\u3061\u306f/i, (res) ->\n    # attatchment \u306e\u69cb\u9020\u3092 richMsg \u4ee5\u4e0b\u306b\u5b9a\u7fa9\u3059\u308b\n    res.envelope.fb = {\n      richMsg: {\n      attachment: {\n        type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"\u304a\u304b\u3063\u3061\u306e\u4eca\u306e\u6c17\u5206\u3092\u6559\u3048\u3066\u307b\u3057\u3044\u3058\u3087\u3093\u3074\u30fc\",\n            buttons: [\n              {\n                type: \"web_url\",\n                title: \"Gmo-research\"\n                url: \"http://gmo-research.jp\"\n              },\n              {\n                type: \"web_url\",\n                title: \"infoq.jp\"\n                url: \"http://infoq.jp\"\n              },\n            ]\n          }\n        }\n      }\n    }\n\n    res.send()\n```\n\n![ButtonLink.jpg](https://qiita-image-store.s3.amazonaws.com/0/9906/cfbebda8-336a-36bf-a88e-ad208daf02aa.jpeg)\n\n\n### \u753b\u50cf\u3092\u8868\u793a\u3059\u308b (URL\u6307\u5b9a)\n\nattachment \u4ee5\u4e0b\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f Messenger Platform Document \u306e**[Image Attachment](https://developers.facebook.com/docs/messenger-platform/send-api-reference/image-attachment)**\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\n\n```coffeescript\n    res.envelope.fb = {\n      richMsg: {\n        attachment: {\n          type: \"image\",\n          payload: {\n            url: \"(\u753b\u50cf\u3078\u306eURL)\"\n          }\n        }\n      }\n    }\n\n```\n![ImageAttachment.jpg](https://qiita-image-store.s3.amazonaws.com/0/9906/683d5eaa-f691-e5a5-032a-72a8bc9ca4f6.jpeg)\n\n### \u305d\u306e\u4ed6\n\u4ed6\u306b\u3082\u611f\u306a\u3082\u306e\u3082\u6709\u308a\u307e\u3059\n\n- [Audio Attachment](https://developers.facebook.com/docs/messenger-platform/send-api-reference/audio-attachment) (\u97f3\u58f0\u3092\u518d\u751f\u3055\u305b\u305f\u3044\u6642)\n- [Video Attachment](https://developers.facebook.com/docs/messenger-platform/send-api-reference/video-attachment) (\u6620\u50cf\u3092\u518d\u751f\u3055\u305b\u305f\u3044\u6642)\n- [Generic Template](https://developers.facebook.com/docs/messenger-platform/send-api-reference/generic-template) (\u753b\u50cf\u3084\u30dc\u30bf\u30f3\u3092\u6df7\u5728\u3055\u305b\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8868\u793a\u3057\u305f\u3044\u6642)\n- [Airline Itinerary Template](https://developers.facebook.com/docs/messenger-platform/send-api-reference/airline-itinerary-template) (\u30d5\u30e9\u30a4\u30c8\u30d7\u30e9\u30f3\u3092\u8868\u793a\u3059\u308b\u7684\u306a\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\uff09\n- \u306a\u3069\u306a\u3069\n\n\n"}