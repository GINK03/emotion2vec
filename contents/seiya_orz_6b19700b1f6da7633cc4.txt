{"context": "\n\n\u306f\u3058\u3081\u306b\n\u4eca\u5e74\u306ere:Invent\u3067\u306f\u69d8\u3005\u306a\u30b5\u30fc\u30d3\u30b9\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\u305d\u306e\u4e2d\u3067\u3082AI\u7cfb\u306e\u30b5\u30fc\u30d3\u30b9\u304c3\u3064\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u753b\u50cf\u8a8d\u8b58\u30b5\u30fc\u30d3\u30b9\u306eRekognition\u3092LINE Bot\u4e0a\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u8a71\u3067\u3059\u3002\n\nRekognition\u3068\u306f\nAmazon Rekognition\n\u4e0b\u8a18\u6a5f\u80fd\u3092\u6709\u3057\u305f\u753b\u50cf\u8a8d\u8b58\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\n\u7269\u4f53\u304a\u3088\u3073\u30b7\u30fc\u30f3\u306e\u691c\u51fa\n\u9854\u306e\u5206\u6790\n\u9854\u306e\u6bd4\u8f03\n\n\u69d8\u3005\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306bSDK\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u975e\u5e38\u306b\u7c21\u5358\u306b\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089GUI\u3067\u8a66\u3057\u3066\u307f\u308c\u308b\u306e\u3067\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u304a\u6301\u3061\u306e\u65b9\u306f\u8a66\u3057\u3066\u307f\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\u6599\u91d1\u306f\u3001\u306f\u3058\u3081\u306e1\u5e74\u9593\u306f5000Image\u307e\u3067\u7121\u6599\u3002\u7121\u6599\u671f\u9593\u304c\u7d42\u308f\u308b\u304b\u30015000\u3092\u8d85\u3048\u305f\u5834\u5408\u30011000Image\u3042\u305f\u308a$1\n\u3067\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001Recognition\u3067\u306f\u306a\u304f\u3001Rekognition\u3067\u3059\u3002re:Invent\u306b\u53c2\u52a0\u4e2d\u306e\u4e0a\u53f8\u304b\u3089\u300cRekognition\u8a66\u3057\u3066\u307f\u3066\uff01\u300d\u3068LINE\u304c\u98db\u3093\u3067\u304d\u3066\u3044\u3066\u3001\u30b9\u30da\u30eb\u9593\u9055\u3063\u3066\u308b\u3084\u3093\u3068\u304b\u601d\u3063\u3066\u307e\u3057\u305f\u304c\u3001Rekognition\u3067\u3042\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u3054\u6ce8\u610f\u3092\u3002\n\n\u69cb\u6210\n\u4eca\u56de\u306e\u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n\nLINE Bot\u306b\u5bfe\u3057\u3066\u753b\u50cf\u3092\u6295\u3052\u308b\u3068\u3001APIGW\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3078\u30d5\u30c3\u30af\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001Lambda\u3078\u6d41\u3057\u3066\u3001Lambda\u5074\u3067\u753b\u50cf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001Rekognition\u3068\u306e\u3084\u308a\u3068\u308a\u3092\u3057\u3001\u7d50\u679c\u3092\u4eba\u304c\u898b\u3084\u3059\u3044\u5f62\u306b\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002\nLINE Bot\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001\u3053\u306e\u3078\u3093\u304b\u3089Messaging API\u3078\u3044\u3063\u3066\u306a\u3093\u304b\u3059\u308c\u3070\u4f5c\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u7c21\u5358\u306a\u306e\u3067\u81ea\u5206\u3067\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\nLambda\u306e\u51e6\u7406\nRekognition\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306baws-sdk\u3092\u5229\u7528\u3057\u307e\u3059\u3002Lambda\u3067\u306f\u6a19\u6e96\u3067\u5099\u308f\u3063\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306a\u306e\u3067\u3001\uff08Node\u306e\u5834\u5408\u3060\u3068\uff09npm install aws-sdk\u3057\u306a\u304f\u3066\u3044\u3044\u306f\u305a\u3067\u3057\u305f\u3002\u3067\u3059\u304c\u30012016/12/9\u73fe\u5728\u3067\u306fLambda\u5185\u306eJS\u7248aws-sdk\u304c\u307e\u3060\u6700\u65b0\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u305d\u3046\u306a\u306e\u3067\u3001\u81ea\u5206\u3067aws-sdk\u306e\u6700\u65b0\u7248\u53d6\u3063\u3066\u304d\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0\u3057\u3066Lambda\u306b\u3042\u3052\u308b\u304b\u3001Python\u306a\u3089Blue Print\u304c\u7528\u610f\u3055\u308c\u3066\u308b\u306e\u3067\u305d\u3063\u3061\u3092\u4f7f\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u30ea\u30fc\u30b8\u30e7\u30f3\u306fRekognition\u304c\u4f7f\u3048\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u50d5\u306fus-east-1\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\u3084\u3063\u3064\u3051\u3067\u66f8\u3044\u305f\u306e\u3067\u30b3\u30fc\u30c9\u304c\u6c5a\u3044\u306e\u306f\u52d8\u5f01\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3061\u306a\u307f\u306b\u3001APIGW\u3068Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u7b49\u3005\u306fSERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u3082\u3057\u5229\u7528\u3055\u308c\u308b\u65b9\u306f\u3053\u306e\u8a18\u4e8b\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nMessaging API\u304c\u767a\u8868\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\uff082016/9\u672b\u304f\u3089\u3044\uff1f\uff09\u3067\u30821\u5ea6Bot\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u3068\u304d\u306b\u306fMessaging API\u3092\u7c21\u5358\u306b\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u63c3\u3063\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4eca\u56de\u8abf\u3079\u3066\u307f\u308b\u3068\u3001line-messaging\u304c\u4f7f\u3048\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u7c21\u5358\u3002\n'use strict';\n\nvar AWS = require(\"aws-sdk\");\nvar rekognition = new AWS.Rekognition();\n\nvar LINEBot = require('line-messaging');\nvar bot = LINEBot.create({\n  channelID: 'your id',\n  channelSecret: 'your secret',\n  channelToken: 'your token'\n});\n\nconst res = {\n  statusCode: 200,\n  headers: {},\n  body: JSON.stringify({\n    message: 'Go Serverless v1.0! Your function executed successfully!'\n  }),\n};\n\nmodule.exports.handler = (event, context, callback) => {\n  var events = JSON.parse(event.body).events;\n  // LINEBot\u306f\u540c\u6642\u306b\u8907\u6570\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6295\u3052\u3089\u308c\u308b\u3053\u3068\u304c\u3042\u308b\n  events.forEach(function(incident, index, array) {\n    if (incident.type == \"message\") {\n      switch (incident.message.type) {\n        case \"image\":\n        // \u753b\u50cf\u3092\u30d0\u30a4\u30ca\u30ea\u3067\u53d6\u3063\u3066\u304f\u308b\n        bot.getMessageContent(incident.message.id).then(function(data) {\n          var buf = new Buffer(data);\n          var param = {\n            Image: {\n              Bytes: buf\n            }\n          };\n          // \u7269\u4f53\u3001\u30b7\u30fc\u30f3\u5206\u6790\n          rekognition.detectLabels(param, function(err, data) {\n            if (err) {\n              console.log(err, err.stack);\n            } else {\n              console.log(JSON.stringify(data));\n              var mes = \"\";\n              // \u305f\u304f\u3055\u3093Label\u304c\u8cbc\u3089\u308c\u308b\u306f\u305a\n              data.Labels.forEach(function(label) {\n                mes += label.Name + \": \" + Math.round(label.Confidence) + \"\\%\\n\";\n                // \u4eba\u3092\u691c\u51fa\u3057\u305f\u5834\u5408\u306e\u307f\u9854\u5206\u6790\u3082\u3059\u308b\n                if (label.Name == \"Person\") {\n                  param[\"Attributes\"] = [\"ALL\"];\n                  // \u9854\u5206\u6790\n                  rekognition.detectFaces(param, function(err, data) {\n                    if (err) {\n                      console.log(err, err.stack);\n                    } else {\n                      console.log(JSON.stringify(data));\n                      data.FaceDetails.forEach(function(detail) {\n                        var message = makeMessageFromFaceDetail(detail);\n                        // replyToken\u306f1\u56de\u306e\u307f\u6709\u52b9\u3060\u3063\u305f\u306f\u305a\u306a\u306e\u3067Push\u3059\u308b\u3057\u304b\u306a\u3044\n                        bot.pushTextMessage(incident.source.userId, message);\n                      });\n                    }\n                  });\n                }\n              });\n              mes = mes.replace(/\\n+$/g, '');\n              bot.replyTextMessage(incident.replyToken, mes).then(function(data) {}).catch(function(err) {});\n            }\n          });\n        }).catch(function(err) {\n\n        });\n        break;\n        default:\n      }\n    }\n  });\n}\n\nfunction makeMessageFromFaceDetail(data) {\n  var mes = \"\";\n  mes += \"Gender: \" + data.Gender.Value + \" \" + Math.round(data.Eyeglasses.Confidence) + \"\\%\\n\";\n  mes += \"Eyeglasses: \" + data.Eyeglasses.Value + \" \" + Math.round(data.Eyeglasses.Confidence) + \"\\%\\n\";\n  mes += \"Emotions: \" + data.Emotions[0].Type + \" \" + Math.round(data.Emotions[0].Confidence) + \"\\%\\n\";\n  mes += \"Smile: \" + data.Smile.Value + \" \" + Math.round(data.Smile.Confidence) + \"\\%\\n\";\n  mes = mes.replace(/\\n+$/g, '');\n  return mes;\n}\n\nLINE Bot\u306b\u3053\u3058\u308b\u308a\u306e\u5199\u771f\u3092\u6295\u3052\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3063\u307d\u3044\u3067\u3059\u306d\u3002\n\n\u6240\u611f\n\n\u7269\u4f53\u304a\u3088\u3073\u30b7\u30fc\u30f3\u306e\u691c\u77e5(detectLabels)\n\u5229\u7528\u65b9\u6cd5\u306b\u3088\u3063\u3066\u306f\u306a\u304b\u306a\u304b\u4fbf\u5229\u306a\u6a5f\u80fd\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u3089\u304b\u3058\u3081\u753b\u50cf\u3092\u52a0\u5de5\u3057\u3066\u6e21\u3059\u3068\u3088\u308a\u5f97\u305f\u3044\u7d50\u679c\u304c\u5f97\u3084\u3059\u304f\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\u305f\u3081\u3057\u306b\u6599\u7406\u306e\u5199\u771f\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\n\n\u5b9a\u98df\u306a\u3069\u306e\u65e5\u672c\u3063\u307d\u3044\u98df\u4e8b\u306f\u306a\u304b\u306a\u304b\u5bfe\u8c61\u304c\u591a\u304f\u3001\u5c0f\u3055\u3044\u3082\u306e\u304c\u591a\u3044\u306e\u3067\u8a8d\u8b58\u3055\u305b\u308b\u306e\u306f\u96e3\u3057\u305d\u3046\u3067\u3059\u3002\n\u30d4\u30b6\u306e\u5199\u771f\u3068\u304b\u3060\u3068Pizza: 99%\u3068\u304b\u306a\u308b\u306e\u3067\u30011\u54c1\u3082\u306e\u306e\u6599\u7406\u3068\u304b\u306f\u8a8d\u8b58\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001Label\u306f\u82f1\u8a9e\u3067\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u65e5\u672c\u4eba\u306b\u308f\u304b\u308b\u3088\u3046\u306b\u8fd4\u305d\u3046\u3068\u601d\u3046\u3068\u548c\u8a33\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u5c11\u3005\u624b\u9593\u3067\u3059\u306d\u3002\n\n\u9854\u306e\u5206\u6790(detectFaces)\n\u3053\u308c\u306f\u306a\u304b\u306a\u304b\u7cbe\u5ea6\u304c\u9ad8\u305d\u3046\u3067\u3059\u306d\u3002\u53d6\u308c\u308b\u7279\u5fb4\u304c\u4e88\u3081\u6c7a\u307e\u3063\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3001\u9aed\u304c\u3042\u308b\u304b\u3068\u304b\u3082\u3068\u308c\u307e\u3059\u3002\n\n\u9854\u306e\u6bd4\u8f03\n\u5b9f\u88c5\u3057\u3066\u307e\u305b\u3093\u3002\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u985e\u4f3c\u5ea6\u304c\u53d6\u308c\u307e\u3059\u3002\u305f\u3060\u3001\u30d3\u30b8\u30cd\u30b9\u3067\u4f55\u306b\u4f7f\u3048\u308b\u306e\u304b\u304c\u5168\u304f\u601d\u3044\u6d6e\u304b\u3070\u306a\u3044\u3002\u9854\u8a8d\u8a3c\u3068\u304b\uff1f\n\n\u307e\u3068\u3081\nRekognition\u3092LINE Bot\u4e0a\u306b\u5b9f\u88c5\u3057\u3066\u307f\u305f\u8a71\u3067\u3057\u305f\u3002\u7cbe\u5ea6\u4e0a\u3001\u5b9f\u7528\u3059\u308b\u306b\u306f\u304b\u306a\u308a\u9650\u5b9a\u7684\u306b\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3068\u306b\u304b\u304f\u7c21\u5358\u306b\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u304c1\u756a\u306e\u30e1\u30ea\u30c3\u30c8\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\n\u4eca\u5f8c\u3069\u3093\u3069\u3093\u7cbe\u5ea6\u304c\u4e0a\u304c\u3063\u3066\u3044\u304f\u30b5\u30fc\u30d3\u30b9\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u3001\u975e\u5e38\u306b\u697d\u3057\u307f\u3067\u3059\u306d\u3002\n\u304a\u308f\u308a\n# \u306f\u3058\u3081\u306b\n\u4eca\u5e74\u306ere:Invent\u3067\u306f\u69d8\u3005\u306a\u30b5\u30fc\u30d3\u30b9\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\u305d\u306e\u4e2d\u3067\u3082AI\u7cfb\u306e\u30b5\u30fc\u30d3\u30b9\u304c3\u3064\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u753b\u50cf\u8a8d\u8b58\u30b5\u30fc\u30d3\u30b9\u306eRekognition\u3092LINE Bot\u4e0a\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3068\u3044\u3046\u8a71\u3067\u3059\u3002\n\n# Rekognition\u3068\u306f\n[Amazon Rekognition](https://aws.amazon.com/jp/rekognition/)\n\n\u4e0b\u8a18\u6a5f\u80fd\u3092\u6709\u3057\u305f\u753b\u50cf\u8a8d\u8b58\u30b5\u30fc\u30d3\u30b9\u3067\u3059\u3002\n\n- \u7269\u4f53\u304a\u3088\u3073\u30b7\u30fc\u30f3\u306e\u691c\u51fa\n- \u9854\u306e\u5206\u6790\n- \u9854\u306e\u6bd4\u8f03\n\n\u69d8\u3005\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u8a00\u8a9e\u306bSDK\u3068\u3057\u3066\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u975e\u5e38\u306b\u7c21\u5358\u306b\u5229\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089GUI\u3067\u8a66\u3057\u3066\u307f\u308c\u308b\u306e\u3067\u3001AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u304a\u6301\u3061\u306e\u65b9\u306f\u8a66\u3057\u3066\u307f\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n\n\u6599\u91d1\u306f\u3001\u306f\u3058\u3081\u306e1\u5e74\u9593\u306f5000Image\u307e\u3067\u7121\u6599\u3002\u7121\u6599\u671f\u9593\u304c\u7d42\u308f\u308b\u304b\u30015000\u3092\u8d85\u3048\u305f\u5834\u5408\u30011000Image\u3042\u305f\u308a$1\n\u3067\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001Recognition\u3067\u306f\u306a\u304f\u3001Rekognition\u3067\u3059\u3002re:Invent\u306b\u53c2\u52a0\u4e2d\u306e\u4e0a\u53f8\u304b\u3089\u300cRekognition\u8a66\u3057\u3066\u307f\u3066\uff01\u300d\u3068LINE\u304c\u98db\u3093\u3067\u304d\u3066\u3044\u3066\u3001\u30b9\u30da\u30eb\u9593\u9055\u3063\u3066\u308b\u3084\u3093\u3068\u304b\u601d\u3063\u3066\u307e\u3057\u305f\u304c\u3001Rekognition\u3067\u3042\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\u3054\u6ce8\u610f\u3092\u3002\n\n# \u69cb\u6210\n\u4eca\u56de\u306e\u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u306f\u3053\u3093\u306a\u611f\u3058\u3002\n![\u30b7\u30b9\u30c6\u30e0\u69cb\u6210.jpeg](https://qiita-image-store.s3.amazonaws.com/0/74853/a3de73df-11d2-1fde-72a1-e944643e8f63.jpeg)\n\nLINE Bot\u306b\u5bfe\u3057\u3066\u753b\u50cf\u3092\u6295\u3052\u308b\u3068\u3001APIGW\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3078\u30d5\u30c3\u30af\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001Lambda\u3078\u6d41\u3057\u3066\u3001Lambda\u5074\u3067\u753b\u50cf\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3001Rekognition\u3068\u306e\u3084\u308a\u3068\u308a\u3092\u3057\u3001\u7d50\u679c\u3092\u4eba\u304c\u898b\u3084\u3059\u3044\u5f62\u306b\u3057\u3066\u8fd4\u3057\u307e\u3059\u3002\n\nLINE Bot\u306e\u8a2d\u5b9a\u306b\u3064\u3044\u3066\u306f\u3001[\u3053\u306e\u3078\u3093](https://business.line.me/ja/)\u304b\u3089Messaging API\u3078\u3044\u3063\u3066\u306a\u3093\u304b\u3059\u308c\u3070\u4f5c\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u7c21\u5358\u306a\u306e\u3067\u81ea\u5206\u3067\u3084\u3063\u3066\u304f\u3060\u3055\u3044\u3002\n\n# Lambda\u306e\u51e6\u7406\nRekognition\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306baws-sdk\u3092\u5229\u7528\u3057\u307e\u3059\u3002Lambda\u3067\u306f\u6a19\u6e96\u3067\u5099\u308f\u3063\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306a\u306e\u3067\u3001\uff08Node\u306e\u5834\u5408\u3060\u3068\uff09npm install aws-sdk\u3057\u306a\u304f\u3066\u3044\u3044\u306f\u305a\u3067\u3057\u305f\u3002\u3067\u3059\u304c\u30012016/12/9\u73fe\u5728\u3067\u306f[Lambda\u5185\u306eJS\u7248aws-sdk\u304c\u307e\u3060\u6700\u65b0\u306b\u306a\u3063\u3066\u3044\u306a\u3044\u305d\u3046](https://forums.aws.amazon.com/message.jspa?messageID=754495)\u306a\u306e\u3067\u3001\u81ea\u5206\u3067aws-sdk\u306e\u6700\u65b0\u7248\u53d6\u3063\u3066\u304d\u3066\u30d1\u30c3\u30b1\u30fc\u30b8\u30f3\u30b0\u3057\u3066Lambda\u306b\u3042\u3052\u308b\u304b\u3001Python\u306a\u3089Blue Print\u304c\u7528\u610f\u3055\u308c\u3066\u308b\u306e\u3067\u305d\u3063\u3061\u3092\u4f7f\u3063\u3066\u3082\u3044\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u30ea\u30fc\u30b8\u30e7\u30f3\u306fRekognition\u304c\u4f7f\u3048\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u50d5\u306fus-east-1\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\n\n\u3084\u3063\u3064\u3051\u3067\u66f8\u3044\u305f\u306e\u3067\u30b3\u30fc\u30c9\u304c\u6c5a\u3044\u306e\u306f\u52d8\u5f01\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3061\u306a\u307f\u306b\u3001APIGW\u3068Lambda\u306e\u30c7\u30d7\u30ed\u30a4\u7b49\u3005\u306f[SERVERLESS\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af](https://serverless.com/)\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u3082\u3057\u5229\u7528\u3055\u308c\u308b\u65b9\u306f[\u3053\u306e\u8a18\u4e8b](http://qiita.com/seiya_orz/items/4bd7cc1010fafdbb8fd0)\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nMessaging API\u304c\u767a\u8868\u3055\u308c\u305f\u30bf\u30a4\u30df\u30f3\u30b0\uff082016/9\u672b\u304f\u3089\u3044\uff1f\uff09\u3067\u30821\u5ea6Bot\u3092\u4f5c\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u305d\u306e\u3068\u304d\u306b\u306fMessaging API\u3092\u7c21\u5358\u306b\u4f7f\u3048\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u304c\u63c3\u3063\u3066\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u4eca\u56de\u8abf\u3079\u3066\u307f\u308b\u3068\u3001[line-messaging](https://github.com/snlangsuan/line-messaging)\u304c\u4f7f\u3048\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\u7c21\u5358\u3002\n\n```js\n'use strict';\n\nvar AWS = require(\"aws-sdk\");\nvar rekognition = new AWS.Rekognition();\n\nvar LINEBot = require('line-messaging');\nvar bot = LINEBot.create({\n  channelID: 'your id',\n  channelSecret: 'your secret',\n  channelToken: 'your token'\n});\n\nconst res = {\n  statusCode: 200,\n  headers: {},\n  body: JSON.stringify({\n    message: 'Go Serverless v1.0! Your function executed successfully!'\n  }),\n};\n\nmodule.exports.handler = (event, context, callback) => {\n  var events = JSON.parse(event.body).events;\n  // LINEBot\u306f\u540c\u6642\u306b\u8907\u6570\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6295\u3052\u3089\u308c\u308b\u3053\u3068\u304c\u3042\u308b\n  events.forEach(function(incident, index, array) {\n    if (incident.type == \"message\") {\n      switch (incident.message.type) {\n        case \"image\":\n        // \u753b\u50cf\u3092\u30d0\u30a4\u30ca\u30ea\u3067\u53d6\u3063\u3066\u304f\u308b\n        bot.getMessageContent(incident.message.id).then(function(data) {\n          var buf = new Buffer(data);\n          var param = {\n            Image: {\n              Bytes: buf\n            }\n          };\n          // \u7269\u4f53\u3001\u30b7\u30fc\u30f3\u5206\u6790\n          rekognition.detectLabels(param, function(err, data) {\n            if (err) {\n              console.log(err, err.stack);\n            } else {\n              console.log(JSON.stringify(data));\n              var mes = \"\";\n              // \u305f\u304f\u3055\u3093Label\u304c\u8cbc\u3089\u308c\u308b\u306f\u305a\n              data.Labels.forEach(function(label) {\n                mes += label.Name + \": \" + Math.round(label.Confidence) + \"\\%\\n\";\n                // \u4eba\u3092\u691c\u51fa\u3057\u305f\u5834\u5408\u306e\u307f\u9854\u5206\u6790\u3082\u3059\u308b\n                if (label.Name == \"Person\") {\n                  param[\"Attributes\"] = [\"ALL\"];\n                  // \u9854\u5206\u6790\n                  rekognition.detectFaces(param, function(err, data) {\n                    if (err) {\n                      console.log(err, err.stack);\n                    } else {\n                      console.log(JSON.stringify(data));\n                      data.FaceDetails.forEach(function(detail) {\n                        var message = makeMessageFromFaceDetail(detail);\n                        // replyToken\u306f1\u56de\u306e\u307f\u6709\u52b9\u3060\u3063\u305f\u306f\u305a\u306a\u306e\u3067Push\u3059\u308b\u3057\u304b\u306a\u3044\n                        bot.pushTextMessage(incident.source.userId, message);\n                      });\n                    }\n                  });\n                }\n              });\n              mes = mes.replace(/\\n+$/g, '');\n              bot.replyTextMessage(incident.replyToken, mes).then(function(data) {}).catch(function(err) {});\n            }\n          });\n        }).catch(function(err) {\n\n        });\n        break;\n        default:\n      }\n    }\n  });\n}\n\nfunction makeMessageFromFaceDetail(data) {\n  var mes = \"\";\n  mes += \"Gender: \" + data.Gender.Value + \" \" + Math.round(data.Eyeglasses.Confidence) + \"\\%\\n\";\n  mes += \"Eyeglasses: \" + data.Eyeglasses.Value + \" \" + Math.round(data.Eyeglasses.Confidence) + \"\\%\\n\";\n  mes += \"Emotions: \" + data.Emotions[0].Type + \" \" + Math.round(data.Emotions[0].Confidence) + \"\\%\\n\";\n  mes += \"Smile: \" + data.Smile.Value + \" \" + Math.round(data.Smile.Confidence) + \"\\%\\n\";\n  mes = mes.replace(/\\n+$/g, '');\n  return mes;\n}\n```\n\nLINE Bot\u306b\u3053\u3058\u308b\u308a\u306e\u5199\u771f\u3092\u6295\u3052\u3066\u307f\u307e\u3057\u305f\u3002\n<img width=\"389\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-12-11 9.37.10.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/74853/cf3aabf3-a6ff-659a-9ddc-ff2ac243be8e.png\">\n\n\u3061\u3083\u3093\u3068\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3063\u307d\u3044\u3067\u3059\u306d\u3002\n\n# \u6240\u611f\n## \u7269\u4f53\u304a\u3088\u3073\u30b7\u30fc\u30f3\u306e\u691c\u77e5(detectLabels)\n\u5229\u7528\u65b9\u6cd5\u306b\u3088\u3063\u3066\u306f\u306a\u304b\u306a\u304b\u4fbf\u5229\u306a\u6a5f\u80fd\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u3042\u3089\u304b\u3058\u3081\u753b\u50cf\u3092\u52a0\u5de5\u3057\u3066\u6e21\u3059\u3068\u3088\u308a\u5f97\u305f\u3044\u7d50\u679c\u304c\u5f97\u3084\u3059\u304f\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\n\u305f\u3081\u3057\u306b\u6599\u7406\u306e\u5199\u771f\u3092\u8a66\u3057\u3066\u307f\u305f\u306e\u3067\u3059\u304c\n<img width=\"375\" alt=\"5A48CBAD-50C0-4AFF-B0F1-6BEE5D7FAB17.PNG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/74853/9ddf0d47-cc32-085d-007e-2405ace08e2a.png\">\n\u5b9a\u98df\u306a\u3069\u306e\u65e5\u672c\u3063\u307d\u3044\u98df\u4e8b\u306f\u306a\u304b\u306a\u304b\u5bfe\u8c61\u304c\u591a\u304f\u3001\u5c0f\u3055\u3044\u3082\u306e\u304c\u591a\u3044\u306e\u3067\u8a8d\u8b58\u3055\u305b\u308b\u306e\u306f\u96e3\u3057\u305d\u3046\u3067\u3059\u3002\n\n\u30d4\u30b6\u306e\u5199\u771f\u3068\u304b\u3060\u3068Pizza: 99%\u3068\u304b\u306a\u308b\u306e\u3067\u30011\u54c1\u3082\u306e\u306e\u6599\u7406\u3068\u304b\u306f\u8a8d\u8b58\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305d\u3046\u3067\u3059\u3002\n\n\u5f53\u305f\u308a\u524d\u3067\u3059\u304c\u3001Label\u306f\u82f1\u8a9e\u3067\u8fd4\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u65e5\u672c\u4eba\u306b\u308f\u304b\u308b\u3088\u3046\u306b\u8fd4\u305d\u3046\u3068\u601d\u3046\u3068\u548c\u8a33\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u5c11\u3005\u624b\u9593\u3067\u3059\u306d\u3002\n\n## \u9854\u306e\u5206\u6790(detectFaces)\n\u3053\u308c\u306f\u306a\u304b\u306a\u304b\u7cbe\u5ea6\u304c\u9ad8\u305d\u3046\u3067\u3059\u306d\u3002\u53d6\u308c\u308b\u7279\u5fb4\u304c\u4e88\u3081\u6c7a\u307e\u3063\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3001\u9aed\u304c\u3042\u308b\u304b\u3068\u304b\u3082\u3068\u308c\u307e\u3059\u3002\n\n## \u9854\u306e\u6bd4\u8f03\n\u5b9f\u88c5\u3057\u3066\u307e\u305b\u3093\u3002\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u985e\u4f3c\u5ea6\u304c\u53d6\u308c\u307e\u3059\u3002\u305f\u3060\u3001\u30d3\u30b8\u30cd\u30b9\u3067\u4f55\u306b\u4f7f\u3048\u308b\u306e\u304b\u304c\u5168\u304f\u601d\u3044\u6d6e\u304b\u3070\u306a\u3044\u3002\u9854\u8a8d\u8a3c\u3068\u304b\uff1f\n\n# \u307e\u3068\u3081\nRekognition\u3092LINE Bot\u4e0a\u306b\u5b9f\u88c5\u3057\u3066\u307f\u305f\u8a71\u3067\u3057\u305f\u3002\u7cbe\u5ea6\u4e0a\u3001\u5b9f\u7528\u3059\u308b\u306b\u306f\u304b\u306a\u308a\u9650\u5b9a\u7684\u306b\u4f7f\u3046\u5fc5\u8981\u304c\u3042\u308a\u305d\u3046\u3067\u3059\u304c\u3001\u3068\u306b\u304b\u304f\u7c21\u5358\u306b\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u304c1\u756a\u306e\u30e1\u30ea\u30c3\u30c8\u3067\u306f\u306a\u3044\u3067\u3057\u3087\u3046\u304b\u3002\n\n\u4eca\u5f8c\u3069\u3093\u3069\u3093\u7cbe\u5ea6\u304c\u4e0a\u304c\u3063\u3066\u3044\u304f\u30b5\u30fc\u30d3\u30b9\u306b\u306a\u308a\u305d\u3046\u306a\u306e\u3067\u3001\u975e\u5e38\u306b\u697d\u3057\u307f\u3067\u3059\u306d\u3002\n\n\u304a\u308f\u308a\n", "tags": ["ReKognition", "AWS", "linebot", "Node.js"]}