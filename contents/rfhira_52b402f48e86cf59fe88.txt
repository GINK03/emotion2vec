{"context": "\n\n\u8aac\u660e\n\u4ee5\u4e0b\u30b9\u30e9\u30a4\u30c9\u306e2\u3067\u884c\u3046\u3001directconnect\u63a5\u7d9a\u306e\u5b9f\u6f14\u306b\u4f7f\u7528\u3059\u308b\u30ab\u30f3\u30cb\u30f3\u30b0\u30da\u30fc\u30d1\u30fc\u3067\u3059\u3002\nhttp://www.slideshare.net/TomoakiHira/let-us-make-clear-the-aws-directconnect\n\n\u5b9f\u6f14\n\n\u74b0\u5883\u78ba\u8a8d (DirectConnect\u5229\u7528\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\nVPC\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpcs\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"Vpcs\": [\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"InstanceTenancy\": \"default\",\n            \"State\": \"available\",\n            \"DhcpOptionsId\": \"dopt-622a****\",\n            \"CidrBlock\": \"172.31.0.0/16\",\n            \"IsDefault\": true\n        }\n    ]\n}\n\n\n\n\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-subnets\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"Subnets\": [\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"CidrBlock\": \"172.31.0.0/20\",\n            \"MapPublicIpOnLaunch\": true,\n            \"DefaultForAz\": true,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1c\",\n            \"SubnetId\": \"subnet-b509****\",\n            \"AvailableIpAddressCount\": 4091\n        },\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"CidrBlock\": \"172.31.16.0/20\",\n            \"MapPublicIpOnLaunch\": true,\n            \"DefaultForAz\": true,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"SubnetId\": \"subnet-4aeb****\",\n            \"AvailableIpAddressCount\": 4090\n        }\n    ]\n}\n\n\n\nVPN\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4(\u4eee\u60f3\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4)\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpn-gateways\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"VpnGateways\": [\n        {\n            \"State\": \"available\",\n            \"Tags\": [\n                {\n                    \"Value\": \"test\",\n                    \"Key\": \"Name\"\n                }\n            ],\n            \"Type\": \"ipsec.1\",\n            \"VpnGatewayId\": \"vgw-abbd****\",\n            \"VpcAttachments\": [\n                {\n                    \"State\": \"attached\",\n                    \"VpcId\": \"vpc-9968****\"\n                }\n            ]\n        }\n    ]\n}\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"RouteTables\": [\n        {\n            \"Associations\": [\n                {\n                    \"RouteTableAssociationId\": \"rtbassoc-02bf****\",\n                    \"Main\": true,\n                    \"RouteTableId\": \"rtb-4998****\"\n                }\n            ],\n            \"RouteTableId\": \"rtb-4998****\",\n            \"VpcId\": \"vpc-9968****\",\n            \"PropagatingVgws\": [],\n            \"Tags\": [],\n            \"Routes\": [\n                {\n                    \"GatewayId\": \"local\",\n                    \"DestinationCidrBlock\": \"172.31.0.0/16\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRouteTable\"\n                },\n                {\n                    \"GatewayId\": \"igw-aa9b****\",\n                    \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRoute\"\n                }\n            ]\n        }\n    ]\n}\n\n\n\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d (DirectConnect\u7ba1\u7406\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\u30b3\u30de\u30f3\u30c9\naws directconnect describe-connections\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"connections\": [\n        {\n            \"ownerAccount\": \"1790********\",\n            \"connectionId\": \"dxcon-********\",\n            \"connectionState\": \"available\",\n            \"bandwidth\": \"10Gbps\",\n            \"location\": \"EqTY2\",\n            \"connectionName\": \"********\",\n            \"region\": \"ap-northeast-1\"\n        },\n        {\n            \"ownerAccount\": \"1790********\",\n            \"connectionId\": \"dxcon-********\",\n            \"connectionState\": \"available\",\n            \"bandwidth\": \"10Gbps\",\n            \"location\": \"EqTY2\",\n            \"connectionName\": \"********\",\n            \"region\": \"ap-northeast-1\"\n        }\n    ]\n}\n\n\n\n\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u306bVirtualInterface\u3092\u5272\u5f53(DirectConnect\u7ba1\u7406\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\u30b3\u30de\u30f3\u30c9\nCONNECTION='dxcon-********'\nVIFNAME='NWG-HIRA-BK'\nACCOUNTID='5651********'\nVLANID='511'\nROUTERIP='169.254.15.213/30'\nAMAZONIP='169.254.15.214/30'\nBGPASN='65000'\nBGPMD5='fr3gUCLDLS6MQsVLVBw9zgdt'\n\ncat <<ETX\n\n    CONNECTION: $CONNECTION\n    VIFNAME   : $VIFNAME\n    ACCOUNTID : $ACCOUNTID\n    VLANID    : $VLANID\n    ROUTERIP  : $ROUTERIP\n    AMAZONIP  : $AMAZONIP\n    BGPASN    : $BGPASN\n    BGPMD5    : $BGPMD5\n\nETX\n\naws directconnect allocate-private-virtual-interface --connection-id $CONNECTION --owner-account $ACCOUNTID --new-private-virtual-interface-allocation virtualInterfaceName=$VIFNAME,vlan=$VLANID,asn=$BGPASN,authKey=$BGPMD5,amazonAddress=$AMAZONIP,customerAddress=$ROUTERIP\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"confirming\",\n    \"asn\": 65000,\n    \"vlan\": 511,\n    \"customerAddress\": \"169.254.15.213/30\",\n    \"ownerAccount\": \"5651********\",\n    \"connectionId\": \"dxcon-********\",\n    \"virtualInterfaceId\": \"dxvif-********\",\n    \"authKey\": \"fr3gUCLDLS6MQsVLVBw9zgdt\",\n    \"routeFilterPrefixes\": [],\n    \"location\": \"EqTY2\",\n    \"customerRouterConfig\": \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<logical_connection id=\\\"dxvif-********\\\">\\n  <vlan>511</vlan>\\n  <customer_address>169.254.15.213/30</customer_address>\\n  <amazon_address>169.254.15.214/30</amazon_address>\\n  <bgp_asn>65000</bgp_asn>\\n  <bgp_auth_key>fr3gUCLDLS6MQsVLVBw9zgdt</bgp_auth_key>\\n  <amazon_bgp_asn>10124</amazon_bgp_asn>\\n  <connection_type>private</connection_type>\\n</logical_connection>\\n\",\n    \"amazonAddress\": \"169.254.15.214/30\",\n    \"virtualInterfaceType\": \"private\",\n    \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n}\n\n\n\nVirtualInterface\u306eConfirm (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\u30b3\u30de\u30f3\u30c9\nVGWID=`aws ec2 describe-vpn-gateways | jq .VpnGateways[0].VpnGatewayId | tr -d '\\\"'`\nVIFID=`aws directconnect describe-virtual-interfaces | jq .virtualInterfaces[0].virtualInterfaceId | tr -d '\\\"'`\n\ncat <<ETX\n\n    VGWID: $VGWID\n    VIFID: $VIFID\n\nETX\n\naws directconnect confirm-private-virtual-interface --virtual-interface-id $VIFID --virtual-gateway-id $VGWID\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"pending\"\n}\n\n\n\n\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\nwatch -n 10 \"aws directconnect describe-virtual-interfaces\"\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaces\": [\n        {\n            \"virtualInterfaceState\": \"available\",\n            \"asn\": 65000,\n            \"vlan\": 511,\n            \"customerAddress\": \"169.254.15.213/30\",\n            \"ownerAccount\": \"5651********\",\n            \"connectionId\": \"dxcon-********\",\n            \"virtualGatewayId\": \"vgw-abbd****\",\n            \"virtualInterfaceId\": \"dxvif-********\",\n            \"routeFilterPrefixes\": [],\n            \"location\": \"EqTY2\",\n            \"amazonAddress\": \"169.254.15.214/30\",\n            \"virtualInterfaceType\": \"private\",\n            \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n        }\n    ]\n}\n\n\n\n\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a/\u78ba\u8a8d (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3066DataCenterNetwork\u304b\u3089\u306e\u7740\u4fe1\u63a5\u7d9a\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups | jq .SecurityGroups[2].IpPermissions[1]\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n  \"IpProtocol\": \"-1\",\n  \"IpRanges\": [\n    {\n      \"CidrIp\": \"172.30.100.0/24\"\n    }\n  ],\n  \"UserIdGroupPairs\": [],\n  \"PrefixListIds\": []\n}\n\n\n\n\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u3066RoutePropagate\u3092\u6709\u52b9\u5316\n\n\u30b3\u30de\u30f3\u30c9\nRTID=`aws ec2 describe-route-tables | jq .RouteTables[0].RouteTableId | tr -d '\\\"'`\nVGWID=`aws ec2 describe-vpn-gateways | jq .VpnGateways[0].VpnGatewayId | tr -d '\\\"'`\n\ncat <<ETX\n\n    RTID : $RTID\n    VGWID: $VGWID\n\nETX\n\naws ec2 enable-vgw-route-propagation --route-table-id $RTID --gateway-id $VGWID\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n\u306a\u3057\n\n\n\n\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"RouteTables\": [\n        {\n            \"Associations\": [\n                {\n                    \"RouteTableAssociationId\": \"rtbassoc-02bf****\",\n                    \"Main\": true,\n                    \"RouteTableId\": \"rtb-4998****\"\n                }\n            ],\n            \"RouteTableId\": \"rtb-4998****\",\n            \"VpcId\": \"vpc-9968****\",\n            \"PropagatingVgws\": [\n                {\n                    \"GatewayId\": \"vgw-abbd****\"\n                }\n            ],\n            \"Tags\": [],\n            \"Routes\": [\n                {\n                    \"GatewayId\": \"local\",\n                    \"DestinationCidrBlock\": \"172.31.0.0/16\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRouteTable\"\n                },\n                {\n                    \"GatewayId\": \"igw-aa9b****\",\n                    \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRoute\"\n                },\n                {\n                    \"GatewayId\": \"vgw-abbd****\",\n                    \"DestinationCidrBlock\": \"172.30.100.0/24\",\n                    \"State\": \"active\",\n                    \"Origin\": \"EnableVgwRoutePropagation\"\n                }\n            ]\n        }\n    ]\n}\n\n\n\nVirtualInterface\u306e\u524a\u9664 (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n\n\u30b3\u30de\u30f3\u30c9\nVIFID=`aws directconnect describe-virtual-interfaces | jq .virtualInterfaces[0].virtualInterfaceId | tr -d '\\\"'`\n\ncat <<ETX\n\n    VIFID: $VIFID\n\nETX\n\naws directconnect delete-virtual-interface --virtual-interface-id $VIFID\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"deleting\"\n}\n\n\n\n\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\naws directconnect describe-virtual-interfaces\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaces\": [\n        {\n            \"virtualInterfaceState\": \"deleted\",\n            \"asn\": 65000,\n            \"vlan\": 511,\n            \"customerAddress\": \"169.254.15.213/30\",\n            \"ownerAccount\": \"5651********\",\n            \"connectionId\": \"dxcon-********\",\n            \"virtualGatewayId\": \"vgw-abbd****\",\n            \"virtualInterfaceId\": \"dxvif-********\",\n            \"routeFilterPrefixes\": [],\n            \"location\": \"EqTY2\",\n            \"amazonAddress\": \"169.254.15.214/30\",\n            \"virtualInterfaceType\": \"private\",\n            \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n        }\n    ]\n}\n\n\n#\u8aac\u660e\n\u4ee5\u4e0b\u30b9\u30e9\u30a4\u30c9\u306e2\u3067\u884c\u3046\u3001directconnect\u63a5\u7d9a\u306e\u5b9f\u6f14\u306b\u4f7f\u7528\u3059\u308b\u30ab\u30f3\u30cb\u30f3\u30b0\u30da\u30fc\u30d1\u30fc\u3067\u3059\u3002\nhttp://www.slideshare.net/TomoakiHira/let-us-make-clear-the-aws-directconnect\n\n#\u5b9f\u6f14\n##\u74b0\u5883\u78ba\u8a8d (DirectConnect\u5229\u7528\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n###VPC\u306e\u78ba\u8a8d\n```text:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpcs\n```\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"Vpcs\": [\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"InstanceTenancy\": \"default\",\n            \"State\": \"available\",\n            \"DhcpOptionsId\": \"dopt-622a****\",\n            \"CidrBlock\": \"172.31.0.0/16\",\n            \"IsDefault\": true\n        }\n    ]\n}\n```\n###\u30b5\u30d6\u30cd\u30c3\u30c8\u306e\u78ba\u8a8d\n\n```text:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-subnets\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"Subnets\": [\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"CidrBlock\": \"172.31.0.0/20\",\n            \"MapPublicIpOnLaunch\": true,\n            \"DefaultForAz\": true,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1c\",\n            \"SubnetId\": \"subnet-b509****\",\n            \"AvailableIpAddressCount\": 4091\n        },\n        {\n            \"VpcId\": \"vpc-9968****\",\n            \"CidrBlock\": \"172.31.16.0/20\",\n            \"MapPublicIpOnLaunch\": true,\n            \"DefaultForAz\": true,\n            \"State\": \"available\",\n            \"AvailabilityZone\": \"ap-northeast-1a\",\n            \"SubnetId\": \"subnet-4aeb****\",\n            \"AvailableIpAddressCount\": 4090\n        }\n    ]\n}\n```\n###VPN\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4(\u4eee\u60f3\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4)\u306e\u78ba\u8a8d\n```text:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-vpn-gateways\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"VpnGateways\": [\n        {\n            \"State\": \"available\",\n            \"Tags\": [\n                {\n                    \"Value\": \"test\",\n                    \"Key\": \"Name\"\n                }\n            ],\n            \"Type\": \"ipsec.1\",\n            \"VpnGatewayId\": \"vgw-abbd****\",\n            \"VpcAttachments\": [\n                {\n                    \"State\": \"attached\",\n                    \"VpcId\": \"vpc-9968****\"\n                }\n            ]\n        }\n    ]\n}\n```\n###\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306e\u78ba\u8a8d\n\n```text:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"RouteTables\": [\n        {\n            \"Associations\": [\n                {\n                    \"RouteTableAssociationId\": \"rtbassoc-02bf****\",\n                    \"Main\": true,\n                    \"RouteTableId\": \"rtb-4998****\"\n                }\n            ],\n            \"RouteTableId\": \"rtb-4998****\",\n            \"VpcId\": \"vpc-9968****\",\n            \"PropagatingVgws\": [],\n            \"Tags\": [],\n            \"Routes\": [\n                {\n                    \"GatewayId\": \"local\",\n                    \"DestinationCidrBlock\": \"172.31.0.0/16\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRouteTable\"\n                },\n                {\n                    \"GatewayId\": \"igw-aa9b****\",\n                    \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRoute\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n##\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d (DirectConnect\u7ba1\u7406\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n```text:\u30b3\u30de\u30f3\u30c9\naws directconnect describe-connections\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"connections\": [\n        {\n            \"ownerAccount\": \"1790********\",\n            \"connectionId\": \"dxcon-********\",\n            \"connectionState\": \"available\",\n            \"bandwidth\": \"10Gbps\",\n            \"location\": \"EqTY2\",\n            \"connectionName\": \"********\",\n            \"region\": \"ap-northeast-1\"\n        },\n        {\n            \"ownerAccount\": \"1790********\",\n            \"connectionId\": \"dxcon-********\",\n            \"connectionState\": \"available\",\n            \"bandwidth\": \"10Gbps\",\n            \"location\": \"EqTY2\",\n            \"connectionName\": \"********\",\n            \"region\": \"ap-northeast-1\"\n        }\n    ]\n}\n```\n##\u30e6\u30fc\u30b6\u30a2\u30ab\u30a6\u30f3\u30c8\u306bVirtualInterface\u3092\u5272\u5f53(DirectConnect\u7ba1\u7406\u8005\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n```text:\u30b3\u30de\u30f3\u30c9\nCONNECTION='dxcon-********'\nVIFNAME='NWG-HIRA-BK'\nACCOUNTID='5651********'\nVLANID='511'\nROUTERIP='169.254.15.213/30'\nAMAZONIP='169.254.15.214/30'\nBGPASN='65000'\nBGPMD5='fr3gUCLDLS6MQsVLVBw9zgdt'\n\ncat <<ETX\n\n    CONNECTION: $CONNECTION\n    VIFNAME   : $VIFNAME\n    ACCOUNTID : $ACCOUNTID\n    VLANID    : $VLANID\n    ROUTERIP  : $ROUTERIP\n    AMAZONIP  : $AMAZONIP\n    BGPASN    : $BGPASN\n    BGPMD5    : $BGPMD5\n\nETX\n\naws directconnect allocate-private-virtual-interface --connection-id $CONNECTION --owner-account $ACCOUNTID --new-private-virtual-interface-allocation virtualInterfaceName=$VIFNAME,vlan=$VLANID,asn=$BGPASN,authKey=$BGPMD5,amazonAddress=$AMAZONIP,customerAddress=$ROUTERIP\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"confirming\",\n    \"asn\": 65000,\n    \"vlan\": 511,\n    \"customerAddress\": \"169.254.15.213/30\",\n    \"ownerAccount\": \"5651********\",\n    \"connectionId\": \"dxcon-********\",\n    \"virtualInterfaceId\": \"dxvif-********\",\n    \"authKey\": \"fr3gUCLDLS6MQsVLVBw9zgdt\",\n    \"routeFilterPrefixes\": [],\n    \"location\": \"EqTY2\",\n    \"customerRouterConfig\": \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<logical_connection id=\\\"dxvif-********\\\">\\n  <vlan>511</vlan>\\n  <customer_address>169.254.15.213/30</customer_address>\\n  <amazon_address>169.254.15.214/30</amazon_address>\\n  <bgp_asn>65000</bgp_asn>\\n  <bgp_auth_key>fr3gUCLDLS6MQsVLVBw9zgdt</bgp_auth_key>\\n  <amazon_bgp_asn>10124</amazon_bgp_asn>\\n  <connection_type>private</connection_type>\\n</logical_connection>\\n\",\n    \"amazonAddress\": \"169.254.15.214/30\",\n    \"virtualInterfaceType\": \"private\",\n    \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n}\n```\n##VirtualInterface\u306eConfirm (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n```text:\u30b3\u30de\u30f3\u30c9\nVGWID=`aws ec2 describe-vpn-gateways | jq .VpnGateways[0].VpnGatewayId | tr -d '\\\"'`\nVIFID=`aws directconnect describe-virtual-interfaces | jq .virtualInterfaces[0].virtualInterfaceId | tr -d '\\\"'`\n\ncat <<ETX\n\n    VGWID: $VGWID\n    VIFID: $VIFID\n\nETX\n\naws directconnect confirm-private-virtual-interface --virtual-interface-id $VIFID --virtual-gateway-id $VGWID\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"pending\"\n}\n```\n```text:\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\nwatch -n 10 \"aws directconnect describe-virtual-interfaces\"\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaces\": [\n        {\n            \"virtualInterfaceState\": \"available\",\n            \"asn\": 65000,\n            \"vlan\": 511,\n            \"customerAddress\": \"169.254.15.213/30\",\n            \"ownerAccount\": \"5651********\",\n            \"connectionId\": \"dxcon-********\",\n            \"virtualGatewayId\": \"vgw-abbd****\",\n            \"virtualInterfaceId\": \"dxvif-********\",\n            \"routeFilterPrefixes\": [],\n            \"location\": \"EqTY2\",\n            \"amazonAddress\": \"169.254.15.214/30\",\n            \"virtualInterfaceType\": \"private\",\n            \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n        }\n    ]\n}\n```\n##\u305d\u306e\u4ed6\u306e\u8a2d\u5b9a/\u78ba\u8a8d (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n###\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3066DataCenterNetwork\u304b\u3089\u306e\u7740\u4fe1\u63a5\u7d9a\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\n\n```text:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups | jq .SecurityGroups[2].IpPermissions[1]\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n  \"IpProtocol\": \"-1\",\n  \"IpRanges\": [\n    {\n      \"CidrIp\": \"172.30.100.0/24\"\n    }\n  ],\n  \"UserIdGroupPairs\": [],\n  \"PrefixListIds\": []\n}\n```\n###\u30eb\u30fc\u30c8\u30c6\u30fc\u30d6\u30eb\u306b\u3066RoutePropagate\u3092\u6709\u52b9\u5316\n\n```text:\u30b3\u30de\u30f3\u30c9\nRTID=`aws ec2 describe-route-tables | jq .RouteTables[0].RouteTableId | tr -d '\\\"'`\nVGWID=`aws ec2 describe-vpn-gateways | jq .VpnGateways[0].VpnGatewayId | tr -d '\\\"'`\n\ncat <<ETX\n\n    RTID : $RTID\n    VGWID: $VGWID\n\nETX\n\naws ec2 enable-vgw-route-propagation --route-table-id $RTID --gateway-id $VGWID\n```\n```text:\u30ec\u30b9\u30dd\u30f3\u30b9\n\u306a\u3057\n```\n```text:\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\naws ec2 describe-route-tables\n```\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"RouteTables\": [\n        {\n            \"Associations\": [\n                {\n                    \"RouteTableAssociationId\": \"rtbassoc-02bf****\",\n                    \"Main\": true,\n                    \"RouteTableId\": \"rtb-4998****\"\n                }\n            ],\n            \"RouteTableId\": \"rtb-4998****\",\n            \"VpcId\": \"vpc-9968****\",\n            \"PropagatingVgws\": [\n                {\n                    \"GatewayId\": \"vgw-abbd****\"\n                }\n            ],\n            \"Tags\": [],\n            \"Routes\": [\n                {\n                    \"GatewayId\": \"local\",\n                    \"DestinationCidrBlock\": \"172.31.0.0/16\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRouteTable\"\n                },\n                {\n                    \"GatewayId\": \"igw-aa9b****\",\n                    \"DestinationCidrBlock\": \"0.0.0.0/0\",\n                    \"State\": \"active\",\n                    \"Origin\": \"CreateRoute\"\n                },\n                {\n                    \"GatewayId\": \"vgw-abbd****\",\n                    \"DestinationCidrBlock\": \"172.30.100.0/24\",\n                    \"State\": \"active\",\n                    \"Origin\": \"EnableVgwRoutePropagation\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n##VirtualInterface\u306e\u524a\u9664 (DirectConnect\u30e6\u30fc\u30b6\u5074\u30a2\u30ab\u30a6\u30f3\u30c8)\n```text:\u30b3\u30de\u30f3\u30c9\nVIFID=`aws directconnect describe-virtual-interfaces | jq .virtualInterfaces[0].virtualInterfaceId | tr -d '\\\"'`\n\ncat <<ETX\n\n    VIFID: $VIFID\n\nETX\n\naws directconnect delete-virtual-interface --virtual-interface-id $VIFID\n```\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaceState\": \"deleting\"\n}\n```\n```text:\u8ffd\u52a0\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\naws directconnect describe-virtual-interfaces\n```\n\n```json:\u30ec\u30b9\u30dd\u30f3\u30b9\n{\n    \"virtualInterfaces\": [\n        {\n            \"virtualInterfaceState\": \"deleted\",\n            \"asn\": 65000,\n            \"vlan\": 511,\n            \"customerAddress\": \"169.254.15.213/30\",\n            \"ownerAccount\": \"5651********\",\n            \"connectionId\": \"dxcon-********\",\n            \"virtualGatewayId\": \"vgw-abbd****\",\n            \"virtualInterfaceId\": \"dxvif-********\",\n            \"routeFilterPrefixes\": [],\n            \"location\": \"EqTY2\",\n            \"amazonAddress\": \"169.254.15.214/30\",\n            \"virtualInterfaceType\": \"private\",\n            \"virtualInterfaceName\": \"NWG-HIRA-BK\"\n        }\n    ]\n}\n```\n", "tags": ["aws-cli"]}