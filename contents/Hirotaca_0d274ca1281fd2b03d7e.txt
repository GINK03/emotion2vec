{"context": "\n\n\u65e2\u306b Twitter\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u6e08\u307f\u3002\nRails -v 4.2.6\n\u4f7f\u7528\u3059\u308b gem\n\n\nomniauth-twitter  -v1.2.1\n\nomniauth -v1.3.1\n\ndotenv-rails  -v2.1.0\n\n\nHeroku\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3089config/secrets.yml\u304c\u7121\u3044\u3063\u3066\u6012\u3089\u308c\u308b\u304b\u3089\ndotenv-rails\u3067\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066secrets.yml\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u4e0b\u306b\u5165\u308c\u305f\u3002\n\n\n1 /.env \u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ndotenv-rails\u304c\u74b0\u5883\u5909\u6570\u3092.env\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u53d6\u5f97\u3059\u308b\u3002\n\n/.env\n    TWITTER_CONSUMER_KEY    =  \u201cTwitter************API_Key\u201d\u2028\n    TWITTER_CONSUMER_SECRET =  \u201cTwitter**********secret_Key\u201d\n\n\n\n\n\u5fc5\u305a\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u304b\u3089\u5916\u3059\u3002(git\u306a\u3089gitignore\u306b\u8ffd\u52a0\u3059\u308b)\n\n\n2  config/secrets.yml\u3092\u74b0\u5883\u5909\u6570\u306b\u5bfe\u5fdc\u3055\u305b\u308b\u3002\n\nconfig/secrets.yml\n\ndefault_twitter: &default_twitter\n  twitter_api_key:     <%= ENV[\"TWITTER_CONSUMER_KEY\"] %>\n  twitter_api_secret:  <%= ENV[\"TWITTER_CONSUMER_SECRET\"] %>\n\n\n\n\ndefault_twitter: &default_twitter\u2028\n  twitter_api_key:    <%= ENV[\"TWITTER_CONSUMER_KEY\"] %>\u2028\n  twitter_api_secret: <%= ENV[\"TWITTER_CONSUMER_SECRET\"] %>\u2028\u2028\n\n  development:\u2028  secret_key_base: \u6587\u5b57\u5217\u2028  ****************\n  <<: *default_twitter\n\n\u2028  test:\u2028         secret_key_base: \u6587\u5b57\u5217\u2028  ****************\n  <<: *default_twitter\u2028\u2028\n\n  production:\u2028   secret_key_base: <%= ENV[\"SECRET_KEY_BASE\"] %>\n\u2028  <<: *default_twitter\n\n\n3  config/initializers/omniauth.rb\u3092\u4f5c\u6210\ntwitter\u7528\u306eprovider\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nconfig/initializers/omniauth.rb\nRails.application.config.middleware.use OmniAuth::Builder do\u2028\n   provider :twitter, Rails.application.secrets.twitter_api_key,\n                      Rails.application.secrets.twitter_api_secret\u2028\nend\n\n\n\n4  Twitter OAuth(Omniauth)\u306e\u30e2\u30c7\u30eb\n  User:\n    provider:  string -OmniAuth\u306e\u8a8d\u8a3c\u3067\u4f7f\u7528\u3059\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u540d(\u4f8b: \u2018twitter\u2019)\n    uid:       string -Provider\u6bce\u306b\u4e0e\u3048\u3089\u308c\u308b\u8b58\u5225\u7528\u306e\u6587\u5b57\u5217\n    nickname:  string -Twitter ID\n    image_url: string -Twitter\u30a2\u30a4\u30b3\u30f3\u753b\u50cf\u306eURL\n\n    add_index :users,[:provider,:uid],unique:true\n\n\u4eca\u56de\u306f\u5168\u3066Null:false\n  (\u30e6\u30cb\u30fc\u30af\u30a4\u30f3\u30c7\u30c3\u30af\u30b9) provider\u3068uid\u306e\u7d44\u307f\u5408\u308f\u305b\u306f\u540c\u3058\u3082\u306e\u306f\u3042\u3063\u3066\u306f\u306a\u3089\u306a\u3044\u3002\n\n5  /auth/twitter\u306b\u98db\u3070\u3059\u3002\n\nTwitter OAuth \u30ed\u30b0\u30a4\u30f3\u5f8c\u51e6\u7406\n\u30ed\u30b0\u30a4\u30f3\u5f8c \u5024\u3092 /auth/twitter/callback \u3078\u98db\u3070\u3059\u3002\n\n1 \u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u5bfe\u5fdc\u3059\u308b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4f5c\u6210\u3002\nrails g controller sessions\n\n2 create\u30a2\u30af\u30b7\u30e7\u30f3\u3068\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4f5c\u6210\n\nuser.rb\nclass << self\n  def find_or_create_from_auth_hash(auth_hash)\n    provider  = auth_hash[:provider]\n    uid       = auth_hash[:uid]\n    nickname  = auth_hash[:info][:nickname]\n    image_url = auth_hash[:info][:image]\n\n   find_or_create_by(provider: provider,uid: uid) do |user|\n    user.nickname  = nickname\n    user.image_url = image_url\n  end\nend\n\n\n\n/sessions_controller.rb\n\ndef create\n  user = User.find_or_create_from_auth_hash(request.env[\u2018omniauth.auth\u2019])\n  session[:user_id] = user.id\n  flash[success] = \u2018\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f\u3002\u2019\n  redirect_to root_path\nend\n\n\n\n/sessions_helper.rb\n\ndef log_in(user)\n  session[:user_id]  = user.id\nend\n\ndef logged_in?\n  !session[:user_id].nil?\nend\n\n\n\n/application_controller.rb\ninclude SessionHelper\n\n\n\n3 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u4f5c\u6210\n\nconfig/routes.rb\nget \u2018/auth/:provider/callback\u2019 => \u2019sessions#create\u2019\nget \u2018/delete\u2019=> \u2018sessions#destroy\u2019,as: :logout\n\n\n\n4 \u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u4f5c\u6210\n\n/sessions_controller.rb\ndef destroy\n reset_session\n flash[:info] = \u2018\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u2019\n redirect_to root_path\nend\n\n\n\n5 header \u5909\u66f4\nunless logged_in?\n   link_to '\u30ed\u30b0\u30a4\u30f3','/auth/twitter'\nelse\n   link_to '\u30ed\u30b0\u30a2\u30a6\u30c8',logout_path\nend\n\n\n###\u65e2\u306b Twitter\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u6e08\u307f\u3002\n\n__Rails__ -v 4.2.6\n\n\u4f7f\u7528\u3059\u308b __gem__\n\n* __omniauth-twitter__  -v1.2.1\n* __omniauth__ -v1.3.1\n* __dotenv-rails__  -v2.1.0\n\n----------------\nHeroku\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u3089config/secrets.yml\u304c\u7121\u3044\u3063\u3066\u6012\u3089\u308c\u308b\u304b\u3089\ndotenv-rails\u3067\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3046\u3088\u3046\u306b\u3057\u3066secrets.yml\u3092\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u4e0b\u306b\u5165\u308c\u305f\u3002\n\n\n----------------\n\n####1 /.env \u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\ndotenv-rails\u304c\u74b0\u5883\u5909\u6570\u3092.env\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u53d6\u5f97\u3059\u308b\u3002\n\n``` /.env\n    TWITTER_CONSUMER_KEY    =  \u201cTwitter************API_Key\u201d\u2028\n    TWITTER_CONSUMER_SECRET =  \u201cTwitter**********secret_Key\u201d\n\n```\n\n###**`\u5fc5\u305a\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u304b\u3089\u5916\u3059\u3002(git\u306a\u3089gitignore\u306b\u8ffd\u52a0\u3059\u308b)`**\n\n\n####2  config/secrets.yml\u3092\u74b0\u5883\u5909\u6570\u306b\u5bfe\u5fdc\u3055\u305b\u308b\u3002\n\n``` config/secrets.yml\n\ndefault_twitter: &default_twitter\n  twitter_api_key:     <%= ENV[\"TWITTER_CONSUMER_KEY\"] %>\n  twitter_api_secret:  <%= ENV[\"TWITTER_CONSUMER_SECRET\"] %>\n\n```\n\n```\u4f8b1)\n\ndefault_twitter: &default_twitter\u2028\n  twitter_api_key:    <%= ENV[\"TWITTER_CONSUMER_KEY\"] %>\u2028\n  twitter_api_secret: <%= ENV[\"TWITTER_CONSUMER_SECRET\"] %>\u2028\u2028\n\n  development:\u2028  secret_key_base: \u6587\u5b57\u5217\u2028  ****************\n  <<: *default_twitter\n\n\u2028  test:\u2028         secret_key_base: \u6587\u5b57\u5217\u2028  ****************\n  <<: *default_twitter\u2028\u2028\n\n  production:\u2028   secret_key_base: <%= ENV[\"SECRET_KEY_BASE\"] %>\n\u2028  <<: *default_twitter\n```\n\n####3  config/initializers/omniauth.rb\u3092\u4f5c\u6210\n\ntwitter\u7528\u306eprovider\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n``` config/initializers/omniauth.rb\nRails.application.config.middleware.use OmniAuth::Builder do\u2028\n   provider :twitter, Rails.application.secrets.twitter_api_key,\n                      Rails.application.secrets.twitter_api_secret\u2028\nend\n```\n\n####4  Twitter OAuth(Omniauth)\u306e\u30e2\u30c7\u30eb\n\n  ```TwitterOAuth\u30e2\u30c7\u30eb(\u4f8b)\n  User:\n    provider:  string -OmniAuth\u306e\u8a8d\u8a3c\u3067\u4f7f\u7528\u3059\u308b\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u540d(\u4f8b: \u2018twitter\u2019)\n    uid:       string -Provider\u6bce\u306b\u4e0e\u3048\u3089\u308c\u308b\u8b58\u5225\u7528\u306e\u6587\u5b57\u5217\n    nickname:  string -Twitter ID\n    image_url: string -Twitter\u30a2\u30a4\u30b3\u30f3\u753b\u50cf\u306eURL\n\n    add_index :users,[:provider,:uid],unique:true\n  ```\n  \u4eca\u56de\u306f\u5168\u3066Null:false\n  (\u30e6\u30cb\u30fc\u30af\u30a4\u30f3\u30c7\u30c3\u30af\u30b9) provider\u3068uid\u306e\u7d44\u307f\u5408\u308f\u305b\u306f\u540c\u3058\u3082\u306e\u306f\u3042\u3063\u3066\u306f\u306a\u3089\u306a\u3044\u3002\n\n####5  /auth/twitter\u306b\u98db\u3070\u3059\u3002\n\n##  Twitter OAuth \u30ed\u30b0\u30a4\u30f3\u5f8c\u51e6\u7406\n\n\u30ed\u30b0\u30a4\u30f3\u5f8c \u5024\u3092 __/auth/twitter/callback__ \u3078\u98db\u3070\u3059\u3002\n\n####1 \u30ed\u30b0\u30a4\u30f3\u5f8c\u306b\u5bfe\u5fdc\u3059\u308b\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4f5c\u6210\u3002\n\n\n__`rails g controller sessions`__\n\n####2 create\u30a2\u30af\u30b7\u30e7\u30f3\u3068\u30ed\u30b0\u30a4\u30f3\u6a5f\u80fd\u3092\u4f5c\u6210\n\n```user.rb\nclass << self\n  def find_or_create_from_auth_hash(auth_hash)\n    provider  = auth_hash[:provider]\n    uid       = auth_hash[:uid]\n    nickname  = auth_hash[:info][:nickname]\n    image_url = auth_hash[:info][:image]\n\n   find_or_create_by(provider: provider,uid: uid) do |user|\n    user.nickname  = nickname\n    user.image_url = image_url\n  end\nend\n```\n\n```/sessions_controller.rb\n\ndef create\n  user = User.find_or_create_from_auth_hash(request.env[\u2018omniauth.auth\u2019])\n  session[:user_id] = user.id\n  flash[success] = \u2018\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3057\u305f\u3002\u2019\n  redirect_to root_path\nend\n```\n\n```/sessions_helper.rb\n\ndef log_in(user)\n  session[:user_id]  = user.id\nend\n\ndef logged_in?\n  !session[:user_id].nil?\nend\n```\n\n```/application_controller.rb\ninclude SessionHelper\n```\n\n####3 \u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u4f5c\u6210\n\n```config/routes.rb\nget \u2018/auth/:provider/callback\u2019 => \u2019sessions#create\u2019\nget \u2018/delete\u2019=> \u2018sessions#destroy\u2019,as: :logout\n```\n\n####4 \u30ed\u30b0\u30a2\u30a6\u30c8\u51e6\u7406\u3092\u4f5c\u6210\n\n```/sessions_controller.rb\ndef destroy\n reset_session\n flash[:info] = \u2018\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u307e\u3057\u305f\u3002\u2019\n redirect_to root_path\nend\n```\n####5 header \u5909\u66f4\n```\nunless logged_in?\n   link_to '\u30ed\u30b0\u30a4\u30f3','/auth/twitter'\nelse\n   link_to '\u30ed\u30b0\u30a2\u30a6\u30c8',logout_path\nend\n```\n\n\n\n", "tags": ["OAuth", "Twitter", "Rails", "omniauth-twitter", "Heroku"]}