{"context": " More than 1 year has passed since last update.2015/01/08\u8ffd\u8a18 \u30b3\u30b3\u30ab\u30e9-->\n\u672c\u30a8\u30f3\u30c8\u30ea\u5185\u3067\u7d39\u4ecb\u3057\u3066\u3044\u308b src/Module/OAuth/Twitter{Module|Provider}.php \u306f\u5916\u90e8\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u5207\u308a\u51fa\u3057\u3001 ray/oauth-module \u3068\u3057\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n<--\u30b3\u30b3\u30de\u30c7\n\n\u3064\u3044\u6628\u65e5(2014/12/22)\u3001BEAR.Sunday v1.0.0-alpha \u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\uff01\n\n\u6700\u521d\u306b\n\u4eca\u3061\u3087\u3046\u3069\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u3067BEAR.Sunday\u3092\u4f7f\u3063\u305f\u30b5\u30fc\u30d3\u30b9\u958b\u767a\u3092\u9032\u3081\u3066\u3044\u3066\u3001Twitter\u3078\u306eOAuth\u3068\u3044\u3046\u5927\u304d\u3081\u306e\u5b9f\u88c5\u306b\u7740\u624b\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u306e\u6a5f\u4f1a\u306bAdventCalendar\u306e\u30a8\u30f3\u30c8\u30ea\u3068\u3057\u3066\u5b9f\u88c5\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\nBEAR.Sunday \u3068 PHPoAuthLib\n\n\nBEAR.Sunday\n\n\u30ea\u30bd\u30fc\u30b9\u6307\u5411\u306ePHP\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\nDI\u3068AOP\u3092\u30b5\u30dd\u30fc\u30c8\n\nBEAR.Package\u3001BEAR.Resource\u3001BEAR.Sunday\u306e3\u3064\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u304b\u3089\u69cb\u6210\u3055\u308c\u308b\n2014/12/22\u306bv1.0.0-alpha\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u81ea\u5206\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304cv0.10.5\u306e\u305f\u3081\u3001\u672c\u30a8\u30f3\u30c8\u30ea\u3067\u306fv0.10\u7cfb\u3092\u4f7f\u7528\u3059\u308b\u524d\u63d0\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\n\n\n\nPHPoAuthLib\n\nPHP\u88fd\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\nTwitter\u4ee5\u5916\u306b\u3082\u591a\u304f\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n\u3044\u304f\u3064\u304b\u5b58\u5728\u3059\u308bPHP\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4e2d\u3067\uff11\u756a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u3067\u3057\u3063\u304b\u308a\u8a2d\u8a08\u3055\u308c\u3066\u3044\u308b(\u3068\u601d\u3046(\u5c0f\u4e26\u611f))\n\n\n\n\n\u672c\u30a8\u30f3\u30c8\u30ea\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u306a\u3044\u3053\u3068\n\n\nBEAR.Sunday(v0.10\u7cfb)\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u65b9\u6cd5\n$ composer create-project bear/skeleton:~0.10 My.Project\n$ cd My.Project\n$ composer install\n\n\nBEAR.Sunday\u306eDI(Dependency Injection)\u306e\u4ed5\u7d44\u307f\nOAuth\u306e\u4ed5\u7d44\u307f\nTwitter\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u65b9\u6cd5\uff08\uff1dAPI\u30ad\u30fc\u306e\u53d6\u5f97\u65b9\u6cd5\uff09\n\n\nTwitter\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\nTwitter\u30a2\u30d7\u30ea\u306e\u7ba1\u7406\u30da\u30fc\u30b8\u3067 Website \u3068 Callback URL \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\n\u7de8\u96c6/\u8ffd\u52a0\u3057\u305f\u90e8\u5206\u4ee5\u5916\u306f\u3001\u57fa\u672c\u7684\u306bComposer\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u305d\u306e\u307e\u307e\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\u3067\u3059\u3002\n\n\nPHPoAuthLib\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsrc/composer.json (\u7de8\u96c6)\n    \"require\": {\n        \"php\": \"5.5.*\",\n        \"bear/package\": \"0.13.0\",\n+       \"lusitanian/oauth\": \"~0.3\",\n        \"ext-apcu\": \"*\",\n        \"ext-mbstring\": \"*\"\n    },\n\n\nTwitter\u306eAPI\u30ad\u30fc\u3092\u5b9a\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3001DI\u306b\u3088\u308a\u4f7f\u7528\u3059\u308b\nvar/conf/constants.php (\u7de8\u96c6)\nTwitter API\u306eConsumer Key,Consumer Secret\u3068Callback URL\u3092\u5b9a\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3001\u4ee5\u964d\u306e\u30ed\u30b8\u30c3\u30af\u304b\u3089DI\u306e\u4ed5\u7d44\u307f\u306b\u3088\u308a\u4f7f\u7528\u3057\u307e\u3059\u3002\n    'prod' => [\n        // DB\n        'master_db' => $masterDb,\n        'slave_db'  => $slaveDb,\n+       // Twitter API\n+       'twitter_api' => [\n+           'consumer_key'    => '{YOUR_CONSUMER_KEY}',\n+           'consumer_secret' => '{YOUR_CONSUMER_SECRET}',\n+           // OAuth\u6642\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u30d1\u30b9\n+           'oauth_callback_path' => '/oauth/twitter/callback',\n+       ],\n    ],\n\n\nPHPoAuthLib\u3092DI\u3059\u308b\nsrc/Module/OAuth/TwitterProvider.php (\u8ffd\u52a0)\nPHPoAuthLib\u3092BEAR.Sunday\u306eDI\u306e\u4ed5\u7d44\u307f\u304b\u3089\u4f7f\u3046\u305f\u3081\u306e\u521d\u671f\u5316\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n<?php\n\nnamespace My\\Project\\Module\\OAuth;\n\nuse OAuth\\Common\\Consumer\\Credentials;\nuse OAuth\\Common\\Http\\Uri\\UriFactory;\nuse OAuth\\Common\\Storage\\Session;\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse OAuth\\ServiceFactory;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Ray\\Di\\ProviderInterface;\n\nclass TwitterProvider implements ProviderInterface\n{\n    /**\n     * @var string\n     */\n    private $consumerKey;\n\n    /**\n     * @var string\n     */\n    private $consumerSecret;\n\n    /**\n     * @var string\n     */\n    private $oauthCallbackPath;\n\n    /**\n     * @param array $apiConfig\n     *\n     * @Inject\n     * @Named(\"twitter_api\")\n     */\n    public function __construct($apiConfig)\n    {\n        $this->consumerKey    = $apiConfig['consumer_key'];\n        $this->consumerSecret = $apiConfig['consumer_secret'];\n        $this->oauthCallbackPath = $apiConfig['oauth_callback_path'];\n    }\n\n    /**\n     * @return \\OAuth\\OAuth1\\Service\\Twitter\n     */\n    public function get()\n    {\n        // \u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306e\u751f\u6210\n        $uri = (new UriFactory())->createFromSuperGlobalArray($_SERVER);\n        $uri->setPath($this->oauthCallbackPath);\n        $uri->setQuery('');\n        $callbackUrl = $uri->getAbsoluteUri();\n\n        $credentials = new Credentials(\n            $this->consumerKey,\n            $this->consumerSecret,\n            $callbackUrl\n        );\n\n        // Twitter\u7528\u306eOAuth\u30b5\u30fc\u30d3\u30b9\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n        return (new ServiceFactory())->createService('twitter', $credentials, new Session());\n    }\n}\n\n\nsrc/Module/OAuth/TwitterModule.php (\u8ffd\u52a0)\n\u4e0a\u3067\u4f5c\u6210\u3057\u305fTwitterProvider(\u306eget\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024)\u3092\\OAuth\\OAuth1\\Service\\Twitter\u306b\u6ce8\u5165(\u675f\u7e1b)\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n<?php\n\nnamespace My\\Project\\Module\\OAuth;\n\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Scope;\n\nclass TwitterModule extends AbstractModule\n{\n\n    protected function configure()\n    {\n        $this->bind(Twitter::class)->toProvider(TwitterProvider::class)->in(Scope::SINGLETON);\n    }\n}\n\n\nsrc/Module/App/Dependency.php (\u7de8\u96c6)\n    protected function configure()\n    {\n+       $this->install(new TwitterModule());\n    }\n\nsrc/Module/AppModule.php (\u7de8\u96c6)\n\u4f9d\u5b58\u3092\u30a2\u30d7\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n    protected function configure()\n    {\n        $this->install(new StandardPackageModule('Kawanamiyuu\\Pentan', $this->context, dirname(dirname(__DIR__))));\n\n        // override module\n        // $this->install(new SmartyModule($this));\n\n        // $this->install(new AuraViewModule($this));\n\n        // install application dependency\n-       // $this->install(new App\\Dependency);\n+       $this->install(new App\\Dependency);\n\n        // install application aspect\n         $this->install(new App\\Aspect($this));\n    }\n}\n\n\nsrc/Inject/TwitterOAuthServiceInject.php (\u8ffd\u52a0)\n\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u306f\u3053\u306etrait\u3092use\u3059\u308b\u3053\u3068\u3067OAuth\u30ed\u30b8\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002setTwitterOAuthService\u3067\u4f9d\u5b58\u304c\u6ce8\u5165\u3055\u308c\u307e\u3059\u3002\n<?php\n\nnamespace My\\Project\\Inject;\n\n\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse Ray\\Di\\Di\\Inject;\n\ntrait TwitterOAuthServiceInject\n{\n    /**\n     * @var Twitter\n     */\n    protected $twitterOAuthService;\n\n    /**\n     * @param Twitter $twitter\n     *\n     * @Inject\n     */\n    public function setTwitterOAuthService(Twitter $twitter)\n    {\n        $this->twitterOAuthService = $twitter;\n    }\n} \n\n\n\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\nsrc/Resource/Page/Oauth/Twitter/Redirect.php (\u8ffd\u52a0)\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762 \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b \u305f\u3081\u306ePage\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\u6b21\u306eURL\u30d1\u30b9\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u2192 /oauth/twitter/redirect\n<?php\n\nnamespace My\\Project\\Resource\\Page\\Oauth\\Twitter;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Inject\\TwitterOAuthServiceInject;\n\nclass Redirect extends ResourceObject\n{\n    use TwitterOAuthServiceInject;\n\n    public function onGet()\n    {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\n        $requestToken = $this->twitterOAuthService->requestRequestToken()->getRequestToken();\n\n        $url = $this->twitterOAuthService->getAuthorizationUri([\n            'oauth_token' => $requestToken,\n            'force_login' => 'true',\n        ]);\n\n        // Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n        header('Location:' . $url);\n        exit;\n    }\n} \n\n\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762\u304b\u3089\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\nsrc/Resource/Page/Oauth/Twitter/Callback.php (\u8ffd\u52a0)\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762 \u304b\u3089\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b Page\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\u6b21\u306eURL\u30d1\u30b9\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u2192 /oauth/twitter/callback\n<?php\n\nnamespace My\\Project\\Resource\\Page\\Oauth\\Twitter;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Inject\\TwitterOAuthServiceInject;\n\nclass Callback extends ResourceObject\n{\n    use TwitterOAuthServiceInject;\n\n        /**\n         * @param string $oauth_token\n         * @param string $oauth_verifier\n         * @param string $denied\n         */\n    public function onGet($oauth_token = null, $oauth_verifier = null, $denied = null)\n    {\n        // Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u3067[\u30ad\u30e3\u30f3\u30bb\u30eb]\u30dc\u30bf\u30f3\u3092\u62bc\u3055\u308c\u305f\u5834\u5408\n        if ($denied) {\n            $this['is_authorized'] = false;\n            return $this;\n        }\n\n        // \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\n        $accessToken = $this->twitterOAuthService->requestAccessToken(\n            $oauth_token,\n            $oauth_verifier\n        );\n\n        // \u8a8d\u8a3c\u6210\u529f\u6642\n        $this['is_authorized'] = true;\n        $this['token']         = $accessToken->getAccessToken();\n        $this['token_secret']  = $accessToken->getAccessTokenSecret();\n        $this['user_id']       = $accessToken->getExtraParams()['user_id'];\n        $this['screen_name']   = $accessToken->getExtraParams()['screen_name'];\n        return $this;\n    }\n} \n\nsrc/Resource/Page/Oauth/Twitter/Callback.twig (\u8ffd\u52a0)\n\u203b\u6ce8\u610f\u203b\n\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306e\u4fbf\u5b9c\u4e0a\u3001\u53d6\u5f97\u3057\u305f\u30c8\u30fc\u30af\u30f3\u3092\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u3067\u306fDB\u306b\u4fdd\u5b58\u5f8c\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u306a\u3069\u3057\u3066\u9069\u5207\u306b\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\" />\n<style type=\"text/css\">\n    dt { font-weight: bold; }\n    dt:after { content: ':'; }\n</style>\n</head>\n<body>\n{% if is_authorized %}\n    <dl>\n        <dt>Token</dt><dd>{{ token }}</dd>\n        <dt>Token Secret</dt><dd>{{ token_secret }}</dd>\n    </dl>\n    <dl>\n        <dt>user_id</dt><dd>{{ user_id }}</dd>\n        <dt>screen_name</dt><dd>{{ screen_name }}</dd>\n    </dl>\n{% else %}\n    <p>\n        <a href=\"/oauth/twitter/redirect\">\u30ea\u30c8\u30e9\u30a4</a>\n    </p>\n{% endif %}\n</body>\n</html>\n\n\n\u30ed\u30fc\u30ab\u30eb\u3067\u306e\u52d5\u4f5c\u78ba\u8a8d\n\uff11. \u30d3\u30eb\u30c9\u30a4\u30f3\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\n$ cd /path/to/My.Project\n# DI\u3001AOP\u306e\u305f\u3081\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u30ad\u30e3\u30b7\u30e5\u3092\u524a\u9664\n$ php bin/clear.php\n$ php -S localhost:8080 -t var/www\n\n\uff12. http://localhost:8080/oauth/twitter/redirect \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\uff13. Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\n\n\uff14. [\u9023\u643a\u30a2\u30d7\u30ea\u3092\u8a8d\u8a3c]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\n\uff15. http://localhost:8080/oauth/twitter/callback \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\n\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\n\n\n\u6700\u5f8c\u306b\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306e\u5927\u534a\u304cDI\u306e\u4ed5\u7d44\u307f\u306b\u95a2\u3059\u308b\u90e8\u5206\u3067\u3042\u3063\u305f\u3088\u3046\u306b\u3001BEAR.Sunday\u3092\u4f7f\u3063\u305f\u958b\u767a\u3067\u306fDI\u304c\u5b9f\u88c5\u306e\u809d\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\u81ea\u5206\u3082\u4eca\u56de\u521d\u3081\u3066\u672c\u683c\u7684\u306b\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092DI\u3057\u3066\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u3066\u305d\u306e\u4ed5\u7d44\u307f\u306e\u7406\u89e3\u304c\u9032\u307f\u307e\u3057\u305f\u3002\n\u4eca\u5f8c\u3082BEAR.Sunday\u3092\u4f7f\u3063\u305f\u958b\u767a\u3092\u901a\u3057\u3066\u305d\u306e\u8a2d\u8a08\u601d\u60f3\u3092\u5b66\u3093\u3067\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u6b21\u306f\u4eca\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092v1.0.0-alpha\u306b\u79fb\u884c\u3057\u306a\u3044\u3068(*\u00b4\u06a1`\u25cf)\n2015/01/08\u8ffd\u8a18 \u30b3\u30b3\u30ab\u30e9-->\n\n\u672c\u30a8\u30f3\u30c8\u30ea\u5185\u3067\u7d39\u4ecb\u3057\u3066\u3044\u308b ```src/Module/OAuth/Twitter{Module|Provider}.php``` \u306f\u5916\u90e8\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u5207\u308a\u51fa\u3057\u3001 [ray/oauth-module](https://github.com/Ray-Di/Ray.OAuthModule) \u3068\u3057\u3066\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n<--\u30b3\u30b3\u30de\u30c7\n\n----\n\n\u3064\u3044\u6628\u65e5(2014/12/22)\u3001[BEAR.Sunday v1.0.0-alpha \u304c\u30ea\u30ea\u30fc\u30b9](https://www.facebook.com/permalink.php?story_fbid=295995643923923&id=110116939178462)\u3055\u308c\u307e\u3057\u305f\uff01\n\n## \u6700\u521d\u306b\n\n\u4eca\u3061\u3087\u3046\u3069\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u3067BEAR.Sunday\u3092\u4f7f\u3063\u305f\u30b5\u30fc\u30d3\u30b9\u958b\u767a\u3092\u9032\u3081\u3066\u3044\u3066\u3001Twitter\u3078\u306eOAuth\u3068\u3044\u3046\u5927\u304d\u3081\u306e\u5b9f\u88c5\u306b\u7740\u624b\u3057\u3088\u3046\u3068\u3057\u3066\u3044\u305f\u306e\u3067\u3001\u3053\u306e\u6a5f\u4f1a\u306bAdventCalendar\u306e\u30a8\u30f3\u30c8\u30ea\u3068\u3057\u3066\u5b9f\u88c5\u4f8b\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n### BEAR.Sunday \u3068 PHPoAuthLib\n\n- [BEAR.Sunday](http://bearsunday.github.io/)\n\t+ \u30ea\u30bd\u30fc\u30b9\u6307\u5411\u306ePHP\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\n\t+ DI\u3068AOP\u3092\u30b5\u30dd\u30fc\u30c8\n\t+ [BEAR.Package](https://github.com/koriym/BEAR.Package)\u3001[BEAR.Resource](https://github.com/koriym/BEAR.Resource)\u3001[BEAR.Sunday](https://github.com/koriym/BEAR.Sunday)\u306e3\u3064\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u304b\u3089\u69cb\u6210\u3055\u308c\u308b\n\t+ 2014/12/22\u306b```v1.0.0-alpha```\u304c[\u30ea\u30ea\u30fc\u30b9](https://github.com/koriym/BEAR.Sunday/releases/tag/1.0.0-alpha)\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u81ea\u5206\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u4f7f\u7528\u3057\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u304c```v0.10.5```\u306e\u305f\u3081\u3001\u672c\u30a8\u30f3\u30c8\u30ea\u3067\u306fv0.10\u7cfb\u3092\u4f7f\u7528\u3059\u308b\u524d\u63d0\u3067\u66f8\u3044\u3066\u3044\u307e\u3059\n\n- [PHPoAuthLib](https://github.com/Lusitanian/PHPoAuthLib)\n\t+ PHP\u88fd\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\n\t+ Twitter\u4ee5\u5916\u306b\u3082[\u591a\u304f\u306e\u30b5\u30fc\u30d3\u30b9](https://github.com/Lusitanian/PHPoAuthLib/tree/master/examples)\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\n\t+ \u3044\u304f\u3064\u304b\u5b58\u5728\u3059\u308bPHP\u306eOAuth\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4e2d\u3067\uff11\u756a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u3067\u3057\u3063\u304b\u308a\u8a2d\u8a08\u3055\u308c\u3066\u3044\u308b(\u3068\u601d\u3046(\u5c0f\u4e26\u611f))\n\n### \u672c\u30a8\u30f3\u30c8\u30ea\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u306a\u3044\u3053\u3068\n\n- BEAR.Sunday(v0.10\u7cfb)\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u4f5c\u6210\u65b9\u6cd5\n\n\t```bash\n\t$ composer create-project bear/skeleton:~0.10 My.Project\n\t$ cd My.Project\n\t$ composer install\n\t```\n+ BEAR.Sunday\u306eDI(Dependency Injection)\u306e\u4ed5\u7d44\u307f\n+ OAuth\u306e\u4ed5\u7d44\u307f\n+ Twitter\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u65b9\u6cd5\uff08\uff1dAPI\u30ad\u30fc\u306e\u53d6\u5f97\u65b9\u6cd5\uff09\n\n\n## Twitter\u30a2\u30d7\u30ea\u306e\u8a2d\u5b9a\n\nTwitter\u30a2\u30d7\u30ea\u306e[\u7ba1\u7406\u30da\u30fc\u30b8](https://apps.twitter.com/)\u3067 **Website** \u3068 **Callback URL** \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n![Pentan_Local___Twitter_Application_Management.png](https://qiita-image-store.s3.amazonaws.com/0/3899/111c5d7f-4fd0-f5ba-067f-134d3048d0b7.png \"Pentan_Local___Twitter_Application_Management.png\")\n\n\n## \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\n\n \u7de8\u96c6/\u8ffd\u52a0\u3057\u305f\u90e8\u5206\u4ee5\u5916\u306f\u3001\u57fa\u672c\u7684\u306bComposer\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u305d\u306e\u307e\u307e\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u6210\u3067\u3059\u3002\n\n![TwitterProvider_php_-__pentan__-_pentan_-____workspace_pentan_.png](https://qiita-image-store.s3.amazonaws.com/0/3899/680d0bf5-390a-1870-c34f-13071772ba8b.png \"TwitterProvider_php_-__pentan__-_pentan_-____workspace_pentan_.png\")\n\n### PHPoAuthLib\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n**src/composer.json (\u7de8\u96c6)**\n\n```diff\n\t\"require\": {\n\t\t\"php\": \"5.5.*\",\n\t\t\"bear/package\": \"0.13.0\",\n+\t\t\"lusitanian/oauth\": \"~0.3\",\n\t\t\"ext-apcu\": \"*\",\n\t\t\"ext-mbstring\": \"*\"\n\t},\n```\n\n### Twitter\u306eAPI\u30ad\u30fc\u3092\u5b9a\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3001DI\u306b\u3088\u308a\u4f7f\u7528\u3059\u308b\n\n**var/conf/constants.php (\u7de8\u96c6)**\n\nTwitter API\u306e```Consumer Key```,```Consumer Secret```\u3068```Callback URL```\u3092\u5b9a\u6570\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3001\u4ee5\u964d\u306e\u30ed\u30b8\u30c3\u30af\u304b\u3089DI\u306e\u4ed5\u7d44\u307f\u306b\u3088\u308a\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```diff\n\t'prod' => [\n\t\t// DB\n\t\t'master_db' => $masterDb,\n\t\t'slave_db'  => $slaveDb,\n+\t\t// Twitter API\n+\t\t'twitter_api' => [\n+\t\t\t'consumer_key'    => '{YOUR_CONSUMER_KEY}',\n+\t\t\t'consumer_secret' => '{YOUR_CONSUMER_SECRET}',\n+\t\t\t// OAuth\u6642\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u30d1\u30b9\n+\t\t\t'oauth_callback_path' => '/oauth/twitter/callback',\n+\t\t],\n\t],\n```\n### PHPoAuthLib\u3092DI\u3059\u308b\n\n**src/Module/OAuth/TwitterProvider.php (\u8ffd\u52a0)**\n\nPHPoAuthLib\u3092BEAR.Sunday\u306eDI\u306e\u4ed5\u7d44\u307f\u304b\u3089\u4f7f\u3046\u305f\u3081\u306e\u521d\u671f\u5316\u51e6\u7406\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n\n```php\n<?php\n\nnamespace My\\Project\\Module\\OAuth;\n\nuse OAuth\\Common\\Consumer\\Credentials;\nuse OAuth\\Common\\Http\\Uri\\UriFactory;\nuse OAuth\\Common\\Storage\\Session;\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse OAuth\\ServiceFactory;\nuse Ray\\Di\\Di\\Inject;\nuse Ray\\Di\\Di\\Named;\nuse Ray\\Di\\ProviderInterface;\n\nclass TwitterProvider implements ProviderInterface\n{\n\t/**\n\t * @var string\n\t */\n\tprivate $consumerKey;\n\n\t/**\n\t * @var string\n\t */\n\tprivate $consumerSecret;\n\n\t/**\n\t * @var string\n\t */\n\tprivate $oauthCallbackPath;\n\n\t/**\n\t * @param array $apiConfig\n\t *\n\t * @Inject\n\t * @Named(\"twitter_api\")\n\t */\n\tpublic function __construct($apiConfig)\n\t{\n\t\t$this->consumerKey    = $apiConfig['consumer_key'];\n\t\t$this->consumerSecret = $apiConfig['consumer_secret'];\n\t\t$this->oauthCallbackPath = $apiConfig['oauth_callback_path'];\n\t}\n\n\t/**\n\t * @return \\OAuth\\OAuth1\\Service\\Twitter\n\t */\n\tpublic function get()\n\t{\n\t\t// \u30b3\u30fc\u30eb\u30d0\u30c3\u30afURL\u306e\u751f\u6210\n\t\t$uri = (new UriFactory())->createFromSuperGlobalArray($_SERVER);\n\t\t$uri->setPath($this->oauthCallbackPath);\n\t\t$uri->setQuery('');\n\t\t$callbackUrl = $uri->getAbsoluteUri();\n\n\t\t$credentials = new Credentials(\n\t\t\t$this->consumerKey,\n\t\t\t$this->consumerSecret,\n\t\t\t$callbackUrl\n\t\t);\n\n\t\t// Twitter\u7528\u306eOAuth\u30b5\u30fc\u30d3\u30b9\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u751f\u6210\n\t\treturn (new ServiceFactory())->createService('twitter', $credentials, new Session());\n\t}\n}\n\n```\n\n**src/Module/OAuth/TwitterModule.php (\u8ffd\u52a0)**\n\n\u4e0a\u3067\u4f5c\u6210\u3057\u305f```TwitterProvider```(\u306eget\u30e1\u30bd\u30c3\u30c9\u306e\u623b\u308a\u5024)\u3092```\\OAuth\\OAuth1\\Service\\Twitter```\u306b\u6ce8\u5165(\u675f\u7e1b)\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```php\n<?php\n\nnamespace My\\Project\\Module\\OAuth;\n\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse Ray\\Di\\AbstractModule;\nuse Ray\\Di\\Scope;\n\nclass TwitterModule extends AbstractModule\n{\n\n\tprotected function configure()\n\t{\n\t\t$this->bind(Twitter::class)->toProvider(TwitterProvider::class)->in(Scope::SINGLETON);\n\t}\n}\n\n```\n\n**src/Module/App/Dependency.php (\u7de8\u96c6)**\n\n```diff\n    protected function configure()\n    {\n+\t\t$this->install(new TwitterModule());\n    }\n```\n\n**src/Module/AppModule.php (\u7de8\u96c6)**\n\n\u4f9d\u5b58\u3092\u30a2\u30d7\u30ea\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```diff\n\tprotected function configure()\n\t{\n\t\t$this->install(new StandardPackageModule('Kawanamiyuu\\Pentan', $this->context, dirname(dirname(__DIR__))));\n\t\t\n\t\t// override module\n\t\t// $this->install(new SmartyModule($this));\n\t\t\n\t\t// $this->install(new AuraViewModule($this));\n\t\t\n\t\t// install application dependency\n-\t\t// $this->install(new App\\Dependency);\n+\t\t$this->install(new App\\Dependency);\n\t\t\n\t\t// install application aspect\n\t\t $this->install(new App\\Aspect($this));\n\t}\n}\n\n```\n\n**src/Inject/TwitterOAuthServiceInject.php (\u8ffd\u52a0)**\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\u304b\u3089\u306f\u3053\u306e```trait```\u3092use\u3059\u308b\u3053\u3068\u3067OAuth\u30ed\u30b8\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002```setTwitterOAuthService```\u3067\u4f9d\u5b58\u304c\u6ce8\u5165\u3055\u308c\u307e\u3059\u3002\n\n```php\n<?php\n\nnamespace My\\Project\\Inject;\n\n\nuse OAuth\\OAuth1\\Service\\Twitter;\nuse Ray\\Di\\Di\\Inject;\n\ntrait TwitterOAuthServiceInject\n{\n\t/**\n\t * @var Twitter\n\t */\n\tprotected $twitterOAuthService;\n\n\t/**\n\t * @param Twitter $twitter\n\t *\n\t * @Inject\n\t */\n\tpublic function setTwitterOAuthService(Twitter $twitter)\n\t{\n\t\t$this->twitterOAuthService = $twitter;\n\t}\n} \n\n```\n\n\n### Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u3078\u306e\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\n**src/Resource/Page/Oauth/Twitter/Redirect.php (\u8ffd\u52a0)**\n\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762 **\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b** \u305f\u3081\u306ePage\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\u6b21\u306eURL\u30d1\u30b9\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u2192 ```/oauth/twitter/redirect```\n\n```php\n<?php\n\nnamespace My\\Project\\Resource\\Page\\Oauth\\Twitter;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Inject\\TwitterOAuthServiceInject;\n\nclass Redirect extends ResourceObject\n{\n\tuse TwitterOAuthServiceInject;\n\n\tpublic function onGet()\n\t{\n\t\t// \u30ea\u30af\u30a8\u30b9\u30c8\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\n\t\t$requestToken = $this->twitterOAuthService->requestRequestToken()->getRequestToken();\n\n\t\t$url = $this->twitterOAuthService->getAuthorizationUri([\n\t\t\t'oauth_token' => $requestToken,\n\t\t\t'force_login' => 'true',\n\t\t]);\n\n\t\t// Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u3078\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n\t\theader('Location:' . $url);\n\t\texit;\n\t}\n} \n```\n\n### Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u304b\u3089\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\n\n**src/Resource/Page/Oauth/Twitter/Callback.php (\u8ffd\u52a0)**\n\nTwitter\u306e\u8a8d\u8a3c\u753b\u9762 **\u304b\u3089\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b** Page\u30ea\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\u6b21\u306eURL\u30d1\u30b9\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u2192 ```/oauth/twitter/callback```\n\n```php\n<?php\n\nnamespace My\\Project\\Resource\\Page\\Oauth\\Twitter;\n\nuse BEAR\\Resource\\ResourceObject;\nuse My\\Project\\Inject\\TwitterOAuthServiceInject;\n\nclass Callback extends ResourceObject\n{\n\tuse TwitterOAuthServiceInject;\n\n        /**\n         * @param string $oauth_token\n         * @param string $oauth_verifier\n         * @param string $denied\n         */\n\tpublic function onGet($oauth_token = null, $oauth_verifier = null, $denied = null)\n\t{\n\t\t// Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u3067[\u30ad\u30e3\u30f3\u30bb\u30eb]\u30dc\u30bf\u30f3\u3092\u62bc\u3055\u308c\u305f\u5834\u5408\n\t\tif ($denied) {\n\t\t\t$this['is_authorized'] = false;\n\t\t\treturn $this;\n\t\t}\n\n\t\t// \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\n\t\t$accessToken = $this->twitterOAuthService->requestAccessToken(\n\t\t\t$oauth_token,\n\t\t\t$oauth_verifier\n\t\t);\n\n\t\t// \u8a8d\u8a3c\u6210\u529f\u6642\n\t\t$this['is_authorized'] = true;\n\t\t$this['token']         = $accessToken->getAccessToken();\n\t\t$this['token_secret']  = $accessToken->getAccessTokenSecret();\n\t\t$this['user_id']       = $accessToken->getExtraParams()['user_id'];\n\t\t$this['screen_name']   = $accessToken->getExtraParams()['screen_name'];\n\t\treturn $this;\n\t}\n} \n```\n\n**src/Resource/Page/Oauth/Twitter/Callback.twig (\u8ffd\u52a0)**\n\n\u203b\u6ce8\u610f\u203b\n\u3053\u3053\u3067\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3068\u3057\u3066\u306e\u4fbf\u5b9c\u4e0a\u3001\u53d6\u5f97\u3057\u305f\u30c8\u30fc\u30af\u30f3\u3092\u753b\u9762\u306b\u8868\u793a\u3057\u307e\u3059\u3002\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u30b3\u30fc\u30c9\u3067\u306fDB\u306b\u4fdd\u5b58\u5f8c\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3059\u308b\u306a\u3069\u3057\u3066\u9069\u5207\u306b\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\n\n```html\n<html lang=\"ja\">\n<head>\n<meta charset=\"utf-8\" />\n<style type=\"text/css\">\n\tdt { font-weight: bold; }\n\tdt:after { content: ':'; }\n</style>\n</head>\n<body>\n{% if is_authorized %}\n\t<dl>\n\t\t<dt>Token</dt><dd>{{ token }}</dd>\n\t\t<dt>Token Secret</dt><dd>{{ token_secret }}</dd>\n\t</dl>\n\t<dl>\n\t\t<dt>user_id</dt><dd>{{ user_id }}</dd>\n\t\t<dt>screen_name</dt><dd>{{ screen_name }}</dd>\n\t</dl>\n{% else %}\n\t<p>\n\t\t<a href=\"/oauth/twitter/redirect\">\u30ea\u30c8\u30e9\u30a4</a>\n\t</p>\n{% endif %}\n</body>\n</html>\n```\n\n## \u30ed\u30fc\u30ab\u30eb\u3067\u306e\u52d5\u4f5c\u78ba\u8a8d\n\n\uff11. \u30d3\u30eb\u30c9\u30a4\u30f3\u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3059\u308b\n\n```bash\n$ cd /path/to/My.Project\n# DI\u3001AOP\u306e\u305f\u3081\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u30ad\u30e3\u30b7\u30e5\u3092\u524a\u9664\n$ php bin/clear.php\n$ php -S localhost:8080 -t var/www\n```\n\n\uff12. ```http://localhost:8080/oauth/twitter/redirect``` \u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\n\uff13. Twitter\u306e\u8a8d\u8a3c\u753b\u9762\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\n\n![Twitter___\u30a2\u30d5\u309a\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a8d\u8a3c 2.png](https://qiita-image-store.s3.amazonaws.com/0/3899/886cee58-736c-ef39-46d2-6bb0dc6a1b03.png \"Twitter___\u30a2\u30d5\u309a\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a8d\u8a3c 2.png\")\n\n\uff14. [\u9023\u643a\u30a2\u30d7\u30ea\u3092\u8a8d\u8a3c]\u30dc\u30bf\u30f3\u3092\u62bc\u3059\n\n\uff15. ```http://localhost:8080/oauth/twitter/callback``` \u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\n\n\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u304c\u8868\u793a\u3055\u308c\u308c\u3070OK\n\n![Twitter___\u30a2\u30d5\u309a\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a8d\u8a3c.png](https://qiita-image-store.s3.amazonaws.com/0/3899/a6a088e6-1792-35d1-2e4f-2669059a54b1.png \"Twitter___\u30a2\u30d5\u309a\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a8d\u8a3c.png\")\n\n## \u6700\u5f8c\u306b\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305f\u30b3\u30fc\u30c9\u306e\u5927\u534a\u304cDI\u306e\u4ed5\u7d44\u307f\u306b\u95a2\u3059\u308b\u90e8\u5206\u3067\u3042\u3063\u305f\u3088\u3046\u306b\u3001BEAR.Sunday\u3092\u4f7f\u3063\u305f\u958b\u767a\u3067\u306fDI\u304c\u5b9f\u88c5\u306e\u809d\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\u81ea\u5206\u3082\u4eca\u56de\u521d\u3081\u3066\u672c\u683c\u7684\u306b\u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u3092DI\u3057\u3066\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u3066\u305d\u306e\u4ed5\u7d44\u307f\u306e\u7406\u89e3\u304c\u9032\u307f\u307e\u3057\u305f\u3002\n\n\u4eca\u5f8c\u3082BEAR.Sunday\u3092\u4f7f\u3063\u305f\u958b\u767a\u3092\u901a\u3057\u3066\u305d\u306e\u8a2d\u8a08\u601d\u60f3\u3092\u5b66\u3093\u3067\u3044\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u6b21\u306f\u4eca\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092```v1.0.0-alpha```\u306b\u79fb\u884c\u3057\u306a\u3044\u3068(*\u00b4\u06a1`\u25cf)\n", "tags": ["BEAR.Sunday0.10.5", "OAuth", "PHP5.5", "Twitter"]}