{"tags": ["CodeDeploy", "AWS", "GitHub", "Slack", "CodePipeline"], "context": "\n\nAWS CodeDeploy\u306e\u5c0e\u5165\n\n2\u3064\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\nCodeDeploy\u306eIAM\u30ed\u30fc\u30eb\u4f5c\u6210\n\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Identity and Access Management\u3092\u9078\u629e\n\u8a73\u7d30\u306e\u9805\u76ee\u304b\u3089\u30ed\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u3001\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3092\u9078\u629e\n\n\u624b\u9806 1: \u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\n    \u30ed\u30fc\u30eb\u540d: myCodeDeploy\n\u624b\u9806 2: \u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\n    Amazon EC2\u3092\u9078\u629e\n\u624b\u9806 3: \u4fe1\u983c\u6027\u306e\u78ba\u7acb\n    \u98db\u3070\u3055\u308c\u308b\n\u624b\u9806 4: \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\n    AWSCodeDeployRole\u3092\u9078\u629e\n\u624b\u9806 5: \u78ba\u8a8d\n    \u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\n\u203b\u6b21\u306b\u3001\u91cd\u8981\u306a\u4f5c\u696d\u3067\u3001Identity and Access Management\u306e\u8a73\u7d30\u9805\u76ee\u4e2d\u306e\u30ed\u30fc\u30eb\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u3092\u9078\u629e\u3057\u3066\u3001\u4fe1\u983c\u95a2\u4fc2\u30bf\u30d6\u4e2d\u306e\u4fe1\u983c\u95a2\u4fc2\u306e\u7de8\u96c6\u3092\u9078\u629e\u3059\u308b\n\u73fe\u308c\u305f\u4fe1\u983c\u95a2\u4fc2\u306e\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4e2d\u306eStatement\u306ePrincipal\u4e2d\u306eService\u3092\"ec2.amazonaws.com\"\u304b\u3089\"codedeploy.us-west-2.amazonaws.com\"\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u305fjson\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"codedeploy.us-west-2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n\n\u7de8\u96c6\u3057\u305f\u3089\u3001\u4fe1\u983c\u30dd\u30ea\u30b7\u30fc\u306e\u66f4\u65b0\u3092\u9078\u629e\u3059\u308b\u3002\n\nEC2\u306eIAM\u30ed\u30fc\u30eb\u4f5c\u6210\nCodeDeploy\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u540c\u69d8\u306b\u4ee5\u4e0b\u306e\u3082\u306e\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u30ed\u30fc\u30eb\u540d: myEC2CodeDeploy\n\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7: EC2\n\u30dd\u30ea\u30b7\u30fc\u30a2\u30bf\u30c3\u30c1: AmazonS3ReadOnlyAccess\n\u3053\u3053\u3067\u306f\u4fe1\u983c\u95a2\u4fc2\u306e\u8a2d\u5b9a\u306f\u7279\u306b\u306f\u5fc5\u8981\u306a\u3044\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EC2\u3092\u9078\u629e\u3057\u3001\u30c8\u30c3\u30d7\u753b\u9762\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u9805\u76ee\u4e2d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\n1.AMI \u306e\u9078\u629e\n\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: Amazon Linux AMI 2016.03.3 (HVM), SSD Volume Type - ami-7172b611 \u3092\u9078\u629e\n2.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306e\u9078\u629e\n    t2.micro\n3.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\n    \u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u304c\u3001IAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyEC2CodeDeploy\u3092\u9078\u629e\u3059\u308b\n4.\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u8ffd\u52a0\n    \u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306e\u307e\u307e\n5.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30bf\u30b0\u4ed8\u3051\n    Name : MyCodeDeploy\n6.\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\u65b0\u3057\u3044\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308b\u3092\u9078\u629e\u3057\u3001\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: myCodeDeploySG\u3068\u3057\u3001\n    SSH : \u4efb\u610f\u306e\u5834\u6240\n    HTTP : \u4efb\u610f\u306e\u5834\u6240\n\u3092\u8a2d\u5b9a\u3059\u308b\n7.\u78ba\u8a8d\n    \u8a2d\u5b9a\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u884c\u3046\u3002\n\nEC2\u306e\u8a2d\u5b9a\n$ ssh -i ~/.ssh/id_rsa_aws_test ec2-user@<EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9>\n\n$ sudo yum -y update\n$ sudo yum install -y aws-cli\n$ pwd\n/home/ec2-user\n$ aws configure\n$ aws s3 cp s3://aws-codedeploy-us-east-1/latest/install . --region us-west-2\n$ chmod +x ./install\n$ sudo ./install auto\n$ sudo service codedeploy-agent status\n\n\nCodeDeploy\u306e\u8a2d\u5b9a\n\n\u30c7\u30d7\u30ed\u30a4\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u6e96\u5099\n\nappspec.yml\u306e\u4f5c\u6210\nappspec.yml\u3068\u3044\u3046deploy\u6642\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\u5b9a\u7fa9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002appspec.yml\u306b\u306f\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u3042\u308b\u3002\nos\nfiles\npermissions\nhooks\n\n\u307e\u305f\u3001\nhooks\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u304c\u3042\u308a\u3001\u305d\u306e\u90fd\u5ea6\u306e\u6319\u52d5\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n(Start)\n\u2193\nApplicationStop\n\u2193\nDownloadBundle\n\u2193\nBeforeInstall\n\u2193\nInstall \n\u2193\nAfterInstall\n\u2193\nApplicationStart\n\u2193\nValidateService\n\u2193\n(End)\n\n\u8a73\u7d30\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\nhttp://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/app-spec-ref-structure.html\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f5c\u6210\u3059\u308b\n\nappspec.yml\nversion: 0.0\nos: linux\nfiles:\n    - source: /\n      destination: /var/www/html\npermissions:\n    - object: /var/www/html\n      pattern: \"**\"\n      owner: apache\n      group: apache\n      mode: 755\n      type:\n        - file\nhooks:\n    BeforeInstall:\n     - location: scripts/initialize.sh\n       runas: root\n\n\n\u305d\u306e\u4ed6\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\ninitialize.sh\n#!/bin/bash\nyum -y install httpd\nservice httpd start\n\n\n\nindex.html\n<html>\n    <body>Hello, world!</body>\n</html>\n\n\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3068\u306a\u308b\u3002\nscripts/initialize.sh\nindex.html\nappspec.yml\n\n\u4e0a\u8a18\u3092GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304f\u3002\nS3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3084\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\u91cd\u8981\u306a\u306e\u306f\u3001\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30c8\u30c3\u30d7\u306bappspec.yml\u3092\u7f6e\u304f\u3053\u3068\u3067\u3042\u308b\u3002\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CodeDeploy\u3092\u9078\u629e\u3059\u308b\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\nCodeDeploy\u30c8\u30c3\u30d7\u306e\u753b\u9762\u304b\u3089\u3001\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d: myCodeDeploy\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d: myCodeDeploy\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\u3067\n\u30ad\u30fc: Name\n\u5024: MyCodeDeploy\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n    \u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30ebARN: arn:aws:iam::~:role/myCodeDeploy\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\n\u65b0\u3057\u3044\u30c7\u30d7\u30ed\u30a4\u306e\u4f5c\u6210\nCodeDeploy\u30c8\u30c3\u30d7\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u3001\u30a2\u30af\u30b7\u30e7\u30f3\u304b\u3089\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3: myCodeDeploy\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7: myCodeDeploy\n\u30ea\u30d3\u30b8\u30e7\u30f3\u30bf\u30a4\u30d7: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f GitHub \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\nGitHub\u306b\u63a5\u7d9a\u3092\u9078\u629e\u3059\u308b\u3002\u3059\u308b\u3068\u73fe\u308c\u308b\u9805\u76ee\u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\u30ea\u30dd\u30b8\u30c8\u30ea\u540d: \uff1cGitHub\u767b\u9332\u30e6\u30fc\u30b6\u30fc\u540d\uff1e/\uff1c\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\uff1e\n\u30b3\u30df\u30c3\u30c8ID: \uff1c\u30b3\u30df\u30c3\u30c8ID\uff1e\n\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a: CodeDeployDefault.oneAtTime\n\u3092\u5165\u529b\u3057\u3066\u3001\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3059\u308b\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u6210\u529f\u3068\u306a\u308b\u3002\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089http://<EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9>\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u4f5c\u6210\u3057\u305findex.html\u306e\u5185\u5bb9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\ngit push\u3067EC2\u306b\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\n\u3053\u3053\u3067\u306fAWS CodePipeline\u3092\u4f7f\u3046\u65b9\u6cd5\u3068GitHub\u306eWebhooks\u6a5f\u80fd\u3092\u4f7f\u3046\u65b9\u6cd5\u306e2\u3064\u3092\u7d39\u4ecb\u3059\u308b\u3002\u3044\u305a\u308c\u304b\u306e\u65b9\u6cd5\u3067\u884c\u3046\u3068\u826f\u3044\u3002\n\u306a\u304a\u3001AWS CodePipeline\u3092\u4f7f\u3063\u305f\u5834\u5408\u306f\u7c21\u5358\u306b\u8a2d\u5b9a\u3067\u304d\u3001\u307e\u305f\u3001GitHub\u306b\u9650\u3089\u305aS3\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u308a\u3001\u30d3\u30eb\u30c9\u306bJenkins\u3084Solano CI\u3092\u9078\u629e\u3057\u305f\u308a\u3001Deployment\u3092\u884c\u3046\u624b\u6bb5\u3068\u3057\u3066\u3001CodeDeploy\u3084AWS Elastic Beanstalk\u306a\u3069\u3092\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n(\u305d\u306e1) AWS CodePipeline\u3092\u4f7f\u3046\u65b9\u6cd5\n\nStep 1: Name\nPipeline name: CodePipelineTest\n\nStep 2: Source\nSource provider: GitHub\nRepository: \uff1cGitHub\u30e6\u30fc\u30b6\u30fc\u540d\uff1e/\uff1c\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\uff1e\nBranch: master\n\nStep 3: Build\nBuild provider: No Build\n\nStep 4: Beta\nDeployment provider: AWS CodeDeploy\nApplication name: myCodeDeployForCodePipeline\nDeployment group: myCodeDeployForCodePipeline\n\nStep 5: Service Role\nRole name\u306fCreate Role\u3092\u9078\u629e\u3057\u3066\u9077\u79fb\u3057\u305f\u5148\u306e\u30da\u30fc\u30b8\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u3066\u8a31\u53ef\u3092\u9078\u629e\u3059\u308b\u3002\nIAM\u30ed\u30fc\u30eb: \u65b0\u3057\u3044IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u30ed\u30fc\u30eb\u540d: AWSCodePipelineService\n\nStep 6: Review\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001Create pipeline\u3092\u9078\u629e\n\u4ee5\u4e0a\u3067\u3001EC2\u306b\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u304c\u59cb\u307e\u308a\u3001\u4ee5\u964dGitHub\u306bpush\u3059\u308b\u5ea6\u306b\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n(\u305d\u306e2) GitHub\u306eWebhooks\u6a5f\u80fd\u3092\u4f7f\u3046\u65b9\u6cd5\nGitHub\u306eService\u306bAWS CodeDeploy\u3068GitHub Auto-Deployment\u306e2\u3064\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\nAWS CodeDeploy\u3092Service\u306b\u767b\u9332\nGitHub\u306e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u30da\u30fc\u30b8\u304b\u3089Settings\u30bf\u30d6\u3092\u9078\u629e\u3057\u3001Webhooks & services\u3092\u9078\u629e\u3002\nServices\u306e\u9805\u76ee\u304b\u3089\u3001Add service\u3092\u62bc\u3057\u3066AWS CodeDeploy\u3092\u9078\u629e\u3059\u308b\u3002\u305d\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\nApplication name: myCodeDeploy\nDeployment group: myCodeDeploy\nAws access key: \uff1cIAM\u30e6\u30fc\u30b6\u30fc\u3067\u767a\u884c\u3055\u308c\u305fcredetials\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\uff1e\nAws region: \uff1cCodeDeploy\u3092\u5b9f\u884c\u3059\u308b\u5730\u57df ex. us-west-2\uff1e\nGitHub api url: \u7a7a\u6b04\nAws secret access key: \uff1cIAM\u30e6\u30fc\u30b6\u30fc\u3067\u767a\u884c\u3055\u308c\u305fcredetials\u306e\u30a2\u30af\u30bb\u30b9\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\uff1e\nGitHub token: \u7a7a\u6b04\n\nGitHub Auto-Deployment\u3092Service\u306b\u767b\u9332\n\u6700\u521d\u306bGitHub\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u305f\u3081\u306e\u30c8\u30fc\u30af\u30f3\u3092\u767a\u884c\u3059\u308b\u3002\n1.GitHub\u306e\u753b\u9762\u53f3\u4e0a\u306e\u81ea\u5206\u306e\u30a2\u30a4\u30b3\u30f3\u3092\u62bc\u3059\u3068\u51fa\u3066\u6765\u308b\u30e1\u30cb\u30e5\u30fc\u304b\u3089Settings\u3092\u9078\u629e\n2.Personal settings\u304b\u3089Personal access tokens\u3092\u9078\u629e\u3059\u308b\u3002\n3.Generate new token\u3092\u62bc\u3059\n4.\u51fa\u3066\u6765\u308b\u753b\u9762\u3067\u3001Token description\u306f\u81ea\u5206\u3067\u4ed6\u306e\u30c8\u30fc\u30af\u30f3\u3068\u8b58\u5225\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u9069\u5f53\u306b\u8a18\u8ff0\u3057\u3066\u304a\u304f\u3002\u52a0\u3048\u3066\u3001repo_deployment\u3092\u6700\u4f4e\u9650\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u305f\u4e0a\u3067Generate token\u3092\u62bc\u3059\u3068\u3001\u30c8\u30fc\u30af\u30f3\u304c\u767a\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u8868\u793a\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n\u6b21\u306b\u3001GitHub\u306e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u30da\u30fc\u30b8\u304b\u3089Settings\u30bf\u30d6\u3092\u9078\u629e\u3057\u3001Webhooks & services\u3092\u9078\u629e\nServices\u306e\u9805\u76ee\u304b\u3089\u3001Add service\u3092\u62bc\u3057\u3066GitHub Auto-Deployment\u3092\u9078\u629e\u3059\u308b\u3002\u305d\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\nGitHub token: <\u5148\u307b\u3069\u767a\u884c\u3057\u305f\u30c8\u30fc\u30af\u30f3>\nEnvironment: myCodeDeploy\nDeploy on status: \u672a\u30c1\u30a7\u30c3\u30af\nGitHub api url: \u7a7a\u6b04\nActive: \u30c1\u30a7\u30c3\u30af\n\u4ee5\u4e0a\u3067\u3001git push\u3067GitHub\u306b\u5909\u66f4\u3092\u9001\u308b\u3068EC2\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u81ea\u52d5\u3067\u53cd\u6620\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092Slack\u306b\u901a\u77e5\n\nSNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n1.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089SNS\u3092\u9078\u629e\u3059\u308b\u3002\n2.SNS dashboard\u304b\u3089Common actions\u4e2d\u306eCreate topic\u3092\u9078\u629e\u3059\u308b\u3002\n3.\u51fa\u3066\u304d\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\nTopic name: deploy_status\nDisplay name: deploystat \n\u5165\u529b\u3057\u305f\u3089Create topic\u3092\u9078\u629e\u3059\u308b\u3002\n\nCodeDeploy\u306b\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\nCodeDeploy\u306e\u753b\u9762\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u3092\u9078\u629e\u3057\u3001Action\u304b\u3089\u7de8\u96c6\u3092\u62bc\u3059\u3002\n\u5148\u307b\u3069\u672a\u8a2d\u5b9a\u306b\u3057\u3066\u304a\u3044\u305f\u30c8\u30ea\u30ac\u30fc\u306e\u9805\u76ee\u304b\u3089\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\u30c8\u30ea\u30ac\u30fc\u540d: deploy-status-trigger\n\u30a4\u30d9\u30f3\u30c8: Deployment Status(all)\nAmazon SNS \u30c8\u30d4\u30c3\u30af: <\u5148\u307b\u3069SNS\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30d4\u30c3\u30af>\nmyCodeDeploy \u306e\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u306e\u9805\u76ee\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001\u4fdd\u5b58\u3057\u3066\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u62bc\u3057\u3001\u73fe\u308c\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304b\u3089\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3059\u308b\n\n\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092Slack\u306b\u901a\u77e5\n\nSNS\u306e\u901a\u77e5\u8a2d\u5b9a\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089SNS\u3092\u9078\u629e\nSNS dashboard\u306e\u9805\u76ee\u304b\u3089Topics\u3092\u9078\u629e\nCreate new topic\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u9805\u76ee\u3092\u5165\u529b\u3059\u308b\nTopic name: Deploy_information\nDisplay name: Deployer\n\u5165\u529b\u3057\u305f\u3089Create topic\u3092\u9078\u629e\u3059\u308b\n\nCodeDeploy\u306e\u8a2d\u5b9a\n1.\u4e88\u3081\u5bfe\u8c61\u3068\u306a\u308bEC2\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u540d\u3092\u9078\u629e\u3057\u3066\u304a\u304f\u3002\n\u4f8b)EC2\u306e\u30da\u30fc\u30b8\u3067\u5bfe\u8c61\u3068\u306a\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u629e\u3057\u3066\u3001\u30bf\u30b0\u9805\u76ee\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30bf\u30b0\u3092\u8ffd\u52a0\u3059\u308b\nName: MyCodeDeploy\n2.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Identity and Access Management\u3092\u9078\u629e\u3057\u3066\u3001\u30ed\u30fc\u30eb\u304b\u3089\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\u3002\n\u624b\u9806 1: \u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\n\u30ed\u30fc\u30eb\u540d: myLambdaExecuteRole\n\u624b\u9806 2: \u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\nAWS Lambda\u3092\u9078\u629e\n\u624b\u9806 3: \u4fe1\u983c\u6027\u306e\u78ba\u7acb\nPass\n\u624b\u9806 4: \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\nAWSLambdaExecute\u3092\u9078\u629e\n\u624b\u9806 5: \u78ba\u8a8d\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\n3.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CodeDeploy\u3092\u9078\u629e\n4.\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\n\n\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d: CodeDeployApp\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d: CodeDeployGroup\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\nName: MyCodeDeploy\n\n\u3053\u3053\u306f\u4e88\u3081EC2\u306b\u5272\u308a\u5f53\u3066\u3066\u304a\u3044\u305f\u30bf\u30b0\u540d\u3068\u3059\u308b\n\n\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\nCodeDeployDefault.OneAtTime\n\n\n\u30c8\u30ea\u30ac\u30fc\n\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3066\u3001\u73fe\u308c\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\n\u30c8\u30ea\u30ac\u30fc\u540d: CodeDeploy\n\u30a4\u30d9\u30f3\u30c8: Deployment Status(All)\n\nAmazon SNS \u30c8\u30d4\u30c3\u30af: Deploy_information\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u9805\u76ee\u3092\u5165\u529b\u3057\u305f\u3089\u3001\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30ebARN: arn:aws:iam::~:role/myLambdaExecuteRole\n\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\nLambda\u306e\u4f5c\u6210\n\u4e88\u3081\u30ed\u30fc\u30ab\u30eb\u3067Lambda\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f.\n\u4e8b\u524d\u6e96\u5099\u3068\u3057\u3066\u3001Slack API\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u767b\u9332\u3092\u3057\u3066\u304a\u304f\n\nSlack API\u306e\u767b\u9332\n1.https://api.slack.com/custom-integrations \u306eURL\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u98db\u3076\n2.Set up an incoming webhook\u3092\u9078\u629e\n3.\u53f3\u4e0a\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u5bfe\u8c61\u306e\u30c1\u30fc\u30e0\u3092\u9078\u629e\n4.Post to Channel\u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u9078\u629e\n\u3053\u3053\u3067\u306f\u81ea\u5206\u5b9b\u306b\u3059\u308b\u306e\u3067\u3001Privately to @hoge (you)\u3092\u9078\u629e\n5.Add Incoming Webhooks integration\u3092\u9078\u629e\n6.\u9077\u79fb\u3057\u305f\u5148\u306e\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u308bWebhook URL\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n\nLambda\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u30ed\u30fc\u30ab\u30eb\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4f5c\u696d\u3092\u884c\u3046\n$ mkdir deployInform\n$ cd deployInform\n$ pip install requests -t .\n$ vim lambda_function.py\n\nlambda_function.py\u306e\u5185\u5bb9\u306f\u4ee5\u4e0b\u306eURL\u306e\u5185\u5bb9\u306e\u3082\u306e\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002channel\u306f\u5148\u307b\u3069\u306e\u500b\u4eba\u5b9b\u306e\u5834\u5408\u306f@hoge\u306e\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\nhttp://ceblog.mediba.jp/post/141460887747/aws-codedeploy\u306e\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092slack\u306b\u6d41\u3059\n$ zip -r deploy.zip -t *\n\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda\u306e\u64cd\u4f5c\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda\u3092\u9078\u629e\nCreate a Lambda funtion\u3092\u9078\u629e\n\nSelect blueprint\nsns-message-python\u3092\u9078\u629e\n\nConfigure triggers\nSNS topic: Deploy_information\nEnable trigger\u306e\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\n\nConfigure function\nName: myDeploymentLambda\nLambda function code\nCode entry type: Upload a .ZIP file\nFunction package: \u4f5c\u6210\u3057\u305fzip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\nLambda function handler and role\nHandler: lambda_function.lambda_handler(<\u30d5\u30a1\u30a4\u30eb\u540d>/<\u95a2\u6570\u540d>)\nRole: Choose a existing role\nExisting role: myLambdaExecuteRole\n\u6b8b\u308a\u306e\u9805\u76ee\u306fEC2\u306e\u5c5e\u3059\u308bVPC\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u7269\u3067\u3042\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u826f\u3044\u3002\nReview\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u305f\u3089Create function\u3092\u9078\u629e\n\u4ee5\u4e0a\u3067\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092git push\u3059\u308b\u5ea6\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3001\u305d\u306e\u7d50\u679c\u304cSlack\u306b\u901a\u77e5\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\u53c2\u8003\nhttps://www.youtube.com/watch?v=qZa5JXmsWZs\nhttps://github.com/andrewpuch/code_deploy_example\nhttp://qiita.com/yukofeb/items/e077fc8755416c904032\nhttp://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/how-to-create-service-role.html\nhttp://qiita.com/toshihirock/items/4ab08afcab2a0e7628a8\n#AWS CodeDeploy\u306e\u5c0e\u5165\n\n##2\u3064\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n###CodeDeploy\u306eIAM\u30ed\u30fc\u30eb\u4f5c\u6210\n1. \u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Identity and Access Management\u3092\u9078\u629e\n2. \u8a73\u7d30\u306e\u9805\u76ee\u304b\u3089\u30ed\u30fc\u30eb\u3092\u9078\u629e\u3057\u3066\u3001\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3092\u9078\u629e\n\n\u624b\u9806 1: \u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\n\t\u30ed\u30fc\u30eb\u540d: myCodeDeploy\n\u624b\u9806 2: \u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\n\tAmazon EC2\u3092\u9078\u629e\n\u624b\u9806 3: \u4fe1\u983c\u6027\u306e\u78ba\u7acb\n\t\u98db\u3070\u3055\u308c\u308b\n\u624b\u9806 4: \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\n\tAWSCodeDeployRole\u3092\u9078\u629e\n\u624b\u9806 5: \u78ba\u8a8d\n\t\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\n\n\n\u203b\u6b21\u306b\u3001\u91cd\u8981\u306a\u4f5c\u696d\u3067\u3001Identity and Access Management\u306e\u8a73\u7d30\u9805\u76ee\u4e2d\u306e\u30ed\u30fc\u30eb\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u3092\u9078\u629e\u3057\u3066\u3001\u4fe1\u983c\u95a2\u4fc2\u30bf\u30d6\u4e2d\u306e\u4fe1\u983c\u95a2\u4fc2\u306e\u7de8\u96c6\u3092\u9078\u629e\u3059\u308b\n\n\u73fe\u308c\u305f\u4fe1\u983c\u95a2\u4fc2\u306e\u30dd\u30ea\u30b7\u30fc\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u4e2d\u306eStatement\u306ePrincipal\u4e2d\u306eService\u3092\"ec2.amazonaws.com\"\u304b\u3089\"codedeploy.us-west-2.amazonaws.com\"\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u305fjson\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"codedeploy.us-west-2.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\n```\n\u7de8\u96c6\u3057\u305f\u3089\u3001\u4fe1\u983c\u30dd\u30ea\u30b7\u30fc\u306e\u66f4\u65b0\u3092\u9078\u629e\u3059\u308b\u3002\n\n###EC2\u306eIAM\u30ed\u30fc\u30eb\u4f5c\u6210\nCodeDeploy\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3068\u540c\u69d8\u306b\u4ee5\u4e0b\u306e\u3082\u306e\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u30ed\u30fc\u30eb\u540d: myEC2CodeDeploy\n\u30ed\u30fc\u30eb\u30bf\u30a4\u30d7: EC2\n\u30dd\u30ea\u30b7\u30fc\u30a2\u30bf\u30c3\u30c1: AmazonS3ReadOnlyAccess\n\n\u3053\u3053\u3067\u306f\u4fe1\u983c\u95a2\u4fc2\u306e\u8a2d\u5b9a\u306f\u7279\u306b\u306f\u5fc5\u8981\u306a\u3044\u3002\n\n##EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089EC2\u3092\u9078\u629e\u3057\u3001\u30c8\u30c3\u30d7\u753b\u9762\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u9805\u76ee\u4e2d\u304b\u3089\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\n\n\n1.AMI \u306e\u9078\u629e\n\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8: Amazon Linux AMI 2016.03.3 (HVM), SSD Volume Type - ami-7172b611 \u3092\u9078\u629e\n2.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30a4\u30d7\u306e\u9078\u629e\n\tt2.micro\n3.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\n\t\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u304c\u3001IAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyEC2CodeDeploy\u3092\u9078\u629e\u3059\u308b\n4.\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u8ffd\u52a0\n\t\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u306e\u307e\u307e\n5.\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u30bf\u30b0\u4ed8\u3051\n\tName : MyCodeDeploy\n6.\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u8a2d\u5b9a\n\u65b0\u3057\u3044\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308b\u3092\u9078\u629e\u3057\u3001\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7: myCodeDeploySG\u3068\u3057\u3001\n\tSSH : \u4efb\u610f\u306e\u5834\u6240\n\tHTTP : \u4efb\u610f\u306e\u5834\u6240\n\u3092\u8a2d\u5b9a\u3059\u308b\n7.\u78ba\u8a8d\n\t\u8a2d\u5b9a\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\u3092\u884c\u3046\u3002\n\n##EC2\u306e\u8a2d\u5b9a\n\n```bash\n$ ssh -i ~/.ssh/id_rsa_aws_test ec2-user@<EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9>\n```\n\n```bash\n$ sudo yum -y update\n$ sudo yum install -y aws-cli\n$ pwd\n/home/ec2-user\n$ aws configure\n$ aws s3 cp s3://aws-codedeploy-us-east-1/latest/install . --region us-west-2\n$ chmod +x ./install\n$ sudo ./install auto\n$ sudo service codedeploy-agent status\n```\n\n\n#CodeDeploy\u306e\u8a2d\u5b9a\n##\u30c7\u30d7\u30ed\u30a4\u306b\u5fc5\u8981\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u6e96\u5099\n###appspec.yml\u306e\u4f5c\u6210\nappspec.yml\u3068\u3044\u3046deploy\u6642\u306e\u6319\u52d5\u306b\u3064\u3044\u3066\u5b9a\u7fa9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002appspec.yml\u306b\u306f\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u3042\u308b\u3002\n\n```\nos\nfiles\npermissions\nhooks\n```\n\u307e\u305f\u3001\nhooks\u306b\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u304c\u3042\u308a\u3001\u305d\u306e\u90fd\u5ea6\u306e\u6319\u52d5\u3092\u5b9a\u7fa9\u3067\u304d\u308b\u3002\n\n```\n(Start)\n\u2193\nApplicationStop\n\u2193\nDownloadBundle\n\u2193\nBeforeInstall\n\u2193\nInstall\t\n\u2193\nAfterInstall\n\u2193\nApplicationStart\n\u2193\nValidateService\n\u2193\n(End)\n```\n\n\u8a73\u7d30\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\nhttp://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/app-spec-ref-structure.html\n\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u4f5c\u6210\u3059\u308b\n\n```appspec.yml\nversion: 0.0\nos: linux\nfiles:\n    - source: /\n      destination: /var/www/html\npermissions:\n    - object: /var/www/html\n      pattern: \"**\"\n      owner: apache\n      group: apache\n      mode: 755\n      type:\n        - file\nhooks:\n    BeforeInstall:\n     - location: scripts/initialize.sh\n       runas: root\n```\n\n\u305d\u306e\u4ed6\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n```initialize.sh\n#!/bin/bash\nyum -y install httpd\nservice httpd start\n```\n\n```index.html\n<html>\n\t<body>Hello, world!</body>\n</html>\n```\n\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3068\u306a\u308b\u3002\n\n```\nscripts/initialize.sh\nindex.html\nappspec.yml\n```\n\n\u4e0a\u8a18\u3092GitHub\u306e\u30ec\u30dd\u30b8\u30c8\u30ea\u306b\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304f\u3002\nS3\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u3066\u3084\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u3002\n\n\u91cd\u8981\u306a\u306e\u306f\u3001\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30c8\u30c3\u30d7\u306bappspec.yml\u3092\u7f6e\u304f\u3053\u3068\u3067\u3042\u308b\u3002\n\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CodeDeploy\u3092\u9078\u629e\u3059\u308b\n\n##\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\nCodeDeploy\u30c8\u30c3\u30d7\u306e\u753b\u9762\u304b\u3089\u3001\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d: myCodeDeploy\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d: myCodeDeploy\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\u3067\n\u30ad\u30fc: Name\n\u5024: MyCodeDeploy\n\n\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n\t\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30ebARN: arn:aws:iam::~:role/myCodeDeploy\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\n##\u65b0\u3057\u3044\u30c7\u30d7\u30ed\u30a4\u306e\u4f5c\u6210\nCodeDeploy\u30c8\u30c3\u30d7\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u3001\u30a2\u30af\u30b7\u30e7\u30f3\u304b\u3089\u65b0\u3057\u3044\u30ea\u30d3\u30b8\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3: myCodeDeploy\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7: myCodeDeploy\n\u30ea\u30d3\u30b8\u30e7\u30f3\u30bf\u30a4\u30d7: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306f GitHub \u306b\u683c\u7d0d\u3055\u308c\u3066\u3044\u307e\u3059\n\nGitHub\u306b\u63a5\u7d9a\u3092\u9078\u629e\u3059\u308b\u3002\u3059\u308b\u3068\u73fe\u308c\u308b\u9805\u76ee\u306b\u3064\u3044\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\n\u30ea\u30dd\u30b8\u30c8\u30ea\u540d: \uff1cGitHub\u767b\u9332\u30e6\u30fc\u30b6\u30fc\u540d\uff1e/\uff1c\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\uff1e\n\u30b3\u30df\u30c3\u30c8ID: \uff1c\u30b3\u30df\u30c3\u30c8ID\uff1e\n\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a: CodeDeployDefault.oneAtTime\n\n\u3092\u5165\u529b\u3057\u3066\u3001\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3059\u308b\n\n\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u4f5c\u6210\u3057\u305f\u30c7\u30d7\u30ed\u30a4\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u6210\u529f\u3068\u306a\u308b\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089```http://<EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u5272\u308a\u632f\u3089\u308c\u305f\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9>```\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u3001\u4f5c\u6210\u3057\u305findex.html\u306e\u5185\u5bb9\u304c\u8868\u793a\u3055\u308c\u308b\u3002\n\n\n\n\n#git push\u3067EC2\u306b\u81ea\u52d5\u30c7\u30d7\u30ed\u30a4\n\u3053\u3053\u3067\u306fAWS CodePipeline\u3092\u4f7f\u3046\u65b9\u6cd5\u3068GitHub\u306eWebhooks\u6a5f\u80fd\u3092\u4f7f\u3046\u65b9\u6cd5\u306e2\u3064\u3092\u7d39\u4ecb\u3059\u308b\u3002\u3044\u305a\u308c\u304b\u306e\u65b9\u6cd5\u3067\u884c\u3046\u3068\u826f\u3044\u3002\n\u306a\u304a\u3001AWS CodePipeline\u3092\u4f7f\u3063\u305f\u5834\u5408\u306f\u7c21\u5358\u306b\u8a2d\u5b9a\u3067\u304d\u3001\u307e\u305f\u3001GitHub\u306b\u9650\u3089\u305aS3\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30c7\u30d7\u30ed\u30a4\u3057\u305f\u308a\u3001\u30d3\u30eb\u30c9\u306bJenkins\u3084Solano CI\u3092\u9078\u629e\u3057\u305f\u308a\u3001Deployment\u3092\u884c\u3046\u624b\u6bb5\u3068\u3057\u3066\u3001CodeDeploy\u3084AWS Elastic Beanstalk\u306a\u3069\u3092\u7528\u3044\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3002\n\n##(\u305d\u306e1) AWS CodePipeline\u3092\u4f7f\u3046\u65b9\u6cd5\n###Step 1: Name\nPipeline name: CodePipelineTest\n\n###Step 2: Source\nSource provider: GitHub\nRepository: \uff1cGitHub\u30e6\u30fc\u30b6\u30fc\u540d\uff1e/\uff1c\u30ec\u30dd\u30b8\u30c8\u30ea\u540d\uff1e\nBranch: master\n\n###Step 3: Build\nBuild provider: No Build\n\n###Step 4: Beta\nDeployment provider: AWS CodeDeploy\nApplication name: myCodeDeployForCodePipeline\nDeployment group: myCodeDeployForCodePipeline\n\n###Step 5: Service Role\nRole name\u306fCreate Role\u3092\u9078\u629e\u3057\u3066\u9077\u79fb\u3057\u305f\u5148\u306e\u30da\u30fc\u30b8\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u3066\u8a31\u53ef\u3092\u9078\u629e\u3059\u308b\u3002\n\nIAM\u30ed\u30fc\u30eb: \u65b0\u3057\u3044IAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u30ed\u30fc\u30eb\u540d: AWSCodePipelineService\n\n###Step 6: Review\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u305f\u3089\u3001Create pipeline\u3092\u9078\u629e\n\n\u4ee5\u4e0a\u3067\u3001EC2\u306b\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u304c\u59cb\u307e\u308a\u3001\u4ee5\u964dGitHub\u306bpush\u3059\u308b\u5ea6\u306b\u81ea\u52d5\u3067\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n##(\u305d\u306e2) GitHub\u306eWebhooks\u6a5f\u80fd\u3092\u4f7f\u3046\u65b9\u6cd5\nGitHub\u306eService\u306bAWS CodeDeploy\u3068GitHub Auto-Deployment\u306e2\u3064\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n###AWS CodeDeploy\u3092Service\u306b\u767b\u9332\nGitHub\u306e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u30da\u30fc\u30b8\u304b\u3089Settings\u30bf\u30d6\u3092\u9078\u629e\u3057\u3001Webhooks & services\u3092\u9078\u629e\u3002\nServices\u306e\u9805\u76ee\u304b\u3089\u3001Add service\u3092\u62bc\u3057\u3066AWS CodeDeploy\u3092\u9078\u629e\u3059\u308b\u3002\u305d\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\n\nApplication name: myCodeDeploy\nDeployment group: myCodeDeploy\nAws access key: \uff1cIAM\u30e6\u30fc\u30b6\u30fc\u3067\u767a\u884c\u3055\u308c\u305fcredetials\u306e\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\uff1e\nAws region: \uff1cCodeDeploy\u3092\u5b9f\u884c\u3059\u308b\u5730\u57df ex. us-west-2\uff1e\nGitHub api url: \u7a7a\u6b04\nAws secret access key: \uff1cIAM\u30e6\u30fc\u30b6\u30fc\u3067\u767a\u884c\u3055\u308c\u305fcredetials\u306e\u30a2\u30af\u30bb\u30b9\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\uff1e\nGitHub token: \u7a7a\u6b04\n\n\n###GitHub Auto-Deployment\u3092Service\u306b\u767b\u9332\n\u6700\u521d\u306bGitHub\u304b\u3089\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u305f\u3081\u306e\u30c8\u30fc\u30af\u30f3\u3092\u767a\u884c\u3059\u308b\u3002\n1.GitHub\u306e\u753b\u9762\u53f3\u4e0a\u306e\u81ea\u5206\u306e\u30a2\u30a4\u30b3\u30f3\u3092\u62bc\u3059\u3068\u51fa\u3066\u6765\u308b\u30e1\u30cb\u30e5\u30fc\u304b\u3089Settings\u3092\u9078\u629e\n2.Personal settings\u304b\u3089Personal access tokens\u3092\u9078\u629e\u3059\u308b\u3002\n3.Generate new token\u3092\u62bc\u3059\n4.\u51fa\u3066\u6765\u308b\u753b\u9762\u3067\u3001Token description\u306f\u81ea\u5206\u3067\u4ed6\u306e\u30c8\u30fc\u30af\u30f3\u3068\u8b58\u5225\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u9069\u5f53\u306b\u8a18\u8ff0\u3057\u3066\u304a\u304f\u3002\u52a0\u3048\u3066\u3001repo_deployment\u3092\u6700\u4f4e\u9650\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u305f\u4e0a\u3067Generate token\u3092\u62bc\u3059\u3068\u3001\u30c8\u30fc\u30af\u30f3\u304c\u767a\u884c\u3055\u308c\u308b\u306e\u3067\u3001\u8868\u793a\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n\n\u6b21\u306b\u3001GitHub\u306e\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u30ec\u30dd\u30b8\u30c8\u30ea\u5185\u306e\u30da\u30fc\u30b8\u304b\u3089Settings\u30bf\u30d6\u3092\u9078\u629e\u3057\u3001Webhooks & services\u3092\u9078\u629e\nServices\u306e\u9805\u76ee\u304b\u3089\u3001Add service\u3092\u62bc\u3057\u3066GitHub Auto-Deployment\u3092\u9078\u629e\u3059\u308b\u3002\u305d\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\u3002\n\nGitHub token: <\u5148\u307b\u3069\u767a\u884c\u3057\u305f\u30c8\u30fc\u30af\u30f3>\nEnvironment: myCodeDeploy\nDeploy on status: \u672a\u30c1\u30a7\u30c3\u30af\nGitHub api url: \u7a7a\u6b04\nActive: \u30c1\u30a7\u30c3\u30af\n\n\n\u4ee5\u4e0a\u3067\u3001git push\u3067GitHub\u306b\u5909\u66f4\u3092\u9001\u308b\u3068EC2\u306e\u30b5\u30fc\u30d0\u30fc\u306b\u81ea\u52d5\u3067\u53cd\u6620\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n#\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092Slack\u306b\u901a\u77e5\n##SNS\u30c8\u30d4\u30c3\u30af\u306e\u4f5c\u6210\n1.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089SNS\u3092\u9078\u629e\u3059\u308b\u3002\n2.SNS dashboard\u304b\u3089Common actions\u4e2d\u306eCreate topic\u3092\u9078\u629e\u3059\u308b\u3002\n3.\u51fa\u3066\u304d\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\nTopic name: deploy_status\nDisplay name: deploystat \n\n\u5165\u529b\u3057\u305f\u3089Create topic\u3092\u9078\u629e\u3059\u308b\u3002\n\n##CodeDeploy\u306b\u30c8\u30ea\u30ac\u30fc\u306e\u8a2d\u5b9a\nCodeDeploy\u306e\u753b\u9762\u304b\u3089\u5148\u307b\u3069\u4f5c\u6210\u3057\u305fmyCodeDeploy\u3092\u9078\u629e\u3057\u3001Action\u304b\u3089\u7de8\u96c6\u3092\u62bc\u3059\u3002\n\n\u5148\u307b\u3069\u672a\u8a2d\u5b9a\u306b\u3057\u3066\u304a\u3044\u305f\u30c8\u30ea\u30ac\u30fc\u306e\u9805\u76ee\u304b\u3089\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u5165\u529b\u3059\u308b\n\n\u30c8\u30ea\u30ac\u30fc\u540d: deploy-status-trigger\n\u30a4\u30d9\u30f3\u30c8: Deployment Status(all)\nAmazon SNS \u30c8\u30d4\u30c3\u30af: <\u5148\u307b\u3069SNS\u3067\u4f5c\u6210\u3057\u305f\u30c8\u30d4\u30c3\u30af>\n\n\nmyCodeDeploy \u306e\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\u304c\u5909\u66f4\u3055\u308c\u307e\u3057\u305f\u306e\u9805\u76ee\u306b\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3001\u4fdd\u5b58\u3057\u3066\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u62bc\u3057\u3001\u73fe\u308c\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u304b\u3089\u4eca\u3059\u3050\u30c7\u30d7\u30ed\u30a4\u3092\u9078\u629e\u3059\u308b\n\n#\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092Slack\u306b\u901a\u77e5\n##SNS\u306e\u901a\u77e5\u8a2d\u5b9a\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089SNS\u3092\u9078\u629e\nSNS dashboard\u306e\u9805\u76ee\u304b\u3089Topics\u3092\u9078\u629e\nCreate new topic\u3092\u9078\u629e\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u9805\u76ee\u3092\u5165\u529b\u3059\u308b\n\nTopic name: Deploy_information\nDisplay name: Deployer\n\n\u5165\u529b\u3057\u305f\u3089Create topic\u3092\u9078\u629e\u3059\u308b\n\n##CodeDeploy\u306e\u8a2d\u5b9a\n1.\u4e88\u3081\u5bfe\u8c61\u3068\u306a\u308bEC2\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30bf\u30b0\u540d\u3092\u9078\u629e\u3057\u3066\u304a\u304f\u3002\n\u4f8b)EC2\u306e\u30da\u30fc\u30b8\u3067\u5bfe\u8c61\u3068\u306a\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u629e\u3057\u3066\u3001\u30bf\u30b0\u9805\u76ee\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30bf\u30b0\u3092\u8ffd\u52a0\u3059\u308b\nName: MyCodeDeploy\n\n2.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Identity and Access Management\u3092\u9078\u629e\u3057\u3066\u3001\u30ed\u30fc\u30eb\u304b\u3089\u65b0\u3057\u3044\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\u3002\n\n\u624b\u9806 1: \u30ed\u30fc\u30eb\u540d\u306e\u8a2d\u5b9a\n\u30ed\u30fc\u30eb\u540d: myLambdaExecuteRole\n\n\u624b\u9806 2: \u30ed\u30fc\u30eb\u30bf\u30a4\u30d7\u306e\u9078\u629e\nAWS Lambda\u3092\u9078\u629e\n\n\u624b\u9806 3: \u4fe1\u983c\u6027\u306e\u78ba\u7acb\nPass\n\n\u624b\u9806 4: \u30dd\u30ea\u30b7\u30fc\u306e\u30a2\u30bf\u30c3\u30c1\nAWSLambdaExecute\u3092\u9078\u629e\n\n\u624b\u9806 5: \u78ba\u8a8d\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u3066\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u9078\u629e\n\n\n\n3.\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089CodeDeploy\u3092\u9078\u629e\n4.\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\n\n###\u65b0\u3057\u3044\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\n```\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d: CodeDeployApp\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u540d: CodeDeployGroup\n```\n\n###\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8ffd\u52a0\n\n```\nName: MyCodeDeploy\n```\n\u3053\u3053\u306f\u4e88\u3081EC2\u306b\u5272\u308a\u5f53\u3066\u3066\u304a\u3044\u305f\u30bf\u30b0\u540d\u3068\u3059\u308b\n\n\n###\u30c7\u30d7\u30ed\u30a4\u8a2d\u5b9a\n\n```\nCodeDeployDefault.OneAtTime\n```\n\n\n###\u30c8\u30ea\u30ac\u30fc\n\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\u3057\u3066\u3001\u73fe\u308c\u305f\u30dd\u30c3\u30d7\u30a2\u30c3\u30d7\u306b\u4ee5\u4e0b\u306e\u5185\u5bb9\u3092\u5165\u529b\u3059\u308b\n\n\u30c8\u30ea\u30ac\u30fc\u540d: CodeDeploy\n\u30a4\u30d9\u30f3\u30c8: Deployment Status(All)\n\n###Amazon SNS \u30c8\u30d4\u30c3\u30af: Deploy_information\n\n\u4ee5\u4e0a\u306e\u3088\u3046\u306b\u9805\u76ee\u3092\u5165\u529b\u3057\u305f\u3089\u3001\u30c8\u30ea\u30ac\u30fc\u306e\u4f5c\u6210\u3092\u9078\u629e\n\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30eb\n\n```\n\u30b5\u30fc\u30d3\u30b9\u30ed\u30fc\u30ebARN: arn:aws:iam::~:role/myLambdaExecuteRole\n```\n\n\u30c7\u30d7\u30ed\u30a4\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u9078\u629e\u3059\u308b\n\n\n\n##Lambda\u306e\u4f5c\u6210\n\u4e88\u3081\u30ed\u30fc\u30ab\u30eb\u3067Lambda\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u3066\u304a\u304f.\n\u4e8b\u524d\u6e96\u5099\u3068\u3057\u3066\u3001Slack API\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u306e\u767b\u9332\u3092\u3057\u3066\u304a\u304f\n\n###Slack API\u306e\u767b\u9332\n1.https://api.slack.com/custom-integrations \u306eURL\u306b\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u98db\u3076\n\n2.Set up an incoming webhook\u3092\u9078\u629e\n\n3.\u53f3\u4e0a\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u304b\u3089\u5bfe\u8c61\u306e\u30c1\u30fc\u30e0\u3092\u9078\u629e\n4.Post to Channel\u3067\u30c1\u30e3\u30f3\u30cd\u30eb\u3092\u9078\u629e\n\u3053\u3053\u3067\u306f\u81ea\u5206\u5b9b\u306b\u3059\u308b\u306e\u3067\u3001```Privately to @hoge (you)```\u3092\u9078\u629e\n\n5.Add Incoming Webhooks integration\u3092\u9078\u629e\n\n6.\u9077\u79fb\u3057\u305f\u5148\u306e\u30da\u30fc\u30b8\u306b\u8868\u793a\u3055\u308c\u308bWebhook URL\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\u3002\n\n\n###Lambda\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u30ed\u30fc\u30ab\u30eb\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u4f5c\u696d\u3092\u884c\u3046\n\n```bash\n$ mkdir deployInform\n$ cd deployInform\n$ pip install requests -t .\n$ vim lambda_function.py\n```\n\nlambda_function.py\u306e\u5185\u5bb9\u306f\u4ee5\u4e0b\u306eURL\u306e\u5185\u5bb9\u306e\u3082\u306e\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002channel\u306f\u5148\u307b\u3069\u306e\u500b\u4eba\u5b9b\u306e\u5834\u5408\u306f@hoge\u306e\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3002\nhttp://ceblog.mediba.jp/post/141460887747/aws-codedeploy\u306e\u30c7\u30d7\u30ed\u30a4\u7d50\u679c\u3092slack\u306b\u6d41\u3059\n\n\n```bash\n$ zip -r deploy.zip -t *\n```\n\n###\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda\u306e\u64cd\u4f5c\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u304b\u3089Lambda\u3092\u9078\u629e\nCreate a Lambda funtion\u3092\u9078\u629e\n\n###Select blueprint\nsns-message-python\u3092\u9078\u629e\n\n###Configure triggers\nSNS topic: Deploy_information\nEnable trigger\u306e\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u308b\n\n\n###Configure function\nName: myDeploymentLambda\n\n\nLambda function code\nCode entry type: Upload a .ZIP file\nFunction package: \u4f5c\u6210\u3057\u305fzip\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\n\nLambda function handler and role\nHandler: lambda_function.lambda_handler(<\u30d5\u30a1\u30a4\u30eb\u540d>/<\u95a2\u6570\u540d>)\nRole: Choose a existing role\nExisting role: myLambdaExecuteRole\n\n\u6b8b\u308a\u306e\u9805\u76ee\u306fEC2\u306e\u5c5e\u3059\u308bVPC\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u7269\u3067\u3042\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u826f\u3044\u3002\n\nReview\n\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u305f\u3089Create function\u3092\u9078\u629e\n\n\u4ee5\u4e0a\u3067\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092git push\u3059\u308b\u5ea6\u306bEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30c7\u30d7\u30ed\u30a4\u3055\u308c\u3066\u3001\u305d\u306e\u7d50\u679c\u304cSlack\u306b\u901a\u77e5\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n\n#\u53c2\u8003\nhttps://www.youtube.com/watch?v=qZa5JXmsWZs\nhttps://github.com/andrewpuch/code_deploy_example\nhttp://qiita.com/yukofeb/items/e077fc8755416c904032\nhttp://docs.aws.amazon.com/ja_jp/codedeploy/latest/userguide/how-to-create-service-role.html\nhttp://qiita.com/toshihirock/items/4ab08afcab2a0e7628a8\n"}