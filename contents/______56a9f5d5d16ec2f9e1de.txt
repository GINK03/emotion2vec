{"context": "http://qiita.com/yumatz/items/debbc6d6063c85531fd1 \u306e\u518d\u751f\u7523\n\n\u6982\u8981\ndstat\u3067\u5f97\u3089\u308c\u305f\u30b5\u30fc\u30d0\u60c5\u5831\u3092fluentd\u3067\u62fe\u3063\u3066\u3042\u3052\u3066elasticsearch\u306b\u6d41\u3057\u8fbc\u3080. \u305d\u308c\u3092kibana\u3067\u53ef\u8996\u5316\u3057\u3066\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u57fa\u76e4\u3092\u4f5c\u308b\n\u6ce8\u610f\u70b9\n\nelasticsearch\u306b\u306flogstash\u5f62\u5f0f\u3067\u633f\u5165\u3059\u308b\u3053\u3068\u3067\u904b\u7528\u6027\u3092\u3042\u3052\u308b\ndstat\u30d7\u30e9\u30b0\u30a4\u30f3\u306f(\u6570\u5024\u3067\u306f\u306a\u304f) \u6587\u5b57\u5217\u3067\u5024\u3092\u8a70\u3081\u8fbc\u3080\u306e\u3067\u3001\nelasticsearch\u306b\u5024\u3092\u5165\u308c\u308b\u969b\u306b dynamic mapping\u3092\u4f7f\u3063\u3066\u6587\u5b57\u5217\u3092\u6570\u5024\u3068\u3057\u3066\u683c\u7d0d\u3059\u308b\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb&\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u505c\u6b62\n\nfluentd\u306f td-agent \u306eRPM\u3067\u5c0e\u5165. systemctl enable td-agent.service \u3067\u81ea\u52d5\u8d77\u52d5\nelasticsearch \u306fRPM\u3067\u5c0e\u5165. systemctl enable elasticsearch \u3067\u81ea\u52d5\u8d77\u52d5\nkibana\u306fRPM\u3067\u5c0e\u5165. systemctl enable kibana \u3067\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n\n/etc/sysconfig/elasticsearch \u3067elasticsearch \u306e\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5909\u66f4\u3057\u3066\u304a\u304f\u3068\u3088\u3044\ndstat\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f sudo td-agent-gem install fluent-plugin-dstat \u3067\u5c0e\u5165\n\n\n/etc/td-agent/td-agent.conf\n\n<source>\n  type dstat\n  tag dstat.__HOSTNAME__\n  option -cmdgn\n  delay 10\n</source>\n<match dstat.**>\n  type copy\n  <store>\n    type elasticsearch\n    host localhost\n    port 9200\n    logstash_format true\n    logstash_prefix logstash\n    type_name dstat\n    flush_interval 20\n  </store>\n</match>\n\n\ndynamical type mapping\nelasticsearch \u306b curl \u3067\u547d\u4ee4\u3092\u3060\u3059\n$ cat << EOF | curl -X PUT 'http://localhost:9200/_template/logstash-tmpl' -d @-\n{\n  \"template\": \"logstash-*\",\n  \"mappings\": {\n    \"dstat\": {\n      \"dynamic_templates\": [\n        {\n          \"string_to_double\": {\n            \"match_mapping_type\": \"string\",\n            \"path_match\": \"dstat.*\",\n            \"mapping\": { \"type\": \"double\" }\n          }\n        }\n      ]\n    }\n  }\n}\nEOF\n\n\n\u6700\u5f8c\u306b\n\u6570\u5024\u7684\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3060\u3051\u306a\u3089 telegraph+influxdb+grafana \u306e\u69cb\u6210\u306e\u65b9\u304c\u7b4b\u304c\u3088\u3044\nhttp://qiita.com/yumatz/items/debbc6d6063c85531fd1 \u306e\u518d\u751f\u7523\n\n## \u6982\u8981\ndstat\u3067\u5f97\u3089\u308c\u305f\u30b5\u30fc\u30d0\u60c5\u5831\u3092fluentd\u3067\u62fe\u3063\u3066\u3042\u3052\u3066elasticsearch\u306b\u6d41\u3057\u8fbc\u3080. \u305d\u308c\u3092kibana\u3067\u53ef\u8996\u5316\u3057\u3066\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30e1\u30c8\u30ea\u30af\u30b9\u57fa\u76e4\u3092\u4f5c\u308b\n\u6ce8\u610f\u70b9\n\n- elasticsearch\u306b\u306flogstash\u5f62\u5f0f\u3067\u633f\u5165\u3059\u308b\u3053\u3068\u3067\u904b\u7528\u6027\u3092\u3042\u3052\u308b\n- dstat\u30d7\u30e9\u30b0\u30a4\u30f3\u306f(\u6570\u5024\u3067\u306f\u306a\u304f) \u6587\u5b57\u5217\u3067\u5024\u3092\u8a70\u3081\u8fbc\u3080\u306e\u3067\u3001\n- elasticsearch\u306b\u5024\u3092\u5165\u308c\u308b\u969b\u306b dynamic mapping\u3092\u4f7f\u3063\u3066\u6587\u5b57\u5217\u3092\u6570\u5024\u3068\u3057\u3066\u683c\u7d0d\u3059\u308b\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb&\u30b5\u30fc\u30d3\u30b9\u306e\u8d77\u52d5\u505c\u6b62\n- fluentd\u306f td-agent \u306eRPM\u3067\u5c0e\u5165. `systemctl enable td-agent.service` \u3067\u81ea\u52d5\u8d77\u52d5\n- elasticsearch \u306fRPM\u3067\u5c0e\u5165. `systemctl enable elasticsearch` \u3067\u81ea\u52d5\u8d77\u52d5\n- kibana\u306fRPM\u3067\u5c0e\u5165. `systemctl enable kibana` \u3067\u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\n- `/etc/sysconfig/elasticsearch` \u3067elasticsearch \u306e\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u5909\u66f4\u3057\u3066\u304a\u304f\u3068\u3088\u3044\n- dstat\u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u306f `sudo td-agent-gem install fluent-plugin-dstat` \u3067\u5c0e\u5165\n\n## `/etc/td-agent/td-agent.conf`\n\n```\n<source>\n  type dstat\n  tag dstat.__HOSTNAME__\n  option -cmdgn\n  delay 10\n</source>\n<match dstat.**>\n  type copy\n  <store>\n    type elasticsearch\n    host localhost\n    port 9200\n    logstash_format true\n    logstash_prefix logstash\n    type_name dstat\n    flush_interval 20\n  </store>\n</match>\n```\n\n## dynamical type mapping\nelasticsearch \u306b curl \u3067\u547d\u4ee4\u3092\u3060\u3059\n\n```\n$ cat << EOF | curl -X PUT 'http://localhost:9200/_template/logstash-tmpl' -d @-\n{\n  \"template\": \"logstash-*\",\n  \"mappings\": {\n    \"dstat\": {\n      \"dynamic_templates\": [\n        {\n          \"string_to_double\": {\n            \"match_mapping_type\": \"string\",\n            \"path_match\": \"dstat.*\",\n            \"mapping\": { \"type\": \"double\" }\n          }\n        }\n      ]\n    }\n  }\n}\nEOF\n```\n\n## \u6700\u5f8c\u306b\n\u6570\u5024\u7684\u306a\u30e1\u30c8\u30ea\u30af\u30b9\u3060\u3051\u306a\u3089 telegraph+influxdb+grafana \u306e\u69cb\u6210\u306e\u65b9\u304c\u7b4b\u304c\u3088\u3044\n", "tags": ["fluentd", "dstat", "kibana", "Elasticsearch"]}