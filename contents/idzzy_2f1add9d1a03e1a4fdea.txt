{"context": " More than 1 year has passed since last update.\n\nWhat's this?\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n* Nova instance \u3092\u505c\u6b62\u305b\u305a\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5225\u306e compute node \u306b\u79fb\u52d5\u3059\u308b\u6a5f\u80fd\u3067\u306f\u306a\u3044\n* \u3042\u304f\u307e\u3067 shared storage \u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u5225\u306e compute node \u3067\u8d77\u52d5\u3057\u76f4\u3059\u6a5f\u80fd\n[Case]\n\nNova instance data is stored in Nova volume of shared storage. Cinder volume is attached to Nova instance.\nNova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage. Cinder volume is attached to Nova instance.\n\n[\u6761\u4ef6]\n\nShared storage \u3042\u308a\nNova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f Shared storage \u306b\u3042\u308b\nCinder volume \u304c Nova instance \u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\nHypervisor \u306f KVM\n\n\n[Case1] Nova instance data is stored in Nova volume of shared storage. Cinder volume is attached to Nova instance.\n\nInitial state\n\nCompute node\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:41:26.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-27T05:41:32.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:41:34.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:36.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:42.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:44.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is running on node-28\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 2a227a9c-801f-458b-ae67-29513e87282b | admin_vm01 | ACTIVE | active               | nova                         | node-28                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nCinder volume is attached\n# nova show admin_vm01 | egrep \"Property|os-extended-volumes\"\n| Property                             | Value                                                    |\n| os-extended-volumes:volumes_attached | [{\"id\": \"59dda5f6-d8dd-475d-8445-3c23aa16e3b6\"}]         |\n\n# cinder list | egrep \"ID|59dda5f6-d8dd-475d-8445-3c23aa16e3b6\"\n|                  ID                  | Status | Display Name | Size | Volume Type | Bootable |             Attached to              |\n| 59dda5f6-d8dd-475d-8445-3c23aa16e3b6 | in-use | admin_vol01  |  1   |     None    |  false   | 2a227a9c-801f-458b-ae67-29513e87282b |\n\n\nStop nova-compute service of node-28\n\nStop nova-compute service\n# service openstack-nova-compute stop\n\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:49:56.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | down  | 2015-03-27T05:48:02.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:49:54.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:50:06.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled XXX 2015-03-27T05:48:02.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:50:04.000000 |\n+--------------------------+----------------------------------------+\n\n\nEvacuate\n\nExecute evacuate\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n# nova evacuate --on-shared-storage 2a227a9c-801f-458b-ae67-29513e87282b node-27\n\n\nCheck the evacuate result\nNova instance is running on node-27(active) by using the previous data stored in shared storage\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 2a227a9c-801f-458b-ae67-29513e87282b | admin_vm01 | ACTIVE | active               | nova                         | node-27                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\nCinder volume(vdb) is attached even after evacuate\n$ ssh cirros@<INSTANCE> lsblk\nNAME   MAJ:MIN RM    SIZE RO TYPE MOUNTPOINT\nvda    253:0    0      1G  0 disk\n`-vda1 253:1    0 1011.9M  0 part /\nvdb    253:16   0      1G  0 disk\n\n\n[Case2] Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage. Cinder volume is attached to Nova instance.\n\nInitial state\n\nCompute node\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:41:26.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-27T05:41:32.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:41:34.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:36.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:42.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:41:44.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is running on node-28\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db | admin_vm02 | ACTIVE | active               | nova                         | node-28                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nCinder volume is attached\n# nova show admin_vm02 | egrep \"Property|os-extended-volumes|image\"\n| Property                             | Value                                                                                            |\n| image                                | Attempt to boot from volume - no image supplied                                                  |\n| os-extended-volumes:volumes_attached | [{\"id\": \"75bf2311-ea23-48fd-b9c4-bb5173f3464f\"}, {\"id\": \"805fea46-28f8-4acc-84cf-e320c42d3d0d\"}] |\n\n# cinder list | egrep \"ID|75bf2311-ea23-48fd-b9c4-bb5173f3464f|805fea46-28f8-4acc-84cf-e320c42d3d0d\"\n|                  ID                  | Status | Display Name | Size | Volume Type | Bootable |             Attached to              |\n| 75bf2311-ea23-48fd-b9c4-bb5173f3464f | in-use | admin_vol02  |  1   |     None    |   true   | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db |\n| 805fea46-28f8-4acc-84cf-e320c42d3d0d | in-use | admin_vol03  |  1   |     None    |  false   | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db |\n\n\nStop nova-compute service of node-28\n\nStop nova-compute service\n# service openstack-nova-compute stop\n\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:49:56.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | down  | 2015-03-27T05:48:02.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:49:54.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:50:06.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled XXX 2015-03-27T05:48:02.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-27T05:50:04.000000 |\n+--------------------------+----------------------------------------+\n\n\nEvacuate\n\nExecute evacuate\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n# nova evacuate --on-shared-storage 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db node-27\n\n\nCheck the evacuate result\nNova instance is running on node-27(active) by using the previous data stored in Cinder volume of shared storage\n# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db | admin_vm02 | ACTIVE | active               | nova                         | node-27                              |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\nCinder volume(vdb) is attached even after evacuate\n$ ssh cirros@<INSTANCE> lsblk\nNAME   MAJ:MIN RM    SIZE RO TYPE MOUNTPOINT\nvda    253:0    0      1G  0 disk\n`-vda1 253:1    0 1011.9M  0 part /\nvdb    253:16   0      1G  0 disk\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nOpenstack - Nova Evacuate with Shared Storage\nOpenstack - Nova Evacuate with Shared Storage with Cinder\nOpenstack - Nova Evacuate with Shared Storage with Cinder between AZ\nOpenstack - Nova Evacuate without Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage between AZ\n## What's this?\n\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n* Nova instance \u3092\u505c\u6b62\u305b\u305a\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u5225\u306e compute node \u306b\u79fb\u52d5\u3059\u308b\u6a5f\u80fd\u3067\u306f\u306a\u3044\n* \u3042\u304f\u307e\u3067 shared storage \u4e0a\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u5225\u306e compute node \u3067\u8d77\u52d5\u3057\u76f4\u3059\u6a5f\u80fd\n\n[Case]\n\n1. Nova instance data is stored in Nova volume of shared storage. Cinder volume is attached to Nova instance.\n2. Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage. Cinder volume is attached to Nova instance.\n\n[\u6761\u4ef6]\n\n* Shared storage \u3042\u308a\n* Nova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f Shared storage \u306b\u3042\u308b\n* **Cinder volume \u304c Nova instance \u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b**\n* Hypervisor \u306f KVM\n\n## [Case1] Nova instance data is stored in Nova volume of shared storage. Cinder volume is attached to Nova instance.\n\n### Initial state\n\n#### Compute node\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:41:26.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-27T05:41:32.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:41:34.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:36.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:42.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:44.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is running on node-28\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 2a227a9c-801f-458b-ae67-29513e87282b | admin_vm01 | ACTIVE | active               | nova                         | node-28                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n#### Cinder volume is attached\n\n    # nova show admin_vm01 | egrep \"Property|os-extended-volumes\"\n    | Property                             | Value                                                    |\n    | os-extended-volumes:volumes_attached | [{\"id\": \"59dda5f6-d8dd-475d-8445-3c23aa16e3b6\"}]         |\n\n    # cinder list | egrep \"ID|59dda5f6-d8dd-475d-8445-3c23aa16e3b6\"\n    |                  ID                  | Status | Display Name | Size | Volume Type | Bootable |             Attached to              |\n    | 59dda5f6-d8dd-475d-8445-3c23aa16e3b6 | in-use | admin_vol01  |  1   |     None    |  false   | 2a227a9c-801f-458b-ae67-29513e87282b |\n\n### Stop nova-compute service of node-28\n\n#### Stop nova-compute service\n\n    # service openstack-nova-compute stop\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:49:56.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | down  | 2015-03-27T05:48:02.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:49:54.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:50:06.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled XXX 2015-03-27T05:48:02.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:50:04.000000 |\n    +--------------------------+----------------------------------------+\n\n### Evacuate\n\n#### Execute evacuate\n\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n\n    # nova evacuate --on-shared-storage 2a227a9c-801f-458b-ae67-29513e87282b node-27\n\n#### Check the evacuate result\n\nNova instance is running on node-27(active) by using the previous data stored in shared storage\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 2a227a9c-801f-458b-ae67-29513e87282b | admin_vm01 | ACTIVE | active               | nova                         | node-27                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\nCinder volume(vdb) is attached even after evacuate\n\n    $ ssh cirros@<INSTANCE> lsblk\n    NAME   MAJ:MIN RM    SIZE RO TYPE MOUNTPOINT\n    vda    253:0    0      1G  0 disk\n    `-vda1 253:1    0 1011.9M  0 part /\n    vdb    253:16   0      1G  0 disk\n\n\n\n## [Case2] Nova instance data is stored in Cinder volume (= boot from Cinder volume), Cinder data is stored in Cinder volume of shared storage. Cinder volume is attached to Nova instance.\n\n### Initial state\n\n#### Compute node\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:41:26.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-27T05:41:32.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:41:34.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:36.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:42.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:41:44.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is running on node-28\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db | admin_vm02 | ACTIVE | active               | nova                         | node-28                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n#### Cinder volume is attached\n\n    # nova show admin_vm02 | egrep \"Property|os-extended-volumes|image\"\n    | Property                             | Value                                                                                            |\n    | image                                | Attempt to boot from volume - no image supplied                                                  |\n    | os-extended-volumes:volumes_attached | [{\"id\": \"75bf2311-ea23-48fd-b9c4-bb5173f3464f\"}, {\"id\": \"805fea46-28f8-4acc-84cf-e320c42d3d0d\"}] |\n\n    # cinder list | egrep \"ID|75bf2311-ea23-48fd-b9c4-bb5173f3464f|805fea46-28f8-4acc-84cf-e320c42d3d0d\"\n    |                  ID                  | Status | Display Name | Size | Volume Type | Bootable |             Attached to              |\n    | 75bf2311-ea23-48fd-b9c4-bb5173f3464f | in-use | admin_vol02  |  1   |     None    |   true   | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db |\n    | 805fea46-28f8-4acc-84cf-e320c42d3d0d | in-use | admin_vol03  |  1   |     None    |  false   | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db |\n\n### Stop nova-compute service of node-28\n\n#### Stop nova-compute service\n\n    # service openstack-nova-compute stop\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-27T05:49:56.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | down  | 2015-03-27T05:48:02.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-27T05:49:54.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:50:06.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled XXX 2015-03-27T05:48:02.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-27T05:50:04.000000 |\n    +--------------------------+----------------------------------------+\n\n### Evacuate\n\n#### Execute evacuate\n\nEvacuate Nova instance from node-28(inactive) to node-27(active)\n\n    # nova evacuate --on-shared-storage 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db node-27\n\n#### Check the evacuate result\n\nNova instance is running on node-27(active) by using the previous data stored in Cinder volume of shared storage\n\n    # nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | 4c0b84ec-3647-4bd9-b222-d07e3ce9a8db | admin_vm02 | ACTIVE | active               | nova                         | node-27                              |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\nCinder volume(vdb) is attached even after evacuate\n\n    $ ssh cirros@<INSTANCE> lsblk\n    NAME   MAJ:MIN RM    SIZE RO TYPE MOUNTPOINT\n    vda    253:0    0      1G  0 disk\n    `-vda1 253:1    0 1011.9M  0 part /\n    vdb    253:16   0      1G  0 disk\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n## Reference\n\n[Openstack - Nova Evacuate with Shared Storage][link-01]\n[Openstack - Nova Evacuate with Shared Storage with Cinder][link-02]\n[Openstack - Nova Evacuate with Shared Storage with Cinder between AZ][link-03]\n[Openstack - Nova Evacuate without Shared Storage][link-04]\n[Openstack - Nova Host-Evacuate with Shared Storage][link-05]\n[Openstack - Nova Host-Evacuate with Shared Storage between AZ][link-06]\n\n[link-01]:http://qiita.com/idzzy/items/3f398ff8eaa3b786fc89\n[link-02]:http://qiita.com/idzzy/items/2f1add9d1a03e1a4fdea\n[link-03]:http://qiita.com/idzzy/items/8dd2b417f8c5f8efa7c9\n[link-04]:http://qiita.com/idzzy/items/860cb6c60ab7433eb817\n[link-05]:http://qiita.com/idzzy/items/9f057becb592c4c89137\n[link-06]:http://qiita.com/idzzy/items/71287b09de1370c68118\n", "tags": ["openstack", "nova"]}