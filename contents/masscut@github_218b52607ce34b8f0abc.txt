{"context": " More than 1 year has passed since last update.\n\nGoal\nbento\u00a0\u3092\u30d9\u30fc\u30b9\u306b\u30aa\u30ec\u30aa\u30ec\u958b\u767a\u74b0\u5883\u306eVagrant box\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nArtifact\nhttps://github.com/masscut/linuxbox\n\nplaybook\n\u6b21\u306bplaybook\u3092\u4f5c\u6210\u3002Vagrant\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3084\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\u3002\n\u3053\u3053\u3067\u4f5c\u6210\u3057\u305fplaybook\u306f\u30b3\u30c1\u30e9\u3002\n\u4ee5\u4e0b\u3001playbook\u306e\u89e3\u8aac\u3002\n\nDeploy using git\n\u30aa\u30ec\u30aa\u30ecdotfiles\u3068oh-my-zsh\u306f\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3057\u305f\u3089git clone\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\nlinuxbox.yml\n    - name: Be sure dotfiles are installed.\n      command: test -d '/home/vagrant/dotfiles' \n      register: resultdtf \n      failed_when: resultdtf.rc not in [0, 1] \n    - name: Deploy dotfiles.\n      git: repo=https://github.com/masscut/dotfiles.git dest=/home/vagrant/dotfiles\n      when: resultdtf.rc == 1\n\n\n\nChange shell to zsh\nvagrant \u30e6\u30fc\u30b6\u30fc\u306eshell\u304czsh(/bin/zsh)\u3058\u3083\u306a\u304b\u3063\u305f\u3089\u3001zsh\u306b\u5207\u308a\u66ff\u3048\u3002\n\nlinuxbox.yml\n    - name: Be sure shell is zsh\n      command: grep vagrant /etc/passwd  \n      register: resultsh \n    - name: Change shell to zsh\n      command: chsh -s /bin/zsh vagrant\n      when: resultsh.stdout.find('/bin/zsh') == -1 \n\n\n\nPacker template\n\u3053\u3053\u3067\u4f5c\u6210\u3057\u305ftemplatefile\u306f\u30b3\u30c1\u30e9\u3002\n\u4ee5\u4e0b\u89e3\u8aac\u3002\n\nInstall ansible\nAnsible\u516c\u5f0f\u3092\u53c2\u8003\u306b\u3001ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bshell\u3092\u4f5c\u6210\u3002\n\nansible.sh\napt-add-repository ppa:rquillo/ansible\napt-get update\napt-get -y install ansible\n\n\n\u3053\u306eshell\u3092packer provisioner\u3067\u5b9f\u884c\u3059\u308b\u7528\u306bpacker template\u3092\u4fee\u6b63\u3002\u307e\u305f\u3001ansible\u306ecopy module\u3067\u4f7f\u3046\u30d5\u30a1\u30a4\u30eb(.gitconfig, .gemrc)\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u306bprovisiners\u30bb\u30af\u30b7\u30e7\u30f3\u306bplaybook_path\u3092\u8a18\u8ff0\u3002\n\nlinuxbox.json\n  \"provisioners\": [\n    {\n      \"environment_vars\": [\n        \"CHEF_VERSION={{user `chef_version`}}\"\n      ],\n      \"execute_command\": \"echo 'vagrant'|{{.Vars}} sudo -S -E bash '{{.Path}}'\",\n      \"scripts\": [\n        \"scripts/ubuntu/update.sh\",\n        \"scripts/common/sshd.sh\",\n        \"scripts/ubuntu/networking.sh\",\n        \"scripts/ubuntu/sudoers.sh\",\n        \"scripts/common/vagrant.sh\",\n        \"scripts/common/vmtools.sh\",\n        \"scripts/common/chef.sh\",\n        \"scripts/ubuntu/ansible.sh\",\n        \"scripts/ubuntu/cleanup.sh\",\n        \"scripts/common/minimize.sh\"\n      ],\n      \"type\": \"shell\"\n    },\n    {\n      \"type\": \"ansible-local\",\n      \"playbook_file\": \"provisioning/linuxbox.yml\",\n      \"playbook_paths\": \"provisioning\"\n    }\n  ]\n\n\n\npacker build!\n% packer build linuxbox.json\n# Goal\n[bento](https://github.com/opscode/bento)\u00a0\u3092\u30d9\u30fc\u30b9\u306b\u30aa\u30ec\u30aa\u30ec\u958b\u767a\u74b0\u5883\u306eVagrant box\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n## Artifact\n[https://github.com/masscut/linuxbox](https://github.com/masscut/linuxbox)\n\n## playbook\n\u6b21\u306bplaybook\u3092\u4f5c\u6210\u3002Vagrant\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u3084\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3046\u3002\n\u3053\u3053\u3067\u4f5c\u6210\u3057\u305fplaybook\u306f[\u30b3\u30c1\u30e9](https://github.com/masscut/linuxbox/provisioning/linuxbox.yml)\u3002\n\u4ee5\u4e0b\u3001playbook\u306e\u89e3\u8aac\u3002\n\n### Deploy using git\n\u30aa\u30ec\u30aa\u30ecdotfiles\u3068oh-my-zsh\u306f\u30c7\u30d7\u30ed\u30a4\u5148\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\u3057\u305f\u3089git clone\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\n```yaml:linuxbox.yml\n    - name: Be sure dotfiles are installed.\n      command: test -d '/home/vagrant/dotfiles' \n      register: resultdtf \n      failed_when: resultdtf.rc not in [0, 1] \n    - name: Deploy dotfiles.\n      git: repo=https://github.com/masscut/dotfiles.git dest=/home/vagrant/dotfiles\n      when: resultdtf.rc == 1\n```\n\n### Change shell to zsh\nvagrant \u30e6\u30fc\u30b6\u30fc\u306eshell\u304czsh(/bin/zsh)\u3058\u3083\u306a\u304b\u3063\u305f\u3089\u3001zsh\u306b\u5207\u308a\u66ff\u3048\u3002\n\n```yaml:linuxbox.yml\n    - name: Be sure shell is zsh\n      command: grep vagrant /etc/passwd  \n      register: resultsh \n    - name: Change shell to zsh\n      command: chsh -s /bin/zsh vagrant\n      when: resultsh.stdout.find('/bin/zsh') == -1 \n```\n\n## Packer template\n\u3053\u3053\u3067\u4f5c\u6210\u3057\u305ftemplatefile\u306f[\u30b3\u30c1\u30e9](https://github.com/masscut/linuxbox/linuxbox.json)\u3002\n\u4ee5\u4e0b\u89e3\u8aac\u3002\n\n### Install ansible\n[Ansible\u516c\u5f0f](http://docs.ansible.com/intro_installation.html#latest-releases-via-apt-ubuntu)\u3092\u53c2\u8003\u306b\u3001ansible\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308bshell\u3092\u4f5c\u6210\u3002\n\n```bash:ansible.sh\napt-add-repository ppa:rquillo/ansible\napt-get update\napt-get -y install ansible\n```\n\n\u3053\u306eshell\u3092packer provisioner\u3067\u5b9f\u884c\u3059\u308b\u7528\u306bpacker template\u3092\u4fee\u6b63\u3002\u307e\u305f\u3001ansible\u306ecopy module\u3067\u4f7f\u3046\u30d5\u30a1\u30a4\u30eb(.gitconfig, .gemrc)\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u306e\u306bprovisiners\u30bb\u30af\u30b7\u30e7\u30f3\u306bplaybook_path\u3092\u8a18\u8ff0\u3002\n\n```json:linuxbox.json\n  \"provisioners\": [\n    {\n      \"environment_vars\": [\n        \"CHEF_VERSION={{user `chef_version`}}\"\n      ],\n      \"execute_command\": \"echo 'vagrant'|{{.Vars}} sudo -S -E bash '{{.Path}}'\",\n      \"scripts\": [\n        \"scripts/ubuntu/update.sh\",\n        \"scripts/common/sshd.sh\",\n        \"scripts/ubuntu/networking.sh\",\n        \"scripts/ubuntu/sudoers.sh\",\n        \"scripts/common/vagrant.sh\",\n        \"scripts/common/vmtools.sh\",\n        \"scripts/common/chef.sh\",\n        \"scripts/ubuntu/ansible.sh\",\n        \"scripts/ubuntu/cleanup.sh\",\n        \"scripts/common/minimize.sh\"\n      ],\n      \"type\": \"shell\"\n    },\n    {\n      \"type\": \"ansible-local\",\n      \"playbook_file\": \"provisioning/linuxbox.yml\",\n      \"playbook_paths\": \"provisioning\"\n    }\n  ]\n```\n\n## packer build!\n\n`% packer build linuxbox.json`\n", "tags": ["vagrant", "packer", "Ansible"]}