{"context": "\n\n1. \u306f\u3058\u3081\u306b\nSoftLayer\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3068VyOS\u3092\u4f7f\u3063\u3066VPN-LAN\u9593\u63a5\u7d9a\u3001\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u63a5\u7d9a\u3092\u69cb\u7bc9\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\n  SoftLayer\u3067\u306f\u3001\u5197\u9577\u5316\u69cb\u6210\u304c\u7d44\u3081\u308b\u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u30a2\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u300d(Vyatta6.x)\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u69cb\u7bc9\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u57fa\u76e4\u306e\u305f\u3081\u6570\u53f0\u306e\u30b5\u30fc\u30d0\u30fc\u5229\u7528\u3067\u306f\u5168\u4f53\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u8003\u3048\u305f\u5834\u5408\u3001\u8cbb\u7528\u9762\u306e\u30cf\u30fc\u30c9\u30eb\u304c\u9ad8\u304f\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n  \u307e\u305f\u3001\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306bVyOS\u3092\u5c0e\u5165\u3057\u305f\u5834\u5408\u3001\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u3082\u3069\u3059\u3053\u3068\u304c\u3067\u304d\u305a\u3001\u6545\u969c\u306e\u969b\u306e\u5fa9\u65e7\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n  \u4eca\u56de\u306f\u8010\u969c\u5bb3\u6027\u3092\u8003\u616e\u3057\u3064\u3064\u3001\u30b3\u30b9\u30c8\u3092\u5c11\u306a\u304f\u3059\u308b\u4e8b\u3092\u76ee\u7684\u306b\u3001\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306bVyOS\u3092\u5c0e\u5165\u3057VRRP\u3067\u5197\u9577\u5316\u69cb\u6210\u306e\u53ef\u80fd\u6027\u3092\u30c6\u30b9\u30c8\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001VyOS\u3067VRRP\u69cb\u6210\u306e\u57fa\u672c\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\n2. VRRP\u306b\u3064\u3044\u3066\n(VRRP:Virtual Router Redundancy Protocol)\nVRRP\u306f\u3001\u7269\u7406\u7684\u306b\u306f\u8907\u6570\u53f0\u3042\u308b\u30eb\u30fc\u30bf\u3092\u4eee\u60f3\u7684\u306b1\u53f0\u306e\u30eb\u30fc\u30bf\u306b\u898b\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u6280\u8853\u3067\u3059\u3002\n \u30eb\u30fc\u30bf\u306a\u3069\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668\u306e \u5197\u9577\u5316\u69cb\u6210\u3092\u69cb\u7bc9\u3059\u308b\u969b\u306e\u6a5f\u80fd\u3067\u3001RFC5798\u3067\u6a19\u6e96\u5316\u3055\u308c\u3066\u307e\u3059\u3002\n\u30b7\u30b9\u30b3\u793e\u306eHSRP(Hot Standby Routing Protocol)\u3082\u57fa\u672c\u7684\u306b\u306f\u540c\u3058\u6a5f\u80fd\u3067\u3059\u304c\u3001\nVRRP\u306e\u5834\u5408\u306f\u3001\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u306b\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u306e\u7269\u7406IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nSoftLayer\u3067VRRP\u7528\u306e\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u624b\u3059\u308b\u306b\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u6642\u306b\u3064\u3044\u3066\u304f\u308b\u30d7\u30e9\u30a4\u30de\u30ea\u30fcIP\u30a2\u30c9\u30ec\u30b9\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5c06\u6765\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306e\u4e88\u7d04IP\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u304a\u52e7\u3081\u3057\u307e\u305b\u3093\u3002\n\n\u3061\u306a\u307f\u306b\u3001SoftLayer\u3067\u6709\u511f\u7248\u306eVytta\u3092HA\u69cb\u6210\u3067\u30aa\u30fc\u30c0\u30fc\u3059\u308b\u3068\u3001\u4eee\u60f3IP\u306f\u4e88\u7d04\u6e08\u307f\u3068\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306a\u5fc3\u914d\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u307e\u305f\u3001\u30dd\u30fc\u30bf\u30d6\u30ebIP\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u304c\u3046\u307e\u304f\u3044\u304b\u305a\u3001\u901a\u4fe1\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\uff08\u53c2\u8003\u307e\u3067\uff1a\u30d1\u30d6\u30ea\u30c3\u30af\u30dd\u30fc\u30bf\u30d6\u30ebIP\u306f16\u30dd\u30fc\u30c8\u6708\u984d$32\u3067\u3059\u3002\uff09\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306fVRRP\u3067\u53ef\u80fd\u306a\u3001\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u306b\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u306e\u7269\u7406IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002\nVRRP\u306f\u8907\u6570\u53f0\u306e\u30eb\u30fc\u30bf(\u8907\u6570\u53f0\u306eVyOS)\u3067\u30b0\u30eb\u30fc\u30d7\u3092\u7d44\u307f\u3001VRRP\u4eee\u60f3IP\u3092\u5171\u6709\u3057\u307e\u3059\u3002\n \u5404\u30eb\u30fc\u30bf\u306f\u300c\u30de\u30b9\u30bf\u30fc(1\u53f0)\u300d\u3068\u300c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300d\u306e\u5f79\u5272\u306b\u5206\u304b\u308c\u3001\u30d7\u30e9\u30a4\u30aa\u30ea\u30c6\u30a3\u5024\u306e\u5927\u304d\u306a\u30eb\u30fc\u30bf\u304c\u300c\u30de\u30b9\u30bf\u30fc\u300d\u3068\u306a\u308a\u307e\u3059\u3002\n\u30fb\u30de\u30b9\u30bf\u30fc\n \u30fb\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\n\u300c\u30de\u30b9\u30bf\u30fc\u300d\u304c\u30c0\u30a6\u30f3\u3057\u305f\u969b\u306f\u3001\u81ea\u52d5\u3067\u300c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300d\u304c\u300c\u65b0\u30de\u30b9\u30bf\u30fc\u300d\u306b\u6607\u683c\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u30c0\u30a6\u30f3\u3057\u305f\u300c\u65e7\u30de\u30b9\u30bf\u30fc\u300d\u304c\u5fa9\u65e7\u3057\u305f\u5834\u5408\u306e\u5207\u308a\u623b\u3057\u306b\u306f\uff12\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n \u30fb\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u6709\u52b9---\u300c\u65e7\u30de\u30b9\u30bf\u30fc\u300d\u304c\u3059\u3050\u306b\u300c\u30de\u30b9\u30bf\u30fc\u300d\u3078\u6607\u683c\n \u30fb\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u7121\u52b9---\u300c\u30de\u30b9\u30bf\u30fc\u300d\u306e\u5207\u308a\u623b\u3057\u306f\u884c\u308f\u306a\u3044\n\u203b\u901a\u4fe1\u63a5\u7d9a\u72b6\u6cc1\u3092\u8003\u616e\u3057\u3001\u81ea\u52d5\u7684\u306b\u5207\u308a\u623b\u3057\u3092\u884c\u308f\u306a\u3044\u3000\u201d\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u7121\u52b9\u201d\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\n\n\uff13. \u69cb\u6210\u306b\u3064\u3044\u3066\n\nVyOS\u3078\u306e\u5165\u308c\u66ff\u3048\u306f\u7701\u7565\u3044\u305f\u3057\u307e\u3059\u3002\n \u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\u306e\u300c9. \u2466 VyOS\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u300d\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562baa\n\n\n\uff13-1. \u5168\u4f53\u69cb\u6210\nSoftLayer\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30923\u53f0\u30aa\u30fc\u30c0\u30fc\u3057\u307e\u3057\u305f\u3002\n\u30fbVyOS01 ------- VyOS\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u30fc\n\u30fbVyOS02 ------- VyOS\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30eb\u30fc\u30bf\u30fc\n\u30fbWWWCent6 --- \u78ba\u8a8d\u7528Web\u30b5\u30fc\u30d0\u30fc\n\n\u30fbVyOS01\u306ePriority\u3092250\u3001VyOS02\u306ePriority\u3092200\u306b\u3057\u307e\u3057\u305f\u306e\u3067\u3001VyOS01\u304c\u30de\u30b9\u30bf\u30fc\u3001VyOS02\u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u306a\u308a\u307e\u3059\u3002\n \u30fbVRRP\u4eee\u60f3PublicIP\u306fVyOS01\u306eeth1(161.202.158.218)\u3001VRRP\u4eee\u60f3PrivateIP\u306fVyOS01\u306eeth0(10.132.52.225)\u3067\u3059\u3002\n\u30fbVyOS01/VyOS02\u306eeth1\u3092Group200\u3001eth0\u3092Group100\u3068\u3057\u307e\u3057\u305f\u3002\n\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u30d1\u30b1\u30c3\u30c8\u304c\u3069\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308b\u304b\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n\u30fb\u78ba\u8a8d\u7528\u306eWeb\u30b5\u30fc\u30d0\u30fc(WWWCent6)\u306e\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306f\u3001VRRP\u4eee\u60f3PrivateIP(10.132.52.225)\u3067\u3059\u3002\n\n\n\uff13-2. VyOS\u69cb\u6210\n\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7(XXX)\u3092\u5165\u308c\u3066\u307e\u3059\u3002\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u5165\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\nVyOS01\u69cb\u6210\u4f8b\n(001) interfaces {\n(002)      ethernet eth0 {\n(003)          address 10.132.52.225/26\n(004)          duplex auto\n(005)          hw-id 06:98:ae:8a:24:ac\n(006)          smp_affinity auto\n(007)          speed auto\n(008)          vrrp {\n(009)              vrrp-group 100 {\n(010)                  advertise-interval 1\n(011)                  preempt true\n(012)                  priority 250\n(013)                  sync-group syncgroup01\n(014)                  virtual-address 10.132.52.225\n(015)              }\n(016)          }\n(017)      }\n(018)      ethernet eth1 {\n(019)          address 161.202.158.218/29\n(020)          duplex auto\n(021)          hw-id 06:26:c9:26:4f:4d\n(022)          smp_affinity auto\n(023)          speed auto\n(024)          vrrp {\n(025)              vrrp-group 200 {\n(026)                  advertise-interval 1\n(027)                  preempt true\n(028)                  priority 250\n(029)                  sync-group syncgroup01\n(030)                  virtual-address 161.202.158.218\n(031)              }\n(032)          }\n(033)      }\n(034)      loopback lo {\n(035)      }\n(036)  }\n(037)  nat {\n(038)      destination {\n(039)          rule 200 {\n(040)              description \"1-to-1 NAT\"\n(041)              destination {\n(042)                  address 161.202.158.218\n(043)                  port 80\n(044)              }\n(045)              inbound-interface any\n(046)              protocol tcp\n(047)              translation {\n(048)                  address 10.132.52.226\n(049)                  port 80\n(050)              }\n(051)          }\n(052)      }\n(053)      source {\n(054)          rule 200 {\n(055)              description \" masquerade NAT\"\n(056)              outbound-interface eth1\n(057)              source {\n(058)                  address 10.132.52.192/26\n(059)              }\n(060)              translation {\n(061)                  address masquerade\n(062)              }\n(063)          }\n(064)      }\n(065)  }\n(066)  protocols {\n(067)      static {\n(068)          route 10.0.0.0/8 {\n(069)              next-hop 10.132.52.193 {\n(070)              }\n(071)          }\n(072)      }\n(073)  }\n(074)  service {\n(075)      ssh {\n(076)          port 22\n(077)      }\n(078)  }\n(079)  system {\n(080)      config-management {\n(081)          commit-revisions 20\n(082)      }\n(083)      console {\n(084)          device hvc0 {\n(085)              speed 9600\n(086)          }\n(087)      }\n(088)      gateway-address 161.202.158.217\n(089)      host-name vyos\n(090)      login {\n(091)          user root {\n(092)              authentication {\n(093)                  encrypted-password xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n(096)                  plaintext-password \"\"\n(097)              }\n(098)              level admin\n(099)          }\n(100)          user vyos {\n(101)              authentication {\n(102)                  encrypted-password xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n(103)                  plaintext-password \"\"\n(104)              }\n(105)              level admin\n(106)          }\n(107)      }\n(108)      name-server 10.0.80.11\n(109)      ntp {\n(100)          server time.service.networklayer.com {\n(111)          }\n(112)      }\n(113)      package {\n(114)          auto-sync 1\n(115)          repository community {\n(116)              components main\n(117)              distribution helium\n(118)              password \"\"\n(119)              url http://packages.vyos.net/vyos\n(120)              username \"\"\n(121)          }\n(122)      }\n(123)      syslog {\n(124)          global {\n(125)              facility all {\n(126)                  level notice\n(127)              }\n(128)              facility protocols {\n(129)                  level debug\n(130)              }\n(131)          }\n(132)      }\n(133)      time-zone Asia/Tokyo\n(134)  }\n\n\nVRRP\u3068NAT\u306e\u7b87\u6240\u3092\u91cd\u70b9\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\n\u30fb(008)-(016):eth0\u306eVRRP\u8a2d\u5b9a\n\u30fb(009):\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u304c\u5c4a\u304f\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9(\u3053\u306e\u4f8b\u3067\u306f100)\n \u3000vyos02\u306eeth0\u3068\u540c\u3058\u30b0\u30eb\u30fc\u30d7\n\u30fb(010):\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u306eadvertise\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u9593\u9694(\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u5024)\n\u30fb(011):\u30c0\u30a6\u30f3\u3057\u305f\u30de\u30b9\u30bf\u30fc\u304c\u969c\u5bb3\u304b\u3089\u5fa9\u65e7\u3057\u305f\u969b\u3001\u3059\u3050\u306b\u81ea\u52d5\u3067\u30de\u30b9\u30bf\u30fc\u3078\u6607\u683c\u3059\u308b\u304b\u3092\n\u8a2d\u5b9a(\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3)(\u3053\u306e\u4f8b\u3067\u306ftrue:\u3059\u3050\u306b\u6607\u683c\u3057\u307e\u3059)\n\u30fb(013):\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eeth0/eth1\u306e\u3069\u3061\u3089\u304b\u304c\u30c0\u30a6\u30f3\u3057\u3066\u7247\u65b9\u304c\u751f\u304d\u6b8b\u3063\u305f\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3078\n\u5207\u308a\u66ff\u308f\u3089\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306beth0/eth1\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u7ba1\u7406\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u300ceth0/eth1\u300d\u3092\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u540d\u3067\u767b\u9332\u3057\u3066\u3044\u308b\uff09\n\u30fb(014):\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074(eth0)\u306eVRRP\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u3001VRRP\u306f\u30de\u30b9\u30bf\u30fc\u3068\u540c\u3058\u7269\u7406IP\u3092\u767b\u9332\u3067\u304d\u308b\u306e\u3067\u3001\u300c10.132.52.225\u300d\u3068\u3057\u305f\uff09\n\u30fb(024)-(032):eth1\u306eVRRP\u8a2d\u5b9a\n\u30fb(025):\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u304c\u5c4a\u304f\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9(\u3053\u306e\u4f8b\u3067\u306f200)\n \u3000vyos02\u306eeth1\u3068\u540c\u3058\u30b0\u30eb\u30fc\u30d7\n\u30fb(026):\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u306eadvertise\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u9593\u9694(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n\u30fb(027):\u30c0\u30a6\u30f3\u3057\u305f\u30de\u30b9\u30bf\u30fc\u304c\u969c\u5bb3\u304b\u3089\u5fa9\u65e7\u3057\u305f\u969b\u3001\u3059\u3050\u306b\u81ea\u52d5\u3067\u30de\u30b9\u30bf\u30fc\u3078\u6607\u683c\u3059\u308b\u304b\u3092\n\u8a2d\u5b9a(\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3)(\u3053\u306e\u4f8b\u3067\u306ftrue:\u3059\u3050\u306b\u6607\u683c\u3057\u307e\u3059)\n\u30fb(028):\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eeth0/eth1\u306e\u3069\u3061\u3089\u304b\u304c\u30c0\u30a6\u30f3\u3057\u3066\u7247\u65b9\u304c\u751f\u304d\u6b8b\u3063\u305f\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3078\n\u5207\u308a\u66ff\u308f\u3089\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306beth0/eth1\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u7ba1\u7406\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u300ceth0/eth1\u300d\u3092\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u540d\u3067\u767b\u9332\u3057\u3066\u3044\u308b\uff09\n\u30fb(030):\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074(eth0)\u306eVRRP\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u3001VRRP\u306f\u30de\u30b9\u30bf\u30fc\u3068\u540c\u3058\u7269\u7406IP\u3092\u767b\u9332\u3067\u304d\u308b\u306e\u3067\u3001\u300c161.202.158.218\u300d\u3068\u3057\u305f\uff09\n\u30fb(037)-(065):NAT\u8a2d\u5b9a\n\u78ba\u8a8d\u76ee\u7684\u306a\u306e\u3067\u3001\u7c21\u6613\u7684\u306a\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n\u30fb(038)-(052):destination NAT\u8a2d\u5b9a\n\u30d1\u30d6\u30ea\u30c3\u30afVRRP\u4eee\u60f3IP(161.202.158.218)\u306e\u30dd\u30fc\u30c880\u304b\u3089\u6765\u305f\u30d1\u30b1\u30c3\u30c8\u3092\u3001Web\u30b5\u30fc\u30d0\u30fc\u306eIP(10/132.52.226)\u306e\u30dd\u30fc\u30c880\u306b1\u5bfe1\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\u30fb(053)-(064):sourceNAT(\u30de\u30b9\u30ab\u30ec\u30fc\u30c9)\u8a2d\u5b9a\n\u4eca\u56de\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u69cb\u5185\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3092\u53c2\u7167\u3059\u308b\u60f3\u5b9a\u306a\u306e\u3067\u3001\u7279\u306b\u5fc5\u8981\u306a\u3044\u3002\n\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7(XXX)\u3092\u5165\u308c\u3066\u307e\u3059\u3002\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u5165\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\n\nVyOS02\u69cb\u6210\u4f8b\n(001)interfaces {\n(002)     ethernet eth0 {\n(003)         address 10.132.52.234/26\n(004)         duplex auto\n(005)         hw-id 06:e3:74:c6:aa:96\n(006)         smp_affinity auto\n(007)         speed auto\n(008)         vrrp {\n(009)             vrrp-group 100 {\n(010)              priority 240\n(011)                 sync-group syncgroup01\n(012)                 virtual-address 10.132.52.225\n(013)             }\n(014)         }\n(015)     }\n(016)     ethernet eth1 {\n(017)         address 161.202.158.221/29\n(018)         duplex auto\n(019)         hw-id 06:62:f3:35:0d:2a\n(020)         smp_affinity auto\n(021)         speed auto\n(022)         vrrp {\n(023)             vrrp-group 200 {\n(024)                 priority 240\n(025)                 sync-group syncgroup01\n(026)                 virtual-address 161.202.158.218\n(027)             }\n(028)         }\n(029)     }\n(030)     loopback lo {\n(031)     }\n(032) }\n(033) nat {\n(034)     destination {\n(035)         rule 200 {\n(036)             description \"1-to-1 NAT\"\n(037)             destination {\n(038)                 address 161.202.158.218\n(039)                 port 80\n(040)             }\n(041)             inbound-interface any\n(042)             protocol tcp\n(043)             translation {\n(044)                 address 10.132.52.226\n(045)                 port 80\n(046)             }\n(047)         }\n(048)     }\n(049)      source {\n(050)          rule 200 {\n(051)              description \" masquerade NAT\"\n(052)              outbound-interface eth1\n(053)              source {\n(054)                  address 10.132.52.192/26\n(055)              }\n(056)              translation {\n(057)                  address masquerade\n(058)              }\n(059)          }\n(060)      }\n(061) }\n(062) protocols {\n(063)     static {\n(064)         route 10.0.0.0/8 {\n(065)             next-hop 10.132.52.193 {\n(066)             }\n(067)         }\n(068)     }\n(069) }\n(070) service {\n(071)     ssh {\n(072)         port 22\n(073)     }\n(074) }\n(075) system {\n(076)     config-management {\n(077)         commit-revisions 20\n(078)     }\n(079)     console {\n(080)         device hvc0 {\n(081)             speed 9600\n(082)         }\n(083)     }\n(084)     gateway-address 161.202.158.217\n(085)     host-name vyos\n(086)     login {\n(087)         user vyos {\n(088)             authentication {\n(089)                 encrypted-password xxxxxxxxxxxxxxxxxxxx(090)                 plaintext-password \"\"\n(091)             }\n(092)             level admin\n(093)         }\n(094)     }\n(095)     name-server 10.0.80.11\n(096)     ntp {\n(097)         server time.service.networklayer.com {\n(098)         }\n(099)     }\n(100)     package {\n(101)         auto-sync 1\n(102)         repository community {\n(103)             components main\n(104)             distribution helium\n(105)             password \"\"\n(106)             url http://packages.vyos.net/vyos\n(107)             username \"\"\n(108)         }\n(109)     }\n(100)     syslog {\n(111)         global {\n(112)             facility all {\n(113)                 level notice\n(114)             }\n(115)             facility protocols {\n(116)                 level debug\n(117)             }\n(118)         }\n(119)     }\n(120)     time-zone Asia/Tokyo\n(121) }\n\n\n\n4. \u52d5\u4f5c\u78ba\u8a8d\n\n4-1. vyos01\u3092\u30ea\u30d6\u30fc\u30c8\u3057\u3001vyos02\u304c\u30de\u30b9\u30bf\u30fc\u306b\u6607\u683c\u3059\u308b\u304b\u3092\u78ba\u8a8d\n\n\u521d\u671f\u72b6\u614b\u3000vyos01\u306fMASTERr\u3001vyos02\u306fBACKUP\u3092\u78ba\u8a8d\n\nvyos01\u3092\u30ea\u30d6\u30fc\u30c8\n\nvyos02\u304cBACKUP\u304b\u3089MASTER\u3078\u6607\u683c\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\nvyos01\u304c\u6b63\u5e38\u8d77\u52d5\u5f8c\n\n\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9(preempt true)\u306e\u305f\u3081\u3001vyos01\u8d77\u52d5\u5f8c\u306bMASTER\u306b\u306a\u308a\u3001vyos02\u304cBACKUP\u306b\u79fb\u884c\u3057\u3066\u3044\u308b\u3002\n\n4-2. vyos01\u306eeth0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u3055\u305b\u3001vyos02\u304c\u30de\u30b9\u30bf\u30fc\u306b\u6607\u683c\u3059\u308b\u304b\u3092\u78ba\u8a8d\nSoftLayer\u30dd\u30fc\u30bf\u30eb\u3088\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306e\u8a73\u7d30\u753b\u9762\u3067eth0\u3092\u5207\u65ad\u3059\u308b\n\n\nvyos01\u306eeth0/eth1\u72b6\u614b\u304c\u4e21\u65b9\u3068\u3082FAULT\u306b\u306a\u308a\u3001eth0/eth1\u306e\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u3067FAULT\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\u540c\u6642\u306bvyos02\u304cMASTER\u306b\u6607\u683c\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n4-3. vyos01\u306e\u96fb\u6e90\u3092\u30aa\u30d5\u306b\u3057\u3001Web\u753b\u9762\u3092\u78ba\u8a8d\u3002\n\u307e\u305a\u306fWeb\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001HTML\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\nSoftLayer\u30dd\u30fc\u30bf\u30eb\u3088\u308a\u3001vyos01\u96fb\u6e90\u30aa\u30d5\n\nvyos02\u304cMASTER\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3001Web\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\n\n\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n5. \u304a\u308f\u308a\u306b\nVRRP\u306e\u72b6\u614b\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\u306f $ show vrry \u3092\u306f\u3058\u3081\u8272\u3005\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u662f\u975e\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89b3\u70b9\u3088\u308a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u304b\u3051\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n# set interfaces ethernet eth0 vrrp vrr-group 100 authentication password xxxx \u23ce\n# set interfaces ethernet eth0 vrrp vrr-group 100 authentication type plaintext-password \u23ce\n\n\n\u4eca\u56de\u3001VyOS\u306e\u5197\u9577\u5316\u6a5f\u80fd\u3092\u52c9\u5f37\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306bVPN\uff0dLAN\u9593\u63a5\u7d9a\u3084\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u304c\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n# 1. \u306f\u3058\u3081\u306b\n  SoftLayer\u306e\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u3068VyOS\u3092\u4f7f\u3063\u3066VPN-LAN\u9593\u63a5\u7d9a\u3001\u30ea\u30e2\u30fc\u30c8\u30a2\u30af\u30bb\u30b9\u63a5\u7d9a\u3092\u69cb\u7bc9\u30b1\u30fc\u30b9\u304c\u3042\u308a\u307e\u3059\u3002\n  SoftLayer\u3067\u306f\u3001<font color=\"blue\">\u5197\u9577\u5316\u69cb\u6210\u304c\u7d44\u3081\u308b\u300c\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u30a2\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u300d(Vyatta6.x)</font>\u3092\u63d0\u4f9b\u3057\u3066\u3044\u308b\u306e\u3067\u69cb\u7bc9\u304c\u53ef\u80fd\u3067\u3059\u304c\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u57fa\u76e4\u306e\u305f\u3081\u6570\u53f0\u306e\u30b5\u30fc\u30d0\u30fc\u5229\u7528\u3067\u306f\u5168\u4f53\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u8003\u3048\u305f\u5834\u5408\u3001<font color=\"red\">\u8cbb\u7528\u9762\u306e\u30cf\u30fc\u30c9\u30eb\u304c\u9ad8\u304f</font>\u306a\u308b\u3067\u3057\u3087\u3046\u3002\n  \u307e\u305f\u3001\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306bVyOS\u3092\u5c0e\u5165\u3057\u305f\u5834\u5408\u3001<font color=\"red\">\u30b9\u30bf\u30f3\u30c0\u30fc\u30c9\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u3082\u3069\u3059\u3053\u3068\u304c\u3067\u304d\u305a</font>\u3001\u6545\u969c\u306e\u969b\u306e\u5fa9\u65e7\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n  \u4eca\u56de\u306f\u8010\u969c\u5bb3\u6027\u3092\u8003\u616e\u3057\u3064\u3064\u3001\u30b3\u30b9\u30c8\u3092\u5c11\u306a\u304f\u3059\u308b\u4e8b\u3092\u76ee\u7684\u306b\u3001<font color=\"blue\">\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc\u306bVyOS\u3092\u5c0e\u5165\u3057VRRP\u3067\u5197\u9577\u5316\u69cb\u6210\u306e\u53ef\u80fd\u6027\u3092\u30c6\u30b9\u30c8</font>\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001<strong><font color=\"blue\">VyOS\u3067VRRP\u69cb\u6210\u306e\u57fa\u672c</font></strong>\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\n \n# 2. VRRP\u306b\u3064\u3044\u3066\n<strong><font color=\"blue\">(VRRP:Virtual Router Redundancy Protocol)</font></strong>\nVRRP\u306f\u3001<font color=\"blue\">\u7269\u7406\u7684\u306b\u306f\u8907\u6570\u53f0\u3042\u308b\u30eb\u30fc\u30bf\u3092\u4eee\u60f3\u7684\u306b1\u53f0\u306e\u30eb\u30fc\u30bf\u306b\u898b\u305b\u308b</font>\u3053\u3068\u304c\u3067\u304d\u308b\u6280\u8853\u3067\u3059\u3002\n \u30eb\u30fc\u30bf\u306a\u3069\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u6a5f\u5668\u306e \u5197\u9577\u5316\u69cb\u6210\u3092\u69cb\u7bc9\u3059\u308b\u969b\u306e\u6a5f\u80fd\u3067\u3001RFC5798\u3067\u6a19\u6e96\u5316\u3055\u308c\u3066\u307e\u3059\u3002\n\n \u30b7\u30b9\u30b3\u793e\u306e<font color=\"green\">HSRP(Hot Standby Routing Protocol)</font>\u3082\u57fa\u672c\u7684\u306b\u306f\u540c\u3058\u6a5f\u80fd\u3067\u3059\u304c\u3001\nVRRP\u306e\u5834\u5408\u306f\u3001\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u306b\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u306e\u7269\u7406IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\nSoftLayer\u3067VRRP\u7528\u306e\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3092\u5165\u624b\u3059\u308b\u306b\u306f\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30aa\u30fc\u30c0\u30fc\u6642\u306b\u3064\u3044\u3066\u304f\u308b\u30d7\u30e9\u30a4\u30de\u30ea\u30fcIP\u30a2\u30c9\u30ec\u30b9\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u5c06\u6765\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306e<font color=\"red\">\u4e88\u7d04IP</font>\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u304a\u52e7\u3081\u3057\u307e\u305b\u3093\u3002\n>\u3061\u306a\u307f\u306b\u3001SoftLayer\u3067\u6709\u511f\u7248\u306eVytta\u3092HA\u69cb\u6210\u3067\u30aa\u30fc\u30c0\u30fc\u3059\u308b\u3068\u3001\u4eee\u60f3IP\u306f\u4e88\u7d04\u6e08\u307f\u3068\u306a\u308a\u307e\u3059\u306e\u3067\u3001\u4e0a\u8a18\u306e\u3088\u3046\u306a\u5fc3\u914d\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n>\n\n\u307e\u305f\u3001\u30dd\u30fc\u30bf\u30d6\u30ebIP\u3067\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u304c\u3046\u307e\u304f\u3044\u304b\u305a\u3001\u901a\u4fe1\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\uff08\u53c2\u8003\u307e\u3067\uff1a\u30d1\u30d6\u30ea\u30c3\u30af\u30dd\u30fc\u30bf\u30d6\u30ebIP\u306f16\u30dd\u30fc\u30c8\u6708\u984d$32\u3067\u3059\u3002\uff09\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306f<font color=\"blue\">VRRP\u3067\u53ef\u80fd\u306a\u3001\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u306b\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u306e\u7269\u7406IP\u30a2\u30c9\u30ec\u30b9\u3092\u6307\u5b9a\u3057\u307e\u3057\u305f\u3002</font>\n\n \n VRRP\u306f\u8907\u6570\u53f0\u306e\u30eb\u30fc\u30bf(\u8907\u6570\u53f0\u306eVyOS)\u3067\u30b0\u30eb\u30fc\u30d7\u3092\u7d44\u307f\u3001VRRP\u4eee\u60f3IP\u3092\u5171\u6709\u3057\u307e\u3059\u3002\n \u5404\u30eb\u30fc\u30bf\u306f<font color=\"blue\">\u300c\u30de\u30b9\u30bf\u30fc(1\u53f0)\u300d</font>\u3068<font color=\"blue\">\u300c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300d</font>\u306e\u5f79\u5272\u306b\u5206\u304b\u308c\u3001<font color=\"blue\">\u30d7\u30e9\u30a4\u30aa\u30ea\u30c6\u30a3\u5024\u306e\u5927\u304d\u306a\u30eb\u30fc\u30bf\u304c\u300c\u30de\u30b9\u30bf\u30fc\u300d</font>\u3068\u306a\u308a\u307e\u3059\u3002\n <strong><font color=\"blue\">\u30fb\u30de\u30b9\u30bf\u30fc\n \u30fb\u30d0\u30c3\u30af\u30a2\u30c3\u30d7</font></strong>\n \n \u300c\u30de\u30b9\u30bf\u30fc\u300d\u304c\u30c0\u30a6\u30f3\u3057\u305f\u969b\u306f\u3001\u81ea\u52d5\u3067\u300c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u300d\u304c\u300c\u65b0\u30de\u30b9\u30bf\u30fc\u300d\u306b\u6607\u683c\u3057\u307e\u3059\u3002\n \n \u307e\u305f\u3001\u30c0\u30a6\u30f3\u3057\u305f\u300c\u65e7\u30de\u30b9\u30bf\u30fc\u300d\u304c\u5fa9\u65e7\u3057\u305f\u5834\u5408\u306e\u5207\u308a\u623b\u3057\u306b\u306f\uff12\u3064\u306e\u65b9\u6cd5\u304c\u3042\u308a\u307e\u3059\u3002\n<font color=\"blue\"> \u30fb\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u6709\u52b9---\u300c\u65e7\u30de\u30b9\u30bf\u30fc\u300d\u304c\u3059\u3050\u306b\u300c\u30de\u30b9\u30bf\u30fc\u300d\u3078\u6607\u683c\n \u30fb\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u7121\u52b9---\u300c\u30de\u30b9\u30bf\u30fc\u300d\u306e\u5207\u308a\u623b\u3057\u306f\u884c\u308f\u306a\u3044</font>\n <font color=\"green\">\u203b\u901a\u4fe1\u63a5\u7d9a\u72b6\u6cc1\u3092\u8003\u616e\u3057\u3001\u81ea\u52d5\u7684\u306b\u5207\u308a\u623b\u3057\u3092\u884c\u308f\u306a\u3044\u3000\u201d\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u7121\u52b9\u201d\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</font>\n \n# \uff13. \u69cb\u6210\u306b\u3064\u3044\u3066\n>VyOS\u3078\u306e\u5165\u308c\u66ff\u3048\u306f\u7701\u7565\u3044\u305f\u3057\u307e\u3059\u3002\n \u300cSoftLayer\u4eee\u60f3\u30b5\u30fc\u30d0\u306bVyOS\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u300d\u306e\u300c9. \u2466 VyOS\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306e\u8a2d\u5b9a\u300d\u3092\u3054\u89a7\u304f\u3060\u3055\u3044\u3002\nhttp://qiita.com/Mitsu-Murakita/items/d793250566a8e9f3562baa\n>\n\n## \uff13-1. \u5168\u4f53\u69cb\u6210\n\nSoftLayer\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30923\u53f0\u30aa\u30fc\u30c0\u30fc\u3057\u307e\u3057\u305f\u3002\n<strong>\u30fbVyOS01 ------- VyOS\u30de\u30b9\u30bf\u30fc\u30eb\u30fc\u30bf\u30fc\n\u30fbVyOS02 ------- VyOS\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30eb\u30fc\u30bf\u30fc\n\u30fbWWWCent6 --- \u78ba\u8a8d\u7528Web\u30b5\u30fc\u30d0\u30fc</strong>\n\n![01.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/01.png)\n\n \u30fbVyOS01\u306ePriority\u3092250\u3001VyOS02\u306ePriority\u3092200\u306b\u3057\u307e\u3057\u305f\u306e\u3067\u3001<strong>VyOS01\u304c\u30de\u30b9\u30bf\u30fc</strong>\u3001<strong>VyOS02\u304c\u30d0\u30c3\u30af\u30a2\u30c3\u30d7</strong>\u306b\u306a\u308a\u307e\u3059\u3002\n \u30fb<strong>VRRP\u4eee\u60f3PublicIP</strong>\u306fVyOS01\u306eeth1(161.202.158.218)\u3001<strong>VRRP\u4eee\u60f3PrivateIP</strong>\u306fVyOS01\u306eeth0(10.132.52.225)\u3067\u3059\u3002\n\u30fbVyOS01/VyOS02\u306e<strong>eth1\u3092Group200</strong>\u3001<strong>eth0\u3092Group100</strong>\u3068\u3057\u307e\u3057\u305f\u3002\n\u30b0\u30eb\u30fc\u30d7\u306f\u3001\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u30d1\u30b1\u30c3\u30c8\u304c\u3069\u306e\u30b0\u30eb\u30fc\u30d7\u306b\u5c5e\u3059\u308b\u304b\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\n\u30fb\u78ba\u8a8d\u7528\u306eWeb\u30b5\u30fc\u30d0\u30fc(WWWCent6)\u306e<font color=\"blue\">\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306f\u3001VRRP\u4eee\u60f3PrivateIP(10.132.52.225)</font>\u3067\u3059\u3002\n\n![02.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/02.png)\n\n## \uff13-2. VyOS\u69cb\u6210\n <font color=\"green\">\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7(XXX)\u3092\u5165\u308c\u3066\u307e\u3059\u3002\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u5165\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002</font>\n\n```Command:VyOS01\u69cb\u6210\u4f8b\n(001) interfaces {\n(002)      ethernet eth0 {\n(003)          address 10.132.52.225/26\n(004)          duplex auto\n(005)          hw-id 06:98:ae:8a:24:ac\n(006)          smp_affinity auto\n(007)          speed auto\n(008)          vrrp {\n(009)              vrrp-group 100 {\n(010)                  advertise-interval 1\n(011)                  preempt true\n(012)                  priority 250\n(013)                  sync-group syncgroup01\n(014)                  virtual-address 10.132.52.225\n(015)              }\n(016)          }\n(017)      }\n(018)      ethernet eth1 {\n(019)          address 161.202.158.218/29\n(020)          duplex auto\n(021)          hw-id 06:26:c9:26:4f:4d\n(022)          smp_affinity auto\n(023)          speed auto\n(024)          vrrp {\n(025)              vrrp-group 200 {\n(026)                  advertise-interval 1\n(027)                  preempt true\n(028)                  priority 250\n(029)                  sync-group syncgroup01\n(030)                  virtual-address 161.202.158.218\n(031)              }\n(032)          }\n(033)      }\n(034)      loopback lo {\n(035)      }\n(036)  }\n(037)  nat {\n(038)      destination {\n(039)          rule 200 {\n(040)              description \"1-to-1 NAT\"\n(041)              destination {\n(042)                  address 161.202.158.218\n(043)                  port 80\n(044)              }\n(045)              inbound-interface any\n(046)              protocol tcp\n(047)              translation {\n(048)                  address 10.132.52.226\n(049)                  port 80\n(050)              }\n(051)          }\n(052)      }\n(053)      source {\n(054)          rule 200 {\n(055)              description \" masquerade NAT\"\n(056)              outbound-interface eth1\n(057)              source {\n(058)                  address 10.132.52.192/26\n(059)              }\n(060)              translation {\n(061)                  address masquerade\n(062)              }\n(063)          }\n(064)      }\n(065)  }\n(066)  protocols {\n(067)      static {\n(068)          route 10.0.0.0/8 {\n(069)              next-hop 10.132.52.193 {\n(070)              }\n(071)          }\n(072)      }\n(073)  }\n(074)  service {\n(075)      ssh {\n(076)          port 22\n(077)      }\n(078)  }\n(079)  system {\n(080)      config-management {\n(081)          commit-revisions 20\n(082)      }\n(083)      console {\n(084)          device hvc0 {\n(085)              speed 9600\n(086)          }\n(087)      }\n(088)      gateway-address 161.202.158.217\n(089)      host-name vyos\n(090)      login {\n(091)          user root {\n(092)              authentication {\n(093)                  encrypted-password xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n(096)                  plaintext-password \"\"\n(097)              }\n(098)              level admin\n(099)          }\n(100)          user vyos {\n(101)              authentication {\n(102)                  encrypted-password xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n(103)                  plaintext-password \"\"\n(104)              }\n(105)              level admin\n(106)          }\n(107)      }\n(108)      name-server 10.0.80.11\n(109)      ntp {\n(100)          server time.service.networklayer.com {\n(111)          }\n(112)      }\n(113)      package {\n(114)          auto-sync 1\n(115)          repository community {\n(116)              components main\n(117)              distribution helium\n(118)              password \"\"\n(119)              url http://packages.vyos.net/vyos\n(120)              username \"\"\n(121)          }\n(122)      }\n(123)      syslog {\n(124)          global {\n(125)              facility all {\n(126)                  level notice\n(127)              }\n(128)              facility protocols {\n(129)                  level debug\n(130)              }\n(131)          }\n(132)      }\n(133)      time-zone Asia/Tokyo\n(134)  }\n``` \nVRRP\u3068NAT\u306e\u7b87\u6240\u3092\u91cd\u70b9\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\n<font color=\"blue\">\u30fb(008)-(016):</font>eth0\u306eVRRP\u8a2d\u5b9a\n<font color=\"blue\">\u30fb(009):</font>\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u304c\u5c4a\u304f\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9(\u3053\u306e\u4f8b\u3067\u306f100)\n \u3000vyos02\u306eeth0\u3068\u540c\u3058\u30b0\u30eb\u30fc\u30d7\n<font color=\"blue\">\u30fb(010):</font>\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u306eadvertise\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u9593\u9694(\u30c7\u30a3\u30d5\u30a9\u30eb\u30c8\u5024)\n<font color=\"blue\">\u30fb(011):</font>\u30c0\u30a6\u30f3\u3057\u305f\u30de\u30b9\u30bf\u30fc\u304c\u969c\u5bb3\u304b\u3089\u5fa9\u65e7\u3057\u305f\u969b\u3001\u3059\u3050\u306b\u81ea\u52d5\u3067\u30de\u30b9\u30bf\u30fc\u3078\u6607\u683c\u3059\u308b\u304b\u3092\n\u8a2d\u5b9a(\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3)(\u3053\u306e\u4f8b\u3067\u306ftrue:\u3059\u3050\u306b\u6607\u683c\u3057\u307e\u3059)\n<font color=\"blue\">\u30fb(013):</font>\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eeth0/eth1\u306e\u3069\u3061\u3089\u304b\u304c\u30c0\u30a6\u30f3\u3057\u3066\u7247\u65b9\u304c\u751f\u304d\u6b8b\u3063\u305f\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3078\n\u5207\u308a\u66ff\u308f\u3089\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306beth0/eth1\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u7ba1\u7406\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u300ceth0/eth1\u300d\u3092\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u540d\u3067\u767b\u9332\u3057\u3066\u3044\u308b\uff09\n<font color=\"blue\">\u30fb(014):</font>\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074(eth0)\u306eVRRP\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u3001VRRP\u306f\u30de\u30b9\u30bf\u30fc\u3068\u540c\u3058\u7269\u7406IP\u3092\u767b\u9332\u3067\u304d\u308b\u306e\u3067\u3001\u300c10.132.52.225\u300d\u3068\u3057\u305f\uff09\n\n<font color=\"blue\">\u30fb(024)-(032):</font>eth1\u306eVRRP\u8a2d\u5b9a\n<font color=\"blue\">\u30fb(025):</font>\u30de\u30eb\u30c1\u30ad\u30e3\u30b9\u30c8\u304c\u5c4a\u304f\u30b0\u30eb\u30fc\u30d7\u3092\u5b9a\u7fa9(\u3053\u306e\u4f8b\u3067\u306f200)\n \u3000vyos02\u306eeth1\u3068\u540c\u3058\u30b0\u30eb\u30fc\u30d7\n<font color=\"blue\">\u30fb(026):</font>\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u306eadvertise\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u9593\u9694(\u30c7\u30d5\u30a9\u30eb\u30c8\u5024)\n<font color=\"blue\">\u30fb(027):</font>\u30c0\u30a6\u30f3\u3057\u305f\u30de\u30b9\u30bf\u30fc\u304c\u969c\u5bb3\u304b\u3089\u5fa9\u65e7\u3057\u305f\u969b\u3001\u3059\u3050\u306b\u81ea\u52d5\u3067\u30de\u30b9\u30bf\u30fc\u3078\u6607\u683c\u3059\u308b\u304b\u3092\n\u8a2d\u5b9a(\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3)(\u3053\u306e\u4f8b\u3067\u306ftrue:\u3059\u3050\u306b\u6607\u683c\u3057\u307e\u3059)\n<font color=\"blue\">\u30fb(028):</font>\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eeth0/eth1\u306e\u3069\u3061\u3089\u304b\u304c\u30c0\u30a6\u30f3\u3057\u3066\u7247\u65b9\u304c\u751f\u304d\u6b8b\u3063\u305f\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3078\n\u5207\u308a\u66ff\u308f\u3089\u306a\u3044\u30b1\u30fc\u30b9\u304c\u3042\u308b\u3002\u3053\u308c\u3092\u9632\u3050\u305f\u3081\u306beth0/eth1\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u7ba1\u7406\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u300ceth0/eth1\u300d\u3092\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u540d\u3067\u767b\u9332\u3057\u3066\u3044\u308b\uff09\n<font color=\"blue\">\u30fb(030):</font>\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5074(eth0)\u306eVRRP\u4eee\u60f3IP\u30a2\u30c9\u30ec\u30b9\u3002\n\uff08\u3053\u306e\u4f8b\u3067\u306f\u3001VRRP\u306f\u30de\u30b9\u30bf\u30fc\u3068\u540c\u3058\u7269\u7406IP\u3092\u767b\u9332\u3067\u304d\u308b\u306e\u3067\u3001\u300c161.202.158.218\u300d\u3068\u3057\u305f\uff09\n\n<font color=\"blue\">\u30fb(037)-(065):</font>NAT\u8a2d\u5b9a\n\u78ba\u8a8d\u76ee\u7684\u306a\u306e\u3067\u3001\u7c21\u6613\u7684\u306a\u8a2d\u5b9a\u306b\u306a\u3063\u3066\u307e\u3059\u3002\n<font color=\"blue\">\u30fb(038)-(052):</font>destination NAT\u8a2d\u5b9a\n\u30d1\u30d6\u30ea\u30c3\u30afVRRP\u4eee\u60f3IP(161.202.158.218)\u306e\u30dd\u30fc\u30c880\u304b\u3089\u6765\u305f\u30d1\u30b1\u30c3\u30c8\u3092\u3001Web\u30b5\u30fc\u30d0\u30fc\u306eIP(10/132.52.226)\u306e\u30dd\u30fc\u30c880\u306b1\u5bfe1\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\n<font color=\"blue\">\u30fb(053)-(064):</font>sourceNAT(\u30de\u30b9\u30ab\u30ec\u30fc\u30c9)\u8a2d\u5b9a\n\u4eca\u56de\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u69cb\u5185\u306eWeb\u30b5\u30fc\u30d0\u30fc\u3092\u53c2\u7167\u3059\u308b\u60f3\u5b9a\u306a\u306e\u3067\u3001\u7279\u306b\u5fc5\u8981\u306a\u3044\u3002\n \n \n \n  <font color=\"green\">\u8aac\u660e\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u884c\u756a\u53f7(XXX)\u3092\u5165\u308c\u3066\u307e\u3059\u3002\u5b9f\u969b\u306b\u5165\u529b\u3059\u308b\u969b\u306f\u5165\u308c\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002</font>\n  \n```Command:VyOS02\u69cb\u6210\u4f8b\n(001)interfaces {\n(002)     ethernet eth0 {\n(003)         address 10.132.52.234/26\n(004)         duplex auto\n(005)         hw-id 06:e3:74:c6:aa:96\n(006)         smp_affinity auto\n(007)         speed auto\n(008)         vrrp {\n(009)             vrrp-group 100 {\n(010)              priority 240\n(011)                 sync-group syncgroup01\n(012)                 virtual-address 10.132.52.225\n(013)             }\n(014)         }\n(015)     }\n(016)     ethernet eth1 {\n(017)         address 161.202.158.221/29\n(018)         duplex auto\n(019)         hw-id 06:62:f3:35:0d:2a\n(020)         smp_affinity auto\n(021)         speed auto\n(022)         vrrp {\n(023)             vrrp-group 200 {\n(024)                 priority 240\n(025)                 sync-group syncgroup01\n(026)                 virtual-address 161.202.158.218\n(027)             }\n(028)         }\n(029)     }\n(030)     loopback lo {\n(031)     }\n(032) }\n(033) nat {\n(034)     destination {\n(035)         rule 200 {\n(036)             description \"1-to-1 NAT\"\n(037)             destination {\n(038)                 address 161.202.158.218\n(039)                 port 80\n(040)             }\n(041)             inbound-interface any\n(042)             protocol tcp\n(043)             translation {\n(044)                 address 10.132.52.226\n(045)                 port 80\n(046)             }\n(047)         }\n(048)     }\n(049)      source {\n(050)          rule 200 {\n(051)              description \" masquerade NAT\"\n(052)              outbound-interface eth1\n(053)              source {\n(054)                  address 10.132.52.192/26\n(055)              }\n(056)              translation {\n(057)                  address masquerade\n(058)              }\n(059)          }\n(060)      }\n(061) }\n(062) protocols {\n(063)     static {\n(064)         route 10.0.0.0/8 {\n(065)             next-hop 10.132.52.193 {\n(066)             }\n(067)         }\n(068)     }\n(069) }\n(070) service {\n(071)     ssh {\n(072)         port 22\n(073)     }\n(074) }\n(075) system {\n(076)     config-management {\n(077)         commit-revisions 20\n(078)     }\n(079)     console {\n(080)         device hvc0 {\n(081)             speed 9600\n(082)         }\n(083)     }\n(084)     gateway-address 161.202.158.217\n(085)     host-name vyos\n(086)     login {\n(087)         user vyos {\n(088)             authentication {\n(089)                 encrypted-password xxxxxxxxxxxxxxxxxxxx(090)                 plaintext-password \"\"\n(091)             }\n(092)             level admin\n(093)         }\n(094)     }\n(095)     name-server 10.0.80.11\n(096)     ntp {\n(097)         server time.service.networklayer.com {\n(098)         }\n(099)     }\n(100)     package {\n(101)         auto-sync 1\n(102)         repository community {\n(103)             components main\n(104)             distribution helium\n(105)             password \"\"\n(106)             url http://packages.vyos.net/vyos\n(107)             username \"\"\n(108)         }\n(109)     }\n(100)     syslog {\n(111)         global {\n(112)             facility all {\n(113)                 level notice\n(114)             }\n(115)             facility protocols {\n(116)                 level debug\n(117)             }\n(118)         }\n(119)     }\n(120)     time-zone Asia/Tokyo\n(121) }\n``` \n\n# 4. \u52d5\u4f5c\u78ba\u8a8d\n## 4-1. vyos01\u3092\u30ea\u30d6\u30fc\u30c8\u3057\u3001vyos02\u304c\u30de\u30b9\u30bf\u30fc\u306b\u6607\u683c\u3059\u308b\u304b\u3092\u78ba\u8a8d\n\n![03.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/03.png)\n\u521d\u671f\u72b6\u614b\u3000vyos01\u306fMASTERr\u3001vyos02\u306fBACKUP\u3092\u78ba\u8a8d\n\n![04.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/04.png)\nvyos01\u3092\u30ea\u30d6\u30fc\u30c8\n\n![05.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/05.png)\nvyos02\u304cBACKUP\u304b\u3089MASTER\u3078\u6607\u683c\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\nvyos01\u304c\u6b63\u5e38\u8d77\u52d5\u5f8c\n![06.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/06.png)\n\u30d7\u30ea\u30a8\u30f3\u30d7\u30b7\u30e7\u30f3\u304c\u6709\u52b9(preempt true)\u306e\u305f\u3081\u3001vyos01\u8d77\u52d5\u5f8c\u306bMASTER\u306b\u306a\u308a\u3001vyos02\u304cBACKUP\u306b\u79fb\u884c\u3057\u3066\u3044\u308b\u3002\n\n## 4-2. vyos01\u306eeth0\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u30c0\u30a6\u30f3\u3055\u305b\u3001vyos02\u304c\u30de\u30b9\u30bf\u30fc\u306b\u6607\u683c\u3059\u308b\u304b\u3092\u78ba\u8a8d\nSoftLayer\u30dd\u30fc\u30bf\u30eb\u3088\u308a\u3001\u30c7\u30d0\u30a4\u30b9\u306e\u8a73\u7d30\u753b\u9762\u3067eth0\u3092\u5207\u65ad\u3059\u308b\n![07.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/07.png)\n\n![08.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/08.png)\nvyos01\u306eeth0/eth1\u72b6\u614b\u304c\u4e21\u65b9\u3068\u3082FAULT\u306b\u306a\u308a\u3001eth0/eth1\u306e\u300csysncgroup01\u300d\u3068\u3044\u3046\u30b0\u30eb\u30fc\u30d7\u3067FAULT\u306b\u306a\u3063\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\u540c\u6642\u306bvyos02\u304cMASTER\u306b\u6607\u683c\u3057\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3002\n\n## 4-3. vyos01\u306e\u96fb\u6e90\u3092\u30aa\u30d5\u306b\u3057\u3001Web\u753b\u9762\u3092\u78ba\u8a8d\u3002\n\u307e\u305a\u306fWeb\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001HTML\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3002\n![10.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/10.png)\n\nSoftLayer\u30dd\u30fc\u30bf\u30eb\u3088\u308a\u3001vyos01\u96fb\u6e90\u30aa\u30d5\n![11.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/11.png)\n\nvyos02\u304cMASTER\u306b\u306a\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3001Web\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\n![12.png](http://www.seahorse-inc.com/QIITA/VyOS-HA-1/12.png)\n\u6b63\u5e38\u306b\u8868\u793a\u3055\u308c\u307e\u3057\u305f\u3002\n\n# 5. \u304a\u308f\u308a\u306b\nVRRP\u306e\u72b6\u614b\u78ba\u8a8d\u30b3\u30de\u30f3\u30c9\u306f $ show vrry \u3092\u306f\u3058\u3081\u8272\u3005\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u662f\u975e\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u306e\u89b3\u70b9\u3088\u308a\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u304b\u3051\u308b\u4e8b\u304c\u3067\u304d\u307e\u3059\u3002\n\n```Command:\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\n# set interfaces ethernet eth0 vrrp vrr-group 100 authentication password xxxx \u23ce\n# set interfaces ethernet eth0 vrrp vrr-group 100 authentication type plaintext-password \u23ce\n``` \n\n\u4eca\u56de\u3001VyOS\u306e\u5197\u9577\u5316\u6a5f\u80fd\u3092\u52c9\u5f37\u3057\u307e\u3057\u305f\u304c\u3001\u5b9f\u969b\u306bVPN\uff0dLAN\u9593\u63a5\u7d9a\u3084\u30ea\u30e2\u30fc\u30c8\u63a5\u7d9a\u304c\u3067\u304d\u308b\u304b\u30c6\u30b9\u30c8\u3059\u308b\u4e88\u5b9a\u3067\u3059\u3002\n", "tags": ["SoftLayer", "VyOS", "\u5197\u9577\u5316", "vyatta", "\u4eee\u60f3\u30b5\u30fc\u30d0\u30fc"]}