{"context": " More than 1 year has passed since last update.\n\n\u69cb\u6210\u56f3\n\n\nbr\u306e\u4f5c\u6210\n# ovs-vsctl add-br br1\n# ovs-vsctl add-br br0\n\n\nbonding\u306e\u4f5c\u6210\n\u3064\u3044\u3067\u306bLAPC\u3082on\n\novs-vsctl add-bond br0 bond0 e0 e1 lacp=active\n\novs-vsctl add-bond br1 bond1 e2 e3 lacp=active\n\n\n\npatch(ovs\u9593\u30ea\u30f3\u30af)\u306e\u8a2d\u5b9a\n\u3053\u3053\u3067\u306fpatch\u3067\u3084\u3063\u3066\u3044\u308b\u304cveth\u3067\u3082\u3067\u304d\u308b\u306f\u305a\n# ovs-vsctl set interface e0 type=patch options:peer=e2\n# ovs-vsctl set interface e2 type=patch options:peer=e0\n# ovs-vsctl set interface e3 type=patch options:peer=e1\n# ovs-vsctl set interface e1 type=patch options:peer=e3\n\n\n\u7269\u7406\u30ea\u30f3\u30af\u306e\u78ba\u8a8d\n\u5168\u3066UP\u3092\u78ba\u8a8d\n\novs-vsctl get interface e0 link_state\n\nup\n\novs-vsctl get interface e1 link_state\n\nup\n\novs-vsctl get interface e2 link_state\n\nup\n\novs-vsctl get interface e3 link_state\n\nup\n\n\nbond\u306bLACP\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n# ovs-vsctl get port bond0 lacp\nactive\n# ovs-vsctl get port bond1 lacp\nactive\n\n\nLACP Status\u306e\u78ba\u8a8d\n# ovs-vsctl get interface e0 lacp_current\ntrue\n# ovs-vsctl get interface e1 lacp_current\ntrue\n# ovs-vsctl get interface e2 lacp_current\ntrue\n# ovs-vsctl get interface e3 lacp_current\ntrue\n# ovs-appctl bond/show bond0\n---- bond0 ----\nbond_mode: active-backup\nbond-hash-basis: 0\nupdelay: 0 ms\ndowndelay: 0 ms\nlacp_status: negotiated\n\nslave e0: enabled\n        may_enable: true\n\nslave e1: enabled\n        active slave\n        may_enable: true\n\n# ovs-appctl bond/show bond1\n---- bond1 ----\nbond_mode: active-backup\nbond-hash-basis: 0\nupdelay: 0 ms\ndowndelay: 0 ms\nlacp_status: negotiated\n\nslave e2: enabled\n        may_enable: true\n\nslave e3: enabled\n        active slave\n        may_enable: true\n\n\n\u5927\u4e8b\u306a\u78ba\u8a8d\n\u63a5\u7d9a\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540c\u58eb(e0\u3068e2\u3001e1\u3068e3)\u3067\u3001system_id\u304c\u898b\u3048\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\nactor\u304c\u81ea\u5206\u3001partner\u304c\u5bfe\u5411\u306e\u60c5\u5831\n\n\novs-appctl lacp/show bond0\n\n---- bond0 ----\n        status: active negotiated\n        sys_id: 86:7a:09:01:35:42\n        sys_priority: 65534\n        aggregation key: 1\n        lacp_time: slow\n\nslave: e0: current attached\n        port_id: 1\n        port_priority: 65535\n        may_enable: true\n\n    actor sys_id: 86:7a:09:01:35:42\n    actor sys_priority: 65534\n    actor port_id: 1\n    actor port_priority: 65535\n    actor key: 1\n    actor state: activity aggregation synchronized collecting distributing\n\n    partner sys_id: a2:40:97:2e:d6:44\n    partner sys_priority: 65534\n    partner port_id: 1\n    partner port_priority: 65535\n    partner key: 1\n    partner state: activity aggregation synchronized collecting distributing\n\n\nslave: e1: current attached\n        port_id: 2\n        port_priority: 65535\n        may_enable: true\n\n    actor sys_id: 86:7a:09:01:35:42\n    actor sys_priority: 65534\n    actor port_id: 2\n    actor port_priority: 65535\n    actor key: 1\n    actor state: activity aggregation synchronized collecting distributing\n\n    partner sys_id: a2:40:97:2e:d6:44\n    partner sys_priority: 65534\n    partner port_id: 2\n    partner port_priority: 65535\n    partner key: 1\n    partner state: activity aggregation synchronized collecting distributing\n\n\novs-appctl lacp/show bond1\n\n---- bond1 ----\n        status: active negotiated\n        sys_id: a2:40:97:2e:d6:44\n        sys_priority: 65534\n        aggregation key: 1\n        lacp_time: slow\n\nslave: e2: current attached\n        port_id: 1\n        port_priority: 65535\n        may_enable: true\n\n    actor sys_id: a2:40:97:2e:d6:44\n    actor sys_priority: 65534\n    actor port_id: 1\n    actor port_priority: 65535\n    actor key: 1\n    actor state: activity aggregation synchronized collecting distributing\n\n    partner sys_id: 86:7a:09:01:35:42\n    partner sys_priority: 65534\n    partner port_id: 1\n    partner port_priority: 65535\n    partner key: 1\n    partner state: activity aggregation synchronized collecting distributing\n\n\nslave: e3: current attached\n        port_id: 2\n        port_priority: 65535\n        may_enable: true\n\n    actor sys_id: a2:40:97:2e:d6:44\n    actor sys_priority: 65534\n    actor port_id: 2\n    actor port_priority: 65535\n    actor key: 1\n    actor state: activity aggregation synchronized collecting distributing\n\n    partner sys_id: 86:7a:09:01:35:42\n    partner sys_priority: 65534\n    partner port_id: 2\n    partner port_priority: 65535\n    partner key: 1\n    partner state: activity aggregation synchronized collecting distributing\n\n\n\n\n\u30e1\u30e2\n\u3053\u308c\u3067\u7d44\u3081\u3066\u3044\u308b\u3068\u601d\u308f\u308c\u308b\u3002\ndump\u3059\u308c\u3070LACPDU\u304c\u51fa\u3066\u3044\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u308b\u306e\u304b\u306a\u3002\u3002\u3002\n\n\u53c2\u8003\u6587\u732e\nhttp://blog.scottlowe.org/2012/10/19/link-aggregation-and-lacp-with-open-vswitch/\n# \u69cb\u6210\u56f3\n![OVS\u9593lacp.jpg](https://qiita-image-store.s3.amazonaws.com/0/43114/4a30c4f1-3255-0902-163f-70748a2892e0.jpeg)\n\n# br\u306e\u4f5c\u6210\n<pre>\n# ovs-vsctl add-br br1\n# ovs-vsctl add-br br0\n</pre>\n\n# bonding\u306e\u4f5c\u6210\n\u3064\u3044\u3067\u306bLAPC\u3082on\n<pre>\n# ovs-vsctl add-bond br0 bond0 e0 e1 lacp=active\n# ovs-vsctl add-bond br1 bond1 e2 e3 lacp=active\n</pre>\n# patch(ovs\u9593\u30ea\u30f3\u30af)\u306e\u8a2d\u5b9a\n\u3053\u3053\u3067\u306fpatch\u3067\u3084\u3063\u3066\u3044\u308b\u304cveth\u3067\u3082\u3067\u304d\u308b\u306f\u305a\n\n<pre>\n# ovs-vsctl set interface e0 type=patch options:peer=e2\n# ovs-vsctl set interface e2 type=patch options:peer=e0\n# ovs-vsctl set interface e3 type=patch options:peer=e1\n# ovs-vsctl set interface e1 type=patch options:peer=e3\n</pre>\n\n# \u7269\u7406\u30ea\u30f3\u30af\u306e\u78ba\u8a8d\n\u5168\u3066UP\u3092\u78ba\u8a8d\n<pre>\n# ovs-vsctl get interface e0 link_state\nup\n# ovs-vsctl get interface e1 link_state\nup\n# ovs-vsctl get interface e2 link_state\nup\n# ovs-vsctl get interface e3 link_state\nup\n</pre>\n\n# bond\u306bLACP\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n<pre>\n# ovs-vsctl get port bond0 lacp\nactive\n# ovs-vsctl get port bond1 lacp\nactive\n</pre>\n\n# LACP Status\u306e\u78ba\u8a8d\n<pre>\n# ovs-vsctl get interface e0 lacp_current\ntrue\n# ovs-vsctl get interface e1 lacp_current\ntrue\n# ovs-vsctl get interface e2 lacp_current\ntrue\n# ovs-vsctl get interface e3 lacp_current\ntrue\n# ovs-appctl bond/show bond0\n---- bond0 ----\nbond_mode: active-backup\nbond-hash-basis: 0\nupdelay: 0 ms\ndowndelay: 0 ms\nlacp_status: negotiated\n\nslave e0: enabled\n        may_enable: true\n\nslave e1: enabled\n        active slave\n        may_enable: true\n\n# ovs-appctl bond/show bond1\n---- bond1 ----\nbond_mode: active-backup\nbond-hash-basis: 0\nupdelay: 0 ms\ndowndelay: 0 ms\nlacp_status: negotiated\n\nslave e2: enabled\n        may_enable: true\n\nslave e3: enabled\n        active slave\n        may_enable: true\n</pre>\n\n# \u5927\u4e8b\u306a\u78ba\u8a8d\n\u63a5\u7d9a\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u540c\u58eb(e0\u3068e2\u3001e1\u3068e3)\u3067\u3001system_id\u304c\u898b\u3048\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\nactor\u304c\u81ea\u5206\u3001partner\u304c\u5bfe\u5411\u306e\u60c5\u5831\n<pre>\n# ovs-appctl lacp/show bond0\n---- bond0 ----\n        status: active negotiated\n        sys_id: 86:7a:09:01:35:42\n        sys_priority: 65534\n        aggregation key: 1\n        lacp_time: slow\n\nslave: e0: current attached\n        port_id: 1\n        port_priority: 65535\n        may_enable: true\n\n        actor sys_id: 86:7a:09:01:35:42\n        actor sys_priority: 65534\n        actor port_id: 1\n        actor port_priority: 65535\n        actor key: 1\n        actor state: activity aggregation synchronized collecting distributing\n\n        partner sys_id: a2:40:97:2e:d6:44\n        partner sys_priority: 65534\n        partner port_id: 1\n        partner port_priority: 65535\n        partner key: 1\n        partner state: activity aggregation synchronized collecting distributing\n\nslave: e1: current attached\n        port_id: 2\n        port_priority: 65535\n        may_enable: true\n\n        actor sys_id: 86:7a:09:01:35:42\n        actor sys_priority: 65534\n        actor port_id: 2\n        actor port_priority: 65535\n        actor key: 1\n        actor state: activity aggregation synchronized collecting distributing\n\n        partner sys_id: a2:40:97:2e:d6:44\n        partner sys_priority: 65534\n        partner port_id: 2\n        partner port_priority: 65535\n        partner key: 1\n        partner state: activity aggregation synchronized collecting distributing\n\n# ovs-appctl lacp/show bond1\n---- bond1 ----\n        status: active negotiated\n        sys_id: a2:40:97:2e:d6:44\n        sys_priority: 65534\n        aggregation key: 1\n        lacp_time: slow\n\nslave: e2: current attached\n        port_id: 1\n        port_priority: 65535\n        may_enable: true\n\n        actor sys_id: a2:40:97:2e:d6:44\n        actor sys_priority: 65534\n        actor port_id: 1\n        actor port_priority: 65535\n        actor key: 1\n        actor state: activity aggregation synchronized collecting distributing\n\n        partner sys_id: 86:7a:09:01:35:42\n        partner sys_priority: 65534\n        partner port_id: 1\n        partner port_priority: 65535\n        partner key: 1\n        partner state: activity aggregation synchronized collecting distributing\n\nslave: e3: current attached\n        port_id: 2\n        port_priority: 65535\n        may_enable: true\n\n        actor sys_id: a2:40:97:2e:d6:44\n        actor sys_priority: 65534\n        actor port_id: 2\n        actor port_priority: 65535\n        actor key: 1\n        actor state: activity aggregation synchronized collecting distributing\n\n        partner sys_id: 86:7a:09:01:35:42\n        partner sys_priority: 65534\n        partner port_id: 2\n        partner port_priority: 65535\n        partner key: 1\n        partner state: activity aggregation synchronized collecting distributing\n</pre>\n\n## \u30e1\u30e2\n\u3053\u308c\u3067\u7d44\u3081\u3066\u3044\u308b\u3068\u601d\u308f\u308c\u308b\u3002\ndump\u3059\u308c\u3070LACPDU\u304c\u51fa\u3066\u3044\u308b\u3053\u3068\u3082\u78ba\u8a8d\u3067\u304d\u308b\u306e\u304b\u306a\u3002\u3002\u3002\n# \u53c2\u8003\u6587\u732e\nhttp://blog.scottlowe.org/2012/10/19/link-aggregation-and-lacp-with-open-vswitch/\n", "tags": ["OpenVSwitch", "lacp"]}