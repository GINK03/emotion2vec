{"tags": ["Claudia.js", "AWSLambda", "babel", "APIGateway"], "context": "\n\n\u306f\u3058\u3081\u306b\nClaudia.js\u3092\u5229\u7528\u3057\u3066API(AWS Lambda & API Gateway)\u306e\u958b\u767a\u3092\u884c\u3046\u969b\u306bBabel - ES2015, 2016, 2017 - \u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u74b0\u5883\u3092\u6574\u7406\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\nClaudia.js\u306fNode.js\u306b\u7279\u5316\u3057\u305fLambda\u306e\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u6982\u8981\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\nNode.js\u3067Lambda\u3092\u958b\u767a\u3059\u308b\u306a\u3089Claudia.js\u304c\u30aa\u30b9\u30b9\u30e1\n\u4eca\u56de\u306e\u5b8c\u6210\u54c1\u306f\u3053\u3061\u3089\u3002\nhttps://github.com/gaishimo/claudiajs-template\n\nClaudia.js\u306e\u8a2d\u5b9a\n\u307e\u305aClaudia.js\u306eCLI\u30c4\u30fc\u30eb\u3068API Builder\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nyarn init\nyarn add --dev claudia\nyarn add claudia-api-builder\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ $(yarn bin)/claudia --version\n2.9.0\n\n\nBabel\u8a2d\u5b9a\n\u6b21\u306bBabel\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002ES2015, ES2016, ES2017\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u203bES2017\u306fAsync Functions\u304c\u5229\u7528\u3067\u304d\u307e\u3059\n\u4ee5\u4e0bbabel\u95a2\u9023\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\nyarn add --dev \\\n  babel-core \\\n  babel-register \\\n  babel-loader \\\n  babel-preset-es2015 \\\n  babel-preset-es2016 \\\n  babel-preset-es2017\n\n.babelrc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\ncat <<-EOS > .babelrc\n{\n  \"presets\": [\n    \"es2015\",\n    \"es2016\",\n    \"es2017\"\n  ]\n}\nEOS\n\nbabel\u304c\u6709\u52b9\u304b\u3069\u3046\u304b\u3001\u9069\u5f53\u306ajs\u3092\u66f8\u3044\u3066import\u69cb\u6587\u3084async\u7b49\u304c\u4f7f\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\ncat <<-EOS > tmp.js\nimport path from 'path'\nconst func1 = async() => 'test'\nEOS\nbabel-node tmp.js\n\n\u30a8\u30e9\u30fc\u304c\u3067\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\u30c6\u30b9\u30c8\u306b\u4f7f\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u4e0d\u8981\u306a\u306e\u3067\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nrm -f tmp.js\n\n\n\u30b3\u30fc\u30c9\u4f5c\u6210\nClaudia.js\u3067babel\u3092\u5229\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u304c\u5b58\u5728\u3059\u308b\u305f\u3081\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3057\u307e\u3059\u3002\nhttps://github.com/claudiajs/example-projects/tree/master/babel\n\u307e\u305aAPI\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nsrc/api.js\nimport APIBuilder from 'claudia-api-builder'\n\nconst api = new APIBuilder()\n\napi.get('/', () => 'hello claudia.js with babel')\n\nmodule.exports = api\n\n\n\nAPIBuilder\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306fmodule.exports\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u305d\u3057\u3066package.json\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\"scripts\": {\n  \"transpile\": \"babel src/ --out-dir bin/\",\n  \"create:api\": \"yarn run transpile && claudia create --region ap-northeast-1 --api-module bin/api\",\n  \"update:api\": \"yarn run transpile && claudia update\"\n},\n\ntranspile\u3092\u5b9f\u884c\u3059\u308b\u3068Babel\u3067src\u306e\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3057\u3001bin\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002create\u3068update\u3067\u306f\u3001transpile\u5f8c\u306bAPI\u306e\u4f5c\u6210\u3001\u66f4\u65b0\u3092\u884c\u3044\u307e\u3059\u3002\n\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ yarn run transpile\nyarn run v0.19.1\nbabel src/ --out-dir bin/\nsrc/api.js -> bin/api.js\n\u2728  Done in 1.23s.\n\n$ yarn run create:api\nyarn run v0.19.1\n$ npm run transpile && claudia create --region us-east-1 --api-module bin/api\n\n> claudiajs-babel@1.0.0 transpile /Users/gaishimo/src/sandbox/claudiajs-babel\n> babel src/ --out-dir bin/\n\nsrc/api.js -> bin/api.js\nsaving configuration\n{\n  \"lambda\": {\n    \"role\": \"claudiajs-babel-executor\",\n    \"name\": \"claudiajs-babel\",\n    \"region\": \"us-east-1\"\n  },\n  \"api\": {\n    \"id\": \"zwakgyo72b\",\n    \"module\": \"bin/api\",\n    \"url\": \"https://xxxxxxxxxxx.execute-api.us-east-1.amazonaws.com/latest\"\n  }\n}\n\u2728  Done in 33.26s.\n\n\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001claudia.json\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u306fLambda\u3084API Gateway\u306eID\u7b49\u3092\u683c\u7d0d\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\u8a66\u3057\u306bAPI\u306b\u5bfe\u3057\u3066HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n$ curl https://xxxxxxxxxxx.execute-api.us-east-1.amazonaws.com/latest\n\"hello claudia.js with babel\"%\n\n\nESLint\u8a2d\u5b9a\nESLint\u306e\u8a2d\u5b9a\u3082\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u8a2d\u5b9a\u306fairbnb\u306e\u8a2d\u5b9a\u3092\u7d99\u627f\u3057\u307e\u3059\u3002\nyarn add --dev \\\n  eslint \\\n  eslint-config-airbnb-base \\\n  eslint-plugin-import\n\n\neslintrc.yaml\nenv:\n  es6: true\n  node: true\nextends: airbnb-base\nparser: babel-eslint\nrules:\n  semi:\n    - error\n    - never\n\n\n\u203bRule\u306f\u597d\u307f\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\npackage.json\u306escripts\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3001\n  \"scripts\": {\n    ...\n    \"lint\": \"eslint -c .eslintrc.yml ./src\",\n    \"lint:fix\": \"eslint -c .eslintrc.yml --fix ./src\"\n  },\n\n\u8a66\u3057\u306blint\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ yarn run lint\nyarn run v0.19.1\n$ eslint -c .eslintrc.yml ./src\n\u2728  Done in 0.95s.\n$ yarn run lint:fix\nyarn run v0.19.1\n$ eslint -c .eslintrc.yml --fix ./src\n\u2728  Done in 0.99s.\n\n\n\u30c6\u30b9\u30c8\u306e\u8a2d\u5b9a\n\u66f4\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002Mocha + power-assert \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\u307e\u305a\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\nyarn add --dev \\\n  mocha \\\n  power-assert \\\n  babel-preset-power-assert\n\nBabel\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067presets\u306bbabel-preset-power-assert\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n{\n  \"presets\": [\n    ...,\n    \"babel-preset-power-assert\"\n  ]\n}\n\n\u305d\u308c\u3068Mocha\u306eoption\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\ntest/mocha.opts\n--recursive\n--compilers js:babel-register\n\n\n\u203b\u3053\u306e\u524dDevOps\u3092\u610f\u8b58\u3057\u305f\u305b\u3044\u304b\u3001\u4f55\u6545\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u3092mocha.ops\u306b\u3057\u3066\u3057\u307e\u3044\u3001\u8a2d\u5b9a\u304c\u52b9\u304b\u306a\u3044..\u3068\u304b\u306a\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002opts\u306a\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\u307e\u305f\u3001ESLint\u3067mocha\u306eglobal\u306a\u5909\u6570\u7b49\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\neslintrc.yml\nenv:\n  ...\n  mocha: true\n\n\n\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3001API\u306ehandler\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306bhandlers.js\u306b\u5206\u96e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nsrc/api.js\nimport APIBuilder from 'claudia-api-builder'\nimport echo from './handlers'\n\nconst api = new APIBuilder()\n\napi.get('/', echo)\n\nmodule.exports = api\n\n\n\n\nsrc/handlers.js\nexport default () => 'hello claudia.js with babel'\n\n\n\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\ntest/handlers.js\nimport assert from 'power-assert'\nimport echo from '../src/handlers'\n\ndescribe('echo', () => {\n  it('returns text', () => {\n    assert(echo() === 'hello claudia.js with babel')\n  })\n})\n\n\n\npackage.json\u306escripts\u306btest\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u3001\n  \"scripts\": {\n    ...\n    \"test\": \"mocha\"\n  },\n\n\u30c6\u30b9\u30c8\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n$ yarn test\nyarn test v0.19.1\n$ mocha\n\n\n  echo\n    \u2713 returns text\n\n\n  1 passing (93ms)\n\n\u2728  Done in 1.15s.\n\n\u8a66\u3057\u306b\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u307f\u308b\u3068...\n\nsrc/handlers.js\nexport default () => 'hello claudia.js with babel xxx'\n\n\n\n$ yarn test\nyarn test v0.19.1\n$ mocha\n\n\n  echo\n    1) returns text\n\n\n  0 passing (105ms)\n  1 failing\n\n  1) echo returns text:\n\n        # test/handlers.js:7\n\n  assert(echo() === 'hello claudia.js with babel')\n         |      |\n         |      false\n         \"hello claudia.js with babel xxx\"\n\n  --- [string] 'hello claudia.js with babel'\n  +++ [string] echo()\n  @@ -20,8 +20,12 @@\n   th babel\n  + xxx\n\n\n      + expected - actual\n\n      -false\n      +true\n\n  AssertionError: false == true\n      at Decorator._callFunc (node_modules/empower-core/lib/decorator.js:110:20)\n      at Decorator.concreteAssert (node_modules/empower-core/lib/decorator.js:103:17)\n      at decoratedAssert (node_modules/empower-core/lib/decorate.js:49:30)\n      at powerAssert (node_modules/empower-core/index.js:63:32)\n      at Context.<anonymous> (test/handlers.js:7:5)\n\n\n\nerror Command failed with exit code 1.\n\n\u30a8\u30e9\u30fc\u3068\u540c\u6642\u306bpower-assert\u56fa\u6709\u306eassertion\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u3064\u3044\u3067\u306b\u30c6\u30b9\u30c8\u304c\u6210\u529f\u3057\u306a\u3044\u3068\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3001\u30c7\u30d7\u30ed\u30a4\u524d\u306b\u30c6\u30b9\u30c8\u5b9f\u884c\u3092\u5dee\u3057\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\npackage.json\n  \"scripts\": {\n    ...\n    \"create\": \"yarn run transpile && yarn test && claudia create --region ap-northeast-1 --api-module bin/api\",\n    \"update\": \"yarn run transpile && yarn test && claudia update\",\n    ...\n  },\n\n\n\n\u5f8c\u7247\u4ed8\u3051\nLambda & API Gateway (IAM Role\u3082)\u3092\u524a\u9664\u3059\u308b\u306b\u306fclaudia destroy\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$(yarn bin)/claudia destroy\n\n\u203b\u3061\u3087\u3063\u3068\u3055\u307f\u3057\u3044\u3067\u3059\u304c\u3001destroy\u6642\u306f\u7279\u306b\u51fa\u529b\u306f\u3067\u307e\u305b\u3093\n\n\u6ce8\u610f\u70b9\ngit\u3067\u7ba1\u7406\u3059\u308b\u5834\u5408\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306eJS\u3092\u51fa\u529b\u3059\u308b\u30d5\u30a9\u30eb\u30c0\u306f.gitignore\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\nbin\n\n.gitignore\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001Claudia.js\u306b\u30c7\u30d7\u30ed\u30a4\u5bfe\u8c61\u3068\u307f\u306a\u3055\u308c\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001package.json\u306efiles\u306b\u8a72\u5f53\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\npackage.json\n  \"files\": [\n    \"bin\"\n  ],\n\n\n\n\u6700\u5f8c\u306b\n\u3053\u308c\u3067Claudia.js\u3067\u306eLambda\u958b\u767a(API)\u3059\u308b\u74b0\u5883\u304c\u6574\u3044\u307e\u3057\u305f!\n## \u306f\u3058\u3081\u306b\n\n[Claudia.js](https://claudiajs.com/)\u3092\u5229\u7528\u3057\u3066API(AWS Lambda & API Gateway)\u306e\u958b\u767a\u3092\u884c\u3046\u969b\u306bBabel - ES2015, 2016, 2017 - \u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u74b0\u5883\u3092\u6574\u7406\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nClaudia.js\u306fNode.js\u306b\u7279\u5316\u3057\u305fLambda\u306e\u30c7\u30d7\u30ed\u30a4\u30c4\u30fc\u30eb\u3067\u3059\u3002 \u6982\u8981\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u3092\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n[Node.js\u3067Lambda\u3092\u958b\u767a\u3059\u308b\u306a\u3089Claudia.js\u304c\u30aa\u30b9\u30b9\u30e1](http://qiita.com/gaishimo/items/5ae6b35ebd4ae9434994)\n\n\u4eca\u56de\u306e\u5b8c\u6210\u54c1\u306f\u3053\u3061\u3089\u3002\nhttps://github.com/gaishimo/claudiajs-template\n\n\n## Claudia.js\u306e\u8a2d\u5b9a\n\n\u307e\u305aClaudia.js\u306eCLI\u30c4\u30fc\u30eb\u3068API Builder\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\nyarn init\nyarn add --dev claudia\nyarn add claudia-api-builder\n```\n\n\n```bash\n# \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n$ $(yarn bin)/claudia --version\n2.9.0\n```\n\n## Babel\u8a2d\u5b9a\n\n\u6b21\u306bBabel\u306e\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002ES2015, ES2016, ES2017\u304c\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u203bES2017\u306fAsync Functions\u304c\u5229\u7528\u3067\u304d\u307e\u3059\n\n\u4ee5\u4e0bbabel\u95a2\u9023\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001\n\n\n```bash\nyarn add --dev \\\n  babel-core \\\n  babel-register \\\n  babel-loader \\\n  babel-preset-es2015 \\\n  babel-preset-es2016 \\\n  babel-preset-es2017\n```\n\n.babelrc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\ncat <<-EOS > .babelrc\n{\n  \"presets\": [\n    \"es2015\",\n    \"es2016\",\n    \"es2017\"\n  ]\n}\nEOS\n```\n\nbabel\u304c\u6709\u52b9\u304b\u3069\u3046\u304b\u3001\u9069\u5f53\u306ajs\u3092\u66f8\u3044\u3066import\u69cb\u6587\u3084async\u7b49\u304c\u4f7f\u3048\u308b\u304b\u30c6\u30b9\u30c8\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n```bash\ncat <<-EOS > tmp.js\nimport path from 'path'\nconst func1 = async() => 'test'\nEOS\nbabel-node tmp.js\n```\n\u30a8\u30e9\u30fc\u304c\u3067\u306a\u3051\u308c\u3070OK\u3067\u3059\u3002\n\n\u30c6\u30b9\u30c8\u306b\u4f7f\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u306f\u4e0d\u8981\u306a\u306e\u3067\u524a\u9664\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash\nrm -f tmp.js\n```\n\n## \u30b3\u30fc\u30c9\u4f5c\u6210\n\nClaudia.js\u3067babel\u3092\u5229\u7528\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u304c\u5b58\u5728\u3059\u308b\u305f\u3081\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3057\u307e\u3059\u3002\nhttps://github.com/claudiajs/example-projects/tree/master/babel\n\n\u307e\u305aAPI\u306e\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```src/api.js\nimport APIBuilder from 'claudia-api-builder'\n\nconst api = new APIBuilder()\n\napi.get('/', () => 'hello claudia.js with babel')\n\nmodule.exports = api\n\n```\n\nAPIBuilder\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306fmodule.exports\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u305d\u3057\u3066package.json\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```json\n\"scripts\": {\n  \"transpile\": \"babel src/ --out-dir bin/\",\n  \"create:api\": \"yarn run transpile && claudia create --region ap-northeast-1 --api-module bin/api\",\n  \"update:api\": \"yarn run transpile && claudia update\"\n},\n```\n\ntranspile\u3092\u5b9f\u884c\u3059\u308b\u3068Babel\u3067src\u306e\u30b3\u30fc\u30c9\u3092\u5909\u63db\u3057\u3001bin\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002create\u3068update\u3067\u306f\u3001transpile\u5f8c\u306bAPI\u306e\u4f5c\u6210\u3001\u66f4\u65b0\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u8a66\u3057\u306b\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ yarn run transpile\nyarn run v0.19.1\nbabel src/ --out-dir bin/\nsrc/api.js -> bin/api.js\n\u2728  Done in 1.23s.\n```\n\n```bash\n$ yarn run create:api\nyarn run v0.19.1\n$ npm run transpile && claudia create --region us-east-1 --api-module bin/api\n\n> claudiajs-babel@1.0.0 transpile /Users/gaishimo/src/sandbox/claudiajs-babel\n> babel src/ --out-dir bin/\n\nsrc/api.js -> bin/api.js\nsaving configuration\n{\n  \"lambda\": {\n    \"role\": \"claudiajs-babel-executor\",\n    \"name\": \"claudiajs-babel\",\n    \"region\": \"us-east-1\"\n  },\n  \"api\": {\n    \"id\": \"zwakgyo72b\",\n    \"module\": \"bin/api\",\n    \"url\": \"https://xxxxxxxxxxx.execute-api.us-east-1.amazonaws.com/latest\"\n  }\n}\n\u2728  Done in 33.26s.\n```\n\n\u4f5c\u6210\u304c\u5b8c\u4e86\u3059\u308b\u3068\u3001`claudia.json`\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u306fLambda\u3084API Gateway\u306eID\u7b49\u3092\u683c\u7d0d\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u8a66\u3057\u306bAPI\u306b\u5bfe\u3057\u3066HTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u308b\u3068\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n```bash\n$ curl https://xxxxxxxxxxx.execute-api.us-east-1.amazonaws.com/latest\n\"hello claudia.js with babel\"%\n```\n\n\n## ESLint\u8a2d\u5b9a\n\nESLint\u306e\u8a2d\u5b9a\u3082\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u8a2d\u5b9a\u306fairbnb\u306e\u8a2d\u5b9a\u3092\u7d99\u627f\u3057\u307e\u3059\u3002\n\n```\nyarn add --dev \\\n  eslint \\\n  eslint-config-airbnb-base \\\n  eslint-plugin-import\n```\n\n\n```.eslintrc.yaml\nenv:\n  es6: true\n  node: true\nextends: airbnb-base\nparser: babel-eslint\nrules:\n  semi:\n    - error\n    - never\n```\n\n\u203bRule\u306f\u597d\u307f\u3067\u6307\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n\n\npackage.json\u306escripts\u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3001\n\n```json\n  \"scripts\": {\n    ...\n    \"lint\": \"eslint -c .eslintrc.yml ./src\",\n    \"lint:fix\": \"eslint -c .eslintrc.yml --fix ./src\"\n  },\n```\n\n\u8a66\u3057\u306blint\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ yarn run lint\nyarn run v0.19.1\n$ eslint -c .eslintrc.yml ./src\n\u2728  Done in 0.95s.\n$ yarn run lint:fix\nyarn run v0.19.1\n$ eslint -c .eslintrc.yml --fix ./src\n\u2728  Done in 0.99s.\n```\n\n\n## \u30c6\u30b9\u30c8\u306e\u8a2d\u5b9a\n\n\u66f4\u306b\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3059\u3002[Mocha](https://mochajs.org/) + [power-assert](https://github.com/power-assert-js/power-assert) \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\n```bash\nyarn add --dev \\\n  mocha \\\n  power-assert \\\n  babel-preset-power-assert\n```\n\nBabel\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067presets\u306b`babel-preset-power-assert`\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```.babelrc\n{\n  \"presets\": [\n    ...,\n    \"babel-preset-power-assert\"\n  ]\n}\n```\n\n\u305d\u308c\u3068Mocha\u306eoption\u30d5\u30a1\u30a4\u30eb\u3092\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```test/mocha.opts\n--recursive\n--compilers js:babel-register\n```\n\n\u203b\u3053\u306e\u524dDevOps\u3092\u610f\u8b58\u3057\u305f\u305b\u3044\u304b\u3001\u4f55\u6545\u304b\u30d5\u30a1\u30a4\u30eb\u540d\u3092`mocha.ops`\u306b\u3057\u3066\u3057\u307e\u3044\u3001\u8a2d\u5b9a\u304c\u52b9\u304b\u306a\u3044..\u3068\u304b\u306a\u3063\u305f\u3053\u3068\u304c\u3042\u308a\u307e\u3057\u305f\u3002`opts`\u306a\u306e\u3067\u6ce8\u610f\u3057\u307e\u3057\u3087\u3046\u3002\n\n\n\u307e\u305f\u3001ESLint\u3067mocha\u306eglobal\u306a\u5909\u6570\u7b49\u304c\u30a8\u30e9\u30fc\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```.eslintrc.yml\nenv:\n  ...\n  mocha: true\n```\n\n\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3001API\u306ehandler\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306bhandlers.js\u306b\u5206\u96e2\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```src/api.js\nimport APIBuilder from 'claudia-api-builder'\nimport echo from './handlers'\n\nconst api = new APIBuilder()\n\napi.get('/', echo)\n\nmodule.exports = api\n\n```\n\n```src/handlers.js\nexport default () => 'hello claudia.js with babel'\n\n```\n\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306b\u306a\u308a\u307e\u3059\u3002\n\n```test/handlers.js\nimport assert from 'power-assert'\nimport echo from '../src/handlers'\n\ndescribe('echo', () => {\n  it('returns text', () => {\n    assert(echo() === 'hello claudia.js with babel')\n  })\n})\n\n```\n\npackage.json\u306escripts\u306btest\u3092\u8ffd\u52a0\u3057\u3066\u304a\u304d\u3001\n\n```json\n  \"scripts\": {\n    ...\n    \"test\": \"mocha\"\n  },\n```\n\n\u30c6\u30b9\u30c8\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash\n$ yarn test\nyarn test v0.19.1\n$ mocha\n\n\n  echo\n    \u2713 returns text\n\n\n  1 passing (93ms)\n\n\u2728  Done in 1.15s.\n```\n\n\u8a66\u3057\u306b\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3059\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u3057\u3066\u307f\u308b\u3068...\n\n```src/handlers.js\nexport default () => 'hello claudia.js with babel xxx'\n\n```\n\n```bash\n$ yarn test\nyarn test v0.19.1\n$ mocha\n\n\n  echo\n    1) returns text\n\n\n  0 passing (105ms)\n  1 failing\n\n  1) echo returns text:\n\n        # test/handlers.js:7\n\n  assert(echo() === 'hello claudia.js with babel')\n         |      |\n         |      false\n         \"hello claudia.js with babel xxx\"\n\n  --- [string] 'hello claudia.js with babel'\n  +++ [string] echo()\n  @@ -20,8 +20,12 @@\n   th babel\n  + xxx\n\n\n      + expected - actual\n\n      -false\n      +true\n\n  AssertionError: false == true\n      at Decorator._callFunc (node_modules/empower-core/lib/decorator.js:110:20)\n      at Decorator.concreteAssert (node_modules/empower-core/lib/decorator.js:103:17)\n      at decoratedAssert (node_modules/empower-core/lib/decorate.js:49:30)\n      at powerAssert (node_modules/empower-core/index.js:63:32)\n      at Context.<anonymous> (test/handlers.js:7:5)\n\n\n\nerror Command failed with exit code 1.\n```\n\n\u30a8\u30e9\u30fc\u3068\u540c\u6642\u306bpower-assert\u56fa\u6709\u306eassertion\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\n\u3064\u3044\u3067\u306b\u30c6\u30b9\u30c8\u304c\u6210\u529f\u3057\u306a\u3044\u3068\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3001\u30c7\u30d7\u30ed\u30a4\u524d\u306b\u30c6\u30b9\u30c8\u5b9f\u884c\u3092\u5dee\u3057\u8fbc\u3093\u3067\u304a\u304d\u307e\u3059\u3002\n\n```package.json\n  \"scripts\": {\n    ...\n    \"create\": \"yarn run transpile && yarn test && claudia create --region ap-northeast-1 --api-module bin/api\",\n    \"update\": \"yarn run transpile && yarn test && claudia update\",\n    ...\n  },\n```\n\n\n## \u5f8c\u7247\u4ed8\u3051\n\nLambda & API Gateway (IAM Role\u3082)\u3092\u524a\u9664\u3059\u308b\u306b\u306f`claudia destroy`\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$(yarn bin)/claudia destroy\n```\n\n\u203b\u3061\u3087\u3063\u3068\u3055\u307f\u3057\u3044\u3067\u3059\u304c\u3001destroy\u6642\u306f\u7279\u306b\u51fa\u529b\u306f\u3067\u307e\u305b\u3093\n\n\n## \u6ce8\u610f\u70b9\n\ngit\u3067\u7ba1\u7406\u3059\u308b\u5834\u5408\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u5f8c\u306eJS\u3092\u51fa\u529b\u3059\u308b\u30d5\u30a9\u30eb\u30c0\u306f.gitignore\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u6307\u5b9a\u3059\u308b\u3053\u3068\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u304c\u3001\n\n\n```.gitignore\nbin\n```\n\n.gitignore\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u3001Claudia.js\u306b\u30c7\u30d7\u30ed\u30a4\u5bfe\u8c61\u3068\u307f\u306a\u3055\u308c\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001package.json\u306e`files`\u306b\u8a72\u5f53\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n```package.json\n  \"files\": [\n    \"bin\"\n  ],\n```\n\n## \u6700\u5f8c\u306b\n\n\u3053\u308c\u3067Claudia.js\u3067\u306eLambda\u958b\u767a(API)\u3059\u308b\u74b0\u5883\u304c\u6574\u3044\u307e\u3057\u305f!\n\n\n\n\n\n\n"}