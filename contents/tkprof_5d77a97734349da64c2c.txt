{"context": "\n\nHow to make Apache mod_dbd driver : apr_dbd_oracle.so\n\nApache DBD API :  http://people.apache.org/~niq/dbd.html\n\nDBDs available with MySQL, PostgreSQL ... with examples\nnone available with ORACLE, so let me build it.\n\n\n\n\nPreliminary\n\n[users@httpd] Re: Regarding Apache HTTP Authentication with an Oracle Database\n\nhttp://mail-archives.apache.org/mod_mbox/httpd-users/200811.mbox/raw/%3c49142D36.1050706@sbcmaroc.com%3e/2\nmod_rewrite\u306e\u8003\u3048\u65b9\u3002\nhttp://koseki.hatenablog.com/entry/20090611/ModRewrite\nApache\u8a8d\u8a3c\u3092SQL\u3067RDBMS\u3078\u9023\u643a\u3059\u308b mod_authn_dbd \u3068 mod_db\u3092\u4f7f\u3046\u3002\nhttp://takuya-1st.hatenablog.jp/entry/2015/11/13/205953\nWindows\u4e0a\u306eApache2.2\u3067 ODBC\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u305f Basic\u8a8d\u8a3c\u3092\u884c\u3046\nhttp://www.walbrix.com/jp/blog/2007-10-windowsapache22-odbc-basic.html\n\n\n\nSteps - How to build \"apr_dbd_oracle.so\"\n\nEnvironment\n\nOracleLinux 6.7 installed (Red Hat Enterprise Linux Server 6.7)\n\n\n/etc/issue\nOracle Linux Server release 6.7\n\n\n\nRequired : PCRE - Perl Compatible Regular Expressions\n# wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz\n# tar zxvf pcre-8.37.tar.gz\n# cd pcre-8.37\n# ./configure\n# make install\n\nOracle Instant Client 11.2.0.4.0\nhttp://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html\n\noracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm\noracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm\noracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm  (optional)\n\n# rpm -UVh oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm\n# rpm -UVh oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm\n/usr/include/oracle/11.2/client64 -> /usr/lib/oracle/11.2/client64/include\n# ln -s /usr/include/oracle/11.2/client64 /usr/lib/oracle11.2/client64/include\nORACLE environment variables\n\n/~/.bashrc\nexport ORACLE_HOME=/usr/lib/oracle/11.2/client64\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$PATH:$ORACLE_HOME/bin\nCPPFLAGS=-I/usr/include/oracle/11.2/client64; export CPPFLAGS\nLDFLAGS=-L/usr/lib/oracle/11.2/client64; export LDFLAGS\n\n\n\napache 2.4.18 / apr 1.5.2 / apr-util 1.5.4\n\napr\n -> apr-util\n --> apache \n\n# wget http://ftp.yz.yamagata-u.ac.jp/pub/network/apache//httpd/httpd-2.4.18.tar.gz\n# tar zxvf httpd-2.4.18.tar.gz\n# wget http://ftp.kddilabs.jp/infosystems/apache/apr/apr-1.5.2.tar.gz\n# tar zxvf apr-1.5.2.tar.gz\n# wget http://ftp.kddilabs.jp/infosystems/apache/apr/apr-util-1.5.4.tar.gz\n# tar zxvf apr-util-1.5.4.tar.gz\n\napr 1.5.2\n# cd apr-1.5.2\n# ./configure\n# make\n# make install\n\napr-util 1.5.4\n# cd apr-util-1.5.4\n# ./configure --with-apr=/usr/local/apr --with-oracle=/usr/lib/oracle/11.2/client64 --with-oracle-include=/usr/include/oracle/11.2/client64/\n# make\n# make install\nNow we got \"apr_dbd_oracle.so\"\n# ls -aslrt /usr/local/apr/lib/apr-util-1\n\nls\n 0 lrwxrwxrwx 1 root root    20 Mar  6 18:08 apr_dbd_sqlite3.so -> apr_dbd_sqlite3-1.so\n 4 -rwxr-xr-x 1 root root  1004 Mar  6 18:08 apr_dbd_sqlite3.la\n64 -rw-r--r-- 1 root root 59680 Mar  6 18:08 apr_dbd_sqlite3.a\n48 -rwxr-xr-x 1 root root 47016 Mar  6 18:08 apr_dbd_sqlite3-1.so\n 0 lrwxrwxrwx 1 root root    18 Mar  6 18:08 apr_dbd_pgsql.so -> apr_dbd_pgsql-1.so\n 4 -rwxr-xr-x 1 root root   998 Mar  6 18:08 apr_dbd_pgsql.la\n80 -rw-r--r-- 1 root root 76214 Mar  6 18:08 apr_dbd_pgsql.a\n64 -rwxr-xr-x 1 root root 57639 Mar  6 18:08 apr_dbd_pgsql-1.so\n 0 lrwxrwxrwx 1 root root    19 Mar  6 18:08 apr_dbd_oracle.so -> apr_dbd_oracle-1.so\n 4 -rwxr-xr-x 1 root root  1068 Mar  6 18:08 apr_dbd_oracle.la\n92 -rw-r--r-- 1 root root 86460 Mar  6 18:08 apr_dbd_oracle.a\n72 -rwxr-xr-x 1 root root 67999 Mar  6 18:08 apr_dbd_oracle-1.so\n 4 drwxr-xr-x 2 root root  4096 Mar  6 18:08 .\n 4 drwxr-xr-x 4 root root  4096 Mar  6 18:08 ..\n\n\n\napache 2.4.18\n# cd httpd-2.4.18\n# CPPFLAGS=-I/usr/include/oracle/11.2/client64; export CPPFLAGS\n# LDFLAGS=-L/usr/lib/oracle/11.2/client64; export LDFLAGS\n# ./configure\n# make\n# make install\n# /usr/local/apache2/bin/httpd -V\n\nSteps - How to configure httpd.conf for mod_dbd Oracle module\"\n/usr/local/apache2/conf/httpd.conf\n  uncomment dbd_module to be loaded\n\nhttpd.conf\nLoadModule dbd_module modules/mod_dbd.so\n\n\n/usr/local/apache2/conf/default.conf\n   describe DBD driver, DB connection string, SQL to be executed, rewrite map rule\n\ndefault.conf\nDBDriver oracle\nDBDParams \"user=ngas pass=ngas$dba dbname=ALMA10 server=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=133.40.204.77)(PORT=1521)))(CONNECT_DATA=(SERVICE_N\nAME=alma10.arc.ea)))\"\n\nDBDMin 4\nDBDKeep 8\nDBDMax 20\nDBDExptime 300\n\n#DBDPrepareSQL \"select 'file://'||FILE_NAME from NGAS_FILES where FILE_ID = @KEY\" map_select\n\nRewriteMap ngas \"dbd: select 'http://' || regexp_replace(HOST_ID,':[0-9.]+') || '.mtk.nao.ac.jp' || MOUNT_POINT || '/'|| FILE_NAME from NGAS.NGAS_FILES f, NGAS.NGA\nS_DISKS d where f.DISK_ID = d.DISK_ID and f.FILE_ID = %s\"\n\n\nRewriteEngine On\n\nRewriteCond %{QUERY_STRING} ^file_id=(.*)$\nRewriteRule ^/RETRIEVE.* ${ngas:%1} [R,L]\n\n\n\n\n#How to make Apache mod_dbd driver : apr_dbd_oracle.so\n - Apache DBD API :  http://people.apache.org/~niq/dbd.html</dd>\n - DBDs available with MySQL, PostgreSQL ... with examples\n - none available with **ORACLE**, so let me build it.\n\n![mod_DBD_per_file.jpg](https://qiita-image-store.s3.amazonaws.com/0/114634/6fa8c73d-e1f1-95e1-0129-3061b008708c.jpeg)\n![mod_DBD_per_rate.jpg](https://qiita-image-store.s3.amazonaws.com/0/114634/1bdf2f20-fb18-b796-0962-b0c8deedb996.jpeg)\n\n\n## Preliminary \n<dl>\n  <dt>[users@httpd] Re: Regarding Apache HTTP Authentication with an Oracle Database\n</dt>\n  <dd>http://mail-archives.apache.org/mod_mbox/httpd-users/200811.mbox/raw/%3c49142D36.1050706@sbcmaroc.com%3e/2</dd>\n\n\n  <dt>mod_rewrite\u306e\u8003\u3048\u65b9\u3002</dt>\n  <dd>http://koseki.hatenablog.com/entry/20090611/ModRewrite</dd>\n\n  <dt>Apache\u8a8d\u8a3c\u3092SQL\u3067RDBMS\u3078\u9023\u643a\u3059\u308b mod_authn_dbd \u3068 mod_db\u3092\u4f7f\u3046\u3002</dt>\n  <dd>http://takuya-1st.hatenablog.jp/entry/2015/11/13/205953</dd>\n\n  <dt>Windows\u4e0a\u306eApache2.2\u3067 ODBC\u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u305f Basic\u8a8d\u8a3c\u3092\u884c\u3046</dt>\n  <dd>http://www.walbrix.com/jp/blog/2007-10-windowsapache22-odbc-basic.html</dd>\n\n</dl>\n***\n\n## Steps - How to build \"**apr_dbd_oracle.so**\"\n### Environment\n- OracleLinux 6.7 installed (Red Hat Enterprise Linux Server 6.7)\n\n```sh:/etc/issue\nOracle Linux Server release 6.7\n```\n\n### Required : PCRE - Perl Compatible Regular Expressions\n\n `# wget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.37.tar.gz`\n `# tar zxvf pcre-8.37.tar.gz`\n `# cd pcre-8.37`\n `# ./configure`\n `# make install`\n\n### Oracle Instant Client 11.2.0.4.0\nhttp://www.oracle.com/technetwork/topics/linuxx86-64soft-092277.html\n\n - oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm\n - oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm\n - oracle-instantclient11.2-sqlplus-11.2.0.4.0-1.x86_64.rpm  (optional)\n\n `# rpm -UVh oracle-instantclient11.2-basic-11.2.0.4.0-1.x86_64.rpm`\n `# rpm -UVh oracle-instantclient11.2-devel-11.2.0.4.0-1.x86_64.rpm`\n\n\n**/usr/include/oracle/11.2/client64 -> /usr/lib/oracle/11.2/client64/include**\n `# ln -s /usr/include/oracle/11.2/client64 /usr/lib/oracle11.2/client64/include`\n\n**ORACLE environment variables**\n\n\n```sh:/~/.bashrc\nexport ORACLE_HOME=/usr/lib/oracle/11.2/client64\nexport LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH\nexport PATH=$PATH:$ORACLE_HOME/bin\nCPPFLAGS=-I/usr/include/oracle/11.2/client64; export CPPFLAGS\nLDFLAGS=-L/usr/lib/oracle/11.2/client64; export LDFLAGS\n```\n\n\n### apache 2.4.18 / apr 1.5.2 / apr-util 1.5.4\n\n 1. apr\n 2.  -> apr-util\n 3.  --> apache \n\n `# wget http://ftp.yz.yamagata-u.ac.jp/pub/network/apache//httpd/httpd-2.4.18.tar.gz`\n `# tar zxvf httpd-2.4.18.tar.gz`\n `# wget http://ftp.kddilabs.jp/infosystems/apache/apr/apr-1.5.2.tar.gz`\n `# tar zxvf apr-1.5.2.tar.gz`\n `# wget http://ftp.kddilabs.jp/infosystems/apache/apr/apr-util-1.5.4.tar.gz`\n `# tar zxvf apr-util-1.5.4.tar.gz`\n\n\n#### apr 1.5.2\n\n `# cd apr-1.5.2`\n `# ./configure`\n `# make`\n `# make install`\n\n\n#### apr-util 1.5.4\n\n `# cd apr-util-1.5.4`\n `# ./configure --with-apr=/usr/local/apr --with-oracle=/usr/lib/oracle/11.2/client64 --with-oracle-include=/usr/include/oracle/11.2/client64/`\n `# make`\n `# make install`\n\n **Now we got \"apr_dbd_oracle.so\"**\n `# ls -aslrt /usr/local/apr/lib/apr-util-1`\n\n```sh:ls\n 0 lrwxrwxrwx 1 root root    20 Mar  6 18:08 apr_dbd_sqlite3.so -> apr_dbd_sqlite3-1.so\n 4 -rwxr-xr-x 1 root root  1004 Mar  6 18:08 apr_dbd_sqlite3.la\n64 -rw-r--r-- 1 root root 59680 Mar  6 18:08 apr_dbd_sqlite3.a\n48 -rwxr-xr-x 1 root root 47016 Mar  6 18:08 apr_dbd_sqlite3-1.so\n 0 lrwxrwxrwx 1 root root    18 Mar  6 18:08 apr_dbd_pgsql.so -> apr_dbd_pgsql-1.so\n 4 -rwxr-xr-x 1 root root   998 Mar  6 18:08 apr_dbd_pgsql.la\n80 -rw-r--r-- 1 root root 76214 Mar  6 18:08 apr_dbd_pgsql.a\n64 -rwxr-xr-x 1 root root 57639 Mar  6 18:08 apr_dbd_pgsql-1.so\n 0 lrwxrwxrwx 1 root root    19 Mar  6 18:08 apr_dbd_oracle.so -> apr_dbd_oracle-1.so\n 4 -rwxr-xr-x 1 root root  1068 Mar  6 18:08 apr_dbd_oracle.la\n92 -rw-r--r-- 1 root root 86460 Mar  6 18:08 apr_dbd_oracle.a\n72 -rwxr-xr-x 1 root root 67999 Mar  6 18:08 apr_dbd_oracle-1.so\n 4 drwxr-xr-x 2 root root  4096 Mar  6 18:08 .\n 4 drwxr-xr-x 4 root root  4096 Mar  6 18:08 ..\n```\n\n\n\n\n#### apache 2.4.18\n\n `# cd httpd-2.4.18`\n `# CPPFLAGS=-I/usr/include/oracle/11.2/client64; export CPPFLAGS`\n `# LDFLAGS=-L/usr/lib/oracle/11.2/client64; export LDFLAGS`\n `# ./configure`\n `# make`\n `# make install`\n\n `# /usr/local/apache2/bin/httpd -V`\n\n\n\n\n## Steps - How to configure httpd.conf for mod_dbd Oracle module\"\n\n**/usr/local/apache2/conf/httpd.conf**\n  uncomment dbd_module to be loaded\n\n```conf:httpd.conf\nLoadModule dbd_module modules/mod_dbd.so\n```\n\n\n\n**/usr/local/apache2/conf/default.conf**\n   describe DBD driver, DB connection string, SQL to be executed, rewrite map rule\n\n```conf:default.conf\nDBDriver oracle\nDBDParams \"user=ngas pass=ngas$dba dbname=ALMA10 server=(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=133.40.204.77)(PORT=1521)))(CONNECT_DATA=(SERVICE_N\nAME=alma10.arc.ea)))\"\n\nDBDMin 4\nDBDKeep 8\nDBDMax 20\nDBDExptime 300\n\n#DBDPrepareSQL \"select 'file://'||FILE_NAME from NGAS_FILES where FILE_ID = @KEY\" map_select\n\nRewriteMap ngas \"dbd: select 'http://' || regexp_replace(HOST_ID,':[0-9.]+') || '.mtk.nao.ac.jp' || MOUNT_POINT || '/'|| FILE_NAME from NGAS.NGAS_FILES f, NGAS.NGA\nS_DISKS d where f.DISK_ID = d.DISK_ID and f.FILE_ID = %s\"\n\n\nRewriteEngine On\n\nRewriteCond %{QUERY_STRING} ^file_id=(.*)$\nRewriteRule ^/RETRIEVE.* ${ngas:%1} [R,L]\n\n```\n\n", "tags": ["Apache", "apache\u30e2\u30b8\u30e5\u30fc\u30eb", "mod_rewrite", "oracle", "mod_dbd"]}