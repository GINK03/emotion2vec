{"context": "\u3044\u304f\u3064\u304b\u306e\u30b5\u30a4\u30c8\u3067\u3001S3\u306eObject\u306e\u64cd\u4f5c\u3092\u8abf\u3079\u305f\u306e\u3067\u3059\u304c\u3001\u6709\u540d\u306a\u30b5\u30a4\u30c8\u3067\u3082\u3001\u79c1\u304c\u671b\u3093\u3066\u3044\u305f\u51e6\u7406\u304c\u4e00\u90e8\u6e80\u305f\u3055\u308c\u3066\u3044\u306a\u3044\uff081,000\u4ef6\u4ee5\u4e0a\u306eObject\u306e\u64cd\u4f5c\u304c\u51fa\u6765\u306a\u3044\u306a\u3069)\u304b\u3063\u305f\u306e\u3067\u3001\u4eca\u56de go-lang \u3067\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u6ce8\u610f\u70b9\n\nAWS \u306e API \u306e\u4ed5\u69d8\u3067\u3001\u4e00\u5ea6\u306b\uff11\uff0c\uff10\uff10\uff10\u4ef6\u307e\u3067\u306e Object \u3057\u304b\u53d6\u5f97\u3067\u304d\u306a\u3044\nec2 \u4e0a\u3067\u5b9f\u884c\u3057\u305f\u65b9\u304c\u3001\u6599\u91d1\u3092\u6291\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306f\u305a\n\n\n\u524d\u63d0\u6761\u4ef6\n\n\nAWS CLI \u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u3002\n\n\n\u5b9f\u88c5\n\npackage main\n\nimport (\n    \"flag\"\n    \"fmt\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n)\n\nvar bucket string\n\n// Regsion\nconst Region = \"us-west-1\"\n\nfunc main() {\n    flag.Parse()\n    fmt.Println(\"flag.Args: \", flag.Args())\n    fmt.Println(flag.Args()[0])\n\n    bucket = flag.Args()[0]\n\n    getS3Objects(\"prefix/\")\n\n}\n\nfunc getS3Objects(prefix string) bool {\n\n    var re = Region\n    cli := s3.New(&aws.Config{Region: &re})\n\n    params := &s3.ListObjectsInput{\n        Bucket: aws.String(bucket),\n        Prefix: aws.String(prefix),\n    }\n\n    cli.ListObjectsPages(params, addAclPublicRead)\n\n    return true\n}\n\nfunc addAclPublicRead(resps *s3.ListObjectsOutput, more bool) bool {\n\n    var re = Region\n    cli := s3.New(&aws.Config{Region: &re})\n\n    for n := 0; n < len(resps.Contents); n++ {\n        params := &s3.PutObjectAclInput{\n            Bucket: aws.String(bucket),\n            Key:    aws.String(*resps.Contents[n].Key),\n            ACL:    aws.String(s3.ObjectCannedACLPublicRead),\n        }\n        resp, err := cli.PutObjectAcl(params)\n\n        if err != nil {\n            fmt.Println(err.Error())\n            return false\n        }\n\n        // Pretty-print the response data.\n        fmt.Println(resp)\n    }\n    return true\n}\n\n\u3044\u304f\u3064\u304b\u306e\u30b5\u30a4\u30c8\u3067\u3001S3\u306eObject\u306e\u64cd\u4f5c\u3092\u8abf\u3079\u305f\u306e\u3067\u3059\u304c\u3001\u6709\u540d\u306a\u30b5\u30a4\u30c8\u3067\u3082\u3001\u79c1\u304c\u671b\u3093\u3066\u3044\u305f\u51e6\u7406\u304c\u4e00\u90e8\u6e80\u305f\u3055\u308c\u3066\u3044\u306a\u3044\uff081,000\u4ef6\u4ee5\u4e0a\u306eObject\u306e\u64cd\u4f5c\u304c\u51fa\u6765\u306a\u3044\u306a\u3069)\u304b\u3063\u305f\u306e\u3067\u3001\u4eca\u56de go-lang \u3067\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## \u6ce8\u610f\u70b9\n\n- AWS \u306e API \u306e\u4ed5\u69d8\u3067\u3001\u4e00\u5ea6\u306b\uff11\uff0c\uff10\uff10\uff10\u4ef6\u307e\u3067\u306e Object \u3057\u304b\u53d6\u5f97\u3067\u304d\u306a\u3044\n- ec2 \u4e0a\u3067\u5b9f\u884c\u3057\u305f\u65b9\u304c\u3001\u6599\u91d1\u3092\u6291\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306f\u305a\n\n## \u524d\u63d0\u6761\u4ef6\n\n- [AWS CLI](https://aws.amazon.com/jp/cli/) \u306e\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u3002\n\n## \u5b9f\u88c5\n\n```go\n\npackage main\n\nimport (\n\t\"flag\"\n\t\"fmt\"\n\n\t\"github.com/aws/aws-sdk-go/aws\"\n\t\"github.com/aws/aws-sdk-go/service/s3\"\n)\n\nvar bucket string\n\n// Regsion\nconst Region = \"us-west-1\"\n\nfunc main() {\n\tflag.Parse()\n\tfmt.Println(\"flag.Args: \", flag.Args())\n\tfmt.Println(flag.Args()[0])\n\n\tbucket = flag.Args()[0]\n\n\tgetS3Objects(\"prefix/\")\n\n}\n\nfunc getS3Objects(prefix string) bool {\n\n\tvar re = Region\n\tcli := s3.New(&aws.Config{Region: &re})\n\n\tparams := &s3.ListObjectsInput{\n\t\tBucket: aws.String(bucket),\n\t\tPrefix: aws.String(prefix),\n\t}\n\n\tcli.ListObjectsPages(params, addAclPublicRead)\n\n\treturn true\n}\n\nfunc addAclPublicRead(resps *s3.ListObjectsOutput, more bool) bool {\n\n\tvar re = Region\n\tcli := s3.New(&aws.Config{Region: &re})\n\n\tfor n := 0; n < len(resps.Contents); n++ {\n\t\tparams := &s3.PutObjectAclInput{\n\t\t\tBucket: aws.String(bucket),\n\t\t\tKey:    aws.String(*resps.Contents[n].Key),\n\t\t\tACL:    aws.String(s3.ObjectCannedACLPublicRead),\n\t\t}\n\t\tresp, err := cli.PutObjectAcl(params)\n\n\t\tif err != nil {\n\t\t\tfmt.Println(err.Error())\n\t\t\treturn false\n\t\t}\n\n\t\t// Pretty-print the response data.\n\t\tfmt.Println(resp)\n\t}\n\treturn true\n}\n```\n", "tags": ["golang", "Go", "AWS", "S3"]}