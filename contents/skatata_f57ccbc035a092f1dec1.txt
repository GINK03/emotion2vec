{"context": " More than 1 year has passed since last update.\u753b\u50cf\u3092\u975e\u540c\u671f\u3067\u8aad\u307f\u3053\u3093\u3067\u63cf\u753b\u6642\u306b\u56fa\u307e\u308b\u3053\u3068\u3092\u907f\u3051\u308b\n\u30b5\u30f3\u30d7\u30eb\u306740\u500b\u306e\u753b\u50cf\u3092\n\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u3042\u308a\u3067\u63cf\u753b\n\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3057\u3067\u63cf\u753b\n\u3057\u3066\u307f\u308b\u3002\n\nResourceLoadScene.h\n#ifndef __Sample__ResourceLoadScene__\n#define __Sample__ResourceLoadScene__\n\n#include <iostream>\n#include \"cocos2d.h\"\n\nusing namespace cocos2d;\n\nclass ResourceLoadScene : public Layer\n{\npublic:\n    static Scene* createScene();\n    virtual bool init();\n    CREATE_FUNC(ResourceLoadScene);\n    ResourceLoadScene();\n    ~ResourceLoadScene();\nprivate:\n    int _loadCount;\n    double getSec();\n    void loadResource();\n    void didLoadResource(Texture2D *texture);\n    void removeResourceCache();\n    void drawSprite();\n};\n#endif\n\n\n\nResourceLoadScene.h\n#include \"ResourceLoadScene.h\"\nUSING_NS_CC;\n#define IMAGE_COUNT 40\n\nScene* ResourceLoadScene::createScene()\n{\n    auto scene = Scene::create();\n    auto layer = ResourceLoadScene::create();\n    scene->addChild(layer);\n    return scene;\n}\n\nResourceLoadScene::ResourceLoadScene()\n{\n    this->_loadCount = IMAGE_COUNT;\n}\n\nResourceLoadScene::~ResourceLoadScene()\n{\n}\n\nbool ResourceLoadScene::init()\n{\n    if(!Layer::init()){\n        return false;\n    }\n    this->loadResource();\n    return true;\n}\n\n//=======================================================\n/// \u79d2\u6570\u53d6\u5f97\n//=======================================================\ndouble ResourceLoadScene::getSec(){\n    timeval val;\n    gettimeofday(&val, nullptr);\n    return (val.tv_sec) + (val.tv_usec) * 1e-6;\n}\n\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u975e\u540c\u671f\u8aad\u307f\u8fbc\u307f\n//=======================================================\nvoid ResourceLoadScene::loadResource(){\n    TextureCache *cache = Director::getInstance()->getTextureCache();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        cache->addImageAsync(StringUtils::format(\"%d.png\", i).c_str(), CC_CALLBACK_1(ResourceLoadScene::didLoadResource, this));\n    }\n}\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u975e\u540c\u671f\u8aad\u307f\u8fbc\u307f\u5b8c\u4e86\n//=======================================================\nvoid ResourceLoadScene::didLoadResource(Texture2D *texture){\n    this->_loadCount--;\n    if(this->_loadCount <= 0){\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u63cf\u753b\n        this->drawSprite();\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u524a\u9664\n        this->removeAllChildren();\n        this->removeResourceCache();\n        // \u666e\u901a\u306b\u63cf\u753b\n        this->drawSprite();\n    }\n}\n//=======================================================\n/// \u30b9\u30d7\u30e9\u30a4\u30c8\u63cf\u753b\n//=======================================================\nvoid ResourceLoadScene::drawSprite(){\n    log(\"START drawSprite --------\");\n    double tStart = getSec();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        Sprite *sp = Sprite::create(StringUtils::format(\"%d.png\", i).c_str());\n        this->addChild(sp);\n    }\n    double tEnd = getSec();\n    log(\" END  drawSprite -------- %f\", tEnd - tStart);\n}\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u524a\u9664\n//=======================================================\nvoid ResourceLoadScene::removeResourceCache(){\n    TextureCache *cache = Director::getInstance()->getTextureCache();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        cache->removeTextureForKey(StringUtils::format(\"%d.png\", i).c_str());\n    }\n}\n\n\n\u7d50\u679c\u306f\ncocos2d: START drawSprite --------\ncocos2d:  END  drawSprite -------- 0.000136\ncocos2d: START drawSprite --------\ncocos2d:  END  drawSprite -------- 0.399950\n\u753b\u50cf\u3092\u975e\u540c\u671f\u3067\u8aad\u307f\u3053\u3093\u3067\u63cf\u753b\u6642\u306b\u56fa\u307e\u308b\u3053\u3068\u3092\u907f\u3051\u308b\n\n\u30b5\u30f3\u30d7\u30eb\u306740\u500b\u306e\u753b\u50cf\u3092\n**\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u3042\u308a\u3067\u63cf\u753b**\n**\u30fb\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3057\u3067\u63cf\u753b**\n\u3057\u3066\u307f\u308b\u3002\n\n```lang:ResourceLoadScene.h\n#ifndef __Sample__ResourceLoadScene__\n#define __Sample__ResourceLoadScene__\n\n#include <iostream>\n#include \"cocos2d.h\"\n\nusing namespace cocos2d;\n\nclass ResourceLoadScene : public Layer\n{\npublic:\n    static Scene* createScene();\n    virtual bool init();\n    CREATE_FUNC(ResourceLoadScene);\n    ResourceLoadScene();\n\t~ResourceLoadScene();\nprivate:\n    int _loadCount;\n    double getSec();\n    void loadResource();\n    void didLoadResource(Texture2D *texture);\n    void removeResourceCache();\n    void drawSprite();\n};\n#endif\n```\n\n```lang:ResourceLoadScene.h\n#include \"ResourceLoadScene.h\"\nUSING_NS_CC;\n#define IMAGE_COUNT 40\n\nScene* ResourceLoadScene::createScene()\n{\n    auto scene = Scene::create();\n    auto layer = ResourceLoadScene::create();\n    scene->addChild(layer);\n    return scene;\n}\n\nResourceLoadScene::ResourceLoadScene()\n{\n    this->_loadCount = IMAGE_COUNT;\n}\n\nResourceLoadScene::~ResourceLoadScene()\n{\n}\n\nbool ResourceLoadScene::init()\n{\n    if(!Layer::init()){\n        return false;\n    }\n    this->loadResource();\n    return true;\n}\n\n//=======================================================\n/// \u79d2\u6570\u53d6\u5f97\n//=======================================================\ndouble ResourceLoadScene::getSec(){\n    timeval val;\n    gettimeofday(&val, nullptr);\n    return (val.tv_sec) + (val.tv_usec) * 1e-6;\n}\n\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u975e\u540c\u671f\u8aad\u307f\u8fbc\u307f\n//=======================================================\nvoid ResourceLoadScene::loadResource(){\n    TextureCache *cache = Director::getInstance()->getTextureCache();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        cache->addImageAsync(StringUtils::format(\"%d.png\", i).c_str(), CC_CALLBACK_1(ResourceLoadScene::didLoadResource, this));\n    }\n}\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u975e\u540c\u671f\u8aad\u307f\u8fbc\u307f\u5b8c\u4e86\n//=======================================================\nvoid ResourceLoadScene::didLoadResource(Texture2D *texture){\n    this->_loadCount--;\n    if(this->_loadCount <= 0){\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u63cf\u753b\n        this->drawSprite();\n        // \u30ad\u30e3\u30c3\u30b7\u30e5\u524a\u9664\n        this->removeAllChildren();\n        this->removeResourceCache();\n        // \u666e\u901a\u306b\u63cf\u753b\n        this->drawSprite();\n    }\n}\n//=======================================================\n/// \u30b9\u30d7\u30e9\u30a4\u30c8\u63cf\u753b\n//=======================================================\nvoid ResourceLoadScene::drawSprite(){\n    log(\"START drawSprite --------\");\n    double tStart = getSec();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        Sprite *sp = Sprite::create(StringUtils::format(\"%d.png\", i).c_str());\n        this->addChild(sp);\n    }\n    double tEnd = getSec();\n    log(\" END  drawSprite -------- %f\", tEnd - tStart);\n}\n//=======================================================\n/// \u30c6\u30af\u30b9\u30c1\u30e3\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u524a\u9664\n//=======================================================\nvoid ResourceLoadScene::removeResourceCache(){\n    TextureCache *cache = Director::getInstance()->getTextureCache();\n    for(int i = 0; i < IMAGE_COUNT; i++){\n        cache->removeTextureForKey(StringUtils::format(\"%d.png\", i).c_str());\n    }\n}\n```\n\n\u7d50\u679c\u306f\n\n`cocos2d: START drawSprite --------\ncocos2d:  END  drawSprite -------- 0.000136\ncocos2d: START drawSprite --------\ncocos2d:  END  drawSprite -------- 0.399950`\n", "tags": ["cocos2d-x3.x"]}