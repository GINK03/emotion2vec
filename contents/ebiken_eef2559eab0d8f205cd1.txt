{"context": " More than 1 year has passed since last update.Ubuntu 14.04.04 \u306b\u3066 /etc/network/interfaces \u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u306b\u3088\u308a\u3001\u8d77\u52d5\u6642\u306b veth pair, bridge, network namespace (netns) \u3092\u4f5c\u6210\u3057\u7e4b\u304c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n\u306a\u304a\u3001 \"/etc/network/interfaces \u3067\u306e veth \u306e\u4f5c\u308a\u65b9\" \u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/kwi/items/c82ea2839e2df5be780f\n\nbridge-utils\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n  $ sudo apt-get update\n  $ sudo apt-get install bridge-utils\n\n\n/etc/network/interfaces \u306e\u7de8\u96c6\n$ cat /etc/network/interfaces\n# interfaces(5) file used by ifup(8) and ifdown(8)\nauto lo\niface lo inet loopback\n\nauto veth1\niface veth1 inet manual\n    pre-up ip link add veth1 type veth peer name gveth1\n    pre-up ip netns add host1\n    pre-up ip link set gveth1 netns host1\n    pre-up ip netns exec host1 ip link set gveth1 up\n    pre-up ip netns exec host1 ip addr add 10.0.0.1/24 brd + dev gveth1\n    post-down ip link del veth1\n\nauto veth2\niface veth2 inet manual\n    pre-up ip link add veth2 type veth peer name gveth2\n    pre-up ip netns add host2\n    pre-up ip link set gveth2 netns host2\n    pre-up ip netns exec host2 ip link set gveth2 up\n    pre-up ip netns exec host2 ip addr add 10.0.0.2/24 brd + dev gveth2\n    post-down ip link del veth2\n\nauto br1\niface br1 inet manual\n    bridge_ports veth1 veth2\n\n\n\u518d\u8d77\u52d5\u5f8c\u3001\u8a2d\u5b9a\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\n\nbridge br1, veth1/veth2 \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\nveth1/veth2 \u304c\u4f5c\u6210\u3055\u308c\u3001br1 \u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u4e8b\uff08master br1\uff09\u3092\u78ba\u8a8d\u3002\n\n$ ip a\n6: veth1@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br1 state UP group default qlen 1000\n    link/ether aa:6d:fb:ec:14:9e brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::a86d:fbff:feec:149e/64 scope link\n       valid_lft forever preferred_lft forever\n7: br1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default\n    link/ether 0e:10:4f:3b:06:1c brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::a86d:fbff:feec:149e/64 scope link\n       valid_lft forever preferred_lft forever\n9: veth2@if8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br1 state UP group default qlen 1000\n    link/ether 0e:10:4f:3b:06:1c brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::c10:4fff:fe3b:61c/64 scope link\n       valid_lft forever preferred_lft forever\n\n\nhost1/host2 \u305d\u308c\u305e\u308c\u306enetns\u306bgveth1/gveth2\u304c\u4f5c\u6210\u3055\u308c\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n\n$ sudo ip netns exec host1 ip a\n1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n5: gveth1@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 1a:f4:12:ed:24:5c brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global gveth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::18f4:12ff:feed:245c/64 scope link\n       valid_lft forever preferred_lft forever\n\n$ sudo ip netns exec host2 ip a\n1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n8: gveth2@if9: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 1a:8f:fe:ed:55:06 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.2/24 brd 10.0.0.255 scope global gveth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::188f:feff:feed:5506/64 scope link\n       valid_lft forever preferred_lft forever\n\n\nnetns \u9593\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067 ping \u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\n\n$ sudo ip netns exec host1 ping 10.0.0.2\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.\n64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.126 ms\n64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.047 ms\n\n$ sudo ip netns exec host2 ping 10.0.0.1\nPING 10.0.0.1 (10.0.0.1) 56(84) bytes of data.\n64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=0.116 ms\n64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.041 ms\n\n\nUbuntu 14.04.04 \u306b\u3066 /etc/network/interfaces \u306b\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u4e8b\u306b\u3088\u308a\u3001\u8d77\u52d5\u6642\u306b veth pair, bridge, network namespace (netns) \u3092\u4f5c\u6210\u3057\u7e4b\u304c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n\n\u306a\u304a\u3001 \"/etc/network/interfaces \u3067\u306e veth \u306e\u4f5c\u308a\u65b9\" \u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/kwi/items/c82ea2839e2df5be780f\n\n## bridge-utils\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```shell-session\n  $ sudo apt-get update\n  $ sudo apt-get install bridge-utils\n```\n\n## /etc/network/interfaces \u306e\u7de8\u96c6\n```shell-session\n$ cat /etc/network/interfaces\n# interfaces(5) file used by ifup(8) and ifdown(8)\nauto lo\niface lo inet loopback\n\nauto veth1\niface veth1 inet manual\n    pre-up ip link add veth1 type veth peer name gveth1\n    pre-up ip netns add host1\n    pre-up ip link set gveth1 netns host1\n    pre-up ip netns exec host1 ip link set gveth1 up\n    pre-up ip netns exec host1 ip addr add 10.0.0.1/24 brd + dev gveth1\n    post-down ip link del veth1\n\nauto veth2\niface veth2 inet manual\n    pre-up ip link add veth2 type veth peer name gveth2\n    pre-up ip netns add host2\n    pre-up ip link set gveth2 netns host2\n    pre-up ip netns exec host2 ip link set gveth2 up\n    pre-up ip netns exec host2 ip addr add 10.0.0.2/24 brd + dev gveth2\n    post-down ip link del veth2\n\nauto br1\niface br1 inet manual\n    bridge_ports veth1 veth2\n```\n\n## \u518d\u8d77\u52d5\u5f8c\u3001\u8a2d\u5b9a\u304c\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\n* bridge br1, veth1/veth2 \u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\n* veth1/veth2 \u304c\u4f5c\u6210\u3055\u308c\u3001br1 \u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u308b\u4e8b\uff08master br1\uff09\u3092\u78ba\u8a8d\u3002\n\n```shell-session\n$ ip a\n6: veth1@if5: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br1 state UP group default qlen 1000\n    link/ether aa:6d:fb:ec:14:9e brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::a86d:fbff:feec:149e/64 scope link\n       valid_lft forever preferred_lft forever\n7: br1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default\n    link/ether 0e:10:4f:3b:06:1c brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::a86d:fbff:feec:149e/64 scope link\n       valid_lft forever preferred_lft forever\n9: veth2@if8: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast master br1 state UP group default qlen 1000\n    link/ether 0e:10:4f:3b:06:1c brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::c10:4fff:fe3b:61c/64 scope link\n       valid_lft forever preferred_lft forever\n```\n\n* host1/host2 \u305d\u308c\u305e\u308c\u306enetns\u306bgveth1/gveth2\u304c\u4f5c\u6210\u3055\u308c\u30a2\u30c9\u30ec\u30b9\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u4e8b\u3092\u78ba\u8a8d\u3002\n\n```shell-session\n$ sudo ip netns exec host1 ip a\n1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n5: gveth1@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 1a:f4:12:ed:24:5c brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.1/24 brd 10.0.0.255 scope global gveth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::18f4:12ff:feed:245c/64 scope link\n       valid_lft forever preferred_lft forever\n\n$ sudo ip netns exec host2 ip a\n1: lo: <LOOPBACK> mtu 65536 qdisc noop state DOWN group default\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n8: gveth2@if9: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 1a:8f:fe:ed:55:06 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.0.2/24 brd 10.0.0.255 scope global gveth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::188f:feff:feed:5506/64 scope link\n       valid_lft forever preferred_lft forever\n```\n\n* netns \u9593\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067 ping \u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\n\n```shell-session\n$ sudo ip netns exec host1 ping 10.0.0.2\nPING 10.0.0.2 (10.0.0.2) 56(84) bytes of data.\n64 bytes from 10.0.0.2: icmp_seq=1 ttl=64 time=0.126 ms\n64 bytes from 10.0.0.2: icmp_seq=2 ttl=64 time=0.047 ms\n\n$ sudo ip netns exec host2 ping 10.0.0.1\nPING 10.0.0.1 (10.0.0.1) 56(84) bytes of data.\n64 bytes from 10.0.0.1: icmp_seq=1 ttl=64 time=0.116 ms\n64 bytes from 10.0.0.1: icmp_seq=2 ttl=64 time=0.041 ms\n```\n", "tags": ["Linux", "Network", "veth", "Ubuntu", "netns"]}