{"tags": ["AWS", "ECS"], "context": " More than 1 year has passed since last update.Amazon EC2 Container Service(ECS)\u3092GUI\u304b\u3089\u8a66\u3057\u3066AWS\u5074\u3067\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30ebWeb\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2\nGUI\u304b\u3089ECS\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u305f\u306e\u3067\u3001\u6b21\u306bCLI\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002nginx\u304c\u52d5\u4f5c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\n\nAWS CLI\u304c\u4f7f\u3048\u308b\u3053\u3068\nDocker\u5b9f\u884c\u74b0\u5883\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\n\nDockerHub\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\n\n\n\u53c2\u8003\n\nAmazon EC2 Container Service (ECS)\u3092\u8a66\u3057\u3066\u307f\u305f\nAmazon EC2 Container Service(ECS)\u3067\u9759\u7684Web\u30b5\u30a4\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\n\u3068\u3044\u3046\u304b\u307b\u3068\u3093\u3069\u4e0a\u8a18\u3092CLI\u3092\u30e1\u30a4\u30f3\u3067\u518d\u5ea6\u3084\u3063\u3066\u307f\u305f\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n\nDocker\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\nAmazon EC2 Container Service(ECS)\u3067\u9759\u7684Web\u30b5\u30a4\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\n\u4e0a\u8a18\u30ea\u30f3\u30af\u306e\u901a\u308a\u3001Dockerfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ mkdir nginx\n$ cd nginx\n$ vi Dockerfile\nFROM nginx\nCOPY html /usr/share/nginx/html\n\n\u307e\u305f\u3001\u30b3\u30d4\u30fc\u3059\u308bHTML\u3082\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ mkdir html\n$ vi html/index.html\n<html>\n<head><title>Amazon ECS deployed!</title></head>\n<body><h1>Amazon ECS deployed!</h1></body>\n</html>\n\ndocker build\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30d3\u30eb\u30c9\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u5316\u3057\u307e\u3059\u3002toshihirock\u306e\u90e8\u5206\u306fDockerhub\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n$docker build -t toshihirock/mynginx .\n\n\u8a66\u3057\u306b\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\n$docker run -d -p 80:80 toshihirock/mynginx\n1eff877751a7\n$curl http://localhost\n<html>\n<head><title>Amazon ECS deployed!</title></head>\n<body><h1>Amazon ECS deployed!</h1></body>\n</html>\n\ndocker inspect\u3092\u4f7f\u3046\u8a2d\u5b9a\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002Cmd\u306b\u4ee5\u4e0b\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u3001 deamon off(\u3064\u307e\u308a\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\uff09\u3067\u5b9f\u884c\u3055\u308c\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\uff08\u30b3\u30de\u30f3\u30c9\u3092\u30d5\u30a9\u30a2\u30b0\u30e9\u30f3\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u306a\u3044\u3068\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3059\u308b\u306e\u3067)\n        \"Cmd\": [\n            \"nginx\",\n            \"-g\",\n            \"daemon off;\"\n        ],\n\n\nDockerhub\u3078\u306e\u767b\u9332\n\u78ba\u8a8d\u304c\u3067\u304d\u305f\u3089Dockerhub\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\u307e\u305a\u3001Dockerhub\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n$docker login\n\n\u6b21\u306bdocker push\u3067Dockerhub\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n$docker push toshihirock/mynginx\n\n\nECS\u7528\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308bEC2\u304b\u3089ECS\u306b\u30a2\u30af\u30bb\u30b9\u3092\u884c\u3046\u305f\u3081\u306b\u5fc5\u8981\u306aIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\u4f5c\u6210\u6642\u306b\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\nAWS CLI\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3092\u52d5\u304b\u3057\u3066\u307f\u308b(IAM\u7de83: \u30ed\u30fc\u30eb)\n\u6700\u521d\u306b\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nrole.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n     {\n       \"Action\": \"sts:AssumeRole\",\n       \"Principal\": {\n         \"Service\": \"ec2.amazonaws.com\"\n        },\n        \"Effect\": \"Allow\",\n        \"Sid\": \"\"\n     }\n  ]\n}\n\n\n\u4f5c\u6210\u5f8c\u3001\u4ee5\u4e0b\u306e\u64cd\u4f5c\u3067\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n# \u4f5c\u6210\n$aws iam create-role --role-name ecs-full-access --assume-role-policy-document file://role.json\n\n#\u78ba\u8a8d\n$aws iam get-role --role-name ecs-full-access\n\n\u6b21\u306bECS\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u3092\u3057\u307e\u3059\u3002\n\nrole-policy.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"ecs:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n$aws iam put-role-policy --role-name ecs-full-access --policy-name  ECSFullAccess --policy-document file://role-policy.json\n\n\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ aws iam list-role-policies --role-name ecs-full-access\n{\n    \"PolicyNames\": [\n        \"ECSFullAccess\"\n    ]\n}\n\n\u5148\u307b\u3069\u306e\u30dd\u30ea\u30b7\u30fc\u304c\u4f5c\u6210\u3057\u305f\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\nEC2\u306eIAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$aws iam create-instance-profile --instance-profile-name ecs-full-access\n\n\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3055\u305b\u307e\u3059\u3002\n$aws iam add-role-to-instance-profile --instance-profile-name ecs-full-access --role-name ecs-full-access\n\n\n\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u4f5c\u3055\u305b\u308bEC2\u7fa4\u307e\u3068\u3081\u308b\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\n$aws ecs create-cluster --cluster-name MyCluster\n\n\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u3092\u78ba\u8a8d\u3057\u307e\u3059\n\n$aws ecs describe-clusters --clusters MyCluster\n\n\nECS-Optimized Amazon Linux\u306e\u8d77\u52d5\u3068\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\nLaunching an Amazon ECS Container Instance\nCoreOS\u3082\u4f7f\u3048\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u6700\u65b0\u306eAmazonLinux\u306eECS ready\u306aAMI\u3092\u4f7f\u3044\u307e\u3059\u300220150623\u73fe\u5728\u3001ap-northeast1\u3067\u4f7f\u3048\u308b\u6700\u65b0\u306e\u3082\u306e\u306fami-fa12b7fa\u3060\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u307e\u305f\u3001\u5148\u307b\u3069\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u306b\u8d77\u52d5\u3059\u308bEC2\u306eUserData\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n#!/bin/bash\necho ECS_CLUSTER=MyCluster >> /etc/ecs/ecs.config\n\nCLI\u304b\u3089\u64cd\u4f5c\u3059\u308b\u5834\u5408\u3001UserData\u306fBase64\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n--subnet-id\u3001--security-group-ids\u3001--key-name\u306b\u3064\u3044\u3066\u306f\u9069\u5b9c\u81ea\u5206\u306e\u74b0\u5883\u306b\u3042\u3063\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3064\u3044\u3066\u306f80\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n$aws ec2 run-instances \\\n--image-id  ami-fa12b7fa \\\n--instance-type t2.micro \\\n--subnet-id subnet-d949e1ae \\\n--iam-instance-profile Name=ecs-full-access \\\n--user-data IyEvYmluL2Jhc2gNCmVjaG8gRUNTX0NMVVNURVI9TXlDbHVzdGVyID4+IC9ldGMvZWNzL2Vjcy5jb25maWc= \\\n--security-group-ids sg-baca56df \\\n--key-name hogeFugaKey \\\n|jq -r '.Instances[].InstanceId'\n\n\u4e0a\u8a18\u5b9f\u884c\u306b\u3088\u308a\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u307f\u51fa\u529b\u3059\u308b\u3088\u3046\u306bjq\u3067\u30d5\u30a3\u30eb\u30bf\u3057\u3066\u3044\u307e\u3059\u3002\n\u3042\u3068\u3067\u5229\u7528\u3059\u308b\u306e\u3067\u30e1\u30e2\u3057\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u3044\u3066\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306b\u5148\u307b\u3069\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u53c2\u52a0\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$aws ecs list-container-instances --cluster MyCluster\n{\n    \"containerInstanceArns\": [\n        \"arn:aws:ecs:ap-northeast-1:694273932022:container-instance/b16efbb0-c12f-4f74-bd2f-aa7756a5cc2d\"\n    ]\n}\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306bcontainerInstanceArns\u306b\u4e00\u3064\u5024\u304c\u5165\u3063\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\n\n\u30bf\u30b9\u30af\u306e\u8ffd\u52a0\n\u30bf\u30b9\u30af\uff08\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u8a73\u7d30\u3092\u307e\u3068\u3081\u305f\u3082\u306e\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u6307\u5b9a\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3067\u306e\u8a73\u7d30\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u6700\u521d\u306b\u4f5c\u6210\u3057\u305fnginx\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3059\u308b\u30bf\u30b9\u30af\u3092\u8a2d\u5b9a\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u3068\u30db\u30b9\u30c8\u3067\u306f80\u30dd\u30fc\u30c8\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u3057\u3066\u3044\u307e\u3059\u3002cpu\u3001memory\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30da\u30c3\u30af\u3092\u8868\u3057\u3001essential\u3092true\u306b\u3059\u308b\u3068\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3059\u308b\u3068\u30bf\u30b9\u30af\u3068\u3057\u3066\u5931\u6557\u3057\u305f\u3082\u306e\u3068\u3057\u3066\u307f\u306a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\nnginx-task.json\n[\n  {\n    \"image\": \"toshihirock/mynginx\",\n    \"name\": \"mynginx\",\n    \"cpu\": 10,\n    \"memory\": 500,\n    \"essential\": true,\n    \"environment\": [],\n    \"portMappings\": [\n      {\n        \"containerPort\": 80,\n        \"hostPort\": 80\n      }\n    ]\n  }\n]\n\n\n\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n$ aws ecs register-task-definition --family mynginx  --container-definitions file://nginx-task.json\n\n\u30bf\u30b9\u30af\u304c\u767b\u9332\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$aws ecs describe-task-definition --task-definition mynginx\n\n\u4e0a\u8a18\u3067\u306f\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u305f\u3060\u3051\u3067\u3001\u30af\u30e9\u30b9\u30bf\u3068\u306e\u95a2\u9023\u3065\u3051\u306f\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30af\u30e9\u30b9\u30bf\u3067\u4e0a\u8a18\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3055\u305b\u305f\u3044\u306e\u3067\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u306e--task-definition\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u306ffamily:revision\u3068\u3044\u3046\u5f62\u5f0f\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u4eca\u56de\u306e\u30bf\u30b9\u30af\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306f1\u306a\u306e\u3067mynginx:1\u3068\u3044\u3046\u6307\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n$aws ecs run-task --cluster MyCluster --task-definition mynginx:1\n{\n    \"failures\": [],\n    \"tasks\": [\n        {\n            \"taskArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\",\n            \"overrides\": {\n                \"containerOverrides\": [\n                    {\n                        \"name\": \"mynginx\"\n                    }\n                ]\n            },\n            \"lastStatus\": \"PENDING\",\n            \"containerInstanceArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:container-instance/f053e789-7aaf-4be7-a90c-2f868b2802f0\",\n            \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:cluster/MyCluster\",\n            \"desiredStatus\": \"RUNNING\",\n            \"taskDefinitionArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task-definition/mynginx3:1\",\n            \"containers\": [\n                {\n                    \"containerArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:container/18de6ec3-66b6-4b72-91a1-044c03ad60ba\",\n                    \"taskArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\",\n                    \"lastStatus\": \"PENDING\",\n                    \"name\": \"mynginx\"\n                }\n            ]\n        }\n    ]\n}\n\n\u767b\u9332\u76f4\u5f8c\u306flastStatus\u304cPENDDING\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u304a\u308a\u307e\u305b\u3093\u3002\u5c11\u3057\u6642\u9593\u3092\u304a\u3044\u3066\u304b\u3089\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002--tasks\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306b\u306f\u5148\u307b\u3069\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u305f\u6642\u306b\u8868\u793a\u3055\u308c\u305f\u30bf\u30b9\u30af\u306eARN(taskArn)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$aws ecs describe-tasks --cluster MyCluster --tasks arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\n\nlastStatus\u3092\u78ba\u8a8d\u3057\u3001PENDDING\u304cRUNNING\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3001\u6e96\u5099\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\nWeb\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u767b\u9332\u6642\u306b\u8868\u793a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u5229\u7528\u3057\u3066EC2\u306ePublicDNS\u540d\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n$aws ec2 describe-instances --instance-ids i-6004f292 |jq -r '.Reservations[].Instances[].PublicDnsName'\n\n\u4e0a\u8a18URL\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068nginx\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\u304a\u6383\u9664\n\u307e\u305a\u3001\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3057\u305f\u30bf\u30b9\u30af\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n$aws ecs stop-task --cluster MyCluster --task arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\n\n\u6b21\u306bECS\u3092\u52d5\u4f5c\u3055\u305b\u3066\u3044\u308bEC2\u3092terminate\u3057\u307e\u3059\u3002\n$aws ec2 terminate-instances --instance-ids i-6004f292\n\n\u6700\u5f8c\u306b\u30af\u30e9\u30b9\u30bf\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n# \u524a\u9664\n$aws ecs delete-cluster --cluster MyCluster\n\n#\u3000\u78ba\u8a8d\n$ aws ecs describe-clusters --clusters MyCluster\n{\n    \"clusters\": [\n        {\n            \"status\": \"INACTIVE\",\n            \"clusterName\": \"MyCluster\",\n            \"registeredContainerInstancesCount\": 0,\n            \"pendingTasksCount\": 0,\n            \"runningTasksCount\": 0,\n            \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:cluster/MyCluster\"\n        }\n    ],\n    \"failures\": []\n}\n\nstatus\u304cINACTIVE\u3068\u306a\u3063\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\nECS\u306e\u30bf\u30b9\u30af\u3001ECS\u7528\u306e\u30ed\u30fc\u30eb\u3092\u524a\u9664\u3057\u305f\u3044\u4eba\u306f\u5404\u81ea\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n[Amazon EC2 Container Service(ECS)\u3092GUI\u304b\u3089\u8a66\u3057\u3066AWS\u5074\u3067\u7528\u610f\u3057\u305f\u30b5\u30f3\u30d7\u30ebWeb\u30a2\u30d7\u30ea\u3092\u52d5\u304b\u3057\u305f\u3068\u304d\u306e\u30e1\u30e2](http://qiita.com/toshihirock/items/dfd42314158aff073e9d)\n\nGUI\u304b\u3089ECS\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u305f\u306e\u3067\u3001\u6b21\u306bCLI\u3092\u4f7f\u3063\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002nginx\u304c\u52d5\u4f5c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\u3057\u3001\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u524d\u63d0\n\n+ AWS CLI\u304c\u4f7f\u3048\u308b\u3053\u3068\n+ Docker\u5b9f\u884c\u74b0\u5883\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\n+ [DockerHub](https://hub.docker.com)\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u5b58\u5728\u3059\u308b\u3053\u3068\n\n# \u53c2\u8003\n\n+ [Amazon EC2 Container Service (ECS)\u3092\u8a66\u3057\u3066\u307f\u305f](http://dev.classmethod.jp/cloud/ecs-ataglance/)\n+ [Amazon EC2 Container Service(ECS)\u3067\u9759\u7684Web\u30b5\u30a4\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b](http://dev.classmethod.jp/cloud/aws/ecs-deploy-static-website/)\n\n\u3068\u3044\u3046\u304b\u307b\u3068\u3093\u3069\u4e0a\u8a18\u3092CLI\u3092\u30e1\u30a4\u30f3\u3067\u518d\u5ea6\u3084\u3063\u3066\u307f\u305f\u5f62\u306b\u306a\u308a\u307e\u3059\u3002\n\n# Docker\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\n\n[Amazon EC2 Container Service(ECS)\u3067\u9759\u7684Web\u30b5\u30a4\u30c8\u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b](http://dev.classmethod.jp/cloud/aws/ecs-deploy-static-website/)\n\n\u4e0a\u8a18\u30ea\u30f3\u30af\u306e\u901a\u308a\u3001Dockerfile\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ mkdir nginx\n$ cd nginx\n$ vi Dockerfile\nFROM nginx\nCOPY html /usr/share/nginx/html\n```\n\n\u307e\u305f\u3001\u30b3\u30d4\u30fc\u3059\u308bHTML\u3082\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$ mkdir html\n$ vi html/index.html\n<html>\n<head><title>Amazon ECS deployed!</title></head>\n<body><h1>Amazon ECS deployed!</h1></body>\n</html>\n```\n\n`docker build`\u30b3\u30de\u30f3\u30c9\u3092\u5229\u7528\u3057\u3066\u30d3\u30eb\u30c9\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u5316\u3057\u307e\u3059\u3002**toshihirock**\u306e\u90e8\u5206\u306fDockerhub\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u540d\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$docker build -t toshihirock/mynginx .\n```\n\n\u8a66\u3057\u306b\u30ed\u30fc\u30ab\u30eb\u3067\u8d77\u52d5\u3057\u3066\u307f\u307e\u3059\n\n\n```\n$docker run -d -p 80:80 toshihirock/mynginx\n1eff877751a7\n$curl http://localhost\n<html>\n<head><title>Amazon ECS deployed!</title></head>\n<body><h1>Amazon ECS deployed!</h1></body>\n</html>\n```\n\n`docker inspect`\u3092\u4f7f\u3046\u8a2d\u5b9a\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002Cmd\u306b\u4ee5\u4e0b\u304c\u8a2d\u5b9a\u3055\u308c\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u3001 **deamon off(\u3064\u307e\u308a\u30d5\u30a9\u30a2\u30b0\u30e9\u30a6\u30f3\u30c9\uff09**\u3067\u5b9f\u884c\u3055\u308c\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3059\u3002\uff08\u30b3\u30de\u30f3\u30c9\u3092\u30d5\u30a9\u30a2\u30b0\u30e9\u30f3\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u306a\u3044\u3068\u30b3\u30f3\u30c6\u30ca\u304c\u7d42\u4e86\u3059\u308b\u306e\u3067)\n\n```\n        \"Cmd\": [\n            \"nginx\",\n            \"-g\",\n            \"daemon off;\"\n        ],\n```\n\n# Dockerhub\u3078\u306e\u767b\u9332\n\n\u78ba\u8a8d\u304c\u3067\u304d\u305f\u3089Dockerhub\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u3001Dockerhub\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n```\n$docker login\n```\n\n\u6b21\u306b`docker push`\u3067Dockerhub\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```\n$docker push toshihirock/mynginx\n```\n\n\n# ECS\u7528\u306eIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308bEC2\u304b\u3089ECS\u306b\u30a2\u30af\u30bb\u30b9\u3092\u884c\u3046\u305f\u3081\u306b\u5fc5\u8981\u306aIAM\u30ed\u30fc\u30eb\u306e\u4f5c\u6210\u3092\u884c\u3044\u307e\u3059\u3002\n\n\u4f5c\u6210\u6642\u306b\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u53c2\u8003\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n[AWS CLI\u3067\u30b5\u30fc\u30d3\u30b9\u306e\u5404\u7a2e\u30b3\u30de\u30f3\u30c9\u3092\u52d5\u304b\u3057\u3066\u307f\u308b(IAM\u7de83: \u30ed\u30fc\u30eb)](http://dev.classmethod.jp/cloud/aws/awscli-iam-3-role/)\n\n\u6700\u521d\u306b\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```lang:role.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n     {\n       \"Action\": \"sts:AssumeRole\",\n       \"Principal\": {\n         \"Service\": \"ec2.amazonaws.com\"\n        },\n        \"Effect\": \"Allow\",\n        \"Sid\": \"\"\n     }\n  ]\n}\n```\n\n\u4f5c\u6210\u5f8c\u3001\u4ee5\u4e0b\u306e\u64cd\u4f5c\u3067\u30ed\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n# \u4f5c\u6210\n$aws iam create-role --role-name ecs-full-access --assume-role-policy-document file://role.json\n\n#\u78ba\u8a8d\n$aws iam get-role --role-name ecs-full-access\n```\n\n\u6b21\u306bECS\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u306e\u4f5c\u6210\u3092\u3057\u307e\u3059\u3002\n\n```lang:role-policy.json\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"ecs:*\",\n      \"Effect\": \"Allow\",\n      \"Resource\": \"*\"\n    }\n  ]\n}\n```\n\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3057\u307e\u3059\u3002\n\n```\n$aws iam put-role-policy --role-name ecs-full-access --policy-name  ECSFullAccess --policy-document file://role-policy.json\n```\n\n\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$ aws iam list-role-policies --role-name ecs-full-access\n{\n    \"PolicyNames\": [\n        \"ECSFullAccess\"\n    ]\n}\n```\n\n\u5148\u307b\u3069\u306e\u30dd\u30ea\u30b7\u30fc\u304c\u4f5c\u6210\u3057\u305f\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3055\u308c\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\nEC2\u306eIAM\u30ed\u30fc\u30eb\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\n$aws iam create-instance-profile --instance-profile-name ecs-full-access\n```\n\n\u4f5c\u6210\u3057\u305f\u30d7\u30ed\u30d5\u30a1\u30a4\u30eb\u3092\u30ed\u30fc\u30eb\u306b\u9069\u7528\u3055\u305b\u307e\u3059\u3002\n\n```\n$aws iam add-role-to-instance-profile --instance-profile-name ecs-full-access --role-name ecs-full-access\n```\n\n# \u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u52d5\u4f5c\u3055\u305b\u308bEC2\u7fa4\u307e\u3068\u3081\u308b\u30af\u30e9\u30b9\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\n\n```\n$aws ecs create-cluster --cluster-name MyCluster\n```\n\n\u30af\u30e9\u30b9\u30bf\u306e\u4f5c\u6210\u3092\u78ba\u8a8d\u3057\u307e\u3059\n```\n$aws ecs describe-clusters --clusters MyCluster\n```\n\n# ECS-Optimized Amazon Linux\u306e\u8d77\u52d5\u3068\u30af\u30e9\u30b9\u30bf\u3078\u306e\u53c2\u52a0\n\n[Launching an Amazon ECS Container Instance](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/launch_container_instance.html)\n\nCoreOS\u3082\u4f7f\u3048\u308b\u3088\u3046\u3067\u3059\u304c\u3001\u6700\u65b0\u306eAmazonLinux\u306eECS ready\u306aAMI\u3092\u4f7f\u3044\u307e\u3059\u300220150623\u73fe\u5728\u3001ap-northeast1\u3067\u4f7f\u3048\u308b\u6700\u65b0\u306e\u3082\u306e\u306f**ami-fa12b7fa**\u3060\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n\u307e\u305f\u3001\u5148\u307b\u3069\u4f5c\u3063\u305f\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u305f\u3081\u306b\u8d77\u52d5\u3059\u308bEC2\u306eUserData\u3067\u4ee5\u4e0b\u3092\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```\n#!/bin/bash\necho ECS_CLUSTER=MyCluster >> /etc/ecs/ecs.config\n```\n\nCLI\u304b\u3089\u64cd\u4f5c\u3059\u308b\u5834\u5408\u3001UserData\u306fBase64\u30a8\u30f3\u30b3\u30fc\u30c9\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n`--subnet-id`\u3001`--security-group-ids`\u3001`--key-name`\u306b\u3064\u3044\u3066\u306f\u9069\u5b9c\u81ea\u5206\u306e\u74b0\u5883\u306b\u3042\u3063\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u4e0b\u3055\u3044\u3002\u307e\u305f\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306b\u3064\u3044\u3066\u306f80\u30dd\u30fc\u30c8\u3092\u958b\u653e\u3057\u305f\u3082\u306e\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\n$aws ec2 run-instances \\\n--image-id  ami-fa12b7fa \\\n--instance-type t2.micro \\\n--subnet-id subnet-d949e1ae \\\n--iam-instance-profile Name=ecs-full-access \\\n--user-data IyEvYmluL2Jhc2gNCmVjaG8gRUNTX0NMVVNURVI9TXlDbHVzdGVyID4+IC9ldGMvZWNzL2Vjcy5jb25maWc= \\\n--security-group-ids sg-baca56df \\\n--key-name hogeFugaKey \\\n|jq -r '.Instances[].InstanceId'\n```\n\n\u4e0a\u8a18\u5b9f\u884c\u306b\u3088\u308a\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u307f\u51fa\u529b\u3059\u308b\u3088\u3046\u306bjq\u3067\u30d5\u30a3\u30eb\u30bf\u3057\u3066\u3044\u307e\u3059\u3002\n\u3042\u3068\u3067\u5229\u7528\u3059\u308b\u306e\u3067\u30e1\u30e2\u3057\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n\n\u5c11\u3057\u6642\u9593\u3092\u7f6e\u3044\u3066\u304b\u3089\u30af\u30e9\u30b9\u30bf\u306b\u5148\u307b\u3069\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u53c2\u52a0\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$aws ecs list-container-instances --cluster MyCluster\n{\n    \"containerInstanceArns\": [\n        \"arn:aws:ecs:ap-northeast-1:694273932022:container-instance/b16efbb0-c12f-4f74-bd2f-aa7756a5cc2d\"\n    ]\n}\n```\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306bcontainerInstanceArns\u306b\u4e00\u3064\u5024\u304c\u5165\u3063\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\n\n# \u30bf\u30b9\u30af\u306e\u8ffd\u52a0\n\n\u30bf\u30b9\u30af\uff08\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30ca\u306e\u8a73\u7d30\u3092\u307e\u3068\u3081\u305f\u3082\u306e\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u6307\u5b9a\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3067\u306e\u8a73\u7d30\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f[\u3053\u3061\u3089](http://docs.aws.amazon.com/ja_jp/AmazonECS/latest/developerguide/task_definition_parameters.html)\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n\u4eca\u56de\u306e\u4f8b\u3067\u306f\u6700\u521d\u306b\u4f5c\u6210\u3057\u305fnginx\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5229\u7528\u3059\u308b\u30bf\u30b9\u30af\u3092\u8a2d\u5b9a\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u3068\u30db\u30b9\u30c8\u3067\u306f80\u30dd\u30fc\u30c8\u306e\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u3057\u3066\u3044\u307e\u3059\u3002cpu\u3001memory\u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30da\u30c3\u30af\u3092\u8868\u3057\u3001essential\u3092true\u306b\u3059\u308b\u3068\u3053\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u304c\u5931\u6557\u3059\u308b\u3068\u30bf\u30b9\u30af\u3068\u3057\u3066\u5931\u6557\u3057\u305f\u3082\u306e\u3068\u3057\u3066\u307f\u306a\u3057\u3066\u304f\u308c\u307e\u3059\u3002\n\n```lang:nginx-task.json\n[\n  {\n    \"image\": \"toshihirock/mynginx\",\n    \"name\": \"mynginx\",\n    \"cpu\": 10,\n    \"memory\": 500,\n    \"essential\": true,\n    \"environment\": [],\n    \"portMappings\": [\n      {\n        \"containerPort\": 80,\n        \"hostPort\": 80\n      }\n    ]\n  }\n]\n```\n\n\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```\n$ aws ecs register-task-definition --family mynginx  --container-definitions file://nginx-task.json\n```\n\n\u30bf\u30b9\u30af\u304c\u767b\u9332\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\n$aws ecs describe-task-definition --task-definition mynginx\n```\n\n\u4e0a\u8a18\u3067\u306f\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u305f\u3060\u3051\u3067\u3001\u30af\u30e9\u30b9\u30bf\u3068\u306e\u95a2\u9023\u3065\u3051\u306f\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u5148\u307b\u3069\u767b\u9332\u3057\u305f\u30af\u30e9\u30b9\u30bf\u3067\u4e0a\u8a18\u30bf\u30b9\u30af\u3092\u5b9f\u884c\u3055\u305b\u305f\u3044\u306e\u3067\u767b\u9332\u3092\u884c\u3044\u307e\u3059\u3002\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u306e`--task-definition`\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3067\u306f**family:revision**\u3068\u3044\u3046\u5f62\u5f0f\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002\u4eca\u56de\u306e\u30bf\u30b9\u30af\u306e\u30ea\u30d3\u30b8\u30e7\u30f3\u306f1\u306a\u306e\u3067**mynginx:1**\u3068\u3044\u3046\u6307\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```\n$aws ecs run-task --cluster MyCluster --task-definition mynginx:1\n{\n    \"failures\": [],\n    \"tasks\": [\n        {\n            \"taskArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\",\n            \"overrides\": {\n                \"containerOverrides\": [\n                    {\n                        \"name\": \"mynginx\"\n                    }\n                ]\n            },\n            \"lastStatus\": \"PENDING\",\n            \"containerInstanceArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:container-instance/f053e789-7aaf-4be7-a90c-2f868b2802f0\",\n            \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:cluster/MyCluster\",\n            \"desiredStatus\": \"RUNNING\",\n            \"taskDefinitionArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task-definition/mynginx3:1\",\n            \"containers\": [\n                {\n                    \"containerArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:container/18de6ec3-66b6-4b72-91a1-044c03ad60ba\",\n                    \"taskArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\",\n                    \"lastStatus\": \"PENDING\",\n                    \"name\": \"mynginx\"\n                }\n            ]\n        }\n    ]\n}\n```\n\n\u767b\u9332\u76f4\u5f8c\u306f**lastStatus**\u304cPENDDING\u3068\u306a\u3063\u3066\u304a\u308a\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3066\u304a\u308a\u307e\u305b\u3093\u3002\u5c11\u3057\u6642\u9593\u3092\u304a\u3044\u3066\u304b\u3089\u767b\u9332\u3055\u308c\u305f\u30bf\u30b9\u30af\u306e\u72b6\u614b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002`--tasks`\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306b\u306f\u5148\u307b\u3069\u30bf\u30b9\u30af\u3092\u767b\u9332\u3057\u305f\u6642\u306b\u8868\u793a\u3055\u308c\u305f\u30bf\u30b9\u30af\u306eARN(taskArn)\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```\n$aws ecs describe-tasks --cluster MyCluster --tasks arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\n```\n\nlastStatus\u3092\u78ba\u8a8d\u3057\u3001PENDDING\u304cRUNNING\u306b\u306a\u3063\u3066\u3044\u308c\u3070\u30b3\u30f3\u30c6\u30ca\u304c\u8d77\u52d5\u3057\u3001\u6e96\u5099\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n# Web\u30b5\u30a4\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u767b\u9332\u6642\u306b\u8868\u793a\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u5229\u7528\u3057\u3066EC2\u306ePublicDNS\u540d\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```\n$aws ec2 describe-instances --instance-ids i-6004f292 |jq -r '.Reservations[].Instances[].PublicDnsName'\n```\n\n\u4e0a\u8a18URL\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068nginx\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u30b3\u30f3\u30c6\u30ca\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3001\u4ee5\u4e0b\u306e\u5185\u5bb9\u304c\u78ba\u8a8d\u3067\u304d\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n![Screen Shot 2015-06-24 at 8.38.06 AM.png](https://qiita-image-store.s3.amazonaws.com/0/20193/23464d4d-0208-2740-71c5-af44239dc2ab.png)\n\n\n# \u304a\u6383\u9664\n\n\u307e\u305a\u3001\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3057\u305f\u30bf\u30b9\u30af\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n\n```\n$aws ecs stop-task --cluster MyCluster --task arn:aws:ecs:ap-northeast-1:694273932022:task/bf71c7b8-6fd0-40e5-b106-a14e588a3b04\n```\n\n\u6b21\u306bECS\u3092\u52d5\u4f5c\u3055\u305b\u3066\u3044\u308bEC2\u3092terminate\u3057\u307e\u3059\u3002\n\n```\n$aws ec2 terminate-instances --instance-ids i-6004f292\n```\n\n\n\u6700\u5f8c\u306b\u30af\u30e9\u30b9\u30bf\u3092\u524a\u9664\u3057\u307e\u3059\u3002\n\n```\n# \u524a\u9664\n$aws ecs delete-cluster --cluster MyCluster\n\n#\u3000\u78ba\u8a8d\n$ aws ecs describe-clusters --clusters MyCluster\n{\n    \"clusters\": [\n        {\n            \"status\": \"INACTIVE\",\n            \"clusterName\": \"MyCluster\",\n            \"registeredContainerInstancesCount\": 0,\n            \"pendingTasksCount\": 0,\n            \"runningTasksCount\": 0,\n            \"clusterArn\": \"arn:aws:ecs:ap-northeast-1:694273932022:cluster/MyCluster\"\n        }\n    ],\n    \"failures\": []\n}\n```\n\nstatus\u304c**INACTIVE**\u3068\u306a\u3063\u3066\u3044\u308c\u3070OK\u3067\u3059\u3002\n\nECS\u306e\u30bf\u30b9\u30af\u3001ECS\u7528\u306e\u30ed\u30fc\u30eb\u3092\u524a\u9664\u3057\u305f\u3044\u4eba\u306f\u5404\u81ea\u304a\u9858\u3044\u3057\u307e\u3059\u3002\n"}