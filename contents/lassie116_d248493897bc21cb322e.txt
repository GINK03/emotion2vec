{"context": " More than 1 year has passed since last update.\n\n\u524d\u56de\u307e\u3067\u306e\u3042\u3089\u3059\u3058\nheroku\u3067\u306fwebsocket\u304c\u516c\u5f0f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u3066\u3001\u691c\u7d22\u3059\u308b\u3068Ruby\u3067\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\u3082\u3044\u3063\u3071\u3044\u3067\u3066\u304f\u308b\u3002\u4e00\u65b9OpenShift\u306e\u60c5\u5831\u306f\u3042\u307e\u308a\u30d2\u30c3\u30c8\u305b\u305a\u3001\u307e\u3060\u03b2\u30b5\u30dd\u30fc\u30c8\u3060\u304b\u3089\u4e0d\u5b89\u5b9a\u3060\u3068\u304b\u3001node.js\u3067\u3057\u304b\u99c4\u76ee\u3060\u3068\u304b\u3001\u3044\u3084\u3044\u3084\u3067\u304d\u308b\u3088\u3060\u3068\u304b\u3001\u73fe\u72b6\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3055\u3063\u3071\u308a\u308f\u304b\u3089\u306a\u3044\u3002\u3053\u3046\u3059\u308c\u3070\u3067\u304d\u308b\u3068\u3044\u3046\u60c5\u5831\u3082\u30d2\u30c3\u30c8\u3057\u305f\u306e\u3067\u305d\u308c\u3092\u5143\u306bheroku\u3067\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\u3092OpenShift\u4e0a\u3067\u52d5\u304b\u3057\u3066\u5b9f\u969b\u306b\u8a66\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n\n\u7d50\u8ad6\n2013\u5e7412\u6708\u73fe\u5728\u3001OpenShift\u4e0a\u306eruby1.9\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067websocket\u306e\u901a\u4fe1\u306b\u6210\u529f\u3002\n\n\u3084\u3063\u305f\u3053\u3068\nOpenShift\u3067websocket\u306eruby\u5b9f\u88c5\u3092\u4f7f\u3046\u306b\u306f\u3001Ruby websockets on OpenShift\u306e\u60c5\u5831\u304c\u308f\u308a\u3068\u8a73\u3057\u3044\u3002\u305f\u3060\u3057\u3001\u809d\u5fc3\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u4eca\u306eOpenShift\u3067\u306f\u52d5\u4f5c\u3055\u305b\u3089\u308c\u306a\u304b\u3063\u305f\u4e0a\u306b\u3001\u72ec\u81ea\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u306a\u306e\u3067\u52d5\u4f5c\u3057\u306a\u3044\u539f\u56e0\u3092\u8abf\u3079\u308b\u306e\u3082\u304b\u306a\u308a\u304d\u3064\u3044\u3002\n\u305d\u3053\u3067\u3001\u6bd4\u8f03\u7684\u5358\u7d14\u3067\u308f\u304b\u308a\u3084\u3059\u3044heroku\u3067\u306e\u30b5\u30f3\u30d7\u30eb\u5b9f\u88c5\u3092\u3001\u4e0a\u8a18\u30b5\u30a4\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u6ce8\u610f\u70b9\u3092\u8aad\u307f\u306a\u304c\u3089OpenShift\u3067\u52d5\u304f\u3088\u3046\u306b\u6539\u5909\u3057\u3066\u3044\u3063\u305f\u3002\n\n\u304a\u304a\u307e\u304b\u306a\u624b\u9806\n\nheroku\u3067\u52d5\u4f5c\u3059\u308bruby-websockets-chat-demo\u3092OpenShift\u306b\u4e57\u305b\u308b\nheroku\u3067\u52d5\u304b\u3057\u305f\u7d4c\u9a13\u3092\u5143\u306bredis\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u30b5\u30f3\u30d7\u30eb\u3092\u6539\u5909\u3059\u308b\nOpenShift\u306b\u3042\u308f\u305b\u3066Gemfile\u7b49\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\nOpenShift\u306eruby\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067puma\u3092\u52d5\u4f5c\u3055\u305b\u308b\nwebsocket\u306e\u30dd\u30fc\u30c8\u3092OpenShift\u306e\u4ed5\u69d8\u306b\u3042\u308f\u305b\u308b\n\n\nruby-websockets-chat-demo\u3092OpenShift\u306b\u4e57\u305b\u308b\nOpenShift\u3067\u9069\u5f53\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n$ rhc app create websocketchat -t ruby-1.9\nApplication Options\n-------------------\n  Domain:     l1s\n  Cartridges: ruby-1.9\n  Gear Size:  default\n  Scaling:    no\n\nCreating application 'websocketchat' ...\n(\u7565)\nRun 'rhc show-app websocketchat' for more details about your app.\n\nruby-websockets-chat-demo\u3092merge\u3059\u308b\u3002Using WebSockets on Heroku with Ruby\u306b\u30b5\u30f3\u30d7\u30eb\u306egithub\u3078\u306e\u30ea\u30f3\u30af\u304c\u3042\u308b\u306e\u3067\u3001How to Migrate Your Heroku Ruby Application to OpenShift\u3092\u53c2\u8003\u306b\u3057\u3066\u3055\u3063\u304d\u4f5c\u3063\u305f\u7a7a\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306bmerge\u3002\n$ cd websocketchat\n$ git pull -s recursive -X theirs https://github.com/heroku-examples/ruby-websockets-chat-demo.git\nwarning: no common commits\nremote: Counting objects: 48, done.\nremote: Compressing objects: 100% (29/29), done.\nremote: Total 48 (delta 12), reused 47 (delta 12)\nUnpacking objects: 100% (48/48), done.\nFrom https://github.com/heroku-examples/ruby-websockets-chat-demo\n * branch            HEAD       -> FETCH_HEAD\nAuto-merging config.ru\nAuto-merging README.md\nMerge made by the 'recursive' strategy.\n Gemfile                                               |    8 +\n Gemfile.lock                                          |   28 +\n(\u7565)\n views/index.html.erb                                  |   34 +\n 21 files changed, 9615 insertions(+), 297 deletions(-)\n create mode 100644 Gemfile\n create mode 100644 Gemfile.lock\n(\u7565)\n create mode 100644 views/index.html.erb\n\n\u3082\u3068\u3082\u3068\u304c\u8d77\u6e90\u306e\u9055\u3046\u4e8c\u3064\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30de\u30fc\u30b8\u306a\u306e\u3067\u3001\u30de\u30fc\u30b8\u5f8c\u306f\u30b3\u30df\u30c3\u30c8\u304c\u5999\u306a\u30b0\u30e9\u30d5\u306b\u306f\u306a\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\u3002\n\nredis\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u30b5\u30f3\u30d7\u30eb\u3092\u6539\u5909\u3059\u308b\n\u3053\u306e\u6642\u70b9\u3067\u306f\u30ed\u30fc\u30ab\u30eb\u3067\u3082rackup\u3067\u304d\u306a\u3044\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u8907\u6570\u30ce\u30fc\u30c9\u306b\u30b9\u30b1\u30fc\u30eb\u3057\u305f\u6642\u3067\u3082\u53d7\u3051\u3068\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306bredis\u3092\u4f7f\u3046\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u306fredis\u306e\u74b0\u5883\u3092\u8a2d\u5b9a\u3057\u3066\u306a\u3044\u304b\u3089\u3060\u3002\u4eca\u306f\u8907\u6570\u30ce\u30fc\u30c9\u306a\u3093\u3066\u3044\u3089\u306a\u3044\u306e\u3067redis\u306e\u90e8\u5206\u3092\u304c\u3055\u3063\u3068\u524a\u308b\u3002\n\u4ee5\u4e0b\u5909\u66f4\u3057\u305f\u3068\u3053\u308d\u3060\u3051\u629c\u7c8b\u3002\n\nmiddlewares/chat_backend.rb\nrequire 'faye/websocket'\nrequire 'thread'\n# require 'redis'\nrequire 'json'\nrequire 'erb'\n\nmodule ChatDemo\n  class ChatBackend\n    KEEPALIVE_TIME = 15 # in seconds\n    CHANNEL        = \"chat-demo\"\n\n    def initialize(app)\n      @app     = app\n      @clients = []\n=begin\n      uri = URI.parse(ENV[\"REDISCLOUD_URL\"])\n      @redis = Redis.new(host: uri.host, port: uri.port, password: uri.password)\n      Thread.new do\n        redis_sub = Redis.new(host: uri.host, port: uri.port, password: uri.password)\n        redis_sub.subscribe(CHANNEL) do |on|\n          on.message do |channel, msg|\n            @clients.each {|ws| ws.send(msg) }\n          end\n        end\n      end\n=end\n    end\n\n    def call(env)\n      if Faye::WebSocket.websocket?(env)\n        ws = Faye::WebSocket.new(env, nil, {ping: KEEPALIVE_TIME })\n        ws.on :open do |event|\n          p [:open, ws.object_id]\n          @clients << ws\n        end\n\n        ws.on :message do |event|\n          p [:message, event.data]\n          # @redis.publish(CHANNEL, sanitize(event.data))\n          @clients.each {|c| c.send(sanitize(event.data))}\n        end\n\n\n\u3053\u308c\u3067\u30ed\u30fc\u30ab\u30eb\u3067\u3082production\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u308b(production\u306b\u3057\u306a\u3044\u3068\u4f55\u6545\u304bpuma\u304c\u3053\u3051\u308b)\u3002\n$ bundle exec rackup -E production\nPuma 2.6.0 starting...\n* Min threads: 0, max threads: 16\n* Environment: production\n* Listening on tcp://0.0.0.0:9292\n\n\u3088\u3046\u3084\u304fHTML\u304c\u8868\u793a\u3055\u308c\u3066\u559c\u3076\u304c\u3001production\u306a\u3089https\u3060\u3088\u306d\u3002\u3060\u304b\u3089wss\u4f7f\u3046\u306d\u3001\u3068\u3044\u3046\u304a\u305b\u3063\u304b\u3044\u30b3\u30fc\u30c9\u306e\u305b\u3044\u3067\u3001http\u3067\u7acb\u3061\u3042\u3052\u3066\u3044\u308b\u3068websocket\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u3002\u3055\u3089\u306bOpenShift\u3067\u306fws\u306e\u5f85\u53d7\u30dd\u30fc\u30c8\u304c\u7279\u6b8a\u306a\u306e\u3067\u3084\u306f\u308awebsocket\u901a\u4fe1\u306f\u307e\u3060\u3067\u304d\u306a\u3044\u3002\u5f8c\u3067\u307e\u3068\u3081\u3066\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\nOpenShift\u306b\u3042\u308f\u305b\u3066Gemfile\u7b49\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\n\u30ed\u30fc\u30ab\u30eb\u3067\u306f\u305d\u308c\u306a\u308a\u306b\u52d5\u3044\u305f\u306e\u3067OpenShift\u306bpush\u3057\u3066\u307f\u308b\u3068\u5909\u306a\u3068\u3053\u308d\u3067\u30a8\u30e9\u30fc\u304c\u3067\u3066\u3044\u308b\u3002\nheroku\u3067\u306fGemfile\u306bruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308bruby\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u4f7f\u3048\u308b\u304c\u3001OpenShift\u3067\u306f\u4f7f\u3048\u306a\u3044\u304b\u3089\u306e\u3088\u3046\u3060\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u524a\u308b\u3002\u3064\u3044\u3067\u306b\u3082\u3046\u4f7f\u308f\u306a\u3044redis\u3082\u524a\u3063\u3066\u304a\u304f\u3002\n\nGemfile\nsource \"https://rubygems.org\"\n\n# ruby \"2.0.0\"\n\ngem \"faye-websocket\"\ngem \"sinatra\"\ngem \"puma\"\n# gem \"redis\"\n\n\nbundle install\u3092\u3057\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u66f4\u65b0\u3057\u3066\u304b\u3089git push origin master\u3092\u3059\u308b\u3068OpenShift\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u3068\u540c\u69d8\u306bHTML\u306f\u8868\u793a\u3055\u308c\u308b\u3002\u3084\u3063\u305f\u306d\u3002\u3060\u304c\u3057\u304b\u3057websocket\u3092\u4f7f\u3046\u30c1\u30e3\u30c3\u30c8\u90e8\u5206\u306f\u4f55\u3082\u52d5\u304b\u306a\u3044\u3002\n\nOpenShift\u3067puma\u3092\u52d5\u4f5c\u3055\u305b\u308b\n\u4ee5\u4e0b\u3001\u307b\u307cRuby websockets on Openshift\u306e\u53d7\u3051\u58f2\u308a\u3002\nOpenShift\u306eruby\u74b0\u5883\u3067\u306fapache+passenger\u304c\u4f7f\u308f\u308c\u3066\u304a\u308a\u3001\u975e\u5e38\u306b\u30c8\u30ea\u30c3\u30ad\u30fc\u306a\u3053\u3068\u3092\u3057\u306a\u3044\u3068websocket\u306e\u901a\u4fe1\u304c\u3067\u304d\u306a\u3044\u3089\u3057\u3044\u3002\u305f\u3060\u3057OpenShift\u306b\u306f\u629c\u3051\u9053\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001passenger\u306e\u4ee3\u308f\u308a\u306b\u4ed6\u306eweb server\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\u305d\u308c\u3092\u4f7f\u3063\u3066ruby\u88fd\u306ewebserver puma\u3092\u8d77\u52d5\u3057\u3066\u3084\u308b\u3068websocket\u306e\u901a\u4fe1\u3082\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u3067\u304d\u308b\u3088\u3001\u3068\u3044\u3046\u3053\u3068\u306e\u3088\u3046\u3060\u3002\u78ba\u304b\u306bheroku\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3082puma\u3092\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u305f\u3002\n\u5177\u4f53\u7684\u306b\u306fOpenShift\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30d5\u30c3\u30af\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3053\u306bpassenger\u306e\u505c\u6b62\u3068puma\u306e\u8d77\u52d5\u3001puma\u306e\u505c\u6b62\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u304f\u3002\u5b9f\u884c\u5c5e\u6027\u3092\u4ed8\u3051\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n\n/.openshift/action_hooks/post_start_ruby-1.9\n#!/bin/bash\necho \"Replacing the default Passenger server with Puma\"\npushd ${OPENSHIFT_REPO_DIR} > /dev/null\n${HOME}/ruby/bin/control stop\nset -e\nPUMA_PID_FILE=\"${OPENSHIFT_DATA_DIR}puma.pid\"\nPUMA_BIND_URL=\"tcp://${OPENSHIFT_RUBY_IP}:${OPENSHIFT_RUBY_PORT}\"\nPUMA_OPTS=\"-d --pidfile ${PUMA_PID_FILE} -e production --bind '${PUMA_BIND_URL}'\"\nbundle exec \"puma $PUMA_OPTS\"\nexit 0\n\n\n\n/.openshift/action_hooks/deploy\n#!/bin/bash\nif [ -f \"${OPENSHIFT_DATA_DIR}puma.pid\" ]; then\n  echo \"Stopping Puma...\"\n  PUMA_PID=$(cat \"${OPENSHIFT_DATA_DIR}puma.pid\")\n  ps -p $PUMA_PID &> /dev/null\n  [ \"$?\" == 0 ] && kill $PUMA_PID\nfi\n\n\nOpenShift\u306bpush\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3002\u5148\u7a0b\u3068\u306f\u9055\u3044push\u5f8c\u306e\u8d77\u52d5\u30ed\u30b0\u3067Puma\u306e\u8d77\u52d5\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n(\u7565)\nremote: Activating deployment\nremote: Starting Ruby cartridge\nremote: Replacing the default Passenger server with Puma\nremote: Stopping Ruby cartridge\nremote: Waiting for stop to finish\nremote: Puma starting in single mode...\nremote: * Version 2.6.0, codename: Pantsuit Party\nremote: * Min threads: 0, max threads: 16\nremote: * Environment: production\nremote: * Listening on tcp://127.8.152.129:8080\nremote: * Daemonizing...\nremote: Result: success\nremote: Activation status: success\nremote: Deployment completed with status: success\n(\u7565)\n\n\u3082\u3046\u3072\u3068\u3044\u304d\u3060\uff01\u3055\u3042\u5f8c\u306f\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\u3060\u3051\u3060\u3002\n\nwebsockets\u306e\u30dd\u30fc\u30c8\u3092OpenShift\u306e\u4ed5\u69d8\u306b\u3042\u308f\u305b\u308b\nOpenShift\u3067\u306f\u5916\u304b\u3089\u306ewebsocket\u306e\u30dd\u30fc\u30c8\u306f8000\u30688443\u306b\u5272\u308a\u3042\u3066\u3089\u308c\u3066\u3044\u308b(Try Out Low-Latency Connections with WebSockets\u53c2\u7167)\u3002\u524d\u8005\u304chttp\u7528\u3067\u5f8c\u8005\u304chttps\u7528\u3002\n\u30b5\u30f3\u30d7\u30eb\u3067\u306fwebsocket\u306e\u901a\u4fe1\u308280\u3068443\u3067\u884c\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u305d\u3053\u3092\u5909\u66f4\u3059\u308b\u3002\u30c6\u30b9\u30c8\u306a\u306e\u3067ws\u306e8000\u30dd\u30fc\u30c8\u306b\u56fa\u5b9a\u3057\u3066\u304a\u304f\u3002\n\n/views/application.js.erb\n//var scheme   = \"<%= @scheme %>\";\nvar scheme   = \"ws://\";\n//var uri      = scheme + window.document.location.host + \"/\";\nvar uri      = scheme + window.document.location.hostname + \":8000/\";\nvar ws       = new WebSocket(uri);\nws.onmessage = function(message) {\n  var data = JSON.parse(message.data);\n  $(\"#chat-text\").append(\"<div class='panel panel-default'><div class='panel-heading'>\" + da\\\nta.handle + \"</div><div class='panel-body'>\" + data.text + \"</div></div>\");\n  $(\"#chat-text\").stop().animate({\n    scrollTop: $('#chat-text')[0].scrollHeight\n  }, 800);\n};\n\n$(\"#input-form\").on(\"submit\", function(event) {\n  event.preventDefault();\n  var handle = $(\"#input-handle\")[0].value;\n  var text   = $(\"#input-text\")[0].value;\n  ws.send(JSON.stringify({ handle: handle, text: text }));\n  $(\"#input-text\")[0].value = \"\";\n});\n\n\n\u3053\u308c\u3067push\u3059\u308c\u3070\u3088\u3046\u3084\u304f\u30c1\u30e3\u30c3\u30c8\u30b5\u30f3\u30d7\u30eb\u304c\u52d5\u4f5c\u3059\u308b\u3002\u8907\u6570\u30d6\u30e9\u30a6\u30b6\u3092\u7acb\u3061\u3042\u3052\u3066\uff11\u4eba\u30c1\u30e3\u30c3\u30c8\u3092\u697d\u3057\u3082\u3046\u3002\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\u3053\u306e\u624b\u9806\u3067\u4f5c\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u305d\u306e\u3082\u306e\u3092 http://websocketchat-l1s.rhcloud.com/ \u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u3069\u3046\u305e\u3002\u3057\u3070\u3089\u304f\u306f\u6b8b\u3057\u3066\u304a\u304f\u3064\u3082\u308a\u3067\u3059\u304c\u7121\u6599\u67a0\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3089\u6d88\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3042\u3057\u304b\u3089\u305a\u3002\n\n\u307e\u3068\u3081\nOpenShift\u306ewebsocket\u306f\u4e00\u5e74\u307b\u3069\u524d\u306bpreview version\u3068\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u305d\u306e\u5f8c\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u306f\u78ba\u8a8d\u3067\u304d\u306a\u304b\u3063\u305f\u3002\u305f\u3060\u3057\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u308b\u3068\u73fe\u72b6\u3067\u3082preview version\u6642\u306e\u60c5\u5831\u306f\u305d\u306e\u307e\u307e\u751f\u304d\u3066\u3044\u3066\u3001\u305d\u308c\u306b\u5f93\u3046\u3053\u3068(+\u30b5\u30fc\u30d0\u7f6e\u304d\u63db\u3048\u3068\u3044\u3046\u8352\u6280)\u3092\u3059\u308c\u3070ruby\u3067\u3082websocket\u3092\u697d\u3057\u3081\u308b\u3002\u73fe\u306b\u3001heroku\u306ewebsocket\u306a\u30c1\u30e3\u30c3\u30c8\u30b5\u30f3\u30d7\u30eb\u3092\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u307e\u308f\u308a\u3060\u3051\u4fee\u6b63\u3059\u308b\u3053\u3068\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001\n\nPuma\u3092\u52d5\u304b\u3059\nPort\u306e\u6307\u5b9a\u306b\u6ce8\u610f\u3059\u308b\n\n\u306e2\u70b9\u3002\n\u3053\u308c\u306b\u6c17\u3092\u3064\u3051\u3066\u3044\u308c\u3070heroku\u306ewebsocket\u306e\u30b3\u30fc\u30c9\u304c\u3059\u3053\u3057\u306e\u5909\u66f4\u3067\u52d5\u304d\u305d\u3046\u3067\u5922\u304c\u5e83\u304c\u308b\u3002\n\n\u86c7\u8db3\n\u305d\u3082\u305d\u3082\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3053\u3046\u3068\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u7de8\u96c6\u3059\u308b\u306b\u3057\u3066\u3082\u3001\u30a8\u30c7\u30a3\u30bf\u3067\u66f8\u3044\u305f\u6587\u7ae0\u3092\u30d6\u30e9\u30a6\u30b6\u306b\u30da\u30fc\u30b9\u30c8\u3059\u308b\u306b\u3057\u3066\u3082\u3001\u63a8\u6572\u3084\u7de8\u96c6\u304c\u3084\u308a\u306b\u304f\u304f\u3066\u305f\u307e\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5148\u306e\u6295\u7a3f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u305f\u3002\u6280\u8853\u306e\u529b\u3067\u3059\u3053\u3057\u5e78\u305b\u306b\u306a\u3063\u305f\u3002\n\n\u53c2\u8003\u60c5\u5831\n\n\nUsing WebSockets on Heroku with Ruby\n\nheroku\u306e\u30b5\u30dd\u30fc\u30c8\u30da\u30fc\u30b8\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\n\n\n\nHow to Migrate Your Heroku Ruby Application to OpenShift\n\nOpenShift\u306e\u30d6\u30ed\u30b0\u3001heroku\u304b\u3089\u306eruby\u30a2\u30d7\u30ea\u306e\u79fb\u690d\u65b9\u6cd5\n\n\n\nTry Out Low-Latency Connections with WebSockets\n\nOpenShift\u306e\u30d6\u30ed\u30b0\u3001websocket\u306e\u4f7f\u3044\u65b9\n\n\n\nRuby websockets on Openshift\n\nOpenShift\u3067\u306e\u7c21\u5358\u306aruby websocket\u306e\u52d5\u304b\u3057\u65b9\n\n\n\nQiita\u306b\u6295\u7a3f\u3059\u308bRuby\u30b9\u30af\u30ea\u30d7\u30c8\n\nQiita\u3078\u6295\u7a3f\u3059\u308b\u62d9\u4f5c\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d39\u4ecb\n\n\n\n\n# \u524d\u56de\u307e\u3067\u306e\u3042\u3089\u3059\u3058\nheroku\u3067\u306fwebsocket\u304c\u516c\u5f0f\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u3066\u3001\u691c\u7d22\u3059\u308b\u3068Ruby\u3067\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\u3082\u3044\u3063\u3071\u3044\u3067\u3066\u304f\u308b\u3002\u4e00\u65b9OpenShift\u306e\u60c5\u5831\u306f\u3042\u307e\u308a\u30d2\u30c3\u30c8\u305b\u305a\u3001\u307e\u3060\u03b2\u30b5\u30dd\u30fc\u30c8\u3060\u304b\u3089\u4e0d\u5b89\u5b9a\u3060\u3068\u304b\u3001node.js\u3067\u3057\u304b\u99c4\u76ee\u3060\u3068\u304b\u3001\u3044\u3084\u3044\u3084\u3067\u304d\u308b\u3088\u3060\u3068\u304b\u3001\u73fe\u72b6\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u306e\u304b\u3055\u3063\u3071\u308a\u308f\u304b\u3089\u306a\u3044\u3002\u3053\u3046\u3059\u308c\u3070\u3067\u304d\u308b\u3068\u3044\u3046\u60c5\u5831\u3082\u30d2\u30c3\u30c8\u3057\u305f\u306e\u3067\u305d\u308c\u3092\u5143\u306bheroku\u3067\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\u3092OpenShift\u4e0a\u3067\u52d5\u304b\u3057\u3066\u5b9f\u969b\u306b\u8a66\u3059\u3053\u3068\u306b\u3057\u305f\u3002\n\n# \u7d50\u8ad6\n2013\u5e7412\u6708\u73fe\u5728\u3001OpenShift\u4e0a\u306eruby1.9\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067websocket\u306e\u901a\u4fe1\u306b\u6210\u529f\u3002\n\n# \u3084\u3063\u305f\u3053\u3068\nOpenShift\u3067websocket\u306eruby\u5b9f\u88c5\u3092\u4f7f\u3046\u306b\u306f\u3001[Ruby websockets on OpenShift](http://mfojtik.im/ruby-websockets-on-openshift)\u306e\u60c5\u5831\u304c\u308f\u308a\u3068\u8a73\u3057\u3044\u3002\u305f\u3060\u3057\u3001\u809d\u5fc3\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u4eca\u306eOpenShift\u3067\u306f\u52d5\u4f5c\u3055\u305b\u3089\u308c\u306a\u304b\u3063\u305f\u4e0a\u306b\u3001\u72ec\u81ea\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u5b9f\u88c5\u306a\u306e\u3067\u52d5\u4f5c\u3057\u306a\u3044\u539f\u56e0\u3092\u8abf\u3079\u308b\u306e\u3082\u304b\u306a\u308a\u304d\u3064\u3044\u3002\n\u305d\u3053\u3067\u3001\u6bd4\u8f03\u7684\u5358\u7d14\u3067\u308f\u304b\u308a\u3084\u3059\u3044heroku\u3067\u306e\u30b5\u30f3\u30d7\u30eb\u5b9f\u88c5\u3092\u3001\u4e0a\u8a18\u30b5\u30a4\u30c8\u306b\u66f8\u3044\u3066\u3042\u308b\u6ce8\u610f\u70b9\u3092\u8aad\u307f\u306a\u304c\u3089OpenShift\u3067\u52d5\u304f\u3088\u3046\u306b\u6539\u5909\u3057\u3066\u3044\u3063\u305f\u3002\n\n## \u304a\u304a\u307e\u304b\u306a\u624b\u9806\n\n1. heroku\u3067\u52d5\u4f5c\u3059\u308bruby-websockets-chat-demo\u3092OpenShift\u306b\u4e57\u305b\u308b\n2. heroku\u3067\u52d5\u304b\u3057\u305f\u7d4c\u9a13\u3092\u5143\u306bredis\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u30b5\u30f3\u30d7\u30eb\u3092\u6539\u5909\u3059\u308b\n3. OpenShift\u306b\u3042\u308f\u305b\u3066Gemfile\u7b49\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\n4. OpenShift\u306eruby\u30ab\u30fc\u30c8\u30ea\u30c3\u30b8\u3067puma\u3092\u52d5\u4f5c\u3055\u305b\u308b\n5. websocket\u306e\u30dd\u30fc\u30c8\u3092OpenShift\u306e\u4ed5\u69d8\u306b\u3042\u308f\u305b\u308b\n\n# ruby-websockets-chat-demo\u3092OpenShift\u306b\u4e57\u305b\u308b\nOpenShift\u3067\u9069\u5f53\u306b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\n\n```sh\n$ rhc app create websocketchat -t ruby-1.9\nApplication Options\n-------------------\n  Domain:     l1s\n  Cartridges: ruby-1.9\n  Gear Size:  default\n  Scaling:    no\n\nCreating application 'websocketchat' ...\n(\u7565)\nRun 'rhc show-app websocketchat' for more details about your app.\n```\n\nruby-websockets-chat-demo\u3092merge\u3059\u308b\u3002[Using WebSockets on Heroku with Ruby](https://devcenter.heroku.com/articles/ruby-websockets)\u306b\u30b5\u30f3\u30d7\u30eb\u306egithub\u3078\u306e\u30ea\u30f3\u30af\u304c\u3042\u308b\u306e\u3067\u3001[How to Migrate Your Heroku Ruby Application to OpenShift](https://www.openshift.com/blogs/heroku-ruby-app-migration)\u3092\u53c2\u8003\u306b\u3057\u3066\u3055\u3063\u304d\u4f5c\u3063\u305f\u7a7a\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306bmerge\u3002\n\n```sh\n$ cd websocketchat\n$ git pull -s recursive -X theirs https://github.com/heroku-examples/ruby-websockets-chat-demo.git\nwarning: no common commits\nremote: Counting objects: 48, done.\nremote: Compressing objects: 100% (29/29), done.\nremote: Total 48 (delta 12), reused 47 (delta 12)\nUnpacking objects: 100% (48/48), done.\nFrom https://github.com/heroku-examples/ruby-websockets-chat-demo\n * branch            HEAD       -> FETCH_HEAD\nAuto-merging config.ru\nAuto-merging README.md\nMerge made by the 'recursive' strategy.\n Gemfile                                               |    8 +\n Gemfile.lock                                          |   28 +\n(\u7565)\n views/index.html.erb                                  |   34 +\n 21 files changed, 9615 insertions(+), 297 deletions(-)\n create mode 100644 Gemfile\n create mode 100644 Gemfile.lock\n(\u7565)\n create mode 100644 views/index.html.erb\n```\n\n\u3082\u3068\u3082\u3068\u304c\u8d77\u6e90\u306e\u9055\u3046\u4e8c\u3064\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30de\u30fc\u30b8\u306a\u306e\u3067\u3001\u30de\u30fc\u30b8\u5f8c\u306f\u30b3\u30df\u30c3\u30c8\u304c\u5999\u306a\u30b0\u30e9\u30d5\u306b\u306f\u306a\u308b\u304c\u6c17\u306b\u3057\u306a\u3044\u3002\n\n# redis\u3092\u4f7f\u308f\u306a\u3044\u3088\u3046\u306b\u30b5\u30f3\u30d7\u30eb\u3092\u6539\u5909\u3059\u308b\n\u3053\u306e\u6642\u70b9\u3067\u306f\u30ed\u30fc\u30ab\u30eb\u3067\u3082rackup\u3067\u304d\u306a\u3044\u3002\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u8907\u6570\u30ce\u30fc\u30c9\u306b\u30b9\u30b1\u30fc\u30eb\u3057\u305f\u6642\u3067\u3082\u53d7\u3051\u3068\u3063\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u5171\u6709\u3059\u308b\u305f\u3081\u306bredis\u3092\u4f7f\u3046\u30b3\u30fc\u30c9\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u30ed\u30fc\u30ab\u30eb\u3067\u306fredis\u306e\u74b0\u5883\u3092\u8a2d\u5b9a\u3057\u3066\u306a\u3044\u304b\u3089\u3060\u3002\u4eca\u306f\u8907\u6570\u30ce\u30fc\u30c9\u306a\u3093\u3066\u3044\u3089\u306a\u3044\u306e\u3067redis\u306e\u90e8\u5206\u3092\u304c\u3055\u3063\u3068\u524a\u308b\u3002\n\n\u4ee5\u4e0b\u5909\u66f4\u3057\u305f\u3068\u3053\u308d\u3060\u3051\u629c\u7c8b\u3002\n\n```ruby:middlewares/chat_backend.rb\nrequire 'faye/websocket'\nrequire 'thread'\n# require 'redis'\nrequire 'json'\nrequire 'erb'\n\nmodule ChatDemo\n  class ChatBackend\n    KEEPALIVE_TIME = 15 # in seconds\n    CHANNEL        = \"chat-demo\"\n\n    def initialize(app)\n      @app     = app\n      @clients = []\n=begin\n      uri = URI.parse(ENV[\"REDISCLOUD_URL\"])\n      @redis = Redis.new(host: uri.host, port: uri.port, password: uri.password)\n      Thread.new do\n        redis_sub = Redis.new(host: uri.host, port: uri.port, password: uri.password)\n        redis_sub.subscribe(CHANNEL) do |on|\n          on.message do |channel, msg|\n            @clients.each {|ws| ws.send(msg) }\n          end\n        end\n      end\n=end\n    end\n\n    def call(env)\n      if Faye::WebSocket.websocket?(env)\n        ws = Faye::WebSocket.new(env, nil, {ping: KEEPALIVE_TIME })\n        ws.on :open do |event|\n          p [:open, ws.object_id]\n          @clients << ws\n        end\n\n        ws.on :message do |event|\n          p [:message, event.data]\n          # @redis.publish(CHANNEL, sanitize(event.data))\n          @clients.each {|c| c.send(sanitize(event.data))}\n        end\n```\n\n\u3053\u308c\u3067\u30ed\u30fc\u30ab\u30eb\u3067\u3082production\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u3064\u3051\u308b\u3068\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u308b(production\u306b\u3057\u306a\u3044\u3068\u4f55\u6545\u304bpuma\u304c\u3053\u3051\u308b)\u3002\n\n```sh:\n$ bundle exec rackup -E production\nPuma 2.6.0 starting...\n* Min threads: 0, max threads: 16\n* Environment: production\n* Listening on tcp://0.0.0.0:9292\n```\n\n\u3088\u3046\u3084\u304fHTML\u304c\u8868\u793a\u3055\u308c\u3066\u559c\u3076\u304c\u3001production\u306a\u3089https\u3060\u3088\u306d\u3002\u3060\u304b\u3089wss\u4f7f\u3046\u306d\u3001\u3068\u3044\u3046\u304a\u305b\u3063\u304b\u3044\u30b3\u30fc\u30c9\u306e\u305b\u3044\u3067\u3001http\u3067\u7acb\u3061\u3042\u3052\u3066\u3044\u308b\u3068websocket\u63a5\u7d9a\u304c\u3067\u304d\u306a\u3044\u3002\u3055\u3089\u306bOpenShift\u3067\u306fws\u306e\u5f85\u53d7\u30dd\u30fc\u30c8\u304c\u7279\u6b8a\u306a\u306e\u3067\u3084\u306f\u308awebsocket\u901a\u4fe1\u306f\u307e\u3060\u3067\u304d\u306a\u3044\u3002\u5f8c\u3067\u307e\u3068\u3081\u3066\u5909\u66f4\u3059\u308b\u3053\u3068\u306b\u3059\u308b\u3002\n\n# OpenShift\u306b\u3042\u308f\u305b\u3066Gemfile\u7b49\u306e\u8a2d\u5b9a\u3092\u5909\u3048\u308b\n\u30ed\u30fc\u30ab\u30eb\u3067\u306f\u305d\u308c\u306a\u308a\u306b\u52d5\u3044\u305f\u306e\u3067OpenShift\u306bpush\u3057\u3066\u307f\u308b\u3068\u5909\u306a\u3068\u3053\u308d\u3067\u30a8\u30e9\u30fc\u304c\u3067\u3066\u3044\u308b\u3002\nheroku\u3067\u306fGemfile\u306bruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b`ruby`\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u4f7f\u3048\u308b\u304c\u3001OpenShift\u3067\u306f\u4f7f\u3048\u306a\u3044\u304b\u3089\u306e\u3088\u3046\u3060\u3002\u3068\u3044\u3046\u308f\u3051\u3067\u524a\u308b\u3002\u3064\u3044\u3067\u306b\u3082\u3046\u4f7f\u308f\u306a\u3044redis\u3082\u524a\u3063\u3066\u304a\u304f\u3002\n\n```ruby:Gemfile\nsource \"https://rubygems.org\"\n\n# ruby \"2.0.0\"\n\ngem \"faye-websocket\"\ngem \"sinatra\"\ngem \"puma\"\n# gem \"redis\"\n```\n\n`bundle install`\u3092\u3057\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u66f4\u65b0\u3057\u3066\u304b\u3089`git push origin master`\u3092\u3059\u308b\u3068OpenShift\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u308b\u3002\u30ed\u30fc\u30ab\u30eb\u3068\u540c\u69d8\u306bHTML\u306f\u8868\u793a\u3055\u308c\u308b\u3002\u3084\u3063\u305f\u306d\u3002\u3060\u304c\u3057\u304b\u3057websocket\u3092\u4f7f\u3046\u30c1\u30e3\u30c3\u30c8\u90e8\u5206\u306f\u4f55\u3082\u52d5\u304b\u306a\u3044\u3002\n\n# OpenShift\u3067puma\u3092\u52d5\u4f5c\u3055\u305b\u308b\n\u4ee5\u4e0b\u3001\u307b\u307c[Ruby websockets on Openshift](http://mfojtik.im/ruby-websockets-on-openshift)\u306e\u53d7\u3051\u58f2\u308a\u3002\n\nOpenShift\u306eruby\u74b0\u5883\u3067\u306fapache+passenger\u304c\u4f7f\u308f\u308c\u3066\u304a\u308a\u3001\u975e\u5e38\u306b\u30c8\u30ea\u30c3\u30ad\u30fc\u306a\u3053\u3068\u3092\u3057\u306a\u3044\u3068websocket\u306e\u901a\u4fe1\u304c\u3067\u304d\u306a\u3044\u3089\u3057\u3044\u3002\u305f\u3060\u3057OpenShift\u306b\u306f\u629c\u3051\u9053\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u3066\u3001passenger\u306e\u4ee3\u308f\u308a\u306b\u4ed6\u306eweb server\u3092\u5229\u7528\u3059\u308b\u65b9\u6cd5\u304c\u3042\u308b\u3002\u305d\u308c\u3092\u4f7f\u3063\u3066ruby\u88fd\u306ewebserver puma\u3092\u8d77\u52d5\u3057\u3066\u3084\u308b\u3068websocket\u306e\u901a\u4fe1\u3082\u6bd4\u8f03\u7684\u7c21\u5358\u306b\u3067\u304d\u308b\u3088\u3001\u3068\u3044\u3046\u3053\u3068\u306e\u3088\u3046\u3060\u3002\u78ba\u304b\u306bheroku\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3082puma\u3092\u8d77\u52d5\u3059\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u305f\u3002\n\n\u5177\u4f53\u7684\u306b\u306fOpenShift\u304c\u7528\u610f\u3057\u3066\u3044\u308b\u30d5\u30c3\u30af\u304c\u3042\u308b\u306e\u3067\u3001\u305d\u3053\u306bpassenger\u306e\u505c\u6b62\u3068puma\u306e\u8d77\u52d5\u3001puma\u306e\u505c\u6b62\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7f6e\u304f\u3002\u5b9f\u884c\u5c5e\u6027\u3092\u4ed8\u3051\u308b\u306e\u3092\u5fd8\u308c\u306a\u3044\u3088\u3046\u306b\u3002\n\n```sh:/.openshift/action_hooks/post_start_ruby-1.9\n#!/bin/bash\necho \"Replacing the default Passenger server with Puma\"\npushd ${OPENSHIFT_REPO_DIR} > /dev/null\n${HOME}/ruby/bin/control stop\nset -e\nPUMA_PID_FILE=\"${OPENSHIFT_DATA_DIR}puma.pid\"\nPUMA_BIND_URL=\"tcp://${OPENSHIFT_RUBY_IP}:${OPENSHIFT_RUBY_PORT}\"\nPUMA_OPTS=\"-d --pidfile ${PUMA_PID_FILE} -e production --bind '${PUMA_BIND_URL}'\"\nbundle exec \"puma $PUMA_OPTS\"\nexit 0\n```\n\n```sh:/.openshift/action_hooks/deploy\n#!/bin/bash\nif [ -f \"${OPENSHIFT_DATA_DIR}puma.pid\" ]; then\n  echo \"Stopping Puma...\"\n  PUMA_PID=$(cat \"${OPENSHIFT_DATA_DIR}puma.pid\")\n  ps -p $PUMA_PID &> /dev/null\n  [ \"$?\" == 0 ] && kill $PUMA_PID\nfi\n```\n\nOpenShift\u306bpush\u3057\u3066\u78ba\u8a8d\u3059\u308b\u3002\u5148\u7a0b\u3068\u306f\u9055\u3044push\u5f8c\u306e\u8d77\u52d5\u30ed\u30b0\u3067Puma\u306e\u8d77\u52d5\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u3067\u3066\u3044\u308b\u306e\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```sh:\n(\u7565)\nremote: Activating deployment\nremote: Starting Ruby cartridge\nremote: Replacing the default Passenger server with Puma\nremote: Stopping Ruby cartridge\nremote: Waiting for stop to finish\nremote: Puma starting in single mode...\nremote: * Version 2.6.0, codename: Pantsuit Party\nremote: * Min threads: 0, max threads: 16\nremote: * Environment: production\nremote: * Listening on tcp://127.8.152.129:8080\nremote: * Daemonizing...\nremote: Result: success\nremote: Activation status: success\nremote: Deployment completed with status: success\n(\u7565)\n```\n\n\u3082\u3046\u3072\u3068\u3044\u304d\u3060\uff01\u3055\u3042\u5f8c\u306f\u30dd\u30fc\u30c8\u306e\u8a2d\u5b9a\u3060\u3051\u3060\u3002\n\n# websockets\u306e\u30dd\u30fc\u30c8\u3092OpenShift\u306e\u4ed5\u69d8\u306b\u3042\u308f\u305b\u308b\nOpenShift\u3067\u306f\u5916\u304b\u3089\u306ewebsocket\u306e\u30dd\u30fc\u30c8\u306f8000\u30688443\u306b\u5272\u308a\u3042\u3066\u3089\u308c\u3066\u3044\u308b([Try Out Low-Latency Connections with WebSockets](https://www.openshift.com/blogs/paas-websockets)\u53c2\u7167)\u3002\u524d\u8005\u304chttp\u7528\u3067\u5f8c\u8005\u304chttps\u7528\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u3067\u306fwebsocket\u306e\u901a\u4fe1\u308280\u3068443\u3067\u884c\u3046\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u305d\u3053\u3092\u5909\u66f4\u3059\u308b\u3002\u30c6\u30b9\u30c8\u306a\u306e\u3067ws\u306e8000\u30dd\u30fc\u30c8\u306b\u56fa\u5b9a\u3057\u3066\u304a\u304f\u3002\n\n```javascript:/views/application.js.erb\n//var scheme   = \"<%= @scheme %>\";\nvar scheme   = \"ws://\";\n//var uri      = scheme + window.document.location.host + \"/\";\nvar uri      = scheme + window.document.location.hostname + \":8000/\";\nvar ws       = new WebSocket(uri);\nws.onmessage = function(message) {\n  var data = JSON.parse(message.data);\n  $(\"#chat-text\").append(\"<div class='panel panel-default'><div class='panel-heading'>\" + da\\\nta.handle + \"</div><div class='panel-body'>\" + data.text + \"</div></div>\");\n  $(\"#chat-text\").stop().animate({\n    scrollTop: $('#chat-text')[0].scrollHeight\n  }, 800);\n};\n\n$(\"#input-form\").on(\"submit\", function(event) {\n  event.preventDefault();\n  var handle = $(\"#input-handle\")[0].value;\n  var text   = $(\"#input-text\")[0].value;\n  ws.send(JSON.stringify({ handle: handle, text: text }));\n  $(\"#input-text\")[0].value = \"\";\n});\n```\n\n\u3053\u308c\u3067push\u3059\u308c\u3070\u3088\u3046\u3084\u304f\u30c1\u30e3\u30c3\u30c8\u30b5\u30f3\u30d7\u30eb\u304c\u52d5\u4f5c\u3059\u308b\u3002\u8907\u6570\u30d6\u30e9\u30a6\u30b6\u3092\u7acb\u3061\u3042\u3052\u3066\uff11\u4eba\u30c1\u30e3\u30c3\u30c8\u3092\u697d\u3057\u3082\u3046\u3002\u304a\u3064\u304b\u308c\u3055\u307e\u3067\u3057\u305f\u3002\n\n\u3053\u306e\u624b\u9806\u3067\u4f5c\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u305d\u306e\u3082\u306e\u3092 http://websocketchat-l1s.rhcloud.com/ \u3067\u52d5\u304b\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u6c17\u306b\u306a\u308b\u65b9\u306f\u3069\u3046\u305e\u3002\u3057\u3070\u3089\u304f\u306f\u6b8b\u3057\u3066\u304a\u304f\u3064\u3082\u308a\u3067\u3059\u304c\u7121\u6599\u67a0\u304c\u8db3\u308a\u306a\u304f\u306a\u3063\u305f\u3089\u6d88\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3042\u3057\u304b\u3089\u305a\u3002\n\n# \u307e\u3068\u3081\nOpenShift\u306ewebsocket\u306f\u4e00\u5e74\u307b\u3069\u524d\u306bpreview version\u3068\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u305d\u306e\u5f8c\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u304c\u3069\u3046\u306a\u3063\u3066\u3044\u308b\u304b\u306f\u78ba\u8a8d\u3067\u304d\u306a\u304b\u3063\u305f\u3002\u305f\u3060\u3057\u3001\u3044\u308d\u3044\u308d\u8abf\u3079\u308b\u3068\u73fe\u72b6\u3067\u3082preview version\u6642\u306e\u60c5\u5831\u306f\u305d\u306e\u307e\u307e\u751f\u304d\u3066\u3044\u3066\u3001\u305d\u308c\u306b\u5f93\u3046\u3053\u3068(+\u30b5\u30fc\u30d0\u7f6e\u304d\u63db\u3048\u3068\u3044\u3046\u8352\u6280)\u3092\u3059\u308c\u3070ruby\u3067\u3082websocket\u3092\u697d\u3057\u3081\u308b\u3002\u73fe\u306b\u3001heroku\u306ewebsocket\u306a\u30c1\u30e3\u30c3\u30c8\u30b5\u30f3\u30d7\u30eb\u3092\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u307e\u308f\u308a\u3060\u3051\u4fee\u6b63\u3059\u308b\u3053\u3068\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u305f\u3002\n\u30dd\u30a4\u30f3\u30c8\u306f\u3001\n\n- Puma\u3092\u52d5\u304b\u3059\n- Port\u306e\u6307\u5b9a\u306b\u6ce8\u610f\u3059\u308b\n\n\u306e2\u70b9\u3002\n\u3053\u308c\u306b\u6c17\u3092\u3064\u3051\u3066\u3044\u308c\u3070heroku\u306ewebsocket\u306e\u30b3\u30fc\u30c9\u304c\u3059\u3053\u3057\u306e\u5909\u66f4\u3067\u52d5\u304d\u305d\u3046\u3067\u5922\u304c\u5e83\u304c\u308b\u3002\n\n# \u86c7\u8db3\n\u305d\u3082\u305d\u3082\u3053\u306e\u8a18\u4e8b\u3092\u66f8\u3053\u3046\u3068\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u7de8\u96c6\u3059\u308b\u306b\u3057\u3066\u3082\u3001\u30a8\u30c7\u30a3\u30bf\u3067\u66f8\u3044\u305f\u6587\u7ae0\u3092\u30d6\u30e9\u30a6\u30b6\u306b\u30da\u30fc\u30b9\u30c8\u3059\u308b\u306b\u3057\u3066\u3082\u3001\u63a8\u6572\u3084\u7de8\u96c6\u304c\u3084\u308a\u306b\u304f\u304f\u3066\u305f\u307e\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u5148\u306e\u6295\u7a3f\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u3044\u305f\u3002\u6280\u8853\u306e\u529b\u3067\u3059\u3053\u3057\u5e78\u305b\u306b\u306a\u3063\u305f\u3002\n\n# \u53c2\u8003\u60c5\u5831\n- [Using WebSockets on Heroku with Ruby](https://devcenter.heroku.com/articles/ruby-websockets)\n - heroku\u306e\u30b5\u30dd\u30fc\u30c8\u30da\u30fc\u30b8\u306ewebsocket\u30b5\u30f3\u30d7\u30eb\n- [How to Migrate Your Heroku Ruby Application to OpenShift](https://www.openshift.com/blogs/heroku-ruby-app-migration)\n - OpenShift\u306e\u30d6\u30ed\u30b0\u3001heroku\u304b\u3089\u306eruby\u30a2\u30d7\u30ea\u306e\u79fb\u690d\u65b9\u6cd5\n- [Try Out Low-Latency Connections with WebSockets](https://www.openshift.com/blogs/paas-websockets)\n - OpenShift\u306e\u30d6\u30ed\u30b0\u3001websocket\u306e\u4f7f\u3044\u65b9\n- [Ruby websockets on Openshift](http://mfojtik.im/ruby-websockets-on-openshift)\n - OpenShift\u3067\u306e\u7c21\u5358\u306aruby websocket\u306e\u52d5\u304b\u3057\u65b9\n- [Qiita\u306b\u6295\u7a3f\u3059\u308bRuby\u30b9\u30af\u30ea\u30d7\u30c8](http://qiita.com/lassie116/items/7042c3ac1f955f67fe1a)\n - Qiita\u3078\u6295\u7a3f\u3059\u308b\u62d9\u4f5c\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u7d39\u4ecb\n", "tags": ["websocket", "Ruby", "openshift"]}