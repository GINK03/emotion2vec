{"context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\nAjax\u3092\u7528\u3044\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n\n\u30d5\u30a1\u30a4\u30eb\u9078\u629e\u3068\u540c\u6642\u306bAjax\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\n\u30d5\u30a1\u30a4\u30eb\u540d\u306f\u65e5\u4ed8\u306b\u5909\u66f4\u3057\u3066\u4fdd\u5b58\n\u30b5\u30e0\u30cd\u30a4\u30eb\u306e\u8868\u793a\n\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u6570\u306e\u5236\u9650\uff08\u6700\u5927\uff13\u3064\uff09\n\u753b\u50cf\u524a\u9664\u30dc\u30bf\u30f3\u306e\u8a2d\u7f6e\n\n\n\n*\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u306e\u90e8\u5206\u306f\u5b9f\u88c5\u51fa\u6765\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n*\u4f7f\u7528\u3057\u3066\u3044\u308b\u753b\u50cf\u306f\u30d5\u30ea\u30fc\u7d20\u6750\u3067\u3059\u3002\nstarwars-icon\n\n\uff13\u3064\u76ee\u306e\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u308b\u3068input\u304c\u975e\u8868\u793a\u306b\u306a\u308b\u3002\n\uff081\u3064\u753b\u50cf\u304c\u524a\u9664\u3055\u308c\u308b\u3068\u518d\u5ea6\u8868\u793a\u3055\u308c\u308b\uff09\n\n\nindex.php\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <script src=\"js/jquery-1.12.4.min.js\" charset=\"utf-8\"></script>\n    <style media=\"screen\">\n      li{\n        list-style: none;\n      }\n    </style>\n    <script type=\"text/javascript\">\n    $(function(){\n      var $fileList = $('#file_list');\n      $fileList\n        //\u524a\u9664\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u305f\u5834\u5408\u306e\u51e6\u7406\n        .on('click.deleteFile', '.delete_btn', function(){\n          var $li = $(this).closest('.each_file');\n          $li.remove();\n          //input\u30bf\u30b0\u6570\u304c4\u3064\u672a\u6e80\u306b\u306a\u3063\u305f\u5834\u5408\u306b\u518d\u5ea6\u8868\u793a\u3055\u305b\u308b\u51e6\u7406\n          var $fileListLI = $('#file_list li input[name=img_file]');\n          var inputFileNum = $fileListLI.length;\n          //\u6700\u5f8c\u306einput\u30bf\u30b0\u3092\u8868\u793a\u3059\u308b\u51e6\u7406\n          var lastInputFile = $fileListLI.eq(-1);\n          if (inputFileNum < 4){\n            $(lastInputFile).show();\n          }\n          return false;\n        })\n\n      $fileList\n        //input\u30bf\u30b0\u306b\u753b\u50cf\u304c\u8ffd\u52a0\u3055\u308c\u305f\u5834\u5408\u306e\u51e6\u7406\n        .on('change.inputFile', '.input_file', function(e){\n          var $input = $(this),\n              $li    = $input.closest('.each_file'),\n              $newLi = $li.clone();\n              $fileList.append($newLi);\n          //\u30b5\u30e0\u30cd\u30a4\u30eb\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u51e6\u7406\n          var file = e.target.files[0],\n              fileName = file.name;\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//FileReader\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n              reader = new FileReader();\n              reader.readAsDataURL(file);\n\n              reader.onloadend = function(){\n                var fileReader = this;\n                if(fileReader.result){\n                  var thumb = '<div class = \"thumbnail\"><img src = \"' + fileReader.result + '\" width = \"150px\" style = \"max-width: 150px;\">' + fileName + '<button class = \"delete_btn\">\u524a\u9664</button></div>';\n                  $li.append(thumb);\n                }\n                return this;\n              };\n          $input.hide();\n\n          //\u753b\u50cf\u304c3\u3064\u306b\u306a\u3063\u305f\u5834\u5408\u306binput\u30bf\u30b0\u3092\u975e\u8868\u793a\u306b\u3059\u308b\u51e6\u7406\n          //\u4e0a\u306b\u3082\u540c\u3058\u30b3\u30fc\u30c9\u304c\u3042\u308b\u306e\u3067\u307e\u3068\u3081\u305f\u65b9\u304c\u3044\u3044\u306e\u3067\u3059\u304c...\n          var $fileListLI = $('#file_list li input[name=img_file]');\n          var inputFileNum = $fileListLI.length;\n          var lastInputFile = $fileListLI.eq(-1);\n          if (inputFileNum == 4){\n            $(lastInputFile).hide();\n          }\n\n          //Ajax\u3067\u98db\u3070\u3059data\uff08FromData\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\n          var fd = new FormData();\n\u3000\u3000\u3000\u3000\u3000//\u6700\u5f8c\u304b\u30892\u756a\u76ee\u306einput\u30bf\u30b0\u3092\u62fe\u3046\u51e6\u7406\n\u3000\u3000\u3000\u3000\u3000//\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u308binput\u30bf\u30b0\u306f\u5fc5\u305a\u6700\u5f8c\u304b\u30892\u756a\u76ee\n          var targetFile = $fileListLI.eq(-2);\n\u3000\u3000\u3000\u3000\u3000//1\u753b\u50cf\u6bce\u306eUP\u306a\u306e\u3067[0]\u3001\u8907\u6570\u3067\u3042\u308b\u5834\u5408\u306f[1][2]...\n          fd.append( \"file\", $(targetFile).prop(\"files\")[0]);\n\n          $.ajax({\n            url: 'file_api.php',\n            type: 'post',\n            dataType: 'json',\n            data: fd,\n            processData: false,\n            contentType: false\n          })\n          .done(function(res){\n            console.log(res);\n          })\n          .fail(function(jqXHR, statusText, errorThrown){\n            console.log(errorThrown);\n          });\n          return this;\n        });\n    });\n    </script>\n    <title>Ajax Sample</title>\n  </head>\n  <body>\n    <h1>Ajax sample</h1>\n    <form action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\">\n      <ul id=\"file_list\">\n        <li class=\"each_file\">\n          <input type=\"file\" class=\"input_file\" name=\"img_file\" value=\"\" accept=\"image/*\">\n        </li>\n      </ul>\n      <input type=\"submit\" id=\"submit_btn\" value=\"\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\">\n    </form>\n  </body>\n</html>\n\n\n\n\nfile_api.php\n<?php\n  date_default_timezone_set('Asia/Tokyo');\n  header(\"Content-type: text/json; charset=UTF-8\");\n  //\u76f4\u63a5\u306e\u30da\u30fc\u30b8\u9077\u79fb\u3092\u963b\u6b62\n  $request = isset($_SERVER['HTTP_X_REQUESTED_WITH']) ? strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) : '';\n  if($request !== 'xmlhttprequest') exit;\n  //\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u53d6\u5f97\n  $file_ext = pathinfo($_FILES['file']['name']);\n  $time = date(\"YmdHis\");\n  //\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u65e5\u4ed8\u306b\u5909\u66f4\n  $file_name = $time.\".\".$file_ext[extension];\n  //\u4fdd\u5b58\u5148\u306e\u30d1\u30b9\n\u3000//index.php file_api.php\u3068\u540c\u5c64\u306bupload_file\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\n  $file_path = \"upload_file/\".$file_name;\n\n  $tmp_file = $_FILES['file']['tmp_name'];\n  $result = move_uploaded_file($tmp_file, $file_path);\n  //\u4fdd\u5b58\u51fa\u6765\u305f\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092json\u3067\u8fd4\u3059\n  if($result){\n    echo json_encode($file_name);\n  }\n?>\n\n\n\u5927\u5909\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/mpyw/items/939964377766a54d4682\nhttps://app.codegrid.net/entry/file-api-filereader-api\nhttp://libro.tuyano.com/index3?id=384001&page=3\n#\u3084\u308a\u305f\u3044\u3053\u3068\n- Ajax\u3092\u7528\u3044\u305f\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n - \u30d5\u30a1\u30a4\u30eb\u9078\u629e\u3068\u540c\u6642\u306bAjax\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u5b58\n - \u30d5\u30a1\u30a4\u30eb\u540d\u306f\u65e5\u4ed8\u306b\u5909\u66f4\u3057\u3066\u4fdd\u5b58\n - \u30b5\u30e0\u30cd\u30a4\u30eb\u306e\u8868\u793a\n - \u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u6570\u306e\u5236\u9650\uff08\u6700\u5927\uff13\u3064\uff09\n - \u753b\u50cf\u524a\u9664\u30dc\u30bf\u30f3\u306e\u8a2d\u7f6e\n \n*\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u5bfe\u7b56\u306e\u90e8\u5206\u306f\u5b9f\u88c5\u51fa\u6765\u3066\u304a\u308a\u307e\u305b\u3093\u3002\n*\u4f7f\u7528\u3057\u3066\u3044\u308b\u753b\u50cf\u306f\u30d5\u30ea\u30fc\u7d20\u6750\u3067\u3059\u3002\n[starwars-icon](http://www.oxygenna.com/news/free-set-of-star-wars-avatars)\n\n<img width=\"650\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-31 11.39.00.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/114886/22af46d0-1164-778d-d941-342ea7aba996.png\">\n\n\uff13\u3064\u76ee\u306e\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u308b\u3068`input`\u304c\u975e\u8868\u793a\u306b\u306a\u308b\u3002\n\uff081\u3064\u753b\u50cf\u304c\u524a\u9664\u3055\u308c\u308b\u3068\u518d\u5ea6\u8868\u793a\u3055\u308c\u308b\uff09\n<img width=\"623\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-31 11.39.18.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/114886/3b6346a8-eec4-d98e-2bed-8bdd581eb2b9.png\">\n\n\n```index.php\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta charset=\"utf-8\">\n    <script src=\"js/jquery-1.12.4.min.js\" charset=\"utf-8\"></script>\n    <style media=\"screen\">\n      li{\n        list-style: none;\n      }\n    </style>\n    <script type=\"text/javascript\">\n    $(function(){\n      var $fileList = $('#file_list');\n      $fileList\n        //\u524a\u9664\u304c\u30af\u30ea\u30c3\u30af\u3055\u308c\u305f\u5834\u5408\u306e\u51e6\u7406\n        .on('click.deleteFile', '.delete_btn', function(){\n          var $li = $(this).closest('.each_file');\n          $li.remove();\n          //\binput\u30bf\u30b0\u6570\u304c4\u3064\u672a\u6e80\u306b\u306a\u3063\u305f\u5834\u5408\u306b\u518d\u5ea6\u8868\u793a\u3055\u305b\u308b\u51e6\u7406\n          var $fileListLI = $('#file_list li input[name=img_file]');\n          var inputFileNum = $fileListLI.length;\n          //\u6700\u5f8c\u306einput\u30bf\u30b0\u3092\u8868\u793a\u3059\u308b\u51e6\u7406\n          var lastInputFile = $fileListLI.eq(-1);\n          if (inputFileNum < 4){\n            $(lastInputFile).show();\n          }\n          return false;\n        })\n\n      $fileList\n        //input\u30bf\u30b0\u306b\u753b\u50cf\u304c\u8ffd\u52a0\u3055\u308c\u305f\u5834\u5408\u306e\u51e6\u7406\n        .on('change.inputFile', '.input_file', function(e){\n          var $input = $(this),\n              $li    = $input.closest('.each_file'),\n              $newLi = $li.clone();\n              $fileList.append($newLi);\n          //\u30b5\u30e0\u30cd\u30a4\u30eb\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u51e6\u7406\n          var file = e.target.files[0],\n              fileName = file.name;\n\u3000\u3000\u3000\u3000\u3000\u3000\u3000\u3000//FileReader\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\n              reader = new FileReader();\n              reader.readAsDataURL(file);\n\n              reader.onloadend = function(){\n                var fileReader = this;\n                if(fileReader.result){\n                  var thumb = '<div class = \"thumbnail\"><img src = \"' + fileReader.result + '\" width = \"150px\" style = \"max-width: 150px;\">' + fileName + '<button class = \"delete_btn\">\u524a\u9664</button></div>';\n                  $li.append(thumb);\n                }\n                return this;\n              };\n          $input.hide();\n\n          //\u753b\u50cf\u304c3\u3064\u306b\u306a\u3063\u305f\u5834\u5408\u306binput\u30bf\u30b0\u3092\u975e\u8868\u793a\u306b\u3059\u308b\u51e6\u7406\n          //\u4e0a\u306b\u3082\u540c\u3058\u30b3\u30fc\u30c9\u304c\u3042\u308b\u306e\u3067\u307e\u3068\u3081\u305f\u65b9\u304c\u3044\u3044\u306e\u3067\u3059\u304c...\n          var $fileListLI = $('#file_list li input[name=img_file]');\n          var inputFileNum = $fileListLI.length;\n          var lastInputFile = $fileListLI.eq(-1);\n          if (inputFileNum == 4){\n            $(lastInputFile).hide();\n          }\n\n          //Ajax\u3067\u98db\u3070\u3059data\uff08FromData\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09\u3092\u751f\u6210\u3059\u308b\u51e6\u7406\n          var fd = new FormData();\n\u3000\u3000\u3000\u3000\u3000//\u6700\u5f8c\u304b\u30892\u756a\u76ee\u306einput\u30bf\u30b0\u3092\u62fe\u3046\u51e6\u7406\n\u3000\u3000\u3000\u3000\u3000//\u753b\u50cf\u304c\u9078\u629e\u3055\u308c\u308binput\u30bf\u30b0\u306f\u5fc5\u305a\u6700\u5f8c\u304b\u30892\u756a\u76ee\n          var targetFile = $fileListLI.eq(-2);\n\u3000\u3000\u3000\u3000\u3000//1\b\u753b\u50cf\u6bce\u306eUP\u306a\u306e\u3067[0]\u3001\u8907\u6570\u3067\u3042\u308b\u5834\u5408\u306f[1][2]...\n          fd.append( \"file\", $(targetFile).prop(\"files\")[0]);\n          \n          $.ajax({\n            url: 'file_api.php',\n            type: 'post',\n            dataType: 'json',\n            data: fd,\n            processData: false,\n            contentType: false\n          })\n          .done(function(res){\n            console.log(res);\n          })\n          .fail(function(jqXHR, statusText, errorThrown){\n            console.log(errorThrown);\n          });\n          return this;\n        });\n    });\n    </script>\n    <title>Ajax Sample</title>\n  </head>\n  <body>\n    <h1>Ajax sample</h1>\n    <form action=\"upload.php\" method=\"post\" enctype=\"multipart/form-data\">\n      <ul id=\"file_list\">\n        <li class=\"each_file\">\n          <input type=\"file\" class=\"input_file\" name=\"img_file\" value=\"\" accept=\"image/*\">\n        </li>\n      </ul>\n      <input type=\"submit\" id=\"submit_btn\" value=\"\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\">\n    </form>\n  </body>\n</html>\n\n```\n\n```file_api.php\n<?php\n  date_default_timezone_set('Asia/Tokyo');\n  header(\"Content-type: text/json; charset=UTF-8\");\n  //\u76f4\u63a5\u306e\u30da\u30fc\u30b8\u9077\u79fb\u3092\u963b\u6b62\n  $request = isset($_SERVER['HTTP_X_REQUESTED_WITH']) ? strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) : '';\n  if($request !== 'xmlhttprequest') exit;\n  //\u753b\u50cf\u306e\u62e1\u5f35\u5b50\u3092\u53d6\u5f97\n  $file_ext = pathinfo($_FILES['file']['name']);\n  $time = date(\"YmdHis\");\n  //\u30d5\u30a1\u30a4\u30eb\u540d\u3092\u65e5\u4ed8\u306b\u5909\u66f4\n  $file_name = $time.\".\".$file_ext[extension];\n  //\u4fdd\u5b58\u5148\u306e\u30d1\u30b9\n\u3000//index.php file_api.php\u3068\u540c\u5c64\u306bupload_file\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5b58\u5728\n  $file_path = \"upload_file/\".$file_name;\n\n  $tmp_file = $_FILES['file']['tmp_name'];\n  $result = move_uploaded_file($tmp_file, $file_path);\n  //\u4fdd\u5b58\u51fa\u6765\u305f\u3089\u30d5\u30a1\u30a4\u30eb\u540d\u3092json\u3067\u8fd4\u3059\n  if($result){\n    echo json_encode($file_name);\n  }\n?>\n```\n\n\u5927\u5909\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u3002\nhttp://qiita.com/mpyw/items/939964377766a54d4682\nhttps://app.codegrid.net/entry/file-api-filereader-api\nhttp://libro.tuyano.com/index3?id=384001&page=3\n\n\n\n\n \n", "tags": ["Ajax", "jQuery", "PHP"]}