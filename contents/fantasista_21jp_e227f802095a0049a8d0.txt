{"tags": ["AWS", "postfix", "ses"], "context": " More than 1 year has passed since last update.\n\nPostfix\u304b\u3089\u306e\u9001\u4fe1\u3092\u5168\u3066SES\u7d4c\u7531\u306b\u5909\u66f4\u3059\u308b\n\n\u306f\u3058\u3081\u306b\n\n\u25bc\u30e1\u30ea\u30c3\u30c8\n\nEC2\u304b\u3089\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u304d\u3001AWS\u306e\u9001\u4fe1\u5236\u9650\uff08\u30dd\u30fc\u30c8\u30c1\u30a7\u30c3\u30af\uff09\u3092\u6c17\u306b\u305b\u305a\u306b\u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u304c\u51fa\u6765\u307e\u3059\u3002\n\nmb_send_mail\u306a\u3069\u306e\u95a2\u6570\u3092\u4f7f\u7528\u3057\u305f\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8\u5206\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306a\u3069\u3067\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u304d\u3001\u9001\u4fe1\u5236\u9650\u3092\u6c17\u306b\u3057\u306a\u304f\u3066\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u3002\n\n\n\u25bc\u30c7\u30e1\u30ea\u30c3\u30c8\n\n\u304a\u91d1\u304c\u304b\u304b\u308a\u307e\u3059\u3002\uff08\u3059\u3054\u3044\u5b89\u3044\u3051\u3069\uff09\n\n\n\u69cb\u7bc9\n\n\u25bcAWS\u3067\u306e\u6e96\u5099\n\nAmazon SES SMTP \u8a8d\u8a3c\u60c5\u5831\u3092\u53d6\u5f97\nSES \uff1e SMTP Settings \u304b\u3089 [Create My SMTP Credentials] \u3092\u30af\u30ea\u30c3\u30af\u3002\n\nIAM\u30e6\u30fc\u30b6\u30fc\u540d\u3092\u6c7a\u3081\u3066\u4f5c\u6210\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n[\u30e6\u30fc\u30b6\u30fc\u306e SMTP \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a]\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\n\nSMTP \u30e6\u30fc\u30b6\u30fc\u540d\nSMTP \u30d1\u30b9\u30ef\u30fc\u30c9\n\n\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\n\n\u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u8a8d\u8a3c\u3059\u308b\n\u300cE\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u8a8d\u8a3c\u300d\u304b\u300c\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u300d\u3092\u3057\u3066\u3001SES\u304b\u3089\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n\u25bc\u30b5\u30fc\u30d0\u5074\u306e\u8a2d\u5b9a\n# Postfix\u5468\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root@ip-172-31-20-41 ~]# yum install postfix mailx cyrus-sasl-plain cyrus-sasl-md5\n# Sendmail \u505c\u6b62\n[root@ip-172-31-20-41 ~]# service sendmail stop\n[root@ip-172-31-20-41 ~]# chkconfig sendmail off\n# mta \u3092 Postfix \u306b\u5909\u66f4\n[root@ip-172-31-20-41 ~]# alternatives --config mta\n     There is 1 program that provides 'mta'.\n\n       Selection    Command\n     -----------------------------------------------\n     *+ 1           /usr/sbin/sendmail.sendmail\n     + 2           /usr/sbin/sendmail.postfix\n     Enter to keep the current selection[+], or type selection number: 2\n[root@ip-172-31-20-41 ~]# alternatives --display mta\n    mta - status is manual.\n     link currently points to /usr/sbin/sendmail.postfix\n    /usr/sbin/sendmail.postfix - priority 30\n     slave mta-pam: /etc/pam.d/smtp.postfix\n     slave mta-mailq: /usr/bin/mailq.postfix\n     slave mta-newaliases: /usr/bin/newaliases.postfix\n     slave mta-rmail: /usr/bin/rmail.postfix\n     slave mta-sendmail: /usr/lib/sendmail.postfix\n     slave mta-mailqman: /usr/share/man/man1/mailq.postfix.1.gz\n     slave mta-newaliasesman: /usr/share/man/man1/newaliases.postfix.1.gz\n     slave mta-aliasesman: /usr/share/man/man5/aliases.postfix.5.gz\n     slave mta-sendmailman: /usr/share/man/man1/sendmail.postfix.1.gz\n    Current `best' version is /usr/sbin/sendmail.postfix.\n# Sendmail \u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u4e00\u7dd2\u306b\u5fc5\u8981\u306a\u306e\u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305d\u3046\u3060\u3063\u305f\u3089\u30b3\u30ec\u306f\u98db\u3070\u3059\uff09\n[root@ip-172-31-20-41 ~]# yum remove sendmail\n# Postfix \u8a2d\u5b9a\n[root@ip-172-31-20-41 ~]# cp /etc/postfix/main.cf /etc/postfix/main.cf.bak20150812\n# \u203bemail-smtp.us-east-1.amazonaws.com \u306e\u90e8\u5206\u306f\u4f7f\u7528\u3057\u3066\u3044\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/main.cf\n     relayhost = [email-smtp.us-east-1.amazonaws.com]:25\n     smtp_sasl_auth_enable = yes\n     smtp_sasl_security_options = noanonymous\n     smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd\n     smtp_use_tls = yes\n     smtp_tls_security_level = encrypt\n     smtp_tls_note_starttls_offer = yes\n[root@ip-172-31-20-41 ~]# diff /etc/postfix/main.cf /etc/postfix/main.cf.bak20150812\n     684,692d683\n     <\n     < relayhost = [email-smtp.us-east-1.amazonaws.com]:25\n     < smtp_sasl_auth_enable = yes\n     < smtp_sasl_security_options = noanonymous\n     < smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd\n     < smtp_use_tls = yes\n     < smtp_tls_security_level = encrypt\n     < smtp_tls_note_starttls_offer = yes\n     <\n[root@ip-172-31-20-41 ~]# cp /etc/postfix/master.cf /etc/postfix/master.cf.bak20150812\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/master.cf\n     #       -o smtp_fallback_relay=\n[root@ip-172-31-20-41 ~]# diff /etc/postfix/master.cf /etc/postfix/master.cf.bak20150812\n     39c39\n     < #     -o smtp_fallback_relay=\n     ---\n     >       -o smtp_fallback_relay=\n[root@ip-172-31-20-41 ~]# touch /etc/postfix/sasl_passwd\n# \u203b\u5148\u7a0b\u4f5c\u6210\u3057\u305fSMTP \u30e6\u30fc\u30b6\u30fc\u540d,SMTP \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/sasl_passwd\n     [email-smtp.us-east-1.amazonaws.com]:25 SMTP \u30e6\u30fc\u30b6\u30fc\u540d:SMTP \u30d1\u30b9\u30ef\u30fc\u30c9\n# hashmap \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n[root@ip-172-31-20-41 ~]# postmap hash:/etc/postfix/sasl_passwd\n[root@ip-172-31-20-41 ~]# rm -f /etc/postfix/sasl_passwd\n[root@ip-172-31-20-41 ~]# chmod 600 /etc/postfix/sasl_passwd.db\n# Postfix \u304c\u6b63\u3057\u304fSSL\u8a3c\u660e\u66f8\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u5909\u66f4\uff08Amazon Linux\u3058\u3083\u306a\u3044\u5834\u5408\u306fCAfile\u306e\u5834\u6240\u304c\u9055\u3046\u304b\u3082\uff09\n[root@ip-172-31-20-41 ~]# postconf -e 'smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt'\n# Postfix \u518d\u8d77\u52d5\n[root@ip-172-31-20-41 ~]# service postfix restart\n# \u30c6\u30b9\u30c8\u9001\u4fe1\n[root@ip-172-31-20-41 ~]# echo \"mail-body\" | mail -r from@hoge.com -s \"mail-subject\" to@hoge.com\n# \u9001\u4fe1\u6210\u529f\u6642\u306emaillog\n[root@ip-172-31-20-41 ~]# less /var/log/maillog\n     Aug 12 01:36:00 ip-172-31-20-41 postfix/smtp[15323]: C6FE9A2C64: to=<to@hoge.com>, relay=email-smtp.us-east-1.amazonaws.com[107.21.234.214]:25, delay=2.4, delays=0.08/0.11/1.4/0.82, dsn=2.0.0, status=sent (250 Ok 0000014f1f8cb78a-9bcb7fca-4e28-4eb3-84a0-9b784732fab9-000000)\n\n\n\n\u307e\u3068\u3081\nmail\u30b3\u30de\u30f3\u30c9\u3001\u3082\u3057\u304f\u306f mb_send_mail \u3068\u304b\u3067\u30e1\u30fc\u30eb\u3092\u9001\u308a\u305f\u3044\u3068\u304d\u306a\u3069\u610f\u5916\u3068\u4fbf\u5229\u3067\u3059\u3088\u3002  \n# Postfix\u304b\u3089\u306e\u9001\u4fe1\u3092\u5168\u3066SES\u7d4c\u7531\u306b\u5909\u66f4\u3059\u308b\n\n## \u306f\u3058\u3081\u306b\n\n### \u25bc\u30e1\u30ea\u30c3\u30c8\n\n- EC2\u304b\u3089\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u304d\u3001AWS\u306e\u9001\u4fe1\u5236\u9650\uff08\u30dd\u30fc\u30c8\u30c1\u30a7\u30c3\u30af\uff09\u3092\u6c17\u306b\u305b\u305a\u306b\u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u304c\u51fa\u6765\u307e\u3059\u3002\n- `mb_send_mail`\u306a\u3069\u306e\u95a2\u6570\u3092\u4f7f\u7528\u3057\u305f\u30e1\u30fc\u30eb\u9001\u4fe1\u90e8\u5206\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u30e1\u30fc\u30eb\u306e\u9001\u4fe1\u304c\u53ef\u80fd\u3067\u3059\u3002\n- \u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306a\u3069\u3067\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\u3068\u304d\u3001\u9001\u4fe1\u5236\u9650\u3092\u6c17\u306b\u3057\u306a\u304f\u3066\u3044\u3044\u306e\u3067\u697d\u3067\u3059\u3002\n\n### \u25bc\u30c7\u30e1\u30ea\u30c3\u30c8\n\n- \u304a\u91d1\u304c\u304b\u304b\u308a\u307e\u3059\u3002\uff08\u3059\u3054\u3044\u5b89\u3044\u3051\u3069\uff09\n\n## \u69cb\u7bc9\n\n### \u25bcAWS\u3067\u306e\u6e96\u5099\n\n#### Amazon SES SMTP \u8a8d\u8a3c\u60c5\u5831\u3092\u53d6\u5f97\n\nSES \uff1e SMTP Settings \u304b\u3089 `[Create My SMTP Credentials]` \u3092\u30af\u30ea\u30c3\u30af\u3002\n\n![0-167d32a5-026a-ff8c-f49b-c78f5785399a.png](https://qiita-image-store.s3.amazonaws.com/0/18487/f0c90496-bd40-0540-45e0-2a6d70e8f4d1.png)\n\n\nIAM\u30e6\u30fc\u30b6\u30fc\u540d\u3092\u6c7a\u3081\u3066\u4f5c\u6210\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u3002\n\n![1-a8d9004a-7e1e-2852-6630-56f36c68809b.png](https://qiita-image-store.s3.amazonaws.com/0/18487/6bdc288b-d959-332a-9fe8-40cce55e35c6.png)\n\n`[\u30e6\u30fc\u30b6\u30fc\u306e SMTP \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a8d\u8a3c\u60c5\u5831\u3092\u8868\u793a]`\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068\n\n- `SMTP \u30e6\u30fc\u30b6\u30fc\u540d`\n- `SMTP \u30d1\u30b9\u30ef\u30fc\u30c9`\n\n\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\n![2-9b07f0e7-1370-5c03-635d-431d98393a27.png](https://qiita-image-store.s3.amazonaws.com/0/18487/ac20a141-c193-53ec-7b79-85c26136e0ce.png)\n\n#### \u9001\u4fe1\u5143\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u8a8d\u8a3c\u3059\u308b\n\n\u300cE\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u8a8d\u8a3c\u300d\u304b\u300c\u30c9\u30e1\u30a4\u30f3\u8a8d\u8a3c\u300d\u3092\u3057\u3066\u3001SES\u304b\u3089\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u4e0b\u3055\u3044\u3002\n\n### \u25bc\u30b5\u30fc\u30d0\u5074\u306e\u8a2d\u5b9a\n\n```\n# Postfix\u5468\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[root@ip-172-31-20-41 ~]# yum install postfix mailx cyrus-sasl-plain cyrus-sasl-md5\n# Sendmail \u505c\u6b62\n[root@ip-172-31-20-41 ~]# service sendmail stop\n[root@ip-172-31-20-41 ~]# chkconfig sendmail off\n# mta \u3092 Postfix \u306b\u5909\u66f4\n[root@ip-172-31-20-41 ~]# alternatives --config mta\n     There is 1 program that provides 'mta'.\n\n       Selection    Command\n     -----------------------------------------------\n     *+ 1           /usr/sbin/sendmail.sendmail\n     + 2           /usr/sbin/sendmail.postfix\n     Enter to keep the current selection[+], or type selection number: 2\n[root@ip-172-31-20-41 ~]# alternatives --display mta\n\tmta - status is manual.\n\t link currently points to /usr/sbin/sendmail.postfix\n\t/usr/sbin/sendmail.postfix - priority 30\n\t slave mta-pam: /etc/pam.d/smtp.postfix\n\t slave mta-mailq: /usr/bin/mailq.postfix\n\t slave mta-newaliases: /usr/bin/newaliases.postfix\n\t slave mta-rmail: /usr/bin/rmail.postfix\n\t slave mta-sendmail: /usr/lib/sendmail.postfix\n\t slave mta-mailqman: /usr/share/man/man1/mailq.postfix.1.gz\n\t slave mta-newaliasesman: /usr/share/man/man1/newaliases.postfix.1.gz\n\t slave mta-aliasesman: /usr/share/man/man5/aliases.postfix.5.gz\n\t slave mta-sendmailman: /usr/share/man/man1/sendmail.postfix.1.gz\n\tCurrent `best' version is /usr/sbin/sendmail.postfix.\n# Sendmail \u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u4e00\u7dd2\u306b\u5fc5\u8981\u306a\u306e\u3092\u30a2\u30f3\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305d\u3046\u3060\u3063\u305f\u3089\u30b3\u30ec\u306f\u98db\u3070\u3059\uff09\n[root@ip-172-31-20-41 ~]# yum remove sendmail\n# Postfix \u8a2d\u5b9a\n[root@ip-172-31-20-41 ~]# cp /etc/postfix/main.cf /etc/postfix/main.cf.bak20150812\n# \u203bemail-smtp.us-east-1.amazonaws.com \u306e\u90e8\u5206\u306f\u4f7f\u7528\u3057\u3066\u3044\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u5909\u308f\u308a\u307e\u3059\u3002\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/main.cf\n     relayhost = [email-smtp.us-east-1.amazonaws.com]:25\n     smtp_sasl_auth_enable = yes\n     smtp_sasl_security_options = noanonymous\n     smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd\n     smtp_use_tls = yes\n     smtp_tls_security_level = encrypt\n     smtp_tls_note_starttls_offer = yes\n[root@ip-172-31-20-41 ~]# diff /etc/postfix/main.cf /etc/postfix/main.cf.bak20150812\n     684,692d683\n     <\n     < relayhost = [email-smtp.us-east-1.amazonaws.com]:25\n     < smtp_sasl_auth_enable = yes\n     < smtp_sasl_security_options = noanonymous\n     < smtp_sasl_password_maps = hash:/etc/postfix/sasl_passwd\n     < smtp_use_tls = yes\n     < smtp_tls_security_level = encrypt\n     < smtp_tls_note_starttls_offer = yes\n     <\n[root@ip-172-31-20-41 ~]# cp /etc/postfix/master.cf /etc/postfix/master.cf.bak20150812\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/master.cf\n     #       -o smtp_fallback_relay=\n[root@ip-172-31-20-41 ~]# diff /etc/postfix/master.cf /etc/postfix/master.cf.bak20150812\n     39c39\n     < #     -o smtp_fallback_relay=\n     ---\n     >       -o smtp_fallback_relay=\n[root@ip-172-31-20-41 ~]# touch /etc/postfix/sasl_passwd\n# \u203b\u5148\u7a0b\u4f5c\u6210\u3057\u305fSMTP \u30e6\u30fc\u30b6\u30fc\u540d,SMTP \u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u8a2d\u5b9a\u3057\u307e\u3059\n[root@ip-172-31-20-41 ~]# vim /etc/postfix/sasl_passwd\n     [email-smtp.us-east-1.amazonaws.com]:25 SMTP \u30e6\u30fc\u30b6\u30fc\u540d:SMTP \u30d1\u30b9\u30ef\u30fc\u30c9\n# hashmap \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n[root@ip-172-31-20-41 ~]# postmap hash:/etc/postfix/sasl_passwd\n[root@ip-172-31-20-41 ~]# rm -f /etc/postfix/sasl_passwd\n[root@ip-172-31-20-41 ~]# chmod 600 /etc/postfix/sasl_passwd.db\n# Postfix \u304c\u6b63\u3057\u304fSSL\u8a3c\u660e\u66f8\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u5909\u66f4\uff08Amazon Linux\u3058\u3083\u306a\u3044\u5834\u5408\u306fCAfile\u306e\u5834\u6240\u304c\u9055\u3046\u304b\u3082\uff09\n[root@ip-172-31-20-41 ~]# postconf -e 'smtp_tls_CAfile = /etc/ssl/certs/ca-bundle.crt'\n# Postfix \u518d\u8d77\u52d5\n[root@ip-172-31-20-41 ~]# service postfix restart\n# \u30c6\u30b9\u30c8\u9001\u4fe1\n[root@ip-172-31-20-41 ~]# echo \"mail-body\" | mail -r from@hoge.com -s \"mail-subject\" to@hoge.com\n# \u9001\u4fe1\u6210\u529f\u6642\u306emaillog\n[root@ip-172-31-20-41 ~]# less /var/log/maillog\n     Aug 12 01:36:00 ip-172-31-20-41 postfix/smtp[15323]: C6FE9A2C64: to=<to@hoge.com>, relay=email-smtp.us-east-1.amazonaws.com[107.21.234.214]:25, delay=2.4, delays=0.08/0.11/1.4/0.82, dsn=2.0.0, status=sent (250 Ok 0000014f1f8cb78a-9bcb7fca-4e28-4eb3-84a0-9b784732fab9-000000)\n\n```\n\n## \u307e\u3068\u3081\n\nmail\u30b3\u30de\u30f3\u30c9\u3001\u3082\u3057\u304f\u306f mb_send_mail \u3068\u304b\u3067\u30e1\u30fc\u30eb\u3092\u9001\u308a\u305f\u3044\u3068\u304d\u306a\u3069\u610f\u5916\u3068\u4fbf\u5229\u3067\u3059\u3088\u3002  \n\n"}