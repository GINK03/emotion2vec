{"tags": ["laravel4.1", "PHP", "PHPUnit"], "context": " More than 1 year has passed since last update.\u81ea\u5206\u304cLaravel 4\u3067\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3059\u308b\u3068\u304d\u306eTestCase\u30af\u30e9\u30b9\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\napp/tests/TestCase.php\nnamespace App\\Tests;\n\nuse Artisan;\nuse DB;\nuse Mockery as m;\n\nclass TestCase extends \\Illuminate\\Foundation\\Testing\\TestCase\n{\n    /**\n     * \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5229\u7528\u30d5\u30e9\u30b0\n     */\n    protected $useDatabase = true;\n\n    /**\n     * Creates the application.\n     *\n     * @return Symfony\\Component\\HttpKernel\\HttpKernelInterface\n     */\n    public function createApplication()\n    {\n        $unitTesting = true;\n\n        $testEnvironment = 'testing';\n\n        return require __DIR__.'/../../bootstrap/start.php';\n    }\n\n    public function setUp()\n    {\n        parent::setUp();\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u521d\u671f\u51e6\u7406\n        if ($this->useDatabase) {\n            $this->setUpDb();\n        }\n    }\n\n    public function tearDown()\n    {\n        parent::tearDown();\n\n        // Mockery\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\n        m::close();\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u7d42\u671f\u51e6\u7406\n        if ($this->useDatabase) {\n            $this->tearDownDb();\n        }\n    }\n\n    protected function setUpDb()\n    {\n        // \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u767b\u9332\n        Artisan::call('migrate');\n        Artisan::call('db:seed');\n    }\n\n    protected function tearDownDb()\n    {\n        // \u30c6\u30fc\u30d6\u30eb\u524a\u9664\n        Artisan::call('migrate:reset');\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u5207\u65ad\n        DB::disconnect();\n    }\n}\n\n\n\n\u8aac\u660e\n\n\n\u3053\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306bMockery\u3092\u7d71\u5408\u3002\n\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306b\u3082\u540d\u524d\u7a7a\u9593\u3092\u5207\u308b\u3002\n\nsetUp()\u3067\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\u3002\n\ntearDown()\u3067\u5168\u90e8\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u524a\u9664\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u5207\u65ad\u3059\u308b\u3002DB::disconnect()\u3057\u306a\u3044\u3068\u300cToo many connections\u300d\u30a8\u30e9\u30fc\u3067\u6012\u3089\u308c\u308b\uff08MySQL + Eloquent\u306e\u5834\u5408\u3002\u4ed6\u306f\u4e0d\u660e\uff09\u3002\n\u30c6\u30b9\u30c8\u6642\u9593\u3092\u5c11\u3057\u3067\u3082\u77ed\u7e2e\u3057\u305f\u3044\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f7f\u308f\u306a\u3044\u30c6\u30b9\u30c8\u3067\u306f$useDatabase\u3092false\u306b\u3057\u3066\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30fc\u30c9\u306e\u5b9f\u884c\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u3002\n\n\u81ea\u5206\u304cLaravel 4\u3067\u30e6\u30cb\u30c3\u30c8\u30c6\u30b9\u30c8\u3059\u308b\u3068\u304d\u306eTestCase\u30af\u30e9\u30b9\u3002\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n```php:app/tests/TestCase.php\nnamespace App\\Tests;\n\nuse Artisan;\nuse DB;\nuse Mockery as m;\n\nclass TestCase extends \\Illuminate\\Foundation\\Testing\\TestCase\n{\n    /**\n     * \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u5229\u7528\u30d5\u30e9\u30b0\n     */\n    protected $useDatabase = true;\n\n    /**\n     * Creates the application.\n     *\n     * @return Symfony\\Component\\HttpKernel\\HttpKernelInterface\n     */\n    public function createApplication()\n    {\n        $unitTesting = true;\n\n        $testEnvironment = 'testing';\n\n        return require __DIR__.'/../../bootstrap/start.php';\n    }\n\n    public function setUp()\n    {\n        parent::setUp();\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u521d\u671f\u51e6\u7406\n        if ($this->useDatabase) {\n            $this->setUpDb();\n        }\n    }\n\n    public function tearDown()\n    {\n        parent::tearDown();\n\n        // Mockery\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\n        m::close();\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u7d42\u671f\u51e6\u7406\n        if ($this->useDatabase) {\n            $this->tearDownDb();\n        }\n    }\n\n    protected function setUpDb()\n    {\n        // \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u767b\u9332\n        Artisan::call('migrate');\n        Artisan::call('db:seed');\n    }\n\n    protected function tearDownDb()\n    {\n        // \u30c6\u30fc\u30d6\u30eb\u524a\u9664\n        Artisan::call('migrate:reset');\n\n        // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u5207\u65ad\n        DB::disconnect();\n    }\n}\n```\n\n## \u8aac\u660e\n\n+ [\u3053\u306e\u30b5\u30a4\u30c8](http://kore1server.com/202/Mockery+0.8.0+%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%89%E3%82%AD%E3%83%A5%E3%83%A1%E3%83%B3%E3%83%88)\u3092\u53c2\u8003\u306bMockery\u3092\u7d71\u5408\u3002\n+ \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u306b\u3082\u540d\u524d\u7a7a\u9593\u3092\u5207\u308b\u3002\n+ `setUp()`\u3067\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u6295\u5165\u3059\u308b\u3002\n+ `tearDown()`\u3067\u5168\u90e8\u306e\u30c6\u30fc\u30d6\u30eb\u3092\u524a\u9664\u3057\u3066\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u5207\u65ad\u3059\u308b\u3002`DB::disconnect()`\u3057\u306a\u3044\u3068\u300cToo many connections\u300d\u30a8\u30e9\u30fc\u3067\u6012\u3089\u308c\u308b\uff08MySQL + Eloquent\u306e\u5834\u5408\u3002\u4ed6\u306f\u4e0d\u660e\uff09\u3002\n+ \u30c6\u30b9\u30c8\u6642\u9593\u3092\u5c11\u3057\u3067\u3082\u77ed\u7e2e\u3057\u305f\u3044\u306e\u3067\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u4f7f\u308f\u306a\u3044\u30c6\u30b9\u30c8\u3067\u306f`$useDatabase`\u3092`false`\u306b\u3057\u3066\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u30b7\u30fc\u30c9\u306e\u5b9f\u884c\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u3002\n\n"}