{"context": " More than 1 year has passed since last update.subnet.main\u3068\u304baws_security_group\u306a\u3069\u306a\u3069\u306f\u5225\u9014\u8a2d\u5b9a\u6e08\u307f\u3068\u3057\u3066\u3002\n#--------------------------------------------------------------\n# Ec2 Instances\n#--------------------------------------------------------------\nresource \"aws_instance\" \"elasticsearch\" {\n  instance_type = \"${var.elasticsearch_instance_type}\"\n  ami = \"${var.default_ami}\"\n  subnet_id = \"${element(aws_subnet.main.*.id, count.index%length(aws_subnet.main.*.id))}\"\n  vpc_security_group_ids = [ \"${aws_security_group.output_all.id}\", \"${aws_security_group.elasticsearch.id}\" ]\n  key_name = \"${aws_key_pair.developer.id}\"\n  iam_instance_profile = \"${aws_iam_instance_profile.elasticsearch.id}\"\n  tags {\n    Name = \"${format(\"%s-elasticsearch%02d\", var.environment, count.index+1)}\"\n    role = \"elasticsearch\"\n    environment = \"${var.environment}\"\n  }\n\n  count = \"${var.elasticsearch_server_count}\"\n}\n\n#--------------------------------------------------------------\n# EBS\n#--------------------------------------------------------------\nresource \"aws_ebs_volume\" \"elasticsearch-data\" {\n  availability_zone = \"${element(aws_subnet.main.*.availability_zone, count.index)}\"\n  size = \"${var.elasticsearch_volume_size}\"\n  type = \"gp2\"\n  tags {\n    Name = \"${format(\"elasticsearch%02d-data\", count.index+1)}\"\n    environment = \"${var.environment}\"\n  }\n  count = \"${var.elasticsearch_ebs_count}\"\n}\n\n#--------------------------------------------------------------\n# EBS attachment\n#--------------------------------------------------------------\nresource \"aws_volume_attachment\" \"attach_elasticsearch-data\" {\n  device_name = \"/dev/sdb\"\n  volume_id = \"${element(aws_ebs_volume.elasticsearch-data.*.id, count.index)}\"\n  instance_id = \"${element(aws_instance.elasticsearch.*.id, count.index)}\"\n  count = \"${var.elasticsearch_server_count}\"\n}\n\n\u3053\u308c\u3067elasticsearch_server_count\u3060\u3051\u30b5\u30fc\u30d0\u304c\u7acb\u3061\u4e0a\u304c\u3063\u305f\u4e0a\u3067EBS\u304cattach\u3055\u308c\u307e\u3059\u3002\n\u3055\u3089\u306b\nterraform destory -target 'aws_instance.elasticsearch'\n\n\u3068\u3057\u305f\u5834\u5408\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3060\u3051\u6d88\u3048\u3066EBS\u306f\u6b8b\u308b\u306e\u3067\u3001\u6b21\u56de\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u305f\u3068\u304d\u306b\u306f\u540c\u3058EBS\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002\n\u554f\u984c\u306fterraform destory\u3057\u305f\u3068\u304d\u306bEBS\u304c\u30de\u30a6\u30f3\u30c8\u6e08\u307f\u3060\u3068\u5f53\u7136\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u843d\u3068\u3059\u3068\u304d\u306fumount\u3092\u3059\u308b\u4f55\u304b\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u3044\u307e\u306e\u3068\u3053\u308d\u4f5c\u6210\u6642\u306b\u306e\u307fprovisioner\u304c\u5b9f\u884c\u3055\u308c\u308b\u3060\u3051\u306a\u306e\u3067terraform\u3067\u306f\u5b8c\u7d50\u3057\u307e\u305b\u3093\u3002\n`subnet.main`\u3068\u304b`aws_security_group`\u306a\u3069\u306a\u3069\u306f\u5225\u9014\u8a2d\u5b9a\u6e08\u307f\u3068\u3057\u3066\u3002\n\n```\n#--------------------------------------------------------------\n# Ec2 Instances\n#--------------------------------------------------------------\nresource \"aws_instance\" \"elasticsearch\" {\n  instance_type = \"${var.elasticsearch_instance_type}\"\n  ami = \"${var.default_ami}\"\n  subnet_id = \"${element(aws_subnet.main.*.id, count.index%length(aws_subnet.main.*.id))}\"\n  vpc_security_group_ids = [ \"${aws_security_group.output_all.id}\", \"${aws_security_group.elasticsearch.id}\" ]\n  key_name = \"${aws_key_pair.developer.id}\"\n  iam_instance_profile = \"${aws_iam_instance_profile.elasticsearch.id}\"\n  tags {\n    Name = \"${format(\"%s-elasticsearch%02d\", var.environment, count.index+1)}\"\n    role = \"elasticsearch\"\n    environment = \"${var.environment}\"\n  }\n\n  count = \"${var.elasticsearch_server_count}\"\n}\n\n#--------------------------------------------------------------\n# EBS\n#--------------------------------------------------------------\nresource \"aws_ebs_volume\" \"elasticsearch-data\" {\n  availability_zone = \"${element(aws_subnet.main.*.availability_zone, count.index)}\"\n  size = \"${var.elasticsearch_volume_size}\"\n  type = \"gp2\"\n  tags {\n    Name = \"${format(\"elasticsearch%02d-data\", count.index+1)}\"\n    environment = \"${var.environment}\"\n  }\n  count = \"${var.elasticsearch_ebs_count}\"\n}\n\n#--------------------------------------------------------------\n# EBS attachment\n#--------------------------------------------------------------\nresource \"aws_volume_attachment\" \"attach_elasticsearch-data\" {\n  device_name = \"/dev/sdb\"\n  volume_id = \"${element(aws_ebs_volume.elasticsearch-data.*.id, count.index)}\"\n  instance_id = \"${element(aws_instance.elasticsearch.*.id, count.index)}\"\n  count = \"${var.elasticsearch_server_count}\"\n}\n```\n\n\u3053\u308c\u3067elasticsearch_server_count\u3060\u3051\u30b5\u30fc\u30d0\u304c\u7acb\u3061\u4e0a\u304c\u3063\u305f\u4e0a\u3067EBS\u304cattach\u3055\u308c\u307e\u3059\u3002\n\n\u3055\u3089\u306b\n\n```\nterraform destory -target 'aws_instance.elasticsearch'\n```\n\u3068\u3057\u305f\u5834\u5408\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3060\u3051\u6d88\u3048\u3066EBS\u306f\u6b8b\u308b\u306e\u3067\u3001\u6b21\u56de\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u7acb\u3061\u4e0a\u3052\u305f\u3068\u304d\u306b\u306f\u540c\u3058EBS\u304c\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002\n\n\u554f\u984c\u306f`terraform destory`\u3057\u305f\u3068\u304d\u306bEBS\u304c\u30de\u30a6\u30f3\u30c8\u6e08\u307f\u3060\u3068\u5f53\u7136\u30a8\u30e9\u30fc\u306b\u306a\u308b\u306e\u3067\u843d\u3068\u3059\u3068\u304d\u306fumount\u3092\u3059\u308b\u4f55\u304b\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\u3044\u307e\u306e\u3068\u3053\u308d\u4f5c\u6210\u6642\u306b\u306e\u307fprovisioner\u304c\u5b9f\u884c\u3055\u308c\u308b\u3060\u3051\u306a\u306e\u3067terraform\u3067\u306f\u5b8c\u7d50\u3057\u307e\u305b\u3093\u3002\n", "tags": ["Terraform0.6.1"]}