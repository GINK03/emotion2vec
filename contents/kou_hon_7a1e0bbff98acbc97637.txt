{"tags": ["Android", "Volley", "jsessionid", "awselb"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nStickySession\u3092\u8a2d\u5b9a\u3057\u305fAWS\u30b5\u30fc\u30d0\u3068Android\u30a2\u30d7\u30ea\u3068\u306e\u901a\u4fe1\u6642\u306bAndroid\u30a2\u30d7\u30ea\u5074\u304b\u3089JavaWeb\u30b5\u30fc\u30d0\u306eCookie\u300cJSESSIONID\u300d\u3068AWS\u306eELB\u306eCookie\u300cAWSELB\u300d\u306e\u5185\u5bb9\u3092\u540c\u6642\u306b\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\n\n\u8a73\u7d30\n\n\u30b5\u30fc\u30d0\u5074\n\u30b5\u30fc\u30d0\u5074\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u306e\u3068\u3053\u308d\u3092\u53c2\u7167\nJava/Servlet\u3068JSESSIONID\u306eURL\u7ba1\u7406\n\u30b9\u30c6\u30a3\u30c3\u30ad\u30fc\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\nAndroid\u30a2\u30d7\u30ea\u5074\n\nVolley\nAndroid\u30a2\u30d7\u30ea\u3067\u975e\u540c\u671f\u901a\u4fe1\u3092\u7c21\u5358\u306b\u5b9f\u73fe\u3059\u308b\u3053\u3068\u306e\u51fa\u6765\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u30e9\u30a4\u30d6\u30e9\u30ea\u3002\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30e9\u30a4\u30d6\u30e9\u30eaVolley\u3092\u4f7f\u3044\u3053\u306a\u3059\n\n\u53d6\u5f97\u65b9\u6cd5\n\nVolleyHttpRequest.java\npublic class VolleyHttpRequest\n{\n    private RequestQueue mQueue;\n\n    public void request(Context context)\n    {\n        // Cookie\u306e\u8a2d\u5b9a\n        DefaultHttpClient client = new DefaultHttpClient();\n        BasicClientCookie cookie = new BasicClientCookie(cookieName, cookieValue);\n        cookie.setDomain(\"domain\");\n        cookie.setPath(\"/\");\n        cookie.setSecure(true);\n        client.getCookieStore().addCookie(cookie);\n        HttpStack httpStack = new HttpClientStack(client);\n\n        // \u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n        mQueue = Volley.newRequestQueue(context, httpStack);\n\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u30af\u30e9\u30b9\u306e\u7528\u610f\n        VolleyRequest volleyRequest = new VolleyRequest(Method.POST,\n                                                        \"\u30ea\u30af\u30a8\u30b9\u30c8URL\",\n                                                        \"\u901a\u4fe1\u30a8\u30e9\u30fc\u6642\u306e\u30ea\u30b9\u30ca\u30af\u30e9\u30b9\",\n                                                        client);\n\n        // \u30ad\u30e5\u30fc\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8ffd\u52a0\n        mQueue.add(volleyRequest);\n    }\n}\n\n\n\nVolleyRequest.java\npublic abstract class VolleyRequest extends Request<JSONObject>\n{\n    private DefaultHttpClient mClient;\n\n    public VolleyRequest(int method,\n                         String url,\n             ErrorListener errorListener,\n             DefaultHttpClient client)\n    {\n        super(method, url, errorListener);\n        mClient = client;\n    }\n\n    @Override\n    protected Response<JSONObject> parseNetworkResponse(NetworkResponse response)\n    {\n        for(Cookie cookie : mClient.getCookieStore().getCookies())\n        {\n            if(cookie.getName().equals(\"JSESSIONID\"))\n            {\n                // \"JSESSIONID\"\u53d6\u5f97\n            }\n            if(cookie.getName().equals(\"AWSELB\"))\n            {\n                // \"AWSELB\"\u53d6\u5f97\n            }\n        }\n    }\n}\n\n\n\n\u3042\u3068\u304c\u304d\n\u672c\u6765\uff08\uff1f\uff09\u306a\u3089parseNetworkResponse\u3067\u6e21\u3063\u3066\u304f\u308bNetworkResponse.headers\u306e\u4e2d\u306bCookie\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u5b9f\u969b\u306e\u3068\u3053\u308d\u306fJSESSIONID\u3057\u304b\u53d6\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3082\u3057\u304b\u3057\u305f\u3089AWS\u306e\u8a2d\u5b9a\u304c\u60aa\u3044\u306e\u304b\u3082\u3002\u3002\u3002\u306a\u3093\u3068\u3082\u8a00\u3048\u307e\u305b\u3093\u304c\u3002\u3002\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3067\u4e21\u65b9\u306eCookie\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n# \u6982\u8981\nStickySession\u3092\u8a2d\u5b9a\u3057\u305fAWS\u30b5\u30fc\u30d0\u3068Android\u30a2\u30d7\u30ea\u3068\u306e\u901a\u4fe1\u6642\u306bAndroid\u30a2\u30d7\u30ea\u5074\u304b\u3089JavaWeb\u30b5\u30fc\u30d0\u306eCookie\u300cJSESSIONID\u300d\u3068AWS\u306eELB\u306eCookie\u300cAWSELB\u300d\u306e\u5185\u5bb9\u3092\u540c\u6642\u306b\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\n# \u8a73\u7d30\n## \u30b5\u30fc\u30d0\u5074\n\u30b5\u30fc\u30d0\u5074\u306b\u3064\u3044\u3066\u306f\u4ee5\u4e0b\u306e\u3068\u3053\u308d\u3092\u53c2\u7167\n[Java/Servlet\u3068JSESSIONID\u306eURL\u7ba1\u7406](http://www.glamenv-septzen.net/view/1093)\n[\u30b9\u30c6\u30a3\u30c3\u30ad\u30fc\u30bb\u30c3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210](http://docs.aws.amazon.com/ja_jp/ElasticLoadBalancing/latest/DeveloperGuide/US_StickySessions.html)\n## Android\u30a2\u30d7\u30ea\u5074\n###Volley\nAndroid\u30a2\u30d7\u30ea\u3067\u975e\u540c\u671f\u901a\u4fe1\u3092\u7c21\u5358\u306b\u5b9f\u73fe\u3059\u308b\u3053\u3068\u306e\u51fa\u6765\u308b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u30e9\u30a4\u30d6\u30e9\u30ea\u3002\n[\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u901a\u4fe1\u7528\u30e9\u30a4\u30d6\u30e9\u30eaVolley\u3092\u4f7f\u3044\u3053\u306a\u3059](http://techbooster.org/android/hacks/16474/)\n###\u53d6\u5f97\u65b9\u6cd5\n```lang:VolleyHttpRequest.java\npublic class VolleyHttpRequest\n{\n    private RequestQueue mQueue;\n\n    public void request(Context context)\n    {\n        // Cookie\u306e\u8a2d\u5b9a\n        DefaultHttpClient client = new DefaultHttpClient();\n        BasicClientCookie cookie = new BasicClientCookie(cookieName, cookieValue);\n        cookie.setDomain(\"domain\");\n        cookie.setPath(\"/\");\n        cookie.setSecure(true);\n        client.getCookieStore().addCookie(cookie);\n        HttpStack httpStack = new HttpClientStack(client);\n\n        // \u30ad\u30e5\u30fc\u306e\u4f5c\u6210\n        mQueue = Volley.newRequestQueue(context, httpStack);\n        \n        // \u30ea\u30af\u30a8\u30b9\u30c8\u30af\u30e9\u30b9\u306e\u7528\u610f\n        VolleyRequest volleyRequest = new VolleyRequest(Method.POST,\n                                                        \"\u30ea\u30af\u30a8\u30b9\u30c8URL\",\n                                                        \"\u901a\u4fe1\u30a8\u30e9\u30fc\u6642\u306e\u30ea\u30b9\u30ca\u30af\u30e9\u30b9\",\n                                                        client);\n\n        // \u30ad\u30e5\u30fc\u306b\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u8ffd\u52a0\n        mQueue.add(volleyRequest);\n    }\n}\n```\n```lang:VolleyRequest.java\npublic abstract class VolleyRequest extends Request<JSONObject>\n{\n    private DefaultHttpClient mClient;\n\n    public VolleyRequest(int method,\n                         String url,\n\t\t\t ErrorListener errorListener,\n\t\t\t DefaultHttpClient client)\n    {\n        super(method, url, errorListener);\n        mClient = client;\n    }\n\n    @Override\n    protected Response<JSONObject> parseNetworkResponse(NetworkResponse response)\n    {\n        for(Cookie cookie : mClient.getCookieStore().getCookies())\n    \t{\n            if(cookie.getName().equals(\"JSESSIONID\"))\n            {\n                // \"JSESSIONID\"\u53d6\u5f97\n            }\n            if(cookie.getName().equals(\"AWSELB\"))\n            {\n                // \"AWSELB\"\u53d6\u5f97\n            }\n        }\n    }\n}\n```\n\n# \u3042\u3068\u304c\u304d\n\n\u672c\u6765\uff08\uff1f\uff09\u306a\u3089parseNetworkResponse\u3067\u6e21\u3063\u3066\u304f\u308bNetworkResponse.headers\u306e\u4e2d\u306bCookie\u60c5\u5831\u304c\u5165\u3063\u3066\u3044\u308b\u306f\u305a\u306a\u306e\u3067\u3059\u304c\u5b9f\u969b\u306e\u3068\u3053\u308d\u306fJSESSIONID\u3057\u304b\u53d6\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3082\u3057\u304b\u3057\u305f\u3089AWS\u306e\u8a2d\u5b9a\u304c\u60aa\u3044\u306e\u304b\u3082\u3002\u3002\u3002\u306a\u3093\u3068\u3082\u8a00\u3048\u307e\u305b\u3093\u304c\u3002\u3002\u3002\n\u3068\u308a\u3042\u3048\u305a\u3001\u4e0a\u8a18\u306e\u65b9\u6cd5\u3067\u4e21\u65b9\u306eCookie\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n"}