{"context": " More than 1 year has passed since last update.Consul ACL (Consul 0.4.X)\u306e\u4f7f\u3044\u65b9\u3002\n\u8a73\u7d30\u307e\u3067\u6b63\u3057\u3044\u304b\u306f\u4e0d\u660e\u3060\u304c\u3001\u89e3\u3063\u305f\u3053\u3068\u304b\u3089\u66f8\u3044\u3066\u3044\u304f\u3002\n\n\u6982\u8981\n\n\u30c8\u30fc\u30af\u30f3\u5358\u4f4d\u3067\u5024\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3092\u5236\u9650\u3059\u308b\u6a5f\u80fd\u3002\n\u5404\u30c8\u30fc\u30af\u30f3\u306fID\u3001\u540d\u524d\u3001\u3069\u3053\u306e\u5024\u306b\u3069\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u304b\u306e\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u3092\u6301\u3064\u3002\n\u5024\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6642\u306b\u30c8\u30fc\u30af\u30f3ID\u3092\u6307\u5b9a\u3057\uff08\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u30c8\u30fc\u30af\u30f3\uff09\u3001\u8a8d\u53ef\u3092\u884c\u3046\u3002\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3053\u3061\u3089\u3002\n\n\u5bfe\u8c61API\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3001\n\nAs of Consul 0.4, it is only possible to specify policies for the KV store.\n\n\u3068\u3042\u308b\u3068\u304a\u308a\u30010.4\u6642\u70b9\u3067\u306fKVS\u3060\u3051\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3067\u304d\u308b\u3002\n\u203bACL\u306eAPI\u306b\u306fmaster token\u3067\u306a\u3044\u3068\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u3002\n\nConfig\u3067\u66f8\u3051\u308b\u3053\u3068\nACL\u306fHTTP API\u3067\u767b\u9332\u3059\u308b\u3002Config\u30d5\u30a1\u30a4\u30eb\u306b\u30eb\u30fc\u30eb\u3092\u66f8\u3044\u3066\u304a\u3044\u3066\u3001\u8d77\u52d5\u3057\u305f\u3089\u305d\u308c\u304c\u6709\u52b9\u306b\u306a\u308b\u3001\u3068\u3044\u3046\u4f7f\u3044\u65b9\u3067\u306f\u306a\u3044\u6a21\u69d8\u3002\n\nConfig\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\u5024\n\nacl_datacenter\n\n\u3053\u308c\u3067\u6307\u5b9a\u3057\u305fdatacenter\u304cACL\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3059\u308b\u5bfe\u8c61\u306b\u306a\u308b\u3002\u3053\u306e\u6307\u5b9a\u304c\u3042\u308b\u3068ACL\u304c\u6709\u52b9\u306b\u306a\u308b\u304c\u3001\u6307\u5b9a\u305b\u305a\u306bACL\u306eAPI\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test\nACL support disabled\n\n\nacl_default_policy\n\nallow\u304bdeny\u3092\u8a2d\u5b9a\u3059\u308b\u3002ACL\u306e\u6301\u3063\u3066\u3044\u308brule\u306b\u5bfe\u3057\u3066\u9069\u7528\u3055\u308c\u308b\u3082\u306e\u3067\u3001allow\u306e\u5834\u5408\u306fblacklist\u3001deny\u306e\u5834\u5408\u306fwhitelist\u65b9\u5f0f\u3067\u306e\u5236\u9650\u3092\u884c\u3046\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fallow\u3002\n\nacl_master_token\n\nType\u304cmanagement\u306e\u30c8\u30fc\u30af\u30f3\u3002\u3053\u308c\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u5168\u3066\u306e\u5024\u306bwrite\u30ec\u30d9\u30eb\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3001ACL\u306e\u64cd\u4f5c\u304c\u3067\u304d\u308b\u3002\n\u203b\u5bfe\u3057\u3066Type\u304cclient\u306e\u5834\u5408\u3001ACL\u306e\u64cd\u4f5c\u306f\u3067\u304d\u306a\u3044\u3002\n\nacl_token\n\nHTTP API\u3067\u5024\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u3001?token=\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3053\u306e\u30c8\u30fc\u30af\u30f3\u304c\u5229\u7528\u3055\u308c\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fanonymous\u3002\n\u203b\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a\u3059\u308c\u3070\u3001\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u5358\u4f4d\u3067\u4e0a\u66f8\u304d\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3002\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\n/etc/consul.d/default.json\n{\n  \"datacenter\": \"testdc\",\n  \"data_dir\": \"/var/lib/consul\",\n  \"server\": true,\n  \"bootstrap\": true,\n  \"acl_datacenter\": \"testdc\",\n  \"acl_default_policy\": \"deny\",\n  \"acl_master_token\": \"master_token_test\",\n  \"acl_token\": \"anonymous\"\n}\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5b58\u5728\u3059\u308bACL\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n$ curl http://localhost:8500/v1/acl/list\nPermission denied\n\n$ curl http://localhost:8500/v1/acl/list?token=anonymous\nPermission denied\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_error\nACL not found\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test | jq .\n[\n  {\n    \"Rules\": \"\",\n    \"Type\": \"client\",\n    \"Name\": \"Anonymous Token\",\n    \"ID\": \"anonymous\",\n    \"ModifyIndex\": 2,\n    \"CreateIndex\": 2\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"management\",\n    \"Name\": \"Master Token\",\n    \"ID\": \"master_token_test\",\n    \"ModifyIndex\": 3,\n    \"CreateIndex\": 3\n  }\n]\n\n\nACL\u306e\u767b\u9332\nACL\u306fHTTP API\u3067\u767b\u9332\u3059\u308b\u3002\nRules\u306f HashiCorp Configuration Language (HCL) \u3092\u6587\u5b57\u5217\u3067\u8a18\u8ff0\u3059\u308b\u3002 json\u3067\u66f8\u304f\u3068\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002 json\u3067\u66f8\u3044\u3066\u3082\u5927\u4e08\u592b\u3002\npolicy\u306b\u306fdeny\u3001read\u3001write\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u3001write\u306fread\u306e\u6a29\u9650\u3082\u5305\u542b\u3059\u308b(readwrite\u306f\u5b58\u5728\u305b\u305a\u3001\u66f8\u304d\u8fbc\u3081\u308b\u304c\u8aad\u307f\u8fbc\u3081\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u306f\u7121\u3044)\u3002\n\u4f8b\uff1a\n$ cat /tmp/acl.txt\n{\n  \"Name\": \"test_token\",\n  \"Type\": \"client\",\n  \"Rules\": \"\n    key \\\"testread/\\\" {\n      policy = \\\"read\\\"\n    }\n    key \\\"testwrite/\\\" {\n      policy = \\\"write\\\"\n    }\n  \"\n}\n\n$ curl -X PUT http://localhost:8500/v1/acl/create?token=master_token_test -d @/tmp/acl.txt\n{\"ID\":\"53b6df4c-7f77-c816-750d-b5eabf5ca582\"}\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test | jq .\n[\n  {\n    \"Rules\": \"    key \\\"testread/\\\" {      policy = \\\"read\\\"    }    key \\\"testwrite/\\\" {      policy = \\\"write\\\"    }  \",\n    \"Type\": \"client\",\n    \"Name\": \"test_token\",\n    \"ID\": \"53b6df4c-7f77-c816-750d-b5eabf5ca582\",\n    \"ModifyIndex\": 26,\n    \"CreateIndex\": 26\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"client\",\n    \"Name\": \"Anonymous Token\",\n    \"ID\": \"anonymous\",\n    \"ModifyIndex\": 2,\n    \"CreateIndex\": 2\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"management\",\n    \"Name\": \"Master Token\",\n    \"ID\": \"master_token_test\",\n    \"ModifyIndex\": 3,\n    \"CreateIndex\": 3\n  }\n]\n\ncreate\u3059\u308b\u3068\u3001\u4f5c\u6210\u3055\u308c\u305fACL\u306eID\u304c\u623b\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3046\u5f62\u306b\u306a\u308b\u3002\n\nACL\u3092\u4f7f\u3063\u3066\u30a2\u30af\u30bb\u30b9\n\nreadable\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\n\nreadable\u306b\u5bfe\u3057\u3066GET\u3092\u884c\u3044\u3001\u5024\u304c\u7121\u3044\u5834\u5408\n\n$ # no value\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=master_token_test\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:22 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:30 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:40 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:54 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n\nreadable\u306b\u5bfe\u3057\u3066PUT\u3092\u884c\u3046\u5834\u5408\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:41 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=anonymous -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:48 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582 -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:59 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=master_token_test -d 200\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 06:48:31 GMT\nContent-Length: 4\n\ntrue\n\n\nreadable\u306b\u5bfe\u3057\u3066GET\u3092\u884c\u3044\u3001\u5024\u304c\u3042\u308b\u5834\u5408\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=master_token_test\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:48:58 GMT\nContent-Length: 99\n\n[{\"CreateIndex\":48,\"ModifyIndex\":48,\"LockIndex\":0,\"Key\":\"testread/value\",\"Flags\":0,\"Value\":\"MjAw\"}]\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:26 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:34 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:42 GMT\nContent-Length: 99\n\n[{\"CreateIndex\":48,\"ModifyIndex\":48,\"LockIndex\":0,\"Key\":\"testread/value\",\"Flags\":0,\"Value\":\"MjAw\"}]\n\nmaster_token\u306f\u4f55\u3067\u3082\u3067\u304d\u308b\u3002\n\u307e\u305f\u3001read\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30c8\u30fc\u30af\u30f3\u3067GET\u3092\u884c\u3063\u305f\u5834\u5408\u3001403\u3067\u306f\u306a\u304f404\u306b\u306a\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\nwritable\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\nmaster_token\u306f\u4e0a\u3067\u3082\u4f3c\u305f\u3088\u3046\u306a\u5b9f\u9a13\u3092\u884c\u3063\u305f\u305f\u3081\u3001\u7701\u7565\u3002\n\nwritable\u306b\u5bfe\u3057\u3066\u66f8\u304d\u8fbc\u307f\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value -d 300\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 07:00:47 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value?token=anonymous -d 300\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 07:00:54 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582 -d 300\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 07:01:03 GMT\nContent-Length: 4\n\ntrue\n\n\nwritable\u306b\u5bfe\u3057\u3066\u8aad\u307f\u8fbc\u307f\n\n$ curl -i http://localhost:8500/v1/kv/testwrite/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:09 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testwrite/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:17 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testwrite/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:23 GMT\nContent-Length: 100\n\n[{\"CreateIndex\":62,\"ModifyIndex\":62,\"LockIndex\":0,\"Key\":\"testwrite/value\",\"Flags\":0,\"Value\":\"MzAw\"}]\n\n\nKVS\u4ee5\u5916\u306eAPI\u3078\u306e\u30a2\u30af\u30bb\u30b9\n\u5148\u982d\u3067\u8a18\u8f09\u3057\u305f\u3068\u304a\u308a\u30010.4\u6642\u70b9\u3067\u306fKVS\u4ee5\u5916\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306f\u5236\u9650\u3055\u308c\u306a\u3044\u3002\n$ curl -i -X GET http://localhost:8500/v1/catalog/services?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 6\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:19:51 GMT\nContent-Length: 13\n\n{\"consul\":[]}\n\n$ curl -i -X PUT http://localhost:8500/v1/event/fire/testevent?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 07:20:16 GMT\nContent-Length: 151\n\n{\"ID\":\"1aa92970-7d1a-d4ae-2334-d8fca7002a26\",\"Name\":\"testevent\",\"Payload\":null,\"NodeFilter\":\"\",\"ServiceFilter\":\"\",\"TagFilter\":\"\",\"Versi\non\":1,\"LTime\":0}\n\n$ curl -i -X GET http://localhost:8500/v1/event/list?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 4151740018762382984\nDate: Thu, 06 Nov 2014 07:20:24 GMT\nContent-Length: 153\n\n[{\"ID\":\"1aa92970-7d1a-d4ae-2334-d8fca7002a26\",\"Name\":\"testevent\",\"Payload\":null,\"NodeFilter\":\"\",\"ServiceFilter\":\"\",\"TagFilter\":\"\",\"Vers\nion\":1,\"LTime\":2}]\n\n\u305f\u3060\u3057\u3001ACL\u306eAPI\u3060\u3051\u306f\u3001master\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3002\n$ curl -i -X GET http://localhost:8500/v1/acl/list\nHTTP/1.1 403 Forbidden\nX-Consul-Index: 0\nX-Consul-Knownleader: false\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:18 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X GET http://localhost:8500/v1/acl/list?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 403 Forbidden\nX-Consul-Index: 0\nX-Consul-Knownleader: false\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:22 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X GET http://localhost:8500/v1/acl/list?token=master_token_test\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 26\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:26 GMT\nContent-Length: 449\n\n[{\"CreateIndex\":26,\"ModifyIndex\":26,\"ID\":\"53b6df4c-7f77-c816-750d-b5eabf5ca582\",\"Name\":\"test_token\",\"Type\":\"client\",\"Rules\":\"    key \\\"testread/\\\" {      policy = \\\"read\\\"    }    key \\\"testwrite/\\\" {      policy = \\\"write\\\"    }  \"},{\"CreateIndex\":2,\"ModifyIndex\":2,\"ID\":\"anonymous\",\"Name\":\"Anonymous Token\",\"Type\":\"client\",\"Rules\":\"\"},{\"CreateIndex\":3,\"ModifyIndex\":3,\"ID\":\"master_token_test\",\"Name\":\"Master Token\",\"Type\":\"management\",\"Rules\":\"\"}]\n\n\n\u7d30\u304b\u3044\u52d5\u304d\n\n\u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u305facl_master_token\u304c\u3059\u3079\u3066\u7570\u306a\u308b\u5834\u5408\u3001\u3069\u308c\u304c\u6709\u52b9\u306b\u306a\u308b\u306e\u304b\uff1f\nacl_master_token\u306f\u3001Leader\u306e\u3082\u306e\u304c\u6709\u52b9\u306b\u306a\u308b\u3002\n\u53b3\u5bc6\u306b\u306f\u3001Leader\u306eacl_master_token\u3092ID\u3068\u3057\u305fACL\u304c\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\nLeader\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3089\u3069\u3046\u306a\u308b\u306e\u304b\uff1f\n\n\u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u3068\u7570\u306a\u308b\u5834\u5408\n\n\u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u3092ID\u3068\u3057\u305fACL\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u306eACL\u306f\u305d\u306e\u307e\u307e\u6b8b\u308b\u306e\u3067\u3001master token\u304c\u8907\u6570\u3042\u308b\u72b6\u614b\u306b\u306a\u308b\u3002\n\uff08\u30c0\u30a6\u30f3\u6642\u3082\u3001\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306e\u5fa9\u65e7\u6642\u3082\u3001\u7279\u306b\u524a\u9664\u3057\u306b\u3044\u3063\u305f\u308a\u306f\u3057\u306a\u3044\uff09\n\n\u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u3068\u540c\u4e00\u306e\u5834\u5408\n\nACL\u306f\u5897\u3048\u3082\u305b\u305a\u6e1b\u308a\u3082\u305b\u305a\u3002\u5f15\u304d\u7d9a\u304d\u540c\u3058acl_master_token\u306eACL\u3092\u5229\u7528\u3067\u304d\u308b\u3002\n\u4eca\u306e\u3068\u3053\u308d\u3001\u3053\u3053\u307e\u3067\u3002\nConsul ACL (Consul 0.4.X)\u306e\u4f7f\u3044\u65b9\u3002\n\u8a73\u7d30\u307e\u3067\u6b63\u3057\u3044\u304b\u306f\u4e0d\u660e\u3060\u304c\u3001\u89e3\u3063\u305f\u3053\u3068\u304b\u3089\u66f8\u3044\u3066\u3044\u304f\u3002\n\n\u6982\u8981\n----\n\n* \u30c8\u30fc\u30af\u30f3\u5358\u4f4d\u3067\u5024\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3092\u5236\u9650\u3059\u308b\u6a5f\u80fd\u3002\n* \u5404\u30c8\u30fc\u30af\u30f3\u306fID\u3001\u540d\u524d\u3001\u3069\u3053\u306e\u5024\u306b\u3069\u306e\u3088\u3046\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b\u304b\u306e\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8\u3092\u6301\u3064\u3002\n* \u5024\u3078\u306e\u30a2\u30af\u30bb\u30b9\u6642\u306b\u30c8\u30fc\u30af\u30f3ID\u3092\u6307\u5b9a\u3057\uff08\u6307\u5b9a\u3057\u306a\u3051\u308c\u3070\u30c7\u30d5\u30a9\u30eb\u30c8\u30c8\u30fc\u30af\u30f3\uff09\u3001\u8a8d\u53ef\u3092\u884c\u3046\u3002\n\n\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f[\u3053\u3061\u3089](http://www.consul.io/docs/internals/acl.html \"ACL\")\u3002\n\n\u5bfe\u8c61API\n-------\n\n[\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://www.consul.io/docs/internals/acl.html \"\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\")\u306b\u3001\n> As of Consul 0.4, it is only possible to specify policies for the KV store.\n\n\u3068\u3042\u308b\u3068\u304a\u308a\u30010.4\u6642\u70b9\u3067\u306fKVS\u3060\u3051\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3067\u304d\u308b\u3002\n\u203bACL\u306eAPI\u306b\u306fmaster token\u3067\u306a\u3044\u3068\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044\u3002\n\nConfig\u3067\u66f8\u3051\u308b\u3053\u3068\n-----------------\n\nACL\u306fHTTP API\u3067\u767b\u9332\u3059\u308b\u3002Config\u30d5\u30a1\u30a4\u30eb\u306b\u30eb\u30fc\u30eb\u3092\u66f8\u3044\u3066\u304a\u3044\u3066\u3001\u8d77\u52d5\u3057\u305f\u3089\u305d\u308c\u304c\u6709\u52b9\u306b\u306a\u308b\u3001\u3068\u3044\u3046\u4f7f\u3044\u65b9\u3067\u306f\u306a\u3044\u6a21\u69d8\u3002\n\n### Config\u30d5\u30a1\u30a4\u30eb\u306b\u66f8\u304f\u5024\n\n* acl_datacenter\n\n\u3053\u308c\u3067\u6307\u5b9a\u3057\u305fdatacenter\u304cACL\u3067\u30a2\u30af\u30bb\u30b9\u5236\u9650\u3059\u308b\u5bfe\u8c61\u306b\u306a\u308b\u3002\u3053\u306e\u6307\u5b9a\u304c\u3042\u308b\u3068ACL\u304c\u6709\u52b9\u306b\u306a\u308b\u304c\u3001\u6307\u5b9a\u305b\u305a\u306bACL\u306eAPI\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002\n\n```bash\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test\nACL support disabled\n```\n\n* acl_default_policy\n\nallow\u304bdeny\u3092\u8a2d\u5b9a\u3059\u308b\u3002ACL\u306e\u6301\u3063\u3066\u3044\u308brule\u306b\u5bfe\u3057\u3066\u9069\u7528\u3055\u308c\u308b\u3082\u306e\u3067\u3001allow\u306e\u5834\u5408\u306fblacklist\u3001deny\u306e\u5834\u5408\u306fwhitelist\u65b9\u5f0f\u3067\u306e\u5236\u9650\u3092\u884c\u3046\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fallow\u3002\n\n* acl_master_token\n\nType\u304cmanagement\u306e\u30c8\u30fc\u30af\u30f3\u3002\u3053\u308c\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001\u5168\u3066\u306e\u5024\u306bwrite\u30ec\u30d9\u30eb\u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u3001ACL\u306e\u64cd\u4f5c\u304c\u3067\u304d\u308b\u3002\n\u203b\u5bfe\u3057\u3066Type\u304cclient\u306e\u5834\u5408\u3001ACL\u306e\u64cd\u4f5c\u306f\u3067\u304d\u306a\u3044\u3002\n\n* acl_token\n\nHTTP API\u3067\u5024\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u969b\u3001?token=\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306f\u3053\u306e\u30c8\u30fc\u30af\u30f3\u304c\u5229\u7528\u3055\u308c\u308b\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306fanonymous\u3002\n\u203b\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a\u3059\u308c\u3070\u3001\u3053\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u5358\u4f4d\u3067\u4e0a\u66f8\u304d\u3067\u304d\u308b\u3001\u3068\u3044\u3046\u3053\u3068\u3002\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u4f8b\n\n/etc/consul.d/default.json\n\n```json\n{\n  \"datacenter\": \"testdc\",\n  \"data_dir\": \"/var/lib/consul\",\n  \"server\": true,\n  \"bootstrap\": true,\n  \"acl_datacenter\": \"testdc\",\n  \"acl_default_policy\": \"deny\",\n  \"acl_master_token\": \"master_token_test\",\n  \"acl_token\": \"anonymous\"\n}\n```\n\n\u4e0a\u8a18\u306e\u8a2d\u5b9a\u3067\u8d77\u52d5\u3057\u305f\u5834\u5408\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5b58\u5728\u3059\u308bACL\u3092\u53d6\u5f97\u3057\u3066\u307f\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n$ curl http://localhost:8500/v1/acl/list\nPermission denied\n\n$ curl http://localhost:8500/v1/acl/list?token=anonymous\nPermission denied\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_error\nACL not found\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test | jq .\n[\n  {\n    \"Rules\": \"\",\n    \"Type\": \"client\",\n    \"Name\": \"Anonymous Token\",\n    \"ID\": \"anonymous\",\n    \"ModifyIndex\": 2,\n    \"CreateIndex\": 2\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"management\",\n    \"Name\": \"Master Token\",\n    \"ID\": \"master_token_test\",\n    \"ModifyIndex\": 3,\n    \"CreateIndex\": 3\n  }\n]\n```\n\nACL\u306e\u767b\u9332\n--------\n\nACL\u306fHTTP API\u3067\u767b\u9332\u3059\u308b\u3002\nRules\u306f [HashiCorp Configuration Language (HCL)](https://github.com/hashicorp/hcl/ \"HashiCorp Configuration Language (HCL)\") \u3092\u6587\u5b57\u5217\u3067\u8a18\u8ff0\u3059\u308b\u3002 ~~json\u3067\u66f8\u304f\u3068\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u3002~~ json\u3067\u66f8\u3044\u3066\u3082\u5927\u4e08\u592b\u3002\npolicy\u306b\u306fdeny\u3001read\u3001write\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u3001write\u306fread\u306e\u6a29\u9650\u3082\u5305\u542b\u3059\u308b(readwrite\u306f\u5b58\u5728\u305b\u305a\u3001\u66f8\u304d\u8fbc\u3081\u308b\u304c\u8aad\u307f\u8fbc\u3081\u306a\u3044\u3001\u3068\u3044\u3046\u3053\u3068\u306f\u7121\u3044)\u3002\n\n\u4f8b\uff1a\n\n```bash\n$ cat /tmp/acl.txt\n{\n  \"Name\": \"test_token\",\n  \"Type\": \"client\",\n  \"Rules\": \"\n    key \\\"testread/\\\" {\n      policy = \\\"read\\\"\n    }\n    key \\\"testwrite/\\\" {\n      policy = \\\"write\\\"\n    }\n  \"\n}\n\n$ curl -X PUT http://localhost:8500/v1/acl/create?token=master_token_test -d @/tmp/acl.txt\n{\"ID\":\"53b6df4c-7f77-c816-750d-b5eabf5ca582\"}\n\n$ curl http://localhost:8500/v1/acl/list?token=master_token_test | jq .\n[\n  {\n    \"Rules\": \"    key \\\"testread/\\\" {      policy = \\\"read\\\"    }    key \\\"testwrite/\\\" {      policy = \\\"write\\\"    }  \",\n    \"Type\": \"client\",\n    \"Name\": \"test_token\",\n    \"ID\": \"53b6df4c-7f77-c816-750d-b5eabf5ca582\",\n    \"ModifyIndex\": 26,\n    \"CreateIndex\": 26\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"client\",\n    \"Name\": \"Anonymous Token\",\n    \"ID\": \"anonymous\",\n    \"ModifyIndex\": 2,\n    \"CreateIndex\": 2\n  },\n  {\n    \"Rules\": \"\",\n    \"Type\": \"management\",\n    \"Name\": \"Master Token\",\n    \"ID\": \"master_token_test\",\n    \"ModifyIndex\": 3,\n    \"CreateIndex\": 3\n  }\n]\n```\n\ncreate\u3059\u308b\u3068\u3001\u4f5c\u6210\u3055\u308c\u305fACL\u306eID\u304c\u623b\u3063\u3066\u304f\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u4f7f\u3046\u5f62\u306b\u306a\u308b\u3002\n\nACL\u3092\u4f7f\u3063\u3066\u30a2\u30af\u30bb\u30b9\n-----------------\n\n### readable\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\n\n* readable\u306b\u5bfe\u3057\u3066GET\u3092\u884c\u3044\u3001\u5024\u304c\u7121\u3044\u5834\u5408\n\n```bash\n$ # no value\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=master_token_test\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:22 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:30 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:40 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 404 Not Found\nX-Consul-Index: 44\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:46:54 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n```\n\n* readable\u306b\u5bfe\u3057\u3066PUT\u3092\u884c\u3046\u5834\u5408\n\n``` bash\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:41 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=anonymous -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:48 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582 -d 200\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 06:47:59 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testread/value?token=master_token_test -d 200\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 06:48:31 GMT\nContent-Length: 4\n\ntrue\n```\n\n* readable\u306b\u5bfe\u3057\u3066GET\u3092\u884c\u3044\u3001\u5024\u304c\u3042\u308b\u5834\u5408\n\n```bash\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=master_token_test\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:48:58 GMT\nContent-Length: 99\n\n[{\"CreateIndex\":48,\"ModifyIndex\":48,\"LockIndex\":0,\"Key\":\"testread/value\",\"Flags\":0,\"Value\":\"MjAw\"}]\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:26 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:34 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testread/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 48\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 06:49:42 GMT\nContent-Length: 99\n\n[{\"CreateIndex\":48,\"ModifyIndex\":48,\"LockIndex\":0,\"Key\":\"testread/value\",\"Flags\":0,\"Value\":\"MjAw\"}]\n```\n\nmaster_token\u306f\u4f55\u3067\u3082\u3067\u304d\u308b\u3002\n\u307e\u305f\u3001read\u304c\u8a31\u53ef\u3055\u308c\u3066\u3044\u306a\u3044\u30c8\u30fc\u30af\u30f3\u3067GET\u3092\u884c\u3063\u305f\u5834\u5408\u3001403\u3067\u306f\u306a\u304f404\u306b\u306a\u308b\u3089\u3057\u3044\u306e\u3067\u3001\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306f\u6ce8\u610f\u304c\u5fc5\u8981\u304b\u3082\u3057\u308c\u306a\u3044\u3002\n\n### writable\u306b\u5bfe\u3059\u308b\u30a2\u30af\u30bb\u30b9\n\nmaster_token\u306f\u4e0a\u3067\u3082\u4f3c\u305f\u3088\u3046\u306a\u5b9f\u9a13\u3092\u884c\u3063\u305f\u305f\u3081\u3001\u7701\u7565\u3002\n\n* writable\u306b\u5bfe\u3057\u3066\u66f8\u304d\u8fbc\u307f\n\n```bash\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value -d 300\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 07:00:47 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value?token=anonymous -d 300\nHTTP/1.1 403 Forbidden\nDate: Thu, 06 Nov 2014 07:00:54 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X PUT http://localhost:8500/v1/kv/testwrite/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582 -d 300\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 07:01:03 GMT\nContent-Length: 4\n\ntrue\n```\n\n* writable\u306b\u5bfe\u3057\u3066\u8aad\u307f\u8fbc\u307f\n\n```bash\n$ curl -i http://localhost:8500/v1/kv/testwrite/value\nHTTP/1.1 404 Not Found\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:09 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testwrite/value?token=anonymous\nHTTP/1.1 404 Not Found\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:17 GMT\nContent-Length: 0\nContent-Type: text/plain; charset=utf-8\n\n$ curl -i http://localhost:8500/v1/kv/testwrite/value?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 62\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:03:23 GMT\nContent-Length: 100\n\n[{\"CreateIndex\":62,\"ModifyIndex\":62,\"LockIndex\":0,\"Key\":\"testwrite/value\",\"Flags\":0,\"Value\":\"MzAw\"}]\n```\n\nKVS\u4ee5\u5916\u306eAPI\u3078\u306e\u30a2\u30af\u30bb\u30b9\n--------------------------\n\n\u5148\u982d\u3067\u8a18\u8f09\u3057\u305f\u3068\u304a\u308a\u30010.4\u6642\u70b9\u3067\u306fKVS\u4ee5\u5916\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306f\u5236\u9650\u3055\u308c\u306a\u3044\u3002\n\n```bash\n$ curl -i -X GET http://localhost:8500/v1/catalog/services?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 6\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:19:51 GMT\nContent-Length: 13\n\n{\"consul\":[]}\n\n$ curl -i -X PUT http://localhost:8500/v1/event/fire/testevent?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nDate: Thu, 06 Nov 2014 07:20:16 GMT\nContent-Length: 151\n\n{\"ID\":\"1aa92970-7d1a-d4ae-2334-d8fca7002a26\",\"Name\":\"testevent\",\"Payload\":null,\"NodeFilter\":\"\",\"ServiceFilter\":\"\",\"TagFilter\":\"\",\"Versi\non\":1,\"LTime\":0}\n\n$ curl -i -X GET http://localhost:8500/v1/event/list?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 4151740018762382984\nDate: Thu, 06 Nov 2014 07:20:24 GMT\nContent-Length: 153\n\n[{\"ID\":\"1aa92970-7d1a-d4ae-2334-d8fca7002a26\",\"Name\":\"testevent\",\"Payload\":null,\"NodeFilter\":\"\",\"ServiceFilter\":\"\",\"TagFilter\":\"\",\"Vers\nion\":1,\"LTime\":2}]\n```\n\n\u305f\u3060\u3057\u3001ACL\u306eAPI\u3060\u3051\u306f\u3001master\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\u3002\n\n```bash\n$ curl -i -X GET http://localhost:8500/v1/acl/list\nHTTP/1.1 403 Forbidden\nX-Consul-Index: 0\nX-Consul-Knownleader: false\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:18 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X GET http://localhost:8500/v1/acl/list?token=53b6df4c-7f77-c816-750d-b5eabf5ca582\nHTTP/1.1 403 Forbidden\nX-Consul-Index: 0\nX-Consul-Knownleader: false\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:22 GMT\nContent-Length: 17\nContent-Type: text/plain; charset=utf-8\n\nPermission denied\n\n$ curl -i -X GET http://localhost:8500/v1/acl/list?token=master_token_test\nHTTP/1.1 200 OK\nContent-Type: application/json\nX-Consul-Index: 26\nX-Consul-Knownleader: true\nX-Consul-Lastcontact: 0\nDate: Thu, 06 Nov 2014 07:12:26 GMT\nContent-Length: 449\n\n[{\"CreateIndex\":26,\"ModifyIndex\":26,\"ID\":\"53b6df4c-7f77-c816-750d-b5eabf5ca582\",\"Name\":\"test_token\",\"Type\":\"client\",\"Rules\":\"    key \\\"testread/\\\" {      policy = \\\"read\\\"    }    key \\\"testwrite/\\\" {      policy = \\\"write\\\"    }  \"},{\"CreateIndex\":2,\"ModifyIndex\":2,\"ID\":\"anonymous\",\"Name\":\"Anonymous Token\",\"Type\":\"client\",\"Rules\":\"\"},{\"CreateIndex\":3,\"ModifyIndex\":3,\"ID\":\"master_token_test\",\"Name\":\"Master Token\",\"Type\":\"management\",\"Rules\":\"\"}]\n```\n\n\u7d30\u304b\u3044\u52d5\u304d\n----------\n\n### \u30af\u30e9\u30b9\u30bf\u306b\u53c2\u52a0\u3059\u308b\u30ce\u30fc\u30c9\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u305facl_master_token\u304c\u3059\u3079\u3066\u7570\u306a\u308b\u5834\u5408\u3001\u3069\u308c\u304c\u6709\u52b9\u306b\u306a\u308b\u306e\u304b\uff1f\n\nacl_master_token\u306f\u3001Leader\u306e\u3082\u306e\u304c\u6709\u52b9\u306b\u306a\u308b\u3002\n\u53b3\u5bc6\u306b\u306f\u3001Leader\u306eacl_master_token\u3092ID\u3068\u3057\u305fACL\u304c\u30af\u30e9\u30b9\u30bf\u306b\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\n### Leader\u304c\u30c0\u30a6\u30f3\u3057\u305f\u3089\u3069\u3046\u306a\u308b\u306e\u304b\uff1f\n\n* \u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u3068\u7570\u306a\u308b\u5834\u5408\n\n\u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u3092ID\u3068\u3057\u305fACL\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u306eACL\u306f\u305d\u306e\u307e\u307e\u6b8b\u308b\u306e\u3067\u3001master token\u304c\u8907\u6570\u3042\u308b\u72b6\u614b\u306b\u306a\u308b\u3002\n\uff08\u30c0\u30a6\u30f3\u6642\u3082\u3001\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306e\u5fa9\u65e7\u6642\u3082\u3001\u7279\u306b\u524a\u9664\u3057\u306b\u3044\u3063\u305f\u308a\u306f\u3057\u306a\u3044\uff09\n\n* \u65b0\u3057\u304f\u9078\u51fa\u3055\u308c\u305fLeader\u306e\u8a2d\u5b9a\u306b\u66f8\u304b\u308c\u3066\u3044\u305facl_master_token\u304c\u30c0\u30a6\u30f3\u3057\u305f\u5143Leader\u306eacl_master_token\u3068\u540c\u4e00\u306e\u5834\u5408\n\nACL\u306f\u5897\u3048\u3082\u305b\u305a\u6e1b\u308a\u3082\u305b\u305a\u3002\u5f15\u304d\u7d9a\u304d\u540c\u3058acl_master_token\u306eACL\u3092\u5229\u7528\u3067\u304d\u308b\u3002\n\n\n\u4eca\u306e\u3068\u3053\u308d\u3001\u3053\u3053\u307e\u3067\u3002\n", "tags": ["consul0.4"]}