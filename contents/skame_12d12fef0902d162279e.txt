{"context": "\n\n\u8868\u984c\u306e\u3068\u304a\u308a glibc \u304c\u30ea\u30f3\u30af\u3055\u308c\u305f binary \u3092 alpine \u4e0a\u3067\u52d5\u304b\u3057\u305f\u3044\ndocker-compose \u3068\u304b\uff0cgolang \u7cfb\u306e\u3082\u306e\u3068\u304b\u3092\u30d0\u30a4\u30ca\u30ea\u3067\u843d\u3068\u3057\u3066\u304d\u3066\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff0e\u3057\u304b\u3082 not found\uff0e\ndocker-compose \u306f python \u306e\u30d0\u30a4\u30ca\u30ea\u306a\u306e\u304b\u2026\u2026\n$ docker run -it --rm alpine:latest /bin/ash\n/ #  apk --update add curl\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing ca-certificates (20160104-r4)\n(2/4) Installing libssh2 (1.7.0-r0)\n(3/4) Installing libcurl (7.51.0-r0)\n(4/4) Installing curl (7.51.0-r0)\nExecuting busybox-1.24.2-r11.trigger\nExecuting ca-certificates-20160104-r4.trigger\nOK: 6 MiB in 15 packages\n/ # curl -s -L https://github.com/docker/compose/releases/latest | \\\n>     egrep -o '/docker/compose/releases/download/[0-9.]*/docker-compose-Linux-x86_64' | \\\n>     (curl -Lo /usr/local/bin/docker-compose http://github.com/`cat`) && \\\n>     chmod +x /usr/local/bin/docker-compose && \\\n>     /usr/local/bin/docker-compose --version\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n100   600    0   600    0     0    532      0 --:--:--  0:00:01 --:--:--   993\n100 7857k  100 7857k    0     0  1559k      0  0:00:05  0:00:05 --:--:-- 2162k\n/bin/ash: /usr/local/bin/docker-compose: not found\n\n\n\u89e3\u6c7a\u6cd5\n\n1. alpine \u30d9\u30fc\u30b9\u3092\u3042\u304d\u3089\u3081\u308b\uff0e\nbaseimage \u3068\u304b\uff1f\u3067\u3082\u30c7\u30ab\u3044\u3093\u3060\u3088\u306a\u2026\u2026\uff0e\n\n2. \u81ea\u5206\u3067 build \u3059\u308b\uff0e\ngolang:alpine \u3068\u304b\u3067\u3067\u304d\u308b\u304c\uff0c\u30d3\u30eb\u30c9\u74b0\u5883\u5185\u5305\u3059\u308b\u306e\u3067\u30c7\u30ab\u304f\u306a\u308b\uff0e\n\u5916\u90e8\u30b3\u30f3\u30c6\u30ca\u4f7f\u3063\u3066\u30d0\u30a4\u30ca\u30ea\u3060\u3051\u6301\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u306e\u304c\u7f8e\u3057\u3044\u304b\u3082\uff0e\u305f\u3060\u9762\u5012\u305d\u3046\uff0e\nhttp://qiita.com/yugui/items/517480f4383b893e092e \u3042\u305f\u308a\u3067\u5916\u90e8\u30b3\u30f3\u30c6\u30ca\u4f7f\u3063\u305f\u65b9\u6cd5\u3084\uff0cBazel \u4f7f\u3063\u305f\u65b9\u6cd5\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\uff0e\n\n3. \u4e0d\u8db3\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff0e\nalpine \u7684\u306b\u6b63\u3057\u304f\u306a\u3055\u305d\u3046\u3060\u304c\uff0c\u5b89\u5fc3\u611f\u306f\u3042\u308b\uff0eDockerfile \u304c\u6c5a\u306a\u304f\u306a\u308b\uff0e\nref. https://github.com/frol/docker-alpine-glibc/blob/master/Dockerfile\nglibc \u5bfe\u5fdc alpine \u30b3\u30f3\u30c6\u30ca\u304b\u3089\u30b3\u30fc\u30c9\u3092\u5f15\u3063\u3071\u3063\u3066\u304d\u305f\u3082\u306e\uff0e\u5143\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u3082\u3044\u3044\u306e\u3060\u308d\u3046\u3051\u3069\uff0e\nRUN ALPINE_GLIBC_BASE_URL=\"https://github.com/sgerrand/alpine-pkg-glibc/releases/download\" && \\\n    ALPINE_GLIBC_PACKAGE_VERSION=\"2.23-r3\" && \\\n    ALPINE_GLIBC_BASE_PACKAGE_FILENAME=\"glibc-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    ALPINE_GLIBC_BIN_PACKAGE_FILENAME=\"glibc-bin-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    ALPINE_GLIBC_I18N_PACKAGE_FILENAME=\"glibc-i18n-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    apk add --no-cache --virtual=.build-dependencies wget ca-certificates && \\\n    wget \\\n        \"https://raw.githubusercontent.com/andyshinn/alpine-pkg-glibc/master/sgerrand.rsa.pub\" \\\n        -O \"/etc/apk/keys/sgerrand.rsa.pub\" && \\\n    wget \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\" && \\\n    apk add --no-cache \\\n        \"$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\" && \\\n    \\\n    rm \"/etc/apk/keys/sgerrand.rsa.pub\" && \\\n    /usr/glibc-compat/bin/localedef --force --inputfile POSIX --charmap UTF-8 C.UTF-8 || true && \\\n    echo \"export LANG=C.UTF-8\" > /etc/profile.d/locale.sh && \\\n    \\\n    apk del glibc-i18n && \\\n    \\\n    rm \"/root/.wget-hsts\" && \\\n    apk del .build-dependencies && \\\n    rm \\\n        \"$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\"\n\n\n4. symbolic link \u5f35\u308b\n\u3044\u304d\u306a\u308a\u975e\u4e92\u63dbAPI\u53e9\u304b\u308c\u308b\u3068\u843d\u3061\u308b\u306e\u3067\uff0c\u5272\u3068\u5371\u967a\uff0e\nref. http://qiita.com/MiCHiLU/items/1e80a5325b2746eaf2d4\nmkdir /lib64 && ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u3063\u3066\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u5931\u6557\uff0e\u306a\u3093\u304b\u61d0\u3057\u3044\u306a\uff0eLD_LIBRARY_PATH \u3068\u304b\u601d\u3044\u51fa\u3059\uff0e\n\n/ # mkdir /lib64 && ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2\n/ # docker-compose -v\nError relocating /tmp/_MEIGjGAKb/libz.so.1: __vsnprintf_chk: symbol not found\nError relocating /tmp/_MEIGjGAKb/libz.so.1: __sprintf_chk: symbol not found\n\n# \u8868\u984c\u306e\u3068\u304a\u308a glibc \u304c\u30ea\u30f3\u30af\u3055\u308c\u305f binary \u3092 alpine \u4e0a\u3067\u52d5\u304b\u3057\u305f\u3044\n\ndocker-compose \u3068\u304b\uff0cgolang \u7cfb\u306e\u3082\u306e\u3068\u304b\u3092\u30d0\u30a4\u30ca\u30ea\u3067\u843d\u3068\u3057\u3066\u304d\u3066\u5b9f\u884c\u3059\u308b\u3068\u30a8\u30e9\u30fc\u304c\u51fa\u308b\uff0e\u3057\u304b\u3082 not found\uff0e\ndocker-compose \u306f python \u306e\u30d0\u30a4\u30ca\u30ea\u306a\u306e\u304b\u2026\u2026\n\n```\n$ docker run -it --rm alpine:latest /bin/ash\n/ #  apk --update add curl\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.4/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing ca-certificates (20160104-r4)\n(2/4) Installing libssh2 (1.7.0-r0)\n(3/4) Installing libcurl (7.51.0-r0)\n(4/4) Installing curl (7.51.0-r0)\nExecuting busybox-1.24.2-r11.trigger\nExecuting ca-certificates-20160104-r4.trigger\nOK: 6 MiB in 15 packages\n/ # curl -s -L https://github.com/docker/compose/releases/latest | \\\n>     egrep -o '/docker/compose/releases/download/[0-9.]*/docker-compose-Linux-x86_64' | \\\n>     (curl -Lo /usr/local/bin/docker-compose http://github.com/`cat`) && \\\n>     chmod +x /usr/local/bin/docker-compose && \\\n>     /usr/local/bin/docker-compose --version\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0\n100   600    0   600    0     0    532      0 --:--:--  0:00:01 --:--:--   993\n100 7857k  100 7857k    0     0  1559k      0  0:00:05  0:00:05 --:--:-- 2162k\n/bin/ash: /usr/local/bin/docker-compose: not found\n```\n\n# \u89e3\u6c7a\u6cd5\n\n## 1. alpine \u30d9\u30fc\u30b9\u3092\u3042\u304d\u3089\u3081\u308b\uff0e\n\nbaseimage \u3068\u304b\uff1f\u3067\u3082\u30c7\u30ab\u3044\u3093\u3060\u3088\u306a\u2026\u2026\uff0e\n\n## 2. \u81ea\u5206\u3067 build \u3059\u308b\uff0e\n\ngolang:alpine \u3068\u304b\u3067\u3067\u304d\u308b\u304c\uff0c\u30d3\u30eb\u30c9\u74b0\u5883\u5185\u5305\u3059\u308b\u306e\u3067\u30c7\u30ab\u304f\u306a\u308b\uff0e\n\n\u5916\u90e8\u30b3\u30f3\u30c6\u30ca\u4f7f\u3063\u3066\u30d0\u30a4\u30ca\u30ea\u3060\u3051\u6301\u3063\u3066\u304f\u308b\u3068\u3044\u3046\u306e\u304c\u7f8e\u3057\u3044\u304b\u3082\uff0e\u305f\u3060\u9762\u5012\u305d\u3046\uff0e\n\nhttp://qiita.com/yugui/items/517480f4383b893e092e \u3042\u305f\u308a\u3067\u5916\u90e8\u30b3\u30f3\u30c6\u30ca\u4f7f\u3063\u305f\u65b9\u6cd5\u3084\uff0cBazel \u4f7f\u3063\u305f\u65b9\u6cd5\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\uff0e\n\n## 3. \u4e0d\u8db3\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\uff0e\n\nalpine \u7684\u306b\u6b63\u3057\u304f\u306a\u3055\u305d\u3046\u3060\u304c\uff0c\u5b89\u5fc3\u611f\u306f\u3042\u308b\uff0eDockerfile \u304c\u6c5a\u306a\u304f\u306a\u308b\uff0e\n\nref. https://github.com/frol/docker-alpine-glibc/blob/master/Dockerfile\n\n[glibc \u5bfe\u5fdc alpine \u30b3\u30f3\u30c6\u30ca](https://hub.docker.com/r/frolvlad/alpine-glibc/)\u304b\u3089\u30b3\u30fc\u30c9\u3092\u5f15\u3063\u3071\u3063\u3066\u304d\u305f\u3082\u306e\uff0e\u5143\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u4f7f\u3063\u3066\u3082\u3044\u3044\u306e\u3060\u308d\u3046\u3051\u3069\uff0e\n\n```\nRUN ALPINE_GLIBC_BASE_URL=\"https://github.com/sgerrand/alpine-pkg-glibc/releases/download\" && \\\n    ALPINE_GLIBC_PACKAGE_VERSION=\"2.23-r3\" && \\\n    ALPINE_GLIBC_BASE_PACKAGE_FILENAME=\"glibc-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    ALPINE_GLIBC_BIN_PACKAGE_FILENAME=\"glibc-bin-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    ALPINE_GLIBC_I18N_PACKAGE_FILENAME=\"glibc-i18n-$ALPINE_GLIBC_PACKAGE_VERSION.apk\" && \\\n    apk add --no-cache --virtual=.build-dependencies wget ca-certificates && \\\n    wget \\\n        \"https://raw.githubusercontent.com/andyshinn/alpine-pkg-glibc/master/sgerrand.rsa.pub\" \\\n        -O \"/etc/apk/keys/sgerrand.rsa.pub\" && \\\n    wget \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BASE_URL/$ALPINE_GLIBC_PACKAGE_VERSION/$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\" && \\\n    apk add --no-cache \\\n        \"$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\" && \\\n    \\\n    rm \"/etc/apk/keys/sgerrand.rsa.pub\" && \\\n    /usr/glibc-compat/bin/localedef --force --inputfile POSIX --charmap UTF-8 C.UTF-8 || true && \\\n    echo \"export LANG=C.UTF-8\" > /etc/profile.d/locale.sh && \\\n    \\\n    apk del glibc-i18n && \\\n    \\\n    rm \"/root/.wget-hsts\" && \\\n    apk del .build-dependencies && \\\n    rm \\\n        \"$ALPINE_GLIBC_BASE_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_BIN_PACKAGE_FILENAME\" \\\n        \"$ALPINE_GLIBC_I18N_PACKAGE_FILENAME\"\n```\n\n## 4. symbolic link \u5f35\u308b\n\n\u3044\u304d\u306a\u308a\u975e\u4e92\u63dbAPI\u53e9\u304b\u308c\u308b\u3068\u843d\u3061\u308b\u306e\u3067\uff0c\u5272\u3068\u5371\u967a\uff0e\n\nref. http://qiita.com/MiCHiLU/items/1e80a5325b2746eaf2d4\n\n```\nmkdir /lib64 && ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2\n```\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u3063\u3066\u306f\u3053\u3093\u306a\u611f\u3058\u3067\u5931\u6557\uff0e\u306a\u3093\u304b\u61d0\u3057\u3044\u306a\uff0eLD_LIBRARY_PATH \u3068\u304b\u601d\u3044\u51fa\u3059\uff0e\n```\n/ # mkdir /lib64 && ln -s /lib/libc.musl-x86_64.so.1 /lib64/ld-linux-x86-64.so.2\n/ # docker-compose -v\nError relocating /tmp/_MEIGjGAKb/libz.so.1: __vsnprintf_chk: symbol not found\nError relocating /tmp/_MEIGjGAKb/libz.so.1: __sprintf_chk: symbol not found\n```\n", "tags": ["docker", "alpine"]}