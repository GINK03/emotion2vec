{"context": " More than 1 year has passed since last update.Mac OSX Yosemite \uff0b Qt5.2.0 \u306e\u74b0\u5883\u3060\u3068\u3001\u30a2\u30d7\u30ea\u753b\u9762\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u304c \"file:///.file/id=12345\" \u3068\u3044\u3046\u3075\u3046\u306b\u3001\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002Qt\u306e\u30d0\u30b0\u3060\u305d\u3046\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u624b\u6cd5\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002\n\n \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n[your_app].pro\nLIBS += -framework CoreFoundation\n\n\n\nmainwindow.h\n#include \"CoreFoundation/CoreFoundation.h\"\nprivate:\n    std::string GetPathFromCFURLRef(CFURLRef urlRef);\n\n\n\nmainwindow.cpp\n// \u8ffd\u52a0\u306e\u95a2\u6570\nstd::string MainWindow::GetPathFromCFURLRef(CFURLRef urlRef)\n{\n    char buffer[1024];\n    std::string path;\n    if(CFURLGetFileSystemRepresentation(urlRef, (Boolean)true, (UInt8*)buffer, (CFIndex)1024))\n        path = std::string(buffer);\n    return path;\n}\n// \u30e1\u30a4\u30f3\u753b\u9762\u3078\u306e\u30c9\u30ed\u30c3\u30d7\u30a4\u30d9\u30f3\u30c8\nvoid MainWindow::dropEvent(QDropEvent *ev)\n{\n    QUrl url = ev->mimeData()->urls().first();\n    QString file_path;\n    if (url.url().startsWith(\"file:///.file/id=\")) {\n        char const* utf8 = url.url().toUtf8().constData();\n        CFStringRef cfstringref = CFStringCreateWithCString(kCFAllocatorDefault, utf8,kCFStringEncodingUTF8);\n        CFURLRef cfurl = CFURLCreateWithString(0, cfstringref, 0);\n        CFErrorRef error = 0;\n        CFURLRef absurl = CFURLCreateFilePathURL(kCFAllocatorDefault, cfurl, &error);\n        std::string path = GetPathFromCFURLRef(absurl);\n        CFRelease(cfurl);\n        CFRelease(absurl);\n        file_path = QString::fromUtf8(path.c_str());\n    } else {\n        file_path = url.toLocalFile();\n    }\n    \u30fb\u30fb\u30fb\n}\n\n\n\n \u53c2\u8003URL\nQt Yosemite drop bug\nhttp://ameblo.jp/mfukushima/entry-12028663303.html\n**Mac OSX Yosemite \uff0b Qt5.2.0 \u306e\u74b0\u5883\u3060\u3068\u3001\u30a2\u30d7\u30ea\u753b\u9762\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u304c `\"file:///.file/id=12345\"` \u3068\u3044\u3046\u3075\u3046\u306b\u3001\u304a\u304b\u3057\u306a\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002Qt\u306e\u30d0\u30b0\u3060\u305d\u3046\u3067\u3059\u304c\u3001\u4ee5\u4e0b\u306e\u624b\u6cd5\u3067\u89e3\u6c7a\u3067\u304d\u307e\u3057\u305f\u3002**\n\n# ![churippu_s.png](https://qiita-image-store.s3.amazonaws.com/0/36751/8157fb95-559a-856d-af0d-e4f75f0c40f6.png) \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n```cpp:[your_app].pro\nLIBS += -framework CoreFoundation\n```\n\n```cpp:mainwindow.h\n#include \"CoreFoundation/CoreFoundation.h\"\nprivate:\n    std::string GetPathFromCFURLRef(CFURLRef urlRef);\n```\n\n```cpp:mainwindow.cpp\n// \u8ffd\u52a0\u306e\u95a2\u6570\nstd::string MainWindow::GetPathFromCFURLRef(CFURLRef urlRef)\n{\n\tchar buffer[1024];\n\tstd::string path;\n\tif(CFURLGetFileSystemRepresentation(urlRef, (Boolean)true, (UInt8*)buffer, (CFIndex)1024))\n\t\tpath = std::string(buffer);\n\treturn path;\n}\n// \u30e1\u30a4\u30f3\u753b\u9762\u3078\u306e\u30c9\u30ed\u30c3\u30d7\u30a4\u30d9\u30f3\u30c8\nvoid MainWindow::dropEvent(QDropEvent *ev)\n{\n\tQUrl url = ev->mimeData()->urls().first();\n\tQString file_path;\n\tif (url.url().startsWith(\"file:///.file/id=\")) {\n\t\tchar const* utf8 = url.url().toUtf8().constData();\n\t\tCFStringRef cfstringref = CFStringCreateWithCString(kCFAllocatorDefault, utf8,kCFStringEncodingUTF8);\n\t\tCFURLRef cfurl = CFURLCreateWithString(0, cfstringref, 0);\n\t\tCFErrorRef error = 0;\n\t\tCFURLRef absurl = CFURLCreateFilePathURL(kCFAllocatorDefault, cfurl, &error);\n\t\tstd::string path = GetPathFromCFURLRef(absurl);\n\t\tCFRelease(cfurl);\n\t\tCFRelease(absurl);\n\t\tfile_path = QString::fromUtf8(path.c_str());\n\t} else {\n\t\tfile_path = url.toLocalFile();\n\t}\n\t\u30fb\u30fb\u30fb\n}\n```\n\n# ![churippu_s.png](https://qiita-image-store.s3.amazonaws.com/0/36751/8157fb95-559a-856d-af0d-e4f75f0c40f6.png) \u53c2\u8003URL\nQt Yosemite drop bug\nhttp://ameblo.jp/mfukushima/entry-12028663303.html\n", "tags": ["Qt5.2.0"]}