{"context": " More than 1 year has passed since last update.\n\nAndroid\u3067Eddystone\u4fe1\u53f7\u3092\u53d7\u4fe1\u3057\u3066\u307f\u3088\u3046\nEddystone\u306e\u516c\u5f0fHP\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3001Android 5.0\u5411\u3051\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001 4.3,4.4\u306eAPI\u3067\u8a18\u8ff0\u3057\u3066\u307f\u308b\u3002\n\nManifest\u30d5\u30a1\u30a4\u30eb\u306b\u7279\u6a29\u306e\u8ffd\u52a0\n<uses-permission android:name=\"android.permission.BLUETOOTH\"/>\n<uses-permission android:name=\"android.permission.BLUETOOTH_ADMIN\"/>\n\nAndroid Play \u306b\u30a2\u30d7\u30ea\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u969b\u306f\u3001Bluetooth 4.0 LE\u642d\u8f09\u306e\u6a5f\u7a2e\u3067\u3057\u304b\u52d5\u4f5c\u3067\u304d\u307e\u305b\u3093\u3088\u3068\u3044\u3046\u304a\u307e\u3058\u306a\u3044\u3082\u3001Manifest\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n<uses-feature android:name=\"android.hardware.bluetooth_le\" android:required=\"true\"/>\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u8a18\u8ff0\u7de8\n\nBluetooth Adapter\u306e\u53d6\u5f97\n\nfinal BluetoothManager bluetoothManager =\n        (BluetoothManager) getSystemService(Context.BLUETOOTH_SERVICE);\nmBluetoothAdapter = bluetoothManager.getAdapter();\n\n\n\nBluetooth LE\u30c7\u30d0\u30a4\u30b9\u306e\u691c\u7d22\nmBluetoothAdapter.startLeScan(mLeScanCallback);\n\n\u3092\u547c\u3073\u51fa\u3059\u3068\u3001Bluetooth LE\u30c7\u30d0\u30a4\u30b9\u306e\u63a2\u7d22\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u306e\u4e2d\u8eab\u3067\u3059\u304c\u3001\nprivate BluetoothAdapter.LeScanCallback mLeScanCallback = new BluetoothAdapter.LeScanCallback() {\n    @Override\n    public void onLeScan(final BluetoothDevice device, int rssi,byte[] scanRecord) {\n         // \u30c7\u30d0\u30a4\u30b9\u304c\u691c\u51fa\u3055\u308c\u308b\u5ea6\u306b\u547c\u3073\u51fa\u3055\u308c\u307e\u3059\u3002\n    });\n};\n\n\u5b9f\u306f\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3060\u3051\u3067\u3001Eddystone\u3092\u691c\u51fa\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3044\u308b\u3093\u3067\u3059\u3002\n\n\u53d6\u308a\u51fa\u3057\u4f8b\nif(scanRecord.length > 14)\n{\n    if((scanRecord[0] == (byte) 0x02) &&\n       (scanRecord[1] == (byte) 0x01) &&\n       (scanRecord[2] == (byte) 0x06) &&\n       (scanRecord[3] == (byte) 0x03) &&\n       (scanRecord[4] == (byte) 0x03) &&\n       (scanRecord[5] == (byte) 0xaa) &&\n       (scanRecord[6] == (byte) 0xfe) &&\n       (scanRecord[8] == (byte) 0x16) &&\n       (scanRecord[9] == (byte) 0xaa) &&\n       (scanRecord[10] == (byte) 0xfe))\n    {\n        switch(scanRecord[11])\n        {\n            case 0x0:\n                Log.d(TAG,\"Eddystone-UID\");\n                Log.d(TAG,\"Ranging Data=\" + IntToHex2(scanRecord[12]));\n\n                String namespace =\n                                    IntToHex2(scanRecord[13]) +\n                                    IntToHex2(scanRecord[14]) +\n                                    IntToHex2(scanRecord[15]) +\n                                    IntToHex2(scanRecord[16]) +\n                                    IntToHex2(scanRecord[17]) +\n                                    IntToHex2(scanRecord[18]) +\n                                    IntToHex2(scanRecord[19]) +\n                                    IntToHex2(scanRecord[20]) +\n                                    IntToHex2(scanRecord[21]) +\n                                    IntToHex2(scanRecord[22]);\n\n                String uid =\n                                    IntToHex2(scanRecord[23]) +\n                                    IntToHex2(scanRecord[24]) +\n                                    IntToHex2(scanRecord[25]) +\n                                    IntToHex2(scanRecord[26]) +\n                                    IntToHex2(scanRecord[27]) +\n                                    IntToHex2(scanRecord[28]);\n\n                Log.d(TAG,namespace+uid);\n                break;\n\n            case 0x10:\n                Log.d(TAG,\"Eddystone-URL\");\n                Log.d(TAG,\"TX Power=\" + IntToHex2(scanRecord[12]));\n\n                int len = scanRecord[7] - 6;\n\n                String Scheme = \"\";\n\n                switch(scanRecord[13])\n                {\n                     case 0x0:\n                          Scheme = \"http://www.\";\n                          break;\n\n                     case 0x1:\n                          Scheme = \"https://www.\";\n                          break;\n\n                     case 0x2:\n                          Scheme = \"http://\";\n                          break;\n\n                     case 0x3:\n                          Scheme = \"https://\";\n                          break;\n                }\n\n                String url = \"\";\n\n                for(int i = 0 ; i < len ; i++)\n                {\n                    url = url + decodeURL(scanRecord[14 + i]);\n                }\n\n                Log.d(TAG,Scheme + url);\n                break;\n\n           case 0x20:\n                Log.d(TAG,\"Eddystone-TLM\");\n                Log.d(TAG,\"Version=\" + IntToHex2(scanRecord[12]));\n                Log.d(TAG,\"VBATT=\" + IntToHex2(scanRecord[13]) + IntToHex2(scanRecord[14]));\n                Log.d(TAG,\"TEMP=\" + IntToHex2(scanRecord[15]) + IntToHex2(scanRecord[16]));\n                Log.d(TAG,\"ADVCNT=\" + IntToHex2(scanRecord[17]) + IntToHex2(scanRecord[18])+ IntToHex2(scanRecord[19]) + IntToHex2(scanRecord[20]));\n                Log.d(TAG,\"SECCNT=\" + IntToHex2(scanRecord[21]) + IntToHex2(scanRecord[22])+ IntToHex2(scanRecord[23]) + IntToHex2(scanRecord[24]));\n                break;\n          }\n     }\n}\n\nURL\u3092\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u95a2\u6570\u306e\u5b9a\u7fa9\nprivate String decodeURL(int Value)\n    {\n        switch(Value)\n        {\n            case 0:\n                return \".com/\";\n\n            case 1:\n                return \".org/\";\n\n            case 2:\n                return \".edu/\";\n\n            case 3:\n                return \".net/\";\n\n            case 4:\n                return \".info/\";\n\n            case 5:\n                return \".biz/\";\n\n            case 6:\n                return \".gov/\";\n\n            case 7:\n                return \".com\";\n\n            case 8:\n                return \".org\";\n\n            case 9:\n                return \".edu\";\n\n            case 10:\n                return \".net\";\n\n            case 11:\n                return \".info\";\n\n            case 12:\n                return \".biz\";\n\n            case 13:\n                return \".gov\";\n\n        }\n\n        if((Value > 0x20) && (Value < 0x7f))\n        {\n            return String.format(\"%c\",Value);\n        }\n\n        return \"\";\n    }\n\n## Android\u3067Eddystone\u4fe1\u53f7\u3092\u53d7\u4fe1\u3057\u3066\u307f\u3088\u3046\n\nEddystone\u306e\u516c\u5f0fHP\u306e\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306f\u3001Android 5.0\u5411\u3051\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001 4.3,4.4\u306eAPI\u3067\u8a18\u8ff0\u3057\u3066\u307f\u308b\u3002\n\n### Manifest\u30d5\u30a1\u30a4\u30eb\u306b\u7279\u6a29\u306e\u8ffd\u52a0\n\n```xml\n<uses-permission android:name=\"android.permission.BLUETOOTH\"/>\n<uses-permission android:name=\"android.permission.BLUETOOTH_ADMIN\"/>\n```\n\nAndroid Play \u306b\u30a2\u30d7\u30ea\u3092\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u969b\u306f\u3001Bluetooth 4.0 LE\u642d\u8f09\u306e\u6a5f\u7a2e\u3067\u3057\u304b\u52d5\u4f5c\u3067\u304d\u307e\u305b\u3093\u3088\u3068\u3044\u3046\u304a\u307e\u3058\u306a\u3044\u3082\u3001Manifest\u30d5\u30a1\u30a4\u30eb\u306b\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```xml\n<uses-feature android:name=\"android.hardware.bluetooth_le\" android:required=\"true\"/>\n```\n\n### \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u8a18\u8ff0\u7de8\n\n#### Bluetooth Adapter\u306e\u53d6\u5f97\n\n```java\n\nfinal BluetoothManager bluetoothManager =\n        (BluetoothManager) getSystemService(Context.BLUETOOTH_SERVICE);\nmBluetoothAdapter = bluetoothManager.getAdapter();\n\n```\n\n### Bluetooth LE\u30c7\u30d0\u30a4\u30b9\u306e\u691c\u7d22\n\n```java\nmBluetoothAdapter.startLeScan(mLeScanCallback);\n```\n\n\u3092\u547c\u3073\u51fa\u3059\u3068\u3001Bluetooth LE\u30c7\u30d0\u30a4\u30b9\u306e\u63a2\u7d22\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u306e\u4e2d\u8eab\u3067\u3059\u304c\u3001\n\n```java\nprivate BluetoothAdapter.LeScanCallback mLeScanCallback = new BluetoothAdapter.LeScanCallback() {\n    @Override\n    public void onLeScan(final BluetoothDevice device, int rssi,byte[] scanRecord) {\n         // \u30c7\u30d0\u30a4\u30b9\u304c\u691c\u51fa\u3055\u308c\u308b\u5ea6\u306b\u547c\u3073\u51fa\u3055\u308c\u307e\u3059\u3002\n    });\n};\n```\n\n\u5b9f\u306f\u3001\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3060\u3051\u3067\u3001Eddystone\u3092\u691c\u51fa\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3066\u3044\u308b\u3093\u3067\u3059\u3002\n\n####\u53d6\u308a\u51fa\u3057\u4f8b\n\n```java\nif(scanRecord.length > 14)\n{\n    if((scanRecord[0] == (byte) 0x02) &&\n       (scanRecord[1] == (byte) 0x01) &&\n       (scanRecord[2] == (byte) 0x06) &&\n       (scanRecord[3] == (byte) 0x03) &&\n       (scanRecord[4] == (byte) 0x03) &&\n       (scanRecord[5] == (byte) 0xaa) &&\n       (scanRecord[6] == (byte) 0xfe) &&\n       (scanRecord[8] == (byte) 0x16) &&\n       (scanRecord[9] == (byte) 0xaa) &&\n       (scanRecord[10] == (byte) 0xfe))\n    {\n        switch(scanRecord[11])\n        {\n            case 0x0:\n                Log.d(TAG,\"Eddystone-UID\");\n                Log.d(TAG,\"Ranging Data=\" + IntToHex2(scanRecord[12]));\n\n                String namespace =\n                                    IntToHex2(scanRecord[13]) +\n                                    IntToHex2(scanRecord[14]) +\n                                    IntToHex2(scanRecord[15]) +\n                                    IntToHex2(scanRecord[16]) +\n                                    IntToHex2(scanRecord[17]) +\n                                    IntToHex2(scanRecord[18]) +\n                                    IntToHex2(scanRecord[19]) +\n                                    IntToHex2(scanRecord[20]) +\n                                    IntToHex2(scanRecord[21]) +\n                                    IntToHex2(scanRecord[22]);\n\n                String uid =\n                                    IntToHex2(scanRecord[23]) +\n                                    IntToHex2(scanRecord[24]) +\n                                    IntToHex2(scanRecord[25]) +\n                                    IntToHex2(scanRecord[26]) +\n                                    IntToHex2(scanRecord[27]) +\n                                    IntToHex2(scanRecord[28]);\n                \n                Log.d(TAG,namespace+uid);\n                break;\n\n            case 0x10:\n                Log.d(TAG,\"Eddystone-URL\");\n                Log.d(TAG,\"TX Power=\" + IntToHex2(scanRecord[12]));\n\n                int len = scanRecord[7] - 6;\n\n                String Scheme = \"\";\n\n                switch(scanRecord[13])\n                {\n                     case 0x0:\n                          Scheme = \"http://www.\";\n                          break;\n\n                     case 0x1:\n                          Scheme = \"https://www.\";\n                          break;\n\n                     case 0x2:\n                          Scheme = \"http://\";\n                          break;\n\n                     case 0x3:\n                          Scheme = \"https://\";\n                          break;\n                }\n\n                String url = \"\";\n\n                for(int i = 0 ; i < len ; i++)\n                {\n                    url = url + decodeURL(scanRecord[14 + i]);\n                }\n\n                Log.d(TAG,Scheme + url);\n                break;\n\n           case 0x20:\n                Log.d(TAG,\"Eddystone-TLM\");\n                Log.d(TAG,\"Version=\" + IntToHex2(scanRecord[12]));\n                Log.d(TAG,\"VBATT=\" + IntToHex2(scanRecord[13]) + IntToHex2(scanRecord[14]));\n                Log.d(TAG,\"TEMP=\" + IntToHex2(scanRecord[15]) + IntToHex2(scanRecord[16]));\n                Log.d(TAG,\"ADVCNT=\" + IntToHex2(scanRecord[17]) + IntToHex2(scanRecord[18])+ IntToHex2(scanRecord[19]) + IntToHex2(scanRecord[20]));\n                Log.d(TAG,\"SECCNT=\" + IntToHex2(scanRecord[21]) + IntToHex2(scanRecord[22])+ IntToHex2(scanRecord[23]) + IntToHex2(scanRecord[24]));\n                break;\n          }\n     }\n}\n```\n\nURL\u3092\u30c7\u30b3\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u95a2\u6570\u306e\u5b9a\u7fa9\n\n```java\nprivate String decodeURL(int Value)\n    {\n        switch(Value)\n        {\n            case 0:\n                return \".com/\";\n\n            case 1:\n                return \".org/\";\n\n            case 2:\n                return \".edu/\";\n\n            case 3:\n                return \".net/\";\n\n            case 4:\n                return \".info/\";\n\n            case 5:\n                return \".biz/\";\n\n            case 6:\n                return \".gov/\";\n\n            case 7:\n                return \".com\";\n\n            case 8:\n                return \".org\";\n\n            case 9:\n                return \".edu\";\n\n            case 10:\n                return \".net\";\n\n            case 11:\n                return \".info\";\n\n            case 12:\n                return \".biz\";\n\n            case 13:\n                return \".gov\";\n\n        }\n\n        if((Value > 0x20) && (Value < 0x7f))\n        {\n            return String.format(\"%c\",Value);\n        }\n\n        return \"\";\n    }\n```\n", "tags": ["Java", "Android", "bluetooth", "eddystone"]}