{"tags": ["GoogleCloudPlatform"], "context": "Public IP\u3067\u306e\u901a\u4fe1\u3067\u306f\u306a\u304f\u3001Private IP\u30a2\u30c9\u30ec\u30b9\u306b\u3088\u308b\u901a\u4fe1\u304c\u53ef\u80fd\u306b\u3002\nPrivate IP\u306b\u3088\u308b\u901a\u4fe1\u304c\u53ef\u80fd\u306b\u306a\u3063\u305f\u306e\u306f\u3001\u4ee5\u4e0b5\u30b5\u30fc\u30d3\u30b9\n\nGoogle Cloud Storage\nGoogle Cloud Bigtable\nGoogle Cloud BigQuery\nGoogle Cloud Dataproc\nGoogle Cloud Pub/Sub\n\n\u8a73\u3057\u304f\u306f\u3001Configuring Private Google Access\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttps://cloud.google.com/compute/docs/configure-private-google-access\n\nPrivate Google Access\u6709\u52b9\u5316\nPrivate\u901a\u4fe1\u3092\u30b5\u30d6\u30cd\u30c3\u30c8\u5358\u4f4d\u3067\u6709\u52b9\u5316\u304c\u3067\u304d\u307e\u3059\u3002\ngcloud beta compute networks subnets update  prod-asia --enable-private-ip-google-access --region asia-east1\n\n\u672c\u5f53\u306bPrivate IP\u3067\u901a\u4fe1\u3057\u3066\u3044\u308b\u304b\u3001GCS\u306e\u30ed\u30b0\u6a5f\u80fd\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nGCS\u30ed\u30b0\u6709\u52b9\u5316\ngsutil logging set on -b gs://xxxxx-audit -o GCSlogs gs://xxxxx-auto\n\n\u30ed\u30b0\u4fdd\u5b58\u30d0\u30b1\u30c3\u30c8\u306b\u3001cloud-storage-analytics@google.com\u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u4ed8\u4e0e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3068\u306e\u3053\u3068\ngsutil acl ch -g cloud-storage-analytics@google.com:W gs://xxxxx-audit\n\n\u30ed\u30b0\u8a18\u9332\u304c\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306b\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n$ gsutil logging get gs://xxxxx-auto\n{\"logBucket\": \"xxxxx-audit\", \"logObjectPrefix\": \"GCSlogs\"}\n\n\nPrivate Google Access\u304c\u6709\u52b9\u304b\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\n\nConsole\n\n\ngcloud CLI\n$ gcloud beta compute networks subnets describe prod-asia\nprivateIpGoogleAccess: true\n\n\n\u6ce8\u610f\u4e8b\u9805\nPublic IP\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u3001public IP\u7d4c\u7531\u3067\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\nPrivate Google Access\u306e\u5fc5\u8981\u6761\u4ef6\u3068\u3057\u3066\u3001\u4e0b\u8a18\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\nCreate any instances that will use this feature without public IP addresses.\uff08public IP\u306a\u3057\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff09\n\n\nGCS\u30ed\u30b0\n\nnon-Public IP\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\"1489312847508000\",\"fda3:e722:ac3:10:11:a83a:a28:a03\",\"2\",\"\",\"POST\",\"/storage/v1/b/cms-stg-deploy/o?fields=generation,customerEncryption,md5Hash,crc32c,etag,size&alt=json&uploadType=multipart\",\"200\",\"0\",\"0\",\"24000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.22 Python/2.7.9 (linux2) google-cloud-sdk/146.0.0 analytics/disabled,gzip(gfe)\",\"fec5c114eed3f1943651ba04a754d098\",\"storage.objects.insert\",\"cms-stg-deploy\",\"aaa.txt\"\n\n\npublic IP\u4ed8\u4e0e\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\"1489301540994001\",\"104.199.161.21\",\"1\",\"\",\"GET\",\"/storage/v1/b/cms-prd-auto/o/startup.sh?generation=1481933188333401&alt=media\",\"200\",\"0\",\"0\",\"86000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.15 Python/2.7.6 (linux2) Cloud SDK Command Line Tool 0.9.80\",\"2b85985746e74243a501ba717597e29b\",\"storage.objects.get\",\"cms-prd-auto\",\"startup.sh\"\n\n\n\u30ed\u30fc\u30ab\u30ebPC\n\"1489293107970000\",\"130.211.XXX.XXX\",\"1\",\"\",\"POST\",\"/storage/v1/b/cms-stg-deploy/o?fields=generation,md5Hash,crc32c,etag,size&alt=json&uploadType=multipart\",\"200\",\"0\",\"0\",\"12000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.15 Python/2.7.6 (linux2) Cloud SDK Command Line Tool 0.9.80,gzip(gfe)\",\"114c258925feebd0c77e20dae9cf240c\",\"storage.objects.insert\",\"cms-stg-deploy\",\"test.csv\"\n\nnon Public IP\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3067\u3082\u3001googleapis\u306e\u30c9\u30e1\u30a4\u30f3\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u3092\u8fd4\u3059\u3088\u3046\u3067\u3059\u3002\nNote: The API is resolved to a public destination IP address, but the traffic is all internal and private. Network address translation is in Google's infrastructure and is transparent to the user.\n\u3068\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u901a\u308a\u3001API\u306epublic,non-public IP\u3092\u900f\u904e\u7684\u306b\u30e6\u30fc\u30b6\u304c\u610f\u8b58\u3057\u306a\u3044\u5f62\u3067\u5207\u308a\u5206\u3051\u3066\u3044\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n$ ping  storage.googleapis.com\nPING storage.l.googleusercontent.com (64.233.189.128) 56(84) bytes of data.\n\nPublic IP\u3067\u306e\u901a\u4fe1\u3067\u306f\u306a\u304f\u3001Private IP\u30a2\u30c9\u30ec\u30b9\u306b\u3088\u308b\u901a\u4fe1\u304c\u53ef\u80fd\u306b\u3002\nPrivate IP\u306b\u3088\u308b\u901a\u4fe1\u304c\u53ef\u80fd\u306b\u306a\u3063\u305f\u306e\u306f\u3001\u4ee5\u4e0b5\u30b5\u30fc\u30d3\u30b9\n\n- Google Cloud Storage\n- Google Cloud Bigtable\n- Google Cloud BigQuery\n- Google Cloud Dataproc\n- Google Cloud Pub/Sub\n\n\n\u8a73\u3057\u304f\u306f\u3001Configuring Private Google Access\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n[https://cloud.google.com/compute/docs/configure-private-google-access](https://cloud.google.com/compute/docs/configure-private-google-access)\n\n# Private Google Access\u6709\u52b9\u5316\n\nPrivate\u901a\u4fe1\u3092\u30b5\u30d6\u30cd\u30c3\u30c8\u5358\u4f4d\u3067\u6709\u52b9\u5316\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\ngcloud beta compute networks subnets update  prod-asia --enable-private-ip-google-access --region asia-east1\n```\n\n\u672c\u5f53\u306bPrivate IP\u3067\u901a\u4fe1\u3057\u3066\u3044\u308b\u304b\u3001GCS\u306e\u30ed\u30b0\u6a5f\u80fd\u3067\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n# GCS\u30ed\u30b0\u6709\u52b9\u5316\n\n```\ngsutil logging set on -b gs://xxxxx-audit -o GCSlogs gs://xxxxx-auto\n```\n\n\u30ed\u30b0\u4fdd\u5b58\u30d0\u30b1\u30c3\u30c8\u306b\u3001cloud-storage-analytics@google.com\u3078\u306e\u66f8\u304d\u8fbc\u307f\u6a29\u9650\u4ed8\u4e0e\u8a2d\u5b9a\u304c\u5fc5\u8981\u3068\u306e\u3053\u3068\n\n```\ngsutil acl ch -g cloud-storage-analytics@google.com:W gs://xxxxx-audit\n```\n\n\u30ed\u30b0\u8a18\u9332\u304c\u6709\u52b9\u5316\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4ee5\u4e0b\u306b\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\n```\n$ gsutil logging get gs://xxxxx-auto\n{\"logBucket\": \"xxxxx-audit\", \"logObjectPrefix\": \"GCSlogs\"}\n```\n\n# Private Google Access\u304c\u6709\u52b9\u304b\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\n\n## Console\n\n![\u30ad\u30e3\u30d7\u30c1\u30e3.PNG](https://qiita-image-store.s3.amazonaws.com/0/32140/129ef520-0652-94d0-8445-c50107d8378b.png)\n\n## gcloud CLI\n\n```\n$ gcloud beta compute networks subnets describe prod-asia\nprivateIpGoogleAccess: true\n```\n\n# \u6ce8\u610f\u4e8b\u9805\nPublic IP\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u306f\u3001public IP\u7d4c\u7531\u3067\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\nPrivate Google Access\u306e\u5fc5\u8981\u6761\u4ef6\u3068\u3057\u3066\u3001\u4e0b\u8a18\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n- Create any instances that will use this feature without public IP addresses.\uff08public IP\u306a\u3057\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\uff09\n\n\n# GCS\u30ed\u30b0\n\n## non-Public IP\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n```\n\"1489312847508000\",\"fda3:e722:ac3:10:11:a83a:a28:a03\",\"2\",\"\",\"POST\",\"/storage/v1/b/cms-stg-deploy/o?fields=generation,customerEncryption,md5Hash,crc32c,etag,size&alt=json&uploadType=multipart\",\"200\",\"0\",\"0\",\"24000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.22 Python/2.7.9 (linux2) google-cloud-sdk/146.0.0 analytics/disabled,gzip(gfe)\",\"fec5c114eed3f1943651ba04a754d098\",\"storage.objects.insert\",\"cms-stg-deploy\",\"aaa.txt\"\n```\n\n## public IP\u4ed8\u4e0e\u3055\u308c\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\n\n```\n\"1489301540994001\",\"104.199.161.21\",\"1\",\"\",\"GET\",\"/storage/v1/b/cms-prd-auto/o/startup.sh?generation=1481933188333401&alt=media\",\"200\",\"0\",\"0\",\"86000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.15 Python/2.7.6 (linux2) Cloud SDK Command Line Tool 0.9.80\",\"2b85985746e74243a501ba717597e29b\",\"storage.objects.get\",\"cms-prd-auto\",\"startup.sh\"\n```\n\n## \u30ed\u30fc\u30ab\u30ebPC\n\n```\n\"1489293107970000\",\"130.211.XXX.XXX\",\"1\",\"\",\"POST\",\"/storage/v1/b/cms-stg-deploy/o?fields=generation,md5Hash,crc32c,etag,size&alt=json&uploadType=multipart\",\"200\",\"0\",\"0\",\"12000\",\"www.googleapis.com\",\"\",\"apitools gsutil/4.15 Python/2.7.6 (linux2) Cloud SDK Command Line Tool 0.9.80,gzip(gfe)\",\"114c258925feebd0c77e20dae9cf240c\",\"storage.objects.insert\",\"cms-stg-deploy\",\"test.csv\"\n```\n\nnon Public IP\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089\u3067\u3082\u3001googleapis\u306e\u30c9\u30e1\u30a4\u30f3\u306f\u30b0\u30ed\u30fc\u30d0\u30eb\u3092\u8fd4\u3059\u3088\u3046\u3067\u3059\u3002\n\nNote: The API is resolved to a public destination IP address, but the traffic is all internal and private. Network address translation is in Google's infrastructure and is transparent to the user.\n\n\u3068\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u66f8\u304b\u308c\u3066\u3044\u308b\u901a\u308a\u3001API\u306epublic,non-public IP\u3092\u900f\u904e\u7684\u306b\u30e6\u30fc\u30b6\u304c\u610f\u8b58\u3057\u306a\u3044\u5f62\u3067\u5207\u308a\u5206\u3051\u3066\u3044\u308b\u3068\u601d\u308f\u308c\u307e\u3059\u3002\n\n```\n$ ping  storage.googleapis.com\nPING storage.l.googleusercontent.com (64.233.189.128) 56(84) bytes of data.\n```\n\n"}