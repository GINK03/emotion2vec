{"context": " More than 1 year has passed since last update.\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Directory Service\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30e6\u30fc\u30b6\u3067Management Console\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306e\u4f5c\u696d\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001AD-Connector\u306f\u5bfe\u8c61\u5916\u3068\u3057\u307e\u3059\u3002\n\u4e00\u90e8\u306e\u64cd\u4f5c\u306fManagement Console\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\nMac\u3092\u304a\u4f7f\u3044\u306e\u65b9\u306f\u3001Windows Server\u3067\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u63a5\u7d9a\u304c\u51fa\u6765\u308b\u30a2\u30d7\u30ea\u3092\u3054\u7528\u610f\u304f\u3060\u3055\u3044\u3002\nWindows Server\u3092\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3055\u305b\u308b\u305f\u3081\u3001SSM\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002SSM\u304c\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u306e\u624b\u9806\u3067\u306f\u30aa\u30ec\u30b4\u30f3\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n\n\u524d\u63d0\u6761\u4ef6\n\n\n\u3053\u306e\u624b\u9806\u306f\u3001\u5168\u90e8\u30675\u3064\u306e\u6295\u7a3f\u304b\u3089\u69cb\u6210\u3055\u308c\u3066\u304a\u308a\u3001\u672c\u6295\u7a3f\u306f\u4ee5\u4e0b\u306e\u6295\u7a3f\u306e\u5185\u5bb9\u3092\u5b9f\u65bd\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\u9014\u4e2d\u304b\u3089\u5b9f\u65bd\u3057\u305f\u5834\u5408\u3001\u5909\u6570\u304c\u7a7a\u6b04\u306e\u305f\u3081\u306b\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306b\u5931\u6557\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n[JAWS-UG CLI]Directory Service:#32-1 VPC\u304a\u3088\u3073\u30e6\u30fc\u30b6\u7ba1\u7406\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210\n[JAWS-UG CLI]Directory Service:#32-2 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\uff08Simple-AD\uff09\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97\n\n\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306f\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c\naws-cli/1.9.5 Python/2.7.10 Linux/4.1.10-17.31.amzn1.x86_64 botocore/1.3.5\n\n\n\n\u5fc5\u8981\u306a\u6a29\u9650\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nEC2\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nDirectory Service\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nIAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\nSSM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n\n0. \u6e96\u5099\n\n\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='us-west-2'\n\n\n\n\u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************PZ4A         iam-role\nsecret_key     ****************AZ55         iam-role\n    region                us-west-2              env    AWS_DEFAULT_REGION\n\n\n\n\u5909\u6570\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    DS_ID: \"${DS_ID}\"\n    Domain Name: ${DS_NAME}\n    Name Server 1: ${DNS_IP1}\n    Name Server 2: ${DNS_IP2}\n\nETX\n\n\n\n\u7d50\u679c\n    DS_ID: \"ds-**********\"\n    Domain Name: jawsug.local\n    Name Server 1: 10.0.0.10\n    Name Server 2: 10.0.1.211\n\n\n\n1. \u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\nWindows Server\u3092Directory Service\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\u3055\u305b\u307e\u3059\u3002\n\nDocument\u306e\u5b9a\u7fa9\n\n\u30b3\u30de\u30f3\u30c9\nSSM_DOCUMENT_FILE='ssm_document.json'\n\ncat << EOF > ${SSM_DOCUMENT_FILE}\n{\n    \"schemaVersion\": \"1.0\",\n    \"description\": \"Sample configuration to join an instance to a domain\",\n    \"runtimeConfig\": {\n        \"aws:domainJoin\": {\n            \"properties\": {\n                \"directoryId\": \"${DS_ID}\",\n                \"directoryName\": \"${DS_NAME}\",\n                \"dnsIpAddresses\": [\n                    \"${DNS_IP1}\",\n                    \"${DNS_IP2}\"\n                ]\n            }\n        }\n    }\n}\nEOF\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u8a3c\n\n\u30b3\u30de\u30f3\u30c9\njsonlint -q ${SSM_DOCUMENT_FILE}\n\n\n\nDocument\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat ${SSM_DOCUMENT_FILE}\n\n\n\n\u7d50\u679c\n{\n    \"schemaVersion\": \"1.0\",\n    \"description\": \"Sample configuration to join an instance to a domain\",\n    \"runtimeConfig\": {\n        \"aws:domainJoin\": {\n            \"properties\": {\n                \"directoryId\": \"d-**********\",\n                \"directoryName\": \"jawsug.local\",\n                \"directoryOU\": \"OU=Computers,DC=jawsug,DC=local\",\n                \"dnsIpAddresses\": [\n                    \"10.0.0.10\",\n                    \"10.0.1.211\"\n                ]\n            }\n        }\n    }\n}\n\n\n\n\u540c\u540d\u306eDocument\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nDOC_NAME='DomainJoin'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ssm get-document --name ${DOC_NAME}\n\n\n\n\u7d50\u679c\nA client error (InvalidDocument) occurred when calling the GetDocument operation: None\n\n\n\nDocument\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\naws ssm create-document --content file://${SSM_DOCUMENT_FILE} --name ${DOC_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"DocumentDescription\": {\n        \"Status\": \"Creating\",\n        \"Sha1\": \"****************************************\",\n        \"Description\": \"Sample configuration to join an instance to a domain\",\n        \"PlatformTypes\": [\n            \"Windows\"\n        ],\n        \"CreatedDate\": 1446988830.672,\n        \"Name\": \"DomainJoin\"\n    }\n}\n\n\n\u78ba\u8a8d\n\uff08EC2Run Command\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u65e2\u5b9a\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u5897\u3048\u305f\u3082\u3088\u3046\u3002\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ssm list-documents\n\n\n\n\u7d50\u679c\n{\n    \"DocumentIdentifiers\": [\n        {\n            \"Name\": \"DomainJoin\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-ConfigureCloudWatch\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-ConfigureWindowsUpdate\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-InstallApplication\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-InstallPowerShellModule\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-JoinDirectoryServiceDomain\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-RunPowerShellScript\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-UpdateEC2Config\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        }\n    ]\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ssm get-document --name ${DOC_NAME}\n\n\n\n\u7d50\u679c\n{\n    \"Content\": \"{\\n    \\\"schemaVersion\\\": \\\"1.0\\\",\\n    \\\"description\\\": \\\"Sample configuration to join an instance to a domain\\\",\\n    \\\"runtimeConfig\\\": {\\n        \\\"aws:domainJoin\\\": {\\n            \\\"properties\\\": {\\n                \\\"directoryId\\\": \\\"d-926738edc0\\\",\\n                \\\"directoryName\\\": \\\"jawsug.local\\\",\\n                \\\"dnsIpAddresses\\\": [\\n                    \\\"10.0.0.192\\\",\\n                    \\\"10.0.1.227\\\"\\n                ]\\n            }\\n        }\\n    }\\n}\\n\",\n    \"Name\": \"DomainJoin\"\n}\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   DOC_NAME: ${DOC_NAME}\n   INSTANCE_ID: ${INSTANCE_ID}\n\nETX\n\n\n\n\u7d50\u679c\n   DOC_NAME: DomainJoin\n   INSTANCE_ID: i-********\n\n\n\n\u30b5\u30fc\u30d0\u3078\u306e\u95a2\u9023\u3065\u3051\n\n\u30b3\u30de\u30f3\u30c9\naws ssm create-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n\n\n\n\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1445770208.736,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1445770208.736,\n            \"Message\": \"Associated with DomainJoin\",\n            \"Name\": \"Associated\"\n        }\n    }\n}\n\n\n\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ssm list-associations --association-filter-list key=InstanceId,value=${INSTANCE_ID}\n\n\n\n\u7d50\u679c\n{\n    \"Associations\": [\n        {\n            \"InstanceId\": \"i-********\",\n            \"Name\": \"DomainJoin\"\n        }\n    ]\n}\n\n\n\n\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u305d\u306e\u305f\u3081\u3001\u3053\u3053\u3067\u5c11\u3057\u4f11\u61a9\u3057\u307e\u3059\u3002\uff09\n\u30c9\u30e1\u30a4\u30f3\u306e\u53c2\u52a0\u304c\u3069\u3046\u3057\u3066\u3082\u6210\u529f\u3057\u306a\u3044\u5834\u5408\u3001aws ec2 get-password-data\u3067\u53d6\u5f97\u3057\u305f\u30ed\u30fc\u30ab\u30eb\u7ba1\u7406\u8005\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u624b\u52d5\u3067\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\uff08\u624b\u9806\u306f\u5f53\u65e5\u306b\u753b\u9762\u3067\u3054\u6848\u5185\u3057\u307e\u3059\u3002\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ssm describe-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n\n\n\n\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1446441382.794,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1446441751.32,\n            \"AdditionalInfo\": \"{\\\"lang\\\":\\\"en-US\\\",\\\"name\\\":\\\"EC2Config\\\",\\\"os\\\":\\\"Windows Server 2012 Standard\\\",\\\"osver\\\":\\\"6.2.9200\\\",\\\"ver\\\":\\\"3.10.442\\\"}\",\n            \"Message\": \"status:Passed, code:0, message:RuntimeStatusCounts=[Passed=1], RuntimeStatus=[aws:domainJoin={Passed}]\",\n            \"Name\": \"Success\"\n        }\n    }\n}\n\n\n\uff08\u4ee5\u4e0b\u3001\u5931\u6557\u4f8b\uff09\n\n\u30b3\u30de\u30f3\u30c9\naws ssm describe-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n\n\n\n\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1445788509.45,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1445788629.156,\n            \"AdditionalInfo\": \"{\\\"lang\\\":\\\"en-US\\\",\\\"name\\\":\\\"EC2Config\\\",\\\"os\\\":\\\"Windows Server 2012 Standard\\\",\\\"osver\\\":\\\"6.2.9200\\\",\\\"ver\\\":\\\"3.10.442\\\"}\",\n            \"Message\": \"status:Failed, code:0, message:RuntimeStatusCounts=[Failed=1], RuntimeStatus=[aws:domainJoin={Failed,Could not create computer. RequestId: 0b679615-7b31-11e5-aa94-d38a3e9e11cc : RequestId: 0b679615-7b31-11e5-aa94-d38a3e9e11cc}]\",\n            \"Name\": \"Failed\"\n        }\n    }\n}\n\n\n\n2. \u30c9\u30e1\u30a4\u30f3\u7ba1\u7406\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nMac\u3092\u3054\u5229\u7528\u306e\u65b9\u306f\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304c\u51fa\u6765\u308b\u74b0\u5883\u3092\u6e96\u5099\u3057\u307e\u3059\nhttps://itunes.apple.com/jp/app/microsoft-remote-desktop/id715768417?mt=12\n\n\u30ed\u30b0\u30a4\u30f3\n\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u63a5\u7d9a\u3092\u884c\u3046\u30c4\u30fc\u30eb\u3067\u30c9\u30e1\u30a4\u30f3\u306e\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\uff08\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\uff09\nIP\u30a2\u30c9\u30ec\u30b9\u306f\u3053\u3061\u3089\u3067\u78ba\u8a8d\nhttp://qiita.com/domokun70cm/items/38ffd040b805e2928d62#%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AFip%E3%82%92%E7%A2%BA%E8%AA%8D\n\n\n\nAccount\nPassword\n\n\n\n\njawsug.local\\administrator\n********\n\n\n\n\nActive Directory\u306e\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nPowerShell\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304d\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u8d77\u52d5\n\n\n\u30b3\u30de\u30f3\u30c9\nImport-Module ServerManager\nAdd-WindowsFeature RSAT-AD-PowerShell,RSAT-AD-AdminCenter\n\n\n\n\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u8d77\u52d5\n\n\u30b3\u30de\u30f3\u30c9\nC:\\Windows\\system32\\dsa.msc /s\n\n\n\n3. \u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n\n\n\n\u88dc\u8db3\nLinux\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3055\u305b\u308b\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://docs.aws.amazon.com/directoryservice/latest/simple-ad/join_linux_instance.html\n# \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306b\u3064\u3044\u3066\n\n- \u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Directory Service\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30e6\u30fc\u30b6\u3067Management Console\u306b\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u307e\u3067\u306e\u4f5c\u696d\u3092\u5b9f\u65bd\u3057\u307e\u3059\u3002\n- \u4eca\u56de\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001AD-Connector\u306f\u5bfe\u8c61\u5916\u3068\u3057\u307e\u3059\u3002\n- \u4e00\u90e8\u306e\u64cd\u4f5c\u306fManagement Console\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\n- Mac\u3092\u304a\u4f7f\u3044\u306e\u65b9\u306f\u3001Windows Server\u3067\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u63a5\u7d9a\u304c\u51fa\u6765\u308b\u30a2\u30d7\u30ea\u3092\u3054\u7528\u610f\u304f\u3060\u3055\u3044\u3002\n- Windows Server\u3092\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3055\u305b\u308b\u305f\u3081\u3001SSM\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002SSM\u304c\u5229\u7528\u53ef\u80fd\u306a\u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u306e\u624b\u9806\u3067\u306f\u30aa\u30ec\u30b4\u30f3\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n# \u524d\u63d0\u6761\u4ef6\n\n- \u3053\u306e\u624b\u9806\u306f\u3001\u5168\u90e8\u30675\u3064\u306e\u6295\u7a3f\u304b\u3089\u69cb\u6210\u3055\u308c\u3066\u304a\u308a\u3001\u672c\u6295\u7a3f\u306f\u4ee5\u4e0b\u306e\u6295\u7a3f\u306e\u5185\u5bb9\u3092\u5b9f\u65bd\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\u9014\u4e2d\u304b\u3089\u5b9f\u65bd\u3057\u305f\u5834\u5408\u3001\u5909\u6570\u304c\u7a7a\u6b04\u306e\u305f\u3081\u306b\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u306b\u5931\u6557\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\n  - [[JAWS-UG CLI]Directory Service:#32-1 VPC\u304a\u3088\u3073\u30e6\u30fc\u30b6\u7ba1\u7406\u7528\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4f5c\u6210](http://qiita.com/domokun70cm/items/38ffd040b805e2928d62)\n  - [[JAWS-UG CLI]Directory Service:#32-2 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\uff08Simple-AD\uff09\u3001\u30b9\u30ca\u30c3\u30d7\u30b7\u30e7\u30c3\u30c8\u306e\u53d6\u5f97](http://qiita.com/domokun70cm/items/5de88fa85c6099f9621e)\n\n## \u30d0\u30fc\u30b8\u30e7\u30f3\u78ba\u8a8d\n\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u306f\u4ee5\u4e0b\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u52d5\u4f5c\u78ba\u8a8d\u3092\u884c\u3044\u307e\u3057\u305f\u3002\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```text:\u7d50\u679c\naws-cli/1.9.5 Python/2.7.10 Linux/4.1.10-17.31.amzn1.x86_64 botocore/1.3.5\n```\n\n## \u5fc5\u8981\u306a\u6a29\u9650\n\n\u4f5c\u696d\u306b\u3042\u305f\u3063\u3066\u306f\u3001\u4ee5\u4e0b\u306e\u6a29\u9650\u3092\u6709\u3057\u305fIAM\u30e6\u30fc\u30b6\u3082\u3057\u304f\u306fIAM\u30ed\u30fc\u30eb\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- EC2\u306b\u5bfe\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- Directory Service\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- IAM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n- SSM\u306b\u95a2\u3059\u308b\u30d5\u30eb\u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u6a29\u9650\n\n# 0. \u6e96\u5099\n\n## \u30ea\u30fc\u30b8\u30e7\u30f3\u3092\u6307\u5b9a\n\n```bash:\u30b3\u30de\u30f3\u30c9\nexport AWS_DEFAULT_REGION='us-west-2'\n```\n\n## \u8cc7\u683c\u60c5\u5831\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```text:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************PZ4A         iam-role\nsecret_key     ****************AZ55         iam-role\n    region                us-west-2              env    AWS_DEFAULT_REGION\n```\n\n## \u5909\u6570\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n    DS_ID: \"${DS_ID}\"\n    Domain Name: ${DS_NAME}\n    Name Server 1: ${DNS_IP1}\n    Name Server 2: ${DNS_IP2}\n\nETX\n```\n\n```text:\u7d50\u679c\n    DS_ID: \"ds-**********\"\n    Domain Name: jawsug.local\n    Name Server 1: 10.0.0.10\n    Name Server 2: 10.0.1.211\n```\n\n# 1. \u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\n\nWindows Server\u3092Directory Service\u3067\u4f5c\u6210\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\u3055\u305b\u307e\u3059\u3002\n\n## Document\u306e\u5b9a\u7fa9\n\n```bash:\u30b3\u30de\u30f3\u30c9\nSSM_DOCUMENT_FILE='ssm_document.json'\n\ncat << EOF > ${SSM_DOCUMENT_FILE}\n{\n    \"schemaVersion\": \"1.0\",\n    \"description\": \"Sample configuration to join an instance to a domain\",\n    \"runtimeConfig\": {\n        \"aws:domainJoin\": {\n            \"properties\": {\n                \"directoryId\": \"${DS_ID}\",\n                \"directoryName\": \"${DS_NAME}\",\n                \"dnsIpAddresses\": [\n                    \"${DNS_IP1}\",\n                    \"${DNS_IP2}\"\n                ]\n            }\n        }\n    }\n}\nEOF\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u8a3c\n\n```bash:\u30b3\u30de\u30f3\u30c9\njsonlint -q ${SSM_DOCUMENT_FILE}\n```\n\n## Document\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat ${SSM_DOCUMENT_FILE}\n```\n\n```json:\u7d50\u679c\n{\n    \"schemaVersion\": \"1.0\",\n    \"description\": \"Sample configuration to join an instance to a domain\",\n    \"runtimeConfig\": {\n        \"aws:domainJoin\": {\n            \"properties\": {\n                \"directoryId\": \"d-**********\",\n                \"directoryName\": \"jawsug.local\",\n                \"directoryOU\": \"OU=Computers,DC=jawsug,DC=local\",\n                \"dnsIpAddresses\": [\n                    \"10.0.0.10\",\n                    \"10.0.1.211\"\n                ]\n            }\n        }\n    }\n}\n```\n\n## \u540c\u540d\u306eDocument\u304c\u5b58\u5728\u3057\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\nDOC_NAME='DomainJoin'\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm get-document --name ${DOC_NAME}\n```\n\n```text:\u7d50\u679c\nA client error (InvalidDocument) occurred when calling the GetDocument operation: None\n```\n\n## Document\u306e\u4f5c\u6210\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm create-document --content file://${SSM_DOCUMENT_FILE} --name ${DOC_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"DocumentDescription\": {\n        \"Status\": \"Creating\",\n        \"Sha1\": \"****************************************\",\n        \"Description\": \"Sample configuration to join an instance to a domain\",\n        \"PlatformTypes\": [\n            \"Windows\"\n        ],\n        \"CreatedDate\": 1446988830.672,\n        \"Name\": \"DomainJoin\"\n    }\n}\n```\n\n\u78ba\u8a8d\n\n\uff08EC2Run Command\u306e\u30ea\u30ea\u30fc\u30b9\u3067\u65e2\u5b9a\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u5897\u3048\u305f\u3082\u3088\u3046\u3002\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm list-documents\n```\n\n```json:\u7d50\u679c\n{\n    \"DocumentIdentifiers\": [\n        {\n            \"Name\": \"DomainJoin\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-ConfigureCloudWatch\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-ConfigureWindowsUpdate\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-InstallApplication\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-InstallPowerShellModule\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-JoinDirectoryServiceDomain\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-RunPowerShellScript\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        },\n        {\n            \"Name\": \"AWS-UpdateEC2Config\",\n            \"PlatformTypes\": [\n                \"Windows\"\n            ]\n        }\n    ]\n}\n```\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm get-document --name ${DOC_NAME}\n```\n\n```json:\u7d50\u679c\n{\n    \"Content\": \"{\\n    \\\"schemaVersion\\\": \\\"1.0\\\",\\n    \\\"description\\\": \\\"Sample configuration to join an instance to a domain\\\",\\n    \\\"runtimeConfig\\\": {\\n        \\\"aws:domainJoin\\\": {\\n            \\\"properties\\\": {\\n                \\\"directoryId\\\": \\\"d-926738edc0\\\",\\n                \\\"directoryName\\\": \\\"jawsug.local\\\",\\n                \\\"dnsIpAddresses\\\": [\\n                    \\\"10.0.0.192\\\",\\n                    \\\"10.0.1.227\\\"\\n                ]\\n            }\\n        }\\n    }\\n}\\n\",\n    \"Name\": \"DomainJoin\"\n}\n```\n\n## \u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n   DOC_NAME: ${DOC_NAME}\n   INSTANCE_ID: ${INSTANCE_ID}\n\nETX\n```\n\n```text:\u7d50\u679c\n   DOC_NAME: DomainJoin\n   INSTANCE_ID: i-********\n```\n\n## \u30b5\u30fc\u30d0\u3078\u306e\u95a2\u9023\u3065\u3051\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm create-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1445770208.736,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1445770208.736,\n            \"Message\": \"Associated with DomainJoin\",\n            \"Name\": \"Associated\"\n        }\n    }\n}\n```\n\n\u78ba\u8a8d\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm list-associations --association-filter-list key=InstanceId,value=${INSTANCE_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"Associations\": [\n        {\n            \"InstanceId\": \"i-********\",\n            \"Name\": \"DomainJoin\"\n        }\n    ]\n}\n```\n\n## \u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\n\n\u30c9\u30e1\u30a4\u30f3\u53c2\u52a0\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\n\uff08\u305d\u306e\u305f\u3081\u3001\u3053\u3053\u3067\u5c11\u3057\u4f11\u61a9\u3057\u307e\u3059\u3002\uff09\n\u30c9\u30e1\u30a4\u30f3\u306e\u53c2\u52a0\u304c\u3069\u3046\u3057\u3066\u3082\u6210\u529f\u3057\u306a\u3044\u5834\u5408\u3001`aws ec2 get-password-data`\u3067\u53d6\u5f97\u3057\u305f\u30ed\u30fc\u30ab\u30eb\u7ba1\u7406\u8005\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u624b\u52d5\u3067\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\uff08\u624b\u9806\u306f\u5f53\u65e5\u306b\u753b\u9762\u3067\u3054\u6848\u5185\u3057\u307e\u3059\u3002\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm describe-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1446441382.794,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1446441751.32,\n            \"AdditionalInfo\": \"{\\\"lang\\\":\\\"en-US\\\",\\\"name\\\":\\\"EC2Config\\\",\\\"os\\\":\\\"Windows Server 2012 Standard\\\",\\\"osver\\\":\\\"6.2.9200\\\",\\\"ver\\\":\\\"3.10.442\\\"}\",\n            \"Message\": \"status:Passed, code:0, message:RuntimeStatusCounts=[Passed=1], RuntimeStatus=[aws:domainJoin={Passed}]\",\n            \"Name\": \"Success\"\n        }\n    }\n}\n```\n\n\uff08\u4ee5\u4e0b\u3001\u5931\u6557\u4f8b\uff09\n\n```bash:\u30b3\u30de\u30f3\u30c9\naws ssm describe-association --name ${DOC_NAME} --instance-id ${INSTANCE_ID}\n```\n\n```json:\u7d50\u679c\n{\n    \"AssociationDescription\": {\n        \"InstanceId\": \"i-********\",\n        \"Date\": 1445788509.45,\n        \"Name\": \"DomainJoin\",\n        \"Status\": {\n            \"Date\": 1445788629.156,\n            \"AdditionalInfo\": \"{\\\"lang\\\":\\\"en-US\\\",\\\"name\\\":\\\"EC2Config\\\",\\\"os\\\":\\\"Windows Server 2012 Standard\\\",\\\"osver\\\":\\\"6.2.9200\\\",\\\"ver\\\":\\\"3.10.442\\\"}\",\n            \"Message\": \"status:Failed, code:0, message:RuntimeStatusCounts=[Failed=1], RuntimeStatus=[aws:domainJoin={Failed,Could not create computer. RequestId: 0b679615-7b31-11e5-aa94-d38a3e9e11cc : RequestId: 0b679615-7b31-11e5-aa94-d38a3e9e11cc}]\",\n            \"Name\": \"Failed\"\n        }\n    }\n}\n```\n\n# 2. \u30c9\u30e1\u30a4\u30f3\u7ba1\u7406\u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n## \u30c4\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nMac\u3092\u3054\u5229\u7528\u306e\u65b9\u306f\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u304c\u51fa\u6765\u308b\u74b0\u5883\u3092\u6e96\u5099\u3057\u307e\u3059\nhttps://itunes.apple.com/jp/app/microsoft-remote-desktop/id715768417?mt=12\n\n## \u30ed\u30b0\u30a4\u30f3\n\n\u30ea\u30e2\u30fc\u30c8\u30c7\u30b9\u30af\u30c8\u30c3\u30d7\u63a5\u7d9a\u3092\u884c\u3046\u30c4\u30fc\u30eb\u3067\u30c9\u30e1\u30a4\u30f3\u306e\u7ba1\u7406\u8005\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u307e\u3059\u3002\n\uff08\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u306a\u304b\u3063\u305f\u5834\u5408\u306f\u3001\u30ed\u30fc\u30ab\u30eb\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\uff09\n\nIP\u30a2\u30c9\u30ec\u30b9\u306f\u3053\u3061\u3089\u3067\u78ba\u8a8d\nhttp://qiita.com/domokun70cm/items/38ffd040b805e2928d62#%E3%83%91%E3%83%96%E3%83%AA%E3%83%83%E3%82%AFip%E3%82%92%E7%A2%BA%E8%AA%8D\n\n| Account | Password |\n|:-------|:---------|\n| jawsug.local\\administrator | ******** |\n\n## Active Directory\u306e\u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nPowerShell\u306e\u30b3\u30f3\u30bd\u30fc\u30eb\u3092\u958b\u304d\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u8d77\u52d5\n\n![PS.png](https://qiita-image-store.s3.amazonaws.com/0/36230/88981d79-404b-2150-00c6-9ec51ffce12e.png)\n\n\n```ps1:\u30b3\u30de\u30f3\u30c9\nImport-Module ServerManager\nAdd-WindowsFeature RSAT-AD-PowerShell,RSAT-AD-AdminCenter\n```\n\n## \u7ba1\u7406\u30c4\u30fc\u30eb\u3092\u8d77\u52d5\n\n```ps1:\u30b3\u30de\u30f3\u30c9\nC:\\Windows\\system32\\dsa.msc /s\n```\n\n# 3. \u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n![user01.png](https://qiita-image-store.s3.amazonaws.com/0/36230/14e4915c-b60f-aebf-c4a4-9d16c04102ab.png)\n\n![user02.png](https://qiita-image-store.s3.amazonaws.com/0/36230/e02c7af6-ab0a-619b-dde3-98b8b004b496.png)\n\n![user03.png](https://qiita-image-store.s3.amazonaws.com/0/36230/2e18f084-356a-1a91-1d52-d9c6a713168d.png)\n\n\n# \u88dc\u8db3\n\nLinux\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30c9\u30e1\u30a4\u30f3\u306b\u53c2\u52a0\u3055\u305b\u308b\u624b\u9806\u306f\u4ee5\u4e0b\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nhttp://docs.aws.amazon.com/directoryservice/latest/simple-ad/join_linux_instance.html\n", "tags": ["aws-cli"]}