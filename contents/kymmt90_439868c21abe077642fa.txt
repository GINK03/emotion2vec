{"tags": ["Rails", "swagger", "OpenAPI"], "context": "\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Rails \u3067\u66f8\u3044\u305f JSON API \u30b5\u30fc\u30d0\u305d\u308c\u81ea\u4f53\u306e API \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4ed5\u69d8\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092 OpenAPI \u5f62\u5f0f\u306e JSON \u30c7\u30fc\u30bf\u3068\u3057\u3066\u751f\u6210\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092 API \u81ea\u4f53\u304b\u3089\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\u3064\u307e\u308a\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\nGET /api-docs.json\n\n\u3092\u53e9\u304f\u3068\u3001\u305d\u306e API \u306e\u4ed5\u69d8\u304c\u6b21\u306e\u3088\u3046\u306a OpenAPI \u5f62\u5f0f\u306e JSON \u3067\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"version\": \"1.0.0\",\n    \"title\": \"Sample App\",\n    \"description\": \"This is a sample app.\",\n    \"contact\": {\n      \"name\": \"@kymmt90\"\n    },\n    \"license\": {\n      \"name\": \"MIT\"\n    }\n  },\n  // ...\n  \"paths\": {\n    \"/users\": {\n      \"post\": {\n        \"description\": \"Creates a user\",\n        \"operationId\": \"create_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"201\": {\n            \"description\": \"Created user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n  // ...\n\nAPI \u304b\u3089\u305d\u308c\u81ea\u8eab\u306e\u4ed5\u69d8\u3092 JSON \u30c7\u30fc\u30bf\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u3001Swagger UI \u3084 ReDoc \u3068\u3044\u3063\u305f OpenAPI \u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u30d6\u30e9\u30a6\u30b8\u30f3\u30b0\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u81ea\u7531\u306b\u9078\u3073\u3001API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001API \u304b\u3089\u53d6\u5f97\u3067\u304d\u308b JSON \u3092\u3082\u3068\u306b\u3001Swagger UI \u3067\u6b21\u306e\u3088\u3046\u306b\u30d6\u30e9\u30a6\u30b8\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\n\n\n\u4f5c\u308a\u304b\u305f\n\u4eca\u56de\u306f swagger-blocks \u3068\u3044\u3046 gem \u3092\u5229\u7528\u3057\u3066\u3001Rails \u3067\u66f8\u3044\u305f JSON API \u30b5\u30fc\u30d0\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4ed5\u69d8\u3092 OpenAPI \u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\nRails \u306f v5.0.2, swagger-blocks \u306f v2.0.0 \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\nOpenAPI \u3068\u306f\nOpenAPI \u306f API \u8a18\u8ff0\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306e\u4ed5\u69d8\u306e\u4e00\u3064\u3067\u3042\u308a\u30012015 \u5e74\u307e\u3067 Swagger \u3068\u547c\u3070\u308c\u3066\u3044\u305f\u3082\u306e\u3067\u3059\u3002\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nOAI/OpenAPI-Specification: The OpenAPI Specification Repository\n\n\nswagger-blocks \u3068\u306f\nswagger-blocks \u306f OpenAPI \u5f62\u5f0f\u306e API \u4ed5\u69d8\u3092 Ruby \u306e DSL \u3068\u3057\u3066\u30b3\u30fc\u30c9\u5185\u306b\u8a18\u8ff0\u3059\u308b\u305f\u3081\u306e gem \u3067\u3059\u3002\n\nfotinakis/swagger-blocks: Define and serve live-updating Swagger JSON for Ruby apps.\n\n\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u3063\u3071\u306a\u3057\u3067\u3082\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u751f\u6210\u3067\u304d\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u66f4\u65b0\u3055\u308c\u305f\u308a\u3001\u5185\u90e8 DSL\uff08\u3059\u306a\u308f\u3061 Ruby\uff09\u306a\u306e\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3082\u304b\u3093\u305f\u3093\u3060\u3063\u305f\u308a\u3068\u3001\u65b0\u898f\u306b Ruby \u88fd Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f8\u304f\u5834\u5408\u306f\u4fbf\u5229\u304b\u3068\u601d\u3044\u307e\u3059\u3002\nswagger-blocks v2.0.0 \u306f 2017 \u5e74 3 \u6708\u73fe\u5728\u6700\u65b0\u3067\u3042\u308b OpenAPI v2.0 \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u985e\u4f3c\u3059\u308b gem \u3067\u3042\u308b swagger-docs \u306f OpenAPI v1.2 \u307e\u3067\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u73fe\u72b6\u306f swagger-blocks \u3092\u4f7f\u3046\u306e\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\nJSON API \u30b5\u30fc\u30d0\u3092\u66f8\u304f\nRails \u3067 API \u30b5\u30fc\u30d0\u3092\u66f8\u304d\u307e\u3059\u3002\u4eca\u56de\u306f User \u306e CRUD \u3060\u3051\u304c\u3067\u304d\u308b\u5358\u7d14\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\nGET /users\nGET /users/:id\nPOST /users\nPATCH /users/:id\nDELETE /users/:id\n\n\u4eca\u56de\u306f\u8aac\u660e\u7528\u306a\u306e\u3067 scaffold \u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5bfe\u3057\u3066\u4f5c\u696d\u3057\u3066\u3044\u304f\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\u8a8d\u8a3c\u306a\u3069\u3082\u7701\u304d\u307e\u3059\u3002\n$ rails new api_sample_app --api\n$ cd api_sample_app\n$ bin/rails g scaffold User name:string email:string\n$ bin/rails db:migrate\n\n\nCORS \u3092\u6709\u52b9\u306b\u3059\u308b\n\u4eca\u56de\u4f5c\u308b OpenAPI \u5f62\u5f0f\u306e JSON \u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f\u5225\u30aa\u30ea\u30b8\u30f3\u304b\u3089\u53e9\u304b\u308c\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u3001rack-cors \u3092\u5c0e\u5165\u3057\u3066 CORS \u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nGemfile \u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u308b rack-cors \u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3001\u6b21\u306e\u8a2d\u5b9a\u3092 config/application.rb \u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\nref: cyu/rack-cors: Rack Middleware for handling Cross-Origin Resource Sharing (CORS), which makes cross-origin AJAX possible.\n\nconfig/application.rb\nconfig.middleware.insert_before 0, Rack::Cors do\n  allow do\n    origins '*'\n    resource '*', :headers => :any, :methods => [:get, :post, :options]\n  end\nend\n\n\n\nAPI \u4ed5\u69d8\u3092 swagger-blocks \u306e DSL \u3067\u66f8\u304f\n\u306a\u306b\u306f\u306a\u304f\u3068\u3082 swagger-blocks \u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\n\nGemfile\ngem 'swagger-blocks' # \u8ffd\u52a0\n\n\n\u305d\u3057\u3066\u3001API \u306e\u4ed5\u69d8\u3092 swagger-blocks \u306e DSL \u3067\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002OpenAPI \u81ea\u4f53\u306e\u4ed5\u69d8\u306f\u4ed5\u69d8\u66f8\u3092\u3001swagger-blocks \u306e\u5229\u7528\u4f8b\u306f GitHub \u306e fotinakis/swagger-blocks \u306b\u3042\u308b\u30da\u30c3\u30c8\u30b9\u30c8\u30a2\u306e\u4f8b\u3092\u898b\u308b\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067 Swagger:Blocks \u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3057\u3001DSL \u3067\u4ed5\u69d8\u3092\u8a18\u8ff0\u3059\u308b\u306e\u304c\u57fa\u672c\u7684\u306a\u4f7f\u3044\u304b\u305f\u3067\u3059\u3002\n\napp/controllers/users_controller.rb\ndef UsersController < ApplicationController\n  include Swagger::Blocks\n\n  swagger_path '/users/{id}' do\n\n    # GET /users/:id \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u5b9a\u7fa9\n    operation :get do\n      key :description, 'Find a user by ID'\n      key :operationId, :find_user_by_id\n\n      # \u30d1\u30b9\u30d1\u30e9\u30e1\u30fc\u30bf id \u306e\u5b9a\u7fa9\n      parameter name: :id do\n        key :in, :path\n        key :description, 'User ID'\n        key :required, true\n        key :type, :integer\n        key :format, :int64 \n      end\n\n      # \u6210\u529f\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u5b9a\u7fa9\n      response 200 do\n        key :description, 'User'\n        schema do\n          key :required, [:id, :name]\n          property :id do\n            key :type, :integer\n            key :format, :int64\n          end\n          property :name do\n            key :type, :string\n          end\n        end\n      end\n    end\n  end\n\n  def show\n    # ...\n  end\n\n  # ...\nend\n\n\nAPI \u4ed5\u69d8\u304c\u8a18\u8ff0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u30af\u30e9\u30b9\u540d\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\u3092 Swagger::Blocks.build_root_json \u306b\u6e21\u3059\u3053\u3068\u3067 OpenAPI \u5f62\u5f0f\u306e JSON \u3092\u8868\u3059\u30cf\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nSwagger::Blocks.build_root_json([User, UserController])\n\n\u3042\u3068\u306f\u3001\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u3092 JSON \u3068\u3057\u3066\u8fd4\u3059\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u6301\u3064\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u308b\u3053\u3068\u3067\u3001\u305d\u306e API \u81ea\u8eab\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 GET /api-docs.json \u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\nroutes.rb\nget 'api-docs', to: 'api_docs#index' # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n\n\n\napp/controllers/api_docs_controller.rb\nclass ApiDocsController < ApplicationController\n  include Swagger::Blocks\n\n  swagger_root do\n    # API \u540d\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\u306e\u30e1\u30bf\u60c5\u5831\u3092\u5b9a\u7fa9\n  end\n\n  def index\n    render json: Swagger::Blocks.build_root_json([User, UsersController])\n  end\nend\n\n\n\n\u305d\u308c\u3067\u306f\u3001\u30d9\u30bf\u30fc\u3068\u601d\u308f\u308c\u308b swagger-blocks \u306e\u4f7f\u3044\u304b\u305f\u306b\u3064\u3044\u3066\u3001\u3044\u304f\u3064\u304b\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u4ed5\u69d8\u3092 concern \u306b\u66f8\u304f\nAPI \u306e\u4ed5\u69d8\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u4e2d\u306b\u66f8\u3044\u3066\u3044\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u4ed5\u69d8\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3054\u3068\u306b\u5225\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u66f8\u304d\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067\u305d\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 include \u3057\u305f\u307b\u3046\u304c\u898b\u901a\u3057\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u3001Swagger::Blocks \u3078\u306e\u4f9d\u5b58\u89e3\u6c7a\u3067\u697d\u3092\u3059\u308b\u305f\u3081\u306b concern \u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u305f\u3068\u3048\u3070\u3001UsersController \u306e\u5404\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u4ed5\u69d8\u306f app/controllers/concerns/swagger/users_api.rb \u306b\u6b21\u306e\u3088\u3046\u306a concern \u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\napp/controllers/concerns/swagger/users_api.rb\nmodule Swagger::UsersApi\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_path '/users/{id}' do\n      parameter :user_id do\n        key :name, :id\n      end\n\n      operation :get do\n        key :description, 'Finds the specified user'\n        key :operationId, :find_user_by_id\n\n        response 200 do\n          key :description, 'User specified by its ID'\n          schema do\n            key :'$ref', :UserOutput\n          end\n        end\n      end\n      # ...\n\n    end\n  end\nend\n\n\n\u305d\u3057\u3066\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u5185\u3067 include \u3059\u308b\u3068\u3001API \u4ed5\u69d8\u306e\u8a18\u8ff0\u3068\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u51e6\u7406\u306e\u8a18\u8ff0\u3092\u5206\u96e2\u3067\u304d\u307e\u3059\u3002\n\napp/controllers/users_controller.rb\nclass UsersController < ApplicationController\n  include Swagger::UsersApi\n\n  # ...\nend\n\n\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a18\u8ff0\u3092 DRY \u306b\u3059\u308b\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3084\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a18\u8ff0\u306f\u5404 API \u3067\u91cd\u8907\u3057\u304c\u3061\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u5225\u9014\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\u3057\u3066\u3001JSON Schema \u306e $ref \u306a\u3069\u3092\u5229\u7528\u3057\u3066\u53c2\u7167\u3059\u308b\u3053\u3068\u3067 DRY \u306b\u306a\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\u305f\u3068\u3048\u3070\u3001API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3057\u3066\u306e User \u3068 ErrorOutput \u3092\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\napp/models/concerns/swagger/user_schema.rb\nmodule Swagger::UserSchema\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_schema :User do\n      key :required, [:name, :email]\n      property :name do\n        key :type, :string\n      end\n      property :email do\n        key :type, :string\n      end\n    end\n  end\nend\n\n\n\napp/models/user.rb\n# User \u3092\u8868\u3059\u4ed5\u69d8\u3092 include \u3057\u3066\u304a\u304f\nclass User < ApplicationRecord\n  include Swagger::UserSchema\nend\n\n\n\napp/models/concerns/swagger/error_schema.rb\nmodule Swagger::ErrorSchema\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_schema :ErrorOutput do\n      key :required, [:errors]\n      property :errors do\n        key :type, :array\n        items do\n          key :type, :string\n        end\n      end\n    end\n  end\nend\n\n\n\u307e\u305f\u3001\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\napp/controllers/concerns/swagger/parameters.rb\nmodule Swagger::Parameters\n  def self.extended(base)\n    base.parameter :user_id do\n      key :in, :path\n      key :description, 'User ID'\n      key :required, true\n      key :type, :integer\n      key :format, :int64\n    end\n  end\nend\n\n\n\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u540c\u3058\u8981\u9818\u3067\u3001\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3082\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\napp/controllers/concerns/swagger/error_respnoses.rb\nmodule Swagger::ErrorResponses\n  module NotFoundError\n    def self.extended(base)\n      base.response 404 do\n        key :description, 'Resource not found'\n        schema do\n          key :'$ref', :ErrorOutput # \u5225\u9014\u5b9a\u7fa9\u3057\u305f\u30a8\u30e9\u30fc\u3092\u53c2\u7167\n        end\n      end\n    end\n  end\n\n  # ...\nend\n\n\n\u3053\u308c\u3067\u3001\u6b21\u306e\u3088\u3046\u306b\u3001\u5b9a\u7fa9\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3084\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5225\u306e\u5834\u6240\u304b\u3089\u53c2\u7167\u3057\u3001\u8a18\u8ff0\u306e\u91cd\u8907\u3092\u9632\u3050\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\napp/controllers/concerns/swagger/sample_app_root.rb\n# Parameters \u306f swagger_root \u5185\u3067 extend \u3057\u3066\u304a\u304f\nmodule Swagger::SampleAppRoot\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_root do\n      # ...\n\n      extend Swagger::Parameters\n    end\n  end\nend\n\n\n\napp/controllers/concerns/swagger/users_api.rb\nmodule Swagger::UsersApi\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    include Swagger::ErrorSchema\n\n    swagger_path '/users/{id}' do\n      parameters :user_id # root \u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u3080\n\n      operation :get do\n        key :description, 'Returns the specified user'\n        key :operationId, :find_user_by_id\n\n        response 200 do\n          key :description, 'User specified by its ID'\n          schema do\n            key :'$ref', :User # \u5225\u9014\u5b9a\u7fa9\u3057\u305f User \u3092\u53c2\u7167\n          end\n        end\n\n        # \u5225\u9014\u5b9a\u7fa9\u3057\u305f\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u308a\u8fbc\u3080\n        extend Swagger::ErrorResponses::NotFoundError\n      end\n    end\n  end\nend\n\n\n\nswagger-blocks \u306b\u3088\u308b API \u4ed5\u69d8\u8a18\u8ff0\u306e\u30b5\u30f3\u30d7\u30eb\n\u4e0a\u8ff0\u3057\u305f\u65b9\u91dd\u3067 swagger-blocks \u3092\u4f7f\u3063\u3066\u66f8\u3044\u305f API \u4ed5\u69d8\u3092\u542b\u3080 Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u3092 GitHub \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\nkymmt90/api_sample_app\n\napp \u914d\u4e0b\u306e\u4eca\u56de\u624b\u3092\u52a0\u3048\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002concerns/swagger \u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u304c API \u4ed5\u69d8\u3092\u8a18\u8ff0\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u542b\u3080\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\napp/controllers\n\u251c\u2500\u2500 api_docs_controller.rb\n\u251c\u2500\u2500 application_controller.rb\n\u251c\u2500\u2500 concerns\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 api_docs.rb\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 error_responses.rb\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 parameters.rb\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 users_api.rb\n\u2514\u2500\u2500 users_controller.rb\n\napp/models\n\u251c\u2500\u2500 application_record.rb\n\u251c\u2500\u2500 concerns\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 error_schema.rb\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 user_schema.rb\n\u2514\u2500\u2500 user.rb\n\n\nOpenAPI \u5f62\u5f0f\u306e API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u53e9\u304f\n\u4eca\u56de\u4f5c\u3063\u305f API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u53d6\u5f97\u7528\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8a66\u3057\u306b\u53e9\u3044\u3066\u307f\u307e\u3059\u3002\n$ bin/rails s\n$ curl http://localhost:3000/api-docs.json | jq .\n\n\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a OpenAPI \u5f62\u5f0f\u306e JSON \u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u307e\u3059\u3002\u3042\u3068\u306f\u3001Swagger UI \u306a\u3069\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u304b\u3089\u3053\u306e JSON \u3092\u53d6\u5f97\u3059\u308c\u3070 OK \u3067\u3059\u3002\n{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"version\": \"1.0.0\",\n    \"title\": \"API Sample App\",\n    \"description\": \"API Sample App\",\n    \"contact\": {\n      \"name\": \"@kymmt90\"\n    },\n    \"license\": {\n      \"name\": \"MIT\"\n    }\n  },\n  \"basePath\": \"/\",\n  \"consumes\": [\n    \"application/json\"\n  ],\n  \"produces\": [\n    \"application/json\"\n  ],\n  \"parameters\": {\n    \"user_id\": {\n      \"in\": \"path\",\n      \"description\": \"User ID\",\n      \"required\": true,\n      \"type\": \"integer\",\n      \"format\": \"int64\"\n    },\n    \"user\": {\n      \"name\": \"user\",\n      \"in\": \"body\",\n      \"description\": \"User attributes\",\n      \"required\": true,\n      \"schema\": {\n        \"$ref\": \"#/definitions/UserInput\"\n      }\n    }\n  },\n  \"paths\": {\n    \"/users\": {\n      \"get\": {\n        \"description\": \"Get all users\",\n        \"operationId\": \"get_all_user\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"All users\",\n            \"schema\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"$ref\": \"#/definitions/UserOutput\"\n              }\n            }\n          }\n        }\n      },\n      \"post\": {\n        \"description\": \"Creates a user\",\n        \"operationId\": \"create_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"201\": {\n            \"description\": \"Created user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"400\": {\n            \"description\": \"Invalid parameters\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      }\n    },\n    \"/users/{id}\": {\n      \"parameters\": [\n        {\n          \"$ref\": \"#/parameters/user_id\",\n          \"name\": \"id\"\n        }\n      ],\n      \"get\": {\n        \"description\": \"Finds the specified user\",\n        \"operationId\": \"find_user_by_id\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"User specified by its ID\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      },\n      \"patch\": {\n        \"description\": \"Updates the user\",\n        \"operationId\": \"update_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Updated user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"400\": {\n            \"description\": \"Invalid parameters\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      },\n      \"delete\": {\n        \"description\": \"Deletes the user\",\n        \"operationId\": \"delete_user\",\n        \"responses\": {\n          \"204\": {\n            \"description\": \"The user was deleted\"\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      }\n    }\n  },\n  \"definitions\": {\n    \"UserInput\": {\n      \"required\": [\n        \"name\",\n        \"email\"\n      ],\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"email\": {\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"UserOutput\": {\n      \"required\": [\n        \"id\",\n        \"name\",\n        \"email\"\n      ],\n      \"properties\": {\n        \"id\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"email\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Rails \u3067\u66f8\u3044\u305f JSON API \u30b5\u30fc\u30d0\u305d\u308c\u81ea\u4f53\u306e API \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4ed5\u69d8\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092 OpenAPI \u5f62\u5f0f\u306e JSON \u30c7\u30fc\u30bf\u3068\u3057\u3066\u751f\u6210\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092 API \u81ea\u4f53\u304b\u3089\u53d6\u5f97\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\n\n\u3064\u307e\u308a\u3001\u6b21\u306e\u3088\u3046\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\n\n```\nGET /api-docs.json\n```\n\n\u3092\u53e9\u304f\u3068\u3001\u305d\u306e API \u306e\u4ed5\u69d8\u304c\u6b21\u306e\u3088\u3046\u306a OpenAPI \u5f62\u5f0f\u306e JSON \u3067\u8fd4\u3063\u3066\u304f\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"version\": \"1.0.0\",\n    \"title\": \"Sample App\",\n    \"description\": \"This is a sample app.\",\n    \"contact\": {\n      \"name\": \"@kymmt90\"\n    },\n    \"license\": {\n      \"name\": \"MIT\"\n    }\n  },\n  // ...\n  \"paths\": {\n    \"/users\": {\n      \"post\": {\n        \"description\": \"Creates a user\",\n        \"operationId\": \"create_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"201\": {\n            \"description\": \"Created user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n  // ...\n```\n\nAPI \u304b\u3089\u305d\u308c\u81ea\u8eab\u306e\u4ed5\u69d8\u3092 JSON \u30c7\u30fc\u30bf\u3068\u3057\u3066\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u3001[Swagger UI](http://swagger.io/swagger-ui/) \u3084 [ReDoc](https://github.com/Rebilly/ReDoc) \u3068\u3044\u3063\u305f OpenAPI \u5f62\u5f0f\u306e\u30c7\u30fc\u30bf\u3092\u30d6\u30e9\u30a6\u30b8\u30f3\u30b0\u3059\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u81ea\u7531\u306b\u9078\u3073\u3001API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4f5c\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001API \u304b\u3089\u53d6\u5f97\u3067\u304d\u308b JSON \u3092\u3082\u3068\u306b\u3001Swagger UI \u3067\u6b21\u306e\u3088\u3046\u306b\u30d6\u30e9\u30a6\u30b8\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\n\n![Swagger UI \u3067\u30d6\u30e9\u30a6\u30b8\u30f3\u30b0\u3059\u308b\u4f8b](https://qiita-image-store.s3.amazonaws.com/0/62097/bad453cb-7a15-9a70-e11e-15d24767c44a.png)\n\n\n# \u4f5c\u308a\u304b\u305f\n\n\u4eca\u56de\u306f swagger-blocks \u3068\u3044\u3046 gem \u3092\u5229\u7528\u3057\u3066\u3001Rails \u3067\u66f8\u3044\u305f JSON API \u30b5\u30fc\u30d0\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u4ed5\u69d8\u3092 OpenAPI \u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\nRails \u306f v5.0.2, swagger-blocks \u306f v2.0.0 \u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n## OpenAPI \u3068\u306f\n\nOpenAPI \u306f API \u8a18\u8ff0\u65b9\u6cd5\u306b\u3064\u3044\u3066\u306e\u4ed5\u69d8\u306e\u4e00\u3064\u3067\u3042\u308a\u30012015 \u5e74\u307e\u3067 Swagger \u3068\u547c\u3070\u308c\u3066\u3044\u305f\u3082\u306e\u3067\u3059\u3002\u8a73\u3057\u304f\u306f\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n- [OAI/OpenAPI-Specification: The OpenAPI Specification Repository](https://github.com/OAI/OpenAPI-Specification)\n\n## swagger-blocks \u3068\u306f\n\nswagger-blocks \u306f OpenAPI \u5f62\u5f0f\u306e API \u4ed5\u69d8\u3092 Ruby \u306e DSL \u3068\u3057\u3066\u30b3\u30fc\u30c9\u5185\u306b\u8a18\u8ff0\u3059\u308b\u305f\u3081\u306e gem \u3067\u3059\u3002\n\n- [fotinakis/swagger-blocks: Define and serve live-updating Swagger JSON for Ruby apps.](https://github.com/fotinakis/swagger-blocks)\n\n\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u3063\u3071\u306a\u3057\u3067\u3082\u30b3\u30fc\u30c9\u3092\u66f8\u304d\u63db\u3048\u308b\u3068\u751f\u6210\u3067\u304d\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u66f4\u65b0\u3055\u308c\u305f\u308a\u3001\u5185\u90e8 DSL\uff08\u3059\u306a\u308f\u3061 Ruby\uff09\u306a\u306e\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3082\u304b\u3093\u305f\u3093\u3060\u3063\u305f\u308a\u3068\u3001\u65b0\u898f\u306b Ruby \u88fd Web \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f8\u304f\u5834\u5408\u306f\u4fbf\u5229\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\nswagger-blocks v2.0.0 \u306f 2017 \u5e74 3 \u6708\u73fe\u5728\u6700\u65b0\u3067\u3042\u308b OpenAPI v2.0 \u306b\u5bfe\u5fdc\u3057\u3066\u3044\u307e\u3059\u3002\u985e\u4f3c\u3059\u308b gem \u3067\u3042\u308b [swagger-docs](https://github.com/richhollis/swagger-docs) \u306f OpenAPI v1.2 \u307e\u3067\u3057\u304b\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u73fe\u72b6\u306f swagger-blocks \u3092\u4f7f\u3046\u306e\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## JSON API \u30b5\u30fc\u30d0\u3092\u66f8\u304f\n\nRails \u3067 API \u30b5\u30fc\u30d0\u3092\u66f8\u304d\u307e\u3059\u3002\u4eca\u56de\u306f `User` \u306e CRUD \u3060\u3051\u304c\u3067\u304d\u308b\u5358\u7d14\u306a\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304c\u3042\u308b\u3068\u3057\u307e\u3059\u3002\n\n- `GET /users`\n- `GET /users/:id`\n- `POST /users`\n- `PATCH /users/:id`\n- `DELETE /users/:id`\n\n\u4eca\u56de\u306f\u8aac\u660e\u7528\u306a\u306e\u3067 scaffold \u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u5bfe\u3057\u3066\u4f5c\u696d\u3057\u3066\u3044\u304f\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\u8a8d\u8a3c\u306a\u3069\u3082\u7701\u304d\u307e\u3059\u3002\n\n```\n$ rails new api_sample_app --api\n$ cd api_sample_app\n$ bin/rails g scaffold User name:string email:string\n$ bin/rails db:migrate\n```\n\n\n## CORS \u3092\u6709\u52b9\u306b\u3059\u308b\n\n\u4eca\u56de\u4f5c\u308b OpenAPI \u5f62\u5f0f\u306e JSON \u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306f\u5225\u30aa\u30ea\u30b8\u30f3\u304b\u3089\u53e9\u304b\u308c\u308b\u3053\u3068\u304c\u591a\u3044\u306e\u3067\u3001rack-cors \u3092\u5c0e\u5165\u3057\u3066 CORS \u3092\u6709\u52b9\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nGemfile \u3067\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3055\u308c\u3066\u3044\u308b rack-cors \u306e\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\u3092\u5916\u3057\u3001\u6b21\u306e\u8a2d\u5b9a\u3092 `config/application.rb` \u3078\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nref: [cyu/rack-cors: Rack Middleware for handling Cross-Origin Resource Sharing (CORS), which makes cross-origin AJAX possible.](https://github.com/cyu/rack-cors#rails-configuration)\n\n```ruby:config/application.rb\nconfig.middleware.insert_before 0, Rack::Cors do\n  allow do\n    origins '*'\n    resource '*', :headers => :any, :methods => [:get, :post, :options]\n  end\nend\n```\n\n## API \u4ed5\u69d8\u3092 swagger-blocks \u306e DSL \u3067\u66f8\u304f\n\n\u306a\u306b\u306f\u306a\u304f\u3068\u3082 swagger-blocks \u3092\u5c0e\u5165\u3057\u307e\u3059\u3002\n\n```ruby:Gemfile\ngem 'swagger-blocks' # \u8ffd\u52a0\n```\n\n\u305d\u3057\u3066\u3001API \u306e\u4ed5\u69d8\u3092 swagger-blocks \u306e DSL \u3067\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002OpenAPI \u81ea\u4f53\u306e\u4ed5\u69d8\u306f[\u4ed5\u69d8\u66f8](https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md)\u3092\u3001swagger-blocks \u306e\u5229\u7528\u4f8b\u306f [GitHub \u306e fotinakis/swagger-blocks](https://github.com/fotinakis/swagger-blocks/) \u306b\u3042\u308b[\u30da\u30c3\u30c8\u30b9\u30c8\u30a2\u306e\u4f8b](https://github.com/fotinakis/swagger-blocks/blob/master/spec/lib/swagger_v2_blocks_spec.rb)\u3092\u898b\u308b\u3068\u3088\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067 `Swagger:Blocks` \u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3057\u3001DSL \u3067\u4ed5\u69d8\u3092\u8a18\u8ff0\u3059\u308b\u306e\u304c\u57fa\u672c\u7684\u306a\u4f7f\u3044\u304b\u305f\u3067\u3059\u3002\n\n```ruby:app/controllers/users_controller.rb\ndef UsersController < ApplicationController\n  include Swagger::Blocks\n  \n  swagger_path '/users/{id}' do\n  \n    # GET /users/:id \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u5b9a\u7fa9\n    operation :get do\n      key :description, 'Find a user by ID'\n      key :operationId, :find_user_by_id\n\n      # \u30d1\u30b9\u30d1\u30e9\u30e1\u30fc\u30bf id \u306e\u5b9a\u7fa9\n      parameter name: :id do\n        key :in, :path\n        key :description, 'User ID'\n        key :required, true\n        key :type, :integer\n        key :format, :int64\t\n      end\n\n      # \u6210\u529f\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u5b9a\u7fa9\n      response 200 do\n        key :description, 'User'\n        schema do\n          key :required, [:id, :name]\n          property :id do\n            key :type, :integer\n            key :format, :int64\n          end\n          property :name do\n            key :type, :string\n          end\n        end\n      end\n    end\n  end\n  \n  def show\n    # ...\n  end\n  \n  # ...\nend\n```\n\nAPI \u4ed5\u69d8\u304c\u8a18\u8ff0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u30af\u30e9\u30b9\u540d\u3092\u683c\u7d0d\u3057\u305f\u914d\u5217\u3092 `Swagger::Blocks.build_root_json` \u306b\u6e21\u3059\u3053\u3068\u3067 OpenAPI \u5f62\u5f0f\u306e JSON \u3092\u8868\u3059\u30cf\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nSwagger::Blocks.build_root_json([User, UserController])\n```\n\n\u3042\u3068\u306f\u3001\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u3067\u4f5c\u6210\u3057\u305f\u30cf\u30c3\u30b7\u30e5\u3092 JSON \u3068\u3057\u3066\u8fd4\u3059\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u6301\u3064\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3092\u4f5c\u308b\u3053\u3068\u3067\u3001\u305d\u306e API \u81ea\u8eab\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 `GET /api-docs.json` \u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\n\n```ruby:routes.rb\nget 'api-docs', to: 'api_docs#index' # \u3053\u306e\u884c\u3092\u8ffd\u52a0\n```\n\n```ruby:app/controllers/api_docs_controller.rb\nclass ApiDocsController < ApplicationController\n  include Swagger::Blocks\n\n  swagger_root do\n    # API \u540d\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306a\u3069\u306e\u30e1\u30bf\u60c5\u5831\u3092\u5b9a\u7fa9\n  end\n\n  def index\n    render json: Swagger::Blocks.build_root_json([User, UsersController])\n  end\nend\n\n```\n\n\u305d\u308c\u3067\u306f\u3001\u30d9\u30bf\u30fc\u3068\u601d\u308f\u308c\u308b swagger-blocks \u306e\u4f7f\u3044\u304b\u305f\u306b\u3064\u3044\u3066\u3001\u3044\u304f\u3064\u304b\u8aac\u660e\u3057\u307e\u3059\u3002\n\n### \u4ed5\u69d8\u3092 concern \u306b\u66f8\u304f\n\nAPI \u306e\u4ed5\u69d8\u3092\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u306e\u4e2d\u306b\u66f8\u3044\u3066\u3044\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u4ed5\u69d8\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3054\u3068\u306b\u5225\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u66f8\u304d\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u3067\u305d\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092 `include` \u3057\u305f\u307b\u3046\u304c\u898b\u901a\u3057\u304c\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u307e\u305f\u3001`Swagger::Blocks` \u3078\u306e\u4f9d\u5b58\u89e3\u6c7a\u3067\u697d\u3092\u3059\u308b\u305f\u3081\u306b concern \u306b\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u305f\u3068\u3048\u3070\u3001`UsersController` \u306e\u5404\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u5bfe\u5fdc\u3059\u308b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u4ed5\u69d8\u306f `app/controllers/concerns/swagger/users_api.rb` \u306b\u6b21\u306e\u3088\u3046\u306a concern \u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```ruby:app/controllers/concerns/swagger/users_api.rb\nmodule Swagger::UsersApi\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n  \n  included do\n    swagger_path '/users/{id}' do\n      parameter :user_id do\n        key :name, :id\n      end\n\n      operation :get do\n        key :description, 'Finds the specified user'\n        key :operationId, :find_user_by_id\n\n        response 200 do\n          key :description, 'User specified by its ID'\n          schema do\n            key :'$ref', :UserOutput\n          end\n        end\n      end\n      # ...\n      \n    end\n  end\nend\n```\n\n\u305d\u3057\u3066\u3001\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u5185\u3067 `include` \u3059\u308b\u3068\u3001API \u4ed5\u69d8\u306e\u8a18\u8ff0\u3068\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u51e6\u7406\u306e\u8a18\u8ff0\u3092\u5206\u96e2\u3067\u304d\u307e\u3059\u3002\n\n```ruby:app/controllers/users_controller.rb\nclass UsersController < ApplicationController\n  include Swagger::UsersApi\n  \n  # ...\nend\n```\n\n### \u30ec\u30b9\u30dd\u30f3\u30b9\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a18\u8ff0\u3092 DRY \u306b\u3059\u308b\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3084\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8a18\u8ff0\u306f\u5404 API \u3067\u91cd\u8907\u3057\u304c\u3061\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u5225\u9014\u30b9\u30ad\u30fc\u30de\u3092\u5b9a\u7fa9\u3057\u3066\u3001JSON Schema \u306e `$ref` \u306a\u3069\u3092\u5229\u7528\u3057\u3066\u53c2\u7167\u3059\u308b\u3053\u3068\u3067 DRY \u306b\u306a\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u305f\u3068\u3048\u3070\u3001API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3068\u3057\u3066\u306e `User` \u3068 `ErrorOutput` \u3092\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```ruby:app/models/concerns/swagger/user_schema.rb\nmodule Swagger::UserSchema\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_schema :User do\n      key :required, [:name, :email]\n      property :name do\n        key :type, :string\n      end\n      property :email do\n        key :type, :string\n      end\n    end\n  end\nend\n```\n\n```ruby:app/models/user.rb\n# User \u3092\u8868\u3059\u4ed5\u69d8\u3092 include \u3057\u3066\u304a\u304f\nclass User < ApplicationRecord\n  include Swagger::UserSchema\nend\n```\n\n```ruby:app/models/concerns/swagger/error_schema.rb\nmodule Swagger::ErrorSchema\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    swagger_schema :ErrorOutput do\n      key :required, [:errors]\n      property :errors do\n        key :type, :array\n        items do\n          key :type, :string\n        end\n      end\n    end\n  end\nend\n```\n\n\u307e\u305f\u3001\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```ruby:app/controllers/concerns/swagger/parameters.rb\nmodule Swagger::Parameters\n  def self.extended(base)\n    base.parameter :user_id do\n      key :in, :path\n      key :description, 'User ID'\n      key :required, true\n      key :type, :integer\n      key :format, :int64\n    end\n  end\nend\n```\n\n\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u540c\u3058\u8981\u9818\u3067\u3001\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3082\u6b21\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```ruby:app/controllers/concerns/swagger/error_respnoses.rb\nmodule Swagger::ErrorResponses\n  module NotFoundError\n    def self.extended(base)\n      base.response 404 do\n        key :description, 'Resource not found'\n        schema do\n          key :'$ref', :ErrorOutput # \u5225\u9014\u5b9a\u7fa9\u3057\u305f\u30a8\u30e9\u30fc\u3092\u53c2\u7167\n        end\n      end\n    end\n  end\n\n  # ...\nend\n```\n\n\u3053\u308c\u3067\u3001\u6b21\u306e\u3088\u3046\u306b\u3001\u5b9a\u7fa9\u3057\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3084\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5225\u306e\u5834\u6240\u304b\u3089\u53c2\u7167\u3057\u3001\u8a18\u8ff0\u306e\u91cd\u8907\u3092\u9632\u3050\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```ruby:app/controllers/concerns/swagger/sample_app_root.rb\n# Parameters \u306f swagger_root \u5185\u3067 extend \u3057\u3066\u304a\u304f\nmodule Swagger::SampleAppRoot\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n  \n  included do\n    swagger_root do\n      # ...\n\t  \n      extend Swagger::Parameters\n    end\n  end\nend\n```\n\n\n```ruby:app/controllers/concerns/swagger/users_api.rb\nmodule Swagger::UsersApi\n  extend ActiveSupport::Concern\n  include Swagger::Blocks\n\n  included do\n    include Swagger::ErrorSchema\n\n    swagger_path '/users/{id}' do\n      parameters :user_id # root \u3067\u5b9a\u7fa9\u3055\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u308a\u8fbc\u3080\n      \n      operation :get do\n        key :description, 'Returns the specified user'\n        key :operationId, :find_user_by_id\n\n        response 200 do\n          key :description, 'User specified by its ID'\n          schema do\n            key :'$ref', :User # \u5225\u9014\u5b9a\u7fa9\u3057\u305f User \u3092\u53c2\u7167\n          end\n        end\n        \n        # \u5225\u9014\u5b9a\u7fa9\u3057\u305f\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u53d6\u308a\u8fbc\u3080\n        extend Swagger::ErrorResponses::NotFoundError\n      end\n    end\n  end\nend\n```\n\n## swagger-blocks \u306b\u3088\u308b API \u4ed5\u69d8\u8a18\u8ff0\u306e\u30b5\u30f3\u30d7\u30eb\n\n\u4e0a\u8ff0\u3057\u305f\u65b9\u91dd\u3067 swagger-blocks \u3092\u4f7f\u3063\u3066\u66f8\u3044\u305f API \u4ed5\u69d8\u3092\u542b\u3080 Rails \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b5\u30f3\u30d7\u30eb\u3092 GitHub \u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n- [kymmt90/api_sample_app](https://github.com/kymmt90/api_sample_app)\n\n`app` \u914d\u4e0b\u306e\u4eca\u56de\u624b\u3092\u52a0\u3048\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\u306f\u6b21\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002`concerns/swagger` \u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u304c API \u4ed5\u69d8\u3092\u8a18\u8ff0\u3057\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u542b\u3080\u30d5\u30a1\u30a4\u30eb\u3067\u3059\u3002\n\n```\napp/controllers\n\u251c\u2500\u2500 api_docs_controller.rb\n\u251c\u2500\u2500 application_controller.rb\n\u251c\u2500\u2500 concerns\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 api_docs.rb\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 error_responses.rb\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 parameters.rb\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 users_api.rb\n\u2514\u2500\u2500 users_controller.rb\n\napp/models\n\u251c\u2500\u2500 application_record.rb\n\u251c\u2500\u2500 concerns\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 swagger\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 error_schema.rb\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 user_schema.rb\n\u2514\u2500\u2500 user.rb\n```\n\n# OpenAPI \u5f62\u5f0f\u306e API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fd4\u3059\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u53e9\u304f\n\n\u4eca\u56de\u4f5c\u3063\u305f API \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u53d6\u5f97\u7528\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u8a66\u3057\u306b\u53e9\u3044\u3066\u307f\u307e\u3059\u3002\n\n```\n$ bin/rails s\n$ curl http://localhost:3000/api-docs.json | jq .\n```\n\n\u3059\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a OpenAPI \u5f62\u5f0f\u306e JSON \u30c7\u30fc\u30bf\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u307e\u3059\u3002\u3042\u3068\u306f\u3001Swagger UI \u306a\u3069\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u304b\u3089\u3053\u306e JSON \u3092\u53d6\u5f97\u3059\u308c\u3070 OK \u3067\u3059\u3002\n\n```\n{\n  \"swagger\": \"2.0\",\n  \"info\": {\n    \"version\": \"1.0.0\",\n    \"title\": \"API Sample App\",\n    \"description\": \"API Sample App\",\n    \"contact\": {\n      \"name\": \"@kymmt90\"\n    },\n    \"license\": {\n      \"name\": \"MIT\"\n    }\n  },\n  \"basePath\": \"/\",\n  \"consumes\": [\n    \"application/json\"\n  ],\n  \"produces\": [\n    \"application/json\"\n  ],\n  \"parameters\": {\n    \"user_id\": {\n      \"in\": \"path\",\n      \"description\": \"User ID\",\n      \"required\": true,\n      \"type\": \"integer\",\n      \"format\": \"int64\"\n    },\n    \"user\": {\n      \"name\": \"user\",\n      \"in\": \"body\",\n      \"description\": \"User attributes\",\n      \"required\": true,\n      \"schema\": {\n        \"$ref\": \"#/definitions/UserInput\"\n      }\n    }\n  },\n  \"paths\": {\n    \"/users\": {\n      \"get\": {\n        \"description\": \"Get all users\",\n        \"operationId\": \"get_all_user\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"All users\",\n            \"schema\": {\n              \"type\": \"array\",\n              \"items\": {\n                \"$ref\": \"#/definitions/UserOutput\"\n              }\n            }\n          }\n        }\n      },\n      \"post\": {\n        \"description\": \"Creates a user\",\n        \"operationId\": \"create_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"201\": {\n            \"description\": \"Created user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"400\": {\n            \"description\": \"Invalid parameters\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      }\n    },\n    \"/users/{id}\": {\n      \"parameters\": [\n        {\n          \"$ref\": \"#/parameters/user_id\",\n          \"name\": \"id\"\n        }\n      ],\n      \"get\": {\n        \"description\": \"Finds the specified user\",\n        \"operationId\": \"find_user_by_id\",\n        \"responses\": {\n          \"200\": {\n            \"description\": \"User specified by its ID\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      },\n      \"patch\": {\n        \"description\": \"Updates the user\",\n        \"operationId\": \"update_user\",\n        \"parameters\": [\n          {\n            \"$ref\": \"#/parameters/user\"\n          }\n        ],\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Updated user\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/UserOutput\"\n            }\n          },\n          \"400\": {\n            \"description\": \"Invalid parameters\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      },\n      \"delete\": {\n        \"description\": \"Deletes the user\",\n        \"operationId\": \"delete_user\",\n        \"responses\": {\n          \"204\": {\n            \"description\": \"The user was deleted\"\n          },\n          \"404\": {\n            \"description\": \"Resource not found\",\n            \"schema\": {\n              \"$ref\": \"#/definitions/ErrorOutput\"\n            }\n          }\n        }\n      }\n    }\n  },\n  \"definitions\": {\n    \"UserInput\": {\n      \"required\": [\n        \"name\",\n        \"email\"\n      ],\n      \"properties\": {\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"email\": {\n          \"type\": \"string\"\n        }\n      }\n    },\n    \"UserOutput\": {\n      \"required\": [\n        \"id\",\n        \"name\",\n        \"email\"\n      ],\n      \"properties\": {\n        \"id\": {\n          \"type\": \"integer\",\n          \"format\": \"int64\"\n        },\n        \"name\": {\n          \"type\": \"string\"\n        },\n        \"email\": {\n          \"type\": \"string\"\n        }\n      }\n    }\n  }\n}\n```\n"}