{"context": "\n\nNetCDF\u306b\u3064\u3044\u3066\n\u3000\u5927\u6c17\u30fb\u6d77\u6d0b\u7cfb\u306e\u7814\u7a76\u3067\u7528\u3044\u3089\u308c\u3066\u3044\u308bNetCDF\u30d5\u30a1\u30a4\u30eb\u306f\u5909\u6570\u3001\u6b21\u5143\u6570\u3001\u5c5e\u6027\u60c5\u5831\u3092\u6301\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u30014\u6b21\u5143\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u306b\u9069\u3057\u3066\u3044\u308b\u3002C\u3084Fortran\u3067\u6271\u308f\u308c\u308b\u3053\u3068\u304c\u591a\u3044NetCDF\u3092\u3001R\u3067\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u30e1\u30e2\u3092\u6b8b\u3057\u307e\u3059\u3002\n\u3000R\u3067\u306f\u3001ncdf4\u3084RNetCDF\u3068\u3044\u3063\u305f\u3001NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u4eca\u56de\u306fNetCDF4\u306b\u5bfe\u5fdc\u3057\u305fncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\u3000NetCDF\u306b\u3064\u3044\u3066\u306e\u8a73\u3057\u3044\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3059\u3002Fortran\u7248NetCDF\u30e6\u30fc\u30b6\u30fc\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u65e5\u672c\u8a9e\u7248\u306e\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002C\u7248\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u3082\u5b58\u5728\u3057\u307e\u3059\u3002\n\nR\u3067NetCDF\u3092\u6271\u3046\u305f\u3081\u306b\n\u3000\u307e\u305a\u3001ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ninstall.packages(\"ncdf4\")\nlibrary(ncdf4)\n\n\u3000ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3088\u304f\u4f7f\u7528\u3059\u308b\u95a2\u6570\u3092\u8aac\u660e\u3057\u307e\u3059\u3002ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u306fCRAN\u30b5\u30a4\u30c8\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u3092R\u3067\u8aad\u307f\u8fbc\u3080\u3068\u304d\u306fnc_open()\u95a2\u6570\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u3000\u8a66\u3057\u306bWRF\u306e\u8a08\u7b97\u7d50\u679c\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\nnc <- nc_open(\"wrfout_d01_2014-02-01_00_00_00\")\n\n\u3000\u3053\u306e\u307e\u307eprint(nc)\u3068\u3059\u308b\u3068\u3001ncdump -h\u3068\u3057\u305f\u6642\u3068\u540c\u3058\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\nFile ./wrfout_d01_2014-02-01_00_00_00 (NC_FORMAT_64BIT):\n\n     146 variables (excluding dimension variables):\n        char Times[DateStrLen,Time]   \n        float LU_INDEX[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: LAND USE CATEGORY\n            units: \n            stagger: \n            coordinates: XLONG XLAT\n            .\n            .\n            .\n            .\n            .\n\n        float LANDMASK[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: LAND MASK (1 FOR LAND, 0 FOR WATER)\n            units: \n            stagger: \n            coordinates: XLONG XLAT\n        float SST[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: SEA SURFACE TEMPERATURE\n            units: K\n            stagger: \n            coordinates: XLONG XLAT\n\n     10 dimensions:\n        Time  Size:24   *** is unlimited ***\n        DateStrLen  Size:19\n        west_east  Size:94\n        south_north  Size:74\n        bottom_top  Size:37\n        bottom_top_stag  Size:38\n        soil_layers_stag  Size:4\n        west_east_stag  Size:95\n        south_north_stag  Size:75\n        land_cat_stag  Size:24\n\n    98 global attributes:\n        TITLE:  OUTPUT FROM WRF V3.4.1 MODEL\n        DX: 81000\n        DY: 81000\n        .\n        .\n        .\n\n\u3000\u591a\u3059\u304e\u308b\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u3002\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3059\u308b\u969b\u306b\u306f\u3001\u5909\u6570(variable)\u3068\u6b21\u5143\u6570(dimension)\u306e\u60c5\u5831\u3092\u3082\u3068\u306b\u8aad\u307f\u89e3\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\u3000\u5909\u6570\u306f\u3001\u30c7\u30fc\u30bf\u306e\u540d\u524d\u3067\u3042\u308a\u3001WRF\u306e\u51fa\u529b\u3067\u306f\u6c17\u6e29(T)\u3084\u5730\u8868\u9762\u6c17\u5727(PSFC)\u3001\u7def\u5ea6\uff08XLONG)\u3001\u7d4c\u5ea6(XLAT)\u306a\u3069\u591a\u304f\u306e\u5909\u6570\u304c\u3042\u308a\u307e\u3059\u3002\n\u3000\u6b21\u5143\u6570\u306f\u7def\u5ea6\u3001\u7d4c\u5ea6\u3001\u9ad8\u3055\u3001\u6642\u9593\u306a\u3069\u306e\u60c5\u5831\u306b\u8a72\u5f53\u3057\u3001\u305d\u306e\u5185\u5bb9\u306fprint(nc)\u3057\u305f\u3068\u304d\u306bdimentions:\u3068\u3057\u3066\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\u3048\u3070\u3001print()\u3067\u51fa\u529b\u3055\u308c\u305f\u3001\u6c17\u6e29(T)\u306e\u60c5\u5831\u3092\u898b\u3066\u3044\u304f\u3068\nfloat T[west_east,south_north,bottom_top,Time]   \n    FieldType: 104\n    MemoryOrder: XYZ\n    description: perturbation potential temperature (theta-t0)\n    units: K\n    stagger: \n    coordinates: XLONG XLAT\n\n\u3000\u3053\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u6570\u540d\uff08T)\u306e\u3042\u3068\u306b\u6b21\u5143\u6570(west_east,south_north,bottom_top,Time)\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u3001T\u5909\u6570\u304c\u7d4c\u5ea6(west_east)\u3001\u7def\u5ea6(south_north)\u3001\u9ad8\u3055(bottom_top)\u3001\u6642\u9593(Time)\u306e\u6b21\u5143\u6570\u3092\u6301\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u5358\u4f4d(units)\u306f\u30b1\u30eb\u30d3\u30f3(K)\u3067\u3059\u3002\n\u3000\u3053\u306e\u5909\u6570T\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\nT <- ncvar_get(nc, \"T\")\n\n\u3000\u62bd\u51fa\u3057\u305fT\u306e\u6b21\u5143\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3068...\n> dim(T)\n[1] 94 74 37 24\n\n\u3000\u3068\u306a\u3063\u3066\u3001\u5148\u307b\u3069\u306e\u6b21\u5143\u6570(west_east,south_north,bottom_top,Time)\u306e\u9806\u756a\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u6771\u897f4\u30fb\u5357\u531712\u306e\u4f4d\u7f6e\u306e\u3001\u6700\u4e0b\u5c64\u30fb10\u6642\u9593\u76ee\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3002\n> T[4, 12, 1, 10]\n[1] -0.7268804\n## ncvar_get(nc, \"T\")[4, 12, 1, 10]\u3068\u3057\u3066\u3082\u540c\u3058\n\n\u3000\u3042\u308b\u6b21\u5143\u306e\u30c7\u30fc\u30bf\u3092\u3059\u3079\u3066\u66f8\u304d\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u6b21\u5143\u6570\u3092\u7a7a\u767d\u306b\u3059\u308b\u3002\u8a66\u3057\u306b\u6771\u897f4\u30fb\u5357\u531712\u306e\u4f4d\u7f6e\u30fb10\u6642\u9593\u76ee\u306e\u30c7\u30fc\u30bf\u3092\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u3059\u3079\u3066\u51fa\u529b\u3059\u308b\u3002\n> T[4, 12, , 10]\n [1]  -0.72688037  -0.74692106  -0.74950713  -0.74189156  -0.38697922\n [6]   0.03983501   0.49886507   1.57127380   3.51204228   6.52097797\n[11]   9.38071728  12.41840744  15.76916504  18.81344604  21.68756104\n[16]  24.52053833  27.69459343  31.33041191  34.73131561  37.54943085\n[21]  39.70961761  41.24932861  42.43940735  43.66003036  45.37441635\n[26]  47.49922943  49.54561234  51.56838989  53.93046951  56.02065659\n[31]  59.96704483  66.28604889  77.90301514  95.81775665 118.12465668\n[36] 140.97705078 164.84016418\n\n\u3000\u6b21\u306b\u3001\u540c\u3058\u6761\u4ef6\u3067\u3001\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u306e\u5e73\u5747\u5024\u3092\u629c\u304d\u51fa\u3057\u305f\u3044\u5834\u5408\u3001mean(T[4, 12, , 10]\u3068\u3059\u308b\u3068\u6c42\u307e\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u3060\u30682\u3064\u4ee5\u4e0a\u306e\u6b21\u5143\u3067\u306f\u4f7f\u3048\u306a\u3044\u3002\u4f8b\u3048\u3070\u3001mean(T[4, 12, , ])\u3068\u3057\u3066\u3001\u6642\u9593\u3054\u3068\u306b\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u306e\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\u3000\u3053\u306e\u3088\u3046\u306a\u3068\u304d\u306fapply()\u95a2\u6570\u3092\u4f7f\u3046\u3002\n> x <- T[4, 12, , ]\n\n> dim(x)\n[1] 37 24 ## \u9ad8\u3055\u3001\u6642\u9593\n\n> mean(x)\n[1] 38.79975\n\n> apply(x, 2, mean)\n [1] 38.72858 38.71227 38.72974 38.75706 38.78006 38.79540 38.81224 38.82204\n [9] 38.84623 38.85404 38.86388 38.85925 38.84810 38.85500 38.85953 38.85500\n[17] 38.84894 38.85622 38.86247 38.83385 38.78480 38.72373 38.67199 38.63350\n\n\u3000apply(data, margin, function)\u95a2\u6570\u3067\u306f\u3001data\u3067\u6307\u5b9a\u3057\u305f\u914d\u5217\u306b\u3001function\u3067\u6307\u5b9a\u3057\u305f\u95a2\u6570\u3092margin\u3067\u6307\u5b9a\u3057\u305f\u6b21\u5143\u306b\u9069\u5fdc\u3057\u305f\u7d50\u679c\u3092\u8fd4\u3059\u3002\n\u3000margin\u306e\u6570\u5b57\u306f\u6b21\u5143\u306e\u9806\u756a\u3067\u3042\u308a\u3001(west_east,south_north,bottom_top,Time)\u306e\u6b21\u5143\u3092\u6301\u3064\u30c7\u30fc\u30bf\u3067\u306f\u3001west_east,south_north,bottom_top,Time\u306e\u9806\u756a\u30671\u301c4\u306e\u6570\u5b57\u304c\u5272\u308a\u632f\u3089\u308c\u308b\u3002\n\u3000\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u30012\u6b21\u5143\u306e\u914d\u5217x\u306b\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u95a2\u6570mean\u3092\u6642\u9593\u3054\u3068\u306b\u9069\u5fdc\u3055\u305b\u305f\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u305f\u3002margin\u30921\u306b\u3059\u308b\u3068\u3001\u9ad8\u3055\u3054\u3068\u306e\u3001\u6642\u9593\u5e73\u5747\u5024\u304c\u8fd4\u308b\u3002\n> apply(x, 1, mean)\n [1]  -1.0751176  -1.1103524  -1.1106088  -1.0420452  -0.8099559  -0.3352173\n [7]   0.2404019   1.7825204   4.3521008   7.0892539   9.5852735  12.4250741\n[13]  15.6243184  18.6672581  21.5216343  24.3097252  27.5070387  31.0727283\n[19]  34.4129815  37.2718484  39.4816875  41.0503216  42.3647316  43.7326900\n[25]  45.3379526  47.2209280  49.2762682  51.5797598  54.2426057  56.3446231\n[31]  60.2103895  66.4429398  78.1916310  96.3676236 118.6383750 140.8374748\n[37] 163.8917669\n\n\u3000\u3082\u3057\u3001\u7def\u5ea6\u30fb\u7d4c\u5ea6\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u5e73\u9762\u4e0a\u3067\u306e\u6700\u4e0b\u5c64\u306e\u671f\u9593\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3002\n> head(apply(T[,,1,], c(1,2), mean))\n            [,1]        [,2]        [,3]        [,4]        [,5]        [,6]\n[1,]  0.01576137  0.04714638  0.05050302  0.02025020 -0.02503504 -0.03634928\n[2,] -0.03251573 -0.07180138 -0.04693846 -0.04799919 -0.09376347 -0.19082553\n[3,] -0.05194719 -0.06634700 -0.09137851 -0.11628789 -0.13117390 -0.16278988\n[4,] -0.08131074 -0.03762976 -0.09773546 -0.34580672 -0.54329378 -0.48351659\n[5,] -0.09038579  0.00158573 -0.08224722 -0.32997115 -0.91169928 -0.93532613\n[6,] -0.13368743 -0.02925559 -0.05932397 -0.20304477 -0.76751008 -0.79081073\n   .\n   .\n   .\n   .\n   .\n         [,68]     [,69]     [,70]     [,71]     [,72]     [,73]     [,74]\n[1,] -44.89541 -47.00260 -50.54811 -53.16967 -52.98195 -53.79609 -46.89111\n[2,] -43.25560 -46.82128 -49.70825 -51.41909 -52.70751 -53.46209 -55.92016\n[3,] -39.67345 -43.78516 -47.86383 -50.77978 -52.87378 -53.38339 -54.67168\n[4,] -36.44224 -40.21573 -46.46169 -51.48956 -53.84814 -53.79808 -53.39638\n[5,] -36.27189 -39.76556 -46.03089 -51.26846 -53.19774 -53.35141 -52.82303\n[6,] -40.24731 -42.20425 -46.12080 -50.63491 -52.61677 -52.13189 -50.25226\n\n\u3000\u3053\u308c\u3060\u3051\u308f\u304b\u308c\u3070\u3001NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u4efb\u610f\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3001\u5e73\u5747\u5024\u306a\u3069\u306b\u52a0\u5de5\u3057\u3066\u30b0\u30e9\u30d5\u306b\u3059\u308b\u3053\u3068\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\nNetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u3000WRF\u3084CMAQ\u306e\u51fa\u529b\u306fNetCDF\u5f62\u5f0f\u3067\u3042\u308a\u3001\u8a08\u7b97\u7d50\u679c\u304c\u5909\u6570\u306b\u5206\u5272\u3055\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3002WRF\u306e\u7d50\u679c\u3067\u3082\u6e7f\u5ea6\u3084\u6d77\u9762\u66f4\u6b63\u6c17\u5727\u3001\u98a8\u5411\u3001\u98a8\u901f\u306a\u3069\u306f\u3088\u304f\u4f7f\u7528\u3059\u308b\u304c\u3001\u305d\u306e\u307e\u307e\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u3044\u304f\u3064\u304b\u306e\u5909\u6570\u306b\u5225\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8a08\u7b97\u5f0f\u306b\u5f53\u3066\u306f\u3081\u3066\u5909\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30001\u5730\u70b9\u306e\u5730\u4e0a\u4ed8\u8fd1\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u304c\u6b32\u3057\u3044\u5834\u5408\u306f\u3001\u5148\u307b\u3069\u306e\u3088\u3046\u306bncvar_get()\u3084apply()\u95a2\u6570\u3092\u4f7f\u3063\u3066\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3001csv\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306b\u66f8\u304d\u3060\u3057\u3066\u304a\u3051\u3070\u826f\u3044\u3002\u3057\u304b\u3057\u3001\u7def\u5ea6\u30fb\u7d4c\u5ea6\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u5e73\u9762\u7a7a\u9593\u3067\u306e\u30c7\u30fc\u30bf\u3092\u6642\u9593\u3054\u3068\u306b\u307b\u3057\u3044\u5834\u5408\u306f\u3001csv\u30d5\u30a1\u30a4\u30eb\u3092\u6642\u9593\u6570\u5206\u4f5c\u3089\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044(csv\u30d5\u30a1\u30a4\u30eb\u306f2\u6b21\u5143\u307e\u3067\u3057\u304b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3067\u304d\u306a\u3044)\u3002CMAQ\u306f\u7c92\u5b50\u306e\u7d50\u679c\u304c\u3044\u304f\u3064\u304b\u306e\u5909\u6570\u306b\u5225\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30c7\u30fc\u30bf\u3092\u5fc5\u8981\u3068\u3059\u308b\u5ea6\u306b\u5909\u63db\u3059\u308b\u306e\u306f\u306a\u304b\u306a\u304b\u3081\u3093\u3069\u304f\u3055\u3044\u3002\n\u3000\u305d\u3053\u3067\u3001\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u3092\u3001\u5148\u306b\u3059\u3079\u3066\u5909\u63db\u3057\u3001\u307e\u3068\u3081\u3066NetCDF\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u7ba1\u3059\u308b\u3002\u3053\u3046\u3059\u308b\u3068NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3059\u3060\u3051\u3067\u6b32\u3057\u3044\u30c7\u30fc\u30bf\u304c\u624b\u306b\u5165\u308a\u3001\u66f4\u306b\u683c\u7d0d\u5909\u6570\u304c\u6e1b\u308b\u305f\u3081\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u304f\u306a\u308a\u3001\u6271\u3044\u3084\u3059\u304f\u306a\u308b\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3002\n\u3000ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306f\u4e00\u901a\u308aNetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u306b\u95a2\u3059\u308b\u95a2\u6570\u304c\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u3002\n\nNetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u624b\u9806\n\u7c21\u5358\u306b\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u4f5c\u6210\u3059\u308b\u3002\n1. \u6b21\u5143\u306e\u5b9a\u7fa9\n2. \u5909\u6570\u306e\u5b9a\u7fa9\n3. NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n4. \u5909\u6570\u30fb\u5c5e\u6027\u306b\u5024\u3092\u5165\u529b\n\nWRF\u306e\u7d50\u679c\u3092\u7de8\u96c6\u3057\u3001\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3060\u3051NetCDF\u5f62\u5f0f\u306b\u307e\u3068\u3081\u308b\n\u3000\u307e\u305a\u306f\u4f8b\u306e\u3054\u3068\u304f\u3001WRF\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u3002\nlibrary(ncdf4)\nWRF <- nc_open(\"wrfout_d01_2014-02-01_00_00_00\")\n\n\u3000print(WRF)\u3068\u3059\u308b\u3068\u3001\u6b21\u5143\u60c5\u5831(dimention)\u306b\u6b21\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3002\n10 dimensions:\n   Time  Size:24   *** is unlimited ***\n   DateStrLen  Size:19\n   west_east  Size:94\n   south_north  Size:74\n   bottom_top  Size:37\n   bottom_top_stag  Size:38\n   soil_layers_stag  Size:4\n   west_east_stag  Size:95\n   south_north_stag  Size:75\n   land_cat_stag  Size:24\n\n\u3000\u3053\u306e\u6b21\u5143\u6570\u3092\u4f7f\u3063\u3066\u65b0\u3057\u3044\u6b21\u5143\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\nnt <- 24  ## Time Size       \nnx <- 94  ## west_east Size   \nny <- 74  ## south_north Size   \nnz <- 37  ## bottom_top Size     \ndate.strength <- 19  ## DateStrLen Size\n\n\u3000\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304f\u3002\u307e\u305a\u306f\u6642\u9593\u60c5\u5831\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u308b\u3068UTC(\u5354\u5b9a\u4e16\u754c\u6642)\u306a\u306e\u3067\u3001JST(\u65e5\u672c\u6a19\u6e96\u6642)\u306b\u5909\u63db\u3059\u308b\u3002\n> ncvar_get(WRF, \"Times\")\n [1] \"2014-02-01_00:00:00\" \"2014-02-01_01:00:00\" \"2014-02-01_02:00:00\"\n [4] \"2014-02-01_03:00:00\" \"2014-02-01_04:00:00\" \"2014-02-01_05:00:00\"\n [7] \"2014-02-01_06:00:00\" \"2014-02-01_07:00:00\" \"2014-02-01_08:00:00\"\n[10] \"2014-02-01_09:00:00\" \"2014-02-01_10:00:00\" \"2014-02-01_11:00:00\"\n[13] \"2014-02-01_12:00:00\" \"2014-02-01_13:00:00\" \"2014-02-01_14:00:00\"\n[16] \"2014-02-01_15:00:00\" \"2014-02-01_16:00:00\" \"2014-02-01_17:00:00\"\n[19] \"2014-02-01_18:00:00\" \"2014-02-01_19:00:00\" \"2014-02-01_20:00:00\"\n[22] \"2014-02-01_21:00:00\" \"2014-02-01_22:00:00\" \"2014-02-01_23:00:00\"\n\nstr.T <- as.POSIXlt(paste(substring(ncvar_get(WRF, \"Times\")[1], 1, 10), \"00:00:00\", sep=\" \"), \"%Y-%m-%d %H:%M:%OS\") + 9*60*60\nJST <- seq(str.T, by=\"hour\", length=nt)\n\n> JST\n [1] \"2014-02-01 09:00:00\" \"2014-02-01 10:00:00\" \"2014-02-01 11:00:00\"\n [4] \"2014-02-01 12:00:00\" \"2014-02-01 13:00:00\" \"2014-02-01 14:00:00\"\n [7] \"2014-02-01 15:00:00\" \"2014-02-01 16:00:00\" \"2014-02-01 17:00:00\"\n[10] \"2014-02-01 18:00:00\" \"2014-02-01 19:00:00\" \"2014-02-01 20:00:00\"\n[13] \"2014-02-01 21:00:00\" \"2014-02-01 22:00:00\" \"2014-02-01 23:00:00\"\n[16] \"2014-02-02 00:00:00\" \"2014-02-02 01:00:00\" \"2014-02-02 02:00:00\"\n[19] \"2014-02-02 03:00:00\" \"2014-02-02 04:00:00\" \"2014-02-02 05:00:00\"\n[22] \"2014-02-02 06:00:00\" \"2014-02-02 07:00:00\" \"2014-02-02 08:00:00\"\n\n\u3000\u6b21\u306b\u5909\u6570\u60c5\u5831\u3092\u629c\u304d\u51fa\u3057\u3066\u3044\u304f\u3002\u6b21\u5143\u6570\u304c\u5909\u6570\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u304c\u3001\u4eca\u56de\u306f\u6642\u9593\u60c5\u5831\u30921\u6b21\u5143\u3001\u4f4d\u7f6e\u60c5\u5831\u30922\u6b21\u5143\u3001\u305d\u308c\u4ee5\u5916\u30923,4\u6b21\u5143\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n## \u4f4d\u7f6e\u30c7\u30fc\u30bf\nlon <- array(ncvar_get(WRF, \"XLONG\")[,,1], dim=c(nx, ny)) # degree\nlat <- array(ncvar_get(WRF, \"XLAT\")[,,1], dim=c(nx, ny)) # degree\nhgt <- array(ncvar_get(WRF, \"HGT\")[,,1], dim=c(nx, ny, nt)) # terrain elevation\n\n## \u6c17\u6e29\u3001\u6e7f\u5ea6\u3001\u964d\u6c34\u91cf\u3001\u6c17\u5727\u3001\u98a8\u901f\u3001\u5883\u754c\u5c64\u9ad8\u5ea6\u30c7\u30fc\u30bf\nt2 <- array(ncvar_get(WRF, \"T2\"), dim=c(nx, ny, nt)) - 273.15 ## \u5730\u4e0a2m\u306e\u6c17\u6e29(\u2103)\nQ2 <- array(ncvar_get(WRF, \"Q2\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a2m\u306e\u6df7\u5408\u6bd4(\u6c34\u84b8\u6c17\u8cea\u91cfkg/\u4e7e\u71e5\u7a7a\u6c17\u8cea\u91cfkg)\nPHUM <- 6.1078*10^(\n  7.5*(t2)/((t2)+237.3)\n)#\u98fd\u548c\u6c34\u84b8\u6c17\u5727\u306e\u8a08\u7b97\u3002Tetens\u306e\u5f0f\u3060\u304c\u3001Goff-Gratch\u306e\u5f0f\u3068\u8fd1\u4f3c\u3067\u304d\u308b\u3002\nrh <- (100*psfc*Q2)/(PHUM*(0.622+Q2)) # \u5730\u4e0a2m\u306e\u6e7f\u5ea6(%)\nrain <- array(ncvar_get(WRF, \"RAINC\"), dim=c(nx, ny, nt)) ## \u7d2f\u7a4d\u964d\u6c34\u91cf\npsfc <- array(ncvar_get(WRF, \"PSFC\"), dim=c(nx, ny, nt))/100 ## \u5730\u8868\u9762\u6c17\u5727(hPa)\npres <- psfc*(1-0.0065*hgt/(t2+273.15+0.0065*hgt))^(-5.257) ## \u6d77\u9762\u66f4\u6b63\u6c17\u5727\npblh <- array(ncvar_get(WRF, \"PBLH\"), dim=c(nx, ny, nt)) # \u5883\u754c\u5c64\u9ad8\u5ea6\nU10 <- array(ncvar_get(WRF, \"U10\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a10m\u6771\u897f\u65b9\u5411\u98a8\u901f(m/s)\nV10 <- array(ncvar_get(WRF, \"V10\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a10m\u5357\u5317\u65b9\u5411\u98a8\u901f\n\n## 4\u6b21\u5143\u6c17\u6e29\u3001\u98a8\u901f\u30c7\u30fc\u30bf\ntemp <- array(ncvar_get(WRF, \"T\"), dim=c(nx, ny, nz, nt)) - 273.15 ## \u5168\u5c64\u6c17\u6e29(\u2103)\nU <- array(ncvar_get(WRF, \"U\"), dim=c(nx, ny, nz, nt)) ## \u5168\u5c64\u6771\u897f\u65b9\u5411\u98a8\u901f(m/s)\nV <- array(ncvar_get(WRF, \"V\"), dim=c(nx, ny, nz, nt)) ## \u5168\u5c64\u6771\u5357\u5317\u5411\u98a8\u901f(m/s) \n\n\u3000\u6b21\u5143\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\ntdim <- ncdim_def(\"Time\", \"\", 1:nt, unlim=TRUE, create_dimvar=FALSE) ##\u3000\u6642\u9593\u6570\nxdim <- ncdim_def(\"west_east\",\"\", 1:nx, create_dimvar=FALSE) ## \u6771\u897f\u30b0\u30ea\u30c3\u30c9\u6570\nydim <- ncdim_def(\"south_north\",\"\", 1:ny, create_dimvar=FALSE)  ## \u5357\u5317\u30b0\u30ea\u30c3\u30c9\u6570\nzdim <- ncdim_def(\"bottom_to_top\",\"\", 1:nz, create_dimvar=FALSE)  ## \u9ad8\u3055\u30b0\u30ea\u30c3\u30c9\u6570\nchar.dim <- ncdim_def(\"date_strength\",\"\", 1:date.strength, create_dimvar=FALSE)  ## \u6642\u9593\u306e\u6587\u5b57\u5217\u9577\u3055\u6307\u5b9a(\"2014-01-01 00:00:00\"\u306719\u6587\u5b57)\n\n\u3000\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\ntime.var <- ncvar_def(\"TIME\", \"Date (JST)\", list(char.dim, tdim), prec=\"char\")\nlong.var <- ncvar_def(\"LON\", \"degreeE\", list(xdim, ydim), 1.e30, longname=\"Longitude\")\nlat.var <- ncvar_def(\"LAT\", \"degreeN\", list(xdim, ydim), 1.e30, longname=\"Latitude\")\ntemp2.var <- ncvar_def(\"TEMP2\", \"degree C\", list(xdim, ydim, tdim), 1.e30, longname=\"Temperature at 2m\")\nrh.var <- ncvar_def(\"RH\", \"percent (%)\", list(xdim, ydim, tdim), 1.e30, longname=\"Humidity at 2m\")\nrain.var <- ncvar_def(\"RAIN\", \"mm\", list(xdim, ydim, tdim), 1.e30, longname=\"Total Precipitation\")\npres.var <- ncvar_def(\"SEA_PRES\", \"hPa\", list(xdim, ydim, tdim), 1.e30, longname=\"Sea Level Correction Pressure\")\nprsfc.var <- ncvar_def(\"PRSFC\", \"hPa\", list(xdim, ydim, tdim), 1.e30, longname=\"Surface pressure\")\npblh.var <- ncvar_def(\"PBLH\", \"m\", list(xdim, ydim, tdim), 1.e30, longname=\"Planetary boundary layer height\")\nu10.var <- ncvar_def(\"U10\", \"m/s\", list(xdim, ydim, tdim), 1.e30, longname=\"west_east Wind speedat 10m\")\nv10.var <- ncvar_def(\"V10\", \"m/s\", list(xdim, ydim, tdim), 1.e30, longname=\"south_north Wind speed at 10m\")\n\ntemp.var <- ncvar_def(\"TEMP\", \"degree C\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"Temperature\")\nu.var <- ncvar_def(\"U\", \"m/s\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"west_east Wind\")\nv.var <- ncvar_def(\"V\", \"m/s\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"south_north Wind speed\")\n\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\nnc <- nc_create(filename=\"./data.nc\",\n                list(time.var, long.var, lat.var,\n                     temp2.var, rh.var, rain.var, \n                     pres.var, prsfc.var, pblh.var,u10.var, v10.var,\n                     temp.var, u.var, v.var\n                     )\n                )\n\n\u3000\u5c5e\u6027\u3092\u5b9a\u7fa9\u307e\u3059\u3002\u5b9a\u7fa9\u306e\u65b9\u6cd5\u306fncatt_put(file_name, varid, attname, value)\u3067\u3001varid\u306b\u3001\u5c5e\u6027\u3092\u3064\u3051\u308b\u5909\u6570\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002varid\u3092\"0\"\u306b\u3059\u308b\u3068\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u5c5e\u6027\u306b\u306a\u308a\u307e\u3059\u3002attname\u3067\u5c5e\u6027\u540d\u3001value\u3067\u5c5e\u6027\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4eca\u56de\u306f\u7c21\u5358\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u5c5e\u6027\u3060\u3051\u6307\u5b9a\u3057\u307e\u3059\u3002\nncatt_put(nc, 0, \"CEN_LAT\", 33.3389205932617)  ## \u8a08\u7b97\u4e2d\u5fc3\u4f4d\u7f6e\u306e\u7def\u5ea6\nncatt_put(nc, 0, \"CEN_LON\", 122.964904785156)  ## \u8a08\u7b97\u4e2d\u5fc3\u4f4d\u7f6e\u306e\u7d4c\u5ea6 \n\n\u3000\u4f5c\u6210\u3057\u305fNetCDF\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u6b21\u5143\u3001\u5909\u6570\u306f\u3042\u308a\u307e\u3059\u304c\u30c7\u30fc\u30bf\u304c\u7a7a\u306e\u72b6\u614b\u306a\u306e\u3067\u3001\u3055\u3063\u304d\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u5b9a\u7fa9\u306e\u65b9\u6cd5\u306f\u3001ncvar_put(file_name, varid, vals, start, count)\u3067\u3001varid\u3067\u5024\u3092\u5165\u308c\u308b\u5909\u6570\u540d\u3001vals\u3067\u5165\u529b\u3059\u308b\u5024\u3001start\u3067\u5024\u3092\u5165\u308c\u308b\u6700\u521d\u306e\u4f4d\u7f6e\u6307\u5b9a\u3001count\u3067\u6b21\u5143\u3092\u6307\u5b9a\u3059\u308b\u3002start\u306f\u3059\u3079\u30661\u3067\u554f\u984c\u306a\u304f\u3001count\u306f\u5909\u6570\u306e\u5b9a\u7fa9\u306e\u6642\u306b\u6307\u5b9a\u3057\u305f\u6b21\u5143\u3092\u305d\u306e\u307e\u307e\u6307\u5b9a\u3059\u308c\u3070\u3088\u3044\u3002\nncvar_put(nc, long.var, lon, start=c(1,1), count=c(nx,ny))\nncvar_put(nc, lat.var, lat, start=c(1,1), count=c(nx,ny))\nncvar_put(nc, temp2.var, t2, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, rh.var, rh, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, rain.var, rain, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, pres.var, pres, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, prsfc.var, psfc, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, pblh.var, pblh, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, u10.var, U10, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, v10.var, V10, start=c(1,1,1), count=c(nx,ny,nt))\n\nncvar_put(nc, temp.var, temp, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\nncvar_put(nc, u.var, U, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\nncvar_put(nc, v.var, V, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\n\nncvar_put(nc, time.var, JST)\nnc_close(nc)  ## \u6700\u5f8c\u306b\u4f5c\u8a5e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\u3002\n\n\u3000\u4f55\u6545\u304b\u6642\u9593\u5909\u6570\u306e\u5165\u529b\u306f\u3001\u4e00\u756a\u6700\u5f8c\u3067\u306a\u3044\u3068\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3000\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u7aef\u672b\u304b\u3089ncdump\u3057\u3066\u307f\u307e\u3059\u3002\n\nbash\n$ ncdump -h ./data.nc \nnetcdf data {\ndimensions:\n    date_strength = 19 ;\n    Time = UNLIMITED ; // (24 currently)\n    west_east = 94 ;\n    south_north = 74 ;\n    bottom_to_top = 37 ;\nvariables:\n    char TIME(Time, date_strength) ;\n        TIME:units = \"Date (JST)\" ;\n    float LON(west_east, south_north) ;\n        LON:units = \"degreeE\" ;\n        LON:_FillValue = 1.e+30f ;\n        LON:long_name = \"Longitude\" ;\n    float LAT(west_east, south_north) ;\n        LAT:units = \"degreeN\" ;\n        LAT:_FillValue = 1.e+30f ;\n        LAT:long_name = \"Latitude\" ;\n    float TEMP2(Time, west_east, south_north) ;\n        TEMP2:units = \"degree C\" ;\n        TEMP2:_FillValue = 1.e+30f ;\n        TEMP2:long_name = \"Temperature at 2m\" ;\n    float RH(Time, west_east, south_north) ;\n        RH:units = \"percent (%)\" ;\n        RH:_FillValue = 1.e+30f ;\n        RH:long_name = \"Humidity at 2m\" ;\n    float RAIN(Time, west_east, south_north) ;\n        RAIN:units = \"mm\" ;\n        RAIN:_FillValue = 1.e+30f ;\n        RAIN:long_name = \"Total Precipitation\" ;\n    float SEA_PRES(Time, west_east, south_north) ;\n        SEA_PRES:units = \"hPa\" ;\n        SEA_PRES:_FillValue = 1.e+30f ;\n        SEA_PRES:long_name = \"Sea Level Correction Pressure\" ;\n    float PRSFC(Time, west_east, south_north) ;\n        PRSFC:units = \"hPa\" ;\n        PRSFC:_FillValue = 1.e+30f ;\n        PRSFC:long_name = \"Surface pressure\" ;\n    float PBLH(Time, west_east, south_north) ;\n        PBLH:units = \"m\" ;\n        PBLH:_FillValue = 1.e+30f ;\n        PBLH:long_name = \"Planetary boundary layer height\" ;\n    float U10(Time, west_east, south_north) ;\n        U10:units = \"m/s\" ;\n        U10:_FillValue = 1.e+30f ;\n        U10:long_name = \"west_east Wind speedat 10m\" ;\n    float V10(Time, west_east, south_north) ;\n        V10:units = \"m/s\" ;\n        V10:_FillValue = 1.e+30f ;\n        V10:long_name = \"south_north Wind speed at 10m\" ;\n    float TEMP(Time, bottom_to_top, west_east, south_north) ;\n        TEMP:units = \"degree C\" ;\n        TEMP:_FillValue = 1.e+30f ;\n        TEMP:long_name = \"Temperature\" ;\n    float U(Time, bottom_to_top, west_east, south_north) ;\n        U:units = \"m/s\" ;\n        U:_FillValue = 1.e+30f ;\n        U:long_name = \"west_east Wind\" ;\n    float V(Time, bottom_to_top, west_east, south_north) ;\n        V:units = \"m/s\" ;\n        V:_FillValue = 1.e+30f ;\n        V:long_name = \"south_north Wind speed\" ;\n\n// global attributes:\n        :CEN_LAT = 33.3389205932617 ;\n        :CEN_LON = 122.964904785156 ;\n}\n\n\n\n\u3000\u3082\u3061\u308d\u3093\u3001ncview\u3067\u958b\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u3000\u6d77\u9762\u66f4\u6b63\u6c17\u5727\u3084\u6e7f\u5ea6\u306f\u3059\u3079\u3066\u8a08\u7b97\u3057\u3066\u3042\u308a\u3001\u307e\u305f\u3001\u5143\u306f500MB\u7a0b\u5ea6\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c80MB\u7a0b\u5ea6\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6b21\u56de\u304b\u3089\u7c21\u5358\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\u3000\u305f\u3060\u3001\u6b21\u5143\u3001\u5c5e\u6027\u3092\u304d\u3061\u3093\u3068\u4ed8\u3051\u306a\u3044\u3068\u3001WRF\u5c02\u7528\u306eviewer\u3067\u306f\u958b\u3051\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u3092\u76ee\u7684\u3068\u3057\u305fNetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u3067\u3059\u306e\u3067\u3053\u3053\u307e\u3067\u306b\u3057\u307e\u3059\u3002\n#NetCDF\u306b\u3064\u3044\u3066\n\u3000\u5927\u6c17\u30fb\u6d77\u6d0b\u7cfb\u306e\u7814\u7a76\u3067\u7528\u3044\u3089\u308c\u3066\u3044\u308bNetCDF\u30d5\u30a1\u30a4\u30eb\u306f\u5909\u6570\u3001\u6b21\u5143\u6570\u3001\u5c5e\u6027\u60c5\u5831\u3092\u6301\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u5f62\u5f0f\u3067\u30014\u6b21\u5143\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u306b\u9069\u3057\u3066\u3044\u308b\u3002C\u3084Fortran\u3067\u6271\u308f\u308c\u308b\u3053\u3068\u304c\u591a\u3044NetCDF\u3092\u3001R\u3067\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u30e1\u30e2\u3092\u6b8b\u3057\u307e\u3059\u3002\n\u3000R\u3067\u306f\u3001ncdf4\u3084RNetCDF\u3068\u3044\u3063\u305f\u3001NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u4eca\u56de\u306fNetCDF4\u306b\u5bfe\u5fdc\u3057\u305fncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u8aac\u660e\u3057\u307e\u3059\u3002\n\u3000NetCDF\u306b\u3064\u3044\u3066\u306e\u8a73\u3057\u3044\u8aac\u660e\u306f\u7701\u7565\u3057\u307e\u3059\u3002[Fortran\u7248NetCDF\u30e6\u30fc\u30b6\u30fc\u30de\u30cb\u30e5\u30a2\u30eb](https://www.gfd-dennou.org/arch/ucar/netcdf-jman/fguide_ja02.pdf)\u306b\u65e5\u672c\u8a9e\u7248\u306e\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308a\u307e\u3059\u306e\u3067\u3001\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002[C\u7248\u306e\u30de\u30cb\u30e5\u30a2\u30eb](https://www.gfd-dennou.org/arch/ucar/netcdf-jman/cguide_ja02.pdf)\u3082\u5b58\u5728\u3057\u307e\u3059\u3002\n\n##R\u3067NetCDF\u3092\u6271\u3046\u305f\u3081\u306b\n\u3000\u307e\u305a\u3001ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```r\ninstall.packages(\"ncdf4\")\nlibrary(ncdf4)\n```\n\u3000ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u3067\u3088\u304f\u4f7f\u7528\u3059\u308b\u95a2\u6570\u3092\u8aac\u660e\u3057\u307e\u3059\u3002ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30de\u30cb\u30e5\u30a2\u30eb\u306f[CRAN\u30b5\u30a4\u30c8](https://cran.r-project.org/web/packages/ncdf4/index.html)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u3092R\u3067\u8aad\u307f\u8fbc\u3080\u3068\u304d\u306f`nc_open()`\u95a2\u6570\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u3000\u8a66\u3057\u306bWRF\u306e\u8a08\u7b97\u7d50\u679c\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u3002\n\n```r\nnc <- nc_open(\"wrfout_d01_2014-02-01_00_00_00\")\n```\n\u3000\u3053\u306e\u307e\u307eprint(nc)\u3068\u3059\u308b\u3068\u3001`ncdump -h`\u3068\u3057\u305f\u6642\u3068\u540c\u3058\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n```r\nFile ./wrfout_d01_2014-02-01_00_00_00 (NC_FORMAT_64BIT):\n\n     146 variables (excluding dimension variables):\n        char Times[DateStrLen,Time]   \n        float LU_INDEX[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: LAND USE CATEGORY\n            units: \n            stagger: \n            coordinates: XLONG XLAT\n            .\n            .\n            .\n            .\n            .\n\n        float LANDMASK[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: LAND MASK (1 FOR LAND, 0 FOR WATER)\n            units: \n            stagger: \n            coordinates: XLONG XLAT\n        float SST[west_east,south_north,Time]   \n            FieldType: 104\n            MemoryOrder: XY \n            description: SEA SURFACE TEMPERATURE\n            units: K\n            stagger: \n            coordinates: XLONG XLAT\n\n     10 dimensions:\n        Time  Size:24   *** is unlimited ***\n        DateStrLen  Size:19\n        west_east  Size:94\n        south_north  Size:74\n        bottom_top  Size:37\n        bottom_top_stag  Size:38\n        soil_layers_stag  Size:4\n        west_east_stag  Size:95\n        south_north_stag  Size:75\n        land_cat_stag  Size:24\n\n    98 global attributes:\n        TITLE:  OUTPUT FROM WRF V3.4.1 MODEL\n        DX: 81000\n        DY: 81000\n        .\n        .\n        .\n```\n\u3000\u591a\u3059\u304e\u308b\u306e\u3067\u7701\u7565\u3057\u307e\u3059\u3002\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3059\u308b\u969b\u306b\u306f\u3001\u5909\u6570(variable)\u3068\u6b21\u5143\u6570(dimension)\u306e\u60c5\u5831\u3092\u3082\u3068\u306b\u8aad\u307f\u89e3\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\u3000\u5909\u6570\u306f\u3001\u30c7\u30fc\u30bf\u306e\u540d\u524d\u3067\u3042\u308a\u3001WRF\u306e\u51fa\u529b\u3067\u306f\u6c17\u6e29(T)\u3084\u5730\u8868\u9762\u6c17\u5727(PSFC)\u3001\u7def\u5ea6\uff08XLONG)\u3001\u7d4c\u5ea6(XLAT)\u306a\u3069\u591a\u304f\u306e\u5909\u6570\u304c\u3042\u308a\u307e\u3059\u3002\n\u3000\u6b21\u5143\u6570\u306f\u7def\u5ea6\u3001\u7d4c\u5ea6\u3001\u9ad8\u3055\u3001\u6642\u9593\u306a\u3069\u306e\u60c5\u5831\u306b\u8a72\u5f53\u3057\u3001\u305d\u306e\u5185\u5bb9\u306f`print(nc)`\u3057\u305f\u3068\u304d\u306bdimentions:\u3068\u3057\u3066\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u3000\u4f8b\u3048\u3070\u3001`print()`\u3067\u51fa\u529b\u3055\u308c\u305f\u3001\u6c17\u6e29(T)\u306e\u60c5\u5831\u3092\u898b\u3066\u3044\u304f\u3068\n\n```r\nfloat T[west_east,south_north,bottom_top,Time]   \n    FieldType: 104\n    MemoryOrder: XYZ\n    description: perturbation potential temperature (theta-t0)\n    units: K\n    stagger: \n    coordinates: XLONG XLAT\n```\n\u3000\u3053\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u6570\u540d\uff08T)\u306e\u3042\u3068\u306b\u6b21\u5143\u6570(west_east,south_north,bottom_top,Time)\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u3001T\u5909\u6570\u304c\u7d4c\u5ea6(west_east)\u3001\u7def\u5ea6(south_north)\u3001\u9ad8\u3055(bottom_top)\u3001\u6642\u9593(Time)\u306e\u6b21\u5143\u6570\u3092\u6301\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u5358\u4f4d(units)\u306f\u30b1\u30eb\u30d3\u30f3(K)\u3067\u3059\u3002\n\u3000\u3053\u306e\u5909\u6570T\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n```r\nT <- ncvar_get(nc, \"T\")\n```\n\n\u3000\u62bd\u51fa\u3057\u305fT\u306e\u6b21\u5143\u6570\u3092\u78ba\u8a8d\u3059\u308b\u3068...\n\n```r\n> dim(T)\n[1] 94 74 37 24\n```\n\u3000\u3068\u306a\u3063\u3066\u3001\u5148\u307b\u3069\u306e\u6b21\u5143\u6570(west_east,south_north,bottom_top,Time)\u306e\u9806\u756a\u3067\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\u306a\u306e\u3067\u3001\u6771\u897f4\u30fb\u5357\u531712\u306e\u4f4d\u7f6e\u306e\u3001\u6700\u4e0b\u5c64\u30fb10\u6642\u9593\u76ee\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u6b21\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\n```r\n> T[4, 12, 1, 10]\n[1] -0.7268804\n## ncvar_get(nc, \"T\")[4, 12, 1, 10]\u3068\u3057\u3066\u3082\u540c\u3058\n```\n\n\u3000\u3042\u308b\u6b21\u5143\u306e\u30c7\u30fc\u30bf\u3092\u3059\u3079\u3066\u66f8\u304d\u51fa\u3057\u305f\u3044\u5834\u5408\u306f\u3001\u6b21\u5143\u6570\u3092\u7a7a\u767d\u306b\u3059\u308b\u3002\u8a66\u3057\u306b\u6771\u897f4\u30fb\u5357\u531712\u306e\u4f4d\u7f6e\u30fb10\u6642\u9593\u76ee\u306e\u30c7\u30fc\u30bf\u3092\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u3059\u3079\u3066\u51fa\u529b\u3059\u308b\u3002\n\n```r\n> T[4, 12, , 10]\n [1]  -0.72688037  -0.74692106  -0.74950713  -0.74189156  -0.38697922\n [6]   0.03983501   0.49886507   1.57127380   3.51204228   6.52097797\n[11]   9.38071728  12.41840744  15.76916504  18.81344604  21.68756104\n[16]  24.52053833  27.69459343  31.33041191  34.73131561  37.54943085\n[21]  39.70961761  41.24932861  42.43940735  43.66003036  45.37441635\n[26]  47.49922943  49.54561234  51.56838989  53.93046951  56.02065659\n[31]  59.96704483  66.28604889  77.90301514  95.81775665 118.12465668\n[36] 140.97705078 164.84016418\n```\n\n\u3000\u6b21\u306b\u3001\u540c\u3058\u6761\u4ef6\u3067\u3001\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u306e\u5e73\u5747\u5024\u3092\u629c\u304d\u51fa\u3057\u305f\u3044\u5834\u5408\u3001`mean(T[4, 12, , 10]`\u3068\u3059\u308b\u3068\u6c42\u307e\u308b\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u3060\u30682\u3064\u4ee5\u4e0a\u306e\u6b21\u5143\u3067\u306f\u4f7f\u3048\u306a\u3044\u3002\u4f8b\u3048\u3070\u3001`mean(T[4, 12, , ])`\u3068\u3057\u3066\u3001\u6642\u9593\u3054\u3068\u306b\u6700\u4e0b\u5c64\u304b\u3089\u6700\u4e0a\u5c64\u307e\u3067\u306e\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u3002\n\u3000\u3053\u306e\u3088\u3046\u306a\u3068\u304d\u306f`apply()`\u95a2\u6570\u3092\u4f7f\u3046\u3002\n\n```r\n> x <- T[4, 12, , ]\n\n> dim(x)\n[1] 37 24 ## \u9ad8\u3055\u3001\u6642\u9593\n\n> mean(x)\n[1] 38.79975\n\n> apply(x, 2, mean)\n [1] 38.72858 38.71227 38.72974 38.75706 38.78006 38.79540 38.81224 38.82204\n [9] 38.84623 38.85404 38.86388 38.85925 38.84810 38.85500 38.85953 38.85500\n[17] 38.84894 38.85622 38.86247 38.83385 38.78480 38.72373 38.67199 38.63350\n```\n\n\u3000`apply(data, margin, function)`\u95a2\u6570\u3067\u306f\u3001data\u3067\u6307\u5b9a\u3057\u305f\u914d\u5217\u306b\u3001function\u3067\u6307\u5b9a\u3057\u305f\u95a2\u6570\u3092margin\u3067\u6307\u5b9a\u3057\u305f\u6b21\u5143\u306b\u9069\u5fdc\u3057\u305f\u7d50\u679c\u3092\u8fd4\u3059\u3002\n\u3000margin\u306e\u6570\u5b57\u306f\u6b21\u5143\u306e\u9806\u756a\u3067\u3042\u308a\u3001(west_east,south_north,bottom_top,Time)\u306e\u6b21\u5143\u3092\u6301\u3064\u30c7\u30fc\u30bf\u3067\u306f\u3001west_east,south_north,bottom_top,Time\u306e\u9806\u756a\u30671\u301c4\u306e\u6570\u5b57\u304c\u5272\u308a\u632f\u3089\u308c\u308b\u3002\n\u3000\u4e0a\u8a18\u306e\u4f8b\u3067\u306f\u30012\u6b21\u5143\u306e\u914d\u5217x\u306b\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u95a2\u6570mean\u3092\u6642\u9593\u3054\u3068\u306b\u9069\u5fdc\u3055\u305b\u305f\u7d50\u679c\u304c\u8fd4\u3063\u3066\u304d\u305f\u3002margin\u30921\u306b\u3059\u308b\u3068\u3001\u9ad8\u3055\u3054\u3068\u306e\u3001\u6642\u9593\u5e73\u5747\u5024\u304c\u8fd4\u308b\u3002\n\n```r\n> apply(x, 1, mean)\n [1]  -1.0751176  -1.1103524  -1.1106088  -1.0420452  -0.8099559  -0.3352173\n [7]   0.2404019   1.7825204   4.3521008   7.0892539   9.5852735  12.4250741\n[13]  15.6243184  18.6672581  21.5216343  24.3097252  27.5070387  31.0727283\n[19]  34.4129815  37.2718484  39.4816875  41.0503216  42.3647316  43.7326900\n[25]  45.3379526  47.2209280  49.2762682  51.5797598  54.2426057  56.3446231\n[31]  60.2103895  66.4429398  78.1916310  96.3676236 118.6383750 140.8374748\n[37] 163.8917669\n```\n\n\u3000\u3082\u3057\u3001\u7def\u5ea6\u30fb\u7d4c\u5ea6\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u5e73\u9762\u4e0a\u3067\u306e\u6700\u4e0b\u5c64\u306e\u671f\u9593\u5e73\u5747\u5024\u3092\u6c42\u3081\u308b\u5834\u5408\u306f\u3001\u6b21\u306e\u3088\u3046\u306b\u8a18\u8ff0\u3059\u308b\u3002\n\n```r\n> head(apply(T[,,1,], c(1,2), mean))\n            [,1]        [,2]        [,3]        [,4]        [,5]        [,6]\n[1,]  0.01576137  0.04714638  0.05050302  0.02025020 -0.02503504 -0.03634928\n[2,] -0.03251573 -0.07180138 -0.04693846 -0.04799919 -0.09376347 -0.19082553\n[3,] -0.05194719 -0.06634700 -0.09137851 -0.11628789 -0.13117390 -0.16278988\n[4,] -0.08131074 -0.03762976 -0.09773546 -0.34580672 -0.54329378 -0.48351659\n[5,] -0.09038579  0.00158573 -0.08224722 -0.32997115 -0.91169928 -0.93532613\n[6,] -0.13368743 -0.02925559 -0.05932397 -0.20304477 -0.76751008 -0.79081073\n   .\n   .\n   .\n   .\n   .\n         [,68]     [,69]     [,70]     [,71]     [,72]     [,73]     [,74]\n[1,] -44.89541 -47.00260 -50.54811 -53.16967 -52.98195 -53.79609 -46.89111\n[2,] -43.25560 -46.82128 -49.70825 -51.41909 -52.70751 -53.46209 -55.92016\n[3,] -39.67345 -43.78516 -47.86383 -50.77978 -52.87378 -53.38339 -54.67168\n[4,] -36.44224 -40.21573 -46.46169 -51.48956 -53.84814 -53.79808 -53.39638\n[5,] -36.27189 -39.76556 -46.03089 -51.26846 -53.19774 -53.35141 -52.82303\n[6,] -40.24731 -42.20425 -46.12080 -50.63491 -52.61677 -52.13189 -50.25226\n```\n\u3000\u3053\u308c\u3060\u3051\u308f\u304b\u308c\u3070\u3001NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u4efb\u610f\u306e\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3001\u5e73\u5747\u5024\u306a\u3069\u306b\u52a0\u5de5\u3057\u3066\u30b0\u30e9\u30d5\u306b\u3059\u308b\u3053\u3068\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\n##NetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u3000WRF\u3084CMAQ\u306e\u51fa\u529b\u306fNetCDF\u5f62\u5f0f\u3067\u3042\u308a\u3001\u8a08\u7b97\u7d50\u679c\u304c\u5909\u6570\u306b\u5206\u5272\u3055\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u3002WRF\u306e\u7d50\u679c\u3067\u3082\u6e7f\u5ea6\u3084\u6d77\u9762\u66f4\u6b63\u6c17\u5727\u3001\u98a8\u5411\u3001\u98a8\u901f\u306a\u3069\u306f\u3088\u304f\u4f7f\u7528\u3059\u308b\u304c\u3001\u305d\u306e\u307e\u307e\u30c7\u30fc\u30bf\u304c\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u306a\u304f\u3001\u3044\u304f\u3064\u304b\u306e\u5909\u6570\u306b\u5225\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u8a08\u7b97\u5f0f\u306b\u5f53\u3066\u306f\u3081\u3066\u5909\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u30001\u5730\u70b9\u306e\u5730\u4e0a\u4ed8\u8fd1\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u304c\u6b32\u3057\u3044\u5834\u5408\u306f\u3001\u5148\u307b\u3069\u306e\u3088\u3046\u306b`ncvar_get()`\u3084`apply()`\u95a2\u6570\u3092\u4f7f\u3063\u3066\u6642\u7cfb\u5217\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u3001csv\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u306b\u66f8\u304d\u3060\u3057\u3066\u304a\u3051\u3070\u826f\u3044\u3002\u3057\u304b\u3057\u3001\u7def\u5ea6\u30fb\u7d4c\u5ea6\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u5e73\u9762\u7a7a\u9593\u3067\u306e\u30c7\u30fc\u30bf\u3092\u6642\u9593\u3054\u3068\u306b\u307b\u3057\u3044\u5834\u5408\u306f\u3001csv\u30d5\u30a1\u30a4\u30eb\u3092\u6642\u9593\u6570\u5206\u4f5c\u3089\u306a\u3051\u308c\u3070\u306a\u3089\u306a\u3044(csv\u30d5\u30a1\u30a4\u30eb\u306f2\u6b21\u5143\u307e\u3067\u3057\u304b\u30c7\u30fc\u30bf\u3092\u683c\u7d0d\u3067\u304d\u306a\u3044)\u3002CMAQ\u306f\u7c92\u5b50\u306e\u7d50\u679c\u304c\u3044\u304f\u3064\u304b\u306e\u5909\u6570\u306b\u5225\u308c\u3066\u683c\u7d0d\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u30c7\u30fc\u30bf\u3092\u5fc5\u8981\u3068\u3059\u308b\u5ea6\u306b\u5909\u63db\u3059\u308b\u306e\u306f\u306a\u304b\u306a\u304b\u3081\u3093\u3069\u304f\u3055\u3044\u3002\n\u3000\u305d\u3053\u3067\u3001\u4f7f\u7528\u3059\u308b\u30c7\u30fc\u30bf\u3092\u3001\u5148\u306b\u3059\u3079\u3066\u5909\u63db\u3057\u3001\u307e\u3068\u3081\u3066NetCDF\u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u7ba1\u3059\u308b\u3002\u3053\u3046\u3059\u308b\u3068NetCDF\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u30c7\u30fc\u30bf\u3092\u629c\u304d\u51fa\u3059\u3060\u3051\u3067\u6b32\u3057\u3044\u30c7\u30fc\u30bf\u304c\u624b\u306b\u5165\u308a\u3001\u66f4\u306b\u683c\u7d0d\u5909\u6570\u304c\u6e1b\u308b\u305f\u3081\u30c7\u30fc\u30bf\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u304f\u306a\u308a\u3001\u6271\u3044\u3084\u3059\u304f\u306a\u308b\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u3002\n\u3000ncdf4\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u306f\u4e00\u901a\u308aNetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u7de8\u96c6\u306b\u95a2\u3059\u308b\u95a2\u6570\u304c\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u3002\n\n###NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\u624b\u9806\n\n\u7c21\u5358\u306b\u306f\u4ee5\u4e0b\u306e\u624b\u9806\u3067\u4f5c\u6210\u3059\u308b\u3002\n1. \u6b21\u5143\u306e\u5b9a\u7fa9\n2. \u5909\u6570\u306e\u5b9a\u7fa9\n3. NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n4. \u5909\u6570\u30fb\u5c5e\u6027\u306b\u5024\u3092\u5165\u529b\n\n###WRF\u306e\u7d50\u679c\u3092\u7de8\u96c6\u3057\u3001\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3060\u3051NetCDF\u5f62\u5f0f\u306b\u307e\u3068\u3081\u308b\n\u3000\u307e\u305a\u306f\u4f8b\u306e\u3054\u3068\u304f\u3001WRF\u306e\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u3002\n\n```r\nlibrary(ncdf4)\nWRF <- nc_open(\"wrfout_d01_2014-02-01_00_00_00\")\n```\n\u3000print(WRF)\u3068\u3059\u308b\u3068\u3001\u6b21\u5143\u60c5\u5831(dimention)\u306b\u6b21\u306e\u3088\u3046\u306b\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\u3002\n\n```r\n10 dimensions:\n   Time  Size:24   *** is unlimited ***\n   DateStrLen  Size:19\n   west_east  Size:94\n   south_north  Size:74\n   bottom_top  Size:37\n   bottom_top_stag  Size:38\n   soil_layers_stag  Size:4\n   west_east_stag  Size:95\n   south_north_stag  Size:75\n   land_cat_stag  Size:24\n```\n\u3000\u3053\u306e\u6b21\u5143\u6570\u3092\u4f7f\u3063\u3066\u65b0\u3057\u3044\u6b21\u5143\u6570\u3092\u6307\u5b9a\u3059\u308b\u3002\n\n```r\nnt <- 24  ## Time Size       \nnx <- 94  ## west_east Size   \nny <- 74  ## south_north Size   \nnz <- 37  ## bottom_top Size     \ndate.strength <- 19  ## DateStrLen Size\n```\n\u3000\u30c7\u30fc\u30bf\u3092\u78ba\u8a8d\u3057\u3066\u3044\u304f\u3002\u307e\u305a\u306f\u6642\u9593\u60c5\u5831\u3092\u629c\u304d\u51fa\u3057\u3066\u307f\u308b\u3068UTC(\u5354\u5b9a\u4e16\u754c\u6642)\u306a\u306e\u3067\u3001JST(\u65e5\u672c\u6a19\u6e96\u6642)\u306b\u5909\u63db\u3059\u308b\u3002\n\n```r\n> ncvar_get(WRF, \"Times\")\n [1] \"2014-02-01_00:00:00\" \"2014-02-01_01:00:00\" \"2014-02-01_02:00:00\"\n [4] \"2014-02-01_03:00:00\" \"2014-02-01_04:00:00\" \"2014-02-01_05:00:00\"\n [7] \"2014-02-01_06:00:00\" \"2014-02-01_07:00:00\" \"2014-02-01_08:00:00\"\n[10] \"2014-02-01_09:00:00\" \"2014-02-01_10:00:00\" \"2014-02-01_11:00:00\"\n[13] \"2014-02-01_12:00:00\" \"2014-02-01_13:00:00\" \"2014-02-01_14:00:00\"\n[16] \"2014-02-01_15:00:00\" \"2014-02-01_16:00:00\" \"2014-02-01_17:00:00\"\n[19] \"2014-02-01_18:00:00\" \"2014-02-01_19:00:00\" \"2014-02-01_20:00:00\"\n[22] \"2014-02-01_21:00:00\" \"2014-02-01_22:00:00\" \"2014-02-01_23:00:00\"\n```\n\n```r\nstr.T <- as.POSIXlt(paste(substring(ncvar_get(WRF, \"Times\")[1], 1, 10), \"00:00:00\", sep=\" \"), \"%Y-%m-%d %H:%M:%OS\") + 9*60*60\nJST <- seq(str.T, by=\"hour\", length=nt)\n\n> JST\n [1] \"2014-02-01 09:00:00\" \"2014-02-01 10:00:00\" \"2014-02-01 11:00:00\"\n [4] \"2014-02-01 12:00:00\" \"2014-02-01 13:00:00\" \"2014-02-01 14:00:00\"\n [7] \"2014-02-01 15:00:00\" \"2014-02-01 16:00:00\" \"2014-02-01 17:00:00\"\n[10] \"2014-02-01 18:00:00\" \"2014-02-01 19:00:00\" \"2014-02-01 20:00:00\"\n[13] \"2014-02-01 21:00:00\" \"2014-02-01 22:00:00\" \"2014-02-01 23:00:00\"\n[16] \"2014-02-02 00:00:00\" \"2014-02-02 01:00:00\" \"2014-02-02 02:00:00\"\n[19] \"2014-02-02 03:00:00\" \"2014-02-02 04:00:00\" \"2014-02-02 05:00:00\"\n[22] \"2014-02-02 06:00:00\" \"2014-02-02 07:00:00\" \"2014-02-02 08:00:00\"\n```\n\u3000\u6b21\u306b\u5909\u6570\u60c5\u5831\u3092\u629c\u304d\u51fa\u3057\u3066\u3044\u304f\u3002\u6b21\u5143\u6570\u304c\u5909\u6570\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u304c\u3001\u4eca\u56de\u306f\u6642\u9593\u60c5\u5831\u30921\u6b21\u5143\u3001\u4f4d\u7f6e\u60c5\u5831\u30922\u6b21\u5143\u3001\u305d\u308c\u4ee5\u5916\u30923,4\u6b21\u5143\u3068\u3057\u3066\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```r\n## \u4f4d\u7f6e\u30c7\u30fc\u30bf\nlon <- array(ncvar_get(WRF, \"XLONG\")[,,1], dim=c(nx, ny)) # degree\nlat <- array(ncvar_get(WRF, \"XLAT\")[,,1], dim=c(nx, ny)) # degree\nhgt <- array(ncvar_get(WRF, \"HGT\")[,,1], dim=c(nx, ny, nt)) # terrain elevation\n\n## \u6c17\u6e29\u3001\u6e7f\u5ea6\u3001\u964d\u6c34\u91cf\u3001\u6c17\u5727\u3001\u98a8\u901f\u3001\u5883\u754c\u5c64\u9ad8\u5ea6\u30c7\u30fc\u30bf\nt2 <- array(ncvar_get(WRF, \"T2\"), dim=c(nx, ny, nt)) - 273.15 ## \u5730\u4e0a2m\u306e\u6c17\u6e29(\u2103)\nQ2 <- array(ncvar_get(WRF, \"Q2\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a2m\u306e\u6df7\u5408\u6bd4(\u6c34\u84b8\u6c17\u8cea\u91cfkg/\u4e7e\u71e5\u7a7a\u6c17\u8cea\u91cfkg)\nPHUM <- 6.1078*10^(\n  7.5*(t2)/((t2)+237.3)\n)#\u98fd\u548c\u6c34\u84b8\u6c17\u5727\u306e\u8a08\u7b97\u3002Tetens\u306e\u5f0f\u3060\u304c\u3001Goff-Gratch\u306e\u5f0f\u3068\u8fd1\u4f3c\u3067\u304d\u308b\u3002\nrh <- (100*psfc*Q2)/(PHUM*(0.622+Q2)) # \u5730\u4e0a2m\u306e\u6e7f\u5ea6(%)\nrain <- array(ncvar_get(WRF, \"RAINC\"), dim=c(nx, ny, nt)) ## \u7d2f\u7a4d\u964d\u6c34\u91cf\npsfc <- array(ncvar_get(WRF, \"PSFC\"), dim=c(nx, ny, nt))/100 ## \u5730\u8868\u9762\u6c17\u5727(hPa)\npres <- psfc*(1-0.0065*hgt/(t2+273.15+0.0065*hgt))^(-5.257) ## \u6d77\u9762\u66f4\u6b63\u6c17\u5727\npblh <- array(ncvar_get(WRF, \"PBLH\"), dim=c(nx, ny, nt)) # \u5883\u754c\u5c64\u9ad8\u5ea6\nU10 <- array(ncvar_get(WRF, \"U10\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a10m\u6771\u897f\u65b9\u5411\u98a8\u901f(m/s)\nV10 <- array(ncvar_get(WRF, \"V10\"), dim=c(nx, ny, nt))  ## \u5730\u4e0a10m\u5357\u5317\u65b9\u5411\u98a8\u901f\n\n## 4\u6b21\u5143\u6c17\u6e29\u3001\u98a8\u901f\u30c7\u30fc\u30bf\ntemp <- array(ncvar_get(WRF, \"T\"), dim=c(nx, ny, nz, nt)) - 273.15 ## \u5168\u5c64\u6c17\u6e29(\u2103)\nU <- array(ncvar_get(WRF, \"U\"), dim=c(nx, ny, nz, nt)) ## \u5168\u5c64\u6771\u897f\u65b9\u5411\u98a8\u901f(m/s)\nV <- array(ncvar_get(WRF, \"V\"), dim=c(nx, ny, nz, nt)) ## \u5168\u5c64\u6771\u5357\u5317\u5411\u98a8\u901f(m/s) \n```\n\u3000\u6b21\u5143\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```r\ntdim <- ncdim_def(\"Time\", \"\", 1:nt, unlim=TRUE, create_dimvar=FALSE) ##\u3000\u6642\u9593\u6570\nxdim <- ncdim_def(\"west_east\",\"\", 1:nx, create_dimvar=FALSE) ## \u6771\u897f\u30b0\u30ea\u30c3\u30c9\u6570\nydim <- ncdim_def(\"south_north\",\"\", 1:ny, create_dimvar=FALSE)  ## \u5357\u5317\u30b0\u30ea\u30c3\u30c9\u6570\nzdim <- ncdim_def(\"bottom_to_top\",\"\", 1:nz, create_dimvar=FALSE)  ## \u9ad8\u3055\u30b0\u30ea\u30c3\u30c9\u6570\nchar.dim <- ncdim_def(\"date_strength\",\"\", 1:date.strength, create_dimvar=FALSE)  ## \u6642\u9593\u306e\u6587\u5b57\u5217\u9577\u3055\u6307\u5b9a(\"2014-01-01 00:00:00\"\u306719\u6587\u5b57)\n```\n\u3000\u5909\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```r\ntime.var <- ncvar_def(\"TIME\", \"Date (JST)\", list(char.dim, tdim), prec=\"char\")\nlong.var <- ncvar_def(\"LON\", \"degreeE\", list(xdim, ydim), 1.e30, longname=\"Longitude\")\nlat.var <- ncvar_def(\"LAT\", \"degreeN\", list(xdim, ydim), 1.e30, longname=\"Latitude\")\ntemp2.var <- ncvar_def(\"TEMP2\", \"degree C\", list(xdim, ydim, tdim), 1.e30, longname=\"Temperature at 2m\")\nrh.var <- ncvar_def(\"RH\", \"percent (%)\", list(xdim, ydim, tdim), 1.e30, longname=\"Humidity at 2m\")\nrain.var <- ncvar_def(\"RAIN\", \"mm\", list(xdim, ydim, tdim), 1.e30, longname=\"Total Precipitation\")\npres.var <- ncvar_def(\"SEA_PRES\", \"hPa\", list(xdim, ydim, tdim), 1.e30, longname=\"Sea Level Correction Pressure\")\nprsfc.var <- ncvar_def(\"PRSFC\", \"hPa\", list(xdim, ydim, tdim), 1.e30, longname=\"Surface pressure\")\npblh.var <- ncvar_def(\"PBLH\", \"m\", list(xdim, ydim, tdim), 1.e30, longname=\"Planetary boundary layer height\")\nu10.var <- ncvar_def(\"U10\", \"m/s\", list(xdim, ydim, tdim), 1.e30, longname=\"west_east Wind speedat 10m\")\nv10.var <- ncvar_def(\"V10\", \"m/s\", list(xdim, ydim, tdim), 1.e30, longname=\"south_north Wind speed at 10m\")\n\ntemp.var <- ncvar_def(\"TEMP\", \"degree C\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"Temperature\")\nu.var <- ncvar_def(\"U\", \"m/s\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"west_east Wind\")\nv.var <- ncvar_def(\"V\", \"m/s\", list(xdim, ydim, zdim, tdim), 1.e30, longname=\"south_north Wind speed\")\n```\n\u3000NetCDF\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u3068\u304d\u3001\u5148\u307b\u3069\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```r\nnc <- nc_create(filename=\"./data.nc\",\n                list(time.var, long.var, lat.var,\n                     temp2.var, rh.var, rain.var, \n                     pres.var, prsfc.var, pblh.var,u10.var, v10.var,\n                     temp.var, u.var, v.var\n                     )\n                )\n```\n\u3000\u5c5e\u6027\u3092\u5b9a\u7fa9\u307e\u3059\u3002\u5b9a\u7fa9\u306e\u65b9\u6cd5\u306f`ncatt_put(file_name, varid, attname, value)`\u3067\u3001varid\u306b\u3001\u5c5e\u6027\u3092\u3064\u3051\u308b\u5909\u6570\u540d\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002varid\u3092\"0\"\u306b\u3059\u308b\u3068\u3001\u30b0\u30ed\u30fc\u30d0\u30eb\u5c5e\u6027\u306b\u306a\u308a\u307e\u3059\u3002attname\u3067\u5c5e\u6027\u540d\u3001value\u3067\u5c5e\u6027\u5024\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u3000\u4eca\u56de\u306f\u7c21\u5358\u306b\u30b0\u30ed\u30fc\u30d0\u30eb\u5c5e\u6027\u3060\u3051\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```r\nncatt_put(nc, 0, \"CEN_LAT\", 33.3389205932617)  ## \u8a08\u7b97\u4e2d\u5fc3\u4f4d\u7f6e\u306e\u7def\u5ea6\nncatt_put(nc, 0, \"CEN_LON\", 122.964904785156)  ## \u8a08\u7b97\u4e2d\u5fc3\u4f4d\u7f6e\u306e\u7d4c\u5ea6 \n```\n\u3000\u4f5c\u6210\u3057\u305fNetCDF\u30d5\u30a1\u30a4\u30eb\u306f\u3001\u6b21\u5143\u3001\u5909\u6570\u306f\u3042\u308a\u307e\u3059\u304c\u30c7\u30fc\u30bf\u304c\u7a7a\u306e\u72b6\u614b\u306a\u306e\u3067\u3001\u3055\u3063\u304d\u5b9a\u7fa9\u3057\u305f\u5909\u6570\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u5b9a\u7fa9\u306e\u65b9\u6cd5\u306f\u3001`ncvar_put(file_name, varid, vals, start, count)`\u3067\u3001varid\u3067\u5024\u3092\u5165\u308c\u308b\u5909\u6570\u540d\u3001vals\u3067\u5165\u529b\u3059\u308b\u5024\u3001start\u3067\u5024\u3092\u5165\u308c\u308b\u6700\u521d\u306e\u4f4d\u7f6e\u6307\u5b9a\u3001count\u3067\u6b21\u5143\u3092\u6307\u5b9a\u3059\u308b\u3002start\u306f\u3059\u3079\u30661\u3067\u554f\u984c\u306a\u304f\u3001count\u306f\u5909\u6570\u306e\u5b9a\u7fa9\u306e\u6642\u306b\u6307\u5b9a\u3057\u305f\u6b21\u5143\u3092\u305d\u306e\u307e\u307e\u6307\u5b9a\u3059\u308c\u3070\u3088\u3044\u3002\n\n```r\nncvar_put(nc, long.var, lon, start=c(1,1), count=c(nx,ny))\nncvar_put(nc, lat.var, lat, start=c(1,1), count=c(nx,ny))\nncvar_put(nc, temp2.var, t2, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, rh.var, rh, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, rain.var, rain, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, pres.var, pres, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, prsfc.var, psfc, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, pblh.var, pblh, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, u10.var, U10, start=c(1,1,1), count=c(nx,ny,nt))\nncvar_put(nc, v10.var, V10, start=c(1,1,1), count=c(nx,ny,nt))\n\nncvar_put(nc, temp.var, temp, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\nncvar_put(nc, u.var, U, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\nncvar_put(nc, v.var, V, start=c(1,1,1,1), count=c(nx,ny,nz,nt))\n\nncvar_put(nc, time.var, JST)\nnc_close(nc)  ## \u6700\u5f8c\u306b\u4f5c\u8a5e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u9589\u3058\u308b\u3002\n```\n\u3000\u4f55\u6545\u304b\u6642\u9593\u5909\u6570\u306e\u5165\u529b\u306f\u3001\u4e00\u756a\u6700\u5f8c\u3067\u306a\u3044\u3068\u3046\u307e\u304f\u3044\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u3000\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u3001\u7aef\u672b\u304b\u3089ncdump\u3057\u3066\u307f\u307e\u3059\u3002\n\n```bash:bash\n$ ncdump -h ./data.nc \nnetcdf data {\ndimensions:\n\tdate_strength = 19 ;\n\tTime = UNLIMITED ; // (24 currently)\n\twest_east = 94 ;\n\tsouth_north = 74 ;\n\tbottom_to_top = 37 ;\nvariables:\n\tchar TIME(Time, date_strength) ;\n\t\tTIME:units = \"Date (JST)\" ;\n\tfloat LON(west_east, south_north) ;\n\t\tLON:units = \"degreeE\" ;\n\t\tLON:_FillValue = 1.e+30f ;\n\t\tLON:long_name = \"Longitude\" ;\n\tfloat LAT(west_east, south_north) ;\n\t\tLAT:units = \"degreeN\" ;\n\t\tLAT:_FillValue = 1.e+30f ;\n\t\tLAT:long_name = \"Latitude\" ;\n\tfloat TEMP2(Time, west_east, south_north) ;\n\t\tTEMP2:units = \"degree C\" ;\n\t\tTEMP2:_FillValue = 1.e+30f ;\n\t\tTEMP2:long_name = \"Temperature at 2m\" ;\n\tfloat RH(Time, west_east, south_north) ;\n\t\tRH:units = \"percent (%)\" ;\n\t\tRH:_FillValue = 1.e+30f ;\n\t\tRH:long_name = \"Humidity at 2m\" ;\n\tfloat RAIN(Time, west_east, south_north) ;\n\t\tRAIN:units = \"mm\" ;\n\t\tRAIN:_FillValue = 1.e+30f ;\n\t\tRAIN:long_name = \"Total Precipitation\" ;\n\tfloat SEA_PRES(Time, west_east, south_north) ;\n\t\tSEA_PRES:units = \"hPa\" ;\n\t\tSEA_PRES:_FillValue = 1.e+30f ;\n\t\tSEA_PRES:long_name = \"Sea Level Correction Pressure\" ;\n\tfloat PRSFC(Time, west_east, south_north) ;\n\t\tPRSFC:units = \"hPa\" ;\n\t\tPRSFC:_FillValue = 1.e+30f ;\n\t\tPRSFC:long_name = \"Surface pressure\" ;\n\tfloat PBLH(Time, west_east, south_north) ;\n\t\tPBLH:units = \"m\" ;\n\t\tPBLH:_FillValue = 1.e+30f ;\n\t\tPBLH:long_name = \"Planetary boundary layer height\" ;\n\tfloat U10(Time, west_east, south_north) ;\n\t\tU10:units = \"m/s\" ;\n\t\tU10:_FillValue = 1.e+30f ;\n\t\tU10:long_name = \"west_east Wind speedat 10m\" ;\n\tfloat V10(Time, west_east, south_north) ;\n\t\tV10:units = \"m/s\" ;\n\t\tV10:_FillValue = 1.e+30f ;\n\t\tV10:long_name = \"south_north Wind speed at 10m\" ;\n\tfloat TEMP(Time, bottom_to_top, west_east, south_north) ;\n\t\tTEMP:units = \"degree C\" ;\n\t\tTEMP:_FillValue = 1.e+30f ;\n\t\tTEMP:long_name = \"Temperature\" ;\n\tfloat U(Time, bottom_to_top, west_east, south_north) ;\n\t\tU:units = \"m/s\" ;\n\t\tU:_FillValue = 1.e+30f ;\n\t\tU:long_name = \"west_east Wind\" ;\n\tfloat V(Time, bottom_to_top, west_east, south_north) ;\n\t\tV:units = \"m/s\" ;\n\t\tV:_FillValue = 1.e+30f ;\n\t\tV:long_name = \"south_north Wind speed\" ;\n\n// global attributes:\n\t\t:CEN_LAT = 33.3389205932617 ;\n\t\t:CEN_LON = 122.964904785156 ;\n}\n\n```\n\u3000\u3082\u3061\u308d\u3093\u3001`ncview`\u3067\u958b\u304f\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n![sample.png](https://qiita-image-store.s3.amazonaws.com/0/113843/d1cebb1f-8b11-b05d-94e9-fc4e4d298f5a.png)\n\u3000\u6d77\u9762\u66f4\u6b63\u6c17\u5727\u3084\u6e7f\u5ea6\u306f\u3059\u3079\u3066\u8a08\u7b97\u3057\u3066\u3042\u308a\u3001\u307e\u305f\u3001\u5143\u306f500MB\u7a0b\u5ea6\u306e\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c80MB\u7a0b\u5ea6\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3001\u6b21\u56de\u304b\u3089\u7c21\u5358\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u3000\u305f\u3060\u3001\u6b21\u5143\u3001\u5c5e\u6027\u3092\u304d\u3061\u3093\u3068\u4ed8\u3051\u306a\u3044\u3068\u3001WRF\u5c02\u7528\u306eviewer\u3067\u306f\u958b\u3051\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u306e\u4fdd\u5b58\u3092\u76ee\u7684\u3068\u3057\u305fNetCDF\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\u3067\u3059\u306e\u3067\u3053\u3053\u307e\u3067\u306b\u3057\u307e\u3059\u3002\n\n", "tags": ["R", "NetCDF", "ncdf4", "WRF"]}