{"context": " More than 1 year has passed since last update.\u5148\u65e5\u53c2\u52a0\u3057\u305f Couchbase MeetUP Tokyo #12 \u3067\u77e5\u3063\u305f\u306e\u3067\u3059\u304c\u3001cbbackup \u304c\u51fa\u529b\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u3066 SQLite \u3067\u691c\u7d22\u304c\u3067\u304d\u308b\u3068\u306e\u3053\u3068\u3002\n\u307e\u305a\u306fcbbackup\n$ /opt/couchbase/bin/cbbackup -b items -u Administrator -p hogemoge http://localhost:8091 /vagrant/dump\n\n$ tree dump\ndump\n\u2514\u2500\u2500 2015-02-16T082318Z\n    \u2514\u2500\u2500 2015-02-16T082318Z-full\n        \u2514\u2500\u2500 bucket-items\n            \u251c\u2500\u2500 design.json\n            \u2514\u2500\u2500 node-127.0.0.1%3A8091\n                \u251c\u2500\u2500 data-0000.cbb\n                \u251c\u2500\u2500 failover.json\n                \u251c\u2500\u2500 meta.json\n                \u251c\u2500\u2500 seqno.json\n                \u2514\u2500\u2500 snapshot_markers.json\n\n\nsqlite \u306f\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u3044\u306e\u3067\u826f\u304f\u5206\u304b\u3089\u306a\u3044\u3051\u3069\u3001.cbb \u4ee5\u5916\u306f JSON \u30d5\u30a1\u30a4\u30eb\u3057\u304b\u306a\u3044\u306e\u3067\u30fb\u30fb\u30fb \n$ sqlite3 data-0000.cbb \nSQLite version 3.7.13 2012-07-17 17:46:21\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> \n\n\u304a\u304a\u3001\u306a\u3093\u304b\u8d77\u52d5\u3057\u305f\u3063\u307d\u3044\u3002\nsqlite> .tables\ncbb_meta  cbb_msg\n\ncbb_meta \u306f\u5358\u7d14\u306a key/value \u306a\u30ec\u30a4\u30a2\u30a6\u30c8\u3002\nsqlite> select key,count(*) from cbb_meta group by key;\nsource_bucket.json|1\nsource_map.json|1\nsource_node.json|1\nstart.datetime|1\n\ncbb_msg \u306e\u65b9\u306f\u3053\u3093\u306a\u30ec\u30a4\u30a2\u30a6\u30c8\u3067\u3001val \u306b JSON \u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n\n\ncmd\nvbucket_id\nkey\nflg\nexp\ncas\nmeta\nval\nseqno\ndtype\nmeta_size\n\n\n\n\n\n$ sqlite3 data-0000.cbb \"select val from cbb_msg limit 1\" | jq '.'\n{\n  \"id\": \"1584\",\n  \"asin\": \"B004X2L352\",\n  \"categories\": [\n    52391051\n  ],\n  \"name\": \"\u30aa\u30fc\u30ac\u30cb\u30c3\u30af\u30ed\u30fc\u30ab\u30b7\u30e5\u30fc\u30ca\u30c3\u30c4\",\n  \"description\": \"\u539f\u7523\u56fd:\u30a2\u30e1\u30ea\u30ab\u5408\u8846\u56fd \u5185\u5bb9\u91cf:227g\",\n  \"available_hours\": 0,\n  \"url\": \"http://www.amazon.jp/dp/B004X2L352/ref=asc_df_B004X2L3521162042?smid=AN1VRQENFRJN5&tag=AssocID&creative=9407&creativeASIN=B004X2L352&linkCode=df0\",\n  \"sales_rank\": 565,\n  \"adult_product\": false,\n  \"images\": {\n    \"small\": {\n      \"width\": 75,\n      \"height\": 75,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL._SL75_.jpg\"\n    },\n    \"large\": {\n      \"width\": 500,\n      \"height\": 500,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL.jpg\"\n    },\n    \"hires\": {\n      \"width\": 1000,\n      \"height\": 1000,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/61clJe9w-KL.jpg\"\n    },\n    \"medium\": {\n      \"width\": 160,\n      \"height\": 160,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL._SL160_.jpg\"\n    }\n  },\n  \"identifiers\": {\n    \"ean\": \"0803813051104\",\n    \"upc\": \"803813051104\"\n  },\n  \"parent_asin\": null,\n  \"keywords\": {\n    \"feature\": [\n      \"\u539f\u7523\u56fd:\u30a2\u30e1\u30ea\u30ab\u5408\u8846\u56fd\",\n      \"\u5185\u5bb9\u91cf:227g\"\n    ],\n    \"mpn\": \"SF10135\",\n    \"brand\": \"\u30b5\u30f3\u30d5\u30fc\u30c9\u30b9\u30fc\u30d1\u30fc\u30d5\u30fc\u30ba(Sunfood Superfoods)\",\n    \"manufacturer\": \"\u30a2\u30ea\u30a8\u30eb\u30c8\u30ec\u30fc\u30c7\u30a3\u30f3\u30b0\"\n  },\n  \"original_price\": 3024,\n  \"price\": 3100,\n  \"status\": \"exchangeable\",\n  \"exclusion_halls\": [],\n  \"exclusion_companies\": []\n}\n\n\u3082\u3063\u3068\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3092\u30c9\u30fc\u30be\u3002\ncbrestore\u3067\u7279\u5b9a\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3060\u3051\u3092\u30ea\u30b9\u30c8\u30a2\u3059\u308b\n\n\u5148\u65e5\u53c2\u52a0\u3057\u305f Couchbase MeetUP Tokyo #12 \u3067\u77e5\u3063\u305f\u306e\u3067\u3059\u304c\u3001`cbbackup` \u304c\u51fa\u529b\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3063\u3066 SQLite \u3067\u691c\u7d22\u304c\u3067\u304d\u308b\u3068\u306e\u3053\u3068\u3002\n\n\u307e\u305a\u306fcbbackup\n\n```\n$ /opt/couchbase/bin/cbbackup -b items -u Administrator -p hogemoge http://localhost:8091 /vagrant/dump\n```\n\n```\n$ tree dump\ndump\n\u2514\u2500\u2500 2015-02-16T082318Z\n    \u2514\u2500\u2500 2015-02-16T082318Z-full\n        \u2514\u2500\u2500 bucket-items\n            \u251c\u2500\u2500 design.json\n            \u2514\u2500\u2500 node-127.0.0.1%3A8091\n                \u251c\u2500\u2500 data-0000.cbb\n                \u251c\u2500\u2500 failover.json\n                \u251c\u2500\u2500 meta.json\n                \u251c\u2500\u2500 seqno.json\n                \u2514\u2500\u2500 snapshot_markers.json\n\n```\n\nsqlite \u306f\u4f7f\u3063\u305f\u3053\u3068\u304c\u306a\u3044\u306e\u3067\u826f\u304f\u5206\u304b\u3089\u306a\u3044\u3051\u3069\u3001`.cbb` \u4ee5\u5916\u306f JSON \u30d5\u30a1\u30a4\u30eb\u3057\u304b\u306a\u3044\u306e\u3067\u30fb\u30fb\u30fb \n\n```\n$ sqlite3 data-0000.cbb \nSQLite version 3.7.13 2012-07-17 17:46:21\nEnter \".help\" for instructions\nEnter SQL statements terminated with a \";\"\nsqlite> \n```\n\n\u304a\u304a\u3001\u306a\u3093\u304b\u8d77\u52d5\u3057\u305f\u3063\u307d\u3044\u3002\n\n```\nsqlite> .tables\ncbb_meta  cbb_msg\n```\n\n`cbb_meta` \u306f\u5358\u7d14\u306a key/value \u306a\u30ec\u30a4\u30a2\u30a6\u30c8\u3002\n\n```\nsqlite> select key,count(*) from cbb_meta group by key;\nsource_bucket.json|1\nsource_map.json|1\nsource_node.json|1\nstart.datetime|1\n```\n\n`cbb_msg` \u306e\u65b9\u306f\u3053\u3093\u306a\u30ec\u30a4\u30a2\u30a6\u30c8\u3067\u3001val \u306b JSON \u304c\u5165\u3063\u3066\u3044\u307e\u3059\u3002\n\n|cmd|vbucket_id|key|flg|exp|cas|meta|val|seqno|dtype|meta_size|\n|---|----------|---|---|---|---|----|---|-----|-----|----------|\n\n\n```\n$ sqlite3 data-0000.cbb \"select val from cbb_msg limit 1\" | jq '.'\n{\n  \"id\": \"1584\",\n  \"asin\": \"B004X2L352\",\n  \"categories\": [\n    52391051\n  ],\n  \"name\": \"\u30aa\u30fc\u30ac\u30cb\u30c3\u30af\u30ed\u30fc\u30ab\u30b7\u30e5\u30fc\u30ca\u30c3\u30c4\",\n  \"description\": \"\u539f\u7523\u56fd:\u30a2\u30e1\u30ea\u30ab\u5408\u8846\u56fd \u5185\u5bb9\u91cf:227g\",\n  \"available_hours\": 0,\n  \"url\": \"http://www.amazon.jp/dp/B004X2L352/ref=asc_df_B004X2L3521162042?smid=AN1VRQENFRJN5&tag=AssocID&creative=9407&creativeASIN=B004X2L352&linkCode=df0\",\n  \"sales_rank\": 565,\n  \"adult_product\": false,\n  \"images\": {\n    \"small\": {\n      \"width\": 75,\n      \"height\": 75,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL._SL75_.jpg\"\n    },\n    \"large\": {\n      \"width\": 500,\n      \"height\": 500,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL.jpg\"\n    },\n    \"hires\": {\n      \"width\": 1000,\n      \"height\": 1000,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/61clJe9w-KL.jpg\"\n    },\n    \"medium\": {\n      \"width\": 160,\n      \"height\": 160,\n      \"unit\": \"pixels\",\n      \"url\": \"http://ecx.images-amazon.com/images/I/513jniBDtvL._SL160_.jpg\"\n    }\n  },\n  \"identifiers\": {\n    \"ean\": \"0803813051104\",\n    \"upc\": \"803813051104\"\n  },\n  \"parent_asin\": null,\n  \"keywords\": {\n    \"feature\": [\n      \"\u539f\u7523\u56fd:\u30a2\u30e1\u30ea\u30ab\u5408\u8846\u56fd\",\n      \"\u5185\u5bb9\u91cf:227g\"\n    ],\n    \"mpn\": \"SF10135\",\n    \"brand\": \"\u30b5\u30f3\u30d5\u30fc\u30c9\u30b9\u30fc\u30d1\u30fc\u30d5\u30fc\u30ba(Sunfood Superfoods)\",\n    \"manufacturer\": \"\u30a2\u30ea\u30a8\u30eb\u30c8\u30ec\u30fc\u30c7\u30a3\u30f3\u30b0\"\n  },\n  \"original_price\": 3024,\n  \"price\": 3100,\n  \"status\": \"exchangeable\",\n  \"exclusion_halls\": [],\n  \"exclusion_companies\": []\n}\n```\n\n\u3082\u3063\u3068\u8a73\u3057\u304f\u77e5\u308a\u305f\u3044\u5834\u5408\u306f\u3053\u3061\u3089\u3092\u30c9\u30fc\u30be\u3002\n\n[cbrestore\u3067\u7279\u5b9a\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3060\u3051\u3092\u30ea\u30b9\u30c8\u30a2\u3059\u308b](http://qiita.com/ijokarumawak@github/items/69e128d37b13e55bed89)\n\n", "tags": ["Couchbase"]}