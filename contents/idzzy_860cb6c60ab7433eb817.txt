{"context": " More than 1 year has passed since last update.\n\nWhat's this?\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n\nShared storage \u7121\u3057\u306e\u5834\u5408\u3001\u5168\u304f\u65b0\u3057\u3044 Nova instance \u304c\u5225\u306e compute node \u4e0a\u3067\u8d77\u52d5\u3055\u308c\u308b\n\u305f\u3060\u3057\u3001\u969c\u5bb3\u505c\u6b62\u3057\u305f compute node \u4e0a\u3067\u7a3c\u50cd\u3057\u3066\u3044\u305f Nova instance \u306e Parameter (id, hostname, uid, ip ...etc)\u304c\u4f7f\u7528\u3055\u308c\u308b\n\u30c7\u30fc\u30bf\u306f\u5f15\u304d\u7d99\u304c\u308c\u306a\u3044\n\n[\u6761\u4ef6]\n\nShared storage \u306a\u3057\nNova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f compute node \u306e local disk \u306b\u3042\u308b\n\u8ffd\u52a0 Volume \u3068\u3057\u3066\u306e Cinder \u672a\u4f7f\u7528\nHypervisor \u306f KVM\n\n\nInitial state\n\nCompute node\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:36:27.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:37.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n+--------------------------+----------------------------------------+\n\n\nNova instance is running on node-27\n[root@node-17 ~]# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n| b103274a-fd6d-42cc-8cfb-c78f3d37c898 | admin_vm01 | ACTIVE | active               | nova                         | node-27                |\n+--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\nStop nova-compute service of node-27\n\nStop nova-compute service\n# service openstack-nova-compute stop\nStopping openstack-nova-compute:                           [  OK  ]\n\n# service openstack-nova-compute status\nopenstack-nova-compute is stopped\n\n# nova service-list | egrep \"Host|nova-compute\"\n| Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n| nova-compute     | node-27 | nova     | enabled | down  | 2015-03-17T08:38:17.000000 | -               |\n| nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:37:14.000000 | -               |\n| nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:38:14.000000 | -               |\n\n\nAZ\n# nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n| nova                     | available                              |\n| |- node-27               |                                        |\n| | |- nova-compute        | enabled XXX 2015-03-17T08:38:17.000000 |\n| |- node-28               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:37:14.000000 |\n| nova2                    | available                              |\n| |- node-31               |                                        |\n| | |- nova-compute        | enabled :-) 2015-03-17T08:38:14.000000 |\n+--------------------------+----------------------------------------+\n\n\nEvacuate\n\nExecute evacuate\nEvacuate Nova instance to node-28\n# nova evacuate b103274a-fd6d-42cc-8cfb-c78f3d37c898 node-28\n+-----------+--------------+\n| Property  | Value        |\n+-----------+--------------+\n| adminPass | EtDTWFzQAe8q |\n+-----------+--------------+\n\n\nCheck the evacuate result\n\nNova instance has same parameters (id, hostname, uid, ip ...etc) which previous Nova instance had.\nYou can login to this instance by using above adminPass.\n\n# nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| b103274a-fd6d-42cc-8cfb-c78f3d37c898 | admin_vm01 | ACTIVE |  | active               | nova                         | node-28                              |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n\n\nEnvironment\n\nOpenstack : Juno\nCeph : Firefly\n\n\nReference\nOpenstack - Nova Evacuate with Shared Storage\nOpenstack - Nova Evacuate with Shared Storage with Cinder\nOpenstack - Nova Evacuate with Shared Storage with Cinder between AZ\nOpenstack - Nova Evacuate without Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage\nOpenstack - Nova Host-Evacuate with Shared Storage between AZ\n## What's this?\n\nNova instance \u304c\u7a3c\u50cd\u3057\u3066\u3044\u308b compute node \u304c\u969c\u5bb3\u505c\u6b62\u3057\u305f\u969b\u306b\u3001Nova instance \u3092\u5225\u306e compute node \u4e0a\u306b\u5fa9\u65e7(=\u9000\u907f)\n\n* Shared storage \u7121\u3057\u306e\u5834\u5408\u3001\u5168\u304f\u65b0\u3057\u3044 Nova instance \u304c\u5225\u306e compute node \u4e0a\u3067\u8d77\u52d5\u3055\u308c\u308b\n* \u305f\u3060\u3057\u3001\u969c\u5bb3\u505c\u6b62\u3057\u305f compute node \u4e0a\u3067\u7a3c\u50cd\u3057\u3066\u3044\u305f Nova instance \u306e Parameter (id, hostname, uid, ip ...etc)\u304c\u4f7f\u7528\u3055\u308c\u308b\n* \u30c7\u30fc\u30bf\u306f\u5f15\u304d\u7d99\u304c\u308c\u306a\u3044\n\n\n[\u6761\u4ef6]\n\n* Shared storage \u306a\u3057\n* Nova instance \u306e\u5168\u30c7\u30fc\u30bf\u306f compute node \u306e local disk \u306b\u3042\u308b\n* \u8ffd\u52a0 Volume \u3068\u3057\u3066\u306e Cinder \u672a\u4f7f\u7528\n* Hypervisor \u306f KVM\n\n## Initial state\n\n#### Compute node\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | up    | 2015-03-17T08:36:27.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:36:24.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:37.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:36:34.000000 |\n    +--------------------------+----------------------------------------+\n\n#### Nova instance is running on node-27\n\n    [root@node-17 ~]# nova list --field name,status,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | ID                                   | Name       | Status | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n    | b103274a-fd6d-42cc-8cfb-c78f3d37c898 | admin_vm01 | ACTIVE | active               | nova                         | node-27                |\n    +--------------------------------------+------------+--------+----------------------+------------------------------+--------------------------------------+\n\n\n## Stop nova-compute service of node-27\n\n#### Stop nova-compute service\n\n    # service openstack-nova-compute stop\n    Stopping openstack-nova-compute:                           [  OK  ]\n\n    # service openstack-nova-compute status\n    openstack-nova-compute is stopped\n\n    # nova service-list | egrep \"Host|nova-compute\"\n    | Binary           | Host    | Zone     | Status  | State | Updated_at                 | Disabled Reason |\n    | nova-compute     | node-27 | nova     | enabled | down  | 2015-03-17T08:38:17.000000 | -               |\n    | nova-compute     | node-28 | nova     | enabled | up    | 2015-03-17T08:37:14.000000 | -               |\n    | nova-compute     | node-31 | nova2    | enabled | up    | 2015-03-17T08:38:14.000000 | -               |\n\n#### AZ\n\n    # nova availability-zone-list | egrep -A 10 \"^\\| nova\"\n    | nova                     | available                              |\n    | |- node-27               |                                        |\n    | | |- nova-compute        | enabled XXX 2015-03-17T08:38:17.000000 |\n    | |- node-28               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:37:14.000000 |\n    | nova2                    | available                              |\n    | |- node-31               |                                        |\n    | | |- nova-compute        | enabled :-) 2015-03-17T08:38:14.000000 |\n    +--------------------------+----------------------------------------+\n\n## Evacuate\n\n#### Execute evacuate\n\nEvacuate Nova instance to node-28\n\n    # nova evacuate b103274a-fd6d-42cc-8cfb-c78f3d37c898 node-28\n    +-----------+--------------+\n    | Property  | Value        |\n    +-----------+--------------+\n    | adminPass | EtDTWFzQAe8q |\n    +-----------+--------------+\n\n#### Check the evacuate result\n\n* Nova instance has same parameters (id, hostname, uid, ip ...etc) which previous Nova instance had.\n* You can login to this instance by using above adminPass.\n\n````\n# nova list --field name,status,,OS-EXT-STS:vm_state,OS-EXT-AZ:availability_zone,OS-EXT-SRV-ATTR:hypervisor_hostname\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| ID                                   | Name       | Status |  | OS-EXT-STS: Vm State | OS-EXT-AZ: Availability Zone | OS-EXT-SRV-ATTR: Hypervisor Hostname |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n| b103274a-fd6d-42cc-8cfb-c78f3d37c898 | admin_vm01 | ACTIVE |  | active               | nova                         | node-28                              |\n+--------------------------------------+------------+--------+--+----------------------+------------------------------+--------------------------------------+\n````\n\n## Environment\n\n* Openstack : Juno\n* Ceph : Firefly\n\n## Reference\n\n[Openstack - Nova Evacuate with Shared Storage][link-01]\n[Openstack - Nova Evacuate with Shared Storage with Cinder][link-02]\n[Openstack - Nova Evacuate with Shared Storage with Cinder between AZ][link-03]\n[Openstack - Nova Evacuate without Shared Storage][link-04]\n[Openstack - Nova Host-Evacuate with Shared Storage][link-05]\n[Openstack - Nova Host-Evacuate with Shared Storage between AZ][link-06]\n\n[link-01]:http://qiita.com/idzzy/items/3f398ff8eaa3b786fc89\n[link-02]:http://qiita.com/idzzy/items/2f1add9d1a03e1a4fdea\n[link-03]:http://qiita.com/idzzy/items/8dd2b417f8c5f8efa7c9\n[link-04]:http://qiita.com/idzzy/items/860cb6c60ab7433eb817\n[link-05]:http://qiita.com/idzzy/items/9f057becb592c4c89137\n[link-06]:http://qiita.com/idzzy/items/71287b09de1370c68118\n", "tags": ["openstack", "nova"]}