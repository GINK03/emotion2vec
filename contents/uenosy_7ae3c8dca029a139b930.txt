{"context": " More than 1 year has passed since last update.Rails\u3068grape\u3092\u4f7f\u7528\u3057\u3066WebAPI\u3092\u4f5c\u6210\u3059\u308b\u3002\ngrape\u3067\u306f\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u4e8b\u7d30\u304b\u304f\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u306a\u305c\u304b\u300c\u3042\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u304c \u7279\u5b9a\u306e\u5024 \u306e\u5834\u5408\u306e\u307f\u3001\u5225\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u300d\u6a5f\u80fd\u304c\u306a\u3044\u3002\u305d\u3093\u306a\u306b\u30ec\u30a2\u30b1\u30fc\u30b9\u3060\u308d\u3046\u304b\uff1f\n\u3061\u306a\u307f\u306b\u3001\u300c\u3042\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u304c \u5b58\u5728\u3059\u308b \u5834\u5408\u306e\u307f\u3001\u5225\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u300d\u6a5f\u80fd\u306f\u3042\u308b\u3002\uff08given\u30d6\u30ed\u30c3\u30af\uff09\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306fRuby(2.2), Rails(4.2), grape(0.13.0)\u3067\u78ba\u8a8d\u3057\u305f\u3002\n\u4f8b\u3068\u3057\u3066\u3001\u6b21\u306e\u3088\u3046\u306aAPI\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002dish\u304c\"nigiri\"\u306e\u5834\u5408\u306e\u307famount_of_wasabi\u3092\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044\u3002\n\u4e0e\u3048\u3089\u308c\u308b\u6b63\u3057\u3044\u5165\u529b\u306f{ \"dish\": \"nigiri\", \"amount_of_wasabi\": \"M\" }\u304b{ \"dish\": \"chirashi\" }\u306e\u3088\u3046\u306a\u5f62\u3092\u60f3\u5b9a\u3059\u308b\u3002\n\u8003\u3048\u65b9\u3068\u3057\u3066\u306f\u3001\u7279\u5b9a\u306e\u5834\u5408\u306e\u307fvalidator\u3092\u8ffd\u52a0\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u9006\u306b\u7279\u5b9a\u306e\u5834\u5408\u306e\u307f\u5916\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\nmy_api.rb\nclass MyAPI < Grape::API\n  resource :sushi_menus do\n    params do\n      requires :dish, type: String, allow_blank: false, values: [\"nigiri\", \"chirashi\"]\n      requires :amount_of_wasabi, type: String, allow_blank: false, values: [\"w/o\", \"S\", \"M\", \"L\"]\n    end\n\n    before_validation do\n      # HACK: dish\u304c\"nigiri\"\u4ee5\u5916\u306e\u5834\u5408\u306famount_of_wasabi\u306evalidator\u3092\u5916\u3059\n      @rejected_validators = []\n      unless params[:dish] == \"nigiri\"\n        @rejected_validators = route_setting(:saved_validations).select { |v| v.attrs.include?(:amount_of_wasabi) }\n        route_setting(:saved_validations).reject! { |v| v.attrs.include?(:amount_of_wasabi) }\n      end\n    end\n\n    after_validation do\n      # HACK: \u5916\u3057\u305fvalidator\u3092\u623b\u3059\n      route_setting(:saved_validations).concat(@rejected_validators)\n    end     \n\n    post do\n      # ...\u7701\u7565\n    end\n  end\nend\n\n\n\u3053\u308c\u3067\u3067\u304d\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u3042\u307e\u308a\u306b\u3082\u919c\u60aa\u306a\u306e\u3067API\u8a2d\u8a08\u306e\u65b9\u3092\u5909\u3048\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u308b\u3002\n\n\u5225\u89e3\u3068\u3057\u3066\u306e\u8a2d\u8a08\u5909\u66f4\n\u5165\u529b\u3092{ \"dish\": { \"nigiri\": { \"amount_of_wasabi\": \"M\" } } }\u304b{ \"dish\": { \"chirashi\": true } }\u306e\u3088\u3046\u306a\u5f62\u306b\u5909\u66f4\u3059\u308b\u3002\n\nmy_api.rb\nclass MyAPI < Grape::API\n  resource :sushi_menus do\n    params do\n      requires :dish, type: Hash, allow_blank: false do\n        optional :nigiri, type: Hash do \n          requires :amount_of_wasabi, type: String, allow_blank: false, values: [\"w/o\", \"S\", \"M\", \"L\"]\n        end\n\n        optional :chirashi, type: Boolean, values: [true]\n\n        exactly_one_of :nigiri, :chirashi\n      end\n    end\n\n    post do\n      # ...\u7701\u7565\n    end\n  end\nend\n\n\n\nRails\u3068[grape](https://github.com/ruby-grape/grape)\u3092\u4f7f\u7528\u3057\u3066WebAPI\u3092\u4f5c\u6210\u3059\u308b\u3002\ngrape\u3067\u306f\u5165\u529b\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u304c\u4e8b\u7d30\u304b\u304f\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u306a\u305c\u304b\u300c\u3042\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u304c __\u7279\u5b9a\u306e\u5024__ \u306e\u5834\u5408\u306e\u307f\u3001\u5225\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u300d\u6a5f\u80fd\u304c\u306a\u3044\u3002\u305d\u3093\u306a\u306b\u30ec\u30a2\u30b1\u30fc\u30b9\u3060\u308d\u3046\u304b\uff1f\n\n\u3061\u306a\u307f\u306b\u3001\u300c\u3042\u308b\u30d1\u30e9\u30e1\u30fc\u30bf\u304c __\u5b58\u5728\u3059\u308b__ \u5834\u5408\u306e\u307f\u3001\u5225\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u300d\u6a5f\u80fd\u306f\u3042\u308b\u3002\uff08`given`\u30d6\u30ed\u30c3\u30af\uff09\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u306fRuby(2.2), Rails(4.2), grape(0.13.0)\u3067\u78ba\u8a8d\u3057\u305f\u3002\n\n\u4f8b\u3068\u3057\u3066\u3001\u6b21\u306e\u3088\u3046\u306aAPI\u304c\u3042\u3063\u305f\u3068\u3059\u308b\u3002`dish`\u304c`\"nigiri\"`\u306e\u5834\u5408\u306e\u307f`amount_of_wasabi`\u3092\u30c1\u30a7\u30c3\u30af\u3057\u305f\u3044\u3002\n\u4e0e\u3048\u3089\u308c\u308b\u6b63\u3057\u3044\u5165\u529b\u306f`{ \"dish\": \"nigiri\", \"amount_of_wasabi\": \"M\" }`\u304b`{ \"dish\": \"chirashi\" }`\u306e\u3088\u3046\u306a\u5f62\u3092\u60f3\u5b9a\u3059\u308b\u3002\n\n\u8003\u3048\u65b9\u3068\u3057\u3066\u306f\u3001\u7279\u5b9a\u306e\u5834\u5408\u306e\u307fvalidator\u3092\u8ffd\u52a0\u3059\u308b\u306e\u306f\u9762\u5012\u306a\u306e\u3067\u9006\u306b\u7279\u5b9a\u306e\u5834\u5408\u306e\u307f\u5916\u3059\u3088\u3046\u306b\u3059\u308b\u3002\n\n```ruby:my_api.rb\nclass MyAPI < Grape::API\n  resource :sushi_menus do\n    params do\n      requires :dish, type: String, allow_blank: false, values: [\"nigiri\", \"chirashi\"]\n      requires :amount_of_wasabi, type: String, allow_blank: false, values: [\"w/o\", \"S\", \"M\", \"L\"]\n    end\n\n    before_validation do\n      # HACK: dish\u304c\"nigiri\"\u4ee5\u5916\u306e\u5834\u5408\u306famount_of_wasabi\u306evalidator\u3092\u5916\u3059\n      @rejected_validators = []\n      unless params[:dish] == \"nigiri\"\n        @rejected_validators = route_setting(:saved_validations).select { |v| v.attrs.include?(:amount_of_wasabi) }\n        route_setting(:saved_validations).reject! { |v| v.attrs.include?(:amount_of_wasabi) }\n      end\n    end\n    \n    after_validation do\n      # HACK: \u5916\u3057\u305fvalidator\u3092\u623b\u3059\n      route_setting(:saved_validations).concat(@rejected_validators)\n    end\t\t\n    \n    post do\n      # ...\u7701\u7565\n    end\n  end\nend\n```\n\n\u3053\u308c\u3067\u3067\u304d\u308b\u3053\u3068\u306f\u3067\u304d\u308b\u304c\u3001\u3042\u307e\u308a\u306b\u3082\u919c\u60aa\u306a\u306e\u3067API\u8a2d\u8a08\u306e\u65b9\u3092\u5909\u3048\u3066\u3057\u307e\u3046\u3068\u3044\u3046\u624b\u3082\u3042\u308b\u3002\n\n### \u5225\u89e3\u3068\u3057\u3066\u306e\u8a2d\u8a08\u5909\u66f4\n\u5165\u529b\u3092`{ \"dish\": { \"nigiri\": { \"amount_of_wasabi\": \"M\" } } }`\u304b`{ \"dish\": { \"chirashi\": true } }`\u306e\u3088\u3046\u306a\u5f62\u306b\u5909\u66f4\u3059\u308b\u3002\n\n```ruby:my_api.rb\nclass MyAPI < Grape::API\n  resource :sushi_menus do\n    params do\n\t  requires :dish, type: Hash, allow_blank: false do\n        optional :nigiri, type: Hash do \n          requires :amount_of_wasabi, type: String, allow_blank: false, values: [\"w/o\", \"S\", \"M\", \"L\"]\n        end\n        \n        optional :chirashi, type: Boolean, values: [true]\n        \n        exactly_one_of :nigiri, :chirashi\n      end\n    end\n    \n    post do\n      # ...\u7701\u7565\n    end\n  end\nend\n```\n", "tags": ["Ruby", "grape", "Rails"]}