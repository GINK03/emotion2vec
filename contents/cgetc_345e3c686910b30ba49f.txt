{"context": "\n\u3044\u308d\u3044\u308d\u63a2\u3057\u307e\u3057\u305f\u304c\u3001\u96c6\u7d04\u3057\u305f\u60c5\u5831\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\ndocker-compose 1.3\u3067\u306flog-driver\u8a2d\u5b9a\u306bfluentd\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002 \u2192 1.8\u3067\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u8ffd\u8a18\u3057\u307e\u3057\u305f\u3002\n\n\ndocker\u304a\u3088\u3073docker-comopose\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\ndocker/docker-compose\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\ndocker\ndocker-compose\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\ndocker-compose.yml\nfluentd:\n  build: ./fluentd\n  links:\n   - \"elasticsearch\"\n# Fluentd logging driver\u5bfe\u5fdc\u306e\u5834\u5408\n  ports:\n   - \"22422:22422\"\n# Fluentd logging driver\u975e\u5bfe\u5fdc\u306e\u5834\u5408\n  volumes:\n   - /var/lib/docker/containers:/var/lib/docker/containers\n   - /var/run:/var/run\n   - /var/log/docker:/var/log/docker\n\nelasticsearch:\n  build: elasticsearch\n  expose:\n    - 9200\n\nkibana:\n  image: kibana\n  links:\n   - \"elasticsearch\"\n  ports:\n   - \"5601:5601\"\n\n\n\nfluentd\n\nFluentd logging driver\u5bfe\u5fdc\u306e\u5834\u5408\nplugins\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5fc5\u9808\u306a\u306e\u3067\u524d\u3082\u3063\u3066\u4f5c\u6210\u3059\u308b\nmkdir -p fluentd/plugins\n\nfluent-plugin-elasticsearch\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nFROM fluent/fluentd\n\nRUN [\"gem\", \"install\", \"fluent-plugin-elasticsearch\", \"--no-rdoc\", \"--no-ri\"]\n\n\nfluentd/fluent.conf\n<source>\n  type forward\n  port 24224\n  bind 0.0.0.0\n</source>\n<match docker.**>\n  type elasticsearch\n  log_level debug\n  host elasticsearch\n  port 9200\n  include_tag_key true\n  logstash_format true\n  flush_interval 5s\n</match>\n\n\n\nFluentd logging driver\u975e\u5bfe\u5fdc\u306e\u5834\u5408\n\ndocker\u306e\u30b3\u30f3\u30c6\u30ca\u540d\u304c\u7121\u3044\u3068\u4f55\u304b\u3068\u8f9b\u3044\u306e\u3067fluent-plugin-docker-tag-resolver\u3092\u4f7f\u3063\u3066\u51fa\u529b\u3057\u307e\u3057\u305f\u3002\n\nFROM kiyoto/fluentd:0.10.56-2.1.1\nMAINTAINER kiyoto@treausure-data.com\nRUN mkdir /etc/fluent\nADD fluent.conf /etc/fluent/\nRUN [\"apt-get\", \"update\"]\nRUN [\"apt-get\", \"install\", \"--yes\", \"make\", \"libcurl4-gnutls-dev\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-elasticsearch\", \"--no-rdoc\", \"--no-ri\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-record-reformer\", \"--no-rdoc\", \"--no-ri\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-docker-tag-resolver\", \"--no-rdoc\", \"--no-ri\"]\nENTRYPOINT [\"/usr/local/bin/fluentd\", \"-c\", \"/etc/fluent/fluent.conf\"]\n\n\nfluentd/fluent.conf\n<source>\n  type tail\n  path /var/lib/docker/containers/*/*-json.log\n  pos_file /var/log/fluentd-docker.pos\n  time_format %Y-%m-%dT%H:%M:%S\n  tag docker.log.*\n  format json\n</source>\n<match docker.log.**>\n  type docker_tag_resolver\n</match>\n<match docker.container.**>\n  type record_reformer\n  container_id ${tag_parts[4]}\n  container_name ${tag_parts[3]}\n  tag docker.all\n</match>\n<match docker.all>\n  type elasticsearch\n  log_level debug\n  host elasticsearch\n  port 9200\n  include_tag_key true\n  logstash_format true\n  flush_interval 5s\n</match>\n\n\n\nelasticsearch\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u5916\u304b\u3089\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067network.bind_host\u3092\u8a2d\u5b9a\u3059\u308b\nFROM elasticsearch\n\nRUN echo \"network.bind_host: 0.0.0.0\" >> /usr/share/elasticsearch/config/elasticsearch.yml\n\n\n\u8d77\u52d5\u65b9\u6cd5\ndocker-compose.yml\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\ndocker-compose up -d\n\n\n\u53c2\u8003\u60c5\u5831\nDocker 1.8 \u306e Fluentd logging driver \u3067\u30b3\u30f3\u30c6\u30ca\u30ed\u30b0\u3092\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b\n\n* \u3044\u308d\u3044\u308d\u63a2\u3057\u307e\u3057\u305f\u304c\u3001\u96c6\u7d04\u3057\u305f\u60c5\u5831\u304c\u306a\u304b\u3063\u305f\u306e\u3067\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n* ~~\u001ddocker-compose 1.3\u3067\u306flog-driver\u8a2d\u5b9a\u306bfluentd\u304c\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u3088\u3046\u3067\u3059\u3002~~ \u2192 1.8\u3067\u5bfe\u5fdc\u3057\u305f\u306e\u3067\u8ffd\u8a18\u3057\u307e\u3057\u305f\u3002\n\n# docker\u304a\u3088\u3073docker-comopose\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n* docker/docker-compose\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u516c\u5f0f\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n* [docker](https://docs.docker.com/)\n* [docker-compose](https://docs.docker.com/compose/install/)\n\n# \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306a\u3069\n\n\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```\u001ddocker-compose.yml\nfluentd:\n  build: ./fluentd\n  links:\n   - \"elasticsearch\"\n# Fluentd logging driver\u5bfe\u5fdc\u306e\u5834\u5408\n  ports:\n   - \"22422:22422\"\n# Fluentd logging driver\u975e\u5bfe\u5fdc\u306e\u5834\u5408\n  volumes:\n   - /var/lib/docker/containers:/var/lib/docker/containers\n   - /var/run:/var/run\n   - /var/log/docker:/var/log/docker\n\nelasticsearch:\n  build: elasticsearch\n  expose:\n    - 9200\n\nkibana:\n  image: kibana\n  links:\n   - \"elasticsearch\"\n  ports:\n   - \"5601:5601\"\n```\n\n## fluentd\n\n### Fluentd logging driver\u5bfe\u5fdc\u306e\u5834\u5408\nplugins\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u5fc5\u9808\u306a\u306e\u3067\u524d\u3082\u3063\u3066\u4f5c\u6210\u3059\u308b\n\n```\nmkdir -p \u001dfluentd/plugins\n```\n\nfluent-plugin-elasticsearch\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```\u001dfluentd/Dockerfile\nFROM fluent/fluentd\n\nRUN [\"gem\", \"install\", \"fluent-plugin-elasticsearch\", \"--no-rdoc\", \"--no-ri\"]\n```\n\n```fluentd/fluent.conf\n<source>\n  type forward\n  port 24224\n  bind 0.0.0.0\n</source>\n<match docker.**>\n  type elasticsearch\n  log_level debug\n  host elasticsearch\n  port 9200\n  include_tag_key true\n  logstash_format true\n  flush_interval 5s\n</match>\n```\n\n### Fluentd logging driver\u975e\u5bfe\u5fdc\u306e\u5834\u5408\n* docker\u306e\u30b3\u30f3\u30c6\u30ca\u540d\u304c\u7121\u3044\u3068\u4f55\u304b\u3068\u8f9b\u3044\u306e\u3067[fluent-plugin-docker-tag-resolver](https://github.com/ainoya/* fluent-plugin-docker-tag-resolver)\u3092\u4f7f\u3063\u3066\u51fa\u529b\u3057\u307e\u3057\u305f\u3002\n\n```\u001dfluentd/Dockerfile\nFROM kiyoto/fluentd:0.10.56-2.1.1\nMAINTAINER kiyoto@treausure-data.com\nRUN mkdir /etc/fluent\nADD fluent.conf /etc/fluent/\nRUN [\"apt-get\", \"update\"]\nRUN [\"apt-get\", \"install\", \"--yes\", \"make\", \"libcurl4-gnutls-dev\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-elasticsearch\", \"--no-rdoc\", \"--no-ri\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-record-reformer\", \"--no-rdoc\", \"--no-ri\"]\nRUN [\"/usr/local/bin/gem\", \"install\", \"fluent-plugin-docker-tag-resolver\", \"--no-rdoc\", \"--no-ri\"]\nENTRYPOINT [\"/usr/local/bin/fluentd\", \"-c\", \"/etc/fluent/fluent.conf\"]\n```\n\n```fluentd/fluent.conf\n<source>\n  type tail\n  path /var/lib/docker/containers/*/*-json.log\n  pos_file /var/log/fluentd-docker.pos\n  time_format %Y-%m-%dT%H:%M:%S\n  tag docker.log.*\n  format json\n</source>\n<match docker.log.**>\n  type docker_tag_resolver\n</match>\n<match docker.container.**>\n  type record_reformer\n  container_id ${tag_parts[4]}\n  container_name ${tag_parts[3]}\n  tag docker.all\n</match>\n<match docker.all>\n  type elasticsearch\n  log_level debug\n  host elasticsearch\n  port 9200\n  include_tag_key true\n  logstash_format true\n  flush_interval 5s\n</match>\n```\n\n## elasticsearch\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u5916\u304b\u3089\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067``network.bind_host``\u3092\u8a2d\u5b9a\u3059\u308b\n\n```elasticsearch/Dockerfile\nFROM elasticsearch\n\nRUN echo \"network.bind_host: 0.0.0.0\" >> /usr/share/elasticsearch/config/elasticsearch.yml\n```\n\n# \u8d77\u52d5\u65b9\u6cd5\ndocker-compose.yml\u306e\u3042\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n\n```\u001drun\ndocker-compose up -d\n```\n\n# \u53c2\u8003\u60c5\u5831\n[Docker 1.8 \u306e Fluentd logging driver \u3067\u30b3\u30f3\u30c6\u30ca\u30ed\u30b0\u3092\u30d5\u30a9\u30ef\u30fc\u30c9\u3059\u308b](http://qiita.com/kumatch/items/744076da68fa71b36a35)\n", "tags": ["fluentd", "kibana", "Elasticsearch", "docker", "docker-compose"]}