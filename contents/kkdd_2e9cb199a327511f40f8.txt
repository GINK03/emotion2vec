{"context": "\u3053\u3093\u306b\u3061\u306f\u3002\nMemSQL 5.1 \u3067\u5186\u9818\u57df\u5185\u306e\u5730\u70b9\u306e\u7a7a\u9593\u691c\u7d22\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306f\u6975\u3081\u3066\u901f\u304b\u3063\u305f\u3067\u3059\uff0811.5 s\u3001\u30c7\u30fc\u30bf\u6570\u7d04530\u4e07)\u3002\n\u7528\u3044\u305f\u5730\u70b9\u30c7\u30fc\u30bf\u306f\u3001\n$ head -n 2 points.json\n{\"type\":\"Point\",\"coordinates\":[135.7182012,34.944685]}\n{\"type\":\"Point\",\"coordinates\":[135.718176,34.9444206]}\n$\n\n\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306f\u3001\nCREATE TABLE `table_with_a_point` (\n  `json` text NOT NULL,\n  `point` as geography_point(json::coordinates::%`0`,json::coordinates::%`1`)\n     persisted geographypoint, index(point)\n);\nLOAD DATA LOCAL INFILE 'points.json'\nINTO TABLE table_with_a_point\nLINES TERMINATED BY '\\n'\n(json);\n\n  Query OK, 5313284 rows affected\n  Time: 11.525s\n\n\u7a7a\u9593\u691c\u7d22\u306f\u5186\u9818\u57df\u5185\u691c\u7d22\u304c\u5bb9\u6613\u3067\u3059\uff08 GEOGRAPHY_WITHIN_DISTANCE()\u3092\u4f7f\u7528\uff09\u3002\u3057\u304b\u3057\u691c\u7d22\u901f\u5ea6\u306f\u4e00\u6841\u9045\u30441\u3068\u601d\u3044\u307e\u3057\u305f\uff080.089s\uff09\nselect count(*) from table_with_a_point\n  where GEOGRAPHY_WITHIN_DISTANCE(geography_point(135.7182012, 34.944685), point, 200);\n+------------+\n|   count(*) |\n|------------|\n|         25 |\n+------------+\n1 row in set\nTime: 0.089s\n\nEXPLAIN | IndexRangeScan test.table_with_a_point, KEY point (point) scan:[geogra\nphy_within_distance(point, GEOGRAPHY_POINT(135.7183011,34.9437886), 200)]\n\nselect point, GEOGRAPHY_DISTANCE(geography_point(135.7182012, 34.944685), point) as dist\n from table_with_a_point where GEOGRAPHY_WITHIN_DISTANCE(geography_point(135.7182012, 34.944685), point, 200)\n ORDER BY dist asc limit 10;\n+---------------------------------+-----------+\n| point                           |      dist |\n|---------------------------------+-----------|\n| POINT(135.71820123 34.94468503) |   0       |\n| POINT(135.71820123 34.94468503) |   0       |\n| POINT(135.71821128 34.94473569) |   5.70343 |\n| POINT(135.71821128 34.94473569) |   5.70343 |\n| POINT(135.71817602 34.94442061) |  29.4757  |\n| POINT(135.71817602 34.94442061) |  29.4757  |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71814618 34.94378051) | 100.646   |\n+---------------------------------+-----------+\n10 rows in set\nTime: 0.321s\n\n\n\n\n\n\u4f8b\u3048\u3070MySQL\u3068\u6bd4\u8f03\u3057\u3066\uff1a\u300cMySQL (InnoDB) \u3067\u7a7a\u9593\u691c\u7d22 (st_within)\u300d\u00a0\u21a9\n\n\n\n\u3053\u3093\u306b\u3061\u306f\u3002\nMemSQL 5.1 \u3067\u5186\u9818\u57df\u5185\u306e\u5730\u70b9\u306e\u7a7a\u9593\u691c\u7d22\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306f\u6975\u3081\u3066\u901f\u304b\u3063\u305f\u3067\u3059\uff0811.5 s\u3001\u30c7\u30fc\u30bf\u6570\u7d04530\u4e07)\u3002\n\n\u7528\u3044\u305f\u5730\u70b9\u30c7\u30fc\u30bf\u306f\u3001\n\n```console\n$ head -n 2 points.json\n{\"type\":\"Point\",\"coordinates\":[135.7182012,34.944685]}\n{\"type\":\"Point\",\"coordinates\":[135.718176,34.9444206]}\n$\n```\n\n\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u306f\u3001\n\n```mysql\nCREATE TABLE `table_with_a_point` (\n  `json` text NOT NULL,\n  `point` as geography_point(json::coordinates::%`0`,json::coordinates::%`1`)\n     persisted geographypoint, index(point)\n);\nLOAD DATA LOCAL INFILE 'points.json'\nINTO TABLE table_with_a_point\nLINES TERMINATED BY '\\n'\n(json);\n\n  Query OK, 5313284 rows affected\n  Time: 11.525s\n```\n\n\u7a7a\u9593\u691c\u7d22\u306f\u5186\u9818\u57df\u5185\u691c\u7d22\u304c\u5bb9\u6613\u3067\u3059\uff08 ```GEOGRAPHY_WITHIN_DISTANCE()```\u3092\u4f7f\u7528\uff09\u3002\u3057\u304b\u3057\u691c\u7d22\u901f\u5ea6\u306f\u4e00\u6841\u9045\u3044[^1]\u3068\u601d\u3044\u307e\u3057\u305f\uff080.089s\uff09\n\n\n```mysql\nselect count(*) from table_with_a_point\n  where GEOGRAPHY_WITHIN_DISTANCE(geography_point(135.7182012, 34.944685), point, 200);\n+------------+\n|   count(*) |\n|------------|\n|         25 |\n+------------+\n1 row in set\nTime: 0.089s\n\nEXPLAIN | IndexRangeScan test.table_with_a_point, KEY point (point) scan:[geogra\nphy_within_distance(point, GEOGRAPHY_POINT(135.7183011,34.9437886), 200)]\n\nselect point, GEOGRAPHY_DISTANCE(geography_point(135.7182012, 34.944685), point) as dist\n from table_with_a_point where GEOGRAPHY_WITHIN_DISTANCE(geography_point(135.7182012, 34.944685), point, 200)\n ORDER BY dist asc limit 10;\n+---------------------------------+-----------+\n| point                           |      dist |\n|---------------------------------+-----------|\n| POINT(135.71820123 34.94468503) |   0       |\n| POINT(135.71820123 34.94468503) |   0       |\n| POINT(135.71821128 34.94473569) |   5.70343 |\n| POINT(135.71821128 34.94473569) |   5.70343 |\n| POINT(135.71817602 34.94442061) |  29.4757  |\n| POINT(135.71817602 34.94442061) |  29.4757  |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71830108 34.94378856) | 100.041   |\n| POINT(135.71814618 34.94378051) | 100.646   |\n+---------------------------------+-----------+\n10 rows in set\nTime: 0.321s\n```\n\n[^1]: \u4f8b\u3048\u3070MySQL\u3068\u6bd4\u8f03\u3057\u3066\uff1a\u300c[MySQL (InnoDB) \u3067\u7a7a\u9593\u691c\u7d22 (st_within)](http://qiita.com/kkdd/items/2e26d9dd25673e52c1af)\u300d\n", "tags": ["GIS", "MemSQL", "MySQL"]}