{"context": "\n\n\u7d4c\u7def\n\n\nSQLite\u306b\u306fsqlite3_create_collation\u3068\u3044\u3046\u6587\u5b57\u5217\u6bd4\u8f03\u3092\u30ab\u30b9\u30bf\u30e0\u51fa\u6765\u308b\u6a5f\u80fd\u304c\u3042\u308b\u3089\u3057\u3044\n\nICU(International Components for Unicode)\u3063\u3066Unicode\u6b63\u898f\u5316\u3092\u8003\u616e\u3057\u305fcollation\u306e\u5b9f\u88c5\u304c\u3042\u3063\u305f\u3088\u3046\u306a\u30fb\u30fb\u30fb\n\u66d6\u6627\u691c\u7d22\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\uff01\n\u3067\u304d\u305f \u2192 https://github.com/Nanashia/ICUandSQLiteTest (x64\u30d3\u30eb\u30c9\u69cb\u6210\u3057\u304b\u7528\u610f\u3057\u3066\u3044\u306a\u3044\u3067\u3059)\n\n\n\u3084\u308a\u304b\u305f\n\u30ab\u30b9\u30bf\u30e0\u6bd4\u8f03\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3066\nint collate_CUSTOM(void* ptr, int len1, const void* ptr1, int len2, const void* ptr2) {\n    // ptr1\u3068ptr2\u304b\u3089UTF-8\u6587\u5b57\u5217\u3092\u751f\u6210\n    StringPiece s1((const char*)ptr1, len1);\n    StringPiece s2((const char*)ptr2, len2);\n\n    // \u6bd4\u8f03\n    UErrorCode status;\n    return ((Collator*)ptr)->compareUTF8(s1, s2, status);\n}\n\nICU\u306eCollator\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u304a\u304f\n    UErrorCode status = U_ZERO_ERROR;\n    coll = Collator::createInstance(Locale(locale_lang), status));\n    if (U_FAILURE(status) || !coll) {\n\nlocale_lang\u306fCollator\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u6e21\u3059Collation Types\u3068Setting Options\u3092\u6307\u5b9a\u3059\u308b\n\u53c2\u8003: http://userguide.icu-project.org/collation/customization\n// Colletion\u306e\u8abf\u6574\n// http://www.unicode.org/reports/tr35/tr35-collation.html#Collation_Settings\nstatic const char* const locale_lang = \n    \"de-u-co-phonebk\"\n    \"-ka-shifted\"     // \u7a7a\u767d\u7121\u8996\n    \"-ks-level1\";     // strength\uff08\u53b3\u5bc6\u3055\u3092\u6700\u3082\u3086\u308b\u304f\uff09\n\nSQLite\u306bcollation\u7528\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af(collate_CUSTOM)\u3092\u767b\u9332\n    ret = sqlite3_create_collation(db, \"CUSTOM\", SQLITE_UTF8, coll, collate_CUSTOM);\n    if (ret) {\n\n\u5b9f\u969b\u306b\u691c\u7d22\u6642\u306b\n    SELECT * FROM tbl_example where text = 'b b' COLLATE CUSTOM;\n    SELECT * FROM tbl_example order by text COLLATE CUSTOM;\n\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u547c\u3073\u51fa\u3059\n\n\u5b9f\u9a13\n\u6b21\u306e\u3088\u3046\u306a\u30c6\u30fc\u30d6\u30eb\u3067\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n1            a            \n2            A            \n3            \u212b          \n4            \u2200          \n5            \u00e0           \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n12           bb           \n13           b b          \u2190\u9593\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9  \n14           b  b         \u2190\u9593\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9  \n15           b\u3000b         \u2190\u9593\u306b\u5168\u89d2\u30b9\u30da\u30fc\u30b9 \n16           b\u3000\u3000b       \u2190\u9593\u306b\u5168\u89d2\u30b9\u30da\u30fc\u30b9\n17           b  b         \u2190\u9593\u306b\u30bf\u30d6\u6587\u5b57\n18           b      b     \u2190\u9593\u306b\u30bf\u30d6\u6587\u5b57\n\n\u691c\u7d22\u3057\u3066\u307f\u305f\u7d50\u679c\nSELECT * FROM tbl_example where text = 'a' COLLATE CUSTOM;\n\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n1            a            \n2            A            \n3            \u212b          \n5            \u00e0           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n\nSELECT * FROM tbl_example where text = 'ae' COLLATE CUSTOM;\n\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n\nSELECT * FROM tbl_example where text = 'b b' COLLATE CUSTOM;\n\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n12           bb           \n13           b b          \n14           b  b         \n15           b\u3000b        \n16           b\u3000\u3000b     \n17           b  b          \n18           b      b         \n\nSELECT * FROM tbl_example order by text COLLATE CUSTOM;\n\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n4            \u2200          \n1            a            \n2            A            \n3            \u212b          \n5            \u00e0           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n12           bb           \n13           b b          \n14           b  b         \n15           b\u3000b        \n16           b\u3000\u3000b     \n17           b  b          \n18           b      b         \n\n\u306a\u3093\u3068\u306a\u304f\u66d6\u6627\u306a\u611f\u3058\u3067\u691c\u7d22\u3067\u304d\u3066\u3044\u308b\u6c17\u304c\u3059\u308b\n\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u306f\u691c\u8a3c\u304c\u9762\u5012\u306a\u306e\u3067\u5bdf\u3057\u3066\u304f\u3060\u3055\u3044\n# \u7d4c\u7def\n\n1. [SQLite](https://www.sqlite.org/)\u306b\u306f`sqlite3_create_collation`\u3068\u3044\u3046\u6587\u5b57\u5217\u6bd4\u8f03\u3092\u30ab\u30b9\u30bf\u30e0\u51fa\u6765\u308b\u6a5f\u80fd\u304c\u3042\u308b\u3089\u3057\u3044\n1. [ICU(International Components for Unicode)](http://site.icu-project.org/)\u3063\u3066Unicode\u6b63\u898f\u5316\u3092\u8003\u616e\u3057\u305fcollation\u306e\u5b9f\u88c5\u304c\u3042\u3063\u305f\u3088\u3046\u306a\u30fb\u30fb\u30fb\n1. \u66d6\u6627\u691c\u7d22\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\uff01\n1. \u3067\u304d\u305f \u2192 https://github.com/Nanashia/ICUandSQLiteTest (x64\u30d3\u30eb\u30c9\u69cb\u6210\u3057\u304b\u7528\u610f\u3057\u3066\u3044\u306a\u3044\u3067\u3059)\n\n# \u3084\u308a\u304b\u305f\n\n\u30ab\u30b9\u30bf\u30e0\u6bd4\u8f03\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u3066\n\n```cpp\nint collate_CUSTOM(void* ptr, int len1, const void* ptr1, int len2, const void* ptr2) {\n\t// ptr1\u3068ptr2\u304b\u3089UTF-8\u6587\u5b57\u5217\u3092\u751f\u6210\n\tStringPiece s1((const char*)ptr1, len1);\n\tStringPiece s2((const char*)ptr2, len2);\n\n\t// \u6bd4\u8f03\n\tUErrorCode status;\n\treturn ((Collator*)ptr)->compareUTF8(s1, s2, status);\n}\n```\n\nICU\u306eCollator\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u3066\u304a\u304f\n\n```cpp\n\tUErrorCode status = U_ZERO_ERROR;\n\tcoll = Collator::createInstance(Locale(locale_lang), status));\n\tif (U_FAILURE(status) || !coll) {\n```\n\nlocale_lang\u306fCollator\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u6e21\u3059Collation Types\u3068Setting Options\u3092\u6307\u5b9a\u3059\u308b\n\u53c2\u8003: http://userguide.icu-project.org/collation/customization\n\n```cpp\n// Colletion\u306e\u8abf\u6574\n// http://www.unicode.org/reports/tr35/tr35-collation.html#Collation_Settings\nstatic const char* const locale_lang = \n\t\"de-u-co-phonebk\"\n\t\"-ka-shifted\"     // \u7a7a\u767d\u7121\u8996\n\t\"-ks-level1\";     // strength\uff08\u53b3\u5bc6\u3055\u3092\u6700\u3082\u3086\u308b\u304f\uff09\n```\n\nSQLite\u306bcollation\u7528\u306e\u30b3\u30fc\u30eb\u30d0\u30c3\u30af(collate_CUSTOM)\u3092\u767b\u9332\n\n```cpp\n\tret = sqlite3_create_collation(db, \"CUSTOM\", SQLITE_UTF8, coll, collate_CUSTOM);\n\tif (ret) {\n```\n\n\u5b9f\u969b\u306b\u691c\u7d22\u6642\u306b\n\n```sql\n\tSELECT * FROM tbl_example where text = 'b b' COLLATE CUSTOM;\n\tSELECT * FROM tbl_example order by text COLLATE CUSTOM;\n```\n\n\u307f\u305f\u3044\u306a\u611f\u3058\u3067\u547c\u3073\u51fa\u3059\n\n# \u5b9f\u9a13\n\n\u6b21\u306e\u3088\u3046\u306a\u30c6\u30fc\u30d6\u30eb\u3067\n\n```text\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n1            a            \n2            A            \n3            \u212b          \n4            \u2200          \n5            \u00e0           \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n12           bb           \n13           b b          \u2190\u9593\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9  \n14           b  b         \u2190\u9593\u306b\u534a\u89d2\u30b9\u30da\u30fc\u30b9  \n15           b\u3000b         \u2190\u9593\u306b\u5168\u89d2\u30b9\u30da\u30fc\u30b9 \n16           b\u3000\u3000b       \u2190\u9593\u306b\u5168\u89d2\u30b9\u30da\u30fc\u30b9\n17           b\tb         \u2190\u9593\u306b\u30bf\u30d6\u6587\u5b57\n18           b\t\tb     \u2190\u9593\u306b\u30bf\u30d6\u6587\u5b57\n```\n\n\u691c\u7d22\u3057\u3066\u307f\u305f\u7d50\u679c\n\n```sql\nSELECT * FROM tbl_example where text = 'a' COLLATE CUSTOM;\n```\n```text\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n1            a            \n2            A            \n3            \u212b          \n5            \u00e0           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n```\n```sql\nSELECT * FROM tbl_example where text = 'ae' COLLATE CUSTOM;\n```\n```text\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n```\n```sql\nSELECT * FROM tbl_example where text = 'b b' COLLATE CUSTOM;\n```\n```text\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n12           bb           \n13           b b          \n14           b  b         \n15           b\u3000b        \n16           b\u3000\u3000b     \n17           b\tb          \n18           b\t\tb         \n```\n```sql\nSELECT * FROM tbl_example order by text COLLATE CUSTOM;\n```\n```text\nid           text         \n~~~~~~~~~~~~ ~~~~~~~~~~~~ \n4            \u2200          \n1            a            \n2            A            \n3            \u212b          \n5            \u00e0           \n9            \u00e5           \n10           \uff21          \n11           \uff41          \n6            \u00e6           \n7            \u01e2           \n8            \u01de           \n12           bb           \n13           b b          \n14           b  b         \n15           b\u3000b        \n16           b\u3000\u3000b     \n17           b\tb          \n18           b\t\tb         \n```\n\n\u306a\u3093\u3068\u306a\u304f\u66d6\u6627\u306a\u611f\u3058\u3067\u691c\u7d22\u3067\u304d\u3066\u3044\u308b\u6c17\u304c\u3059\u308b\n~~\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u306f\u691c\u8a3c\u304c\u9762\u5012\u306a\u306e\u3067\u5bdf\u3057\u3066\u304f\u3060\u3055\u3044~~\n", "tags": ["C++", "ICU", "SQLite3"]}