{"context": " More than 1 year has passed since last update.\n\nIntro\nAndroid\u306eSQLite3\u306eLock\u3068Transaction Immediate/Exclusive\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f. \n\u57fa\u790e\u3068\u306a\u308b\u77e5\u8b58\u3068\u3057\u3066\u306f \u4e0b\u8a18 \u3092\u53c2\u7167. \n\nYuki\u306e\u679d\u6298 - Android: SQLite3 Lock\u3068Transaction Immediate/Exclusive\nQiita - \u540c\u6642\u5b9f\u884c\u5236\u5fa1\u3068SQLite3\n\n\nLocking And Concurrency In SQLite3\nOracle\u7b49\u306eDBMS\u3067\u306f\"\u884c\u30ed\u30c3\u30af\"\u306a\u3069\u7d30\u304b\u304f\u30ed\u30c3\u30af\u7c92\u5ea6\u3092\u5236\u5fa1\u3067\u304d\u308b\u304c, SQLite\u3067\u306f\u3053\u308c\u304c\u3067\u304d\u306a\u3044. \nSQLite\u306e\u30ed\u30c3\u30af\u7c92\u5ea6\u306f\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5358\u4f4d\"\u306e\u307f\u3067\u3042\u308b. \u3053\u306e\u305f\u3081Read/Write\u30ed\u30c3\u30af\u53d6\u5f97\uff5e\u89e3\u653e\u307e\u3067\u306e\u9593, \u4ed6\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044. (\u3053\u306e\u3053\u3068\u306f\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5206\u5272\u3059\u308b/\u3057\u306a\u3044\"\u306e\u5224\u65ad\u57fa\u6e96\u306e\uff11\u3064\u306b\u306f\u306a\u308a\u305d\u3046)\nAndroid\u3067\u306fSQLite\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3068\u3057\u3066Immediate\u3068Exclusive\u3092API\u3067\u6307\u5b9a\u3067\u304d\u308b. \u7279\u306b\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306fExclusive\u30e2\u30fc\u30c9\u3068\u306a\u308b. \n\nTransaction Immediate\n\u30ed\u30c3\u30af\u53d6\u5f97\u4e2d\u306f\u4ed6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u66f8\u304d\u8fbc\u307f\u3092\u5236\u9650\u3057, \u8aad\u307f\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308bmode. \nExclusive mode\u3088\u308a\u7de9\u3044\u5206\u96e2\u30ec\u30d9\u30eb\u3067\u3042\u308b\u305f\u3081\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4e26\u5217\u5316\u3092\u4fc3\u9032\u3067\u304d, \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u3067\u671f\u5f85\u3067\u304d\u308b. \u305f\u3060\u3057, Phantom Read\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b. \n\nIMMEDIATE. \n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306bRESERVED\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b. BEGIN IMMEDIATE\u306b\u3088\u308aRESERVED\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3055\u308c\u308b\u3068, \u4ed6\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u66f8\u304d\u8fbc\u3093\u3060\u308a, BEGIN IMMEDIATE or BEGIN EXCLUSIVE\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u304c, \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u306e\u8aad\u307f\u8fbc\u307f\u3092\u7d99\u7d9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b. \nANSI/ISO SQL\u6a19\u6e96\u3067\u306f REPEATABLE_READ \u306b\u76f8\u5f53\u3059\u308b. \n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306b\u66f8\u304d\u8fbc\u307f\u5c02\u7528\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3 \u3068 \u8aad\u307f\u8fbc\u307f\u5c02\u7528\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u3088\u3046\u306bRead/Write\u3092\u5206\u96e2\u3067\u304d\u308b\u306e\u3067\u3042\u308c\u3070Immediate mode\u306f\u6709\u52b9\u306b\u4f5c\u7528\u3059\u308b. \nImmediate mode\u3067\u306fPhantom Read\u304c\u767a\u751f\u3059\u308b\u305f\u3081, \u6b21\u306e\u3088\u3046\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u306f\u4e00\u8cab\u6027\u304c\u640d\u306a\u308f\u308c\u308b. \n\n\nTransaction Exclusive\n\u30ed\u30c3\u30af\u53d6\u5f97\u4e2d\u306f\u4ed6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u8aad\u307f\u8fbc\u307f/\u66f8\u304d\u8fbc\u307f\u3092\u5236\u9650\u3059\u308bmode.\nImmediate\u3088\u308a\u53b3\u3057\u3044\u5206\u96e2\u30ec\u30d9\u30eb\u3067\u3042\u308b\u305f\u3081\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u76f4\u5217\u5316\u304c\u4fc3\u9032\u3055\u308c, \u30c7\u30fc\u30bf\u306e\u4e00\u8cab\u6027\u304c\u5411\u4e0a\u3059\u308b. \u305f\u3060\u3057\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306fImmediate\u306b\u52a3\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044. \n\nEXCLUSIVE\n\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306bEXCLUSIVE\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b. BEGIN EXCLUSIVE\u306b\u3088\u308aEXCLUSIVE\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3055\u308c\u308b\u3068, READ_UNCOMMITTED\u306e\u63a5\u7d9a\u3092\u9664\u3044\u305f\u5168\u3066\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306b\u3064\u3044\u3066\u306f\u4f8b\u5916\u306a\u304f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u5b8c\u4e86\u307e\u3067\u8a31\u53ef\u3055\u308c\u306a\u3044. \nANSI/ISO SQL\u6a19\u6e96\u3067\u306f SERIALIZABLE \u306b\u76f8\u5f53\u3059\u308b. \n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u5b8c\u5168\u306a\u30c7\u30fc\u30bf\u306e\u4e00\u8cab\u6027\u304c\u6c42\u3081\u3089\u308c\u308b\u5834\u5408\u306fExclusive mode\u3092\u6307\u5b9a\u3059\u308b. \n\nImplements\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089Transaction mode\u3092\u6307\u5b9a\u3059\u308b\u306b\u306fSQLiteDataBase\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3059\u308b. \n\nSQLiteDataBase.beginTransaction()\nSQLiteDataBase.beginTransactionWithListener(SQLiteTransactionListener)\nSQLiteDataBase.beginTransactionNonExclusive()\nSQLiteDataBase.beginTransactionWithListenerNonExclusive(SQLiteTransactionListener)\n\nbeginTransactionNonExclusive/beginTransactionWithListenerNonExclusive\u306fAPI Level11\u3067\u8ffd\u52a0\u3055\u308c\u305fAPI.\nbeginTransaction/beginTransactionWithListener\u3067\u958b\u59cb\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306fExclusive mode\u3067, \nbeginTransactionNonExclusive/beginTransactionWithListenerNonExclusive\u3067\u958b\u59cb\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306fImmediate mode\u3067\u52d5\u4f5c\u3059\u308b. \n// Transaction Exclusive mode\ndb.beginTransaction();\ntry {\n    // do something.\n    db.setTransactionSuccessful();\n} finally {\n    db.endTransaction();\n}\n\n// Transaction Immediate mode\ndb.beginTransactionNonExclusive();\ntry {\n    // do something.\n    db.setTransactionSuccessful();\n} finally {\n    db.endTransaction();\n}\n\n\nSQLiteDatabaseLockedException\n\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057, SQLiteDatabase\u7d4c\u7531\u3067\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306e\u6319\u52d5\u306f\u4e0b\u8a18. \n\nSQLiteDatabase.query\n\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3067\u304d\u308b\u307e\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u5f85\u6a5f\u3055\u308c\u308b. API Level16\u4ee5\u964d\u306fCancellationSignal\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b. \n\nSQLiteDatabase.insert\nSQLiteDatabase\u304cSQLiteDatabaseLockedException\u3092\u30ad\u30e3\u30c3\u30c1\u3057, \u547c\u51fa\u3057\u5143\u306b-1\u3092\u8fd4\u3059. \npublic long insert(String table, String nullColumnHack, ContentValues values) {\n    try {\n        return insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);\n    } catch (SQLException e) {\n        Log.e(TAG, \"Error inserting \" + values, e);\n        return -1;\n    }\n}\n\n\nSQLiteDatabase.insertOrThrow\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \npublic long insertOrThrow(String table, String nullColumnHack, ContentValues values)\n        throws SQLException {\n    return insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);\n}\n\n\nSQLiteDatabase.update\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\nSQLiteDatabase.delete\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\nSQLiteDatabase.beginTransaction\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\nReference\nFile Locking And Concurrency In SQLite Version 3\n\u4ee5\u4e0a. \n\u8ee2\u8a18\u5143: http://yuki312.blogspot.jp/2012/07/androidsqlitetransaction.html\nIntro\n------------------------------------------------------\n\nAndroid\u306eSQLite3\u306eLock\u3068Transaction Immediate/Exclusive\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u305f. \n\u57fa\u790e\u3068\u306a\u308b\u77e5\u8b58\u3068\u3057\u3066\u306f \u4e0b\u8a18 \u3092\u53c2\u7167. \n\n - [Yuki\u306e\u679d\u6298 - Android: SQLite3 Lock\u3068Transaction Immediate/Exclusive](http://yuki312.blogspot.jp/2014/10/android-sqlite3.html)\n - [Qiita - \u540c\u6642\u5b9f\u884c\u5236\u5fa1\u3068SQLite3](http://qiita.com/Yuki_312/items/7a7dff204e67af0c613a)\n\nLocking And Concurrency In SQLite3\n------------------------------------------------------\n\nOracle\u7b49\u306eDBMS\u3067\u306f\"\u884c\u30ed\u30c3\u30af\"\u306a\u3069\u7d30\u304b\u304f\u30ed\u30c3\u30af\u7c92\u5ea6\u3092\u5236\u5fa1\u3067\u304d\u308b\u304c, SQLite\u3067\u306f\u3053\u308c\u304c\u3067\u304d\u306a\u3044. \nSQLite\u306e\u30ed\u30c3\u30af\u7c92\u5ea6\u306f\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5358\u4f4d\"\u306e\u307f\u3067\u3042\u308b. \u3053\u306e\u305f\u3081Read/Write\u30ed\u30c3\u30af\u53d6\u5f97\uff5e\u89e3\u653e\u307e\u3067\u306e\u9593, \u4ed6\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u306a\u3044. (\u3053\u306e\u3053\u3068\u306f\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u5206\u5272\u3059\u308b/\u3057\u306a\u3044\"\u306e\u5224\u65ad\u57fa\u6e96\u306e\uff11\u3064\u306b\u306f\u306a\u308a\u305d\u3046)\n\nAndroid\u3067\u306fSQLite\u306e\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3068\u3057\u3066Immediate\u3068Exclusive\u3092API\u3067\u6307\u5b9a\u3067\u304d\u308b. \u7279\u306b\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u306fExclusive\u30e2\u30fc\u30c9\u3068\u306a\u308b. \n\n### Transaction Immediate\n\n\u30ed\u30c3\u30af\u53d6\u5f97\u4e2d\u306f\u4ed6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u66f8\u304d\u8fbc\u307f\u3092\u5236\u9650\u3057, \u8aad\u307f\u8fbc\u307f\u3092\u8a31\u53ef\u3059\u308bmode. \nExclusive mode\u3088\u308a\u7de9\u3044\u5206\u96e2\u30ec\u30d9\u30eb\u3067\u3042\u308b\u305f\u3081\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u4e26\u5217\u5316\u3092\u4fc3\u9032\u3067\u304d, \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u9762\u3067\u671f\u5f85\u3067\u304d\u308b. \u305f\u3060\u3057, Phantom Read\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b. \n\n> IMMEDIATE. \n> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306bRESERVED\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b. BEGIN IMMEDIATE\u306b\u3088\u308aRESERVED\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3055\u308c\u308b\u3068, \u4ed6\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u66f8\u304d\u8fbc\u3093\u3060\u308a, BEGIN IMMEDIATE or BEGIN EXCLUSIVE\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b\u304c, \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u304b\u3089\u306e\u8aad\u307f\u8fbc\u307f\u3092\u7d99\u7d9a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u308b. \nANSI/ISO SQL\u6a19\u6e96\u3067\u306f `REPEATABLE_READ` \u306b\u76f8\u5f53\u3059\u308b. \n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u30a2\u30af\u30bb\u30b9\u3059\u308b\u306e\u306b\u66f8\u304d\u8fbc\u307f\u5c02\u7528\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3 \u3068 \u8aad\u307f\u8fbc\u307f\u5c02\u7528\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u3088\u3046\u306bRead/Write\u3092\u5206\u96e2\u3067\u304d\u308b\u306e\u3067\u3042\u308c\u3070Immediate mode\u306f\u6709\u52b9\u306b\u4f5c\u7528\u3059\u308b. \n\nImmediate mode\u3067\u306fPhantom Read\u304c\u767a\u751f\u3059\u308b\u305f\u3081, \u6b21\u306e\u3088\u3046\u306a\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u306f\u4e00\u8cab\u6027\u304c\u640d\u306a\u308f\u308c\u308b. \n\n![Phantom Read](https://qiita-image-store.s3.amazonaws.com/0/3888/0eaaf435-40b6-0d60-f618-9e62b1aa2f15.png)\n\n\n### Transaction Exclusive\n\n\u30ed\u30c3\u30af\u53d6\u5f97\u4e2d\u306f\u4ed6\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u8aad\u307f\u8fbc\u307f/\u66f8\u304d\u8fbc\u307f\u3092\u5236\u9650\u3059\u308bmode.\nImmediate\u3088\u308a\u53b3\u3057\u3044\u5206\u96e2\u30ec\u30d9\u30eb\u3067\u3042\u308b\u305f\u3081\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u76f4\u5217\u5316\u304c\u4fc3\u9032\u3055\u308c, \u30c7\u30fc\u30bf\u306e\u4e00\u8cab\u6027\u304c\u5411\u4e0a\u3059\u308b. \u305f\u3060\u3057\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306fImmediate\u306b\u52a3\u308b\u53ef\u80fd\u6027\u304c\u9ad8\u3044. \n\n> EXCLUSIVE\n> \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u958b\u59cb\u6642\u306bEXCLUSIVE\u30ed\u30c3\u30af\u3092\u53d6\u5f97\u3059\u308b. BEGIN EXCLUSIVE\u306b\u3088\u308aEXCLUSIVE\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3055\u308c\u308b\u3068, READ_UNCOMMITTED\u306e\u63a5\u7d9a\u3092\u9664\u3044\u305f\u5168\u3066\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304b\u3089\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308b. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306b\u3064\u3044\u3066\u306f\u4f8b\u5916\u306a\u304f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u5b8c\u4e86\u307e\u3067\u8a31\u53ef\u3055\u308c\u306a\u3044. \nANSI/ISO SQL\u6a19\u6e96\u3067\u306f `SERIALIZABLE` \u306b\u76f8\u5f53\u3059\u308b. \n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057\u3066\u5b8c\u5168\u306a\u30c7\u30fc\u30bf\u306e\u4e00\u8cab\u6027\u304c\u6c42\u3081\u3089\u308c\u308b\u5834\u5408\u306fExclusive mode\u3092\u6307\u5b9a\u3059\u308b. \n\n\n\nImplements\n------------------------------------------------------\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089Transaction mode\u3092\u6307\u5b9a\u3059\u308b\u306b\u306f`SQLiteDataBase`\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3059\u308b. \n\n - `SQLiteDataBase.beginTransaction()`\n - `SQLiteDataBase.beginTransactionWithListener(SQLiteTransactionListener)`\n - `SQLiteDataBase.beginTransactionNonExclusive()`\n - `SQLiteDataBase.beginTransactionWithListenerNonExclusive(SQLiteTransactionListener)`\n\nbeginTransactionNonExclusive/beginTransactionWithListenerNonExclusive\u306fAPI Level11\u3067\u8ffd\u52a0\u3055\u308c\u305fAPI.\n\nbeginTransaction/beginTransactionWithListener\u3067\u958b\u59cb\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306fExclusive mode\u3067, \nbeginTransactionNonExclusive/beginTransactionWithListenerNonExclusive\u3067\u958b\u59cb\u3055\u308c\u305f\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306fImmediate mode\u3067\u52d5\u4f5c\u3059\u308b. \n\n```java\n// Transaction Exclusive mode\ndb.beginTransaction();\ntry {\n    // do something.\n    db.setTransactionSuccessful();\n} finally {\n    db.endTransaction();\n}\n\n// Transaction Immediate mode\ndb.beginTransactionNonExclusive();\ntry {\n    // do something.\n    db.setTransactionSuccessful();\n} finally {\n    db.endTransaction();\n}\n```\n\n\n### SQLiteDatabaseLockedException\n\n\u30ed\u30c3\u30af\u3055\u308c\u3066\u3044\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u3057, SQLiteDatabase\u7d4c\u7531\u3067\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3057\u305f\u5834\u5408\u306e\u6319\u52d5\u306f\u4e0b\u8a18. \n\n#### SQLiteDatabase.query\n\n\u30ed\u30c3\u30af\u304c\u53d6\u5f97\u3067\u304d\u308b\u307e\u3067\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306f\u5f85\u6a5f\u3055\u308c\u308b. API Level16\u4ee5\u964d\u306f[CancellationSignal](http://developer.android.com/reference/android/os/CancellationSignal.html)\u3092\u4f7f\u3063\u3066\u30af\u30a8\u30ea\u3092\u30ad\u30e3\u30f3\u30bb\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b. \n\n\n#### SQLiteDatabase.insert\n\nSQLiteDatabase\u304cSQLiteDatabaseLockedException\u3092\u30ad\u30e3\u30c3\u30c1\u3057, \u547c\u51fa\u3057\u5143\u306b-1\u3092\u8fd4\u3059. \n\n```java\npublic long insert(String table, String nullColumnHack, ContentValues values) {\n    try {\n        return insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);\n    } catch (SQLException e) {\n        Log.e(TAG, \"Error inserting \" + values, e);\n        return -1;\n    }\n}\n```\n\n#### SQLiteDatabase.insertOrThrow\n\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\n```java\npublic long insertOrThrow(String table, String nullColumnHack, ContentValues values)\n        throws SQLException {\n    return insertWithOnConflict(table, nullColumnHack, values, CONFLICT_NONE);\n}\n```\n\n#### SQLiteDatabase.update\n\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\n#### SQLiteDatabase.delete\n\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\n#### SQLiteDatabase.beginTransaction\n\nSQLiteDatabaseLockedException\u304c\u30b9\u30ed\u30fc\u3055\u308c\u308b. \n\n\nReference\n-------------------------------------------------------------\n[File Locking And Concurrency In SQLite Version 3](http://www.sqlite.org/lockingv3.html)\n\n\u4ee5\u4e0a. \n\n\n\u8ee2\u8a18\u5143: http://yuki312.blogspot.jp/2012/07/androidsqlitetransaction.html\n", "tags": ["Android", "SQLite3"]}