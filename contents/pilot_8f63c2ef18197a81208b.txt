{"context": "\n\n\u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://github.com/gimite/google-drive-ruby \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n# cat /etc/redhat-release\nCentOS release 6.7 (Final)\n# ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n# gem -v\n2.5.1\n# gem install google_drive\n\uff5e\u7565\uff5e\n# gem list | grep google_drive\ngoogle_drive (2.1.1)\n\n\nGoogleDrive\u63a5\u7d9a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n\u4ee5\u4e0b\u306erb\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\nsetup.rb\nrequire \"google_drive\"\n\n# \u521d\u56de\u5b9f\u884c\u6642\u306f\u3001\u8868\u793a\u3055\u308c\u308bURL\u306bGoogle\u30ed\u30b0\u30a4\u30f3\u6e08\u306e\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u6587\u5b57\u5217\u3092\u5165\u529b\u3059\u308b\u5fc5\u8981\u3042\u308a\nGoogleDrive::Session.from_config(\"google_drive_config.json\")\n\n\n\u4e0a\u8a18\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001URL\u304c\u8868\u793a\u3055\u308c\u3001\u5165\u529b\u5f85\u3061\u306b\u306a\u308b\n$ ruby setup.rb\n\n1. Open this page:\nhttps://accounts.google.com/o/oauth2/auth?access_type=offline&client_id=\uff5e\u7565\uff5e\n\n2. Enter the authorization code shown in the page:\n\n\u4e0a\u8a18URL\u306bGoogle\u30ed\u30b0\u30a4\u30f3\u6e08\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n\u8a31\u53ef\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n\u5f53\u8a72\u6587\u5b57\u5217\u3092\u5148\u7a0b\u306e\u300c2. Enter the authorization code shown in the page:\u300d\u306b\u5165\u529b\ngoogle_drive_config.json\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u53d6\u5f97\u30af\u30e9\u30b9\n\ngoogle_drive_wrapper.rb\nrequire \"google_drive\"\n\nclass GoogleDriveWrapper\n  # \u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u53d6\u5f97\n  # (\u30d5\u30a9\u30eb\u30c0/\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8/\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u304c\u306a\u3051\u308c\u3070\u4f5c\u6210)\n  def self.get_worksheet(folder_name, spreadsheet_name, worksheet_name)\n    session = GoogleDrive::Session.from_config(\"google_drive_config.json\")\n\n    folders = session.collections(\"q\" => [\"name = ? and trashed = false\", folder_name])\n    folder = nil\n    if folders.length == 0\n      folder = session.root_collection.create_subcollection(folder_name)\n      puts \"\u30d5\u30a9\u30eb\u30c0 '\" + folder_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n    else\n      folder = folders[0]\n    end\n\n    spreadsheets = folder.files(\"q\" => [\"name = ? and mimeType = 'application/vnd.google-apps.spreadsheet' and trashed = false\", spreadsheet_name])\n    worksheet = nil\n    if spreadsheets.length == 0\n      # \u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3092root\u306b\u4f5c\u6210\u3001\u6307\u5b9a\u30d5\u30a9\u30eb\u30c0\u306b\u8ffd\u52a0\u3001root\u304b\u3089\u524a\u9664\n      spreadsheet = session.create_spreadsheet(spreadsheet_name)\n      folder.add(spreadsheet)\n      session.root_collection.remove(spreadsheet)\n      puts \"\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8 '\" + spreadsheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n      # \u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u3092\u8ffd\u52a0\u3001\u5143\u304b\u3089\u3042\u3063\u305f1\u30b7\u30fc\u30c8\u76ee\u306f\u524a\u9664\n      worksheet = spreadsheet.add_worksheet(worksheet_name)\n      spreadsheet.worksheets[0].delete\n      puts \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c8 '\" + worksheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n    else\n      spreadsheet = spreadsheets[0]\n      worksheet = spreadsheet.worksheet_by_title(worksheet_name)\n      if worksheet.nil?\n        worksheet = spreadsheet.add_worksheet(worksheet_name)\n        puts \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c8 '\" + worksheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n      end\n    end\n    worksheet\n  end\nend\n\n\n\n\u547c\u3073\u51fa\u3057\u5074\n\nxxx.rb\nrequire 'google_drive'\nrequire './google_drive_wrapper'\n\nworksheet = GoogleDriveWrapper.get_worksheet(\"\u30d5\u30a9\u30eb\u30c01\", \"\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c81\", \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c81\")\nworksheet[1, 4] = \"xxx\" # 1\u884c\u76ee4\u5217\u76ee\u306b\u66f8\u304d\u8fbc\u307f\nworksheet.save # \u4fdd\u5b58\n\n\n\nTODO\n\u304a\u624b\u8efd\u3058\u3083\u306a\u3044\u65b9\u6cd5\n\u3000Java\u7de8 http://qiita.com/pilot/items/85bae4e5d5e35ffa7019 \u3092\u3084\u3063\u3066\u307f\u305f\u3089\n\u3000\u672c\u8a18\u4e8b\u306e\u5185\u5bb9\u306f\u3042\u307e\u308a\u826f\u304f\u306a\u3044\u65b9\u6cd5\u3060\u3063\u305f\n\u3000(\u5229\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u5185\u306esecret\u3092\u4f7f\u3063\u3066\u3044\u305f\u308a)\n\u5fc5\u8981\u30e9\u30a4\u30d6\u30e9\u30ea\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n========================\n\nhttps://github.com/gimite/google-drive-ruby \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n# cat /etc/redhat-release\nCentOS release 6.7 (Final)\n# ruby -v\nruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-linux]\n# gem -v\n2.5.1\n# gem install google_drive\n\uff5e\u7565\uff5e\n# gem list | grep google_drive\ngoogle_drive (2.1.1)\n```\n\nGoogleDrive\u63a5\u7d9a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\n=============================\n\n\u4ee5\u4e0b\u306erb\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n```setup.rb\nrequire \"google_drive\"\n\n# \u521d\u56de\u5b9f\u884c\u6642\u306f\u3001\u8868\u793a\u3055\u308c\u308bURL\u306bGoogle\u30ed\u30b0\u30a4\u30f3\u6e08\u306e\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3057\u3001\u8868\u793a\u3055\u308c\u305f\u6587\u5b57\u5217\u3092\u5165\u529b\u3059\u308b\u5fc5\u8981\u3042\u308a\nGoogleDrive::Session.from_config(\"google_drive_config.json\")\n```\n\n\u4e0a\u8a18\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001URL\u304c\u8868\u793a\u3055\u308c\u3001\u5165\u529b\u5f85\u3061\u306b\u306a\u308b\n\n```\n$ ruby setup.rb\n\n1. Open this page:\nhttps://accounts.google.com/o/oauth2/auth?access_type=offline&client_id=\uff5e\u7565\uff5e\n\n2. Enter the authorization code shown in the page:\n```\n\n\u4e0a\u8a18URL\u306bGoogle\u30ed\u30b0\u30a4\u30f3\u6e08\u30d6\u30e9\u30a6\u30b6\u3067\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n![\u30d6\u30e9\u30a6\u30b6\u753b\u9762\u305d\u306e1](https://qiita-image-store.s3.amazonaws.com/0/112363/93c4d4a9-fff6-7a9f-a1b8-523359ed05a4.png)\n\n\n\u8a31\u53ef\u30dc\u30bf\u30f3\u3092\u62bc\u4e0b\u3059\u308b\u3068\u4ee5\u4e0b\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\n\n![\u30d6\u30e9\u30a6\u30b6\u753b\u9762\u305d\u306e2](https://qiita-image-store.s3.amazonaws.com/0/112363/577be7b7-19ed-d735-95c8-646453abe714.png)\n\n\n\u5f53\u8a72\u6587\u5b57\u5217\u3092\u5148\u7a0b\u306e\u300c2. Enter the authorization code shown in the page:\u300d\u306b\u5165\u529b\n\ngoogle_drive_config.json\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\n\n\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u53d6\u5f97\u30af\u30e9\u30b9\n====================\n\n```google_drive_wrapper.rb\nrequire \"google_drive\"\n\nclass GoogleDriveWrapper\n  # \u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u53d6\u5f97\n  # (\u30d5\u30a9\u30eb\u30c0/\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8/\u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u304c\u306a\u3051\u308c\u3070\u4f5c\u6210)\n  def self.get_worksheet(folder_name, spreadsheet_name, worksheet_name)\n    session = GoogleDrive::Session.from_config(\"google_drive_config.json\")\n\n    folders = session.collections(\"q\" => [\"name = ? and trashed = false\", folder_name])\n    folder = nil\n    if folders.length == 0\n      folder = session.root_collection.create_subcollection(folder_name)\n      puts \"\u30d5\u30a9\u30eb\u30c0 '\" + folder_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n    else\n      folder = folders[0]\n    end\n\n    spreadsheets = folder.files(\"q\" => [\"name = ? and mimeType = 'application/vnd.google-apps.spreadsheet' and trashed = false\", spreadsheet_name])\n    worksheet = nil\n    if spreadsheets.length == 0\n      # \u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3092root\u306b\u4f5c\u6210\u3001\u6307\u5b9a\u30d5\u30a9\u30eb\u30c0\u306b\u8ffd\u52a0\u3001root\u304b\u3089\u524a\u9664\n      spreadsheet = session.create_spreadsheet(spreadsheet_name)\n      folder.add(spreadsheet)\n      session.root_collection.remove(spreadsheet)\n      puts \"\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8 '\" + spreadsheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n      # \u30ef\u30fc\u30af\u30b7\u30fc\u30c8\u3092\u8ffd\u52a0\u3001\u5143\u304b\u3089\u3042\u3063\u305f1\u30b7\u30fc\u30c8\u76ee\u306f\u524a\u9664\n      worksheet = spreadsheet.add_worksheet(worksheet_name)\n      spreadsheet.worksheets[0].delete\n      puts \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c8 '\" + worksheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n    else\n      spreadsheet = spreadsheets[0]\n      worksheet = spreadsheet.worksheet_by_title(worksheet_name)\n      if worksheet.nil?\n        worksheet = spreadsheet.add_worksheet(worksheet_name)\n        puts \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c8 '\" + worksheet_name + \"' \u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\"\n      end\n    end\n    worksheet\n  end\nend\n```\n\n\u547c\u3073\u51fa\u3057\u5074\n=========\n\n```xxx.rb\nrequire 'google_drive'\nrequire './google_drive_wrapper'\n\nworksheet = GoogleDriveWrapper.get_worksheet(\"\u30d5\u30a9\u30eb\u30c01\", \"\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c81\", \"\u30ef\u30fc\u30af\u30b7\u30fc\u30c81\")\nworksheet[1, 4] = \"xxx\" # 1\u884c\u76ee4\u5217\u76ee\u306b\u66f8\u304d\u8fbc\u307f\nworksheet.save # \u4fdd\u5b58\n```\n\nTODO\n====\n\n\u304a\u624b\u8efd\u3058\u3083\u306a\u3044\u65b9\u6cd5\n\u3000Java\u7de8 http://qiita.com/pilot/items/85bae4e5d5e35ffa7019 \u3092\u3084\u3063\u3066\u307f\u305f\u3089\n\u3000\u672c\u8a18\u4e8b\u306e\u5185\u5bb9\u306f\u3042\u307e\u308a\u826f\u304f\u306a\u3044\u65b9\u6cd5\u3060\u3063\u305f\n\u3000(\u5229\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u5185\u306esecret\u3092\u4f7f\u3063\u3066\u3044\u305f\u308a)\n", "tags": ["Ruby", "GoogleSpreadSheet"]}