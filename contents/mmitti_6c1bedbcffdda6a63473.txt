{"tags": ["kubernetes", "Ubuntu"], "context": "\n\n\u6982\u8981\nKubernetes\u3092Ubuntu\u3067\u69cb\u7bc9\u3057\u305f\u3044\u4eba\u5411\u3051\u306e\u8a18\u4e8b\u3067\u3059\u3002\nmaster\u3068node1\u53f0\u305a\u3064\u69cb\u7bc9\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u306e\u8aac\u660e\u3092\u542b\u3093\u3067\u3044\u307e\u3059\u3002\n\n\u52d5\u4f5c\u74b0\u5883\n\u3053\u3053\u3067\u306fmaster\u3068\u30ce\u30fc\u30c9\u306e2\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306eIP\u30a2\u30c9\u30ec\u30b9\u30fb\u30db\u30b9\u30c8\u540d\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\nmaster \u30b5\u30fc\u30d0\u30fc\n\u30db\u30b9\u30c8\u540d master\nIP\u30a2\u30c9\u30ec\u30b9 192.168.137.20\nnode\u3000\u30b5\u30fc\u30d0\u30fc\n\u30db\u30b9\u30c8\u540d node1\nIP\u30a2\u30c9\u30ec\u30b9 192.168.137.21\n\n\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\n\nOS:Ubuntu 14.04.5 LTS Basic Ubuntu Server\u306e\u307f\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nKubernetes:1.3.6\netcd:3.0.7\nflannel:0.6.1\n\n\nmaster\u5074\u306e\u69cb\u7bc9\nmaster\u5074\u3067\u306fkubernetes\u306eapiserver\u3084etcd\u306a\u3069\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\n\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get update\nsudo apt-get install build-essential linux-libc-dev bridge-utils git curl ssh unzip golang -y\n\n\n\u30d0\u30a4\u30ca\u30ea\u306e\u4fdd\u5b58\u5148\u4f5c\u6210\nsudo mkdir /opt/bin\n\n\n\u30db\u30b9\u30c8\u540d\u306e\u767b\u9332\nsudo sh -c \"echo '192.168.137.20 master' >> /etc/hosts\"\nsudo sh -c \"echo '192.168.137.21  node1' >> /etc/hosts\"\n\n\netcd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nwget https://github.com/coreos/etcd/releases/download/v3.0.7/etcd-v3.0.7-linux-amd64.tar.gz\ntar xzvf etcd-v3.0.7-linux-amd64.tar.gz\n\nsudo mv etcd-v3.0.7-linux-amd64/etcd /opt/bin/\nsudo mv etcd-v3.0.7-linux-amd64/etcdctl /opt/bin/\n\nsudo ln -s /opt/bin/etcd /usr/local/bin/etcd\nsudo ln -s /opt/bin/etcdctl /usr/local/bin/etcdctl\n\nsudo chmod 755 /opt/bin/etcd\nsudo chmod 755 /opt/bin/etcdctl\n\n/etc/init/etcd.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n29c29\n<       ETCD_OPTS=\"\"\n---\n>       ETCD_OPTS=\"--listen-client-urls http://0.0.0.0:2379 --advertise-client-urls http://localhost:2379\"\n\n\nflanneld\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nwget https://github.com/coreos/flannel/releases/download/v0.6.1/flanneld-amd64\nsudo mkdir /opt/flanneld\nsudo mv flanneld-amd64 /opt/bin/flanneld\nsudo ln -s /opt/bin/flanneld /usr/local/bin/flanneld\nsudo chmod 755 /opt/bin/flanneld\n\nflannel\u3067\u5229\u7528\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u306e\u7bc4\u56f2\u3092\u8a2d\u5b9a\nsudo initctl start etcd\netcdctl mk /coreos.com/network/config '{\"Network\":\"172.17.0.0/16\"}'\n\n\nkubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\n\n#\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u306fserver\u30d5\u30a9\u30eb\u30c0\u30fc\u4ee5\u4e0b\u306btar\u3067\u56fa\u3081\u3089\u308c\u3066\u3044\u307e\u3059\ncd kubernetes/server\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u5c55\u958b\uff08\u5404\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n\nsudo cp kubernetes/server/bin/kube-apiserver /opt/bin/\nsudo cp kubernetes/server/bin/kube-controller-manager /opt/bin/\nsudo cp kubernetes/server/bin/kube-scheduler /opt/bin/\nsudo cp kubernetes/server/bin/kube-proxy /opt/bin/\nsudo cp kubernetes/server/bin/kubectl /opt/bin/\n\ncd ~\n\nsudo ln -s /opt/bin/kube-apiserver /usr/local/bin/\nsudo ln -s /opt/bin/kube-controller-manager /usr/local/bin/\nsudo ln -s /opt/bin/kube-scheduler  /usr/local/bin/\nsudo ln -s /opt/bin/kubectl /usr/local/bin/\nsudo ln -s /opt/bin/kube-proxy /usr/local/bin/\n\nsudo cp kubernetes/cluster/ubuntu/master/init_conf/* /etc/init/\nsudo cp kubernetes/cluster/ubuntu/master-flannel/init_conf/flanneld.conf /etc/init/\n\n/etc/init/kube-scheduler.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n25c25\n<       KUBE_SCHEDULER_OPTS=\"\"\n---\n>       KUBE_SCHEDULER_OPTS=\"--master http://master:8080\"\n\n/etc/init/kube-controller-manager.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n25c25\n<       KUBE_CONTROLLER_MANAGER_OPTS=\"\"\n---\n>       KUBE_CONTROLLER_MANAGER_OPTS=\"--address 0.0.0.0  --master http://master:8080\"\n\n/etc/init/kube-apiserver.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n25c25\n<       KUBE_APISERVER_OPTS=\"\"\n---\n>       KUBE_APISERVER_OPTS=\"--address 0.0.0.0 --port 8080 --etcd_servers http://master:2379  --allow_privileged false --service-cluster-ip-range 10.254.0.0/16 --kubelet_port 10250\"\n\n\n/etc/init/flanneld.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n24c24\n<       FLANNEL_OPTS=\"\"\n---\n>       FLANNEL_OPTS=\"-etcd-endpoints=http://master:2379 -etcd-prefix=/coreos.com/network\"\n\n\nnode\u5074\u306e\u69cb\u7bc9\nnode\u5074\u3067\u306fkubernetes\u306ekubelet\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\n\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo apt-get update\nsudo apt-get install build-essential linux-libc-dev bridge-utils git curl ssh unzip golang -y\n\n\n\u30d0\u30a4\u30ca\u30ea\u306e\u4fdd\u5b58\u5148\u4f5c\u6210\nsudo mkdir /opt/bin\n\n\n\u30db\u30b9\u30c8\u540d\u306e\u767b\u9332\nsudo sh -c \"echo '192.168.137.20 master' >> /etc/hosts\"\nsudo sh -c \"echo '192.168.137.21  node1' >> /etc/hosts\"\n\n\nflanneld\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nwget https://github.com/coreos/flannel/releases/download/v0.6.1/flanneld-amd64\nsudo mkdir /opt/flanneld\nsudo mv flanneld-amd64 /opt/bin/flanneld\nsudo ln -s /opt/bin/flanneld /usr/local/bin/flanneld\nsudo chmod 755 /opt/bin/flanneld\n\n\nKubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\n\n#\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u306fserver\u30d5\u30a9\u30eb\u30c0\u30fc\u306btar\u3067\u56fa\u3081\u3089\u308c\u3066\u3044\u307e\u3059\ncd kubernetes/server\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u5c55\u958b\uff08\u5404\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30d4\u30fc\n#\u30ce\u30fc\u30c9\u306b\u306fkubelet\u3068kube-proxy\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\nsudo cp kubernetes/server/bin/kubelet /opt/bin/\nsudo cp kubernetes/server/bin/kube-proxy /opt/bin/\n\ncd ~\n\nsudo ln -s /opt/bin/kubelet  /usr/local/bin/\nsudo ln -s /opt/bin/kube-proxy /usr/local/bin/\n\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30d4\u30fc\nsudo cp kubernetes/cluster/ubuntu/minion-flannel/init_conf/flanneld.conf /etc/init/\nsudo cp kubernetes/cluster/ubuntu/minion/init_conf/* /etc/init/\n\n/etc/init/kube-proxy.conf(\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059)\n27c27\n<       KUBE_PROXY_OPTS=\"\"\n---\n>       KUBE_PROXY_OPTS=\"--master http://master:8080\"\n\n/etc/init/kubelet.conf(\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059)\n25c25\n<       KUBELET_OPTS=\"\"\n---\n>       KUBELET_OPTS=\"--address=0.0.0.0 --port=10250 --hostname-override node1 --api-servers http://master:8080\"\n\n/etc/init/flanneld.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n24c24\n<       FLANNEL_OPTS=\"\"\n---\n>       FLANNEL_OPTS=\"-etcd-endpoints=http://master:2379 -etcd-prefix=/coreos.com/network\"\n\n\nDocker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nwget -qO- https://get.docker.com/ | sh\n\nflanneld\u3067\u5272\u308a\u5f53\u3066\u3089\u308c\u305fIP\u30a2\u30c9\u30ec\u30b9\u3092\u9069\u7528\u3059\u308b\u305f\u3081\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u53c2\u8003\uff1ahttp://blog.shippable.com/docker-overlay-network-using-flannel\n/etc/init/docker.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n3,4c3,4\n< start on (filesystem and net-device-up IFACE!=lo)\n< stop on runlevel [!2345]\n---\n> start on started flanneld\n> stop on stopping flanneld\n41a42,51\n>       if [ -f /var/run/flannel/subnet.env ]; then\n>               ## if flannel subnet env is present, then use it to define\n>               ## the subnet and MTU values\n>                 . /var/run/flannel/subnet.env\n>                 DOCKER_OPTS=\"$DOCKER_OPTS --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU}\"\n>         else\n>                 echo \"Flannel subnet not found, exiting...\"\n>                 exit 1\n>         fi\n> \n\nnsenter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nsudo docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter\n\n\nDashBoard\u306e\u5c0e\u5165\n\u52d5\u4f5c\u30c6\u30b9\u30c8\u306e\u305f\u3081\u5c0e\u5165\u3057\u307e\u3059\u3002\nwget https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n#api\u30b5\u30fc\u30d0\u30fc\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a(docker\u5185\u3067\u5229\u7528\u3055\u308c\u308b\u306e\u3067IP\u30a2\u30c9\u30ec\u30b9\u76f4\u6253\u3061\u3067\u3059\u3002)\nsed -ie 's/# - --apiserver-host=http:\\/\\/my-address:port/- --apiserver-host=http:\\/\\/192.168.137.20:8080/' kubernetes-dashboard.yaml\nkubectl create -f kubernetes-dashboard.yaml\n\nkubectl get no\u3067\u30ce\u30fc\u30c9\u304cReady\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3001kubectl --namespace=kube-system get po\u3067pod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nhttp://192.168.137.20:8080/ui \u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\nguestbook\u3092\u7acb\u3061\u4e0a\u3052\u308b\n\u4ee5\u4e0b\u306e\u624b\u9806\u3067guestbook\u3092\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u3002\nmaster\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u53e9\u3044\u3066\u304f\u3060\u3055\u3044\u3002\nwget https://raw.githubusercontent.com/kubernetes/kubernetes/master/examples/guestbook/all-in-one/guestbook-all-in-one.yaml\n\nguestbook-all-in-one.yaml\u3092\u958b\u304dGET_HOSTS_FROM\u306evalue\u3092env\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002(DNS\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3002)\n\u6700\u5f8c\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\nkubectl create -f guestbook-all-in-one.yaml\n\nhttp://192.168.137.20:8080/api/v1/proxy/namespaces/default/services/frontend:80/ \u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n\u53c2\u8003\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5f15\u6570\u5468\u308a\u306f\u516c\u5f0fFedora\u5411\u3051\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://kubernetes.io/docs/getting-started-guides/fedora/fedora_manual_config/\n\n#\u6982\u8981\nKubernetes\u3092Ubuntu\u3067\u69cb\u7bc9\u3057\u305f\u3044\u4eba\u5411\u3051\u306e\u8a18\u4e8b\u3067\u3059\u3002\nmaster\u3068node1\u53f0\u305a\u3064\u69cb\u7bc9\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u306e\u8aac\u660e\u3092\u542b\u3093\u3067\u3044\u307e\u3059\u3002\n\n#\u52d5\u4f5c\u74b0\u5883\n\n\u3053\u3053\u3067\u306fmaster\u3068\u30ce\u30fc\u30c9\u306e2\u30b5\u30fc\u30d0\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\u4ee5\u4e0b\u306eIP\u30a2\u30c9\u30ec\u30b9\u30fb\u30db\u30b9\u30c8\u540d\u3067\u69cb\u7bc9\u3057\u307e\u3057\u305f\u3002\n\n- master \u30b5\u30fc\u30d0\u30fc  \n    \u30db\u30b9\u30c8\u540d master  \n    IP\u30a2\u30c9\u30ec\u30b9 192.168.137.20\n- node\u3000\u30b5\u30fc\u30d0\u30fc   \n    \u30db\u30b9\u30c8\u540d node1  \n    IP\u30a2\u30c9\u30ec\u30b9 192.168.137.21\n\n![\u56f3\u97621.png](https://qiita-image-store.s3.amazonaws.com/0/140084/bcf483c0-35c4-6625-64f3-7e60d8a2567c.png)\n\n###\u30d0\u30fc\u30b8\u30e7\u30f3\n - OS:Ubuntu 14.04.5 LTS Basic Ubuntu Server\u306e\u307f\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n - Kubernetes:1.3.6\n - etcd:3.0.7\n - flannel:0.6.1\n\n#master\u5074\u306e\u69cb\u7bc9\nmaster\u5074\u3067\u306fkubernetes\u306eapiserver\u3084etcd\u306a\u3069\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\n###\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```\nsudo apt-get update\nsudo apt-get install build-essential linux-libc-dev bridge-utils git curl ssh unzip golang -y\n```\n###\u30d0\u30a4\u30ca\u30ea\u306e\u4fdd\u5b58\u5148\u4f5c\u6210\n```\nsudo mkdir /opt/bin\n```\n###\u30db\u30b9\u30c8\u540d\u306e\u767b\u9332\n```\nsudo sh -c \"echo '192.168.137.20 master' >> /etc/hosts\"\nsudo sh -c \"echo '192.168.137.21  node1' >> /etc/hosts\"\n```\n###etcd\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n```\nwget https://github.com/coreos/etcd/releases/download/v3.0.7/etcd-v3.0.7-linux-amd64.tar.gz\ntar xzvf etcd-v3.0.7-linux-amd64.tar.gz\n\nsudo mv etcd-v3.0.7-linux-amd64/etcd /opt/bin/\nsudo mv etcd-v3.0.7-linux-amd64/etcdctl /opt/bin/\n\nsudo ln -s /opt/bin/etcd /usr/local/bin/etcd\nsudo ln -s /opt/bin/etcdctl /usr/local/bin/etcdctl\n\nsudo chmod 755 /opt/bin/etcd\nsudo chmod 755 /opt/bin/etcdctl\n```\n\n/etc/init/etcd.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n29c29\n<       ETCD_OPTS=\"\"\n---\n>       ETCD_OPTS=\"--listen-client-urls http://0.0.0.0:2379 --advertise-client-urls http://localhost:2379\"\n```\n\n###flanneld\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n```\nwget https://github.com/coreos/flannel/releases/download/v0.6.1/flanneld-amd64\nsudo mkdir /opt/flanneld\nsudo mv flanneld-amd64 /opt/bin/flanneld\nsudo ln -s /opt/bin/flanneld /usr/local/bin/flanneld\nsudo chmod 755 /opt/bin/flanneld\n```\n\nflannel\u3067\u5229\u7528\u3059\u308b\u30a2\u30c9\u30ec\u30b9\u306e\u7bc4\u56f2\u3092\u8a2d\u5b9a\n\n```\nsudo initctl start etcd\netcdctl mk /coreos.com/network/config '{\"Network\":\"172.17.0.0/16\"}'\n```\n\n\n### kubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n```\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\n\n#\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u306fserver\u30d5\u30a9\u30eb\u30c0\u30fc\u4ee5\u4e0b\u306btar\u3067\u56fa\u3081\u3089\u308c\u3066\u3044\u307e\u3059\ncd kubernetes/server\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u5c55\u958b\uff08\u5404\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n\nsudo cp kubernetes/server/bin/kube-apiserver /opt/bin/\nsudo cp kubernetes/server/bin/kube-controller-manager /opt/bin/\nsudo cp kubernetes/server/bin/kube-scheduler /opt/bin/\nsudo cp kubernetes/server/bin/kube-proxy /opt/bin/\nsudo cp kubernetes/server/bin/kubectl /opt/bin/\n\ncd ~\n\nsudo ln -s /opt/bin/kube-apiserver /usr/local/bin/\nsudo ln -s /opt/bin/kube-controller-manager /usr/local/bin/\nsudo ln -s /opt/bin/kube-scheduler  /usr/local/bin/\nsudo ln -s /opt/bin/kubectl /usr/local/bin/\nsudo ln -s /opt/bin/kube-proxy /usr/local/bin/\n\nsudo cp kubernetes/cluster/ubuntu/master/init_conf/* /etc/init/\nsudo cp kubernetes/cluster/ubuntu/master-flannel/init_conf/flanneld.conf /etc/init/\n```\n\n/etc/init/kube-scheduler.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n25c25\n<       KUBE_SCHEDULER_OPTS=\"\"\n---\n>       KUBE_SCHEDULER_OPTS=\"--master http://master:8080\"\n```\n\n/etc/init/kube-controller-manager.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n25c25\n<       KUBE_CONTROLLER_MANAGER_OPTS=\"\"\n---\n>       KUBE_CONTROLLER_MANAGER_OPTS=\"--address 0.0.0.0  --master http://master:8080\"\n```\n\n/etc/init/kube-apiserver.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n25c25\n<       KUBE_APISERVER_OPTS=\"\"\n---\n>       KUBE_APISERVER_OPTS=\"--address 0.0.0.0 --port 8080 --etcd_servers http://master:2379  --allow_privileged false --service-cluster-ip-range 10.254.0.0/16 --kubelet_port 10250\"\n\n```\n\n/etc/init/flanneld.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n24c24\n<       FLANNEL_OPTS=\"\"\n---\n>       FLANNEL_OPTS=\"-etcd-endpoints=http://master:2379 -etcd-prefix=/coreos.com/network\"\n```\n\n#node\u5074\u306e\u69cb\u7bc9\nnode\u5074\u3067\u306fkubernetes\u306ekubelet\u3092\u52d5\u4f5c\u3055\u305b\u307e\u3059\u3002\n\n###\u95a2\u9023\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nsudo apt-get update\nsudo apt-get install build-essential linux-libc-dev bridge-utils git curl ssh unzip golang -y\n```\n###\u30d0\u30a4\u30ca\u30ea\u306e\u4fdd\u5b58\u5148\u4f5c\u6210\n```\nsudo mkdir /opt/bin\n```\n\n###\u30db\u30b9\u30c8\u540d\u306e\u767b\u9332\n```\nsudo sh -c \"echo '192.168.137.20 master' >> /etc/hosts\"\nsudo sh -c \"echo '192.168.137.21  node1' >> /etc/hosts\"\n```\n###flanneld\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\n```\nwget https://github.com/coreos/flannel/releases/download/v0.6.1/flanneld-amd64\nsudo mkdir /opt/flanneld\nsudo mv flanneld-amd64 /opt/bin/flanneld\nsudo ln -s /opt/bin/flanneld /usr/local/bin/flanneld\nsudo chmod 755 /opt/bin/flanneld\n```\n\n\n###Kubernetes\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n```\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\n\n#\u30d3\u30eb\u30c9\u6e08\u307f\u306e\u30d0\u30a4\u30ca\u30ea\u306fserver\u30d5\u30a9\u30eb\u30c0\u30fc\u306btar\u3067\u56fa\u3081\u3089\u308c\u3066\u3044\u307e\u3059\ncd kubernetes/server\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u5c55\u958b\uff08\u5404\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u3042\u3063\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u5c55\u958b\u3057\u3066\u304f\u3060\u3055\u3044\u3002)\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n\n#kubernetes\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30d4\u30fc\n#\u30ce\u30fc\u30c9\u306b\u306fkubelet\u3068kube-proxy\u3092\u5165\u308c\u3066\u304f\u3060\u3055\u3044\nsudo cp kubernetes/server/bin/kubelet /opt/bin/\nsudo cp kubernetes/server/bin/kube-proxy /opt/bin/\n\ncd ~\n\nsudo ln -s /opt/bin/kubelet  /usr/local/bin/\nsudo ln -s /opt/bin/kube-proxy /usr/local/bin/\n\n#\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u30b3\u30d4\u30fc\nsudo cp kubernetes/cluster/ubuntu/minion-flannel/init_conf/flanneld.conf /etc/init/\nsudo cp kubernetes/cluster/ubuntu/minion/init_conf/* /etc/init/\n```\n\n/etc/init/kube-proxy.conf(\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059)\n\n```\n27c27\n<       KUBE_PROXY_OPTS=\"\"\n---\n>       KUBE_PROXY_OPTS=\"--master http://master:8080\"\n```\n\n/etc/init/kubelet.conf(\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059)\n\n```\n25c25\n<       KUBELET_OPTS=\"\"\n---\n>       KUBELET_OPTS=\"--address=0.0.0.0 --port=10250 --hostname-override node1 --api-servers http://master:8080\"\n```\n\n/etc/init/flanneld.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n24c24\n<       FLANNEL_OPTS=\"\"\n---\n>       FLANNEL_OPTS=\"-etcd-endpoints=http://master:2379 -etcd-prefix=/coreos.com/network\"\n```\n\n###Docker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3068\u8a2d\u5b9a\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nwget -qO- https://get.docker.com/ | sh\n```\n\nflanneld\u3067\u5272\u308a\u5f53\u3066\u3089\u308c\u305fIP\u30a2\u30c9\u30ec\u30b9\u3092\u9069\u7528\u3059\u308b\u305f\u3081\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\u53c2\u8003\uff1ahttp://blog.shippable.com/docker-overlay-network-using-flannel\n\n/etc/init/docker.conf\uff08\u5dee\u5206\u306e\u307f\u3092\u793a\u3057\u307e\u3059\u3002\uff09\n\n```\n3,4c3,4\n< start on (filesystem and net-device-up IFACE!=lo)\n< stop on runlevel [!2345]\n---\n> start on started flanneld\n> stop on stopping flanneld\n41a42,51\n>       if [ -f /var/run/flannel/subnet.env ]; then\n>               ## if flannel subnet env is present, then use it to define\n>               ## the subnet and MTU values\n>                 . /var/run/flannel/subnet.env\n>                 DOCKER_OPTS=\"$DOCKER_OPTS --bip=${FLANNEL_SUBNET} --mtu=${FLANNEL_MTU}\"\n>         else\n>                 echo \"Flannel subnet not found, exiting...\"\n>                 exit 1\n>         fi\n> \n```\n\nnsenter\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\nsudo docker run --rm -v /usr/local/bin:/target jpetazzo/nsenter\n```\n\n##DashBoard\u306e\u5c0e\u5165\n\u52d5\u4f5c\u30c6\u30b9\u30c8\u306e\u305f\u3081\u5c0e\u5165\u3057\u307e\u3059\u3002\n\n```\nwget https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n#api\u30b5\u30fc\u30d0\u30fc\u306e\u30a2\u30c9\u30ec\u30b9\u3068\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u6307\u5b9a(docker\u5185\u3067\u5229\u7528\u3055\u308c\u308b\u306e\u3067IP\u30a2\u30c9\u30ec\u30b9\u76f4\u6253\u3061\u3067\u3059\u3002)\nsed -ie 's/# - --apiserver-host=http:\\/\\/my-address:port/- --apiserver-host=http:\\/\\/192.168.137.20:8080/' kubernetes-dashboard.yaml\nkubectl create -f kubernetes-dashboard.yaml\n```\n\nkubectl get no\u3067\u30ce\u30fc\u30c9\u304cReady\u306b\u306a\u3063\u3066\u3044\u308b\u304b\u3001kubectl --namespace=kube-system get po\u3067pod\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u304b\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nhttp://192.168.137.20:8080/ui \u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n##guestbook\u3092\u7acb\u3061\u4e0a\u3052\u308b\n\n\u4ee5\u4e0b\u306e\u624b\u9806\u3067guestbook\u3092\u30c7\u30d7\u30ed\u30a4\u3067\u304d\u307e\u3059\u3002\nmaster\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u53e9\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nwget https://raw.githubusercontent.com/kubernetes/kubernetes/master/examples/guestbook/all-in-one/guestbook-all-in-one.yaml\n```\nguestbook-all-in-one.yaml\u3092\u958b\u304dGET_HOSTS_FROM\u306evalue\u3092env\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002(DNS\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u3002)\n\n\u6700\u5f8c\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n```\nkubectl create -f guestbook-all-in-one.yaml\n```\n\nhttp://192.168.137.20:8080/api/v1/proxy/namespaces/default/services/frontend:80/ \u3067\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\u3002\n\n#\u53c2\u8003\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u5f15\u6570\u5468\u308a\u306f\u516c\u5f0fFedora\u5411\u3051\u306e\u30da\u30fc\u30b8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\nhttp://kubernetes.io/docs/getting-started-guides/fedora/fedora_manual_config/\n"}