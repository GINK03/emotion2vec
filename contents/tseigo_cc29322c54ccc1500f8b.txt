{"context": " More than 1 year has passed since last update.\u305f\u307e\u306b\u3001\u500b\u4eba\u306e\u30a4\u30d9\u30f3\u30c8\u3054\u3068\u306e\u30c1\u30e3\u30c3\u30c8\u30c4\u30fc\u30eb\u3067\u30a4\u30d9\u30f3\u30c8\u307e\u3067\u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3092\u3084\u308a\u305f\u304f\u306a\u308b\u306e\u3067\u30e1\u30e2\u3067\u3059\u3002\n\nHeroku\u8a2d\u5b9a\n\u3044\u3064\u3082\u306e\u3067\u7acb\u3066\u307e\u3059\u3002\nGetting Started with Node.js on Heroku | Heroku Dev Center\n\n\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u8a2d\u5b9a\u3092\u5916\u90e8\u5316\nheroku config:add CHATWORK_ACCESS_TOKEN=CHATWORK_ACCESS_TOKEN\n\n\u5024\u3092\u8a2d\u5b9a\u5f8c\u306bWEB\u306eUI\u306e\u307b\u3046\u304b\u3089\u76f4\u3057\u307e\u3059\u3002\n\n\n\u4ed6\u306e\u8a2d\u5b9a\u3082\u5916\u90e8\u5316\nheroku config:add TARGET_DATE=TARGET_DATE\nheroku config:add ROOM_ID=ROOM_ID\nheroku config:add EVENT_TITLE=EVENT_TITLE\n\nROOM_ID\u306f\u767a\u8a00\u3055\u305b\u305f\u3044\u30eb\u30fc\u30e0ID\u3002URL\u78ba\u8a8d\u3059\u308b\u3068\u308f\u304b\u308a\u307e\u3059\u3002\n\u30eb\u30fc\u30e0ID 123456 \u3078 2015/10/10 \u306b \u4f53\u80b2\u306e\u65e5 \u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3092\u3057\u305f\u3044\u5834\u5408\u3002\nheroku config:add TARGET_DATE=2015/10/10\nheroku config:add ROOM_ID=123456\nheroku config:add EVENT_TITLE=\u4f53\u80b2\u306e\u65e5\n\n\n\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fcaddons\u3092\u8a2d\u5b9a\nheroku addons:create scheduler:standard\n\n1\u65e5\u3054\u3068\u306b\u558b\u3089\u305b\u308b\n\nUTC\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u65e5\u672c\u6642\u9593\u3067\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306f-9:00\u3057\u305f\u6642\u9593\u3067\u884c\u3046\u3002\n\u65e5\u672c\u6642\u9593AM10:00\u306b\u884c\u3044\u305f\u3044\u3068\u304d\u306f 1:00 UTC\u3002\n\n\n\u5b9f\u969b\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nvar express = require('express');\nvar app = express();\n\napp.set('port', (process.env.PORT || 5000));\napp.use(express.static(__dirname + '/public'));\n\n// JSON\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\uff08\u30ed\u30fc\u30ab\u30eb\u7528\uff09\nvar fs = require('fs');\nvar setting = {};\nif( process.env.PORT ) {\n    //\n} else {\n    // .env\u30d5\u30a9\u30eb\u30c0\u306f\u3042\u3089\u304b\u3058\u3081 .gitignore \u5bfe\u8c61\u306b\u3057\u3066\u304a\u304f\u3002\n    setting = JSON.parse(fs.readFileSync('.env/setting.json', 'utf8'));\n}\n\n// \u8a2d\u5b9a\u8aad\u307f\u8fbc\u307f\nvar ROOM_ID = (process.env.ROOM_ID || setting.ROOM_ID);  // \u5bfe\u8c61\u30eb\u30fc\u30e0\nvar CHATWORK_ACCESS_TOKEN = (process.env.CHATWORK_ACCESS_TOKEN || setting.CHATWORK_ACCESS_TOKEN);  // \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\nvar TARGET_DATE = (process.env.TARGET_DATE || setting.TARGET_DATE);  // \u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u65e5\u4ed8\nvar EVENT_TITLE = (process.env.EVENT_TITLE || setting.EVENT_TITLE);  // \u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30c8\u30eb\nconsole.log(\"CHATWORK_ACCESS_TOKEN : \" + CHATWORK_ACCESS_TOKEN);\nconsole.log(\"ROOM_ID : \" + ROOM_ID);\nconsole.log(\"TARGET_DATE : \" + TARGET_DATE);\nconsole.log(\"EVENT_TITLE : \" + EVENT_TITLE);\n\n// \u6642\u9593\nvar unity_base_time = new Date(TARGET_DATE);\nconsole.log(unity_base_time);\n\n// \u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u6642\u5dee\u3092\u78ba\u8a8d\nvar GMT9 = 9 * 60 * 60 * 1000; //  GMT+0900\nvar timezoneOffset = new Date().getTimezoneOffset();\nconsole.log(\"timezoneOffset : \" + timezoneOffset + \"min\");\n// \u305d\u308c\u306b\u57fa\u3065\u3044\u3066\u6642\u5dee\u3092\u4fee\u6b63\u3059\u308b\u30df\u30ea\u79d2\u3092\u751f\u6210(timezoneOffset_msec)\nvar timezoneOffset_msec = timezoneOffset * 60 * 1000 + GMT9;\nconsole.log(\"timezoneOffset_msec : \" + timezoneOffset_msec + \"msec\");\n\n// \u6642\u9593\u6bd4\u8f03\nfunction getUnitySpanDate(){\n    // \u73fe\u5728\u306e\u6642\u9593\n    var d = new Date();\n    // 0:00\u540c\u58eb\u3067\u6bd4\u8f03\u3057\u306a\u3044\u3068\u3061\u3083\u3093\u3068\u3057\u305f\u5024\u304c\u51fa\u306a\u3044\u306e\u3067\u88dc\u6b63\n    var current_date = new Date(d.getFullYear() + \"/\" + (d.getMonth()+1) + \"/\" + d.getDate() );\n    // \u6642\u9593\u88dc\u6b63\n    unity_base_time.setTime( unity_base_time.getTime() + timezoneOffset_msec );\n    current_date.setTime( current_date.getTime() + timezoneOffset_msec );\n    // \u671f\u9593(timezoneOffset_msec\u3092\u4f7f\u3046)\n    var span_timestamp = unity_base_time.getTime() - current_date.getTime();\n    // 1\u65e5(per_day)\u3067\u5272\u308b\n    var per_day = 84600 * 1000;\n    var ret = Math.floor(span_timestamp / per_day);  // \u5207\u308a\u6368\u3066\n\n    return ret;\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\nfunction postMessage(bodyStr){\n    var request = require('request');\n    var options = {\n        headers: {\n            'X-ChatWorkToken': CHATWORK_ACCESS_TOKEN\n        },\n        json: true\n    };\n\n    options.url = 'https://api.chatwork.com/v1/rooms/' + ROOM_ID + '/messages';\n    options.form = { body: bodyStr };\n    request.post(options, function (error, response, body) {\n        if (!error && response.statusCode == 200) {\n            console.log(body);\n        }else{\n            console.log('error: '+ response.statusCode);\n        }\n    });\n}\n\napp.get('/', function(request, response) {\n    response.send('Hello World!');\n});\n\napp.get('/check', function(request, response) {\n\n    response.send('check!');\n    console.log('check!');\n    console.log(new Date().toString());\n\n    var span_date = getUnitySpanDate();\n\n    if( span_date == 0 ) {\n        // \u5f53\u65e5\u51e6\u7406\n        var bodyStr = '';\n        bodyStr += '[info][title]bot\uff1a\u304a\u77e5\u3089\u305b[/title]\u307f\u306a\u3055\u3093\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\uff01' + \"\\n\";\n        bodyStr += EVENT_TITLE + ' \u306f(*)\u672c(*)\u65e5(*)\u958b(*)\u50ac(*)\u3067\u3059\u3002[/info]';\n\n        postMessage(bodyStr);\n    } else if( span_date > 0 ){\n        // \u5f53\u65e5\u307e\u3067\u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u51e6\u7406\n        var bodyStr = '';\n        bodyStr += '[info][title]bot\uff1a\u304a\u77e5\u3089\u305b[/title]\u307f\u306a\u3055\u3093\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\uff01' + \"\\n\";\n        bodyStr += EVENT_TITLE + ' \u306f ' + TARGET_DATE + ' \u958b\u50ac\u3067\u3059\u3002';\n        bodyStr += '[info](F)\u3042\u3068 ' + span_date + ' \u65e5\uff01(F)[/info][/info]' + \"\\n\";\n\n        postMessage(bodyStr);\n    } else {\n        // \u65e2\u306b\u904e\u304e\u3066\u3044\u308b\u5834\u5408\u306f\u4f55\u3082\u3057\u306a\u3044\n    }\n\n});\n\napp.listen(app.get('port'), function() {\n    console.log('Node app is running on port', app.get('port'));\n});\n\n\n\u53c2\u8003\u8a18\u4e8b\n\n\u901f\u5831! ChatworkAPI\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u53cd\u5fdc\u3059\u308bBOT\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002 - Qiita\nChatworkAPI\u3067message\u3092POST\u3057\u3066\u307f\u308b\u3002 - Qiita\nChatworkAPI\u306bexpress\u304b\u3089request\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u63a5\u7d9a - Qiita\n\n\u305f\u307e\u306b\u3001\u500b\u4eba\u306e\u30a4\u30d9\u30f3\u30c8\u3054\u3068\u306e\u30c1\u30e3\u30c3\u30c8\u30c4\u30fc\u30eb\u3067\u30a4\u30d9\u30f3\u30c8\u307e\u3067\u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3092\u3084\u308a\u305f\u304f\u306a\u308b\u306e\u3067\u30e1\u30e2\u3067\u3059\u3002\n\n# Heroku\u8a2d\u5b9a\n\n\u3044\u3064\u3082\u306e\u3067\u7acb\u3066\u307e\u3059\u3002\n\n<a href=\"https://devcenter.heroku.com/articles/getting-started-with-nodejs#deploy-the-app\" title=\"Getting Started with Node.js on Heroku | Heroku Dev Center\" target=\"_blank\">Getting Started with Node.js on Heroku | Heroku Dev Center</a>\n\n# \u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u8a2d\u5b9a\u3092\u5916\u90e8\u5316\n\n```\nheroku config:add CHATWORK_ACCESS_TOKEN=CHATWORK_ACCESS_TOKEN\n```\n\n\u5024\u3092\u8a2d\u5b9a\u5f8c\u306bWEB\u306eUI\u306e\u307b\u3046\u304b\u3089\u76f4\u3057\u307e\u3059\u3002\n\n![image_20150622_182403_4.png](https://qiita-image-store.s3.amazonaws.com/1560/56170/e680e249-4b44-bcde-157d-edd5064d1f0d.png)\n\n# \u4ed6\u306e\u8a2d\u5b9a\u3082\u5916\u90e8\u5316\n\n```\nheroku config:add TARGET_DATE=TARGET_DATE\nheroku config:add ROOM_ID=ROOM_ID\nheroku config:add EVENT_TITLE=EVENT_TITLE\n```\n\nROOM_ID\u306f\u767a\u8a00\u3055\u305b\u305f\u3044\u30eb\u30fc\u30e0ID\u3002URL\u78ba\u8a8d\u3059\u308b\u3068\u308f\u304b\u308a\u307e\u3059\u3002\n\n```\u30eb\u30fc\u30e0ID 123456 \u3078 2015/10/10 \u306b \u4f53\u80b2\u306e\u65e5``` \u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u3092\u3057\u305f\u3044\u5834\u5408\u3002\n\n```\nheroku config:add TARGET_DATE=2015/10/10\nheroku config:add ROOM_ID=123456\nheroku config:add EVENT_TITLE=\u4f53\u80b2\u306e\u65e5\n```\n\n# \u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u30fcaddons\u3092\u8a2d\u5b9a\n\n```\nheroku addons:create scheduler:standard\n```\n\n1\u65e5\u3054\u3068\u306b\u558b\u3089\u305b\u308b\n\n![image_20150622_181559_2.png](https://qiita-image-store.s3.amazonaws.com/1560/56170/6c2dfa53-cedb-cb35-9937-6fc1d7faaf13.png)\n\nUTC\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u65e5\u672c\u6642\u9593\u3067\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306f-9:00\u3057\u305f\u6642\u9593\u3067\u884c\u3046\u3002\n\n```\n\u65e5\u672c\u6642\u9593AM10:00\u306b\u884c\u3044\u305f\u3044\u3068\u304d\u306f 1:00 UTC\u3002\n```\n\n# \u5b9f\u969b\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n```js\nvar express = require('express');\nvar app = express();\n\napp.set('port', (process.env.PORT || 5000));\napp.use(express.static(__dirname + '/public'));\n\n// JSON\u30d5\u30a1\u30a4\u30eb\u306e\u8aad\u307f\u8fbc\u307f\uff08\u30ed\u30fc\u30ab\u30eb\u7528\uff09\nvar fs = require('fs');\nvar setting = {};\nif( process.env.PORT ) {\n    //\n} else {\n    // .env\u30d5\u30a9\u30eb\u30c0\u306f\u3042\u3089\u304b\u3058\u3081 .gitignore \u5bfe\u8c61\u306b\u3057\u3066\u304a\u304f\u3002\n    setting = JSON.parse(fs.readFileSync('.env/setting.json', 'utf8'));\n}\n\n// \u8a2d\u5b9a\u8aad\u307f\u8fbc\u307f\nvar ROOM_ID = (process.env.ROOM_ID || setting.ROOM_ID);  // \u5bfe\u8c61\u30eb\u30fc\u30e0\nvar CHATWORK_ACCESS_TOKEN = (process.env.CHATWORK_ACCESS_TOKEN || setting.CHATWORK_ACCESS_TOKEN);  // \u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\nvar TARGET_DATE = (process.env.TARGET_DATE || setting.TARGET_DATE);  // \u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u65e5\u4ed8\nvar EVENT_TITLE = (process.env.EVENT_TITLE || setting.EVENT_TITLE);  // \u30a4\u30d9\u30f3\u30c8\u30bf\u30a4\u30c8\u30eb\nconsole.log(\"CHATWORK_ACCESS_TOKEN : \" + CHATWORK_ACCESS_TOKEN);\nconsole.log(\"ROOM_ID : \" + ROOM_ID);\nconsole.log(\"TARGET_DATE : \" + TARGET_DATE);\nconsole.log(\"EVENT_TITLE : \" + EVENT_TITLE);\n\n// \u6642\u9593\nvar unity_base_time = new Date(TARGET_DATE);\nconsole.log(unity_base_time);\n\n// \u30b5\u30fc\u30d0\u30fc\u4e0a\u306e\u6642\u5dee\u3092\u78ba\u8a8d\nvar GMT9 = 9 * 60 * 60 * 1000; //  GMT+0900\nvar timezoneOffset = new Date().getTimezoneOffset();\nconsole.log(\"timezoneOffset : \" + timezoneOffset + \"min\");\n// \u305d\u308c\u306b\u57fa\u3065\u3044\u3066\u6642\u5dee\u3092\u4fee\u6b63\u3059\u308b\u30df\u30ea\u79d2\u3092\u751f\u6210(timezoneOffset_msec)\nvar timezoneOffset_msec = timezoneOffset * 60 * 1000 + GMT9;\nconsole.log(\"timezoneOffset_msec : \" + timezoneOffset_msec + \"msec\");\n\n// \u6642\u9593\u6bd4\u8f03\nfunction getUnitySpanDate(){\n    // \u73fe\u5728\u306e\u6642\u9593\n    var d = new Date();\n    // 0:00\u540c\u58eb\u3067\u6bd4\u8f03\u3057\u306a\u3044\u3068\u3061\u3083\u3093\u3068\u3057\u305f\u5024\u304c\u51fa\u306a\u3044\u306e\u3067\u88dc\u6b63\n    var current_date = new Date(d.getFullYear() + \"/\" + (d.getMonth()+1) + \"/\" + d.getDate() );\n    // \u6642\u9593\u88dc\u6b63\n    unity_base_time.setTime( unity_base_time.getTime() + timezoneOffset_msec );\n    current_date.setTime( current_date.getTime() + timezoneOffset_msec );\n    // \u671f\u9593(timezoneOffset_msec\u3092\u4f7f\u3046)\n    var span_timestamp = unity_base_time.getTime() - current_date.getTime();\n    // 1\u65e5(per_day)\u3067\u5272\u308b\n    var per_day = 84600 * 1000;\n    var ret = Math.floor(span_timestamp / per_day);  // \u5207\u308a\u6368\u3066\n\n    return ret;\n}\n\n// \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\nfunction postMessage(bodyStr){\n    var request = require('request');\n    var options = {\n        headers: {\n            'X-ChatWorkToken': CHATWORK_ACCESS_TOKEN\n        },\n        json: true\n    };\n\n    options.url = 'https://api.chatwork.com/v1/rooms/' + ROOM_ID + '/messages';\n    options.form = { body: bodyStr };\n    request.post(options, function (error, response, body) {\n        if (!error && response.statusCode == 200) {\n            console.log(body);\n        }else{\n            console.log('error: '+ response.statusCode);\n        }\n    });\n}\n\napp.get('/', function(request, response) {\n    response.send('Hello World!');\n});\n\napp.get('/check', function(request, response) {\n\n    response.send('check!');\n    console.log('check!');\n    console.log(new Date().toString());\n\n    var span_date = getUnitySpanDate();\n\n    if( span_date == 0 ) {\n        // \u5f53\u65e5\u51e6\u7406\n        var bodyStr = '';\n        bodyStr += '[info][title]bot\uff1a\u304a\u77e5\u3089\u305b[/title]\u307f\u306a\u3055\u3093\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\uff01' + \"\\n\";\n        bodyStr += EVENT_TITLE + ' \u306f(*)\u672c(*)\u65e5(*)\u958b(*)\u50ac(*)\u3067\u3059\u3002[/info]';\n\n        postMessage(bodyStr);\n    } else if( span_date > 0 ){\n        // \u5f53\u65e5\u307e\u3067\u306e\u30ab\u30a6\u30f3\u30c8\u30c0\u30a6\u30f3\u51e6\u7406\n        var bodyStr = '';\n        bodyStr += '[info][title]bot\uff1a\u304a\u77e5\u3089\u305b[/title]\u307f\u306a\u3055\u3093\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\uff01' + \"\\n\";\n        bodyStr += EVENT_TITLE + ' \u306f ' + TARGET_DATE + ' \u958b\u50ac\u3067\u3059\u3002';\n        bodyStr += '[info](F)\u3042\u3068 ' + span_date + ' \u65e5\uff01(F)[/info][/info]' + \"\\n\";\n\n        postMessage(bodyStr);\n    } else {\n        // \u65e2\u306b\u904e\u304e\u3066\u3044\u308b\u5834\u5408\u306f\u4f55\u3082\u3057\u306a\u3044\n    }\n\n});\n\napp.listen(app.get('port'), function() {\n    console.log('Node app is running on port', app.get('port'));\n});\n```\n\n\n\n# \u53c2\u8003\u8a18\u4e8b\n\n* <a href=\"http://qiita.com/n0bisuke/items/25813fba8120451d40da\" title=\"\u901f\u5831! ChatworkAPI\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u53cd\u5fdc\u3059\u308bBOT\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002 - Qiita\" target=\"_blank\">\u901f\u5831! ChatworkAPI\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u53d6\u5f97\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u306b\u53cd\u5fdc\u3059\u308bBOT\u4f7f\u3063\u3066\u307f\u307e\u3057\u305f\u3002 - Qiita</a>\n* <a href=\"http://qiita.com/n0bisuke/items/6a3164b27e3775c81e3c\" title=\"ChatworkAPI\u3067message\u3092POST\u3057\u3066\u307f\u308b\u3002 - Qiita\" target=\"_blank\">ChatworkAPI\u3067message\u3092POST\u3057\u3066\u307f\u308b\u3002 - Qiita</a>\n* <a href=\"http://qiita.com/n0bisuke/items/c7b82b5b64a3155baed3\" title=\"ChatworkAPI\u306bexpress\u304b\u3089request\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u63a5\u7d9a - Qiita\" target=\"_blank\">ChatworkAPI\u306bexpress\u304b\u3089request\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u63a5\u7d9a - Qiita</a>\n", "tags": ["chatwork", "Heroku"]}