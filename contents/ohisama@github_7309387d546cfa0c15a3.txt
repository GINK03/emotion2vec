{"context": " More than 1 year has passed since last update.\n\n\u6982\u8981\nsmallbasic\u3067sango\u306besp8266\u304b\u3089mqtt\u306epublish\u3057\u3066\u307f\u305f\u3002\nmqtt\u306f\u30b9\u30af\u30e9\u30c3\u30c1\u3057\u305f\u3002\n\n\u5199\u771f\n\n\n\u753b\u9762\n\n\n\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\nc = Text.GetCharacter(34)\nn = Text.GetCharacter(13) + Text.GetCharacter(10)\nbutton0 = Controls.AddButton(\"open\", 30, 20)\nbutton1 = Controls.AddButton(\"gmr\", 90, 20)\nbutton2 = Controls.AddButton(\"cwjap\", 150, 20)\nbutton3 = Controls.AddButton(\"cipmux\", 210, 20)\nbutton4 = Controls.AddButton(\"start\", 30, 80)\nbutton5 = Controls.AddButton(\"cifsr\", 90, 80)\nbutton6 = Controls.AddButton(\"pub\", 150, 80)\nbutton7 = Controls.AddButton(\"status\", 210, 80)\nControls.ButtonClicked = OnButtonClicked\nmtextbox0 = Controls.AddMultiLineTextBox(10, 150)\nControls.SetSize(mtextbox0, 300, 200)\nControls.SetTextBoxText(mtextbox0, \"send\" + n)\nmtextbox1 = Controls.AddMultiLineTextBox(320, 30)\nControls.SetSize(mtextbox1, 300, 400)\nControls.SetTextBoxText(mtextbox1, \"recv\" + n)\nSub OnButtonClicked\n  button = Controls.LastClickedButton\n  If (button = button0) Then\n    class1.OpenPort(\"COM5\", 115200)\n    class1.SetHandshake(\"n\")\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">open\" + n)\n  ElseIf (button = button1) Then\n    class1.TXString(\"AT+GMR\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">gmr\" + n)\n    Program.Delay(100)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button2) Then\n    class1.TXString(\"AT+CWJAP=\" + c +\"free-spot\" + c  + \",\" + c + c + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cwjap\" + n)\n    Program.Delay(3000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button3) Then\n    class1.TXString(\"AT+CIPMUX=0\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cipmux\" + n)\n    Program.Delay(100)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button4) Then\n    class1.TXString(\"AT+CIPSTART=\" + c + \"TCP\" + c  + \",\" + c + \"lite.mqtt.shiguredo.jp\" + c + \",1883\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">start\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    class1.TXString(\"AT+CIPSEND=52\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">auth\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    buf = \"\"\n    buf = buf + Text.GetCharacter(16)\n    buf = buf + Text.GetCharacter(50)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(4) + \"MQTT\"\n    buf = buf + Text.GetCharacter(4)\n    class1.TXString(buf)\n    class1.TXByte(194)\n    buf = \"\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(60)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(4) + \"papa\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(14) + \"ohisama@github\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(16) + \"****************\"\n    class1.TXString(buf)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button6) Then\n    While \"True\"\n    class1.TXString(\"AT+CIPSEND=28\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">pub\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    buf = \"\"\n    buf = buf + Text.GetCharacter(48)\n    buf = buf + Text.GetCharacter(26)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(20) + \"ohisama@github/test0\"\n    buf = buf + \"28.5\"\n    class1.TXString(buf)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    Program.Delay(19000)\n    EndWhile\n  ElseIf (button = button5) Then\n    class1.TXString(\"AT+CIFSR\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cifsr\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf  \n  ElseIf (button = button7) Then\n    class1.TXString(\"AT+CIPSTATUS\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">status\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf  \n  EndIf\nEndSub\n\n\n##\u6982\u8981\nsmallbasic\u3067sango\u306besp8266\u304b\u3089mqtt\u306epublish\u3057\u3066\u307f\u305f\u3002\nmqtt\u306f\u30b9\u30af\u30e9\u30c3\u30c1\u3057\u305f\u3002\n##\u5199\u771f\n![MVC-018S.JPG](https://qiita-image-store.s3.amazonaws.com/0/18104/44b020d4-7452-6840-2bf6-0067c249eb4e.jpeg)\n##\u753b\u9762\n![mqtt.PNG](https://qiita-image-store.s3.amazonaws.com/0/18104/a68834b5-a75d-5516-ff0e-1da6a80467c6.png)\n##\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\n```\nc = Text.GetCharacter(34)\nn = Text.GetCharacter(13) + Text.GetCharacter(10)\nbutton0 = Controls.AddButton(\"open\", 30, 20)\nbutton1 = Controls.AddButton(\"gmr\", 90, 20)\nbutton2 = Controls.AddButton(\"cwjap\", 150, 20)\nbutton3 = Controls.AddButton(\"cipmux\", 210, 20)\nbutton4 = Controls.AddButton(\"start\", 30, 80)\nbutton5 = Controls.AddButton(\"cifsr\", 90, 80)\nbutton6 = Controls.AddButton(\"pub\", 150, 80)\nbutton7 = Controls.AddButton(\"status\", 210, 80)\nControls.ButtonClicked = OnButtonClicked\nmtextbox0 = Controls.AddMultiLineTextBox(10, 150)\nControls.SetSize(mtextbox0, 300, 200)\nControls.SetTextBoxText(mtextbox0, \"send\" + n)\nmtextbox1 = Controls.AddMultiLineTextBox(320, 30)\nControls.SetSize(mtextbox1, 300, 400)\nControls.SetTextBoxText(mtextbox1, \"recv\" + n)\nSub OnButtonClicked\n  button = Controls.LastClickedButton\n  If (button = button0) Then\n    class1.OpenPort(\"COM5\", 115200)\n    class1.SetHandshake(\"n\")\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">open\" + n)\n  ElseIf (button = button1) Then\n    class1.TXString(\"AT+GMR\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">gmr\" + n)\n    Program.Delay(100)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button2) Then\n    class1.TXString(\"AT+CWJAP=\" + c +\"free-spot\" + c  + \",\" + c + c + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cwjap\" + n)\n    Program.Delay(3000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button3) Then\n    class1.TXString(\"AT+CIPMUX=0\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cipmux\" + n)\n    Program.Delay(100)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button4) Then\n    class1.TXString(\"AT+CIPSTART=\" + c + \"TCP\" + c  + \",\" + c + \"lite.mqtt.shiguredo.jp\" + c + \",1883\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">start\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    class1.TXString(\"AT+CIPSEND=52\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">auth\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    buf = \"\"\n    buf = buf + Text.GetCharacter(16)\n    buf = buf + Text.GetCharacter(50)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(4) + \"MQTT\"\n    buf = buf + Text.GetCharacter(4)\n    class1.TXString(buf)\n    class1.TXByte(194)\n    buf = \"\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(60)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(4) + \"papa\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(14) + \"ohisama@github\"\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(16) + \"****************\"\n    class1.TXString(buf)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n  ElseIf (button = button6) Then\n    While \"True\"\n    class1.TXString(\"AT+CIPSEND=28\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">pub\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    buf = \"\"\n    buf = buf + Text.GetCharacter(48)\n    buf = buf + Text.GetCharacter(26)\n    buf = buf + Text.GetCharacter(0)\n    buf = buf + Text.GetCharacter(20) + \"ohisama@github/test0\"\n    buf = buf + \"28.5\"\n    class1.TXString(buf)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf\n    Program.Delay(19000)\n    EndWhile\n  ElseIf (button = button5) Then\n    class1.TXString(\"AT+CIFSR\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">cifsr\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf  \n  ElseIf (button = button7) Then\n    class1.TXString(\"AT+CIPSTATUS\" + n)\n    text = Controls.GetTextBoxText(mtextbox0)\n    Controls.SetTextBoxText(mtextbox0, text + \">status\" + n)\n    Program.Delay(1000)\n    s = Class1.RXAll()\n    if s <> \"\" then\n      text = Controls.GetTextBoxText(mtextbox1) + \"@\"\n      Controls.SetTextBoxText(mtextbox1, text + s + n)\n    EndIf  \n  EndIf\nEndSub\n\n```\n", "tags": ["smallbasic", "mqtt", "ESP8266", "sango"]}