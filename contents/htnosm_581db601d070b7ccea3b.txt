{"context": "\n\n\u4e8b\u8c61\nfluent-plugin-cloudwatch-logs \u3092\u4f7f\u7528\u3057\u3066\u8907\u6570\u306e AWS EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 CloudWatch Logs \u306e\u540c\u4e00 LogStream \u3078\u8ee2\u9001\u3057\u3066\u3044\u305f\u969b\u3001\u4e0b\u8a18\u306e\u69d8\u306a WARNING \u306b\u3088\u308a\u30ed\u30b0\u8ee2\u9001\u304c\u884c\u308f\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n2016-05-14 02:08:24 +0000 [warn]: temporarily failed to flush the buffer. next_retry=2016-05-14 02:42:45 +0000 error_class=\"Aws::CloudWatchLogs::Errors::InvalidSequenceTokenException\" error=\"The given sequenceToken is invalid. The next expected sequenceToken is: 99999999999999999999999999999999999999999999999999999999\" plugin_id=\"object:XXXXXXXXX1dc\"\n\n\n\u539f\u56e0\n\u4ed5\u69d8\u306e\u3088\u3046\u3067\u3001\u8907\u6570\u306e\u8ee2\u9001\u5143\u304b\u3089\u540c\u4e00 LogStream \u3078\u306e\u8ee2\u9001\u6642\u306f\u767a\u751f\u3059\u308b\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\nInvalidSequenceTokenException \u00b7 Issue #32 \u00b7 ryotarai/fluent-plugin-cloudwatch-logs\n\n\n\u56de\u907f\u7b56\nLogStream \u3092\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u56fa\u6709\u306b\u3057\u307e\u3059\u3002\n\nsource \u90e8\u4f8b\n\u4f8b\u3068\u3057\u3066 nginx \u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n<source>\n  @type tail\n  format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \\[(?<time>[^\\]]*)\\] \"(?<method>\\S+)(?: +(?<path>[^ ]*) +\\S*)?\" (?<code>[^ ]*) (?<size>[^ ]*)(?: \"(?<referer>[^\\\"]*)\" \"(?<agent>[^\\\"]*)\" \"(?<forwarder>[^\\\"]*)\")?/\n  time_format %d/%b/%Y:%H:%M:%S %z\n  tag nginx.access\n  path /var/log/nginx/access.log\n</source>\n\n<source>\n  @type tail\n  format /^(?<time>\\d{4}/\\d{2}/\\d{2} \\d{2}:\\d{2}:\\d{2}) \\[(?<log_level>\\w+)\\] (?<pid>\\d+).(?<tid>\\d+): (?<message>.*)$/\n  tag nginx.error\n  path /var/log/nginx/error.log\n</source>\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\nLogStream \u3092\u56fa\u6709\u306b\u3067\u304d\u308c\u3070\u826f\u3044\u306e\u3067ID\u3084\u30db\u30b9\u30c8\u540d\u7b49\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\u4eca\u56de\u306f InstanceId \u3092\u4ed8\u3051\u307e\u3057\u305f\u3002\n\nfluent-plugin-ec2-metadata \u3067 InstanceId \u3092\u53d6\u5f97\n\n\n\u51fa\u529b\u30bf\u30b0\u306b InstanceId \u4ed8\u4e0e\n\n\n\n<match nginx.*>\n  type ec2_metadata\n  output_tag ${instance_id}.${tag}\n\n  <record>\n    instance_id ${instance_id}\n    hostname    ${tagset_name}\n  </record>\n</match>\n\n\n\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3078\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u4ed8\u4e0e\n\nfluent-plugin-forest \u3067 fluent-plugin-cloudwatch-logs \u306e log_stream_name \u306b InstanceId \u3092\u4ed8\u4e0e\n\n<match *.nginx.*>\n  type forest\n  subtype cloudwatch_logs\n\n  <template>\n    log_group_name ${tag_parts[1]}-${tag_parts[2]}\n    log_stream_name ${tag_parts[0]}\n    region ap-northeast-1\n    auto_create_stream true\n  </template>\n</match>\n\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u7b49\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3067\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u304c\u591a\u3044\u3067\u3059\u304c\u3001\nfluent-plugin-cloudwatch-logs \u3067\u5b9f\u88c5\u3057\u3066\u3044\u3066\u30ed\u30b0\u304c\u8ee2\u9001\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n# \u4e8b\u8c61\n\nfluent-plugin-cloudwatch-logs \u3092\u4f7f\u7528\u3057\u3066\u8907\u6570\u306e AWS EC2 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304b\u3089 CloudWatch Logs \u306e\u540c\u4e00 LogStream \u3078\u8ee2\u9001\u3057\u3066\u3044\u305f\u969b\u3001\u4e0b\u8a18\u306e\u69d8\u306a WARNING \u306b\u3088\u308a\u30ed\u30b0\u8ee2\u9001\u304c\u884c\u308f\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n```\n2016-05-14 02:08:24 +0000 [warn]: temporarily failed to flush the buffer. next_retry=2016-05-14 02:42:45 +0000 error_class=\"Aws::CloudWatchLogs::Errors::InvalidSequenceTokenException\" error=\"The given sequenceToken is invalid. The next expected sequenceToken is: 99999999999999999999999999999999999999999999999999999999\" plugin_id=\"object:XXXXXXXXX1dc\"\n```\n\n# \u539f\u56e0\n\n\u4ed5\u69d8\u306e\u3088\u3046\u3067\u3001\u8907\u6570\u306e\u8ee2\u9001\u5143\u304b\u3089\u540c\u4e00 LogStream \u3078\u306e\u8ee2\u9001\u6642\u306f\u767a\u751f\u3059\u308b\u3068\u306e\u3053\u3068\u3067\u3059\u3002\n\n- [InvalidSequenceTokenException \u00b7 Issue #32 \u00b7 ryotarai/fluent-plugin-cloudwatch-logs](https://github.com/ryotarai/fluent-plugin-cloudwatch-logs/issues/32)\n\n# \u56de\u907f\u7b56\n\nLogStream \u3092\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u56fa\u6709\u306b\u3057\u307e\u3059\u3002\n\n## source \u90e8\u4f8b\n\n\u4f8b\u3068\u3057\u3066 nginx \u306e\u30ed\u30b0\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```\n<source>\n  @type tail\n  format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \\[(?<time>[^\\]]*)\\] \"(?<method>\\S+)(?: +(?<path>[^ ]*) +\\S*)?\" (?<code>[^ ]*) (?<size>[^ ]*)(?: \"(?<referer>[^\\\"]*)\" \"(?<agent>[^\\\"]*)\" \"(?<forwarder>[^\\\"]*)\")?/\n  time_format %d/%b/%Y:%H:%M:%S %z\n  tag nginx.access\n  path /var/log/nginx/access.log\n</source>\n\n<source>\n  @type tail\n  format /^(?<time>\\d{4}/\\d{2}/\\d{2} \\d{2}:\\d{2}:\\d{2}) \\[(?<log_level>\\w+)\\] (?<pid>\\d+).(?<tid>\\d+): (?<message>.*)$/\n  tag nginx.error\n  path /var/log/nginx/error.log\n</source>\n```\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u306e\u53d6\u5f97\n\nLogStream \u3092\u56fa\u6709\u306b\u3067\u304d\u308c\u3070\u826f\u3044\u306e\u3067ID\u3084\u30db\u30b9\u30c8\u540d\u7b49\u3092\u4ed8\u4e0e\u3057\u307e\u3059\u3002\u4eca\u56de\u306f InstanceId \u3092\u4ed8\u3051\u307e\u3057\u305f\u3002\n\n- fluent-plugin-ec2-metadata \u3067 InstanceId \u3092\u53d6\u5f97\n\t- \u51fa\u529b\u30bf\u30b0\u306b InstanceId \u4ed8\u4e0e\n\n```\n<match nginx.*>\n  type ec2_metadata\n  output_tag ${instance_id}.${tag}\n\n  <record>\n    instance_id ${instance_id}\n    hostname    ${tagset_name}\n  </record>\n</match>\n```\n\n## \u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3078\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3092\u4ed8\u4e0e\n\n- fluent-plugin-forest \u3067 fluent-plugin-cloudwatch-logs \u306e log_stream_name \u306b InstanceId \u3092\u4ed8\u4e0e\n\n```\n<match *.nginx.*>\n  type forest\n  subtype cloudwatch_logs\n\n  <template>\n    log_group_name ${tag_parts[1]}-${tag_parts[2]}\n    log_stream_name ${tag_parts[0]}\n    region ap-northeast-1\n    auto_create_stream true\n  </template>\n</match>\n```\n\n---\n\nCloudWatch Logs \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u7b49\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9ID\u3067\u30ed\u30b0\u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u8a2d\u5b9a\u3059\u308b\u4e8b\u304c\u591a\u3044\u3067\u3059\u304c\u3001\nfluent-plugin-cloudwatch-logs \u3067\u5b9f\u88c5\u3057\u3066\u3044\u3066\u30ed\u30b0\u304c\u8ee2\u9001\u3055\u308c\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u826f\u3044\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\n", "tags": ["fluentd", "td-agent2", "CloudWatch"]}