{"tags": ["SRX", "AWS", "junos"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u81ea\u5b85\u304b\u3089AWS\u3078SRX\u3092\u4f7f\u7528\u3057\u3066VPN\u3067\u63a5\u7d9a\u3092\u3059\u308b\u3002\n\nAWS\u69cb\u6210\n\u54c1\u5ddd\u304b\u3089AWS\u3078\u63a5\u7d9a\u3059\u308b\u3002\n\n\nVPC\u8a2d\u5b9a\n\nCustomer Gateways\nVPC Dashboard\u304b\u3089Customer Gateways\u3092\u9078\u629e\u3002\nBGP\u306b\u3066\u7d4c\u8def\u4ea4\u63db\u3092\u884c\u3046\u305f\u3081\u3001Dynamic\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n\nVirtual Private Gateways\nipsec\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001Virtual Private Gateways\u3092\u9078\u629e\u3002\n\u4f5c\u6210\u3059\u308b\u3060\u3051\u3002\n\n\nVPN Connections\nVPN\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306bVPN Connections\u3092\u9078\u629e\u3002\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u3001\u300cVPN Connections\u300d\u3001\u300cVPN Connections\u300d\u3092\u95a2\u9023\u4ed8\u3051\u3059\u308b\u3002\n\u307e\u305f\u3001BGP\u306b\u3066\u63a5\u7d9a\u3059\u308b\u305f\u3081Dynamic\u3068\u3059\u308b\u3002\n\n\nRoute\n\u4f5c\u6210\u3057\u305fGW\u3078\u306e\u30eb\u30fc\u30c8\u3092\u8ffd\u52a0\n\n\n\nSRX\u8a2d\u5b9a\n\u8a2d\u5b9a\u3059\u308b\u5143Config\u306f\u3001\u3053\u3061\u3089\nVPN Connections\u306eDownload Configuration\u304b\u3089\u8a2d\u5b9a\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n\n\u5f8c\u306f\u8a2d\u5b9a\u3092\u305d\u306e\u307e\u307e\u8ffd\u52a0\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u601d\u3044\u304d\u3084\u3001\u4e00\u624b\u9593\u5fc5\u8981\u3002\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30c8\u3092\u5e83\u544a\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u8a72\u5f53\u306e\u30eb\u30fc\u30c8\u306e\u307f\u306b\u5909\u66f4\n\n\nSRX210.conf\n##\u524a\u9664\nset policy-options policy-statement EXPORT-DEFAULT term default from route-filter 0.0.0.0/0 exact\n##\u8ffd\u52a0\nset policy-options policy-statement EXPORT-DEFAULT term default from route-filter 172.17.0.0/24 exact\n\n\n\npp0.0\u306b\u3066\u30d4\u30a2\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306b\u5909\u66f4\n\n\nSRX210.conf\n##\u524a\u9664\nset security ike gateway gw-vpn-81b50280-1 external-interface ge-0/0/0.0\nset security ike gateway gw-vpn-81b50280-2 external-interface ge-0/0/0.0\n##\u8ffd\u52a0\nset security ike gateway gw-vpn-81b50280-1 external-interface pp0.0\nset security ike gateway gw-vpn-81b50280-2 external-interface pp0.0      \n\n\n\n\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\n\n\u30eb\u30fc\u30bf\u306e\u8a2d\u5b9a\u3084\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\u306b\u3088\u3063\u3066\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n\nSRX210.conf\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match source-address any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match destination-address any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match application any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn then permit\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match source-address any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match destination-address any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match application any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn then permit\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match source-address any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match destination-address any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match application any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn then permit\nset security zones security-zone vpn interfaces st0.1\nset security zones security-zone vpn interfaces st0.2\ndelete security zones security-zone trust interfaces st0.1\ndelete security zones security-zone trust interfaces st0.2\n\n\n\n\u901a\u4fe1\u78ba\u8a8d\n\nIKE Status\u78ba\u8a8d\n\nroot> show security ike security-associations\nIndex   State  Initiator cookie  Responder cookie  Mode           Remote Address\n3843154 UP     53d3ff37802470d3  86e611a696ac37bf  Main           xxx.xxx.xxx.xxx\n3843153 UP     85dc9face9e23f63  4cbb9957c5ee31f5  Main           xxx.xxx.xxx.xxx\n\n\nIPsec\u3000\u78ba\u8a8d\n\nroot> show security ipsec security-associations\nTotal active tunnels: 2\nID    Algorithm       SPI      Life:sec/kb  Mon vsys Port  Gateway\n/<131073 ESP:aes-128/sha1 c546e29c 3445/ unlim -  root 500   xxx.xxx.xxx.xxx\n/>131073 ESP:aes-128/sha1 90bce219 3445/ unlim -  root 500   xxx.xxx.xxx.xxx\n/<131074 ESP:aes-128/sha1 ad9f05f7 3450/ unlim -  root 500   xxx.xxx.xxx.xxx\n/>131074 ESP:aes-128/sha1 9c37647f 3450/ unlim -  root 500   xxx.xxx.xxx.xxx\n\n\nBGP\u30d4\u30a2\u78ba\u8a8d\n\nroot> show bgp summary\nGroups: 1 Peers: 2 Down peers: 0\nTable          Tot Paths  Act Paths Suppressed    History Damp State    Pending\ninet.0\n                       0          0          0          0          0          0\nPeer                     AS      InPkt     OutPkt    OutQ   Flaps Last Up/Dwn State|#Active/Received/Accepted/Damped...\nxxx.xxx.xxx.xxx         10124         31         35       0       0        4:42 0/0/0/0              0/0/0/0\nxxx.xxx.xxx.xxx         10124         32         34       0       0        4:38 0/0/0/0              0/0/0/0\n\n\nBGP\u53d7\u4fe1\u7d4c\u8def\u78ba\u8a8d\n\nroot> show route protocol bgp\ninet.0: 10 destinations, 11 routes (10 active, 0 holddown, 0 hidden)\n+ = Active Route, - = Last Active, * = Both\n10.0.0.0/16        *[BGP/170] 00:03:30, localpref 100\n                      AS path: 10124 I\n                    > to 169.254.252.5 via st0.2\n                    [BGP/170] 00:03:30, localpref 100\n                      AS path: 10124 I\n                    > to 169.254.252.1 via st0.1\n\n\nBGP\u9001\u4fe1\u7d4c\u8def\u78ba\u8a8d(\u30d4\u30a2\u6bce\u306b\u78ba\u8a8d)\n\nroot> show route advertising-protocol bgp xxx.xxx.xxx.xxx\ninet.0: 9 destinations, 9 routes (9 active, 0 holddown, 0 hidden)\n  Prefix                  Nexthop              MED     Lclpref    AS path\n* 172.17.0.0/24           Self                                    I\n\n\nPing\n\n[ec2-user@ip-10-0-1-10 ~]$ ping 172.17.0.11\nPING 172.17.0.11 (172.17.0.11) 56(84) bytes of data.\n64 bytes from 172.17.0.11: icmp_seq=1 ttl=126 time=8.14 ms\n64 bytes from 172.17.0.11: icmp_seq=2 ttl=126 time=7.81 ms\n64 bytes from 172.17.0.11: icmp_seq=3 ttl=126 time=11.3 ms\n\netc...\nBGP\u30d4\u30a2\u3001VPN\u306f\u7c21\u5358\u306b\u63a5\u7d9a\u3067\u304d\u308b\u304c\u3001\u30d5\u30a1\u30a4\u30a2\u30fc\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u306f\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u307e\u305f\u30011\u65e5\u63a5\u7d9a\u3057\u3066\u3044\u308b\u3060\u3051\u30671\u30c9\u30eb\u7a0b\u5ea6\u304b\u304b\u308b\u305f\u3081\u3001\n\u500b\u4eba\u7684\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u5fc5\u8981\u306a\u6642\u3060\u3051\u306b\u3059\u308b\u3002\n#\u6982\u8981\n\n\u81ea\u5b85\u304b\u3089AWS\u3078SRX\u3092\u4f7f\u7528\u3057\u3066VPN\u3067\u63a5\u7d9a\u3092\u3059\u308b\u3002\n\n##AWS\u69cb\u6210\n\n\u54c1\u5ddd\u304b\u3089AWS\u3078\u63a5\u7d9a\u3059\u308b\u3002\n\n![AWS_Web - New Page.jpeg](https://qiita-image-store.s3.amazonaws.com/0/49877/85e7a360-b682-d037-43d0-17a7c0219b81.jpeg)\n\n\n##VPC\u8a2d\u5b9a\n\n###Customer Gateways\nVPC Dashboard\u304b\u3089Customer Gateways\u3092\u9078\u629e\u3002\nBGP\u306b\u3066\u7d4c\u8def\u4ea4\u63db\u3092\u884c\u3046\u305f\u3081\u3001Dynamic\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n![cgw.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/7e9155f5-a0cb-38b5-9cb5-3ccdc53c954b.png)\n\n###Virtual Private Gateways\nipsec\u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001Virtual Private Gateways\u3092\u9078\u629e\u3002\n\u4f5c\u6210\u3059\u308b\u3060\u3051\u3002\n![vpg1.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/dc3d46b1-da84-f806-d1bc-fc84b9539ec7.png)\n\n###VPN Connections\nVPN\u3092\u4f5c\u6210\u3059\u308b\u305f\u3081\u306bVPN Connections\u3092\u9078\u629e\u3002\n\u5148\u307b\u3069\u4f5c\u6210\u3057\u305f\u3001\u300cVPN Connections\u300d\u3001\u300cVPN Connections\u300d\u3092\u95a2\u9023\u4ed8\u3051\u3059\u308b\u3002\n\u307e\u305f\u3001BGP\u306b\u3066\u63a5\u7d9a\u3059\u308b\u305f\u3081Dynamic\u3068\u3059\u308b\u3002\n\n![vpn.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/591b5a6a-f78e-2dca-9d49-661821451fbc.png)\n\n###Route\n\u4f5c\u6210\u3057\u305fGW\u3078\u306e\u30eb\u30fc\u30c8\u3092\u8ffd\u52a0\n\n![route.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/5635d446-d4e5-cb78-7dd6-f8f356f8edac.png)\n\n![route2.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/c53877e9-20a7-042a-9bac-3dcd2b7a9b54.png)\n\n\n##SRX\u8a2d\u5b9a\n\n\u8a2d\u5b9a\u3059\u308b\u5143Config\u306f\u3001[\u3053\u3061\u3089](http://qiita.com/SatoHiroyuki/items/471fd0342c3101fb8765)\n\n\nVPN Connections\u306eDownload Configuration\u304b\u3089\u8a2d\u5b9a\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3002\n![config.PNG](https://qiita-image-store.s3.amazonaws.com/0/49877/4f059964-d3f2-5541-f33a-3841e1cc8b21.png)\n\n\u5f8c\u306f\u8a2d\u5b9a\u3092\u305d\u306e\u307e\u307e\u8ffd\u52a0\u3059\u308c\u3070\u3044\u3044\u304b\u3068\u601d\u3044\u304d\u3084\u3001\u4e00\u624b\u9593\u5fc5\u8981\u3002\n\n* \u30c7\u30d5\u30a9\u30eb\u30c8\u30eb\u30fc\u30c8\u3092\u5e83\u544a\u3057\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u8a72\u5f53\u306e\u30eb\u30fc\u30c8\u306e\u307f\u306b\u5909\u66f4\n\n```lang:SRX210.conf\n##\u524a\u9664\nset policy-options policy-statement EXPORT-DEFAULT term default from route-filter 0.0.0.0/0 exact\n##\u8ffd\u52a0\nset policy-options policy-statement EXPORT-DEFAULT term default from route-filter 172.17.0.0/24 exact\n```\n\n* pp0.0\u306b\u3066\u30d4\u30a2\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306b\u5909\u66f4\n \n```lang:SRX210.conf\n##\u524a\u9664\nset security ike gateway gw-vpn-81b50280-1 external-interface ge-0/0/0.0\nset security ike gateway gw-vpn-81b50280-2 external-interface ge-0/0/0.0\n##\u8ffd\u52a0\nset security ike gateway gw-vpn-81b50280-1 external-interface pp0.0\nset security ike gateway gw-vpn-81b50280-2 external-interface pp0.0      \n```\n* \u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\n\n\u30eb\u30fc\u30bf\u306e\u8a2d\u5b9a\u3084\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30dd\u30ea\u30b7\u30fc\u306b\u3088\u3063\u3066\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\n\n```lang:SRX210.conf\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match source-address any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match destination-address any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn match application any\nset security policies from-zone trust to-zone vpn policy trust-to-vpn then permit\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match source-address any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match destination-address any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn match application any\nset security policies from-zone vpn to-zone trust policy trust-to-vpn then permit\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match source-address any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match destination-address any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn match application any\nset security policies from-zone vpn to-zone vpn policy trust-to-vpn then permit\nset security zones security-zone vpn interfaces st0.1\nset security zones security-zone vpn interfaces st0.2\ndelete security zones security-zone trust interfaces st0.1\ndelete security zones security-zone trust interfaces st0.2\n```\n\n##\u901a\u4fe1\u78ba\u8a8d\n\n* IKE Status\u78ba\u8a8d\n\n`root> show security ike security-associations\nIndex   State  Initiator cookie  Responder cookie  Mode           Remote Address\n3843154 UP     53d3ff37802470d3  86e611a696ac37bf  Main           xxx.xxx.xxx.xxx\n3843153 UP     85dc9face9e23f63  4cbb9957c5ee31f5  Main           xxx.xxx.xxx.xxx\n`\n\n* IPsec\u3000\u78ba\u8a8d\n\n`root> show security ipsec security-associations\nTotal active tunnels: 2\nID    Algorithm       SPI      Life:sec/kb  Mon vsys Port  Gateway\n/<131073 ESP:aes-128/sha1 c546e29c 3445/ unlim -  root 500   xxx.xxx.xxx.xxx\n/>131073 ESP:aes-128/sha1 90bce219 3445/ unlim -  root 500   xxx.xxx.xxx.xxx\n/<131074 ESP:aes-128/sha1 ad9f05f7 3450/ unlim -  root 500   xxx.xxx.xxx.xxx\n/>131074 ESP:aes-128/sha1 9c37647f 3450/ unlim -  root 500   xxx.xxx.xxx.xxx\n`\n\n* BGP\u30d4\u30a2\u78ba\u8a8d\n\n`root> show bgp summary\nGroups: 1 Peers: 2 Down peers: 0\nTable          Tot Paths  Act Paths Suppressed    History Damp State    Pending\ninet.0\n                       0          0          0          0          0          0\nPeer                     AS      InPkt     OutPkt    OutQ   Flaps Last Up/Dwn State|#Active/Received/Accepted/Damped...\nxxx.xxx.xxx.xxx         10124         31         35       0       0        4:42 0/0/0/0              0/0/0/0\nxxx.xxx.xxx.xxx         10124         32         34       0       0        4:38 0/0/0/0              0/0/0/0\n`\n\n* BGP\u53d7\u4fe1\u7d4c\u8def\u78ba\u8a8d\n\n`root> show route protocol bgp\ninet.0: 10 destinations, 11 routes (10 active, 0 holddown, 0 hidden)\n+ = Active Route, - = Last Active, * = Both\n10.0.0.0/16        *[BGP/170] 00:03:30, localpref 100\n                      AS path: 10124 I\n                    > to 169.254.252.5 via st0.2\n                    [BGP/170] 00:03:30, localpref 100\n                      AS path: 10124 I\n                    > to 169.254.252.1 via st0.1\n`\n\n* BGP\u9001\u4fe1\u7d4c\u8def\u78ba\u8a8d(\u30d4\u30a2\u6bce\u306b\u78ba\u8a8d)\n\n`root> show route advertising-protocol bgp xxx.xxx.xxx.xxx\ninet.0: 9 destinations, 9 routes (9 active, 0 holddown, 0 hidden)\n  Prefix                  Nexthop              MED     Lclpref    AS path\n* 172.17.0.0/24           Self                                    I\n`\n\n* Ping\n\n`[ec2-user@ip-10-0-1-10 ~]$ ping 172.17.0.11\nPING 172.17.0.11 (172.17.0.11) 56(84) bytes of data.\n64 bytes from 172.17.0.11: icmp_seq=1 ttl=126 time=8.14 ms\n64 bytes from 172.17.0.11: icmp_seq=2 ttl=126 time=7.81 ms\n64 bytes from 172.17.0.11: icmp_seq=3 ttl=126 time=11.3 ms`\n\n##etc...\nBGP\u30d4\u30a2\u3001VPN\u306f\u7c21\u5358\u306b\u63a5\u7d9a\u3067\u304d\u308b\u304c\u3001\u30d5\u30a1\u30a4\u30a2\u30fc\u30a6\u30a9\u30fc\u30eb\u306e\u8a2d\u5b9a\u306f\u74b0\u5883\u306b\u3088\u3063\u3066\u5909\u66f4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\u307e\u305f\u30011\u65e5\u63a5\u7d9a\u3057\u3066\u3044\u308b\u3060\u3051\u30671\u30c9\u30eb\u7a0b\u5ea6\u304b\u304b\u308b\u305f\u3081\u3001\n\u500b\u4eba\u7684\u306b\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u5fc5\u8981\u306a\u6642\u3060\u3051\u306b\u3059\u308b\u3002\n"}