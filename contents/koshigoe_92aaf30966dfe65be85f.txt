{"tags": ["Pure-FTPd", "ftp"], "context": " More than 1 year has passed since last update.\n\nTL;DR\n\nPure-FTPd \u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u7b2c1\u306b\u8003\u3048\u3066\u3044\u308b\u3068\u306e\u3053\u3068\nPure-FTPd \u3067\u306f\u30a2\u30c8\u30df\u30c3\u30af\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u308b\n\n\nvsftpd, ProFTPD \u3067\u5b9f\u73fe\u53ef\u80fd\u304b\u628a\u63e1\u3067\u304d\u3066\u3044\u306a\u3044(\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u4e0d\u53ef)\n\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6210\u529f\u6642\u306b\u5f8c\u51e6\u7406\u3092\u5b9f\u884c\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u308b\nMySQL \u3084 PostgreSQL \u3092\u4f7f\u3063\u3066\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u7ba1\u7406\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\n\n\nchroot \u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u81ea\u52d5\u3067\u4f5c\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0\u4f5c\u696d\u306f\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210\u3060\u3051\u3067\u826f\u3044\n\n\n\n\nPure-FTPd \u3068\u306f\nSecurity First \u304c\u5408\u3044\u8a00\u8449(?)\u306a FTPd \u3067\u3059\u3002\n\nPure-FTPd is a free (BSD), secure, production-quality and standard-conformant FTP server. It doesn't provide useless bells and whistles, but focuses on efficiency and ease of use. It provides simple answers to common needs, plus unique useful features for personal users as well as hosting providers.\nPure-FTPd - About\n\nCVE \u3078\u306e\u5831\u544a\u6570\u3082\u6700\u5c0f\u3060\u3068\u304b\u3002\n\n\u4f55\u304c\u3067\u304d\u308b\u306e\u304b\n\u6a5f\u80fd\u30ea\u30b9\u30c8\u3092\u3056\u3063\u3068\u898b\u305f\u611f\u3058\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001FTPd \u306b\u671b\u307e\u308c\u308b\u3053\u3068\u306f\u5927\u62b5\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002FTPd \u306e\u904b\u7528\u7d4c\u9a13\u304c\u8c4a\u5bcc\u306a\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u2026\u3002\n\u4ee5\u4e0b\u3001\u6a5f\u80fd\u30ea\u30b9\u30c8(Pure-FTPd - About)\u304b\u3089\u4e00\u90e8\u3092\u629c\u7c8b\u3057\u307e\u3057\u305f\u3002\n\nLinux \u30ab\u30a6\u30f3\u30c8\u3092 FTP \u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b(\u6307\u5b9a UID \u672a\u6e80\u306e\u5229\u7528\u3092\u7981\u6b62\u3068\u3044\u3046\u8a2d\u5b9a\u3082\u53ef)\n\u8a8d\u8a3c\u3092 PAM \u7d4c\u7531\u3067\u884c\u3048\u308b\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 chroot \u3059\u308b\nFTP \u30a2\u30ab\u30a6\u30f3\u30c8\u306f Linux \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u306a\u3044\u3001\u72ec\u7acb\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u7ba1\u7406\u3055\u308c\u305f\u3082\u306e\u306b\u3067\u304d\u308b(\u30d0\u30fc\u30c1\u30e3\u30eb\u30e6\u30fc\u30b6)\nLDAP \u30b5\u30dd\u30fc\u30c8\n\u8907\u6570\u306e\u8a8d\u8a3c\u65b9\u5f0f\u3092\u597d\u307f\u306e\u9806\u5e8f\u3067\u30c1\u30a7\u30a4\u30f3\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\nquota \u30b5\u30dd\u30fc\u30c8\n\u5e2f\u57df\u5236\u9650\u30b5\u30dd\u30fc\u30c8\n\u30e6\u30fc\u30b6\u5358\u4f4d\u3067\u306e\u7d30\u304b\u306a\u5236\u9650\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6210\u529f\u5f8c\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 on-demand \u306b\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\u540c\u4e00\u30db\u30b9\u30c8\u3067\u8907\u6570\u306e\u30d0\u30fc\u30c1\u30e3\u30eb FTP \u30b5\u30fc\u30d0\u3092\u904b\u7528\u3067\u304d\u308b\nchroot \u5916\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u30d5\u30a9\u30ed\u30fc\u3059\u308b\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f atomic\n\n\nCentOS7 \u306e VM \u3092\u6e96\u5099\n\u3044\u304f\u3064\u304b\u306e\u52d5\u4f5c\u691c\u8a3c\u306e\u305f\u3081\u306b CentOS 7 \u306e VM \u3092\u7528\u610f\u3057\u307e\u3059\u3002\nCentOS \u3067\u3042\u308b\u5fc5\u8981\u6027\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\u203b \u4ee5\u5f8c\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u8a18\u9332\u306b\u3066 SELinux \u306b\u95a2\u3059\u308b\u8a71\u306f\u66d6\u6627\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059(Permissive \u3060\u3063\u305f\u3001\u3068\u3060\u3051\u8a00\u3063\u3066\u304a\u304d\u307e\u3057\u3087\u3046)\u3002\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # config.ssh.insert_key = false\n  config.vm.box = \"bento/centos-7.1\"\n\n  config.vm.define 'pure-ftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.10\"\n    c.vm.hostname = 'pure-ftpd'\n  end\n\n  config.vm.define 'pro-ftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.11\"\n    c.vm.hostname = 'pro-ftpd'\n  end\n\n  config.vm.define 'vsftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.12\"\n    c.vm.hostname = 'vsftpd'\n  end\nend\n\n\nAtomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\uff1f\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7528\u306b\u5927\u304d\u3081\u306e Sparse file \u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n% dd if=/dev/zero of=./hoge.dat seek=1000 bs=1048576 count=1\n\n\nvsftpd \u306f\uff1f\nvsftpd \u3092\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n[vagrant@vsftpd]$ sudo yum install vsftpd\n[vagrant@vsftpd]$ sudo systemctl start vsftpd\n[vagrant@vsftpd]$ sudo systemctl enable vsftpd\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n% ftp vagrant@192.168.33.12\n> put ./hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 131008\n-rw-r--r--. 1 vagrant vagrant 85738976 10\u6708  9 17:41 hoge.dat\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 524224\n-rw-r--r--. 1 vagrant vagrant 515505800 10\u6708  9 17:41 hoge.dat\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:41 hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3078\u9069\u5f53\u306a\u51fa\u529b\u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3082\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001 rm \u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\u30aa\u30d7\u30b7\u30e7\u30f3 lock_upload_files \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c YES \u306a\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u306f write \u30ed\u30c3\u30af\u3055\u308c\u308b\u69d8\u3067\u3059\u3002\n\u3056\u3063\u3068\u8a2d\u5b9a\u5024\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u9650\u308a\u3067\u306f\u3001Atomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\nManpage of VSFTPD.CONF\n\n\nProFTPD\n\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n[vagrant@pro-ftpd]$ sudo yum install epel-release\n[vagrant@pro-ftpd]$ sudo yum install proftpd\n[vagrant@pro-ftpd]$ sudo systemctl start proftpd\n[vagrant@pro-ftpd]$ sudo systemctl enable proftpd\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n% ftp vagrant@192.168.33.11\n> put ./hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 524224\n-rw-r--r--. 1 vagrant vagrant 290361320 10\u6708  9 17:54 hoge.dat\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 1048512\n-rw-r--r--. 1 vagrant vagrant 586870048 10\u6708  9 17:54 hoge.dat\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:55 hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3078\u9069\u5f53\u306a\u51fa\u529b\u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3082\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001 rm \u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\u3056\u3063\u3068\u8a2d\u5b9a\u5024\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u9650\u308a\u3067\u306f\u3001Atomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\nList of Directives\n\n\nPure-FTPd\n\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n$ sudo yum install epel-release\n$ sudo yum install pure-ftpd pure-ftpd-selinux\n$ sudo systemctl start pure-ftpd\n$ sudo systemctl enable pure-ftpd\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n% ftp vagrant@192.168.33.10\n> put ./hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 262080\n-rw-r--r--. 1 vagrant vagrant 204178848 10\u6708  9 17:59 hoge.dat\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1048512\n-rw-r--r--. 1 vagrant vagrant 611263808 10\u6708  9 17:59 hoge.dat\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:59 hoge.dat\n\nAtomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u69d8\u306a\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u518d\u5ea6\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ sudo sed -i.orig -e 's/# NoTruncate/NoTruncate/' /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ diff -u /etc/pure-ftpd/pure-ftpd.conf.orig /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n[vagrant@pure-ftpd ~]$ rm ~/hoge.dat\n\n\u6539\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n% ftp vagrant@192.168.33.10\n> put ./hoge.dat\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u3066\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u307e\u3057\u305f\u3002\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 0\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 18:19 hoge.dat\n\nPure-FTPd \u3067\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u69d8\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\nPure-FTPd \u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u51e6\u7406\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u4efb\u610f\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3055\u305b\u308b\u305f\u3081\u306e\u8a2d\u5b9a CallUploadScript \u3067\u3059\u3002\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001 CallUploadScript \u3092 yes \u306b\u3057\u305f\u4e0a\u3067 FTPd \u3067\u3042\u308b pure-ftpd \u3068\u306f\u5225\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u3042\u308b pure-uploadscript \u3068\u547c\u3070\u308c\u308b\u30c7\u30fc\u30e2\u30f3\u3092\u7a3c\u50cd\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\npure-uploadscript \u30c7\u30fc\u30e2\u30f3\u306f\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3055\u308c\u305f\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u7b2c1\u5f15\u6570\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u4e0e\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u74b0\u5883\u5909\u6570\u3082\u4f7f\u3048\u308b\u69d8\u306b\u3057\u307e\u3059\u3002\n\nUPLOAD_SIZE  : the size of the file, in bytes.\nUPLOAD_PERMS : the permissions, as an octal value.\nUPLOAD_UID   : the uid of the owner.\nUPLOAD_GID   : the group the file belongs to.\nUPLOAD_USER  : the name of the owner.\nUPLOAD_GROUP : the group name the file belongs to.\nUPLOAD_VUSER : the full user name, or the virtual user name. (127 chars max)\n\npure-uploadscript \u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f man pure-uploadscript \u3084 download.pureftpd.org/pub/pure-ftpd/doc/README \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u5f8c\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u52d5\u304f\u4e8b\u306e\u78ba\u8a8d\u3060\u3051\u3057\u305f\u3044\u306e\u3067\u3001\u5165\u529b\u3092\u30d7\u30ea\u30f3\u30c8\u3059\u308b\u3060\u3051\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u3057\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ cat <<\\SCRIPT > /home/vagrant/pure-uploadscript.sh\n#!/bin/sh\n\ncat <<EOF >> /home/vagrant/pure-uploadscript.log\n\\$1 = $1\nUPLOAD_SIZE = $UPLOAD_SIZE\nUPLOAD_PERMS = $UPLOAD_PERMS\nUPLOAD_UID = $UPLOAD_UID\nUPLOAD_GID = $UPLOAD_GID\nUPLOAD_USER = $UPLOAD_USER\nUPLOAD_GROUP = $UPLOAD_GROUP\nUPLOAD_VUSER = $UPLOAD_VUSER\nEOF\nSCRIPT\n[vagrant@pure-ftpd ~]$ chmod 0755 /home/vagrant/pure-uploadscript.sh\n\n\npure-uploadscript\npure-uploadscript \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u5b9f\u884c\u306b\u306f root \u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002\n[vagrant@pure-ftpd]$ sudo pure-uploadscript -r /home/vagrant/pure-uploadscript.sh\n\n\n\u88dc\u8db3\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u304b\u308c\u3066\u3044\u305f\u4ee5\u4e0b\u306e\u6587\u3092\u3001\u300c\u5148\u306b pure-ftpd \u3092\u8d77\u52d5\u3057\u3066\u3001\u305d\u306e\u5f8c\u3067 pure-uploadscript \u3092\u52d5\u304b\u3055\u306a\u3044\u3068\u3060\u3081\u3088\u3002\u300d\u3068\u8aad\u3093\u3067\u305d\u306e\u9806\u5e8f\u3067\u8a66\u307f\u305f\u306e\u3067\u3059\u304c\u3001 systemctl start pure-ftpd \u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u3066\u3057\u307e\u3044\u307e\u3044\u305f\u3002\n\nYOU MUST START PURE-FTPD FIRST and THEN START PURE-UPLOADSCRIPT. THE REVERSE ORDER WON'T WORK.\n\n\u82f1\u8a9e\u304c\u8aad\u3081\u306a\u3044\u306e\u3067\u3001\u4e0a\u624b\u304f\u3044\u3063\u305f\u9006\u9806\u306e\u65b9\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\npure-ftpd\n\u8a2d\u5b9a CallUploadScript \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ sudo sed -i.notruncate -e 's/#CallUploadScript/CallUploadScript/' /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n[vagrant@pure-ftpd ~]$ ls -l /var/run/pure-*\n\npure-uploadscript \u3092\u5229\u7528\u3059\u308b\u969b\u306f CustomerProof \u3092 yes \u3068\u3057\u3066\u304a\u304f\u4e8b\u304c\u5f37\u304f\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059(\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f)\u3002\nCustomerProof \u3092\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u306b\u3088\u308b\u4e0d\u7528\u610f\u306a(\u8aa4\u3063\u305f) chmod \u306e\u5b9f\u884c\u3092\u9632\u304e\u307e\u3059\u3002\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n% ftp vagrant@192.168.33.10\n> put Vagrantfile\n\n[vagrant@pure-ftpd]$ cat pure-uploadscript.log\n$1 = /home/vagrant/Vagrantfile\nUPLOAD_SIZE = 541\nUPLOAD_PERMS = 644\nUPLOAD_UID = 1000\nUPLOAD_GID = 1000\nUPLOAD_USER = vagrant\nUPLOAD_GROUP = vagrant\nUPLOAD_VUSER = vagrant\n\n\nPureFTPd \u3067\u30d0\u30fc\u30c1\u30e3\u30eb\u30e6\u30fc\u30b6\nPostgreSQL \u3092\u4f7f\u3063\u3066 FTP \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\ndownload.pureftpd.org/pub/pure-ftpd/doc/README.PGSQL\n\n\nPostgreSQL \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n[vagrant@pure-ftpd]$ sudo yum install postgresql postgresql-server\n[vagrant@pure-ftpd]$ sudo postgresql-setup initdb\n[vagrant@pure-ftpd]$ sudo systemctl start postgresql\n[vagrant@pure-ftpd]$ sudo systemctl enable postgresql\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n=# CREATE DATABASE pureftpd;\n\n\n\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n=# \\c pureftpd;\n=# CREATE TABLE \"users\" (\n(#   \"User\" TEXT NOT NULL,\n(#   \"Password\" TEXT NOT NULL,\n(#   \"Uid\" INTEGER NOT NULL default '-1',\n(#   \"Gid\" INTEGER NOT NULL default '-1',\n(#   \"Dir\" TEXT NOT NULL,\n(#   PRIMARY KEY (\"User\")\n(# ) WITHOUT OIDS;\n\n\u3064\u3044\u3067\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n=# INSERT INTO users VALUES ('user', 'password', 1000, 1000, '/home/vagrant/user');\n\n\n\u63a5\u7d9a\u30e6\u30fc\u30b6\n=# CREATE USER pureftpd PASSWORD 'password';\n=# GRANT SELECT ON users TO pureftpd;\n\n\n\u63a5\u7d9a\u8a2d\u5b9a\nPostgreSQL \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u30ed\u30fc\u30ab\u30eb\u63a5\u7d9a\u304c\u5236\u9650\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u4efb\u610f\u306e\u30e6\u30fc\u30b6/\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u63a5\u7d9a\u3067\u304d\u308b\u69d8\u306b\u3057\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ sudo cp /var/lib/pgsql/data/pg_hba.conf /var/lib/pgsql/data/pg_hba.conf.orig\n[vagrant@pure-ftpd ~]$ sudo vi /var/lib/pgsql/data/pg_hba.conf\n[vagrant@pure-ftpd ~]$ sudo diff -u /var/lib/pgsql/data/pg_hba.conf.orig /var/lib/pgsql/data/pg_hba.conf\n--- /var/lib/pgsql/data/pg_hba.conf.orig        2015-10-10 08:43:26.851201925 +0000\n+++ /var/lib/pgsql/data/pg_hba.conf     2015-10-10 08:46:53.410201925 +0000\n@@ -77,6 +77,7 @@\n # TYPE  DATABASE        USER            ADDRESS                 METHOD\n\n # \"local\" is for Unix domain socket connections only\n+local pureftpd pureftpd password\n local   all             all                                     peer\n # IPv4 local connections:\n host    all             all             127.0.0.1/32            ident\n[vagrant@pure-ftpd ~]$ sudo systemctl reload postgresql\n[vagrant@pure-ftpd ~]$ psql -U pureftpd -d pureftpd\n\u30e6\u30fc\u30b6 pureftpd \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (9.2.13)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npureftpd=> SELECT * FROM users;\n User | Password | Uid | Gid | Dir\n------+----------+-----+-----+-----\n(0 \u884c)\n\n\u3053\u308c\u3060\u3068\u3001 -h localhost -p 5432 \u3092\u4ed8\u3051\u305f\u3068\u304d\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067\u3082\u3046\u4e00\u3064\u8a2d\u5b9a\u3092\u52a0\u3048\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ sudo cp /var/lib/pgsql/data/pg_hba.conf /var/lib/pgsql/data/pg_hba.conf.local-pureftpd\n[vagrant@pure-ftpd ~]$ sudo vi /var/lib/pgsql/data/pg_hba.conf\n[vagrant@pure-ftpd ~]$ sudo diff -u /var/lib/pgsql/data/pg_hba.conf.local-pureftpd /var/lib/pgsql/data/pg_hba.conf\n--- /var/lib/pgsql/data/pg_hba.conf.local-pureftpd      2015-10-10 08:49:27.841201925 +0000\n+++ /var/lib/pgsql/data/pg_hba.conf     2015-10-10 08:52:27.383201925 +0000\n@@ -80,8 +80,10 @@\n local pureftpd pureftpd password\n local   all             all                                     peer\n # IPv4 local connections:\n+host    pureftpd        pureftpd        127.0.0.1/32            password\n host    all             all             127.0.0.1/32            ident\n # IPv6 local connections:\n+host    pureftpd        pureftpd        ::1/128                 password\n host    all             all             ::1/128                 ident\n # Allow replication connections from localhost, by a user with the\n # replication privilege.\n[vagrant@pure-ftpd ~]$ sudo systemctl reload postgresql\n[vagrant@pure-ftpd ~]$ psql -U pureftpd -d pureftpd -h localhost -p 5432\n\u30e6\u30fc\u30b6 pureftpd \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (9.2.13)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npureftpd=>\n\n\n\u8a2d\u5b9a\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b PostgreSQL \u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n[vagrant@pure-ftpd ~]$ grep '^PGSQL' /etc/pure-ftpd/pureftpd-pgsql.conf\nPGSQLServer     localhost\nPGSQLPort       5432\nPGSQLUser       postgres\nPGSQLPassword   rootpw\nPGSQLDatabase   pureftpd\nPGSQLCrypt      cleartext\nPGSQLGetPW      SELECT Password FROM users WHERE User='\\L'\nPGSQLGetUID     SELECT Uid FROM users WHERE User='\\L'\nPGSQLGetGID     SELECT Gid FROM users WHERE User='\\L'\nPGSQLGetDir     SELECT Dir FROM users WHERE User='\\L'\n\n\u3053\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068 pure-ftpd \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306f\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n[vagrant@pure-ftpd ~]$ grep 'PG' /etc/pure-ftpd/pure-ftpd.conf\n# Postgres configuration file (see README.PGSQL)\n# PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u306b\u3042\u308f\u305b\u3066\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u53cd\u6620\u3055\u305b\u307e\u3057\u3087\u3046\u3002\n[vagrant@pure-ftpd ~]$ sudo cp /etc/pure-ftpd/pureftpd-pgsql.conf /etc/pure-ftpd/pureftpd-pgsql.conf.orig\n[vagrant@pure-ftpd ~]$ sudo vi /etc/pure-ftpd/pureftpd-pgsql.conf\n[vagrant@pure-ftpd ~]$ sudo diff /etc/pure-ftpd/pureftpd-pgsql.conf.orig /etc/pure-ftpd/pureftpd-pgsql.conf\n19c19\n< PGSQLUser       postgres\n---\n> PGSQLUser       pureftpd\n22c22\n< PGSQLPassword   rootpw\n---\n> PGSQLPassword   password\n46c46\n< PGSQLGetPW      SELECT Password FROM users WHERE User='\\L'\n---\n> PGSQLGetPW      SELECT \"Password\" FROM users WHERE \"User\"='\\L'\n51c51\n< PGSQLGetUID     SELECT Uid FROM users WHERE User='\\L'\n---\n> PGSQLGetUID     SELECT \"Uid\" FROM users WHERE \"User\"='\\L'\n56c56\n< #PGSQLDefaultUID 1000\n---\n> PGSQLDefaultUID 1000\n61c61\n< PGSQLGetGID     SELECT Gid FROM users WHERE User='\\L'\n---\n> PGSQLGetGID     SELECT \"Gid\" FROM users WHERE \"User\"='\\L'\n66c66\n< #PGSQLDefaultGID 1000\n---\n> PGSQLDefaultGID 1000\n71c71\n< PGSQLGetDir     SELECT Dir FROM users WHERE User='\\L'\n---\n> PGSQLGetDir     SELECT \"Dir\" FROM users WHERE \"User\"='\\L'\n\nPostgreSQL \u8a8d\u8a3c\u3092\u4f7f\u3048\u308b\u69d8\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n[vagrant@pure-ftpd ~]$ sudo cp /etc/pure-ftpd/pure-ftpd.conf /etc/pure-ftpd/pure-ftpd.conf.uploadscript\n[vagrant@pure-ftpd ~]$ sudo vi /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo diff /etc/pure-ftpd/pure-ftpd.conf.uploadscript /etc/pure-ftpd/pure-ftpd.conf\n121c121\n< # PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n---\n> PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n137c137\n< PAMAuthentication             yes\n---\n> PAMAuthentication             no\n143c143\n< # UnixAuthentication            yes\n---\n> UnixAuthentication            no\n343c343\n< #CreateHomeDir               yes\n---\n> CreateHomeDir               yes\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n\nPostgreSQL \u3068\u76f4\u63a5\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3060\u3051\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u69d8\u306b\u3059\u308b\u305f\u3081\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u4f5c\u6210\u3059\u308b\u69d8\u306b CreateHomeDir \u3092 yes \u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u30ed\u30b0\u30a4\u30f3\n\u30ed\u30b0\u30a4\u30f3\u306b\u6210\u529f\u3057\u3001\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n% ftp user@192.168.33.10\nConnected to 192.168.33.10.\n220---------- Welcome to Pure-FTPd [privsep] [TLS] ----------\n220-You are user number 1 of 50 allowed.\n220-Local time is now 09:46. Server port: 21.\n220-IPv6 connections are also welcome on this server.\n220 You will be disconnected after 15 minutes of inactivity.\n331 User user OK. Password required\nPassword:\n230 OK. Current restricted directory is /\nRemote system type is UNIX.\nUsing binary mode to transfer files.\n\n\n\u307e\u3068\u3081\nPure-FTPd \u306e\u7279\u5fb4\u7684\u306a\u3060\u306a\u3068\u611f\u3058\u305f\u6a5f\u80fd\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\u76f8\u5909\u308f\u3089\u305a\u306e\u30a2\u30b5\u30c1\u30e3\u30d7(\u6d45\u702c\u3067\u30c1\u30e3\u30d7\u30c1\u30e3\u30d7)\u30e1\u30bd\u30c3\u30c9\u306a\u306e\u3067\u3001\u672c\u5f53\u306b\u5b8c\u5168\u306a\u30a2\u30c8\u30df\u30c3\u30af\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u306a\u306e\u304b\u3001\u5b9f\u306f vsftpd \u3084 ProFTPD \u3067\u3082\u53ef\u80fd\u306a\u306e\u3067\u306f\u306a\u3044\u304b\u3001\u306a\u3069\u306f\u6df1\u6398\u308a\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002\n\u307e\u305f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u51e6\u7406\u306b\u3064\u3044\u3066\u3082\u3001\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u904b\u7528\u3092\u5b89\u5b9a\u3055\u305b\u308b\u305f\u3081\u306e\u5de5\u592b\u306a\u3069\u3001\u691c\u8a3c\u304c\u8db3\u308a\u3066\u3044\u307e\u305b\u3093\u3002\nPostgreSQL \u8a8d\u8a3c\u306b\u3064\u3044\u3066\u3082\u3001UID, GID, \u30d1\u30b9\u30ef\u30fc\u30c9\u6697\u53f7\u5316\u306a\u3069\u306f\u9069\u5f53\u3067\u3059\u3002\n\u8272\u3005\u3068\u3084\u308a\u6b8b\u3057\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u304b\u306a\u308a\u826f\u3044\u611f\u89e6\u3092\u3064\u304b\u3080\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u304b\u306a\u308a\u6e80\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\u5b9f\u306f\u4ed6\u3068\u6bd4\u3079\u305f Pure-FTPd \u306e\u81f4\u547d\u7684\u306a\u30c7\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u500b\u4eba\u7684(\u76f4\u8fd1\u3067\u898b\u3048\u3066\u3044\u308b\u7528\u9014\u7684)\u306b\u306f\u304b\u306a\u308a\u306e\u9ad8\u8a55\u4fa1\u3067\u3059\u3002\nTL;DR\n----\n\n- Pure-FTPd \u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u7b2c1\u306b\u8003\u3048\u3066\u3044\u308b\u3068\u306e\u3053\u3068\n- Pure-FTPd \u3067\u306f\u30a2\u30c8\u30df\u30c3\u30af\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u308b\n    - vsftpd, ProFTPD \u3067\u5b9f\u73fe\u53ef\u80fd\u304b\u628a\u63e1\u3067\u304d\u3066\u3044\u306a\u3044(\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u306f\u4e0d\u53ef)\n- \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6210\u529f\u6642\u306b\u5f8c\u51e6\u7406\u3092\u5b9f\u884c\u3055\u305b\u308b\u4e8b\u304c\u3067\u304d\u308b\n- MySQL \u3084 PostgreSQL \u3092\u4f7f\u3063\u3066\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u7ba1\u7406\u3059\u308b\u4e8b\u304c\u3067\u304d\u308b\n    - chroot \u5148\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u81ea\u52d5\u3067\u4f5c\u308b\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u30a2\u30ab\u30a6\u30f3\u30c8\u8ffd\u52a0\u4f5c\u696d\u306f\u30ec\u30b3\u30fc\u30c9\u4f5c\u6210\u3060\u3051\u3067\u826f\u3044\n\n\nPure-FTPd \u3068\u306f\n----\n\nSecurity First \u304c\u5408\u3044\u8a00\u8449(?)\u306a FTPd \u3067\u3059\u3002\n\n> Pure-FTPd is a free (BSD), secure, production-quality and standard-conformant FTP server. It doesn't provide useless bells and whistles, but focuses on efficiency and ease of use. It provides simple answers to common needs, plus unique useful features for personal users as well as hosting providers.\n> [Pure-FTPd - About](https://www.pureftpd.org/project/pure-ftpd)\n\nCVE \u3078\u306e\u5831\u544a\u6570\u3082\u6700\u5c0f\u3060\u3068\u304b\u3002\n\n\n\u4f55\u304c\u3067\u304d\u308b\u306e\u304b\n----\n\n\u6a5f\u80fd\u30ea\u30b9\u30c8\u3092\u3056\u3063\u3068\u898b\u305f\u611f\u3058\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001FTPd \u306b\u671b\u307e\u308c\u308b\u3053\u3068\u306f\u5927\u62b5\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002FTPd \u306e\u904b\u7528\u7d4c\u9a13\u304c\u8c4a\u5bcc\u306a\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u2026\u3002\n\n\u4ee5\u4e0b\u3001\u6a5f\u80fd\u30ea\u30b9\u30c8([Pure-FTPd - About](https://www.pureftpd.org/project/pure-ftpd))\u304b\u3089\u4e00\u90e8\u3092\u629c\u7c8b\u3057\u307e\u3057\u305f\u3002\n\n- Linux \u30ab\u30a6\u30f3\u30c8\u3092 FTP \u30a2\u30ab\u30a6\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b(\u6307\u5b9a UID \u672a\u6e80\u306e\u5229\u7528\u3092\u7981\u6b62\u3068\u3044\u3046\u8a2d\u5b9a\u3082\u53ef)\n- \u8a8d\u8a3c\u3092 PAM \u7d4c\u7531\u3067\u884c\u3048\u308b\n- \u30c7\u30d5\u30a9\u30eb\u30c8\u3067 chroot \u3059\u308b\n- FTP \u30a2\u30ab\u30a6\u30f3\u30c8\u306f Linux \u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u306a\u3044\u3001\u72ec\u7acb\u3057\u305f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3067\u7ba1\u7406\u3055\u308c\u305f\u3082\u306e\u306b\u3067\u304d\u308b(\u30d0\u30fc\u30c1\u30e3\u30eb\u30e6\u30fc\u30b6)\n- LDAP \u30b5\u30dd\u30fc\u30c8\n- \u8907\u6570\u306e\u8a8d\u8a3c\u65b9\u5f0f\u3092\u597d\u307f\u306e\u9806\u5e8f\u3067\u30c1\u30a7\u30a4\u30f3\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n- quota \u30b5\u30dd\u30fc\u30c8\n- \u5e2f\u57df\u5236\u9650\u30b5\u30dd\u30fc\u30c8\n- \u30e6\u30fc\u30b6\u5358\u4f4d\u3067\u306e\u7d30\u304b\u306a\u5236\u9650\n- \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u6210\u529f\u5f8c\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n- \u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092 on-demand \u306b\u4f5c\u6210\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n- \u540c\u4e00\u30db\u30b9\u30c8\u3067\u8907\u6570\u306e\u30d0\u30fc\u30c1\u30e3\u30eb FTP \u30b5\u30fc\u30d0\u3092\u904b\u7528\u3067\u304d\u308b\n- chroot \u5916\u3078\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u30d5\u30a9\u30ed\u30fc\u3059\u308b\n- \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f atomic\n\n\nCentOS7 \u306e VM \u3092\u6e96\u5099\n----\n\n\u3044\u304f\u3064\u304b\u306e\u52d5\u4f5c\u691c\u8a3c\u306e\u305f\u3081\u306b CentOS 7 \u306e VM \u3092\u7528\u610f\u3057\u307e\u3059\u3002\nCentOS \u3067\u3042\u308b\u5fc5\u8981\u6027\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u203b \u4ee5\u5f8c\u306e\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u8a18\u9332\u306b\u3066 SELinux \u306b\u95a2\u3059\u308b\u8a71\u306f\u66d6\u6627\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3059(Permissive \u3060\u3063\u305f\u3001\u3068\u3060\u3051\u8a00\u3063\u3066\u304a\u304d\u307e\u3057\u3087\u3046)\u3002\n\n### Vagrantfile\n\n```ruby\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nVagrant.configure(2) do |config|\n  # config.ssh.insert_key = false\n  config.vm.box = \"bento/centos-7.1\"\n\n  config.vm.define 'pure-ftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.10\"\n    c.vm.hostname = 'pure-ftpd'\n  end\n\n  config.vm.define 'pro-ftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.11\"\n    c.vm.hostname = 'pro-ftpd'\n  end\n\n  config.vm.define 'vsftpd' do |c|\n    c.vm.network \"private_network\", ip: \"192.168.33.12\"\n    c.vm.hostname = 'vsftpd'\n  end\nend\n```\n\n\nAtomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\uff1f\n----\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u7528\u306b\u5927\u304d\u3081\u306e Sparse file \u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\n% dd if=/dev/zero of=./hoge.dat seek=1000 bs=1048576 count=1\n```\n\n### vsftpd \u306f\uff1f\n\nvsftpd \u3092\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\n[vagrant@vsftpd]$ sudo yum install vsftpd\n[vagrant@vsftpd]$ sudo systemctl start vsftpd\n[vagrant@vsftpd]$ sudo systemctl enable vsftpd\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```shell-session\n% ftp vagrant@192.168.33.12\n> put ./hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 131008\n-rw-r--r--. 1 vagrant vagrant 85738976 10\u6708  9 17:41 hoge.dat\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 524224\n-rw-r--r--. 1 vagrant vagrant 515505800 10\u6708  9 17:41 hoge.dat\n[vagrant@vsftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:41 hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3078\u9069\u5f53\u306a\u51fa\u529b\u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3082\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001 `rm` \u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\u30aa\u30d7\u30b7\u30e7\u30f3 `lock_upload_files` \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u304c `YES` \u306a\u306e\u3067\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u306f write \u30ed\u30c3\u30af\u3055\u308c\u308b\u69d8\u3067\u3059\u3002\n\u3056\u3063\u3068\u8a2d\u5b9a\u5024\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u9650\u308a\u3067\u306f\u3001Atomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\n- [Manpage of VSFTPD.CONF](https://security.appspot.com/vsftpd/vsftpd_conf.html)\n\n### ProFTPD\n\n\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n\n```\n[vagrant@pro-ftpd]$ sudo yum install epel-release\n[vagrant@pro-ftpd]$ sudo yum install proftpd\n[vagrant@pro-ftpd]$ sudo systemctl start proftpd\n[vagrant@pro-ftpd]$ sudo systemctl enable proftpd\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```shell-session\n% ftp vagrant@192.168.33.11\n> put ./hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 524224\n-rw-r--r--. 1 vagrant vagrant 290361320 10\u6708  9 17:54 hoge.dat\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 1048512\n-rw-r--r--. 1 vagrant vagrant 586870048 10\u6708  9 17:54 hoge.dat\n[vagrant@pro-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:55 hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3078\u9069\u5f53\u306a\u51fa\u529b\u3092\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3057\u3066\u3082\u4e0a\u66f8\u304d\u3055\u308c\u306a\u3044\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\u307e\u305f\u3001 `rm` \u30b3\u30de\u30f3\u30c9\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3067\u304d\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\u3056\u3063\u3068\u8a2d\u5b9a\u5024\u306e\u4e00\u89a7\u3092\u78ba\u8a8d\u3057\u305f\u9650\u308a\u3067\u306f\u3001Atomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u306f\u5bfe\u5fdc\u3057\u3066\u3044\u306a\u3044\u69d8\u306b\u898b\u3048\u307e\u3059\u3002\n\n- [List of Directives](http://www.proftpd.org/docs/directives/linked/by-name.html)\n\n### Pure-FTPd\n\n\u6700\u5c0f\u306e\u624b\u9593\u3067\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\n$ sudo yum install epel-release\n$ sudo yum install pure-ftpd pure-ftpd-selinux\n$ sudo systemctl start pure-ftpd\n$ sudo systemctl enable pure-ftpd\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```shell-session\n% ftp vagrant@192.168.33.10\n> put ./hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u4e8b\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 262080\n-rw-r--r--. 1 vagrant vagrant 204178848 10\u6708  9 17:59 hoge.dat\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1048512\n-rw-r--r--. 1 vagrant vagrant 611263808 10\u6708  9 17:59 hoge.dat\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 17:59 hoge.dat\n```\n\nAtomic \u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306f\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u69d8\u306a\u306e\u3067\u3001\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u3066\u518d\u5ea6\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ sudo sed -i.orig -e 's/# NoTruncate/NoTruncate/' /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ diff -u /etc/pure-ftpd/pure-ftpd.conf.orig /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n[vagrant@pure-ftpd ~]$ rm ~/hoge.dat\n```\n\n\u6539\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```shell-session\n% ftp vagrant@192.168.33.10\n> put ./hoge.dat\n```\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u5b8c\u4e86\u3057\u3066\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u307e\u3057\u305f\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 0\n[vagrant@pure-ftpd ~]$ ll\n\u5408\u8a08 1025024\n-rw-r--r--. 1 vagrant vagrant 1049624576 10\u6708  9 18:19 hoge.dat\n```\n\nPure-FTPd \u3067\u3082\u30c7\u30d5\u30a9\u30eb\u30c8\u306f\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u9014\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u3089\u308c\u308b\u69d8\u306b\u306a\u3063\u3066\u3044\u308b\u4e8b\u304c\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\n\nPure-FTPd \u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u51e6\u7406\n----\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u4efb\u610f\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3055\u305b\u308b\u305f\u3081\u306e\u8a2d\u5b9a `CallUploadScript` \u3067\u3059\u3002\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306e\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b\u305f\u3081\u306b\u306f\u3001 `CallUploadScript` \u3092 `yes` \u306b\u3057\u305f\u4e0a\u3067 FTPd \u3067\u3042\u308b `pure-ftpd` \u3068\u306f\u5225\u306e\u30d7\u30ed\u30bb\u30b9\u3067\u3042\u308b `pure-uploadscript` \u3068\u547c\u3070\u308c\u308b\u30c7\u30fc\u30e2\u30f3\u3092\u7a3c\u50cd\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n`pure-uploadscript` \u30c7\u30fc\u30e2\u30f3\u306f\u3001\u8d77\u52d5\u6642\u306b\u6307\u5b9a\u3055\u308c\u305f\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u306e\u7b2c1\u5f15\u6570\u306b\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u30d5\u30a1\u30a4\u30eb\u306e\u30d1\u30b9\u3092\u4e0e\u3048\u307e\u3059\u3002\n\u307e\u305f\u3001\u4ee5\u4e0b\u306e\u69d8\u306a\u74b0\u5883\u5909\u6570\u3082\u4f7f\u3048\u308b\u69d8\u306b\u3057\u307e\u3059\u3002\n\n> UPLOAD_SIZE  : the size of the file, in bytes.\n> UPLOAD_PERMS : the permissions, as an octal value.\n> UPLOAD_UID   : the uid of the owner.\n> UPLOAD_GID   : the group the file belongs to.\n> UPLOAD_USER  : the name of the owner.\n> UPLOAD_GROUP : the group name the file belongs to.\n> UPLOAD_VUSER : the full user name, or the virtual user name. (127 chars max)\n\n`pure-uploadscript` \u306e\u8a73\u7d30\u306b\u3064\u3044\u3066\u306f `man pure-uploadscript` \u3084 [download.pureftpd.org/pub/pure-ftpd/doc/README](http://download.pureftpd.org/pub/pure-ftpd/doc/README) \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u5f8c\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u3001\u52d5\u304f\u4e8b\u306e\u78ba\u8a8d\u3060\u3051\u3057\u305f\u3044\u306e\u3067\u3001\u5165\u529b\u3092\u30d7\u30ea\u30f3\u30c8\u3059\u308b\u3060\u3051\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u3057\u307e\u3059\u3002\n\n```sh\n[vagrant@pure-ftpd ~]$ cat <<\\SCRIPT > /home/vagrant/pure-uploadscript.sh\n#!/bin/sh\n\ncat <<EOF >> /home/vagrant/pure-uploadscript.log\n\\$1 = $1\nUPLOAD_SIZE = $UPLOAD_SIZE\nUPLOAD_PERMS = $UPLOAD_PERMS\nUPLOAD_UID = $UPLOAD_UID\nUPLOAD_GID = $UPLOAD_GID\nUPLOAD_USER = $UPLOAD_USER\nUPLOAD_GROUP = $UPLOAD_GROUP\nUPLOAD_VUSER = $UPLOAD_VUSER\nEOF\nSCRIPT\n[vagrant@pure-ftpd ~]$ chmod 0755 /home/vagrant/pure-uploadscript.sh\n```\n\n### pure-uploadscript\n\n`pure-uploadscript` \u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u5b9f\u884c\u306b\u306f root \u6a29\u9650\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```\n[vagrant@pure-ftpd]$ sudo pure-uploadscript -r /home/vagrant/pure-uploadscript.sh\n```\n\n#### \u88dc\u8db3\n\n\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u66f8\u304b\u308c\u3066\u3044\u305f\u4ee5\u4e0b\u306e\u6587\u3092\u3001\u300c\u5148\u306b `pure-ftpd` \u3092\u8d77\u52d5\u3057\u3066\u3001\u305d\u306e\u5f8c\u3067 `pure-uploadscript` \u3092\u52d5\u304b\u3055\u306a\u3044\u3068\u3060\u3081\u3088\u3002\u300d\u3068\u8aad\u3093\u3067\u305d\u306e\u9806\u5e8f\u3067\u8a66\u307f\u305f\u306e\u3067\u3059\u304c\u3001 `systemctl start pure-ftpd` \u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u3066\u3057\u307e\u3044\u307e\u3044\u305f\u3002\n\n> YOU MUST START PURE-FTPD _FIRST_ and _THEN_ START PURE-UPLOADSCRIPT. THE REVERSE ORDER WON'T WORK.\n\n\u82f1\u8a9e\u304c\u8aad\u3081\u306a\u3044\u306e\u3067\u3001\u4e0a\u624b\u304f\u3044\u3063\u305f\u9006\u9806\u306e\u65b9\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\n\n### pure-ftpd\n\n\u8a2d\u5b9a `CallUploadScript` \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n```\n[vagrant@pure-ftpd ~]$ sudo sed -i.notruncate -e 's/#CallUploadScript/CallUploadScript/' /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n[vagrant@pure-ftpd ~]$ ls -l /var/run/pure-*\n```\n\n`pure-uploadscript` \u3092\u5229\u7528\u3059\u308b\u969b\u306f `CustomerProof` \u3092 `yes` \u3068\u3057\u3066\u304a\u304f\u4e8b\u304c\u5f37\u304f\u63a8\u5968\u3055\u308c\u3066\u3044\u307e\u3059(\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3067\u6709\u52b9\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f)\u3002\n`CustomerProof` \u3092\u6709\u52b9\u306b\u3059\u308b\u3053\u3068\u3067\u3001\u30e6\u30fc\u30b6\u306b\u3088\u308b\u4e0d\u7528\u610f\u306a(\u8aa4\u3063\u305f) `chmod` \u306e\u5b9f\u884c\u3092\u9632\u304e\u307e\u3059\u3002\n\n### \u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\n```\n% ftp vagrant@192.168.33.10\n> put Vagrantfile\n```\n\n```shell-session\n[vagrant@pure-ftpd]$ cat pure-uploadscript.log\n$1 = /home/vagrant/Vagrantfile\nUPLOAD_SIZE = 541\nUPLOAD_PERMS = 644\nUPLOAD_UID = 1000\nUPLOAD_GID = 1000\nUPLOAD_USER = vagrant\nUPLOAD_GROUP = vagrant\nUPLOAD_VUSER = vagrant\n```\n\n\nPureFTPd \u3067\u30d0\u30fc\u30c1\u30e3\u30eb\u30e6\u30fc\u30b6\n----\n\nPostgreSQL \u3092\u4f7f\u3063\u3066 FTP \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\n- [download.pureftpd.org/pub/pure-ftpd/doc/README.PGSQL](http://download.pureftpd.org/pub/pure-ftpd/doc/README.PGSQL)\n\n### PostgreSQL \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```shell-session\n[vagrant@pure-ftpd]$ sudo yum install postgresql postgresql-server\n[vagrant@pure-ftpd]$ sudo postgresql-setup initdb\n[vagrant@pure-ftpd]$ sudo systemctl start postgresql\n[vagrant@pure-ftpd]$ sudo systemctl enable postgresql\n```\n\n#### \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u4f5c\u6210\n\n```shell-session\n=# CREATE DATABASE pureftpd;\n```\n\n#### \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n```shell-session\n=# \\c pureftpd;\n=# CREATE TABLE \"users\" (\n(#   \"User\" TEXT NOT NULL,\n(#   \"Password\" TEXT NOT NULL,\n(#   \"Uid\" INTEGER NOT NULL default '-1',\n(#   \"Gid\" INTEGER NOT NULL default '-1',\n(#   \"Dir\" TEXT NOT NULL,\n(#   PRIMARY KEY (\"User\")\n(# ) WITHOUT OIDS;\n```\n\n\u3064\u3044\u3067\u306b\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\n=# INSERT INTO users VALUES ('user', 'password', 1000, 1000, '/home/vagrant/user');\n```\n\n#### \u63a5\u7d9a\u30e6\u30fc\u30b6\n\n```shell-session\n=# CREATE USER pureftpd PASSWORD 'password';\n=# GRANT SELECT ON users TO pureftpd;\n```\n\n#### \u63a5\u7d9a\u8a2d\u5b9a\n\nPostgreSQL \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u8a2d\u5b9a\u3067\u30ed\u30fc\u30ab\u30eb\u63a5\u7d9a\u304c\u5236\u9650\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u4efb\u610f\u306e\u30e6\u30fc\u30b6/\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u63a5\u7d9a\u3067\u304d\u308b\u69d8\u306b\u3057\u307e\u3059\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ sudo cp /var/lib/pgsql/data/pg_hba.conf /var/lib/pgsql/data/pg_hba.conf.orig\n[vagrant@pure-ftpd ~]$ sudo vi /var/lib/pgsql/data/pg_hba.conf\n[vagrant@pure-ftpd ~]$ sudo diff -u /var/lib/pgsql/data/pg_hba.conf.orig /var/lib/pgsql/data/pg_hba.conf\n--- /var/lib/pgsql/data/pg_hba.conf.orig        2015-10-10 08:43:26.851201925 +0000\n+++ /var/lib/pgsql/data/pg_hba.conf     2015-10-10 08:46:53.410201925 +0000\n@@ -77,6 +77,7 @@\n # TYPE  DATABASE        USER            ADDRESS                 METHOD\n\n # \"local\" is for Unix domain socket connections only\n+local pureftpd pureftpd password\n local   all             all                                     peer\n # IPv4 local connections:\n host    all             all             127.0.0.1/32            ident\n[vagrant@pure-ftpd ~]$ sudo systemctl reload postgresql\n[vagrant@pure-ftpd ~]$ psql -U pureftpd -d pureftpd\n\u30e6\u30fc\u30b6 pureftpd \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (9.2.13)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npureftpd=> SELECT * FROM users;\n User | Password | Uid | Gid | Dir\n------+----------+-----+-----+-----\n(0 \u884c)\n```\n\n\u3053\u308c\u3060\u3068\u3001 `-h localhost -p 5432` \u3092\u4ed8\u3051\u305f\u3068\u304d\u306b\u63a5\u7d9a\u3067\u304d\u306a\u3044\u306e\u3067\u3082\u3046\u4e00\u3064\u8a2d\u5b9a\u3092\u52a0\u3048\u307e\u3059\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ sudo cp /var/lib/pgsql/data/pg_hba.conf /var/lib/pgsql/data/pg_hba.conf.local-pureftpd\n[vagrant@pure-ftpd ~]$ sudo vi /var/lib/pgsql/data/pg_hba.conf\n[vagrant@pure-ftpd ~]$ sudo diff -u /var/lib/pgsql/data/pg_hba.conf.local-pureftpd /var/lib/pgsql/data/pg_hba.conf\n--- /var/lib/pgsql/data/pg_hba.conf.local-pureftpd      2015-10-10 08:49:27.841201925 +0000\n+++ /var/lib/pgsql/data/pg_hba.conf     2015-10-10 08:52:27.383201925 +0000\n@@ -80,8 +80,10 @@\n local pureftpd pureftpd password\n local   all             all                                     peer\n # IPv4 local connections:\n+host    pureftpd        pureftpd        127.0.0.1/32            password\n host    all             all             127.0.0.1/32            ident\n # IPv6 local connections:\n+host    pureftpd        pureftpd        ::1/128                 password\n host    all             all             ::1/128                 ident\n # Allow replication connections from localhost, by a user with the\n # replication privilege.\n[vagrant@pure-ftpd ~]$ sudo systemctl reload postgresql\n[vagrant@pure-ftpd ~]$ psql -U pureftpd -d pureftpd -h localhost -p 5432\n\u30e6\u30fc\u30b6 pureftpd \u306e\u30d1\u30b9\u30ef\u30fc\u30c9:\npsql (9.2.13)\n\"help\" \u3067\u30d8\u30eb\u30d7\u3092\u8868\u793a\u3057\u307e\u3059.\n\npureftpd=>\n```\n\n### \u8a2d\u5b9a\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b PostgreSQL \u7528\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ grep '^PGSQL' /etc/pure-ftpd/pureftpd-pgsql.conf\nPGSQLServer     localhost\nPGSQLPort       5432\nPGSQLUser       postgres\nPGSQLPassword   rootpw\nPGSQLDatabase   pureftpd\nPGSQLCrypt      cleartext\nPGSQLGetPW      SELECT Password FROM users WHERE User='\\L'\nPGSQLGetUID     SELECT Uid FROM users WHERE User='\\L'\nPGSQLGetGID     SELECT Gid FROM users WHERE User='\\L'\nPGSQLGetDir     SELECT Dir FROM users WHERE User='\\L'\n```\n\n\u3053\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u3068 `pure-ftpd` \u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u304b\u3089\u306f\u8aad\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ grep 'PG' /etc/pure-ftpd/pure-ftpd.conf\n# Postgres configuration file (see README.PGSQL)\n# PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n```\n\n\u4eca\u56de\u306e\u30b1\u30fc\u30b9\u306b\u3042\u308f\u305b\u3066\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u53cd\u6620\u3055\u305b\u307e\u3057\u3087\u3046\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ sudo cp /etc/pure-ftpd/pureftpd-pgsql.conf /etc/pure-ftpd/pureftpd-pgsql.conf.orig\n[vagrant@pure-ftpd ~]$ sudo vi /etc/pure-ftpd/pureftpd-pgsql.conf\n[vagrant@pure-ftpd ~]$ sudo diff /etc/pure-ftpd/pureftpd-pgsql.conf.orig /etc/pure-ftpd/pureftpd-pgsql.conf\n19c19\n< PGSQLUser       postgres\n---\n> PGSQLUser       pureftpd\n22c22\n< PGSQLPassword   rootpw\n---\n> PGSQLPassword   password\n46c46\n< PGSQLGetPW      SELECT Password FROM users WHERE User='\\L'\n---\n> PGSQLGetPW      SELECT \"Password\" FROM users WHERE \"User\"='\\L'\n51c51\n< PGSQLGetUID     SELECT Uid FROM users WHERE User='\\L'\n---\n> PGSQLGetUID     SELECT \"Uid\" FROM users WHERE \"User\"='\\L'\n56c56\n< #PGSQLDefaultUID 1000\n---\n> PGSQLDefaultUID 1000\n61c61\n< PGSQLGetGID     SELECT Gid FROM users WHERE User='\\L'\n---\n> PGSQLGetGID     SELECT \"Gid\" FROM users WHERE \"User\"='\\L'\n66c66\n< #PGSQLDefaultGID 1000\n---\n> PGSQLDefaultGID 1000\n71c71\n< PGSQLGetDir     SELECT Dir FROM users WHERE User='\\L'\n---\n> PGSQLGetDir     SELECT \"Dir\" FROM users WHERE \"User\"='\\L'\n```\n\nPostgreSQL \u8a8d\u8a3c\u3092\u4f7f\u3048\u308b\u69d8\u306b\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```shell-session\n[vagrant@pure-ftpd ~]$ sudo cp /etc/pure-ftpd/pure-ftpd.conf /etc/pure-ftpd/pure-ftpd.conf.uploadscript\n[vagrant@pure-ftpd ~]$ sudo vi /etc/pure-ftpd/pure-ftpd.conf\n[vagrant@pure-ftpd ~]$ sudo diff /etc/pure-ftpd/pure-ftpd.conf.uploadscript /etc/pure-ftpd/pure-ftpd.conf\n121c121\n< # PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n---\n> PGSQLConfigFile               /etc/pure-ftpd/pureftpd-pgsql.conf\n137c137\n< PAMAuthentication             yes\n---\n> PAMAuthentication             no\n143c143\n< # UnixAuthentication            yes\n---\n> UnixAuthentication            no\n343c343\n< #CreateHomeDir               yes\n---\n> CreateHomeDir               yes\n[vagrant@pure-ftpd ~]$ sudo systemctl stop pure-ftpd\n[vagrant@pure-ftpd ~]$ sudo systemctl start pure-ftpd\n```\n\nPostgreSQL \u3068\u76f4\u63a5\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30ec\u30b3\u30fc\u30c9\u633f\u5165\u3060\u3051\u3067\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u69d8\u306b\u3059\u308b\u305f\u3081\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306f\u30ed\u30b0\u30a4\u30f3\u6642\u306b\u4f5c\u6210\u3059\u308b\u69d8\u306b `CreateHomeDir` \u3092 `yes` \u3068\u3057\u3066\u3044\u307e\u3059\u3002\n\n### \u30ed\u30b0\u30a4\u30f3\n\n\u30ed\u30b0\u30a4\u30f3\u306b\u6210\u529f\u3057\u3001\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3082\u81ea\u52d5\u7684\u306b\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n```shell-session\n% ftp user@192.168.33.10\nConnected to 192.168.33.10.\n220---------- Welcome to Pure-FTPd [privsep] [TLS] ----------\n220-You are user number 1 of 50 allowed.\n220-Local time is now 09:46. Server port: 21.\n220-IPv6 connections are also welcome on this server.\n220 You will be disconnected after 15 minutes of inactivity.\n331 User user OK. Password required\nPassword:\n230 OK. Current restricted directory is /\nRemote system type is UNIX.\nUsing binary mode to transfer files.\n```\n\n\n\u307e\u3068\u3081\n----\n\nPure-FTPd \u306e\u7279\u5fb4\u7684\u306a\u3060\u306a\u3068\u611f\u3058\u305f\u6a5f\u80fd\u3092\u8a66\u3057\u307e\u3057\u305f\u3002\n\n\u76f8\u5909\u308f\u3089\u305a\u306e\u30a2\u30b5\u30c1\u30e3\u30d7(\u6d45\u702c\u3067\u30c1\u30e3\u30d7\u30c1\u30e3\u30d7)\u30e1\u30bd\u30c3\u30c9\u306a\u306e\u3067\u3001\u672c\u5f53\u306b\u5b8c\u5168\u306a\u30a2\u30c8\u30df\u30c3\u30af\u306a\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u304c\u53ef\u80fd\u306a\u306e\u304b\u3001\u5b9f\u306f vsftpd \u3084 ProFTPD \u3067\u3082\u53ef\u80fd\u306a\u306e\u3067\u306f\u306a\u3044\u304b\u3001\u306a\u3069\u306f\u6df1\u6398\u308a\u3067\u304d\u3066\u3044\u307e\u305b\u3093\u3002\n\n\u307e\u305f\u3001\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u5f8c\u51e6\u7406\u306b\u3064\u3044\u3066\u3082\u3001\u3053\u308c\u3092\u5229\u7528\u3057\u3066\u904b\u7528\u3092\u5b89\u5b9a\u3055\u305b\u308b\u305f\u3081\u306e\u5de5\u592b\u306a\u3069\u3001\u691c\u8a3c\u304c\u8db3\u308a\u3066\u3044\u307e\u305b\u3093\u3002\n\nPostgreSQL \u8a8d\u8a3c\u306b\u3064\u3044\u3066\u3082\u3001UID, GID, \u30d1\u30b9\u30ef\u30fc\u30c9\u6697\u53f7\u5316\u306a\u3069\u306f\u9069\u5f53\u3067\u3059\u3002\n\n\u8272\u3005\u3068\u3084\u308a\u6b8b\u3057\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u304b\u306a\u308a\u826f\u3044\u611f\u89e6\u3092\u3064\u304b\u3080\u3053\u3068\u304c\u3067\u304d\u305f\u306e\u3067\u304b\u306a\u308a\u6e80\u8db3\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u5b9f\u306f\u4ed6\u3068\u6bd4\u3079\u305f Pure-FTPd \u306e\u81f4\u547d\u7684\u306a\u30c7\u30e1\u30ea\u30c3\u30c8\u304c\u3042\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u500b\u4eba\u7684(\u76f4\u8fd1\u3067\u898b\u3048\u3066\u3044\u308b\u7528\u9014\u7684)\u306b\u306f\u304b\u306a\u308a\u306e\u9ad8\u8a55\u4fa1\u3067\u3059\u3002\n"}