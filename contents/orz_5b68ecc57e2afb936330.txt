{"context": " More than 1 year has passed since last update.\u524d\u56de\u306f\u3053\u3061\u3089 - \u6b21\u56de\u306f\u3053\u3061\u3089\n\n\n\u3053\u308c\u306f\u306a\u306b\n\u300cOpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580\u300d\u306e\u5b9f\u7fd2\u3092SoftLayer\u306e\u7121\u6599\u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u884c\u3046\u8a18\u9332\u3067\u3042\u308b\u3002\n\n\n\u7b2c6\u7ae0 \u30b7\u30f3\u30d7\u30eb\u306a3\u968e\u5c64\u69cb\u9020\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\n\u3053\u306e\u7ae0\u3067\u306fgit\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b3\u5c64\u306eSNS\u30a2\u30d7\u30ea\u3092OpenStack\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3002\n\u7b2c5\u7ae0\u304b\u3089\u7b2c10\u7ae0\u307e\u3067\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u3061\u3089\u3002\u307e\u3068\u3081\u3066git\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10\n\u7b2c6\u7ae0\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u3061\u3089\u3067\u3042\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10/tree/master/06\n\u524d\u56de\u3068\u540c\u69d8\u306b\u7b2c6\u7ae0\u306e\u3059\u3079\u3066\u306e\u30b9\u30c6\u30c3\u30d7\u3092\u307e\u3068\u3081\u3066\u884c\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10/blob/master/06/build_chap06.sh\n\u3055\u3059\u304c\u306b\u52c9\u5f37\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u3082\u30b9\u30c6\u30c3\u30d7\u30fb\u30d0\u30a4\u30fb\u30b9\u30c6\u30c3\u30d7\u3067\u78ba\u8a8d\u3057\u306a\u304c\u3089\u9032\u3081\u308b\u3002\n\n6.1 \u4f5c\u696d\u524d\u306e\u6ce8\u610f\n\u4eca\u56de\u306e\u4f5c\u696d\u306f\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u3067\u884c\u3046\u306e\u3067\u3001\u8e0f\u307f\u53f0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u300csource ooenrc\u300d\u3067\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u3066\u3001\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u3092git\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3001\u3068\u3044\u3046\u6ce8\u610f\u3067\u3042\u308b\u3002\n[root@step-server ~]# cd\n[root@step-server ~]# source openrc\n[root@step-server ~]# git clone https://github.com/josug-book1-materials/chapter05-10.git\n\n\n6.2 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3068\u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n(6)\u306e5.4 \u4f5c\u696d\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u306e\u6e96\u5099\u3067\u306f\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3068\u30ad\u30fc\u30da\u30a2\u3092\u4f5c\u6210\u3057\u305f\u3002\n\u3053\u3053\u3067\u306f\u3001\u4e0b\u8a18\u3092\u4e0b\u8a18\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u5404\u30b5\u30fc\u30d0\u30fc\u9593\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078ssh\u63a5\u7d9a\u3059\u308b\u30ad\u30fc\u30da\u30a2\n\n\n6.2.1 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\u66f8\u7c4d\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u307e\u3068\u3081\u3066\u884c\u3063\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u304c\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u6bce\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u5916\u90e8\u30cd\u30c3\u30c8\u304b\u3089Web\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-web-from-internet\u306e\u4f5c\u6210\u30020.0.0.0/0\u304b\u3089http(80)/https(443)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n[root@step-server ~]# neutron security-group-create sg-web-from-internet\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6                                                                                                                                                                                                                                                                                          |\n| name                 | sg-web-from-internet                                                                                                                                                                                                                                                                                                          |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"09d6443a-1c45-4355-bbf3-7aa375850509\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"cc608154-3187-442f-9179-0c5fa373b7c3\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 80 --port-range-max 80 \\\n> --remote-ip-prefix 0.0.0.0/0 sg-web-from-internet\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 59d404e5-ea71-4c19-9ac8-826e65b67689 |\n| port_range_max    | 80                                   |\n| port_range_min    | 80                                   |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 443 --port-range-max 443 \\\n> --remote-ip-prefix 0.0.0.0/0 sg-web-from-internet\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | af37ddd2-311e-4e36-8e83-dfd2752793d3 |\n| port_range_max    | 443                                  |\n| port_range_min    | 443                                  |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\nWeb\u30b5\u30fc\u30d0\u30fc-App\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-all-from-app-net\u306e\u4f5c\u6210\u3002172.16.10.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n[root@step-server ~]# neutron security-group-create sg-all-from-app-net\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | ddb0a170-99b3-4409-bd4c-1dab987f0fc9                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-app-net                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"ddb0a170-99b3-4409-bd4c-1dab987f0fc9\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"eb46aec3-df4e-438a-bd43-6e3b5da6fc02\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"ddb0a170-99b3-4409-bd4c-1dab987f0fc9\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"bc112a1b-56f1-4241-b54b-edbcb9dfab12\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 172.16.10.0/24 sg-all-from-app-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b12167aa-dc78-4edf-ae63-4f5314bb8c00 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.10.0/24                       |\n| security_group_id | ddb0a170-99b3-4409-bd4c-1dab987f0fc9 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 172.16.10.0/24 sg-all-from-app-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 15c86252-2b68-4ead-a010-63b795cffe9f |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.10.0/24                       |\n| security_group_id | ddb0a170-99b3-4409-bd4c-1dab987f0fc9 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\nApp\u30b5\u30fc\u30d0\u30fc-DB\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-all-from-dbs-net\u306e\u4f5c\u6210\u3002172.16.20.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n[root@step-server ~]# neutron security-group-create sg-all-from-dbs-net\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 686e2f26-9e3e-4217-b305-3c184a20d227                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-dbs-net                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"686e2f26-9e3e-4217-b305-3c184a20d227\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"efefcdb1-2879-41a0-83dd-b8ee11a91ba0\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"686e2f26-9e3e-4217-b305-3c184a20d227\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"9efd3a4c-bc13-4b3f-b518-8fc4717087ed\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 172.16.20.0/24 sg-all-from-dbs-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | d942bab9-4ee4-42d4-8a05-c11ce8728797 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.20.0/24                       |\n| security_group_id | 686e2f26-9e3e-4217-b305-3c184a20d227 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 172.16.20.0/24 sg-all-from-dbs-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b004df8f-6b46-4347-9eac-910f91929e17 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.20.0/24                       |\n| security_group_id | 686e2f26-9e3e-4217-b305-3c184a20d227 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u3001Web\u3001App\u3001DB\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u63a5\u7d9a\u3078\u9069\u7528\u3055\u308c\u308bsg-all-from-console\u306e\u4f5c\u6210\u300210.0.0.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n[root@step-server ~]# neutron security-group-create sg-all-from-console\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 95618f13-e85e-4634-828c-540d756f9523                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-console                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"95618f13-e85e-4634-828c-540d756f9523\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"c4f73837-afca-47b5-8311-86546985c97e\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"95618f13-e85e-4634-828c-540d756f9523\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"b2b5490d-84bd-41cd-8d71-4d418bd1f19f\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 10.0.0.0/24 sg-all-from-console\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 10f4c1c0-cccb-4a14-8dbd-f649462a6486 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 10.0.0.0/24                          |\n| security_group_id | 95618f13-e85e-4634-828c-540d756f9523 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 10.0.0.0/24 sg-all-from-console\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 484fa4ec-21ca-47ef-91a0-016df7551f76 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 10.0.0.0/24                          |\n| security_group_id | 95618f13-e85e-4634-828c-540d756f9523 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n\n6.2.2 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30a4\u30f3\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3059\u308bSSH\u4f5c\u6210\u3057\u6a29\u9650\u306e\u5909\u66f4\u3092\u3059\u308b\u3002\n[root@step-server ~]# nova keypair-add key-for-internal | tee key-for-internal.pem\n-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAoC5dt0ryTvxlmVOODSuTLoR5JgehXBRtjUA6Smt4rHwlBRxp\nYPReargPgN52SJY4gGD2BE39DSuX+sky9IB9BF9bc7aVvVD/MUYKDJUijbRwFS7j\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nsUketT8yXb6sYbxsAtaRnIjEjdZWECYNrHsEXJCrE7Mdu4fjlsLL73jD48Dz7oIe\nP1P8GWWEKT2NhCCEz1dH2wNAbCw25lMfotNwmCjKCmkLaU7vjhhnpg==\n-----END RSA PRIVATE KEY-----\n\n[root@step-server ~]# chmod 600 key-for-internal.pem\n\n\n\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u30ad\u30fc\u3092\u30db\u30b9\u30c8\u533a\u753b\u306b\u3082\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\u3053\u306e\u4f5c\u696d\u306f\u30db\u30b9\u30c8\u533a\u753b\u304b\u3089\u884c\u3046\u3002\nuser01@test:~$ scp -i key-for-step-server.pem root@192.168.100.131:~/key-for-internal.pem ~/\nkey-for-internal.pem                                          100% 1680     1.6KB/s   00:00\n\n\n6.3 \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\n\n6.3.1 userdata\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u4eee\u60f3\u30de\u30b7\u30f3\u306euserdata\u3092\u7528\u610f\u3059\u308b\u3002\u5404\u3005\u306e\u5185\u5bb9\u306f\u3053\u3061\u3089\u30fbgit\u304b\u3089\u30a2\u30d7\u30ea\u3092clone\u3057\u3066\u5404\u3005\u306e\u5f79\u5272\u7528\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30fb\n\nweb\u30b5\u30fc\u30d0\u30fc\u7528\napp\u30b5\u30fc\u30d0\u30fc\u7528\ndb\u30b5\u30fc\u30d0\u30fc\u7528\n\n\n6.3.2 \u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306eUUID\u3092\u540d\u524d\u304b\u3089\u53d6\u5f97\u3057\u3066\u74b0\u5883\u5909\u6570\u306b\u4fdd\u7ba1\u3059\u308b\u3002\n\n[root@step-server ~]# function get_uuid () { cat - | grep \" id \" | awk '{print $4}'; }\n[root@step-server ~]# export MY_DMZ_NET=neutron net-show dmz-net | get_uuid\n[root@step-server ~]# export MY_APP_NET=neutron net-show app-net | get_uuid\n[root@step-server ~]# export MY_DBS_NET=neutron net-show dbs-net | get_uuid\n[root@step-server ~]# env |grep MY_\nMY_DBS_NET=ec886dac-29bf-404a-8464-736c948e7c2a\nMY_APP_NET=7d3828af-2da1-4e10-a904-f9e03b28e181\nMY_DMZ_NET=35e4baac-7230-4232-9644-856874dfe8af\n\n\n6.3.3 \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\u4f5c\u6210\u6e08\u307f\u306euserdata\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n\u307e\u305aweb\u30b5\u30fc\u30d0\u30fc\u3002\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_web.txt \\\n> --security-groups sg-all-from-console,sg-web-from-internet,sg-all-from-app-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_APP_NET} \\\n> web01\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | J3byEEVYosrf                                                   |\n| config_drive                         |                                                                |\n| created                              | 2015-03-24T02:32:10Z                                           |\n| flavor                               | standard.xsmall (100)                                          |\n| hostId                               |                                                                |\n| id                                   | ca755522-3eb2-475a-8e37-7fe23398b1d9                           |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149)             |\n| key_name                             | key-for-internal                                               |\n| metadata                             | {}                                                             |\n| name                                 | web01                                                          |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | sg-all-from-console, sg-web-from-internet, sg-all-from-app-net |\n| status                               | BUILD                                                          |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                               |\n| updated                              | 2015-03-24T02:32:10Z                                           |\n| user_id                              | 98dd78b670884b64b879568215777c53                               |\n+--------------------------------------+----------------------------------------------------------------+\n\n\u6b21\u306bapp\u30b5\u30fc\u30d0\u30fc\u3002\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_app.txt \\\n> --security-groups sg-all-from-console,sg-all-from-app-net,sg-all-from-dbs-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_APP_NET} --nic net-id=${MY_DBS_NET} \\\n> app01\n+--------------------------------------+---------------------------------------------------------------+\n| Property                             | Value                                                         |\n+--------------------------------------+---------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                          |\n| OS-EXT-STS:power_state               | 0                                                             |\n| OS-EXT-STS:task_state                | scheduling                                                    |\n| OS-EXT-STS:vm_state                  | building                                                      |\n| OS-SRV-USG:launched_at               | -                                                             |\n| OS-SRV-USG:terminated_at             | -                                                             |\n| accessIPv4                           |                                                               |\n| accessIPv6                           |                                                               |\n| adminPass                            | vR5Usr6SiieH                                                  |\n| config_drive                         |                                                               |\n| created                              | 2015-03-24T02:33:34Z                                          |\n| flavor                               | standard.xsmall (100)                                         |\n| hostId                               |                                                               |\n| id                                   | 35d338e5-6e8a-4cee-9be1-9a37b431bf38                          |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149)            |\n| key_name                             | key-for-internal                                              |\n| metadata                             | {}                                                            |\n| name                                 | app01                                                         |\n| os-extended-volumes:volumes_attached | []                                                            |\n| progress                             | 0                                                             |\n| security_groups                      | sg-all-from-console, sg-all-from-app-net, sg-all-from-dbs-net |\n| status                               | BUILD                                                         |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                              |\n| updated                              | 2015-03-24T02:33:34Z                                          |\n| user_id                              | 98dd78b670884b64b879568215777c53                              |\n+--------------------------------------+---------------------------------------------------------------+\n\n\u6700\u5f8cdb\u306b\u30b5\u30fc\u30d0\u30fc\u3002\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_dbs.txt \\\n> --security-groups sg-all-from-console,sg-all-from-dbs-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_DBS_NET} \\\n> dbs01\n+--------------------------------------+----------------------------------------------------+\n| Property                             | Value                                              |\n+--------------------------------------+----------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                             |\n| OS-EXT-AZ:availability_zone          | nova                                               |\n| OS-EXT-STS:power_state               | 0                                                  |\n| OS-EXT-STS:task_state                | scheduling                                         |\n| OS-EXT-STS:vm_state                  | building                                           |\n| OS-SRV-USG:launched_at               | -                                                  |\n| OS-SRV-USG:terminated_at             | -                                                  |\n| accessIPv4                           |                                                    |\n| accessIPv6                           |                                                    |\n| adminPass                            | CKvxdXLA6d8a                                       |\n| config_drive                         |                                                    |\n| created                              | 2015-03-24T02:37:15Z                               |\n| flavor                               | standard.xsmall (100)                              |\n| hostId                               |                                                    |\n| id                                   | edf1b599-de4f-4b2c-be90-17ab1252728f               |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149) |\n| key_name                             | key-for-internal                                   |\n| metadata                             | {}                                                 |\n| name                                 | dbs01                                              |\n| os-extended-volumes:volumes_attached | []                                                 |\n| progress                             | 0                                                  |\n| security_groups                      | sg-all-from-console, sg-all-from-dbs-net           |\n| status                               | BUILD                                              |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                   |\n| updated                              | 2015-03-24T02:37:15Z                               |\n| user_id                              | 98dd78b670884b64b879568215777c53                   |\n+--------------------------------------+----------------------------------------------------+\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8d77\u52d5\u3057\u3066\u304d\u305f\u3002\nuser01@test:~/chapter05-10/06$ nova list\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n| ID                                   | Name        | Status | Task State | Power State | Networks                                                      |\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n| 35d338e5-6e8a-4cee-9be1-9a37b431bf38 | app01       | ACTIVE | -          | Running     | dmz-net=192.168.0.3; app-net=172.16.10.3; dbs-net=172.16.20.1 |\n| edf1b599-de4f-4b2c-be90-17ab1252728f | dbs01       | ACTIVE | -          | Running     | dmz-net=192.168.0.4; dbs-net=172.16.20.3                      |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | ACTIVE | -          | Running     | work-net=10.0.0.1, 192.168.100.131                            |\n| ca755522-3eb2-475a-8e37-7fe23398b1d9 | web01       | ACTIVE | -          | Running     | dmz-net=192.168.0.1; app-net=172.16.10.1                      |\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u306e\u78ba\u8a8d\u3082\u66f8\u7c4d\u3068\u540c\u69d8\u3002\u554f\u984c\u304c\u7121\u3044\u3088\u3046\u3060\u3002\n\n\n6.4 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\u8a2d\u5b9a\u65b9\u6cd5\u306f\u3053\u3061\u3089\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001Web\u30b5\u30fc\u30d0\u30fc\u3068App\u30b5\u30fc\u30d0\u30fc\u306eendpoint.conf\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308bIP\u3092\u4eca\u56de\u306e\u74b0\u5883\u306e\u3082\u306e\u306b\u5909\u66f4\u3059\u308b\u3002\n\n6.4.1 APP\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\napp\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3002\napp01\u306b\u306f\u300cdmz-net=192.168.0.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u305f\u306e\u3067\u3001\u4e0b\u8a18\u3067\u30ed\u30b0\u30aa\u30f3\u3059\u308b\u3002\n[root@step-server ~]# ssh -i key-for-internal.pem root@192.168.0.3\n[root@app01 ~]#\n\nApp\u2192DB\u306e\u53c2\u7167\u304c\u51fa\u6765\u308b\u3088\u3046\u306bdb_host\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002dbs01\u306b\u306f\u300cdbs-net=172.16.20.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u3066\u3044\u308b\u3002\n[root@app01 ~]# cat /root/sample-app/endpoint.conf\n[rest-server]\nrest_host = 127.0.0.1\nrest_endpoint = http://%(rest_host)s:5555/bbs\n\n[db-server]\ndb_host = 172.16.20.3\ndb_endpoint = mysql://user:password@%(db_host)s/sample_bbs?charset=utf8\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3002\n[root@app01 ~]# sh /root/sample-app/server-setup/rest.init.sh start\nStarting rest.py                                           [  OK  ]\n[root@app01 ~]# curl http://127.0.0.1:5555/bbs\n{}\n[root@app01 ~]# exit\nlogout\nConnection to 192.168.0.3 closed.\n\n\n6.4.2 WEB\u30b5\u30fc\u30d0\u30fc\nweb\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3002\nweb01\u306b\u306f\u300cdmz-net=192.168.0.1\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u305f\u306e\u3067\u3001\u4e0b\u8a18\u3067\u30ed\u30b0\u30aa\u30f3\u3059\u308b\u3002\n[root@step-server ~]# ssh -i key-for-internal.pem root@192.168.0.1\n[root@web01 ~]#\n\nWeb\u2192App\u306e\u53c2\u7167\u304c\u51fa\u6765\u308b\u3088\u3046\u306brest_host\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002app01\u306b\u306f\u300capp-net=172.16.10.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u3066\u3044\u308b\u3002\n[root@web01 ~]# cat /root/sample-app/endpoint.conf\n[rest-server]\nrest_host = 172.16.10.3\nrest_endpoint = http://%(rest_host)s:5555/bbs\n\n[db-server]\ndb_host = localhost\ndb_endpoint = mysql://user:password@%(db_host)s/sample_bbs?charset=utf8\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3002\n[root@web01 ~]# sh /root/sample-app/server-setup/web.init.sh start\nStarting web.py                                            [  OK  ]\n[root@web01 ~]# curl http://127.0.0.1/\n<!doctype html>\n<html>\n  <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title></title>\n  </head>\n  <body>\n    <form method=\"POST\" action=\"/\">\n      <label for=\"text\">Please write something and hit enter</label> <input id=\"text\" name=\"text\" type=\"text\" value=\"\">\n    </form>\n    <br/>\n  </body>\n</html>\n[root@web01 ~]# exit\nlogout\nConnection to 192.168.0.1 closed.\n\n\n6.5 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30ea\u30fc\u30b9\n\u5916\u90e8\u3092\u898b\u7acb\u3066\u305fExt-Net\u304b\u3089Floting IP\u3092\u53d6\u5f97\u3057\u3001web01\u306b\u30a2\u30b5\u30a4\u30f3\u3059\u308b\u3002\n[root@step-server ~]# nova floating-ip-create Ext-Net\n+-----------------+-----------+----------+---------+\n| Ip              | Server Id | Fixed Ip | Pool    |\n+-----------------+-----------+----------+---------+\n| 192.168.100.133 |           | -        | Ext-Net |\n+-----------------+-----------+----------+---------+\n[root@step-server ~]# nova floating-ip-associate web01 192.168.100.133\n\n\u30db\u30b9\u30c8\u533a\u753b\u306b\u623b\u308anginx\u306eReverse Proxy\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n/etc/nginx/conf.d\u306b\u4eca\u56de\u306fweb01.conf\u3068\u3044\u3046\u540d\u524d\u3067\u4e0b\u8a18\u3092\u4f5c\u6210\u3059\u308b\u3002\u30dd\u30fc\u30c81080\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068web01\u306b\u8ee2\u9001\u3055\u308c\u308b\u3002Basic\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u306f\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7528\u306b\u4f5c\u3063\u305f\u3082\u306e\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3059\u308b\u3002\nserver {\n  listen 1080;\n  server_name [Public IP];\n  location /  {\n    auth_basic \"Input ID/PASS\";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n    proxy_pass http://192.168.100.133/;\n  }\n}\n\nnginx\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\nuser01@test:/etc/nginx/conf.d$ sudo service nginx restart\n * Restarting nginx nginx                                                                    [ OK ]\n\n\u6307\u5b9a\u3057\u305f\u30dd\u30fc\u30c81080\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002Basic\u8a8d\u8a3c\u306e\u5f8c\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u7a3c\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\n\u7b2c6\u7ae0\u304c\u5b8c\u4e86\u3057\u305f\u3002\n\n\u524d\u56de\u306f\u3053\u3061\u3089 - \u6b21\u56de\u306f\u3053\u3061\u3089\n[\u524d\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/ebc41e2695fc1be17576) - [\u6b21\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/143a1ae5985610f49da4)\n\n***\n#\u3053\u308c\u306f\u306a\u306b\n[\u300cOpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580\u300d](http://www.shoeisha.co.jp/book/detail/9784798139784)\u306e\u5b9f\u7fd2\u3092SoftLayer\u306e\u7121\u6599\u30d9\u30a2\u30e1\u30bf\u30eb\u3067\u884c\u3046\u8a18\u9332\u3067\u3042\u308b\u3002\n![OpenStack\u30af\u30e9\u30a6\u30c9\u30a4\u30f3\u30c6\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30af\u30e9\u30a6\u30c9\u306b\u3088\u308b\u30b5\u30fc\u30d3\u30b9\u69cb\u7bc9\u5165\u9580](http://www.seshop.com/static/images/product/17681/L.png)\n\n# \u7b2c6\u7ae0 \u30b7\u30f3\u30d7\u30eb\u306a3\u968e\u5c64\u69cb\u9020\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\n\u3053\u306e\u7ae0\u3067\u306fgit\u306b\u7528\u610f\u3055\u308c\u3066\u3044\u308b3\u5c64\u306eSNS\u30a2\u30d7\u30ea\u3092OpenStack\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u3002\n\n\u7b2c5\u7ae0\u304b\u3089\u7b2c10\u7ae0\u307e\u3067\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u3061\u3089\u3002\u307e\u3068\u3081\u3066git\u3067\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3067\u304d\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10\n<br/>\u7b2c6\u7ae0\u306e\u652f\u63f4\u30d5\u30a1\u30a4\u30eb\u306f\u3053\u3061\u3089\u3067\u3042\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10/tree/master/06\n<br/>\u524d\u56de\u3068\u540c\u69d8\u306b\u7b2c6\u7ae0\u306e\u3059\u3079\u3066\u306e\u30b9\u30c6\u30c3\u30d7\u3092\u307e\u3068\u3081\u3066\u884c\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u3082\u7528\u610f\u3055\u308c\u3066\u3044\u308b\u3002\nhttps://github.com/josug-book1-materials/chapter05-10/blob/master/06/build_chap06.sh\n\n\u3055\u3059\u304c\u306b\u52c9\u5f37\u306b\u306a\u3089\u306a\u3044\u306e\u3067\u3001\u4eca\u56de\u3082\u30b9\u30c6\u30c3\u30d7\u30fb\u30d0\u30a4\u30fb\u30b9\u30c6\u30c3\u30d7\u3067\u78ba\u8a8d\u3057\u306a\u304c\u3089\u9032\u3081\u308b\u3002\n\n## 6.1 \u4f5c\u696d\u524d\u306e\u6ce8\u610f\n\u4eca\u56de\u306e\u4f5c\u696d\u306f\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u3067\u884c\u3046\u306e\u3067\u3001\u8e0f\u307f\u53f0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u300csource ooenrc\u300d\u3067\u74b0\u5883\u5909\u6570\u3092\u30bb\u30c3\u30c8\u3057\u3066\u3001[\u652f\u63f4\u30d5\u30a1\u30a4\u30eb](https://github.com/josug-book1-materials/chapter05-10)\u3092git\u3057\u3066\u304a\u304f\u3088\u3046\u306b\u3001\u3068\u3044\u3046\u6ce8\u610f\u3067\u3042\u308b\u3002\n\n<pre>\n[root@step-server ~]# cd\n[root@step-server ~]# source openrc\n[root@step-server ~]# git clone https://github.com/josug-book1-materials/chapter05-10.git\n</pre>\n\n## 6.2 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3068\u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\n[(6)\u306e5.4 \u4f5c\u696d\u7528\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3068\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u306e\u6e96\u5099](http://qiita.com/orz/items/ebc41e2695fc1be17576#54-%E4%BD%9C%E6%A5%AD%E7%94%A8%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E3%81%A8%E8%B8%8F%E3%81%BF%E5%8F%B0%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E6%BA%96%E5%82%99)\u3067\u306f\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3068\u30ad\u30fc\u30da\u30a2\u3092\u4f5c\u6210\u3057\u305f\u3002\n\u3053\u3053\u3067\u306f\u3001\u4e0b\u8a18\u3092\u4e0b\u8a18\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n0. \u5404\u30b5\u30fc\u30d0\u30fc\u9593\u306e\u901a\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n0. \u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\n0. \u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u5404\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3078ssh\u63a5\u7d9a\u3059\u308b\u30ad\u30fc\u30da\u30a2\n\n### 6.2.1 \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\n\n\u66f8\u7c4d\u3067\u306f\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u3092\u307e\u3068\u3081\u3066\u884c\u3063\u3066\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u3092\u4f5c\u6210\u3057\u3066\u3044\u308b\u304c\u3001\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u4f5c\u6210\u6bce\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u30eb\u30fc\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n\u5916\u90e8\u30cd\u30c3\u30c8\u304b\u3089Web\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-web-from-internet\u306e\u4f5c\u6210\u30020.0.0.0/0\u304b\u3089http(80)/https(443)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# neutron security-group-create sg-web-from-internet\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6                                                                                                                                                                                                                                                                                          |\n| name                 | sg-web-from-internet                                                                                                                                                                                                                                                                                                          |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"09d6443a-1c45-4355-bbf3-7aa375850509\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"cc608154-3187-442f-9179-0c5fa373b7c3\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 80 --port-range-max 80 \\\n> --remote-ip-prefix 0.0.0.0/0 sg-web-from-internet\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 59d404e5-ea71-4c19-9ac8-826e65b67689 |\n| port_range_max    | 80                                   |\n| port_range_min    | 80                                   |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 443 --port-range-max 443 \\\n> --remote-ip-prefix 0.0.0.0/0 sg-web-from-internet\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | af37ddd2-311e-4e36-8e83-dfd2752793d3 |\n| port_range_max    | 443                                  |\n| port_range_min    | 443                                  |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 0.0.0.0/0                            |\n| security_group_id | f9bbc1ca-2b47-46e0-a9b7-6f42bc0d57f6 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n</pre>\n\nWeb\u30b5\u30fc\u30d0\u30fc-App\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-all-from-app-net\u306e\u4f5c\u6210\u3002172.16.10.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n<pre>[root@step-server ~]# neutron security-group-create sg-all-from-app-net\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | ddb0a170-99b3-4409-bd4c-1dab987f0fc9                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-app-net                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"ddb0a170-99b3-4409-bd4c-1dab987f0fc9\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"eb46aec3-df4e-438a-bd43-6e3b5da6fc02\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"ddb0a170-99b3-4409-bd4c-1dab987f0fc9\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"bc112a1b-56f1-4241-b54b-edbcb9dfab12\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 172.16.10.0/24 sg-all-from-app-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b12167aa-dc78-4edf-ae63-4f5314bb8c00 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.10.0/24                       |\n| security_group_id | ddb0a170-99b3-4409-bd4c-1dab987f0fc9 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 172.16.10.0/24 sg-all-from-app-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 15c86252-2b68-4ead-a010-63b795cffe9f |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.10.0/24                       |\n| security_group_id | ddb0a170-99b3-4409-bd4c-1dab987f0fc9 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n</pre>\n\nApp\u30b5\u30fc\u30d0\u30fc-DB\u30b5\u30fc\u30d0\u30fc\u306b\u9069\u7528\u3055\u308c\u308bsg-all-from-dbs-net\u306e\u4f5c\u6210\u3002172.16.20.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# neutron security-group-create sg-all-from-dbs-net\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 686e2f26-9e3e-4217-b305-3c184a20d227                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-dbs-net                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"686e2f26-9e3e-4217-b305-3c184a20d227\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"efefcdb1-2879-41a0-83dd-b8ee11a91ba0\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"686e2f26-9e3e-4217-b305-3c184a20d227\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"9efd3a4c-bc13-4b3f-b518-8fc4717087ed\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 172.16.20.0/24 sg-all-from-dbs-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | d942bab9-4ee4-42d4-8a05-c11ce8728797 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.20.0/24                       |\n| security_group_id | 686e2f26-9e3e-4217-b305-3c184a20d227 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 172.16.20.0/24 sg-all-from-dbs-net\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | b004df8f-6b46-4347-9eac-910f91929e17 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 172.16.20.0/24                       |\n| security_group_id | 686e2f26-9e3e-4217-b305-3c184a20d227 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n</pre>\n\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u3001Web\u3001App\u3001DB\u30b5\u30fc\u30d0\u30fc\u3078\u306e\u63a5\u7d9a\u3078\u9069\u7528\u3055\u308c\u308bsg-all-from-console\u306e\u4f5c\u6210\u300210.0.0.0/24\u304b\u3089\u306e\u63a5\u7d9a\u3067\u3042\u308c\u3070\u3001\u3059\u3079\u3066\u306e\u30dd\u30fc\u30c8\u306e\u63a5\u7d9a\u3068icmp(ping)\u306e\u63a5\u7d9a\u3092\u8a31\u53ef\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# neutron security-group-create sg-all-from-console\nCreated a new security_group:\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| Field                | Value                                                                                                                                                                                                                                                                                                                         |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| description          |                                                                                                                                                                                                                                                                                                                               |\n| id                   | 95618f13-e85e-4634-828c-540d756f9523                                                                                                                                                                                                                                                                                          |\n| name                 | sg-all-from-console                                                                                                                                                                                                                                                                                                           |\n| security_group_rules | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"95618f13-e85e-4634-828c-540d756f9523\", \"port_range_min\": null, \"ethertype\": \"IPv4\", \"id\": \"c4f73837-afca-47b5-8311-86546985c97e\"} |\n|                      | {\"remote_group_id\": null, \"direction\": \"egress\", \"remote_ip_prefix\": null, \"protocol\": null, \"tenant_id\": \"106e169743964758bcad1f06cc69c472\", \"port_range_max\": null, \"security_group_id\": \"95618f13-e85e-4634-828c-540d756f9523\", \"port_range_min\": null, \"ethertype\": \"IPv6\", \"id\": \"b2b5490d-84bd-41cd-8d71-4d418bd1f19f\"} |\n| tenant_id            | 106e169743964758bcad1f06cc69c472                                                                                                                                                                                                                                                                                              |\n+----------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol tcp \\\n> --port-range-min 1 --port-range-max 65535 \\\n> --remote-ip-prefix 10.0.0.0/24 sg-all-from-console\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 10f4c1c0-cccb-4a14-8dbd-f649462a6486 |\n| port_range_max    | 65535                                |\n| port_range_min    | 1                                    |\n| protocol          | tcp                                  |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 10.0.0.0/24                          |\n| security_group_id | 95618f13-e85e-4634-828c-540d756f9523 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n\n[root@step-server ~]# neutron security-group-rule-create --ethertype IPv4 --protocol icmp \\\n> --remote-ip-prefix 10.0.0.0/24 sg-all-from-console\nCreated a new security_group_rule:\n+-------------------+--------------------------------------+\n| Field             | Value                                |\n+-------------------+--------------------------------------+\n| direction         | ingress                              |\n| ethertype         | IPv4                                 |\n| id                | 484fa4ec-21ca-47ef-91a0-016df7551f76 |\n| port_range_max    |                                      |\n| port_range_min    |                                      |\n| protocol          | icmp                                 |\n| remote_group_id   |                                      |\n| remote_ip_prefix  | 10.0.0.0/24                          |\n| security_group_id | 95618f13-e85e-4634-828c-540d756f9523 |\n| tenant_id         | 106e169743964758bcad1f06cc69c472     |\n+-------------------+--------------------------------------+\n</pre>\n\n### 6.2.2 \u30ad\u30fc\u30da\u30a2\u306e\u4f5c\u6210\n\n\u8e0f\u307f\u53f0\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u7528\u306e\u30a4\u30f3\u30bf\u30f3\u30b9\u306b\u63a5\u7d9a\u3059\u308bSSH\u4f5c\u6210\u3057\u6a29\u9650\u306e\u5909\u66f4\u3092\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# nova keypair-add key-for-internal | tee key-for-internal.pem\n-----BEGIN RSA PRIVATE KEY-----\nMIIEpAIBAAKCAQEAoC5dt0ryTvxlmVOODSuTLoR5JgehXBRtjUA6Smt4rHwlBRxp\nYPReargPgN52SJY4gGD2BE39DSuX+sky9IB9BF9bc7aVvVD/MUYKDJUijbRwFS7j\n\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\uff5e\nsUketT8yXb6sYbxsAtaRnIjEjdZWECYNrHsEXJCrE7Mdu4fjlsLL73jD48Dz7oIe\nP1P8GWWEKT2NhCCEz1dH2wNAbCw25lMfotNwmCjKCmkLaU7vjhhnpg==\n-----END RSA PRIVATE KEY-----\n\n[root@step-server ~]# chmod 600 key-for-internal.pem\n\n</pre>\n\n\u4f5c\u6210\u3057\u305f\u79d8\u5bc6\u30ad\u30fc\u3092\u30db\u30b9\u30c8\u533a\u753b\u306b\u3082\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304f\u3002\u3053\u306e\u4f5c\u696d\u306f*\u30db\u30b9\u30c8\u533a\u753b*\u304b\u3089\u884c\u3046\u3002\n\n<pre>\nuser01@test:~$ scp -i key-for-step-server.pem root@192.168.100.131:~/key-for-internal.pem ~/\nkey-for-internal.pem                                          100% 1680     1.6KB/s   00:00\n</pre>\n\n## 6.3 \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u3068\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30d7\u30ed\u30a4\n\n### 6.3.1 userdata\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u306euserdata\u3092\u7528\u610f\u3059\u308b\u3002\u5404\u3005\u306e\u5185\u5bb9\u306f\u3053\u3061\u3089\u30fbgit\u304b\u3089\u30a2\u30d7\u30ea\u3092clone\u3057\u3066\u5404\u3005\u306e\u5f79\u5272\u7528\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u30fb\n\n* [web\u30b5\u30fc\u30d0\u30fc\u7528](https://github.com/josug-book1-materials/chapter05-10/blob/master/06/userdata_web.txt)\n* [app\u30b5\u30fc\u30d0\u30fc\u7528](https://github.com/josug-book1-materials/chapter05-10/blob/master/06/userdata_app.txt)\n* [db\u30b5\u30fc\u30d0\u30fc\u7528](https://github.com/josug-book1-materials/chapter05-10/blob/master/06/userdata_dbs.txt)\n\n### 6.3.2 \u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306eUUID\u3092\u540d\u524d\u304b\u3089\u53d6\u5f97\u3057\u3066\u74b0\u5883\u5909\u6570\u306b\u4fdd\u7ba1\u3059\u308b\u3002\n<pre>\n[root@step-server ~]# function get_uuid () { cat - | grep \" id \" | awk '{print $4}'; }\n[root@step-server ~]# export MY_DMZ_NET=`neutron net-show dmz-net | get_uuid`\n[root@step-server ~]# export MY_APP_NET=`neutron net-show app-net | get_uuid`\n[root@step-server ~]# export MY_DBS_NET=`neutron net-show dbs-net | get_uuid`\n[root@step-server ~]# env |grep MY_\nMY_DBS_NET=ec886dac-29bf-404a-8464-736c948e7c2a\nMY_APP_NET=7d3828af-2da1-4e10-a904-f9e03b28e181\nMY_DMZ_NET=35e4baac-7230-4232-9644-856874dfe8af\n</pre>\n\n### 6.3.3 \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\n\u4f5c\u6210\u6e08\u307f\u306euserdata\u3067\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n\n\u307e\u305aweb\u30b5\u30fc\u30d0\u30fc\u3002\n\n<pre>\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_web.txt \\\n> --security-groups sg-all-from-console,sg-web-from-internet,sg-all-from-app-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_APP_NET} \\\n> web01\n+--------------------------------------+----------------------------------------------------------------+\n| Property                             | Value                                                          |\n+--------------------------------------+----------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                         |\n| OS-EXT-AZ:availability_zone          | nova                                                           |\n| OS-EXT-STS:power_state               | 0                                                              |\n| OS-EXT-STS:task_state                | scheduling                                                     |\n| OS-EXT-STS:vm_state                  | building                                                       |\n| OS-SRV-USG:launched_at               | -                                                              |\n| OS-SRV-USG:terminated_at             | -                                                              |\n| accessIPv4                           |                                                                |\n| accessIPv6                           |                                                                |\n| adminPass                            | J3byEEVYosrf                                                   |\n| config_drive                         |                                                                |\n| created                              | 2015-03-24T02:32:10Z                                           |\n| flavor                               | standard.xsmall (100)                                          |\n| hostId                               |                                                                |\n| id                                   | ca755522-3eb2-475a-8e37-7fe23398b1d9                           |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149)             |\n| key_name                             | key-for-internal                                               |\n| metadata                             | {}                                                             |\n| name                                 | web01                                                          |\n| os-extended-volumes:volumes_attached | []                                                             |\n| progress                             | 0                                                              |\n| security_groups                      | sg-all-from-console, sg-web-from-internet, sg-all-from-app-net |\n| status                               | BUILD                                                          |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                               |\n| updated                              | 2015-03-24T02:32:10Z                                           |\n| user_id                              | 98dd78b670884b64b879568215777c53                               |\n+--------------------------------------+----------------------------------------------------------------+\n</pre>\n\n\u6b21\u306bapp\u30b5\u30fc\u30d0\u30fc\u3002\n\n<pre>\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_app.txt \\\n> --security-groups sg-all-from-console,sg-all-from-app-net,sg-all-from-dbs-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_APP_NET} --nic net-id=${MY_DBS_NET} \\\n> app01\n+--------------------------------------+---------------------------------------------------------------+\n| Property                             | Value                                                         |\n+--------------------------------------+---------------------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                                        |\n| OS-EXT-AZ:availability_zone          | nova                                                          |\n| OS-EXT-STS:power_state               | 0                                                             |\n| OS-EXT-STS:task_state                | scheduling                                                    |\n| OS-EXT-STS:vm_state                  | building                                                      |\n| OS-SRV-USG:launched_at               | -                                                             |\n| OS-SRV-USG:terminated_at             | -                                                             |\n| accessIPv4                           |                                                               |\n| accessIPv6                           |                                                               |\n| adminPass                            | vR5Usr6SiieH                                                  |\n| config_drive                         |                                                               |\n| created                              | 2015-03-24T02:33:34Z                                          |\n| flavor                               | standard.xsmall (100)                                         |\n| hostId                               |                                                               |\n| id                                   | 35d338e5-6e8a-4cee-9be1-9a37b431bf38                          |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149)            |\n| key_name                             | key-for-internal                                              |\n| metadata                             | {}                                                            |\n| name                                 | app01                                                         |\n| os-extended-volumes:volumes_attached | []                                                            |\n| progress                             | 0                                                             |\n| security_groups                      | sg-all-from-console, sg-all-from-app-net, sg-all-from-dbs-net |\n| status                               | BUILD                                                         |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                              |\n| updated                              | 2015-03-24T02:33:34Z                                          |\n| user_id                              | 98dd78b670884b64b879568215777c53                              |\n+--------------------------------------+---------------------------------------------------------------+\n</pre>\n\n\u6700\u5f8cdb\u306b\u30b5\u30fc\u30d0\u30fc\u3002\n\n<pre>\nuser01@test:~/chapter05-10/06$ nova boot --flavor standard.xsmall --image \"centos-base\" \\\n> --key-name key-for-internal --user-data userdata_dbs.txt \\\n> --security-groups sg-all-from-console,sg-all-from-dbs-net \\\n> --availability-zone az1 \\\n> --nic net-id=${MY_DMZ_NET} --nic net-id=${MY_DBS_NET} \\\n> dbs01\n+--------------------------------------+----------------------------------------------------+\n| Property                             | Value                                              |\n+--------------------------------------+----------------------------------------------------+\n| OS-DCF:diskConfig                    | MANUAL                                             |\n| OS-EXT-AZ:availability_zone          | nova                                               |\n| OS-EXT-STS:power_state               | 0                                                  |\n| OS-EXT-STS:task_state                | scheduling                                         |\n| OS-EXT-STS:vm_state                  | building                                           |\n| OS-SRV-USG:launched_at               | -                                                  |\n| OS-SRV-USG:terminated_at             | -                                                  |\n| accessIPv4                           |                                                    |\n| accessIPv6                           |                                                    |\n| adminPass                            | CKvxdXLA6d8a                                       |\n| config_drive                         |                                                    |\n| created                              | 2015-03-24T02:37:15Z                               |\n| flavor                               | standard.xsmall (100)                              |\n| hostId                               |                                                    |\n| id                                   | edf1b599-de4f-4b2c-be90-17ab1252728f               |\n| image                                | centos-base (098f948e-e80b-4b1a-8a46-f8d2dd57e149) |\n| key_name                             | key-for-internal                                   |\n| metadata                             | {}                                                 |\n| name                                 | dbs01                                              |\n| os-extended-volumes:volumes_attached | []                                                 |\n| progress                             | 0                                                  |\n| security_groups                      | sg-all-from-console, sg-all-from-dbs-net           |\n| status                               | BUILD                                              |\n| tenant_id                            | 106e169743964758bcad1f06cc69c472                   |\n| updated                              | 2015-03-24T02:37:15Z                               |\n| user_id                              | 98dd78b670884b64b879568215777c53                   |\n+--------------------------------------+----------------------------------------------------+\n</pre>\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8d77\u52d5\u3057\u3066\u304d\u305f\u3002\n\n<pre>\nuser01@test:~/chapter05-10/06$ nova list\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n| ID                                   | Name        | Status | Task State | Power State | Networks                                                      |\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n| 35d338e5-6e8a-4cee-9be1-9a37b431bf38 | app01       | ACTIVE | -          | Running     | dmz-net=192.168.0.3; app-net=172.16.10.3; dbs-net=172.16.20.1 |\n| edf1b599-de4f-4b2c-be90-17ab1252728f | dbs01       | ACTIVE | -          | Running     | dmz-net=192.168.0.4; dbs-net=172.16.20.3                      |\n| 65d3400d-3467-4563-9ff5-9c0e30c7157e | step-server | ACTIVE | -          | Running     | work-net=10.0.0.1, 192.168.100.131                            |\n| ca755522-3eb2-475a-8e37-7fe23398b1d9 | web01       | ACTIVE | -          | Running     | dmz-net=192.168.0.1; app-net=172.16.10.1                      |\n+--------------------------------------+-------------+--------+------------+-------------+---------------------------------------------------------------+\n</pre>\n\n\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u304b\u3089\u306e\u78ba\u8a8d\u3082\u66f8\u7c4d\u3068\u540c\u69d8\u3002\u554f\u984c\u304c\u7121\u3044\u3088\u3046\u3060\u3002\n\n![\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30dd\u30ed\u30b8\u30fc](https://qiita-image-store.s3.amazonaws.com/0/71995/27753d34-8fe4-4db2-7d3f-333b1f2199fc.png)\n\n## 6.4 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u8a2d\u5b9a\n\n\u8a2d\u5b9a\u65b9\u6cd5\u306f[\u3053\u3061\u3089](https://github.com/josug-book1-materials/sample-app/blob/master/README.org)\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001Web\u30b5\u30fc\u30d0\u30fc\u3068App\u30b5\u30fc\u30d0\u30fc\u306e[endpoint.conf](https://github.com/josug-book1-materials/sample-app/blob/master/endpoint.conf)\u306b\u6307\u5b9a\u3055\u308c\u3066\u3044\u308bIP\u3092\u4eca\u56de\u306e\u74b0\u5883\u306e\u3082\u306e\u306b\u5909\u66f4\u3059\u308b\u3002\n\n### 6.4.1 APP\u30b5\u30fc\u30d0\u30fc\u306e\u8a2d\u5b9a\n\napp\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3002\napp01\u306b\u306f\u300cdmz-net=192.168.0.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u305f\u306e\u3067\u3001\u4e0b\u8a18\u3067\u30ed\u30b0\u30aa\u30f3\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# ssh -i key-for-internal.pem root@192.168.0.3\n[root@app01 ~]#\n</pre>\n\nApp\u2192DB\u306e\u53c2\u7167\u304c\u51fa\u6765\u308b\u3088\u3046\u306bdb_host\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002dbs01\u306b\u306f\u300cdbs-net=172.16.20.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u3066\u3044\u308b\u3002\n\n<pre>\n[root@app01 ~]# cat /root/sample-app/endpoint.conf\n[rest-server]\nrest_host = 127.0.0.1\nrest_endpoint = http://%(rest_host)s:5555/bbs\n\n[db-server]\ndb_host = 172.16.20.3\ndb_endpoint = mysql://user:password@%(db_host)s/sample_bbs?charset=utf8\n</pre>\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3002\n\n<pre>\n[root@app01 ~]# sh /root/sample-app/server-setup/rest.init.sh start\nStarting rest.py                                           [  OK  ]\n[root@app01 ~]# curl http://127.0.0.1:5555/bbs\n{}\n[root@app01 ~]# exit\nlogout\nConnection to 192.168.0.3 closed.\n</pre>\n\n### 6.4.2 WEB\u30b5\u30fc\u30d0\u30fc\n\nweb\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\u3059\u308b\u3002\nweb01\u306b\u306f\u300cdmz-net=192.168.0.1\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u305f\u306e\u3067\u3001\u4e0b\u8a18\u3067\u30ed\u30b0\u30aa\u30f3\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# ssh -i key-for-internal.pem root@192.168.0.1\n[root@web01 ~]#\n</pre>\n\nWeb\u2192App\u306e\u53c2\u7167\u304c\u51fa\u6765\u308b\u3088\u3046\u306brest_host\u306e\u30a2\u30c9\u30ec\u30b9\u3092\u8a2d\u5b9a\u3059\u308b\u3002app01\u306b\u306f\u300capp-net=172.16.10.3\u300d\u304c\u5272\u308a\u632f\u3089\u308c\u3066\u3044\u308b\u3002\n\n<pre>\n[root@web01 ~]# cat /root/sample-app/endpoint.conf\n[rest-server]\nrest_host = 172.16.10.3\nrest_endpoint = http://%(rest_host)s:5555/bbs\n\n[db-server]\ndb_host = localhost\ndb_endpoint = mysql://user:password@%(db_host)s/sample_bbs?charset=utf8\n</pre>\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u8d77\u52d5\u3057\u3066\u63a5\u7d9a\u3092\u78ba\u8a8d\u3057\u305f\u3089\u30ed\u30b0\u30a2\u30a6\u30c8\u3059\u308b\u3002\n\n```\n[root@web01 ~]# sh /root/sample-app/server-setup/web.init.sh start\nStarting web.py                                            [  OK  ]\n[root@web01 ~]# curl http://127.0.0.1/\n<!doctype html>\n<html>\n  <head>\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\">\n    <title></title>\n  </head>\n  <body>\n    <form method=\"POST\" action=\"/\">\n      <label for=\"text\">Please write something and hit enter</label> <input id=\"text\" name=\"text\" type=\"text\" value=\"\">\n    </form>\n    <br/>\n  </body>\n</html>\n[root@web01 ~]# exit\nlogout\nConnection to 192.168.0.1 closed.\n```\n\n## 6.5 \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ea\u30ea\u30fc\u30b9\n\n\u5916\u90e8\u3092\u898b\u7acb\u3066\u305fExt-Net\u304b\u3089Floting IP\u3092\u53d6\u5f97\u3057\u3001web01\u306b\u30a2\u30b5\u30a4\u30f3\u3059\u308b\u3002\n\n<pre>\n[root@step-server ~]# nova floating-ip-create Ext-Net\n+-----------------+-----------+----------+---------+\n| Ip              | Server Id | Fixed Ip | Pool    |\n+-----------------+-----------+----------+---------+\n| 192.168.100.133 |           | -        | Ext-Net |\n+-----------------+-----------+----------+---------+\n[root@step-server ~]# nova floating-ip-associate web01 192.168.100.133\n</pre>\n\n\u30db\u30b9\u30c8\u533a\u753b\u306b\u623b\u308anginx\u306eReverse Proxy\u306e\u8a2d\u5b9a\u3092\u3059\u308b\u3002\n\n/etc/nginx/conf.d\u306b\u4eca\u56de\u306fweb01.conf\u3068\u3044\u3046\u540d\u524d\u3067\u4e0b\u8a18\u3092\u4f5c\u6210\u3059\u308b\u3002\u30dd\u30fc\u30c81080\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068web01\u306b\u8ee2\u9001\u3055\u308c\u308b\u3002Basic\u8a8d\u8a3c\u306e\u8a2d\u5b9a\u306f[\u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u7528\u306b\u4f5c\u3063\u305f\u3082\u306e](http://qiita.com/orz/items/ebc41e2695fc1be17576#basic-%E8%AA%8D%E8%A8%BC%E3%82%92%E3%81%8B%E3%81%91%E3%81%9Fnginx%E3%81%AEreverse-proxy%E3%81%A7horizon%E3%81%B8%E3%81%AE%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9)\u3092\u305d\u306e\u307e\u307e\u5229\u7528\u3059\u308b\u3002\n\n```\nserver {\n  listen 1080;\n  server_name [Public IP];\n  location /  {\n    auth_basic \"Input ID/PASS\";\n    auth_basic_user_file /etc/nginx/.htpasswd;\n    proxy_pass http://192.168.100.133/;\n  }\n}\n```\n\nnginx\u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```\nuser01@test:/etc/nginx/conf.d$ sudo service nginx restart\n * Restarting nginx nginx                                                                    [ OK ]\n```\n\n\u6307\u5b9a\u3057\u305f\u30dd\u30fc\u30c81080\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3002Basic\u8a8d\u8a3c\u306e\u5f8c\u306b\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u7a3c\u52d5\u304c\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n![\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u78ba\u8a8d](https://qiita-image-store.s3.amazonaws.com/0/71995/4c214e14-5b60-b4e7-dc16-34c8d5c22685.png)\n\n***\n\u7b2c6\u7ae0\u304c\u5b8c\u4e86\u3057\u305f\u3002\n***\n[\u524d\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/ebc41e2695fc1be17576) - [\u6b21\u56de\u306f\u3053\u3061\u3089](http://qiita.com/orz/items/143a1ae5985610f49da4)\n", "tags": ["SoftLayer", "openstack"]}