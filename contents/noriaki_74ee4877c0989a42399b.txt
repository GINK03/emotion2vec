{"context": " More than 1 year has passed since last update.\u3053\u306e\u8a18\u4e8b\u306f\u3001\u81ea\u5206\u306e\u8a18\u4e8b\u300cCentOS+Rails4+Apache2.2\u3067Puma\u3092\u8a2d\u5b9a\u3059\u308b | noriaki blog\u300d\u306e\u8a2d\u5b9a\u90e8\u5206\u3092\u5099\u5fd8\u7684\u306b\u629c\u304d\u51fa\u3057\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u8a73\u7d30\u306a\u624b\u9806\u306f\u8a18\u4e8b\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\nPuma\u8a2d\u5b9a\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n% mkdir -p tmp/pids\n% mkdir -p tmp/sockets\n\n\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(config/puma.rb)\n\nconfig/puma.rb\nrequire 'active_support'\nrequire 'active_support/core_ext'\n\nrails_root = Dir.pwd\n\nunless ENV['RACK_ENV'] == 'production'\n  environment ENV['RACK_ENV'] || 'development'\n  daemonize true  # \u30c7\u30fc\u30e2\u30f3\u5316\n\n  workers 0  # 1\u4ee5\u4e0a\u3092\u6307\u5b9a\u3059\u308b\u3068Cluster\u5316\u3059\u308b\n  threads 0,2  # \u30b9\u30ec\u30c3\u30c9\u6570\uff08\u6700\u5c0f, \u6700\u5927\uff09\n\n  bind 'unix://' + File.join(rails_root, 'tmp', 'sockets', 'puma.sock')  # /PATH/TO/MYAPP/tmp/sockets/puma.sock\n  port 9293  # Port\u756a\u53f7\n\n  pidfile File.join(rails_root, 'tmp', 'pids', 'puma.pid')  # /PATH/TO/MYAPP/tmp/pids/puma.pid\n  state_path File.join(rails_root, 'tmp', 'puma.state')  # /PATH/TO/MYAPP/tmp/puma.state\n\n  stdout_redirect(  # puma\u306e\u30ed\u30b0\u3092log/\u4ee5\u4e0b\u306b\u51fa\u529b\u3059\u308b\u3002true\u306f\u8ffd\u8a18\u30e2\u30fc\u30c9\u3002\n    File.join(rails_root, 'log', 'puma.log'),\n    File.join(rails_root, 'log', 'puma-error.log'),\n    true\n  )\n\n  # pumactl\u306e\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a via. http://qiita.com/takkkun/items/ecdee7e7dec1bcc9a5b5\n  activate_control_app('auto', auth_token: rails_root.camelize.parameterize)\nend\n\n\n\nApache\u8a2d\u5b9a\n\n\u30a2\u30d7\u30ea\u7528\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\n\nconf.d/virtualhost_MYAPP.conf\n# -*- coding: utf-8; mode: conf; -*-\n\n##\n# MYAPP\n#\n<virtualhost *:80>\n    DocumentRoot \"/PATH/TO/MYAPP/public\" # Rails\u30a2\u30d7\u30ea\u306epublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\n    ServerName myapp.example.com  # Rails\u30a2\u30d7\u30ea\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u6307\u5b9a\n\n    RewriteLog logs/MYAPP-rewrite_log\n    RewriteLogLevel 1\n    ErrorLog logs/MYAPP-error_log\n    CustomLog logs/MYAPP-access_log combined env=!no_log\n\n    SetEnv RACK_ENV developmen  # Rails\u30a2\u30d7\u30ea\u306e\u5b9f\u884c\u74b0\u5883(development/test/production)\n\n    # for puma config\n    include conf.d/puma-conf  # \u3053\u3053\u3067Puma\u5171\u901a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\n    RewriteRule ^/(.*)$ http://0.0.0.0:9293%{REQUEST_URI} [P]  # '9293'\u306e\u3068\u3053\u308d\u306b\u306fconf/puma.rb\u3067\u6307\u5b9a\u3057\u305fPort\u756a\u53f7\u3092\u8a2d\u5b9a\n\n    <directory \"/PATH/TO/MYAPP/public\">\n        AllowOverride All\n        Options FollowSymLinks -MultiViews\n        Order deny,allow\n        Allow from all\n    </directory>\n\n</virtualhost>\n\n\n\nPuma\u7528\u5171\u901a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\nconf.d/puma-conf\n# -*- coding: utf-8; mode: conf; -*-\n\n    # Redirect all requests that don't match a file on disk\n    # under DocumentRoot get proxied to Puma\n    RewriteEngine On\n    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f\n\n    # Don't allow client to fool Puma into thinking connection is secure\n    RequestHeader unset X-Forwarded-Proto\n\n    # Disable ETags (https://github.com/h5bp/server-configs-apache/tree/master/doc#configure-etags)\n    # Set Expiration date for all assets to one year in the future\n    <locationmatch \"^/assets/.*$\">\n        Header unset ETag\n        FileETag None\n\n        ExpiresActive On\n        ExpiresDefault \"access plus 1 year\"\n    </locationmatch>\n\n    # Rewrite requests for js and css to gzipped versions\n    # if client and server support it\n    <locationmatch \"^/assets/.*\\.(css|js)$\">\n        RewriteEngine on\n        RewriteCond %{HTTP:Accept-Encoding} \\b(x-)?gzip\\b\n        RewriteCond %{REQUEST_FILENAME}.gz -s\n        RewriteRule ^(.+)$ $1.gz\n    </locationmatch>\n\n    # Set type and headers for gzipped css\n    <locationmatch \"^/assets/.*\\.css\\.gz$\">\n        ForceType text/css\n        Header set Content-Encoding gzip\n        Header add Vary Accept-Encoding\n    </locationmatch>\n\n    # Set type and headers for gzipped js\n    <locationmatch \"^/assets/.*\\.js\\.gz$\">\n        ForceType application/javascript\n        Header set Content-Encoding gzip\n        Header add Vary Accept-Encoding\n    </locationmatch>\n\n    # Compress HTML on the fly\n    AddOutputFilterByType DEFLATE text/html\n\n\n\u8a73\u7d30\u306a\u624b\u9806\u304c\u5fc5\u8981\u306a\u65b9\u306f\u62d9\u30d6\u30ed\u30b0\u8a18\u4e8b\uff08CentOS+Rails4+Apache2.2\u3067Puma\u3092\u8a2d\u5b9a\u3059\u308b | noriaki blog\uff09\u3092\u3069\u3046\u305e\u3002\n\n\u74b0\u5883\u60c5\u5831\n\nRuby, Rails, RubyGems\n% rake about\nAbout your application's environment\nRails version        4.2.0\nRuby version         2.1.5-p273 (x86_64-linux)\nRubyGems version     2.4.4\nRack version         1.5\n\n\nPuma\n% puma --version\npuma version 2.10.2\n\n\nApache\n% /usr/sbin/httpd -v\nServer version: Apache/2.2.15 (Unix)\nServer built:   Oct 16 2014 14:48:21\n\n\nCentOS\n% inxi -SM\nSystem:    Host: hakone.vps.sakura.ne.jp Kernel: 2.6.32-431.1.2.0.1.el6.x86_64 x86_64 (64 bit)\n           Console: tty 1 Distro: CentOS release 6.6 (Final)\nMachine:   System: Red Hat product: KVM v: RHEL 6.4.0 PC\n           Mobo: N/A model: N/A Bios: Sea v: 0.5.1 date: 01/01/2007\n\n\u3053\u306e\u8a18\u4e8b\u306f\u3001\u81ea\u5206\u306e\u8a18\u4e8b\u300c[CentOS+Rails4+Apache2.2\u3067Puma\u3092\u8a2d\u5b9a\u3059\u308b | noriaki blog](http://blog.noriaki.me/2015-01-12-development-rails-apache-puma-on-centos)\u300d\u306e\u8a2d\u5b9a\u90e8\u5206\u3092\u5099\u5fd8\u7684\u306b\u629c\u304d\u51fa\u3057\u305f\u3082\u306e\u306a\u306e\u3067\u3001\u8a73\u7d30\u306a\u624b\u9806\u306f\u8a18\u4e8b\u3092\u53c2\u7167\u306e\u3053\u3068\u3002\n\n## Puma\u8a2d\u5b9a\n### \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210\n\n~~~~zsh\n% mkdir -p tmp/pids\n% mkdir -p tmp/sockets\n~~~~\n\n### \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb(config/puma.rb)\n\n~~~~rb:config/puma.rb\nrequire 'active_support'\nrequire 'active_support/core_ext'\n\nrails_root = Dir.pwd\n\nunless ENV['RACK_ENV'] == 'production'\n  environment ENV['RACK_ENV'] || 'development'\n  daemonize true  # \u30c7\u30fc\u30e2\u30f3\u5316\n\n  workers 0  # 1\u4ee5\u4e0a\u3092\u6307\u5b9a\u3059\u308b\u3068Cluster\u5316\u3059\u308b\n  threads 0,2  # \u30b9\u30ec\u30c3\u30c9\u6570\uff08\u6700\u5c0f, \u6700\u5927\uff09\n\n  bind 'unix://' + File.join(rails_root, 'tmp', 'sockets', 'puma.sock')  # /PATH/TO/MYAPP/tmp/sockets/puma.sock\n  port 9293  # Port\u756a\u53f7\n\n  pidfile File.join(rails_root, 'tmp', 'pids', 'puma.pid')  # /PATH/TO/MYAPP/tmp/pids/puma.pid\n  state_path File.join(rails_root, 'tmp', 'puma.state')  # /PATH/TO/MYAPP/tmp/puma.state\n\n  stdout_redirect(  # puma\u306e\u30ed\u30b0\u3092log/\u4ee5\u4e0b\u306b\u51fa\u529b\u3059\u308b\u3002true\u306f\u8ffd\u8a18\u30e2\u30fc\u30c9\u3002\n    File.join(rails_root, 'log', 'puma.log'),\n    File.join(rails_root, 'log', 'puma-error.log'),\n    true\n  )\n\n  # pumactl\u306e\u30c8\u30fc\u30af\u30f3\u3092\u6307\u5b9a via. http://qiita.com/takkkun/items/ecdee7e7dec1bcc9a5b5\n  activate_control_app('auto', auth_token: rails_root.camelize.parameterize)\nend\n~~~~\n\n## Apache\u8a2d\u5b9a\n\n### \u30a2\u30d7\u30ea\u7528\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\n\n~~~~apache:conf.d/virtualhost_MYAPP.conf\n# -*- coding: utf-8; mode: conf; -*-\n\n##\n# MYAPP\n#\n<virtualhost *:80>\n    DocumentRoot \"/PATH/TO/MYAPP/public\" # Rails\u30a2\u30d7\u30ea\u306epublic\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\n    ServerName myapp.example.com  # Rails\u30a2\u30d7\u30ea\u306e\u30c9\u30e1\u30a4\u30f3\u3092\u6307\u5b9a\n\n    RewriteLog logs/MYAPP-rewrite_log\n    RewriteLogLevel 1\n    ErrorLog logs/MYAPP-error_log\n    CustomLog logs/MYAPP-access_log combined env=!no_log\n\n    SetEnv RACK_ENV developmen  # Rails\u30a2\u30d7\u30ea\u306e\u5b9f\u884c\u74b0\u5883(development/test/production)\n\n    # for puma config\n    include conf.d/puma-conf  # \u3053\u3053\u3067Puma\u5171\u901a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u308b\n    RewriteRule ^/(.*)$ http://0.0.0.0:9293%{REQUEST_URI} [P]  # '9293'\u306e\u3068\u3053\u308d\u306b\u306fconf/puma.rb\u3067\u6307\u5b9a\u3057\u305fPort\u756a\u53f7\u3092\u8a2d\u5b9a\n\n    <directory \"/PATH/TO/MYAPP/public\">\n        AllowOverride All\n        Options FollowSymLinks -MultiViews\n        Order deny,allow\n        Allow from all\n    </directory>\n\n</virtualhost>\n~~~~\n\n### Puma\u7528\u5171\u901a\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\n\n~~~~apache:conf.d/puma-conf\n# -*- coding: utf-8; mode: conf; -*-\n\n    # Redirect all requests that don't match a file on disk\n    # under DocumentRoot get proxied to Puma\n    RewriteEngine On\n    RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f\n\n    # Don't allow client to fool Puma into thinking connection is secure\n    RequestHeader unset X-Forwarded-Proto\n\n    # Disable ETags (https://github.com/h5bp/server-configs-apache/tree/master/doc#configure-etags)\n    # Set Expiration date for all assets to one year in the future\n    <locationmatch \"^/assets/.*$\">\n        Header unset ETag\n        FileETag None\n\n        ExpiresActive On\n        ExpiresDefault \"access plus 1 year\"\n    </locationmatch>\n\n    # Rewrite requests for js and css to gzipped versions\n    # if client and server support it\n    <locationmatch \"^/assets/.*\\.(css|js)$\">\n        RewriteEngine on\n        RewriteCond %{HTTP:Accept-Encoding} \\b(x-)?gzip\\b\n        RewriteCond %{REQUEST_FILENAME}.gz -s\n        RewriteRule ^(.+)$ $1.gz\n    </locationmatch>\n\n    # Set type and headers for gzipped css\n    <locationmatch \"^/assets/.*\\.css\\.gz$\">\n        ForceType text/css\n        Header set Content-Encoding gzip\n        Header add Vary Accept-Encoding\n    </locationmatch>\n\n    # Set type and headers for gzipped js\n    <locationmatch \"^/assets/.*\\.js\\.gz$\">\n        ForceType application/javascript\n        Header set Content-Encoding gzip\n        Header add Vary Accept-Encoding\n    </locationmatch>\n\n    # Compress HTML on the fly\n    AddOutputFilterByType DEFLATE text/html\n~~~~\n\n\u8a73\u7d30\u306a\u624b\u9806\u304c\u5fc5\u8981\u306a\u65b9\u306f[\u62d9\u30d6\u30ed\u30b0\u8a18\u4e8b\uff08CentOS+Rails4+Apache2.2\u3067Puma\u3092\u8a2d\u5b9a\u3059\u308b | noriaki blog\uff09](http://blog.noriaki.me/2015-01-12-development-rails-apache-puma-on-centos)\u3092\u3069\u3046\u305e\u3002\n\n## \u74b0\u5883\u60c5\u5831\n\n### Ruby, Rails, RubyGems\n\n~~~~zsh\n% rake about\nAbout your application's environment\nRails version        4.2.0\nRuby version         2.1.5-p273 (x86_64-linux)\nRubyGems version     2.4.4\nRack version         1.5\n~~~~\n\n### Puma\n\n~~~~zsh\n% puma --version\npuma version 2.10.2\n~~~~\n\n### Apache\n\n~~~~zsh\n% /usr/sbin/httpd -v\nServer version: Apache/2.2.15 (Unix)\nServer built:   Oct 16 2014 14:48:21\n~~~~\n\n### CentOS\n\n~~~~zsh\n% inxi -SM\nSystem:    Host: hakone.vps.sakura.ne.jp Kernel: 2.6.32-431.1.2.0.1.el6.x86_64 x86_64 (64 bit)\n           Console: tty 1 Distro: CentOS release 6.6 (Final)\nMachine:   System: Red Hat product: KVM v: RHEL 6.4.0 PC\n           Mobo: N/A model: N/A Bios: Sea v: 0.5.1 date: 01/01/2007\n~~~~\n", "tags": ["puma", "Rails", "CentOS", "Apache", "Ruby"]}