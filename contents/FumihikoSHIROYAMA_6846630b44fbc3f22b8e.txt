{"context": " More than 1 year has passed since last update.Google Compute Engine \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u76e3\u8996\u3092\u3069\u3046\u3059\u308b\u304b\u306f\u30b5\u30fc\u30d0\u7ba1\u7406\u8005\u306e\u60a9\u307f\u306e\u30bf\u30cd\u3060\u3068\u601d\u3044\u307e\u3059\u3002\nsensu\u3092\u5165\u308c\u305f\u308aMackerel\u3092\u5165\u308c\u305f\u308aDataDog\u3092\u8a66\u3057\u3066\u307f\u305f\u308a\u2026\u9078\u629e\u80a2\u306f\u8272\u3005\u3042\u308b\u3068\u601d\u3046\u3093\u3067\u3059\u304c\u3001\u4eca\u306a\u3089Google Cloud Monitoring\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\uff01\uff01\uff01\n\nGoogle Cloud Platform \u904b\u7528\u7ba1\u7406 - Cloud Monitoring \u7de8 \u3068\u3044\u3046\u30d6\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u306b\u975e\u5e38\u306b\u3088\u304f\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u50d5\u306e\u65b9\u3067\u3082\u3044\u304f\u3064\u304b\u88dc\u8db3\u3057\u306a\u304c\u3089\u89e3\u8aac\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u3067\u304d\u308b\u3053\u3068\n\n\nCPU Usage, Memory Usage, Disk Usage, Disk I/O, Network Traffic, Open TCP Connections, Processes \u306a\u3069\u306e\u57fa\u672c\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u60c5\u5831\u306e\u76e3\u8996\n\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306bHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u6b63\u5e38\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u308b\u304b\u76e3\u8996\n\u3053\u308c\u3089\u306eEmail, HipChat, SMS, Slack \u7b49\u3092\u4f7f\u3063\u305f\u30a2\u30e9\u30fc\u30c8\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3063\u305f MySQL, Nginx \u7b49\u306e\u5916\u90e8\u30d7\u30ed\u30c0\u30af\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53ef\u8996\u5316\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u547d\u540d\u898f\u5247\u3084\u30bf\u30b0\u3092\u5229\u7528\u3057\u305f\u67d4\u8edf\u306a\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\n\n\u306a\u3069\u306a\u3069\u3002\n\u3084\u306f\u308a\u4e00\u756a\u5b09\u3057\u3044\u306e\u306f\u3001\u3053\u308c\u3089\u306e\u6a5f\u80fd\u304c\u516c\u5f0f\u30c4\u30fc\u30eb\u3068\u3057\u3066\u7121\u6599\u3067\u5229\u7528\u53ef\u80fd\u3067\u3042\u308b\u70b9\u3067\u3059\u3002\nGoogle Cloud Monitoring powered by Stackdriver \u3068\u3042\u308b\u3088\u3046\u306b\u3001\u5143\u306fStackdriver\u3068\u3044\u3046\u76e3\u8996\u30c4\u30fc\u30eb\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u304cGoogle\u306b\u8cb7\u53ce\u3055\u308c\u3066\u516c\u5f0f\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u89e3\u8aac\u3067\u3082Stackdriver Agent\u307f\u305f\u3044\u306a\u611f\u3058\u3067Stackdriver\u3068\u3044\u3046\u7528\u8a9e\u304c\u30b5\u30e9\u30c3\u3068\u51fa\u3066\u304d\u307e\u3059\u304c\u3001\u672c\u8a18\u4e8b\u3067\u306fGoogle Cloud Monitoring\u3068Stackdriver\u306f\u672c\u8cea\u7684\u306b\u540c\u3058\u3082\u306e\u3068\u3057\u3066\u6271\u3063\u3066\u3044\u307e\u3059\u3002\n\nGoogle Cloud Monitoring \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u4f55\u3082\u8003\u3048\u305a\u306b\u4ee5\u4e0b\u306e\u901a\u308a\u306b\u30b3\u30d4\u30da\u3057\u3066\u76e3\u8996\u7528\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\nhttps://app.google.stackdriver.com/settings/apikeys/ \u3067 API Key \u3092\u53d6\u5f97\nshell> curl -O https://repo.stackdriver.com/stack-install.sh\nshell> sudo bash stack-install.sh --api-key=[API Key]\n\n\u57fa\u672c\u7684\u306b\u306f\u3053\u308c\u3060\u3051\uff01\n\u524d\u51fa\u306e\u516c\u5f0f\u30d6\u30ed\u30b0\u306b\u306fDebian\u7528\u306e\u89e3\u8aac\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u624b\u5143\u306eCentOS 6.7\u3068Debian 8\u3067\u5168\u304f\u540c\u69d8\u306b\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u6e08\u307f\u3067\u3059\u3002\n\u65e9\u901f https://app.google.stackdriver.com/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\nInfrastructure > Instances\u3068\u9078\u3093\u3067\u3044\u304f\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u305d\u3053\u304b\u3089Cloud Monitoring\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u307e\u3059\u306d\uff01\n\nGroup \u3092\u4f5c\u3063\u3066\u307f\u308b\n\u8907\u6570\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070 rails, redis, db \u306e\u3088\u3046\u306b\u7a2e\u985e\u3054\u3068\u306b\u5206\u3051\u308b\u3082\u3088\u3057\u3001production, staging, development \u306e\u3088\u3046\u306b\u7528\u9014\u3054\u3068\u306b\u5206\u3051\u308b\u3082\u3088\u3057\u3002\u8a2d\u8a08\u306f\u81ea\u7531\u3067\u3059\u3002\nGroups > Create \u3068\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f rails \u3068\u3044\u3046Group Name\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30b0\u306b rails \u3068\u3044\u3046\u30bf\u30b0\u304c\u3064\u3044\u3066\u3044\u308b\u3082\u306e\u3092\u6761\u4ef6\u3068\u3057\u3066\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6761\u4ef6\u306f\u3001\u547d\u540d\u898f\u5247\u3060\u3063\u305f\u308a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3060\u3063\u305f\u308a\u30ea\u30fc\u30b8\u30e7\u30f3\u3060\u3063\u305f\u308a\u3001\u304b\u306a\u308a\u81ea\u7531\u5ea6\u9ad8\u304f\u8a2d\u8a08\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\nAlert \u3092\u4f5c\u3063\u3066\u307f\u308b\n\u524d\u8ff0\u306e Group \u306f\u5358\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u675f\u306d\u3066\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u307f\u306a\u3089\u305a\u3001\u30a2\u30e9\u30fc\u30c8\u306b\u5229\u7528\u3059\u308b\u3068\u4fbf\u5229\u3067\u3059\u3002\n\u3053\u3053\u3067\u306f Rails \u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u3069\u308c\u304b\u304c CPU\u8ca0\u8377, \u30e1\u30e2\u30ea\u4f7f\u7528\u91cf, \u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf \u304c\u9ad8\u304f\u306a\u308b\u3068\u30e1\u30fc\u30eb\u3067\u30a2\u30e9\u30fc\u30c8\u3092\u9001\u308b\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u3067\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\nAlerting > Create Alerting Policy \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u3092\u76e3\u8996\u3059\u308b\n\u4efb\u610f\u306e Policy Name \u3092\u3064\u3051\u3001Metric Threshold \u3067 Next \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f RESOURCE TYPE \u3092 Instances \u306b\u3057\u3066\u3001APPLIEST TO \u3092 Group Rails \u306b\u3001CONDITION TRIGGERS IF \u3092 Any Member Violates \u306b\u3057\u3066\u3001\u3069\u308c\u304b\u3072\u3068\u3064\u3067\u3082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6761\u4ef6\u3092\u7834\u308c\u3070\u30a2\u30e9\u30fc\u30c8\u3092\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u306f\u7121\u8ad6\u3001\u5168\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6761\u4ef6\u3092\u7834\u308c\u3070\u3068\u3082\u3067\u304d\u307e\u3059\u3057\u3001\u5168\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306en%\u304c\u3001\u3068\u3044\u3046\u98a8\u306b\u3082\u51fa\u6765\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u3053\u3053\u3067\u306fCPU\u8ca0\u8377\u304c90%\u4ee5\u4e0a\u306e\u72b6\u614b\u304c5\u5206\u3064\u3065\u3044\u305f\u3089\u7570\u5e38\u3068\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u6761\u4ef6\u306f\u3053\u306e\u4ed6\u306b\u3082\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\u3088\u304f\u4f7f\u3046\u306e\u306f Memory Used, Volume Usage \u306a\u3069\u3067\u3059\u3002\n\n\n\u30d7\u30ed\u30bb\u30b9\u3092\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\n\u540c\u69d8\u306b\u3001Process Health \u304b\u3089\u306f\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3092\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n\u76e3\u8996\u3059\u308bTARGET\u307e\u3067\u306f\u540c\u69d8\u3067\u3001CONFIGURATION\u30bf\u30d6\u3067 deploy \u30e6\u30fc\u30b6\u304c\u5b9f\u884c\u3059\u308b unicorn \u306e\u30d7\u30ed\u30bb\u30b9\u304c 5\u5206\u4ee5\u4e0a, 1\u672a\u6e80 \u306b\u306a\u3063\u305f\u5834\u5408\u306b\u7570\u5e38\u3092\u691c\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u6761\u4ef6\u306b\u30de\u30c3\u30c1\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30a6\u30a7\u30d6\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u975e\u5e38\u306b\u76f4\u611f\u7684\u3067\u4fbf\u5229\u3067\u3059\u3002\n\n\u901a\u77e5\u3059\u308b\n\u6700\u5f8c\u306b\u901a\u77e5\u5148\u3092\u9078\u3073\u307e\u3059\u3002\u3053\u3053\u3067\u306fEmail\u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3082\u3061\u308d\u3093HipChat\u3084Slack\u3068\u3082\u8d85\u7c21\u5358\u306b\u9023\u643a\u3067\u304d\u307e\u3059\u3002\n\n\nHTTP\u3067\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u76e3\u8996\u3059\u308b\n\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u3066\u3044\u308b\u304b\u3060\u3051\u3067\u306a\u304f\u3001\u6b63\u3057\u3044HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u3066\u3044\u308b\u304b\u5426\u304b\u3068\u3044\u3046\u3088\u3046\u306a\u3053\u3068\u3082\u7c21\u5358\u306b\u76e3\u8996\u3067\u304d\u307e\u3059\u3002\nAlerting > Uptime Checks \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u5c11\u3057\u5206\u304b\u308a\u3065\u3089\u3044\u3067\u3059\u304c\u753b\u9762\u53f3\u306e Add Uptime Check \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n\u3053\u3053\u3067\u306f http://blog.mana.bo/ \u30925\u5206\u304a\u304d\u306b\u76e3\u8996\u3057\u3066\u3044\u307e\u3059\u3002\n\nAdvanced Options \u3092\u62bc\u3059\u3053\u3068\u3067\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u30db\u30b9\u30c8\u30d8\u30c3\u30c0\u3092\u8a2d\u5b9a\u3057\u305f\u308a\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u7279\u5b9a\u306e\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u691c\u8a3c\u3057\u305f\u308a\u3001\u4efb\u610f\u306e\u30d8\u30c3\u30c0\u3092\u4ed5\u8fbc\u3093\u3060\u308a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n\u307e\u305f\u76e3\u8996\u5bfe\u8c61\u306fURL\u3060\u3051\u3067\u306a\u304f\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3084AppEngine\u3082\u9078\u629e\u53ef\u80fd\u3067\u3059\u3002\n\n\u76e3\u8996\u5bfe\u8c61\u3092\u8a2d\u5b9a\u3057\u305f\u3089\u524d\u7bc0\u3068\u540c\u69d8\u306b\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u7570\u5e38\u304c\u8d77\u3053\u3063\u305f\u5834\u5408\u306b\u691c\u77e5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nNginx\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\n\u7d44\u307f\u8fbc\u307f\u306e\u76e3\u8996\u9805\u76ee\u3060\u3051\u3067\u306a\u304f\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u5916\u90e8\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u8a73\u7d30\u306a\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u3053\u3053\u3067\u306fNginx\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3063\u3066Nginx\u306e\u8272\u3005\u306a\u60c5\u5831\u3092Cloud Monitoring\u306b\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n1. Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\nshell> sudo vim /etc/nginx/sites-available/monitoring\nserver {\n   listen 80;\n   server_name local-stackdriver-agent.stackdriver.com;\n   location /nginx_status {\n     stub_status on;\n     access_log   off;\n     allow 127.0.0.1;\n     deny all;\n   }\n   location / {\n     root /dev/null;\n   }\n}\n\n2. Nginx\u518d\u8d77\u52d5\nshell> ln -s /etc/nginx/sites-available/monitoring /etc/nginx/sites-enabled/monitoring\nshell> sudo nginx -t\nshell> sudo systemctl restart nginx.service # Debian\u7cfb\nshell> sudo service nginx restart  # RedHat\u7cfb\n\n3. \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\nshell> sudo vim /opt/stackdriver/collectd/etc/collectd.d/nginx.conf\nLoadPlugin \"nginx\"\n<Plugin \"nginx\">\n URL \"http://local-stackdriver-agent.stackdriver.com/nginx_status\"\n</Plugin>\n\nshell> sudo systemctl restart stackdriver-agent # Debian\u7cfb\nshell> sudo service stackdriver-agent restart # RedHat\u7cfb\n\nInfrastructure > Instances \u304b\u3089Nginx\u306e\u52d5\u3044\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u8d77\u52d5\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b NGINX \u30bf\u30d6\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\u7b49\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u6210\u529f\u3067\u3059\uff01\n\n\n\u53cd\u6620\u306b\u306f\u591a\u5c11\u6642\u5dee\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\nMySQL\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\n\u4e0a\u8ff0\u306eNginx\u540c\u69d8\u3001MySQL\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n1. show status\u3067\u304d\u308b\u3060\u3051\u306e\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0\nmysql> CREATE USER 'monitoring'@'127.0.0.1' IDENTIFIED BY 'monitoring';\n\n2. \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a\nshell> vim /opt/stackdriver/collectd/etc/collectd.d/mysql.conf\nLoadPlugin \"mysql\"\n<Plugin \"mysql\">\n <Database \"your_db_name\">\n   Host \"127.0.0.1\"\n   User \"monitoring\"\n   Password \"monitoring\"\n   Port 3306\n </Database>\n</Plugin>\n\nshell> sudo systemctl restart stackdriver-agent / sudo service stackdriver-agent restart\n\n\u2026\u304c\u3001\u30a8\u30e9\u30fc\u767a\u751f\uff01\nNov 18 16:42:05 staging-manabo-db-master collectd[12871]: lt_dlopen (\"/opt/stackdriver/collectd/lib/collectd/mysql.so\") failed: file not found. The most common cause for this problem is missing dependencies. Use ldd(1) to check the dependencies of the plugin / shared object.\nNov 18 16:42:05 staging-manabo-db-master collectd[12871]: plugin_load: Load plugin \"mysql\" failed with status 1.\n\n\u4f55\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u304b\u8abf\u3079\u3066\u307f\u308b\u3002\nshell> root@staging-manabo-db-master:~# ldd /opt/stackdriver/collectd/lib/collectd/mysql.so\n        linux-vdso.so.1 (0x00007ffd8b064000)\n        libmysqlclient.so.18 => not found\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f0e6960c000)\n        libz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007f0e693f1000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f0e690f0000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f0e68eec000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f0e68b43000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f0e69a2f000)\n\n\u3053\u306e\u74b0\u5883 (Debian 8) \u3067\u306f libmysqlclient.so.18 \u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3080\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u691c\u7d22\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u306a\u304a\u3001RedHat\u7cfb\u3067\u306f yum provides */libmysqlclient.so.18 \u3068\u304b\u3059\u308c\u3070\u826f\u3044\u3002\n\u8a73\u3057\u304f\u306f Debian\u7cfb RedHat\u7cfb \u3067\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b3\u30de\u30f3\u30c9\u5bfe\u5fdc\u8868 \u3092\u53c2\u7167\u3002\nshell> apt-file search \"libmysqlclient.so.18\"\nlibmysqlclient18: /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18\nlibmysqlclient18: /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18.0.0\n\nshell> sudo apt-get install libmysqlclient18\nshell> sudo systemctl restart stackdriver-agent / sudo service stackdriver-agent restart\nshell> sudo systemctl status stackdriver-agent / sudo service stackdriver-agent status\n\n\u7279\u306b\u30a8\u30e9\u30fc\u3082\u51fa\u3066\u3044\u306a\u3044\u306e\u3067\u5b8c\u4e86\uff01\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u2026\n\n\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff01\n\n\u307e\u3068\u3081\n\u3053\u308c\u3060\u3051\u306e\u6a5f\u80fd\u304c\u6a19\u6e96\u3067\u3057\u304b\u3082\u7121\u6599\u3067\u63c3\u3063\u3066\u3044\u308b\u306e\u306f\u76f8\u5f53\u5fc3\u5f37\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u307f\u306a\u3055\u3093\u3082\u662f\u975e\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\nGoogle Compute Engine \u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u76e3\u8996\u3092\u3069\u3046\u3059\u308b\u304b\u306f\u30b5\u30fc\u30d0\u7ba1\u7406\u8005\u306e\u60a9\u307f\u306e\u30bf\u30cd\u3060\u3068\u601d\u3044\u307e\u3059\u3002\n[sensu](https://sensuapp.org/)\u3092\u5165\u308c\u305f\u308a[Mackerel](https://mackerel.io/ja/)\u3092\u5165\u308c\u305f\u308a[DataDog](https://www.datadoghq.com/jp/)\u3092\u8a66\u3057\u3066\u307f\u305f\u308a\u2026\u9078\u629e\u80a2\u306f\u8272\u3005\u3042\u308b\u3068\u601d\u3046\u3093\u3067\u3059\u304c\u3001\u4eca\u306a\u3089[Google Cloud Monitoring](https://cloud.google.com/monitoring/?hl=ja)\u304c\u30aa\u30b9\u30b9\u30e1\u3067\u3059\uff01\uff01\uff01\n\n<img width=\"493\" alt=\"Cloud Monitoring.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/de15fc34-903c-11f2-c887-e1a6afe4da09.png\">\n\n[Google Cloud Platform \u904b\u7528\u7ba1\u7406 - Cloud Monitoring \u7de8](http://googlecloudplatform-japan.blogspot.jp/2015/11/google-cloud-platform-cloud-monitoring.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed:+GoogleCloudPlatformJapanBlog+(Google+Cloud+Platform+Japan+Blog)) \u3068\u3044\u3046\u30d6\u30ed\u30b0\u30a8\u30f3\u30c8\u30ea\u306b\u975e\u5e38\u306b\u3088\u304f\u307e\u3068\u307e\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u50d5\u306e\u65b9\u3067\u3082\u3044\u304f\u3064\u304b\u88dc\u8db3\u3057\u306a\u304c\u3089\u89e3\u8aac\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u3067\u304d\u308b\u3053\u3068\n\n1. `CPU Usage`, `Memory Usage`, `Disk Usage`, `Disk I/O`, `Network Traffic`, `Open TCP Connections`, `Processes` \u306a\u3069\u306e\u57fa\u672c\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u60c5\u5831\u306e\u76e3\u8996\n2. \u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\n3. \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306bHTTP\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u6b63\u5e38\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u308b\u304b\u76e3\u8996\n4. \u3053\u308c\u3089\u306e`Email`, `HipChat`, `SMS`, `Slack` \u7b49\u3092\u4f7f\u3063\u305f\u30a2\u30e9\u30fc\u30c8\n5. \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3063\u305f `MySQL`, `Nginx` \u7b49\u306e\u5916\u90e8\u30d7\u30ed\u30c0\u30af\u30c8\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u53ef\u8996\u5316\n6. \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u547d\u540d\u898f\u5247\u3084\u30bf\u30b0\u3092\u5229\u7528\u3057\u305f\u67d4\u8edf\u306a\u30b0\u30eb\u30fc\u30d4\u30f3\u30b0\n\n\u306a\u3069\u306a\u3069\u3002\n\u3084\u306f\u308a\u4e00\u756a\u5b09\u3057\u3044\u306e\u306f\u3001\u3053\u308c\u3089\u306e\u6a5f\u80fd\u304c\u516c\u5f0f\u30c4\u30fc\u30eb\u3068\u3057\u3066\u7121\u6599\u3067\u5229\u7528\u53ef\u80fd\u3067\u3042\u308b\u70b9\u3067\u3059\u3002\n\nGoogle Cloud Monitoring **powered by Stackdriver** \u3068\u3042\u308b\u3088\u3046\u306b\u3001\u5143\u306fStackdriver\u3068\u3044\u3046\u76e3\u8996\u30c4\u30fc\u30eb\u3060\u3063\u305f\u3088\u3046\u3067\u3059\u304cGoogle\u306b\u8cb7\u53ce\u3055\u308c\u3066\u516c\u5f0f\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u30c4\u30fc\u30eb\u306b\u306a\u3063\u305f\u3088\u3046\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u89e3\u8aac\u3067\u3082`Stackdriver Agent`\u307f\u305f\u3044\u306a\u611f\u3058\u3067Stackdriver\u3068\u3044\u3046\u7528\u8a9e\u304c\u30b5\u30e9\u30c3\u3068\u51fa\u3066\u304d\u307e\u3059\u304c\u3001\u672c\u8a18\u4e8b\u3067\u306fGoogle Cloud Monitoring\u3068Stackdriver\u306f\u672c\u8cea\u7684\u306b\u540c\u3058\u3082\u306e\u3068\u3057\u3066\u6271\u3063\u3066\u3044\u307e\u3059\u3002\n\n# Google Cloud Monitoring \u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\n\u4f55\u3082\u8003\u3048\u305a\u306b\u4ee5\u4e0b\u306e\u901a\u308a\u306b\u30b3\u30d4\u30da\u3057\u3066\u76e3\u8996\u7528\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n1. https://app.google.stackdriver.com/settings/apikeys/ \u3067 `API Key` \u3092\u53d6\u5f97\n2. `shell> curl -O https://repo.stackdriver.com/stack-install.sh`\n3. `shell> sudo bash stack-install.sh --api-key=[API Key]`\n\n\u57fa\u672c\u7684\u306b\u306f\u3053\u308c\u3060\u3051\uff01\n\u524d\u51fa\u306e\u516c\u5f0f\u30d6\u30ed\u30b0\u306b\u306fDebian\u7528\u306e\u89e3\u8aac\u3068\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u304c\u3001\u624b\u5143\u306e`CentOS 6.7`\u3068`Debian 8`\u3067\u5168\u304f\u540c\u69d8\u306b\u5229\u7528\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u6e08\u307f\u3067\u3059\u3002\n\n\u65e9\u901f https://app.google.stackdriver.com/ \u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n![Instances](https://qiita-image-store.s3.amazonaws.com/0/37089/901afd2f-37b3-ceff-b8f5-2d097a17cef5.png)\n\n`Infrastructure > Instances`\u3068\u9078\u3093\u3067\u3044\u304f\u3068\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u4e00\u89a7\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\n\u305d\u3053\u304b\u3089Cloud Monitoring\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u9078\u3093\u3067\u304f\u3060\u3055\u3044\u3002\n\n![overview.png](https://qiita-image-store.s3.amazonaws.com/0/37089/631bce11-6573-9fda-5ecd-9150bc04f73b.png)\n\n<img width=\"670\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 22.39.22.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/2878f858-ba75-e96b-a0bc-8a05db5a5da2.png\">\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u60c5\u5831\u304c\u53d6\u5f97\u3067\u304d\u3066\u3044\u307e\u3059\u306d\uff01\n\n# Group \u3092\u4f5c\u3063\u3066\u307f\u308b\n\n\u8907\u6570\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u30b0\u30eb\u30fc\u30d7\u3067\u7ba1\u7406\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\u305f\u3068\u3048\u3070 `rails`, `redis`, `db` \u306e\u3088\u3046\u306b\u7a2e\u985e\u3054\u3068\u306b\u5206\u3051\u308b\u3082\u3088\u3057\u3001`production`, `staging`, `development` \u306e\u3088\u3046\u306b\u7528\u9014\u3054\u3068\u306b\u5206\u3051\u308b\u3082\u3088\u3057\u3002\u8a2d\u8a08\u306f\u81ea\u7531\u3067\u3059\u3002\n\n`Groups > Create` \u3068\u9078\u629e\u3057\u307e\u3059\u3002\n\n<img width=\"274\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 22.56.07.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/e2d7b1d9-f50c-42c5-1009-2830fd48fc1c.png\">\n\n\u3053\u3053\u3067\u306f `rails` \u3068\u3044\u3046Group Name\u3067\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u30bf\u30b0\u306b `rails` \u3068\u3044\u3046\u30bf\u30b0\u304c\u3064\u3044\u3066\u3044\u308b\u3082\u306e\u3092\u6761\u4ef6\u3068\u3057\u3066\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"460\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 22.57.03.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/8a850a64-acb8-99e4-085a-104967fc1f5a.png\">\n\n\u6761\u4ef6\u306f\u3001\u547d\u540d\u898f\u5247\u3060\u3063\u305f\u308a\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u3060\u3063\u305f\u308a\u30ea\u30fc\u30b8\u30e7\u30f3\u3060\u3063\u305f\u308a\u3001\u304b\u306a\u308a\u81ea\u7531\u5ea6\u9ad8\u304f\u8a2d\u8a08\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n# Alert \u3092\u4f5c\u3063\u3066\u307f\u308b\n\n\u524d\u8ff0\u306e Group \u306f\u5358\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u675f\u306d\u3066\u898b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u307f\u306a\u3089\u305a\u3001\u30a2\u30e9\u30fc\u30c8\u306b\u5229\u7528\u3059\u308b\u3068\u4fbf\u5229\u3067\u3059\u3002\n\n\u3053\u3053\u3067\u306f `Rails` \u30b0\u30eb\u30fc\u30d7\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u3069\u308c\u304b\u304c `CPU\u8ca0\u8377`, `\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf`, `\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf` \u304c\u9ad8\u304f\u306a\u308b\u3068\u30e1\u30fc\u30eb\u3067\u30a2\u30e9\u30fc\u30c8\u3092\u9001\u308b\u3068\u3044\u3046\u30b7\u30ca\u30ea\u30aa\u3067\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n`Alerting > Create Alerting Policy` \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n<img width=\"237\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.00.19.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/c38cc36e-20a5-72fa-91f3-0ec7f4d26ad8.png\">\n\n## \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u3092\u76e3\u8996\u3059\u308b\n\n\u4efb\u610f\u306e Policy Name \u3092\u3064\u3051\u3001`Metric Threshold` \u3067 `Next` \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n<img width=\"959\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.01.35.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/d9dadea7-9fcc-20b4-f51b-edaa65c8502e.png\">\n\n\u3053\u3053\u3067\u306f RESOURCE TYPE \u3092 `Instances` \u306b\u3057\u3066\u3001APPLIEST TO \u3092 `Group Rails` \u306b\u3001CONDITION TRIGGERS IF \u3092 `Any Member Violates` \u306b\u3057\u3066\u3001\u3069\u308c\u304b\u3072\u3068\u3064\u3067\u3082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6761\u4ef6\u3092\u7834\u308c\u3070\u30a2\u30e9\u30fc\u30c8\u3092\u51fa\u3059\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u306f\u7121\u8ad6\u3001\u5168\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u6761\u4ef6\u3092\u7834\u308c\u3070\u3068\u3082\u3067\u304d\u307e\u3059\u3057\u3001\u5168\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4e2d\u306en%\u304c\u3001\u3068\u3044\u3046\u98a8\u306b\u3082\u51fa\u6765\u307e\u3059\u3002\n\n<img width=\"503\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.02.13.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/9b72dde3-bb95-f690-2817-e0e7ef6fd1ab.png\">\n\n\u6700\u5f8c\u306b\u3053\u3053\u3067\u306fCPU\u8ca0\u8377\u304c90%\u4ee5\u4e0a\u306e\u72b6\u614b\u304c5\u5206\u3064\u3065\u3044\u305f\u3089\u7570\u5e38\u3068\u8a2d\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u6761\u4ef6\u306f\u3053\u306e\u4ed6\u306b\u3082\u8907\u6570\u8a2d\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n\u3088\u304f\u4f7f\u3046\u306e\u306f `Memory Used`, `Volume Usage` \u306a\u3069\u3067\u3059\u3002\n\n<img width=\"709\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.02.31.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/34ec07eb-10d4-b2d9-a664-ddf3a70c86b8.png\">\n\n## \u30d7\u30ed\u30bb\u30b9\u3092\u6b7b\u6d3b\u76e3\u8996\u3059\u308b\n\n\u540c\u69d8\u306b\u3001`Process Health` \u304b\u3089\u306f\u30d7\u30ed\u30bb\u30b9\u306e\u6b7b\u6d3b\u76e3\u8996\u3092\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u307e\u3059\u3002\n\n<img width=\"956\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.18.58.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/779f7c6c-cb47-f334-e92e-9fb9295f7aeb.png\">\n\n\u76e3\u8996\u3059\u308bTARGET\u307e\u3067\u306f\u540c\u69d8\u3067\u3001CONFIGURATION\u30bf\u30d6\u3067 `deploy` \u30e6\u30fc\u30b6\u304c\u5b9f\u884c\u3059\u308b `unicorn` \u306e\u30d7\u30ed\u30bb\u30b9\u304c `5\u5206\u4ee5\u4e0a`, `1\u672a\u6e80` \u306b\u306a\u3063\u305f\u5834\u5408\u306b\u7570\u5e38\u3092\u691c\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"612\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.23.00.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/4a547c47-ab8d-81ab-8b46-c560a71a1b5a.png\">\n\n\u6761\u4ef6\u306b\u30de\u30c3\u30c1\u3059\u308b\u30d7\u30ed\u30bb\u30b9\u304c\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30a6\u30a7\u30d6\u753b\u9762\u306b\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u975e\u5e38\u306b\u76f4\u611f\u7684\u3067\u4fbf\u5229\u3067\u3059\u3002\n\n## \u901a\u77e5\u3059\u308b\n\n\u6700\u5f8c\u306b\u901a\u77e5\u5148\u3092\u9078\u3073\u307e\u3059\u3002\u3053\u3053\u3067\u306fEmail\u3092\u9078\u629e\u3057\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"646\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.12.55.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/ace3a833-53d0-bdb5-c7c5-c0fa6ba3ff9b.png\">\n\n\u3082\u3061\u308d\u3093HipChat\u3084Slack\u3068\u3082\u8d85\u7c21\u5358\u306b\u9023\u643a\u3067\u304d\u307e\u3059\u3002\n\n<img width=\"242\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.13.20.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/ecc16f13-cd19-6ad7-6d9b-6cda925371af.png\">\n\n# HTTP\u3067\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u76e3\u8996\u3059\u308b\n\n\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u3066\u3044\u308b\u304b\u3060\u3051\u3067\u306a\u304f\u3001\u6b63\u3057\u3044HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u8fd4\u305b\u3066\u3044\u308b\u304b\u5426\u304b\u3068\u3044\u3046\u3088\u3046\u306a\u3053\u3068\u3082\u7c21\u5358\u306b\u76e3\u8996\u3067\u304d\u307e\u3059\u3002\n`Alerting > Uptime Checks` \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n<img width=\"234\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.25.57.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/052d45d5-304d-afe2-a1f0-cce127b5465e.png\">\n\n\u5c11\u3057\u5206\u304b\u308a\u3065\u3089\u3044\u3067\u3059\u304c\u753b\u9762\u53f3\u306e `Add Uptime Check` \u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\n<img width=\"224\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.26.25.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/3cf08687-ed26-9b4f-466d-77561538884d.png\">\n\n\u3053\u3053\u3067\u306f `http://blog.mana.bo/` \u30925\u5206\u304a\u304d\u306b\u76e3\u8996\u3057\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"501\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.27.02.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/b6849571-463a-81a3-685e-b700409aba45.png\">\n\n`Advanced Options` \u3092\u62bc\u3059\u3053\u3068\u3067\u30d0\u30fc\u30c1\u30e3\u30eb\u30db\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306e\u30db\u30b9\u30c8\u30d8\u30c3\u30c0\u3092\u8a2d\u5b9a\u3057\u305f\u308a\u3001\u30ec\u30b9\u30dd\u30f3\u30b9\u306b\u7279\u5b9a\u306e\u6587\u5b57\u5217\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u691c\u8a3c\u3057\u305f\u308a\u3001\u4efb\u610f\u306e\u30d8\u30c3\u30c0\u3092\u4ed5\u8fbc\u3093\u3060\u308a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\n<img width=\"462\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.28.26.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/8d96be35-0aa4-309b-147b-37e34888113b.png\">\n\n\u307e\u305f\u76e3\u8996\u5bfe\u8c61\u306fURL\u3060\u3051\u3067\u306a\u304f\u3001\u30ed\u30fc\u30c9\u30d0\u30e9\u30f3\u30b5\u3084AppEngine\u3082\u9078\u629e\u53ef\u80fd\u3067\u3059\u3002\n\n<img width=\"494\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.27.24.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/bb7c4ea5-36bc-043e-1f88-7580c4d5c55c.png\">\n\n\u76e3\u8996\u5bfe\u8c61\u3092\u8a2d\u5b9a\u3057\u305f\u3089\u524d\u7bc0\u3068\u540c\u69d8\u306b\u30a2\u30e9\u30fc\u30c8\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u7570\u5e38\u304c\u8d77\u3053\u3063\u305f\u5834\u5408\u306b\u691c\u77e5\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n# Nginx\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\n\n\u7d44\u307f\u8fbc\u307f\u306e\u76e3\u8996\u9805\u76ee\u3060\u3051\u3067\u306a\u304f\u3001\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3067\u5916\u90e8\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u8a73\u7d30\u306a\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u8868\u793a\u3059\u308b\u3053\u3068\u304c\u53ef\u80fd\u3067\u3059\u3002\n\u3053\u3053\u3067\u306fNginx\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f7f\u3063\u3066Nginx\u306e\u8272\u3005\u306a\u60c5\u5831\u3092Cloud Monitoring\u306b\u8868\u793a\u3057\u3066\u307f\u307e\u3059\u3002\n\n**1. Nginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0**\n\n```zsh\nshell> sudo vim /etc/nginx/sites-available/monitoring\nserver {\n   listen 80;\n   server_name local-stackdriver-agent.stackdriver.com;\n   location /nginx_status {\n     stub_status on;\n     access_log   off;\n     allow 127.0.0.1;\n     deny all;\n   }\n   location / {\n     root /dev/null;\n   }\n}\n```\n\n**2. Nginx\u518d\u8d77\u52d5**\n\n```zsh\nshell> ln -s /etc/nginx/sites-available/monitoring /etc/nginx/sites-enabled/monitoring\nshell> sudo nginx -t\nshell> sudo systemctl restart nginx.service # Debian\u7cfb\nshell> sudo service nginx restart  # RedHat\u7cfb\n```\n\n**3. \u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a**\n\n```zsh\nshell> sudo vim /opt/stackdriver/collectd/etc/collectd.d/nginx.conf\nLoadPlugin \"nginx\"\n<Plugin \"nginx\">\n URL \"http://local-stackdriver-agent.stackdriver.com/nginx_status\"\n</Plugin>\n\nshell> sudo systemctl restart stackdriver-agent # Debian\u7cfb\nshell> sudo service stackdriver-agent restart # RedHat\u7cfb\n```\n\n`Infrastructure > Instances` \u304b\u3089Nginx\u306e\u52d5\u3044\u3066\u3044\u308b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u8d77\u52d5\u3057\u3066\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b `NGINX` \u30bf\u30d6\u306b\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u6570\u7b49\u304c\u78ba\u8a8d\u3067\u304d\u308c\u3070\u6210\u529f\u3067\u3059\uff01\n\n<img width=\"674\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.38.32.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/3cf011f9-b5df-c48d-170c-3bb7e255adac.png\">\n\n<img width=\"689\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.38.41.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/7ed23a54-29e8-900f-a814-8142b71ca124.png\">\n\n\u53cd\u6620\u306b\u306f\u591a\u5c11\u6642\u5dee\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\n\n# MySQL\u30d7\u30e9\u30b0\u30a4\u30f3\u8a2d\u5b9a\n\n\u4e0a\u8ff0\u306eNginx\u540c\u69d8\u3001MySQL\u30d7\u30e9\u30b0\u30a4\u30f3\u3082\u975e\u5e38\u306b\u4fbf\u5229\u3067\u3059\u3002\n\n**1. show status\u3067\u304d\u308b\u3060\u3051\u306e\u30e6\u30fc\u30b6\u3092\u8ffd\u52a0**\n\n```sql\nmysql> CREATE USER 'monitoring'@'127.0.0.1' IDENTIFIED BY 'monitoring';\n```\n\n**2. \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u8a2d\u5b9a**\n\n```zsh\nshell> vim /opt/stackdriver/collectd/etc/collectd.d/mysql.conf\nLoadPlugin \"mysql\"\n<Plugin \"mysql\">\n <Database \"your_db_name\">\n   Host \"127.0.0.1\"\n   User \"monitoring\"\n   Password \"monitoring\"\n   Port 3306\n </Database>\n</Plugin>\n\nshell> sudo systemctl restart stackdriver-agent / sudo service stackdriver-agent restart\n```\n\n\u2026\u304c\u3001\u30a8\u30e9\u30fc\u767a\u751f\uff01\n\n```zsh\nNov 18 16:42:05 staging-manabo-db-master collectd[12871]: lt_dlopen (\"/opt/stackdriver/collectd/lib/collectd/mysql.so\") failed: file not found. The most common cause for this problem is missing dependencies. Use ldd(1) to check the dependencies of the plugin / shared object.\nNov 18 16:42:05 staging-manabo-db-master collectd[12871]: plugin_load: Load plugin \"mysql\" failed with status 1.\n```\n\n\u4f55\u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u304b\u8abf\u3079\u3066\u307f\u308b\u3002\n\n```zsh\nshell> root@staging-manabo-db-master:~# ldd /opt/stackdriver/collectd/lib/collectd/mysql.so\n        linux-vdso.so.1 (0x00007ffd8b064000)\n        libmysqlclient.so.18 => not found\n        libpthread.so.0 => /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f0e6960c000)\n        libz.so.1 => /lib/x86_64-linux-gnu/libz.so.1 (0x00007f0e693f1000)\n        libm.so.6 => /lib/x86_64-linux-gnu/libm.so.6 (0x00007f0e690f0000)\n        libdl.so.2 => /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f0e68eec000)\n        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f0e68b43000)\n        /lib64/ld-linux-x86-64.so.2 (0x00007f0e69a2f000)\n```\n\n\u3053\u306e\u74b0\u5883 (Debian 8) \u3067\u306f `libmysqlclient.so.18` \u304c\u8db3\u308a\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3080\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u691c\u7d22\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3002\n\u306a\u304a\u3001RedHat\u7cfb\u3067\u306f `yum provides */libmysqlclient.so.18` \u3068\u304b\u3059\u308c\u3070\u826f\u3044\u3002\n\u8a73\u3057\u304f\u306f [Debian\u7cfb RedHat\u7cfb \u3067\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u7ba1\u7406\u30b3\u30de\u30f3\u30c9\u5bfe\u5fdc\u8868](http://qiita.com/FumihikoSHIROYAMA/items/47154bb4e38f5b42e318) \u3092\u53c2\u7167\u3002\n\n```zsh\nshell> apt-file search \"libmysqlclient.so.18\"\nlibmysqlclient18: /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18\nlibmysqlclient18: /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18.0.0\n\nshell> sudo apt-get install libmysqlclient18\nshell> sudo systemctl restart stackdriver-agent / sudo service stackdriver-agent restart\nshell> sudo systemctl status stackdriver-agent / sudo service stackdriver-agent status\n```\n\n\u7279\u306b\u30a8\u30e9\u30fc\u3082\u51fa\u3066\u3044\u306a\u3044\u306e\u3067\u5b8c\u4e86\uff01\u5b9f\u969b\u306b\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u2026\n\n<img width=\"668\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-07 23.47.27.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/37089/d07cf055-181a-0602-bd4e-adccdefc973a.png\">\n\n\u3046\u307e\u304f\u3044\u3063\u3066\u3044\u308b\u3088\u3046\u3067\u3059\uff01\n\n# \u307e\u3068\u3081\n\n\u3053\u308c\u3060\u3051\u306e\u6a5f\u80fd\u304c\u6a19\u6e96\u3067\u3057\u304b\u3082\u7121\u6599\u3067\u63c3\u3063\u3066\u3044\u308b\u306e\u306f\u76f8\u5f53\u5fc3\u5f37\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u307f\u306a\u3055\u3093\u3082\u662f\u975e\u4f7f\u3063\u3066\u307f\u3066\u304f\u3060\u3055\u3044\uff01\n", "tags": ["gcp", "gcpja", "GoogleCloudMonitoring"]}