{"context": "\n\n\u306f\u3058\u3081\u306b\n\u6628\u5e74\u672b\u306b\u521d\u3081\u3066AWS Lambda \u74b0\u5883\u3067LINE Bot \u3092\u958b\u767a\u3057\u307e\u3057\u305f\u3002\n\u7c21\u5358\u306aBot \u3092\u4f5c\u308b\u3060\u3051\u3067\u3042\u308c\u3070\u3001Lambda \u3092\u7d20\u3067\u4f7f\u3063\u3066\u3082\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001LINE Login \u306a\u3069\u4ed6\u306eWEB \u30b5\u30fc\u30d3\u30b9\u304b\u3089\u306e\u547c\u3073\u51fa\u3057\u3092\u53d7\u3051\u4ed8\u3051\u3066\u52d5\u304f\u3088\u3046\u306a\u5c11\u3057\u8907\u96d1\u306aBot \u3092\u4f5c\u308d\u3046\u3068\u601d\u3046\u3068\u3001\u3061\u3087\u3063\u3068\u8f9b\u304f\u306a\u3063\u3066\u304d\u307e\u3059\u3002\nLambda \u74b0\u5883\u3067Node.js \u306eexpress \u306e\u3088\u3046\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u4f7f\u3048\u306a\u3044\u304b\u3068\u601d\u3063\u3066\u691c\u7d22\u3057\u3066\u3044\u308b\u3068\u3001\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\nAWS \u8b39\u88fd aws-serverless-express \u3092\u4f7f\u3063\u3066 APIGateway + Lambda + Node + Express \u3067 RESTful \u30b5\u30fc\u30d3\u30b9\u306e\u96db\u5f62\u3092\u6700\u901f\u3067\u4f5c\u308b\n\n\u8a18\u4e8b\u306b\u3088\u308b\u3068\u3001Lambda \u3067express \u304c\u4f7f\u3048\u308b\u30b3\u30fc\u30c9\u304cAWS \u516c\u5f0f\u3067\uff08\uff01\uff09\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b\u3068\u30c9\u30f3\u30d4\u30b7\u30e3\u306e\u5185\u5bb9\u3067\u3057\u305f\u306e\u3067\u3001\u305d\u3046\u306a\u3089\u3070\u4f7f\u3063\u3066\u307f\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\u4ee5\u4e0b\u3001Mac OSX \u74b0\u5883\u3067\u69cb\u7bc9\u30fb\u958b\u767a\u3057\u305f\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\nAWS \u74b0\u5883\u306e\u6e96\u5099\n\nAWS \u516c\u5f0f\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\nGitHub \u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308bAWS \u306e\u516c\u5f0f\u30b3\u30fc\u30c9\u3092\u53d6\u5f97\u3057\u3066\u3001\u958b\u767a\u7528\u30b3\u30fc\u30c9\u306b\u3057\u307e\u3059\u3002\n$ git clone https://github.com/awslabs/aws-serverless-express.git\n$ cp -r ./aws-serverless-express/example ~/aws/samplebot-express\n$ cd ~/aws/samplebot-express\n\n\n\u30a2\u30d7\u30ea\u8a2d\u5b9a\n\u516c\u5f0f\u30b3\u30fc\u30c9\u306eREADME.md \u306e\u624b\u9806\u306b\u5f93\u3063\u3066\u958b\u767a\u3059\u308b\u30a2\u30d7\u30ea\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u4e8b\u524d\u306bS3\u306e\u30d0\u30b1\u30c3\u30c8\uff08\u30b3\u30fc\u30c9\u306e\u30c7\u30d7\u30ed\u30a4\u7528\uff09\u4f5c\u6210\u3068\u3001AWS CLI \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ cd ~/aws/samplebot-express\n$ npm run config -- --account-id=\"<accountID>\" --bucket-name=\"<bucketName>\"  --region=\"<region>\" --function-name=\"<functionName>\"\n\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\n\u610f\u5473\n\n\n\n\naccountID\nAWS \u306e\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3067\u3059\u3002AWS \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u753b\u9762\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\nbucketName\nS3 \u306e\u30d0\u30b1\u30c3\u30c8\u540d\u3067\u3059\u3002\u3053\u306e\u30d0\u30b1\u30c3\u30c8\u306f\u30b3\u30fc\u30c9\u306e\u30c7\u30d7\u30ed\u30a4\u3060\u3051\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002\n\n\nregion\n\u4f5c\u6210\u3059\u308bLambda \u30a2\u30d7\u30ea \u304c\u7a3c\u50cd\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3002\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306a\u3089ap-northeast-1 \u3067\u3059\u306d\u3002\n\n\nfunctionName\n\u4f5c\u6210\u3059\u308bLambda \u30a2\u30d7\u30ea\u540d\u3067\u3059\u3002\n\n\n\n$ cd ~/aws/samplebot-express\n$ npm run config -- --account-id=\"xxxxxxxxxxx\" --bucket-name=\"samplebot-express-bucket\"  --region=\"ap-northeast-1\" --function-name=\"samplebot-express\"\n\n\nAWS \u3078\u306e\u30a2\u30d7\u30ea\u767b\u9332\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3067Lambda \u3084APIGateway \u306e\u767b\u9332\u304c\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3044\u3084\uff5e\u697d\u30c1\u30f3\u3067\u3059\u306d\u3002\n$ npm run setup\n\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u3001CloudFormation \u753b\u9762\u3067\u3001\u8a72\u5f53\u306eCloudStack \u306eStatus \u304c\u201dCREATE_COMPLETE\u201d\u306b\u306a\u308c\u3070\u767b\u9332\u5b8c\u4e86\u3067\u3059\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u3053\u308c\u3067\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u304c\u52d5\u304f\u72b6\u614b\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u3055\u3063\u305d\u304f\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u8a72\u5f53\u306eCloudStack \u306eOutputs \u306b\u3042\u308b\u300cApiUrl\u300d\u306eURL \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\n\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u307e\u3059\u306d\u301c\uff01\nRESTful API \u306a\u611f\u3058\u3067\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n\n\nLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6e96\u5099\nAWS \u306e\u65b9\u304c\u3072\u3068\u3068\u304a\u308a\u52d5\u3044\u305f\u306e\u3067\u3001\u6b21\u306fLINE Bot \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u5fc5\u8981\u306aLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u30fb\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\nLINE Bot \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u306fLINE Business \u30a2\u30ab\u30a6\u30f3\u30c8\u53d6\u5f97\u306a\u3069\u3092\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\u306e\u3084\u308a\u65b9\u3082\u3053\u306e\u8a18\u4e8b\u306b\u66f8\u3053\u3046\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u3061\u3089\u306e\u8a18\u4e8b\u304c\u5206\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n\n\"Channel Secret\"\u3068\"Channel Access Token\"\u306e\u8a2d\u5b9a\nLINE Bot \u5b9f\u884c\u306b\u5fc5\u8981\u306a\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u53d6\u5f97\u3057\u3066\u3001Lambda \u306e\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\"Channel Secret\"\u3068\"Channel Access Token\"\u306e\u53d6\u5f97\n\"Channel Secret\"\u3068\"Channel Access Token\"\u306f\u3001LINE developers \u306e\u753b\u9762\u304b\u3089\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n\"Channel Secret\"\u306f\u753b\u9762\u4e0a\u90e8\u306b\u3042\u308b\u300cSHOW\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u8868\u793a\u3055\u308c\u305f\u3082\u306e\u3092\u3001\"Channel Access Token\"\u306f\u753b\u9762\u4e0b\u90e8\u306e\u300cISSUE\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u767a\u884c\u3055\u308c\u305f\u3082\u306e\u3092\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\nLambda \u30a2\u30d7\u30ea\u306b\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3059\u308b\nLambda \u30a2\u30d7\u30ea\u306e\u74b0\u5883\u5909\u6570\u306b\u5148\u307b\u3069\u53d6\u5f97\u3057\u305f\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nLambda \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u201dCode\u201d\u6b04\u4e0b\u90e8\u306b\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u7b87\u6240\u304c\u3042\u308b\u306e\u3067\u3053\u3053\u306b\u8ffd\u8a18\u3057\u3066\u3001\u753b\u9762\u4e0a\u90e8\u306e\u300cSave\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\uff08\u300cSave\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3055\u305a\u306b\u5f8c\u8ff0\u306e\u201d\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u5143\u306e\u691c\u8a3c\u201d\u3067\u5f15\u3063\u304b\u304b\u3063\u305f\u306e\u306f\u30ca\u30a4\u30b7\u30e7\u3067\u3059 ;-)\uff09\n\n\u305d\u308c\u305e\u308c\u3001\u4ee5\u4e0b\u306e\u5909\u6570\u540d\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\nChannel Secret\uff1aLINE_CHANNEL_SECRET\nChannel Access Token\uff1aLINE_CHANNEL_ACCESS_TOKEN\n\n\nWebhook URL \u306e\u8a2d\u5b9a\nLINE \u3067Bot \u5b9b\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u305f\u5834\u5408\u3084\u3001\u300c\u304a\u53cb\u3060\u3061\u8ffd\u52a0\u300d\u6642\u306b\u5b9f\u884c\u3055\u308c\u308bWebhook URL \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nAWS \u3078\u306eLambda \u30a2\u30d7\u30ea\u767b\u9332\u6642\u306bCloudFormation \u3067\u69cb\u7bc9\u3055\u308c\u305fAPI Gateway \u306eURL \u3092LINE developers \u30b5\u30a4\u30c8\u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fAPI Gateway \u3078\u69cb\u7bc9\u6e08\u307fURL \u914d\u4e0b\u306e\"webhook/\"\u30d1\u30b9\u304cLINE \u304b\u3089\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u3055\u304d\u307b\u3069\"Channel Secret\"\u306a\u3069\u3092\u53d6\u5f97\u3057\u305fLINE developers \u30b5\u30a4\u30c8\u306e\u753b\u9762\u304b\u3089\u300cEDIT\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066Webhook URL \u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n\nBot \u30a2\u30d7\u30ea\u306e\u958b\u767a\nLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306fLambda \u4e0a\u3067\u52d5\u304b\u3059Bot \u30a2\u30d7\u30ea\u3092\u958b\u767a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u9001\u4fe1\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8a9e\u5c3e\u306b\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u3092\u4ed8\u3051\u3066\u8fd4\u3059\u3060\u3051\u306eBot \u3092\u4f5c\u308a\u307e\u3059\u3002\n\nnode.js \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\nnode.js \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fLambda \u3068\u540c\u3058\u30d0\u30fc\u30b8\u30e7\u30f3\uff08v4.3.2\uff09\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nnode.js\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ node -v\nv4.3.2\n\n\n\nLINE Messaging API \u7528SDK \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnode.js \u7528\u306eLINE Messaging API \u516c\u5f0fSDK \u306f\u6b8b\u5ff5\u306a\u304c\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4eca\u56de\u306f\u975e\u516c\u5f0fSDK \u300cnode-line-bot-api\u300d\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u300cnode-line-bot-api\u300d\u306fnpm \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n$ npm install --save node-line-bot-api\nnode-line-bot-api@0.1.2 node_modules/node-line-bot-api\n\u2514\u2500\u2500 superagent@2.3.0 (methods@1.1.2, component-emitter@1.2.1, cookiejar@2.1.0, extend@3.0.0, mime@1.3.4, formidable@1.1.1, qs@6.3.0, debug@2.6.0, readable-stream@2.2.2, form-data@1.0.0-rc4)\n\n\nLINE Messaging API \u7528SDK \u306e\u521d\u671f\u5316\n\u3053\u3053\u304b\u3089\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\napp.js \u306e\u5192\u982d\u3067SDK\u300cnode-line-bot-api\u300d\u3092require \u3057\u3066\u3001SDK \u306e\u521d\u671f\u5316\u6642\u306bLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u305f\u969b\u306b\u53d6\u5f97\u3057\u305f\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u6e21\u3057\u307e\u3059\u3002\n\napp.js\uff08\u4e00\u90e8\uff09\n'use strict'\nconst express = require('express');\nconst line = require('node-line-bot-api');\nconst bodyParser = require('body-parser');\nconst cors = require('cors');\nconst awsServerlessExpressMiddleware = require('aws-serverless-express/middleware');\nconst app = express();\n\n// LINE BOT SDK \u521d\u671f\u5316\nline.init({\n  accessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN,\n  channelSecret: process.env.LINE_CHANNEL_SECRET\n});\n\u2026\uff08\u5f8c\u7565\uff09\n\n\n\u306a\u304a\u3001Lambda \u306b\u8a2d\u5b9a\u3057\u305f\u74b0\u5883\u5909\u6570\u306f\u300cprocess.env.${\u5909\u6570\u540d}\u300d\u3067\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u5404\u7a2eAPI \u306e\u30c8\u30fc\u30af\u30f3\u5024\u306a\u3069\u3092\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u3051\u3070\u958b\u767a\u7528\uff0f\u672c\u756a\u7528\u3082\u7c21\u5358\u306b\u5207\u308a\u5206\u3051\u3089\u308c\u307e\u3059\u306d\u3002\n\nLINE \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u5143\u306e\u691c\u8a3c\nLINE Messaging API \u306e\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u3082\u3042\u308b\u3068\u304a\u308a\u3001Webhook \u53d7\u4fe1\u5f8c\u306b\u9001\u4fe1\u5143\u304c\u6b63\u3057\u3044\u304b\u3092\u691c\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u672c\u6765\u306fWebhook \u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u306b\u3042\u308b\u7f72\u540d\u300cX-Line-Signature\u300d\u5024\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u3068HMAC-SHA256\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306a\u3069\u3092\u57fa\u306b\u8a08\u7b97\u3057\u305f\u5024\u3068\u3092\u6bd4\u8f03\u3057\u3066\u3001\u6b63\u3057\u3044\u9001\u4fe1\u5143\u3067\u3042\u308b\u304b\u3092\u691c\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u4eca\u56de\u4f7f\u3046SDK\u300cnode-line-bot-api\u300d\u306b\u691c\u8a3c\u6a5f\u80fd\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u4f7f\u3044\u307e\u3059\u3002\n\napp.js\uff08\u4e00\u90e8\uff09\n\u2026\uff08\u524d\u7565\uff09\n// \u9001\u4fe1\u5143\u306e\u691c\u8a3c\uff08X-Line-Signature \u7f72\u540d\u691c\u8a3c\uff09\u306brawBody\u304c\u5fc5\u8981\n// @see https://devdocs.line.me/ja/?shell#webhooks\napp.use(bodyParser.json({\n    verify(req, res, buf) {\n        req.rawBody = buf;\n    }\n}));\n\napp.post('/webhook/', \n         line.validator.validateSignature(),    // <-- \u9001\u4fe1\u5143\u306e\u691c\u8a3c\uff08X-Line-Signature \u7f72\u540d\u691c\u8a3c\uff09\n         function(req, res) {\n\u2026\uff08\u5f8c\u7565\uff09\n\n\n\nLINE \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u52d5\u4f5c\u3092\u4f5c\u308b\nAWS \u516c\u5f0f\u30b3\u30fc\u30c9\u306eapp.js \u306b\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4eca\u56de\u4f7f\u308f\u306a\u3044\u7b87\u6240\u306f\u524a\u9664\u3057\u3066\u3001LINE webhook \u7528\u306ePOST \u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u4fe1\u90e8\u5206\u3092\u4f5c\u308a\u307e\u3059\u3002\n\napp.js\uff08\u4e00\u90e8\uff09\n\u2026\uff08\u524d\u7565\uff09\n/**\n* LINE \u304b\u3089\u306eWebhook \u53d7\u4fe1\u6642\u306b\u547c\u3070\u308c\u308b\n* LINE developers \u306e\u300cWebhook URL\u300d\u306b\u8a2d\u5b9a\u3057\u305fURL\n* URL:https://xxxxxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/webhook/\n*\n* @see https://devdocs.line.me/ja/#webhook-event-object\n*/\napp.post('/webhook/', line.validator.validateSignature(), function(req, res) {\n    console.log('LINE message Webhook called!!');\n\n    // \u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u30a4\u30d9\u30f3\u30c8\u3092\u51e6\u7406\n    const promises = req.body.events.map(function(event) {\n        let promise = null;\n        if ('message' === event.type) {\n            promise = handleMessageEvent(event);\n        }\n        return promise;\n    });\n\n    // \u30e1\u30c3\u30bb\u30fc\u30b8\u3054\u3068\u306e\u51e6\u7406\u306fPromise\u3067\u5b9f\u884c\n    Promise\n        .all(promises)\n        .then(function(value) {\n            // \u51e6\u7406\u304c\u5168\u3066\u6b63\u5e38\u7d42\u4e86\u3059\u308c\u3070\u3001HTTP STATUS CODE 200\u3092\u8fd4\u3059\n            return res.json({success: true}); })\n        .catch(function(error) {\n            // \u7570\u5e38\u7d42\u4e86\u304c\u3042\u308c\u3070\u3001HTTP STATUS CODE 500\u3092\u8fd4\u3059\n            console.log('Error!: ', error);\n            return res.status(500).json({});\n        });\n});\n\n/**\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306b\u547c\u3070\u308c\u308b\n* @param event  {JSON}  Message Event\n* @return   Promise\uff08Reply message\uff09\n*\n* @see https://devdocs.line.me/ja/#webhook-event-object\n* @see https://devdocs.line.me/ja/#reply-message\n*/\nfunction handleMessageEvent(event)\n{\n    console.log('handleMessageEvent function called!!');\n    const messageType = event.message.type;\n\n    let promise = null;\n    if ('text' === messageType) {\n        // \u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3042\u308c\u3070\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8a9e\u5c3e\u306b\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u3060\u3051\u4ed8\u3051\u3066\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [{\n                type: 'text',\n                text: event.message.text + '\u3067\u3093\u304c\u306a\uff01'\n            }]\n        });\n    } else if ('location' === messageType || 'sticker' === messageType) {\n        // \u4f4d\u7f6e\u60c5\u5831\u3068\u30b9\u30bf\u30f3\u30d7\uff08\u516c\u5f0f\u30b9\u30bf\u30f3\u30d7\u306e\u307f\uff09\u306f\u3001\u305d\u306e\u307e\u307e\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [event.message]\n        });\n    } else {\n        // \u305d\u308c\u4ee5\u5916\u306f\u3001\u9069\u5f53\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [{\n                type: 'text',\n                text: '\u305d\u308c\u306f\u3042\u304b\u3093\u3067\u3047\u2026'\n            }]\n        });\n    }\n    return promise;\n}\n\u2026\uff08\u5f8c\u7565\uff09\n\n\n\nAWS \u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u7c21\u5358\u3067\u3059\u304cBot \u30a2\u30d7\u30ea\u3092\u3064\u304f\u3063\u305f\u306e\u3067AWS \u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u7d20\u306e\u307e\u307e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5834\u5408\u3001\u30a2\u30d7\u30ea\u30ea\u30bd\u30fc\u30b9\u3092Zip \u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u5834\u5408\u306f\u305f\u3063\u305f\u3072\u3068\u3064\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u3088\u3046\u306bpackage.json \u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u7d20\u6674\u3089\u3057\u3044\u3067\u3059\u306d\u3047\u3002\n$ npm run package-upload-update-function\n\n\n\u3044\u3056\u5b9f\u884c\uff01\n\u3053\u308c\u3067\u3072\u3068\u3068\u304a\u308a\u3067\u304d\u305f\u306e\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff01\nLINE \u30a2\u30d7\u30ea\u3067Bot \u3092\u53cb\u3060\u3061\u8ffd\u52a0\u3057\u3066\u3001Bot \u3068\u306e\u30c8\u30fc\u30af\u753b\u9762\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u3060\u3051\u3067\u3059\u3002\n\u52d5\u304d\u307e\u3057\u305f\uff01\n\n\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5834\u5408\u306f\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u304c\u672b\u5c3e\u306b\u3064\u3044\u3066\u3001\u4f4d\u7f6e\u60c5\u5831\u3068\u30b9\u30bf\u30f3\u30d7\u306e\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u8fd4\u4fe1\u3067\u304d\u3066\u3044\u307e\u3059\u306d\u3002\n\n\u753b\u50cf\u306e\u5834\u5408\u306f\u9069\u5f53\u306a\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8fd4\u4fe1\u3067\u304d\u3066\u3044\u307e\u3059 :-)\n\u3053\u3093\u306a\u611f\u3058\u3067\u7c21\u5358\u306b\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u306aLINE Bot \u3092\u958b\u767a\u3067\u304d\u307e\u3059\u3002\u7d20\u6674\u3089\u3057\u304f\u7c21\u5358\u3067\u3059\u306d\u3047\u3002\n\n\u305d\u306e\u4ed6\u30cf\u30de\u3063\u305f\u3053\u3068\n\u3053\u306e\u516c\u5f0f\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u5e7e\u3064\u304b\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30a2\u30d7\u30ea\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\nAWS\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30bf\u30b9\u30af\u304cpackage.json \u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u30b5\u30f3\u30d7\u30eb\u3067\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\uff0f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3057\u304b\u8a18\u8f09\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u65b0\u305f\u306bjs \u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u5834\u5408\u306fpackage.json \u306e\u300cpackage-function\u300d\uff08Zip \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\uff09\u30bf\u30b9\u30af\u306b\u8ffd\u8a18\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\npackage.json\uff08\u4e00\u90e8\uff09\n// \u5909\u66f4\u524d\n// \"package-function\": \"zip -q -r lambda-function.zip lambda.js app.js index.html node_module\",\n// \u2193\n// \u5909\u66f4\u5f8c \u672b\u5c3e\u306b\u300clib\u300d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\n\"package-function\": \"zip -q -r lambda-function.zip lambda.js app.js index.html node_modules lib\",\n\n\n\nAWS \u516c\u5f0f\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u8907\u6570\u306e\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\n\u8907\u6570\u306eexpress \u30a2\u30d7\u30ea\u3092\u767b\u9332\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u8907\u6570\u767b\u9332\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u6b21\u306e\u8a2d\u5b9a\u3092\u30a2\u30d7\u30ea\u3054\u3068\u306b\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\npackage.json\n\u30d5\u30a1\u30a4\u30eb\u306e\uff18\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b\"cloudFormationStackName\" \u306e\u5024\u3092\u5909\u3048\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\"cloudFormationStackName\" \u304c\u30a2\u30ab\u30a6\u30f3\u30c8\u5185\u3067\u91cd\u8907\u3059\u308b\u3068\u767b\u9332\u3067\u304d\u307e\u305b\u3093\u3002\n\npackage.json\uff08\u4e00\u90e8\uff09\n {\n   \"name\": \"aws-serverless-express-example\",\n   \"version\": \"1.1.0\",\n   \"description\": \"Example application for running a Node Express app on AWS Lambda using Amazon API Gateway.\",\n   \"main\": \"lambda.js\",\n   \"config\": {\n     \"s3BucketName\": \"samplebot-express-bucket\",\n     \"cloudFormationStackName\": \"AwsServerlessExpressStackSampleBot\", // <-- \u3053\u3053\n     \"region\": \"ap-northeast-1\"\n   }\n\n\n\nsimple-proxy-api.yaml\n\u30d5\u30a1\u30a4\u30eb\u306e4\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b \"title\" \u3092\u5909\u3048\u3066\u304a\u304f\u3068API Gateway \u306e\u30ea\u30bd\u30fc\u30b9\u540d\u79f0\u304c\u5909\u308f\u308b\u306e\u3067\u533a\u5225\u304c\u3064\u304d\u3084\u3059\u3044\u3067\u3059\u3002\n\nsimple-proxy-api.yaml\uff08\u4e00\u90e8\uff09\n ---\n swagger: 2.0\n info:\n   title: SampleBotExpressApi // <-- \u3053\u3053\n basePath: /prod\n\n\n\n\u304a\u308f\u308a\u306b\n\u3053\u3093\u306a\u306b\u3082\u7c21\u5358\u306bWeb \u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u306a\u3093\u3066\u3001\u307b\u3093\u3068\u826f\u3044\u4e16\u306e\u4e2d\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3047\uff08\u9060\u3044\u76ee\n\u3061\u306a\u307f\u306b\u3001\u4eca\u56de\u7d39\u4ecb\u3057\u305f\u74b0\u5883\u3092\u4f7f\u3063\u3066\u300c\u30db\u30c6\u30ebBot\u300d\u3068\u3044\u3046LINE Bot \u3092\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u3002\n\u5225\u306e\u8a18\u4e8b\u306b\u3082\u63b2\u8f09\u3057\u307e\u3057\u305f\u304c\u3001Bot \u3068\u306e\u30c8\u30fc\u30af\u3067\u201d\u672d\u5e4c\u3067\u660e\u65e5\u304b\u3089\uff12\u6cca\u3001\u4e00\u4e07\u5186\u4ee5\u4e0b\u306e\u7981\u7159\u30eb\u30fc\u30e0\u3067\u671d\u98df\u3042\u308a\u201d \u306e\u3088\u3046\u306b\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u6761\u4ef6\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u3001\u6761\u4ef6\u306b\u3042\u3063\u305f\u30db\u30c6\u30eb\u306e\u691c\u7d22\u7d50\u679c\u3092\u8fd4\u3057\u3066\u304f\u308c\u3001\u305d\u306e\u307e\u307e\u4e88\u7d04\u307e\u3067\u3067\u304d\u308bLINE Bot\u3067\u3059\u3002\n\u51fa\u5f35\u304c\u591a\u304f\u983b\u7e41\u306b\u30db\u30c6\u30eb\u4e88\u7d04\u3092\u3059\u308b\u306e\u3067\u3001\u3053\u308c\u304b\u3089\u3082\u4f7f\u3044\u52dd\u624b\u304c\u3088\u304f\u306a\u308b\u3088\u3046\u306b\u6539\u826f\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u79c1\u306e\u3088\u3046\u306b\u51fa\u5f35\u65cf\u306e\u65b9\u3084\u3001\u65c5\u884c\u597d\u304d\u306a\u65b9\u306f\u662f\u975e\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002\nLINE \u30a2\u30d7\u30ea\u3067\u4e0b\u306eQR\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u53d6\u3063\u3066\u3001Bot \u3092\u53cb\u3060\u3061\u8ffd\u52a0\u3059\u308c\u3070\u3059\u3050\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n\u3053\u306e\u30da\u30fc\u30b8\u3092\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u3067\u898b\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0b\u306e\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3057\u3066LINE \u30a2\u30d7\u30ea\u3067\u300c\u53cb\u3060\u3061\u8ffd\u52a0\u300d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u305d\u308c\u3067\u306f\u7686\u3055\u3093\u3082\u3088\u3044LINE Bot \u958b\u767a\u3092\uff01\n\n\u53c2\u8003\u8a18\u4e8b\u306a\u3069\n\nAWS Lambda \u3068 Amazon API Gateway \u3067 Express \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\naws-serverless-express\nAWS \u8b39\u88fd aws-serverless-express \u3092\u4f7f\u3063\u3066 APIGateway + Lambda + Node + Express \u3067 RESTful \u30b5\u30fc\u30d3\u30b9\u306e\u96db\u5f62\u3092\u6700\u901f\u3067\u4f5c\u308b\nLINE BOT\u306e\u4f5c\u308a\u65b9\u3092\u4e16\u754c\u4e00\u308f\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\uff08\uff11\uff09\u3010\u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\u7de8\u3011\n\n\u3044\u3089\u3059\u3068\u3084 \uff08\u3044\u3064\u3082\u304a\u4e16\u8a71\u306b\u306a\u3063\u3066\u3044\u307e\u3059\uff01\uff09\n\u30db\u30c6\u30ebBot \u306e\u4f7f\u3044\u65b9\n\u30db\u30c6\u30ebBot\n\n# \u306f\u3058\u3081\u306b\n\u6628\u5e74\u672b\u306b\u521d\u3081\u3066[AWS Lambda \u74b0\u5883\u3067LINE Bot \u3092\u958b\u767a\u3057\u307e\u3057\u305f](http://qiita.com/sumihiro3/items/0bc6cddf4943ca2d18e3)\u3002\n\u7c21\u5358\u306aBot \u3092\u4f5c\u308b\u3060\u3051\u3067\u3042\u308c\u3070\u3001Lambda \u3092\u7d20\u3067\u4f7f\u3063\u3066\u3082\u554f\u984c\u3042\u308a\u307e\u305b\u3093\u304c\u3001LINE Login \u306a\u3069\u4ed6\u306eWEB \u30b5\u30fc\u30d3\u30b9\u304b\u3089\u306e\u547c\u3073\u51fa\u3057\u3092\u53d7\u3051\u4ed8\u3051\u3066\u52d5\u304f\u3088\u3046\u306a\u5c11\u3057\u8907\u96d1\u306aBot \u3092\u4f5c\u308d\u3046\u3068\u601d\u3046\u3068\u3001\u3061\u3087\u3063\u3068\u8f9b\u304f\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\nLambda \u74b0\u5883\u3067Node.js \u306eexpress \u306e\u3088\u3046\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u4f7f\u3048\u306a\u3044\u304b\u3068\u601d\u3063\u3066\u691c\u7d22\u3057\u3066\u3044\u308b\u3068\u3001[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/exabugs/items/594d3cd417e99dc29387)\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\n* [AWS \u8b39\u88fd aws-serverless-express \u3092\u4f7f\u3063\u3066 APIGateway + Lambda + Node + Express \u3067 RESTful \u30b5\u30fc\u30d3\u30b9\u306e\u96db\u5f62\u3092\u6700\u901f\u3067\u4f5c\u308b](http://qiita.com/exabugs/items/594d3cd417e99dc29387)\n\n\u8a18\u4e8b\u306b\u3088\u308b\u3068\u3001Lambda \u3067express \u304c\u4f7f\u3048\u308b\u30b3\u30fc\u30c9\u304c[AWS \u516c\u5f0f\u3067\uff08\uff01\uff09\u63d0\u4f9b\u3055\u308c\u3066\u3044\u308b](https://aws.amazon.com/jp/blogs/news/running-express-applications-on-aws-lambda-and-amazon-api-gateway/)\u3068\u30c9\u30f3\u30d4\u30b7\u30e3\u306e\u5185\u5bb9\u3067\u3057\u305f\u306e\u3067\u3001\u305d\u3046\u306a\u3089\u3070\u4f7f\u3063\u3066\u307f\u308b\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u4ee5\u4e0b\u3001Mac OSX \u74b0\u5883\u3067\u69cb\u7bc9\u30fb\u958b\u767a\u3057\u305f\u3082\u306e\u3068\u306a\u308a\u307e\u3059\u3002\n\n# AWS \u74b0\u5883\u306e\u6e96\u5099\n## AWS \u516c\u5f0f\u30b3\u30fc\u30c9\u306e\u53d6\u5f97\n[GitHub \u3067\u516c\u958b\u3055\u308c\u3066\u3044\u308bAWS \u306e\u516c\u5f0f\u30b3\u30fc\u30c9](https://github.com/awslabs/aws-serverless-express)\u3092\u53d6\u5f97\u3057\u3066\u3001\u958b\u767a\u7528\u30b3\u30fc\u30c9\u306b\u3057\u307e\u3059\u3002\n\n```\u958b\u767a\u7528\u30b3\u30fc\u30c9\u306e\u6e96\u5099\n$ git clone https://github.com/awslabs/aws-serverless-express.git\n$ cp -r ./aws-serverless-express/example ~/aws/samplebot-express\n$ cd ~/aws/samplebot-express\n```\n\n## \u30a2\u30d7\u30ea\u8a2d\u5b9a\n\u516c\u5f0f\u30b3\u30fc\u30c9\u306eREADME.md \u306e\u624b\u9806\u306b\u5f93\u3063\u3066\u958b\u767a\u3059\u308b\u30a2\u30d7\u30ea\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u4e8b\u524d\u306bS3\u306e\u30d0\u30b1\u30c3\u30c8\uff08\u30b3\u30fc\u30c9\u306e\u30c7\u30d7\u30ed\u30a4\u7528\uff09\u4f5c\u6210\u3068\u3001AWS CLI \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```AWS\u3078\u306e\u30a2\u30d7\u30ea\u8a2d\u5b9a\n$ cd ~/aws/samplebot-express\n$ npm run config -- --account-id=\"<accountID>\" --bucket-name=\"<bucketName>\"  --region=\"<region>\" --function-name=\"<functionName>\"\n```\n\n| \u30d1\u30e9\u30e1\u30fc\u30bf     | \u610f\u5473        |\n|:-------------|:------------|\n| accountID    | AWS \u306e\u30a2\u30ab\u30a6\u30f3\u30c8ID\u3067\u3059\u3002[AWS \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u753b\u9762](https://console.aws.amazon.com/billing/home?#/account)\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002 |\n| bucketName   | S3 \u306e\u30d0\u30b1\u30c3\u30c8\u540d\u3067\u3059\u3002\u3053\u306e\u30d0\u30b1\u30c3\u30c8\u306f\u30b3\u30fc\u30c9\u306e\u30c7\u30d7\u30ed\u30a4\u3060\u3051\u306b\u4f7f\u308f\u308c\u307e\u3059\u3002 |\n| region       | \u4f5c\u6210\u3059\u308bLambda \u30a2\u30d7\u30ea \u304c\u7a3c\u50cd\u3059\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u3002\u6771\u4eac\u30ea\u30fc\u30b8\u30e7\u30f3\u306a\u3089ap-northeast-1 \u3067\u3059\u306d\u3002 |\n| functionName | \u4f5c\u6210\u3059\u308bLambda \u30a2\u30d7\u30ea\u540d\u3067\u3059\u3002 |\n\n```AWS\u3078\u306e\u30a2\u30d7\u30ea\u8a2d\u5b9a\u306e\u5b9f\u884c\u4f8b\n$ cd ~/aws/samplebot-express\n$ npm run config -- --account-id=\"xxxxxxxxxxx\" --bucket-name=\"samplebot-express-bucket\"  --region=\"ap-northeast-1\" --function-name=\"samplebot-express\"\n```\n\n## AWS \u3078\u306e\u30a2\u30d7\u30ea\u767b\u9332\n\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3060\u3051\u3067Lambda \u3084APIGateway \u306e\u767b\u9332\u304c\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\u3044\u3084\uff5e\u697d\u30c1\u30f3\u3067\u3059\u306d\u3002\n\n```AWS\u3078\u306e\u30a2\u30d7\u30ea\u767b\u9332\n$ npm run setup\n```\n\n\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u3001CloudFormation \u753b\u9762\u3067\u3001\u8a72\u5f53\u306eCloudStack \u306eStatus \u304c\u201dCREATE_COMPLETE\u201d\u306b\u306a\u308c\u3070\u767b\u9332\u5b8c\u4e86\u3067\u3059\u3002\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\u3053\u308c\u3067\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u304c\u52d5\u304f\u72b6\u614b\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u3055\u3063\u305d\u304f\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u8a72\u5f53\u306eCloudStack \u306eOutputs \u306b\u3042\u308b\u300cApiUrl\u300d\u306eURL \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n![CloudStack \u306eOutputs \u306b\u3042\u308b\u300cApiUrl\u300d](https://qiita-image-store.s3.amazonaws.com/0/154381/29a46ad8-136f-b1a0-32a3-1a53276c5ae7.png \"CloudStack \u306eOutputs \u306b\u3042\u308b\u300cApiUrl\u300d\")\n\n\u3061\u3083\u3093\u3068\u52d5\u3044\u3066\u307e\u3059\u306d\u301c\uff01\nRESTful API \u306a\u611f\u3058\u3067\u52d5\u3044\u3066\u3044\u307e\u3059\u3002\n![AWSServerlessExpress.png](https://qiita-image-store.s3.amazonaws.com/0/154381/f36d3968-752a-c6f9-4b63-e4bd97d6b4f2.png \"AWSServerlessExpress.png\")\n\n\n# LINE \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6e96\u5099\nAWS \u306e\u65b9\u304c\u3072\u3068\u3068\u304a\u308a\u52d5\u3044\u305f\u306e\u3067\u3001\u6b21\u306fLINE Bot \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u5fc5\u8981\u306aLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u30fb\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n## \u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\nLINE Bot \u3092\u52d5\u304b\u3059\u305f\u3081\u306b\u306fLINE Business \u30a2\u30ab\u30a6\u30f3\u30c8\u53d6\u5f97\u306a\u3069\u3092\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\u306e\u3084\u308a\u65b9\u3082\u3053\u306e\u8a18\u4e8b\u306b\u66f8\u3053\u3046\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/yoshizaki_kkgk/items/bd4277d3943200beab26)\u304c\u5206\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u7167\u3057\u3066\u8a2d\u5b9a\u3057\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u3088\u3044\u3067\u3059\u3002\n\n## \"Channel Secret\"\u3068\"Channel Access Token\"\u306e\u8a2d\u5b9a\nLINE Bot \u5b9f\u884c\u306b\u5fc5\u8981\u306a\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u53d6\u5f97\u3057\u3066\u3001Lambda \u306e\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### \"Channel Secret\"\u3068\"Channel Access Token\"\u306e\u53d6\u5f97\n\"Channel Secret\"\u3068\"Channel Access Token\"\u306f\u3001LINE developers \u306e\u753b\u9762\u304b\u3089\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n![Channel Secret\u3068Channel Access Token\u3092\u53d6\u5f97](https://qiita-image-store.s3.amazonaws.com/0/154381/1d18727a-980d-1f70-2a05-920031e1d5e2.png \"Channel Secret\u3068Channel Access Token\u3092\u53d6\u5f97\")\n\"Channel Secret\"\u306f\u753b\u9762\u4e0a\u90e8\u306b\u3042\u308b\u300cSHOW\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u8868\u793a\u3055\u308c\u305f\u3082\u306e\u3092\u3001\"Channel Access Token\"\u306f\u753b\u9762\u4e0b\u90e8\u306e\u300cISSUE\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u767a\u884c\u3055\u308c\u305f\u3082\u306e\u3092\u63a7\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n### Lambda \u30a2\u30d7\u30ea\u306b\u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\u3059\u308b\nLambda \u30a2\u30d7\u30ea\u306e\u74b0\u5883\u5909\u6570\u306b\u5148\u307b\u3069\u53d6\u5f97\u3057\u305f\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nLambda \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u201dCode\u201d\u6b04\u4e0b\u90e8\u306b\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u7b87\u6240\u304c\u3042\u308b\u306e\u3067\u3053\u3053\u306b\u8ffd\u8a18\u3057\u3066\u3001\u753b\u9762\u4e0a\u90e8\u306e\u300cSave\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u8a2d\u5b9a\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\uff08\u300cSave\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3055\u305a\u306b\u5f8c\u8ff0\u306e\u201d\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u5143\u306e\u691c\u8a3c\u201d\u3067\u5f15\u3063\u304b\u304b\u3063\u305f\u306e\u306f\u30ca\u30a4\u30b7\u30e7\u3067\u3059 ;-)\uff09\n![Lambda \u30b3\u30f3\u30bd\u30fc\u30eb](https://qiita-image-store.s3.amazonaws.com/0/154381/a0df4e11-0dcf-221d-2475-499372dda01b.png \"Lambda \u30b3\u30f3\u30bd\u30fc\u30eb\")\n\u305d\u308c\u305e\u308c\u3001\u4ee5\u4e0b\u306e\u5909\u6570\u540d\u3067\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n* Channel Secret\uff1aLINE_CHANNEL_SECRET\n* Channel Access Token\uff1aLINE_CHANNEL_ACCESS_TOKEN\n\n### Webhook URL \u306e\u8a2d\u5b9a\nLINE \u3067Bot \u5b9b\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u305f\u5834\u5408\u3084\u3001\u300c\u304a\u53cb\u3060\u3061\u8ffd\u52a0\u300d\u6642\u306b\u5b9f\u884c\u3055\u308c\u308bWebhook URL \u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nAWS \u3078\u306eLambda \u30a2\u30d7\u30ea\u767b\u9332\u6642\u306bCloudFormation \u3067\u69cb\u7bc9\u3055\u308c\u305fAPI Gateway \u306eURL \u3092LINE developers \u30b5\u30a4\u30c8\u306b\u767b\u9332\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fAPI Gateway \u3078\u69cb\u7bc9\u6e08\u307fURL \u914d\u4e0b\u306e\"webhook/\"\u30d1\u30b9\u304cLINE \u304b\u3089\u5b9f\u884c\u3055\u308c\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n\u3055\u304d\u307b\u3069\"Channel Secret\"\u306a\u3069\u3092\u53d6\u5f97\u3057\u305fLINE developers \u30b5\u30a4\u30c8\u306e\u753b\u9762\u304b\u3089\u300cEDIT\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066Webhook URL \u3092\u5165\u529b\u3057\u307e\u3059\u3002\n![Webhook URL \u3092\u5165\u529b](https://qiita-image-store.s3.amazonaws.com/0/154381/d5f209ca-2d5a-8afd-7bc3-62192ea21e1d.png \"Webhook URL \u3092\u5165\u529b\")\n\n# Bot \u30a2\u30d7\u30ea\u306e\u958b\u767a\nLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306fLambda \u4e0a\u3067\u52d5\u304b\u3059Bot \u30a2\u30d7\u30ea\u3092\u958b\u767a\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306f\u9001\u4fe1\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8a9e\u5c3e\u306b\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u3092\u4ed8\u3051\u3066\u8fd4\u3059\u3060\u3051\u306eBot \u3092\u4f5c\u308a\u307e\u3059\u3002\n\n## node.js \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\nnode.js \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fLambda \u3068\u540c\u3058\u30d0\u30fc\u30b8\u30e7\u30f3\uff08v4.3.2\uff09\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```node.js\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ node -v\nv4.3.2\n```\n\n## LINE Messaging API \u7528SDK \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nnode.js \u7528\u306eLINE Messaging API \u516c\u5f0fSDK \u306f\u6b8b\u5ff5\u306a\u304c\u3089\u63d0\u4f9b\u3055\u308c\u3066\u3044\u306a\u3044\u305f\u3081\u3001\u4eca\u56de\u306f\u975e\u516c\u5f0fSDK \u300c[node-line-bot-api](https://github.com/tejitak/node-line-bot-api)\u300d\u3092\u4f7f\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\u300c[node-line-bot-api](https://github.com/tejitak/node-line-bot-api)\u300d\u306fnpm \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n```\u300cnode-line-bot-api\u300d\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ npm install --save node-line-bot-api\nnode-line-bot-api@0.1.2 node_modules/node-line-bot-api\n\u2514\u2500\u2500 superagent@2.3.0 (methods@1.1.2, component-emitter@1.2.1, cookiejar@2.1.0, extend@3.0.0, mime@1.3.4, formidable@1.1.1, qs@6.3.0, debug@2.6.0, readable-stream@2.2.2, form-data@1.0.0-rc4)\n```\n\n## LINE Messaging API \u7528SDK \u306e\u521d\u671f\u5316\n\u3053\u3053\u304b\u3089\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\napp.js \u306e\u5192\u982d\u3067SDK\u300cnode-line-bot-api\u300d\u3092require \u3057\u3066\u3001SDK \u306e\u521d\u671f\u5316\u6642\u306bLINE \u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u305f\u969b\u306b\u53d6\u5f97\u3057\u305f\"Channel Secret\"\u3068\"Channel Access Token\"\u3092\u6e21\u3057\u307e\u3059\u3002\n\n```js:app.js\uff08\u4e00\u90e8\uff09\n'use strict'\nconst express = require('express');\nconst line = require('node-line-bot-api');\nconst bodyParser = require('body-parser');\nconst cors = require('cors');\nconst awsServerlessExpressMiddleware = require('aws-serverless-express/middleware');\nconst app = express();\n\n// LINE BOT SDK \u521d\u671f\u5316\nline.init({\n  accessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN,\n  channelSecret: process.env.LINE_CHANNEL_SECRET\n});\n\u2026\uff08\u5f8c\u7565\uff09\n``` \n\n\u306a\u304a\u3001Lambda \u306b\u8a2d\u5b9a\u3057\u305f\u74b0\u5883\u5909\u6570\u306f\u300cprocess.env.${\u5909\u6570\u540d}\u300d\u3067\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\u5404\u7a2eAPI \u306e\u30c8\u30fc\u30af\u30f3\u5024\u306a\u3069\u3092\u74b0\u5883\u5909\u6570\u306b\u8a2d\u5b9a\u3057\u3066\u304a\u3051\u3070\u958b\u767a\u7528\uff0f\u672c\u756a\u7528\u3082\u7c21\u5358\u306b\u5207\u308a\u5206\u3051\u3089\u308c\u307e\u3059\u306d\u3002\n\n## LINE \u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u5143\u306e\u691c\u8a3c\n[LINE Messaging API \u306e\u516c\u5f0f\u30da\u30fc\u30b8](https://devdocs.line.me/ja/?shell#webhooks)\u306b\u3082\u3042\u308b\u3068\u304a\u308a\u3001Webhook \u53d7\u4fe1\u5f8c\u306b\u9001\u4fe1\u5143\u304c\u6b63\u3057\u3044\u304b\u3092\u691c\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u672c\u6765\u306fWebhook \u30ea\u30af\u30a8\u30b9\u30c8\u30d8\u30c3\u30c0\u306b\u3042\u308b\u7f72\u540d\u300cX-Line-Signature\u300d\u5024\u3068\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u30dc\u30c7\u30a3\u3068HMAC-SHA256\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306a\u3069\u3092\u57fa\u306b\u8a08\u7b97\u3057\u305f\u5024\u3068\u3092\u6bd4\u8f03\u3057\u3066\u3001\u6b63\u3057\u3044\u9001\u4fe1\u5143\u3067\u3042\u308b\u304b\u3092\u691c\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u3061\u3089\u306f\u4eca\u56de\u4f7f\u3046SDK\u300cnode-line-bot-api\u300d\u306b\u691c\u8a3c\u6a5f\u80fd\u304c\u5b9f\u88c5\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n```js:app.js\uff08\u4e00\u90e8\uff09\n\u2026\uff08\u524d\u7565\uff09\n// \u9001\u4fe1\u5143\u306e\u691c\u8a3c\uff08X-Line-Signature \u7f72\u540d\u691c\u8a3c\uff09\u306brawBody\u304c\u5fc5\u8981\n// @see https://devdocs.line.me/ja/?shell#webhooks\napp.use(bodyParser.json({\n    verify(req, res, buf) {\n        req.rawBody = buf;\n    }\n}));\n\napp.post('/webhook/', \n         line.validator.validateSignature(),    // <-- \u9001\u4fe1\u5143\u306e\u691c\u8a3c\uff08X-Line-Signature \u7f72\u540d\u691c\u8a3c\uff09\n         function(req, res) {\n\u2026\uff08\u5f8c\u7565\uff09\n``` \n\n## LINE \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306e\u52d5\u4f5c\u3092\u4f5c\u308b\nAWS \u516c\u5f0f\u30b3\u30fc\u30c9\u306eapp.js \u306b\u306f\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u304c\u6b8b\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u4eca\u56de\u4f7f\u308f\u306a\u3044\u7b87\u6240\u306f\u524a\u9664\u3057\u3066\u3001LINE webhook \u7528\u306ePOST \u30ea\u30af\u30a8\u30b9\u30c8\u53d7\u4fe1\u90e8\u5206\u3092\u4f5c\u308a\u307e\u3059\u3002\n\n```js:app.js\uff08\u4e00\u90e8\uff09\n\u2026\uff08\u524d\u7565\uff09\n/**\n* LINE \u304b\u3089\u306eWebhook \u53d7\u4fe1\u6642\u306b\u547c\u3070\u308c\u308b\n* LINE developers \u306e\u300cWebhook URL\u300d\u306b\u8a2d\u5b9a\u3057\u305fURL\n* URL:https://xxxxxxxx.execute-api.ap-northeast-1.amazonaws.com/prod/webhook/\n*\n* @see https://devdocs.line.me/ja/#webhook-event-object\n*/\napp.post('/webhook/', line.validator.validateSignature(), function(req, res) {\n    console.log('LINE message Webhook called!!');\n    \n    // \u53d7\u4fe1\u3057\u305f\u30e1\u30c3\u30bb\u30fc\u30b8\u30a4\u30d9\u30f3\u30c8\u3092\u51e6\u7406\n    const promises = req.body.events.map(function(event) {\n        let promise = null;\n        if ('message' === event.type) {\n            promise = handleMessageEvent(event);\n        }\n        return promise;\n    });\n    \n    // \u30e1\u30c3\u30bb\u30fc\u30b8\u3054\u3068\u306e\u51e6\u7406\u306fPromise\u3067\u5b9f\u884c\n    Promise\n        .all(promises)\n        .then(function(value) {\n            // \u51e6\u7406\u304c\u5168\u3066\u6b63\u5e38\u7d42\u4e86\u3059\u308c\u3070\u3001HTTP STATUS CODE 200\u3092\u8fd4\u3059\n            return res.json({success: true}); })\n        .catch(function(error) {\n            // \u7570\u5e38\u7d42\u4e86\u304c\u3042\u308c\u3070\u3001HTTP STATUS CODE 500\u3092\u8fd4\u3059\n            console.log('Error!: ', error);\n            return res.status(500).json({});\n        });\n});\n         \n/**\n* \u30e1\u30c3\u30bb\u30fc\u30b8\u53d7\u4fe1\u6642\u306b\u547c\u3070\u308c\u308b\n* @param event  {JSON}  Message Event\n* @return   Promise\uff08Reply message\uff09\n*\n* @see https://devdocs.line.me/ja/#webhook-event-object\n* @see https://devdocs.line.me/ja/#reply-message\n*/\nfunction handleMessageEvent(event)\n{\n    console.log('handleMessageEvent function called!!');\n    const messageType = event.message.type;\n    \n    let promise = null;\n    if ('text' === messageType) {\n        // \u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3042\u308c\u3070\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u8a9e\u5c3e\u306b\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u3060\u3051\u4ed8\u3051\u3066\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [{\n                type: 'text',\n                text: event.message.text + '\u3067\u3093\u304c\u306a\uff01'\n            }]\n        });\n    } else if ('location' === messageType || 'sticker' === messageType) {\n        // \u4f4d\u7f6e\u60c5\u5831\u3068\u30b9\u30bf\u30f3\u30d7\uff08\u516c\u5f0f\u30b9\u30bf\u30f3\u30d7\u306e\u307f\uff09\u306f\u3001\u305d\u306e\u307e\u307e\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [event.message]\n        });\n    } else {\n        // \u305d\u308c\u4ee5\u5916\u306f\u3001\u9069\u5f53\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8fd4\u3059\n        promise = line.client.replyMessage({\n            replyToken: event.replyToken,\n            messages: [{\n                type: 'text',\n                text: '\u305d\u308c\u306f\u3042\u304b\u3093\u3067\u3047\u2026'\n            }]\n        });\n    }\n    return promise;\n}\n\u2026\uff08\u5f8c\u7565\uff09\n``` \n\n## AWS \u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n\u7c21\u5358\u3067\u3059\u304cBot \u30a2\u30d7\u30ea\u3092\u3064\u304f\u3063\u305f\u306e\u3067AWS \u3078\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\u7d20\u306e\u307e\u307e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5834\u5408\u3001\u30a2\u30d7\u30ea\u30ea\u30bd\u30fc\u30b9\u3092Zip \u30d5\u30a1\u30a4\u30eb\u306b\u56fa\u3081\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u4eca\u56de\u306e\u5834\u5408\u306f\u305f\u3063\u305f\u3072\u3068\u3064\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51fa\u6765\u308b\u3088\u3046\u306bpackage.json \u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u7d20\u6674\u3089\u3057\u3044\u3067\u3059\u306d\u3047\u3002\n\n```AWS\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\n$ npm run package-upload-update-function\n``` \n\n## \u3044\u3056\u5b9f\u884c\uff01\n\u3053\u308c\u3067\u3072\u3068\u3068\u304a\u308a\u3067\u304d\u305f\u306e\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u3087\u3046\uff01\nLINE \u30a2\u30d7\u30ea\u3067Bot \u3092\u53cb\u3060\u3061\u8ffd\u52a0\u3057\u3066\u3001Bot \u3068\u306e\u30c8\u30fc\u30af\u753b\u9762\u3067\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u308b\u3060\u3051\u3067\u3059\u3002\n\n\u52d5\u304d\u307e\u3057\u305f\uff01\n![SampleBot01.png](https://qiita-image-store.s3.amazonaws.com/0/154381/ed6ef038-484f-8ccf-694e-193db1a7e6f0.png \"SampleBot01.png\")\n\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u5834\u5408\u306f\u201d\u3067\u3093\u304c\u306a\uff01\u201d\u304c\u672b\u5c3e\u306b\u3064\u3044\u3066\u3001\u4f4d\u7f6e\u60c5\u5831\u3068\u30b9\u30bf\u30f3\u30d7\u306e\u5834\u5408\u306f\u305d\u306e\u307e\u307e\u8fd4\u4fe1\u3067\u304d\u3066\u3044\u307e\u3059\u306d\u3002\n\n![SampleBot02.png](https://qiita-image-store.s3.amazonaws.com/0/154381/af115a5a-76ae-d819-7b4e-60df90b88a54.png \"SampleBot02.png\")\n\u753b\u50cf\u306e\u5834\u5408\u306f\u9069\u5f53\u306a\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8fd4\u4fe1\u3067\u304d\u3066\u3044\u307e\u3059 :-)\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u7c21\u5358\u306b\u30b5\u30fc\u30d0\u30fc\u30ec\u30b9\u306aLINE Bot \u3092\u958b\u767a\u3067\u304d\u307e\u3059\u3002\u7d20\u6674\u3089\u3057\u304f\u7c21\u5358\u3067\u3059\u306d\u3047\u3002\n\n# \u305d\u306e\u4ed6\u30cf\u30de\u3063\u305f\u3053\u3068\n\u3053\u306e\u516c\u5f0f\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u30a2\u30d7\u30ea\u3092\u4f5c\u3063\u3066\u3044\u308b\u3068\u5e7e\u3064\u304b\u30cf\u30de\u3063\u305f\u3053\u3068\u304c\u3042\u3063\u305f\u306e\u3067\u8f09\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n## \u30a2\u30d7\u30ea\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\nAWS\u3078\u306e\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3059\u308b\u30bf\u30b9\u30af\u304cpackage.json \u3067\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u30b5\u30f3\u30d7\u30eb\u3067\u6e96\u5099\u3055\u308c\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\uff0f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3057\u304b\u8a18\u8f09\u3055\u308c\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u65b0\u305f\u306bjs \u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u305f\u5834\u5408\u306fpackage.json \u306e\u300cpackage-function\u300d\uff08Zip \u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308b\uff09\u30bf\u30b9\u30af\u306b\u8ffd\u8a18\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```json:package.json\uff08\u4e00\u90e8\uff09\n// \u5909\u66f4\u524d\n// \"package-function\": \"zip -q -r lambda-function.zip lambda.js app.js index.html node_module\",\n// \u2193\n// \u5909\u66f4\u5f8c \u672b\u5c3e\u306b\u300clib\u300d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\n\"package-function\": \"zip -q -r lambda-function.zip lambda.js app.js index.html node_modules lib\",\n```\n\n## AWS \u516c\u5f0f\u30b3\u30fc\u30c9\u3092\u4f7f\u3063\u3066\u8907\u6570\u306e\u30a2\u30d7\u30ea\u3092\u4f5c\u6210\u3059\u308b\u5834\u5408\n\u8907\u6570\u306eexpress \u30a2\u30d7\u30ea\u3092\u767b\u9332\u3059\u308b\u5834\u5408\u3001\u305d\u306e\u307e\u307e\u3067\u306f\u8907\u6570\u767b\u9332\u3067\u304d\u306a\u3044\u306e\u3067\u3001\u6b21\u306e\u8a2d\u5b9a\u3092\u30a2\u30d7\u30ea\u3054\u3068\u306b\u5909\u3048\u3066\u304a\u304d\u307e\u3059\u3002\n\n#### package.json \n\u30d5\u30a1\u30a4\u30eb\u306e\uff18\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b\"cloudFormationStackName\" \u306e\u5024\u3092\u5909\u3048\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\"cloudFormationStackName\" \u304c\u30a2\u30ab\u30a6\u30f3\u30c8\u5185\u3067\u91cd\u8907\u3059\u308b\u3068\u767b\u9332\u3067\u304d\u307e\u305b\u3093\u3002\n\n```json:package.json\uff08\u4e00\u90e8\uff09\n {\n   \"name\": \"aws-serverless-express-example\",\n   \"version\": \"1.1.0\",\n   \"description\": \"Example application for running a Node Express app on AWS Lambda using Amazon API Gateway.\",\n   \"main\": \"lambda.js\",\n   \"config\": {\n     \"s3BucketName\": \"samplebot-express-bucket\",\n     \"cloudFormationStackName\": \"AwsServerlessExpressStackSampleBot\", // <-- \u3053\u3053\n     \"region\": \"ap-northeast-1\"\n   }\n```\n\n#### simple-proxy-api.yaml \n\u30d5\u30a1\u30a4\u30eb\u306e4\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b \"title\" \u3092\u5909\u3048\u3066\u304a\u304f\u3068API Gateway \u306e\u30ea\u30bd\u30fc\u30b9\u540d\u79f0\u304c\u5909\u308f\u308b\u306e\u3067\u533a\u5225\u304c\u3064\u304d\u3084\u3059\u3044\u3067\u3059\u3002\n\n``` simple-proxy-api.yaml\uff08\u4e00\u90e8\uff09\n ---\n swagger: 2.0\n info:\n   title: SampleBotExpressApi // <-- \u3053\u3053\n basePath: /prod\n```\n\n# \u304a\u308f\u308a\u306b\n\u3053\u3093\u306a\u306b\u3082\u7c21\u5358\u306bWeb \u30a2\u30d7\u30ea\u3092\u4f5c\u308b\u3053\u3068\u304c\u51fa\u6765\u308b\u306a\u3093\u3066\u3001\u307b\u3093\u3068\u826f\u3044\u4e16\u306e\u4e2d\u306b\u306a\u308a\u307e\u3057\u305f\u306d\u3047\uff08\u9060\u3044\u76ee\n\n\u3061\u306a\u307f\u306b\u3001\u4eca\u56de\u7d39\u4ecb\u3057\u305f\u74b0\u5883\u3092\u4f7f\u3063\u3066\u300c[\u30db\u30c6\u30ebBot](http://hotelbot.app-labo.net/)\u300d\u3068\u3044\u3046LINE Bot \u3092\u958b\u767a\u3057\u3066\u3044\u307e\u3059\u3002\n[\u5225\u306e\u8a18\u4e8b\u306b\u3082\u63b2\u8f09\u3057\u307e\u3057\u305f](http://qiita.com/sumihiro3/items/ec310ea61d629c1daee9)\u304c\u3001Bot \u3068\u306e\u30c8\u30fc\u30af\u3067\u201d\u672d\u5e4c\u3067\u660e\u65e5\u304b\u3089\uff12\u6cca\u3001\u4e00\u4e07\u5186\u4ee5\u4e0b\u306e\u7981\u7159\u30eb\u30fc\u30e0\u3067\u671d\u98df\u3042\u308a\u201d \u306e\u3088\u3046\u306b\u30c6\u30ad\u30b9\u30c8\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u6761\u4ef6\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u3001\u6761\u4ef6\u306b\u3042\u3063\u305f\u30db\u30c6\u30eb\u306e\u691c\u7d22\u7d50\u679c\u3092\u8fd4\u3057\u3066\u304f\u308c\u3001\u305d\u306e\u307e\u307e\u4e88\u7d04\u307e\u3067\u3067\u304d\u308bLINE Bot\u3067\u3059\u3002\n\u51fa\u5f35\u304c\u591a\u304f\u983b\u7e41\u306b\u30db\u30c6\u30eb\u4e88\u7d04\u3092\u3059\u308b\u306e\u3067\u3001\u3053\u308c\u304b\u3089\u3082\u4f7f\u3044\u52dd\u624b\u304c\u3088\u304f\u306a\u308b\u3088\u3046\u306b\u6539\u826f\u3057\u3066\u3044\u304d\u305f\u3044\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u79c1\u306e\u3088\u3046\u306b\u51fa\u5f35\u65cf\u306e\u65b9\u3084\u3001\u65c5\u884c\u597d\u304d\u306a\u65b9\u306f\u662f\u975e\u304a\u8a66\u3057\u304f\u3060\u3055\u3044\u3002\n\nLINE \u30a2\u30d7\u30ea\u3067\u4e0b\u306eQR\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u53d6\u3063\u3066\u3001Bot \u3092\u53cb\u3060\u3061\u8ffd\u52a0\u3059\u308c\u3070\u3059\u3050\u306b\u4f7f\u3048\u307e\u3059\u3002\n<img height=\"200\" src=\"http://qr-official.line.me/L/cqnqVP5X5_.png\">\n\n\u3053\u306e\u30da\u30fc\u30b8\u3092\u30b9\u30de\u30fc\u30c8\u30d5\u30a9\u30f3\u3067\u898b\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u4e0b\u306e\u30dc\u30bf\u30f3\u3092\u30bf\u30c3\u30d7\u3057\u3066LINE \u30a2\u30d7\u30ea\u3067\u300c\u53cb\u3060\u3061\u8ffd\u52a0\u300d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n<a href=\"https://line.me/R/ti/p/%40ynv4372o\"><img height=\"64\" border=\"0\" alt=\"\u53cb\u3060\u3061\u8ffd\u52a0\" src=\"https://scdn.line-apps.com/n/line_add_friends/btn/ja.png\"></a>\n\n\u305d\u308c\u3067\u306f\u7686\u3055\u3093\u3082\u3088\u3044LINE Bot \u958b\u767a\u3092\uff01\n\n# \u53c2\u8003\u8a18\u4e8b\u306a\u3069\n\n* [AWS Lambda \u3068 Amazon API Gateway \u3067 Express \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c](https://aws.amazon.com/jp/blogs/news/running-express-applications-on-aws-lambda-and-amazon-api-gateway/)\n* [aws-serverless-express](https://github.com/awslabs/aws-serverless-express)\n* [AWS \u8b39\u88fd aws-serverless-express \u3092\u4f7f\u3063\u3066 APIGateway + Lambda + Node + Express \u3067 RESTful \u30b5\u30fc\u30d3\u30b9\u306e\u96db\u5f62\u3092\u6700\u901f\u3067\u4f5c\u308b](http://qiita.com/exabugs/items/594d3cd417e99dc29387)\n* [LINE BOT\u306e\u4f5c\u308a\u65b9\u3092\u4e16\u754c\u4e00\u308f\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\uff08\uff11\uff09\u3010\u30a2\u30ab\u30a6\u30f3\u30c8\u6e96\u5099\u7de8\u3011](http://qiita.com/yoshizaki_kkgk/items/bd4277d3943200beab26)\n* [\u3044\u3089\u3059\u3068\u3084](http://www.irasutoya.com/) \uff08\u3044\u3064\u3082\u304a\u4e16\u8a71\u306b\u306a\u3063\u3066\u3044\u307e\u3059\uff01\uff09\n* [\u30db\u30c6\u30ebBot \u306e\u4f7f\u3044\u65b9](http://qiita.com/sumihiro3/items/ec310ea61d629c1daee9)\n* [\u30db\u30c6\u30ebBot](http://hotelbot.app-labo.net/)\n", "tags": ["lambda", "Node.js", "linebot", "aws-serverless-express", "LINEmessagingAPI"]}