{"tags": ["Slim31.0.16"], "context": " More than 1 year has passed since last update.\n\nHTML\u3068Slim3(Java)\u5074\u3067\u3001Google App Engine\u306eKey\u3092\u3084\u308a\u53d6\u308a\n\u66f4\u65b0\u3084\u524a\u9664\u3067\u3001\u753b\u9762\u4e0a\u306b\u6587\u5b57\u5217\u3068\u3057\u3066\u57cb\u3081\u8fbc\u307e\u308c\u3066\u308bKey\u3092\u5143\u306b\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u307b\u3052\u307b\u3052\u3057\u305f\u3044\u5834\u5408\u3002\uff08\u666e\u901a\u306b\u3088\u304f\u3042\u308b\u72b6\u614b\u3067\u3059\uff09\n\n\u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u3066\u56f0\u3063\u3066\u3044\u305f\u30fb\u30fb\njava.lang.IllegalArgumentException: Cannot parse: HogeModel(3301)==\n    at com.google.appengine.api.datastore.KeyFactory.stringToKey(KeyFactory.java:197)\n    at org.slim3.datastore.DatastoreDelegate.stringToKey(DatastoreDelegate.java:641)\n\n\n\u72b6\u6cc1\u8aac\u660e\n\n\u30d5\u30ed\u30f3\u30c8\u5074\n<html>\n..\n<form>\n    <input type=\"hidden\" name=\"key\" value=\"aglub19hcHBfaWEkdhsgkSBEJsb2cYaAw\">\n    <span class=\"name\">\u3053\u308c\u304b\u3089\u524a\u9664\u3057\u305f\u3044\u5185\u5bb9</span>\n    <button type=\"submit\">\u524a\u9664\u3058\u3083</button>\n</form>\n..\n</html>\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u306fkey\u3067\u6e21\u3059\u3053\u3068\u306b\u3059\u308b\u3002\n\n\u30b5\u30fc\u30d0\u30fc\u5074(Slim3)\npublic class HogeController extends Controller {\n    @Override\n    public Navigation run() throws Exception {\n        // DELETE\u306e\u6642\u3060\u3051\u66f8\u3044\u3066\u307f\u308b\n        if(isDelete()) {\n            String keyString = request.getParameter(\"key\");\n            Key key = Datastore.stringToKey(keyString);\n            Datastore.delete(key);\n        }\n        return null;\n    }\n}\n\n\u30dd\u30a4\u30f3\u30c8\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u6587\u5b57\u5217\u3067\u53d7\u3051\u53d6\u3063\u305fkey\u3092Datastore.stringToKey\u3067Key\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3002\n\n\u9006\u306f\uff1f\uff08Key\u304b\u3089String\uff09\n\u3053\u308c\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u66f8\u3044\u3066\u3066\u3001\u9006\u5909\u63db\u3057\u3088\u3046\u3068\u3057\u3066\u3001\u52d8\u9055\u3044\u3057\u3066\u30cf\u30de\u308a\u307e\u3057\u305f\u30fb\u30fb\n@Test\npublic void testDelete() throws Exception {\n    HogeModel createdHoge = service.createHoge();\n    String keyString = Datastore.keyToString(createdHoge.getKey());\n    tester.request.setMethod(\"delete\");\n    tester.param(\"key\", keyString);\n    tester.start(\"/webapi/hoge\");\n\n    HogeModel removed = Datastore.query(HogeModel.class).asSingle();\n    assertThat(removed, is(nullValue()));\n}\n\n\u3084\u3063\u3071\u308a\u3001\u3068\u3044\u3046\u304b\u30cd\u30fc\u30df\u30f3\u30b0\u305d\u306e\u307e\u307e\u3067\u7d20\u6674\u3089\u3057\u3044\u3093\u3067\u3059\u304c\u3001Datastore.keyToString\u3092\u4f7f\u3063\u3066Key\u304b\u3089String\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\u3046\u3063\u304b\u308agetKey().toString()\u3067\u6e21\u3057\u3066\u3057\u3070\u3089\u304f\u30cf\u30de\u3063\u3066\u307e\u3057\u305f\u30fb\u30fb\u30fb\uff08\u5192\u982d\u306e\u30a8\u30e9\u30fc\u306b\u906d\u3046\uff09\u3000\u305d\u308a\u3083\u3041\u3001\u30c0\u30e1\u3060\u308d\u3046\u3055\u3002\u3002\n\n\u53c2\u8003URL\uff1a \u3010\u5165\u9580\u7de8\u3011Slim3\u3067\u59cb\u3081\u308b\uff01GAE/J\u3067\u30af\u30e9\u30a6\u30c9\u30fb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\uff08\u7b2c\uff13\u56de\uff09\u30001/8\u30da\u30fc\u30b8 | \u30ad\u30e3\u30b9\u30ec\u30fc\u30b3\u30f3\u30b5\u30eb\u30c6\u30a3\u30f3\u30b0\u3000\u6280\u8853\u30d6\u30ed\u30b0\n## HTML\u3068Slim3(Java)\u5074\u3067\u3001Google App Engine\u306eKey\u3092\u3084\u308a\u53d6\u308a\n\n\u66f4\u65b0\u3084\u524a\u9664\u3067\u3001\u753b\u9762\u4e0a\u306b\u6587\u5b57\u5217\u3068\u3057\u3066\u57cb\u3081\u8fbc\u307e\u308c\u3066\u308bKey\u3092\u5143\u306b\u3001\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u307b\u3052\u307b\u3052\u3057\u305f\u3044\u5834\u5408\u3002\uff08\u666e\u901a\u306b\u3088\u304f\u3042\u308b\u72b6\u614b\u3067\u3059\uff09\n\n### \u3053\u3093\u306a\u30a8\u30e9\u30fc\u304c\u3067\u3066\u56f0\u3063\u3066\u3044\u305f\u30fb\u30fb\n\n```\njava.lang.IllegalArgumentException: Cannot parse: HogeModel(3301)==\n\tat com.google.appengine.api.datastore.KeyFactory.stringToKey(KeyFactory.java:197)\n\tat org.slim3.datastore.DatastoreDelegate.stringToKey(DatastoreDelegate.java:641)\n```\n\n## \u72b6\u6cc1\u8aac\u660e\n\n### \u30d5\u30ed\u30f3\u30c8\u5074\n\n```\n<html>\n..\n<form>\n    <input type=\"hidden\" name=\"key\" value=\"aglub19hcHBfaWEkdhsgkSBEJsb2cYaAw\">\n    <span class=\"name\">\u3053\u308c\u304b\u3089\u524a\u9664\u3057\u305f\u3044\u5185\u5bb9</span>\n    <button type=\"submit\">\u524a\u9664\u3058\u3083</button>\n</form>\n..\n</html>\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u540d\u306fkey\u3067\u6e21\u3059\u3053\u3068\u306b\u3059\u308b\u3002\n\n### \u30b5\u30fc\u30d0\u30fc\u5074(Slim3)\n\n```\npublic class HogeController extends Controller {\n    @Override\n    public Navigation run() throws Exception {\n        // DELETE\u306e\u6642\u3060\u3051\u66f8\u3044\u3066\u307f\u308b\n        if(isDelete()) {\n            String keyString = request.getParameter(\"key\");\n            Key key = Datastore.stringToKey(keyString);\n            Datastore.delete(key);\n        }\n        return null;\n    }\n}\n```\n\n\u30dd\u30a4\u30f3\u30c8\u306f\u30d1\u30e9\u30e1\u30fc\u30bf\u6587\u5b57\u5217\u3067\u53d7\u3051\u53d6\u3063\u305fkey\u3092```Datastore.stringToKey```\u3067Key\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3002\n\n## \u9006\u306f\uff1f\uff08Key\u304b\u3089String\uff09\n\n\u3053\u308c\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u66f8\u3044\u3066\u3066\u3001\u9006\u5909\u63db\u3057\u3088\u3046\u3068\u3057\u3066\u3001\u52d8\u9055\u3044\u3057\u3066\u30cf\u30de\u308a\u307e\u3057\u305f\u30fb\u30fb\n\n```\n@Test\npublic void testDelete() throws Exception {\n    HogeModel createdHoge = service.createHoge();\n    String keyString = Datastore.keyToString(createdHoge.getKey());\n    tester.request.setMethod(\"delete\");\n    tester.param(\"key\", keyString);\n    tester.start(\"/webapi/hoge\");\n    \n    HogeModel removed = Datastore.query(HogeModel.class).asSingle();\n    assertThat(removed, is(nullValue()));\n}\n```\n\n\u3084\u3063\u3071\u308a\u3001\u3068\u3044\u3046\u304b\u30cd\u30fc\u30df\u30f3\u30b0\u305d\u306e\u307e\u307e\u3067\u7d20\u6674\u3089\u3057\u3044\u3093\u3067\u3059\u304c\u3001```Datastore.keyToString```\u3092\u4f7f\u3063\u3066Key\u304b\u3089String\u306b\u5909\u63db\u3057\u307e\u3059\u3002\n\n\u3046\u3063\u304b\u308agetKey().toString()\u3067\u6e21\u3057\u3066\u3057\u3070\u3089\u304f\u30cf\u30de\u3063\u3066\u307e\u3057\u305f\u30fb\u30fb\u30fb\uff08\u5192\u982d\u306e\u30a8\u30e9\u30fc\u306b\u906d\u3046\uff09\u3000\u305d\u308a\u3083\u3041\u3001\u30c0\u30e1\u3060\u308d\u3046\u3055\u3002\u3002\n\n- - -\n\u53c2\u8003URL\uff1a [\u3010\u5165\u9580\u7de8\u3011Slim3\u3067\u59cb\u3081\u308b\uff01GAE/J\u3067\u30af\u30e9\u30a6\u30c9\u30fb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u958b\u767a\uff08\u7b2c\uff13\u56de\uff09\u30001/8\u30da\u30fc\u30b8 | \u30ad\u30e3\u30b9\u30ec\u30fc\u30b3\u30f3\u30b5\u30eb\u30c6\u30a3\u30f3\u30b0\u3000\u6280\u8853\u30d6\u30ed\u30b0](http://www.casleyconsulting.co.jp/blog-engineer/gae/%E3%80%90%E5%85%A5%E9%96%80%E7%B7%A8%E3%80%91slim3%E3%81%A7%E5%A7%8B%E3%82%81%E3%82%8B%EF%BC%81gaej%E3%81%A7%E3%82%AF%E3%83%A9%E3%82%A6%E3%83%89%E3%83%BB%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC-6/)\n"}