{"context": "Fluentd\u3068Elasticsearch\u3068Kibana\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u6d41\u884c\u3063\u3066\u308b\uff1f\u307f\u305f\u3044\u306a\u306e\u3067docker\u74b0\u5883\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n\u524d\u63d0\n\n\u30ed\u30b0\u306f\u884c\u306bJSON\nFluentd\u3068Elasticsearch\u3068Kibana\u306f\u540c\u3058\u30b5\u30fc\u30d0\u4e0a\u306b\u5b58\u5728\n\n\n\u69cb\u6210\n.\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 elasticsearch\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 fluentd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Dockerfile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fluent.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 plugins\n\u2514\u2500\u2500 log\n    \u2514\u2500\u2500 hoge_log # \u53ce\u96c6\u3059\u308b\u30ed\u30b0\n\n\nDocker\n\ndocker-compose.yml\nelasticsearch:\n  build: elasticsearch\n  ports:\n    - 9200:9200\nfluentd:\n  build: fluentd\n  ports:\n    - 24284:24284\n  volumes:\n    - ./log:/var/log/hoge\n  links:\n    - elasticsearch\nkibana:\n  image: kibana\n  ports:\n    - 9204:5601\n  environment:\n      - ELASTICSEARCH_URL=http://elasticsearch:9200\n  links:\n      - elasticsearch\n\n\n\nFluentd\nFROM fluent/fluentd:latest-onbuild\n\nUSER fluent\n\nWORKDIR /home/fluent\nENV PATH /home/fluent/.gem/ruby/2.3.0/bin:$PATH\nRUN gem install fluent-plugin-secure-forward # \u30bb\u30ad\u30ea\u30e5\u30c6\u30a3\u5bfe\u7b56\nRUN gem install fluent-plugin-elasticsearch # Elasticsearch\u9023\u643a\n\nEXPOSE 24284\n\nCMD fluentd -c /fluentd/etc/fluent.conf -p /fluentd/plugins -vv\n\n\nfluent.conf\n<source>\n  type tail\n  path /var/log/hoge/hoge_log\n  tag json.hoge\n  pos_file /var/log/hoge/hoge_log.pos\n  format json\n</source>\n\n<match json.**>\n  type copy\n\n  <store>\n    type elasticsearch\n    host elasticsearch\n    port 9200\n    logstash_format true\n  </store>\n\n  <store>\n    type stdout\n  </store>\n</match>\n\n\n\nElasticsearch\nFROM elasticsearch\n\nRUN bin/plugin install mobz/elasticsearch-head\n\nEXPOSE 9200\n\nCMD  [\"bin/elasticsearch\", \"-Des.insecure.allow.root=true\"] # root=true\u304c\u7121\u3044\u3068\u521d\u56de\u8d77\u52d5\u3067\u5931\u6557\u3059\u308b\n\n\n\u8d77\u52d5\n$ docker-compose up --build\n\nElasticsearch \u30da\u30fc\u30b8\nhttp://[IP]:9200/_plugin/head/\n\nKibana\u30da\u30fc\u30b8\nhttp://[IP]:9204/\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8a66\u3057\u306b\u30ed\u30b0\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\n$ echo \"{ hoge :\"hoge\" }\" >> log/hoge_log\n\nElasticsearch\u306b\u30ed\u30b0\u304c\u5165\u3063\u3066\u3044\u308c\u3070OK\n\ngithub\n\u4eca\u56de\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/naruminn/fluentd-elasticsearch-kibana\n\nFluentd\u3068Elasticsearch\u3068Kibana\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u6d41\u884c\u3063\u3066\u308b\uff1f\u307f\u305f\u3044\u306a\u306e\u3067docker\u74b0\u5883\u3067\u4f5c\u3063\u3066\u307f\u307e\u3057\u305f\u3002\n\n## \u524d\u63d0\n\n* \u30ed\u30b0\u306f\u884c\u306bJSON\n* Fluentd\u3068Elasticsearch\u3068Kibana\u306f\u540c\u3058\u30b5\u30fc\u30d0\u4e0a\u306b\u5b58\u5728\n\n## \u69cb\u6210\n\n```bash\n.\n\u251c\u2500\u2500 docker-compose.yml\n\u251c\u2500\u2500 elasticsearch\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 fluentd\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Dockerfile\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fluent.conf\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 plugins\n\u2514\u2500\u2500 log\n    \u2514\u2500\u2500 hoge_log # \u53ce\u96c6\u3059\u308b\u30ed\u30b0\n```\n\n## Docker\n\n```docker-compose.yml\nelasticsearch:\n  build: elasticsearch\n  ports:\n    - 9200:9200\nfluentd:\n  build: fluentd\n  ports:\n    - 24284:24284\n  volumes:\n    - ./log:/var/log/hoge\n  links:\n    - elasticsearch\nkibana:\n  image: kibana\n  ports:\n    - 9204:5601\n  environment:\n      - ELASTICSEARCH_URL=http://elasticsearch:9200\n  links:\n      - elasticsearch\n```\n\n\n## Fluentd\n\n```Dockerfile\nFROM fluent/fluentd:latest-onbuild\n\nUSER fluent\n\nWORKDIR /home/fluent\nENV PATH /home/fluent/.gem/ruby/2.3.0/bin:$PATH\nRUN gem install fluent-plugin-secure-forward # \u30bb\u30ad\u30ea\u30e5\u30c6\u30a3\u5bfe\u7b56\nRUN gem install fluent-plugin-elasticsearch # Elasticsearch\u9023\u643a\n\nEXPOSE 24284\n\nCMD fluentd -c /fluentd/etc/fluent.conf -p /fluentd/plugins -vv\n```\n\n```fluent.conf\n<source>\n  type tail\n  path /var/log/hoge/hoge_log\n  tag json.hoge\n  pos_file /var/log/hoge/hoge_log.pos\n  format json\n</source>\n\n<match json.**>\n  type copy\n\n  <store>\n    type elasticsearch\n    host elasticsearch\n    port 9200\n    logstash_format true\n  </store>\n\n  <store>\n    type stdout\n  </store>\n</match>\n```\n\n## Elasticsearch\n\n\n```Dockerfile\nFROM elasticsearch\n\nRUN bin/plugin install mobz/elasticsearch-head\n\nEXPOSE 9200\n\nCMD  [\"bin/elasticsearch\", \"-Des.insecure.allow.root=true\"] # root=true\u304c\u7121\u3044\u3068\u521d\u56de\u8d77\u52d5\u3067\u5931\u6557\u3059\u308b\n```\n\n## \u8d77\u52d5\n\n```bash\n$ docker-compose up --build\n```\n\n\nElasticsearch \u30da\u30fc\u30b8\n\n```\nhttp://[IP]:9200/_plugin/head/\n```\n\nKibana\u30da\u30fc\u30b8\n\n```\nhttp://[IP]:9204/\n```\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u8a66\u3057\u306b\u30ed\u30b0\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\n\n```bash\n$ echo \"{ hoge :\"hoge\" }\" >> log/hoge_log\n```\n\nElasticsearch\u306b\u30ed\u30b0\u304c\u5165\u3063\u3066\u3044\u308c\u3070OK\n\n## github\n\n\u4eca\u56de\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\nhttps://github.com/naruminn/fluentd-elasticsearch-kibana\n", "tags": ["Elasticsearch", "docker-compose", "fluentd", "docker", "kibana"]}