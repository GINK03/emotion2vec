{"context": " More than 1 year has passed since last update.\n\n\u3010 \u60f3\u5b9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30fbDB\u30c6\u30fc\u30d6\u30eb \u3011\n\n\n\uff08 \u30c6\u30fc\u30d6\u30eb\u7269\u7406\u540d \uff09user_log\n\uff08 \u30c6\u30fc\u30d6\u30eb\u30ab\u30e9\u30e0\u540d \uff09 user_id, datetime\uff08\u30ed\u30b0\u30a4\u30f3\u65e5\uff09\n\n\n\n\u3010 SQL \u3011\n\n\n\u3010 \u53d6\u5f97\u3055\u308c\u308b\u30ab\u30e9\u30e0 \u3011\n\n\nuser_id\nperiod_login_days\npercent_rank_login_days\nstart_date\nend_date\n\n\n\uff08 \u5099\u8003 \uff09\n\n\u65e5\u4ed8\uff08YYYY-MM-DD HH24:MI:SS\uff09\u30ab\u30e9\u30e0\u3092 YYYY-MM-DD \u5f62\u5f0f \u306b \u5207\u308a\u4e0a\u3052\u308b\u90e8\u5206\u306f\u3001AWS Redshift \u5b9f\u88c5\u306edate_trunc()\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\nOracke \u306e \u5834\u5408\u306f\u3001trunc('DD', datetime) \u306b\u7f6e\u304d\u63db\u3048\u3066\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nSQL\nSET start_date '2015-05-01'\nSET end_date '2015-05-31'\n\nWITH temp AS (\n              SELECT distinct user_id,\n                 count(distinct date_trunc('day', datetime)) over(partition by user_id) as period_login_days\n          FROM   user_log\n          WHERE  date_trunc('day', datetime)) between :start_date and :end_date\n             )\nSELECT temp.*,\n       percent_rank()over (partition by user_id order by period_login_days) as percent_rank_login_days,\n       :start_date AS start_date,\n       :end_date AS end_date\nFROM   temp\nORDER  BY percent_rank_login_days\n\n\n\n\n\u3010 \u53c2\u8003\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8 \u3011\n\n\nAmazon Redshift \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u958b\u767a\u8005\u30ac\u30a4\u30c9 (API Version 2012-12-01) \u300cPERCENT_RANK \u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306e\u4f8b\u300d\n\u30a8\u30af\u30bb\u30eb\u5b9f\u8df5\u587e\u300c\u300c\u4e0a\u4f4d\uff08\u4e0b\u4f4d\uff09\u25cb\uff05\u4ee5\u5185\u300d\u3092\u5224\u5b9a\u3059\u308b\u3068\u304d\u306b\u306f\u3001PERCENTRANK\u95a2\u6570\u3092\u4f7f\u3046\u300d\n\n###__\u3010 \u60f3\u5b9a\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u30fbDB\u30c6\u30fc\u30d6\u30eb \u3011__\n\n* __\uff08 \u30c6\u30fc\u30d6\u30eb\u7269\u7406\u540d \uff09**user_log**__\n\n* __\uff08 \u30c6\u30fc\u30d6\u30eb\u30ab\u30e9\u30e0\u540d \uff09 **user_id**, **datetime\uff08\u30ed\u30b0\u30a4\u30f3\u65e5\uff09**__\n\n___\n\n###__\u3010 SQL \u3011__\n\n####__\u3010 \u53d6\u5f97\u3055\u308c\u308b\u30ab\u30e9\u30e0 \u3011__\n\n* user_id\n* period_login_days\n* percent_rank_login_days\n* start_date\n* end_date\n\n##### __\uff08 \u5099\u8003 \uff09__\n\n\u65e5\u4ed8\uff08YYYY-MM-DD HH24:MI:SS\uff09\u30ab\u30e9\u30e0\u3092 YYYY-MM-DD \u5f62\u5f0f \u306b \u5207\u308a\u4e0a\u3052\u308b\u90e8\u5206\u306f\u3001AWS Redshift \u5b9f\u88c5\u306edate_trunc()\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\nOracke \u306e \u5834\u5408\u306f\u3001trunc('DD', datetime) \u306b\u7f6e\u304d\u63db\u3048\u3066\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```{SQL:SQL}\nSET start_date '2015-05-01'\nSET end_date '2015-05-31'\n\nWITH temp AS (\n              SELECT distinct user_id,\n\t             count(distinct date_trunc('day', datetime)) over(partition by user_id) as period_login_days\n\t      FROM   user_log\n\t      WHERE  date_trunc('day', datetime)) between :start_date and :end_date\n             )\nSELECT temp.*,\n       percent_rank()over (partition by user_id order by period_login_days) as percent_rank_login_days,\n       :start_date AS start_date,\n       :end_date AS end_date\nFROM   temp\nORDER  BY percent_rank_login_days\n```\n\n___\n\n### __\u3010 \u53c2\u8003\u30a6\u30a7\u30d6\u30b5\u30a4\u30c8 \u3011__\n\n* [Amazon Redshift \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u958b\u767a\u8005\u30ac\u30a4\u30c9 (API Version 2012-12-01) \u300cPERCENT_RANK \u30a6\u30a3\u30f3\u30c9\u30a6\u95a2\u6570\u306e\u4f8b\u300d](http://docs.aws.amazon.com/ja_jp/redshift/latest/dg/r_Examples_of_PERCENT_RANK_WF.html)\n* [\u30a8\u30af\u30bb\u30eb\u5b9f\u8df5\u587e\u300c\u300c\u4e0a\u4f4d\uff08\u4e0b\u4f4d\uff09\u25cb\uff05\u4ee5\u5185\u300d\u3092\u5224\u5b9a\u3059\u308b\u3068\u304d\u306b\u306f\u3001PERCENTRANK\u95a2\u6570\u3092\u4f7f\u3046\u300d](http://www.ne.jp/asahi/juku/excel/Joukensiki530.htm)\n", "tags": ["SQL", "\u30de\u30fc\u30b1\u30c6\u30a3\u30f3\u30b0", "\u30a2\u30af\u30bb\u30b9\u89e3\u6790", "\u30b9\u30de\u30db\u30b2\u30fc\u30e0", "\u30c7\u30fc\u30bf\u5206\u6790"]}