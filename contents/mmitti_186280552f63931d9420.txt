{"context": "\n\n\u6982\u8981\nkube-dns\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3067\u52d5\u304b\u3057\u307e\u3059\u3002\ncluster-dns\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u3067\u901a\u4fe1\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\u300cKubernetes\u3092Ubuntu\u3067\u52d5\u304b\u3059\u300d\u3067\u69cb\u7bc9\u3057\u305f\u74b0\u5883\u304c\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u52d5\u4f5c\u74b0\u5883\n\u4e0a\u8a18\u306e\u8a18\u4e8b\u3068\u540c\u3058\u74b0\u5883\u3068\u306a\u308a\u307e\u3059\u3002\n\n\n\n\nmaster\u30b5\u30fc\u30d0\u30fc\nnode\u30b5\u30fc\u30d0\u30fc\n\n\n\n\n\u30db\u30b9\u30c8\u540d\nmaster\nnode1\n\n\nIP\u30a2\u30c9\u30ec\u30b9\n192.168.137.20\n192.168.137.21\n\n\n\u52d5\u4f5c\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9\nkube-apiserverkube-controller-managerkube-schedulerkube-dns\n\nkubeletkube-proxy\n\n\n\ndns\u30b5\u30fc\u30d0\u30fc(kube-dns)\u306fmaster\u4e0a53\u756a\u30dd\u30fc\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\uff09\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306f\u30c9\u30e1\u30a4\u30f3\u540d\u3092mmitti.info\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306fcluster.local\u3067\u3059\u3002\uff09\n\nmaster\u5074\u306e\u69cb\u7bc9\nkube-dns\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\n\u9014\u4e2d\u307e\u3067\u3053\u3061\u3089\u306e\u8a18\u4e8b\u3068\u540c\u3058\u624b\u9806\u3068\u306a\u308a\u307e\u3059\u3002\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\ncd kubernetes/server\n#\u304a\u4f7f\u3044\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n\n\u7d9a\u3051\u3066kube-dns\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nsudo cp kubernetes/server/bin/kube-dns /opt/bin/\nsudo ln -s /opt/bin/kube-dns /usr/local/bin/\n\n/etc/init/kube-dns.conf\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\nKUBE_DNS_OPTS\u306f\u74b0\u5883\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ndescription \"Kube-dns service\"\nauthor \"@mmitti\"\n\nrespawn\n\nstart on started kube-apiserver\nstop on stopping kube-apiserver\n\npre-start script\n        KUBE_DNS=/opt/bin/$UPSTART_JOB\n        if [ -f /etc/default/$UPSTART_JOB ]; then\n                . /etc/default/$UPSTART_JOB\n        fi\n        if [ -f $KUBE_DNS ]; then\n                exit 0\n        fi\n    exit 22\nend script\n\nscript\n        KUBE_DNS=/opt/bin/$UPSTART_JOB\n        KUBE_DNS_OPTS=\"--kube-master-url=http://master:8080 --domain=mmitti.info\"\n        if [ -f /etc/default/$UPSTART_JOB ]; then\n                . /etc/default/$UPSTART_JOB\n        fi\n        exec \"$KUBE_DNS\" $KUBE_DNS_OPTS\nend script\n\n\nnode\u5074\nkubelet\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n/etc/init/kubelet.conf\u306eKUBELET_OPTS\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n--cluster-dns=192.168.137.20 --cluster-domain=mmitti.info\n\n\u306a\u304a\u3001cluster-dns\u3068cluster-domain\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3088\u3046\u3067\u3059\u3002\nkubelet does not have ClusterDNS IP configured and cannot create Pod using \"ClusterFirst\" policy. Falling back to DNSDefault policy.\n\n\ncluster-dns\u30b5\u30f3\u30d7\u30eb\n\u89e3\u51cd\u3057\u305fkubernetes\u4ee5\u4e0b\u306eexamples/cluster-dns\u306b\u79fb\u52d5\u3057\u3066\u4f5c\u696d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\ndns-frontend-pod.yaml(\u5dee\u5206\u306e\u307f\u793a\u3057\u307e\u3059)\n14c14\n<         - http://dns-backend.development.cluster.local:8000\n---\n>         - http://dns-backend.default.svc.mmitti.info:8000\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u9806\u306b\u5b9f\u884c\u3057\u3066pod\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\nkubectl create -f dns-backend-rc.yaml\nkubectl create -f dns-backend-service.yaml\nkubectl create -f dns-frontend-pod.yaml\n\n\u6700\u5f8c\u306b\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nkubectl logs dns-frontend\n\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\u3002\n10.254.104.56\nSend request to: http://dns-backend.default.svc.mmitti.info:8000\n<Response [200]>\nHello World!\n\n\u306a\u304a\u3001\u767b\u9332\u3055\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u30c9\u30e1\u30a4\u30f3\u306f\u30b5\u30fc\u30d3\u30b9\u540d.\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9.svc.\u30c9\u30e1\u30a4\u30f3\u3068\u306a\u308a\u307e\u3059\u3002\n\n\u53c2\u8003\nhttps://github.com/kubernetes/kubernetes/tree/master/build/kube-dns\n#\u6982\u8981\nkube-dns\u3092\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9\u3067\u52d5\u304b\u3057\u307e\u3059\u3002\ncluster-dns\u30b5\u30f3\u30d7\u30eb\u3092\u52d5\u304b\u3057\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u3067\u901a\u4fe1\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n[\u300cKubernetes\u3092Ubuntu\u3067\u52d5\u304b\u3059\u300d](http://qiita.com/mmitti/private/6c1bedbcffdda6a63473)\u3067\u69cb\u7bc9\u3057\u305f\u74b0\u5883\u304c\u524d\u63d0\u3068\u306a\u308a\u307e\u3059\u3002\n\n#\u52d5\u4f5c\u74b0\u5883\n\u4e0a\u8a18\u306e\u8a18\u4e8b\u3068\u540c\u3058\u74b0\u5883\u3068\u306a\u308a\u307e\u3059\u3002\n\n||master\u30b5\u30fc\u30d0\u30fc|node\u30b5\u30fc\u30d0\u30fc|\n|:----|:----|:----|\n|\u30db\u30b9\u30c8\u540d|master|node1|\n|IP\u30a2\u30c9\u30ec\u30b9|192.168.137.20|192.168.137.21|\n|\u52d5\u4f5c\u3057\u3066\u3044\u308b\u30b5\u30fc\u30d3\u30b9|kube-apiserver<BR>kube-controller-manager<BR>kube-scheduler<BR>**kube-dns**|kubelet<BR>kube-proxy|\n\ndns\u30b5\u30fc\u30d0\u30fc(kube-dns)\u306fmaster\u4e0a53\u756a\u30dd\u30fc\u30c8\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\uff09\u3067\u52d5\u4f5c\u3057\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306f\u30c9\u30e1\u30a4\u30f3\u540d\u3092mmitti.info\u3068\u3057\u3066\u8a18\u8f09\u3057\u3066\u3044\u307e\u3059\u3002\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306fcluster.local\u3067\u3059\u3002\uff09\n\n\n#master\u5074\u306e\u69cb\u7bc9\nkube-dns\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u3059\u3002\n\u9014\u4e2d\u307e\u3067[\u3053\u3061\u3089\u306e\u8a18\u4e8b](http://qiita.com/mmitti/private/6c1bedbcffdda6a63473#kubernetes%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E8%A8%AD%E5%AE%9A)\u3068\u540c\u3058\u624b\u9806\u3068\u306a\u308a\u307e\u3059\u3002\n\n```\nwget https://github.com/kubernetes/kubernetes/releases/download/v1.3.6/kubernetes.tar.gz\ntar xzvf kubernetes.tar.gz\ncd kubernetes/server\n#\u304a\u4f7f\u3044\u306e\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\ntar xzvf kubernetes-server-linux-amd64.tar.gz\n```\n\n\u7d9a\u3051\u3066kube-dns\u306e\u30d0\u30a4\u30ca\u30ea\u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n```\nsudo cp kubernetes/server/bin/kube-dns /opt/bin/\nsudo ln -s /opt/bin/kube-dns /usr/local/bin/\n```\n\n/etc/init/kube-dns.conf\u3092\u4ee5\u4e0b\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\nKUBE_DNS_OPTS\u306f\u74b0\u5883\u306b\u5fdc\u3058\u3066\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\ndescription \"Kube-dns service\"\nauthor \"@mmitti\"\n\nrespawn\n\nstart on started kube-apiserver\nstop on stopping kube-apiserver\n\npre-start script\n        KUBE_DNS=/opt/bin/$UPSTART_JOB\n        if [ -f /etc/default/$UPSTART_JOB ]; then\n                . /etc/default/$UPSTART_JOB\n        fi\n        if [ -f $KUBE_DNS ]; then\n                exit 0\n        fi\n    exit 22\nend script\n\nscript\n        KUBE_DNS=/opt/bin/$UPSTART_JOB\n        KUBE_DNS_OPTS=\"--kube-master-url=http://master:8080 --domain=mmitti.info\"\n        if [ -f /etc/default/$UPSTART_JOB ]; then\n                . /etc/default/$UPSTART_JOB\n        fi\n        exec \"$KUBE_DNS\" $KUBE_DNS_OPTS\nend script\n```\n\n#node\u5074\nkubelet\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\u3092\u884c\u3044\u307e\u3059\u3002\n/etc/init/kubelet.conf\u306eKUBELET_OPTS\u306b\u4ee5\u4e0b\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```\n--cluster-dns=192.168.137.20 --cluster-domain=mmitti.info\n```\n\n\u306a\u304a\u3001cluster-dns\u3068cluster-domain\u3092\u8a2d\u5b9a\u3057\u306a\u3044\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u3088\u3046\u3067\u3059\u3002\n\n```\nkubelet does not have ClusterDNS IP configured and cannot create Pod using \"ClusterFirst\" policy. Falling back to DNSDefault policy.\n```\n\n\n#cluster-dns\u30b5\u30f3\u30d7\u30eb\n\u89e3\u51cd\u3057\u305fkubernetes\u4ee5\u4e0b\u306eexamples/cluster-dns\u306b\u79fb\u52d5\u3057\u3066\u4f5c\u696d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ndns-frontend-pod.yaml(\u5dee\u5206\u306e\u307f\u793a\u3057\u307e\u3059)\n\n```\n14c14\n<         - http://dns-backend.development.cluster.local:8000\n---\n>         - http://dns-backend.default.svc.mmitti.info:8000\n```\n\n\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u9806\u306b\u5b9f\u884c\u3057\u3066pod\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nkubectl create -f dns-backend-rc.yaml\nkubectl create -f dns-backend-service.yaml\nkubectl create -f dns-frontend-pod.yaml\n```\n\n\u6700\u5f8c\u306b\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```\nkubectl logs dns-frontend\n```\n\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8868\u793a\u3055\u308c\u308c\u3070OK\u3067\u3059\u3002\n\n```\n10.254.104.56\nSend request to: http://dns-backend.default.svc.mmitti.info:8000\n<Response [200]>\nHello World!\n```\n\n\u306a\u304a\u3001\u767b\u9332\u3055\u308c\u308b\u30b5\u30fc\u30d3\u30b9\u306e\u30c9\u30e1\u30a4\u30f3\u306f`\u30b5\u30fc\u30d3\u30b9\u540d.\u30cd\u30fc\u30e0\u30b9\u30da\u30fc\u30b9.svc.\u30c9\u30e1\u30a4\u30f3`\u3068\u306a\u308a\u307e\u3059\u3002\n\n#\u53c2\u8003\nhttps://github.com/kubernetes/kubernetes/tree/master/build/kube-dns\n\n", "tags": ["kubernetes"]}