{"tags": ["PHP", "Heroku", "shell", "Redis"], "context": "\u4e0b\u8a18\u306funix\u30e9\u30a4\u30af\u306a\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304c\u5229\u7528\u3067\u304d\u308b\u524d\u63d0\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\ngit\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u305f\u308a\u3059\u308b\u306e\u3067\u307e\u305a\u306f\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u3066\u306d\u3002\n\n\u30b3\u30de\u30f3\u30c9\n$ git --version\n\n\nhttps://git-scm.com/book/ja/v1/%E4%BD%BF%E3%81%84%E5%A7%8B%E3%82%81%E3%82%8B-Git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\n\nheroku\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\nhttps://www.heroku.com/\n\nheroku\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://devcenter.heroku.com/articles/heroku-command-line\n\nssh\u30ad\u30fc\u4f5c\u6210(heroku\u306bpush\u3059\u308b\u3068\u304d\u3044\u308b\u3088)\nhttp://webkaru.net/linux/ssh-keygen-command/\n\nheroku\u306bssh\u30ad\u30fc\u3092\u767b\u9332\nhttp://blog.infinity-dimensions.com/2012/02/heroku-public-key-add.html\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u4e0b\u8a18\u3092\u5b9f\u884c\n\n\u30b3\u30de\u30f3\u30c9\n$ curl -o- https://raw.githubusercontent.com/nanananamememe/open_heroku/master/make.sh | bash\n\n\n\n\u51fa\u529b\u7d50\u679c\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   261  100   261    0     0   1003      0 --:--:-- --:--:-- --:--:--  1007\nmkdir: my_site: File exists\nReinitialized existing Git repository in ~/my_site/.git/\nCreating app... done, \u2b22 hoge-piyo-99999\nhttps://hoge-piyo-99999.herokuapp.com/ | https://git.heroku.com/hoge-piyo-99999.git\nOn branch master\nnothing to commit, working directory clean\nCounting objects: 4, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (2/2), done.\nWriting objects: 100% (4/4), 299 bytes | 0 bytes/s, done.\nTotal 4 (delta 0), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----> PHP app detected\nremote: -----> Bootstrapping...\nremote: -----> Installing platform packages...\nremote:        NOTICE: No runtime required in composer.lock; using PHP ^5.5.17\nremote:        - apache (2.4.20)\nremote:        - nginx (1.8.1)\nremote:        - php (5.6.29)\nremote: -----> Installing dependencies...\nremote:        Composer version 1.2.4 2016-12-06 22:00:51\nremote: -----> Preparing runtime environment...\nremote:        NOTICE: No Procfile, using 'web: vendor/bin/heroku-php-apache2'.\nremote: -----> Checking for additional extensions to install...\nremote: -----> Discovering process types\nremote:        Procfile declares types -> web\nremote: \nremote: -----> Compressing...\nremote:        Done: 13.5M\nremote: -----> Launching...\nremote:        Released v3\nremote:        https://hoge-piyo-99999.herokuapp.com/ deployed to Heroku\nremote: \nremote: Verifying deploy.... done.\nTo https://git.heroku.com/hoge-piyo-99999.git\n * [new branch]      master -> master\n\n\n\u3053\u308c\u3067\u5e83\u544a\u8868\u793a\u7121\u3057\u306e\u30d5\u30ea\u30fc\u306eweb\u30b5\u30a4\u30c8\u304c\u958b\u8a2d\u3055\u308c\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3092\u5b9f\u884c\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306e\u76f4\u4e0b\u306bmy_site\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u304c\u51fa\u6765\u307e\u3059\u3002\nheroku\u306e\u30a2\u30d7\u30ea\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u3001my_site\u30d5\u30a9\u30eb\u30c0\u306b\u30ea\u30e2\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u3057\u3066\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nweb\u30b5\u30a4\u30c8\u3092\u7de8\u96c6\n\n\u30b3\u30de\u30f3\u30c9\n$ cd my_site;\n$ echo '<p><a href=\"test.html\">test.html</a></p>' >> index.html;\n$ echo 'This is a pen. This is a apple. huuunmm! Applepen!!' > test.html;\n$ git add .;\n$ git commit -a -m test;\n$ git push heroku master;\n$ heroku open;\n\n\n\u3069\u3046\u3067\u3059\u304b\uff1findex.html\u306btest.html\u306e\u30ea\u30f3\u30af\u304c\u8cbc\u3089\u308c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\uff1f\n\u3042\u3068\u306f\u30ac\u30f3\u30ac\u30f3html\u306a\u308ajavascript\u306a\u308acss\u306a\u308a\u66f8\u3044\u3066\u30b3\u30df\u30c3\u30c8\u3057\u3066\u30d7\u30c3\u30b7\u30e5\u3057\u3066web\u30b5\u30a4\u30c8\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n\u3053\u308c\u3060\u3051\u3060\u3068\u4f55\u306a\u306e\u3067\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\n\nmake.sh\n#!/bin/sh\napp=$1; #\u2190\u5f15\u6570\u3092\u53d6\u5f97\nif [ -z \"$app\" ];then\n    app=\"my_site\"; #\u2190\u5f15\u6570\u7a7a\u306a\u3089my_site\u306b\nfi\nmkdir $app; #\u2190\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210 \ncd $app; #\u2190\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\ngit init; #\u2190git\u521d\u671f\u5316\nheroku create; #\u2190heroku\u30a2\u30d7\u30ea\u4f5c\u6210\necho '{}' > composer.json; #\u2190\u30b3\u30f3\u30dd\u30fc\u30b5\u30fc\u8a2d\u5b9a\u4f5c\u6210\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u6709\u7121\u3067php\u30a2\u30d7\u30ea\u304b\u5224\u65ad\u3055\u308c\u308b\necho '<b>Hellow World!!</b> Yes we can!!' > index.html; #\u2190\u30d8\u30ed\u301c\ngit add .; #\u2190composer.json\u3068index.html\u3092git\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u767b\u9332\ngit commit -a -m first; #\u2190\u30b3\u30df\u30c3\u30c8\ngit push heroku master; #\u2190\u30d7\u30c3\u30b7\u30e5\uff06\u30c7\u30d7\u30ed\u30a4\u30fc\u30f3\nheroku open; #\u2190\u30d6\u30e9\u30a6\u30b6\u30fc\u306b\u300eHellow World!\u300f\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u30cf\u30c3\u30d4\u30fc\n\n\n\n\u3055\u3089\u306b\u3053\u308c\u3060\u3051\u3067\u306f\u4f55\u306a\u306e\u3067\u30a2\u30c9\u30aa\u30f3\u3067redis\u3092\u4f7f\u7528\u3057\u305f\u30a2\u30d7\u30ea\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3082\n\n\u5b9f\u30bd\u30fc\u30b9 https://github.com/nanananamememe/short_url\n\n\u30b5\u30f3\u30d7\u30eb https://infinite-forest-33516.herokuapp.com/\n\n\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067github\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30af\u30ed\u30fc\u30f3\u3057heroku\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u3001redis\u306e\u8ffd\u52a0\u307e\u3067\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\u300cheroku-redis state creating.\u300d\u3068\u8907\u6570\u56de\u51fa\u307e\u3059\u3002\n\u3053\u308c\u306fredis\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u4e2d\u306e\u305f\u3081\u3001\u305d\u306e\u9593\u306f\u30a2\u30d7\u30ea\u304c\u52d5\u304b\u306a\u3044\u306e\u3067\u8d77\u52d5\u307e\u3067\u306e\u5f85\u6a5f\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3059\u3002\n\u300cAllrady heroku-redis state created.\u300d\u3068\u51fa\u308b\u3068\u8d77\u52d5\u5b8c\u4e86\u3002\u30d6\u30e9\u30a6\u30b6\u3067\u77ed\u7e2eURL\u4f5c\u6210\u30b5\u30a4\u30c8\u304c\u958b\u304f\u306f\u305a\u3067\u3059\u3002\uff08\u305f\u3076\u3093\uff09\n\n\u30b3\u30de\u30f3\u30c9\n$ curl -o- https://raw.githubusercontent.com/nanananamememe/open_heroku/master/make_short_url.sh | bash\n\n\n\n\u51fa\u529b\u7d50\u679c\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   519  100   519    0     0   1038      0 --:--:-- --:--:-- --:--:--  1040\nCloning into 'short_url'...\nremote: Counting objects: 12, done.\nremote: Compressing objects: 100% (9/9), done.\nremote: Total 12 (delta 0), reused 12 (delta 0), pack-reused 0\nUnpacking objects: 100% (12/12), done.\nChecking connectivity... done.\nCreating app... done, \u2b22 hoge-piyo-99999\nhttps://hoge-piyo-99999.herokuapp.com/ | https://git.heroku.com/hoge-piyo-99999.git\nCreating heroku-redis:hobby-dev on \u2b22 hoge-piyo-99999... free\nYour add-on is being provisioned and will be available shortly\n! Data stored in hobby plans on Heroku Redis are not persisted.\nredis-hoge-99999 is being created in the background. The app will restart when complete...\nUse heroku addons:info redis-hoge-99999 to check creation progress\nUse heroku addons:docs heroku-redis to view documentation\nCounting objects: 12, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (9/9), done.\nWriting objects: 100% (12/12), 2.63 KiB | 0 bytes/s, done.\nTotal 12 (delta 0), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----> PHP app detected\nremote: -----> Bootstrapping...\nremote: -----> Installing platform packages...\nremote:        NOTICE: No runtime required in composer.json; requirements\nremote:        from dependencies in composer.lock will be used for selection\nremote:        - php (7.1.0)\nremote:        - apache (2.4.20)\nremote:        - nginx (1.8.1)\nremote: -----> Installing dependencies...\nremote:        Composer version 1.2.4 2016-12-06 22:00:51\nremote:        Loading composer repositories with package information\nremote:        Installing dependencies from lock file\nremote:          - Installing predis/predis (v1.0.3)\nremote:            Downloading: 100%\nremote:        \nremote:        Generating optimized autoload files\nremote: -----> Preparing runtime environment...\nremote:        NOTICE: No Procfile, using 'web: vendor/bin/heroku-php-apache2'.\nremote: -----> Checking for additional extensions to install...\nremote: -----> Discovering process types\nremote:        Procfile declares types -> web\nremote: \nremote: -----> Compressing...\nremote:        Done: 14M\nremote: -----> Launching...\nremote:        Released v3\nremote:        https://hoge-piyo-99999.herokuapp.com/ deployed to Heroku\nremote: \nremote: Verifying deploy... done.\nTo https://git.heroku.com/hoge-piyo-99999.git\n * [new branch]      master -> master\nheroku-redis state creating.\nheroku-redis state creating.\nheroku-redis state creating.\nAllrady heroku-redis state created.\n\n\n\n\u77ed\u7e2eURL\u4f5c\u6210PHP\u306e\u8aac\u660e\n\u77ed\u7e2eURL\u3068\u3044\u3046\u3053\u3068\u3067 http://hogehoge.heroku.com/ \u4ee5\u964d\u306f\u691c\u7d22\u30ad\u30fc\u6271\u3044\u3068\u3059\u308b\u306e\u3067\u3001.htaccess\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u3002\n\n.htaccess\n<IfModule mod_rewrite.c>\n    RewriteEngine On\n    RewriteCond %{REQUEST_FILENAME} !-d\n    RewriteCond %{REQUEST_FILENAME} !-f\n    RewriteRule ^ index.php [L]\n</IfModule>\n\n\nredis\u3068\u306e\u63a5\u7d9a\u306bpredis\u3092\u4f7f\u7528\u3002\n\ncomposer.json\n{\n  \"require\": {\n     \"predis/predis\": \"1.0.3\"\n  }\n}\n\n\n\nindex.php\n<?php\nrequire 'vendor/autoload.php';\nPredis\\Autoloader::register();\n$domain = getenv('HTTP_HOST'); //\u30db\u30b9\u30c8\u540d\u53d6\u5f97\n$redisUrl = getenv('REDIS_URL'); //redis\u8a2d\u5b9a\u53d6\u5f97\nif (!$redisUrl) { //redis\u8a2d\u5b9a\u304c\u53d6\u5f97\u3067\u304d\u306a\u3051\u308c\u3070\u30a8\u30b9\u30b1\u30fc\u30d7\n    echo 'heroku-redis\u30a2\u30c9\u30aa\u30f3\u4f5c\u6210\u4e2d\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u4e0b\u3055\u3044...';\n    exit;\n}\n$redis = new Predis\\Client($redisUrl); //preis\u3092\u4ecb\u3057\u3066redis\u306b\u63a5\u7d9a\n$url = empty($_POST['url'])?null:trim($_POST['url']); //\u77ed\u7e2e\u5bfe\u8c61\u306eURL\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070\u5909\u6570\u306b\u683c\u7d0d\n$key = trim(getenv('REQUEST_URI'), '/'); //http://hogehoge.heroku.com/\u4ee5\u964d\u3092\u691c\u7d22\u30ad\u30fc\u3068\u3057\u3066\u53d6\u5f97\nif ($url) { //\u77ed\u7e2e\u5bfe\u8c61\u306eURL\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070\n    if (!preg_match('/^https?:\\/\\//', $url)) {\u3000//URL\u306e\u6700\u521d\u304chttp\u304bhttps\u304b\u3067\u306a\u3051\u308c\u3070\u982d\u306bhttp://\u3092\u8ffd\u52a0\n        $url = 'http://' . $url;\n    }\n    $hash = strtr(trim(base64_encode(crc32(md5($url))), '='), '+/', '-_'); //$url\u3092\u5143\u306b\u691c\u7d22\u30ad\u30fc\u751f\u6210\n    $redis->set($hash, $url); //redis\u30bb\u30c3\u30c8\n    $redis->expire($hash, 43260); //redis\u4fdd\u5b58\u671f\u9650\u306e\u8a2d\u5b9a(\u79d2)\u3068\u308a\u3042\u3048\u305a | 60\u79d2 x 60\u5206\u3000x 24\u6642\u9593 x 30\u65e5\u3000= 43260\n}\nif ($key) { //\u691c\u7d22\u30ad\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\n    $redirect = $redis->get($key); //redis\u304b\u3089url\u3092\u53d6\u5f97\n    if ($redirect) { //url\u304c\u6b63\u5e38\u306b\u53d6\u5f97\u3067\u304d\u308c\u3070\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n        header(\"Location: {$redirect}\");\n    } else {\n        echo '\u3053\u306eURL\u306e\u6709\u52b9\u671f\u9650\u306f\u5207\u308c\u307e\u3057\u305f\u3002';\n        exit;\n    }\n} else {\n    $jump = \"http://{$domain}/{$hash}\"; // \u77ed\u7e2e\u5f8cURL\u3092\u4f5c\u6210\n    require 'form.php'; //form.php\u3092\u8aad\u307f\u8fbc\u307f\n}\n\n\n\n\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\n\nmake_short_url.sh\n#!/bin/sh\napp=$1; #\u5f15\u6570\u3092\u53d6\u5f97\nif [ -z \"$app\" ];then\n    app=\"short_url\"; #\u5f15\u6570\u7a7a\u306a\u3089short_url\u306b\nfi\ngit clone https://github.com/nanananamememe/short_url $app; #github\u3088\u308a\u77ed\u7e2eURL\u4f5c\u6210\u306e\u30bd\u30fc\u30b9\u3092\u30af\u30ed\u30fc\u30f3\ncd $app; #\u30c1\u30a7\u30fc\u30f3\u30b8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nheroku create; #\u30d8\u30ed\u30af\u30a2\u30d7\u30ea\u751f\u6210\nheroku addons:create heroku-redis:hobby-dev; #\u30b5\u30fc\u30d0\u30fc\u3078redis\u30a2\u30c9\u30aa\u30f3\u3092\u8ffd\u52a0\ngit push heroku master; #\u77ed\u7e2eURL\u4f5c\u6210\u306e\u30bd\u30fc\u30b9\u3092\u30d8\u30ed\u30af\u306b\u30d7\u30c3\u30b7\u30e5\nstate=`heroku addons:info heroku-redis|grep State|awk '{print $2}'`; #redis\u30b5\u30fc\u30d0\u30fc\u306e\u72b6\u614b\u3092\u53d6\u5f97\nhold=\"creating\" #\u72b6\u614b\u304c\u4f5c\u6210\u4e2d\u306e\u5834\u5408\u306f\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3001$state\u304c\u4e00\u81f4\u3057\u305f\u5834\u5408\u306f\u5ef6\u3005\u3068while\u304c\u56de\u308a\u307e\u3059\u3002\nwhile [ $state = $hold ]\ndo\n    echo \"heroku-redis state $state.\"; #\u4f5c\u6210\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\n    sleep 10s; #10\u79d2\u5f85\u6a5f\n    state=`heroku addons:info heroku-redis|grep State|awk '{print $2}'`; #redis\u30b5\u30fc\u30d0\u30fc\u306e\u72b6\u614b\u3092\u53d6\u5f97\ndone;\necho \"Allrady heroku-redis state $state.\"; #redis\u30b5\u30fc\u30d0\u30fc\u4f5c\u6210\u5b8c\u4e86\nheroku open; #\u30d6\u30e9\u30a6\u30b6\u3092\u8d77\u52d5\n\n\n\u4ee5\u4e0a\u3002\n\u4e0b\u8a18\u306funix\u30e9\u30a4\u30af\u306a\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304c\u5229\u7528\u3067\u304d\u308b\u524d\u63d0\u3067\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\n# git\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u305f\u308a\u3059\u308b\u306e\u3067\u307e\u305a\u306f\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u3066\u307f\u3066\u306d\u3002\n\n```text:\u30b3\u30de\u30f3\u30c9\n$ git --version\n```\nhttps://git-scm.com/book/ja/v1/%E4%BD%BF%E3%81%84%E5%A7%8B%E3%82%81%E3%82%8B-Git%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB\n\n# heroku\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\nhttps://www.heroku.com/\n\n# heroku\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhttps://devcenter.heroku.com/articles/heroku-command-line\n\n# ssh\u30ad\u30fc\u4f5c\u6210(heroku\u306bpush\u3059\u308b\u3068\u304d\u3044\u308b\u3088)\nhttp://webkaru.net/linux/ssh-keygen-command/\n\n# heroku\u306bssh\u30ad\u30fc\u3092\u767b\u9332\nhttp://blog.infinity-dimensions.com/2012/02/heroku-public-key-add.html\n\n# \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067\u4e0b\u8a18\u3092\u5b9f\u884c\n```text:\u30b3\u30de\u30f3\u30c9\n$ curl -o- https://raw.githubusercontent.com/nanananamememe/open_heroku/master/make.sh | bash\n```\n\n```text:\u51fa\u529b\u7d50\u679c\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   261  100   261    0     0   1003      0 --:--:-- --:--:-- --:--:--  1007\nmkdir: my_site: File exists\nReinitialized existing Git repository in ~/my_site/.git/\nCreating app... done, \u2b22 hoge-piyo-99999\nhttps://hoge-piyo-99999.herokuapp.com/ | https://git.heroku.com/hoge-piyo-99999.git\nOn branch master\nnothing to commit, working directory clean\nCounting objects: 4, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (2/2), done.\nWriting objects: 100% (4/4), 299 bytes | 0 bytes/s, done.\nTotal 4 (delta 0), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----> PHP app detected\nremote: -----> Bootstrapping...\nremote: -----> Installing platform packages...\nremote:        NOTICE: No runtime required in composer.lock; using PHP ^5.5.17\nremote:        - apache (2.4.20)\nremote:        - nginx (1.8.1)\nremote:        - php (5.6.29)\nremote: -----> Installing dependencies...\nremote:        Composer version 1.2.4 2016-12-06 22:00:51\nremote: -----> Preparing runtime environment...\nremote:        NOTICE: No Procfile, using 'web: vendor/bin/heroku-php-apache2'.\nremote: -----> Checking for additional extensions to install...\nremote: -----> Discovering process types\nremote:        Procfile declares types -> web\nremote: \nremote: -----> Compressing...\nremote:        Done: 13.5M\nremote: -----> Launching...\nremote:        Released v3\nremote:        https://hoge-piyo-99999.herokuapp.com/ deployed to Heroku\nremote: \nremote: Verifying deploy.... done.\nTo https://git.heroku.com/hoge-piyo-99999.git\n * [new branch]      master -> master\n```\n\u3053\u308c\u3067\u5e83\u544a\u8868\u793a\u7121\u3057\u306e\u30d5\u30ea\u30fc\u306eweb\u30b5\u30a4\u30c8\u304c\u958b\u8a2d\u3055\u308c\u307e\u3059\u3002\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3092\u5b9f\u884c\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u306e\u76f4\u4e0b\u306bmy_site\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u304c\u51fa\u6765\u307e\u3059\u3002\nheroku\u306e\u30a2\u30d7\u30ea\u306f\u81ea\u52d5\u751f\u6210\u3055\u308c\u3001my_site\u30d5\u30a9\u30eb\u30c0\u306b\u30ea\u30e2\u30fc\u30c8\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u3057\u3066\u8ffd\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# web\u30b5\u30a4\u30c8\u3092\u7de8\u96c6\n```text:\u30b3\u30de\u30f3\u30c9\n$ cd my_site;\n$ echo '<p><a href=\"test.html\">test.html</a></p>' >> index.html;\n$ echo 'This is a pen. This is a apple. huuunmm! Applepen!!' > test.html;\n$ git add .;\n$ git commit -a -m test;\n$ git push heroku master;\n$ heroku open;\n```\n\u3069\u3046\u3067\u3059\u304b\uff1findex.html\u306btest.html\u306e\u30ea\u30f3\u30af\u304c\u8cbc\u3089\u308c\u3066\u3044\u308b\u3067\u3057\u3087\u3046\uff1f\n\u3042\u3068\u306f\u30ac\u30f3\u30ac\u30f3html\u306a\u308ajavascript\u306a\u308acss\u306a\u308a\u66f8\u3044\u3066\u30b3\u30df\u30c3\u30c8\u3057\u3066\u30d7\u30c3\u30b7\u30e5\u3057\u3066web\u30b5\u30a4\u30c8\u3092\u69cb\u7bc9\u3057\u3066\u3044\u304d\u307e\u3057\u3087\u3046\u3002\n\n# \u3053\u308c\u3060\u3051\u3060\u3068\u4f55\u306a\u306e\u3067\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\n```bash:make.sh\n#!/bin/sh\napp=$1; #\u2190\u5f15\u6570\u3092\u53d6\u5f97\nif [ -z \"$app\" ];then\n    app=\"my_site\"; #\u2190\u5f15\u6570\u7a7a\u306a\u3089my_site\u306b\nfi\nmkdir $app; #\u2190\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4f5c\u6210 \ncd $app; #\u2190\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u79fb\u52d5\ngit init; #\u2190git\u521d\u671f\u5316\nheroku create; #\u2190heroku\u30a2\u30d7\u30ea\u4f5c\u6210\necho '{}' > composer.json; #\u2190\u30b3\u30f3\u30dd\u30fc\u30b5\u30fc\u8a2d\u5b9a\u4f5c\u6210\u3001\u3053\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u6709\u7121\u3067php\u30a2\u30d7\u30ea\u304b\u5224\u65ad\u3055\u308c\u308b\necho '<b>Hellow World!!</b> Yes we can!!' > index.html; #\u2190\u30d8\u30ed\u301c\ngit add .; #\u2190composer.json\u3068index.html\u3092git\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u767b\u9332\ngit commit -a -m first; #\u2190\u30b3\u30df\u30c3\u30c8\ngit push heroku master; #\u2190\u30d7\u30c3\u30b7\u30e5\uff06\u30c7\u30d7\u30ed\u30a4\u30fc\u30f3\nheroku open; #\u2190\u30d6\u30e9\u30a6\u30b6\u30fc\u306b\u300eHellow World!\u300f\u3068\u8868\u793a\u3055\u308c\u305f\u3089\u30cf\u30c3\u30d4\u30fc\n```\n\n\n# \u3055\u3089\u306b\u3053\u308c\u3060\u3051\u3067\u306f\u4f55\u306a\u306e\u3067\u30a2\u30c9\u30aa\u30f3\u3067redis\u3092\u4f7f\u7528\u3057\u305f\u30a2\u30d7\u30ea\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u3082\n* \u5b9f\u30bd\u30fc\u30b9 https://github.com/nanananamememe/short_url\n* \u30b5\u30f3\u30d7\u30eb https://infinite-forest-33516.herokuapp.com/\n\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3067github\u304b\u3089\u30bd\u30fc\u30b9\u3092\u30af\u30ed\u30fc\u30f3\u3057heroku\u30a2\u30d7\u30ea\u306e\u4f5c\u6210\u3001redis\u306e\u8ffd\u52a0\u307e\u3067\u3084\u3063\u3066\u304f\u308c\u307e\u3059\u3002\n\u300cheroku-redis state creating.\u300d\u3068\u8907\u6570\u56de\u51fa\u307e\u3059\u3002\n\u3053\u308c\u306fredis\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u4e2d\u306e\u305f\u3081\u3001\u305d\u306e\u9593\u306f\u30a2\u30d7\u30ea\u304c\u52d5\u304b\u306a\u3044\u306e\u3067\u8d77\u52d5\u307e\u3067\u306e\u5f85\u6a5f\u30e1\u30c3\u30bb\u30fc\u30b8\u3067\u3059\u3002\n\u300cAllrady heroku-redis state created.\u300d\u3068\u51fa\u308b\u3068\u8d77\u52d5\u5b8c\u4e86\u3002\u30d6\u30e9\u30a6\u30b6\u3067\u77ed\u7e2eURL\u4f5c\u6210\u30b5\u30a4\u30c8\u304c\u958b\u304f\u306f\u305a\u3067\u3059\u3002\uff08\u305f\u3076\u3093\uff09\n\n```text:\u30b3\u30de\u30f3\u30c9\n$ curl -o- https://raw.githubusercontent.com/nanananamememe/open_heroku/master/make_short_url.sh | bash\n```\n\n```text:\u51fa\u529b\u7d50\u679c\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   519  100   519    0     0   1038      0 --:--:-- --:--:-- --:--:--  1040\nCloning into 'short_url'...\nremote: Counting objects: 12, done.\nremote: Compressing objects: 100% (9/9), done.\nremote: Total 12 (delta 0), reused 12 (delta 0), pack-reused 0\nUnpacking objects: 100% (12/12), done.\nChecking connectivity... done.\nCreating app... done, \u2b22 hoge-piyo-99999\nhttps://hoge-piyo-99999.herokuapp.com/ | https://git.heroku.com/hoge-piyo-99999.git\nCreating heroku-redis:hobby-dev on \u2b22 hoge-piyo-99999... free\nYour add-on is being provisioned and will be available shortly\n! Data stored in hobby plans on Heroku Redis are not persisted.\nredis-hoge-99999 is being created in the background. The app will restart when complete...\nUse heroku addons:info redis-hoge-99999 to check creation progress\nUse heroku addons:docs heroku-redis to view documentation\nCounting objects: 12, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (9/9), done.\nWriting objects: 100% (12/12), 2.63 KiB | 0 bytes/s, done.\nTotal 12 (delta 0), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----> PHP app detected\nremote: -----> Bootstrapping...\nremote: -----> Installing platform packages...\nremote:        NOTICE: No runtime required in composer.json; requirements\nremote:        from dependencies in composer.lock will be used for selection\nremote:        - php (7.1.0)\nremote:        - apache (2.4.20)\nremote:        - nginx (1.8.1)\nremote: -----> Installing dependencies...\nremote:        Composer version 1.2.4 2016-12-06 22:00:51\nremote:        Loading composer repositories with package information\nremote:        Installing dependencies from lock file\nremote:          - Installing predis/predis (v1.0.3)\nremote:            Downloading: 100%\nremote:        \nremote:        Generating optimized autoload files\nremote: -----> Preparing runtime environment...\nremote:        NOTICE: No Procfile, using 'web: vendor/bin/heroku-php-apache2'.\nremote: -----> Checking for additional extensions to install...\nremote: -----> Discovering process types\nremote:        Procfile declares types -> web\nremote: \nremote: -----> Compressing...\nremote:        Done: 14M\nremote: -----> Launching...\nremote:        Released v3\nremote:        https://hoge-piyo-99999.herokuapp.com/ deployed to Heroku\nremote: \nremote: Verifying deploy... done.\nTo https://git.heroku.com/hoge-piyo-99999.git\n * [new branch]      master -> master\nheroku-redis state creating.\nheroku-redis state creating.\nheroku-redis state creating.\nAllrady heroku-redis state created.\n```\n\n# \u77ed\u7e2eURL\u4f5c\u6210PHP\u306e\u8aac\u660e\n\u77ed\u7e2eURL\u3068\u3044\u3046\u3053\u3068\u3067 http://hogehoge.heroku.com/ \u4ee5\u964d\u306f\u691c\u7d22\u30ad\u30fc\u6271\u3044\u3068\u3059\u308b\u306e\u3067\u3001.htaccess\u3067\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u3002\n\n```text:.htaccess\n<IfModule mod_rewrite.c>\n    RewriteEngine On\n    RewriteCond %{REQUEST_FILENAME} !-d\n    RewriteCond %{REQUEST_FILENAME} !-f\n    RewriteRule ^ index.php [L]\n</IfModule>\n```\n\nredis\u3068\u306e\u63a5\u7d9a\u306bpredis\u3092\u4f7f\u7528\u3002\n\n```json:composer.json\n{\n  \"require\": {\n     \"predis/predis\": \"1.0.3\"\n  }\n}\n```\n\n```php:index.php\n<?php\nrequire 'vendor/autoload.php';\nPredis\\Autoloader::register();\n$domain = getenv('HTTP_HOST'); //\u30db\u30b9\u30c8\u540d\u53d6\u5f97\n$redisUrl = getenv('REDIS_URL'); //redis\u8a2d\u5b9a\u53d6\u5f97\nif (!$redisUrl) { //redis\u8a2d\u5b9a\u304c\u53d6\u5f97\u3067\u304d\u306a\u3051\u308c\u3070\u30a8\u30b9\u30b1\u30fc\u30d7\n    echo 'heroku-redis\u30a2\u30c9\u30aa\u30f3\u4f5c\u6210\u4e2d\u3002\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u4e0b\u3055\u3044...';\n    exit;\n}\n$redis = new Predis\\Client($redisUrl); //preis\u3092\u4ecb\u3057\u3066redis\u306b\u63a5\u7d9a\n$url = empty($_POST['url'])?null:trim($_POST['url']); //\u77ed\u7e2e\u5bfe\u8c61\u306eURL\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070\u5909\u6570\u306b\u683c\u7d0d\n$key = trim(getenv('REQUEST_URI'), '/'); //http://hogehoge.heroku.com/\u4ee5\u964d\u3092\u691c\u7d22\u30ad\u30fc\u3068\u3057\u3066\u53d6\u5f97\nif ($url) { //\u77ed\u7e2e\u5bfe\u8c61\u306eURL\u304c\u9001\u4fe1\u3055\u308c\u3066\u3044\u308c\u3070\n    if (!preg_match('/^https?:\\/\\//', $url)) {\u3000//URL\u306e\u6700\u521d\u304chttp\u304bhttps\u304b\u3067\u306a\u3051\u308c\u3070\u982d\u306bhttp://\u3092\u8ffd\u52a0\n        $url = 'http://' . $url;\n    }\n    $hash = strtr(trim(base64_encode(crc32(md5($url))), '='), '+/', '-_'); //$url\u3092\u5143\u306b\u691c\u7d22\u30ad\u30fc\u751f\u6210\n    $redis->set($hash, $url); //redis\u30bb\u30c3\u30c8\n    $redis->expire($hash, 43260); //redis\u4fdd\u5b58\u671f\u9650\u306e\u8a2d\u5b9a(\u79d2)\u3068\u308a\u3042\u3048\u305a | 60\u79d2 x 60\u5206\u3000x 24\u6642\u9593 x 30\u65e5\u3000= 43260\n}\nif ($key) { //\u691c\u7d22\u30ad\u30fc\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308c\u3070\n    $redirect = $redis->get($key); //redis\u304b\u3089url\u3092\u53d6\u5f97\n    if ($redirect) { //url\u304c\u6b63\u5e38\u306b\u53d6\u5f97\u3067\u304d\u308c\u3070\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\n        header(\"Location: {$redirect}\");\n    } else {\n        echo '\u3053\u306eURL\u306e\u6709\u52b9\u671f\u9650\u306f\u5207\u308c\u307e\u3057\u305f\u3002';\n        exit;\n    }\n} else {\n    $jump = \"http://{$domain}/{$hash}\"; // \u77ed\u7e2e\u5f8cURL\u3092\u4f5c\u6210\n    require 'form.php'; //form.php\u3092\u8aad\u307f\u8fbc\u307f\n}\n```\n\n# \u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u8aac\u660e\n```bash:make_short_url.sh\n#!/bin/sh\napp=$1; #\u5f15\u6570\u3092\u53d6\u5f97\nif [ -z \"$app\" ];then\n    app=\"short_url\"; #\u5f15\u6570\u7a7a\u306a\u3089short_url\u306b\nfi\ngit clone https://github.com/nanananamememe/short_url $app; #github\u3088\u308a\u77ed\u7e2eURL\u4f5c\u6210\u306e\u30bd\u30fc\u30b9\u3092\u30af\u30ed\u30fc\u30f3\ncd $app; #\u30c1\u30a7\u30fc\u30f3\u30b8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nheroku create; #\u30d8\u30ed\u30af\u30a2\u30d7\u30ea\u751f\u6210\nheroku addons:create heroku-redis:hobby-dev; #\u30b5\u30fc\u30d0\u30fc\u3078redis\u30a2\u30c9\u30aa\u30f3\u3092\u8ffd\u52a0\ngit push heroku master; #\u77ed\u7e2eURL\u4f5c\u6210\u306e\u30bd\u30fc\u30b9\u3092\u30d8\u30ed\u30af\u306b\u30d7\u30c3\u30b7\u30e5\nstate=`heroku addons:info heroku-redis|grep State|awk '{print $2}'`; #redis\u30b5\u30fc\u30d0\u30fc\u306e\u72b6\u614b\u3092\u53d6\u5f97\nhold=\"creating\" #\u72b6\u614b\u304c\u4f5c\u6210\u4e2d\u306e\u5834\u5408\u306f\u3053\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3001$state\u304c\u4e00\u81f4\u3057\u305f\u5834\u5408\u306f\u5ef6\u3005\u3068while\u304c\u56de\u308a\u307e\u3059\u3002\nwhile [ $state = $hold ]\ndo\n    echo \"heroku-redis state $state.\"; #\u4f5c\u6210\u4e2d\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\n    sleep 10s; #10\u79d2\u5f85\u6a5f\n    state=`heroku addons:info heroku-redis|grep State|awk '{print $2}'`; #redis\u30b5\u30fc\u30d0\u30fc\u306e\u72b6\u614b\u3092\u53d6\u5f97\ndone;\necho \"Allrady heroku-redis state $state.\"; #redis\u30b5\u30fc\u30d0\u30fc\u4f5c\u6210\u5b8c\u4e86\nheroku open; #\u30d6\u30e9\u30a6\u30b6\u3092\u8d77\u52d5\n```\n\n\u4ee5\u4e0a\u3002\n"}