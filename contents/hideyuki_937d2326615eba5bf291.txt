{"tags": ["gRPC", "Python"], "context": " More than 1 year has passed since last update.\n\ngRPC \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nhomebrew \u30d9\u30fc\u30b9\u3067 gRPC \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ngRPC\u3068\u5171\u306b\u3001RPC\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30bc\u30fc\u30b7\u30e7\u30f3\u3092\u62c5\u3046 Protocol Buffers \u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n$ curl -fsSL https://goo.gl/getgrpc | bash -s python\n\n\u3082\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u306f homebrew \u304c\u53e4\u3044\u306e\u3067 brew update \u3092\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\nError: undefined method `desc' for Grpc:Class\nPlease report this bug:\n    http://git.io/brew-troubleshooting\n/usr/local/Library/Taps/grpc/homebrew-grpc/Formula/grpc.rb:2:in `<class:Grpc>'\n\u30fb\u30fb\u30fb\n\n\n.proto(IDL)\u3092\u66f8\u304f\nProtocol Buffers \u306eIDL\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u30b5\u30fc\u30dc\u3092\u52d5\u304b\u3059RPC\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\ngRPC \u81ea\u4f53\u306f Protocol Buffers \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n(gRPC \u4ee5\u5916\u306b\u3082 RPC \u5b9f\u88c5\u306f\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059)\n\ngateway.proto\nsyntax = \"proto3\";\n\npackage gateway;\n\nmessage MoveServoRequest {\n  int32 servo_id = 1;\n  int32 position = 2;\n}\n\nmessage MoveServoResponse {\n  int32 current_position = 1;\n}\n\nservice AVRGateway {\n  rpc MoveServo (MoveServoRequest) returns (MoveServoResponse) {}\n}\n\n\n\nIDL\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066gRPC\u306epython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u751f\u6210\n\u4ee5\u4e0b\u306e protoc \u30b3\u30de\u30f3\u30c9\u3067\u3001gateway_pb2.py \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n$ protoc --python_out=. --grpc_out=. --plugin=protoc-gen-grpc=`which grpc_python_plugin` gateway.proto\n\n\ngRPC\u7528\u306e\u30b5\u30fc\u30d0/\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u751f\u6210\u3055\u308c\u305fPython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308c\u3070\u7c21\u5358\u306b\u30b5\u30fc\u30d0\uff0f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u3051\u307e\u3059\u3002\ngRPC\u306ePython\u30e9\u30a4\u30d6\u30e9\u30ea\u81ea\u4f53\u307e\u3060Alpha\u7248\u306a\u306e\u3067\u3001\u3044\u308d\u3093\u306a\u30e1\u30bd\u30c3\u30c9\u306bearly_adopter_*\u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u3002\n\ngateway_server.py\nimport time\nimport gateway_pb2\n\nclass AVRGateway(gateway_pb2.EarlyAdopterAVRGatewayServicer):\n  def MoveServo(self, request, context):\n    print 'servo_id: %d, position: %d' % (request.servo_id, request.position)\n    return gateway_pb2.MoveServoResponse(current_position=150)\n\ndef serve():\n  server = gateway_pb2.early_adopter_create_AVRGateway_server(AVRGateway(), 9494, None, None)\n  server.start()\n  try:\n    while True:\n      time.sleep(100000)\n  except KeyboardInterrupt:\n    server.stop()\n\nif __name__ == '__main__':\n  serve()\n\n\n\ngateway_client.py\nimport gateway_pb2\n\ndef run():\n  with gateway_pb2.early_adopter_create_AVRGateway_stub('localhost', 9494) as stub:\n    response = stub.MoveServo(gateway_pb2.MoveServoRequest(servo_id=1, position=200), 10) \n    print \"current position: \" + str(response.current_position)\n\nif __name__ == '__main__':\n  run()\n\n\n\n\u5b9f\u884c\n\u307e\u305a\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n$ ls\ngateway.proto      gateway_client.py  gateway_pb2.py      gateway_server.py\n$ python gateway_server.py\n\n\u305d\u3057\u3066\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u3002\n$ python gateway_client.py\ncurrent position: 150\nD0729 10:42:14.835677000 140735135564544 iomgr.c:119] Waiting for 1 iomgr objects to be destroyed and executing final callbacks\n\n\u30b5\u30fc\u30d0\u306e\u307b\u3046\u3067\u306f\n$ python gateway_server.py \nservo_id: 1, position: 200\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u3066\u3044\u308c\u3070OK\u3002\n\n## gRPC \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nhomebrew \u30d9\u30fc\u30b9\u3067 gRPC \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\ngRPC\u3068\u5171\u306b\u3001RPC\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30bc\u30fc\u30b7\u30e7\u30f3\u3092\u62c5\u3046 Protocol Buffers \u3082\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u308b\u3088\u3046\u3067\u3059\u3002\n\n```bash\n$ curl -fsSL https://goo.gl/getgrpc | bash -s python\n```\n\n\u3082\u3057\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u4e2d\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u305f\u5834\u5408\u306f homebrew \u304c\u53e4\u3044\u306e\u3067 `brew update` \u3092\u8a66\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n```\nError: undefined method `desc' for Grpc:Class\nPlease report this bug:\n    http://git.io/brew-troubleshooting\n/usr/local/Library/Taps/grpc/homebrew-grpc/Formula/grpc.rb:2:in `<class:Grpc>'\n\u30fb\u30fb\u30fb\n```\n\n## .proto(IDL)\u3092\u66f8\u304f\n\nProtocol Buffers \u306eIDL\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4ee5\u4e0b\u306e\u4f8b\u3067\u306f\u30b5\u30fc\u30dc\u3092\u52d5\u304b\u3059RPC\u3092\u5b9a\u7fa9\u3057\u3066\u3044\u307e\u3059\u3002\n\ngRPC \u81ea\u4f53\u306f Protocol Buffers \u306e\u30d7\u30e9\u30b0\u30a4\u30f3\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n(gRPC \u4ee5\u5916\u306b\u3082 [RPC \u5b9f\u88c5\u306f\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059](https://github.com/google/protobuf/wiki/Third-Party-Add-ons#rpc-implementations))\n\n```gateway.proto\nsyntax = \"proto3\";\n\npackage gateway;\n\nmessage MoveServoRequest {\n  int32 servo_id = 1;\n  int32 position = 2;\n}\n\nmessage MoveServoResponse {\n  int32 current_position = 1;\n}\n\nservice AVRGateway {\n  rpc MoveServo (MoveServoRequest) returns (MoveServoResponse) {}\n}\n```\n\n## IDL\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066gRPC\u306epython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u751f\u6210\n\n\u4ee5\u4e0b\u306e `protoc` \u30b3\u30de\u30f3\u30c9\u3067\u3001`gateway_pb2.py` \u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\n\n```bash\n$ protoc --python_out=. --grpc_out=. --plugin=protoc-gen-grpc=`which grpc_python_plugin` gateway.proto\n```\n\n## gRPC\u7528\u306e\u30b5\u30fc\u30d0/\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f\n\u4e0a\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\u751f\u6210\u3055\u308c\u305fPython\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308c\u3070\u7c21\u5358\u306b\u30b5\u30fc\u30d0\uff0f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u66f8\u3051\u307e\u3059\u3002\ngRPC\u306ePython\u30e9\u30a4\u30d6\u30e9\u30ea\u81ea\u4f53[\u307e\u3060Alpha\u7248](https://github.com/grpc/grpc/tree/master/src/python)\u306a\u306e\u3067\u3001\u3044\u308d\u3093\u306a\u30e1\u30bd\u30c3\u30c9\u306bearly_adopter_*\u3068\u3044\u3046\u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u304c\u3064\u3044\u3066\u3044\u307e\u3059\u3002\n\n```gateway_server.py\nimport time\nimport gateway_pb2\n\nclass AVRGateway(gateway_pb2.EarlyAdopterAVRGatewayServicer):\n  def MoveServo(self, request, context):\n    print 'servo_id: %d, position: %d' % (request.servo_id, request.position)\n    return gateway_pb2.MoveServoResponse(current_position=150)\n\ndef serve():\n  server = gateway_pb2.early_adopter_create_AVRGateway_server(AVRGateway(), 9494, None, None)\n  server.start()\n  try:\n    while True:\n      time.sleep(100000)\n  except KeyboardInterrupt:\n    server.stop()\n\nif __name__ == '__main__':\n  serve()\n```\n\n```gateway_client.py\nimport gateway_pb2\n\ndef run():\n  with gateway_pb2.early_adopter_create_AVRGateway_stub('localhost', 9494) as stub:\n    response = stub.MoveServo(gateway_pb2.MoveServoRequest(servo_id=1, position=200), 10) \n    print \"current position: \" + str(response.current_position)\n\nif __name__ == '__main__':\n  run()\n```\n\n## \u5b9f\u884c\n\n\u307e\u305a\u30b5\u30fc\u30d0\u3092\u7acb\u3061\u4e0a\u3052\u307e\u3059\u3002\n\n```bash\n$ ls\ngateway.proto      gateway_client.py  gateway_pb2.py      gateway_server.py\n$ python gateway_server.py\n```\n\n\u305d\u3057\u3066\u5225\u306e\u30bf\u30fc\u30df\u30ca\u30eb\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u3002\n\n```bash\n$ python gateway_client.py\ncurrent position: 150\nD0729 10:42:14.835677000 140735135564544 iomgr.c:119] Waiting for 1 iomgr objects to be destroyed and executing final callbacks\n```\n\n\u30b5\u30fc\u30d0\u306e\u307b\u3046\u3067\u306f\n\n```bash\n$ python gateway_server.py \nservo_id: 1, position: 200\n```\n\n\u3068\u3044\u3046\u611f\u3058\u3067\u51fa\u529b\u3055\u308c\u3066\u3044\u308c\u3070OK\u3002\n"}