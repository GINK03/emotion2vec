{"context": " More than 1 year has passed since last update.\n\u540c\u69d8\u306e\u4e8b\u8c61\u306b\u30cf\u30de\u3063\u305f\u5148\u4eba\u306e\u6559\u3048\u304c\u5168\u304f\u305d\u306e\u307e\u307e\u3067\u3042\u3063\u305f\u30fb\u30fb\u30fb\u3002\n\u3000\u2192\u3000http://mokky14.hatenablog.com/entry/2014/08/01/044235\n\n\u25a0\u539f\u56e0\n\u69cb\u7bc9\u6642\u306b\u52d5\u4f5c\u78ba\u8a8d\u3068\u3057\u3066\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3057\u3066\u3044\u305f\u305f\u3081\u3002\ncrm resource move VIP \u30db\u30b9\u30c8\u540d force\u3000\u2192VIP\u5f37\u5236\u79fb\u52d5\ncrm resource move VIP \u30db\u30b9\u30c8\u540d force\u3000\u2192VIP\u5f37\u5236\u79fb\u52d5\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\nWARNING: Creating rsc_location constraint 'cli-standby-vip' with a score of -INFINITY for resource vip on host1\n        This will prevent vip from running on host1 until the constraint is removed using the 'crm_resource -U' command or manually with cibadmin\n        This will be the case even if 0270-host1 is the last node in the cluster\n        This message can be disabled with -Q\n\n\u3068\u51fa\u308b\u3002\n\u305d\u3057\u3066\u4ee5\u4e0b\u306e location \u5b9a\u7fa9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\ncrm configure show\n\uff1a\nlocation cli-prefer-VIP VIP \\\n        rule $id=\"cli-prefer-rule-VIP\" inf: #uname eq tomi-test-001\nlocation cli-standby-VIP VIP \\\n        rule $id=\"cli-standby-rule-VIP\" -inf: #uname eq tomi-test-001\n\uff1a\n\n\u3053\u306elocation\u306e\u5b9a\u7fa9\u304c\u3042\u308b\u3068\ntomi-test-rediss001\u306b\u306f\u7d76\u5bfe\u306bVIP\u306f\u5207\u308a\u66ff\u308f\u3089\u306a\u3044(-inf)\u3053\u3068\u304c\u5206\u304b\u3063\u305f\u3002\n\n\u25a0\u4fee\u5fa9\u65b9\u6cd5\nlocation \u5b9a\u7fa9\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30de\u30b9\u30bf or \u30b9\u30ec\u30fc\u30d6\u3069\u3061\u3089\u304b\u3067\u767a\u884c\u3057\u3066\u6d88\u3059\u3002\ncrm resource unmigrate VIP\n\n\n\u25a0\u4eca\u5f8c\u306e\u518d\u767a\u9632\u6b62\u7b56\n\u307e\u305a\u4eca\u5f8c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4f7f\u308f\u306a\u3044\u3053\u3068\u306b\u3059\u308b\u3002\ncrm resource move VIP <host\u540d> force\n\n\u305d\u306e\u4ee3\u308f\u308a\u306b\u69cb\u7bc9\u6642\u306bVIP\u304c\u5207\u308a\u66ff\u308f\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\n/etc/init.d/heartbeat stop\n\u3082\u3057\u304f\u306f\nOS\u518d\u8d77\u52d5\n\n\u3092\u5b9f\u65bd\u3057\u305f\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3060\u3002\n\u203b\u30b3\u30de\u30f3\u30c9\u3067node\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u306e\u3067\u53c2\u8003\u307e\u3067\u3002(\u73fe\u5b9f\u7684\u306a\u969c\u5bb3\u60f3\u5b9a\u3067\u306f\u306a\u3044)\n1)\u30de\u30b9\u30bf\u843d\u3061\u305f\u60f3\u5b9a(standby\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\ncrm node standby <\u30de\u30b9\u30bf\u30db\u30b9\u30c8\u540d>\n\n\u3000\u3000\u2192VIP\u304c\u30b9\u30ec\u30fc\u30d6\u306b\u5207\u308a\u66ff\u308f\u308b\n\u3000\u3000\n2)\u30de\u30b9\u30bf\u5fa9\u6d3b\u60f3\u5b9a(online\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\ncrm node online <\u30de\u30b9\u30bf\u30db\u30b9\u30c8\u540d>\n\n\u3000\u3000\u2192VIP\u306f\u30b9\u30ec\u30fc\u30d6\u306e\u307e\u307e\n3)\u30b9\u30ec\u30fc\u30d6\u843d\u3061\u305f\u60f3\u5b9a(standby\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\ncrm node standby <\u30b9\u30ec\u30fc\u30d6\u30db\u30b9\u30c8\u540d>\n\n\u3000\u3000\u2192VIP\u304c\u30de\u30b9\u30bf\u306b\u5207\u308a\u66ff\u308f\u308b\n4)\u30b9\u30ec\u30fc\u30d6\u5fa9\u6d3b\u60f3\u5b9a(online\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\ncrm node online <\u30b9\u30ec\u30fc\u30d6\u30db\u30b9\u30c8\u540d>\n\n\u3000\u2192VIP\u306f\u30de\u30b9\u30bf\u306e\u307e\u307e\n\n\u672c\u5f53\u306b\u5192\u982d\u306e\u5148\u4eba\u306e\u65b9\u306e\u8a18\u4e8b\u306f\u52a9\u304b\u308a\u307e\u3057\u305f\u3002\u611f\u8b1d\u3002\n---\n\n\u540c\u69d8\u306e\u4e8b\u8c61\u306b\u30cf\u30de\u3063\u305f\u5148\u4eba\u306e\u6559\u3048\u304c\u5168\u304f\u305d\u306e\u307e\u307e\u3067\u3042\u3063\u305f\u30fb\u30fb\u30fb\u3002\n\n\u3000\u2192\u3000http://mokky14.hatenablog.com/entry/2014/08/01/044235\n\n---\n\u25a0\u539f\u56e0\n\n\u69cb\u7bc9\u6642\u306b\u52d5\u4f5c\u78ba\u8a8d\u3068\u3057\u3066\u4ee5\u4e0b\u3092\u5b9f\u65bd\u3057\u3066\u3044\u305f\u305f\u3081\u3002\n\n    crm resource move VIP \u30db\u30b9\u30c8\u540d force\u3000\u2192VIP\u5f37\u5236\u79fb\u52d5\n    crm resource move VIP \u30db\u30b9\u30c8\u540d force\u3000\u2192VIP\u5f37\u5236\u79fb\u52d5\n\n\u3053\u308c\u3092\u5b9f\u884c\u3059\u308b\u3068\n\n    WARNING: Creating rsc_location constraint 'cli-standby-vip' with a score of -INFINITY for resource vip on host1\n            This will prevent vip from running on host1 until the constraint is removed using the 'crm_resource -U' command or manually with cibadmin\n            This will be the case even if 0270-host1 is the last node in the cluster\n            This message can be disabled with -Q\n\n\u3068\u51fa\u308b\u3002\n\u305d\u3057\u3066\u4ee5\u4e0b\u306e location \u5b9a\u7fa9\u304c\u8ffd\u52a0\u3055\u308c\u308b\u3002\n\n    crm configure show\n    \uff1a\n    location cli-prefer-VIP VIP \\\n            rule $id=\"cli-prefer-rule-VIP\" inf: #uname eq tomi-test-001\n    location cli-standby-VIP VIP \\\n            rule $id=\"cli-standby-rule-VIP\" -inf: #uname eq tomi-test-001\n    \uff1a\n\n\u3053\u306elocation\u306e\u5b9a\u7fa9\u304c\u3042\u308b\u3068\ntomi-test-rediss001\u306b\u306f\u7d76\u5bfe\u306bVIP\u306f\u5207\u308a\u66ff\u308f\u3089\u306a\u3044(-inf)\u3053\u3068\u304c\u5206\u304b\u3063\u305f\u3002\n\n---\n\u25a0\u4fee\u5fa9\u65b9\u6cd5\n\nlocation \u5b9a\u7fa9\u3092\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30de\u30b9\u30bf or \u30b9\u30ec\u30fc\u30d6\u3069\u3061\u3089\u304b\u3067\u767a\u884c\u3057\u3066\u6d88\u3059\u3002\n\n    crm resource unmigrate VIP\n\n---\n\u25a0\u4eca\u5f8c\u306e\u518d\u767a\u9632\u6b62\u7b56\n\n\u307e\u305a\u4eca\u5f8c\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u4f7f\u308f\u306a\u3044\u3053\u3068\u306b\u3059\u308b\u3002\n\n    crm resource move VIP <host\u540d> force\n\n\u305d\u306e\u4ee3\u308f\u308a\u306b\u69cb\u7bc9\u6642\u306bVIP\u304c\u5207\u308a\u66ff\u308f\u308b\u304b\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\n\n    /etc/init.d/heartbeat stop\n    \u3082\u3057\u304f\u306f\n    OS\u518d\u8d77\u52d5\n\n\u3092\u5b9f\u65bd\u3057\u305f\u307b\u3046\u304c\u826f\u3055\u305d\u3046\u3060\u3002\n\n\u203b\u30b3\u30de\u30f3\u30c9\u3067node\u3092\u64cd\u4f5c\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u306e\u3067\u53c2\u8003\u307e\u3067\u3002(\u73fe\u5b9f\u7684\u306a\u969c\u5bb3\u60f3\u5b9a\u3067\u306f\u306a\u3044)\n1)\u30de\u30b9\u30bf\u843d\u3061\u305f\u60f3\u5b9a(standby\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\n\n    crm node standby <\u30de\u30b9\u30bf\u30db\u30b9\u30c8\u540d>\n\u3000\u3000\u2192VIP\u304c\u30b9\u30ec\u30fc\u30d6\u306b\u5207\u308a\u66ff\u308f\u308b\n\u3000\u3000\n2)\u30de\u30b9\u30bf\u5fa9\u6d3b\u60f3\u5b9a(online\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\n\n    crm node online <\u30de\u30b9\u30bf\u30db\u30b9\u30c8\u540d>\n\u3000\u3000\u2192VIP\u306f\u30b9\u30ec\u30fc\u30d6\u306e\u307e\u307e\n\n3)\u30b9\u30ec\u30fc\u30d6\u843d\u3061\u305f\u60f3\u5b9a(standby\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\n\n    crm node standby <\u30b9\u30ec\u30fc\u30d6\u30db\u30b9\u30c8\u540d>\n\u3000\u3000\u2192VIP\u304c\u30de\u30b9\u30bf\u306b\u5207\u308a\u66ff\u308f\u308b\n\n4)\u30b9\u30ec\u30fc\u30d6\u5fa9\u6d3b\u60f3\u5b9a(online\u30b9\u30c6\u30fc\u30bf\u30b9\u306b\u3059\u308b)\n\n    crm node online <\u30b9\u30ec\u30fc\u30d6\u30db\u30b9\u30c8\u540d>\n\u3000\u2192VIP\u306f\u30de\u30b9\u30bf\u306e\u307e\u307e\n\n---\n\n\u672c\u5f53\u306b\u5192\u982d\u306e\u5148\u4eba\u306e\u65b9\u306e\u8a18\u4e8b\u306f\u52a9\u304b\u308a\u307e\u3057\u305f\u3002\u611f\u8b1d\u3002\n", "tags": ["heartbeat", "pacemaker"]}