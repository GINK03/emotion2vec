{"context": "\n\n1 \u69cb\u6210\nnode1\u3067httpd\u3092\u8d77\u52d5\u3059\u308b\u3002\nmaster\u3067curl\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n   master  ------------------ > node1\n\u3000curl http://node1             httpd(port=80)\n\n\n\n2 \u74b0\u5883\nmaster,node1\u3068\u3082\u306bOS\u306fCentOS7.2\u3092\u4f7f\u7528\u3059\u308b\u3002\n[root@master ~]# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n\n\n3 TCP\u30d1\u30b1\u30c3\u30c8\u306e\u63a1\u53d6\u65b9\u6cd5\n\n3.1 SYN\u30d5\u30e9\u30b0\u304c\u305f\u3063\u305f(=1)\u30d1\u30b1\u30c3\u30c8\n\n---------\n0. \u76ee\u6a19 \n---------\nmaster\u304b\u3089node1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3057\u3066\u3001\u26051\u3068\u26052\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\u3002\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\u26051\n     |<------------ SYN +ACK ----------|\u26052\n     |------------- ACK -------------->|\n     |                                 |\n\n--------------------\n1. node1\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnc\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum install nmap-ncat\n\n80\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u6a5f\u3059\u308bnc\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# nc -l 80 &\n[1] 4093\n\nnc\u30d7\u30ed\u30bb\u30b9\u304c\u5f85\u3061\u53d7\u3051\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# lsof -i:80\nCOMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnc      4093 root    3u  IPv6  44382      0t0  TCP *:http (LISTEN)\nnc      4093 root    4u  IPv4  44383      0t0  TCP *:http (LISTEN)\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0\n\n\n--------------------\n2. master\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnc\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum install nmap-ncat\n\nnode1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n[root@master sar]# nc node1 80 -vv\nNcat: Version 6.40 ( http://nmap.org/ncat )\nlibnsock nsi_new2(): nsi_new (IOD #1)\nlibnsock nsock_connect_tcp(): TCP connection requested to 192.168.0.20:80 (IOD #1) EID 8\nlibnsock nsock_trace_handler_callback(): Callback: CONNECT SUCCESS for EID 8 [192.168.0.20:80]\nNcat: Connected to 192.168.0.20:80.\nlibnsock nsi_new2(): nsi_new (IOD #2)\nlibnsock nsock_read(): Read request from IOD #1 [192.168.0.20:80] (timeout: -1ms) EID 18\nlibnsock nsock_readbytes(): Read request for 0 bytes from IOD #2 [peer unspecified] EID 26\ntest    => \"test\"\u3068\u5165\u529b\u3057\u305f\u3002\n\n\n--------------------\n3. node1\u5074\u306e\u78ba\u8a8d\u7d50\u679c\n--------------------\nSYN\u30d5\u30e9\u30b0\u306e\u305f\u3063\u305f\u30d1\u30b1\u30c3\u30c8(\u2605\u5370)\u63a1\u53d6\u3092\u304a\u3053\u306a\u3046\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n11:53:15.864640 IP master.48604 > node1.http: Flags \u2605[S], seq 1922717478, win 29200, options [mss 1460,sackOK,TS val 10235908 ecr 0,nop,wscale 7], length 0\n11:53:15.864796 IP node1.http > master.48604: Flags \u2605[S.], seq 1379729022, \u2605ack 1922717479, win 28960, options [mss 1460,sackOK,TS val 3079043 ecr 10235908,nop,wscale 7], length 0\ntest   =>master\u3067\u5165\u529b\u3057\u305f\"test\"\u304cnode1\u5074\u3067\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\n\n\n3.2 SYN\u30d1\u30b1\u30c3\u30c8(SYN\u30d5\u30e9\u30b0\u306e\u307f\u7acb\u3063\u305f\u30d1\u30b1\u30c3\u30c8)\n\u26051\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\u26051\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |                                 |\n\n\n--------------------\n1. node1\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\n80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306eTCP\u30d1\u30b1\u30c3\u30c8\u306f\u5ec3\u68c4\u3059\u308b\u3002\n[root@node1 ~]# iptables -A INPUT -p tcp --dport 80 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 58 packets, 18279 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80\n\n80\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u6a5f\u3059\u308bnc\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# nc -l 80 &\n[1] 2518\n\nnc\u30d7\u30ed\u30bb\u30b9\u304c\u5f85\u3061\u53d7\u3051\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# lsof -i:80\nCOMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnc      2518 root    3u  IPv6  30891      0t0  TCP *:http (LISTEN)\nnc      2518 root    4u  IPv4  30892      0t0  TCP *:http (LISTEN)\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002SYN\u30d1\u30b1\u30c3\u30c8\u306e\u307f\u63a1\u53d6\u3059\u308b\u8a2d\u5b9a\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0 and '(tcp[tcpflags] & tcp-ack) ==0'\n\n--------------------\n2. master\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnode1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n[root@master sar]# nc node1 80 -vv\nNcat: Version 6.40 ( http://nmap.org/ncat )\nlibnsock nsi_new2(): nsi_new (IOD #1)\nlibnsock nsock_connect_tcp(): TCP connection requested to 192.168.0.20:80 (IOD #1) EID 8\nlibnsock nsock_trace_handler_callback(): Callback: CONNECT TIMEOUT for EID 8 [192.168.0.20:80]\nNcat: Connection timed out.  => SYN\u518d\u9001\u56de\u6570\u306e\u6700\u5927\u5024\u306b\u5230\u9054\u524d\u306b\u3001\u5148\u306bnc\u30b3\u30de\u30f3\u30c9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u3066\u7d42\u4e86\u3057\u305f\u6a21\u69d8\u3002\n\n--------------------\n3. node1\u5074\u306e\u78ba\u8a8d\u7d50\u679c\n--------------------\ntcpdump\u306e\u5b9f\u884c\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3002SYN\u30d1\u30b1\u30c3\u30c8(\u2605\u5370)\u306e\u307f\u63a1\u53d6\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0 and '(tcp[tcpflags] & tcp-ack) ==0'\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n11:20:35.970211 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8276013 ecr 0,nop,wscale 7], length 0\n11:20:36.971734 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8277017 ecr 0,nop,wscale 7], length 0\n11:20:39.252406 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8279024 ecr 0,nop,wscale 7], length 0\n11:20:42.986909 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8283032 ecr 0,nop,wscale 7], length 0\n- nc\u30b3\u30de\u30f3\u30c9\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306b\u3088\u308a\u3001\u3053\u3053\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86 -\n\n\n-----------------------------\n4. \u3042\u3068\u59cb\u672b(iptables\u5b9a\u7fa9\u524a\u9664)\n-----------------------------\n[root@node1 ~]# iptables -L INPUT --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n1    DROP       tcp  --  anywhere             anywhere             tcp dpt:http\n[root@node1 ~]# iptables -D INPUT 1\n[root@node1 ~]# iptables -L INPUT --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n[root@node1 ~]#\n\n\n\n3.3 FIN\u30d1\u30b1\u30c3\u30c8\n\u26051\u3068\u26052\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\n     |<------------ SYN + ACK ---------|\n     |------------- ACK -------------->|\n     |                                 |\n     |                                 |\n     |------------- FIN -------------->|\u26051\n     |<------------ FIN + ACK ---------|\u26052\n     |------------- ACK -------------->|\n     |                                 |\n     |                                 |\n\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-fin)' != 0\n-\u4e2d\u7565-\n20:46:33.720744 IP master.35582 > node1.http: Flags [F.], seq 635647794, ack 894972442, win 319, options [nop,nop,TS val 4009862 ecr 3088873], length 0\n20:46:33.721687 IP node1.http > master.35582: Flags [F.], seq 1, ack 1, win 227, options [nop,nop,TS val 3088875 ecr 4009862], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n4 MAC\u30a2\u30c9\u30ec\u30b9\u3092\u8868\u793a\u3059\u308b(-e)\n[root@node1 ~]# tcpdump -e -i eth0 port 80\n21:04:41.208201 00:0c:29:18:5c:90 (oui Unknown) > 00:0c:29:a5:64:c8 (oui Unknown), ethertype IPv4 (0x0800), length 74: master.35770 > node1.http: Flags [S], seq 844789185, win 29200, options [mss 1460,sackOK,TS val 5097353 ecr 0,nop,wscale 7], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n\n5 \u63a1\u53d6\u3057\u305ftcpdump\u3092\u8868\u793a(-r)\u3059\u308b\n\u30c6\u30b9\u30c8\u7528\u306etcpdump\u3092\u63a1\u53d6(-w)\u3059\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 port 80 -w http.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u63a1\u53d6\u3057\u305ftcpdump\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# ls -l http.cap\n-rw-r--r-- 1 tcpdump tcpdump 38313  2\u6708 11 21:48 http.cap\n[root@node1 ~]#\n\n\u63a1\u53d6\u3057\u305ftcpdump\u3092\u8868\u793a(-r)\u3059\u308b\u3002\n[root@node1 ~]# tcpdump -r http.cap\n-\u4e2d\u7565-\n21:47:39.816741 IP master.36345 > node1.http: Flags [S], seq 1437916452, win 29200, options [mss 1460,sackOK,TS val 7676049 ecr 0,nop,wscale 7], length 0\n21:47:39.816879 IP node1.http > master.36345: Flags [S.], seq 296354756, ack 1437916453, win 28960, options [mss 1460,sackOK,TS val 6754970 ecr 7676049,nop,wscale 7], length 0\n21:47:39.818131 IP master.36345 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 7676050 ecr 6754970], length 0\n21:47:39.818180 IP master.36345 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 7676051 ecr 6754970], length 69\n21:47:39.818234 IP node1.http > master.36345: Flags [.], ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 0\n21:47:39.818968 IP node1.http > master.36345: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 4344\n21:47:39.819210 IP node1.http > master.36345: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 6754973 ecr 7676051], length 805\n21:47:39.820037 IP master.36345 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 7676052 ecr 6754972], length 0\n21:47:39.820077 IP master.36345 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822032 IP master.36345 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822277 IP node1.http > master.36345: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 6754976 ecr 7676053], length 0\n21:47:39.826081 IP master.36345 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 7676055 ecr 6754976], length 0\n21:47:43.474723 IP master.36346 > node1.http: Flags [S], seq 3975369367, win 29200, options [mss 1460,sackOK,TS val 7679705 ecr 0,nop,wscale 7], length 0\n21:47:43.474894 IP node1.http > master.36346: Flags [S.], seq 3828837720, ack 3975369368, win 28960, options [mss 1460,sackOK,TS val 6758628 ecr 7679705,nop,wscale 7], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n----------------------------\n2. sed\u3092\u4f7f\u3063\u3066\u6642\u523b\u3092\u7d5e\u308a\u8fbc\u3080\n----------------------------\n[root@node1 ~]# tcpdump -r http.cap |sed -n '/21:47:39\\.816741/,/21:47:39\\.826081/p'\n-\u4e2d\u7565-\n21:47:39.816741 IP master.36345 > node1.http: Flags [S], seq 1437916452, win 29200, options [mss 1460,sackOK,TS val 7676049 ecr 0,nop,wscale 7], length 0\n21:47:39.816879 IP node1.http > master.36345: Flags [S.], seq 296354756, ack 1437916453, win 28960, options [mss 1460,sackOK,TS val 6754970 ecr 7676049,nop,wscale 7], length 0\n21:47:39.818131 IP master.36345 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 7676050 ecr 6754970], length 0\n21:47:39.818180 IP master.36345 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 7676051 ecr 6754970], length 69\n21:47:39.818234 IP node1.http > master.36345: Flags [.], ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 0\n21:47:39.818968 IP node1.http > master.36345: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 4344\n21:47:39.819210 IP node1.http > master.36345: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 6754973 ecr 7676051], length 805\n21:47:39.820037 IP master.36345 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 7676052 ecr 6754972], length 0\n21:47:39.820077 IP master.36345 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822032 IP master.36345 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822277 IP node1.http > master.36345: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 6754976 ecr 7676053], length 0\n21:47:39.826081 IP master.36345 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 7676055 ecr 6754976], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n\n6 \u7c21\u6f54\u306a\u51fa\u529b\u3092\u3059\u308b(-q)\n[root@node1 ~]# tcpdump -i eth0 port 80 -q\n-\u4e2d\u7565-\n22:08:54.904012 IP master.36554 > node1.http: tcp 0\n22:08:54.904207 IP node1.http > master.36554: tcp 0\n22:08:54.904678 IP master.36554 > node1.http: tcp 0\n22:08:54.905582 IP master.36554 > node1.http: tcp 69\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n7 tcpdump\u3067\u4f7f\u7528\u3067\u304d\u308b\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b(-D)\n\u4e0b\u8a18\u306ecbr0\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001Docker\u306e\u30ab\u30b9\u30bf\u30e0\u30d6\u30ea\u30c3\u30b8\u3067\u3059\u3002\n[root@node1 ~]# tcpdump -D\n1.eth0\n2.cbr0\n3.nflog (Linux netfilter log (NFLOG) interface)\n4.nfqueue (Linux netfilter queue (NFQUEUE) interface)\n5.usbmon1 (USB bus number 1)\n6.usbmon2 (USB bus number 2)\n7.any (Pseudo-device that captures on all interfaces)\n8.lo\n[root@node1 ~]#\n\n\n\n8 \u6642\u9593\u3067\u5207\u308a\u66ff\u3048\u308b(-G,-z)\n\n8.1 -G\u3060\u3051\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408(\u5207\u308a\u66ff\u3048\u306f\u53ef\u80fd\u3060\u3051\u3069\u3001\u7121\u9650\u306b\u5897\u3048\u3066\u3044\u304f\uff09\ntcpdump\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# id\nuid=0(root) gid=0(root) groups=0(root)\n\nroot\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f5c\u6210\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3001\u30b0\u30eb\u30fc\u30d7\u306froot\u3068\u306a\u308b\u3002\n[root@node1 ~]# mkdir tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 root root 6  2\u6708 11 23:29 tcpdump\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u3092tcpdump\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u306a\u3044\u3068\u3001\u63a1\u53d6\u3067\u304d\u306a\u3044\u3002\n\u7406\u7531\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u304croot\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3002\n\u4ed6\u306e\u3084\u308a\u65b9\u3068\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092root\u306b\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u304c\u3042\u308b(10\u53c2\u7167\uff09\u3002\n[root@node1 ~]# chown tcpdump:tcpdump tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 tcpdump tcpdump 6  2\u6708 11 22:41 tcpdump\n\n[root@node1 ~]# cd tcpdump/\n\n10\u79d2\u6bce\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b(-G)\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -G 10 -w tcpdump_%Y%m%d_%H%M%S.cap\n\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u300210\u79d2\u5358\u4f4d\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 tcpdump]# ls -l --full-time\n\u5408\u8a08 104\n-rw-r--r-- 1 tcpdump tcpdump 18004 2017-02-11 22:45:11.073577507 +0900 tcpdump_20170211_224501.cap\n-rw-r--r-- 1 tcpdump tcpdump 21492 2017-02-11 22:45:21.111767063 +0900 tcpdump_20170211_224511.cap\n-rw-r--r-- 1 tcpdump tcpdump 24196 2017-02-11 22:45:31.145956545 +0900 tcpdump_20170211_224521.cap\n-rw-r--r-- 1 tcpdump tcpdump 20946 2017-02-11 22:45:41.166145762 +0900 tcpdump_20170211_224531.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n8.2 -G + -z (\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\uff09\n8.1\u306e\u65b9\u6cd5\u3060\u3068\u3001\u7121\u9650\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf\u3092\u4e00\u5b9a\u91cf\u306b\u6291\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3002\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u4ee5\u4e0a\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\u3064\u307e\u308a\u4fdd\u6301\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f3\u500b\u3002\n[root@node1 tcpdump]# cat limit.sh\n#!/usr/bin/bash\nfile_num=$(ls tcpdump_*|wc -l)\n\nif [ $file_num -gt 3 ]; then\n  file_name=$(ls -tr tcpdump_*|head -n 1)\n  rm -f $file_name\nfi\n\n\u30b7\u30a7\u30eb\u306e\u6240\u6709\u6a29\u3001\u30b0\u30eb\u30fc\u30d7\u306ftcpdump\u306b\u3057\u3066\u304a\u304f\u3002\n[root@node1 tcpdump]# ls -l limit.sh\n-rwxr--r-- 1 tcpdump tcpdump 35  2\u6708 12 09:41 limit.sh\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u300210\u79d2\u6bce\u306b\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -G 10 -w tcpdump_%Y%m%d_%H%M%S.cap -z ./limit.sh\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n9 \u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3067\u5207\u308a\u66ff\u3048\u308b(-C,-z)\n\n9.1 -C\u3060\u3051\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408(\u5207\u308a\u66ff\u3048\u306f\u53ef\u80fd\u3060\u3051\u3069\u3001\u7121\u9650\u306b\u5897\u3048\u3066\u3044\u304f\uff09\ntcpdump\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# mkdir tcpdump\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u3092tcpdump\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u306a\u3044\u3068\u3001\u63a1\u53d6\u3067\u304d\u306a\u3044\u3002\n\u7406\u7531\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u304croot\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3002\n\u4ed6\u306e\u3084\u308a\u65b9\u3068\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092root\u306b\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u304c\u3042\u308b(10\u53c2\u7167\uff09\u3002\n[root@node1 ~]# chown tcpdump:tcpdump tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 tcpdump tcpdump 6  2\u6708 11 22:41 tcpdump\n\n[root@node1 ~]# cd tcpdump/\n\n1M\u5358\u4f4d\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b(-C)\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -C 1 -w tcpdump.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u30021M\u30b5\u30a4\u30ba\u3067\u30d5\u30a1\u30a4\u30eb\u304c\u5207\u308a\u66ff\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node2 tcpdump]# ls -l\n\u5408\u8a08 20560\n-rw-r--r-- 1 tcpdump tcpdump 1000895  2\u6708 26 17:33 tcpdump.cap\n-rw-r--r-- 1 tcpdump tcpdump 1000753  2\u6708 26 17:33 tcpdump.cap1\n-rw-r--r-- 1 tcpdump tcpdump 1000794  2\u6708 26 17:35 tcpdump.cap10\n-rw-r--r-- 1 tcpdump tcpdump 1000011  2\u6708 26 17:35 tcpdump.cap11\n-rw-r--r-- 1 tcpdump tcpdump 1000072  2\u6708 26 17:35 tcpdump.cap12\n-rw-r--r-- 1 tcpdump tcpdump 1001184  2\u6708 26 17:35 tcpdump.cap13\n-rw-r--r-- 1 tcpdump tcpdump 1001498  2\u6708 26 17:35 tcpdump.cap14\n-rw-r--r-- 1 tcpdump tcpdump 1000372  2\u6708 26 17:35 tcpdump.cap15\n-rw-r--r-- 1 tcpdump tcpdump 1001118  2\u6708 26 17:35 tcpdump.cap16\n-rw-r--r-- 1 tcpdump tcpdump 1001198  2\u6708 26 17:35 tcpdump.cap17\n-rw-r--r-- 1 tcpdump tcpdump 1001276  2\u6708 26 17:35 tcpdump.cap18\n-rw-r--r-- 1 tcpdump tcpdump 1000664  2\u6708 26 17:35 tcpdump.cap19\n-rw-r--r-- 1 tcpdump tcpdump 1000752  2\u6708 26 17:33 tcpdump.cap2\n-rw-r--r-- 1 tcpdump tcpdump  536576  2\u6708 26 17:35 tcpdump.cap20\n-rw-r--r-- 1 tcpdump tcpdump 1000146  2\u6708 26 17:34 tcpdump.cap3\n-rw-r--r-- 1 tcpdump tcpdump 1000094  2\u6708 26 17:35 tcpdump.cap4\n-rw-r--r-- 1 tcpdump tcpdump 1001523  2\u6708 26 17:35 tcpdump.cap5\n-rw-r--r-- 1 tcpdump tcpdump 1000928  2\u6708 26 17:35 tcpdump.cap6\n-rw-r--r-- 1 tcpdump tcpdump 1001232  2\u6708 26 17:35 tcpdump.cap7\n-rw-r--r-- 1 tcpdump tcpdump 1000980  2\u6708 26 17:35 tcpdump.cap8\n-rw-r--r-- 1 tcpdump tcpdump 1001383  2\u6708 26 17:35 tcpdump.cap9\n\n\nDocker\u304c\u4f7f\u3048\u308b\u74b0\u5883\u306a\u3089\u3001docker pull centos\u7b49\u3092\u5b9f\u884c\u3057\u306a\u304c\u3089\u3001\ntcpdump -i eth0 -C 1 -w tcpdump.cap\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u3089\u308c\u65b9\u304c\u308f\u304b\u308b\u3002\n\n\n\n9.2 -C + -z (\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\uff09\n9.1\u306e\u65b9\u6cd5\u3060\u3068\u3001\u7121\u9650\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf\u3092\u4e00\u5b9a\u91cf\u306b\u6291\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3002\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u4ee5\u4e0a\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\u3064\u307e\u308a\u4fdd\u6301\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f3\u500b\u3002\n[root@node1 tcpdump]# cat limit.sh\n#!/usr/bin/bash\nfile_num=$(ls tcpdump.cap*|wc -l)\n\nif [ $file_num -gt 3 ]; then\n  file_name=$(ls -tr tcpdump.cap*|head -n 1)\n  rm -f $file_name\nfi\n\n\u30b7\u30a7\u30eb\u306e\u6240\u6709\u6a29\u3001\u30b0\u30eb\u30fc\u30d7\u306ftcpdump\u306b\u3057\u3066\u304a\u304f\u3002\n[root@node1 tcpdump]# chown  tcpdump:tcpdump limit.sh\n[root@node1 tcpdump]# ls -l limit.sh\n-rwxr--r-- 1 tcpdump tcpdump 35  2\u6708 12 09:41 limit.sh\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002\n\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u304c1M\u306b\u306a\u3063\u305f\u3089\u3002\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b\u3002\n\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u306b\u306a\u3063\u305f\u3089\u3001\u6700\u3082\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -C 1 -w tcpdump.cap -z ./limit.sh\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n10 tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u5207\u308a\u66ff\u3048\u308b(-Z)\n----------------------------\n1. tcpdump\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n---------------------------\n[root@node1 tcpdump]# id\nuid=0(root) gid=0(root) groups=0(root)\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 port 80\n-\u4e2d\u7565-\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 tcpdump]# ps -C tcpdump -o comm,uid,euid\nCOMMAND           UID  EUID\ntcpdump            72    72\n\nUID=72\u306ftcpdump\u306eUID\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 tcpdump]# cat /etc/passwd|grep 72\ntcpdump:x:72:72::/:/sbin/nologin\n\n-----------------------\n2. root\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n-----------------------\ntcpdump\u3092root\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -Z root -i eth0 port 80\n-\u4e2d\u7565-\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 tcpdump]# ps -C tcpdump -o comm,uid,euid\nCOMMAND           UID  EUID\ntcpdump             0     0\n\n\n\n11 \u63a1\u53d6\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092\u5236\u9650\u3059\u308b\u3002(-s)\n-s128 \u63a1\u53d6\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092128\u30d0\u30a4\u30c8\u306b\u5236\u9650\u3059\u308b\u3002 \n-s0 \u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092\u5236\u9650\u3057\u306a\u3044\u3002NFS\u306e\u5834\u5408\u3001-s0\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n12 \u6642\u523b\u95a2\u9023\n\n12.1 \u76f4\u524d\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u523b\u304b\u3089\u306e\u7d4c\u904e\u6642\u523b\u8868\u793a(-ttt)\n[root@node1 ~]# tcpdump -ttt -i eth0 port 80\n-\u4e2d\u7565-\n00:00:00.000000 IP master.45591 > node1.http: Flags [S], seq 3130128384, win 29200, options [mss 1460,sackOK,TS val 1308684 ecr 0,nop,wscale 7], length 0\n00:00:00.000573 IP node1.http > master.45591: Flags [S.], seq 2731073810, ack 3130128385, win 28960, options [mss 1460,sackOK,TS val 8901 ecr 1308684,nop,wscale 7], length 0\n00:00:00.000590 IP master.45591 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 1308687 ecr 8901], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n12.2 \u6642\u523b\u3092\u5206\u304b\u308a\u3084\u3059\u3044\u5f62\u3067\u8868\u793a\u3059\u308b(-tttt)\n[root@node1 tcpdump]# tcpdump -tttt -i eth0 port 80\n-\u4e2d\u7565-\n2017-02-11 23:48:24.601156 IP master.37570 > node1.http: Flags [S], seq 1753606276, win 29200, options [mss 1460,sackOK,TS val 14920793 ecr 0,nop,wscale 7], length 0\n2017-02-11 23:48:24.601327 IP node1.http > master.37570: Flags [S.], seq 2174856607, ack 1753606277, win 28960, options [mss 1460,sackOK,TS val 13999755 ecr 14920793,nop,wscale 7], length 0\n2017-02-11 23:48:24.630309 IP master.37570 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 14920796 ecr 13999755], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n12.3 \u6700\u521d\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u523b\u304b\u3089\u306e\u7d4c\u904e\u6642\u523b\u8868\u793a(-ttttt)\n[root@node1 tcpdump]# tcpdump -ttttt -i eth0 port 80\n-\u4e2d\u7565-\n00:00:00.000000 IP master.37609 > node1.http: Flags [S], seq 1814350362, win 29200, options [mss 1460,sackOK,TS val 15104880 ecr 0,nop,wscale 7], length 0\n00:00:00.000130 IP node1.http > master.37609: Flags [S.], seq 3384514235, ack 1814350363, win 28960, options [mss 1460,sackOK,TS val 14183842 ecr 15104880,nop,wscale 7], length 0\n00:00:00.000503 IP master.37609 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 15104880 ecr 14183842], length 0\n00:00:00.000827 IP master.37609 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 15104881 ecr 14183842], length 69\n00:00:00.000910 IP node1.http > master.37609: Flags [.], ack 70, win 227, options [nop,nop,TS val 14183843 ecr 15104881], length 0\n00:00:00.001818 IP node1.http > master.37609: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 14183844 ecr 15104881], length 4344\n00:00:00.002032 IP node1.http > master.37609: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 14183844 ecr 15104881], length 805\n00:00:00.002447 IP master.37609 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 15104882 ecr 14183844], length 0\n00:00:00.002521 IP master.37609 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 15104882 ecr 14183844], length 0\n00:00:00.003245 IP master.37609 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15104883 ecr 14183844], length 0\n00:00:00.003504 IP node1.http > master.37609: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 14183845 ecr 15104883], length 0\n00:00:00.004282 IP master.37609 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 15104884 ecr 14183845], length 0\n00:00:12.419958 IP master.37610 > node1.http: Flags [S], seq 3751257265, win 29200, options [mss 1460,sackOK,TS val 15117299 ecr 0,nop,wscale 7], length 0\n00:00:12.420080 IP node1.http > master.37610: Flags [S.], seq 2826492114, ack 3751257266, win 28960, options [mss 1460,sackOK,TS val 14196262 ecr 15117299,nop,wscale 7], length 0\n00:00:12.420785 IP master.37610 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 15117300 ecr 14196262], length 0\n00:00:12.420819 IP master.37610 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 15117300 ecr 14196262], length 69\n00:00:12.420867 IP node1.http > master.37610: Flags [.], ack 70, win 227, options [nop,nop,TS val 14196263 ecr 15117300], length 0\n00:00:12.421848 IP node1.http > master.37610: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 14196263 ecr 15117300], length 4344\n00:00:12.422183 IP node1.http > master.37610: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 14196264 ecr 15117300], length 805\n00:00:12.422851 IP master.37610 > node1.http: Flags [.], ack 2897, win 274, options [nop,nop,TS val 15117302 ecr 14196263], length 0\n00:00:12.422900 IP master.37610 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 15117302 ecr 14196263], length 0\n00:00:12.422911 IP master.37610 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 15117302 ecr 14196264], length 0\n00:00:12.423754 IP master.37610 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15117303 ecr 14196264], length 0\n00:00:12.842416 IP node1.http > master.37610: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 14196483 ecr 15117303], length 0\n00:00:12.843931 IP master.37610 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15117532 ecr 14196264], length 0\n00:00:12.843997 IP node1.http > master.37610: Flags [.], ack 71, win 227, options [nop,nop,TS val 14196686 ecr 15117532,nop,nop,sack 1 {70:71}], length 0\n00:00:12.846918 IP master.37610 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 15117725 ecr 14196483], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n\n13 \u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9(-p)\nmaster\u304b\u3089Router\u5b9b\u3066\u306bping\u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3001node1\u3067\u30d1\u30b1\u30c3\u30c8\u3092\u30ad\u30e3\u30c3\u30d7\u30c1\u30e3\u3059\u308b(tcpdump\u5b9f\u884c)\u3002\n\n-p\u3092\u4ed8\u3051\u305f\u5834\u5408\u3068\u3001\u4ed8\u3051\u306a\u3044\u5834\u5408\u306e\u9055\u3044\u3092\u78ba\u8a8d\u3059\u308b\u3001\n\n       master                        node1\n     192.168.0.10                 192.168.0.20\n         |                             |\n         |  ping                       |  tcpdump\u5b9f\u884c\n         |   |                         |\n         |   |                         |\n         |   |                         |\n    +--------|----------------------------------+\n    |        |     VMware Workstation           |\n    +--------|----------------------------------+\n             |           |\n             |           |\n             V           |\n                     192.168.0.1\n                       Router\n\n\n----------------------------------------\n1. -p\u306a\u3057\u306e\u5834\u5408(\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9\u306e\u6642)\n----------------------------------------\n[root@master ~]# ping -c 1 192.168.0.1\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u3072\u3089\u304d\u3001tcpdum\u3092\u5b9f\u884c\u3059\u308b\u3002Route\u5b9b\u3066\u306eICMP\u30d1\u30b1\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u3064\u307e\u308a\u3001\u81ea\u5206\u5b9b\u3066(node1)\u4ee5\u5916\u306e\u30d1\u30b1\u30c3\u30c8\u3082\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 icmp\n20:15:07.404762 IP master > 192.168.0.1: ICMP echo request, id 2395, seq 1, length 64\n20:15:07.408709 IP 192.168.0.1 > master: ICMP echo reply, id 2395, seq 1, length 64\n\n-----------------\n2. -p\u3042\u308a\u306e\u5834\u5408\n-----------------\n[root@master ~]# ping -c 1 192.168.0.1\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u3072\u3089\u304d\u3001tcpdum\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u4ed6\u4eba\u5b9b\u3066\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nroot@node1 ~]# tcpdump -p -i eth0 icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n\u3053\u3053\u3067\u505c\u6b62\u3057\u305f\u307e\u307e\u3002\n\n\n\n14 \u53d7\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u306e\u307f/\u9001\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u306e\u307f\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P)\n\n14.1 \u9001\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P out)\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066ping\u3092\u5b9f\u884c\u3059\u308b\u3002ICMP echo request\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@master ~]# tcpdump -i eth0 -P out icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n20:08:40.058141 IP master > 192.168.0.1: \u2605ICMP echo request, id 1634, seq 1, length 64\n\n\n\n14.2 \u53d7\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P in)\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066ping\u3092\u5b9f\u884c\u3059\u308b\u3002ICMP echo reply\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@master ~]# tcpdump -i eth0 -P in icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n20:10:07.954078 IP 192.168.0.1 > master: \u2605ICMP echo reply, id 1642, seq 1, length 64\n\n\n\nx \u53c2\u8003\u60c5\u5831\nhttp://www.tcpdump.org\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u30c0\u30f3\u30d7\u51fa\u529b\u3059\u308b\n#1 \u69cb\u6210\n\nnode1\u3067httpd\u3092\u8d77\u52d5\u3059\u308b\u3002\nmaster\u3067curl\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```\n   master  ------------------ > node1\n\u3000curl http://node1             httpd(port=80)\n\n```\n\n\n\n#2 \u74b0\u5883\n\nmaster,node1\u3068\u3082\u306bOS\u306fCentOS7.2\u3092\u4f7f\u7528\u3059\u308b\u3002\n\n```\n[root@master ~]# cat /etc/redhat-release\nCentOS Linux release 7.2.1511 (Core)\n\n```\n\n\n\n#3 TCP\u30d1\u30b1\u30c3\u30c8\u306e\u63a1\u53d6\u65b9\u6cd5\n\n\n##3.1 SYN\u30d5\u30e9\u30b0\u304c\u305f\u3063\u305f(=1)\u30d1\u30b1\u30c3\u30c8\n\n\n```\n\n---------\n0. \u76ee\u6a19 \n---------\nmaster\u304b\u3089node1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3057\u3066\u3001\u26051\u3068\u26052\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\u3002\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\u26051\n     |<------------ SYN +ACK ----------|\u26052\n     |------------- ACK -------------->|\n     |                                 |\n     \n--------------------\n1. node1\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnc\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum install nmap-ncat\n\n80\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u6a5f\u3059\u308bnc\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# nc -l 80 &\n[1] 4093\n\nnc\u30d7\u30ed\u30bb\u30b9\u304c\u5f85\u3061\u53d7\u3051\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# lsof -i:80\nCOMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnc      4093 root    3u  IPv6  44382      0t0  TCP *:http (LISTEN)\nnc      4093 root    4u  IPv4  44383      0t0  TCP *:http (LISTEN)\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0\n\n\n--------------------\n2. master\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnc\u30b3\u30de\u30f3\u30c9\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n[root@node1 ~]# yum install nmap-ncat\n\nnode1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n[root@master sar]# nc node1 80 -vv\nNcat: Version 6.40 ( http://nmap.org/ncat )\nlibnsock nsi_new2(): nsi_new (IOD #1)\nlibnsock nsock_connect_tcp(): TCP connection requested to 192.168.0.20:80 (IOD #1) EID 8\nlibnsock nsock_trace_handler_callback(): Callback: CONNECT SUCCESS for EID 8 [192.168.0.20:80]\nNcat: Connected to 192.168.0.20:80.\nlibnsock nsi_new2(): nsi_new (IOD #2)\nlibnsock nsock_read(): Read request from IOD #1 [192.168.0.20:80] (timeout: -1ms) EID 18\nlibnsock nsock_readbytes(): Read request for 0 bytes from IOD #2 [peer unspecified] EID 26\ntest    => \"test\"\u3068\u5165\u529b\u3057\u305f\u3002\n\n\n--------------------\n3. node1\u5074\u306e\u78ba\u8a8d\u7d50\u679c\n--------------------\nSYN\u30d5\u30e9\u30b0\u306e\u305f\u3063\u305f\u30d1\u30b1\u30c3\u30c8(\u2605\u5370)\u63a1\u53d6\u3092\u304a\u3053\u306a\u3046\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n11:53:15.864640 IP master.48604 > node1.http: Flags \u2605[S], seq 1922717478, win 29200, options [mss 1460,sackOK,TS val 10235908 ecr 0,nop,wscale 7], length 0\n11:53:15.864796 IP node1.http > master.48604: Flags \u2605[S.], seq 1379729022, \u2605ack 1922717479, win 28960, options [mss 1460,sackOK,TS val 3079043 ecr 10235908,nop,wscale 7], length 0\ntest   =>master\u3067\u5165\u529b\u3057\u305f\"test\"\u304cnode1\u5074\u3067\u78ba\u8a8d\u3067\u304d\u305f\u3002\n\n\n```\n\n\n\n##3.2 SYN\u30d1\u30b1\u30c3\u30c8(SYN\u30d5\u30e9\u30b0\u306e\u307f\u7acb\u3063\u305f\u30d1\u30b1\u30c3\u30c8)\n\n\n\n```\n\u26051\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\u26051\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |------------- SYN -------------->|\u26051\uff08\u518d\u9001\uff09\n     |                                 |\n     \n\n--------------------\n1. node1\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\n80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306eTCP\u30d1\u30b1\u30c3\u30c8\u306f\u5ec3\u68c4\u3059\u308b\u3002\n[root@node1 ~]# iptables -A INPUT -p tcp --dport 80 -j DROP\n\n\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# iptables -nvL INPUT --line-numbers\nChain INPUT (policy ACCEPT 58 packets, 18279 bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1        0     0 DROP       tcp  --  *      *       0.0.0.0/0            0.0.0.0/0            tcp dpt:80\n\n80\u756a\u30dd\u30fc\u30c8\u3067\u5f85\u6a5f\u3059\u308bnc\u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 ~]# nc -l 80 &\n[1] 2518\n\nnc\u30d7\u30ed\u30bb\u30b9\u304c\u5f85\u3061\u53d7\u3051\u3066\u3044\u308b\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# lsof -i:80\nCOMMAND  PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME\nnc      2518 root    3u  IPv6  30891      0t0  TCP *:http (LISTEN)\nnc      2518 root    4u  IPv4  30892      0t0  TCP *:http (LISTEN)\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002SYN\u30d1\u30b1\u30c3\u30c8\u306e\u307f\u63a1\u53d6\u3059\u308b\u8a2d\u5b9a\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0 and '(tcp[tcpflags] & tcp-ack) ==0'\n\n--------------------\n2. master\u5074\u3067\u5b9f\u884c\u3059\u308b\n--------------------\nnode1\u306e80\u756a\u30dd\u30fc\u30c8\u5b9b\u3066\u306bTCP\u30d1\u30b1\u30c3\u30c8\u3092\u9001\u4fe1\u3059\u308b\u3002\n[root@master sar]# nc node1 80 -vv\nNcat: Version 6.40 ( http://nmap.org/ncat )\nlibnsock nsi_new2(): nsi_new (IOD #1)\nlibnsock nsock_connect_tcp(): TCP connection requested to 192.168.0.20:80 (IOD #1) EID 8\nlibnsock nsock_trace_handler_callback(): Callback: CONNECT TIMEOUT for EID 8 [192.168.0.20:80]\nNcat: Connection timed out.  => SYN\u518d\u9001\u56de\u6570\u306e\u6700\u5927\u5024\u306b\u5230\u9054\u524d\u306b\u3001\u5148\u306bnc\u30b3\u30de\u30f3\u30c9\u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3057\u3066\u7d42\u4e86\u3057\u305f\u6a21\u69d8\u3002\n\n--------------------\n3. node1\u5074\u306e\u78ba\u8a8d\u7d50\u679c\n--------------------\ntcpdump\u306e\u5b9f\u884c\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\u3002SYN\u30d1\u30b1\u30c3\u30c8(\u2605\u5370)\u306e\u307f\u63a1\u53d6\u3067\u304d\u305f\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-syn)' != 0 and '(tcp[tcpflags] & tcp-ack) ==0'\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n11:20:35.970211 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8276013 ecr 0,nop,wscale 7], length 0\n11:20:36.971734 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8277017 ecr 0,nop,wscale 7], length 0\n11:20:39.252406 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8279024 ecr 0,nop,wscale 7], length 0\n11:20:42.986909 IP master.48298 > node1.http: Flags \u2605[S], seq 149498950, win 29200, options [mss 1460,sackOK,TS val 8283032 ecr 0,nop,wscale 7], length 0\n- nc\u30b3\u30de\u30f3\u30c9\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306b\u3088\u308a\u3001\u3053\u3053\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u7d42\u4e86 -\n\n\n-----------------------------\n4. \u3042\u3068\u59cb\u672b(iptables\u5b9a\u7fa9\u524a\u9664)\n-----------------------------\n[root@node1 ~]# iptables -L INPUT --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n1    DROP       tcp  --  anywhere             anywhere             tcp dpt:http\n[root@node1 ~]# iptables -D INPUT 1\n[root@node1 ~]# iptables -L INPUT --line-numbers\nChain INPUT (policy ACCEPT)\nnum  target     prot opt source               destination\n[root@node1 ~]#\n\n```\n\n\n\n\n##3.3 FIN\u30d1\u30b1\u30c3\u30c8\n\n```\n\u26051\u3068\u26052\u306e\u30d1\u30b1\u30c3\u30c8\u3092\u63a1\u53d6\u3059\u308b\n\n   master                            node1\n     |                                 |\n     |------------- SYN -------------->|\n     |<------------ SYN + ACK ---------|\n     |------------- ACK -------------->|\n     |                                 |\n     |                                 |\n     |------------- FIN -------------->|\u26051\n     |<------------ FIN + ACK ---------|\u26052\n     |------------- ACK -------------->|\n     |                                 |\n     |                                 |\n\n[root@node1 ~]# tcpdump -i eth0 '(tcp[tcpflags] & tcp-fin)' != 0\n-\u4e2d\u7565-\n20:46:33.720744 IP master.35582 > node1.http: Flags [F.], seq 635647794, ack 894972442, win 319, options [nop,nop,TS val 4009862 ecr 3088873], length 0\n20:46:33.721687 IP node1.http > master.35582: Flags [F.], seq 1, ack 1, win 227, options [nop,nop,TS val 3088875 ecr 4009862], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n#4 MAC\u30a2\u30c9\u30ec\u30b9\u3092\u8868\u793a\u3059\u308b(-e)\n\n```\n[root@node1 ~]# tcpdump -e -i eth0 port 80\n21:04:41.208201 00:0c:29:18:5c:90 (oui Unknown) > 00:0c:29:a5:64:c8 (oui Unknown), ethertype IPv4 (0x0800), length 74: master.35770 > node1.http: Flags [S], seq 844789185, win 29200, options [mss 1460,sackOK,TS val 5097353 ecr 0,nop,wscale 7], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n```\n\n\n\n#5 \u63a1\u53d6\u3057\u305ftcpdump\u3092\u8868\u793a(-r)\u3059\u308b\n\n\n```\n\u30c6\u30b9\u30c8\u7528\u306etcpdump\u3092\u63a1\u53d6(-w)\u3059\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 port 80 -w http.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u63a1\u53d6\u3057\u305ftcpdump\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 ~]# ls -l http.cap\n-rw-r--r-- 1 tcpdump tcpdump 38313  2\u6708 11 21:48 http.cap\n[root@node1 ~]#\n\n\u63a1\u53d6\u3057\u305ftcpdump\u3092\u8868\u793a(-r)\u3059\u308b\u3002\n[root@node1 ~]# tcpdump -r http.cap\n-\u4e2d\u7565-\n21:47:39.816741 IP master.36345 > node1.http: Flags [S], seq 1437916452, win 29200, options [mss 1460,sackOK,TS val 7676049 ecr 0,nop,wscale 7], length 0\n21:47:39.816879 IP node1.http > master.36345: Flags [S.], seq 296354756, ack 1437916453, win 28960, options [mss 1460,sackOK,TS val 6754970 ecr 7676049,nop,wscale 7], length 0\n21:47:39.818131 IP master.36345 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 7676050 ecr 6754970], length 0\n21:47:39.818180 IP master.36345 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 7676051 ecr 6754970], length 69\n21:47:39.818234 IP node1.http > master.36345: Flags [.], ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 0\n21:47:39.818968 IP node1.http > master.36345: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 4344\n21:47:39.819210 IP node1.http > master.36345: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 6754973 ecr 7676051], length 805\n21:47:39.820037 IP master.36345 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 7676052 ecr 6754972], length 0\n21:47:39.820077 IP master.36345 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822032 IP master.36345 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822277 IP node1.http > master.36345: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 6754976 ecr 7676053], length 0\n21:47:39.826081 IP master.36345 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 7676055 ecr 6754976], length 0\n21:47:43.474723 IP master.36346 > node1.http: Flags [S], seq 3975369367, win 29200, options [mss 1460,sackOK,TS val 7679705 ecr 0,nop,wscale 7], length 0\n21:47:43.474894 IP node1.http > master.36346: Flags [S.], seq 3828837720, ack 3975369368, win 28960, options [mss 1460,sackOK,TS val 6758628 ecr 7679705,nop,wscale 7], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n----------------------------\n2. sed\u3092\u4f7f\u3063\u3066\u6642\u523b\u3092\u7d5e\u308a\u8fbc\u3080\n----------------------------\n[root@node1 ~]# tcpdump -r http.cap |sed -n '/21:47:39\\.816741/,/21:47:39\\.826081/p'\n-\u4e2d\u7565-\n21:47:39.816741 IP master.36345 > node1.http: Flags [S], seq 1437916452, win 29200, options [mss 1460,sackOK,TS val 7676049 ecr 0,nop,wscale 7], length 0\n21:47:39.816879 IP node1.http > master.36345: Flags [S.], seq 296354756, ack 1437916453, win 28960, options [mss 1460,sackOK,TS val 6754970 ecr 7676049,nop,wscale 7], length 0\n21:47:39.818131 IP master.36345 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 7676050 ecr 6754970], length 0\n21:47:39.818180 IP master.36345 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 7676051 ecr 6754970], length 69\n21:47:39.818234 IP node1.http > master.36345: Flags [.], ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 0\n21:47:39.818968 IP node1.http > master.36345: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 6754972 ecr 7676051], length 4344\n21:47:39.819210 IP node1.http > master.36345: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 6754973 ecr 7676051], length 805\n21:47:39.820037 IP master.36345 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 7676052 ecr 6754972], length 0\n21:47:39.820077 IP master.36345 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822032 IP master.36345 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 7676053 ecr 6754973], length 0\n21:47:39.822277 IP node1.http > master.36345: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 6754976 ecr 7676053], length 0\n21:47:39.826081 IP master.36345 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 7676055 ecr 6754976], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n\n```\n\n\n\n#6 \u7c21\u6f54\u306a\u51fa\u529b\u3092\u3059\u308b(-q)\n\n```\n[root@node1 ~]# tcpdump -i eth0 port 80 -q\n-\u4e2d\u7565-\n22:08:54.904012 IP master.36554 > node1.http: tcp 0\n22:08:54.904207 IP node1.http > master.36554: tcp 0\n22:08:54.904678 IP master.36554 > node1.http: tcp 0\n22:08:54.905582 IP master.36554 > node1.http: tcp 69\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n#7 tcpdump\u3067\u4f7f\u7528\u3067\u304d\u308b\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u4e00\u89a7\u3092\u8868\u793a\u3059\u308b(-D)\n\n\u4e0b\u8a18\u306ecbr0\u30a4\u30f3\u30bf\u30d5\u30a7\u30fc\u30b9\u306f\u3001Docker\u306e\u30ab\u30b9\u30bf\u30e0\u30d6\u30ea\u30c3\u30b8\u3067\u3059\u3002\n\n```\n[root@node1 ~]# tcpdump -D\n1.eth0\n2.cbr0\n3.nflog (Linux netfilter log (NFLOG) interface)\n4.nfqueue (Linux netfilter queue (NFQUEUE) interface)\n5.usbmon1 (USB bus number 1)\n6.usbmon2 (USB bus number 2)\n7.any (Pseudo-device that captures on all interfaces)\n8.lo\n[root@node1 ~]#\n\n```\n\n\n\n\n#8 \u6642\u9593\u3067\u5207\u308a\u66ff\u3048\u308b(-G,-z)\n\n##8.1 -G\u3060\u3051\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408(\u5207\u308a\u66ff\u3048\u306f\u53ef\u80fd\u3060\u3051\u3069\u3001\u7121\u9650\u306b\u5897\u3048\u3066\u3044\u304f\uff09\n```\ntcpdump\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# id\nuid=0(root) gid=0(root) groups=0(root)\n\nroot\u30e6\u30fc\u30b6\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u308b\u306e\u3067\u3001\u4f5c\u6210\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3001\u30b0\u30eb\u30fc\u30d7\u306froot\u3068\u306a\u308b\u3002\n[root@node1 ~]# mkdir tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 root root 6  2\u6708 11 23:29 tcpdump\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u3092tcpdump\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u306a\u3044\u3068\u3001\u63a1\u53d6\u3067\u304d\u306a\u3044\u3002\n\u7406\u7531\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u304croot\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3002\n\u4ed6\u306e\u3084\u308a\u65b9\u3068\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092root\u306b\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u304c\u3042\u308b(10\u53c2\u7167\uff09\u3002\n[root@node1 ~]# chown tcpdump:tcpdump tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 tcpdump tcpdump 6  2\u6708 11 22:41 tcpdump\n\n[root@node1 ~]# cd tcpdump/\n\n10\u79d2\u6bce\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b(-G)\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -G 10 -w tcpdump_%Y%m%d_%H%M%S.cap\n\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u300210\u79d2\u5358\u4f4d\u3067\u4f5c\u6210\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 tcpdump]# ls -l --full-time\n\u5408\u8a08 104\n-rw-r--r-- 1 tcpdump tcpdump 18004 2017-02-11 22:45:11.073577507 +0900 tcpdump_20170211_224501.cap\n-rw-r--r-- 1 tcpdump tcpdump 21492 2017-02-11 22:45:21.111767063 +0900 tcpdump_20170211_224511.cap\n-rw-r--r-- 1 tcpdump tcpdump 24196 2017-02-11 22:45:31.145956545 +0900 tcpdump_20170211_224521.cap\n-rw-r--r-- 1 tcpdump tcpdump 20946 2017-02-11 22:45:41.166145762 +0900 tcpdump_20170211_224531.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n##8.2 -G + -z (\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\uff09\n\n8.1\u306e\u65b9\u6cd5\u3060\u3068\u3001\u7121\u9650\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf\u3092\u4e00\u5b9a\u91cf\u306b\u6291\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3002\n\n```\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u4ee5\u4e0a\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\u3064\u307e\u308a\u4fdd\u6301\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f3\u500b\u3002\n[root@node1 tcpdump]# cat limit.sh\n#!/usr/bin/bash\nfile_num=$(ls tcpdump_*|wc -l)\n\nif [ $file_num -gt 3 ]; then\n  file_name=$(ls -tr tcpdump_*|head -n 1)\n  rm -f $file_name\nfi\n\n\u30b7\u30a7\u30eb\u306e\u6240\u6709\u6a29\u3001\u30b0\u30eb\u30fc\u30d7\u306ftcpdump\u306b\u3057\u3066\u304a\u304f\u3002\n[root@node1 tcpdump]# ls -l limit.sh\n-rwxr--r-- 1 tcpdump tcpdump 35  2\u6708 12 09:41 limit.sh\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u300210\u79d2\u6bce\u306b\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -G 10 -w tcpdump_%Y%m%d_%H%M%S.cap -z ./limit.sh\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n#9 \u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u3067\u5207\u308a\u66ff\u3048\u308b(-C,-z)\n\n\n##9.1 -C\u3060\u3051\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408(\u5207\u308a\u66ff\u3048\u306f\u53ef\u80fd\u3060\u3051\u3069\u3001\u7121\u9650\u306b\u5897\u3048\u3066\u3044\u304f\uff09\n\n```\ntcpdump\u3092\u5b9f\u884c\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3059\u308b\u3002\n[root@node1 ~]# mkdir tcpdump\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u3092tcpdump\u306b\u5909\u66f4\u3059\u308b\u3002\u5909\u66f4\u3057\u306a\u3044\u3068\u3001\u63a1\u53d6\u3067\u304d\u306a\u3044\u3002\n\u7406\u7531\u306f\u3001\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u6240\u6709\u8005\u3068\u30b0\u30eb\u30fc\u30d7\u304croot\u306b\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3002\n\u4ed6\u306e\u3084\u308a\u65b9\u3068\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092root\u306b\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u304c\u3042\u308b(10\u53c2\u7167\uff09\u3002\n[root@node1 ~]# chown tcpdump:tcpdump tcpdump\n[root@node1 ~]# ls -ld tcpdump\ndrwxr-xr-x 2 tcpdump tcpdump 6  2\u6708 11 22:41 tcpdump\n\n[root@node1 ~]# cd tcpdump/\n\n1M\u5358\u4f4d\u3067\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b(-C)\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -C 1 -w tcpdump.cap\n-\u4ee5\u4e0b\u3001\u7565-\n\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u78ba\u8a8d\u3059\u308b\u30021M\u30b5\u30a4\u30ba\u3067\u30d5\u30a1\u30a4\u30eb\u304c\u5207\u308a\u66ff\u308f\u3063\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node2 tcpdump]# ls -l\n\u5408\u8a08 20560\n-rw-r--r-- 1 tcpdump tcpdump 1000895  2\u6708 26 17:33 tcpdump.cap\n-rw-r--r-- 1 tcpdump tcpdump 1000753  2\u6708 26 17:33 tcpdump.cap1\n-rw-r--r-- 1 tcpdump tcpdump 1000794  2\u6708 26 17:35 tcpdump.cap10\n-rw-r--r-- 1 tcpdump tcpdump 1000011  2\u6708 26 17:35 tcpdump.cap11\n-rw-r--r-- 1 tcpdump tcpdump 1000072  2\u6708 26 17:35 tcpdump.cap12\n-rw-r--r-- 1 tcpdump tcpdump 1001184  2\u6708 26 17:35 tcpdump.cap13\n-rw-r--r-- 1 tcpdump tcpdump 1001498  2\u6708 26 17:35 tcpdump.cap14\n-rw-r--r-- 1 tcpdump tcpdump 1000372  2\u6708 26 17:35 tcpdump.cap15\n-rw-r--r-- 1 tcpdump tcpdump 1001118  2\u6708 26 17:35 tcpdump.cap16\n-rw-r--r-- 1 tcpdump tcpdump 1001198  2\u6708 26 17:35 tcpdump.cap17\n-rw-r--r-- 1 tcpdump tcpdump 1001276  2\u6708 26 17:35 tcpdump.cap18\n-rw-r--r-- 1 tcpdump tcpdump 1000664  2\u6708 26 17:35 tcpdump.cap19\n-rw-r--r-- 1 tcpdump tcpdump 1000752  2\u6708 26 17:33 tcpdump.cap2\n-rw-r--r-- 1 tcpdump tcpdump  536576  2\u6708 26 17:35 tcpdump.cap20\n-rw-r--r-- 1 tcpdump tcpdump 1000146  2\u6708 26 17:34 tcpdump.cap3\n-rw-r--r-- 1 tcpdump tcpdump 1000094  2\u6708 26 17:35 tcpdump.cap4\n-rw-r--r-- 1 tcpdump tcpdump 1001523  2\u6708 26 17:35 tcpdump.cap5\n-rw-r--r-- 1 tcpdump tcpdump 1000928  2\u6708 26 17:35 tcpdump.cap6\n-rw-r--r-- 1 tcpdump tcpdump 1001232  2\u6708 26 17:35 tcpdump.cap7\n-rw-r--r-- 1 tcpdump tcpdump 1000980  2\u6708 26 17:35 tcpdump.cap8\n-rw-r--r-- 1 tcpdump tcpdump 1001383  2\u6708 26 17:35 tcpdump.cap9\n\n\nDocker\u304c\u4f7f\u3048\u308b\u74b0\u5883\u306a\u3089\u3001docker pull centos\u7b49\u3092\u5b9f\u884c\u3057\u306a\u304c\u3089\u3001\ntcpdump -i eth0 -C 1 -w tcpdump.cap\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u3089\u308c\u65b9\u304c\u308f\u304b\u308b\u3002\n\n```\n\n\n##9.2 -C + -z (\u30b7\u30a7\u30eb\u3092\u5b9f\u884c\u3057\u3066\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u65b9\u6cd5\uff09\n\n9.1\u306e\u65b9\u6cd5\u3060\u3068\u3001\u7121\u9650\u306b\u30d5\u30a1\u30a4\u30eb\u304c\u5897\u3048\u3066\u3044\u304f\u3002\n\u30c7\u30a3\u30b9\u30af\u4f7f\u7528\u91cf\u3092\u4e00\u5b9a\u91cf\u306b\u6291\u3048\u305f\u3044\u5834\u5408\u306f\u3001\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u5b9a\u671f\u7684\u306b\u524a\u9664\u3059\u308b\u3002\n\n```\n\u30ad\u30e3\u30d7\u30c1\u30e3\u30c7\u30fc\u30bf\u3092\u4fdd\u5b58\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u4ee5\u4e0a\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\u3064\u307e\u308a\u4fdd\u6301\u3059\u308b\u30d5\u30a1\u30a4\u30eb\u306f3\u500b\u3002\n[root@node1 tcpdump]# cat limit.sh\n#!/usr/bin/bash\nfile_num=$(ls tcpdump.cap*|wc -l)\n\nif [ $file_num -gt 3 ]; then\n  file_name=$(ls -tr tcpdump.cap*|head -n 1)\n  rm -f $file_name\nfi\n\n\u30b7\u30a7\u30eb\u306e\u6240\u6709\u6a29\u3001\u30b0\u30eb\u30fc\u30d7\u306ftcpdump\u306b\u3057\u3066\u304a\u304f\u3002\n[root@node1 tcpdump]# chown  tcpdump:tcpdump limit.sh\n[root@node1 tcpdump]# ls -l limit.sh\n-rwxr--r-- 1 tcpdump tcpdump 35  2\u6708 12 09:41 limit.sh\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002\n\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u306e\u30b5\u30a4\u30ba\u304c1M\u306b\u306a\u3063\u305f\u3089\u3002\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u3092\u5207\u308a\u66ff\u3048\u308b\u3002\n\u4fdd\u5b58\u30d5\u30a1\u30a4\u30eb\u304c4\u500b\u306b\u306a\u3063\u305f\u3089\u3001\u6700\u3082\u53e4\u3044\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 -C 1 -w tcpdump.cap -z ./limit.sh\n-\u4ee5\u4e0b\u3001\u7565-\n\n````\n\n\n\n#10 tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u5207\u308a\u66ff\u3048\u308b(-Z)\n\n```\n----------------------------\n1. tcpdump\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n---------------------------\n[root@node1 tcpdump]# id\nuid=0(root) gid=0(root) groups=0(root)\n\ntcpdump\u3092\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -i eth0 port 80\n-\u4e2d\u7565-\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 tcpdump]# ps -C tcpdump -o comm,uid,euid\nCOMMAND           UID  EUID\ntcpdump            72    72\n\nUID=72\u306ftcpdump\u306eUID\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 tcpdump]# cat /etc/passwd|grep 72\ntcpdump:x:72:72::/:/sbin/nologin\n\n-----------------------\n2. root\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n-----------------------\ntcpdump\u3092root\u6a29\u9650\u3067\u8d77\u52d5\u3059\u308b\u3002\n[root@node1 tcpdump]# tcpdump -Z root -i eth0 port 80\n-\u4e2d\u7565-\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u30aa\u30fc\u30d7\u30f3\u3057\u3066\u3001tcpdump\u30d7\u30ed\u30bb\u30b9\u306eUID\u3092\u78ba\u8a8d\u3059\u308b\u3002\n[root@node1 tcpdump]# ps -C tcpdump -o comm,uid,euid\nCOMMAND           UID  EUID\ntcpdump             0     0\n\n```\n\n\n#11 \u63a1\u53d6\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092\u5236\u9650\u3059\u308b\u3002(-s)\n\n-s128 \u63a1\u53d6\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092128\u30d0\u30a4\u30c8\u306b\u5236\u9650\u3059\u308b\u3002 \n-s0 \u30d1\u30b1\u30c3\u30c8\u30b5\u30a4\u30ba\u3092\u5236\u9650\u3057\u306a\u3044\u3002NFS\u306e\u5834\u5408\u3001-s0\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n\n\n\n#12 \u6642\u523b\u95a2\u9023\n\n\n##12.1 \u76f4\u524d\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u523b\u304b\u3089\u306e\u7d4c\u904e\u6642\u523b\u8868\u793a(-ttt)\n\n```\n[root@node1 ~]# tcpdump -ttt -i eth0 port 80\n-\u4e2d\u7565-\n00:00:00.000000 IP master.45591 > node1.http: Flags [S], seq 3130128384, win 29200, options [mss 1460,sackOK,TS val 1308684 ecr 0,nop,wscale 7], length 0\n00:00:00.000573 IP node1.http > master.45591: Flags [S.], seq 2731073810, ack 3130128385, win 28960, options [mss 1460,sackOK,TS val 8901 ecr 1308684,nop,wscale 7], length 0\n00:00:00.000590 IP master.45591 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 1308687 ecr 8901], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n##12.2 \u6642\u523b\u3092\u5206\u304b\u308a\u3084\u3059\u3044\u5f62\u3067\u8868\u793a\u3059\u308b(-tttt)\n\n```\n[root@node1 tcpdump]# tcpdump -tttt -i eth0 port 80\n-\u4e2d\u7565-\n2017-02-11 23:48:24.601156 IP master.37570 > node1.http: Flags [S], seq 1753606276, win 29200, options [mss 1460,sackOK,TS val 14920793 ecr 0,nop,wscale 7], length 0\n2017-02-11 23:48:24.601327 IP node1.http > master.37570: Flags [S.], seq 2174856607, ack 1753606277, win 28960, options [mss 1460,sackOK,TS val 13999755 ecr 14920793,nop,wscale 7], length 0\n2017-02-11 23:48:24.630309 IP master.37570 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 14920796 ecr 13999755], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n\n##12.3 \u6700\u521d\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u305f\u6642\u523b\u304b\u3089\u306e\u7d4c\u904e\u6642\u523b\u8868\u793a(-ttttt)\n\n```\n[root@node1 tcpdump]# tcpdump -ttttt -i eth0 port 80\n-\u4e2d\u7565-\n00:00:00.000000 IP master.37609 > node1.http: Flags [S], seq 1814350362, win 29200, options [mss 1460,sackOK,TS val 15104880 ecr 0,nop,wscale 7], length 0\n00:00:00.000130 IP node1.http > master.37609: Flags [S.], seq 3384514235, ack 1814350363, win 28960, options [mss 1460,sackOK,TS val 14183842 ecr 15104880,nop,wscale 7], length 0\n00:00:00.000503 IP master.37609 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 15104880 ecr 14183842], length 0\n00:00:00.000827 IP master.37609 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 15104881 ecr 14183842], length 69\n00:00:00.000910 IP node1.http > master.37609: Flags [.], ack 70, win 227, options [nop,nop,TS val 14183843 ecr 15104881], length 0\n00:00:00.001818 IP node1.http > master.37609: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 14183844 ecr 15104881], length 4344\n00:00:00.002032 IP node1.http > master.37609: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 14183844 ecr 15104881], length 805\n00:00:00.002447 IP master.37609 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 15104882 ecr 14183844], length 0\n00:00:00.002521 IP master.37609 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 15104882 ecr 14183844], length 0\n00:00:00.003245 IP master.37609 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15104883 ecr 14183844], length 0\n00:00:00.003504 IP node1.http > master.37609: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 14183845 ecr 15104883], length 0\n00:00:00.004282 IP master.37609 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 15104884 ecr 14183845], length 0\n00:00:12.419958 IP master.37610 > node1.http: Flags [S], seq 3751257265, win 29200, options [mss 1460,sackOK,TS val 15117299 ecr 0,nop,wscale 7], length 0\n00:00:12.420080 IP node1.http > master.37610: Flags [S.], seq 2826492114, ack 3751257266, win 28960, options [mss 1460,sackOK,TS val 14196262 ecr 15117299,nop,wscale 7], length 0\n00:00:12.420785 IP master.37610 > node1.http: Flags [.], ack 1, win 229, options [nop,nop,TS val 15117300 ecr 14196262], length 0\n00:00:12.420819 IP master.37610 > node1.http: Flags [P.], seq 1:70, ack 1, win 229, options [nop,nop,TS val 15117300 ecr 14196262], length 69\n00:00:12.420867 IP node1.http > master.37610: Flags [.], ack 70, win 227, options [nop,nop,TS val 14196263 ecr 15117300], length 0\n00:00:12.421848 IP node1.http > master.37610: Flags [.], seq 1:4345, ack 70, win 227, options [nop,nop,TS val 14196263 ecr 15117300], length 4344\n00:00:12.422183 IP node1.http > master.37610: Flags [P.], seq 4345:5150, ack 70, win 227, options [nop,nop,TS val 14196264 ecr 15117300], length 805\n00:00:12.422851 IP master.37610 > node1.http: Flags [.], ack 2897, win 274, options [nop,nop,TS val 15117302 ecr 14196263], length 0\n00:00:12.422900 IP master.37610 > node1.http: Flags [.], ack 4345, win 296, options [nop,nop,TS val 15117302 ecr 14196263], length 0\n00:00:12.422911 IP master.37610 > node1.http: Flags [.], ack 5150, win 319, options [nop,nop,TS val 15117302 ecr 14196264], length 0\n00:00:12.423754 IP master.37610 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15117303 ecr 14196264], length 0\n00:00:12.842416 IP node1.http > master.37610: Flags [F.], seq 5150, ack 71, win 227, options [nop,nop,TS val 14196483 ecr 15117303], length 0\n00:00:12.843931 IP master.37610 > node1.http: Flags [F.], seq 70, ack 5150, win 319, options [nop,nop,TS val 15117532 ecr 14196264], length 0\n00:00:12.843997 IP node1.http > master.37610: Flags [.], ack 71, win 227, options [nop,nop,TS val 14196686 ecr 15117532,nop,nop,sack 1 {70:71}], length 0\n00:00:12.846918 IP master.37610 > node1.http: Flags [.], ack 5151, win 319, options [nop,nop,TS val 15117725 ecr 14196483], length 0\n-\u4ee5\u4e0b\u3001\u7565-\n\n```\n\n\n\n#13 \u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9(-p)\n\n```\nmaster\u304b\u3089Router\u5b9b\u3066\u306bping\u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3001node1\u3067\u30d1\u30b1\u30c3\u30c8\u3092\u30ad\u30e3\u30c3\u30d7\u30c1\u30e3\u3059\u308b(tcpdump\u5b9f\u884c)\u3002\n\n-p\u3092\u4ed8\u3051\u305f\u5834\u5408\u3068\u3001\u4ed8\u3051\u306a\u3044\u5834\u5408\u306e\u9055\u3044\u3092\u78ba\u8a8d\u3059\u308b\u3001\n\n       master                        node1\n     192.168.0.10                 192.168.0.20\n         |                             |\n         |  ping                       |  tcpdump\u5b9f\u884c\n         |   |                         |\n         |   |                         |\n         |   |                         |\n    +--------|----------------------------------+\n    |        |     VMware Workstation           |\n    +--------|----------------------------------+\n             |           |\n             |           |\n             V           |\n                     192.168.0.1\n                       Router\n\n\n----------------------------------------\n1. -p\u306a\u3057\u306e\u5834\u5408(\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9\u306e\u6642)\n----------------------------------------\n[root@master ~]# ping -c 1 192.168.0.1\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u3072\u3089\u304d\u3001tcpdum\u3092\u5b9f\u884c\u3059\u308b\u3002Route\u5b9b\u3066\u306eICMP\u30d1\u30b1\u30c3\u30c8\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\u3064\u307e\u308a\u3001\u81ea\u5206\u5b9b\u3066(node1)\u4ee5\u5916\u306e\u30d1\u30b1\u30c3\u30c8\u3082\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308b\u3002\n[root@node1 ~]# tcpdump -i eth0 icmp\n20:15:07.404762 IP master > 192.168.0.1: ICMP echo request, id 2395, seq 1, length 64\n20:15:07.408709 IP 192.168.0.1 > master: ICMP echo reply, id 2395, seq 1, length 64\n\n-----------------\n2. -p\u3042\u308a\u306e\u5834\u5408\n-----------------\n[root@master ~]# ping -c 1 192.168.0.1\n\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u3072\u3089\u304d\u3001tcpdum\u3092\u5b9f\u884c\u3059\u308b\u3002\n\u30d7\u30ed\u30df\u30b9\u30ad\u30e3\u30b9\u30e2\u30fc\u30c9\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u4ed6\u4eba\u5b9b\u3066\u306e\u30d1\u30b1\u30c3\u30c8\u306f\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308b\u3002\nroot@node1 ~]# tcpdump -p -i eth0 icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n\u3053\u3053\u3067\u505c\u6b62\u3057\u305f\u307e\u307e\u3002\n\n```\n\n\n#14 \u53d7\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u306e\u307f/\u9001\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u306e\u307f\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P)\n##14.1 \u9001\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P out)\n\n```\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066ping\u3092\u5b9f\u884c\u3059\u308b\u3002ICMP echo request\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@master ~]# tcpdump -i eth0 -P out icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n20:08:40.058141 IP master > 192.168.0.1: \u2605ICMP echo request, id 1634, seq 1, length 64\n\n```\n\n\n##14.2 \u53d7\u4fe1\u3059\u308b\u30d1\u30b1\u30c3\u30c8\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b(-P in)\n\n```\n\u5225\u30bf\u30fc\u30df\u30ca\u30eb\u3092\u958b\u3044\u3066ping\u3092\u5b9f\u884c\u3059\u308b\u3002ICMP echo reply\u3060\u3051\u30ad\u30e3\u30d7\u30c1\u30e3\u3067\u304d\u308b\u3053\u3068\u304c\u308f\u304b\u308b(\u2605\u5370)\u3002\n[root@master ~]# tcpdump -i eth0 -P in icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 65535 bytes\n20:10:07.954078 IP 192.168.0.1 > master: \u2605ICMP echo reply, id 1642, seq 1, length 64\n\n```\n\n\n#x \u53c2\u8003\u60c5\u5831\n[http://www.tcpdump.org](http://www.tcpdump.org/tcpdump_man.html)\n[\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30c8\u30e9\u30d5\u30a3\u30c3\u30af\u3092\u30c0\u30f3\u30d7\u51fa\u529b\u3059\u308b](http://itpro.nikkeibp.co.jp/article/COLUMN/20140512/556024/?rt=nocnt)\n", "tags": ["centos7", "tcpdump", "\u30d1\u30b1\u30c3\u30c8\u30ad\u30e3\u30d7\u30c1\u30e3"]}