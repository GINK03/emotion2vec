{"context": " More than 1 year has passed since last update.bc\u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u3001yum/apt\u306a\u3069\u3067\u5c0e\u5165\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nCPU\u30b3\u30a2\u6570\u306f\u81ea\u52d5\u7684\u306b\u5224\u5b9a\u3057\u3001\u9069\u5207(\u5168\u3066\u306e\u30b3\u30a2\u3078\u5206\u6563\u3059\u308b)\u306a\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n/etc/init.d/rpsxps\n#!/bin/sh\n\n# chkconfig: - 85 15\n\n### BEGIN INIT INFO\n# Provides:          rpsxps\n# Required-Start:    $local_fs $remote_fs $network $syslog\n# Required-Stop:     $local_fs $remote_fs $network $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: rpsxps \n# Description:       rpsxps\n### END INIT INFO\n\n# Source function library.\n. /etc/rc.d/init.d/functions\n\n### Environment variables\naction=\"$1\"\nprog=$(basename $0)\nfullbit=32\n\n# Feel free to change any of the following variables for your app:\nstart(){\n  echo -n $\"Starting $prog: \"\n  for if in `ls /sys/class/net| grep -v lo`; do\n    I=0\n    for q in `ls /sys/class/net/${if}/queues/tx-*/xps_cpus`;do\n      echo 2^${I}|bc > ${q}\n      I=$(( ${I}+1 ))\n    done\n    for q in `ls -dF /sys/class/net/${if}/queues/rx-*`;do\n      n=$(cat /proc/cpuinfo | grep ^processor|wc -l)\n      if [ ${n} -ge ${fullbit} ]; then n=${fullbit}; fi\n      echo \"obase=16;2^${n}-1\"| bc > ${q}/rps_cpus\n      echo 4096 > ${q}/rps_flow_cnt\n    done\n  done\n\n  echo 32768 > /proc/sys/net/core/rps_sock_flow_entries\n  echo\n}\n\nstop(){\n  echo\n}\n\ncase $action in\nstart)\n  start\n  ;;\nstop)\n  stop\n  ;;\n*)\n  echo >&2 \"Usage: $0 <start|stop>\"\n  exit 1\n  ;;\nesac\nexit 0```\n\n\nbc\u3092\u4f7f\u3044\u307e\u3059\u306e\u3067\u3001yum/apt\u306a\u3069\u3067\u5c0e\u5165\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nCPU\u30b3\u30a2\u6570\u306f\u81ea\u52d5\u7684\u306b\u5224\u5b9a\u3057\u3001\u9069\u5207(\u5168\u3066\u306e\u30b3\u30a2\u3078\u5206\u6563\u3059\u308b)\u306a\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\n\n```shell-session:/etc/init.d/rpsxps\n#!/bin/sh\n\n# chkconfig: - 85 15\n\n### BEGIN INIT INFO\n# Provides:          rpsxps\n# Required-Start:    $local_fs $remote_fs $network $syslog\n# Required-Stop:     $local_fs $remote_fs $network $syslog\n# Default-Start:     2 3 4 5\n# Default-Stop:      0 1 6\n# Short-Description: rpsxps \n# Description:       rpsxps\n### END INIT INFO\n\n# Source function library.\n. /etc/rc.d/init.d/functions\n\n### Environment variables\naction=\"$1\"\nprog=$(basename $0)\nfullbit=32\n\n# Feel free to change any of the following variables for your app:\nstart(){\n  echo -n $\"Starting $prog: \"\n  for if in `ls /sys/class/net| grep -v lo`; do\n    I=0\n    for q in `ls /sys/class/net/${if}/queues/tx-*/xps_cpus`;do\n      echo 2^${I}|bc > ${q}\n      I=$(( ${I}+1 ))\n    done\n    for q in `ls -dF /sys/class/net/${if}/queues/rx-*`;do\n      n=$(cat /proc/cpuinfo | grep ^processor|wc -l)\n      if [ ${n} -ge ${fullbit} ]; then n=${fullbit}; fi\n      echo \"obase=16;2^${n}-1\"| bc > ${q}/rps_cpus\n      echo 4096 > ${q}/rps_flow_cnt\n    done\n  done\n\n  echo 32768 > /proc/sys/net/core/rps_sock_flow_entries\n  echo\n}\n\nstop(){\n  echo\n}\n\ncase $action in\nstart)\n  start\n  ;;\nstop)\n  stop\n  ;;\n*)\n  echo >&2 \"Usage: $0 <start|stop>\"\n  exit 1\n  ;;\nesac\nexit 0```\n", "tags": ["Network", "Linux"]}