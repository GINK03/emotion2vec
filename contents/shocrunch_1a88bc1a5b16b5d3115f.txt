{"context": " More than 1 year has passed since last update.\u4eca\u65e5\u306f Chapter 5. The chain funtion \u306b\u3064\u3044\u3066\u3067\u3059\u3002\n\u203b Day13 \u306e\u74b0\u5883\u3092\u524d\u63d0\u306b\u3053\u308c\u304b\u3089\u304a\u8a71\u3057\u3059\u308b\u306e\u3067\u3001\u307e\u3060Day13\u3092\u898b\u3066\u306a\u3044\u4eba\u306f\u3001\u307e\u305a\u306f\u305d\u3061\u3089\u3067\u74b0\u5883\u69cb\u7bc9\u3092\uff01\n\n\u3084\u308a\u305f\u3044\u3053\u3068\u3092\u66f8\u304f _chain()\nChapter 5 \u306b\u3082\u66f8\u3044\u3066\u3044\u308b\u3088\u3046\u306b  _chain() \u306f\u300c\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3084\u308a\u305f\u3044\u3053\u3068\u300d\u3092\u5b9f\u88c5\u3059\u308b\u5834\u6240\u3067\u3059\u3002\u300c\u30d7\u30e9\u30b0\u30a4\u30f3\u4f5c\u308a\u305f\u3044\u306a\u30fc\u300d\u3068\u601d\u3063\u3066\u307e\u305a\u5f04\u3063\u3066\u3044\u304f\u306e\u306f\u3053\u3053\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30d0\u30b1\u30c4\u30ea\u30ec\u30fc\u306a GStreamer \u306e\u51e6\u7406\nElement \u306f\u597d\u304d\u306a\u51e6\u7406\u3092\u3057\u305f\u5f8cpad_push()\u3059\u308b\u306e\u304c\u3001 GStreamer \u306e\u30eb\u30fc\u30eb\u3067\u3059\u3002\n\n\u4e0a\u6d41\u306e Element \u304c pad_push()\u3059\u308b\u3068\u3001_chain() \u306e\u7b2c3\u5f15\u6570\u306b GstBuffer \u304c\u5165\u3063\u3066\u304d\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u306a\u3093\u3089\u304b\u306e\u300c\u3084\u308a\u305f\u3044\u3053\u3068\u300d\u3092\u51e6\u7406\u3057\u305f\u3042\u3068\u3001GstBuffer \u3092 pad_push() \u3057\u307e\u3059\u3002\n\npad_push()\u3055\u308c\u308b\u3068\u4e0b\u6d41\u306e_chain()\u304c\u5b9f\u884c\u3055\u308c\u3001\u30d0\u30b1\u30c4\u30ea\u30ec\u30fc\u306e\u8981\u9818\u3067_chain()\u304c\u6b21\u3005\u3068\u5b9f\u884c\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002(\u307e\u3055\u306b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u3059\uff01)\n\n\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5\u306f?\n\u3053\u306e\u52d5\u304d\u306f gstpad.c\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u4e0b\u6d41\u306eElement\u306e_chain()\u3092\u547c\u3076\u306e\u306f gstpad.c \u306e\u3053\u306e\u884c\u306a\u306e\u3067\u3001\u3053\u3053\u304b\u3089\u3069\u3093\u3069\u3093\u9061\u3063\u3066\u3044\u304f\u3068gst_pad_push()\u306b\u5de1\u308a\u3042\u3048\u307e\u3059 :)\n\n_chain \u3092\u7de8\u96c6\u3057\u3066\u307f\u3088\u3046\n\u3055\u3066\u3001pad_push() \u2192 _chain() \u306e\u6982\u5ff5\u3092\u77e5\u3063\u305f\u3068\u3053\u308d\u3067 Boilerplate \u306e\u30b3\u30fc\u30c9\u306b\u624b\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u203b GstBuffer \u306b\u3064\u3044\u3066\u306fyashi \u3055\u3093\u306e Day 12\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u3053\u3067\u306f\u7701\u304d\u307e\u3059\u3002\n\u3053\u3053\u304b\u3089\u3001\u3053\u3053\u307e\u3067 \u3092 _chain()\u306b\u8ffd\u52a0\u3057\u305f\u3089\u3055\u3063\u305d\u304f\u30d3\u30eb\u30c9\u3057\u307e\u3057\u3087\u3046\u3002\n\ngstplugin.c\n/* chain function\n * this function does the actual processing\n */\nstatic GstFlowReturn\ngst_plugin_template_chain(GstPad * pad, GstObject * parent, GstBuffer * buf)\n{\n    GstPluginTemplate *filter;\n\n    filter = GST_PLUGIN_TEMPLATE(parent);\n\n    if (filter->silent == FALSE)\n        g_print(\"I'm plugged, therefore I'm in.\\n\");\n\n    // \u3053\u3053\u304b\u3089\n    {\n        GstMapInfo info;\n\n        gst_buffer_map(buf, &info, GST_MAP_READ);\n        g_print(\"%s\", info.data);\n        gst_buffer_unmap(buf, &info);\n    }\n    // \u3053\u3053\u307e\u3067\n\n    /* just push out the incoming buffer without touching it */\n    return gst_pad_push(filter->srcpad, buf);\n}\n\n\n\u65e9\u304f\u52d5\u304b\u3057\u305f\u3044\u6c17\u6301\u3061\u306f\u3050\u3063\u3068\u3053\u3089\u3048\u3064\u3064\u3001\u30e1\u30e2\u5e33\u3084 echo \u30b3\u30de\u30f3\u30c9\u306a\u3069\u3067\u3001input\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n$ echo \"hoge\" > input\n\n\u3055\u3042\u3001\u3084\u3063\u3068\u5b9f\u884c\u3067\u3059\uff01\n$ GST_PLUGIN_PATH=`pwd` gst-launch-1.0.exe filesrc location=input ! plugin silent=true ! fakesink\nSetting pipeline to PAUSED ...\nPipeline is PREROLLING ...\nhoge\nPipeline is PREROLLED ...\nSetting pipeline to PLAYING ...\nNew clock: GstSystemClock\nGot EOS from element \"pipeline0\".\nExecution ended after 0:00:00.000122404\nSetting pipeline to PAUSED ...\nSetting pipeline to READY ...\nSetting pipeline to NULL ...\nFreeing pipeline ...\n\nfilesrc \u304b\u3089 input \u3092\u8aad\u307f\u8fbc\u307f\u3001plugin \u304c\u305d\u308c\u3092\u30cf\u30f3\u30c9\u30eb\u3057\u3066\u3001hoge \u3068\u8868\u793a\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u306d\uff01\nplugin \u306e\u958b\u767a\u3068\u3044\u3046\u3068\u6577\u5c45\u304c\u9ad8\u3044\u611f\u3058\u304c\u3057\u307e\u3059\u304c\u3001\u7c21\u5358\u306a\u3082\u306e\u306f\u305f\u3063\u305f\u3053\u308c\u3060\u3051\u3067\u4f5c\u308c\u308b\u306e\u3067\u3059\u3002\u305c\u3072\u904a\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044 :)\n\n\u4eca\u65e5\u306f [Chapter 5. The chain funtion](http://gstreamer.freedesktop.org/data/doc/gstreamer/head/pwg/html/chapter-building-chainfn.html) \u306b\u3064\u3044\u3066\u3067\u3059\u3002\n\n\u203b [Day13](http://qiita.com/shocrunch/items/e1eff815f363c35f426e) \u306e\u74b0\u5883\u3092\u524d\u63d0\u306b\u3053\u308c\u304b\u3089\u304a\u8a71\u3057\u3059\u308b\u306e\u3067\u3001\u307e\u3060Day13\u3092\u898b\u3066\u306a\u3044\u4eba\u306f\u3001\u307e\u305a\u306f\u305d\u3061\u3089\u3067\u74b0\u5883\u69cb\u7bc9\u3092\uff01\n\n### \u3084\u308a\u305f\u3044\u3053\u3068\u3092\u66f8\u304f _chain()\n\nChapter 5 \u306b\u3082\u66f8\u3044\u3066\u3044\u308b\u3088\u3046\u306b  `_chain()` \u306f\u300c\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3084\u308a\u305f\u3044\u3053\u3068\u300d\u3092\u5b9f\u88c5\u3059\u308b\u5834\u6240\u3067\u3059\u3002\u300c\u30d7\u30e9\u30b0\u30a4\u30f3\u4f5c\u308a\u305f\u3044\u306a\u30fc\u300d\u3068\u601d\u3063\u3066\u307e\u305a\u5f04\u3063\u3066\u3044\u304f\u306e\u306f\u3053\u3053\u3068\u3044\u3046\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n### \u30d0\u30b1\u30c4\u30ea\u30ec\u30fc\u306a GStreamer \u306e\u51e6\u7406\n\nElement \u306f\u597d\u304d\u306a\u51e6\u7406\u3092\u3057\u305f\u5f8c`pad_push()`\u3059\u308b\u306e\u304c\u3001 GStreamer \u306e\u30eb\u30fc\u30eb\u3067\u3059\u3002\n\n![gst.png](https://qiita-image-store.s3.amazonaws.com/0/97187/60f5b639-e7d2-5387-642c-a5a2463f62da.png)\n\n\u4e0a\u6d41\u306e Element \u304c `pad_push()`\u3059\u308b\u3068\u3001`_chain()` \u306e\u7b2c3\u5f15\u6570\u306b `GstBuffer` \u304c\u5165\u3063\u3066\u304d\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u306a\u3093\u3089\u304b\u306e\u300c\u3084\u308a\u305f\u3044\u3053\u3068\u300d\u3092\u51e6\u7406\u3057\u305f\u3042\u3068\u3001`GstBuffer` \u3092 `pad_push()` \u3057\u307e\u3059\u3002\n\n![gst2.png](https://qiita-image-store.s3.amazonaws.com/0/97187/ca266194-fe9f-4424-77c8-e95748239fef.png)\n\n`pad_push()`\u3055\u308c\u308b\u3068\u4e0b\u6d41\u306e`_chain()`\u304c\u5b9f\u884c\u3055\u308c\u3001\u30d0\u30b1\u30c4\u30ea\u30ec\u30fc\u306e\u8981\u9818\u3067`_chain()`\u304c\u6b21\u3005\u3068\u5b9f\u884c\u3055\u308c\u3066\u3044\u304d\u307e\u3059\u3002(\u307e\u3055\u306b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u3059\uff01)\n\n### \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5\u306f?\n\n\u3053\u306e\u52d5\u304d\u306f `gstpad.c`\u306b\u66f8\u304b\u308c\u3066\u3044\u307e\u3059\u3002\n\u4e0b\u6d41\u306eElement\u306e`_chain()`\u3092\u547c\u3076\u306e\u306f [gstpad.c \u306e\u3053\u306e\u884c](http://cgit.freedesktop.org/gstreamer/gstreamer/tree/gst/gstpad.c#n4153)\u306a\u306e\u3067\u3001\u3053\u3053\u304b\u3089\u3069\u3093\u3069\u3093\u9061\u3063\u3066\u3044\u304f\u3068`gst_pad_push()`\u306b\u5de1\u308a\u3042\u3048\u307e\u3059 :)\n\n### _chain \u3092\u7de8\u96c6\u3057\u3066\u307f\u3088\u3046\n\n\u3055\u3066\u3001`pad_push()` \u2192 `_chain()` \u306e\u6982\u5ff5\u3092\u77e5\u3063\u305f\u3068\u3053\u308d\u3067 Boilerplate \u306e\u30b3\u30fc\u30c9\u306b\u624b\u3092\u5165\u308c\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u203b GstBuffer \u306b\u3064\u3044\u3066\u306f[yashi \u3055\u3093\u306e Day 12](http://hellolibraryworld.blogspot.jp/2015/12/gstreamer-6-buffer-memory.html)\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3053\u3053\u3067\u306f\u7701\u304d\u307e\u3059\u3002\n\n*\u3053\u3053\u304b\u3089*\u3001*\u3053\u3053\u307e\u3067* \u3092 `_chain()`\u306b\u8ffd\u52a0\u3057\u305f\u3089\u3055\u3063\u305d\u304f\u30d3\u30eb\u30c9\u3057\u307e\u3057\u3087\u3046\u3002\n\n```c:gstplugin.c\n/* chain function\n * this function does the actual processing\n */\nstatic GstFlowReturn\ngst_plugin_template_chain(GstPad * pad, GstObject * parent, GstBuffer * buf)\n{\n\tGstPluginTemplate *filter;\n\n\tfilter = GST_PLUGIN_TEMPLATE(parent);\n\n\tif (filter->silent == FALSE)\n\t\tg_print(\"I'm plugged, therefore I'm in.\\n\");\n\n\t// \u3053\u3053\u304b\u3089\n\t{\n\t\tGstMapInfo info;\n\n\t\tgst_buffer_map(buf, &info, GST_MAP_READ);\n\t\tg_print(\"%s\", info.data);\n\t\tgst_buffer_unmap(buf, &info);\n\t}\n\t// \u3053\u3053\u307e\u3067\n\n\t/* just push out the incoming buffer without touching it */\n\treturn gst_pad_push(filter->srcpad, buf);\n}\n```\n\n\u65e9\u304f\u52d5\u304b\u3057\u305f\u3044\u6c17\u6301\u3061\u306f\u3050\u3063\u3068\u3053\u3089\u3048\u3064\u3064\u3001\u30e1\u30e2\u5e33\u3084 echo \u30b3\u30de\u30f3\u30c9\u306a\u3069\u3067\u3001`input`\u3068\u3044\u3046\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u307e\u3057\u3087\u3046\u3002\n\n```shell-session\n$ echo \"hoge\" > input\n```\n\n\u3055\u3042\u3001\u3084\u3063\u3068\u5b9f\u884c\u3067\u3059\uff01\n\n```shell-session\n$ GST_PLUGIN_PATH=`pwd` gst-launch-1.0.exe filesrc location=input ! plugin silent=true ! fakesink\nSetting pipeline to PAUSED ...\nPipeline is PREROLLING ...\nhoge\nPipeline is PREROLLED ...\nSetting pipeline to PLAYING ...\nNew clock: GstSystemClock\nGot EOS from element \"pipeline0\".\nExecution ended after 0:00:00.000122404\nSetting pipeline to PAUSED ...\nSetting pipeline to READY ...\nSetting pipeline to NULL ...\nFreeing pipeline ...\n```\n\nfilesrc \u304b\u3089 input \u3092\u8aad\u307f\u8fbc\u307f\u3001plugin \u304c\u305d\u308c\u3092\u30cf\u30f3\u30c9\u30eb\u3057\u3066\u3001`hoge` \u3068\u8868\u793a\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u306d\uff01\n\nplugin \u306e\u958b\u767a\u3068\u3044\u3046\u3068\u6577\u5c45\u304c\u9ad8\u3044\u611f\u3058\u304c\u3057\u307e\u3059\u304c\u3001\u7c21\u5358\u306a\u3082\u306e\u306f\u305f\u3063\u305f\u3053\u308c\u3060\u3051\u3067\u4f5c\u308c\u308b\u306e\u3067\u3059\u3002\u305c\u3072\u904a\u3093\u3067\u307f\u3066\u304f\u3060\u3055\u3044 :)\n", "tags": ["gstreamer", "Linux", "Windows"]}