{"context": " More than 1 year has passed since last update.\n\n\u30d5\u30a3\u30eb\u30bf\n\u539f\u6587\uff1ahttps://docs.docker.com/swarm/scheduler/filter/\nDocker Swam \u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u8907\u6570\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\u30ce\u30fc\u30c9\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\uff08\u4e00\u90e8\uff09\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u3068\u304d\u3001\u6b21\u306e\u30d5\u30a3\u30eb\u30bf\u304c\u5229\u7528\u3067\u304d\u307e\u3059\uff1a\n\nConstraint\uff08\u5f37\u5236\uff09\nAffinity\uff08\u89aa\u5bc6\u3055\uff09\nPort\uff08\u30dd\u30fc\u30c8\uff09\nDependency\uff08\u4f9d\u5b58\u6027\uff09\nHealth\uff08\u30d8\u30eb\u30b9\uff09\n\n\u4f55\u3089\u304b\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u3044\u305f\u3044\u3068\u304d\u306f swam manage \u306e --filter \u30d5\u30e9\u30b0\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nConstraint \u30d5\u30a3\u30eb\u30bf\nConstraint \u306f\u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u3092\u7d50\u3073\u4ed8\u3051\u307e\u3059\u3002\u3053\u308c\u3089\u306f node \u30bf\u30b0\u3067\u898b\u3089\u308c\u307e\u3059\u3002\n\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u6642\u3001\u30ce\u30fc\u30c9\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306e\u305f\u3081\u306b\u3001\u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u3001\u3042\u308b\u3044\u306f\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u3067\u4e00\u81f4\u3059\u3079\u304d\u3068\u8003\u3048\u3089\u308c\u308b\u30ce\u30fc\u30c9\u3067\u3059\u3002\n\u3053\u306e\u624b\u6cd5\u306f\u3044\u304f\u3064\u304b\u306e\u7279\u5b9a\u306e\u4f7f\u3044\u65b9\u304c\u3042\u308a\u307e\u3059\uff1a\n\n\u30db\u30b9\u30c8\u30fb\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6307\u5b9a\u3057\u305f\u9078\u629e\uff08storage=ssd \u306e\u3088\u3046\u306b\u3001\u7279\u5b9a\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u305f\u3081\uff09\n\u7269\u7406\u7684\u306a\u5834\u6240\u3092\u30ce\u30fc\u30c9\u306e\u571f\u53f0\u3068\u30bf\u30b0\u4ed8\u3051\u3059\u308b\uff08region=us-ease \u306e\u3088\u3046\u306b\u3001\u6307\u5b9a\u3057\u305f\u5834\u6240\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u5f37\u5236\u7684\u306b\u5b9f\u884c\uff09\n\u8ad6\u7406\u7684\u306a\u30af\u30e9\u30b9\u30bf\u306e\u5206\u5272\uff08environment=production \u306e\u3088\u3046\u306b\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u9055\u3044\u306b\u3088\u308a\u30af\u30e9\u30b9\u30bf\u3092\u30b5\u30d6\u30af\u30e9\u30b9\u306b\u5206\u5272\uff09\n\n\u7279\u5b9a\u306e\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u30ce\u30fc\u30c9\u3092\u30bf\u30b0\u4ed8\u3051\u3059\u308b\u306b\u306f\u3001docker \u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u5c11\u306a\u304f\u3068\u3082\uff11\u3064\u306e --label \u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u4f8b\u3048\u3070\u3001node-1 \u3092\u8d77\u52d5\u3059\u308b\u3068\u304d storage=ssd \u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u307f\u307e\u3057\u3087\u3046\uff1a\n$ docker -d --label storage=ssd\n$ swarm join --advertise=192.168.0.42:2375 token://XXXXXXXXXXXXXXXXXX\n\n\u3082\u3046\u4e00\u5ea6\u3001\u305f\u3060\u3057\u6b21\u306f node-2 \u3092 storage=disk \u3067\u8d77\u52d5\u3057\u307e\u3059\uff1a\n$ docker -d --label storage=disk\n$ swarm join --advertise=192.168.0.43:2375 token://XXXXXXXXXXXXXXXXXX\n\n\u30ce\u30fc\u30c9\u304c\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u308b\u3068\u3001\u30de\u30b9\u30bf\u306f\u5404\u3005\u306e\u30bf\u30b0\u3092\u53d6\u5f97\u3057\u3001\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3068\u304d\u306b\u305d\u308c\u3089\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\u305d\u308c\u3067\u306f MySQL \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u826f\u3044 I/O \u6027\u80fd\u3092\u6301\u3064\u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u4e0a\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff1a\n$ docker run -d -P -e constraint:storage==ssd --name db mysql\nf8b693db9cd6\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\nf8b693db9cd6        mysql:latest        \"mysqld\"            Less than a second ago   running             192.168.0.42:49178->3306/tcp    node-1      db\n\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u30de\u30b9\u30bf\u306f\u9078\u629e\u3055\u308c\u305f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304b\u3089\u3001\u4e8b\u524d\u306b\u6307\u5b9a\u3055\u308c\u305f storage=ssd \u3092\u5f37\u5236\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u9069\u7528\u3057\u307e\u3059\u3002node-1 \u306f \u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u30db\u30b9\u30c8\u3092\u9078\u3070\u308c\u3066\u3044\u307e\u3059\u3002\n\u6b21\u306f\u30af\u30e9\u30b9\u30bf\u4e0a\u306b Nginx \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3092\u8d70\u3089\u305b\u3066\u307f\u307e\u3059\u3002\u3067\u3059\u304c\u3001\u30ed\u30b0\u3092\u30c7\u30a3\u30b9\u30af\u306b\u6ca2\u5c71\u66f8\u304d\u8fbc\u3080\u306e\u3067\u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u3092\u4f7f\u3044\u305f\u304f\u3042\u308a\u307e\u305b\u3093\u3002\n$ docker run -d -P -e constraint:storage==disk --name frontend nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n963841b138d8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.43:49177->80/tcp      node-2      frontend\nf8b693db9cd6        mysql:latest        \"mysqld\"            Up About a minute        running             192.168.0.42:49178->3306/tcp    node-1      db\n\n\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f storage=disk \u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u8d77\u52d5\u305a\u307f\u306e node-2 \u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\nConstraints \u306e\u6a19\u6e96\n\u52a0\u3048\u3066\u3001\u30ce\u30fc\u30c9\u3092\u958b\u59cb\u3059\u308b\u3068\u304d\u306b\u7279\u306b\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u4f7f\u3046\u6a19\u6e96 constraint \u30bb\u30c3\u30c8\u3092\u4f7f\u3048\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30bf\u30b0\u306f docker info \u3067\u78ba\u8a8d\u3067\u304d\u3001\u73fe\u5728\u5229\u7528\u3067\u304d\u308b\u306e\u306f\uff1a\n\n\u30ce\u30fc\u30c9 ID \u307e\u305f\u306f\u30ce\u30fc\u30c9\u540d\uff08\"node\" \u3092\u30ad\u30fc\u306b\u7528\u3044\u308b\uff09\nstoragedriver\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u30fb\u30c9\u30e9\u30a4\u30d0\uff09\nexecutiondriver\uff08\u5b9f\u884c\u30c9\u30e9\u30a4\u30d0\uff09\nkernelversion\uff08\u30ab\u30fc\u30cd\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\noperatingsystem\uff08\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30fb\u30b7\u30b9\u30c6\u30e0\uff09\n\n\n\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3 \uff08\u89aa\u5bc6\u3055\uff09\u30d5\u30a3\u30eb\u30bf\n\u30b3\u30f3\u30c6\u30ca\u9593\u3092\"\u5f15\u304d\u5bc4\u305b\u3066\" \u3092\u4f5c\u6210\u3059\u308b\u306e\u306b\u3001--affinity:<\u30d5\u30a3\u30eb\u30bf> \u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u5834\u6240\u3092\u6307\u5b9a\u3057\u3001\u305d\u306e\u96a3\u306b\u6b21\u306e\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8\u3084\u30e9\u30d9\u30eb\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u5f15\u304d\u5bc4\u305b\u6a5f\u80fd\u306b\u3088\u3063\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ce\u30fc\u30c9\u3067\u78ba\u5b9f\u306b\u52d5\u304b\u3057\u307e\u3059\u3002\u305d\u306e\u3068\u304d\u3001\u3069\u3061\u3089\u306e\u30ce\u30fc\u30c9\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u304b\u77e5\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\uff08\u89aa\u5bc6\u3055\uff09\n\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u305f\u3042\u3068\u3001\u96a3\u306b\u4ed6\u306e\u540d\u524d\u3084 ID \u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001frontend \u3068\u3044\u3046\u540d\u524d\u3067 nginx \u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u307e\u3059\uff1a\n$ docker run -d -p 80:80 --name front nginx\n 87c4376856a8\n\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      frontend\n\n\u305d\u308c\u304b\u3089\u3001-e affinity:container==frontend \u30d5\u30e9\u30b0\u3092\u4f7f\u3044\u3001\uff12\u3064\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3092 frontend \u306e\u96a3\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\uff08\u8a08\u753b\uff09\u3057\u307e\u3059\u3002\n$ docker run -d --name logger -e affinity:container==frontend logger\n 87c4376856a8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      frontend\n963841b138d8        logger:latest       \"logger\"            Less than a second ago   running                                             node-1      logge\n\naffinity \u306e\u540d\u524d\u306b\u3088\u3063\u3066\u3001logger \u30b3\u30f3\u30c6\u30ca\u306f frontend \u30b3\u30f3\u30c6\u30ca\u3068\u540c\u3058 node-1 \u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002frontend \u3068\u3044\u3046\u540d\u524d\u3060\u3051\u3067\u306a\u304f\u3001ID \u3092\u4f7f\u3044\u6b21\u306e\u3088\u3046\u306a\u6307\u5b9a\u3082\u3067\u304d\u307e\u3059\uff1a\ndocker run -d --name logger -e affinity:container==87c4376856a8`\n\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\uff08\u89aa\u5bc6\u3055\uff09\n\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6e08\u307f\u306e\u30ce\u30fc\u30c9\u306e\u307f\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n$ docker -H node-1:2375 pull redis\n$ docker -H node-2:2375 pull mysql\n$ docker -H node-3:2375 pull redis\n\nnode-1 \u3068 node-3 \u306f redis \u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002-e affinity:image==redis \u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u3044\u3001\u3053\u308c\u3089\u306e\u30ce\u30fc\u30c9\u4e0a\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ docker run -d --name redis1 -e affinity:image==redis redis\n$ docker run -d --name redis2 -e affinity:image==redis redis\n$ docker run -d --name redis3 -e affinity:image==redis redis\n$ docker run -d --name redis4 -e affinity:image==redis redis\n$ docker run -d --name redis5 -e affinity:image==redis redis\n$ docker run -d --name redis6 -e affinity:image==redis redis\n$ docker run -d --name redis7 -e affinity:image==redis redis\n$ docker run -d --name redis8 -e affinity:image==redis redis\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis1\n1212386856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis2\n87c4376639a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis3\n1234376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis4\n86c2136253a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis5\n87c3236856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis6\n87c4376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis7\n963841b138d8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis8\n\n\u3053\u3053\u3067\u898b\u3048\u308b\u3088\u3046\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u308b\u306e\u306f redis \u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u307f\u3067\u3059\u3002\u30a4\u30e1\u30fc\u30b8\u540d\u306b\u52a0\u3048\u3066\u3001\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8 ID \u3082\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n$ docker images\nREPOSITORY                         TAG                       IMAGE ID            CREATED             VIRTUAL SIZE\nredis                              latest                    06a1f75304ba        2 days ago          111.1 MB\n\n$ docker run -d --name redis1 -e affinity:image==06a1f75304ba redis\n\n\n\u30e9\u30d9\u30eb\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\n\u30e9\u30d9\u30eb\u30fb\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306b\u3088\u3063\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30e9\u30d9\u30eb\u3092\u4f7f\u3063\u3066\u5f15\u304d\u5bc4\u305b\u3066\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001nginx \u30b3\u30f3\u30c6\u30ca\u3092 com.example.type=frontend \u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker run -d -p 80:80 --label com.example.type=frontend nginx\n 87c4376856a8\n$ docker ps  --filter \"label=com.example.type=front\"\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      trusting_yonath\n\n\u305d\u308c\u304b\u3089\u3001-e affinity:com.example.type==frontend \u3092\u4f7f\u3063\u3066\u3001com.example.type==fronten \u30e9\u30d9\u30eb\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u306e\u96a3\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ docker run -d -e affinity:com.example.type==frontend logger\n 87c4376856a8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      trusting_yonath\n963841b138d8        logger:latest       \"logger\"            Less than a second ago   running                                             node-1      happy_hawking\n\nlogger \u30b3\u30f3\u30c6\u30ca\u306f\u3001\u6700\u7d42\u7684\u306b node-1 \u306b\u7f6e\u304b\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306b com.example.type==frontend \u30e9\u30d9\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\n\u6587\u6cd5\u8868\u73fe\n\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3084 constraint\uff08\u5236\u7d04\uff09\u306f\u3001 key \u3068 value \u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u8868\u73fe\u3057\u307e\u3059\u3002key \u306f\u82f1\u6570\u5b57\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u5f93\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u5148\u982d\u306f\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u304b\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3067\u3059\u3002\nvalue \u306f\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\uff1a\n\n\u82f1\u6570\u5b57\u306e\u6587\u5b57\u5217\u3001\u30c9\u30c3\u30c8\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\n\u90e8\u5206\u4e00\u81f4\u3001\u4f8b\u3048\u3070 abc*\n\n\n/regexp/ \u5f62\u5f0f\u306e\u6b63\u898f\u8868\u73fe\n\nGo \u8a00\u8a9e\u306e\u6b63\u898f\u8868\u73fe\u6587\u6cd5\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u73fe\u6642\u70b9\u306e Swarm \u306f\u3001\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fbconstraint \u3067\u6f14\u7b97\u5b50 == \u3068 != \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\n\n\nconstraint:node==node1 \u306f\u3001\u30ce\u30fc\u30c9 node1 \u306b\u30de\u30c3\u30c1\n\nconstraint:node!=node1 \u306f\u3001node1 \u3092\u306e\u305e\u304f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n\nconstraint:region!=us* \u306f\u3001us \u304c\u4ed8\u3044\u3066\u3044\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u5916\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n\nconstraint:node==/node[12]/ \u306f\u3001node1 \u3068 node2 \u306b\u30de\u30c3\u30c1\n\nconstraint:node==/node\\d/ \u306f\u3001node + 10\u9032\u6570\u306e\uff11\u6587\u5b57\u306b\u30de\u30c3\u30c1\n\nconstraint:node!=/node-[01]/ \u306f\u3001node-0 \u3068 node-1 \u4ee5\u5916\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n\nconstraint:node!=/foo\\[bar\\]/ \u306f\u3001foo[var] \u4ee5\u5916\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n\nconstraint:node==/(?i)node1/ \u306f\u3001\u5927\u6587\u5b57\u30fb\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3057\u306a\u3044 node1 \u306b\u30de\u30c3\u30c1\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001NoDe1 \u3084 NODE1 \u3082\u30de\u30c3\u30c1\u3057\u307e\u3059\u3002\n\n\nSoft affinities/constrains (\u30bd\u30d5\u30c8\u306a\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fb\u5236\u7d04)\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3068\u5236\u7d04\u306f\u30cf\u30fc\u30c9\u306b\u5f37\u5236\u3055\u308c\u308b\u3082\u306e\u3067\u3059\u3002\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3084\u5236\u7d04\u304c\u306a\u3051\u308c\u3070\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u307e\u305b\u3093\u3002Soft affinities/constrains \u304c\u3042\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u305f\u3081\u306b\u4e00\u81f4\u3059\u308b\u30eb\u30fc\u30eb\u3092\u63a2\u305d\u3046\u3068\u3057\u307e\u3059\u3002\u3082\u3057\u4e00\u81f4\u3057\u306a\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30d5\u30a3\u30eb\u30bf\u3092\u5ec3\u68c4\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\nSoft affinities/constrains \u306f ~ \u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\uff1a\n$ docker run -d --name redis1 -e affinity:image==~redis redis\n\n\u3082\u3057\u3001\u30af\u30e9\u30b9\u30bf\u306b\u30a4\u30e1\u30fc\u30b8 redis \u3092\u6301\u3064\u30ce\u30fc\u30c9\u304c\u7121\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ docker run -d --name redis2 -e constraint:region==~us* redis\n\n\u3082\u3057\u3001us \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5c5e\u3059\u30ce\u30fc\u30c9\u304c\u30af\u30e9\u30b9\u30bf\u306b\u7121\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u5236\u7d04\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ docker run -d --name redis5 -e affinity:container!=~redis* redis\n\n\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fb\u30d5\u30a3\u30eb\u30bf\u306f\u65b0\u3057\u3044 redis5 \u30b3\u30f3\u30c6\u30ca\u3092\u3001\u6307\u5b9a\u3057\u305f redis*  \u306e\u540d\u524d\u3092\u542b\u3080\u30b3\u30f3\u30c6\u30ca\u304c\u7121\u3044\u30ce\u30fc\u30c9\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\u3082\u3057\u30af\u30e9\u30b9\u30bf\u306e\u5404\u3005\u306e\u30ce\u30fc\u30c9\u304c redis* \u30b3\u30f3\u30c6\u30ca\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306e\u30eb\u30fc\u30eb\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u30dd\u30fc\u30c8\u30d5\u30a3\u30eb\u30bf\n\u3053\u306e ports \u30d5\u30a3\u30eb\u30bf\u306f\u30e6\u30cb\u30fc\u30af\u306a\u30ea\u30bd\u30fc\u30b9\u3060\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n$ docker run -d -p 80:80 nginx\n87c4376856a8\n\n$ docker ps\nCONTAINER ID    IMAGE               COMMAND         PORTS                       NODE        NAMES\n87c4376856a8    nginx:latest        \"nginx\"         192.168.0.42:80->80/tcp     node-1      prickly_engelbart\n\nDocker \u30af\u30e9\u30b9\u30bf\u304b\u3089\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u306e\u30dd\u30fc\u30c8 80 \u304c\u5229\u7528\u53ef\u80fd\u306a\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\u3053\u306e\u4f8b\u3067\u306f node-1 \u304c\u8a72\u5f53\u3057\u307e\u3059\u3002\n\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30d1\u30d6\u30ea\u30c3\u30af\u306e\u30dd\u30fc\u30c8 80 \u3067\u8d77\u52d5\u3057\u3088\u3046\u3068\u3059\u308b\u306a\u3089\u3001\u65e2\u306b node-1 \u306f\u4f7f\u7528\u4e2d\u306e\u305f\u3081\u3001\u5225\u306e\u30ce\u30fc\u30c9\u304c\u9078\u3070\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n$ docker run -d -p 80:80 nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID        IMAGE          COMMAND        PORTS                           NODE        NAMES\n963841b138d8        nginx:latest   \"nginx\"        192.168.0.43:80->80/tcp         node-2      dreamy_turing\n87c4376856a8        nginx:latest   \"nginx\"        192.168.0.42:80->80/tcp         node-1      prickly_engelbart\n\n\u518d\u3073\u540c\u3058\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u30dd\u30fc\u30c8 80 \u304c\u4f7f\u3048\u306a\u3044 node-1 \u3084 node-2 \u3067\u306f\u306a\u3044\u3001node-3 \u304c\u9078\u3070\u308c\u307e\u3059\u3002\n$ docker run -d -p 80:80 nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID   IMAGE               COMMAND        PORTS                           NODE        NAMES\nf8b693db9cd6   nginx:latest        \"nginx\"        192.168.0.44:80->80/tcp         node-3      stoic_albattani\n963841b138d8   nginx:latest        \"nginx\"        192.168.0.43:80->80/tcp         node-2      dreamy_turing\n87c4376856a8   nginx:latest        \"nginx\"        192.168.0.42:80->80/tcp         node-1      prickly_engelbart\n\n\u6700\u7d42\u7684\u306b\u3001\u30af\u30e9\u30b9\u30bf\u4e0a\u3067\u30dd\u30fc\u30c8 80 \u304c\u5229\u7528\u53ef\u80fd\u306a\u30ce\u30fc\u30c9\u304c\u7121\u304f\u306a\u308b\u3068\u3001Docker Swam \u306f\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3092\u62d2\u5426\u3057\u307e\u3059\u3002\n$ docker run -d -p 80:80 nginx\n2014/10/29 00:33:20 Error response from daemon: no resources available to schedule container\n\n\n\u30db\u30b9\u30c8\u30fb\u30e2\u30fc\u30c9\u3067\u306e\u30dd\u30fc\u30c8\u30d5\u30a3\u30eb\u30bf\nDocker \u306b --net=host \u3092\u4f7f\u3063\u305f\u30db\u30b9\u30c8\u30fb\u30e2\u30fc\u30c9\u306e\u5b9f\u884c\u306f\u3001\u30dd\u30fc\u30c8\u306e\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u304c\u3067\u304d\u306a\u3044 host \u30e2\u30fc\u30c9\u306e\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e bridge \u30e2\u30fc\u30c9\u3068\u306f\u7570\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\uff11\u3064\u4ee5\u4e0a\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u660e\u793a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff08 Dockerfile \u3067 EXPOSE \u3092\u4f7f\u3046\u304b\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 --expose \u3092\u4f7f\u3044\u307e\u3059 \uff09\u3002Swarm \u306f\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u5411\u3051\u306e\u30ce\u30fc\u30c9\u3092\u9078\u3076\u3068\u304d\u306b host \u30e2\u30fc\u30c9\u306e\u3053\u306e\u60c5\u5831\u3092\u4f7f\u3044\u307e\u3059\u3002\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f nginx \u3092\uff13\u3064\u306e\u30ce\u30fc\u30c9\u30fb\u30af\u30e9\u30b9\u30bf\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker run -d --expose=80 --net=host nginx\n640297cb29a7\n$ docker run -d --expose=80 --net=host nginx\n7ecf562b1b3f\n$ docker run -d --expose=80 --net=host nginx\n09a92f582bc2\n\n\u30dd\u30fc\u30c8\u30d0\u30a4\u30f3\u30c9\u306e\u60c5\u5831\u306f\u3001docker ps \u30b3\u30de\u30f3\u30c9\u3092\u901a\u3057\u3066\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u306f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304c host \u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS              PORTS               NAMES\n640297cb29a7        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up 30 seconds                           box3/furious_heisenberg\n7ecf562b1b3f        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up 28 seconds                           box2/ecstatic_meitner\n09a92f582bc2        nginx:1             \"nginx -g 'daemon of   46 seconds ago           Up 27 seconds                           box1/mad_goldstine\n\n\uff14\u3064\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u6e96\u5099\u3057\u3088\u3046\u3068\u3057\u3066\u3082\u3001Swarm \u306f\u62d2\u5426\u3059\u308b\u3067\u3057\u3087\u3046\u3002\n$  docker run -d --expose=80 --net=host nginx\nFATA[0000] Error response from daemon: unable to find a node with port 80/tcp available in the Host mode\n\n\u305d\u306e\u304b\u308f\u308a\u306b\u3001\u30dd\u30fc\u30c8 81 \u306e\u3088\u3046\u306a\u3001\u7570\u306a\u3063\u305f\u30dd\u30fc\u30c8\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u3059\u3002\n$  docker run -d -p 81:80 nginx:latest\n832f42819adc\n$  docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS                  PORTS                                 NAMES\n832f42819adc        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up Less than a second   443/tcp, 192.168.136.136:81->80/tcp   box3/thirsty_hawking\n640297cb29a7        nginx:1             \"nginx -g 'daemon of   8 seconds ago            Up About a minute                                             box3/furious_heisenberg\n7ecf562b1b3f        nginx:1             \"nginx -g 'daemon of   13 seconds ago           Up About a minute                                             box2/ecstatic_meitner\n09a92f582bc2        nginx:1             \"nginx -g 'daemon of   About a minute ago       Up About a minute                                             box1/mad_goldstine\n\n\ndependency\uff08\u4f9d\u5b58\uff09\u30d5\u30a3\u30eb\u30bf\n\u3053\u306e\u30d5\u30a3\u30eb\u30bf\u306f\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u4f9d\u5b58\u6027\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\u73fe\u6642\u70b9\u3067\u306f\u3001\u6b21\u306e\u4f9d\u5b58\u6027\u3092\u5ba3\u8a00\u3067\u304d\u307e\u3059\uff1a\n\n\u30dc\u30ea\u30e5\u30fc\u30e0\u5171\u6709\uff1a--volumes-from=dependency\n\n\u30ea\u30f3\u30af\uff1a --link=dependency:alias\n\n\u5171\u6709\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5c64\uff1a--net=container:dependency\n\n\nSwarm \u306f\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u3067\u4f9d\u5b58\u6027\u306e\u3042\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u8a2d\u7f6e\u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u3082\u3057\u5b9f\u884c\u3067\u304d\u306a\u305d\u3046\u3067\u3042\u308c\u3070\uff08\u4f9d\u5b58\u6027\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u308a\u3001\u30ce\u30fc\u30c9\u306b\u5341\u5206\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u7121\u3044\u5834\u5408\uff09\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u3002\n\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u8907\u6570\u306e\u4f9d\u5b58\u6027\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001--volumes-from=A --net=container:B \u306f\u3001A \u3068 B \u3068\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7f6e\u3053\u3046\u3068\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5225\u3005\u306e\u30ce\u30fc\u30c9\u3067\u52d5\u3044\u3066\u3044\u308b\u306a\u3089\u3001Swarm \u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u307e\u305b\u3093\u3002\n\n\u30d8\u30eb\u30b9\u30fb\u30d5\u30a3\u30eb\u30bf\n\u969c\u5bb3\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u30d5\u30a3\u30eb\u30bf\u3057\u307e\u3059\u3002\n# \u30d5\u30a3\u30eb\u30bf\n\u539f\u6587\uff1ahttps://docs.docker.com/swarm/scheduler/filter/\n\n`Docker Swam` \u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u8907\u6570\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u30ce\u30fc\u30c9\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\uff08\u4e00\u90e8\uff09\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u3068\u304d\u3001\u6b21\u306e\u30d5\u30a3\u30eb\u30bf\u304c\u5229\u7528\u3067\u304d\u307e\u3059\uff1a\n\n* Constraint\uff08\u5f37\u5236\uff09\n* Affinity\uff08\u89aa\u5bc6\u3055\uff09\n* Port\uff08\u30dd\u30fc\u30c8\uff09\n* Dependency\uff08\u4f9d\u5b58\u6027\uff09\n* Health\uff08\u30d8\u30eb\u30b9\uff09\n\n\u4f55\u3089\u304b\u306e\u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u3044\u305f\u3044\u3068\u304d\u306f `swam manage` \u306e `--filter` \u30d5\u30e9\u30b0\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n## Constraint \u30d5\u30a3\u30eb\u30bf\n\nConstraint \u306f\u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u306b\u5bfe\u3057\u3066\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u3092\u7d50\u3073\u4ed8\u3051\u307e\u3059\u3002\u3053\u308c\u3089\u306f ***node*** \u30bf\u30b0\u3067\u898b\u3089\u308c\u307e\u3059\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u306e\u4f5c\u6210\u6642\u3001\u30ce\u30fc\u30c9\u306e\u30b5\u30d6\u30bb\u30c3\u30c8\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306e\u305f\u3081\u306b\u3001\u7279\u5b9a\u306e\u30ce\u30fc\u30c9\u3001\u3042\u308b\u3044\u306f\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u3067\u4e00\u81f4\u3059\u3079\u304d\u3068\u8003\u3048\u3089\u308c\u308b\u30ce\u30fc\u30c9\u3067\u3059\u3002\n\n\u3053\u306e\u624b\u6cd5\u306f\u3044\u304f\u3064\u304b\u306e\u7279\u5b9a\u306e\u4f7f\u3044\u65b9\u304c\u3042\u308a\u307e\u3059\uff1a\n\n* \u30db\u30b9\u30c8\u30fb\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6307\u5b9a\u3057\u305f\u9078\u629e\uff08`storage=ssd` \u306e\u3088\u3046\u306b\u3001\u7279\u5b9a\u306e\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u305f\u3081\uff09\n* \u7269\u7406\u7684\u306a\u5834\u6240\u3092\u30ce\u30fc\u30c9\u306e\u571f\u53f0\u3068\u30bf\u30b0\u4ed8\u3051\u3059\u308b\uff08`region=us-ease` \u306e\u3088\u3046\u306b\u3001\u6307\u5b9a\u3057\u305f\u5834\u6240\u3067\u30b3\u30f3\u30c6\u30ca\u3092\u5f37\u5236\u7684\u306b\u5b9f\u884c\uff09\n* \u8ad6\u7406\u7684\u306a\u30af\u30e9\u30b9\u30bf\u306e\u5206\u5272\uff08`environment=production` \u306e\u3088\u3046\u306b\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u9055\u3044\u306b\u3088\u308a\u30af\u30e9\u30b9\u30bf\u3092\u30b5\u30d6\u30af\u30e9\u30b9\u306b\u5206\u5272\uff09\n\n\u7279\u5b9a\u306e\u30ad\u30fc\u30fb\u30d0\u30ea\u30e5\u30fc\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u30ce\u30fc\u30c9\u3092\u30bf\u30b0\u4ed8\u3051\u3059\u308b\u306b\u306f\u3001docker \u8d77\u52d5\u6642\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3001\u5c11\u306a\u304f\u3068\u3082\uff11\u3064\u306e `--label` \u6307\u5b9a\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001`node-1` \u3092\u8d77\u52d5\u3059\u308b\u3068\u304d `storage=ssd` \u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u307f\u307e\u3057\u3087\u3046\uff1a\n\n```\n$ docker -d --label storage=ssd\n$ swarm join --advertise=192.168.0.42:2375 token://XXXXXXXXXXXXXXXXXX\n```\n\n\u3082\u3046\u4e00\u5ea6\u3001\u305f\u3060\u3057\u6b21\u306f `node-2` \u3092 `storage=disk` \u3067\u8d77\u52d5\u3057\u307e\u3059\uff1a\n\n```\n$ docker -d --label storage=disk\n$ swarm join --advertise=192.168.0.43:2375 token://XXXXXXXXXXXXXXXXXX\n```\n\n\u30ce\u30fc\u30c9\u304c\u30af\u30e9\u30b9\u30bf\u306b\u767b\u9332\u3055\u308c\u308b\u3068\u3001\u30de\u30b9\u30bf\u306f\u5404\u3005\u306e\u30bf\u30b0\u3092\u53d6\u5f97\u3057\u3001\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3059\u308b\u3068\u304d\u306b\u305d\u308c\u3089\u3092\u53cd\u6620\u3057\u307e\u3059\u3002\n\n\u305d\u308c\u3067\u306f MySQL \u30b5\u30fc\u30d0\u3092\u8d77\u52d5\u3057\u3001\u826f\u3044 I/O \u6027\u80fd\u3092\u6301\u3064\u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u4e0a\u3067\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u3087\u3046\uff1a\n\n```\n$ docker run -d -P -e constraint:storage==ssd --name db mysql\nf8b693db9cd6\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\nf8b693db9cd6        mysql:latest        \"mysqld\"            Less than a second ago   running             192.168.0.42:49178->3306/tcp    node-1      db\n```\n\n\u3053\u306e\u4f8b\u3067\u306f\u3001\u30de\u30b9\u30bf\u306f\u9078\u629e\u3055\u308c\u305f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304b\u3089\u3001\u4e8b\u524d\u306b\u6307\u5b9a\u3055\u308c\u305f `storage=ssd` \u3092\u5f37\u5236\u3057\u305f\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u9069\u7528\u3057\u307e\u3059\u3002`node-1` \u306f \u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u30db\u30b9\u30c8\u3092\u9078\u3070\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u6b21\u306f\u30af\u30e9\u30b9\u30bf\u4e0a\u306b Nginx \u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3092\u8d70\u3089\u305b\u3066\u307f\u307e\u3059\u3002\u3067\u3059\u304c\u3001\u30ed\u30b0\u3092\u30c7\u30a3\u30b9\u30af\u306b\u6ca2\u5c71\u66f8\u304d\u8fbc\u3080\u306e\u3067\u30d5\u30e9\u30c3\u30b7\u30e5\u30fb\u30c9\u30e9\u30a4\u30d6\u3092\u4f7f\u3044\u305f\u304f\u3042\u308a\u307e\u305b\u3093\u3002\n\n```\n$ docker run -d -P -e constraint:storage==disk --name frontend nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n963841b138d8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.43:49177->80/tcp      node-2      frontend\nf8b693db9cd6        mysql:latest        \"mysqld\"            Up About a minute        running             192.168.0.42:49178->3306/tcp    node-1      db\n```\n\n\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f `storage=disk` \u30e9\u30d9\u30eb\u3092\u4ed8\u3051\u3066\u8d77\u52d5\u305a\u307f\u306e `node-2` \u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n## Constraints \u306e\u6a19\u6e96\n\n\u52a0\u3048\u3066\u3001\u30ce\u30fc\u30c9\u3092\u958b\u59cb\u3059\u308b\u3068\u304d\u306b\u7279\u306b\u6307\u5b9a\u3057\u306a\u304f\u3066\u3082\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306b\u4f7f\u3046\u6a19\u6e96 constraint \u30bb\u30c3\u30c8\u3092\u4f7f\u3048\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30bf\u30b0\u306f `docker info` \u3067\u78ba\u8a8d\u3067\u304d\u3001\u73fe\u5728\u5229\u7528\u3067\u304d\u308b\u306e\u306f\uff1a\n\n* \u30ce\u30fc\u30c9 ID \u307e\u305f\u306f\u30ce\u30fc\u30c9\u540d\uff08\"node\" \u3092\u30ad\u30fc\u306b\u7528\u3044\u308b\uff09\n* storagedriver\uff08\u30b9\u30c8\u30ec\u30fc\u30b8\u30fb\u30c9\u30e9\u30a4\u30d0\uff09\n* executiondriver\uff08\u5b9f\u884c\u30c9\u30e9\u30a4\u30d0\uff09\n* kernelversion\uff08\u30ab\u30fc\u30cd\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\n* operatingsystem\uff08\u30aa\u30da\u30ec\u30fc\u30c6\u30a3\u30f3\u30b0\u30fb\u30b7\u30b9\u30c6\u30e0\uff09\n\n## \u30a2\u30d5\u30a3\u30cb\u30c6\u30a3 \uff08\u89aa\u5bc6\u3055\uff09\u30d5\u30a3\u30eb\u30bf\n\n\u30b3\u30f3\u30c6\u30ca\u9593\u3092\"\u5f15\u304d\u5bc4\u305b\u3066\" \u3092\u4f5c\u6210\u3059\u308b\u306e\u306b\u3001`--affinity:<\u30d5\u30a3\u30eb\u30bf>` \u3092\u4f7f\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306e\u5834\u6240\u3092\u6307\u5b9a\u3057\u3001\u305d\u306e\u96a3\u306b\u6b21\u306e\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8\u3084\u30e9\u30d9\u30eb\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u3092\u914d\u7f6e\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u5f15\u304d\u5bc4\u305b\u6a5f\u80fd\u306b\u3088\u3063\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u540c\u3058\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30ce\u30fc\u30c9\u3067\u78ba\u5b9f\u306b\u52d5\u304b\u3057\u307e\u3059\u3002\u305d\u306e\u3068\u304d\u3001\u3069\u3061\u3089\u306e\u30ce\u30fc\u30c9\u3067\u5b9f\u884c\u3057\u3066\u3044\u308b\u304b\u77e5\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n### \u30b3\u30f3\u30c6\u30ca\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\uff08\u89aa\u5bc6\u3055\uff09\n\n\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u305f\u3042\u3068\u3001\u96a3\u306b\u4ed6\u306e\u540d\u524d\u3084 ID \u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001`frontend` \u3068\u3044\u3046\u540d\u524d\u3067 `nginx` \u30b3\u30f3\u30c6\u30ca\u3092\u5b9f\u884c\u3057\u307e\u3059\uff1a\n\n```\n$ docker run -d -p 80:80 --name front nginx\n 87c4376856a8\n\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      frontend\n```\n\n\u305d\u308c\u304b\u3089\u3001`-e affinity:container==frontend` \u30d5\u30e9\u30b0\u3092\u4f7f\u3044\u3001\uff12\u3064\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3092 `frontend` \u306e\u96a3\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\uff08\u8a08\u753b\uff09\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d --name logger -e affinity:container==frontend logger\n 87c4376856a8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      frontend\n963841b138d8        logger:latest       \"logger\"            Less than a second ago   running                                             node-1      logge\n```\n\naffinity \u306e\u540d\u524d\u306b\u3088\u3063\u3066\u3001`logger` \u30b3\u30f3\u30c6\u30ca\u306f `frontend` \u30b3\u30f3\u30c6\u30ca\u3068\u540c\u3058 `node-1` \u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002`frontend` \u3068\u3044\u3046\u540d\u524d\u3060\u3051\u3067\u306a\u304f\u3001ID \u3092\u4f7f\u3044\u6b21\u306e\u3088\u3046\u306a\u6307\u5b9a\u3082\u3067\u304d\u307e\u3059\uff1a\n\n```\ndocker run -d --name logger -e affinity:container==87c4376856a8`\n```\n\n### \u30a4\u30e1\u30fc\u30b8\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\uff08\u89aa\u5bc6\u3055\uff09\n\n\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u3001\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u6e08\u307f\u306e\u30ce\u30fc\u30c9\u306e\u307f\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n$ docker -H node-1:2375 pull redis\n$ docker -H node-2:2375 pull mysql\n$ docker -H node-3:2375 pull redis\n```\n\n`node-1` \u3068 `node-3` \u306f `redis` \u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002`-e affinity:image==redis` \u30d5\u30a3\u30eb\u30bf\u3092\u4f7f\u3044\u3001\u3053\u308c\u3089\u306e\u30ce\u30fc\u30c9\u4e0a\u3067\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d --name redis1 -e affinity:image==redis redis\n$ docker run -d --name redis2 -e affinity:image==redis redis\n$ docker run -d --name redis3 -e affinity:image==redis redis\n$ docker run -d --name redis4 -e affinity:image==redis redis\n$ docker run -d --name redis5 -e affinity:image==redis redis\n$ docker run -d --name redis6 -e affinity:image==redis redis\n$ docker run -d --name redis7 -e affinity:image==redis redis\n$ docker run -d --name redis8 -e affinity:image==redis redis\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis1\n1212386856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis2\n87c4376639a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis3\n1234376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis4\n86c2136253a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis5\n87c3236856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis6\n87c4376856a8        redis:latest        \"redis\"             Less than a second ago   running                                             node-3      redis7\n963841b138d8        redis:latest        \"redis\"             Less than a second ago   running                                             node-1      redis8\n```\n\n\u3053\u3053\u3067\u898b\u3048\u308b\u3088\u3046\u306b\u3001\u30b3\u30f3\u30c6\u30ca\u304c\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u308b\u306e\u306f `redis` \u30a4\u30e1\u30fc\u30b8\u3092\u6301\u3063\u3066\u3044\u308b\u30ce\u30fc\u30c9\u306e\u307f\u3067\u3059\u3002\u30a4\u30e1\u30fc\u30b8\u540d\u306b\u52a0\u3048\u3066\u3001\u7279\u5b9a\u306e\u30a4\u30e1\u30fc\u30b8 ID \u3082\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n\n```\n$ docker images\nREPOSITORY                         TAG                       IMAGE ID            CREATED             VIRTUAL SIZE\nredis                              latest                    06a1f75304ba        2 days ago          111.1 MB\n\n$ docker run -d --name redis1 -e affinity:image==06a1f75304ba redis\n```\n\n### \u30e9\u30d9\u30eb\u306e\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\n\n\u30e9\u30d9\u30eb\u30fb\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306b\u3088\u3063\u3066\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u30e9\u30d9\u30eb\u3092\u4f7f\u3063\u3066\u5f15\u304d\u5bc4\u305b\u3066\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001`nginx` \u30b3\u30f3\u30c6\u30ca\u3092 `com.example.type=frontend` \u30e9\u30d9\u30eb\u3092\u3064\u3051\u3066\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n$ docker run -d -p 80:80 --label com.example.type=frontend nginx\n 87c4376856a8\n\n```\n$ docker ps  --filter \"label=com.example.type=front\"\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      trusting_yonath\n```\n\n\u305d\u308c\u304b\u3089\u3001`-e affinity:com.example.type==frontend` \u3092\u4f7f\u3063\u3066\u3001`com.example.type==fronten` \u30e9\u30d9\u30eb\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u306e\u96a3\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d -e affinity:com.example.type==frontend logger\n 87c4376856a8\n\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND             CREATED                  STATUS              PORTS                           NODE        NAMES\n87c4376856a8        nginx:latest        \"nginx\"             Less than a second ago   running             192.168.0.42:80->80/tcp         node-1      trusting_yonath\n963841b138d8        logger:latest       \"logger\"            Less than a second ago   running                                             node-1      happy_hawking\n```\n\n`logger` \u30b3\u30f3\u30c6\u30ca\u306f\u3001\u6700\u7d42\u7684\u306b `node-1` \u306b\u7f6e\u304b\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306b `com.example.type==frontend` \u30e9\u30d9\u30eb\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\n### \u6587\u6cd5\u8868\u73fe\n\n\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3084 constraint\uff08\u5236\u7d04\uff09\u306f\u3001 `key` \u3068 `value` \u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u8868\u73fe\u3057\u307e\u3059\u3002`key` \u306f\u82f1\u6570\u5b57\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u5f93\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u5148\u982d\u306f\u30a2\u30eb\u30d5\u30a1\u30d9\u30c3\u30c8\u304b\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\u3067\u3059\u3002\n\n`value` \u306f\u6b21\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3059\uff1a\n\n* \u82f1\u6570\u5b57\u306e\u6587\u5b57\u5217\u3001\u30c9\u30c3\u30c8\u3001\u30cf\u30a4\u30d5\u30f3\u3001\u30a2\u30f3\u30c0\u30fc\u30b9\u30b3\u30a2\n* \u90e8\u5206\u4e00\u81f4\u3001\u4f8b\u3048\u3070 `abc*`\n* `/regexp/` \u5f62\u5f0f\u306e\u6b63\u898f\u8868\u73fe\n\nGo \u8a00\u8a9e\u306e\u6b63\u898f\u8868\u73fe\u6587\u6cd5\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u73fe\u6642\u70b9\u306e Swarm \u306f\u3001\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fbconstraint \u3067\u6f14\u7b97\u5b50 `==` \u3068 `!=` \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001\n\n* `constraint:node==node1` \u306f\u3001\u30ce\u30fc\u30c9 `node1` \u306b\u30de\u30c3\u30c1\n* `constraint:node!=node1` \u306f\u3001`node1` \u3092\u306e\u305e\u304f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n* `constraint:region!=us*` \u306f\u3001`us` \u304c\u4ed8\u3044\u3066\u3044\u308b\u30ea\u30fc\u30b8\u30e7\u30f3\u4ee5\u5916\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n* `constraint:node==/node[12]/` \u306f\u3001`node1` \u3068 `node2` \u306b\u30de\u30c3\u30c1\n* `constraint:node==/node\\d/` \u306f\u3001`node` + 10\u9032\u6570\u306e\uff11\u6587\u5b57\u306b\u30de\u30c3\u30c1\n* `constraint:node!=/node-[01]/` \u306f\u3001`node-0` \u3068 `node-1` \u4ee5\u5916\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n* `constraint:node!=/foo\\[bar\\]/` \u306f\u3001`foo[var]` \u4ee5\u5916\u306e\u5168\u3066\u306e\u30ce\u30fc\u30c9\u306b\u30de\u30c3\u30c1\n* `constraint:node==/(?i)node1/` \u306f\u3001\u5927\u6587\u5b57\u30fb\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3057\u306a\u3044 `node1` \u306b\u30de\u30c3\u30c1\u3057\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001`NoDe1` \u3084 `NODE1` \u3082\u30de\u30c3\u30c1\u3057\u307e\u3059\u3002\n\n### Soft affinities/constrains (\u30bd\u30d5\u30c8\u306a\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fb\u5236\u7d04)\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f\u3001\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3068\u5236\u7d04\u306f\u30cf\u30fc\u30c9\u306b\u5f37\u5236\u3055\u308c\u308b\u3082\u306e\u3067\u3059\u3002\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3084\u5236\u7d04\u304c\u306a\u3051\u308c\u3070\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3055\u308c\u307e\u305b\u3093\u3002Soft affinities/constrains \u304c\u3042\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u305f\u3081\u306b\u4e00\u81f4\u3059\u308b\u30eb\u30fc\u30eb\u3092\u63a2\u305d\u3046\u3068\u3057\u307e\u3059\u3002\u3082\u3057\u4e00\u81f4\u3057\u306a\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30d5\u30a3\u30eb\u30bf\u3092\u5ec3\u68c4\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306e\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nSoft affinities/constrains \u306f ~ \u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\uff1a\n\n```\n$ docker run -d --name redis1 -e affinity:image==~redis redis\n```\n\n\u3082\u3057\u3001\u30af\u30e9\u30b9\u30bf\u306b\u30a4\u30e1\u30fc\u30b8 `redis` \u3092\u6301\u3064\u30ce\u30fc\u30c9\u304c\u7121\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d --name redis2 -e constraint:region==~us* redis\n```\n\n\u3082\u3057\u3001`us` \u30ea\u30fc\u30b8\u30e7\u30f3\u306b\u5c5e\u3059\u30ce\u30fc\u30c9\u304c\u30af\u30e9\u30b9\u30bf\u306b\u7121\u3051\u308c\u3070\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u5236\u7d04\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d --name redis5 -e affinity:container!=~redis* redis\n```\n\n\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u30fb\u30d5\u30a3\u30eb\u30bf\u306f\u65b0\u3057\u3044 `redis5` \u30b3\u30f3\u30c6\u30ca\u3092\u3001\u6307\u5b9a\u3057\u305f `redis*`  \u306e\u540d\u524d\u3092\u542b\u3080\u30b3\u30f3\u30c6\u30ca\u304c\u7121\u3044\u30ce\u30fc\u30c9\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\u3082\u3057\u30af\u30e9\u30b9\u30bf\u306e\u5404\u3005\u306e\u30ce\u30fc\u30c9\u304c `redis*` \u30b3\u30f3\u30c6\u30ca\u3092\u6301\u3063\u3066\u3044\u308b\u5834\u5408\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30e9\u306f\u30a2\u30d5\u30a3\u30cb\u30c6\u30a3\u306e\u30eb\u30fc\u30eb\u3092\u7834\u68c4\u3057\u3001\u30b9\u30c8\u30e9\u30c6\u30b8\u306b\u5f93\u3063\u3066\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n## \u30dd\u30fc\u30c8\u30d5\u30a3\u30eb\u30bf\n\n\u3053\u306e `ports` \u30d5\u30a3\u30eb\u30bf\u306f\u30e6\u30cb\u30fc\u30af\u306a\u30ea\u30bd\u30fc\u30b9\u3060\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\n```\n$ docker run -d -p 80:80 nginx\n87c4376856a8\n\n$ docker ps\nCONTAINER ID    IMAGE               COMMAND         PORTS                       NODE        NAMES\n87c4376856a8    nginx:latest        \"nginx\"         192.168.0.42:80->80/tcp     node-1      prickly_engelbart\n```\n\nDocker \u30af\u30e9\u30b9\u30bf\u304b\u3089\u3001\u30d1\u30d6\u30ea\u30c3\u30af\u306e\u30dd\u30fc\u30c8 `80` \u304c\u5229\u7528\u53ef\u80fd\u306a\u30ce\u30fc\u30c9\u3092\u9078\u629e\u3057\u3001\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\u3053\u306e\u4f8b\u3067\u306f `node-1` \u304c\u8a72\u5f53\u3057\u307e\u3059\u3002\n\n\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u30d1\u30d6\u30ea\u30c3\u30af\u306e\u30dd\u30fc\u30c8 `80` \u3067\u8d77\u52d5\u3057\u3088\u3046\u3068\u3059\u308b\u306a\u3089\u3001\u65e2\u306b `node-1` \u306f\u4f7f\u7528\u4e2d\u306e\u305f\u3081\u3001\u5225\u306e\u30ce\u30fc\u30c9\u304c\u9078\u3070\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\n$ docker run -d -p 80:80 nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID        IMAGE          COMMAND        PORTS                           NODE        NAMES\n963841b138d8        nginx:latest   \"nginx\"        192.168.0.43:80->80/tcp         node-2      dreamy_turing\n87c4376856a8        nginx:latest   \"nginx\"        192.168.0.42:80->80/tcp         node-1      prickly_engelbart\n```\n\n\u518d\u3073\u540c\u3058\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u30dd\u30fc\u30c8 `80` \u304c\u4f7f\u3048\u306a\u3044 `node-1` \u3084 `node-2` \u3067\u306f\u306a\u3044\u3001`node-3` \u304c\u9078\u3070\u308c\u307e\u3059\u3002\n\n```\n$ docker run -d -p 80:80 nginx\n963841b138d8\n\n$ docker ps\nCONTAINER ID   IMAGE               COMMAND        PORTS                           NODE        NAMES\nf8b693db9cd6   nginx:latest        \"nginx\"        192.168.0.44:80->80/tcp         node-3      stoic_albattani\n963841b138d8   nginx:latest        \"nginx\"        192.168.0.43:80->80/tcp         node-2      dreamy_turing\n87c4376856a8   nginx:latest        \"nginx\"        192.168.0.42:80->80/tcp         node-1      prickly_engelbart\n```\n\n\u6700\u7d42\u7684\u306b\u3001\u30af\u30e9\u30b9\u30bf\u4e0a\u3067\u30dd\u30fc\u30c8 `80` \u304c\u5229\u7528\u53ef\u80fd\u306a\u30ce\u30fc\u30c9\u304c\u7121\u304f\u306a\u308b\u3068\u3001Docker Swam \u306f\u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u884c\u3092\u62d2\u5426\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d -p 80:80 nginx\n2014/10/29 00:33:20 Error response from daemon: no resources available to schedule container\n```\n\n### \u30db\u30b9\u30c8\u30fb\u30e2\u30fc\u30c9\u3067\u306e\u30dd\u30fc\u30c8\u30d5\u30a3\u30eb\u30bf\n\nDocker \u306b `--net=host` \u3092\u4f7f\u3063\u305f\u30db\u30b9\u30c8\u30fb\u30e2\u30fc\u30c9\u306e\u5b9f\u884c\u306f\u3001\u30dd\u30fc\u30c8\u306e\u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u304c\u3067\u304d\u306a\u3044 `host` \u30e2\u30fc\u30c9\u306e\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u306e `bridge` \u30e2\u30fc\u30c9\u3068\u306f\u7570\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u305f\u3081\u3001\uff11\u3064\u4ee5\u4e0a\u306e\u30dd\u30fc\u30c8\u756a\u53f7\u3092\u660e\u793a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff08 `Dockerfile` \u3067 `EXPOSE` \u3092\u4f7f\u3046\u304b\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u3067 `--expose` \u3092\u4f7f\u3044\u307e\u3059 \uff09\u3002Swarm \u306f\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ca\u5411\u3051\u306e\u30ce\u30fc\u30c9\u3092\u9078\u3076\u3068\u304d\u306b `host` \u30e2\u30fc\u30c9\u306e\u3053\u306e\u60c5\u5831\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n\u4f8b\u3048\u3070\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f `nginx` \u3092\uff13\u3064\u306e\u30ce\u30fc\u30c9\u30fb\u30af\u30e9\u30b9\u30bf\u3067\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```\n$ docker run -d --expose=80 --net=host nginx\n640297cb29a7\n$ docker run -d --expose=80 --net=host nginx\n7ecf562b1b3f\n$ docker run -d --expose=80 --net=host nginx\n09a92f582bc2\n```\n\n\u30dd\u30fc\u30c8\u30d0\u30a4\u30f3\u30c9\u306e\u60c5\u5831\u306f\u3001`docker ps` \u30b3\u30de\u30f3\u30c9\u3092\u901a\u3057\u3066\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002\u3053\u308c\u306f\u5168\u3066\u306e\u30ce\u30fc\u30c9\u304c `host` \u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3055\u308c\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002\n\n```\n$ docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS              PORTS               NAMES\n640297cb29a7        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up 30 seconds                           box3/furious_heisenberg\n7ecf562b1b3f        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up 28 seconds                           box2/ecstatic_meitner\n09a92f582bc2        nginx:1             \"nginx -g 'daemon of   46 seconds ago           Up 27 seconds                           box1/mad_goldstine\n```\n\n\uff14\u3064\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u6e96\u5099\u3057\u3088\u3046\u3068\u3057\u3066\u3082\u3001Swarm \u306f\u62d2\u5426\u3059\u308b\u3067\u3057\u3087\u3046\u3002\n\n```\n$  docker run -d --expose=80 --net=host nginx\nFATA[0000] Error response from daemon: unable to find a node with port 80/tcp available in the Host mode\n```\n\n\u305d\u306e\u304b\u308f\u308a\u306b\u3001\u30dd\u30fc\u30c8 `81` \u306e\u3088\u3046\u306a\u3001\u7570\u306a\u3063\u305f\u30dd\u30fc\u30c8\u3092\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u3059\u3002\n\n```\n$  docker run -d -p 81:80 nginx:latest\n832f42819adc\n$  docker ps\nCONTAINER ID        IMAGE               COMMAND                CREATED                  STATUS                  PORTS                                 NAMES\n832f42819adc        nginx:1             \"nginx -g 'daemon of   Less than a second ago   Up Less than a second   443/tcp, 192.168.136.136:81->80/tcp   box3/thirsty_hawking\n640297cb29a7        nginx:1             \"nginx -g 'daemon of   8 seconds ago            Up About a minute                                             box3/furious_heisenberg\n7ecf562b1b3f        nginx:1             \"nginx -g 'daemon of   13 seconds ago           Up About a minute                                             box2/ecstatic_meitner\n09a92f582bc2        nginx:1             \"nginx -g 'daemon of   About a minute ago       Up About a minute                                             box1/mad_goldstine\n```\n\n## dependency\uff08\u4f9d\u5b58\uff09\u30d5\u30a3\u30eb\u30bf\n\n\u3053\u306e\u30d5\u30a3\u30eb\u30bf\u306f\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u3067\u306e\u30b3\u30f3\u30c6\u30ca\u4f9d\u5b58\u6027\u3092\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n\u73fe\u6642\u70b9\u3067\u306f\u3001\u6b21\u306e\u4f9d\u5b58\u6027\u3092\u5ba3\u8a00\u3067\u304d\u307e\u3059\uff1a\n\n* \u30dc\u30ea\u30e5\u30fc\u30e0\u5171\u6709\uff1a`--volumes-from=dependency`\n* \u30ea\u30f3\u30af\uff1a `--link=dependency:alias`\n* \u5171\u6709\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5c64\uff1a`--net=container:dependency`\n\nSwarm \u306f\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u3067\u4f9d\u5b58\u6027\u306e\u3042\u308b\u30b3\u30f3\u30c6\u30ca\u3092\u8a2d\u7f6e\u3057\u3088\u3046\u3068\u3057\u307e\u3059\u3002\u3082\u3057\u5b9f\u884c\u3067\u304d\u306a\u305d\u3046\u3067\u3042\u308c\u3070\uff08\u4f9d\u5b58\u6027\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5b58\u5728\u3057\u306a\u304b\u3063\u305f\u308a\u3001\u30ce\u30fc\u30c9\u306b\u5341\u5206\u306a\u30ea\u30bd\u30fc\u30b9\u304c\u7121\u3044\u5834\u5408\uff09\u3001\u30b3\u30f3\u30c6\u30ca\u306f\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u3002\n\n\u53ef\u80fd\u3067\u3042\u308c\u3070\u3001\u8907\u6570\u306e\u4f9d\u5b58\u6027\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001`--volumes-from=A --net=container:B` \u306f\u3001`A` \u3068 `B` \u3068\u540c\u3058\u30ce\u30fc\u30c9\u4e0a\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7f6e\u3053\u3046\u3068\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5225\u3005\u306e\u30ce\u30fc\u30c9\u3067\u52d5\u3044\u3066\u3044\u308b\u306a\u3089\u3001Swarm \u306f\u30b3\u30f3\u30c6\u30ca\u306e\u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u3092\u884c\u3044\u307e\u305b\u3093\u3002\n\n## \u30d8\u30eb\u30b9\u30fb\u30d5\u30a3\u30eb\u30bf\n\n\u969c\u5bb3\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u30ce\u30fc\u30c9\u3092\u30d5\u30a3\u30eb\u30bf\u3057\u307e\u3059\u3002\n\n", "tags": ["DockerSwarm0.3.0", "docker"]}