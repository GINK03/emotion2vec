{"context": "\u203b\u300c\u2248\u2248\u2248\u300d\u306f\u7701\u7565\u3092\u8868\u3059\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\n$ node -v\nv6.2.1\n\n$ cat package.json\n{\n  \u2248\u2248\u2248\n  \"dependencies\": {\n    \"express\": \"~4.13.1\",\n    \"log4js\": \"^0.6.37\",\n    \u2248\u2248\u2248\n  },\n  \u2248\u2248\u2248\n}\n\n\nlog4js\u306e\u8a2d\u5b9a\n$ mkdir modules\n$ cat modules/logger.js \nvar log4js = require('log4js');\n\nlog4js.configure({\n    \"appenders\": [{\n      \"category\": \"access\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/access.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"category\": \"system\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/system.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"category\": \"error\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/error.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"type\": \"console\"\n    }],\n    \"levels\": {\n      \"access\": \"ALL\",\n      \"system\": \"ALL\",\n      \"error\": \"ERROR\"\n    }\n});\n\nmodule.exports = { \n  access: log4js.getLogger('access'),\n  system: log4js.getLogger('system'),\n  error: log4js.getLogger('error'),\n  express: log4js.connectLogger(log4js.getLogger('access'), {level: log4js.levels.INFO}),\n  isDebug: function(category) {\n    return (log4js.levels.DEBUG.level >= category.level.level);\n  }\n};\n\n\napp.js\n$ cat app.js\n\u2248\u2248\u2248\nvar logger = require('./modules/logger');\n\u2248\u2248\u2248\napp.use(logger.express);\n\u2248\u2248\u2248\n\n\n\u4f7f\u3044\u65b9\n$ cat app.js\n\u2248\u2248\u2248\nvar test = require('../routes/test');\n\u2248\u2248\u2248\napp.use('/', test);\n\u2248\u2248\u2248\n\n$ cat routes/test.js\nvar express = require('express');\nvar logger  = require('../modules/logger');\nvar router = express.Router();\n\nrouter.get('/', function(req, res, next) {\n  if(logger.isDebug(logger.system)) {\n    logger.system.debug(\"debug\u30ed\u30b0\u306f\u3001DEBUG\u30ec\u30d9\u30eb\u306e\u6642\u3060\u3051\u547c\u3073\u305f\u3044\u3002\");\n  }\n\n  logger.error.error(\"error\u3058\u3083\u306a\u3044\u3051\u3069\u306d\uff01\");\n}\n\nmodule.exports = router;\n\n\u203b\u300c\u2248\u2248\u2248\u300d\u306f\u7701\u7565\u3092\u8868\u3059\n\n# \u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\n$ node -v\nv6.2.1\n```\n\n```\n$ cat package.json\n{\n  \u2248\u2248\u2248\n  \"dependencies\": {\n    \"express\": \"~4.13.1\",\n    \"log4js\": \"^0.6.37\",\n    \u2248\u2248\u2248\n  },\n  \u2248\u2248\u2248\n}\n```\n\n# log4js\u306e\u8a2d\u5b9a\n\n```\n$ mkdir modules\n$ cat modules/logger.js \nvar log4js = require('log4js');\n\nlog4js.configure({\n    \"appenders\": [{\n      \"category\": \"access\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/access.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"category\": \"system\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/system.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"category\": \"error\",\n      \"type\": \"dateFile\",\n      \"filename\": \"/var/log/nodejs/error.log\",\n      \"pattern\": \"-yyyy-MM-dd\",\n      \"backups\": 3\n    },\n    {\n      \"type\": \"console\"\n    }],\n    \"levels\": {\n      \"access\": \"ALL\",\n      \"system\": \"ALL\",\n      \"error\": \"ERROR\"\n    }\n});\n\nmodule.exports = { \n  access: log4js.getLogger('access'),\n  system: log4js.getLogger('system'),\n  error: log4js.getLogger('error'),\n  express: log4js.connectLogger(log4js.getLogger('access'), {level: log4js.levels.INFO}),\n  isDebug: function(category) {\n    return (log4js.levels.DEBUG.level >= category.level.level);\n  }\n};\n```\n\n# app.js\n\n```\n$ cat app.js\n\u2248\u2248\u2248\nvar logger = require('./modules/logger');\n\u2248\u2248\u2248\napp.use(logger.express);\n\u2248\u2248\u2248\n```\n\n# \u4f7f\u3044\u65b9\n\n```\n$ cat app.js\n\u2248\u2248\u2248\nvar test = require('../routes/test');\n\u2248\u2248\u2248\napp.use('/', test);\n\u2248\u2248\u2248\n```\n```\n$ cat routes/test.js\nvar express = require('express');\nvar logger  = require('../modules/logger');\nvar router = express.Router();\n\nrouter.get('/', function(req, res, next) {\n  if(logger.isDebug(logger.system)) {\n    logger.system.debug(\"debug\u30ed\u30b0\u306f\u3001DEBUG\u30ec\u30d9\u30eb\u306e\u6642\u3060\u3051\u547c\u3073\u305f\u3044\u3002\");\n  }\n\n  logger.error.error(\"error\u3058\u3083\u306a\u3044\u3051\u3069\u306d\uff01\");\n}\n\nmodule.exports = router;\n```\n", "tags": ["Node.js", "Express.js", "log4js"]}