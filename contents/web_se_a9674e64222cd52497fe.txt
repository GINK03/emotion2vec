{"context": "NOAA Global Historical Climatology Network \u306e\u5929\u5019\u30c7\u30fc\u30bf\uff08\u65e5\u672c\u306b\u3082\u306e\u306b\u7d5e\u3063\u3066\uff09\u3092\u4f7f\u3063\u3066\u3001\nColumn-oriented \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u30ab\u30c6\u30b4\u30ea\u5206\u3051\u3055\u308c\u308b Parquet\u306b\u5909\u63db\u3057\u3066\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nApache Drill\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\ncurl -o apache-drill-1.9.0.tar.gz http://apache.mirrors.hoobly.com/drill/drill-1.9.0/apache-drill-1.9.0.tar.gz\n\n\nApache Drill\u306b\u3066\u3001CSV\u304b\u3089Parquet\u3078\u306eConvert\u4f5c\u696d\n0: jdbc:drill:zk=local> ALTER SESSION SET `store.format` = 'parquet'\n. . . . . . . . . . . > ;\n+-------+------------------------+\n|  ok   |        summary         |\n+-------+------------------------+\n| true  | store.format updated.  |\n+-------+------------------------+\n1 row selected (1.655 seconds)\n\n\u578b\u5909\u63db\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001VARCHAR\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3059\u306e\u3067\u3001Paruent\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3068\u304d\u306b\n\u8a72\u5f53\u30d5\u30a3\u30fc\u30eb\u30c9\uff08\u3053\u306e\u5834\u5408\u3001value)\u3092FLOAT\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n0: jdbc:drill:zk=local> CREATE TABLE dfs.tmp.`/ghcnd_2016/` AS SELECT\n. . . . . . . . . . . > id,\n. . . . . . . . . . . > `date`,\n. . . . . . . . . . . > `element`,\n. . . . . . . . . . . > CAST(`value` AS FLOAT) AS `value`,\n. . . . . . . . . . . > mflag,\n. . . . . . . . . . . > qflag,\n. . . . . . . . . . . > sflag,\n. . . . . . . . . . . > `time`\n. . . . . . . . . . . > FROM dfs.`/tmp/ghcnd_2016_ja.csvh`;\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\n+-----------+----------------------------+\n| Fragment  | Number of records written  |\n+-----------+----------------------------+\n| 0_0       | 174292                     |\n+-----------+----------------------------+\n1 row selected (3.755 seconds)\n\n\u6c17\u8c61\u89b3\u6e2c\u6240\u306e\u30c7\u30fc\u30bf\u306f\u305d\u306e\u307e\u307e\u5909\u63db\u3057\u307e\u3057\u305f\u3002\n CREATE TABLE dfs.tmp.`/ghcnd_stations/` AS\n SELECT * FROM dfs.`/tmp/ghcnd_stations.csvh`\n\n/tmp/ghcnd_201611\u3001/tmp/ghcnd_stations\u306e\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3092S3\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\nAmazon Athena \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\nCREATE EXTERNAL TABLE IF NOT EXISTS athena_test_1.ghcnd_2016 (\n  id string,\n  date string,\n  element string,\n  value float,\n  mflag string,\n  qflag string,\n  sflag string,\n  time string\n)\nROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'\nWITH SERDEPROPERTIES (\n  'serialization.format' = '1'\n) LOCATION 's3://athena-test-data01/parquent/ghcnd_2016/';\n\nCREATE EXTERNAL TABLE IF NOT EXISTS athena_test_1.ghcnd_stations (\n  id string,\n  latitude float,\n  longitude float,\n  elevation float,\n  state string,\n  name string,\n  gsn_flag string,\n  hcn_crn_flag string,\n  wmoid int\n)\nROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'\nWITH SERDEPROPERTIES (\n  'serialization.format' = '1'\n) LOCATION 's3://athena-test-data01/parquent/ghcnd_stations/';\n\n\u30c6\u30fc\u30d6\u30eb\u30c7\u30fc\u30bf\u6570\n\n\n\nTable\ncount\n\n\n\n\nghcnd_2016\n174,292\n\n\nghcnd_stations\n100,820\n\n\n\nBigQuery\u3067\u5b9f\u884c\u3059\u308b\u30af\u30a8\u30ea\u30fc\uff08Standard SQL\uff09\n#standardSQL\nSELECT \nW.date AS date,\nS.NAME AS name,\nSUM(case when element = 'PRCP' then value else 0 end) AS PRCP,\nSUM(case when element = 'TAVG' then value else 0 end) AS TAVG,\nSUM(case when element = 'TMIN' then value else 0 end) AS TMIN,\nSUM(case when element = 'TMAX' then value else 0 end) AS TMAX\nFROM `redash_shonan_handon`.ghcnd_2016_ja AS W\nJOIN\n`redash_shonan_handon`.ghcnd_stations AS S\nON \nW.id = S.id\nGROUP BY date,name\n\n\n\u30af\u30a8\u30ea\u5b9f\u884c\u7d50\u679c\n\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nelapsed\nscan size\n\n\n\n\nparquent\n5.21\n3.9MB\n\n\ncsv\n4.02\n13.01MB\n\n\nBigQuery\n4.4\n8.76MB\n\n\n\nNOAA Global Historical Climatology Network \u306e\u5929\u5019\u30c7\u30fc\u30bf\uff08\u65e5\u672c\u306b\u3082\u306e\u306b\u7d5e\u3063\u3066\uff09\u3092\u4f7f\u3063\u3066\u3001\nColumn-oriented \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u30ab\u30c6\u30b4\u30ea\u5206\u3051\u3055\u308c\u308b Parquet\u306b\u5909\u63db\u3057\u3066\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n## Apache Drill\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\n\n```\ncurl -o apache-drill-1.9.0.tar.gz http://apache.mirrors.hoobly.com/drill/drill-1.9.0/apache-drill-1.9.0.tar.gz\n```\n\n\n## Apache Drill\u306b\u3066\u3001CSV\u304b\u3089Parquet\u3078\u306eConvert\u4f5c\u696d\n\n```\n0: jdbc:drill:zk=local> ALTER SESSION SET `store.format` = 'parquet'\n. . . . . . . . . . . > ;\n+-------+------------------------+\n|  ok   |        summary         |\n+-------+------------------------+\n| true  | store.format updated.  |\n+-------+------------------------+\n1 row selected (1.655 seconds)\n```\n\n\u578b\u5909\u63db\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001VARCHAR\u3068\u3057\u3066\u8a8d\u8b58\u3055\u308c\u307e\u3059\u306e\u3067\u3001Paruent\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3068\u304d\u306b\n\u8a72\u5f53\u30d5\u30a3\u30fc\u30eb\u30c9\uff08\u3053\u306e\u5834\u5408\u3001value)\u3092FLOAT\u306b\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n0: jdbc:drill:zk=local> CREATE TABLE dfs.tmp.`/ghcnd_2016/` AS SELECT\n. . . . . . . . . . . > id,\n. . . . . . . . . . . > `date`,\n. . . . . . . . . . . > `element`,\n. . . . . . . . . . . > CAST(`value` AS FLOAT) AS `value`,\n. . . . . . . . . . . > mflag,\n. . . . . . . . . . . > qflag,\n. . . . . . . . . . . > sflag,\n. . . . . . . . . . . > `time`\n. . . . . . . . . . . > FROM dfs.`/tmp/ghcnd_2016_ja.csvh`;\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\n+-----------+----------------------------+\n| Fragment  | Number of records written  |\n+-----------+----------------------------+\n| 0_0       | 174292                     |\n+-----------+----------------------------+\n1 row selected (3.755 seconds)\n```\n\n\u6c17\u8c61\u89b3\u6e2c\u6240\u306e\u30c7\u30fc\u30bf\u306f\u305d\u306e\u307e\u307e\u5909\u63db\u3057\u307e\u3057\u305f\u3002\n\n```\n CREATE TABLE dfs.tmp.`/ghcnd_stations/` AS\n SELECT * FROM dfs.`/tmp/ghcnd_stations.csvh`\n```\n\n/tmp/ghcnd_201611\u3001/tmp/ghcnd_stations\u306e\u4e2d\u306e\u30d5\u30a1\u30a4\u30eb\u3092S3\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n## Amazon Athena \u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\n\n```\nCREATE EXTERNAL TABLE IF NOT EXISTS athena_test_1.ghcnd_2016 (\n  id string,\n  date string,\n  element string,\n  value float,\n  mflag string,\n  qflag string,\n  sflag string,\n  time string\n)\nROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'\nWITH SERDEPROPERTIES (\n  'serialization.format' = '1'\n) LOCATION 's3://athena-test-data01/parquent/ghcnd_2016/';\n```\n\n```\nCREATE EXTERNAL TABLE IF NOT EXISTS athena_test_1.ghcnd_stations (\n  id string,\n  latitude float,\n  longitude float,\n  elevation float,\n  state string,\n  name string,\n  gsn_flag string,\n  hcn_crn_flag string,\n  wmoid int\n)\nROW FORMAT SERDE 'org.apache.hadoop.hive.ql.io.parquet.serde.ParquetHiveSerDe'\nWITH SERDEPROPERTIES (\n  'serialization.format' = '1'\n) LOCATION 's3://athena-test-data01/parquent/ghcnd_stations/';\n```\n\n\u30c6\u30fc\u30d6\u30eb\u30c7\u30fc\u30bf\u6570\n\n| Table| count |\n|:-----------|------------:|\n| ghcnd_2016 |        174,292|\n| ghcnd_stations|      100,820|\n\n\nBigQuery\u3067\u5b9f\u884c\u3059\u308b\u30af\u30a8\u30ea\u30fc\uff08Standard SQL\uff09\n\n```\n#standardSQL\nSELECT \nW.date AS date,\nS.NAME AS name,\nSUM(case when element = 'PRCP' then value else 0 end) AS PRCP,\nSUM(case when element = 'TAVG' then value else 0 end) AS TAVG,\nSUM(case when element = 'TMIN' then value else 0 end) AS TMIN,\nSUM(case when element = 'TMAX' then value else 0 end) AS TMAX\nFROM `redash_shonan_handon`.ghcnd_2016_ja AS W\nJOIN\n`redash_shonan_handon`.ghcnd_stations AS S\nON \nW.id = S.id\nGROUP BY date,name\n```\n\n## \u30af\u30a8\u30ea\u5b9f\u884c\u7d50\u679c\n\n|\u30d5\u30a9\u30fc\u30de\u30c3\u30c8| elapsed |scan size|\n|:-----------|------------:|------------:|\n| parquent |5.21|3.9MB|\n| csv|4.02|13.01MB|\n|BigQuery|4.4|8.76MB|\n\n\n\n", "tags": ["AWS", "GoogleCloudPlatform"]}