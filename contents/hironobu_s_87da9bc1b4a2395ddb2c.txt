{"tags": ["openstack", "Ubuntu"], "context": "Ubuntu OpenStack Installer\u306f\u3001Canonical\u793e\u304c\u958b\u767a\u3057\u3066\u3044\u308bOpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3067\u3059\u3002\u79c1\u306fUbuntu\u30e6\u30fc\u30b6\u30fc\u306a\u306e\u3067\u3053\u308c\u3092\u3088\u304f\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u69cb\u7bc9\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306b\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u304c\u96e3\u70b9\u3067\u3057\u305f(\u6570\u6642\u9593\u3068\u304b)\u3002\u3053\u308c\u3092\u6539\u5584\u3057\u305f\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001\u4ed6\u306eOpenStack\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\n\n\u516c\u5f0f\u306eDevStack\n\nRed Hat\u304c\u958b\u767a\u3057\u3066\u3044\u308bRDO\n\nMirantis\u304c\u958b\u767a\u3057\u3066\u3044\u308bFuel\n\n\n\u3068\u304b\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n\u306a\u305c\u9045\u3044\u306e\u304b\n\u3053\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\u5185\u90e8\u3067lxc\u3084juju\u3092\u5229\u7528\u3057\u3066\u3044\u3066\u3001\u305d\u308c\u3089\u304clxc\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3084kvm\u306e\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092 cloud-images.ubuntu.com \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u306f\u30a4\u30ae\u30ea\u30b9\u306b\u3042\u308b\u3088\u3046\u3067\u3001\u65e5\u672c\u304b\u3089\u975e\u5e38\u306b\u9060\u3044\u3067\u3059\u3002\u3072\u3069\u3044\u3068100KB/sec\u304f\u3089\u3044\u3057\u304b\u51fa\u307e\u305b\u3093\u3002\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306f\u6570\u767eMB\u3042\u308b\u306e\u3067\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3060\u3051\u3067\u304b\u306a\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u3053\u3046\u3044\u3046\u3068\u304d\u306f\u30df\u30e9\u30fc\u30b5\u30fc\u30d0\u3092\u4f7f\u3046\u3079\u304d\u3067\u3059\u3002Ubuntu\u306f\u975e\u5e38\u306b\u591a\u304f\u306e\u30df\u30e9\u30fc\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u307b\u3068\u3093\u3069\u304capt\u3068ISO\u30a4\u30e1\u30fc\u30b8\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30df\u30e9\u30fc\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u3067\u3059\u3002\u65e5\u672c\u3067\u306f\u552f\u4e00\u3001\u5bcc\u5c71\u5927\u5b66\u304c\u30df\u30e9\u30fc\u3067\u3059\u3002\n\u65e5\u672c\u56fd\u5185\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30c8\n(UEC iamge\u306e\u3068\u3053\u308d)\n\u305d\u3057\u3066Ubuntu OpenStack Installer\u306b\u306f\u3001\u30df\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u9805\u76ee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u5185\u90e8\u3067\u547c\u3073\u51fa\u3057\u3044\u3066\u3044\u308blxc\u3084juju\u306a\u3069\u3082\u3001\u30df\u30e9\u30fc\u306e\u8a2d\u5b9a\u306f\u3042\u308b\u3082\u306e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u96a0\u853d\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6b8b\u5ff5\u306a\u304c\u3089\u8a2d\u5b9a\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u4ed5\u65b9\u306a\u3044\u306e\u3067\u30df\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u306f\u7121\u304f\u3001\u3042\u3089\u304b\u3058\u3081\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u7f6e\u3044\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u6700\u521d\u306b\u4f5c\u6210\u3059\u308blxc\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8(\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba150MB\u304f\u3089\u3044)\u3092\u3001\u30df\u30e9\u30fc\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3059\u308b\u3002\nlxc\u30b3\u30f3\u30c6\u30ca\u5185\u3067juju\u304c\u8d77\u52d5\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8(\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba250MB\u304f\u3089\u3044)\u3092\u3001\u30db\u30b9\u30c8\u5074\u3067\u3042\u3089\u304b\u3058\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u3044\u3066\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5171\u6709\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5229\u7528\u3059\u308b\u3002\n\n\n\u624b\u9806\n\u3067\u306f\u3084\u3063\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9\u3078\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u524d\u63d0\u3067\u3059\u3002\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3082\u5408\u308f\u305b\u3066\u898b\u3066\u4e0b\u3055\u3044\u3002\n\u52d5\u4f5c\u78ba\u8a8d\u306fVMware\u4e0a\u306eUbuntu14.04LTS\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\nhiro@ubuntu14:~$ uname -a\nLinux ubuntu14 4.2.0-27-generic #32~14.04.1-Ubuntu SMP Fri Jan 22 15:32:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\nhiro@ubuntu14:~$ openstack-install --version\nopenstack-install 0.99.28\n\n\u4ee5\u4e0b\u3001\u8272\u3005\u89e3\u8aac\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u3084\u308b\u3053\u3068\u81ea\u4f53\u306f\u5c11\u306a\u3044\u3067\u3059\u3002\n\n1. \u6e96\u5099\nopenstack-install\u3092\u5b9f\u884c\u3059\u308b\u76f4\u524d(Start the installation\u306e\u524d)\u307e\u3067\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308a\u306b\u9032\u3081\u307e\u3059\u3002\n\n2. lxc\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3059\u308b\nlxc\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u969b\u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u5fc5\u8981\u3068\u3057\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u969b\u306b\u306f\u5185\u90e8\u3067 /usr/share/lxc/templates/lxc-ubuntu-cloud \u304c\u547c\u3070\u308c\u307e\u3059\u3002\u4e2d\u8eab\u306f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\u305d\u3057\u3066\u3001lxc-ubuntu-cloud\u306f\u3055\u3089\u306b\u5185\u90e8\u3067ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306fcloud-utils\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30db\u30b9\u30c8\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3084Ubuntu\u306e\u30ea\u30ea\u30fc\u30b9\u540d\u3092\u5143\u306b\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068rootfs\u306e\u5c55\u958b\u3092\u884c\u3044\u307e\u3059\u3002\u3053\u308c\u3082\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\nubuntu-cloudimg-query\u306f\u74b0\u5883\u5909\u6570 UBUNTU_CLOUDIMG_QUERY_BASEURL \u3067\u30df\u30e9\u30fc\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u65e5\u672c\u306e\u30df\u30e9\u30fc\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306f\u30df\u30e9\u30fc\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u306e\u3001ubuntu-cloudimg-query\u304c\u5229\u7528\u3059\u308b\u30af\u30a8\u30ea\u30d5\u30a1\u30a4\u30eb\u3060\u3051\u30df\u30e9\u30fc\u3055\u308c\u3066\u3044\u307e\u305b\u3093(\u306a\u305c\u306a\u306e\u304b...)\n\u305d\u3053\u3067\u3001\u4e00\u5ea6\u30df\u30e9\u30fc\u306a\u3057\u3067ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u30ed\u30fc\u30ab\u30eb\u306b\u30af\u30a8\u30ea\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u308a\u3001\u6b21\u306blxc-ubuntu-cloud\u3092\u5b9f\u884c\u3057\u3066\u30df\u30e9\u30fc\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3044\u3046\u6bb5\u968e\u3092\u8e0f\u307f\u307e\u3059\u3002\n\u307e\u305a\u3001ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u7b2c\u4e00\u5f15\u6570\u306fUbuntu\u306e\u30ea\u30ea\u30fc\u30b9\u540d(/etc/lsb-release\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059)\u3001\u7b2c\u4e8c\u5f15\u6570\u306freleased\u3067\u56fa\u5b9a\u3001\u7b2c\u4e09\u5f15\u6570\u306f\u30db\u30b9\u30c8\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u3059\u3002\nhiro@ubuntu14:~$ ubuntu-cloudimg-query trusty released amd64 > /dev/null\n\n\u6b21\u306blxc-ubuntu-cloud\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u74b0\u5883\u5909\u6570UBUNTU_CLOUDIMG_QUERY_BASEURL\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30df\u30e9\u30fc\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002path\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5fc5\u9808\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3001\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306brootfs\u304c\u5c55\u958b\u3055\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u4e0d\u8981\u306a\u306e\u3067\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nUBUNTU_CLOUDIMG_QUERY_BASEURL=http://ubuntutym2.u-toyama.ac.jp/cloud-images/releases sudo -E /usr/share/lxc/templates/lxc-ubuntu-cloud --path=/tmp/hoge\n\n\u305d\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u304c/var/cache/lxc/cloud-(\u30ea\u30ea\u30fc\u30b9\u540d)\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nhiro@ubuntu14:~$ sudo ls -l /var/cache/lxc/cloud-trusty\n\u5408\u8a08 122104\ndrwxr-xr-x 22 root root      4096  7\u6708 26 11:59 rootfs\ndrwxr-xr-x  3 root root      4096  7\u6708 26 12:04 tmp\n-rw-r--r--  1 root root 125023208  7\u6708 15 06:03 ubuntu-14.04-server-cloudimg-amd64-root.tar.xz\n\n\n3. \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u3042\u3089\u304b\u3058\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\n\u6b21\u306b\u3001juju\u304clxc\u5185\u90e8\u3067\u4f7f\u7528\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u3001\u3042\u3089\u304b\u3058\u3081\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002juju\u5185\u90e8\u3067\u306fuvtool\u304c\u4f7f\u308f\u308c\u3066\u304a\u308a\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u7ba1\u7406\u306b\u306fuvt-simplestreams-libvirt\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3082cloud-images.ubuntu.com\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3067\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002\u30df\u30e9\u30fc\u306e\u6307\u5b9a\u306f--source\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u884c\u3044\u307e\u3059\u3002\n\u7d50\u8ad6\u3068\u3057\u3066\u3001\u6b8b\u5ff5\u306a\u304c\u3089juju\u3092\u4f7f\u3046\u5834\u5408\u306b\u304a\u3044\u3066--source\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u306e\u3042\u305f\u308a\u3067\u3059\u3002\nhttps://github.com/juju/juju/blob/69d8569f1da7a360851dc79d8b76549562e1b326/container/kvm/libvirt.go#L59\nhttps://github.com/juju/juju/blob/69d8569f1da7a360851dc79d8b76549562e1b326/container/kvm/kvm.go#L146\n\u306a\u306e\u3067\u65b9\u6cd5\u8ad6\u3068\u3057\u3066\u3001\u30db\u30b9\u30c8\u5074\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30e1\u30fc\u30b8\u3092\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u3044\u3066\u3001\u305d\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/var/lib/uvtool)\u3092lxc\u30b3\u30f3\u30c6\u30ca\u5185\u306ejuju\u3068\u5171\u6709\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\nuvtool\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nhiro@ubuntu14:~$ sudo apt-get install uvtool\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b(\u30aa\u30d7\u30b7\u30e7\u30f3\u306erelease\u3068arch\u306f\u4f7f\u3063\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u5408\u308f\u305b\u3066\u4e0b\u3055\u3044\u3002)\nhiro@ubuntu14:~$ uvt-simplestreams-libvirt sync --source=http://ubuntutym2.u-toyama.ac.jp/cloud-images/releases arch=amd64 release=trusty\n\n\u4f55\u3082\u51fa\u529b\u3055\u308c\u307e\u305b\u3093\u304c\u3001/var/lib/uvtool/ \u914d\u4e0b\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\nhiro@ubuntu14:~$ ls -l /var/lib/uvtool/libvirt/images/\n\u5408\u8a08 845196\ndrwxr-xr-x 2 root      root          4096  7\u6708 26 19:24 ./\ndrwxr-xr-x 4 root      root          4096  7\u6708 26 12:48 ../\n-rw------- 1 pollinate libvirtd 865468416  7\u6708 26 16:40 x-uvt-b64-Y29tLnVidW50dS5jbG91ZDpzZXJ2ZXI6MTQuMDQ6YW1kNjQgMjAxNjA3MTQ=\n\n\n4. cloud-init\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4fee\u6b63\u3059\u308b\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u4f7f\u3046cloud-init\u306euser-data\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002 \u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u30db\u30b9\u30c8\u306euvtool\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067\u3001/var/lib/\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3089\u3067\u3059\u3002\nsudo vi /usr/share/openstack/templates/userdata.yaml\n\n\u6700\u4e0b\u884c\u306b\u4ee5\u4e0b\u306e\u4e00\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002YAML\u306a\u306e\u3067\u30a4\u30f3\u30c7\u30f3\u30c8\u306b\u6ce8\u610f\u3067\u3059\u3002\n{%- if https_proxy %}\n  - echo \"export https_proxy={{ https_proxy }}\" >> /home/ubuntu/.bashrc\n  - echo \"export HTTPS_PROXY={{ https_proxy }}\" >> /home/ubuntu/.bashrc\n{%- endif %}\n  - \"chown ubuntu:ubuntu /home/ubuntu /home/ubuntu/.bashrc\"\n  - \"ln -s /home/ubuntu/uvtool /var/lib/uvtool\"              \u2190 \u3053\u306e\u884c\n\n\n5. openstack-install\u3092\u5b9f\u884c\u3059\u308b\n\u3088\u3046\u3084\u304fOpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\u3067\u3059\uff01 openstack-install\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u3001\u74b0\u5883\u5909\u6570\u30922\u3064\u6307\u5b9a\u3057\u307e\u3059\u3002\nEXTRA_BIND_DIRS=/var/lib/uvtool USE_LXC_IMAGE_CACHE=1 sudo -E openstack-install\n\nsudo\u306b-E\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3053\u3068\u304c\u5fc5\u9808\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308asudo\u304b\u3089\u8d77\u52d5\u3057\u305f\u30b3\u30de\u30f3\u30c9\u306b\u74b0\u5883\u5909\u6570\u304c\u5f15\u304d\u7d99\u304c\u308c\u307e\u3059\u3002\nEXTRA_BIND_DIRS\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u4f5c\u6210\u3059\u308blxc\u30b3\u30f3\u30c6\u30ca\u304c\u3001\u30db\u30b9\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3088\u3046\u6307\u5b9a\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3002\u30db\u30b9\u30c8\u306euvtool\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30f3\u30c6\u30ca\u5185\u304b\u3089\u4f7f\u7528\u3059\u308b\u305f\u3081\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30d8\u30eb\u30d7\u306b\u306f\u66f8\u3044\u3066\u306a\u304f\u30b3\u30fc\u30c9\u5185\u306b\u3042\u308a\u307e\u3059\u3002\nhttps://github.com/Ubuntu-Solutions-Engineering/openstack-installer/blob/350445f5a7fdb7f42b7c97f14eb77813ecf816a2/cloudinstall/controllers/install/single.py#L225\nUSE_LXC_IMAGE_CACHE\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304clxc\u30a4\u30e1\u30fc\u30b8\u3092\u8d77\u52d5\u3059\u308b\u969b\u306b\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u5236\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u6319\u52d5\u3068\u3057\u3066\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u5185\u90e8\u3067\u8d77\u52d5\u3059\u308blxc-create\u304b\u3089-F\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u9664\u5916\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001openstack-install\u3092\u5b9f\u884c\u3059\u308b\u5ea6\u306b\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059(Additional Tips\u306e\u3068\u3053\u308d)\nhttps://help.ubuntu.com/lts/clouddocs/installer/en/single-install.html\n\u3042\u3068\u306f\u901a\u5e38\u901a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u9032\u3081\u308b\u3060\u3051\u3067\u3059\uff01 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u9593\u304c\u304b\u306a\u308a\u77ed\u304f\u306a\u3063\u3066\u308b\u306f\u305a\u3067\u3059(\u6570\u5341\u5206\u3067\u7d42\u308f\u308b)\n[Ubuntu OpenStack Installer](https://help.ubuntu.com/lts/clouddocs/installer/)\u306f\u3001[Canonical](https://www.ubuntu.com/)\u793e\u304c\u958b\u767a\u3057\u3066\u3044\u308bOpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u3067\u3059\u3002\u79c1\u306fUbuntu\u30e6\u30fc\u30b6\u30fc\u306a\u306e\u3067\u3053\u308c\u3092\u3088\u304f\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\u69cb\u7bc9\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306b\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u304c\u96e3\u70b9\u3067\u3057\u305f(\u6570\u6642\u9593\u3068\u304b)\u3002\u3053\u308c\u3092\u6539\u5584\u3057\u305f\u30ef\u30fc\u30af\u30a2\u30e9\u30a6\u30f3\u30c9\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\n> \u3061\u306a\u307f\u306b\u3001\u4ed6\u306eOpenStack\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\n>\n> * \u516c\u5f0f\u306e[DevStack](http://docs.openstack.org/developer/devstack/)\n> * Red Hat\u304c\u958b\u767a\u3057\u3066\u3044\u308b[RDO](https://www.rdoproject.org/)\n> * Mirantis\u304c\u958b\u767a\u3057\u3066\u3044\u308b[Fuel](https://www.mirantis.com/products/mirantis-> openstack-software/openstack-deployment-fuel/)\n>\n> \u3068\u304b\u304c\u3042\u308a\u307e\u3059\u3002\n\n# \u306a\u305c\u9045\u3044\u306e\u304b\n\n\u3053\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\u5185\u90e8\u3067lxc\u3084juju\u3092\u5229\u7528\u3057\u3066\u3044\u3066\u3001\u305d\u308c\u3089\u304clxc\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3084kvm\u306e\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092 [cloud-images.ubuntu.com](http://cloud-images.ubuntu.com) \u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u3053\u306e\u30b5\u30fc\u30d0\u30fc\u306f\u30a4\u30ae\u30ea\u30b9\u306b\u3042\u308b\u3088\u3046\u3067\u3001\u65e5\u672c\u304b\u3089\u975e\u5e38\u306b\u9060\u3044\u3067\u3059\u3002\u3072\u3069\u3044\u3068100KB/sec\u304f\u3089\u3044\u3057\u304b\u51fa\u307e\u305b\u3093\u3002\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306f\u6570\u767eMB\u3042\u308b\u306e\u3067\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3060\u3051\u3067\u304b\u306a\u308a\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\n\u3053\u3046\u3044\u3046\u3068\u304d\u306f\u30df\u30e9\u30fc\u30b5\u30fc\u30d0\u3092\u4f7f\u3046\u3079\u304d\u3067\u3059\u3002Ubuntu\u306f\u975e\u5e38\u306b\u591a\u304f\u306e\u30df\u30e9\u30fc\u304c\u3042\u308b\u306e\u3067\u3059\u304c\u3001\u307b\u3068\u3093\u3069\u304capt\u3068ISO\u30a4\u30e1\u30fc\u30b8\u3067\u3001\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30df\u30e9\u30fc\u306f\u975e\u5e38\u306b\u5c11\u306a\u3044\u3067\u3059\u3002\u65e5\u672c\u3067\u306f\u552f\u4e00\u3001\u5bcc\u5c71\u5927\u5b66\u304c\u30df\u30e9\u30fc\u3067\u3059\u3002\n\n[\u65e5\u672c\u56fd\u5185\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30c8](https://www.ubuntulinux.jp/ubuntu/mirrors)\n(UEC iamge\u306e\u3068\u3053\u308d)\n\n\u305d\u3057\u3066Ubuntu OpenStack Installer\u306b\u306f\u3001\u30df\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u9805\u76ee\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u307e\u305f\u3001\u5185\u90e8\u3067\u547c\u3073\u51fa\u3057\u3044\u3066\u3044\u308blxc\u3084juju\u306a\u3069\u3082\u3001\u30df\u30e9\u30fc\u306e\u8a2d\u5b9a\u306f\u3042\u308b\u3082\u306e\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u96a0\u853d\u3057\u3066\u3057\u307e\u3046\u306e\u3067\u3001\u6b8b\u5ff5\u306a\u304c\u3089\u8a2d\u5b9a\u304c\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n\u4ed5\u65b9\u306a\u3044\u306e\u3067\u30df\u30e9\u30fc\u3092\u8a2d\u5b9a\u3059\u308b\u306e\u3067\u306f\u7121\u304f\u3001\u3042\u3089\u304b\u3058\u3081\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u7f6e\u3044\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3057\u3066\u304a\u304d\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u306f\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u5229\u7528\u3059\u308b\u3088\u3046\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u53d6\u308a\u307e\u3057\u305f\u3002\n\n* \u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u6700\u521d\u306b\u4f5c\u6210\u3059\u308blxc\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30e1\u30fc\u30b8(\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba150MB\u304f\u3089\u3044)\u3092\u3001\u30df\u30e9\u30fc\u30b5\u30a4\u30c8\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3059\u308b\u3002\n* lxc\u30b3\u30f3\u30c6\u30ca\u5185\u3067juju\u304c\u8d77\u52d5\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8(\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u30b5\u30a4\u30ba250MB\u304f\u3089\u3044)\u3092\u3001\u30db\u30b9\u30c8\u5074\u3067\u3042\u3089\u304b\u3058\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u3044\u3066\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u5171\u6709\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3067\u5229\u7528\u3059\u308b\u3002\n\n# \u624b\u9806\n\n\u3067\u306f\u3084\u3063\u3066\u307f\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b7\u30f3\u30b0\u30eb\u30ce\u30fc\u30c9\u3078\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u524d\u63d0\u3067\u3059\u3002[\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://help.ubuntu.com/lts/clouddocs/installer/en/single-install.html)\u3082\u5408\u308f\u305b\u3066\u898b\u3066\u4e0b\u3055\u3044\u3002\n\n\u52d5\u4f5c\u78ba\u8a8d\u306fVMware\u4e0a\u306eUbuntu14.04LTS\u3067\u884c\u3063\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\nhiro@ubuntu14:~$ uname -a\nLinux ubuntu14 4.2.0-27-generic #32~14.04.1-Ubuntu SMP Fri Jan 22 15:32:26 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\nhiro@ubuntu14:~$ openstack-install --version\nopenstack-install 0.99.28\n```\n\n\u4ee5\u4e0b\u3001\u8272\u3005\u89e3\u8aac\u3082\u66f8\u304d\u307e\u3057\u305f\u304c\u3001\u3084\u308b\u3053\u3068\u81ea\u4f53\u306f\u5c11\u306a\u3044\u3067\u3059\u3002\n\n## 1. \u6e96\u5099\n\nopenstack-install\u3092\u5b9f\u884c\u3059\u308b\u76f4\u524d(Start the installation\u306e\u524d)\u307e\u3067\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u901a\u308a\u306b\u9032\u3081\u307e\u3059\u3002\n\n## 2. lxc\u306e\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u6210\u3059\u308b\n\nlxc\u306f\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3059\u308b\u969b\u306b\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u5fc5\u8981\u3068\u3057\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u969b\u306b\u306f\u5185\u90e8\u3067 /usr/share/lxc/templates/lxc-ubuntu-cloud \u304c\u547c\u3070\u308c\u307e\u3059\u3002\u4e2d\u8eab\u306f\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\n\u305d\u3057\u3066\u3001lxc-ubuntu-cloud\u306f\u3055\u3089\u306b\u5185\u90e8\u3067ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u306fcloud-utils\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u542b\u307e\u308c\u308b\u30b3\u30de\u30f3\u30c9\u3067\u3001\u30db\u30b9\u30c8\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30fc\u3084Ubuntu\u306e\u30ea\u30ea\u30fc\u30b9\u540d\u3092\u5143\u306b\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3068rootfs\u306e\u5c55\u958b\u3092\u884c\u3044\u307e\u3059\u3002\u3053\u308c\u3082\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u3059\u3002\n\nubuntu-cloudimg-query\u306f\u74b0\u5883\u5909\u6570 **UBUNTU_CLOUDIMG_QUERY_BASEURL** \u3067\u30df\u30e9\u30fc\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u65e5\u672c\u306e\u30df\u30e9\u30fc\u306b\u306f\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u306f\u30df\u30e9\u30fc\u3055\u308c\u3066\u3044\u308b\u3082\u306e\u306e\u3001ubuntu-cloudimg-query\u304c\u5229\u7528\u3059\u308b[\u30af\u30a8\u30ea\u30d5\u30a1\u30a4\u30eb](http://cloud-images.ubuntu.com/query/)\u3060\u3051\u30df\u30e9\u30fc\u3055\u308c\u3066\u3044\u307e\u305b\u3093(\u306a\u305c\u306a\u306e\u304b...)\n\n\u305d\u3053\u3067\u3001\u4e00\u5ea6\u30df\u30e9\u30fc\u306a\u3057\u3067ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u30ed\u30fc\u30ab\u30eb\u306b\u30af\u30a8\u30ea\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u4f5c\u308a\u3001\u6b21\u306blxc-ubuntu-cloud\u3092\u5b9f\u884c\u3057\u3066\u30df\u30e9\u30fc\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3044\u3046\u6bb5\u968e\u3092\u8e0f\u307f\u307e\u3059\u3002\n\n\u307e\u305a\u3001ubuntu-cloudimg-query\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u7b2c\u4e00\u5f15\u6570\u306fUbuntu\u306e\u30ea\u30ea\u30fc\u30b9\u540d(/etc/lsb-release\u306b\u66f8\u3044\u3066\u3042\u308a\u307e\u3059)\u3001\u7b2c\u4e8c\u5f15\u6570\u306freleased\u3067\u56fa\u5b9a\u3001\u7b2c\u4e09\u5f15\u6570\u306f\u30db\u30b9\u30c8\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3067\u3059\u3002\n\n```shell-session\nhiro@ubuntu14:~$ ubuntu-cloudimg-query trusty released amd64 > /dev/null\n```\n\n\u6b21\u306blxc-ubuntu-cloud\u3067\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\u74b0\u5883\u5909\u6570UBUNTU_CLOUDIMG_QUERY_BASEURL\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u3001\u30df\u30e9\u30fc\u304b\u3089\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u304c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u307e\u3059\u3002path\u30d1\u30e9\u30e1\u30fc\u30bf\u306f\u5fc5\u9808\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u3001\u6307\u5b9a\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306brootfs\u304c\u5c55\u958b\u3055\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u4e0d\u8981\u306a\u306e\u3067\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```shell-session\nUBUNTU_CLOUDIMG_QUERY_BASEURL=http://ubuntutym2.u-toyama.ac.jp/cloud-images/releases sudo -E /usr/share/lxc/templates/lxc-ubuntu-cloud --path=/tmp/hoge\n```\n\n\u305d\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u30a4\u30e1\u30fc\u30b8\u304c/var/cache/lxc/cloud-(\u30ea\u30ea\u30fc\u30b9\u540d)\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```shell-session\nhiro@ubuntu14:~$ sudo ls -l /var/cache/lxc/cloud-trusty\n\u5408\u8a08 122104\ndrwxr-xr-x 22 root root      4096  7\u6708 26 11:59 rootfs\ndrwxr-xr-x  3 root root      4096  7\u6708 26 12:04 tmp\n-rw-r--r--  1 root root 125023208  7\u6708 15 06:03 ubuntu-14.04-server-cloudimg-amd64-root.tar.xz\n```\n\n## 3. \u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u3042\u3089\u304b\u3058\u3081\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304f\n\n\u6b21\u306b\u3001juju\u304clxc\u5185\u90e8\u3067\u4f7f\u7528\u3059\u308b\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u3001\u3042\u3089\u304b\u3058\u3081\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u304d\u307e\u3059\u3002juju\u5185\u90e8\u3067\u306f[uvtool](https://help.ubuntu.com/lts/serverguide/cloud-images-and-uvtool.html)\u304c\u4f7f\u308f\u308c\u3066\u304a\u308a\u3001\u30a4\u30e1\u30fc\u30b8\u306e\u7ba1\u7406\u306b\u306f**uvt-simplestreams-libvirt**\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3044\u307e\u3059\u3002\u3053\u306e\u30b3\u30de\u30f3\u30c9\u3082cloud-images.ubuntu.com\u304b\u3089\u30a4\u30e1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u306e\u3067\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002\u30df\u30e9\u30fc\u306e\u6307\u5b9a\u306f--source\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u884c\u3044\u307e\u3059\u3002\n\n\u7d50\u8ad6\u3068\u3057\u3066\u3001\u6b8b\u5ff5\u306a\u304c\u3089juju\u3092\u4f7f\u3046\u5834\u5408\u306b\u304a\u3044\u3066--source\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3059\u308b\u65b9\u6cd5\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u306e\u3042\u305f\u308a\u3067\u3059\u3002\n\nhttps://github.com/juju/juju/blob/69d8569f1da7a360851dc79d8b76549562e1b326/container/kvm/libvirt.go#L59\nhttps://github.com/juju/juju/blob/69d8569f1da7a360851dc79d8b76549562e1b326/container/kvm/kvm.go#L146\n\n\n\u306a\u306e\u3067\u65b9\u6cd5\u8ad6\u3068\u3057\u3066\u3001\u30db\u30b9\u30c8\u5074\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30e1\u30fc\u30b8\u3092\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304a\u3044\u3066\u3001\u305d\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(/var/lib/uvtool)\u3092lxc\u30b3\u30f3\u30c6\u30ca\u5185\u306ejuju\u3068\u5171\u6709\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nuvtool\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```shell-session\nhiro@ubuntu14:~$ sudo apt-get install uvtool\n```\n\n\u4eee\u60f3\u30de\u30b7\u30f3\u30a4\u30e1\u30fc\u30b8\u3092\u30df\u30e9\u30fc\u304b\u3089\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b(\u30aa\u30d7\u30b7\u30e7\u30f3\u306erelease\u3068arch\u306f\u4f7f\u3063\u3066\u3044\u308b\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u5408\u308f\u305b\u3066\u4e0b\u3055\u3044\u3002)\n \n```\nhiro@ubuntu14:~$ uvt-simplestreams-libvirt sync --source=http://ubuntutym2.u-toyama.ac.jp/cloud-images/releases arch=amd64 release=trusty\n```\n\n\u4f55\u3082\u51fa\u529b\u3055\u308c\u307e\u305b\u3093\u304c\u3001/var/lib/uvtool/ \u914d\u4e0b\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```shell-session\nhiro@ubuntu14:~$ ls -l /var/lib/uvtool/libvirt/images/\n\u5408\u8a08 845196\ndrwxr-xr-x 2 root      root          4096  7\u6708 26 19:24 ./\ndrwxr-xr-x 4 root      root          4096  7\u6708 26 12:48 ../\n-rw------- 1 pollinate libvirtd 865468416  7\u6708 26 16:40 x-uvt-b64-Y29tLnVidW50dS5jbG91ZDpzZXJ2ZXI6MTQuMDQ6YW1kNjQgMjAxNjA3MTQ=\n```\n\n## 4. cloud-init\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u4fee\u6b63\u3059\u308b\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u4f7f\u3046cloud-init\u306euser-data\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002 \u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u30db\u30b9\u30c8\u306euvtool\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30db\u30fc\u30e0\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30de\u30a6\u30f3\u30c8\u3059\u308b\u306e\u3067\u3001/var/lib/\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u308b\u5fc5\u8981\u304c\u3042\u308b\u304b\u3089\u3067\u3059\u3002\n\n```shell-session\nsudo vi /usr/share/openstack/templates/userdata.yaml\n```\n\n\u6700\u4e0b\u884c\u306b\u4ee5\u4e0b\u306e\u4e00\u884c\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002YAML\u306a\u306e\u3067\u30a4\u30f3\u30c7\u30f3\u30c8\u306b\u6ce8\u610f\u3067\u3059\u3002\n\n```yaml\n{%- if https_proxy %}\n  - echo \"export https_proxy={{ https_proxy }}\" >> /home/ubuntu/.bashrc\n  - echo \"export HTTPS_PROXY={{ https_proxy }}\" >> /home/ubuntu/.bashrc\n{%- endif %}\n  - \"chown ubuntu:ubuntu /home/ubuntu /home/ubuntu/.bashrc\"\n  - \"ln -s /home/ubuntu/uvtool /var/lib/uvtool\"              \u2190 \u3053\u306e\u884c\n```\n\n## 5. openstack-install\u3092\u5b9f\u884c\u3059\u308b\n\n\u3088\u3046\u3084\u304fOpenStack\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u958b\u59cb\u3067\u3059\uff01 openstack-install\u3092\u5b9f\u884c\u3059\u308b\u969b\u306b\u3001\u74b0\u5883\u5909\u6570\u30922\u3064\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n```shell-session\nEXTRA_BIND_DIRS=/var/lib/uvtool USE_LXC_IMAGE_CACHE=1 sudo -E openstack-install\n```\n\nsudo\u306b-E\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\u3053\u3068\u304c\u5fc5\u9808\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308asudo\u304b\u3089\u8d77\u52d5\u3057\u305f\u30b3\u30de\u30f3\u30c9\u306b\u74b0\u5883\u5909\u6570\u304c\u5f15\u304d\u7d99\u304c\u308c\u307e\u3059\u3002\n\nEXTRA_BIND_DIRS\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u4f5c\u6210\u3059\u308blxc\u30b3\u30f3\u30c6\u30ca\u304c\u3001\u30db\u30b9\u30c8\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u3088\u3046\u6307\u5b9a\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3059\u3002\u30db\u30b9\u30c8\u306euvtool\u306e\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30f3\u30c6\u30ca\u5185\u304b\u3089\u4f7f\u7528\u3059\u308b\u305f\u3081\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30d8\u30eb\u30d7\u306b\u306f\u66f8\u3044\u3066\u306a\u304f\u30b3\u30fc\u30c9\u5185\u306b\u3042\u308a\u307e\u3059\u3002\n\nhttps://github.com/Ubuntu-Solutions-Engineering/openstack-installer/blob/350445f5a7fdb7f42b7c97f14eb77813ecf816a2/cloudinstall/controllers/install/single.py#L225\n\nUSE_LXC_IMAGE_CACHE\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304clxc\u30a4\u30e1\u30fc\u30b8\u3092\u8d77\u52d5\u3059\u308b\u969b\u306b\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3055\u308c\u305f\u30a4\u30e1\u30fc\u30b8\u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u3046\u3053\u3068\u3092\u5f37\u5236\u3059\u308b\u3082\u306e\u3067\u3059\u3002\u6319\u52d5\u3068\u3057\u3066\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u30fc\u304c\u5185\u90e8\u3067\u8d77\u52d5\u3059\u308blxc-create\u304b\u3089-F\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u9664\u5916\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u6307\u5b9a\u3057\u306a\u3044\u3068\u3001openstack-install\u3092\u5b9f\u884c\u3059\u308b\u5ea6\u306b\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304c\u884c\u308f\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u8a18\u8ff0\u304c\u3042\u308a\u307e\u3059(Additional Tips\u306e\u3068\u3053\u308d)\n\nhttps://help.ubuntu.com/lts/clouddocs/installer/en/single-install.html\n\n\n\n\u3042\u3068\u306f\u901a\u5e38\u901a\u308a\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u9032\u3081\u308b\u3060\u3051\u3067\u3059\uff01 \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u9593\u304c\u304b\u306a\u308a\u77ed\u304f\u306a\u3063\u3066\u308b\u306f\u305a\u3067\u3059(\u6570\u5341\u5206\u3067\u7d42\u308f\u308b)\n"}