{"context": "\u3053\u3093\u306b\u3061\u306f\u3002\n\u524d\u56de\u306e\u8a18\u4e8b\uff08\u4e0b\u8a18\uff09\u306b\u5f15\u304d\u7d9a\u304d\u3001Pig on Tez on CDH\u306e\u304a\u8a66\u3057\u3067\u3059\u3002\nhttp://qiita.com/kimutansk/items/8a91baf476fff4232634\n\nPig on Tez on CDH\u3067GPL\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\u7406\u7531\nPig\u3092\u4f7f\u3046\u969b\u3001\u524d\u63d0\u3068\u306a\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3084\u8a2d\u5b9a\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\nPig UDF\u306e\u5834\u5408\u306fPig Script\u4e2d\u3067\u660e\u793a\u7684\u306b\u30ed\u30fc\u30c9\u3092\u884c\u3046\u305f\u3081\u3001\nHDFS\u4e0a\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u3070\u3001Tez\u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u3066\u3082\u554f\u984c\u306a\u304f\u53ef\u80fd\u3067\u3057\u3087\u3046\u3002\n\u305f\u3060\u3001\u7279\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u305f\u3081\u306b\u30af\u30e9\u30b9\u304c\u8a2d\u5b9a\u3057\u3066\u6307\u5b9a\u3055\u308c\u3066\u30ed\u30fc\u30c9\u3055\u308c\u308b\u30b1\u30fc\u30b9\u3001\n\u4f8b\u3048\u3070Lzo\u306a\u3093\u304b\u3092\u3069\u3046\u3084\u3063\u3066\u8a2d\u5b9a\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u306b\u3064\u3044\u3066\u306f\u7591\u554f\u304c\u6b8b\u308a\u307e\u3059\u3002\n\u3067\u3059\u306e\u3067\u3001\u5b9f\u969b\u306b\u3084\u3063\u3066\u307f\u3088\u3046\u3001\u3068\u3044\u3046\u5f62\u3067\u3059\u3002\n\n\u5fc5\u8981\u74b0\u5883\uff0f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u524d\u63d0\u3068\u3059\u308b\u74b0\u5883\u3068\u3057\u3066\u3001Lzo\u3092\u542b\u3080GPLEXTRA\u306eParcel\u3092\u5c0e\u5165\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nCloudera Manager\u306e\u30c8\u30c3\u30d7\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cParcel\u300d\uff1e\u300c\u8a2d\u5b9a\u300d\u3092\u9078\u629e\u3057\u3001\u4e0b\u8a18\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nhttps://archive.cloudera.com/gplextras5/parcels/{latest_supported}\n\u4e0b\u8a18\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3055\u308c\u308b\u5f62\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\n\u8ffd\u52a0\u3057\u305f\u4e0a\u3067\u300c\u65b0\u3057\u3044Percel \u306e\u30c1\u30a7\u30c3\u30af\u300d\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u300cGPLEXTRAS\u300d\u304c\u4e00\u89a7\u306b\u51fa\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u308c\u3092\u300c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\uff1e\u300c\u914d\u5e03\u300d\uff1e\u300c\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u300d\u3068\u5b9f\u884c\u3057\u3066\u6709\u52b9\u5316\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5bfe\u3059\u308b\u8a2d\u5b9a\u5b9f\u65bd\n\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306f\u8a2d\u5b9a\u3067\u3059\u3002\n\u8a72\u5f53\u306e\u30af\u30e9\u30b9\u30bf\u3067\u300cHDFS\u300d\uff1e\u300c\u8a2d\u5b9a\u300d\u3092\u9078\u629e\u3057\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u9805\u76ee\u306b\u5024\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n\u8a2d\u5b9a\u9805\u76ee\uff1aio.compression.codecs\n\u8ffd\u52a0\u5185\u5bb9\uff1acom.hadoop.compression.lzo.LzoCodec\n\u8ffd\u52a0\u5185\u5bb9\uff1acom.hadoop.compression.lzo.LzopCodec\n\n\n\u8ffd\u52a0\u3057\u305f\u3089\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u8a2d\u5b9a\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n- /etc/hadoop/conf/core-site.xml\n\n\u8aad\u307f\u8fbc\u307f\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff0f\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u5b9f\u969b\u306b\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u3001\u524d\u56de\u4f7f\u7528\u3057\u305f data_noheader.csv \u3092\u5727\u7e2e\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo yum install -y lzop\n$ lzop data_noheader.csv\n\n\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb( data_noheader.csv.lzo )\u3092HDFS\u306e /user/pub/example-lzo \u914d\u4e0b\u306b\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\nPig\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\uff1e\u5931\u6557\nPig\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u3001\u5b9f\u884c\u3057\u307e\u3059\u3002\n\ntest-lzo-count.pig\nloadresult = LOAD '/user/pub/example-lzo';\nlimitedresult = LIMIT loadresult 10;\nlogs_count = FOREACH (GROUP loadresult ALL) GENERATE COUNT(loadresult);\nDUMP logs_count\nDUMP limitedresult;\n\n\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\u6848\u306e\u5b9a\u3068\u3044\u3046\u304b\u3001\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u5b9f\u884c\u306f\u5931\u6557\u3057\u307e\u3059\u3002\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 18:44:47,043 [PigTezLauncher-0] INFO  org.apache.pig.backend.hadoop.executionengine.tez.TezJob - DAG Status: status=FAILED, progress=TotalTasks: 2 Succeeded: 0 Running: 0 Failed: 1 Killed: 1 FailedTaskAttempts: 4, diagnostics=Vertex failed, vertexName=scope-10, vertexId=vertex_1461490474710_0001_1_00, diagnostics=[Task failed, taskId=task_1461490474710_0001_1_00_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: exceptionThrown=java.lang.IllegalArgumentException: Compression codec com.hadoop.compression.lzo.LzoCodec not found.\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.getCodecClasses(CompressionCodecFactory.java:135)\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.<init>(CompressionCodecFactory.java:175)\n        at org.apache.hadoop.mapreduce.lib.input.LineRecordReader.initialize(LineRecordReader.java:87)\n        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.initialize(PigRecordReader.java:181)\n        at org.apache.tez.mapreduce.lib.MRReaderMapReduce.setupNewRecordReader(MRReaderMapReduce.java:152)\n        at org.apache.tez.mapreduce.lib.MRReaderMapReduce.setSplit(MRReaderMapReduce.java:85)\n        at org.apache.tez.mapreduce.input.MRInput.initFromEventInternal(MRInput.java:614)\n        at org.apache.tez.mapreduce.input.MRInput.processSplitEvent(MRInput.java:566)\n        at org.apache.tez.mapreduce.input.MRInput.handleEvents(MRInput.java:530)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.handleEvent(LogicalIOProcessorRuntimeTask.java:631)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.access$600(LogicalIOProcessorRuntimeTask.java:98)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask$1.runInternal(LogicalIOProcessorRuntimeTask.java:694)\n        at org.apache.tez.common.RunnableWithNdc.run(RunnableWithNdc.java:35)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ClassNotFoundException: Class com.hadoop.compression.lzo.LzoCodec not found\n        at org.apache.hadoop.conf.Configuration.getClassByName(Configuration.java:1980)\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.getCodecClasses(CompressionCodecFactory.java:128)\n        ... 13 more\n(\u7701\u7565)\n]], Vertex did not succeed due to OWN_TASK_FAILURE, failedTasks:1 killedTasks:0, Vertex vertex_1461490474710_0001_1_00 [scope-10] killed/failed due to:null]\nVertex killed, vertexName=scope-11, vertexId=vertex_1461490474710_0001_1_01, diagnostics=[Vertex received Kill while in RUNNING state., Vertex did not succeed due to OTHER_VERTEX_FAILURE, failedTasks:0 killedTasks:1, Vertex vertex_1461490474710_0001_1_01 [scope-11] killed/failed due to:null]\nDAG did not succeed due to VERTEX_FAILURE. failedVertices:1 killedVertices:1, counters=Counters: 4\n        org.apache.tez.common.counters.DAGCounter\n                NUM_FAILED_TASKS=4\n                TOTAL_LAUNCHED_TASKS=4\n                AM_CPU_MILLISECONDS=1730\n                AM_GC_TIME_MILLIS=56\n\nPigTezLauncher\u306e\u6bb5\u968e\u3067Hadoop\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3060\u969b\u306b\u3053\u3051\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\u304b\u3064\u3001Tez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u3067\u3082\u540c\u7a2e\u306e\u30a8\u30e9\u30fc\u306f\u767a\u751f\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3089\u3001\u4e0b\u8a18\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\nPig\u8d77\u52d5\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\nTez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n\nPig on Tez\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\nPig\u8d77\u52d5\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n\u3053\u308c\u306fPig\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u982d\u306b\u8ffd\u52a0\u3057\u3066\u3082\u3001\nTez\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u306f\u3063\u3066\u3082\u3069\u3061\u3089\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\nPig\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u8ffd\u52a0\u3057\u305f\u306e\u306f\u5b8c\u5168\u306bTez\u306e\u8a2d\u5b9a\u3067\u3059\u306e\u3067\u3001Tez\u3092\u4f7f\u3046\u306e\u306f\u78ba\u5b9a\u3060\u308d\u3046\u3001\n\u3068\u3044\u3046\u3053\u3068\u3067\u5f8c\u8005\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\n$ ln -s /opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar /opt/tez-lib/hadoop-lzo.jar\n\n\nTez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n/opt/tez-conf/tez-site.xml \u306b\u4e0b\u8a18\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\ntez-site.xml\n  <property>\n      <name>tez.cluster.additional.classpath.prefix</name>\n      <value>/opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar</value>\n  </property>\n\n\n\nPig\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u518d\u5b9f\u884c\n\u518d\u5ea6hdfs\u30e6\u30fc\u30b6\u3067Pig\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\u3059\u308b\u3068\u30fb\u30fb\u30fb\n\nhdfs\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n\uff08\u7701\u7565\uff09\n2016-04-24 20:03:40,460 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: hdfs\n            FileName: /tmp/test-lzo-count.pig\n           StartedAt: 2016-04-24 20:03:28\n          FinishedAt: 2016-04-24 20:03:40\n            Features: GROUP_BY\n\nSuccess!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0014\n  TotalLaunchedTasks: 2\n       FileBytesRead: 99\n    FileBytesWritten: 67\n       HdfsBytesRead: 61480\n    HdfsBytesWritten: 7\n\nInput(s):\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n\nOutput(s):\nSuccessfully stored 1 records (7 bytes) in: \"hdfs://hadoophost01:8020/tmp/temp-1823417929/tmp552056591\"\n(1744)\n(1871-01-01,4.44,0.26,0.4,12.46,5.32,84.52,4.95,7.61,,,,,,,)\n(1871-02-01,4.5,0.26,0.4,12.84,5.32,83.12,4.8,7.39,,,,,,,)\n(1871-03-01,4.61,0.26,0.4,13.03,5.33,83.91,4.73,7.28,,,,,,,)\n(1871-04-01,4.74,0.26,0.4,12.56,5.33,89.54,4.91,7.56,,,,,,,)\n(1871-05-01,4.86,0.26,0.4,12.27,5.33,93.95,5.03,7.73,,,,,,,)\n(1871-06-01,4.82,0.26,0.4,12.08,5.34,94.64,5.11,7.85,,,,,,,)\n(1871-07-01,4.73,0.26,0.4,12.08,5.34,92.87,5.11,7.85,,,,,,,)\n(1871-08-01,4.79,0.26,0.4,11.89,5.34,95.56,5.19,7.98,,,,,,,)\n(1871-09-01,4.84,0.26,0.4,12.18,5.35,94.29,5.07,7.79,,,,,,,)\n(1871-10-01,4.59,0.26,0.4,12.37,5.35,88.04,4.99,7.67,,,,,,,)\n\n\n\u5b9f\u884c\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u524d\u56de\u3068\u6bd4\u3079\u308b\u3068\u3001\u8aad\u8fbc\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u308f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u78ba\u304b\u306b\u5727\u7e2e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3060\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n\u524d\u56de\u7d50\u679c\nSuccessfully read 1744 records (116662 bytes) from: \"/user/pub/example-data\"\n\n\n\n\u4eca\u56de\u7d50\u679c\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n\n\n\n\u304c\u3001\u3057\u304b\u3057\u30fb\u30fb\u30fb\uff1f\n\u305f\u3060\u3001\u3053\u3053\u3067\u4e0a\u624b\u304f\u884c\u3063\u305f\u3068\u601d\u3063\u3066\u5225\u306e\u30e6\u30fc\u30b6\uff08\u4eca\u56de\u306f\u30d3\u30eb\u30c9\u7528\u30e6\u30fc\u30b6\u306ebuild\uff09\u3067\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001\n\u4f55\u6545\u304b\u8aad\u8fbc\u306b\u5931\u6557\u3059\u308b\u4e8b\u8c61\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n\nbuild\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\uff1e\u5931\u6557\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 20:13:44,815 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: build\n            FileName: test-lzo-count.pig\n           StartedAt: 2016-04-24 20:13:26\n          FinishedAt: 2016-04-24 20:13:44\n            Features: GROUP_BY\n\nFailed!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0015\n  TotalLaunchedTasks: 4\n       FileBytesRead: 0\n    FileBytesWritten: 0\n       HdfsBytesRead: 0\n    HdfsBytesWritten: 0\n\nInput(s):\nFailed to read data from \"/user/pub/example-lzo\"\n\nOutput(s):\nFailed to produce result in \"hdfs://hadoophost01:8020/tmp/temp-1843801261/tmp-1479312519\"\n\n2016-04-24 20:13:44,912 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1066: Unable to open iterator for alias logs_count. Backend error : Vertex failed, vertexName=scope-10, vertexId=vertex_1461490474710_0015_1_00, diagnostics=[Task failed, taskId=task_1461490474710_0015_1_00_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: exceptionThrown=java.lang.IllegalArgumentException: Compression codec com.hadoop.compression.lzo.LzoCodec not found.\n\n\n\n\u9055\u3044\u306f\u3069\u3053\u306b\u3042\u308b\uff1f\n\u3069\u3053\u306b\u9055\u3044\u304c\u3042\u308b\u306e\u304b\u3056\u3063\u3068\u8ffd\u3063\u3066\u307f\u308b\u3068\u3001\u4e0b\u8a18\u306e\uff12\u3064\u306e\u6642\u70b9\u3067\u5dee\u5206\u304c\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n1. YARN\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\uff08YARN\u306e\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\uff09\n\n\nbuild\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u305f\u5074\u306f tez.cluster.additional.classpath.prefix \u306e\u8a2d\u5b9a\u304c\u306a\u3044\n\n\n2. Pig\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u305fTezClient\u4e2d\u306e\u51e6\u7406\uff08\u30ea\u30e2\u30fc\u30c8\u30c7\u30d0\u30c3\u30b0\uff09\n\n\nbuild\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u305f\u5074\u306f tez.cluster.additional.classpath.prefix \u306e\u8a2d\u5b9a\u304c\u306a\u3044\n\n\n\n\u3064\u307e\u308a\u306fHadoop\u30b3\u30de\u30f3\u30c9 > Pig > Tez\u3068\u306a\u308b\u4e2d\u3067\u8a2d\u5b9a\u304c\u6b20\u843d\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\n\u3056\u3063\u3068\u30c7\u30d0\u30c3\u30b0\u3057\u305f\u6642\u70b9\u3067\u306f\u7d50\u8ad6\u306f\u898b\u3048\u305a\u3068\u3044\u3046\u72b6\u6cc1\u3002\n\u3067\u3059\u306e\u3067\u3001Pig\u304c\u8aad\u307f\u8fbc\u3093\u3067Hadoop\u306e\u8a2d\u5b9a\u306b\u542b\u3081\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306e pig.properties \u306b\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n$ echo \"tez.cluster.additional.classpath.prefix=/opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar\" >> /opt/pig/conf/pig.properties\n\n\n\u518d\u5ea6\u5b9f\u884c\n\u3059\u308b\u3068\u30fb\u30fb\u30fb\uff1f\n\nbuild\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\uff1e\u6210\u529f\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 22:16:17,439 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: build\n            FileName: test-lzo-count.pig\n           StartedAt: 2016-04-24 22:16:06\n          FinishedAt: 2016-04-24 22:16:17\n            Features: GROUP_BY\n\nSuccess!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0025\n  TotalLaunchedTasks: 2\n       FileBytesRead: 99\n    FileBytesWritten: 67\n       HdfsBytesRead: 61480\n    HdfsBytesWritten: 7\n\nInput(s):\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n\nOutput(s):\nSuccessfully stored 1 records (7 bytes) in: \"hdfs://hadoophost01:8020/tmp/temp-1901693688/tmp-778527532\"\n\n(1744)\n(1871-01-01,4.44,0.26,0.4,12.46,5.32,84.52,4.95,7.61,,,,,,,)\n(1871-02-01,4.5,0.26,0.4,12.84,5.32,83.12,4.8,7.39,,,,,,,)\n(1871-03-01,4.61,0.26,0.4,13.03,5.33,83.91,4.73,7.28,,,,,,,)\n(1871-04-01,4.74,0.26,0.4,12.56,5.33,89.54,4.91,7.56,,,,,,,)\n(1871-05-01,4.86,0.26,0.4,12.27,5.33,93.95,5.03,7.73,,,,,,,)\n(1871-06-01,4.82,0.26,0.4,12.08,5.34,94.64,5.11,7.85,,,,,,,)\n(1871-07-01,4.73,0.26,0.4,12.08,5.34,92.87,5.11,7.85,,,,,,,)\n(1871-08-01,4.79,0.26,0.4,11.89,5.34,95.56,5.19,7.98,,,,,,,)\n(1871-09-01,4.84,0.26,0.4,12.18,5.35,94.29,5.07,7.79,,,,,,,)\n(1871-10-01,4.59,0.26,0.4,12.37,5.35,88.04,4.99,7.67,,,,,,,)\n\n\npig.properties \u306b\u8a2d\u5b9a\u3057\u305f\u5206\u306fbuild\u30e6\u30fc\u30b6\u3067\u3082\u554f\u984c\u306a\u304f\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u5dee\u5206\u304c\u767a\u751f\u3059\u308b\u539f\u56e0\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u89e3\u6d88\u306f\u3067\u304d\u305f\u3001\u3068\u3044\u3046\u5f62\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\u30af\u30e9\u30b9\u30d1\u30b9\u304b\u3089Hadoop\u8a2d\u5b9a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u3068\u304d\u306e\u6319\u52d5\u306e\u5dee\u306e\u3088\u3046\u3067\u3059\u304c\u3001\n\u3053\u308c\u306f\u6c17\u9577\u306b\u8ffd\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u30fb\u30fb\u30fb\n\n\u307e\u3068\u3081\n\nPig on Tez\u306bLzo\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\n\n\nPig on Tez\u8d77\u52d5\u6642\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3081\u308b\nTez\u52d5\u4f5c\u6642\u306e\u8ffd\u52a0\u30af\u30e9\u30b9\u30d1\u30b9( tez-site.xml )\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3081\u308b\n\n\n\u305f\u3060\u3057\u3001\u4e00\u90e8\u306e\u30e6\u30fc\u30b6\u3067\u306f tez-site.xml \u306b\u542b\u3081\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044\uff08\u539f\u56e0\u304c\u73fe\u72b6\u4e0d\u660e\uff09\n\u4e0a\u8a18\u306e\u5834\u5408\u3001 pig.properties \u306b\u8a18\u8ff0\u3059\u308c\u3070\u52d5\u4f5c\u3059\u308b\u3002 \n\n\n\n\n\n\u3053\u3093\u306b\u3061\u306f\u3002\n\n\u524d\u56de\u306e\u8a18\u4e8b\uff08\u4e0b\u8a18\uff09\u306b\u5f15\u304d\u7d9a\u304d\u3001Pig on Tez on CDH\u306e\u304a\u8a66\u3057\u3067\u3059\u3002\nhttp://qiita.com/kimutansk/items/8a91baf476fff4232634\n\n## Pig on Tez on CDH\u3067GPL\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\u7406\u7531\nPig\u3092\u4f7f\u3046\u969b\u3001\u524d\u63d0\u3068\u306a\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3084\u8a2d\u5b9a\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308b\u30b1\u30fc\u30b9\u304c\u3042\u308b\u305f\u3081\u3067\u3059\u3002\n\nPig UDF\u306e\u5834\u5408\u306fPig Script\u4e2d\u3067\u660e\u793a\u7684\u306b\u30ed\u30fc\u30c9\u3092\u884c\u3046\u305f\u3081\u3001\nHDFS\u4e0a\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u30a2\u30c3\u30d7\u3057\u3066\u304a\u3051\u3070\u3001Tez\u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u3066\u3082\u554f\u984c\u306a\u304f\u53ef\u80fd\u3067\u3057\u3087\u3046\u3002\n\n\u305f\u3060\u3001\u7279\u5b9a\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u6271\u3046\u305f\u3081\u306b\u30af\u30e9\u30b9\u304c\u8a2d\u5b9a\u3057\u3066\u6307\u5b9a\u3055\u308c\u3066\u30ed\u30fc\u30c9\u3055\u308c\u308b\u30b1\u30fc\u30b9\u3001\n\u4f8b\u3048\u3070Lzo\u306a\u3093\u304b\u3092\u3069\u3046\u3084\u3063\u3066\u8a2d\u5b9a\u3059\u308c\u3070\u3044\u3044\u306e\u304b\u306b\u3064\u3044\u3066\u306f\u7591\u554f\u304c\u6b8b\u308a\u307e\u3059\u3002\n\n\u3067\u3059\u306e\u3067\u3001\u5b9f\u969b\u306b\u3084\u3063\u3066\u307f\u3088\u3046\u3001\u3068\u3044\u3046\u5f62\u3067\u3059\u3002\n\n### \u5fc5\u8981\u74b0\u5883\uff0f\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u524d\u63d0\u3068\u3059\u308b\u74b0\u5883\u3068\u3057\u3066\u3001Lzo\u3092\u542b\u3080GPLEXTRA\u306eParcel\u3092\u5c0e\u5165\u3057\u3066\u304a\u304f\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\nCloudera Manager\u306e\u30c8\u30c3\u30d7\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cParcel\u300d\uff1e\u300c\u8a2d\u5b9a\u300d\u3092\u9078\u629e\u3057\u3001\u4e0b\u8a18\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nhttps://archive.cloudera.com/gplextras5/parcels/{latest_supported}\n\n\u4e0b\u8a18\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u3088\u3046\u306b\u8ffd\u52a0\u3055\u308c\u308b\u5f62\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n![ParcelSetting.JPG](https://qiita-image-store.s3.amazonaws.com/0/9616/ad97210a-d7e2-697c-397a-bc1a2873f8fe.jpeg)\n\n\u8ffd\u52a0\u3057\u305f\u4e0a\u3067\u300c\u65b0\u3057\u3044Percel \u306e\u30c1\u30a7\u30c3\u30af\u300d\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u300cGPLEXTRAS\u300d\u304c\u4e00\u89a7\u306b\u51fa\u3066\u304d\u307e\u3059\u306e\u3067\u3001\n\u305d\u308c\u3092\u300c\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u300d\uff1e\u300c\u914d\u5e03\u300d\uff1e\u300c\u30a2\u30af\u30c6\u30a3\u30d6\u5316\u300d\u3068\u5b9f\u884c\u3057\u3066\u6709\u52b9\u5316\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u5bfe\u3059\u308b\u8a2d\u5b9a\u5b9f\u65bd\n\u30d1\u30c3\u30b1\u30fc\u30b8\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306f\u8a2d\u5b9a\u3067\u3059\u3002\n\u8a72\u5f53\u306e\u30af\u30e9\u30b9\u30bf\u3067\u300cHDFS\u300d\uff1e\u300c\u8a2d\u5b9a\u300d\u3092\u9078\u629e\u3057\u3001\u4e0b\u8a18\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u9805\u76ee\u306b\u5024\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n- \u8a2d\u5b9a\u9805\u76ee\uff1aio.compression.codecs\n- \u8ffd\u52a0\u5185\u5bb9\uff1acom.hadoop.compression.lzo.LzoCodec\n- \u8ffd\u52a0\u5185\u5bb9\uff1acom.hadoop.compression.lzo.LzopCodec\n\n![HDFSSetting.JPG](https://qiita-image-store.s3.amazonaws.com/0/9616/b6f92a5b-8d34-a4ab-fa23-0814290f7dd6.jpeg)\n\n\u8ffd\u52a0\u3057\u305f\u3089\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u3059\u308b\u3068\u3001\u4e0b\u8a18\u306e\u30d5\u30a1\u30a4\u30eb\u4e2d\u306e\u8a2d\u5b9a\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n- /etc/hadoop/conf/core-site.xml\n\n### \u8aad\u307f\u8fbc\u307f\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff0f\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u5b9f\u969b\u306b\u8aad\u307f\u8fbc\u3080\u305f\u3081\u306e\u30d5\u30a1\u30a4\u30eb\u3068\u3057\u3066\u3001\u524d\u56de\u4f7f\u7528\u3057\u305f `data_noheader.csv` \u3092\u5727\u7e2e\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u4e0b\u8a18\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u5727\u7e2e\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo yum install -y lzop\n$ lzop data_noheader.csv\n```\n\n\u4f5c\u6210\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb( `data_noheader.csv.lzo` )\u3092HDFS\u306e `/user/pub/example-lzo` \u914d\u4e0b\u306b\u30a2\u30c3\u30d7\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n### Pig\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9f\u884c\uff1e\u5931\u6557\nPig\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e0b\u8a18\u306e\u3088\u3046\u306b\u4fee\u6b63\u3057\u3001\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash:test-lzo-count.pig\nloadresult = LOAD '/user/pub/example-lzo';\nlimitedresult = LIMIT loadresult 10;\nlogs_count = FOREACH (GROUP loadresult ALL) GENERATE COUNT(loadresult);\nDUMP logs_count\nDUMP limitedresult;\n```\n\n```bash\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n```\n\n\u5b9f\u884c\u3059\u308b\u3068\u3001\u6848\u306e\u5b9a\u3068\u3044\u3046\u304b\u3001\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u5b9f\u884c\u306f\u5931\u6557\u3057\u307e\u3059\u3002\n\n```shell-session\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 18:44:47,043 [PigTezLauncher-0] INFO  org.apache.pig.backend.hadoop.executionengine.tez.TezJob - DAG Status: status=FAILED, progress=TotalTasks: 2 Succeeded: 0 Running: 0 Failed: 1 Killed: 1 FailedTaskAttempts: 4, diagnostics=Vertex failed, vertexName=scope-10, vertexId=vertex_1461490474710_0001_1_00, diagnostics=[Task failed, taskId=task_1461490474710_0001_1_00_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: exceptionThrown=java.lang.IllegalArgumentException: Compression codec com.hadoop.compression.lzo.LzoCodec not found.\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.getCodecClasses(CompressionCodecFactory.java:135)\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.<init>(CompressionCodecFactory.java:175)\n        at org.apache.hadoop.mapreduce.lib.input.LineRecordReader.initialize(LineRecordReader.java:87)\n        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigRecordReader.initialize(PigRecordReader.java:181)\n        at org.apache.tez.mapreduce.lib.MRReaderMapReduce.setupNewRecordReader(MRReaderMapReduce.java:152)\n        at org.apache.tez.mapreduce.lib.MRReaderMapReduce.setSplit(MRReaderMapReduce.java:85)\n        at org.apache.tez.mapreduce.input.MRInput.initFromEventInternal(MRInput.java:614)\n        at org.apache.tez.mapreduce.input.MRInput.processSplitEvent(MRInput.java:566)\n        at org.apache.tez.mapreduce.input.MRInput.handleEvents(MRInput.java:530)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.handleEvent(LogicalIOProcessorRuntimeTask.java:631)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask.access$600(LogicalIOProcessorRuntimeTask.java:98)\n        at org.apache.tez.runtime.LogicalIOProcessorRuntimeTask$1.runInternal(LogicalIOProcessorRuntimeTask.java:694)\n        at org.apache.tez.common.RunnableWithNdc.run(RunnableWithNdc.java:35)\n        at java.lang.Thread.run(Thread.java:745)\nCaused by: java.lang.ClassNotFoundException: Class com.hadoop.compression.lzo.LzoCodec not found\n        at org.apache.hadoop.conf.Configuration.getClassByName(Configuration.java:1980)\n        at org.apache.hadoop.io.compress.CompressionCodecFactory.getCodecClasses(CompressionCodecFactory.java:128)\n        ... 13 more\n(\u7701\u7565)\n]], Vertex did not succeed due to OWN_TASK_FAILURE, failedTasks:1 killedTasks:0, Vertex vertex_1461490474710_0001_1_00 [scope-10] killed/failed due to:null]\nVertex killed, vertexName=scope-11, vertexId=vertex_1461490474710_0001_1_01, diagnostics=[Vertex received Kill while in RUNNING state., Vertex did not succeed due to OTHER_VERTEX_FAILURE, failedTasks:0 killedTasks:1, Vertex vertex_1461490474710_0001_1_01 [scope-11] killed/failed due to:null]\nDAG did not succeed due to VERTEX_FAILURE. failedVertices:1 killedVertices:1, counters=Counters: 4\n        org.apache.tez.common.counters.DAGCounter\n                NUM_FAILED_TASKS=4\n                TOTAL_LAUNCHED_TASKS=4\n                AM_CPU_MILLISECONDS=1730\n                AM_GC_TIME_MILLIS=56\n```\n\nPigTezLauncher\u306e\u6bb5\u968e\u3067Hadoop\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3060\u969b\u306b\u3053\u3051\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u306d\u3002\n\u304b\u3064\u3001Tez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u3067\u3082\u540c\u7a2e\u306e\u30a8\u30e9\u30fc\u306f\u767a\u751f\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3089\u3001\u4e0b\u8a18\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\n\n- Pig\u8d77\u52d5\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n- Tez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n### Pig on Tez\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\n\n- Pig\u8d77\u52d5\u30d7\u30ed\u30bb\u30b9\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n\u3053\u308c\u306fPig\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u982d\u306b\u8ffd\u52a0\u3057\u3066\u3082\u3001\nTez\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u306f\u3063\u3066\u3082\u3069\u3061\u3089\u3067\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\nPig\u306e\u8d77\u52d5\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u8ffd\u52a0\u3057\u305f\u306e\u306f\u5b8c\u5168\u306bTez\u306e\u8a2d\u5b9a\u3067\u3059\u306e\u3067\u3001Tez\u3092\u4f7f\u3046\u306e\u306f\u78ba\u5b9a\u3060\u308d\u3046\u3001\n\u3068\u3044\u3046\u3053\u3068\u3067\u5f8c\u8005\u3067\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n```\n$ ln -s /opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar /opt/tez-lib/hadoop-lzo.jar\n```\n\n- Tez\u306eYARN\u30b3\u30f3\u30c6\u30ca\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u8ffd\u52a0\n\n`/opt/tez-conf/tez-site.xml` \u306b\u4e0b\u8a18\u306e\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```xml:tez-site.xml\n  <property>\n      <name>tez.cluster.additional.classpath.prefix</name>\n      <value>/opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar</value>\n  </property>\n```\n\n### Pig\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u518d\u5b9f\u884c\n\u518d\u5ea6**hdfs\u30e6\u30fc\u30b6**\u3067Pig\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\u3059\u308b\u3068\u30fb\u30fb\u30fb\n\n```shell-session:hdfs\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n\uff08\u7701\u7565\uff09\n2016-04-24 20:03:40,460 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: hdfs\n            FileName: /tmp/test-lzo-count.pig\n           StartedAt: 2016-04-24 20:03:28\n          FinishedAt: 2016-04-24 20:03:40\n            Features: GROUP_BY\n\nSuccess!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0014\n  TotalLaunchedTasks: 2\n       FileBytesRead: 99\n    FileBytesWritten: 67\n       HdfsBytesRead: 61480\n    HdfsBytesWritten: 7\n\nInput(s):\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n\nOutput(s):\nSuccessfully stored 1 records (7 bytes) in: \"hdfs://hadoophost01:8020/tmp/temp-1823417929/tmp552056591\"\n(1744)\n(1871-01-01,4.44,0.26,0.4,12.46,5.32,84.52,4.95,7.61,,,,,,,)\n(1871-02-01,4.5,0.26,0.4,12.84,5.32,83.12,4.8,7.39,,,,,,,)\n(1871-03-01,4.61,0.26,0.4,13.03,5.33,83.91,4.73,7.28,,,,,,,)\n(1871-04-01,4.74,0.26,0.4,12.56,5.33,89.54,4.91,7.56,,,,,,,)\n(1871-05-01,4.86,0.26,0.4,12.27,5.33,93.95,5.03,7.73,,,,,,,)\n(1871-06-01,4.82,0.26,0.4,12.08,5.34,94.64,5.11,7.85,,,,,,,)\n(1871-07-01,4.73,0.26,0.4,12.08,5.34,92.87,5.11,7.85,,,,,,,)\n(1871-08-01,4.79,0.26,0.4,11.89,5.34,95.56,5.19,7.98,,,,,,,)\n(1871-09-01,4.84,0.26,0.4,12.18,5.35,94.29,5.07,7.79,,,,,,,)\n(1871-10-01,4.59,0.26,0.4,12.37,5.35,88.04,4.99,7.67,,,,,,,)\n```\n\n\u5b9f\u884c\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\n\u524d\u56de\u3068\u6bd4\u3079\u308b\u3068\u3001\u8aad\u8fbc\u30d5\u30a1\u30a4\u30eb\u30b5\u30a4\u30ba\u304c\u4e0b\u8a18\u306e\u3088\u3046\u306b\u5909\u308f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u78ba\u304b\u306b\u5727\u7e2e\u3057\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u3093\u3060\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\n\n```shell-session:\u524d\u56de\u7d50\u679c\nSuccessfully read 1744 records (116662 bytes) from: \"/user/pub/example-data\"\n```\n\n```shell-session:\u4eca\u56de\u7d50\u679c\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n```\n\n### \u304c\u3001\u3057\u304b\u3057\u30fb\u30fb\u30fb\uff1f\n\u305f\u3060\u3001\u3053\u3053\u3067\u4e0a\u624b\u304f\u884c\u3063\u305f\u3068\u601d\u3063\u3066\u5225\u306e\u30e6\u30fc\u30b6\uff08\u4eca\u56de\u306f\u30d3\u30eb\u30c9\u7528\u30e6\u30fc\u30b6\u306e**build**\uff09\u3067\u5b9f\u884c\u3057\u3066\u307f\u308b\u3068\u3001\n\u4f55\u6545\u304b\u8aad\u8fbc\u306b\u5931\u6557\u3059\u308b\u4e8b\u8c61\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\n\n```shell-session:build\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\uff1e\u5931\u6557\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 20:13:44,815 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: build\n            FileName: test-lzo-count.pig\n           StartedAt: 2016-04-24 20:13:26\n          FinishedAt: 2016-04-24 20:13:44\n            Features: GROUP_BY\n\nFailed!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0015\n  TotalLaunchedTasks: 4\n       FileBytesRead: 0\n    FileBytesWritten: 0\n       HdfsBytesRead: 0\n    HdfsBytesWritten: 0\n\nInput(s):\nFailed to read data from \"/user/pub/example-lzo\"\n\nOutput(s):\nFailed to produce result in \"hdfs://hadoophost01:8020/tmp/temp-1843801261/tmp-1479312519\"\n\n2016-04-24 20:13:44,912 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 1066: Unable to open iterator for alias logs_count. Backend error : Vertex failed, vertexName=scope-10, vertexId=vertex_1461490474710_0015_1_00, diagnostics=[Task failed, taskId=task_1461490474710_0015_1_00_000000, diagnostics=[TaskAttempt 0 failed, info=[Error: exceptionThrown=java.lang.IllegalArgumentException: Compression codec com.hadoop.compression.lzo.LzoCodec not found.\n```\n\n### \u9055\u3044\u306f\u3069\u3053\u306b\u3042\u308b\uff1f\n\n\u3069\u3053\u306b\u9055\u3044\u304c\u3042\u308b\u306e\u304b\u3056\u3063\u3068\u8ffd\u3063\u3066\u307f\u308b\u3068\u3001\u4e0b\u8a18\u306e\uff12\u3064\u306e\u6642\u70b9\u3067\u5dee\u5206\u304c\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\n- 1. YARN\u30b3\u30f3\u30c6\u30ca\u8d77\u52d5\u6642\u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\uff08YARN\u306e\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\uff09\n  - build\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u305f\u5074\u306f `tez.cluster.additional.classpath.prefix` \u306e\u8a2d\u5b9a\u304c\u306a\u3044\n- 2. Pig\u304b\u3089\u547c\u3073\u51fa\u3055\u308c\u305fTezClient\u4e2d\u306e\u51e6\u7406\uff08\u30ea\u30e2\u30fc\u30c8\u30c7\u30d0\u30c3\u30b0\uff09\n  - build\u30e6\u30fc\u30b6\u3067\u5b9f\u884c\u3057\u305f\u5074\u306f `tez.cluster.additional.classpath.prefix` \u306e\u8a2d\u5b9a\u304c\u306a\u3044\n\n\u3064\u307e\u308a\u306fHadoop\u30b3\u30de\u30f3\u30c9 > Pig > Tez\u3068\u306a\u308b\u4e2d\u3067\u8a2d\u5b9a\u304c\u6b20\u843d\u3057\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\n\u3056\u3063\u3068\u30c7\u30d0\u30c3\u30b0\u3057\u305f\u6642\u70b9\u3067\u306f\u7d50\u8ad6\u306f\u898b\u3048\u305a\u3068\u3044\u3046\u72b6\u6cc1\u3002\n\n\u3067\u3059\u306e\u3067\u3001Pig\u304c\u8aad\u307f\u8fbc\u3093\u3067Hadoop\u306e\u8a2d\u5b9a\u306b\u542b\u3081\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u306e `pig.properties` \u306b\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u3066\u8a66\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```shell-session\n$ echo \"tez.cluster.additional.classpath.prefix=/opt/cloudera/parcels/GPLEXTRAS/lib/hadoop/lib/hadoop-lzo.jar\" >> /opt/pig/conf/pig.properties\n```\n\n### \u518d\u5ea6\u5b9f\u884c\n\n\u3059\u308b\u3068\u30fb\u30fb\u30fb\uff1f\n\n```shell-session:build\u30e6\u30fc\u30b6\u3067\u306e\u5b9f\u884c\uff1e\u6210\u529f\n/opt/pig/bin/pig -x tez -f test-lzo-count.pig\n2016-04-24 22:16:17,439 [main] INFO  org.apache.pig.tools.pigstats.tez.TezPigScriptStats - Script Statistics:\n\n       HadoopVersion: 2.6.0-cdh5.7.0\n          PigVersion: 0.15.0\n          TezVersion: 0.7.0\n              UserId: build\n            FileName: test-lzo-count.pig\n           StartedAt: 2016-04-24 22:16:06\n          FinishedAt: 2016-04-24 22:16:17\n            Features: GROUP_BY\n\nSuccess!\n\nDAG PigLatin:test-lzo-count.pig-0_scope-0:\n       ApplicationId: job_1461490474710_0025\n  TotalLaunchedTasks: 2\n       FileBytesRead: 99\n    FileBytesWritten: 67\n       HdfsBytesRead: 61480\n    HdfsBytesWritten: 7\n\nInput(s):\nSuccessfully read 1744 records (61480 bytes) from: \"/user/pub/example-lzo\"\n\nOutput(s):\nSuccessfully stored 1 records (7 bytes) in: \"hdfs://hadoophost01:8020/tmp/temp-1901693688/tmp-778527532\"\n\n(1744)\n(1871-01-01,4.44,0.26,0.4,12.46,5.32,84.52,4.95,7.61,,,,,,,)\n(1871-02-01,4.5,0.26,0.4,12.84,5.32,83.12,4.8,7.39,,,,,,,)\n(1871-03-01,4.61,0.26,0.4,13.03,5.33,83.91,4.73,7.28,,,,,,,)\n(1871-04-01,4.74,0.26,0.4,12.56,5.33,89.54,4.91,7.56,,,,,,,)\n(1871-05-01,4.86,0.26,0.4,12.27,5.33,93.95,5.03,7.73,,,,,,,)\n(1871-06-01,4.82,0.26,0.4,12.08,5.34,94.64,5.11,7.85,,,,,,,)\n(1871-07-01,4.73,0.26,0.4,12.08,5.34,92.87,5.11,7.85,,,,,,,)\n(1871-08-01,4.79,0.26,0.4,11.89,5.34,95.56,5.19,7.98,,,,,,,)\n(1871-09-01,4.84,0.26,0.4,12.18,5.35,94.29,5.07,7.79,,,,,,,)\n(1871-10-01,4.59,0.26,0.4,12.37,5.35,88.04,4.99,7.67,,,,,,,)\n```\n\n`pig.properties` \u306b\u8a2d\u5b9a\u3057\u305f\u5206\u306fbuild\u30e6\u30fc\u30b6\u3067\u3082\u554f\u984c\u306a\u304f\u8aad\u307f\u8fbc\u3080\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\n\u5dee\u5206\u304c\u767a\u751f\u3059\u308b\u539f\u56e0\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u3068\u308a\u3042\u3048\u305a\u89e3\u6d88\u306f\u3067\u304d\u305f\u3001\u3068\u3044\u3046\u5f62\u306b\u306a\u308a\u307e\u3059\u306d\u3002\n\u30af\u30e9\u30b9\u30d1\u30b9\u304b\u3089Hadoop\u8a2d\u5b9a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u3068\u304d\u306e\u6319\u52d5\u306e\u5dee\u306e\u3088\u3046\u3067\u3059\u304c\u3001\n\u3053\u308c\u306f\u6c17\u9577\u306b\u8ffd\u3063\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u30fb\u30fb\u30fb\n\n### \u307e\u3068\u3081\n- Pig on Tez\u306bLzo\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306f\u4e0b\u8a18\u306e\u5bfe\u5fdc\u304c\u5fc5\u8981\n  - Pig on Tez\u8d77\u52d5\u6642\u306e\u30af\u30e9\u30b9\u30d1\u30b9\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3081\u308b\n  - Tez\u52d5\u4f5c\u6642\u306e\u8ffd\u52a0\u30af\u30e9\u30b9\u30d1\u30b9( `tez-site.xml` )\u306bLzo\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u542b\u3081\u308b\n      - \u305f\u3060\u3057\u3001\u4e00\u90e8\u306e\u30e6\u30fc\u30b6\u3067\u306f `tez-site.xml` \u306b\u542b\u3081\u3066\u3082\u52d5\u4f5c\u3057\u306a\u3044\uff08\u539f\u56e0\u304c\u73fe\u72b6\u4e0d\u660e\uff09\n      - \u4e0a\u8a18\u306e\u5834\u5408\u3001 `pig.properties` \u306b\u8a18\u8ff0\u3059\u308c\u3070\u52d5\u4f5c\u3059\u308b\u3002 \n", "tags": ["pig", "Tez", "CDH", "hadoop"]}