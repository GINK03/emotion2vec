{"context": " More than 1 year has passed since last update.\n\nHamee Advent Calender\u306e5\u65e5\u76ee\u3067\u3059\u3002\n\n\u306f\u3058\u3081\u306b\nec-cube\u306e3\u304c\u51fa\u3066\u89e6\u308a\u305f\u304b\u3063\u305f\u306e\u3067\u4f55\u304b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u3001\u4e01\u5ea6\u958b\u50ac\u4e2d\uff082015/12/18 \u307e\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u52df\u96c6\u4e2d\uff09\u306eEC-CUBE PLUGIN AWARD 3.0\u306b\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u4f55\u3092\u4f5c\u308b\u304b\n\u3068\u3044\u3063\u3066\u3082\u3001\u521d\u3081\u3066\u3060\u3057\u3001\u6642\u9593\u3082\u306a\u3044\u306e\u3067\u3001\u7c21\u5358\u3067\u30cb\u30c3\u30c1\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u3042\u308b\u7a0b\u5ea6\u308f\u304b\u308a\u305f\u3044\u306e\u3067\u3001\u30b7\u30e7\u30c3\u30d7\u5074\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092\u5909\u66f4\u3059\u308b\u3088\u3046\u306a\u5185\u5bb9\u3067\u8003\u3048\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u30fb\u30fb\u30fb\u6570\u5206\u5f8c\u30fb\u30fb\u30fb\n\n\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\n\u6c7a\u307e\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u672c\u5e97\u30b5\u30a4\u30c8\u306e\u30da\u30fc\u30b8\u306b\u6765\u305f\u304a\u5ba2\u69d8\u3092\u672c\u5e97\u4ee5\u5916\u306e\u30e2\u30fc\u30eb\u3078\u8a98\u5c0e\u3059\u308b\u3001\u9006\u30b5\u30c6\u30e9\u30a4\u30c8\u30b5\u30a4\u30c8\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\u304a\u5e97\u304b\u3089\u3059\u308c\u3070\u672c\u5e97\u304b\u3089\u304a\u5ba2\u69d8\u3092\u9003\u3057\u306a\u304f\u306a\u3044\u3067\u3059\u304c\u3001\u304a\u5ba2\u69d8\u304b\u3089\u3059\u308c\u3070\u3088\u304f\u5229\u7528\u3059\u308b\u30e2\u30fc\u30eb\u3067\u3082\u58f2\u3063\u3066\u3044\u308b\u306a\u3089\u305d\u3063\u3061\u3067\u3082\u8cb7\u3044\u305f\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3001\u3063\u3066\u601d\u3063\u3066\u8003\u3048\u307e\u3057\u305f\u3002\n\n\u4f5c\u308a\u65b9\u3092\u77e5\u308b\n\u307e\u305a\u306f\u3001\u672c\u5bb6\u30b5\u30a4\u30c8\u304b\u3089\u3044\u308d\u3044\u308d\u8fbf\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\nec-cube\u306egithub\nec-cube3\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u4ed5\u69d8\u66f8\u3092\u8aad\u3080\nEC-CUBE 3 \u958b\u767a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\n\u30b5\u30f3\u30d7\u30eb\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u773a\u3081\u308b\nEC-CUBE3\u30d7\u30e9\u30b0\u30a4\u30f3\u958b\u767a\u521d\u671f\u306b\u30cf\u30de\u3063\u305f\u3053\u3068\u30e1\u30e2\u96c6\n\u6700\u5f8c\u306bindex_dev.php\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306b\u306a\u308b\u3068\u3044\u3046\u60c5\u5831\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u69cb\u6210\n\nec-cube3plugin\n{PluginName}\n\u251c\u2500\u2500\u2500config.yml\u3000       //\u30d7\u30e9\u30b0\u30a4\u30f3\u57fa\u672c\u60c5\u5831\n\u251c\u2500\u2500\u2500PluginManager.php //\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u3001\u66f4\u65b0\u6642\u306a\u3069\u306e\u51e6\u7406\n\u251c\u2500\u2500\u2500ServiceProvider\n    \u251c\u2500\u2500\u2500*.php         //config.yml\u3067\u5b9a\u7fa9\u3057\u305fServiceProvider\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500\u2500event.yml         //\u5229\u7528\u3059\u308b\u30d5\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\n\u251c\u2500\u2500\u2500{EventName}.php   //\u30d5\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u306b\u4ecb\u5165\u3059\u308b\u51e6\u7406\n\u251c\u2500\u2500\u2500Migration\n    \u251c\u2500\u2500\u2500Version{YYYYmmddHHiiss}.php //\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3084\u524a\u9664\n    Resource\n    \u251c\u2500\u2500\u2500doctrine\n        \u251c\u2500\u2500\u2500*.dcm.yml //\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\n    Form              \n    \u251c\u2500\u2500\u2500Type\n        \u251c\u2500\u2500\u2500*.php\u3000\u3000\u3000//\u72ec\u81ea\u62e1\u5f35\u30d5\u30a9\u30fc\u30e0\u306e\u5b9a\u7fa9\n    \u251c\u2500\u2500\u2500Extension\n        \u251c\u2500\u2500\u2500*.php\u3000\u3000\u3000//\u72ec\u81ea\u62e1\u5f35\u30d5\u30a9\u30fc\u30e0\u306e\u5b9a\u7fa9\n\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\n\u4ed5\u69d8\u66f8\u306b\u6cbf\u3063\u3066\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u57fa\u672c\u8a2d\u5b9a\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb{config.yml}\u3092\u66f8\u304d\u307e\u3059\u3002\n\nyaml\nname: \u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\ncode: OtherSite\nversion: 0.0.1\nservice:\n    - OtherSiteServiceProvider\norm.path:\n    - /Resource/doctrine\nmigration.path:\n    - /migration\nevent: OtherSiteEvent\n\n\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u3001\u66f4\u65b0\u6642\u306e\u51e6\u7406{PluginManager.php}\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\nphp\n<?php\n\nnamespace Plugin\\OtherSite;\n\nuse Eccube\\Plugin\\AbstractPluginManager;\n\nclass PluginManager extends AbstractPluginManager\n{\n\n    public function install($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code']);\n    }\n\n    public function uninstall($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code'], 0);\n    }\n\n    public function enable($config, $app)\n    {\n    }\n\n    public function disable($config, $app)\n    {\n    }\n\n    public function update($config, $app)\n    {\n    }\n}\n\n\n\n\u3069\u3053\u306b\u51e6\u7406\u3092\u4ecb\u5165\u3055\u305b\u308b\u304b\n\u4eca\u56de\u306f\u5546\u54c1\u8a73\u7d30\u753b\u9762\u306b\u30e2\u30fc\u30eb\u3078\u306e\u30ea\u30f3\u30af\u30dc\u30bf\u30f3\u3001\u7ba1\u7406\u753b\u9762\u306e\u5546\u54c1\u767b\u9332\u30fb\u66f4\u65b0\u6642\u306b\u30e2\u30fc\u30eb\u306eURL\u306e\u8a2d\u5b9a\u3059\u308b\u51e6\u7406\u3092\u4ecb\u5165\u3055\u305b\u308b{event.yml}\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nyaml\neccube.event.render.admin_product_product_new.before:\n    - [addContentOnProductEdit, NORMAL]\n    - [registerOtherSite, NORMAL]\neccube.event.render.admin_product_product_edit.before:\n    - [addContentOnProductEdit, NORMAL]\n    - [registerOtherSite, NORMAL]\neccube.event.render.product_detail.before:\n    - [showOtherSite, NORMAL]\n\n\n\u307e\u305f\u3001\u6700\u521d\u306b\u66f8\u3044\u3061\u3083\u3044\u307e\u3057\u305f\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb{config.yml}\u306bevent\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\nyaml\nevent: OtherSiteEvent\n\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\n\u30e2\u30fc\u30eb\u306eURL\u3092\u4fdd\u5b58\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u697d\u5929\u5e02\u5834\u3001Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u3001Amazon\u3001DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u3001\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30eb\u306eURL\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\u307e\u305a\u306f\u3001\nentity{Entity/OtherSite.php} \n\u3068\ndoctrine\u306e\u8a2d\u5b9a{Resource/doctrine/Plugin.OtherSite.Entity.OtherSite.dcm.yml}\u3092\u66f8\u304d\u307e\u3059\u3002\n\nphp\n<?php\n\nnamespace Plugin\\OtherSite\\Entity;\n\nclass OtherSite extends \\Eccube\\Entity\\AbstractEntity\n{\n    private $product_id;\n    private $rakuten_url;\n    private $yahoo_url;\n    private $amazon_url;\n    private $dena_url;\n    private $ponpare_url;\n    private $Product;\n\n    public function getRakutenUrl()\n    {\n        return $this->rakuten_url;\n    }\n\n    public function setRakutenUrl($rakuten)\n    {\n        $this->rakuten_url = $rakuten;\n        return $this;\n    }\n\n    public function getYahooUrl()\n    {\n        return $this->yahoo_url;\n    }\n\n    public function setYahooUrl($yahoo)\n    {\n        $this->yahoo_url = $yahoo;\n        return $this;\n    }\n\n    public function getAmazonUrl()\n    {\n        return $this->amazon_url;\n    }\n\n    public function setAmazonUrl($amazon)\n    {\n        $this->amazon_url = $amazon;\n        return $this;\n    }\n\n    public function getDenaUrl()\n    {\n        return $this->dena_url;\n    }\n\n    public function setDenaUrl($dena)\n    {\n        $this->dena_url = $dena;\n        return $this;\n    }\n\n\n    public function getPonpareUrl()\n    {\n        return $this->ponpare_url;\n    }\n\n    public function setPonpareUrl($ponpare)\n    {\n        $this->ponpare_url = $ponpare;\n        return $this;\n    }\n\n\n    public function getProduct()\n    {\n        return $this->Product;\n    }\n\n\n    public function setProduct(\\Eccube\\Entity\\Product $Product)\n    {\n        $this->Product = $Product;\n\n        return $this;\n    }\n\n    public function getProductId()\n    {\n        return $this->product_id;\n    }\n\n    public function setProductId($productId)\n    {\n        $this->product_id = $productId;\n\n        return $this;\n    }\n\n}\n\n\n\nyaml\nPlugin\\OtherSite\\Entity\\OtherSite:\n    type: entity\n    table: plg_other_site\n    repositoryClass: Plugin\\OtherSite\\Repository\\OtherSiteRepository\n    id:\n        product_id:\n            type: smallint\n            nullable: false\n            unsigned: false\n            id: true\n            generator:\n                strategy: NONE\n    fields:\n        rakuten_url:\n            type: string\n            default: \"\"\n        yahoo_url:\n            type: string\n            default: \"\"\n        amazon_url:\n            type: string\n            default: \"\"\n        dena_url:\n            type: string\n            default: \"\"\n        ponpare_url:\n            type: string\n            default: \"\"\n    OneToOne:\n        Product:\n            targetEntity: Eccube\\Entity\\Product\n            joinColumn:\n                name: product_id\n                referencedColumnName: product_id\n    lifecycleCallbacks: {  }\n\n\n\u6b21\u306bRepository{Repository/OtherSiteRepository.php}\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4f7f\u308f\u306a\u3044\u304b\u3089\u7a7a\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nphp\n\n<?php\n\nnamespace Plugin\\OtherSite\\Repository;\n\nuse Doctrine\\ORM\\EntityRepository;\n\nclass OtherSiteRepository extends EntityRepository\n{\n}\n\n\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u7ba1\u7406\u3059\u308b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb{Migration/Version20151201000000.php}\u3092\u66f8\u304d\u307e\u3059\u3002\n\nphp\n\n<?php\nnamespace DoctrineMigrations;\n\nuse Doctrine\\DBAL\\Migrations\\AbstractMigration;\nuse Doctrine\\DBAL\\Schema\\Schema;\n\nclass Version20151201000000 extends AbstractMigration\n{\n\n    public function up(Schema $schema)\n    {\n        $this->createOtherSiteTable($schema);\n    }\n\n    public function down(Schema $schema)\n    {\n        $schema->dropTable('plg_other_site');\n    }\n\n    protected function createOtherSiteTable(Schema $schema)\n    {\n        $table = $schema->createTable(\"plg_other_site\");\n        $table->addColumn('product_id', 'integer');\n        $option=array('length' => 255,'notnull' => false);\n        $table->addColumn('rakuten_url', 'string', $option);\n        $table->addColumn('yahoo_url', 'string', $option);\n        $table->addColumn('amazon_url', 'string', $option);\n        $table->addColumn('dena_url', 'string', $option);\n        $table->addColumn('ponpare_url', 'string', $option);\n        $table->setPrimaryKey(array('product_id'));\n    }\n}\n\n\n\n\u30d5\u30a9\u30fc\u30e0\u306e\u62e1\u5f35\n\u7ba1\u7406\u753b\u9762\u306e\u5546\u54c1\u767b\u9332\u753b\u9762\u306b\u30e2\u30fc\u30eb\u306eURL\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u70ba\u306b{Form/Extension/Admin/OtherSiteCollectionExtension.php}\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\nphp\n<?php\n\nnamespace Plugin\\OtherSite\\Form\\Extension\\Admin;\n\nuse Symfony\\Component\\Form\\AbstractTypeExtension;\nuse Symfony\\Component\\Form\\FormBuilderInterface;\nuse Symfony\\Component\\Form\\FormInterface;\nuse Symfony\\Component\\Form\\FormView;\n\nclass OtherSiteCollectionExtension extends AbstractTypeExtension\n{\n    public function buildForm(FormBuilderInterface $builder, array $options)\n    {\n\n        $builder\n            ->add('rakuten_url', 'text', array(\n                'label' => '\u697d\u5929\u5e02\u5834URL',\n                'mapped' => false,\n            ))\n            ->add('yahoo_url', 'text', array(\n                'label' => 'Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0URL',\n                'mapped' => false,\n            ))\n            ->add('amazon_url', 'text', array(\n                'label' => 'AmazonURL',\n                'mapped' => false,\n            ))\n            ->add('dena_url', 'text', array(\n                'label' => 'DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0URL',\n                'mapped' => false,\n            ))\n            ->add('ponpare_url', 'text', array(\n                'label' => '\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30ebURL',\n                'mapped' => false,\n            ))\n        ;\n    }\n\n    public function buildView(FormView $view, FormInterface $form, array $options)\n    {\n    }\n\n    public function getExtendedType()\n    {\n        return 'admin_product';\n    }\n\n}\n\n\n\n\u8868\u793a\u306e\u5909\u66f4\n\u7ba1\u7406\u753b\u9762\u306b\u8ffd\u52a0\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8{Resource/template/Admin/other_site.twig}\u3068\u5546\u54c1\u8a73\u7d30\u753b\u9762\u306b\u8ffd\u52a0\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8{Resource/template/Front/other_site.twig}\u3092twig\u30de\u30ca\u30fc\u66f8\u304d\u307e\u3059\u3002\n\u7ba1\u7406\u753b\u9762\n\ntwig\n\n</div>\n<div class=\"box accordion\">\n<div class=\"box accordion form-horizontal\">\n    <div class=\"box-header toggle\">\n        <h3 class=\"box-title\">\n            \u305d\u306e\u4ed6\u306e\u30b5\u30a4\u30c8\n            <svg class=\"cb cb-angle-down icon_down\"> <use xlink:href=\"#cb-angle-down\" /></svg>\n        </h3>\n    </div><!-- /.box-header -->\n    <div class=\"box-body accpanel\">\n        <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\">{{ form.rakuten_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n                {{ form_widget(form.rakuten_url) }}\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\">{{ form.yahoo_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n                {{ form_widget(form.yahoo_url) }}\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\">{{ form.amazon_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n                {{ form_widget(form.amazon_url) }}\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\">{{ form.dena_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n                {{ form_widget(form.dena_url) }}\n            </div>\n        </div>\n        <div class=\"form-group\">\n            <label class=\"col-sm-3 control-label\">{{ form.ponpare_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n                {{ form_widget(form.ponpare_url) }}\n            </div>\n        </div>\n    </div>\n</div>\n\n\n\n\u5546\u54c1\u8a73\u7d30\u753b\u9762\n\nphp\n<div class=\"other_site\">\n    <h4>\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002</h4>\n    <ul class=\"row\">\n        {% if OtherSite.rakuten_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.rakuten_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">\u697d\u5929\u5e02\u5834</a></li>{% endif %}\n        {% if OtherSite.amazon_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.amazon_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">Amazon</a></li>{% endif %}\n        {% if OtherSite.yahoo_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.yahoo_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0</a></li>{% endif %}\n        {% if OtherSite.dena_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.dena_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0</a></li>{% endif %}\n        {% if OtherSite.ponpare_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.ponpare_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30eb</a></li>{% endif %}\n    </ul>\n</div>\n\n\n\n\n\u30a4\u30d9\u30f3\u30c8\u306e\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\n\u5b9f\u969b\u3053\u3053\u306f\u8868\u793a\u306e\u5909\u66f4\u3084\u30d5\u30a9\u30fc\u30e0\u306e\u62e1\u5f35\u3084\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3084\u308a\u306a\u304c\u3089\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\nOtherSiteEvent.php\n\nphp\n\n<?php\n\nnamespace Plugin\\OtherSite;\n\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\n\nclass OtherSiteEvent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function showOtherSite(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n\n        $id = $app['request']->attributes->get('id');\n        $Product = $app['eccube.repository.product']->find($id);\n        $OtherSite = $app['eccube.plugin.repository.other_site']->find($id);\n\n        if (count($OtherSite) > 0) {\n            $twig = $app->renderView(\n                'OtherSite/Resource/template/Front/other_site.twig',\n                array(\n                    'OtherSite' => $OtherSite,\n                )\n            );\n\n            $response = $event->getResponse();\n            $html = $response->getContent();\n            $crawler = new Crawler($html);\n            $oldElement = $crawler->filter('.cart_area .btn_area');\n            $oldHtml = $oldElement->html();\n            $newHtml = $oldHtml.$twig;\n\n            $html = $crawler->html();\n            $html = str_replace($oldHtml, $newHtml, $html);\n\n            $response->setContent($html);\n            $event->setResponse($response);\n        }\n    }\n\n    public function registerOtherSite(FilterResponseEvent $event)\n    {\n\n        $app = $this->app;\n        $id = $app['request']->attributes->get('id');\n\n        $form = $app['form.factory']->createBuilder('admin_product')->getForm();\n\n        $OtherSite=$app['eccube.plugin.repository.other_site']->find($id);\n\n        if (is_null($OtherSite)) {\n            $OtherSite = new \\Plugin\\OtherSite\\Entity\\OtherSite();\n        }\n        $form->get('rakuten_url')->setData($OtherSite->getRakutenUrl());\n        $form->get('yahoo_url')->setData($OtherSite->getYahooUrl());\n        $form->get('amazon_url')->setData($OtherSite->getAmazonUrl());\n        $form->get('dena_url')->setData($OtherSite->getDenaUrl());\n        $form->get('ponpare_url')->setData($OtherSite->getPonpareUrl());\n\n        $form->handleRequest($app['request']);      \n\n       if ('POST' === $app['request']->getMethod()) {\n            if ($form->isValid()) {\n                $Product = $app['eccube.repository.product']->find($id);\n                $OtherSite\n                    ->setProductId($Product->getId())\n                    ->setProduct($Product)\n                    ->setRakutenUrl($form->get('rakuten_url')->getData())\n                    ->setYahooUrl($form->get('yahoo_url')->getData())\n                    ->setAmazonUrl($form->get('amazon_url')->getData())\n                    ->setDenaUrl($form->get('dena_url')->getData())\n                    ->setPonpareUrl($form->get('ponpare_url')->getData())\n                    ;\n                $app['orm.em']->persist($OtherSite);\n                $app['orm.em']->flush();\n            }\n        }\n\n    }\n\n    public function addContentOnProductEdit(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n        $id = $request->attributes->get('id');\n\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_product')\n            ->getForm();\n\n        if ($id) {\n            $Product = $app['eccube.repository.product']->find($id);\n        } else {\n            $Product = new \\Eccube\\Entity\\Product();\n        }\n\n        $OtherSite = $app['eccube.plugin.repository.other_site']->findOneBy(\n            array(\n                'product_id' => $id,\n            ));\n        if (isset($OtherSite)) {\n            $form->get('rakuten_url')->setData($OtherSite->getRakutenUrl());\n            $form->get('yahoo_url')->setData($OtherSite->getYahooUrl());\n            $form->get('amazon_url')->setData($OtherSite->getAmazonUrl());\n            $form->get('dena_url')->setData($OtherSite->getDenaUrl());\n            $form->get('ponpare_url')->setData($OtherSite->getPonpareUrl());\n        }\n        $form->handleRequest($request);\n\n        $twig = $app->renderView('OtherSite/Resource/template/Admin/other_site.twig',\n                array('form' => $form->createView()));\n\n        $oldElement = $crawler\n            ->filter('.accordion')\n            ->last();\n\n        if ($oldElement->count() > 0) {\n            $oldHtml = $oldElement->html();\n            $newHtml = $oldHtml.$twig;\n            $html = $crawler->html();\n            $html = str_replace($oldHtml, $newHtml, $html);\n            $response->setContent($html);\n            $event->setResponse($response);\n        }\n    }\n}\n\n\n\n\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3057\u3066\u5b8c\u6210\n\u6700\u5f8c\u306b\u30d5\u30a1\u30a4\u30eb\u3092.tar.gz\u306b\u307e\u3068\u3081\u3066\u5b8c\u6210\n\u6ce8\uff1a\u30d7\u30e9\u30b0\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u4e8b\u3002\n\n\u5b8c\u6210\u54c1\n\n\u7ba1\u7406\u753b\u9762\n\n\n\u5546\u54c1\u8a73\u7d30\n\n\nEC-CUBE PLUGIN AWARD 3.0\u306b\u51fa\u3059\n\n\u30d1\u30fc\u30c8\u30ca\u30fc\u767b\u9332\u3092\u3059\u308b\nEC-CUBE\u30d1\u30fc\u30c8\u30ca\u30fc\u767b\u9332\n\u767b\u9332\u3057\u305f\u3093\u3067\u3059\u304c\u3001\u7d44\u7e54\u540d\u3001\u7d44\u7e54URL\u3001\u7d44\u7e54\u8aac\u660e\u306f\u30b3\u30f3\u30c6\u30b9\u30c8\u5fdc\u52df\u306e\u6577\u5c45\u3092\u9ad8\u304f\u3057\u3066\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\u500b\u4eba\u3067\u53c2\u52a0\u51fa\u6765\u308b\u4e8b\u306f\u3082\u3063\u3068\u660e\u793a\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u3067\u306f\uff1f\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u7533\u8acb\u6e96\u5099\nEC-CUBE\u30d7\u30e9\u30b0\u30a4\u30f3\u7533\u8acb\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u53c2\u8003\u306b\u30ed\u30b4\u3068\u304b\u8aac\u660e\u3068\u304b\u5165\u529b\u3057\u3066\u7533\u8acb\u5b8c\u4e86\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\n\u307e\u3060\u307e\u3060\u5168\u7136\u7406\u89e3\u3057\u3066\u306a\u3044\u3051\u3069\u4ed6\u306b\u4f55\u4f5c\u308d\u3046\u304b\u306a\u3041 \n\n\n### [Hamee Advent Calender](http://qiita.com/advent-calendar/2015/hamee)\u306e5\u65e5\u76ee\u3067\u3059\u3002\n\n# \u306f\u3058\u3081\u306b\nec-cube\u306e3\u304c\u51fa\u3066\u89e6\u308a\u305f\u304b\u3063\u305f\u306e\u3067\u4f55\u304b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u3063\u3066\u3001\u4e01\u5ea6\u958b\u50ac\u4e2d\uff082015/12/18 \u307e\u3067\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u52df\u96c6\u4e2d\uff09\u306e[EC-CUBE PLUGIN AWARD 3.0](http://www.ec-cube.net/events/plugin_award_30/)\u306b\u51fa\u3057\u3066\u307f\u307e\u3059\u3002\n\n# \u4f55\u3092\u4f5c\u308b\u304b\n\u3068\u3044\u3063\u3066\u3082\u3001\u521d\u3081\u3066\u3060\u3057\u3001\u6642\u9593\u3082\u306a\u3044\u306e\u3067\u3001\u7c21\u5358\u3067\u30cb\u30c3\u30c1\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u306b\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u51fa\u6765\u308b\u3053\u3068\u304c\u3042\u308b\u7a0b\u5ea6\u308f\u304b\u308a\u305f\u3044\u306e\u3067\u3001\u30b7\u30e7\u30c3\u30d7\u5074\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092\u5909\u66f4\u3059\u308b\u3088\u3046\u306a\u5185\u5bb9\u3067\u8003\u3048\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u30fb\u30fb\u30fb\u6570\u5206\u5f8c\u30fb\u30fb\u30fb\n\n## \u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\n\n\u6c7a\u307e\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u3092\u4f5c\u308a\u307e\u3059\u3002\n\u672c\u5e97\u30b5\u30a4\u30c8\u306e\u30da\u30fc\u30b8\u306b\u6765\u305f\u304a\u5ba2\u69d8\u3092\u672c\u5e97\u4ee5\u5916\u306e\u30e2\u30fc\u30eb\u3078\u8a98\u5c0e\u3059\u308b\u3001\u9006\u30b5\u30c6\u30e9\u30a4\u30c8\u30b5\u30a4\u30c8\u306a\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3002\u304a\u5e97\u304b\u3089\u3059\u308c\u3070\u672c\u5e97\u304b\u3089\u304a\u5ba2\u69d8\u3092\u9003\u3057\u306a\u304f\u306a\u3044\u3067\u3059\u304c\u3001\u304a\u5ba2\u69d8\u304b\u3089\u3059\u308c\u3070\u3088\u304f\u5229\u7528\u3059\u308b\u30e2\u30fc\u30eb\u3067\u3082\u58f2\u3063\u3066\u3044\u308b\u306a\u3089\u305d\u3063\u3061\u3067\u3082\u8cb7\u3044\u305f\u3044\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3001\u3063\u3066\u601d\u3063\u3066\u8003\u3048\u307e\u3057\u305f\u3002\n\n# \u4f5c\u308a\u65b9\u3092\u77e5\u308b\n\u307e\u305a\u306f\u3001\u672c\u5bb6\u30b5\u30a4\u30c8\u304b\u3089\u3044\u308d\u3044\u308d\u8fbf\u3063\u3066\u3044\u304d\u307e\u3059\u3002\n\n- [ec-cube\u306egithub](https://github.com/EC-CUBE/ec-cube)\n- [ec-cube3\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u4ed5\u69d8\u66f8\u3092\u8aad\u3080](http://downloads.ec-cube.net/src/manual/v3/plugin.pdf)\n- [EC-CUBE 3 \u958b\u767a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://ec-cube.github.io/)\n- [\u30b5\u30f3\u30d7\u30eb\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u773a\u3081\u308b](https://github.com/EC-CUBE)\n- [EC-CUBE3\u30d7\u30e9\u30b0\u30a4\u30f3\u958b\u767a\u521d\u671f\u306b\u30cf\u30de\u3063\u305f\u3053\u3068\u30e1\u30e2\u96c6](http://qiita.com/tuyop1/items/f2e1d95b8c807002af22)\n- \u6700\u5f8c\u306bindex_dev.php\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u3068\u30c7\u30d0\u30c3\u30b0\u30e2\u30fc\u30c9\u306b\u306a\u308b\u3068\u3044\u3046\u60c5\u5831\n\n## \u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u69cb\u6210\n\n```lang:ec-cube3plugin\n{PluginName}\n\u251c\u2500\u2500\u2500config.yml\u3000       //\u30d7\u30e9\u30b0\u30a4\u30f3\u57fa\u672c\u60c5\u5831\n\u251c\u2500\u2500\u2500PluginManager.php //\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u3001\u66f4\u65b0\u6642\u306a\u3069\u306e\u51e6\u7406\n\u251c\u2500\u2500\u2500ServiceProvider\n    \u251c\u2500\u2500\u2500*.php         //config.yml\u3067\u5b9a\u7fa9\u3057\u305fServiceProvider\u3067\u547c\u3073\u51fa\u3055\u308c\u308b\u30d5\u30a1\u30a4\u30eb\n\u251c\u2500\u2500\u2500event.yml         //\u5229\u7528\u3059\u308b\u30d5\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\n\u251c\u2500\u2500\u2500{EventName}.php   //\u30d5\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u306b\u4ecb\u5165\u3059\u308b\u51e6\u7406\n\u251c\u2500\u2500\u2500Migration\n    \u251c\u2500\u2500\u2500Version{YYYYmmddHHiiss}.php //\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3084\u524a\u9664\n    Resource\n    \u251c\u2500\u2500\u2500doctrine\n        \u251c\u2500\u2500\u2500*.dcm.yml //\u30c6\u30fc\u30d6\u30eb\u5b9a\u7fa9\n    Form              \n    \u251c\u2500\u2500\u2500Type\n        \u251c\u2500\u2500\u2500*.php\u3000\u3000\u3000//\u72ec\u81ea\u62e1\u5f35\u30d5\u30a9\u30fc\u30e0\u306e\u5b9a\u7fa9\n    \u251c\u2500\u2500\u2500Extension\n        \u251c\u2500\u2500\u2500*.php\u3000\u3000\u3000//\u72ec\u81ea\u62e1\u5f35\u30d5\u30a9\u30fc\u30e0\u306e\u5b9a\u7fa9\n```\n\n# \u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u308b\n\u4ed5\u69d8\u66f8\u306b\u6cbf\u3063\u3066\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n## \u30d7\u30e9\u30b0\u30a4\u30f3\u57fa\u672c\u8a2d\u5b9a\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb{[config.yml](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/config.yml?at=master&fileviewer=file-view-default)}\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```lang:yaml\nname: \u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002\u30d7\u30e9\u30b0\u30a4\u30f3\ncode: OtherSite\nversion: 0.0.1\nservice:\n    - OtherSiteServiceProvider\norm.path:\n    - /Resource/doctrine\nmigration.path:\n    - /migration\nevent: OtherSiteEvent\n```\n## \u30d7\u30e9\u30b0\u30a4\u30f3\u30de\u30cd\u30fc\u30b8\u30e3\n\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u3001\u66f4\u65b0\u6642\u306e\u51e6\u7406{[PluginManager.php](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/PluginManager.php?at=master&fileviewer=file-view-default)}\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n```lang:php\n<?php\n\nnamespace Plugin\\OtherSite;\n\nuse Eccube\\Plugin\\AbstractPluginManager;\n\nclass PluginManager extends AbstractPluginManager\n{\n\n    public function install($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code']);\n    }\n\n    public function uninstall($config, $app)\n    {\n        $this->migrationSchema($app, __DIR__ . '/Migration', $config['code'], 0);\n    }\n\n    public function enable($config, $app)\n    {\n    }\n\n    public function disable($config, $app)\n    {\n    }\n\n    public function update($config, $app)\n    {\n    }\n}\n```\n## \u3069\u3053\u306b\u51e6\u7406\u3092\u4ecb\u5165\u3055\u305b\u308b\u304b\n\u4eca\u56de\u306f\u5546\u54c1\u8a73\u7d30\u753b\u9762\u306b\u30e2\u30fc\u30eb\u3078\u306e\u30ea\u30f3\u30af\u30dc\u30bf\u30f3\u3001\u7ba1\u7406\u753b\u9762\u306e\u5546\u54c1\u767b\u9332\u30fb\u66f4\u65b0\u6642\u306b\u30e2\u30fc\u30eb\u306eURL\u306e\u8a2d\u5b9a\u3059\u308b\u51e6\u7406\u3092\u4ecb\u5165\u3055\u305b\u308b{[event.yml](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/event.yml?at=master&fileviewer=file-view-default)}\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```lang:yaml\neccube.event.render.admin_product_product_new.before:\n    - [addContentOnProductEdit, NORMAL]\n    - [registerOtherSite, NORMAL]\neccube.event.render.admin_product_product_edit.before:\n    - [addContentOnProductEdit, NORMAL]\n    - [registerOtherSite, NORMAL]\neccube.event.render.product_detail.before:\n    - [showOtherSite, NORMAL]\n```\n\n\u307e\u305f\u3001\u6700\u521d\u306b\u66f8\u3044\u3061\u3083\u3044\u307e\u3057\u305f\u304c\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb{[config.yml](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/config.yml?at=master&fileviewer=file-view-default)}\u306bevent\u306e\u8a2d\u5b9a\u3092\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```lang:yaml\nevent: OtherSiteEvent\n```\n\n## \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\n\u30e2\u30fc\u30eb\u306eURL\u3092\u4fdd\u5b58\u3059\u308b\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u4eca\u56de\u306f\u697d\u5929\u5e02\u5834\u3001Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u3001Amazon\u3001DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u3001\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30eb\u306eURL\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n\u307e\u305a\u306f\u3001\nentity{[Entity/OtherSite.php]\n(https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Entity/?at=master)} \n\u3068\ndoctrine\u306e\u8a2d\u5b9a{[Resource/doctrine/Plugin.OtherSite.Entity.OtherSite.dcm.yml](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Resource/doctrine/Plugin.OtherSite.Entity.OtherSite.dcm.yml?at=master&fileviewer=file-view-default)}\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```lang:php\n<?php\n\nnamespace Plugin\\OtherSite\\Entity;\n\nclass OtherSite extends \\Eccube\\Entity\\AbstractEntity\n{\n\tprivate $product_id;\n\tprivate $rakuten_url;\n\tprivate $yahoo_url;\n\tprivate $amazon_url;\n\tprivate $dena_url;\n\tprivate $ponpare_url;\n    private $Product;\n\n    public function getRakutenUrl()\n    {\n        return $this->rakuten_url;\n    }\n\n    public function setRakutenUrl($rakuten)\n    {\n        $this->rakuten_url = $rakuten;\n        return $this;\n    }\n\n    public function getYahooUrl()\n    {\n        return $this->yahoo_url;\n    }\n\n    public function setYahooUrl($yahoo)\n    {\n        $this->yahoo_url = $yahoo;\n        return $this;\n    }\n\n    public function getAmazonUrl()\n    {\n        return $this->amazon_url;\n    }\n\n    public function setAmazonUrl($amazon)\n    {\n        $this->amazon_url = $amazon;\n        return $this;\n    }\n\n    public function getDenaUrl()\n    {\n        return $this->dena_url;\n    }\n\n    public function setDenaUrl($dena)\n    {\n        $this->dena_url = $dena;\n        return $this;\n    }\n\n\n    public function getPonpareUrl()\n    {\n        return $this->ponpare_url;\n    }\n\n    public function setPonpareUrl($ponpare)\n    {\n        $this->ponpare_url = $ponpare;\n        return $this;\n    }\n\n\n    public function getProduct()\n    {\n        return $this->Product;\n    }\n    \n\n    public function setProduct(\\Eccube\\Entity\\Product $Product)\n    {\n        $this->Product = $Product;\n\n        return $this;\n    }\n\n    public function getProductId()\n    {\n        return $this->product_id;\n    }\n\n    public function setProductId($productId)\n    {\n        $this->product_id = $productId;\n\n        return $this;\n    }\n\n}\n```\n```lang:yaml\nPlugin\\OtherSite\\Entity\\OtherSite:\n    type: entity\n    table: plg_other_site\n    repositoryClass: Plugin\\OtherSite\\Repository\\OtherSiteRepository\n    id:\n        product_id:\n            type: smallint\n            nullable: false\n            unsigned: false\n            id: true\n            generator:\n                strategy: NONE\n    fields:\n        rakuten_url:\n            type: string\n            default: \"\"\n        yahoo_url:\n            type: string\n            default: \"\"\n        amazon_url:\n            type: string\n            default: \"\"\n        dena_url:\n            type: string\n            default: \"\"\n        ponpare_url:\n            type: string\n            default: \"\"\n    OneToOne:\n        Product:\n            targetEntity: Eccube\\Entity\\Product\n            joinColumn:\n                name: product_id\n                referencedColumnName: product_id\n    lifecycleCallbacks: {  }\n```\n\n\u6b21\u306bRepository{[Repository/OtherSiteRepository.php](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Repository/?at=master)}\u3092\u66f8\u304d\u307e\u3059\u3002\n\u4eca\u56de\u306f\u4f7f\u308f\u306a\u3044\u304b\u3089\u7a7a\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n```lang:php\n\n<?php\n\nnamespace Plugin\\OtherSite\\Repository;\n\nuse Doctrine\\ORM\\EntityRepository;\n\nclass OtherSiteRepository extends EntityRepository\n{\n}\n\n```\n\n\u30c6\u30fc\u30d6\u30eb\u3092\u7ba1\u7406\u3059\u308b\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb{[Migration/Version20151201000000.php](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Migration/Version20151201000000.php?at=master&fileviewer=file-view-default)}\u3092\u66f8\u304d\u307e\u3059\u3002\n\n```lang:php\n\n<?php\nnamespace DoctrineMigrations;\n\nuse Doctrine\\DBAL\\Migrations\\AbstractMigration;\nuse Doctrine\\DBAL\\Schema\\Schema;\n\nclass Version20151201000000 extends AbstractMigration\n{\n\n    public function up(Schema $schema)\n    {\n        $this->createOtherSiteTable($schema);\n    }\n\n    public function down(Schema $schema)\n    {\n        $schema->dropTable('plg_other_site');\n    }\n\n    protected function createOtherSiteTable(Schema $schema)\n    {\n        $table = $schema->createTable(\"plg_other_site\");\n        $table->addColumn('product_id', 'integer');\n        $option=array('length' => 255,'notnull' => false);\n        $table->addColumn('rakuten_url', 'string', $option);\n        $table->addColumn('yahoo_url', 'string', $option);\n        $table->addColumn('amazon_url', 'string', $option);\n        $table->addColumn('dena_url', 'string', $option);\n        $table->addColumn('ponpare_url', 'string', $option);\n        $table->setPrimaryKey(array('product_id'));\n    }\n}\n```\n\n\n## \u30d5\u30a9\u30fc\u30e0\u306e\u62e1\u5f35\n\u7ba1\u7406\u753b\u9762\u306e\u5546\u54c1\u767b\u9332\u753b\u9762\u306b\u30e2\u30fc\u30eb\u306eURL\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3059\u308b\u70ba\u306b{[Form/Extension/Admin/OtherSiteCollectionExtension.php](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Form/Extension/Admin/OtherSiteCollectionExtension.php?at=master&fileviewer=file-view-default)}\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```lang:php\n<?php\n\nnamespace Plugin\\OtherSite\\Form\\Extension\\Admin;\n\nuse Symfony\\Component\\Form\\AbstractTypeExtension;\nuse Symfony\\Component\\Form\\FormBuilderInterface;\nuse Symfony\\Component\\Form\\FormInterface;\nuse Symfony\\Component\\Form\\FormView;\n\nclass OtherSiteCollectionExtension extends AbstractTypeExtension\n{\n    public function buildForm(FormBuilderInterface $builder, array $options)\n    {\n\n        $builder\n            ->add('rakuten_url', 'text', array(\n                'label' => '\u697d\u5929\u5e02\u5834URL',\n                'mapped' => false,\n            ))\n            ->add('yahoo_url', 'text', array(\n                'label' => 'Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0URL',\n                'mapped' => false,\n            ))\n            ->add('amazon_url', 'text', array(\n                'label' => 'AmazonURL',\n                'mapped' => false,\n            ))\n            ->add('dena_url', 'text', array(\n                'label' => 'DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0URL',\n                'mapped' => false,\n            ))\n            ->add('ponpare_url', 'text', array(\n                'label' => '\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30ebURL',\n                'mapped' => false,\n            ))\n        ;\n    }\n\n    public function buildView(FormView $view, FormInterface $form, array $options)\n    {\n    }\n\n    public function getExtendedType()\n    {\n        return 'admin_product';\n    }\n\n}\n```\n\n## \u8868\u793a\u306e\u5909\u66f4\n\u7ba1\u7406\u753b\u9762\u306b\u8ffd\u52a0\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8{[Resource/template/Admin/other_site.twig](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Resource/template/Admin/other_site.twig?at=master&fileviewer=file-view-default)}\u3068\u5546\u54c1\u8a73\u7d30\u753b\u9762\u306b\u8ffd\u52a0\u3059\u308b\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8{[Resource/template/Front/other_site.twig](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/Resource/template/Front/other_site.twig?at=master&fileviewer=file-view-default)}\u3092[twig\u30de\u30ca\u30fc](http://twig.sensiolabs.org/)\u66f8\u304d\u307e\u3059\u3002\n\n\u7ba1\u7406\u753b\u9762\n\n```lang:twig\n\n</div>\n<div class=\"box accordion\">\n<div class=\"box accordion form-horizontal\">\n    <div class=\"box-header toggle\">\n        <h3 class=\"box-title\">\n        \t\u305d\u306e\u4ed6\u306e\u30b5\u30a4\u30c8\n            <svg class=\"cb cb-angle-down icon_down\"> <use xlink:href=\"#cb-angle-down\" /></svg>\n        </h3>\n    </div><!-- /.box-header -->\n    <div class=\"box-body accpanel\">\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"col-sm-3 control-label\">{{ form.rakuten_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n\t\t\t\t{{ form_widget(form.rakuten_url) }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"col-sm-3 control-label\">{{ form.yahoo_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n\t\t\t\t{{ form_widget(form.yahoo_url) }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"col-sm-3 control-label\">{{ form.amazon_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n\t\t\t\t{{ form_widget(form.amazon_url) }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"col-sm-3 control-label\">{{ form.dena_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n\t\t\t\t{{ form_widget(form.dena_url) }}\n\t\t\t</div>\n\t\t</div>\n\t\t<div class=\"form-group\">\n\t\t\t<label class=\"col-sm-3 control-label\">{{ form.ponpare_url.vars.label }}</label>\n            <div class=\"col-sm-8 col-lg-9\">\n\t\t\t\t{{ form_widget(form.ponpare_url) }}\n\t\t\t</div>\n\t\t</div>\n    </div>\n</div>\n\n```\n\n\u5546\u54c1\u8a73\u7d30\u753b\u9762\n\n```lang:php\n<div class=\"other_site\">\n    <h4>\u3053\u3061\u3089\u306e\u30b5\u30a4\u30c8\u3067\u3082\u304a\u8cb7\u3044\u6c42\u3081\u9802\u3051\u307e\u3059\u3002</h4>\n    <ul class=\"row\">\n\t\t{% if OtherSite.rakuten_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.rakuten_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">\u697d\u5929\u5e02\u5834</a></li>{% endif %}\n\t\t{% if OtherSite.amazon_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.amazon_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">Amazon</a></li>{% endif %}\n\t\t{% if OtherSite.yahoo_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.yahoo_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">Yahoo\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0</a></li>{% endif %}\n\t\t{% if OtherSite.dena_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.dena_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">DeNA\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0</a></li>{% endif %}\n\t\t{% if OtherSite.ponpare_url %}<li class=\"col-xs-6 col-sm-4\"><a href=\"{{ OtherSite.ponpare_url }}\" target=\"_blank\" class=\"btn btn-default btn-sm btn-block\">\u30dd\u30f3\u30d1\u30ec\u30e2\u30fc\u30eb</a></li>{% endif %}\n    </ul>\n</div>\n\n```\n\n\n\n## \u30a4\u30d9\u30f3\u30c8\u306e\u51e6\u7406\u3092\u8a18\u8ff0\u3059\u308b\n\u5b9f\u969b\u3053\u3053\u306f\u8868\u793a\u306e\u5909\u66f4\u3084\u30d5\u30a9\u30fc\u30e0\u306e\u62e1\u5f35\u3084\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u3084\u308a\u306a\u304c\u3089\u8a18\u8ff0\u3057\u3066\u3044\u307e\u3059\u3002\n[OtherSiteEvent.php](https://bitbucket.org/junya_suzuki/ec-cube-other-site-plugin/src/f3c75c97ef6d2072e408e122a97e94370768f94c/OtherSiteEvent.php?at=master&fileviewer=file-view-default)\n\n```lang:php\n\n<?php\n\nnamespace Plugin\\OtherSite;\n\nuse Symfony\\Component\\DomCrawler\\Crawler;\nuse Symfony\\Component\\HttpKernel\\Event\\FilterResponseEvent;\n\nclass OtherSiteEvent\n{\n    private $app;\n\n    public function __construct($app)\n    {\n        $this->app = $app;\n    }\n\n    public function showOtherSite(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n\n        $id = $app['request']->attributes->get('id');\n        $Product = $app['eccube.repository.product']->find($id);\n        $OtherSite = $app['eccube.plugin.repository.other_site']->find($id);\n\n        if (count($OtherSite) > 0) {\n            $twig = $app->renderView(\n                'OtherSite/Resource/template/Front/other_site.twig',\n                array(\n                    'OtherSite' => $OtherSite,\n                )\n            );\n\n            $response = $event->getResponse();\n            $html = $response->getContent();\n            $crawler = new Crawler($html);\n            $oldElement = $crawler->filter('.cart_area .btn_area');\n            $oldHtml = $oldElement->html();\n            $newHtml = $oldHtml.$twig;\n\n            $html = $crawler->html();\n            $html = str_replace($oldHtml, $newHtml, $html);\n\n            $response->setContent($html);\n            $event->setResponse($response);\n        }\n    }\n\n    public function registerOtherSite(FilterResponseEvent $event)\n    {\n\n        $app = $this->app;\n        $id = $app['request']->attributes->get('id');\n\n        $form = $app['form.factory']->createBuilder('admin_product')->getForm();\n\n\t\t$OtherSite=$app['eccube.plugin.repository.other_site']->find($id);\n\t\t\t\t\t\n\t\tif (is_null($OtherSite)) {\n  \t\t\t$OtherSite = new \\Plugin\\OtherSite\\Entity\\OtherSite();\n\t\t}\n    \t$form->get('rakuten_url')->setData($OtherSite->getRakutenUrl());\n    \t$form->get('yahoo_url')->setData($OtherSite->getYahooUrl());\n    \t$form->get('amazon_url')->setData($OtherSite->getAmazonUrl());\n    \t$form->get('dena_url')->setData($OtherSite->getDenaUrl());\n    \t$form->get('ponpare_url')->setData($OtherSite->getPonpareUrl());\n\t\t\t\t\n\t    $form->handleRequest($app['request']);\t\t\n\n       if ('POST' === $app['request']->getMethod()) {\n            if ($form->isValid()) {\n                $Product = $app['eccube.repository.product']->find($id);\n                $OtherSite\n                    ->setProductId($Product->getId())\n                    ->setProduct($Product)\n                    ->setRakutenUrl($form->get('rakuten_url')->getData())\n                    ->setYahooUrl($form->get('yahoo_url')->getData())\n                    ->setAmazonUrl($form->get('amazon_url')->getData())\n                    ->setDenaUrl($form->get('dena_url')->getData())\n                    ->setPonpareUrl($form->get('ponpare_url')->getData())\n                    ;\n                $app['orm.em']->persist($OtherSite);\n                $app['orm.em']->flush();\n            }\n        }\n\n    }\n\n    public function addContentOnProductEdit(FilterResponseEvent $event)\n    {\n        $app = $this->app;\n        $request = $event->getRequest();\n        $response = $event->getResponse();\n        $id = $request->attributes->get('id');\n\n        $html = $response->getContent();\n        $crawler = new Crawler($html);\n\n        $form = $app['form.factory']\n            ->createBuilder('admin_product')\n            ->getForm();\n\n        if ($id) {\n            $Product = $app['eccube.repository.product']->find($id);\n        } else {\n            $Product = new \\Eccube\\Entity\\Product();\n        }\n\n        $OtherSite = $app['eccube.plugin.repository.other_site']->findOneBy(\n            array(\n                'product_id' => $id,\n            ));\n\t\tif (isset($OtherSite)) {\n        \t$form->get('rakuten_url')->setData($OtherSite->getRakutenUrl());\n        \t$form->get('yahoo_url')->setData($OtherSite->getYahooUrl());\n        \t$form->get('amazon_url')->setData($OtherSite->getAmazonUrl());\n        \t$form->get('dena_url')->setData($OtherSite->getDenaUrl());\n        \t$form->get('ponpare_url')->setData($OtherSite->getPonpareUrl());\n\t\t}\n        $form->handleRequest($request);\n\n\t\t$twig = $app->renderView('OtherSite/Resource/template/Admin/other_site.twig',\n    \t\t\tarray('form' => $form->createView()));\n\n\t\t$oldElement = $crawler\n\t\t    ->filter('.accordion')\n\t\t    ->last();\n\n\t\tif ($oldElement->count() > 0) {\n\t\t    $oldHtml = $oldElement->html();\n    \t\t$newHtml = $oldHtml.$twig;\n    \t\t$html = $crawler->html();\n    \t\t$html = str_replace($oldHtml, $newHtml, $html);\n\t\t    $response->setContent($html);\n    \t\t$event->setResponse($response);\n\t\t}\n    }\n}\n\n```\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u306b\u3057\u3066\u5b8c\u6210\n\u6700\u5f8c\u306b\u30d5\u30a1\u30a4\u30eb\u3092.tar.gz\u306b\u307e\u3068\u3081\u3066\u5b8c\u6210\n\u6ce8\uff1a\u30d7\u30e9\u30b0\u30a4\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u914d\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u7fa4\u3092\u30d1\u30c3\u30b1\u30fc\u30b8\u3059\u308b\u4e8b\u3002\n\n## \u5b8c\u6210\u54c1\n### \u7ba1\u7406\u753b\u9762\n<img width=\"2558\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-05 16.45.33.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/71312/51f09532-ac45-4fc2-da71-05024e27f1a2.jpeg\">\n\n\n### \u5546\u54c1\u8a73\u7d30\n<img width=\"1720\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-12-05 16.44.32.jpg\" src=\"https://qiita-image-store.s3.amazonaws.com/0/71312/61d41d9f-5c13-7f13-06b7-33e5703a1769.jpeg\">\n\n\n# EC-CUBE PLUGIN AWARD 3.0\u306b\u51fa\u3059\n## \u30d1\u30fc\u30c8\u30ca\u30fc\u767b\u9332\u3092\u3059\u308b\n[EC-CUBE\u30d1\u30fc\u30c8\u30ca\u30fc\u767b\u9332](https://www.ec-cube.net/entry/partner_kiyaku.php)\n\u767b\u9332\u3057\u305f\u3093\u3067\u3059\u304c\u3001\u7d44\u7e54\u540d\u3001\u7d44\u7e54URL\u3001\u7d44\u7e54\u8aac\u660e\u306f\u30b3\u30f3\u30c6\u30b9\u30c8\u5fdc\u52df\u306e\u6577\u5c45\u3092\u9ad8\u304f\u3057\u3066\u308b\u6c17\u304c\u3057\u307e\u3059\u3002\u500b\u4eba\u3067\u53c2\u52a0\u51fa\u6765\u308b\u4e8b\u306f\u3082\u3063\u3068\u660e\u793a\u3057\u305f\u65b9\u304c\u3044\u3044\u306e\u3067\u306f\uff1f\n\n## \u30d7\u30e9\u30b0\u30a4\u30f3\u7533\u8acb\u6e96\u5099\n[EC-CUBE\u30d7\u30e9\u30b0\u30a4\u30f3\u7533\u8acb\u30de\u30cb\u30e5\u30a2\u30eb](https://www.ec-cube.net/document/GL02_plugin_apply.pdf)\u3092\u53c2\u8003\u306b\u30ed\u30b4\u3068\u304b\u8aac\u660e\u3068\u304b\u5165\u529b\u3057\u3066\u7533\u8acb\u5b8c\u4e86\u3002\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3057\u305f\u3002\n\n# \u307e\u3060\u307e\u3060\u5168\u7136\u7406\u89e3\u3057\u3066\u306a\u3044\u3051\u3069\u4ed6\u306b\u4f55\u4f5c\u308d\u3046\u304b\u306a\u3041 :trollface: \n\n", "tags": ["EC-CUBE3"]}