{"context": " More than 1 year has passed since last update.\n\n\u3059\u3044\u307e\u305b\u3093\u3067\u3057\u305f...\n24\u65e5\u306b\u767b\u9332\u3057\u305f\u3064\u3082\u308a\u3067\u3044\u307e\u3057\u305f\u3002\u3053\u306e\u8a18\u4e8b\u306f mod_mruby\u30fbngx_mruby Advent Calendar 2014 23\u65e5 \u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059...\n\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3002\n\nDocker\u3067\u30d3\u30eb\u30c9\u541b\u3092\u4f5c\u308d\u3046\n\u30af\u30ea\u30b9\u30de\u30b9\u306a\u306e\u3067mod_mruby\u3092Docker\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\u305f\u3060\u30d3\u30eb\u30c9\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30d0\u30a4\u30ca\u30ea\u3092\u5410\u304d\u51fa\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u516c\u5f0f\u3092\u3082\u3068\u306b\u3053\u3046\u3044\u3046Dockerfile\u3092\u4f5c\u308b\u3002\n\nbase/Dockerfile\nFROM ubuntu:trusty\nMAINTAINER Uchio KONDO <udzura@udzura.jp>\n\nENV DEBIAN_FRONTEND noninteractive\nRUN apt-get -y update\nRUN apt-get -y install \\\n    sudo git curl bison \\\n    apache2 apache2-dev apache2-utils \\\n    ruby2.0 ruby2.0-dev rake \\\n    libcurl4-openssl-dev libhiredis-dev libmarkdown2-dev libcap-dev libcgroup-dev\n\nWORKDIR /usr/local/src/\nRUN git clone https://github.com/matsumoto-r/mod_mruby.git\n\nWORKDIR /usr/local/src/mod_mruby\nRUN git submodule init\nRUN git submodule update\n\nADD run-all.sh /usr/local/bin/run-all.sh\nRUN chmod a+x /usr/local/bin/run-all.sh\n\nENTRYPOINT [\"/usr/local/bin/run-all.sh\"]\nCMD [\"build\"]\n\n\nrun-all.sh \u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\nbase/run-all.sh\n#!/bin/bash\nset -x\nset -e\n\nif [ \"$1\" = \"check\" ]; then\n  check=true\nfi\n\nsh build.sh 1>&2\nmake install 1>&2\n\nif [ -z \"$check\" ]; then\n  cat /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\nelse\n  file /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\n  ls -l /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\nfi\n\n\n\u3042\u3068\u306f\n$ docker build -t udzura/mod_mruby-builder base/\n$ docker run --rm udzura/mod_mruby-builder > out/mod_mruby.so\n$ file out/mod_mruby.so \nout/mod_mruby.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, not stripped\n\n\u3053\u308c\u309264bit Ubuntu\u306b\u7a81\u3063\u8fbc\u3081\u3070\u52d5\u304d\u307e\u3059\u3002\u4fbf\u5229!!!!\uff08apt-get -y install libhiredis0.10 \u306f\u3042\u3089\u304b\u3058\u3081\u5fc5\u8981\u3067\u3059\uff09\u3002\n\nONBUILD \u3067 build_config.rb \u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\n\u3053\u3053\u307e\u3067\u306a\u3089\u3001\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u3092 @hfm \u3055\u3093\u304c\u3084\u3063\u3066\u3044\u3089\u3063\u3057\u3083\u308b\u3002\n\nhttps://github.com/tacahilo/docker-ngx_mruby-memcached\n\n\u3082\u3046\u3059\u3053\u3057Docker\u3089\u3057\u304f\u3059\u308b\u305f\u3081\u306b ONBUILD \u3067 build_config.rb \u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u306e\u8853\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\ndiff --git a/base/Dockerfile b/base/Dockerfile\nindex 36624ec..0145f7f 100644\n--- a/base/Dockerfile\n+++ b/base/Dockerfile\n@@ -19,5 +19,7 @@ RUN git submodule update\n ADD run-all.sh /usr/local/bin/run-all.sh\n RUN chmod a+x /usr/local/bin/run-all.sh\n\n+ONBUILD ADD build_config.rb /usr/local/src/mod_mruby/build_config.rb\n+\n ENTRYPOINT [\"/usr/local/bin/run-all.sh\"]\n CMD [\"build\"]\n\nonbuild\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eDockerfile\u3092\u5225\u9014\u7528\u610f...\u30b7\u30f3\u30d7\u30eb...\n\nonbuild/Dockerfile\nFROM udzura/mod_mruby-builder\nMAINTAINER Uchio KONDO <udzura@udzura.jp>\n\n\n\u4ee5\u4e0b\u306e build_config.rb \u3092\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7528\u610f\u3059\u308b\u3002\n\nonbuild/build_config.rb\nMRuby::Build.new do |conf|\n  toolchain :gcc\n  conf.gembox 'full-core'\n  conf.gem :github => 'iij/mruby-io'\n  conf.gem :github => 'iij/mruby-env'\n  conf.gem :github => 'iij/mruby-dir'\n  conf.gem :github => 'iij/mruby-digest'\n  conf.gem :github => 'iij/mruby-process'\n  conf.gem :github => 'iij/mruby-pack'\n  conf.gem :github => 'mattn/mruby-json'\n  conf.gem :github => 'mattn/mruby-onig-regexp'\n  conf.gem :github => 'matsumoto-r/mruby-redis'\n  conf.gem :github => 'matsumoto-r/mruby-vedis'\n  conf.gem :github => 'matsumoto-r/mruby-sleep'\n  conf.gem :github => 'matsumoto-r/mruby-userdata'\n  conf.gem :github => 'matsumoto-r/mruby-uname'\n  conf.gem '../mrbgems/mod_mruby_mrblib'\n\n  # \u3053\u308c\u3092\u8ffd\u52a0\n  conf.gem :github => 'matsumoto-r/mruby-discount'\n\n  conf.cc do |cc|\n    if ENV['BUILD_TYPE'] == \"debug\"\n      cc.flags << '-fPIC -g3 -Wall -Werror-implicit-function-declaration'\n    else\n      cc.flags << '-fPIC'\n    end\n    if ENV['BUILD_BIT'] == \"64\"\n      cc.flags << ' -DMRB_INT64'\n    end\n  end\n\n  conf.linker do |linker|\n    if ENV['BUILD_BIT'] == \"64\"\n      linker.flags = '-DMRB_INT64'\n    end\n  end\nend\n\n\n\u30ab\u30b9\u30bf\u30e0\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n$ docker build -t udzura/mod_mruby-builder base/\n$ docker build -t udzura/mod_mruby-done onbuild/\n$ docker run --rm udzura/mod_mruby-done > out/mod_mruby.so\n\n\u3053\u306e mod_mruby.so \u3092\u540c\u69d8\u306b\u30b3\u30d4\u30fc\u3057\u3001 libmarkdown2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\n\nhttps://gist.github.com/udzura/dccf796cc7bfae7c766e\n\n \u306b\u3042\u308b\u3088\u3046\u306amruby\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u52d5\u304b\u3059\u3068:\n\n\u52d5\u3044\u305f\u301c\n\n\u307e\u3068\u3081\n\u3068\u8a00\u3046\u3053\u3068\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u50d5\u3060\u3051\u306e\u6700\u5f37\u306e mod_mruby.so \u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308bDocker image\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\nmruby\u306f\u57fa\u672c\u7684\u306b\u3059\u3079\u3066\u306emrbgems\u3092\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30ea\u30f3\u30af\u3059\u308b\u306e\u3067\u3001\u65b0\u305f\u306agem\u3092\u5229\u7528\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u3057\u76f4\u3057\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u3067\u3059\u304c\u3001\u3053\u3046\u8a00\u3046\u7c21\u5358\u4e00\u767a\u30d3\u30eb\u30c9\u541b\u3092\u4f5c\u3063\u3066\u304a\u304f\u3068\u4f55\u304b\u3068\u4fbf\u5229\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\uff08\u3053\u3046\u8a00\u3046\u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u6210\u3067\u304d\u308b\u3053\u3068\u306f\u3001\u9006\u306bmrbgems\u304c\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30ea\u30f3\u30af\u3055\u308c\u308b\u3053\u3068\u306e\u30e1\u30ea\u30c3\u30c8\u306e\u4e00\u3064\u3068\u8a00\u3048\u308b\u3067\u3057\u3087\u3046\uff09\u3002\n\u306a\u304a\u3001\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u3092 ngx_mruby \u3067\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u6700\u5f8c\u306b\u3001\u4eca\u56de\u306e\u624b\u9806\u304c\u3059\u3050\u306b\u8a66\u305b\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092 GitHub \u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\n\u672c\u5f53\u306e24\u65e5\u306f @cubicdaiya \u3055\u3093\u3067\u3057\u305f\u3002\n\u660e\u65e5\uff0825\u65e5\uff09\u306f @matsumotory \u3055\u3093\u306b\u3088\u308b\u6700\u5f8c\u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\uff01\n## \u3059\u3044\u307e\u305b\u3093\u3067\u3057\u305f...\n\n24\u65e5\u306b\u767b\u9332\u3057\u305f\u3064\u3082\u308a\u3067\u3044\u307e\u3057\u305f\u3002\u3053\u306e\u8a18\u4e8b\u306f mod_mruby\u30fbngx_mruby Advent Calendar 2014 **23\u65e5** \u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059...\n\n\u6c17\u3092\u53d6\u308a\u76f4\u3057\u3066\u3002\n\n## Docker\u3067\u30d3\u30eb\u30c9\u541b\u3092\u4f5c\u308d\u3046\n\n\u30af\u30ea\u30b9\u30de\u30b9\u306a\u306e\u3067mod_mruby\u3092Docker\u3067\u30d3\u30eb\u30c9\u3057\u307e\u3059\u3002\u305f\u3060\u30d3\u30eb\u30c9\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30d0\u30a4\u30ca\u30ea\u3092\u5410\u304d\u51fa\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u516c\u5f0f\u3092\u3082\u3068\u306b\u3053\u3046\u3044\u3046Dockerfile\u3092\u4f5c\u308b\u3002\n\n```docker:base/Dockerfile\nFROM ubuntu:trusty\nMAINTAINER Uchio KONDO <udzura@udzura.jp>\n\nENV DEBIAN_FRONTEND noninteractive\nRUN apt-get -y update\nRUN apt-get -y install \\\n    sudo git curl bison \\\n    apache2 apache2-dev apache2-utils \\\n    ruby2.0 ruby2.0-dev rake \\\n    libcurl4-openssl-dev libhiredis-dev libmarkdown2-dev libcap-dev libcgroup-dev\n\nWORKDIR /usr/local/src/\nRUN git clone https://github.com/matsumoto-r/mod_mruby.git\n\nWORKDIR /usr/local/src/mod_mruby\nRUN git submodule init\nRUN git submodule update\n\nADD run-all.sh /usr/local/bin/run-all.sh\nRUN chmod a+x /usr/local/bin/run-all.sh\n\nENTRYPOINT [\"/usr/local/bin/run-all.sh\"]\nCMD [\"build\"]\n```\n\n`run-all.sh` \u306f\u3053\u3093\u306a\u611f\u3058\u3067\u3002\n\n```sh:base/run-all.sh\n#!/bin/bash\nset -x\nset -e\n\nif [ \"$1\" = \"check\" ]; then\n  check=true\nfi\n\nsh build.sh 1>&2\nmake install 1>&2\n\nif [ -z \"$check\" ]; then\n  cat /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\nelse\n  file /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\n  ls -l /usr/local/src/mod_mruby/src/.libs/mod_mruby.so\nfi\n```\n\n\u3042\u3068\u306f\n\n```console\n$ docker build -t udzura/mod_mruby-builder base/\n$ docker run --rm udzura/mod_mruby-builder > out/mod_mruby.so\n$ file out/mod_mruby.so \nout/mod_mruby.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, not stripped\n```\n\n\u3053\u308c\u309264bit Ubuntu\u306b\u7a81\u3063\u8fbc\u3081\u3070\u52d5\u304d\u307e\u3059\u3002\u4fbf\u5229!!!!\uff08`apt-get -y install libhiredis0.10` \u306f\u3042\u3089\u304b\u3058\u3081\u5fc5\u8981\u3067\u3059\uff09\u3002\n\n## `ONBUILD` \u3067 `build_config.rb` \u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\n\n\u3053\u3053\u307e\u3067\u306a\u3089\u3001\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u3092 @hfm \u3055\u3093\u304c\u3084\u3063\u3066\u3044\u3089\u3063\u3057\u3083\u308b\u3002\n\n- https://github.com/tacahilo/docker-ngx_mruby-memcached\n\n\u3082\u3046\u3059\u3053\u3057Docker\u3089\u3057\u304f\u3059\u308b\u305f\u3081\u306b `ONBUILD` \u3067 `build_config.rb` \u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\u306e\u8853\u3092\u4f7f\u3063\u3066\u307f\u307e\u3059\u3002\n\n```diff\ndiff --git a/base/Dockerfile b/base/Dockerfile\nindex 36624ec..0145f7f 100644\n--- a/base/Dockerfile\n+++ b/base/Dockerfile\n@@ -19,5 +19,7 @@ RUN git submodule update\n ADD run-all.sh /usr/local/bin/run-all.sh\n RUN chmod a+x /usr/local/bin/run-all.sh\n \n+ONBUILD ADD build_config.rb /usr/local/src/mod_mruby/build_config.rb\n+\n ENTRYPOINT [\"/usr/local/bin/run-all.sh\"]\n CMD [\"build\"]\n```\n\nonbuild\u3092\u5229\u7528\u3059\u308b\u305f\u3081\u306eDockerfile\u3092\u5225\u9014\u7528\u610f...\u30b7\u30f3\u30d7\u30eb...\n\n```docker:onbuild/Dockerfile\nFROM udzura/mod_mruby-builder\nMAINTAINER Uchio KONDO <udzura@udzura.jp>\n```\n\n\u4ee5\u4e0b\u306e `build_config.rb` \u3092\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7528\u610f\u3059\u308b\u3002\n\n```rb:onbuild/build_config.rb\nMRuby::Build.new do |conf|\n  toolchain :gcc\n  conf.gembox 'full-core'\n  conf.gem :github => 'iij/mruby-io'\n  conf.gem :github => 'iij/mruby-env'\n  conf.gem :github => 'iij/mruby-dir'\n  conf.gem :github => 'iij/mruby-digest'\n  conf.gem :github => 'iij/mruby-process'\n  conf.gem :github => 'iij/mruby-pack'\n  conf.gem :github => 'mattn/mruby-json'\n  conf.gem :github => 'mattn/mruby-onig-regexp'\n  conf.gem :github => 'matsumoto-r/mruby-redis'\n  conf.gem :github => 'matsumoto-r/mruby-vedis'\n  conf.gem :github => 'matsumoto-r/mruby-sleep'\n  conf.gem :github => 'matsumoto-r/mruby-userdata'\n  conf.gem :github => 'matsumoto-r/mruby-uname'\n  conf.gem '../mrbgems/mod_mruby_mrblib'\n\n  # \u3053\u308c\u3092\u8ffd\u52a0\n  conf.gem :github => 'matsumoto-r/mruby-discount'\n\n  conf.cc do |cc|\n    if ENV['BUILD_TYPE'] == \"debug\"\n      cc.flags << '-fPIC -g3 -Wall -Werror-implicit-function-declaration'\n    else\n      cc.flags << '-fPIC'\n    end\n    if ENV['BUILD_BIT'] == \"64\"\n      cc.flags << ' -DMRB_INT64'\n    end\n  end\n\n  conf.linker do |linker|\n    if ENV['BUILD_BIT'] == \"64\"\n      linker.flags = '-DMRB_INT64'\n    end\n  end\nend\n```\n\n\u30ab\u30b9\u30bf\u30e0\u30d3\u30eb\u30c9\u3057\u3066\u307f\u307e\u3059\u3002\n\n\n```\n$ docker build -t udzura/mod_mruby-builder base/\n$ docker build -t udzura/mod_mruby-done onbuild/\n$ docker run --rm udzura/mod_mruby-done > out/mod_mruby.so\n```\n\n\u3053\u306e `mod_mruby.so` \u3092\u540c\u69d8\u306b\u30b3\u30d4\u30fc\u3057\u3001 libmarkdown2 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304b\u3089\n\n- https://gist.github.com/udzura/dccf796cc7bfae7c766e\n\n:arrow_up: \u306b\u3042\u308b\u3088\u3046\u306amruby\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u52d5\u304b\u3059\u3068:\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2014-12-24 14.36.35.png](https://qiita-image-store.s3.amazonaws.com/0/569/edcc7ec9-cb10-4f62-9e9a-238aa539509f.png)\n\n\u52d5\u3044\u305f\u301c\n\n## \u307e\u3068\u3081\n\n\u3068\u8a00\u3046\u3053\u3068\u3067\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u50d5\u3060\u3051\u306e\u6700\u5f37\u306e `mod_mruby.so` \u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u308bDocker image\u304c\u51fa\u6765\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n\nmruby\u306f\u57fa\u672c\u7684\u306b\u3059\u3079\u3066\u306emrbgems\u3092\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30ea\u30f3\u30af\u3059\u308b\u306e\u3067\u3001\u65b0\u305f\u306agem\u3092\u5229\u7528\u3059\u308b\u306b\u3042\u305f\u3063\u3066\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u3057\u76f4\u3057\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\u3067\u3059\u304c\u3001\u3053\u3046\u8a00\u3046\u7c21\u5358\u4e00\u767a\u30d3\u30eb\u30c9\u541b\u3092\u4f5c\u3063\u3066\u304a\u304f\u3068\u4f55\u304b\u3068\u4fbf\u5229\u3067\u306f\u306a\u3044\u304b\u3068\u601d\u3044\u307e\u3059\uff08\u3053\u3046\u8a00\u3046\u30d0\u30a4\u30ca\u30ea\u3092\u4f5c\u6210\u3067\u304d\u308b\u3053\u3068\u306f\u3001\u9006\u306bmrbgems\u304c\u30b9\u30bf\u30c6\u30a3\u30c3\u30af\u30ea\u30f3\u30af\u3055\u308c\u308b\u3053\u3068\u306e\u30e1\u30ea\u30c3\u30c8\u306e\u4e00\u3064\u3068\u8a00\u3048\u308b\u3067\u3057\u3087\u3046\uff09\u3002\n\n\u306a\u304a\u3001\u540c\u3058\u3088\u3046\u306a\u3053\u3068\u3092 ngx_mruby \u3067\u3082\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u6700\u5f8c\u306b\u3001\u4eca\u56de\u306e\u624b\u9806\u304c\u3059\u3050\u306b\u8a66\u305b\u308b\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092 [GitHub](https://github.com/udzura/mod_mruby-builder) \u306b\u7f6e\u304d\u307e\u3057\u305f\u3002\n\n----\n\n\u672c\u5f53\u306e24\u65e5\u306f @cubicdaiya \u3055\u3093\u3067\u3057\u305f\u3002\n\n\u660e\u65e5\uff0825\u65e5\uff09\u306f @matsumotory \u3055\u3093\u306b\u3088\u308b\u6700\u5f8c\u306e\u8a18\u4e8b\u3068\u306a\u308a\u307e\u3059\uff01\n", "tags": ["mod_mruby", "docker"]}