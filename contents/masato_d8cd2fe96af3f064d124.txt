{"context": " More than 1 year has passed since last update.2015\u5e741\u670812\u65e5\u306b\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305fN1QL DP4\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002N1QL\u3092\u4f7f\u3046\u3068Couchbase\u3092SQL\u30e9\u30a4\u30af\u306b\u30af\u30a8\u30ea\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fDP4 (Developer Preview 4)\u3067\u3059\u3002\n\nCentOS\u30b3\u30f3\u30c6\u30ca\u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nN1QL\u3092CentOS\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002CentOS\u306e\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30a4\u30e1\u30fc\u30b8\u3092\u3064\u304b\u3044\u307e\u3059\u3002\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u5b9f\u884c\u3059\u308b\u305f\u3081\u30018093\u30dd\u30fc\u30c8\u3092Docker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker pull centos:6.6\n$ docker run -it --name n1ql -p 8093:8093  centos:6.6 /bin/bash\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3068N1QL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002Downloads\u30da\u30fc\u30b8\u304b\u3089Red Hat 6\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n$ yum install -y wget tar\n$ wget -qO- http://packages.couchbase.com/releases/couchbase-query/dp4/couchbase-query_dev_preview4_x86_64_linux.tar.gz | tar -zxv -C ${HOME}\n\n\nN1QL\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\n\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\nCouchbase Server\u306b\u63a5\u7d9a\u3057\u3066\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ cd ~/cbq-dp4\n$ ./cbq-engine -datastore=http://10.3.0.7:8091/\n_time=\"2015-01-20T07:28:07Z\" _level=\"INFO\" _msg=\"New site created with url http://10.3.0.7:8091/\"\n_time=\"2015-01-20T07:28:08Z\" _level=\"INFO\" _msg=\"cbq-engine started\" version=\"cbq-dp4\" datastore=\"http://10.3.0.7:8091/\"\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306fCouchbase\u306e\u30da\u30fc\u30b8\u304b\u3089\u30aa\u30f3\u30e9\u30a4\u30f3\u3067\u8a66\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u306e\u8d77\u52d5\n\u5225\u306e\u30b7\u30a7\u30eb\u304b\u3089\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u3068\u540c\u3058\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002-engine\u30d5\u30e9\u30b0\u306b\u306flocalhost\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n$ cd ~/cbq-dp4\n$ ./cbq -engine=http://localhost:8093/\ncbq>\n\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306e\u60c5\u5831\u3092\u30af\u30a8\u30ea\u3057\u3066\u307f\u307e\u3059\u3002\ncbq> SELECT * FROM system:datastores \n{\n    \"requestID\": \"eee04b16-f680-4d9d-9521-d15f76a76c98\",\n    \"signature\": {\n        \"*\": \"*\"\n    },\n    \"results\": [\n        {\n            \"datastores\": {\n                \"id\": \"http://10.3.0.7:8091/\",\n                \"url\": \"http://10.3.0.7:8091/\"\n            }\n        }\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"759.196us\",\n        \"executionTime\": \"583.695us\",\n        \"resultCount\": 1,\n        \"resultSize\": 147\n    }\n}\n\n\nbeer-sample\u30d0\u30b1\u30c3\u30c8\u3092\u30af\u30a8\u30ea\u3059\u308b\nbeer-sample\u30d0\u30b1\u30c3\u30c8\u304b\u3089\u30af\u30a8\u30ea\u3059\u308b\u524d\u306b\u3001PRIMARY INDEX\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002beer-sample\u306f\u30d0\u30c3\u30af\u30c1\u30c3\u30af\u3067\u56f2\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\ncbq> CREATE PRIMARY INDEX ON `beer-sample` ;\n{\n    \"requestID\": \"917d9bde-706b-4845-b9e5-3637f803e155\",\n    \"signature\": null,\n    \"results\": [\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"824.505438ms\",\n        \"executionTime\": \"824.346364ms\",\n        \"resultCount\": 0,\n        \"resultSize\": 0\n    }\n}\n\nN1QL\u3092\u4f7f\u3046\u3068\u3001SQL\u306e\u3088\u3046\u306b\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\ncbq> SELECT * FROM `beer-sample` WHERE type='beer' LIMIT 2;\n{\n    \"requestID\": \"0f0857e3-d187-4745-a834-ca9a07709ce7\",\n    \"signature\": {\n        \"*\": \"*\"\n    },\n    \"results\": [\n        {\n            \"beer-sample\": {\n                \"abv\": 0,\n                \"brewery_id\": \"anheuser_busch\",\n                \"category\": \"North American Lager\",\n                \"description\": \"\",\n                \"ibu\": 0,\n                \"name\": \"Michelob Hefeweizen\",\n                \"srm\": 0,\n                \"style\": \"American-Style Lager\",\n                \"type\": \"beer\",\n                \"upc\": 0,\n                \"updated\": \"2010-07-22 20:00:20\"\n            }\n        },\n        {\n            \"beer-sample\": {\n                \"abv\": 9,\n                \"brewery_id\": \"brasserie_de_l_abbaye_val_dieu\",\n                \"description\": \"\",\n                \"ibu\": 0,\n                \"name\": \"Triple\",\n                \"srm\": 0,\n                \"type\": \"beer\",\n                \"upc\": 0,\n                \"updated\": \"2010-07-22 20:00:20\"\n            }\n        }\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"325.203897ms\",\n        \"executionTime\": \"325.095821ms\",\n        \"resultCount\": 2,\n        \"resultSize\": 842\n    }\n}\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3082\u540c\u69d8\u306b\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n2015\u5e741\u670812\u65e5\u306b[\u30ea\u30ea\u30fc\u30b9](http://blog.couchbase.com/n1ql-dp4-is-here)\u3055\u308c\u305f[N1QL DP4](http://docs.couchbase.com/developer/n1ql-dp3/n1ql-intro.html)\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002N1QL\u3092\u4f7f\u3046\u3068Couchbase\u3092SQL\u30e9\u30a4\u30af\u306b\u30af\u30a8\u30ea\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u73fe\u5728\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306fDP4 (Developer Preview 4)\u3067\u3059\u3002\n\n## CentOS\u30b3\u30f3\u30c6\u30ca\u3078\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nN1QL\u3092CentOS\u30b3\u30f3\u30c6\u30ca\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002CentOS\u306e[\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u30a4\u30e1\u30fc\u30b8](https://registry.hub.docker.com/u/library/centos/)\u3092\u3064\u304b\u3044\u307e\u3059\u3002\n\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u5b9f\u884c\u3059\u308b\u305f\u3081\u30018093\u30dd\u30fc\u30c8\u3092Docker\u30db\u30b9\u30c8\u306b\u30de\u30c3\u30d7\u3057\u3066\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n``` bash\n$ docker pull centos:6.6\n$ docker run -it --name n1ql -p 8093:8093  centos:6.6 /bin/bash\n```\n\n\u5fc5\u8981\u306a\u30d1\u30c3\u30b1\u30fc\u30b8\u3068N1QL\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002[Downloads](http://www.couchbase.com/nosql-databases/downloads#PreRelease)\u30da\u30fc\u30b8\u304b\u3089Red Hat 6\u7528\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u4f7f\u3044\u307e\u3059\u3002\n\n``` bash\n$ yum install -y wget tar\n$ wget -qO- http://packages.couchbase.com/releases/couchbase-query/dp4/couchbase-query_dev_preview4_x86_64_linux.tar.gz | tar -zxv -C ${HOME}\n```\n\n## N1QL\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\n\n### \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\n\nCouchbase Server\u306b\u63a5\u7d9a\u3057\u3066\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n``` bash\n$ cd ~/cbq-dp4\n$ ./cbq-engine -datastore=http://10.3.0.7:8091/\n_time=\"2015-01-20T07:28:07Z\" _level=\"INFO\" _msg=\"New site created with url http://10.3.0.7:8091/\"\n_time=\"2015-01-20T07:28:08Z\" _level=\"INFO\" _msg=\"cbq-engine started\" version=\"cbq-dp4\" datastore=\"http://10.3.0.7:8091/\"\n```\n\n\u30d6\u30e9\u30a6\u30b6\u3092\u958b\u3044\u3066\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n![n1ql_hello.png](https://qiita-image-store.s3.amazonaws.com/0/43745/9fa1f91d-d231-afde-1f93-88f20d97d4c5.png)\n\n\n\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u306fCouchbase\u306e\u30da\u30fc\u30b8\u304b\u3089[\u30aa\u30f3\u30e9\u30a4\u30f3](http://query.pub.couchbase.com/tutorial/#1)\u3067\u8a66\u3059\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\n### \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u306e\u8d77\u52d5\n\n\u5225\u306e\u30b7\u30a7\u30eb\u304b\u3089\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30c4\u30fc\u30eb\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u30b5\u30fc\u30d0\u30fc\u3068\u540c\u3058\u30b5\u30fc\u30d0\u30fc\u4e0a\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002`-engine`\u30d5\u30e9\u30b0\u306b\u306flocalhost\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n``` bash\n$ cd ~/cbq-dp4\n$ ./cbq -engine=http://localhost:8093/\ncbq>\n```\n\n\u30c7\u30fc\u30bf\u30b9\u30c8\u30a2\u306e\u60c5\u5831\u3092\u30af\u30a8\u30ea\u3057\u3066\u307f\u307e\u3059\u3002\n\n``` bash\ncbq> SELECT * FROM system:datastores \n{\n    \"requestID\": \"eee04b16-f680-4d9d-9521-d15f76a76c98\",\n    \"signature\": {\n        \"*\": \"*\"\n    },\n    \"results\": [\n        {\n            \"datastores\": {\n                \"id\": \"http://10.3.0.7:8091/\",\n                \"url\": \"http://10.3.0.7:8091/\"\n            }\n        }\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"759.196us\",\n        \"executionTime\": \"583.695us\",\n        \"resultCount\": 1,\n        \"resultSize\": 147\n    }\n}\n```\n\n### beer-sample\u30d0\u30b1\u30c3\u30c8\u3092\u30af\u30a8\u30ea\u3059\u308b\n\n`beer-sample`\u30d0\u30b1\u30c3\u30c8\u304b\u3089\u30af\u30a8\u30ea\u3059\u308b\u524d\u306b\u3001PRIMARY INDEX\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002`beer-sample`\u306f\u30d0\u30c3\u30af\u30c1\u30c3\u30af\u3067\u56f2\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n``` bash\ncbq> CREATE PRIMARY INDEX ON `beer-sample` ;\n{\n    \"requestID\": \"917d9bde-706b-4845-b9e5-3637f803e155\",\n    \"signature\": null,\n    \"results\": [\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"824.505438ms\",\n        \"executionTime\": \"824.346364ms\",\n        \"resultCount\": 0,\n        \"resultSize\": 0\n    }\n}\n```\n\nN1QL\u3092\u4f7f\u3046\u3068\u3001SQL\u306e\u3088\u3046\u306b\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n``` bash\ncbq> SELECT * FROM `beer-sample` WHERE type='beer' LIMIT 2;\n{\n    \"requestID\": \"0f0857e3-d187-4745-a834-ca9a07709ce7\",\n    \"signature\": {\n        \"*\": \"*\"\n    },\n    \"results\": [\n        {\n            \"beer-sample\": {\n                \"abv\": 0,\n                \"brewery_id\": \"anheuser_busch\",\n                \"category\": \"North American Lager\",\n                \"description\": \"\",\n                \"ibu\": 0,\n                \"name\": \"Michelob Hefeweizen\",\n                \"srm\": 0,\n                \"style\": \"American-Style Lager\",\n                \"type\": \"beer\",\n                \"upc\": 0,\n                \"updated\": \"2010-07-22 20:00:20\"\n            }\n        },\n        {\n            \"beer-sample\": {\n                \"abv\": 9,\n                \"brewery_id\": \"brasserie_de_l_abbaye_val_dieu\",\n                \"description\": \"\",\n                \"ibu\": 0,\n                \"name\": \"Triple\",\n                \"srm\": 0,\n                \"type\": \"beer\",\n                \"upc\": 0,\n                \"updated\": \"2010-07-22 20:00:20\"\n            }\n        }\n    ],\n    \"status\": \"success\",\n    \"metrics\": {\n        \"elapsedTime\": \"325.203897ms\",\n        \"executionTime\": \"325.095821ms\",\n        \"resultCount\": 2,\n        \"resultSize\": 842\n    }\n}\n```\n\n\u30d6\u30e9\u30a6\u30b6\u304b\u3089\u3082\u540c\u69d8\u306b\u30af\u30a8\u30ea\u3092\u5b9f\u884c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![n1ql_beer_sample_beers.png](https://qiita-image-store.s3.amazonaws.com/0/43745/c9b44cd9-2ae3-94d2-1933-65b979b8b289.png)\n\n\n\n\n", "tags": ["Couchbase3.0.1", "N1QLDP4"]}