{"tags": ["Django", "Celery", "Python"], "context": " More than 1 year has passed since last update.Celery \u306f Python \u3067\u975e\u540c\u671f\u51e6\u7406\u3092\u3059\u308b\u305f\u3081\u306e Task Queue \u3067\u3059\u3002\nCelery 3.0 \u307e\u3067\u306f Django \u3067\u4f7f\u3046\u5834\u5408\u306f django-celery \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nCelery 3.1 \u304b\u3089\u306f django-celery \u3092\u4f7f\u308f\u306a\u3044\u3079\u304d\u3068\u306a\u3063\u305f\u306e\u3067\u305d\u306e\u65b9\u6cd5\u3092\u8ff0\u3079\u307e\u3059\u3002\ndjango \u306e\u6e96\u5099\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3059\u308b\u306e\u3067\u3001\u5fc5\u8981\u3042\u308c\u3070 http://qiita.com/seizans/items/1dc744694c1072e2b8d3 \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u524d\u6e96\u5099\n\ncelery \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n$ pip install celery\n\n\nBroker \u3092\u7528\u610f\u3059\u308b\nCelery \u3067 stable \u306a Broker \u3068\u3057\u3066\u3044\u308b\u306e\u306f RabbitMQ \u3068 Redis \u3067\u3059\u3002(Amazon SQS \u306a\u3069\u3082 Experimental \u3068\u3057\u3066\u4f7f\u3048\u308b)\nRedis \u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u3068\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8d77\u52d5\u3055\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n$ brew install redis\n$ redis-server\n\n\n\u5fc5\u8981\u4e8b\u9805\u3092\u8a2d\u5b9a\u3059\u308b\n\u4ee5\u4e0b\u3001core \u3068\u3044\u3046\u540d\u524d\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7528\u610f\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\nsettings.py\ncore/settings.py \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nBROKER_URL = 'redis://localhost'\nCELERY_RESULT_BACKEND = 'redis'\nCELERY_TASK_SERIALIZER = 'json'\nCELERY_RESULT_SERIALIZER = 'json'\nCELERY_ACCEPT_CONTENT = ['json']\n\n\ncelery.py\ncore/celery.py \u3092\u6b21\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\nfrom __future__ import absolute_import\n\nimport os\n\nfrom celery import Celery\n\nfrom django.conf import settings\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')\n\napp = Celery('core')\n\napp.config_from_object('django.conf:settings')\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\n\n\n@app.task(bind=True)\ndef debug_task(self):\n    print('Request: {0!r}'.format(self.request))\n\n\ntasks.py\nfrom celery import shared_task\n\n\n@shared_task\ndef add(x, y):\n    return x + y\n\n\nviews.py\ncore/views.py \u306b\u52d5\u4f5c\u78ba\u8a8d\u7528\u306e\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cf\u30f3\u30c9\u30e9 (\u3068 urls.py \u306b\u305d\u306e\u5bfe\u5fdc)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nfrom django.shortcuts import render\n\nfrom .tasks import add\n\n\ndef hello(request):\n    result = add.delay(3, 8)\n    while not result.ready():\n        print 'spam'\n    print result.get()\n    return render(request, 'hello.html')\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n$ python manage.py runserver  # \u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\n$ celery -A core worker -l info  # celery \u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n\n\u3092\u5b9f\u884c\u3057\u305f\u5f8c\u3067\u8a72\u5f53 url \u3092\u53e9\u3051\u3070\u52d5\u4f5c\u78ba\u8a8d\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\n\u3088\u308a\u8a73\u3057\u304f\n\u4ed6\u306e\u8a2d\u5b9a\u9805\u76ee\u3001API \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3001\u30c7\u30fc\u30e2\u30f3\u3068\u3057\u3066\u306e\u4f7f\u3044\u65b9\u306a\u3069\u7d9a\u304d\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3002\nhttp://celery.readthedocs.org/en/latest/index.html\n\n\u53c2\u8003\n\nhttp://celery.readthedocs.org/en/latest/django/first-steps-with-django.html\nhttp://chriskief.com/2013/11/15/celery-3-1-with-django-django-celery-rabbitmq-and-macports/\n\n\nCelery \u306f Python \u3067\u975e\u540c\u671f\u51e6\u7406\u3092\u3059\u308b\u305f\u3081\u306e Task Queue \u3067\u3059\u3002\nCelery 3.0 \u307e\u3067\u306f Django \u3067\u4f7f\u3046\u5834\u5408\u306f django-celery \u3092\u4f7f\u3044\u307e\u3057\u305f\u3002\nCelery 3.1 \u304b\u3089\u306f django-celery \u3092\u4f7f\u308f\u306a\u3044\u3079\u304d\u3068\u306a\u3063\u305f\u306e\u3067\u305d\u306e\u65b9\u6cd5\u3092\u8ff0\u3079\u307e\u3059\u3002\n\ndjango \u306e\u6e96\u5099\u306b\u3064\u3044\u3066\u306f\u7701\u7565\u3059\u308b\u306e\u3067\u3001\u5fc5\u8981\u3042\u308c\u3070 http://qiita.com/seizans/items/1dc744694c1072e2b8d3 \u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n### \u524d\u6e96\u5099\n\n#### celery \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```\n$ pip install celery\n```\n\n#### Broker \u3092\u7528\u610f\u3059\u308b\n\nCelery \u3067 stable \u306a Broker \u3068\u3057\u3066\u3044\u308b\u306e\u306f RabbitMQ \u3068 Redis \u3067\u3059\u3002(Amazon SQS \u306a\u3069\u3082 Experimental \u3068\u3057\u3066\u4f7f\u3048\u308b)\nRedis \u3067\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u3068\u3057\u3066\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u8d77\u52d5\u3055\u305b\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ brew install redis\n$ redis-server\n```\n\n### \u5fc5\u8981\u4e8b\u9805\u3092\u8a2d\u5b9a\u3059\u308b\n\n\u4ee5\u4e0b\u3001core \u3068\u3044\u3046\u540d\u524d\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u7528\u610f\u3057\u3066\u3044\u308b\u524d\u63d0\u3067\u8a2d\u5b9a\u3092\u66f8\u304d\u307e\u3059\u3002\n\n#### settings.py\n\ncore/settings.py \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\nBROKER_URL = 'redis://localhost'\nCELERY_RESULT_BACKEND = 'redis'\nCELERY_TASK_SERIALIZER = 'json'\nCELERY_RESULT_SERIALIZER = 'json'\nCELERY_ACCEPT_CONTENT = ['json']\n```\n\n#### celery.py\n\ncore/celery.py \u3092\u6b21\u306e\u5185\u5bb9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```\nfrom __future__ import absolute_import\n\nimport os\n\nfrom celery import Celery\n\nfrom django.conf import settings\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')\n\napp = Celery('core')\n\napp.config_from_object('django.conf:settings')\napp.autodiscover_tasks(lambda: settings.INSTALLED_APPS)\n\n\n@app.task(bind=True)\ndef debug_task(self):\n    print('Request: {0!r}'.format(self.request))\n```\n\n#### tasks.py\n\n```\nfrom celery import shared_task\n\n\n@shared_task\ndef add(x, y):\n    return x + y\n```\n\n#### views.py\n\ncore/views.py \u306b\u52d5\u4f5c\u78ba\u8a8d\u7528\u306e\u4f8b\u3068\u3057\u3066\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30cf\u30f3\u30c9\u30e9 (\u3068 urls.py \u306b\u305d\u306e\u5bfe\u5fdc)\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```\nfrom django.shortcuts import render\n\nfrom .tasks import add\n\n\ndef hello(request):\n    result = add.delay(3, 8)\n    while not result.ready():\n        print 'spam'\n    print result.get()\n    return render(request, 'hello.html')\n```\n\n#### \u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\n\n```\n$ python manage.py runserver  # \u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\n$ celery -A core worker -l info  # celery \u30d7\u30ed\u30bb\u30b9\u3092\u8d77\u52d5\u3059\u308b\n```\n\n\u3092\u5b9f\u884c\u3057\u305f\u5f8c\u3067\u8a72\u5f53 url \u3092\u53e9\u3051\u3070\u52d5\u4f5c\u78ba\u8a8d\u3067\u304d\u308b\u3067\u3057\u3087\u3046\u3002\n\n### \u3088\u308a\u8a73\u3057\u304f\n\n\u4ed6\u306e\u8a2d\u5b9a\u9805\u76ee\u3001API \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3001\u30c7\u30fc\u30e2\u30f3\u3068\u3057\u3066\u306e\u4f7f\u3044\u65b9\u306a\u3069\u7d9a\u304d\u306f\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3002\nhttp://celery.readthedocs.org/en/latest/index.html\n\n\n### \u53c2\u8003\n\n- http://celery.readthedocs.org/en/latest/django/first-steps-with-django.html\n- http://chriskief.com/2013/11/15/celery-3-1-with-django-django-celery-rabbitmq-and-macports/"}