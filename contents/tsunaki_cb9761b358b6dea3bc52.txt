{"tags": ["CubieTruck", "\u30d9\u30a2\u30e1\u30bf\u30eb", "Debian", "tftp", "MAAS"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\nMaas + JuJu\u3067ARM\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u4f7f\u3063\u305f\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u305f\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305aWEB\u753b\u9762\u304b\u3089\u306e\u30b5\u30fc\u30d0\u8d77\u52d5\u3092\u76ee\u6a19\u306b\u7814\u7a76\u7528\u306eCPU\u30dc\u30fc\u30c9(CubieTruck)\u3067Network boot\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b\u3002\nCubieTruck\u306a\u3069CPU\u30dc\u30fc\u30c9\u306e\u5834\u5408\u3001boot\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u4f5c\u6210\u3057\u306a\u3044\u3068\u30c0\u30e1\u3060\u304c\u3001\u901a\u5e38\u306fbios\u306ePXE\u30d6\u30fc\u30c8\u3067\u3001\u3059\u3050\u306b\u8a66\u305b\u308b\u307f\u305f\u3044\u3002\n\u6ce8\u610f\uff1a\u30b9\u30da\u30c3\u30af\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u74b0\u5883\u306b\u3082\u3088\u308a\u307e\u3059\u304c\u3001NetBoot\u306e\u74b0\u5883\u69cb\u7bc9\u306f\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u69cb\u7bc9\u3059\u308b\u65b9\u306f\u6c17\u5408\u3044\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u203b\u30d5\u30a1\u30a4\u30ebI/O\u304c\u591a\u3044\u306e\u3067SSD\u306e\u7aef\u672b\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u3092\u884c\u3046\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30d9\u30a2\u30e1\u30bf\u30eb\u8abf\u67fb\u30e1\u30e2\n\u7269\u7406\u30b5\u30fc\u30d0\u3092\u30af\u30e9\u30a6\u30c9\u306e\u3088\u3046\u306b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u306a\u308b\u3002\n\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u6f14\u7b97\u306e\u6027\u80fd\u3084\u76f4\u63a5\u30e9\u30c3\u30af\u3078\u306e\u914d\u7f6e\u306a\u3069\u3001AWS\u30fbAzure\u306a\u3069\u3068\u306e\u5dee\u5225\u5316\u304c\u56f3\u308c\u308b\u305f\u3081\u3001\n\u4eca\u5f8c\u3001\u671f\u5f85\u3055\u308c\u308b\u6280\u8853\u3067\u3042\u308b\u306e\u3067\u3001\u7814\u7a76\u3068\u3057\u3066\u81ea\u5b85\u306b\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\u500b\u4eba\u7684\u3060\u304c\u3001\u56fd\u5185\u4f01\u696d\u306f\u30af\u30e9\u30a6\u30c9\u3088\u308a\u30a6\u30b1\u304c\u3044\u3044\u6c17\u304c\u3044\u3044\u3068\u601d\u3046\u3002\n\n\u30d9\u30a2\u30e1\u30bf\u30eb\u306e\u7279\u6027\u306b\u3064\u3044\u3066\n\u30d9\u30a2\u30e1\u30bf\u30eb\u3092\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30b5\u30fc\u30d3\u30b9\u3092\u57fa\u306b\u6bd4\u8f03\u3057\u3066\u307f\u308b\u3002\n\n\n\n\u30b5\u30fc\u30d3\u30b9\n\u4eee\u60f3\u5316\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\n\u4ed6\u30b5\u30fc\u30d0\u306e\u5f71\u97ff\n\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8\n\u521d\u671f\u8cbb\u7528\n\u69cb\u6210\u306e\u67d4\u8edf\u6027\n\n\n\n\n\u30d1\u30d6\u30ea\u30c3\u30af\u30af\u30e9\u30a6\u30c9(laaS)\n\u3042\u308a\n\u3042\u308a\n\u25cb\n\u25ce\n\u25b3\n\n\n\u7269\u7406\u30b5\u30fc\u30d0\n\u306a\u3057\n\u306a\u3057\n\u00d7\n\u00d7\n\u25cb\n\n\n\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\n\u306a\u3057\n\u306a\u3057\n\u25cb\n\u25cb\n\u25b3\n\n\n\n\u203b\u30d9\u30a2\u30e1\u30bf\u30eb\u306e\u521d\u671f\u8cbb\u7528\u306b\u3064\u3044\u3066\u306f\u3001\u30b5\u30fc\u30d0\u3092CPU\u30dc\u30fc\u30c9\u3084\u30d6\u30ec\u30fc\u30c9\u30b5\u30fc\u30d0\u3067\u60f3\u5b9a\u3002\n\n\u8ab2\u984c\n\u30fbArm\u3067\u306e\u60c5\u5831\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304a\u3088\u3073\u66f8\u7c4d\u306a\u3069\u306e\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u3001\u30cf\u30fc\u30c9\u30eb\u9ad8\u3044\uff01\uff01\n\n\u4eca\u56de\u69cb\u7bc9\u3059\u308b\u69cb\u6210\u306b\u3064\u3044\u3066\n\u6e96\u5099\u3057\u305f\u74b0\u5883\n\u3000\u25a0 tftp\u30b5\u30fc\u30d0 (SSD boot)\n\u3000\u3000\u30fbCubietruck : Lubuntu\n\u3000\u3000\u3000(CPU :ARM Cortex-A7 Dual-Core, MEM: 2GB, Storage: 240G(Intel SSD)\uff09\n\n\u3000\u25a0 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30fc\u30d0\n\u3000\u3000\u30fbCubietruck \u00d7 2\n\u3000\u3000\u3000(CPU :ARM Cortex-A7 Dual-Core, MEM: 2GB, Storage: 16G(SDCard)\uff09\n\n\u3000\u25a0 DHCP\u30b5\u30fc\u30d0\uff08\u7121\u7dda\u30eb\u30fc\u30bf\u517c\u7528\uff09\n\u3000\u3000\u30fbRaspberry PI TYPE B\n\n\u3000\u25a0 \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\n\u3000\u3000\u30fbMac book Air\n\u3000\u3000 ( VMWaer Fusion: Ubuntu 14.04 CPU: 2 / MEM: 4GB)\n\u3000 \n\u3000\u305d\u306e\u4ed6 \u30fbUSB\uff0d\u30b7\u30ea\u30a2\u30eb\u5909\u63db\u30b1\u30fc\u30d6\u30eb\n      \u3000\u30fbCubie-PC\u63a5\u7d9a\u7528\u306eUSB(A-mini B)\u304c\u30b1\u30fc\u30d6\u30eb\n      \u3000\u30fbswitch(LAN HUB)\n      \u3000\u30fbSD\u30ab\u30fc\u30c9\u30e9\u30a4\u30bf\u30fc (MacBook Air 11\u306a\u3069\u306e\u5834\u5408)\n\n\n\u3010\u30b5\u30fc\u30d0\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u56f3\u3011\n\n\u203bMac\u304b\u3089cubie\u5074\u306e\u30bb\u30b0\u3078\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u8a2d\u5b9a\u6e08\u307f\u3002\n$ sudo route -n add 192.168.100.0/24 192.168.10.3\n\nCubietruck\u306etftp\u30b5\u30fc\u30d0\u4f5c\u6210\n\n\u30a4\u30e1\u30fc\u30b8\u6e96\u5099\nCubietruck\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001SD\u30ab\u30fc\u30c9\u306f\u4f7f\u308f\u305a\u3001USB OTG\u7d4c\u7531\u3067SSD\u3078\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148(lubuntu)\nhttp://docs.cubieboard.org/tutorials/a20-cubietruck_lubuntu_server_releases\n\u30a4\u30e1\u30fc\u30b8\u306e\u66f8\u304d\u8fbc\u307f\u30c4\u30fc\u30eb(Livesuit)\nhttp://docs.cubieboard.org/downloads\n\u30c4\u30fc\u30eb\u306e\u624b\u9806\u901a\u308aCubietruck\u306eUSB OTG\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u203b H/W\u306e\u6a2a\u306b\u3064\u3044\u3066\u308b\u3001FELkey\u3092\u62bc\u3057\u305f\u307e\u307eUSB\u3067PC\u3092\u63a5\u7d9a\u3057\u3001\u63a5\u7d9a\u5f8c\u306b\u30dc\u30bf\u30f3\u3092\u96e2\u3059\u3002\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\nssh ID/PASS : linaro/linaro\n# nic\u306e\u8a2d\u5b9a\u304cdhcp\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001static\u306b\u5909\u66f4\n$ sudo vi /etc/network/interfaces \nauto lo eth0\niface lo inet loopback\n# iface eth0 inet dhcp\niface eth0 inet static\naddress 192.168.100.2\nnetmask 255.255.255.0\ngateway 192.168.100.1\n\n# \u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u304c\u306a\u3044\u306e\u3067\u518d\u8d77\u52d5\u3059\u308b (ifup/ifdown\u53ef)\n$ sudo reboot\n\n\nSSD\u306e\u8a2d\u5b9a\u3059\u308b\n$ sudo fdisk /dev/sda\n Command (m for help): d\n Command (m for help): n\n  Partition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\n  Select (default p): p\n  Partition number (1-4, default 1): \n  Using default value 1\n  First sector (2048-468862127, default 2048): \n  Using default value 2048\n  Last sector, +sectors or +size{K,M,G} (2048-468862127, default 468862127): \n  Using default value 468862127\n\n Command (m for help): w\n\n$ sudo mkfs.ext4 /dev/sda1\n\n# Root\u30c7\u30a3\u30b9\u30af\u3092SSD\u306b\u30b3\u30d4\u30fc\n$ sudo dd if=/dev/nandb of=/dev/sda1 bs=1M\n\n# Boot\u30d5\u30a1\u30a4\u30eb\u306bRootfs\u3092\u8a2d\u5b9a\n$ mkdir /tmp/boot\n$ sudo mount /dev/nanda /tmp/boot\n\n# Rootfs\u3092\u4ee5\u4e0b\u306b\u5909\u66f4\n$ sudo vi /tmp/boot/uEnv.txt\n  nand_root=/dev/sda1\n\n$ sync\n$ sudo reboot \n\n# \u518d\u8d77\u52d5\u5f8c\u306bdf\u30b5\u30a4\u30ba\u78ba\u8a8d(\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u30682GB\u3057\u304b\u4f7f\u3048\u306a\u3044)\n$ df -h\n Filesystem      Size  Used Avail Use% Mounted on\n /dev/root       2.0G  655M  1.3G  34% /\n devtmpfs        889M  4.0K  889M   1% /dev\n none            4.0K     0  4.0K   0% /sys/fs/cgroup\n tmpfs            20M     0   20M   0% /tmp\n none            197M  160K  197M   1% /run\n none            5.0M     0  5.0M   0% /run/lock\n none            985M     0  985M   0% /run/shm\n none            100M     0  100M   0% /run/user\n\n# \u9818\u57df\u306e\u62e1\u5f35\n$ sudo resize2fs /dev/sda1\n$ df -h\n Filesystem      Size  Used Avail Use% Mounted on\n /dev/root       221G  656M  211G   1% /\n devtmpfs        889M  4.0K  889M   1% /dev\n none            4.0K     0  4.0K   0% /sys/fs/cgroup\n tmpfs            20M     0   20M   0% /tmp\n none            197M  160K  197M   1% /run\n none            5.0M     0  5.0M   0% /run/lock\n none            985M     0  985M   0% /run/shm\n none            100M     0  100M   0% /run/user\n\n\n\n\u30b5\u30fc\u30d0\u306e\u521d\u671f\u8a2d\u5b9a\n# \u4ee5\u4e0b\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8a2d\u5b9a\n$ sudo vi /etc/apt/sources.list\ndeb http://old-releases.ubuntu.com/ubuntu/ raring main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-security main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-security main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-updates main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-updates main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-backports main restricted universe multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-backports main restricted universe multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-proposed main restricted universe multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-proposed main restricted universe multiverse\n\n\n$ sudo apt-get update\n\n# Time zone\u306e\u8a2d\u5b9a\n$ sudo mv /etc/localtime /etc/localtime.org\n$ sudo ln -s /usr/share/zoneinfo/Japan /etc/localtime\n$ sudo apt-get install -y ntp\n$ date\n\n# \u4e0d\u8981\u306a\u30df\u30c9\u30eb\u524a\u9664\n$ sudo apt-get remove --purge mysql-server mysql-client mysql-common\n$ sudo apt-get autoremove\n$ sudo apt-get autoclean \n\n\n\ntftp\u30b5\u30fc\u30d0\u306e\u30a4\u30b9\u30c8\u30fc\u30eb\nNetBoot\u306e\u30a4\u30e1\u30fc\u30b8\u914d\u5e03\u30b5\u30fc\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n$ sudo apt-get install -y xinetd tftpd tftp\n$ sudo mkdir /usr/local/tftpboot\n$ sudo chmod -R 777 /usr/local/tftpboot\n$ sudo chown -R nobody /usr/local/tftpboot\n\n\n$ sudo mkdir /etc/xinetd.d\n$ sudo vi /etc/xinetd.d/tftp\nservice tftp\n{\n    protocol        = udp\n    port            = 69\n    socket_type     = dgram\n    wait            = yes\n    user            = nobody\n    server          = /usr/sbin/in.tftpd\n    server_args     = /usr/local/tftpboot\n    disable         = no\n}\n\n$ sudo /etc/init.d/xinetd restart\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\n$ sudo vi /usr/local/tftpboot/test.txt\ntest\n$ ls -l /usr/local/tftpboot/\ntotal 4\n-rw-r--r-- 1 root root 5 Jan  1 04:59 test.txt\n\n$ tftp 192.168.100.2\ntftp> get test.txt\nReceived 6 bytes in 0.0 seconds\ntftp> quit\n\n\n\nNFS\u30b5\u30fc\u30d0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u5404\u30ce\u30fc\u30c9\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3059\u308brootfs\u7528\u306eNFS\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u8d77\u52d5\u7528\u306eSD\u3060\u3051\u3067\u52d5\u304b\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n$ sudo apt-get install nfs-kernel-server rpcbind nfs-common\n\n# rootfs\u306e\u9818\u57df\n$ sudo mkdir /usr/local/tftpboot/rootfs\n$ sudo chmod 755 /usr/local/tftpboot/rootfs\n\n# \u30de\u30a6\u30f3\u30c8\u8a31\u53ef\u3092\u4ee5\u4e0b\u3092\u8ffd\u8a18\n$ sudo vi /etc/exports\n/usr/local/tftpboot/rootfs *(rw,sync,no_root_squash,no_subtree_check)\n\n$ sudo exportfs -ra\n$ sudo /etc/init.d/nfs-kernel-server restart\n\n\n\n\u63a5\u7d9a\u30c6\u30b9\u30c8\nRaspberry Pi\u304b\u3089\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\n\npi$ sudo apt-get install nfs-common\npi$ sudo mkdir -p /mnt/nfs\npi$ sudo mount 192.168.100.2:/usr/local/tftpboot/rootfs /mnt/nfs\npi$ sudo vi /mnt/nfs/test.txt\ntest\n\n# cubie\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u306e\u78ba\u8a8d\n$ ls -l /usr/local/tftpboot/rootfs\ntotal 4\n-rw-r--r-- 1 root root 5 Jan  1 16:11 test.txt\n\n\npi$ sudo umount /mnt/nfs\n\n\n\u30b5\u30fc\u30d0\u5074\u306e\u8a2d\u5b9a\u306f\u3053\u3053\u307e\u3067\u3002\n\nCubietruck\u306eNetwork Boot\u30a4\u30e1\u30fc\u30b8\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n\u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u306fMac\u4e0a\u306eUbuntu\u3067\u884c\u3046\u3053\u3068\u306b\u3059\u308b.\n\n\u521d\u671f\u6e96\u5099\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u306froot\u3067\u884c\u3046\n$ sudo su -\n\n$ apt-get update\n$ apt-get upgrade\n\n# \u30a4\u30e1\u30fc\u30b8\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install -y build-essential u-boot-tools libncurses-dev git make gcc g++-arm-linux-gnueabihf libusb-1.0-0-dev pkg-config dkms\n\n\n\u30a4\u30e1\u30fc\u30b8\u30d3\u30eb\u30c9\n# work\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n$ mkdir ~/build\n$ cd ~/build/\n\n# boot\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30ed\u30fc\u30c9(u-boot)\n$ git clone https://github.com/linux-sunxi/u-boot-sunxi.git\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\uff08FEL\u306fUSB\u30d6\u30fc\u30c8\u7528\uff09\n$ cd u-boot-sunxi\n$ cat boards.cfg | awk '{print $7}' | grep -i Cubietruck\n\n# boot\u30a4\u30e1\u30fc\u30b8\u30b3\u30f3\u30d1\u30a4\u30eb\n$ make Cubietruck_config CROSS_COMPILE=arm-linux-gnueabihf-\n$ make CROSS_COMPILE=arm-linux-gnueabihf-\n\n\n# boot script(script.bin)\u3092\u4f5c\u6210\n$ cd ~/build/\n$ git clone https://github.com/linux-sunxi/sunxi-tools\n$ git clone https://github.com/cubieboard/cubie_configs\n\n$ cd sunxi-tools\n$ make\n\n# script.bin\u306e\u4f5c\u6210\n$ cd ~/build/\n$ sunxi-tools/fex2bin cubie_configs/sysconfig/linux/cubietruck.fex script.bin\n\n\nscript.bin\u306e\u914d\u7f6e\n\u5168\u624b\u9806\u3067\u4f5c\u6210\u3057\u305fscript.bin\u3092scp\u306a\u3069\u3067Cubietruck\u306etftpboot\u306e\u30d5\u30a9\u30eb\u30c0\u3078\u79fb\u52d5(\u6a29\u9650 777)\n################ Cubietruck ################\n$ ls -l  /usr/local/tftpboot/script.bin\n-rwxrwxrwx 1 linaro linaro 46240 Jan  1 17:33 /usr/local/tftpboot/script.bin\n\n\nkernel\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n################ \u518d\u3073 mac\u4e0a\u3067\u306e\u4f5c\u696d ################\n# kernel\u30b3\u30f3\u30d1\u30a4\u30eb\n$ git clone http://github.com/cubieboard/linux-sunxi.git\n$ cp cubie_configs/kernel-configs/3.4/cubietruck_defconfig linux-sunxi/.config\n$ cd linux-sunxi\n\n# kernel\u306e\u8a2d\u5b9a\n$ make ARCH=arm menuconfig\n\nkernel \u8a2d\u5b9a\u753b\u9762\u304c\u8d77\u52d5\u3059\u308b\u3002\n\n\u3053\u3053\u3067\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u300c\u300d\u306b\u8a2d\u5b9a\u3059\u308b\nDevice Drivers --> Network device support --> ** CAIF transport drivers *** section --> Ethernet driver support --> Sunxi platform 10/100/1000Mbps Ethernet driver\n\n\u30b3\u30f3\u30d1\u30a4\u30eb\n$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- uImage modules\n\n# \u5b8c\u4e86\u5f8c\u306f\u3053\u3053\u306buImage\u304c\u4f5c\u6210\u3055\u308c\u308b\n$ ls -l arch/arm/boot/uImage\n\n\nuImage\u306e\u914d\u7f6e\n\u5168\u624b\u9806\u3067\u4f5c\u6210\u3057\u305fscript.bin\u3092scp\u306a\u3069\u3067Cubietruck\u306etftpboot\u306e\u30d5\u30a9\u30eb\u30c0\u3078\u79fb\u52d5(\u6a29\u9650 777)\n################ Cubietruck ################\n$ ls -l  /usr/local/tftpboot/\ntotal 4532\ndrwxr-xr-x 22 root   root      4096 Jan  1 18:25 rootfs\n-rwxrwxrwx  1 linaro linaro   46240 Jan  1 17:33 script.bin\n-rwxrwxrwx  1 linaro linaro 4583488 Jan  1 20:11 uImage\n\n\nrootfs\u306e\u6e96\u5099\nchroot\u3067\u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u3092\u5b9f\u65bd\u3059\u308b\u305f\u3081\u30bf\u30fc\u30b2\u30c3\u30c8\u306eOS\u306fDebian\u3068\u3059\u308b\u3002\n\u203btftp\u30b5\u30fc\u30d0\u3068\u306a\u308bCubietruck\u4e0a\u3067\u306e\u4f5c\u696d\n$ apt-get install qemu-user-static debootstrap binfmt-support\n\n# \u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n$ targetdir=/usr/local/tftpboot/rootfs\n$ distro=wheezy\n\n# root\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\n$ wget https://releases.linaro.org/13.04/ubuntu/quantal-images/nano/linaro-quantal-nano-20130422-342.tar.gz\n\n# \u30a4\u30e1\u30fc\u30b8\u306e\u5c55\u958b\n$ tar -xzf linaro-quantal-nano-20130422-342.tar.gz -C $targetdir\n\n# OS\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u6e96\u5099\n$ debootstrap --arch=armhf --foreign $distro $targetdir\n\n# \u30a4\u30e1\u30fc\u30b8\u3078\u30bd\u30fc\u30b9\u30b3\u30d4\u30fc\n$ cp /usr/bin/qemu-arm-static $targetdir/usr/bin/\n$ cp /etc/resolv.conf $targetdir/etc\n\n# \u30a4\u30e1\u30fc\u30b8\u306bchroot\u3057\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n$ chroot $targetdir\n\n$ distro=wheezy\n$ export LANG=C\n$ /debootstrap/debootstrap --second-stage\n\n$ cat <<EOT > /etc/apt/sources.list\ndeb http://ftp.kr.debian.org/debian $distro main contrib non-free\ndeb-src http://ftp.kr.debian.org/debian $distro main contrib non-free\ndeb http://ftp.kr.debian.org/debian $distro-updates main contrib non-free\ndeb-src http://ftp.kr.debian.org/debian $distro-updates main contrib non-free\ndeb http://security.debian.org/debian-security $distro/updates main contrib non-free\ndeb-src http://security.debian.org/debian-security $distro/updates main contrib non-free\nEOT\n\n$ cat <<EOT > /etc/apt/apt.conf.d/71-no-recommends\nAPT::Install-Recommends \"0\";\nAPT::Install-Suggests \"0\";\nEOT\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0(language\u8a2d\u5b9a)\n$ apt-get update\n$ apt-get install locales dialog\n$ dpkg-reconfigure locales\n\n# ssh,ntp \u30b5\u30fc\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install -y openssh-server ntpdate\n\n# root passwd\u8a2d\u5b9a\n$ passwd\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n$ echo <<EOT >> /etc/network/interfaces\nallow-hotplug eth0\niface eth0 inet dhcp\nEOT\n\n# HOSTNAME\u8a2d\u5b9a\n$ echo debian-armhf > /etc/hostname\n\n# \u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u8a2d\u5b9a\n$ echo T0:2345:respawn:/sbin/getty -L ttyS0 115200 vt100 >> /etc/inittab\n\n$ exit\n\n# \u4e00\u6642\u7684\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n$ rm $targetdir/etc/resolv.conf\n$ rm $targetdir/usr/bin/qemu-arm-static\n\n\nboot\u7528\u306eSD\u3092\u4f5c\u6210\nmac\u4e0a\u3067\u306e\u4f5c\u696d\n$ export card=/dev/sdd\n$ dd if=/dev/zero of=$card bs=2M count=1\n\n# \u3059\u3079\u3066\u306e\u9818\u57df\u3092\u5229\u7528\n$ fdisk $card\nCommand (m for help): n\nCommand (m for help): w\n\n$ mkfs.ext3 $card\n\n$ cd ~/build/u-boot-sunxi\n$ dd if=u-boot-sunxi-with-spl.bin of=$card bs=1024 seek=8\n\n\n\nCubieTruck Boot\u8a2d\u5b9a\n\u3053\u3053\u3067\u306f\u3001UART\u7d4c\u7531\u3067\u306e\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u4f5c\u696d\u304c\u5fc5\u8981\u3068\u306a\u308b\u3002\n\u30dc\u30fc\u30c9\u306eUART IO\u3068Mac\u4e0a\u306eUbuntu\u3068\u3067USB\u63a5\u7d9a\u3059\u308b\u3002\n# Ubuntu\u3067\u306e\u4f5c\u696d\n\n# \u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install picocom\n\n# \u30dc\u30fc\u30c9\u306b\u63a5\u7d9a\n$ picocom -b 115200 -d 8 -p n --send-cmd \"sz -y\" --receive-cmd \"rz -y\" /dev/ttyUSB0\npicocom v1.7\n\nport is        : /dev/ttyUSB0\nflowcontrol    : none\nbaudrate is    : 115200\nparity is      : none\ndatabits are   : 8\nescape is      : C-a\nlocal echo is  : no\nnoinit is      : no\nnoreset is     : no\nnolock is      : no\nsend_cmd is    : sz -y\nreceive_cmd is : rz -y\nimap is        : \nomap is        : \nemap is        : crcrlf,delbs,\n\nTerminal ready\n\n### ethaddr \u30a2\u30c9\u30ec\u30b9\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\nsun7i$ printenv\n\n\nsun7i$ saveenv default -a\nsun7i$ saveenv\n\n# tftp\u30b5\u30fc\u30d0\u8a2d\u5b9a\n\nsun7i$ setenv autoload no\nsun7i$ setenv serverip 192.168.100.2\n\nsun7i$ setenv nfsroot ${serverip}:/usr/local/tftpboot/rootfs/\n\n## \u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\uff08\u81ea\u52d5\u8d77\u52d5\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u4e0d\u8981\uff09\nsun7i$ setenv bootcmd \"dhcp; tftp 0x43000000 script.bin; tftp 0x48000000 uImage; bootm 0x48000000\"\n\n\n\nsun7i$ setenv bootargs \"console=ttyS0,115200 root=/dev/nfs init=/sbin/init \nnfsroot=${nfsroot} ip=${ipaddr}:${serverip}:${gatewayip}:${netmask}::eth0\"\n\nsun7i$ saveenv\n\nsun7i$ dhcp\n\nsun7i$ saveenv\n\n\n\nCubieTruck\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d77\u52d5\n\nsun7i$ boot\n\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306bboot\u304c\u6d41\u308c\u3066\u8d77\u52d5\u304c\u59cb\u307e\u308b\u3002\n\n\n\u8d77\u52d5\u5b8c\u4e86\n\n$ cat /etc/os-release \nPRETTY_NAME=\"Debian GNU/Linux 7 (wheezy)\"\nNAME=\"Debian GNU/Linux\"\nVERSION_ID=\"7\"\nVERSION=\"7 (wheezy)\"\nID=debian\nANSI_COLOR=\"1;31\"\nHOME_URL=\"http://www.debian.org/\"\nSUPPORT_URL=\"http://www.debian.org/support/\"\nBUG_REPORT_URL=\"http://bugs.debian.org/\"\n\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u5909\u66f4\u3057\u3066ubuntu\u3092\u8d77\u52d5\n\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u306e\u3088\u3046\u306b\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u5909\u66f4\u3057\u3066\u8d77\u52d5\u3055\u305b\u308b\u3002\ntftp\u30b5\u30fc\u30d0\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u914d\u7f6e\n$ mkdir -p /usr/local/tftpboot/images/ubuntu\n$ cd ~/\n$ wget http://dl.cubieboard.org/software/a20-cubietruck/lubuntu/ct-lubuntu-card0-v1.00/desktop/rootfs-part2.tar.gz\n\n# image\u306e\u6e96\u5099\n$ tar -C /usr/local/tftpboot/images/ubuntu -xvf rootfs-part2.tar.gz\n\n# NFS\u8a2d\u5b9a\n$ vi /etc/exports\n# ADD\n/usr/local/tftpboot/images/ubuntu *(rw,sync,no_root_squash,no_subtree_check)\n\n$ exportfs -ra\n$ /etc/init.d/nfs-kernel-server restart\n\n\nUART\u7d4c\u7531\u3067\u306e\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u4f5c\u696d\nsun7i$ setenv serverip 192.168.100.2\n\nsun7i$ setenv nfsroot ${serverip}:/usr/local/tftpboot/images/ubuntu\n\nsun7i$ setenv bootargs \"console=ttyS0,115200 root=/dev/nfs init=/sbin/init \nnfsroot=${nfsroot} ip=${ipaddr}:${serverip}:${gatewayip}:${netmask}::eth0\"\n\nsun7i$ saveenv\n\nsun7i$ dhcp; tftp 0x43000000 script.bin; tftp 0x48000000 uImage; bootm 0x48000000\n\n\u7c21\u5358\u306b\u8d77\u52d5\u3067\u304d\u308b\u3053\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\n\u7d9a\u3044\u3066\u5b9f\u6a5f\u306b\u76f4\u63a5OS\u3092\u30a4\u30f3\u30c8\u30fc\u30eb\u3059\u308b\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u3067\u5b9f\u6a5f\u306e\u30c7\u30a3\u30b9\u30af\u306bOS\u30a4\u30e1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\n\ntftp\u30b5\u30fc\u30d0\u3067\u306e\u4f5c\u696d\nboot\u3092\u4f5c\u6210\u3059\u308b\n$ mkdir /usr/local/tftpboot/installer\n$ cd /usr/local/tftpboot/installer\n$ mkdir netboot\n$ mkdir device-tree\n\n$ wget -P netboot http://d-i.debian.org/daily-images/armhf/daily/netboot/vmlinuz http://d-i.debian.org/daily-images/armhf/daily/netboot/initrd.gz\n\n$ wget -P device-tree http://d-i.debian.org/daily-images/armhf/daily/device-tree/sun7i-a20-cubietruck.dtb \n\n$ vi cubietruck\n#setenv diargs <EXTRA ARGUMENTS>\n\nsetenv fdt_addr       0x43000000\nsetenv ramdisk_addr_r 0x48000000\nsetenv kernel_addr_r  0x47000000\n\nsetenv dibase installer\n\ntftp ${kernel_addr_r} ${dibase}/netboot/vmlinuz\nsetenv bootargs \"console=ttyS0,115200 --- ${diargs}\"\n\ntftp ${fdt_addr} ${dibase}/device-tree/sun7i-a20-cubietruck.dtb\nfdt addr ${fdt_addr} 0x40000\n\ntftp ${ramdisk_addr_r} ${dibase}/netboot/initrd.gz\nbootz ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr}\n\n$ mkimage -T script -A arm -d /usr/local/tftpboot/installer/cubietruck /usr/local/tftpboot/installer/cubietruck.scr\n\n\nCubietruck\u3067\u306e\u4f5c\u696d\nboot\u3067\u5148\u307b\u3069\u306e\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\nsun7i$ setenv autoload no\nsun7i$ dhcp\nsun7i$ tftp 0x46000000 uImage\nsun7i$ tftp ${scriptaddr} installer/cubietruck.scr\nsun7i$ saveenv\nsun7i$ source ${scriptaddr}\n\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u306f\u3058\u307e\u308a\u307e\u3059\n\n\u203b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304a\u3088\u3073\u30d5\u30eb\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306a\u306e\u3067\u3001\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u666e\u901a\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nWEB\u304b\u3089\u30b5\u30fc\u30d0\u8d77\u52d5\u3057\u3066\u307f\u308b\n\u9069\u5f53\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3001WEB\u304b\u3089\u8d77\u52d5\u3002\n\n\u300c\u30b5\u30fc\u30d0\u8d77\u52d5\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u30b5\u30fc\u30d0\u8d77\u52d5\u3002\n\n\u8d77\u52d5\u5f8c\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n\n\n\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f8b\n\u307e\u305a\u3001UART\u63a5\u7d9a\u3057\u3066\u3044\u308b\u7aef\u672b\u306bnode\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u3053\u3053\u3067\u306f\u3001Mac\u4e0a\u306eUbuntu 14.04)\u3057\u3066\u3001\n\u4ee5\u4e0b\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3002\uff08\u30b5\u30f3\u30d7\u30eb\u306f\u53c2\u8003\u307e\u3067\u306b\uff09\npackage.json\n{\n  \"name\": \"netboot\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node ./bin/www\"\n  },\n  \"devDependencies\": {\n  },\n  \"dependencies\": {\n    \"express\": \"latest\",\n    \"socket.io\": \"latest\",\n    \"serialport\": \"^1.4.9\"\n  }\n}\n\napp.js\nvar express = require('express'),\n    app = express(),\n    server = require('http').Server(app),\n    io = require('socket.io')(server);\n\napp.use(express.static(__dirname + '/app/webroot'));\nserver.listen(3000);\n\n\nio.sockets.on('connection', function (socket) {\n  console.log(\"connection\");\n  var serialport = require('serialport');\n  var sp = new serialport.SerialPort(\"/dev/ttyUSB0\", {\n    baudRate: 115200,\n    dataBits: 8,\n    stopBits: 1,\n    parser: serialport.parsers.readline(\"\\n\")\n  });\n  sp.on('open', function() {\n    console.log('open');\n    sp.on('data', function(input) {\n      console.log(input.toString());\n      socket.emit(\"buffer\", input.toString());\n      if (input.toString().indexOf(\"autoboot\") > -1) {\n        sp.write(\"\\n\");\n      }\n    });\n  });\n  socket.on(\"boot\", function() {\n    console.log('boot');\n    sp.write(\"dhcp;\");\n    sp.write(\"tftp 0x43000000 script.bin;\");\n    sp.write(\"tftp 0x48000000 uImage;\");\n    sp.write(\"bootm 0x48000000;\");\n    sp.write(\"\\n\");\n  });\n});\n\n\nindex.htlm\n<!DOCTYPE HTML>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>test</title>\n  <script type=\"text/javascript\" src=\"jquery.js\"></script>\n  <script src=\"/socket.io/socket.io.js\"></script>\n  <script type=\"text/javascript\">\n    var url = location.protocol + \"//\" + location.host;\n    var io = io.connect(url);\n    io.on(\"connect\", function () {}); \n    io.on(\"buffer\", function (data) {\n      $(\"#buffer\").append(\"<span>\" + data + \"<br/></span>\");\n    });\n    $(document).ready(function() {\n      $(\"#boot\").on(\"click\", function() {\n        console.log(\"boot\");\n        io.emit(\"boot\");\n      });\n    });\n  </script>\n  <style>\n    *{\n      font-size:14px;\n      padding:0;\n      height: 100%;\n    }\n    div.console {\n      margin:10px;\n      background-color: #000;\n      color : #fff;\n      padding: 10px;\n      width : 80%;\n      height: 80%;\n      border-radius : 5px;\n      overflow: scroll;\n    }\n    #boot {\n      margin:10px;\n      width : 100px;\n    }\n  </style>\n</head>\n<body>\n<input type='button' id=\"boot\" value=\"\u30b5\u30fc\u30d0\u8d77\u52d5\">\n<div id=\"buffer\" class=\"console\"></div>\n</body>\n</html>\n\n\n\n\u307e\u3068\u3081\nWEB\u753b\u9762\u3067\u8d77\u52d5\u30ce\u30fc\u30c9\u3084\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306a\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u7ba1\u7406\u3059\u308c\u3070\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u306e\u69cb\u7bc9\u5b8c\u4e86\u3002\n\u4eca\u56de\u3001\u30df\u30c9\u30eb\u306e\u7ba1\u7406\u307e\u3067\u306f\u306a\u3044\u304c\u3001\u6b21\u306f\u30df\u30c9\u30eb\u69cb\u7bc9\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u30a4\u30f3\u30d5\u30e9\u7cfb\u306e\u30b9\u30ad\u30eb\u304c\u4f4e\u3044\u306e\u306b\u52a0\u3048\u3001\u3068\u306b\u304b\u304f\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u30cf\u30de\u308a\u307e\u3059\u3002\n\n## \u306f\u3058\u3081\u306b\nMaas + JuJu\u3067ARM\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u4f7f\u3063\u305f\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3057\u305f\u3044\u306e\u3067\u3001\u3068\u308a\u3042\u3048\u305aWEB\u753b\u9762\u304b\u3089\u306e\u30b5\u30fc\u30d0\u8d77\u52d5\u3092\u76ee\u6a19\u306b\u7814\u7a76\u7528\u306eCPU\u30dc\u30fc\u30c9(CubieTruck)\u3067Network boot\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u307f\u308b\u3002\n\n\n\nCubieTruck\u306a\u3069CPU\u30dc\u30fc\u30c9\u306e\u5834\u5408\u3001boot\u30a4\u30e1\u30fc\u30b8\u304b\u3089\u4f5c\u6210\u3057\u306a\u3044\u3068\u30c0\u30e1\u3060\u304c\u3001\u901a\u5e38\u306fbios\u306ePXE\u30d6\u30fc\u30c8\u3067\u3001\u3059\u3050\u306b\u8a66\u305b\u308b\u307f\u305f\u3044\u3002\n\n<b><span style=\"color:#FF0000\">\u6ce8\u610f</span></b>\uff1a\u30b9\u30da\u30c3\u30af\u3084\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u74b0\u5883\u306b\u3082\u3088\u308a\u307e\u3059\u304c\u3001NetBoot\u306e\u74b0\u5883\u69cb\u7bc9\u306f\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067\u3001\u69cb\u7bc9\u3059\u308b\u65b9\u306f\u6c17\u5408\u3044\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u203b\u30d5\u30a1\u30a4\u30ebI/O\u304c\u591a\u3044\u306e\u3067SSD\u306e\u7aef\u672b\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u3092\u884c\u3046\u65b9\u304c\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n \n\n## \u30d9\u30a2\u30e1\u30bf\u30eb\u8abf\u67fb\u30e1\u30e2\n\u7269\u7406\u30b5\u30fc\u30d0\u3092\u30af\u30e9\u30a6\u30c9\u306e\u3088\u3046\u306b\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3059\u308b\u30b5\u30fc\u30d3\u30b9\u3068\u306a\u308b\u3002\n\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u6f14\u7b97\u306e\u6027\u80fd\u3084\u76f4\u63a5\u30e9\u30c3\u30af\u3078\u306e\u914d\u7f6e\u306a\u3069\u3001AWS\u30fbAzure\u306a\u3069\u3068\u306e\u5dee\u5225\u5316\u304c\u56f3\u308c\u308b\u305f\u3081\u3001\n\u4eca\u5f8c\u3001\u671f\u5f85\u3055\u308c\u308b\u6280\u8853\u3067\u3042\u308b\u306e\u3067\u3001\u7814\u7a76\u3068\u3057\u3066\u81ea\u5b85\u306b\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u74b0\u5883\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\u500b\u4eba\u7684\u3060\u304c\u3001\u56fd\u5185\u4f01\u696d\u306f\u30af\u30e9\u30a6\u30c9\u3088\u308a\u30a6\u30b1\u304c\u3044\u3044\u6c17\u304c\u3044\u3044\u3068\u601d\u3046\u3002\n\n###\u30d9\u30a2\u30e1\u30bf\u30eb\u306e\u7279\u6027\u306b\u3064\u3044\u3066\n\u30d9\u30a2\u30e1\u30bf\u30eb\u3092\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30b5\u30fc\u30d3\u30b9\u3092\u57fa\u306b\u6bd4\u8f03\u3057\u3066\u307f\u308b\u3002\n\n|\u30b5\u30fc\u30d3\u30b9|\u4eee\u60f3\u5316\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9|\u4ed6\u30b5\u30fc\u30d0\u306e\u5f71\u97ff|\u30b9\u30b1\u30fc\u30eb\u30a2\u30a6\u30c8|\u521d\u671f\u8cbb\u7528|\u69cb\u6210\u306e\u67d4\u8edf\u6027|\n|:-----:|:--------------:|:-----------:|:---------:|:-------:|:------:|\n| \u30d1\u30d6\u30ea\u30c3\u30af\u30af\u30e9\u30a6\u30c9(laaS)| \u3042\u308a|\u3042\u308a|\u25cb|\u25ce|\u25b3|\n| \u7269\u7406\u30b5\u30fc\u30d0 | \u306a\u3057|\u306a\u3057|\u00d7|\u00d7|\u25cb|\n| \u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9 |\u306a\u3057|\u306a\u3057|\u25cb|\u25cb|\u25b3|\n  \n\u203b\u30d9\u30a2\u30e1\u30bf\u30eb\u306e\u521d\u671f\u8cbb\u7528\u306b\u3064\u3044\u3066\u306f\u3001\u30b5\u30fc\u30d0\u3092CPU\u30dc\u30fc\u30c9\u3084\u30d6\u30ec\u30fc\u30c9\u30b5\u30fc\u30d0\u3067\u60f3\u5b9a\u3002\n\n###\u8ab2\u984c\n\u30fbArm\u3067\u306e\u60c5\u5831\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304a\u3088\u3073\u66f8\u7c4d\u306a\u3069\u306e\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u3001\u30cf\u30fc\u30c9\u30eb\u9ad8\u3044\uff01\uff01\n\n\n## \u4eca\u56de\u69cb\u7bc9\u3059\u308b\u69cb\u6210\u306b\u3064\u3044\u3066\n\n\u6e96\u5099\u3057\u305f\u74b0\u5883\n\n```\n\u3000\u25a0 tftp\u30b5\u30fc\u30d0 (SSD boot)\n\u3000\u3000\u30fbCubietruck : Lubuntu\n\u3000\u3000\u3000(CPU :ARM Cortex-A7 Dual-Core, MEM: 2GB, Storage: 240G(Intel SSD)\uff09\n\n\u3000\u25a0 \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b5\u30fc\u30d0\n\u3000\u3000\u30fbCubietruck \u00d7 2\n\u3000\u3000\u3000(CPU :ARM Cortex-A7 Dual-Core, MEM: 2GB, Storage: 16G(SDCard)\uff09\n\n\u3000\u25a0 DHCP\u30b5\u30fc\u30d0\uff08\u7121\u7dda\u30eb\u30fc\u30bf\u517c\u7528\uff09\n\u3000\u3000\u30fbRaspberry PI TYPE B\n\n\u3000\u25a0 \u30aa\u30da\u30ec\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\n\u3000\u3000\u30fbMac book Air\n\u3000\u3000 ( VMWaer Fusion: Ubuntu 14.04 CPU: 2 / MEM: 4GB)\n\u3000 \n\u3000\u305d\u306e\u4ed6 \u30fbUSB\uff0d\u30b7\u30ea\u30a2\u30eb\u5909\u63db\u30b1\u30fc\u30d6\u30eb\n      \u3000\u30fbCubie-PC\u63a5\u7d9a\u7528\u306eUSB(A-mini B)\u304c\u30b1\u30fc\u30d6\u30eb\n      \u3000\u30fbswitch(LAN HUB)\n      \u3000\u30fbSD\u30ab\u30fc\u30c9\u30e9\u30a4\u30bf\u30fc (MacBook Air 11\u306a\u3069\u306e\u5834\u5408)\n\n```\n\n\u3010\u30b5\u30fc\u30d0\u30fb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u69cb\u6210\u56f3\u3011\n\n![server.001.jpg](https://qiita-image-store.s3.amazonaws.com/0/52867/3e0bd7f8-bb45-b395-736c-ea698499c508.jpeg \"server.001.jpg\")\n\n\n\u203bMac\u304b\u3089cubie\u5074\u306e\u30bb\u30b0\u3078\u306e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u8a2d\u5b9a\u6e08\u307f\u3002\n```$ sudo route -n add 192.168.100.0/24 192.168.10.3```\n\n## Cubietruck\u306etftp\u30b5\u30fc\u30d0\u4f5c\u6210\n\n### \u30a4\u30e1\u30fc\u30b8\u6e96\u5099\nCubietruck\u3078\u306e\u66f8\u304d\u8fbc\u307f\u306f\u3001SD\u30ab\u30fc\u30c9\u306f\u4f7f\u308f\u305a\u3001USB OTG\u7d4c\u7531\u3067SSD\u3078\u30a4\u30e1\u30fc\u30b8\u3092\u66f8\u304d\u8fbc\u307f\u307e\u3059\u3002\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148(lubuntu)\nhttp://docs.cubieboard.org/tutorials/a20-cubietruck_lubuntu_server_releases\n\n\u30a4\u30e1\u30fc\u30b8\u306e\u66f8\u304d\u8fbc\u307f\u30c4\u30fc\u30eb(Livesuit)\nhttp://docs.cubieboard.org/downloads\n\n\u30c4\u30fc\u30eb\u306e\u624b\u9806\u901a\u308aCubietruck\u306eUSB OTG\u304b\u3089\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\u203b H/W\u306e\u6a2a\u306b\u3064\u3044\u3066\u308b\u3001FELkey\u3092\u62bc\u3057\u305f\u307e\u307eUSB\u3067PC\u3092\u63a5\u7d9a\u3057\u3001\u63a5\u7d9a\u5f8c\u306b\u30dc\u30bf\u30f3\u3092\u96e2\u3059\u3002\n\n![Screen Shot 2015-01-01 at 00.40.58.png](https://qiita-image-store.s3.amazonaws.com/0/52867/03acdcd4-5e14-1b65-4493-b94d14f42c00.png \"Screen Shot 2015-01-01 at 00.40.58.png\")\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\nssh ID/PASS : linaro/linaro\n\n```bash\n# nic\u306e\u8a2d\u5b9a\u304cdhcp\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001static\u306b\u5909\u66f4\n$ sudo vi /etc/network/interfaces \nauto lo eth0\niface lo inet loopback\n# iface eth0 inet dhcp\niface eth0 inet static\naddress 192.168.100.2\nnetmask 255.255.255.0\ngateway 192.168.100.1\n\n# \u30c7\u30a3\u30b9\u30d7\u30ec\u30a4\u304c\u306a\u3044\u306e\u3067\u518d\u8d77\u52d5\u3059\u308b (ifup/ifdown\u53ef)\n$ sudo reboot\n```\n\n### SSD\u306e\u8a2d\u5b9a\u3059\u308b\n\n```bash\n$ sudo fdisk /dev/sda\n Command (m for help): d\n Command (m for help): n\n  Partition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\n  Select (default p): p\n  Partition number (1-4, default 1): \n  Using default value 1\n  First sector (2048-468862127, default 2048): \n  Using default value 2048\n  Last sector, +sectors or +size{K,M,G} (2048-468862127, default 468862127): \n  Using default value 468862127\n\n Command (m for help): w\n\n$ sudo mkfs.ext4 /dev/sda1\n\n# Root\u30c7\u30a3\u30b9\u30af\u3092SSD\u306b\u30b3\u30d4\u30fc\n$ sudo dd if=/dev/nandb of=/dev/sda1 bs=1M\n\n# Boot\u30d5\u30a1\u30a4\u30eb\u306bRootfs\u3092\u8a2d\u5b9a\n$ mkdir /tmp/boot\n$ sudo mount /dev/nanda /tmp/boot\n\n# Rootfs\u3092\u4ee5\u4e0b\u306b\u5909\u66f4\n$ sudo vi /tmp/boot/uEnv.txt\n  nand_root=/dev/sda1\n\n$ sync\n$ sudo reboot \n\n# \u518d\u8d77\u52d5\u5f8c\u306bdf\u30b5\u30a4\u30ba\u78ba\u8a8d(\u30c7\u30d5\u30a9\u30eb\u30c8\u3060\u30682GB\u3057\u304b\u4f7f\u3048\u306a\u3044)\n$ df -h\n Filesystem      Size  Used Avail Use% Mounted on\n /dev/root       2.0G  655M  1.3G  34% /\n devtmpfs        889M  4.0K  889M   1% /dev\n none            4.0K     0  4.0K   0% /sys/fs/cgroup\n tmpfs            20M     0   20M   0% /tmp\n none            197M  160K  197M   1% /run\n none            5.0M     0  5.0M   0% /run/lock\n none            985M     0  985M   0% /run/shm\n none            100M     0  100M   0% /run/user\n\n# \u9818\u57df\u306e\u62e1\u5f35\n$ sudo resize2fs /dev/sda1\n$ df -h\n Filesystem      Size  Used Avail Use% Mounted on\n /dev/root       221G  656M  211G   1% /\n devtmpfs        889M  4.0K  889M   1% /dev\n none            4.0K     0  4.0K   0% /sys/fs/cgroup\n tmpfs            20M     0   20M   0% /tmp\n none            197M  160K  197M   1% /run\n none            5.0M     0  5.0M   0% /run/lock\n none            985M     0  985M   0% /run/shm\n none            100M     0  100M   0% /run/user\n\n```\n\n## \u30b5\u30fc\u30d0\u306e\u521d\u671f\u8a2d\u5b9a\n\n```bash\n# \u4ee5\u4e0b\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8a2d\u5b9a\n$ sudo vi /etc/apt/sources.list\ndeb http://old-releases.ubuntu.com/ubuntu/ raring main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-security main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-security main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-updates main universe restricted multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-updates main universe restricted multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-backports main restricted universe multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-backports main restricted universe multiverse\n\ndeb http://old-releases.ubuntu.com/ubuntu/ raring-proposed main restricted universe multiverse\ndeb-src http://old-releases.ubuntu.com/ubuntu/ raring-proposed main restricted universe multiverse\n\n\n$ sudo apt-get update\n\n# Time zone\u306e\u8a2d\u5b9a\n$ sudo mv /etc/localtime /etc/localtime.org\n$ sudo ln -s /usr/share/zoneinfo/Japan /etc/localtime\n$ sudo apt-get install -y ntp\n$ date\n\n# \u4e0d\u8981\u306a\u30df\u30c9\u30eb\u524a\u9664\n$ sudo apt-get remove --purge mysql-server mysql-client mysql-common\n$ sudo apt-get autoremove\n$ sudo apt-get autoclean \n\n```\n\n\n## tftp\u30b5\u30fc\u30d0\u306e\u30a4\u30b9\u30c8\u30fc\u30eb\nNetBoot\u306e\u30a4\u30e1\u30fc\u30b8\u914d\u5e03\u30b5\u30fc\u30d0\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```bash\n$ sudo apt-get install -y xinetd tftpd tftp\n$ sudo mkdir /usr/local/tftpboot\n$ sudo chmod -R 777 /usr/local/tftpboot\n$ sudo chown -R nobody /usr/local/tftpboot\n\n\n$ sudo mkdir /etc/xinetd.d\n$ sudo vi /etc/xinetd.d/tftp\nservice tftp\n{\n\tprotocol        = udp\n\tport            = 69\n\tsocket_type     = dgram\n\twait            = yes\n\tuser            = nobody\n\tserver          = /usr/sbin/in.tftpd\n\tserver_args     = /usr/local/tftpboot\n\tdisable         = no\n}\n\n$ sudo /etc/init.d/xinetd restart\n```\n\n### \u63a5\u7d9a\u30c6\u30b9\u30c8\n\n```bash\n$ sudo vi /usr/local/tftpboot/test.txt\ntest\n$ ls -l /usr/local/tftpboot/\ntotal 4\n-rw-r--r-- 1 root root 5 Jan  1 04:59 test.txt\n\n$ tftp 192.168.100.2\ntftp> get test.txt\nReceived 6 bytes in 0.0 seconds\ntftp> quit\n\n```\n\n## NFS\u30b5\u30fc\u30d0\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\n\u5404\u30ce\u30fc\u30c9\u304b\u3089\u30de\u30a6\u30f3\u30c8\u3059\u308brootfs\u7528\u306eNFS\u30b5\u30fc\u30d0\u3092\u69cb\u7bc9\u3059\u308b\u3002\n\u3053\u308c\u306b\u3088\u308a\u3001\u8d77\u52d5\u7528\u306eSD\u3060\u3051\u3067\u52d5\u304b\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```bash\n$ sudo apt-get install nfs-kernel-server rpcbind nfs-common\n\n# rootfs\u306e\u9818\u57df\n$ sudo mkdir /usr/local/tftpboot/rootfs\n$ sudo chmod 755 /usr/local/tftpboot/rootfs\n\n# \u30de\u30a6\u30f3\u30c8\u8a31\u53ef\u3092\u4ee5\u4e0b\u3092\u8ffd\u8a18\n$ sudo vi /etc/exports\n/usr/local/tftpboot/rootfs *(rw,sync,no_root_squash,no_subtree_check)\n\n$ sudo exportfs -ra\n$ sudo /etc/init.d/nfs-kernel-server restart\n\n```\n\n### \u63a5\u7d9a\u30c6\u30b9\u30c8\nRaspberry Pi\u304b\u3089\u306e\u63a5\u7d9a\u30c6\u30b9\u30c8\n\n```bash\n\npi$ sudo apt-get install nfs-common\npi$ sudo mkdir -p /mnt/nfs\npi$ sudo mount 192.168.100.2:/usr/local/tftpboot/rootfs /mnt/nfs\npi$ sudo vi /mnt/nfs/test.txt\ntest\n\n# cubie\u304b\u3089\u30d5\u30a1\u30a4\u30eb\u4f5c\u6210\u306e\u78ba\u8a8d\n$ ls -l /usr/local/tftpboot/rootfs\ntotal 4\n-rw-r--r-- 1 root root 5 Jan  1 16:11 test.txt\n\n\npi$ sudo umount /mnt/nfs\n\n```\n\n\u30b5\u30fc\u30d0\u5074\u306e\u8a2d\u5b9a\u306f\u3053\u3053\u307e\u3067\u3002\n\n## Cubietruck\u306eNetwork Boot\u30a4\u30e1\u30fc\u30b8\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n\u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u306fMac\u4e0a\u306eUbuntu\u3067\u884c\u3046\u3053\u3068\u306b\u3059\u308b.\n\n### \u521d\u671f\u6e96\u5099\n```bash\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u4f5c\u696d\u306froot\u3067\u884c\u3046\n$ sudo su -\n\n$ apt-get update\n$ apt-get upgrade\n\n# \u30a4\u30e1\u30fc\u30b8\u30d3\u30eb\u30c9\u306b\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install -y build-essential u-boot-tools libncurses-dev git make gcc g++-arm-linux-gnueabihf libusb-1.0-0-dev pkg-config dkms\n```\n### \u30a4\u30e1\u30fc\u30b8\u30d3\u30eb\u30c9\n```bash\n# work\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\n$ mkdir ~/build\n$ cd ~/build/\n\n# boot\u30a4\u30e1\u30fc\u30b8\u306e\u30c0\u30a6\u30ed\u30fc\u30c9(u-boot)\n$ git clone https://github.com/linux-sunxi/u-boot-sunxi.git\n\n# \u30b3\u30f3\u30d1\u30a4\u30eb\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\uff08FEL\u306fUSB\u30d6\u30fc\u30c8\u7528\uff09\n$ cd u-boot-sunxi\n$ cat boards.cfg | awk '{print $7}' | grep -i Cubietruck\n\n# boot\u30a4\u30e1\u30fc\u30b8\u30b3\u30f3\u30d1\u30a4\u30eb\n$ make Cubietruck_config CROSS_COMPILE=arm-linux-gnueabihf-\n$ make CROSS_COMPILE=arm-linux-gnueabihf-\n\n\n# boot script(script.bin)\u3092\u4f5c\u6210\n$ cd ~/build/\n$ git clone https://github.com/linux-sunxi/sunxi-tools\n$ git clone https://github.com/cubieboard/cubie_configs\n\n$ cd sunxi-tools\n$ make\n\n# script.bin\u306e\u4f5c\u6210\n$ cd ~/build/\n$ sunxi-tools/fex2bin cubie_configs/sysconfig/linux/cubietruck.fex script.bin\n```\n\n### script.bin\u306e\u914d\u7f6e\n\u5168\u624b\u9806\u3067\u4f5c\u6210\u3057\u305fscript.bin\u3092scp\u306a\u3069\u3067Cubietruck\u306etftpboot\u306e\u30d5\u30a9\u30eb\u30c0\u3078\u79fb\u52d5(\u6a29\u9650 777)\n\n```bash\n################ Cubietruck ################\n$ ls -l  /usr/local/tftpboot/script.bin\n-rwxrwxrwx 1 linaro linaro 46240 Jan  1 17:33 /usr/local/tftpboot/script.bin\n```\n\n### kernel\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\n```bash\n################ \u518d\u3073 mac\u4e0a\u3067\u306e\u4f5c\u696d ################\n# kernel\u30b3\u30f3\u30d1\u30a4\u30eb\n$ git clone http://github.com/cubieboard/linux-sunxi.git\n$ cp cubie_configs/kernel-configs/3.4/cubietruck_defconfig linux-sunxi/.config\n$ cd linux-sunxi\n\n# kernel\u306e\u8a2d\u5b9a\n$ make ARCH=arm menuconfig\n````\n\nkernel \u8a2d\u5b9a\u753b\u9762\u304c\u8d77\u52d5\u3059\u308b\u3002\n![Screen Shot 2015-01-01 at 19.37.31.png](https://qiita-image-store.s3.amazonaws.com/0/52867/4a3e87ff-77ff-a81c-c659-fa9060a21949.png \"Screen Shot 2015-01-01 at 19.37.31.png\")\n\n\n\u3053\u3053\u3067\u4ee5\u4e0b\u306e\u9805\u76ee\u3092\u300c*\u300d\u306b\u8a2d\u5b9a\u3059\u308b\nDevice Drivers --> Network device support --> *** CAIF transport drivers *** section --> Ethernet driver support --> Sunxi platform 10/100/1000Mbps Ethernet driver\n\n### \u30b3\u30f3\u30d1\u30a4\u30eb\n```bash\n$ make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- uImage modules\n\n# \u5b8c\u4e86\u5f8c\u306f\u3053\u3053\u306buImage\u304c\u4f5c\u6210\u3055\u308c\u308b\n$ ls -l arch/arm/boot/uImage\n```\n\n### uImage\u306e\u914d\u7f6e\n\u5168\u624b\u9806\u3067\u4f5c\u6210\u3057\u305fscript.bin\u3092scp\u306a\u3069\u3067Cubietruck\u306etftpboot\u306e\u30d5\u30a9\u30eb\u30c0\u3078\u79fb\u52d5(\u6a29\u9650 777)\n\n```bash\n################ Cubietruck ################\n$ ls -l  /usr/local/tftpboot/\ntotal 4532\ndrwxr-xr-x 22 root   root      4096 Jan  1 18:25 rootfs\n-rwxrwxrwx  1 linaro linaro   46240 Jan  1 17:33 script.bin\n-rwxrwxrwx  1 linaro linaro 4583488 Jan  1 20:11 uImage\n```\n\n## rootfs\u306e\u6e96\u5099\nchroot\u3067\u30b7\u30b9\u30c6\u30e0\u69cb\u6210\u3092\u5b9f\u65bd\u3059\u308b\u305f\u3081\u30bf\u30fc\u30b2\u30c3\u30c8\u306eOS\u306fDebian\u3068\u3059\u308b\u3002\n\u203btftp\u30b5\u30fc\u30d0\u3068\u306a\u308bCubietruck\u4e0a\u3067\u306e\u4f5c\u696d\n\n```bash\n$ apt-get install qemu-user-static debootstrap binfmt-support\n\n# \u74b0\u5883\u5909\u6570\u306e\u8a2d\u5b9a\n$ targetdir=/usr/local/tftpboot/rootfs\n$ distro=wheezy\n\n# root\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\n$ wget https://releases.linaro.org/13.04/ubuntu/quantal-images/nano/linaro-quantal-nano-20130422-342.tar.gz\n\n# \u30a4\u30e1\u30fc\u30b8\u306e\u5c55\u958b\n$ tar -xzf linaro-quantal-nano-20130422-342.tar.gz -C $targetdir\n\n# OS\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u6e96\u5099\n$ debootstrap --arch=armhf --foreign $distro $targetdir\n\n# \u30a4\u30e1\u30fc\u30b8\u3078\u30bd\u30fc\u30b9\u30b3\u30d4\u30fc\n$ cp /usr/bin/qemu-arm-static $targetdir/usr/bin/\n$ cp /etc/resolv.conf $targetdir/etc\n\n# \u30a4\u30e1\u30fc\u30b8\u306bchroot\u3057\u3066\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\n$ chroot $targetdir\n\n$ distro=wheezy\n$ export LANG=C\n$ /debootstrap/debootstrap --second-stage\n\n$ cat <<EOT > /etc/apt/sources.list\ndeb http://ftp.kr.debian.org/debian $distro main contrib non-free\ndeb-src http://ftp.kr.debian.org/debian $distro main contrib non-free\ndeb http://ftp.kr.debian.org/debian $distro-updates main contrib non-free\ndeb-src http://ftp.kr.debian.org/debian $distro-updates main contrib non-free\ndeb http://security.debian.org/debian-security $distro/updates main contrib non-free\ndeb-src http://security.debian.org/debian-security $distro/updates main contrib non-free\nEOT\n\n$ cat <<EOT > /etc/apt/apt.conf.d/71-no-recommends\nAPT::Install-Recommends \"0\";\nAPT::Install-Suggests \"0\";\nEOT\n\n## \u30d1\u30c3\u30b1\u30fc\u30b8\u66f4\u65b0(language\u8a2d\u5b9a)\n$ apt-get update\n$ apt-get install locales dialog\n$ dpkg-reconfigure locales\n\n# ssh,ntp \u30b5\u30fc\u30d0\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install -y openssh-server ntpdate\n\n# root passwd\u8a2d\u5b9a\n$ passwd\n\n# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\n$ echo <<EOT >> /etc/network/interfaces\nallow-hotplug eth0\niface eth0 inet dhcp\nEOT\n\n# HOSTNAME\u8a2d\u5b9a\n$ echo debian-armhf > /etc/hostname\n\n# \u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u8a2d\u5b9a\n$ echo T0:2345:respawn:/sbin/getty -L ttyS0 115200 vt100 >> /etc/inittab\n\n\b$ exit\n\n# \u4e00\u6642\u7684\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\n$ rm $targetdir/etc/resolv.conf\n$ rm $targetdir/usr/bin/qemu-arm-static\n```\n\n\n## boot\u7528\u306eSD\u3092\u4f5c\u6210\nmac\u4e0a\u3067\u306e\u4f5c\u696d\n\n```bash\n$ export card=/dev/sdd\n$ dd if=/dev/zero of=$card bs=2M count=1\n\n# \u3059\u3079\u3066\u306e\u9818\u57df\u3092\u5229\u7528\n$ fdisk $card\nCommand (m for help): n\nCommand (m for help): w\n\n$ mkfs.ext3 $card\n\n$ cd ~/build/u-boot-sunxi\n$ dd if=u-boot-sunxi-with-spl.bin of=$card bs=1024 seek=8\n\n```\n\n## CubieTruck Boot\u8a2d\u5b9a\n\n\u3053\u3053\u3067\u306f\u3001UART\u7d4c\u7531\u3067\u306e\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u4f5c\u696d\u304c\u5fc5\u8981\u3068\u306a\u308b\u3002\n\u30dc\u30fc\u30c9\u306eUART IO\u3068Mac\u4e0a\u306eUbuntu\u3068\u3067USB\u63a5\u7d9a\u3059\u308b\u3002\n\n```bash\n# Ubuntu\u3067\u306e\u4f5c\u696d\n\n# \u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ apt-get install picocom\n\n# \u30dc\u30fc\u30c9\u306b\u63a5\u7d9a\n$ picocom -b 115200 -d 8 -p n --send-cmd \"sz -y\" --receive-cmd \"rz -y\" /dev/ttyUSB0\npicocom v1.7\n\nport is        : /dev/ttyUSB0\nflowcontrol    : none\nbaudrate is    : 115200\nparity is      : none\ndatabits are   : 8\nescape is      : C-a\nlocal echo is  : no\nnoinit is      : no\nnoreset is     : no\nnolock is      : no\nsend_cmd is    : sz -y\nreceive_cmd is : rz -y\nimap is        : \nomap is        : \nemap is        : crcrlf,delbs,\n\nTerminal ready\n\n### ethaddr \u30a2\u30c9\u30ec\u30b9\u3092\u30e1\u30e2\u3057\u3066\u304a\u304f\nsun7i$ printenv\n\n\nsun7i$ saveenv default -a\nsun7i$ saveenv\n\n# tftp\u30b5\u30fc\u30d0\u8a2d\u5b9a\n\nsun7i$ setenv autoload no\nsun7i$ setenv serverip 192.168.100.2\n\nsun7i$ setenv nfsroot ${serverip}:/usr/local/tftpboot/rootfs/\n\n## \u81ea\u52d5\u8d77\u52d5\u8a2d\u5b9a\uff08\u81ea\u52d5\u8d77\u52d5\u3057\u306a\u3044\u5834\u5408\u306f\u3001\u4e0d\u8981\uff09\nsun7i$ setenv bootcmd \"dhcp; tftp 0x43000000 script.bin; tftp 0x48000000 uImage; bootm 0x48000000\"\n\n\n\nsun7i$ setenv bootargs \"console=ttyS0,115200 root=/dev/nfs init=/sbin/init \nnfsroot=${nfsroot} ip=${ipaddr}:${serverip}:${gatewayip}:${netmask}::eth0\"\n\nsun7i$ saveenv\n\nsun7i$ dhcp\n\nsun7i$ saveenv\n\n```\n\n## CubieTruck\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8d77\u52d5\n\n```bash\n\nsun7i$ boot\n\n```\n\n\u30b3\u30f3\u30bd\u30fc\u30eb\u306bboot\u304c\u6d41\u308c\u3066\u8d77\u52d5\u304c\u59cb\u307e\u308b\u3002\n![server.jpg](https://qiita-image-store.s3.amazonaws.com/0/52867/2e7b4f31-e4f5-99a3-f4c1-05b3b223f898.jpeg \"server.jpg\")\n\n## \u8d77\u52d5\u5b8c\u4e86\n\n![Screen Shot 2015-01-02 at 02.32.49.png](https://qiita-image-store.s3.amazonaws.com/0/52867/fb30fe58-0ad6-1e58-d061-cfef45787a07.png \"Screen Shot 2015-01-02 at 02.32.49.png\")\n\n```bash\n$ cat /etc/os-release \nPRETTY_NAME=\"Debian GNU/Linux 7 (wheezy)\"\nNAME=\"Debian GNU/Linux\"\nVERSION_ID=\"7\"\nVERSION=\"7 (wheezy)\"\nID=debian\nANSI_COLOR=\"1;31\"\nHOME_URL=\"http://www.debian.org/\"\nSUPPORT_URL=\"http://www.debian.org/support/\"\nBUG_REPORT_URL=\"http://bugs.debian.org/\"\n```\n## \u30a4\u30e1\u30fc\u30b8\u306e\u5909\u66f4\u3057\u3066ubuntu\u3092\u8d77\u52d5\n\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u306e\u3088\u3046\u306b\u3001\u30a4\u30e1\u30fc\u30b8\u3092\u5909\u66f4\u3057\u3066\u8d77\u52d5\u3055\u305b\u308b\u3002\n\ntftp\u30b5\u30fc\u30d0\u306b\u30a4\u30e1\u30fc\u30b8\u3092\u914d\u7f6e\n\n```bash\n$ mkdir -p /usr/local/tftpboot/images/ubuntu\n$ cd ~/\n$ wget http://dl.cubieboard.org/software/a20-cubietruck/lubuntu/ct-lubuntu-card0-v1.00/desktop/rootfs-part2.tar.gz\n\n# image\u306e\u6e96\u5099\n$ tar -C /usr/local/tftpboot/images/ubuntu -xvf rootfs-part2.tar.gz\n\n# NFS\u8a2d\u5b9a\n$ vi /etc/exports\n# ADD\n/usr/local/tftpboot/images/ubuntu *(rw,sync,no_root_squash,no_subtree_check)\n\n$ exportfs -ra\n$ /etc/init.d/nfs-kernel-server restart\n\n```\n\nUART\u7d4c\u7531\u3067\u306e\u30b7\u30ea\u30a2\u30eb\u901a\u4fe1\u4f5c\u696d\n\n```\nsun7i$ setenv serverip 192.168.100.2\n\nsun7i$ setenv nfsroot ${serverip}:/usr/local/tftpboot/images/ubuntu\n\nsun7i$ setenv bootargs \"console=ttyS0,115200 root=/dev/nfs init=/sbin/init \nnfsroot=${nfsroot} ip=${ipaddr}:${serverip}:${gatewayip}:${netmask}::eth0\"\n\nsun7i$ saveenv\n\nsun7i$ dhcp; tftp 0x43000000 script.bin; tftp 0x48000000 uImage; bootm 0x48000000\n```\n\n\u7c21\u5358\u306b\u8d77\u52d5\u3067\u304d\u308b\u3053\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n![Screen Shot 2015-01-03 at 01.38.01.png](https://qiita-image-store.s3.amazonaws.com/0/52867/08df7471-ce58-3163-71ae-56c87e21abd4.png)\n\n## \u7d9a\u3044\u3066\u5b9f\u6a5f\u306b\u76f4\u63a5OS\u3092\u30a4\u30f3\u30c8\u30fc\u30eb\u3059\u308b\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u7d4c\u7531\u3067\u5b9f\u6a5f\u306e\u30c7\u30a3\u30b9\u30af\u306bOS\u30a4\u30e1\u30fc\u30b8\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u65b9\u6cd5\n\n### tftp\u30b5\u30fc\u30d0\u3067\u306e\u4f5c\u696d\nboot\u3092\u4f5c\u6210\u3059\u308b\n\n```bash\n$ mkdir /usr/local/tftpboot/installer\n$ cd /usr/local/tftpboot/installer\n$ mkdir netboot\n$ mkdir device-tree\n\n$ wget -P netboot http://d-i.debian.org/daily-images/armhf/daily/netboot/vmlinuz http://d-i.debian.org/daily-images/armhf/daily/netboot/initrd.gz\n\n$ wget -P device-tree http://d-i.debian.org/daily-images/armhf/daily/device-tree/sun7i-a20-cubietruck.dtb \n\n$ vi cubietruck\n#setenv diargs <EXTRA ARGUMENTS>\n\nsetenv fdt_addr       0x43000000\nsetenv ramdisk_addr_r 0x48000000\nsetenv kernel_addr_r  0x47000000\n\nsetenv dibase installer\n\ntftp ${kernel_addr_r} ${dibase}/netboot/vmlinuz\nsetenv bootargs \"console=ttyS0,115200 --- ${diargs}\"\n\ntftp ${fdt_addr} ${dibase}/device-tree/sun7i-a20-cubietruck.dtb\nfdt addr ${fdt_addr} 0x40000\n\ntftp ${ramdisk_addr_r} ${dibase}/netboot/initrd.gz\nbootz ${kernel_addr_r} ${ramdisk_addr_r}:${filesize} ${fdt_addr}\n\n$ mkimage -T script -A arm -d /usr/local/tftpboot/installer/cubietruck /usr/local/tftpboot/installer/cubietruck.scr\n```\n\n### Cubietruck\u3067\u306e\u4f5c\u696d\nboot\u3067\u5148\u307b\u3069\u306e\u8d77\u52d5\u30a4\u30e1\u30fc\u30b8\u3092\u6307\u5b9a\n\n```bash\nsun7i$ setenv autoload no\nsun7i$ dhcp\nsun7i$ tftp 0x46000000 uImage\nsun7i$ tftp ${scriptaddr} installer/cubietruck.scr\nsun7i$ saveenv\nsun7i$ source ${scriptaddr}\n````\n\u3053\u308c\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30e9\u304c\u306f\u3058\u307e\u308a\u307e\u3059\n![Screen Shot 2015-01-03 at 18.01.36.png](https://qiita-image-store.s3.amazonaws.com/0/52867/5487af49-2c81-47b6-5fef-6ef12b7aa6c2.png)\n\u203b\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u304a\u3088\u3073\u30d5\u30eb\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306a\u306e\u3067\u3001\u5c11\u3057\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3059\u308b\u3068\u666e\u901a\u306b\u4f7f\u3048\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\n## WEB\u304b\u3089\u30b5\u30fc\u30d0\u8d77\u52d5\u3057\u3066\u307f\u308b\n\n\u9069\u5f53\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u4f5c\u6210\u3057\u3066\u3001WEB\u304b\u3089\u8d77\u52d5\u3002\n\n![Screen Shot 2015-01-02 at 17.40.42.png](https://qiita-image-store.s3.amazonaws.com/0/52867/360b6de9-1d9c-a213-90d4-7b7e94026640.png \"Screen Shot 2015-01-02 at 17.40.42.png\")\n\n\u300c\u30b5\u30fc\u30d0\u8d77\u52d5\u300d\u30dc\u30bf\u30f3\u3092\u62bc\u3057\u3066\u30b5\u30fc\u30d0\u8d77\u52d5\u3002\n![Screen Shot 2015-01-02 at 17.41.32.png](https://qiita-image-store.s3.amazonaws.com/0/52867/4403f1d7-0267-d21c-637f-cf17f829aad1.png \"Screen Shot 2015-01-02 at 17.41.32.png\")\n\n\u8d77\u52d5\u5f8c\u306bSSH\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\n![Screen Shot 2015-01-02 at 18.02.34.png](https://qiita-image-store.s3.amazonaws.com/0/52867/065bac87-9218-733d-83ed-c3f2d6ad9a69.png \"Screen Shot 2015-01-02 at 18.02.34.png\")\n\n\n###\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4f8b\n\u307e\u305a\u3001UART\u63a5\u7d9a\u3057\u3066\u3044\u308b\u7aef\u672b\u306bnode\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08\u3053\u3053\u3067\u306f\u3001Mac\u4e0a\u306eUbuntu 14.04)\u3057\u3066\u3001\n\u4ee5\u4e0b\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3002\uff08\u30b5\u30f3\u30d7\u30eb\u306f\u53c2\u8003\u307e\u3067\u306b\uff09\n\npackage.json\n\n```json\n{\n  \"name\": \"netboot\",\n  \"version\": \"0.0.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"start\": \"node ./bin/www\"\n  },\n  \"devDependencies\": {\n  },\n  \"dependencies\": {\n    \"express\": \"latest\",\n    \"socket.io\": \"latest\",\n    \"serialport\": \"^1.4.9\"\n  }\n}\n```\n\napp.js\n\n```js\nvar express = require('express'),\n    app = express(),\n    server = require('http').Server(app),\n    io = require('socket.io')(server);\n\napp.use(express.static(__dirname + '/app/webroot'));\nserver.listen(3000);\n\n\nio.sockets.on('connection', function (socket) {\n  console.log(\"connection\");\n  var serialport = require('serialport');\n  var sp = new serialport.SerialPort(\"/dev/ttyUSB0\", {\n    baudRate: 115200,\n    dataBits: 8,\n    stopBits: 1,\n    parser: serialport.parsers.readline(\"\\n\")\n  });\n  sp.on('open', function() {\n    console.log('open');\n    sp.on('data', function(input) {\n      console.log(input.toString());\n      socket.emit(\"buffer\", input.toString());\n      if (input.toString().indexOf(\"autoboot\") > -1) {\n        sp.write(\"\\n\");\n      }\n    });\n  });\n  socket.on(\"boot\", function() {\n    console.log('boot');\n    sp.write(\"dhcp;\");\n    sp.write(\"tftp 0x43000000 script.bin;\");\n    sp.write(\"tftp 0x48000000 uImage;\");\n    sp.write(\"bootm 0x48000000;\");\n    sp.write(\"\\n\");\n  });\n});\n\n```\n\nindex.htlm\n\n```html\n<!DOCTYPE HTML>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <title>test</title>\n  <script type=\"text/javascript\" src=\"jquery.js\"></script>\n  <script src=\"/socket.io/socket.io.js\"></script>\n  <script type=\"text/javascript\">\n    var url = location.protocol + \"//\" + location.host;\n    var io = io.connect(url);\n    io.on(\"connect\", function () {}); \n    io.on(\"buffer\", function (data) {\n      $(\"#buffer\").append(\"<span>\" + data + \"<br/></span>\");\n    });\n    $(document).ready(function() {\n      $(\"#boot\").on(\"click\", function() {\n        console.log(\"boot\");\n        io.emit(\"boot\");\n      });\n    });\n  </script>\n  <style>\n    *{\n      font-size:14px;\n      padding:0;\n      height: 100%;\n    }\n    div.console {\n      margin:10px;\n      background-color: #000;\n      color : #fff;\n      padding: 10px;\n      width : 80%;\n      height: 80%;\n      border-radius : 5px;\n      overflow: scroll;\n    }\n    #boot {\n      margin:10px;\n      width : 100px;\n    }\n  </style>\n</head>\n<body>\n<input type='button' id=\"boot\" value=\"\u30b5\u30fc\u30d0\u8d77\u52d5\">\n<div id=\"buffer\" class=\"console\"></div>\n</body>\n</html>\n\n```\n\n## \u307e\u3068\u3081\n\nWEB\u753b\u9762\u3067\u8d77\u52d5\u30ce\u30fc\u30c9\u3084\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306a\u3067\u306e\u30d7\u30ed\u30d3\u30b8\u30e7\u30cb\u30f3\u30b0\u3092\u7ba1\u7406\u3059\u308c\u3070\u3001\u30d9\u30a2\u30e1\u30bf\u30eb\u30af\u30e9\u30a6\u30c9\u306e\u69cb\u7bc9\u5b8c\u4e86\u3002\n\u4eca\u56de\u3001\u30df\u30c9\u30eb\u306e\u7ba1\u7406\u307e\u3067\u306f\u306a\u3044\u304c\u3001\u6b21\u306f\u30df\u30c9\u30eb\u69cb\u7bc9\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u30a4\u30f3\u30d5\u30e9\u7cfb\u306e\u30b9\u30ad\u30eb\u304c\u4f4e\u3044\u306e\u306b\u52a0\u3048\u3001\u3068\u306b\u304b\u304f\u60c5\u5831\u304c\u5c11\u306a\u3044\u306e\u3067\u30cf\u30de\u308a\u307e\u3059\u3002\n"}