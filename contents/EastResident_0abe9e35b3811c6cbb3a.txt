{"context": "\u5148\u65e5User Local\u304c\u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API\u3092\u516c\u958b\u3057\u307e\u3057\u305f\u3002\u30dc\u30c3\u30c8\u958b\u767a\u306b\u5fc5\u8981\u306a\u81ea\u7136\u8a00\u8a9e\u51e6\u7406\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u96c6\u7d04\u3057\u305f\u3082\u306e\u3067\u3001\u73fe\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6a5f\u80fd\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u5168\u81ea\u52d5\u4f1a\u8a71API\n\u6c0f\u540d\u81ea\u52d5\u8b58\u5225API\n\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u4f1a\u8a71API\n\u5f62\u614b\u7d20\u89e3\u6790API\n\n\u56fd\u7523\u306e\u30dc\u30c3\u30c8\u4f5c\u6210\u30b5\u30fc\u30d3\u30b9\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u524d\u3005\u304b\u3089\u6c17\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u65e9\u901f\u624b\u3092\u51fa\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u5168\u81ea\u52d5\u4f1a\u8a71API\u3092\u4f7f\u3063\u3066LINE\u30dc\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u6a5f\u80fd\u78ba\u8a8d\n\n\u6e96\u5099\n\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u306f\u3053\u3053\u304b\u3089\u4f1a\u54e1\u767b\u9332\u304c\u5fc5\u8981\u3067\u3001\u73fe\u5728\u3001\u7b2c2\u671f\u52df\u96c6\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u81ea\u5206\u306f\u7b2c\u4e00\u671f\u306b\u7533\u3057\u8fbc\u3093\u3067\u30016\u670815\u65e5\u306bAPI\u30ad\u30fc\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\u4eca\u304b\u3089\u7533\u3057\u8fbc\u3093\u3060\u5834\u5408\u306f\u3001\u5229\u7528\u3067\u304d\u308b\u307e\u3067\u306b\u82e5\u5e72\u6642\u9593\u304c\u304b\u304b\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u305f\u3060\u3057\u3001\u4f1a\u54e1\u767b\u9332\u3057\u306a\u304f\u3066\u3082\u8a66\u7528\u3059\u308b\u65b9\u6cd5\u306f\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u307e\u305f\u3001\u4eca\u56de\u306fBot\u5b9f\u88c5\u306b\u3042\u305f\u3063\u3066\u3001Ruby\u3001sinatra\u3001heroku\u3001LINE BOT API\u7b49\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u53c2\u80031 \u53c2\u80032\n\n\u52d5\u4f5c\u691c\u8a3c\nBot\u3092\u4f5c\u308b\u524d\u306b\u3068\u308a\u3042\u3048\u305a\u901a\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\u81ea\u52d5\u4f1a\u8a71API\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u4e0e\u3057\u3066https://chatbot-api.userlocal.jp/api/chat\u306b\u5411\u3051\u3066GET\u3059\u308c\u3070\u3044\u3044\u3088\u3046\u3067\u3059(POST\u3082\u3067\u304d\u307e\u3059)\u3002\nhttps://chatbot-api.userlocal.jp/api/chat?key=your_api_key&message=\u3053\u3093\u306b\u3061\u306f\n\n\"key\"\u306fUserLocal\u304b\u3089\u63d0\u4f9b\u3055\u308c\u308bAPI\u30ad\u30fc\u3067\u3059\u3002\"message\"\u306b\u306f\u8a71\u3057\u304b\u3051\u308b\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001key\u306b \"sample\"\u3068\u5165\u308c\u308b\u3068\u3001\u672a\u767b\u9332\u3067\u3082\u5229\u7528\u3067\u304d\u307e\u3059(10\u56de/1h\u307e\u3067)\u3002\n\u305d\u308c\u3067\u306f\u8a66\u3057\u306b\u901a\u4fe1\u3057\u3066\u3001\u7d50\u679c\u3092\u53d7\u3051\u53d6\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u6700\u521d\u306fPOST\u3067\u901a\u4fe1\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001Ruby\u306eRestClient\u3067\u306f\u306a\u305c\u304bjson\u304c\u6e21\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001get\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u3044\u307e\u3059\u3002\nrequire 'json'\nrequire 'rest-client'\nrequire \"cgi\"\n\nrequest_content = {'key' => '5d11a37a8e1ff54e86cf', 'message' => CGI.escape('\u3053\u3093\u306b\u3061\u306f')}\nrequest_params = request_content.reduce([]) do |params, (key, value)|\n  params << \"#{key.to_s}=#{value}\"\nend\nrest = RestClient.get('https://chatbot-api.userlocal.jp/api/chat?' + request_params.join('&').to_s)\nresult = JSON.parse(rest)\np result\n\n\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7d50\u679c\u304c\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\n{\"status\"=>\"success\", \"result\"=>\"\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\"}\n\n\u4eca\u306f\u671d\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u3042\u3044\u3055\u3064\u3092\u8fd4\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\n\u5b9f\u88c5\n\u3067\u306f\u5b9f\u969b\u306bLINE\u30dc\u30c3\u30c8\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Ruby\u3001Sinatra\u3001heroku\u3001LINE BOT API\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3042\u305f\u308a\u306e\u8a73\u3057\u3044\u4f7f\u7528\u65b9\u6cd5\u306b\u95a2\u3057\u3066\u306f\u5148\u4eba\u306e\u65b9\u3005\u304c\u307e\u3068\u3081\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u8a73\u3057\u304f\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\u53c2\u80031:LINE bot\u3067\u30aa\u30a6\u30e0\u8fd4\u3057\u3092\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u4f5c\u308b\u5168\u624b\u9806\n\u53c2\u80032:LINE BOT API\u3067google\u691c\u7d22\u30dc\u30c3\u30c8\u3092\u4f5c\u3063\u305f\n\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\nworking_folder\n\n\nGemfile\nconfig.ru\nmain.rb\n\n\n\n\nGemfile\u306e\u7de8\u96c6\nGemfile\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001'bundle install'\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\nsource \"https://rubygems.org\"\n\ngem 'sinatra'\ngem 'json'\ngem 'rest-client'\ngem 'sinatra-contrib'\n\n\nconfig.ru\u306e\u7de8\u96c6\nconfig.ru\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fmain.rb\u306e\u307b\u3046\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\nrequire './main.rb'\n\nrun Main\n\n\n\u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\nAPI KEY\u3084ID\u7b49\u306e\u60c5\u5831\u3092heroku\u306e\u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\nLINE developers\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306eBasic information\u304b\u3089\u3001Channel ID\u3001 Channel Secret\u3001 MID\u306e3\u3064\u3001heroku\u306eFixie\u30a2\u30c9\u30aa\u30f3\u306eproxy_URL\u3001\u305d\u3057\u3066\u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API\u306eAPI \u30ad\u30fc\u3092\u767b\u9332\u3057\u307e\u3059\u3002\nheroku config:add LINE_CHANNEL_ID=\"your_channel_id\"\nheroku config:add LINE_CHANNEL_SECRET=\"your_channel_secret\"\nheroku config:add LINE_CHANNEL_MID=\"your_channel_mid\"\nheroku config:add USR_LOCAL_API_KEY=\"your_api_key\"\nheroku config:add FIXIE_URL=\"your_proxy_url\"\n\n\nmain.rb\u306e\u7de8\u96c6\nmain.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\nrequire 'bundler/setup'\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\nrequire \"cgi\"\n\nclass Main < Sinatra::Base\n\n  post '/linebot/callback' do\n    @params = JSON.parse(request.body.read)['result'].first\n\n    post_text(get_userlocal_bot)\n  end\n\n  private\n\n  def post_text(*post_messages)\n    line_pipe = {\n      'Content-Type': 'application/json; charset=UTF-8',\n      'X-Line-ChannelID': ENV['LINE_CHANNEL_ID'],\n      'X-Line-ChannelSecret': ENV['LINE_CHANNEL_SECRET'],\n      'X-Line-Trusted-User-With-ACL': ENV['LINE_CHANNEL_MID']\n    }\n\n    RestClient.proxy = ENV['FIXIE_URL']\n    endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n\n    post_messages.flatten.each do |post_message|\n      request_content = {\n        to: [@params['content']['from']],\n        toChannel: 1383378250,\n        eventType: '138311608800106203',\n        content: {contentType:1, toType:1, text: post_message }\n      }\n      content_json = request_content.to_json\n\n      RestClient.post(endpoint_uri, content_json, line_pipe)\n    end\n  end\n\n  def get_userlocal_bot\n    word = @params['content']['text']\n\n    request_content = {'key' =>  ENV['USR_LOCAL_API_KEY'], 'message' => CGI.escape(word), 'user_id' => @params['content']['from']}\n\n    request_params = request_content.reduce([]) do |params, (key, value)|\n      params << \"#{key}=#{value}\"\n    end\n    rest = RestClient.get('https://chatbot-api.userlocal.jp/api/chat?' + request_params.join('&').to_s)\n\n    result = JSON.parse(rest)\n    result['result']\n  end\nend\n\n\n\u52d5\u4f5c\u78ba\u8a8d\nLINE\u4e0a\u3067\u4f1a\u8a71\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\n\u611f\u60f3\n\u5148\u65e5\u3001\u985e\u4f3c\u306e\u56fd\u7523\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308bBOT TREE for MEDIA\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308b\u306a\u3069\u3001\u65e5\u672c\u3067\u3082\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u304c\u3088\u308a\u8eab\u8fd1\u306b\u306a\u3063\u3066\u304d\u3066\u3044\u308b\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\n\u4eca\u56de\u4f7f\u7528\u3057\u3066\u307f\u305f\u5168\u81ea\u52d5\u4f1a\u8a71API\u3067\u3059\u304c\u3001\u6b63\u76f4\u3001\u73fe\u72b6\u3067\u306f\u7cbe\u5ea6\u304c\u9ad8\u3044\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u90e8\u5206\u306b\u95a2\u3057\u3066\u306f\u516c\u5f0f\u5074\u3067\u3001\n\n\u4f1a\u8a71\u306e\u7cbe\u5ea6\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u3060\u6a5f\u68b0\u5b66\u7fd2\u306e\u9014\u4e2d\u3067\u3042\u308a\u3001\u4eca\u5f8c\u3001\u4f1a\u8a71\u306e\u8cea\u304c\u4e0a\u304c\u3063\u3066\u3044\u304f\u4e88\u5b9a\u3067\u3059\u3002(\u521d\u671f\u6bb5\u968e\u3067\u306f\u3001\u5b66\u7fd2\u3084\u8abf\u6574\u304c\u9032\u3093\u3067\u3044\u306a\u3044\u305f\u3081\u4f1a\u8a71\u7cbe\u5ea6\u304c\u4f4e\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059)\n\n\u3068\u8a00\u53ca\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u6642\u9593\u304c\u7d4c\u3064\u306b\u3057\u305f\u304c\u3063\u3066\u3001\u4f1a\u8a71\u7cbe\u5ea6\u306e\u5411\u4e0a\u304c\u898b\u8fbc\u3081\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u4eca\u5f8c\u3082\u69d8\u3005\u306a\u8ffd\u52a0\u6a5f\u80fd\u306e\u63d0\u4f9b\u3092\u63a7\u3048\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u3053\u308c\u304b\u3089\u306e\u5c55\u958b\u306b\u671f\u5f85\u3067\u3059\u3002\n\n\u5148\u65e5User Local\u304c[\u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API](http://ai.userlocal.jp/)\u3092\u516c\u958b\u3057\u307e\u3057\u305f\u3002\u30dc\u30c3\u30c8\u958b\u767a\u306b\u5fc5\u8981\u306a\u81ea\u7136\u8a00\u8a9e\u51e6\u7406\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u96c6\u7d04\u3057\u305f\u3082\u306e\u3067\u3001\u73fe\u6642\u70b9\u3067\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u6a5f\u80fd\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n- \u5168\u81ea\u52d5\u4f1a\u8a71API\n- \u6c0f\u540d\u81ea\u52d5\u8b58\u5225API\n- \u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u4f1a\u8a71API\n- \u5f62\u614b\u7d20\u89e3\u6790API\n\n\u56fd\u7523\u306e\u30dc\u30c3\u30c8\u4f5c\u6210\u30b5\u30fc\u30d3\u30b9\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u524d\u3005\u304b\u3089\u6c17\u306b\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u65e9\u901f\u624b\u3092\u51fa\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u4eca\u56de\u306f\u5168\u81ea\u52d5\u4f1a\u8a71API\u3092\u4f7f\u3063\u3066LINE\u30dc\u30c3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n# \u6a5f\u80fd\u78ba\u8a8d\n\n## \u6e96\u5099\n\n\u5229\u7528\u3059\u308b\u305f\u3081\u306b\u306f[\u3053\u3053](http://ai.userlocal.jp/)\u304b\u3089\u4f1a\u54e1\u767b\u9332\u304c\u5fc5\u8981\u3067\u3001\u73fe\u5728\u3001\u7b2c2\u671f\u52df\u96c6\u3092\u884c\u3063\u3066\u3044\u307e\u3059\u3002\u81ea\u5206\u306f\u7b2c\u4e00\u671f\u306b\u7533\u3057\u8fbc\u3093\u3067\u30016\u670815\u65e5\u306bAPI\u30ad\u30fc\u304c\u5c4a\u304d\u307e\u3057\u305f\u3002\u4eca\u304b\u3089\u7533\u3057\u8fbc\u3093\u3060\u5834\u5408\u306f\u3001\u5229\u7528\u3067\u304d\u308b\u307e\u3067\u306b\u82e5\u5e72\u6642\u9593\u304c\u304b\u304b\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u305f\u3060\u3057\u3001\u4f1a\u54e1\u767b\u9332\u3057\u306a\u304f\u3066\u3082\u8a66\u7528\u3059\u308b\u65b9\u6cd5\u306f\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\u307e\u305f\u3001\u4eca\u56de\u306fBot\u5b9f\u88c5\u306b\u3042\u305f\u3063\u3066\u3001Ruby\u3001sinatra\u3001heroku\u3001LINE BOT API\u7b49\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n[\u53c2\u80031](http://www.sakana.tech/entry/2016/04/12/112700) [\u53c2\u80032](http://qiita.com/EastResident/items/d1b572f00c29f907b743)\n\n## \u52d5\u4f5c\u691c\u8a3c\n\nBot\u3092\u4f5c\u308b\u524d\u306b\u3068\u308a\u3042\u3048\u305a\u901a\u4fe1\u3057\u3066\u307f\u307e\u3059\u3002\u81ea\u52d5\u4f1a\u8a71API\u3092\u5229\u7528\u3059\u308b\u306b\u306f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4ed8\u4e0e\u3057\u3066<https://chatbot-api.userlocal.jp/api/chat>\u306b\u5411\u3051\u3066GET\u3059\u308c\u3070\u3044\u3044\u3088\u3046\u3067\u3059(POST\u3082\u3067\u304d\u307e\u3059)\u3002\n\n```\nhttps://chatbot-api.userlocal.jp/api/chat?key=your_api_key&message=\u3053\u3093\u306b\u3061\u306f\n```\n\n\"key\"\u306fUserLocal\u304b\u3089\u63d0\u4f9b\u3055\u308c\u308bAPI\u30ad\u30fc\u3067\u3059\u3002\"message\"\u306b\u306f\u8a71\u3057\u304b\u3051\u308b\u30c6\u30ad\u30b9\u30c8\u3092\u5165\u529b\u3057\u307e\u3059\u3002\u3061\u306a\u307f\u306b\u3001key\u306b \"sample\"\u3068\u5165\u308c\u308b\u3068\u3001\u672a\u767b\u9332\u3067\u3082\u5229\u7528\u3067\u304d\u307e\u3059(10\u56de/1h\u307e\u3067)\u3002\n\n\u305d\u308c\u3067\u306f\u8a66\u3057\u306b\u901a\u4fe1\u3057\u3066\u3001\u7d50\u679c\u3092\u53d7\u3051\u53d6\u3063\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u6700\u521d\u306fPOST\u3067\u901a\u4fe1\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001Ruby\u306eRestClient\u3067\u306f\u306a\u305c\u304bjson\u304c\u6e21\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001get\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u9001\u3063\u3066\u3044\u307e\u3059\u3002\n\n```rb\nrequire 'json'\nrequire 'rest-client'\nrequire \"cgi\"\n\nrequest_content = {'key' => '5d11a37a8e1ff54e86cf', 'message' => CGI.escape('\u3053\u3093\u306b\u3061\u306f')}\nrequest_params = request_content.reduce([]) do |params, (key, value)|\n  params << \"#{key.to_s}=#{value}\"\nend\nrest = RestClient.get('https://chatbot-api.userlocal.jp/api/chat?' + request_params.join('&').to_s)\nresult = JSON.parse(rest)\np result\n```\n\n\u4e0a\u8a18\u306e\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u7d50\u679c\u304c\u51fa\u529b\u3055\u308c\u307e\u3057\u305f\u3002\n\n```json\n{\"status\"=>\"success\", \"result\"=>\"\u304a\u306f\u3088\u3046\u3054\u3056\u3044\u307e\u3059\"}\n```\n\n\u4eca\u306f\u671d\u3067\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001\u3042\u3044\u3055\u3064\u3092\u8fd4\u3057\u3066\u304f\u308c\u307e\u3057\u305f\u3002\n\n# \u5b9f\u88c5\n\n\u3067\u306f\u5b9f\u969b\u306bLINE\u30dc\u30c3\u30c8\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u4eca\u56de\u306f\u3001Ruby\u3001Sinatra\u3001heroku\u3001LINE BOT API\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3042\u305f\u308a\u306e\u8a73\u3057\u3044\u4f7f\u7528\u65b9\u6cd5\u306b\u95a2\u3057\u3066\u306f\u5148\u4eba\u306e\u65b9\u3005\u304c\u307e\u3068\u3081\u3066\u304f\u3060\u3055\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u8a73\u3057\u304f\u306f\u5272\u611b\u3057\u307e\u3059\u3002\n\n[\u53c2\u80031:LINE bot\u3067\u30aa\u30a6\u30e0\u8fd4\u3057\u3092\u30d6\u30e9\u30a6\u30b6\u4e0a\u3067\u4f5c\u308b\u5168\u624b\u9806](http://www.sakana.tech/entry/2016/04/12/112700)\n[\u53c2\u80032:LINE BOT API\u3067google\u691c\u7d22\u30dc\u30c3\u30c8\u3092\u4f5c\u3063\u305f](http://qiita.com/EastResident/items/d1b572f00c29f907b743)\n\n## \u30d5\u30a1\u30a4\u30eb\u69cb\u6210\n\u30d5\u30a1\u30a4\u30eb\u69cb\u6210\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n- working_folder\n  - Gemfile\n  - config.ru\n  - main.rb\n\n## Gemfile\u306e\u7de8\u96c6\n\nGemfile\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u3001'bundle install'\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```\nsource \"https://rubygems.org\"\n\ngem 'sinatra'\ngem 'json'\ngem 'rest-client'\ngem 'sinatra-contrib'\n```\n\n## config.ru\u306e\u7de8\u96c6\n\nconfig.ru\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\u3053\u3061\u3089\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u3082\u3044\u3044\u306e\u3067\u3059\u304c\u3001\u4eca\u56de\u306fmain.rb\u306e\u307b\u3046\u306b\u51e6\u7406\u3092\u66f8\u3044\u3066\u3044\u304d\u307e\u3059\u3002\n\n```rb\nrequire './main.rb'\n\nrun Main\n```\n\n## \u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\nAPI KEY\u3084ID\u7b49\u306e\u60c5\u5831\u3092heroku\u306e\u74b0\u5883\u5909\u6570\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002\nLINE developers\u3067\u4f5c\u6210\u3057\u305f\u30a2\u30ab\u30a6\u30f3\u30c8\u306eBasic information\u304b\u3089\u3001Channel ID\u3001 Channel Secret\u3001 MID\u306e3\u3064\u3001heroku\u306eFixie\u30a2\u30c9\u30aa\u30f3\u306eproxy_URL\u3001\u305d\u3057\u3066\u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API\u306eAPI \u30ad\u30fc\u3092\u767b\u9332\u3057\u307e\u3059\u3002\n\n```\nheroku config:add LINE_CHANNEL_ID=\"your_channel_id\"\nheroku config:add LINE_CHANNEL_SECRET=\"your_channel_secret\"\nheroku config:add LINE_CHANNEL_MID=\"your_channel_mid\"\nheroku config:add USR_LOCAL_API_KEY=\"your_api_key\"\nheroku config:add FIXIE_URL=\"your_proxy_url\"\n```\n\n## main.rb\u306e\u7de8\u96c6\n\nmain.rb\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\n\n```rb\nrequire 'bundler/setup'\nrequire 'sinatra/base'\nrequire 'json'\nrequire 'rest-client'\nrequire \"cgi\"\n\nclass Main < Sinatra::Base\n\n  post '/linebot/callback' do\n    @params = JSON.parse(request.body.read)['result'].first\n\n    post_text(get_userlocal_bot)\n  end\n\n  private\n\n  def post_text(*post_messages)\n    line_pipe = {\n      'Content-Type': 'application/json; charset=UTF-8',\n      'X-Line-ChannelID': ENV['LINE_CHANNEL_ID'],\n      'X-Line-ChannelSecret': ENV['LINE_CHANNEL_SECRET'],\n      'X-Line-Trusted-User-With-ACL': ENV['LINE_CHANNEL_MID']\n    }\n\n    RestClient.proxy = ENV['FIXIE_URL']\n    endpoint_uri = 'https://trialbot-api.line.me/v1/events'\n\n    post_messages.flatten.each do |post_message|\n      request_content = {\n        to: [@params['content']['from']],\n        toChannel: 1383378250,\n        eventType: '138311608800106203',\n        content: {contentType:1, toType:1, text: post_message }\n      }\n      content_json = request_content.to_json\n\n      RestClient.post(endpoint_uri, content_json, line_pipe)\n    end\n  end\n\n  def get_userlocal_bot\n    word = @params['content']['text']\n\n    request_content = {'key' =>  ENV['USR_LOCAL_API_KEY'], 'message' => CGI.escape(word), 'user_id' => @params['content']['from']}\n\n    request_params = request_content.reduce([]) do |params, (key, value)|\n      params << \"#{key}=#{value}\"\n    end\n    rest = RestClient.get('https://chatbot-api.userlocal.jp/api/chat?' + request_params.join('&').to_s)\n\n    result = JSON.parse(rest)\n    result['result']\n  end\nend\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\nLINE\u4e0a\u3067\u4f1a\u8a71\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-06-17 00.01.40.png](https://qiita-image-store.s3.amazonaws.com/0/79302/673fdc7d-5c6e-a611-34e5-2599c74f1c05.png)\n\n# \u611f\u60f3\n\n\u5148\u65e5\u3001\u985e\u4f3c\u306e\u56fd\u7523\u30b5\u30fc\u30d3\u30b9\u3067\u3042\u308b[BOT TREE for MEDIA](http://zeals.co.jp/bottree/)\u304c\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308b\u306a\u3069\u3001\u65e5\u672c\u3067\u3082\u30c1\u30e3\u30c3\u30c8\u30dc\u30c3\u30c8\u304c\u3088\u308a\u8eab\u8fd1\u306b\u306a\u3063\u3066\u304d\u3066\u3044\u308b\u3088\u3046\u306b\u601d\u3044\u307e\u3059\u3002\n\n\u4eca\u56de\u4f7f\u7528\u3057\u3066\u307f\u305f\u5168\u81ea\u52d5\u4f1a\u8a71API\u3067\u3059\u304c\u3001\u6b63\u76f4\u3001\u73fe\u72b6\u3067\u306f\u7cbe\u5ea6\u304c\u9ad8\u3044\u3068\u306f\u8a00\u3048\u307e\u305b\u3093\u3002\u3057\u304b\u3057\u3001\u3053\u306e\u90e8\u5206\u306b\u95a2\u3057\u3066\u306f\u516c\u5f0f\u5074\u3067\u3001\n\n>\u4f1a\u8a71\u306e\u7cbe\u5ea6\u306b\u3064\u3044\u3066\u306f\u3001\u307e\u3060\u6a5f\u68b0\u5b66\u7fd2\u306e\u9014\u4e2d\u3067\u3042\u308a\u3001\u4eca\u5f8c\u3001\u4f1a\u8a71\u306e\u8cea\u304c\u4e0a\u304c\u3063\u3066\u3044\u304f\u4e88\u5b9a\u3067\u3059\u3002(\u521d\u671f\u6bb5\u968e\u3067\u306f\u3001\u5b66\u7fd2\u3084\u8abf\u6574\u304c\u9032\u3093\u3067\u3044\u306a\u3044\u305f\u3081\u4f1a\u8a71\u7cbe\u5ea6\u304c\u4f4e\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059)\n\n\u3068\u8a00\u53ca\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001\u6642\u9593\u304c\u7d4c\u3064\u306b\u3057\u305f\u304c\u3063\u3066\u3001\u4f1a\u8a71\u7cbe\u5ea6\u306e\u5411\u4e0a\u304c\u898b\u8fbc\u3081\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u4eca\u5f8c\u3082\u69d8\u3005\u306a\u8ffd\u52a0\u6a5f\u80fd\u306e\u63d0\u4f9b\u3092\u63a7\u3048\u3066\u3044\u308b\u3088\u3046\u306a\u306e\u3067\u3001\u3053\u308c\u304b\u3089\u306e\u5c55\u958b\u306b\u671f\u5f85\u3067\u3059\u3002\n", "tags": ["Ruby", "Sinatra", "api", "linebot", "\u4eba\u5de5\u77e5\u80fd"]}