{"context": " More than 1 year has passed since last update.\u6c17\u304c\u3064\u3044\u305f\u3089Chef\u3084\u3089Puppet\u3084\u3089Ansible\u306fDevOps\u3068\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3093\u3067\u3059\u306d\u3002\n\u6642\u4ee3\u306e\u3061\u3087\u3063\u3068\u5148\u7aef\u306b\u884c\u3063\u305f\u3068\u601d\u3063\u305f\u3089\u307e\u305f\u53d6\u308a\u6b8b\u3055\u308c\u3066\u308b\u611f\u3058\u304c\u306a\u3093\u3068\u3082\u3053\u306e\u696d\u754c\u306a\u3089\u3067\u306f\u304b\u3068\u3002\n\u3067\u3001\u8a71\u306f\u5909\u308f\u3063\u3066\u524d\u304b\u3089Vagrant\u306ebaseBox\u3092\u30bc\u30ed\u304b\u3089\u4f5c\u308a\u305f\u3044\u305e\uff01\uff01\u3053\u306e\u30e4\u30ed\u30fc\uff01\uff01\u3063\u3066\u601d\u3063\u3066\u3044\u305f\u3089\nPacker\u3068\u3044\u3046Vagrant\u306e\u4f5c\u8005\u304c\u4eee\u60f3\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\u30c4\u30fc\u30eb\u3092\u51fa\u3057\u3066\u3044\u305f\u306e\u3067\u4f5c\u3063\u3066\u898b\u305f\u6642\u306e\u30e1\u30e2\n\n\u74b0\u5883\n\nmacosx10.8(\u30db\u30b9\u30c8OS)\n\n\n\u4f5c\u308b\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eOS\n\nCentOS6.4-x86_64_minimal\n\n\n\u4e8b\u524d\u6e96\u5099\u306b\u5fc5\u8981\u306a\u3082\u306e\n\n\nhomebrew \u203b\u5165\u308c\u3066\u3044\u306a\u3044\u65b9\u306f\u4f55\u3082\u8003\u3048\u305a\u306bruby -e \"$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)\"\u3068\u6253\u3068\u3046\n\nvirtualbox \u203b\u5165\u308c\u3066\u3044\u306a\u3044\u65b9\u306f\u305d\u3046\u3060virtualbox\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046\u304b\u3089virtualbox\u306e\u5165\u624b\u3060\u3051\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\n\n\n\u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\n[\u7d9a\u5831]Packer\u3067Vagrant\u7528\u306eBox\u3092\u4f5c\u6210\u3059\u308b\nOSX\u3067packer\u3067CentOS6.4\u306eVirtualBox VM\u3092\u4f5c\u6210\u3059\u308b\n\n\n\u3068\u308a\u3042\u3048\u305aPacker\u3092\u8a66\u3057\u305f\u3044\u65b9\u306f\u3053\u3061\u3089\n\nPacker\u3092\u3064\u304b\u3063\u30663\u30b9\u30c6\u30c3\u30d7\u3067Vagrant\u306eBox\u3092\u4f5c\u308b\n\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\nryurock/versicolor\n\nPacker\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nOSX\u3067\u8a66\u3057\u305f\u306e\u3067\u4ed6\u306eOS\u306f\u672c\u5bb6\u306e\u8aac\u660e\u306b\u8b72\u308a\u307e\u3059\nINSTALL PACKER\nbrew tap homebrew/binary\nbrew install packer\n\n\nPacker\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\u3010\u6ce8\u610f\u3011 packer1.4\u4ee5\u524d\u3068\u4ee5\u964d\u3067\u8a2d\u5b9a\u65b9\u6cd5\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\u5404\u9805\u76ee\u306etype\u306f\n\nPacker1.4\u4ee5\u524d\u306fvirtualbox\n\nPacker1.4\u4ee5\u964d\u306fvirtualbox-iso\n\n\n\u306b\u306a\u308a\u307e\u3059\u3002\n\u9069\u5f53\u306a\u30d5\u30a1\u30a4\u30eb\u540d.json\u3067\u3082\u3044\u3044\u307f\u305f\u3044\u3067\u3059\n\npacker.json\n{\n  \"builders\": [\n    {\n      \"type\": \"virtualbox-iso\",\n      \"vm_name\": \"box\",\n      \"boot_wait\": \"10s\",\n      \"disk_size\": 512000,\n      \"guest_os_type\": \"RedHat_64\",\n      \"iso_checksum\": \"4a5fa01c81cc300f4729136e28ebe600\",\n      \"iso_checksum_type\": \"md5\",\n      \"iso_url\": \"http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso\",\n      \"ssh_username\": \"vagrant\",\n      \"ssh_password\": \"vagrant\",\n      \"ssh_port\": 22,\n      \"ssh_wait_timeout\": \"10000s\",\n      \"shutdown_command\": \"echo '/sbin/halt -h -p' > shutdown.sh; echo 'vagrant'|sudo -S sh 'shutdown.sh'\",\n      \"guest_additions_path\": \"VBoxGuestAdditions_{{.Version}}.iso\",\n      \"virtualbox_version_file\": \".vbox_version\",\n      \"vboxmanage\": [\n        [\n          \"modifyvm\",\n          \"{{.Name}}\",\n          \"--memory\",\n          \"2048\"\n        ],\n        [\n          \"modifyvm\",\n          \"{{.Name}}\",\n          \"--cpus\",\n          \"2\"\n        ]\n      ],\n      \"http_directory\": \"./packer/builders/\",\n      \"boot_command\": [\n        \"<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>\"\n      ]\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"scripts\": [\n        \"packer/provisioners/base.sh\",\n        \"packer/provisioners/vagrant.sh\",\n        \"packer/provisioners/virtualbox.sh\",\n        \"packer/provisioners/cleanup.sh\"\n      ],\n      \"override\": {\n        \"virtualbox-iso\": {\n          \"execute_command\": \"echo 'vagrant'|sudo -S sh '{{.Path}}'\"\n        }\n      }\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"vagrant\",\n      \"output\": \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n    }\n  ]\n}\n\n\n\u4f55\u304c\u66f8\u3044\u3066\u3042\u308b\u306e\u304b\u308f\u304b\u3089\u306a\u3044\u3068\u304a\u3082\u3046\u306e\u3067\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\n\nbuilders\n\npacker.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n  \"builders\": [\n    {\n      \"type\": \"virtualbox-iso\",\n      \"vm_name\": \"CentOS6.4-x86_minimal\",\n             .\n             .\n             .\n    }\n  ]\n\n\n\u3053\u308c\u306f\u4f5c\u308b\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\n\n\u9805\u76ee\u540d\n\u8aac\u660e\n\n\n\n\ntype\n\u4f55\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b\u9805\u76ee\u3067\u3059AWS\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u304b\u3082\u6307\u5b9a\u53ef\u80fd\u3002\u4eca\u56de\u306fvirtualbox\u306a\u306e\u3067 \u300cvirtualbox-iso\u300d\u3092\u8a18\u8f09\n\n\nvm_name\n\u30c7\u30d5\u30a9\u30eb\u30c8\u306evm\u540d\u306b\u306a\u308a\u307e\u3059Vagrant\u3067\u3082\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3067\u304d\u308b\u306e\u8a18\u8f09\u3057\u306a\u304f\u3066\u3082\u554f\u984c\u306a\u3044\n\n\nboot_wait\n\u6700\u521d\u306bVirtualbox\u304c\u8d77\u52d5boot\u3059\u308b\u307e\u3067\u306e\u5f85\u3061\u6642\u9593\n\n\ndisk_size\nVirtualbox\u306e\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u306e\u6307\u5b9a\u9069\u5f53\u306b\u591a\u3081\u3067\n\n\nguest_os_type\nCentOSx86\u7cfb\u306a\u3089\u300cRedHat_64\u300d\u3092\u6307\u5b9a\u3002type\u306e\u4e00\u89a7\u306fVBoxManage list ostypes \u3067\u308f\u304b\u308b\n\n\niso_checksum\niso\u306echecksum\u3002\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306fmd5 \u4f5c\u308bOS.iso\u3068\u53e9\u3051\u3070\u308f\u304b\u308b\n\n\niso_url\niso\u306eDL\u5148\u306eURL\u3002\u4f55\u6545\u304bHTTP\u3057\u304b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u304b\u3063\u305f\n\n\nssh_username\nssh\u30e6\u30fc\u30b6\u30fc\u540d\u3002vagrant\u3068\u9023\u643a\u3057\u305f\u3044\u306a\u3089\u30e6\u30fc\u30b6\u30fc\u540d\u306fvagrant\u306b\u3057\u3068\u3044\u305f\u307b\u3046\u304c\u697d\u304b\u3082\n\n\nssh_password\nssh\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\n\n\nssh_port\n\u4f55\u3082\u8003\u3048\u305a\u306b22\u3067\u3044\u3044\u3067\u3057\u3087\u3046\n\n\nssh_wait_timeout\nSSH\u306e\u63a5\u7d9a\u6642\u9593\n\n\nshutdown_command\n\u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u30b3\u30de\u30f3\u30c9\n\n\nguest_additions_path\nVirtualbox\u306eguest_additions\u306e\u30d1\u30b9\n\n\nvirtualbox_version_file\nVirtualBox\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306a\u3093\u3067\u3057\u3087\u3046\n\n\nvboxmanage\nVirtualbox\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u3002\u4eca\u56de\u306f\u30e1\u30e2\u30ea\u30922G\u3001CPUCore\u6570\u30922\u3068\u3057\u3066\u3044\u308b\n\n\nhttp_directory\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u30ed\u30fc\u30ab\u30eb\u306bWeb\u30b5\u30fc\u30d0\u3092\u305f\u3066\u3066kickstart\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u6301\u3063\u3066\u3044\u304f\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3059\u3002kickstart\u3063\u3066\u4f55\uff1f\u3063\u3066\u65b9\u306fkickstart\u3067CentOS6\u306e\u81ea\u52d5\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3092\u307f\u3066\u304f\u3060\u3055\u3044\n\n\nboot_command\nboot\u6642\u306ekickstart\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306eks.cfg\u306e\u5834\u6240\u3092\u6307\u5b9a\u3059\u308b\n\n\n\n\npost-processors\nOS\u3092\u4f5c\u6210\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u8a18\u8f09\u3059\u308b\u9805\u76ee\u3067\u3059\n\npacker.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n \"post-processors\": [\n    {\n      \"type\": \"vagrant\",\n      \"output\": \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n    }\n  ]\n\n\n\n\n\n\u9805\u76ee\u540d\n\u8aac\u660e\n\n\n\n\ntype\nvagrant\u306e\u30dc\u30c3\u30af\u30b9\u4f5c\u308b\u5834\u5408\u306fvagrant\u3067\n\n\noutput\nvagrant\u306e\u30dc\u30c3\u30af\u30b9\u4f5c\u3063\u305f\u5f8c\u306e.box\u306e\u5410\u304d\u51fa\u3057\u5834\u6240\u306e\u6307\u5b9a\u3067\u3059\n\n\n\n\nKickStart\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\nOSX\u3067packer\u3067CentOS6.4\u306eVirtualBox VM\u3092\u4f5c\u6210\u3059\u308b\u306e\u307e\u3093\u307e\u3067\u3059\u3002\n\u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308d\u3046\nmkdir -r packer/vagrant-boxes packer/builders\nvim packer/builders/ks.cfg\n\n\npacker/builders/ks.cfg\ninstall\ncdrom\nlang en_US.UTF-8\nkeyboard us\nnetwork --bootproto=dhcp\nrootpw vagrant\nfirewall --enabled --service=ssh\nauthconfig --enableshadow --passalgo=sha512\nselinux --disabled\ntimezone Asia/Tokyo\nbootloader --location=mbr\n\ntext\nskipx\nzerombr\n\nclearpart --all --initlabel\nautopart\n\nauth  --useshadow  --enablemd5\nfirstboot --disabled\nreboot\n\n%packages --ignoremissing\n@core\nbzip2\nkernel-devel\nkernel-headers\n-ipw2100-firmware\n-ipw2200-firmware\n-ivtv-firmware\n%end\n\n%post\n/usr/bin/yum -y install sudo\n/usr/sbin/groupadd -g 501 vagrant\n/usr/sbin/useradd vagrant -u 501 -g vagrant -G wheel\necho \"vagrant\"|passwd --stdin vagrant\necho \"vagrant        ALL=(ALL)       NOPASSWD: ALL\" >> /etc/sudoers.d/vagrant\nchmod 0440 /etc/sudoers.d/vagrant\n%end\n\n\n\nprovisioners\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3082\u306e\u3067\u3059\u3002KickStart\u3067\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30d7\u30e9\u30b9\u30a2\u30eb\u30d5\u30a1\u306e\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306fprovisioners\u5074\u3067\u7ba1\u7406\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002provisioners\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u5024\u3092\u5165\u308c\u308c\u3070\u4efb\u610f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\n\npacker.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"scripts\": [\n        \"packer/provisioners/base.sh\",\n        \"packer/provisioners/vagrant.sh\",\n        \"packer/provisioners/virtualbox.sh\",\n        \"packer/provisioners/cleanup.sh\"\n      ],\n      \"override\": {\n        \"virtualbox-iso\": {\n          \"execute_command\": \"echo 'vagrant'|sudo -S sh '{{.Path}}'\"\n        }\n      }\n    }\n  ],\n\n\n\n\u30d3\u30eb\u30c9\u306e\u5b9f\u884c\ncd packer.json\u304c\u7f6e\u3044\u3066\u3042\u308b\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\npacker build --only=virtualbox-iso packer.json\n# \u53e4\u3044packer\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u65b9\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\n# packer build -only=virtualbox packer.json\n\n\nvirtualbox output will be in this color.\n\n==> virtualbox: Downloading or copying Guest additions checksums\n    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/SHA256SUMS\n==> virtualbox: Downloading or copying Guest additions\n    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/VBoxGuestAdditions_4.2.10.iso\n==> virtualbox: Downloading or copying ISO\n    virtualbox: Downloading or copying: http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso\n==> virtualbox: Starting HTTP server on port 8081\n==> virtualbox: Creating virtual machine...\n==> virtualbox: Creating hard drive...\n==> virtualbox: Creating forwarded port mapping for SSH (host port 3213)\n==> virtualbox: Executing custom VBoxManage commands...\n    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --memory 2048\n    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --cpus 2\n==> virtualbox: Starting the virtual machine...\n==> virtualbox: Waiting 10s for boot...\n==> virtualbox: Typing the boot command...\n==> virtualbox: Waiting for SSH to become available...\n==> virtualbox: Connected to SSH!\n==> virtualbox: Uploading VirtualBox version info (4.2.10)\n==> virtualbox: Uploading VirtualBox guest additions ISO...\n==> virtualbox: Gracefully halting virtual machine...\n    virtualbox: \n    virtualbox:\n    virtualbox: Broadcast message from vagrant@localhost.localdomain\n    virtualbox: (unknown) at 0:22 ...\n    virtualbox:\n    virtualbox: The system is going down for power off NOW!\n==> virtualbox: Preparing to export machine...\n    virtualbox: Deleting forwarded port mapping for SSH (host port 3213)\n==> virtualbox: Exporting virtual machine...\n==> virtualbox: Unregistering and deleting virtual machine...\n==> virtualbox: Running post-processor: vagrant\n==> virtualbox (vagrant): Creating Vagrant box for 'virtualbox' provider\n    virtualbox (vagrant): Copying: output-virtualbox/packer-disk1.vmdk\n    virtualbox (vagrant): Copying: output-virtualbox/packer.ovf\n    virtualbox (vagrant): Renaming the OVF to box.ovf...\n    virtualbox (vagrant): Compressing box...\n    virtualbox (vagrant): Compressing: Vagrantfile\n    virtualbox (vagrant): Compressing: box.ovf\n    virtualbox (vagrant): Compressing: metadata.json\n    virtualbox (vagrant): Compressing: packer-disk1.vmdk\nBuild 'virtualbox' finished.\n\n==> Builds finished. The artifacts of successful builds are:\n--> virtualbox: 'virtualbox' provider box: ./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\n\n\nVagrantFile\u306b\u8ffd\u52a0\nVagrantFile\u304c\u306a\u3044\u5834\u5408\u306f\u4f5c\u308b\ncd packer.json\u304c\u7f6e\u3044\u3066\u3042\u308b\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nvagrat init\n\nVagrantFile\u306b\u66f8\u304d\u307e\u3057\u3087\n\nVagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nBOX_NAME = \"CentOS6.4-x86-minimal\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.box = BOX_NAME\n\n  config.vm.box_url = \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n\n  config.vm.network :private_network, ip: \"192.168.56.101\"\n\n  config.vm.provider :virtualbox do |vb|\n     vb.name = BOX_NAME\n     vb.customize [\"modifyvm\", :id, \"--memory\", \"2048\"]\n     vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n\n   end\nend\n\n\n\nVagrant\u3067\u8d77\u52d5\u78ba\u8a8d\nvagrant up\n\nBringing machine 'default' up with 'virtualbox' provider...\n[default] Box 'CentOS6.4-x86-minimal' was not found. Fetching box from specified URL for\nthe provider 'virtualbox'. Note that if the URL does not have\na box for this provider, you should interrupt Vagrant now and add\nthe box yourself. Otherwise Vagrant will attempt to download the\nfull box prior to discovering this error.\nDownloading or copying the box...\nExtracting box...e: 285M/s, Estimated time remaining: --:--:--)\nSuccessfully added box 'CentOS6.4-x86-minimal' with provider 'virtualbox'!\n[default] Importing base box 'CentOS6.4-x86-minimal'...\n[default] Matching MAC address for NAT networking...\n[default] Setting the name of the VM...\n[default] Clearing any previously set forwarded ports...\n[default] Creating shared folders metadata...\n[default] Clearing any previously set network interfaces...\n[default] Preparing network interfaces based on configuration...\n[default] Forwarding ports...\n[default] -- 22 => 2222 (adapter 1)\n[default] Running any VM customizations...\n[default] Booting VM...\n[default] Waiting for VM to boot. This can take a few minutes.\n\n\u3053\u308c\u3067\u30aa\u30ec\u30aa\u30ec.box\u306e\u51fa\u6765\u4e0a\u304c\u308a\u3067\u3059\uff01\uff01\n\u6c17\u304c\u3064\u3044\u305f\u3089[Chef](http://tsuchikazu.net/chef_solo_start/)\u3084\u3089[Puppet](http://gihyo.jp/admin/serial/01/puppet)\u3084\u3089[Ansible](http://apatheia.info/blog/2013/04/06/about-ansible/)\u306f[DevOps](http://www.atmarkit.co.jp/ait/articles/1307/02/news002.html)\u3068\u547c\u3070\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u3093\u3067\u3059\u306d\u3002\n\u6642\u4ee3\u306e\u3061\u3087\u3063\u3068\u5148\u7aef\u306b\u884c\u3063\u305f\u3068\u601d\u3063\u305f\u3089\u307e\u305f\u53d6\u308a\u6b8b\u3055\u308c\u3066\u308b\u611f\u3058\u304c\u306a\u3093\u3068\u3082\u3053\u306e\u696d\u754c\u306a\u3089\u3067\u306f\u304b\u3068\u3002\n\n\u3067\u3001\u8a71\u306f\u5909\u308f\u3063\u3066\u524d\u304b\u3089[Vagrant](http://www.vagrantup.com/)\u306ebaseBox\u3092\u30bc\u30ed\u304b\u3089\u4f5c\u308a\u305f\u3044\u305e\uff01\uff01\u3053\u306e\u30e4\u30ed\u30fc\uff01\uff01\u3063\u3066\u601d\u3063\u3066\u3044\u305f\u3089\n[Packer](http://www.packer.io/)\u3068\u3044\u3046Vagrant\u306e\u4f5c\u8005\u304c\u4eee\u60f3\u30a4\u30e1\u30fc\u30b8\u3092\u4f5c\u308b\u30c4\u30fc\u30eb\u3092\u51fa\u3057\u3066\u3044\u305f\u306e\u3067\u4f5c\u3063\u3066\u898b\u305f\u6642\u306e\u30e1\u30e2\n\n## \u74b0\u5883\n\n* macosx10.8(\u30db\u30b9\u30c8OS)\n\n## \u4f5c\u308b\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306eOS\n\n* CentOS6.4-x86_64_minimal\n\n## \u4e8b\u524d\u6e96\u5099\u306b\u5fc5\u8981\u306a\u3082\u306e\n* [homebrew](http://brew.sh/index_ja.html) \u203b\u5165\u308c\u3066\u3044\u306a\u3044\u65b9\u306f\u4f55\u3082\u8003\u3048\u305a\u306b```ruby -e \"$(curl -fsSL https://raw.github.com/mxcl/homebrew/go)\"```\u3068\u6253\u3068\u3046\n* [virtualbox](https://www.virtualbox.org/) \u203b\u5165\u308c\u3066\u3044\u306a\u3044\u65b9\u306f[\u305d\u3046\u3060virtualbox\u3092\u4f7f\u3063\u3066\u307f\u3088\u3046](http://qiita.com/ryurock/items/31029ea9ac3fcb34abdc)\u304b\u3089virtualbox\u306e\u5165\u624b\u3060\u3051\u3092\u8a66\u3057\u3066\u304f\u3060\u3055\u3044\n\n## \u53c2\u8003\u306b\u3057\u305f\u30b5\u30a4\u30c8\n\n* [[\u7d9a\u5831]Packer\u3067Vagrant\u7528\u306eBox\u3092\u4f5c\u6210\u3059\u308b](http://www.ryuzee.com/contents/blog/6706)\n* [OSX\u3067packer\u3067CentOS6.4\u306eVirtualBox VM\u3092\u4f5c\u6210\u3059\u308b](http://qiita.com/hnakamur/items/da0ed14192a18405f704)\n\n\n## \u3068\u308a\u3042\u3048\u305aPacker\u3092\u8a66\u3057\u305f\u3044\u65b9\u306f\u3053\u3061\u3089\n\n* [Packer\u3092\u3064\u304b\u3063\u30663\u30b9\u30c6\u30c3\u30d7\u3067Vagrant\u306eBox\u3092\u4f5c\u308b](http://qiita.com/ryurock/items/e3635221e4717f2addfe)\n\n\n\n## \u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\n\n[ryurock/versicolor](https://github.com/ryurock/versicolor/tree/a2f83daedf9d30b6faa2c83c7536700b9dc6be29)\n\n\n## Packer\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nOSX\u3067\u8a66\u3057\u305f\u306e\u3067\u4ed6\u306eOS\u306f\u672c\u5bb6\u306e\u8aac\u660e\u306b\u8b72\u308a\u307e\u3059\n[INSTALL PACKER](http://www.packer.io/intro/getting-started/setup.html)\n\n```shell\nbrew tap homebrew/binary\nbrew install packer\n``` \n\n## Packer\u306e\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\n\n\n### \u3010\u6ce8\u610f\u3011 packer1.4\u4ee5\u524d\u3068\u4ee5\u964d\u3067\u8a2d\u5b9a\u65b9\u6cd5\u304c\u5909\u308f\u308a\u307e\u3057\u305f\u3002\n\n\u5404\u9805\u76ee\u306etype\u306f\n\n* Packer1.4\u4ee5\u524d\u306f```virtualbox```\n* Packer1.4\u4ee5\u964d\u306f```virtualbox-iso```\n\n\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u9069\u5f53\u306a\u30d5\u30a1\u30a4\u30eb\u540d.json\u3067\u3082\u3044\u3044\u307f\u305f\u3044\u3067\u3059\n\n```packer.json\n{\n  \"builders\": [\n    {\n      \"type\": \"virtualbox-iso\",\n      \"vm_name\": \"box\",\n      \"boot_wait\": \"10s\",\n      \"disk_size\": 512000,\n      \"guest_os_type\": \"RedHat_64\",\n      \"iso_checksum\": \"4a5fa01c81cc300f4729136e28ebe600\",\n      \"iso_checksum_type\": \"md5\",\n      \"iso_url\": \"http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso\",\n      \"ssh_username\": \"vagrant\",\n      \"ssh_password\": \"vagrant\",\n      \"ssh_port\": 22,\n      \"ssh_wait_timeout\": \"10000s\",\n      \"shutdown_command\": \"echo '/sbin/halt -h -p' > shutdown.sh; echo 'vagrant'|sudo -S sh 'shutdown.sh'\",\n      \"guest_additions_path\": \"VBoxGuestAdditions_{{.Version}}.iso\",\n      \"virtualbox_version_file\": \".vbox_version\",\n      \"vboxmanage\": [\n        [\n          \"modifyvm\",\n          \"{{.Name}}\",\n          \"--memory\",\n          \"2048\"\n        ],\n        [\n          \"modifyvm\",\n          \"{{.Name}}\",\n          \"--cpus\",\n          \"2\"\n        ]\n      ],\n      \"http_directory\": \"./packer/builders/\",\n      \"boot_command\": [\n        \"<tab> text ks=http://{{ .HTTPIP }}:{{ .HTTPPort }}/ks.cfg<enter><wait>\"\n      ]\n    }\n  ],\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"scripts\": [\n        \"packer/provisioners/base.sh\",\n        \"packer/provisioners/vagrant.sh\",\n        \"packer/provisioners/virtualbox.sh\",\n        \"packer/provisioners/cleanup.sh\"\n      ],\n      \"override\": {\n        \"virtualbox-iso\": {\n          \"execute_command\": \"echo 'vagrant'|sudo -S sh '{{.Path}}'\"\n        }\n      }\n    }\n  ],\n  \"post-processors\": [\n    {\n      \"type\": \"vagrant\",\n      \"output\": \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n    }\n  ]\n}\n```\n\n\u4f55\u304c\u66f8\u3044\u3066\u3042\u308b\u306e\u304b\u308f\u304b\u3089\u306a\u3044\u3068\u304a\u3082\u3046\u306e\u3067\u8aac\u660e\u3057\u3066\u3044\u304d\u307e\u3059\n\n### builders\n\n```packer.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n  \"builders\": [\n    {\n      \"type\": \"virtualbox-iso\",\n      \"vm_name\": \"CentOS6.4-x86_minimal\",\n             .\n             .\n             .\n    }\n  ]\n```\n\n\u3053\u308c\u306f\u4f5c\u308b\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n| \u9805\u76ee\u540d | \u8aac\u660e |\n|:-----------|------------:|\n| type       | \u4f55\u306e\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u304b\u3092\u6307\u5b9a\u3059\u308b\u9805\u76ee\u3067\u3059AWS\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u304b\u3082\u6307\u5b9a\u53ef\u80fd\u3002\u4eca\u56de\u306fvirtualbox\u306a\u306e\u3067 \u300cvirtualbox-iso\u300d\u3092\u8a18\u8f09 |\n| vm_name       | \u30c7\u30d5\u30a9\u30eb\u30c8\u306evm\u540d\u306b\u306a\u308a\u307e\u3059Vagrant\u3067\u3082\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3067\u304d\u308b\u306e\u8a18\u8f09\u3057\u306a\u304f\u3066\u3082\u554f\u984c\u306a\u3044 |\n| boot_wait | \u6700\u521d\u306bVirtualbox\u304c\u8d77\u52d5boot\u3059\u308b\u307e\u3067\u306e\u5f85\u3061\u6642\u9593 |\n| disk_size | Virtualbox\u306e\u30c7\u30a3\u30b9\u30af\u5bb9\u91cf\u306e\u6307\u5b9a\u9069\u5f53\u306b\u591a\u3081\u3067 |\n|guest_os_type| CentOSx86\u7cfb\u306a\u3089\u300cRedHat_64\u300d\u3092\u6307\u5b9a\u3002type\u306e\u4e00\u89a7\u306f```VBoxManage list ostypes``` \u3067\u308f\u304b\u308b|\n|iso_checksum| iso\u306echecksum\u3002\u308f\u304b\u3089\u306a\u3044\u5834\u5408\u306f```md5 \u4f5c\u308bOS.iso```\u3068\u53e9\u3051\u3070\u308f\u304b\u308b|\n|iso_url| iso\u306eDL\u5148\u306eURL\u3002\u4f55\u6545\u304bHTTP\u3057\u304b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u304b\u3063\u305f|\n|ssh_username| ssh\u30e6\u30fc\u30b6\u30fc\u540d\u3002vagrant\u3068\u9023\u643a\u3057\u305f\u3044\u306a\u3089\u30e6\u30fc\u30b6\u30fc\u540d\u306fvagrant\u306b\u3057\u3068\u3044\u305f\u307b\u3046\u304c\u697d\u304b\u3082|\n|ssh_password| ssh\u30e6\u30fc\u30b6\u30fc\u306e\u30d1\u30b9\u30ef\u30fc\u30c9|\n|ssh_port| \u4f55\u3082\u8003\u3048\u305a\u306b22\u3067\u3044\u3044\u3067\u3057\u3087\u3046|\n|ssh_wait_timeout| SSH\u306e\u63a5\u7d9a\u6642\u9593|\n| shutdown_command | \u30b7\u30e3\u30c3\u30c8\u30c0\u30a6\u30f3\u30b3\u30de\u30f3\u30c9 |\n| guest_additions_path | Virtualbox\u306eguest_additions\u306e\u30d1\u30b9 |\n| virtualbox_version_file | VirtualBox\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u756a\u53f7\u306a\u3093\u3067\u3057\u3087\u3046 |\n| vboxmanage | Virtualbox\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8a2d\u5b9a\u3002\u4eca\u56de\u306f\u30e1\u30e2\u30ea\u30922G\u3001CPUCore\u6570\u30922\u3068\u3057\u3066\u3044\u308b |\n|http_directory| \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u30ed\u30fc\u30ab\u30eb\u306bWeb\u30b5\u30fc\u30d0\u3092\u305f\u3066\u3066kickstart\u306a\u3069\u306e\u8a2d\u5b9a\u60c5\u5831\u3092\u6301\u3063\u3066\u3044\u304f\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3059\u3002kickstart\u3063\u3066\u4f55\uff1f\u3063\u3066\u65b9\u306f[kickstart\u3067CentOS6\u306e\u81ea\u52d5\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb](http://wg.drive.ne.jp/miura/archives/2208)\u3092\u307f\u3066\u304f\u3060\u3055\u3044|\n|boot_command| boot\u6642\u306ekickstart\u3092\u5b9f\u884c\u3059\u308b\u3068\u304d\u306eks.cfg\u306e\u5834\u6240\u3092\u6307\u5b9a\u3059\u308b|\n\n\n### post-processors\n\nOS\u3092\u4f5c\u6210\u3057\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3053\u3068\u3092\u8a18\u8f09\u3059\u308b\u9805\u76ee\u3067\u3059\n\n```packer.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n \"post-processors\": [\n    {\n      \"type\": \"vagrant\",\n      \"output\": \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n    }\n  ]\n```\n\n| \u9805\u76ee\u540d | \u8aac\u660e |\n|:-----------|------------:|\n| type | vagrant\u306e\u30dc\u30c3\u30af\u30b9\u4f5c\u308b\u5834\u5408\u306fvagrant\u3067|\n| output | vagrant\u306e\u30dc\u30c3\u30af\u30b9\u4f5c\u3063\u305f\u5f8c\u306e.box\u306e\u5410\u304d\u51fa\u3057\u5834\u6240\u306e\u6307\u5b9a\u3067\u3059|\n\n\n## KickStart\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304f\n\n[OSX\u3067packer\u3067CentOS6.4\u306eVirtualBox VM\u3092\u4f5c\u6210\u3059\u308b](http://qiita.com/hnakamur/items/da0ed14192a18405f704)\u306e\u307e\u3093\u307e\u3067\u3059\u3002\n\n\u307e\u305a\u306f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308d\u3046\n\n```shell\nmkdir -r packer/vagrant-boxes packer/builders\nvim packer/builders/ks.cfg\n```\n\n```shell:packer/builders/ks.cfg\ninstall\ncdrom\nlang en_US.UTF-8\nkeyboard us\nnetwork --bootproto=dhcp\nrootpw vagrant\nfirewall --enabled --service=ssh\nauthconfig --enableshadow --passalgo=sha512\nselinux --disabled\ntimezone Asia/Tokyo\nbootloader --location=mbr\n\ntext\nskipx\nzerombr\n\nclearpart --all --initlabel\nautopart\n\nauth  --useshadow  --enablemd5\nfirstboot --disabled\nreboot\n\n%packages --ignoremissing\n@core\nbzip2\nkernel-devel\nkernel-headers\n-ipw2100-firmware\n-ipw2200-firmware\n-ivtv-firmware\n%end\n\n%post\n/usr/bin/yum -y install sudo\n/usr/sbin/groupadd -g 501 vagrant\n/usr/sbin/useradd vagrant -u 501 -g vagrant -G wheel\necho \"vagrant\"|passwd --stdin vagrant\necho \"vagrant        ALL=(ALL)       NOPASSWD: ALL\" >> /etc/sudoers.d/vagrant\nchmod 0440 /etc/sudoers.d/vagrant\n%end\n```\n\n### provisioners\n\n\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u4f5c\u6210\u3055\u308c\u305f\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3082\u306e\u3067\u3059\u3002KickStart\u3067\u4eee\u60f3\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u30d7\u30e9\u30b9\u30a2\u30eb\u30d5\u30a1\u306e\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\u306fprovisioners\u5074\u3067\u7ba1\u7406\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u304b\u3068\u601d\u3044\u307e\u3059\u3002provisioners\u306e\u30cf\u30c3\u30b7\u30e5\u306e\u5024\u3092\u5165\u308c\u308c\u3070\u4efb\u610f\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5b9f\u884c\u3067\u304d\u307e\u3059\n\n\n```packer.json\uff08\u4e00\u90e8\u629c\u7c8b\uff09\n  \"provisioners\": [\n    {\n      \"type\": \"shell\",\n      \"scripts\": [\n        \"packer/provisioners/base.sh\",\n        \"packer/provisioners/vagrant.sh\",\n        \"packer/provisioners/virtualbox.sh\",\n        \"packer/provisioners/cleanup.sh\"\n      ],\n      \"override\": {\n        \"virtualbox-iso\": {\n          \"execute_command\": \"echo 'vagrant'|sudo -S sh '{{.Path}}'\"\n        }\n      }\n    }\n  ],\n```\n\n\n\n## \u30d3\u30eb\u30c9\u306e\u5b9f\u884c\n\n```shell\ncd packer.json\u304c\u7f6e\u3044\u3066\u3042\u308b\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\npacker build --only=virtualbox-iso packer.json\n# \u53e4\u3044packer\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u65b9\u306f\u4e0b\u8a18\u306e\u30b3\u30de\u30f3\u30c9\u3067\n# packer build -only=virtualbox packer.json\n\n\nvirtualbox output will be in this color.\n\n==> virtualbox: Downloading or copying Guest additions checksums\n    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/SHA256SUMS\n==> virtualbox: Downloading or copying Guest additions\n    virtualbox: Downloading or copying: http://download.virtualbox.org/virtualbox/4.2.10/VBoxGuestAdditions_4.2.10.iso\n==> virtualbox: Downloading or copying ISO\n    virtualbox: Downloading or copying: http://ftp.iij.ad.jp/pub/linux/centos/6.4/isos/x86_64/CentOS-6.4-x86_64-minimal.iso\n==> virtualbox: Starting HTTP server on port 8081\n==> virtualbox: Creating virtual machine...\n==> virtualbox: Creating hard drive...\n==> virtualbox: Creating forwarded port mapping for SSH (host port 3213)\n==> virtualbox: Executing custom VBoxManage commands...\n    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --memory 2048\n    virtualbox: Executing: modifyvm CentOS6.4-x86_minimal --cpus 2\n==> virtualbox: Starting the virtual machine...\n==> virtualbox: Waiting 10s for boot...\n==> virtualbox: Typing the boot command...\n==> virtualbox: Waiting for SSH to become available...\n==> virtualbox: Connected to SSH!\n==> virtualbox: Uploading VirtualBox version info (4.2.10)\n==> virtualbox: Uploading VirtualBox guest additions ISO...\n==> virtualbox: Gracefully halting virtual machine...\n    virtualbox: \n    virtualbox:\n    virtualbox: Broadcast message from vagrant@localhost.localdomain\n    virtualbox: (unknown) at 0:22 ...\n    virtualbox:\n    virtualbox: The system is going down for power off NOW!\n==> virtualbox: Preparing to export machine...\n    virtualbox: Deleting forwarded port mapping for SSH (host port 3213)\n==> virtualbox: Exporting virtual machine...\n==> virtualbox: Unregistering and deleting virtual machine...\n==> virtualbox: Running post-processor: vagrant\n==> virtualbox (vagrant): Creating Vagrant box for 'virtualbox' provider\n    virtualbox (vagrant): Copying: output-virtualbox/packer-disk1.vmdk\n    virtualbox (vagrant): Copying: output-virtualbox/packer.ovf\n    virtualbox (vagrant): Renaming the OVF to box.ovf...\n    virtualbox (vagrant): Compressing box...\n    virtualbox (vagrant): Compressing: Vagrantfile\n    virtualbox (vagrant): Compressing: box.ovf\n    virtualbox (vagrant): Compressing: metadata.json\n    virtualbox (vagrant): Compressing: packer-disk1.vmdk\nBuild 'virtualbox' finished.\n\n==> Builds finished. The artifacts of successful builds are:\n--> virtualbox: 'virtualbox' provider box: ./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\n```\n\n## VagrantFile\u306b\u8ffd\u52a0\n\nVagrantFile\u304c\u306a\u3044\u5834\u5408\u306f\u4f5c\u308b\n\n```shell\ncd packer.json\u304c\u7f6e\u3044\u3066\u3042\u308b\u30ab\u30ec\u30f3\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\nvagrat init\n```\n\nVagrantFile\u306b\u66f8\u304d\u307e\u3057\u3087\n\n```ruby:Vagrantfile\n# -*- mode: ruby -*-\n# vi: set ft=ruby :\n\nBOX_NAME = \"CentOS6.4-x86-minimal\"\n\nVagrant.configure(\"2\") do |config|\n  config.vm.box = BOX_NAME\n\n  config.vm.box_url = \"./packer/vagrant-boxes/CentOS-6.4-x86_64-minimal.box\"\n\n  config.vm.network :private_network, ip: \"192.168.56.101\"\n\n  config.vm.provider :virtualbox do |vb|\n     vb.name = BOX_NAME\n     vb.customize [\"modifyvm\", :id, \"--memory\", \"2048\"]\n     vb.customize [\"modifyvm\", :id, \"--cpus\", \"2\"]\n \n   end\nend\n```\n\n## Vagrant\u3067\u8d77\u52d5\u78ba\u8a8d\n\n```shell\nvagrant up\n\nBringing machine 'default' up with 'virtualbox' provider...\n[default] Box 'CentOS6.4-x86-minimal' was not found. Fetching box from specified URL for\nthe provider 'virtualbox'. Note that if the URL does not have\na box for this provider, you should interrupt Vagrant now and add\nthe box yourself. Otherwise Vagrant will attempt to download the\nfull box prior to discovering this error.\nDownloading or copying the box...\nExtracting box...e: 285M/s, Estimated time remaining: --:--:--)\nSuccessfully added box 'CentOS6.4-x86-minimal' with provider 'virtualbox'!\n[default] Importing base box 'CentOS6.4-x86-minimal'...\n[default] Matching MAC address for NAT networking...\n[default] Setting the name of the VM...\n[default] Clearing any previously set forwarded ports...\n[default] Creating shared folders metadata...\n[default] Clearing any previously set network interfaces...\n[default] Preparing network interfaces based on configuration...\n[default] Forwarding ports...\n[default] -- 22 => 2222 (adapter 1)\n[default] Running any VM customizations...\n[default] Booting VM...\n[default] Waiting for VM to boot. This can take a few minutes.\n```\n\n\u3053\u308c\u3067\u30aa\u30ec\u30aa\u30ec.box\u306e\u51fa\u6765\u4e0a\u304c\u308a\u3067\u3059\uff01\uff01\n\n\n\n\n\n\n\n\n\n\n\n", "tags": ["VirtualBox", "OSX", "packer", "CentOS", "chef"]}