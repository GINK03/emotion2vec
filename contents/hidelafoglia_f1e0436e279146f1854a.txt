{"context": " More than 1 year has passed since last update.\nhttps://docs.djangoproject.com/en/1.7/releases/1.7/#schema-migrations\n\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316\nstartproject:\n(v17)hdknr@wzy:~/ve/v17/src/sample$ mkdir -p web; django-admin.py startproject app web ;cd web\n\nmigrate & createsuperuser :\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\nOperations to perform:\n  Apply all migrations: admin, contenttypes, auth, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying sessions.0001_initial... OK\n\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py createsuperuser\nUsername (leave blank to use 'hdknr'): admin\nEmail address: admin@admin.admin\nPassword: \nPassword (again): \nSuperuser created successfully.\n\nsyncdb\u3082\u4e00\u5fdc\u4f7f\u3048\u308b:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ rm db.sqlite3 ; python manage.py syncdb\nOperations to perform:\n  Apply all migrations: admin, contenttypes, auth, sessions\nRunning migrations:\n  Applying contenttypes.0001_initial... OK\n  Applying auth.0001_initial... OK\n  Applying admin.0001_initial... OK\n  Applying sessions.0001_initial... OK\n\nYou have installed Django's auth system, and don't have any superusers defined.\nWould you like to create one now? (yes/no): yes\nUsername (leave blank to use 'hdknr'): admin\nEmail address: admin@admin.admin\nPassword: \nPassword (again): \nSuperuser created successfully.\n\n\n\u30e2\u30c7\u30eb\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\nmakemigrations:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations \nNo changes detected\n\n\u30a2\u30d7\u30ea\u8ffd\u52a0\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py startapp todos\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree todos/\ntodos/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 admin.py\n\u251c\u2500\u2500 migrations\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 models.py\n\u251c\u2500\u2500 tests.py\n\u2514\u2500\u2500 views.py\n\n1 directory, 6 files\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"INSTALLED_APPS += ('todos',)\" >> app/settings.py\n\n\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u7121\u3044\u306e\u3067\u8ffd\u52a0:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations\nNo changes detected\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ cat todos/models.py\n\nfrom django.db import models\nfrom django.contrib.auth.models import User\n\n\nclass Todo(models.Model):\n    user = models.ForeignKey(User)\n    title = models.CharField(max_length=50)\n    description = models.TextField()\n    due_at = models.DateTimeField(\n        null=True, blank=True, default=None)\n    created_at = models.DateTimeField(auto_now_add=True, )\n    updated_at = models.DateTimeField(auto_now=True, )\n\nmakemigrations:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations todos\n\nMigrations for 'todos':\n  0001_initial.py:\n    - Create model Todo\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree todos/\n\ntodos/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 __init__.pyc\n\u251c\u2500\u2500 admin.py\n\u251c\u2500\u2500 admin.pyc\n\u251c\u2500\u2500 migrations\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 0001_initial.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 __init__.pyc\n\u251c\u2500\u2500 models.py\n\u251c\u2500\u2500 models.pyc\n\u251c\u2500\u2500 tests.py\n\u2514\u2500\u2500 views.py\n\n1 directory, 11 files\n\nmigrate:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\nOperations to perform:\n  Apply all migrations: todos\nRunning migrations:\n  Applying todos.0001_initial... OK        \n\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \".schema todos_todo\" | python manage.py dbshell\n\nCREATE TABLE \"todos_todo\" (\n    \"id\" integer NOT NULL PRIMARY KEY AUTOINCREMENT, \n    \"title\" varchar(50) NOT NULL, \n    \"description\" text NOT NULL, \n    \"due_at\" datetime NULL, \n    \"created_at\" datetime NOT NULL, \n    \"updated_at\" datetime NOT NULL, \n    \"user_id\" integer NOT NULL REFERENCES \"auth_user\" (\"id\"));\n\nCREATE INDEX todos_todo_e8701ad4 ON \"todos_todo\" (\"user_id\");\n\n\ndjango_migrations\n\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb:\n$ echo \".schema django_migrations\" | python manage.py dbshell\n\nCREATE TABLE \"django_migrations\" (\n    \"id\" integer NOT NULL PRIMARY KEY AUTOINCREMENT, \n    \"app\" varchar(255) NOT NULL, \n    \"name\" varchar(255) NOT NULL, \n    \"applied\" datetime NOT NULL);\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select * from django_migrations;\" | python manage.py dbshell\n\n1|contenttypes|0001_initial|2014-09-03 02:10:35.695671\n2|auth|0001_initial|2014-09-03 02:10:35.744375\n3|admin|0001_initial|2014-09-03 02:10:35.788881\n4|sessions|0001_initial|2014-09-03 02:10:35.808466\n5|todos|0001_initial|2014-09-03 02:10:35.855269\n6|todos|0002_todo_closed|2014-09-03 02:11:12.687727\n\n\u30e2\u30b8\u30e5\u30fc\u30eb:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree $VIRTUAL_ENV/lib/python2.7/site-packages/django/db/migrations/ -I \"*.pyc\"\n/home/hdknr/ve/v17/lib/python2.7/site-packages/django/db/migrations/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 autodetector.py\n\u251c\u2500\u2500 executor.py\n\u251c\u2500\u2500 graph.py\n\u251c\u2500\u2500 loader.py\n\u251c\u2500\u2500 migration.py\n\u251c\u2500\u2500 operations\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 base.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fields.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 models.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 special.py\n\u251c\u2500\u2500 optimizer.py\n\u251c\u2500\u2500 questioner.py\n\u251c\u2500\u2500 recorder.py\n\u251c\u2500\u2500 state.py\n\u2514\u2500\u2500 writer.py\n\n1 directory, 16 files\n\nshell\u304b\u3089:\n>>> from django.db.migrations.recorder import *\n>>> for i in MigrationRecorder.Migration.objects.values():\n...     print i\n... \n{'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 695671, tzinfo=<UTC>), 'app': u'contenttypes', u'id': 1, 'name': u'0001_initial'}\n{'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 744375, tzinfo=<UTC>), 'app': u'auth', u'id': 2, 'name': u'0001_initial'}\n{'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 788881, tzinfo=<UTC>), 'app': u'admin', u'id': 3, 'name': u'0001_initial'}\n{'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 808466, tzinfo=<UTC>), 'app': u'sessions', u'id': 4, 'name': u'0001_initial'}\n{'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 855269, tzinfo=<UTC>), 'app': u'todos', u'id': 5, 'name': u'0001_initial'}\n{'applied': datetime.datetime(2014, 9, 3, 2, 11, 12, 687727, tzinfo=<UTC>), 'app': u'todos', u'id': 6, 'name': u'0002_todo_closed'}\n\n\npre_migrate/ post_migrate\ntodos/models.py \u4fee\u6b63:\nfrom django.dispatch import receiver\nfrom django.db.models.signals import (\n    pre_migrate, post_migrate,\n)\n\n\ndef trace(msg, sender, app_config, *args, **kwargs):\n    assert sender == app_config\n    assert args == ()\n    if app_config and app_config.name == \"todos\":\n        print msg \n        for k, v in kwargs.items():\n            print \"***\", k, type(v), v\n\n\n@receiver(pre_migrate)\ndef pre_migrate_handler(\n    sender=None, app_config=None, *args, **kwargs\n):\n    trace(\n        \">>> pre_migrate signal\",\n        sender, app_config, *args, **kwargs)\n\n\n@receiver(post_migrate)\ndef post_migrate_handler(\n    sender=None, app_config=None, *args, **kwargs\n):\n    trace(\n        \">>> post_migrate signal\",\n        sender, app_config, *args, **kwargs)\n\n\nclass Todo(models.Model):\n    closed = models.BooleanField(default=False)\n    ....    \n\nmakemigrations & migrate:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations todos\n\nMigrations for 'todos':\n  0002_todo_closed.py:\n    - Add field closed to todo\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\n\nOperations to perform:\n  Apply all migrations: todos\nRunning migrations:\n  Applying todos.0002_todo_closed... OK\n>>> post_migrate signal\n*** using <type 'str'> default\n*** verbosity <type 'int'> 1\n*** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x25ba110>\n*** interactive <type 'bool'> True\n\n\nDatabase router \u306e allow_migrate\u30e1\u30bd\u30c3\u30c9\nallow_syncdb -> allow_migrate\u306e\u5909\u66f4\u3002\n\u65e2\u5b58\u306eXOOPS\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8aad\u3080\u3088\u3046\u306broute\u3092\u8a2d\u5b9a:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ more app/database.py\n\n_EXCLUSIVE = lambda obj: \\\n    {\"xoops\": \"xoops\"}.get(obj._meta.app_label, 'default')\n\n\nclass SitesRouter(object):\n\n    def db_for_read(self, model, **hints):\n        return _EXCLUSIVE(model)\n\n    def db_for_write(self, model, **hints):\n        return _EXCLUSIVE(model)\n\n    def allow_relation(self, obj1, obj2, **hints):\n        d1, d2 = _EXCLUSIVE(obj1), _EXCLUSIVE(obj2)\n\n        return None if d1 != d2 else d1\n\n    def allow_migrate(self, db, model):\n        ''' allow_syncdb -> allow_migrate '''\n        return _EXCLUSIVE(model)\n\napp/settings.py:\nINSTALLED_APPS += ('todos', 'xoops',)\n#\nDATABASES['xoops'] = {\n    'ENGINE': 'django.db.backends.mysql',\n    'NAME': os.environ['XOOPS_DBNAME'],\n    'USER': os.environ['XOOPS_DBUSER'],\n    'PASSWORD': os.environ['XOOPS_DBPASSWORD'],\n    'TEST_CHARSET': 'utf8',\n    'TEST_DATABASE_COLLATION': 'utf8_general_ci',\n}\nDATABASE_ROUTERS = ['app.database.SitesRouter']\n\nmigrate\u3057\u3066\u307f\u308b:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\n\nOperations to perform:\n  Synchronize unmigrated apps: xoops\n  Apply all migrations: admin, contenttypes, todos, auth, sessions\nSynchronizing apps without migrations:\n\n>>> pre_migrate signal\n*** using <type 'str'> default\n*** verbosity <type 'int'> 1\n*** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x27a4190>\n*** interactive <type 'bool'> True\n\n  Creating tables...\n  Installing custom SQL...\n  Installing indexes...\nRunning migrations:\n  No migrations to apply.\n\n>>> post_migrate signal\n*** using <type 'str'> default\n*** verbosity <type 'int'> 1\n*** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x27a41d0>\n*** interactive <type 'bool'> True\n\n\ninitial_data.json\n\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8:\ninitial_data fixtures are no longer loaded for apps with migrations; \nif you want to load initial data for an app, we suggest you do it in a migration.\n\ninitial_data.json:\n[{\"fields\": {\"description\": \"task1\", \"title\": \"task1\", \n  \"due_at\": null, \"created_at\": \"2014-09-03T03:10:37.059Z\", \n  \"updated_at\": \"2014-09-03T03:10:37.059Z\", \"user\": 1, \"closed\": false}, \n  \"model\": \"todos.todo\", \"pk\": 1}] \n\n\u524a\u9664:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"delete from todos_todo;\" | python  manage.py dbshell\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n0\n\ntodos\u3092migrate:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\nOperations to perform:\n  Apply all migrations: todos\nRunning migrations:\n  No migrations to apply.\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n0\n\n\u5168\u4f53:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\nOperations to perform:\n  Synchronize unmigrated apps: xoops\n  Apply all migrations: admin, contenttypes, todos, auth, sessions\nSynchronizing apps without migrations:\n  Creating tables...\n  Installing custom SQL...\n  Installing indexes...\nInstalled 1 object(s) from 1 fixture(s)\nRunning migrations:\n  No migrations to apply.\n\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n1\n\ntodos/fixtures/initial_data.json:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py dumpdata  > todos/fixtures/initial_data.json\n\nmigrate\u3067\u8aad\u307e\u306a\u3044\uff1a\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\nOperations to perform:\n  Apply all migrations: admin, contenttypes, todos, auth, sessions\nRunning migrations:\n  No migrations to apply.\n\ntests\u3060\u3068\u8aad\u307e\u308c\u308b\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u304c\u7121\u3044\u306e\u3067\u30a8\u30e9\u30fc:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py test todos\n\n....\n\ndjango.db.utils.OperationalError: \nProblem installing fixture '/home/hdknr/ve/v17/src/sample/web/todos/fixtures/initial_data.json': \nCould not load contenttypes.ContentType(pk=1): no such table: django_content_type\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u3042\u3063\u3066\u3082\u30a8\u30e9\u30fc:\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ mv todos/fixtures/initial_data.json  .\n(v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py test todos\n\n....\n\ndjango.db.utils.OperationalError: \nProblem installing fixture '/home/hdknr/ve/v17/src/sample/web/initial_data.json': \nCould not load contenttypes.ContentType(pk=1): no such table: django_content_type\n\n\u3088\u3063\u3066, initial_data.json \u306f\u4f7f\u308f\u306a\u3044\u3067loadata \u3067\u660e\u793a\u7684\u306b\u30ed\u30fc\u30c9\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u306e\u3060\u308d\u3046\u304b\u3002\n\nTransactionTestCase\nTODO:\nTransactionTestCase\u3092\u3064\u304b\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u306a\u3044\u306e\u3067\u3042\u3068\u3067\u8abf\u3079\u308b\n\n\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8:\nTest rollback behavior is different for apps with migrations; in particular, \nDjango will no longer emulate rollbacks on non-transactional databases \nor inside TransactionTestCase unless specifically requested.\n\nRollback emulation:\nAny initial data loaded in migrations will only be available in TestCase tests \nand not in TransactionTestCase tests, \nand additionally only on backends \nwhere transactions are supported (the most important exception being MyISAM).\n\nDjango can reload that data for you on a per-testcase basis \nby setting the serialized_rollback option to True \nin the body of the TestCase or TransactionTestCase, \nbut note that this will slow down that test suite by approximately 3x.\n\nThird-party apps or those developing against MyISAM will need to set this; \nin general, however, \nyou should be developing your own projects against a transactional database \nand be using TestCase for most tests, and thus not need this setting.\n\nThe initial serialization is usually very quick, \nbut if you wish to exclude some apps from this process \n(and speed up test runs slightly), \nyou may add those apps to TEST_NON_SERIALIZED_APPS.\n\nApps without migrations are not affected; \ninitial_data fixtures are reloaded as usual.\n\n\n\u4f9d\u5b58\n\u30a2\u30d7\u30ea\u304c\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f9d\u5b58\u3059\u308b\u306a\u3089\u3070\u3001\n\u304b\u306a\u3089\u305a\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6301\u3064\u3088\u3046\u306b\u3059\u308b\u4e8b\u3002\nIt is not advised to have apps \nwithout migrations depend on \n(have a ForeignKey or ManyToManyField to) apps with migrations. \n\nRead the dependencies documentation for more.\n\n\n\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\n\n\nSouth\nsouth\u304b\u3089\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3002\n\n\n\u7c21\u5358 (\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9)\n\nSouth\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u6700\u65b0\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n'south' \u3092INSTALLED_APPS\u304b\u3089\u524a\u9664\nmigrations\u914d\u4e0b\u306e\u6570\u5b57\u3067\u59cb\u307e\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3002init.py\u306f\u6b8b\u3059\u3002.pyc\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3002\nmakemigrations \u3092\u5b9f\u884c\u3002 \nmigrate \u3092\u5b9f\u884c\u3002\n\n\n\n\n- https://docs.djangoproject.com/en/1.7/releases/1.7/#schema-migrations\n\n# \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u521d\u671f\u5316 #\n\nstartproject:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample$ mkdir -p web; django-admin.py startproject app web ;cd web\n    \n\nmigrate & createsuperuser :\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\n    Operations to perform:\n      Apply all migrations: admin, contenttypes, auth, sessions\n    Running migrations:\n      Applying contenttypes.0001_initial... OK\n      Applying auth.0001_initial... OK\n      Applying admin.0001_initial... OK\n      Applying sessions.0001_initial... OK\n\n    \n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py createsuperuser\n    Username (leave blank to use 'hdknr'): admin\n    Email address: admin@admin.admin\n    Password: \n    Password (again): \n    Superuser created successfully.\n\n\nsyncdb\u3082\u4e00\u5fdc\u4f7f\u3048\u308b:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ rm db.sqlite3 ; python manage.py syncdb\n    Operations to perform:\n      Apply all migrations: admin, contenttypes, auth, sessions\n    Running migrations:\n      Applying contenttypes.0001_initial... OK\n      Applying auth.0001_initial... OK\n      Applying admin.0001_initial... OK\n      Applying sessions.0001_initial... OK\n    \n    You have installed Django's auth system, and don't have any superusers defined.\n    Would you like to create one now? (yes/no): yes\n    Username (leave blank to use 'hdknr'): admin\n    Email address: admin@admin.admin\n    Password: \n    Password (again): \n    Superuser created successfully.\n    \n\n# \u30e2\u30c7\u30eb\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3 #\n\nmakemigrations:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations \n    No changes detected\n\n\u30a2\u30d7\u30ea\u8ffd\u52a0\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py startapp todos\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree todos/\n    todos/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 admin.py\n    \u251c\u2500\u2500 migrations\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 models.py\n    \u251c\u2500\u2500 tests.py\n    \u2514\u2500\u2500 views.py\n    \n    1 directory, 6 files\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"INSTALLED_APPS += ('todos',)\" >> app/settings.py\n\n\u30e2\u30c7\u30eb\u30af\u30e9\u30b9\u7121\u3044\u306e\u3067\u8ffd\u52a0:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations\n    No changes detected\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ cat todos/models.py\n\n    from django.db import models\n    from django.contrib.auth.models import User\n    \n    \n    class Todo(models.Model):\n        user = models.ForeignKey(User)\n        title = models.CharField(max_length=50)\n        description = models.TextField()\n        due_at = models.DateTimeField(\n            null=True, blank=True, default=None)\n        created_at = models.DateTimeField(auto_now_add=True, )\n        updated_at = models.DateTimeField(auto_now=True, )\n\n\nmakemigrations:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations todos\n\n    Migrations for 'todos':\n      0001_initial.py:\n        - Create model Todo\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree todos/\n\n    todos/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 __init__.pyc\n    \u251c\u2500\u2500 admin.py\n    \u251c\u2500\u2500 admin.pyc\n    \u251c\u2500\u2500 migrations\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 0001_initial.py\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 __init__.pyc\n    \u251c\u2500\u2500 models.py\n    \u251c\u2500\u2500 models.pyc\n    \u251c\u2500\u2500 tests.py\n    \u2514\u2500\u2500 views.py\n    \n    1 directory, 11 files\n        \nmigrate:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\n    Operations to perform:\n      Apply all migrations: todos\n    Running migrations:\n      Applying todos.0001_initial... OK        \n\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \".schema todos_todo\" | python manage.py dbshell\n\n    CREATE TABLE \"todos_todo\" (\n        \"id\" integer NOT NULL PRIMARY KEY AUTOINCREMENT, \n        \"title\" varchar(50) NOT NULL, \n        \"description\" text NOT NULL, \n        \"due_at\" datetime NULL, \n        \"created_at\" datetime NOT NULL, \n        \"updated_at\" datetime NOT NULL, \n        \"user_id\" integer NOT NULL REFERENCES \"auth_user\" (\"id\"));\n\n    CREATE INDEX todos_todo_e8701ad4 ON \"todos_todo\" (\"user_id\");\n    \n## django_migrations #\n\n\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u30c6\u30fc\u30d6\u30eb:\n\n    $ echo \".schema django_migrations\" | python manage.py dbshell\n\n    CREATE TABLE \"django_migrations\" (\n        \"id\" integer NOT NULL PRIMARY KEY AUTOINCREMENT, \n        \"app\" varchar(255) NOT NULL, \n        \"name\" varchar(255) NOT NULL, \n        \"applied\" datetime NOT NULL);\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select * from django_migrations;\" | python manage.py dbshell\n\n    1|contenttypes|0001_initial|2014-09-03 02:10:35.695671\n    2|auth|0001_initial|2014-09-03 02:10:35.744375\n    3|admin|0001_initial|2014-09-03 02:10:35.788881\n    4|sessions|0001_initial|2014-09-03 02:10:35.808466\n    5|todos|0001_initial|2014-09-03 02:10:35.855269\n    6|todos|0002_todo_closed|2014-09-03 02:11:12.687727\n\n\u30e2\u30b8\u30e5\u30fc\u30eb:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ tree $VIRTUAL_ENV/lib/python2.7/site-packages/django/db/migrations/ -I \"*.pyc\"\n    /home/hdknr/ve/v17/lib/python2.7/site-packages/django/db/migrations/\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 autodetector.py\n    \u251c\u2500\u2500 executor.py\n    \u251c\u2500\u2500 graph.py\n    \u251c\u2500\u2500 loader.py\n    \u251c\u2500\u2500 migration.py\n    \u251c\u2500\u2500 operations\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 base.py\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 fields.py\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 models.py\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 special.py\n    \u251c\u2500\u2500 optimizer.py\n    \u251c\u2500\u2500 questioner.py\n    \u251c\u2500\u2500 recorder.py\n    \u251c\u2500\u2500 state.py\n    \u2514\u2500\u2500 writer.py\n    \n    1 directory, 16 files\n\nshell\u304b\u3089:\n\n    >>> from django.db.migrations.recorder import *\n    >>> for i in MigrationRecorder.Migration.objects.values():\n    ...     print i\n    ... \n    {'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 695671, tzinfo=<UTC>), 'app': u'contenttypes', u'id': 1, 'name': u'0001_initial'}\n    {'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 744375, tzinfo=<UTC>), 'app': u'auth', u'id': 2, 'name': u'0001_initial'}\n    {'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 788881, tzinfo=<UTC>), 'app': u'admin', u'id': 3, 'name': u'0001_initial'}\n    {'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 808466, tzinfo=<UTC>), 'app': u'sessions', u'id': 4, 'name': u'0001_initial'}\n    {'applied': datetime.datetime(2014, 9, 3, 2, 10, 35, 855269, tzinfo=<UTC>), 'app': u'todos', u'id': 5, 'name': u'0001_initial'}\n    {'applied': datetime.datetime(2014, 9, 3, 2, 11, 12, 687727, tzinfo=<UTC>), 'app': u'todos', u'id': 6, 'name': u'0002_todo_closed'}\n\n\n# pre_migrate/ post_migrate #\n\ntodos/models.py \u4fee\u6b63:\n\n    \n    from django.dispatch import receiver\n    from django.db.models.signals import (\n        pre_migrate, post_migrate,\n    )\n    \n    \n    def trace(msg, sender, app_config, *args, **kwargs):\n        assert sender == app_config\n        assert args == ()\n        if app_config and app_config.name == \"todos\":\n            print msg \n            for k, v in kwargs.items():\n                print \"***\", k, type(v), v\n    \n    \n    @receiver(pre_migrate)\n    def pre_migrate_handler(\n        sender=None, app_config=None, *args, **kwargs\n    ):\n        trace(\n            \">>> pre_migrate signal\",\n            sender, app_config, *args, **kwargs)\n    \n    \n    @receiver(post_migrate)\n    def post_migrate_handler(\n        sender=None, app_config=None, *args, **kwargs\n    ):\n        trace(\n            \">>> post_migrate signal\",\n            sender, app_config, *args, **kwargs)\n    \n    \n    class Todo(models.Model):\n        closed = models.BooleanField(default=False)\n        ....    \n\nmakemigrations & migrate:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py makemigrations todos\n\n    Migrations for 'todos':\n      0002_todo_closed.py:\n        - Add field closed to todo\n    \n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\n\n    Operations to perform:\n      Apply all migrations: todos\n    Running migrations:\n      Applying todos.0002_todo_closed... OK\n    >>> post_migrate signal\n    *** using <type 'str'> default\n    *** verbosity <type 'int'> 1\n    *** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x25ba110>\n    *** interactive <type 'bool'> True\n\n# Database router \u306e allow_migrate\u30e1\u30bd\u30c3\u30c9 #\n\nallow_syncdb -> allow_migrate\u306e\u5909\u66f4\u3002\n\n\u65e2\u5b58\u306eXOOPS\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u8aad\u3080\u3088\u3046\u306broute\u3092\u8a2d\u5b9a:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ more app/database.py\n\n    _EXCLUSIVE = lambda obj: \\\n        {\"xoops\": \"xoops\"}.get(obj._meta.app_label, 'default')\n    \n    \n    class SitesRouter(object):\n    \n        def db_for_read(self, model, **hints):\n            return _EXCLUSIVE(model)\n    \n        def db_for_write(self, model, **hints):\n            return _EXCLUSIVE(model)\n    \n        def allow_relation(self, obj1, obj2, **hints):\n            d1, d2 = _EXCLUSIVE(obj1), _EXCLUSIVE(obj2)\n    \n            return None if d1 != d2 else d1\n    \n        def allow_migrate(self, db, model):\n            ''' allow_syncdb -> allow_migrate '''\n            return _EXCLUSIVE(model)\n\napp/settings.py:\n\n    INSTALLED_APPS += ('todos', 'xoops',)\n    #\n    DATABASES['xoops'] = {\n        'ENGINE': 'django.db.backends.mysql',\n        'NAME': os.environ['XOOPS_DBNAME'],\n        'USER': os.environ['XOOPS_DBUSER'],\n        'PASSWORD': os.environ['XOOPS_DBPASSWORD'],\n        'TEST_CHARSET': 'utf8',\n        'TEST_DATABASE_COLLATION': 'utf8_general_ci',\n    }\n    DATABASE_ROUTERS = ['app.database.SitesRouter']\n   \n\nmigrate\u3057\u3066\u307f\u308b:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\n\n    Operations to perform:\n      Synchronize unmigrated apps: xoops\n      Apply all migrations: admin, contenttypes, todos, auth, sessions\n    Synchronizing apps without migrations:\n\n    >>> pre_migrate signal\n    *** using <type 'str'> default\n    *** verbosity <type 'int'> 1\n    *** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x27a4190>\n    *** interactive <type 'bool'> True\n\n      Creating tables...\n      Installing custom SQL...\n      Installing indexes...\n    Running migrations:\n      No migrations to apply.\n\n    >>> post_migrate signal\n    *** using <type 'str'> default\n    *** verbosity <type 'int'> 1\n    *** signal <class 'django.dispatch.dispatcher.Signal'> <django.dispatch.dispatcher.Signal object at 0x27a41d0>\n    *** interactive <type 'bool'> True\n     \n\n# initial_data.json #\n\n\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8:\n\n    initial_data fixtures are no longer loaded for apps with migrations; \n    if you want to load initial data for an app, we suggest you do it in a migration.\n\n\ninitial_data.json:\n   \n    [{\"fields\": {\"description\": \"task1\", \"title\": \"task1\", \n      \"due_at\": null, \"created_at\": \"2014-09-03T03:10:37.059Z\", \n      \"updated_at\": \"2014-09-03T03:10:37.059Z\", \"user\": 1, \"closed\": false}, \n      \"model\": \"todos.todo\", \"pk\": 1}] \n\n\u524a\u9664:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"delete from todos_todo;\" | python  manage.py dbshell\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n    0\n\ntodos\u3092migrate:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate todos\n    Operations to perform:\n      Apply all migrations: todos\n    Running migrations:\n      No migrations to apply.\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n    0\n    \n\n\u5168\u4f53:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\n    Operations to perform:\n      Synchronize unmigrated apps: xoops\n      Apply all migrations: admin, contenttypes, todos, auth, sessions\n    Synchronizing apps without migrations:\n      Creating tables...\n      Installing custom SQL...\n      Installing indexes...\n    Installed 1 object(s) from 1 fixture(s)\n    Running migrations:\n      No migrations to apply.\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ echo \"select count(*) from todos_todo;\" | python manage.py dbshell\n    1\n\ntodos/fixtures/initial_data.json:\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py dumpdata  > todos/fixtures/initial_data.json\n\n\nmigrate\u3067\u8aad\u307e\u306a\u3044\uff1a\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py migrate\n    Operations to perform:\n      Apply all migrations: admin, contenttypes, todos, auth, sessions\n    Running migrations:\n      No migrations to apply.\n\ntests\u3060\u3068\u8aad\u307e\u308c\u308b\u304c\u3001\u30c6\u30fc\u30d6\u30eb\u304c\u7121\u3044\u306e\u3067\u30a8\u30e9\u30fc:\n\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py test todos\n\n    ....\n    \n    django.db.utils.OperationalError: \n    Problem installing fixture '/home/hdknr/ve/v17/src/sample/web/todos/fixtures/initial_data.json': \n    Could not load contenttypes.ContentType(pk=1): no such table: django_content_type\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u3042\u3063\u3066\u3082\u30a8\u30e9\u30fc:\n\n\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ mv todos/fixtures/initial_data.json  .\n    (v17)hdknr@wzy:~/ve/v17/src/sample/web$ python manage.py test todos\n\n    ....\n    \n    django.db.utils.OperationalError: \n    Problem installing fixture '/home/hdknr/ve/v17/src/sample/web/initial_data.json': \n    Could not load contenttypes.ContentType(pk=1): no such table: django_content_type\n\n\n\u3088\u3063\u3066, initial_data.json \u306f\u4f7f\u308f\u306a\u3044\u3067loadata \u3067\u660e\u793a\u7684\u306b\u30ed\u30fc\u30c9\u3057\u305f\u307b\u3046\u304c\u3044\u3044\u306e\u3060\u308d\u3046\u304b\u3002\n\n\n\n# TransactionTestCase #\n\nTODO:\n    \n    TransactionTestCase\u3092\u3064\u304b\u3063\u305f\u3053\u3068\u306a\u3044\u306e\u306a\u3044\u306e\u3067\u3042\u3068\u3067\u8abf\u3079\u308b\n\n\u30ea\u30ea\u30fc\u30b9\u30ce\u30fc\u30c8:\n\n    Test rollback behavior is different for apps with migrations; in particular, \n    Django will no longer emulate rollbacks on non-transactional databases \n    or inside TransactionTestCase unless specifically requested.\n\n\n[Rollback emulation](https://docs.djangoproject.com/en/1.7/topics/testing/overview/#test-case-serialized-rollback):\n\n    Any initial data loaded in migrations will only be available in TestCase tests \n    and not in TransactionTestCase tests, \n    and additionally only on backends \n    where transactions are supported (the most important exception being MyISAM).\n\n    Django can reload that data for you on a per-testcase basis \n    by setting the serialized_rollback option to True \n    in the body of the TestCase or TransactionTestCase, \n    but note that this will slow down that test suite by approximately 3x.\n\n    Third-party apps or those developing against MyISAM will need to set this; \n    in general, however, \n    you should be developing your own projects against a transactional database \n    and be using TestCase for most tests, and thus not need this setting.\n\n    The initial serialization is usually very quick, \n    but if you wish to exclude some apps from this process \n    (and speed up test runs slightly), \n    you may add those apps to TEST_NON_SERIALIZED_APPS.\n\n    Apps without migrations are not affected; \n    initial_data fixtures are reloaded as usual.\n\n\n# \u4f9d\u5b58 #\n\n\u30a2\u30d7\u30ea\u304c\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u3042\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f9d\u5b58\u3059\u308b\u306a\u3089\u3070\u3001\n\u304b\u306a\u3089\u305a\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6301\u3064\u3088\u3046\u306b\u3059\u308b\u4e8b\u3002\n\n    It is not advised to have apps \n    without migrations depend on \n    (have a ForeignKey or ManyToManyField to) apps with migrations. \n\n    Read the dependencies documentation for more.\n\n- [\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](https://docs.djangoproject.com/en/1.7/topics/migrations/#unmigrated-dependencies)\n\n# South #\n\nsouth\u304b\u3089\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3002\n\n\n- [\u7c21\u5358](https://docs.djangoproject.com/en/1.7/topics/migrations/#upgrading-from-south) ([\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9](http://south.readthedocs.org/en/latest/releasenotes/1.0.html#library-migration-path))\n\n\n    - South\u306e\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u6700\u65b0\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\n    - 'south' \u3092INSTALLED_APPS\u304b\u3089\u524a\u9664\n    - migrations\u914d\u4e0b\u306e\u6570\u5b57\u3067\u59cb\u307e\u308b\u30d5\u30a1\u30a4\u30eb\u3092\u524a\u9664\u3002__init__.py\u306f\u6b8b\u3059\u3002.pyc\u30d5\u30a1\u30a4\u30eb\u306f\u524a\u9664\u3002\n    - makemigrations \u3092\u5b9f\u884c\u3002 \n    - migrate \u3092\u5b9f\u884c\u3002\n", "tags": ["Django"]}