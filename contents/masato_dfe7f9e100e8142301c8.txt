{"context": " More than 1 year has passed since last update.IoT\u306e\u305f\u3081\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306eMeshblu\u3092\u4f7f\u3044\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306bDocker Compose\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002Meshblu\u306fOctoblu\u304c\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3067\u958b\u767a\u3092\u3057\u3066\u3044\u307e\u3059\u3002MQTT\u3001HTTP REST\u3001WebSocket\u3001CoAP\u306a\u3069\u8907\u6570\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u3063\u3066\u76f8\u4e92\u306b\u30d6\u30ea\u30c3\u30b8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070Raspberry Pi\u304b\u3089MQTT\u3067publish\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u304b\u3089WebSocket\u3067subscribe\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u304c\u3067\u304d\u307e\u3059\u3002MQTT\u306esubscribe\u306b\u5bfe\u3057\u3066REST API\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u3055\u307e\u3056\u307e\u306a\u30c7\u30d0\u30a4\u30b9\u3084\u30b5\u30fc\u30d3\u30b9\u3092\u9023\u4fc2\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nUbuntu 14.04\u306eDocker\u30db\u30b9\u30c8\u3092\u65b0\u3057\u304f\u7528\u610f\u3057\u307e\u3059\u3002GitHub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089clone\u3059\u308b\u306e\u3067\u6700\u521d\u306bGit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ sudo apt-get update && sudo apt-get install -y git\n\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089git clone\u3057\u307e\u3059\u3002\n$ mkdir ~/iot_apps && cd ~/iot_apps\n$ git clone https://github.com/IDCFChannel/meshblu-compose\n\nclone\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066bootstrap\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002Meshblu\u306e\u30d3\u30eb\u30c9\u3084MongoDB\u3001Redis\u3001OpenResty\u306a\u3069\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u81ea\u52d5\u7684\u306b\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ cd meshblu-compose\n$ ./bootstrap.sh\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u78ba\u8a8d\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3059\u308b\u3068docker-compose ps\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u304c4\u3064\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n$ docker-compose ps\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 80/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n\nDocker\u3068Docker Compose\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n$ docker version\nClient version: 1.7.0\n...\n$ docker-compose --version\ndocker-compose version: 1.3.1\n\nDocker\u30db\u30b9\u30c8\u306ecurl\u30b3\u30de\u30f3\u30c9\u304b\u3089Mesublu\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ curl --insecure https://localhost/status\n{\"meshblu\":\"online\"}\n\nDocker\u30db\u30b9\u30c8\u304c\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306b\u3042\u308b\u5834\u5408\u306f\u3001\u5916\u90e8\u304b\u3089\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3067\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u4eca\u56de\u306fHTTPS\u3068MQTT\u3092\u4f7f\u3046\u305f\u3081443\u30681883\u306e\u30dd\u30fc\u30c8\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n$ curl --insecure https://xxx.xxx.xxx.xxx/status\n{\"meshblu\":\"online\"}\n\n\n\u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3068\u518d\u8d77\u52d5\n\u505c\u6b62\u72b6\u614b\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306fOpenResty\u30b5\u30fc\u30d3\u30b9\u3092up\u30b3\u30de\u30f3\u30c9\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ docker-compose up -d openresty\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u304d\u306frestart\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n$ docker-compose restart\n\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\n\u306f\u3058\u3081\u306biotutil\u30b5\u30fc\u30d3\u30b9\u306eregister\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u3059\u3079\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u308b\u30de\u30b9\u30bf\u30fc\u306eowner\u30c7\u30d0\u30a4\u30b9\u3068\u3001action-*\u30925\u3064\u3001trigger-*\u30925\u3064\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil register\n> iotutil@0.0.1 start /app\n> node app.js \"register\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 052cb87a           \u2502 bfbe30e3-18af-4f79-97d8-3c70744e5dc5 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\u304c\u7d42\u4e86\u3059\u308b\u3068owner\u30c7\u30d0\u30a4\u30b9\u306e\u8a8d\u8a3c\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3082\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n$ docker-compose run --rm iotutil owner\n\n> iotutil@0.0.1 start /app\n> node app.js \"owner\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 052cb87a           \u2502 bfbe30e3-18af-4f79-97d8-3c70744e5dc5 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8a31\u53ef\u3059\u308b\n\u672b\u5c3e\u306e\u756a\u53f7\u304c\u540c\u3058\u756a\u53f7\u306e\u5834\u5408\u306f\u3001trigger-*\u304b\u3089action-*\u3078\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002(\u4f8b: trigger-1\u304b\u3089action-1)\u3002\u4efb\u610f\u306e\u30c7\u30d0\u30a4\u30b9\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070action-1\u304b\u3089trigger-3\u3078\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil whiten -- -f action-1 -t trigger-3\n\n> iotutil@0.0.1 start /app\n> node app.js \"whiten\" \"-f\" \"action-1\" \"-t\" \"trigger-3\"\n\naction-1 can send message to trigger-3\n\n\nCLI\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u306eUUID\u3092\u53d6\u5f97\u3059\u308b\niotutil\u30b5\u30fc\u30d3\u30b9\u306elist\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n$ docker-compose run --rm iotutil list\n\n> iotutil@0.0.1 start /app\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 bfdc54e3 \u2502 8383dee6-31d5-43d0-aee7-4abc21aa19c2 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-2 \u2502 18b0ee41 \u2502 a32d604e-b9e3-4584-9f10-30d2925d634d \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-3 \u2502 701fc8da \u2502 5cee22da-b9c0-4746-8876-4017ca0d8cf0 \u2502\n...\n\nshow\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u500b\u5225\u306e\u30c7\u30d0\u30a4\u30b9\u306e\u60c5\u5831\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil show -- --keyword action-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"--keyword\" \"action-3\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword  \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1 \u2502 b6716f76 \u2502 32d85553-b41d-4a62-8828-b5f1187768ee \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\nAPI\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u306eUUID\u3092\u53d6\u5f97\u3059\u308b\nowner\u30c7\u30d0\u30a4\u30b9\u306e\u5834\u5408\u306f\u3001/owner/uuid\u3001\u901a\u5e38\u306e\u30c7\u30d0\u30a4\u30b9\u306f/device/uuid\u306b\u5bfe\u3057\u3066\u30af\u30a8\u30ea\u6587\u5b57\u5217\u306bkeyword\u3068token\u3092\u6e21\u3057\u3066HTTP GET\u3057\u307e\u3059\u3002\n$ curl --insecure \"https://xxx.xxx.xxx.xxx/owner/uuid?token=052cb87a&keyword=owner\"\n{\"uuid\":\"bfbe30e3-18af-4f79-97d8-3c70744e5dc5\"}\n\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u524a\u9664\ndel\u30b3\u30de\u30f3\u30c9\u3067\u767b\u9332\u3057\u3066\u3042\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u3059\u3079\u3066\u524a\u9664\u3057\u307e\u3059\u3002\u524a\u9664\u5f8c\u306fregiser\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c7\u30d0\u30a4\u30b9\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ docker-compose run --rm iotutil del\n\n> iotutil@0.0.1 start /app\n> node app.js \"del\"\n\nare you sure?: [Yn]:  Y\ntrigger-1, trigger-2, trigger-3, trigger-4, trigger-5, action-1, action-2, action-3, action-4, action-5, owner are deleted.\n\n\nIoT\u306e\u305f\u3081\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e[Meshblu](https://github.com/octoblu/meshblu/)\u3092\u4f7f\u3044\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306bDocker Compose\u306b\u307e\u3068\u3081\u307e\u3057\u305f\u3002Meshblu\u306f[Octoblu](https://octoblu.com/)\u304c\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3067\u958b\u767a\u3092\u3057\u3066\u3044\u307e\u3059\u3002MQTT\u3001HTTP REST\u3001WebSocket\u3001CoAP\u306a\u3069\u8907\u6570\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u3063\u3066\u76f8\u4e92\u306b\u30d6\u30ea\u30c3\u30b8\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u4f8b\u3048\u3070Raspberry Pi\u304b\u3089MQTT\u3067publish\u3057\u3066\u3001\u30d6\u30e9\u30a6\u30b6\u304b\u3089WebSocket\u3067subscribe\u3059\u308b\u3068\u3044\u3063\u305f\u4f7f\u3044\u65b9\u304c\u3067\u304d\u307e\u3059\u3002MQTT\u306esubscribe\u306b\u5bfe\u3057\u3066REST API\u304b\u3089\u30e1\u30c3\u30bb\u30fc\u30b8\u3092POST\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\u306e\u3067\u3001\u3055\u307e\u3056\u307e\u306a\u30c7\u30d0\u30a4\u30b9\u3084\u30b5\u30fc\u30d3\u30b9\u3092\u9023\u4fc2\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n<!-- more -->\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nUbuntu 14.04\u306eDocker\u30db\u30b9\u30c8\u3092\u65b0\u3057\u304f\u7528\u610f\u3057\u307e\u3059\u3002GitHub\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u304b\u3089clone\u3059\u308b\u306e\u3067\u6700\u521d\u306bGit\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```sh\n$ sudo apt-get update && sudo apt-get install -y git\n```\n\n\u9069\u5f53\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b[\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/IDCFChannel/meshblu-compose)\u304b\u3089`git clone`\u3057\u307e\u3059\u3002\n\n```sh\n$ mkdir ~/iot_apps && cd ~/iot_apps\n$ git clone https://github.com/IDCFChannel/meshblu-compose\n```\n\nclone\u3057\u305f\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\u3057\u3066bootstrap\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002Meshblu\u306e\u30d3\u30eb\u30c9\u3084MongoDB\u3001Redis\u3001OpenResty\u306a\u3069\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u81ea\u52d5\u7684\u306b\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```sh\n$ cd meshblu-compose\n$ ./bootstrap.sh\n```\n\n### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u78ba\u8a8d\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u6210\u529f\u3059\u308b\u3068`docker-compose ps`\u30b3\u30de\u30f3\u30c9\u306e\u7d50\u679c\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u30b3\u30f3\u30c6\u30ca\u304c4\u3064\u8d77\u52d5\u3057\u307e\u3057\u305f\u3002\n\n```sh\n$ docker-compose ps\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 80/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up                 0.0.0.0:443->443\npenresty_1         inx/nginx.conf                        /tcp, 0.0.0.0:80\n                                                         ->80/tcp\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n```\n\nDocker\u3068Docker Compose\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash\n$ docker version\nClient version: 1.7.0\n...\n$ docker-compose --version\ndocker-compose version: 1.3.1\n```\n\nDocker\u30db\u30b9\u30c8\u306ecurl\u30b3\u30de\u30f3\u30c9\u304b\u3089Mesublu\u30b5\u30fc\u30d0\u30fc\u304c\u8d77\u52d5\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```sh\n$ curl --insecure https://localhost/status\n{\"meshblu\":\"online\"}\n```\n\nDocker\u30db\u30b9\u30c8\u304c\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4e0a\u306b\u3042\u308b\u5834\u5408\u306f\u3001\u5916\u90e8\u304b\u3089\u30d1\u30d6\u30ea\u30c3\u30afIP\u30a2\u30c9\u30ec\u30b9\u3067\u63a5\u7d9a\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u30d5\u30a1\u30a4\u30a2\u30a6\u30a9\u30fc\u30eb\u3068\u30dd\u30fc\u30c8\u30d5\u30a9\u30ef\u30fc\u30c9\u306e\u8a2d\u5b9a\u3092\u3057\u3066\u304a\u304d\u307e\u3059\u3002\u4eca\u56de\u306fHTTPS\u3068MQTT\u3092\u4f7f\u3046\u305f\u3081`443`\u3068`1883`\u306e\u30dd\u30fc\u30c8\u304c\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```sh\n$ curl --insecure https://xxx.xxx.xxx.xxx/status\n{\"meshblu\":\"online\"}\n```\n\n## \u30b5\u30fc\u30d0\u30fc\u306e\u8d77\u52d5\u3068\u518d\u8d77\u52d5\n\n\u505c\u6b62\u72b6\u614b\u304b\u3089\u30b5\u30fc\u30d3\u30b9\u3092\u8d77\u52d5\u3059\u308b\u3068\u304d\u306fOpenResty\u30b5\u30fc\u30d3\u30b9\u3092`up`\u30b3\u30de\u30f3\u30c9\u304b\u3089\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose up -d openresty\n```\n\n\u30b5\u30fc\u30d3\u30b9\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u304d\u306f`restart`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```bash\n$ docker-compose restart\n```\n\n## \u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\n\n\u306f\u3058\u3081\u306b`iotutil`\u30b5\u30fc\u30d3\u30b9\u306e`register`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u521d\u671f\u8a2d\u5b9a\u3092\u884c\u3044\u307e\u3059\u3002\u3059\u3079\u3066\u306e\u30c7\u30d0\u30a4\u30b9\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u4fe1\u3067\u304d\u308b\u30de\u30b9\u30bf\u30fc\u306e`owner`\u30c7\u30d0\u30a4\u30b9\u3068\u3001`action-*`\u30925\u3064\u3001`trigger-*`\u30925\u3064\u30b3\u30de\u30f3\u30c9\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil register\n> iotutil@0.0.1 start /app\n> node app.js \"register\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 052cb87a           \u2502 bfbe30e3-18af-4f79-97d8-3c70744e5dc5 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n\u30c7\u30d0\u30a4\u30b9\u306e\u767b\u9332\u304c\u7d42\u4e86\u3059\u308b\u3068`owner`\u30c7\u30d0\u30a4\u30b9\u306e\u8a8d\u8a3c\u60c5\u5831\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u3082\u78ba\u8a8d\u304c\u3067\u304d\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil owner\n\n> iotutil@0.0.1 start /app\n> node app.js \"owner\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword \u2502 meshblu_auth_token \u2502 meshblu_auth_uuid                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 owner   \u2502 052cb87a           \u2502 bfbe30e3-18af-4f79-97d8-3c70744e5dc5 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### \u30c7\u30d0\u30a4\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8a31\u53ef\u3059\u308b\n\n\u672b\u5c3e\u306e\u756a\u53f7\u304c\u540c\u3058\u756a\u53f7\u306e\u5834\u5408\u306f\u3001`trigger-*`\u304b\u3089`action-*`\u3078\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u9001\u4fe1\u3067\u304d\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002(\u4f8b: trigger-1\u304b\u3089action-1)\u3002\u4efb\u610f\u306e\u30c7\u30d0\u30a4\u30b9\u9593\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3059\u308b\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070action-1\u304b\u3089trigger-3\u3078\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u9001\u4fe1\u3092\u8a31\u53ef\u3057\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil whiten -- -f action-1 -t trigger-3\n\n> iotutil@0.0.1 start /app\n> node app.js \"whiten\" \"-f\" \"action-1\" \"-t\" \"trigger-3\"\n\naction-1 can send message to trigger-3\n```\n\n## CLI\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u306eUUID\u3092\u53d6\u5f97\u3059\u308b\n\n`iotutil`\u30b5\u30fc\u30d3\u30b9\u306e`list`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u767b\u9332\u3055\u308c\u3066\u3044\u308b\u30c7\u30d0\u30a4\u30b9\u60c5\u5831\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil list\n\n> iotutil@0.0.1 start /app\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword   \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-1 \u2502 bfdc54e3 \u2502 8383dee6-31d5-43d0-aee7-4abc21aa19c2 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-2 \u2502 18b0ee41 \u2502 a32d604e-b9e3-4584-9f10-30d2925d634d \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 trigger-3 \u2502 701fc8da \u2502 5cee22da-b9c0-4746-8876-4017ca0d8cf0 \u2502\n...\n```\n\n`show`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u500b\u5225\u306e\u30c7\u30d0\u30a4\u30b9\u306e\u60c5\u5831\u3092\u8868\u793a\u3057\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil show -- --keyword action-1\n\n> iotutil@0.0.1 start /app\n> node app.js \"show\" \"--keyword\" \"action-3\"\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 keyword  \u2502 token    \u2502 uuid                                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 action-1 \u2502 b6716f76 \u2502 32d85553-b41d-4a62-8828-b5f1187768ee \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### API\u304b\u3089\u30c7\u30d0\u30a4\u30b9\u306eUUID\u3092\u53d6\u5f97\u3059\u308b\n\n`owner`\u30c7\u30d0\u30a4\u30b9\u306e\u5834\u5408\u306f\u3001`/owner/uuid`\u3001\u901a\u5e38\u306e\u30c7\u30d0\u30a4\u30b9\u306f`/device/uuid`\u306b\u5bfe\u3057\u3066\u30af\u30a8\u30ea\u6587\u5b57\u5217\u306b`keyword`\u3068`token`\u3092\u6e21\u3057\u3066HTTP GET\u3057\u307e\u3059\u3002\n\n```sh\n$ curl --insecure \"https://xxx.xxx.xxx.xxx/owner/uuid?token=052cb87a&keyword=owner\"\n{\"uuid\":\"bfbe30e3-18af-4f79-97d8-3c70744e5dc5\"}\n```\n\n## \u30c7\u30d0\u30a4\u30b9\u306e\u524a\u9664\n\n`del`\u30b3\u30de\u30f3\u30c9\u3067\u767b\u9332\u3057\u3066\u3042\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u3059\u3079\u3066\u524a\u9664\u3057\u307e\u3059\u3002\u524a\u9664\u5f8c\u306f`regiser`\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u30c7\u30d0\u30a4\u30b9\u3092\u518d\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```sh\n$ docker-compose run --rm iotutil del\n\n> iotutil@0.0.1 start /app\n> node app.js \"del\"\n\nare you sure?: [Yn]:  Y\ntrigger-1, trigger-2, trigger-3, trigger-4, trigger-5, action-1, action-2, action-3, action-4, action-5, owner are deleted.\n```\n", "tags": ["Meshblu", "IDCF\u30af\u30e9\u30a6\u30c9", "RaspberryPi", "IoT", "mqtt"]}