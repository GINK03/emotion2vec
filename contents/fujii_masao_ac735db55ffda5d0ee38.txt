{"context": " More than 1 year has passed since last update.\u6574\u6570\u578b\u306e id \u5217\u3068\u6587\u5b57\u5217\u578b\u306e name \u5217\u3092\u6301\u3064 hoge \u30c6\u30fc\u30d6\u30eb\u306b\u3064\u3044\u3066\u3001\u5f15\u6570\u306e\u6570\u5024\u306b id \u5217\u304c\u4e00\u81f4\u3059\u308b\u884c\u3092\u3059\u3079\u3066\u8fd4\u5374\u3059\u308b\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\nPL/SQL\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\nCREATE TABLE hoge (id INTEGER, name VARCHAR2(64));\nINSERT INTO hoge VALUES (1, 'one');\nINSERT INTO hoge VALUES (1, 'first');\nINSERT INTO hoge VALUES (2, 'two');\nINSERT INTO hoge VALUES (3, 'three');\nINSERT INTO hoge VALUES (4, 'four');\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u306e\u4f5c\u6210\nCREATE TYPE HogeRowType IS OBJECT (id INTEGER, name VARCHAR2(64));\n/\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u3092\u8981\u7d20\u3068\u3059\u308b\u30cd\u30b9\u30c8\u3057\u305f\u8868\u3092\u4f5c\u6210\nCREATE TYPE HogeRowArrayType IS TABLE OF HogeRowType;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1 (\u30cd\u30b9\u30c8\u3057\u305f\u8868\u306b\u7d50\u679c\u3092\u6e9c\u3081\u8fbc\u3093\u3067\u4e00\u5ea6\u306b\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl (x INTEGER)\n  RETURN HogeRowArrayType\nIS\n  ret HogeRowArrayType := HogeRowArrayType();\n  i INTEGER;\nBEGIN\n  i := 1;\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    ret.EXTEND;\n    ret(i) := HogeRowType(row.id, row.name);\n    i := i + 1;\n  END LOOP;\n  RETURN ret;\nEND;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1\u3092\u5b9f\u884c\nSELECT * FROM TABLE(hogetbl(1));\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2 (PIPELINED \u3067\u7d50\u679c\u3092\u5c11\u3057\u305a\u3064\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl_pipelined (x INTEGER)\n  RETURN HogeRowArrayType PIPELINED\nIS\nBEGIN\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    PIPE ROW(HogeRowType(row.id, row.name));\n  END LOOP;\nEND;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2\u3092\u5b9f\u884c\nSELECT * FROM TABLE(hogetbl_pipelined(1));\n\n\nPL/pgSQL\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\nCREATE TABLE hoge (id INTEGER, name VARCHAR(64));\nINSERT INTO hoge VALUES (1, 'one');\nINSERT INTO hoge VALUES (1, 'first');\nINSERT INTO hoge VALUES (2, 'two');\nINSERT INTO hoge VALUES (3, 'three');\nINSERT INTO hoge VALUES (4, 'four');\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1 (RETURN QUERY \u3067\u7d50\u679c\u3092\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl (x INTEGER)\n  RETURNS SETOF hoge AS $$\nBEGIN\n  RETURN QUERY SELECT * FROM hoge WHERE id = x;\n  RETURN;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1\u3092\u5b9f\u884c\nSELECT * FROM hogetbl(1);\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u306e\u4f5c\u6210\nCREATE TYPE HogeRowType AS (id INTEGER, name VARCHAR(64));\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2 (RETURN NEXT \u3067\u7d50\u679c\u3092\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl2 (x INTEGER)\n  RETURNS SETOF HogeRowType AS $$\nDECLARE\n  row HogeRowType;\nBEGIN\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    RETURN NEXT row;\n  END LOOP;\n  RETURN;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2\u3092\u5b9f\u884c\nSELECT * FROM hogetbl2(1);\n\n\u6574\u6570\u578b\u306e id \u5217\u3068\u6587\u5b57\u5217\u578b\u306e name \u5217\u3092\u6301\u3064 hoge \u30c6\u30fc\u30d6\u30eb\u306b\u3064\u3044\u3066\u3001\u5f15\u6570\u306e\u6570\u5024\u306b id \u5217\u304c\u4e00\u81f4\u3059\u308b\u884c\u3092\u3059\u3079\u3066\u8fd4\u5374\u3059\u308b\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n# PL/SQL\n```sql\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\nCREATE TABLE hoge (id INTEGER, name VARCHAR2(64));\nINSERT INTO hoge VALUES (1, 'one');\nINSERT INTO hoge VALUES (1, 'first');\nINSERT INTO hoge VALUES (2, 'two');\nINSERT INTO hoge VALUES (3, 'three');\nINSERT INTO hoge VALUES (4, 'four');\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u306e\u4f5c\u6210\nCREATE TYPE HogeRowType IS OBJECT (id INTEGER, name VARCHAR2(64));\n/\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u3092\u8981\u7d20\u3068\u3059\u308b\u30cd\u30b9\u30c8\u3057\u305f\u8868\u3092\u4f5c\u6210\nCREATE TYPE HogeRowArrayType IS TABLE OF HogeRowType;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1 (\u30cd\u30b9\u30c8\u3057\u305f\u8868\u306b\u7d50\u679c\u3092\u6e9c\u3081\u8fbc\u3093\u3067\u4e00\u5ea6\u306b\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl (x INTEGER)\n  RETURN HogeRowArrayType\nIS\n  ret HogeRowArrayType := HogeRowArrayType();\n  i INTEGER;\nBEGIN\n  i := 1;\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    ret.EXTEND;\n    ret(i) := HogeRowType(row.id, row.name);\n    i := i + 1;\n  END LOOP;\n  RETURN ret;\nEND;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1\u3092\u5b9f\u884c\nSELECT * FROM TABLE(hogetbl(1));\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2 (PIPELINED \u3067\u7d50\u679c\u3092\u5c11\u3057\u305a\u3064\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl_pipelined (x INTEGER)\n  RETURN HogeRowArrayType PIPELINED\nIS\nBEGIN\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    PIPE ROW(HogeRowType(row.id, row.name));\n  END LOOP;\nEND;\n/\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2\u3092\u5b9f\u884c\nSELECT * FROM TABLE(hogetbl_pipelined(1));\n```\n\n# PL/pgSQL\n```plpgsql\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u4f5c\u6210\nCREATE TABLE hoge (id INTEGER, name VARCHAR(64));\nINSERT INTO hoge VALUES (1, 'one');\nINSERT INTO hoge VALUES (1, 'first');\nINSERT INTO hoge VALUES (2, 'two');\nINSERT INTO hoge VALUES (3, 'three');\nINSERT INTO hoge VALUES (4, 'four');\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1 (RETURN QUERY \u3067\u7d50\u679c\u3092\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl (x INTEGER)\n  RETURNS SETOF hoge AS $$\nBEGIN\n  RETURN QUERY SELECT * FROM hoge WHERE id = x;\n  RETURN;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u95a2\u6570\u4f8b\u305d\u306e1\u3092\u5b9f\u884c\nSELECT * FROM hogetbl(1);\n\n-- hoge \u30c6\u30fc\u30d6\u30eb\u306e\u30ec\u30b3\u30fc\u30c9\u578b\u306e\u4f5c\u6210\nCREATE TYPE HogeRowType AS (id INTEGER, name VARCHAR(64));\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2 (RETURN NEXT \u3067\u7d50\u679c\u3092\u8fd4\u5374)\nCREATE OR REPLACE FUNCTION hogetbl2 (x INTEGER)\n  RETURNS SETOF HogeRowType AS $$\nDECLARE\n  row HogeRowType;\nBEGIN\n  FOR row IN (SELECT * FROM hoge WHERE id = x) LOOP\n    RETURN NEXT row;\n  END LOOP;\n  RETURN;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- \u95a2\u6570\u4f8b\u305d\u306e2\u3092\u5b9f\u884c\nSELECT * FROM hogetbl2(1);\n```\n", "tags": ["oracle", "PostgreSQL", "plsql", "PLpgSQL"]}