{"context": "Keras\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306ftensorflow\uff09\u3067\u3001\u3053\u306e\u5ea6\u6a2a\u7db1\u306b\u6607\u9032\u3057\u305f\u7a00\u52e2\u306e\u91cc\u3068\u3001\u5343\u5e74\u306b\u4e00\u4eba\u306e\u9038\u6750\u306e\u6a4b\u672c\u74b0\u5948\u3092\u898b\u5206\u3051\u3089\u308c\u308b\u306e\u304b\u3084\u3063\u3066\u307f\u305f\u3002\u3067\u3001\u305d\u306e\u9014\u4e2d\u3067\u30a2\u30a4\u30c9\u30eb\u540c\u58eb\u3092\u898b\u5206\u3051\u308b\u3053\u3068\u3063\u3066\u3067\u304d\u308b\u3093\u3060\u308d\u3046\u304b\u3068\u601d\u3063\u3066\u5e83\u702c\u3059\u305a\u3082\u8ffd\u52a0\u3057\u3066\u4e09\u3064\u5df4\u3067\u3084\u3063\u3066\u307f\u305f\u3002\nKeras\u306b\u3088\u308b\u3001\u3082\u306e\u3059\u3054\u304f\u30b7\u30f3\u30d7\u30eb\u306a\u753b\u50cf\u5206\u985e\uff08\u308a\u3093\u3054\u3068\u30aa\u30ec\u30f3\u30b8\uff09\u3067\u306f\u8aad\u307f\u8fbc\u3093\u3060\u753b\u50cf\u3092\u30d5\u30e9\u30c3\u30c8\u306a\uff11\u6b21\u5143\u914d\u5217\u306b\u5909\u63db\u3057\u3066\u30e2\u30c7\u30eb\u306e\u5b66\u7fd2\u306b\u4f7f\u3063\u305f\u3051\u3069\u3001\u4eca\u56de\u306f\u3088\u308a\u672c\u683c\u7684\u306b\u7573\u307f\u8fbc\u307f\u5c64(Convolution2D)\u3092\u8ffd\u52a0\u3057\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002\nKeras\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8aad\u3080\u3068\u3001Convolution2D\u306b\u55b0\u308f\u305b\u308b\u524d\u306b\u3001\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3060\u914d\u5217\u306e\u6b21\u5143\u3092\u3044\u3058\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u4f8b\u3048\u3070 \u7e26:100 x \u6a2a:100 x RGB:3 \u306e\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3060\u5834\u5408\u3001100x100x3\u306e\u914d\u5217\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u3092 3x100x100\u306e\u5f62\u306b\u76f4\u3057\u3066\u304b\u3089Convolution2D\u306b\u4e0e\u3048\u308d\u3063\u3066\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\n\u3053\u308c\u3089\u304b\u3089\u307e\u305a\u3001\n./data/train/kisenosato/(\u7a00\u52e2\u306e\u91cc\u306e\u753b\u50cf)\n            /hashimoto/(\u6a4b\u672c\u74b0\u5948\u306e\u753b\u50cf)\n            /hirose/(\u5e83\u702c\u3059\u305a\u306e\u753b\u50cf)\n\n./data/test/kisenosato/(\u7a00\u52e2\u306e\u91cc\u306e\u753b\u50cf)\n           /hashimoto/(\u6a4b\u672c\u74b0\u5948\u306e\u753b\u50cf)\n           /hirose/(\u5e83\u702c\u3059\u305a\u306e\u753b\u50cf)\n\n\u3068\u3057\u3066\u3001 data/train \u4ee5\u4e0b\u306e\u753b\u50cf\u306f\u5b66\u7fd2\u7528\u3001 data/test \u4ee5\u4e0b\u306e\u753b\u50cf\u306f\u5b66\u7fd2\u5f8c\u306e\u30c6\u30b9\u30c8\u7528\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3002\u5b66\u7fd2\u7528\u306e\u753b\u50cf\u306f\u305d\u308c\u305e\u308c30\u679a\u3065\u3064\u3050\u3089\u3044\u3001Google\u753b\u50cf\u691c\u7d22\u3067\u624b\u52d5\u3067\u96c6\u3081\u305f\u3067\u3059....\n\u30b3\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\n\nkisenosato.py\nfrom keras.models import Sequential\nfrom keras.layers import Activation, Dense, Dropout, Convolution2D, Flatten, MaxPooling2D\nfrom keras.utils.np_utils import to_categorical\nfrom keras.optimizers import Adagrad\nfrom keras.optimizers import Adam\nimport numpy as np\nfrom PIL import Image\nimport os\n\n# \u5b66\u7fd2\u7528\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u308b.\nimage_list = []\nlabel_list = []\n\n# ./data/train \u4ee5\u4e0b\u306eorange,apple\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306e\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3080\u3002\nfor dir in os.listdir(\"data/train\"):\n    if dir == \".DS_Store\":\n        continue\n\n    dir1 = \"data/train/\" + dir \n    label = 0\n\n    if dir == \"kisenosato\":    # \u7a00\u52e2\u306e\u91cc\u306f\u30e9\u30d9\u30eb0\n        label = 0\n    elif dir == \"hashimoto\":   # \u6a4b\u672c\u74b0\u5948\u306f\u30e9\u30d9\u30eb1\n        label = 1\n    elif dir == \"hirose\":      # \u5e83\u702c\u3059\u305a\u306f\u30e9\u30d9\u30eb2\n        label = 2\n\n    for file in os.listdir(dir1):\n        if file != \".DS_Store\":\n            # \u914d\u5217label_list\u306b\u6b63\u89e3\u30e9\u30d9\u30eb\u3092\u8ffd\u52a0(\u7a00\u52e2\u306e\u91cc:0 \u6a4b\u672c\u74b0\u5948:1 \u5e83\u702c\u3059\u305a:2)\n            label_list.append(label)\n            filepath = dir1 + \"/\" + file\n            # \u753b\u50cf\u3092100x100pixel\u306b\u5909\u63db\u3057\u30011\u8981\u7d20\u304c[R,G,B]3\u8981\u7d20\u3092\u542b\u3080\u914d\u5217\u306e100x100\u306e\uff12\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u8aad\u307f\u8fbc\u3080\u3002\n            # [R,G,B]\u306f\u305d\u308c\u305e\u308c\u304c0-255\u306e\u914d\u5217\u3002\n            image = np.array(Image.open(filepath).resize((100, 100)))\n            print(filepath)\n            # \u914d\u5217\u3092\u5909\u63db\u3057\u3001[[Red\u306e\u914d\u5217],[Green\u306e\u914d\u5217],[Blue\u306e\u914d\u5217]] \u306e\u3088\u3046\u306a\u5f62\u306b\u3059\u308b\u3002\n            image = image.transpose(2, 0, 1)\n            print(image.shape)\n            # \u51fa\u6765\u4e0a\u304c\u3063\u305f\u914d\u5217\u3092image_list\u306b\u8ffd\u52a0\u3002\n            image_list.append(image / 255.)\n\n# keras\u306b\u6e21\u3059\u305f\u3081\u306bnumpy\u914d\u5217\u306b\u5909\u63db\u3002\nimage_list = np.array(image_list)\n\n# \u30e9\u30d9\u30eb\u306e\u914d\u5217\u30921\u30680\u304b\u3089\u306a\u308b\u30e9\u30d9\u30eb\u914d\u5217\u306b\u5909\u66f4\n# 0 -> [1,0,0], 1 -> [0,1,0] \u3068\u3044\u3046\u611f\u3058\u3002\nY = to_categorical(label_list)\n\n# \u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u3066\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u3092\u69cb\u7bc9\nmodel = Sequential()\nmodel.add(Convolution2D(32, 3, 3, border_mode='same', input_shape=(3, 100, 100)))\nmodel.add(Activation(\"relu\"))\nmodel.add(Convolution2D(32, 3, 3))\nmodel.add(Activation(\"relu\"))\nmodel.add(MaxPooling2D(pool_size=(2, 2), border_mode=(\"same\")))\nmodel.add(Dropout(0.25))\n\nmodel.add(Flatten())\n\nmodel.add(Dense(200))\nmodel.add(Activation(\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(200))\nmodel.add(Activation(\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(3))\nmodel.add(Activation(\"softmax\"))\n\n# \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306bAdam\u3092\u4f7f\u7528\nopt = Adam(lr=0.0001)\n# \u30e2\u30c7\u30eb\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\nmodel.compile(loss=\"categorical_crossentropy\", optimizer=opt, metrics=[\"accuracy\"])\n# \u5b66\u7fd2\u3092\u5b9f\u884c\u300210%\u306f\u30c6\u30b9\u30c8\u306b\u4f7f\u7528\u3002\nmodel.fit(image_list, Y, nb_epoch=1000, batch_size=25, validation_split=0.1)\n\n# \u30c6\u30b9\u30c8\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(./data/train/)\u306e\u753b\u50cf\u3067\u30c1\u30a7\u30c3\u30af\u3002\u6b63\u89e3\u7387\u3092\u8868\u793a\u3059\u308b\u3002\ntotal = 0.\nok_count = 0.\n\nfor dir in os.listdir(\"data/test\"):\n    if dir == \".DS_Store\":\n        continue\n\n    dir1 = \"data/test/\" + dir \n    label = 0\n\n    if dir == \"kisenosato\":\n        label = 0\n    elif dir == \"hashimoto\":\n        label = 1\n    elif dir == \"hirose\":\n        label = 2\n\n    for file in os.listdir(dir1):\n        if file != \".DS_Store\":\n            label_list.append(label)\n            filepath = dir1 + \"/\" + file\n            image = np.array(Image.open(filepath).resize((100, 100)))\n            print(filepath)\n            image = image.transpose(2, 0, 1)\n            result = model.predict_classes(np.array([image / 255.]))\n            print(\"label:\", label, \"result:\", result[0])\n\n            total += 1.\n\n            if label == result[0]:\n                ok_count += 1.\n\nprint(\"seikai: \", ok_count / total * 100, \"%\")\n\n\n\n2017/02/15\u8ffd\u8a18\n\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306bConvolution2D\u30921\u5c64\u8ffd\u52a0\u3057\u3066\u5408\u308f\u305b\u30662\u5c64\u3068\u3057\u3001\u52a0\u3048\u3066MaxPooling2D\u5c64\u3092\u8ffd\u52a0\u3057\u305f\u3068\u3053\u308d\u8b58\u5225\u7387\u304c\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n\n\n\u3055\u3066\u3001\u7d50\u679c\u306e\u51fa\u529b\u3067\u3059\u304c\u3001\u4e0a\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u5b66\u7fd2\u30d7\u30ed\u30bb\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u3001\u6700\u7d42\u7684\u306b\nEpoch 1000/1000\n108/108 [==============================] - 0s - loss: 2.8859e-05 - acc: 1.0000 - val_loss: 0.6708 - val_acc: 0.7500\n\n\ndata/test/hashimoto/1032kanna-top_1200x.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/4616_original-e1444887883222.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/d724e07900b770b9f78eaa1b111c8a2f.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/JLU_4kBV.jpeg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/wam1022-kanna-003_x480.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/WS000043.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/\u6a4b\u672c\u74b0\u5948.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 2\ndata/test/hirose/20170110hirose.jpg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/2e2d42fcee97871743e9a52f54c0fabb_319.jpeg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/m_E5BA83E780ACE38199E3819A.jpg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/mig.jpeg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/uV3Uh8toqAmGDHQ_Inuz4_109.png\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/kisenosato/2012062514095159c.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/20161226-00000028-tospoweb-000-1-view.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/images.jpeg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/kise.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/o03780450m0023152112.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\nseikai:  94.11764705882352 %\n\n\u5b9f\u884c\u7d50\u679c\u306e\u51fa\u529b\u306f\u4e0a\u8a18\u306e\u901a\u308a\u3002\n\u7d50\u679c\u3092\u898b\u3084\u3059\u304f\u8868\u306b\u3059\u308b\u3068...\n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948 \n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948 \n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\uff08\u4e0d\u6b63\u89e3\uff01\uff09\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\u3068\u3044\u3046\u308f\u3051\u3067\u8b58\u5225\u7387\u306f94.11%\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u4e00\u679a\u304c\u4e0d\u6b63\u89e3\u3001\u4ed6\u306e\u5168\u3066\u306f\u6b63\u89e3\u3067\u3059\u3002\u7d20\u6750\u306e\u753b\u50cf\u304c\u5c11\u306a\u3044\u72b6\u614b\u3067\u3042\u308b\u3053\u3068\u3092\u8003\u3048\u308b\u3068\u7d50\u69cb\u3044\u3044\u78ba\u7387\u306a\u306e\u3067\u306f\u3002\n\u3042\u3068\u3001\u30e9\u30d9\u30eb\u306f 0\u304c\u7a00\u52e2\u306e\u91cc 1\u304c\u6a4b\u672c\u74b0\u5948 2\u304c\u5e83\u702c\u3059\u305a \u306a\u3093\u3067\u3059\u304c\u3001\u7a00\u52e2\u306e\u91cc\u3068\u30a2\u30a4\u30c9\u30eb\u3092\u9593\u9055\u3048\u3066\u306a\u3044\u3068\u3053\u308d\u304c\u3055\u3059\u304c\u3067\u3059\u7b11 \u6a4b\u672c\u74b0\u5948\u3068\u5e83\u702c\u3059\u305a\u306f\u4e00\u7b87\u6240\u3060\u3051\u9593\u9055\u3048\u3066\u307e\u3059\u306d\u3002\u6b63\u76f4\u306a\u3068\u3053\u308d\u3001\u76f8\u64b2\u53d6\u308a\u3068\u30a2\u30a4\u30c9\u30eb\u306f\u898b\u5206\u3051\u3089\u308c\u3066\u3082\u3001\u30a2\u30a4\u30c9\u30eb\u540c\u58eb\u306f\u3053\u306e\u5b66\u7fd2\u7528\u753b\u50cf\u6570\u3067\u306f\u96e3\u3057\u3044\u306e\u3067\u306f\u3001\u3063\u3066\u601d\u3063\u3066\u305f\u3089\u7d50\u69cb\u898b\u5206\u3051\u3089\u308c\u308b\u3093\u3067\u3059\u306d\u3048\u3002\n\u3068\u308a\u3042\u3048\u305a\u753b\u50cf\u306e\u5206\u985e\u306b\u3064\u3044\u3066\u306f\u4e00\u65e6\u3053\u3053\u3067\u7f6e\u3044\u3066\u3001\u4eca\u5ea6\u306fRNN\u3092\u3084\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\nKeras\uff08\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u306ftensorflow\uff09\u3067\u3001\u3053\u306e\u5ea6\u6a2a\u7db1\u306b\u6607\u9032\u3057\u305f\u7a00\u52e2\u306e\u91cc\u3068\u3001\u5343\u5e74\u306b\u4e00\u4eba\u306e\u9038\u6750\u306e\u6a4b\u672c\u74b0\u5948\u3092\u898b\u5206\u3051\u3089\u308c\u308b\u306e\u304b\u3084\u3063\u3066\u307f\u305f\u3002\u3067\u3001\u305d\u306e\u9014\u4e2d\u3067\u30a2\u30a4\u30c9\u30eb\u540c\u58eb\u3092\u898b\u5206\u3051\u308b\u3053\u3068\u3063\u3066\u3067\u304d\u308b\u3093\u3060\u308d\u3046\u304b\u3068\u601d\u3063\u3066\u5e83\u702c\u3059\u305a\u3082\u8ffd\u52a0\u3057\u3066\u4e09\u3064\u5df4\u3067\u3084\u3063\u3066\u307f\u305f\u3002\n[Keras\u306b\u3088\u308b\u3001\u3082\u306e\u3059\u3054\u304f\u30b7\u30f3\u30d7\u30eb\u306a\u753b\u50cf\u5206\u985e\uff08\u308a\u3093\u3054\u3068\u30aa\u30ec\u30f3\u30b8\uff09](http://qiita.com/hiroeorz@github/items/ecb39ed4042ebdc0a957)\u3067\u306f\u8aad\u307f\u8fbc\u3093\u3060\u753b\u50cf\u3092\u30d5\u30e9\u30c3\u30c8\u306a\uff11\u6b21\u5143\u914d\u5217\u306b\u5909\u63db\u3057\u3066\u30e2\u30c7\u30eb\u306e\u5b66\u7fd2\u306b\u4f7f\u3063\u305f\u3051\u3069\u3001\u4eca\u56de\u306f\u3088\u308a\u672c\u683c\u7684\u306b\u7573\u307f\u8fbc\u307f\u5c64(Convolution2D)\u3092\u8ffd\u52a0\u3057\u3066\u3084\u3063\u3066\u307f\u307e\u3059\u3002\n\n[Keras\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](https://keras.io/ja/getting-started/sequential-model-guide/)\u3092\u8aad\u3080\u3068\u3001Convolution2D\u306b\u55b0\u308f\u305b\u308b\u524d\u306b\u3001\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3060\u914d\u5217\u306e\u6b21\u5143\u3092\u3044\u3058\u308b\u5fc5\u8981\u304c\u3042\u308b\u3088\u3046\u3067\u3059\u3002\u4f8b\u3048\u3070 `\u7e26:100` x `\u6a2a:100` x `RGB:3` \u306e\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3093\u3060\u5834\u5408\u3001100x100x3\u306e\u914d\u5217\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u308c\u307e\u3059\u304c\u3001\u3053\u308c\u3092 3x100x100\u306e\u5f62\u306b\u76f4\u3057\u3066\u304b\u3089Convolution2D\u306b\u4e0e\u3048\u308d\u3063\u3066\u3053\u3068\u3089\u3057\u3044\u3067\u3059\u3002\n\n\n\u3053\u308c\u3089\u304b\u3089\u307e\u305a\u3001\n\n```\n./data/train/kisenosato/(\u7a00\u52e2\u306e\u91cc\u306e\u753b\u50cf)\n            /hashimoto/(\u6a4b\u672c\u74b0\u5948\u306e\u753b\u50cf)\n            /hirose/(\u5e83\u702c\u3059\u305a\u306e\u753b\u50cf)\n\n./data/test/kisenosato/(\u7a00\u52e2\u306e\u91cc\u306e\u753b\u50cf)\n           /hashimoto/(\u6a4b\u672c\u74b0\u5948\u306e\u753b\u50cf)\n           /hirose/(\u5e83\u702c\u3059\u305a\u306e\u753b\u50cf)\n```\n\n\u3068\u3057\u3066\u3001 `data/train` \u4ee5\u4e0b\u306e\u753b\u50cf\u306f\u5b66\u7fd2\u7528\u3001 `data/test` \u4ee5\u4e0b\u306e\u753b\u50cf\u306f\u5b66\u7fd2\u5f8c\u306e\u30c6\u30b9\u30c8\u7528\u3068\u3057\u3066\u4f7f\u7528\u3059\u308b\u3002\u5b66\u7fd2\u7528\u306e\u753b\u50cf\u306f\u305d\u308c\u305e\u308c30\u679a\u3065\u3064\u3050\u3089\u3044\u3001Google\u753b\u50cf\u691c\u7d22\u3067\u624b\u52d5\u3067\u96c6\u3081\u305f\u3067\u3059....\n\n\u30b3\u30fc\u30c9\u306f\u3053\u3093\u306a\u611f\u3058\n\n```python:kisenosato.py\nfrom keras.models import Sequential\nfrom keras.layers import Activation, Dense, Dropout, Convolution2D, Flatten, MaxPooling2D\nfrom keras.utils.np_utils import to_categorical\nfrom keras.optimizers import Adagrad\nfrom keras.optimizers import Adam\nimport numpy as np\nfrom PIL import Image\nimport os\n\n# \u5b66\u7fd2\u7528\u306e\u30c7\u30fc\u30bf\u3092\u4f5c\u308b.\nimage_list = []\nlabel_list = []\n\n# ./data/train \u4ee5\u4e0b\u306eorange,apple\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u4ee5\u4e0b\u306e\u753b\u50cf\u3092\u8aad\u307f\u8fbc\u3080\u3002\nfor dir in os.listdir(\"data/train\"):\n    if dir == \".DS_Store\":\n        continue\n\n    dir1 = \"data/train/\" + dir \n    label = 0\n\n    if dir == \"kisenosato\":    # \u7a00\u52e2\u306e\u91cc\u306f\u30e9\u30d9\u30eb0\n        label = 0\n    elif dir == \"hashimoto\":   # \u6a4b\u672c\u74b0\u5948\u306f\u30e9\u30d9\u30eb1\n        label = 1\n    elif dir == \"hirose\":      # \u5e83\u702c\u3059\u305a\u306f\u30e9\u30d9\u30eb2\n        label = 2\n        \n    for file in os.listdir(dir1):\n        if file != \".DS_Store\":\n            # \u914d\u5217label_list\u306b\u6b63\u89e3\u30e9\u30d9\u30eb\u3092\u8ffd\u52a0(\u7a00\u52e2\u306e\u91cc:0 \u6a4b\u672c\u74b0\u5948:1 \u5e83\u702c\u3059\u305a:2)\n            label_list.append(label)\n            filepath = dir1 + \"/\" + file\n            # \u753b\u50cf\u3092100x100pixel\u306b\u5909\u63db\u3057\u30011\u8981\u7d20\u304c[R,G,B]3\u8981\u7d20\u3092\u542b\u3080\u914d\u5217\u306e100x100\u306e\uff12\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u8aad\u307f\u8fbc\u3080\u3002\n            # [R,G,B]\u306f\u305d\u308c\u305e\u308c\u304c0-255\u306e\u914d\u5217\u3002\n            image = np.array(Image.open(filepath).resize((100, 100)))\n            print(filepath)\n            # \u914d\u5217\u3092\u5909\u63db\u3057\u3001[[Red\u306e\u914d\u5217],[Green\u306e\u914d\u5217],[Blue\u306e\u914d\u5217]] \u306e\u3088\u3046\u306a\u5f62\u306b\u3059\u308b\u3002\n            image = image.transpose(2, 0, 1)\n            print(image.shape)\n            # \u51fa\u6765\u4e0a\u304c\u3063\u305f\u914d\u5217\u3092image_list\u306b\u8ffd\u52a0\u3002\n            image_list.append(image / 255.)\n\n# keras\u306b\u6e21\u3059\u305f\u3081\u306bnumpy\u914d\u5217\u306b\u5909\u63db\u3002\nimage_list = np.array(image_list)\n\n# \u30e9\u30d9\u30eb\u306e\u914d\u5217\u30921\u30680\u304b\u3089\u306a\u308b\u30e9\u30d9\u30eb\u914d\u5217\u306b\u5909\u66f4\n# 0 -> [1,0,0], 1 -> [0,1,0] \u3068\u3044\u3046\u611f\u3058\u3002\nY = to_categorical(label_list)\n\n# \u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u3066\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u3092\u69cb\u7bc9\nmodel = Sequential()\nmodel.add(Convolution2D(32, 3, 3, border_mode='same', input_shape=(3, 100, 100)))\nmodel.add(Activation(\"relu\"))\nmodel.add(Convolution2D(32, 3, 3))\nmodel.add(Activation(\"relu\"))\nmodel.add(MaxPooling2D(pool_size=(2, 2), border_mode=(\"same\")))\nmodel.add(Dropout(0.25))\n\nmodel.add(Flatten())\n\nmodel.add(Dense(200))\nmodel.add(Activation(\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(200))\nmodel.add(Activation(\"relu\"))\nmodel.add(Dropout(0.2))\n\nmodel.add(Dense(3))\nmodel.add(Activation(\"softmax\"))\n\n# \u30aa\u30d7\u30c6\u30a3\u30de\u30a4\u30b6\u306bAdam\u3092\u4f7f\u7528\nopt = Adam(lr=0.0001)\n# \u30e2\u30c7\u30eb\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\nmodel.compile(loss=\"categorical_crossentropy\", optimizer=opt, metrics=[\"accuracy\"])\n# \u5b66\u7fd2\u3092\u5b9f\u884c\u300210%\u306f\u30c6\u30b9\u30c8\u306b\u4f7f\u7528\u3002\nmodel.fit(image_list, Y, nb_epoch=1000, batch_size=25, validation_split=0.1)\n\n# \u30c6\u30b9\u30c8\u7528\u30c7\u30a3\u30ec\u30af\u30c8\u30ea(./data/train/)\u306e\u753b\u50cf\u3067\u30c1\u30a7\u30c3\u30af\u3002\u6b63\u89e3\u7387\u3092\u8868\u793a\u3059\u308b\u3002\ntotal = 0.\nok_count = 0.\n\nfor dir in os.listdir(\"data/test\"):\n    if dir == \".DS_Store\":\n        continue\n\n    dir1 = \"data/test/\" + dir \n    label = 0\n\n    if dir == \"kisenosato\":\n        label = 0\n    elif dir == \"hashimoto\":\n        label = 1\n    elif dir == \"hirose\":\n        label = 2\n        \n    for file in os.listdir(dir1):\n        if file != \".DS_Store\":\n            label_list.append(label)\n            filepath = dir1 + \"/\" + file\n            image = np.array(Image.open(filepath).resize((100, 100)))\n            print(filepath)\n            image = image.transpose(2, 0, 1)\n            result = model.predict_classes(np.array([image / 255.]))\n            print(\"label:\", label, \"result:\", result[0])\n            \n            total += 1.\n            \n            if label == result[0]:\n                ok_count += 1.\n\nprint(\"seikai: \", ok_count / total * 100, \"%\")\n```\n\n```text:2017/02/15\u8ffd\u8a18\n\u30cb\u30e5\u30fc\u30e9\u30eb\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u306bConvolution2D\u30921\u5c64\u8ffd\u52a0\u3057\u3066\u5408\u308f\u305b\u30662\u5c64\u3068\u3057\u3001\u52a0\u3048\u3066MaxPooling2D\u5c64\u3092\u8ffd\u52a0\u3057\u305f\u3068\u3053\u308d\u8b58\u5225\u7387\u304c\u4e0a\u304c\u308a\u307e\u3057\u305f\u3002\n```\n\n\u3055\u3066\u3001\u7d50\u679c\u306e\u51fa\u529b\u3067\u3059\u304c\u3001\u4e0a\u8a18\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u5b9f\u884c\u3059\u308b\u3068\u5b66\u7fd2\u30d7\u30ed\u30bb\u30b9\u304c\u8868\u793a\u3055\u308c\u3066\u3001\u6700\u7d42\u7684\u306b\n\n```\nEpoch 1000/1000\n108/108 [==============================] - 0s - loss: 2.8859e-05 - acc: 1.0000 - val_loss: 0.6708 - val_acc: 0.7500\n\n\ndata/test/hashimoto/1032kanna-top_1200x.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/4616_original-e1444887883222.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/d724e07900b770b9f78eaa1b111c8a2f.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/JLU_4kBV.jpeg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/wam1022-kanna-003_x480.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/WS000043.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 1\ndata/test/hashimoto/\u6a4b\u672c\u74b0\u5948.jpg\n1/1 [==============================] - 0s\nlabel: 1 result: 2\ndata/test/hirose/20170110hirose.jpg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/2e2d42fcee97871743e9a52f54c0fabb_319.jpeg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/m_E5BA83E780ACE38199E3819A.jpg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/mig.jpeg\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/hirose/uV3Uh8toqAmGDHQ_Inuz4_109.png\n1/1 [==============================] - 0s\nlabel: 2 result: 2\ndata/test/kisenosato/2012062514095159c.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/20161226-00000028-tospoweb-000-1-view.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/images.jpeg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/kise.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\ndata/test/kisenosato/o03780450m0023152112.jpg\n1/1 [==============================] - 0s\nlabel: 0 result: 0\nseikai:  94.11764705882352 %\n```\n\n\u5b9f\u884c\u7d50\u679c\u306e\u51fa\u529b\u306f\u4e0a\u8a18\u306e\u901a\u308a\u3002\n\n\u7d50\u679c\u3092\u898b\u3084\u3059\u304f\u8868\u306b\u3059\u308b\u3068...\n\n\n![1032kanna-top_1200x.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/79e09ff2-cd6a-851f-beb5-8c735e0db1ae.jpeg \"1032kanna-top_1200x.jpg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n![4616_original-e1444887883222.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/cd261cc6-3ebc-9610-d3f3-1060f05b0ee0.jpeg \"4616_original-e1444887883222.jpg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948 \n\n![d724e07900b770b9f78eaa1b111c8a2f.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/f37e8c84-de27-a976-3cf8-8c3ef50f0d1c.jpeg \"d724e07900b770b9f78eaa1b111c8a2f.jpg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948 \n\n![JLU_4kBV.jpeg](https://qiita-image-store.s3.amazonaws.com/0/13835/c7c402bc-d9e1-a1f8-393b-7fd2acf85fde.jpeg \"JLU_4kBV.jpeg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n![wam1022-kanna-003_x480.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/9d58c79b-98dd-a7e5-a5f5-9488bcb680ee.jpeg \"wam1022-kanna-003_x480.jpg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n![WS000043.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/e9775760-f261-5cd2-4253-8ce0cd2ce832.jpeg \"WS000043.jpg\")\n\u5224\u5b9a\uff1a\u6a4b\u672c\u74b0\u5948\n\n![\u6a4b\u672c\u74b0\u5948.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/456bbcc6-23eb-2cee-6e15-23f108473d99.jpeg \"\u6a4b\u672c\u74b0\u5948.jpg\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\uff08\u4e0d\u6b63\u89e3\uff01\uff09\n\n![2e2d42fcee97871743e9a52f54c0fabb_319.jpeg](https://qiita-image-store.s3.amazonaws.com/0/13835/16d1ced3-c7c4-2491-3ea1-66c0374954e9.jpeg \"2e2d42fcee97871743e9a52f54c0fabb_319.jpeg\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n![20170110hirose.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/b4f2cb34-775e-27d2-9c80-2849ed688588.jpeg \"20170110hirose.jpg\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n![m_E5BA83E780ACE38199E3819A.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/f0990f8e-2ad7-01b5-2bfc-31b9f6765ee7.jpeg \"m_E5BA83E780ACE38199E3819A.jpg\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n![mig.jpeg](https://qiita-image-store.s3.amazonaws.com/0/13835/4fe26e68-f23f-b7ca-c024-bc095eb8b74f.jpeg \"mig.jpeg\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n![uV3Uh8toqAmGDHQ_Inuz4_109.png](https://qiita-image-store.s3.amazonaws.com/0/13835/06f46f8e-e468-8be2-7a01-08ad368ba93a.png \"uV3Uh8toqAmGDHQ_Inuz4_109.png\")\n\u5224\u5b9a\uff1a\u5e83\u702c\u3059\u305a\n\n![20161226-00000028-tospoweb-000-1-view.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/6b249dd9-9637-a7b7-2e71-3ac4aae006c7.jpeg \"20161226-00000028-tospoweb-000-1-view.jpg\")\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n![2012062514095159c.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/598cbd79-38a0-4f12-e613-6f2547fa497d.jpeg \"2012062514095159c.jpg\")\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n![images.jpeg](https://qiita-image-store.s3.amazonaws.com/0/13835/03735760-6482-c79f-4936-77b33fe481f4.jpeg \"images.jpeg\")\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n![kise.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/067271d9-ea31-8d0d-35f5-c0a859d4a59b.jpeg \"kise.jpg\")\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n![o03780450m0023152112.jpg](https://qiita-image-store.s3.amazonaws.com/0/13835/322078d6-7828-59ec-79e6-55ad07a9a578.jpeg \"o03780450m0023152112.jpg\")\n\u5224\u5b9a\uff1a\u7a00\u52e2\u306e\u91cc\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u8b58\u5225\u7387\u306f94.11%\u3068\u306a\u308a\u307e\u3057\u305f\u3002\u4e00\u679a\u304c\u4e0d\u6b63\u89e3\u3001\u4ed6\u306e\u5168\u3066\u306f\u6b63\u89e3\u3067\u3059\u3002\u7d20\u6750\u306e\u753b\u50cf\u304c\u5c11\u306a\u3044\u72b6\u614b\u3067\u3042\u308b\u3053\u3068\u3092\u8003\u3048\u308b\u3068\u7d50\u69cb\u3044\u3044\u78ba\u7387\u306a\u306e\u3067\u306f\u3002\n\u3042\u3068\u3001\u30e9\u30d9\u30eb\u306f `0\u304c\u7a00\u52e2\u306e\u91cc` `1\u304c\u6a4b\u672c\u74b0\u5948` `2\u304c\u5e83\u702c\u3059\u305a` \u306a\u3093\u3067\u3059\u304c\u3001\u7a00\u52e2\u306e\u91cc\u3068\u30a2\u30a4\u30c9\u30eb\u3092\u9593\u9055\u3048\u3066\u306a\u3044\u3068\u3053\u308d\u304c\u3055\u3059\u304c\u3067\u3059\u7b11 \u6a4b\u672c\u74b0\u5948\u3068\u5e83\u702c\u3059\u305a\u306f\u4e00\u7b87\u6240\u3060\u3051\u9593\u9055\u3048\u3066\u307e\u3059\u306d\u3002\u6b63\u76f4\u306a\u3068\u3053\u308d\u3001\u76f8\u64b2\u53d6\u308a\u3068\u30a2\u30a4\u30c9\u30eb\u306f\u898b\u5206\u3051\u3089\u308c\u3066\u3082\u3001\u30a2\u30a4\u30c9\u30eb\u540c\u58eb\u306f\u3053\u306e\u5b66\u7fd2\u7528\u753b\u50cf\u6570\u3067\u306f\u96e3\u3057\u3044\u306e\u3067\u306f\u3001\u3063\u3066\u601d\u3063\u3066\u305f\u3089\u7d50\u69cb\u898b\u5206\u3051\u3089\u308c\u308b\u3093\u3067\u3059\u306d\u3048\u3002\n\n\u3068\u308a\u3042\u3048\u305a\u753b\u50cf\u306e\u5206\u985e\u306b\u3064\u3044\u3066\u306f\u4e00\u65e6\u3053\u3053\u3067\u7f6e\u3044\u3066\u3001\u4eca\u5ea6\u306fRNN\u3092\u3084\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["\u6df1\u5c64\u5b66\u7fd2", "Keras"]}