{"tags": ["itamae", "Ruby", "Node.js", "serverspec"], "context": "\n\n\u6982\u8981\n\u4eee\u60f3\u74b0\u5883\u3084\u672c\u756a\u74b0\u5883\u306b\u3001\u30b5\u30af\u30c3\u3068ndenv\u3092\u5165\u308c\u308b\u305f\u3081\u306eItamae\u30ec\u30b7\u30d4\u3067\u3059\u3002\n\n\u30bd\u30fc\u30b9\nGitHub\u306b\u30bd\u30fc\u30b9\u3092\u7f6e\u3044\u3066\u307e\u3059\u3002\nhttps://github.com/dtlabo/itamae-ndenv\n\n\u53c2\u8003URL\n\u4ee5\u4e0b\u306erbenv\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u3001ndenv\u306b\u9069\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nhttp://qiita.com/fukuiretu/items/337e6ae15c1f01e93ec3\nhttp://blog.kyanny.me/entry/2012/02/03/155652\n\n\u69cb\u6210\n$ tree\n.\n\u251c\u2500\u2500 Gemfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 recipes\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ndenv.rb\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 remote_files\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 ndenv.sh\n\u2514\u2500\u2500 spec\n    \u251c\u2500\u2500 dev-test\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 ndenv_spec.rb\n    \u2514\u2500\u2500 spec_helper.rb\n\n\n\u30d5\u30a1\u30a4\u30eb\u8a2d\u7f6e\n\u307e\u305a\u306f\u74b0\u5883\u5909\u6570\u306a\u3069\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\nndenv.sh\nexport NDENV_ROOT=\"/usr/local/ndenv\"\nexport PATH=\"${NDENV_ROOT}/bin:${PATH}\"\neval \"$(ndenv init --no-rehash -)\"\n\n\n\n\u30ec\u30b7\u30d4\u4f5c\u6210\n\nndenv.rb\nNDENV_DIR = \"/usr/local/ndenv\"\nNDENV_SCRIPT = \"/etc/profile.d/ndenv.sh\"\n\ngit NDENV_DIR do\n  repository \"git://github.com/riywo/ndenv.git\"\nend\n\nexecute \"mkdir #{NDENV_DIR}/shims #{NDENV_DIR}/versions\"\n\nremote_file NDENV_SCRIPT do\n  source \"remote_files/ndenv.sh\"\nend\n\nexecute \"set owner and mode for #{NDENV_SCRIPT} \" do\n  command \"chown root: #{NDENV_SCRIPT}; chmod 644 #{NDENV_SCRIPT}\"\n  user \"root\"\nend\n\nexecute \"mkdir #{NDENV_DIR}/plugins\" do\n  not_if \"test -d #{NDENV_DIR}/plugins\"\nend\n\ngit \"#{NDENV_DIR}/plugins/node-build\" do\n  repository \"git://github.com/riywo/node-build.git\"\nend\n\n\n\nServerspec\n\nndenv_spec.rb\nrequire 'spec_helper'\n\ndescribe command('source /etc/profile.d/ndenv.sh; which ndenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/ndenv/bin/ndenv} }\nend\n\ndescribe file('/etc/profile.d/ndenv.sh') do\n  it { should be_file }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 644 }\n  its(:content) { should match(/^export NDENV_ROOT=\"\\/usr\\/local\\/ndenv\"$/) }\n  its(:content) { should match(/^export PATH=\"\\${NDENV_ROOT}\\/bin:\\${PATH}\"$/) }\n  its(:content) { should match(/^eval \"\\$\\(ndenv init --no-rehash -\\)\"$/) }\nend\n\ndescribe file('/usr/local/ndenv/plugins') do\n  it { should be_directory }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 755 }\nend\n\ndescribe file('/usr/local/ndenv/plugins/node-build') do\n  it { should be_directory }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 755 }\nend\n\n\n\nspec\u5b9f\u884c\n$ bundle exec rake spec\n\n\u5b9f\u884c\u7d50\u679c\u306f\u8d64\n\n\u30ec\u30b7\u30d4 dry-run\n$ bundle exec itamae ssh -h \u30db\u30b9\u30c8\u540d -n recipes/ndenv.rb\n\n\n\u30ec\u30b7\u30d4\u5b9f\u884c\n$ bundle exec itamae ssh -h \u30db\u30b9\u30c8\u540d recipes/ndenv.rb\n\n\nspec\u518d\u5b9f\u884c\n$ bundle exec rake spec\n\n\u5b9f\u884c\u7d50\u679c\u304c\u7dd1\u306b\u306a\u308c\u3070OK\n\n\u78ba\u8a8d\nssh\u3067\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\n\n$ ndenv -v\n\n# \u6982\u8981\n\u4eee\u60f3\u74b0\u5883\u3084\u672c\u756a\u74b0\u5883\u306b\u3001\u30b5\u30af\u30c3\u3068ndenv\u3092\u5165\u308c\u308b\u305f\u3081\u306e[Itamae](https://github.com/itamae-kitchen/itamae)\u30ec\u30b7\u30d4\u3067\u3059\u3002\n\n# \u30bd\u30fc\u30b9\nGitHub\u306b\u30bd\u30fc\u30b9\u3092\u7f6e\u3044\u3066\u307e\u3059\u3002\nhttps://github.com/dtlabo/itamae-ndenv\n\n# \u53c2\u8003URL\n\u4ee5\u4e0b\u306erbenv\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u65b9\u6cd5\u306a\u3069\u3092\u53c2\u8003\u306b\u3057\u3066\u3001ndenv\u306b\u9069\u7528\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nhttp://qiita.com/fukuiretu/items/337e6ae15c1f01e93ec3\nhttp://blog.kyanny.me/entry/2012/02/03/155652\n\n# \u69cb\u6210\n\n```\n$ tree\n.\n\u251c\u2500\u2500 Gemfile\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 Rakefile\n\u251c\u2500\u2500 recipes\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 ndenv.rb\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 remote_files\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 ndenv.sh\n\u2514\u2500\u2500 spec\n    \u251c\u2500\u2500 dev-test\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 ndenv_spec.rb\n    \u2514\u2500\u2500 spec_helper.rb\n```\n\n# \u30d5\u30a1\u30a4\u30eb\u8a2d\u7f6e\n\u307e\u305a\u306f\u74b0\u5883\u5909\u6570\u306a\u3069\u3092\u8a2d\u5b9a\u3059\u308b\u305f\u3081\u306e\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7528\u610f\u3057\u307e\u3059\u3002\n\n\n```ndenv.sh\nexport NDENV_ROOT=\"/usr/local/ndenv\"\nexport PATH=\"${NDENV_ROOT}/bin:${PATH}\"\neval \"$(ndenv init --no-rehash -)\"\n```\n\n# \u30ec\u30b7\u30d4\u4f5c\u6210\n\n```ruby:ndenv.rb\nNDENV_DIR = \"/usr/local/ndenv\"\nNDENV_SCRIPT = \"/etc/profile.d/ndenv.sh\"\n\ngit NDENV_DIR do\n  repository \"git://github.com/riywo/ndenv.git\"\nend\n\nexecute \"mkdir #{NDENV_DIR}/shims #{NDENV_DIR}/versions\"\n\nremote_file NDENV_SCRIPT do\n  source \"remote_files/ndenv.sh\"\nend\n\nexecute \"set owner and mode for #{NDENV_SCRIPT} \" do\n  command \"chown root: #{NDENV_SCRIPT}; chmod 644 #{NDENV_SCRIPT}\"\n  user \"root\"\nend\n\nexecute \"mkdir #{NDENV_DIR}/plugins\" do\n  not_if \"test -d #{NDENV_DIR}/plugins\"\nend\n\ngit \"#{NDENV_DIR}/plugins/node-build\" do\n  repository \"git://github.com/riywo/node-build.git\"\nend\n```\n\n# Serverspec\n```ndenv_spec.rb\nrequire 'spec_helper'\n\ndescribe command('source /etc/profile.d/ndenv.sh; which ndenv') do\n  let(:disable_sudo) { true }\n  its(:stdout) { should match %r{/usr/local/ndenv/bin/ndenv} }\nend\n\ndescribe file('/etc/profile.d/ndenv.sh') do\n  it { should be_file }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 644 }\n  its(:content) { should match(/^export NDENV_ROOT=\"\\/usr\\/local\\/ndenv\"$/) }\n  its(:content) { should match(/^export PATH=\"\\${NDENV_ROOT}\\/bin:\\${PATH}\"$/) }\n  its(:content) { should match(/^eval \"\\$\\(ndenv init --no-rehash -\\)\"$/) }\nend\n\ndescribe file('/usr/local/ndenv/plugins') do\n  it { should be_directory }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 755 }\nend\n\ndescribe file('/usr/local/ndenv/plugins/node-build') do\n  it { should be_directory }\n  it { should be_owned_by 'root' }\n  it { should be_grouped_into 'root' }\n  it { should be_mode 755 }\nend\n```\n\n# spec\u5b9f\u884c\n```\n$ bundle exec rake spec\n```\n\u5b9f\u884c\u7d50\u679c\u306f\u8d64\n\n# \u30ec\u30b7\u30d4 dry-run\n```\n$ bundle exec itamae ssh -h \u30db\u30b9\u30c8\u540d -n recipes/ndenv.rb\n```\n# \u30ec\u30b7\u30d4\u5b9f\u884c\n```\n$ bundle exec itamae ssh -h \u30db\u30b9\u30c8\u540d recipes/ndenv.rb\n```\n\n# spec\u518d\u5b9f\u884c\n```\n$ bundle exec rake spec\n```\n\u5b9f\u884c\u7d50\u679c\u304c\u7dd1\u306b\u306a\u308c\u3070OK\n\n# \u78ba\u8a8d\nssh\u3067\u30b5\u30fc\u30d0\u306b\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\n```\n$ ndenv -v\n```\n"}