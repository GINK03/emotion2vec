{"tags": ["\u8106\u5f31\u6027", "Ruby", "openssl"], "context": " More than 1 year has passed since last update.\n\n\u6982\u8981\n\u5148\u65e5\u3001OpenSSL\u306e\u8106\u5f31\u6027\uff08CVE-2015-1793\uff09\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\nJVN\u306eCVE-2015-1793\u306e\u30da\u30fc\u30b8\u3092\u898b\u308b\u3068\u6df1\u523b\u5ea6\uff0d\u9ad8\u3068\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\u3069\u3046\u3044\u3046\u3082\u306e\u306a\u306e\u304b\u8abf\u3079\u307e\u3057\u305f\u3002\nOpenSSL\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u898b\u308b\u3068\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304c\u516c\u958b\u3055\u308c\u3001\u653b\u6483\u53ef\u80fd\u306a\u72b6\u6cc1\u306b\u3064\u3044\u3066\u8aac\u660e\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u8aad\u307f\u307e\u3057\u305f\u3002\n\u3053\u308c\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306a\u56f3\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\nrootCA (self-signed)\n   |\ninterCA\n  |\nsubinterCA       subinterCA (self-signed)\n  |                   |\nleaf ------------------\n  |\nbad\n\n\u307e\u305a\u3053\u308c\u3092\u898b\u3066\u601d\u3063\u305f\u306e\u306f\u3001\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3063\u3066\u5206\u5c90\u3042\u308b\u306e...??\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\nsubinterCA(self-signed)\u3063\u3066root CA\u306a\u306e\u306b\u3001\u305d\u3053\u306e\u767a\u884c\u3057\u305f\u7f72\u540d\u66f8\u306b\u5bfe\u3057\u3066interCA\u304c\u7f72\u540d\u3059\u308b\u3068\u3044\u3046\u72b6\u6cc1\u3042\u308b\u306e\u304b\u306a\u3002\n\u307e\u305a\u305d\u3053\u304b\u3089\u3044\u304d\u306a\u308a\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30b0\u30b0\u308a\u7d9a\u3051\u3088\u3046\u3084\u304f\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308b\u3089\u3057\u3044\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u3067\u3059\u3002\n\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3063\u3066\u4f55\uff1f\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u8d77\u304d\u3046\u308b\u72b6\u6cc1\u304c\u7406\u89e3\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306b\u306a\u305c\u4eca\u56de\u306e\u8106\u5f31\u6027\u304c\u751f\u307e\u308c\u305f\u306e\u304b\u8abf\u3079\u307e\u3057\u305f\u3002\n\u5148\u307b\u3069\u306eOpenSSL\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u3044\u3066\u3082\u3001interCA\u304croots.pem\u306b\u5165\u3063\u3066\u3044\u3066rootCA\u306f\u5165\u3063\u3066\u306a\u3044\u306e\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u3060\uff01\u3068\u3044\u3046\u611f\u3058\u3067\u3057\u305f\u3002\n\u300crootCA\u304c\u3044\u308b\u306e\u306broots.pem\u306b\u5165\u3063\u3066\u306a\u3044\u304b\u3089\u30c1\u30a7\u30fc\u30f3\u306e\u6bb5\u5dee\u304c\u5f71\u97ff\u3042\u308b\u3093\u3058\u3083\u306a\u3044\uff1f\u300d\u306a\u3069\u306e\u6307\u6458\u3092\u90e8\u7f72\u306e\u65b9\u304b\u3089\u53d7\u3051\u305f\u308a\u3082\u3057\u307e\u3057\u305f\u304c\u5b8c\u5168\u306b\u306f\u7406\u89e3\u3067\u304d\u305a\u3001\u3069\u3046\u3057\u305f\u3082\u306e\u304b\u3068\u56f0\u3063\u3066\u3044\u305f\u3089\u975e\u5e38\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u89e3\u8aac\u8a18\u4e8b\u304c\u51fa\u3066\u3044\u307e\u3057\u305f\u3002\n\nOpenSSL\u306e\u8106\u5f31\u6027(CVE-2015-1793)\u306b\u3088\u308bAlt\u30c1\u30a7\u30fc\u30f3\u8a3c\u660e\u66f8\u507d\u9020\u306e\u4ed5\u7d44\u307f\n\n\u3053\u308c\u8aad\u3081\u3070\u5168\u3066\u7406\u89e3\u3067\u304d\u308b\u306d\u301c\u3068\u3044\u3046\u3053\u3068\u3067\u7279\u306b\u8a00\u3046\u3053\u3068\u306f\u306a\u3044\u3067\u3059\u3002\u7d42\u308f\u308a\u3002\n\u3068\u3044\u3046\u306e\u3082\u30a2\u30ec\u306a\u306e\u3067Ruby\u3067\u4eca\u56de\u306e\u8106\u5f31\u6027\u3092\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e0a\u8a18\u3067leaf\u304cCA=FALSE\u3067\u3001CA\u3067\u306f\u306a\u3044\u306e\u306b\u8a3c\u660e\u66f8\u304c\u767a\u884c\u3067\u304d\u3066\u3057\u307e\u3046\uff08\u691c\u8a3c\u3092\u901a\u904e\u3057\u3066\u3057\u307e\u3046\uff09\u3068\u3044\u3046\u306e\u304c\u4eca\u56de\u306e\u8106\u5f31\u6027\u306a\u306e\u3067\u3059\u304c\u3001\u72b6\u6cc1\u306e\u8a73\u7d30\u306fopenssl\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304b\u4e0a\u8a18\u306e\u30d6\u30ed\u30b0\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\u691c\u8a3c\u3060\u3051\u884c\u3044\u307e\u3059\u3002\n\u4f55\u304b\u691c\u8a3c\u304c\u304a\u304b\u3057\u304b\u3063\u305f\u3089\u6307\u6458\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\nRuby\u521d\u5fc3\u8005\u306a\u306e\u3067\u66f8\u304d\u65b9\u306b\u3064\u3044\u3066\u306e\u3054\u6307\u6458\u3082\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n\u74b0\u5883\n\nOS\n\n\nCentOS 6.6\n\n\nOpenSSL\n\n\n1.0.1n(\u8106\u5f31\u7248\uff09\n1.0.1p(\u4fee\u6b63\u7248\uff09\n\n\nRuby\n\n\n2.2.0\n\n\n\n\n\u53c2\u8003\u30b5\u30a4\u30c8\n\nOpenSSL \u306b\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u306e\u691c\u8a3c\u4e0d\u5099\u306e\u8106\u5f31\u6027\nOpenSSL\u306e\u8106\u5f31\u6027(CVE-2015-1793)\u306b\u3088\u308bAlt\u30c1\u30a7\u30fc\u30f3\u8a3c\u660e\u66f8\u507d\u9020\u306e\u4ed5\u7d44\u307f\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3063\u3066\u4f55\uff1f\nLinux\u306bApache\u3068OpenSSL\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\nRuby\u306eOpenSSL::OPENSSL_VERSION\u306f\u306a\u305c\u5b9a\u6570\uff1f\n\n\n\u691c\u8a3c\n\u307e\u305a\u81ea\u5206\u306eopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8abf\u3079\u308b\u3068\u30011.0.1e\u3067\u4eca\u56de\u306e\u5bfe\u8c61\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n$ openssl version\nOpenSSL 1.0.1e-fips 11 Feb 2013\n\n\u305d\u3053\u3067\u5bfe\u8c61\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u305d\u308c\u305e\u308c\u843d\u3068\u3057\u3066\u304d\u3066\u3001/opt\u4ee5\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nopenssl-1.0.1n\n\nopenssl\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u521d\u306bopenssl-1.0.1n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ wget ftp://ftp.openssl.org/source/openssl-1.0.1n.tar.gz\n$ tar zxvf openssl-1.0.1n.tar.gz\n$ cd openssl-1.0.1n\n$ ./config --prefix=/opt/openssl-1.0.1n shared zlib\n$ make\n$ sudo make install\n\n\u3053\u308c\u3067openssl-1.0.1n\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\nRuby\u306e\u66f4\u65b0\nRuby\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u308bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1e-fips 11 Feb 2013\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u65b0\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fopenssl-1.0.1n\u3092\u6307\u5b9a\u3057\u3066\u518d\u5ea6rbenv\u3067Ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n$ CONFIGURE_OPTS=\"--with-openssl-dir=/opt/openssl1.0.1n\" rbenv install -f 2.2.0\n\n\u4e0a\u8a18\u306e\u3088\u3046\u306bopenssl\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u3068Ruby\u3067\u4f7f\u3046openssl\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u304d\u307e\u3059\u3002\n\u518d\u5ea6\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1n 11 Jun 2015\n\n\u7121\u4e8b\u306b\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n\u691c\u8a3c\u30b3\u30fc\u30c9\n\u3067\u306f\u5b9f\u969b\u306b\u691c\u8a3c\u7528\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\u8a3c\u660e\u66f8\u306f\u5148\u7a0b\u306eopenssl\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u30c6\u30b9\u30c8\u7528\u306b\u63d0\u4f9b\u3055\u308c\u3066\u304d\u305f\u306e\u3067\u305d\u308c\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n\u305d\u308c\u3089\u3092\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3068\u3057\u3066\u7528\u3044\u308bSSL\u30b5\u30fc\u30d0\u3068\u3001\u305d\u308c\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n\u30b5\u30fc\u30d0\n\u30b5\u30fc\u30d0\u5074\u306f12345\u756a\u30dd\u30fc\u30c8\u3067listen\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3068\u3057\u3066\u306fbad.pem\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u5bfe\u5fdc\u3059\u308b\u79d8\u5bc6\u9375\u306fbad.key\u3067\u3059\u3002\nbad.pem\u306e\u30b3\u30e2\u30f3\u30cd\u30fc\u30e0\uff08\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u540d\uff09\u306fbad\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30b5\u30fc\u30d0\u306e\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001leaf\u304b\u3089interCA\u307e\u3067\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u9001\u308a\u307e\u3059\u3002\n\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3053\u308c\u3089\u306e\u8a3c\u660e\u66f8\u3092extra_chain_cert\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306f\u63a5\u7d9a\u3057\u3066\u304d\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306bSuccess\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\nrootCA (self-signed)\n   |\ninterCA\n  |\nsubinterCA\n  | \nleaf\n  |\nbad\n\n\u4ee5\u4e0b\u304c\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\nserver.rb\nrequire 'socket'\nrequire 'openssl'\n\nport = 12345\nbad = 'certs/bad.pem'\nbad_key = 'certs/bad.key'\ninterCA = 'certs/interCA.pem'\nsubinterCA = 'certs/subinterCA.pem'\nleaf = 'certs/leaf.pem'\n\nctx = OpenSSL::SSL::SSLContext.new\nctx.cert, *ctx.extra_chain_cert = [bad, leaf, subinterCA, interCA].map{|cert| OpenSSL::X509::Certificate.new File.read(cert)}\nctx.key = OpenSSL::PKey::RSA.new File.read(bad_key)\n\nserver = TCPServer.new port\nsslServer = OpenSSL::SSL::SSLServer.new server, ctx\n\nwhile client = sslServer.accept\n  client.puts \"HTTP/1.1 200 OK\\r\\nContent-Length: 7\\r\\n\\r\\nSuccess\"\nend\n\n\n\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\nroots.pem\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u4fe1\u983c\u3059\u308b\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3092\u5165\u308c\u307e\u3059\u3002\n\u4eca\u56de\u306e\u5834\u5408\u306finterCA.pem\u3068subinterCA-ss.pem\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\nlocalhost\u306e12345\u756a\u30dd\u30fc\u30c8\u3067\u30b5\u30fc\u30d0\u304clisten\u3057\u3066\u3044\u308b\u306e\u3067\u305d\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u5f97\u3089\u308c\u305f\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30dc\u30c7\u30a3\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\u305f\u3060\u3057\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u540d\u306fbad\u3067\u3059\u304clocalhost\u3067listen\u3057\u3066\u3044\u308b\u306e\u3067\u3001bad\u304c127.0.0.1\u3067\u89e3\u6c7a\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n/etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n127.0.0.1   bad\n\n\n\u4ee5\u4e0b\u304c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u306a\u308a\u307e\u3059\u3002\n\nclient.rb\nrequire 'net/https'\nhttps = Net::HTTP.new('bad', 12345)\nhttps.use_ssl = true\nhttps.verify_mode = OpenSSL::SSL::VERIFY_PEER\nhttps.ca_file = 'certs/roots.pem'\n\nhttps.start { |h|\n  response = h.get(\"/\")\n  puts response.body\n}\n\n\ngist\u306b\u3082\u6295\u7a3f\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\nhttps://gist.github.com/knqyf263/57ec60dfe0821320505d\n\n\u5b9f\u884c\n\u6e96\u5099\u304c\u6574\u3063\u305f\u306e\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\nleaf\u306fCA\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u8a3c\u660e\u66f8\u306e\u691c\u8a3c\u306f\u5931\u6557\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n$ ruby server.rb &\n[1] 25798\n$ ruby client.rb\nSuccess\n\nSuccess\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u5206\u304b\u308b\u3088\u3046\u306b\u691c\u8a3c\u3092\u901a\u904e\u3057\u63a5\u7d9a\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\nopenssl-1.0.1p\n\nopenssl\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306e\u8106\u5f31\u6027\u304c\u4fee\u6b63\u3055\u308c\u305fopenssl-1.0.1p\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n$ wget ftp://ftp.openssl.org/source/openssl-1.0.1p.tar.gz\n$ tar zxvf openssl-1.0.1p.tar.gz\n$ cd openssl-1.0.1p\n$ ./config --prefix=/opt/openssl-1.0.1p shared zlib\n$ make\n$ sudo make install\n\nopenssl-1.0.1p\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\nRuby\u306e\u66f4\u65b0\nRuby\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u308bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30921.0.1p\u3078\u66f4\u65b0\u3057\u307e\u3059\u3002\n$ CONFIGURE_OPTS=\"--with-openssl-dir=/opt/openssl1.0.1p\" rbenv install -f 2.2.0\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1p 9 Jul 2015\n\nopenssl-1.0.1p\u3078\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002\n\n\u5b9f\u884c\n\u3067\u306f\u5148\u307b\u3069\u306e\u691c\u8a3c\u3068\u540c\u3058\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\u305d\u306e\u524d\u306b\u5148\u307b\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u6b8b\u3063\u3066\u3044\u308b\u5834\u5408\u306fkill\u3057\u3066\u304f\u3060\u3055\u3044\uff08\u4e0a\u8a18\u306e\u4f8b\u3067\u306fkill -9 25798\uff09\u3002\n$ ruby server.rb &\n[1] 25798\n$ ruby client.rb\n/home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `connect': SSL_connect returned=1 errno=0 state=error: certificate verify failed (OpenSSL::SSL::SSLError)\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `block in connect'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/timeout.rb:67:in `timeout'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `connect'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:863:in `do_start'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:852:in `start'\n        from client.rb:8:in `<main>'\n\n\u4eca\u5ea6\u306fcertificate verify failed\u3068\u8868\u793a\u3055\u308c\u304d\u3061\u3093\u3068\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u8106\u5f31\u6027\u304c\u4fee\u6b63\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n\u307e\u3068\u3081\nPKI\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u3064\u3082\u308a\u3067\u3057\u305f\u304c\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3068\u304b\u3042\u3063\u305f\u308a\u3067\u5168\u7136\u7406\u89e3\u3067\u304d\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u52c9\u5f37\u306e\u305f\u3081\u306bRuby\u3067\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u5c11\u3057\u7406\u89e3\u304c\u6df1\u307e\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\n\u6df1\u523b\u5ea6\u304c\u9ad8\u306e\u3082\u306e\u306f\u4f59\u88d5\u304c\u3042\u308c\u3070\u691c\u8a3c\u3057\u3066\u3044\u304d\u305f\u3044\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b8c\u5168\u306b\u81ea\u5df1\u6e80\u8db3\u3067\u3059\u304c\u4e00\u5fdc\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n#\u6982\u8981\n\u5148\u65e5\u3001OpenSSL\u306e\u8106\u5f31\u6027\uff08CVE-2015-1793\uff09\u304c\u767a\u8868\u3055\u308c\u307e\u3057\u305f\u3002\n[JVN\u306eCVE-2015-1793\u306e\u30da\u30fc\u30b8](http://jvn.jp/vu/JVNVU99160787/)\u3092\u898b\u308b\u3068`\u6df1\u523b\u5ea6\uff0d\u9ad8`\u3068\u306a\u3063\u3066\u3044\u305f\u306e\u3067\u3001\u3069\u3046\u3044\u3046\u3082\u306e\u306a\u306e\u304b\u8abf\u3079\u307e\u3057\u305f\u3002\n[OpenSSL\u306e\u30ea\u30dd\u30b8\u30c8\u30ea](https://github.com/openssl/openssl/commit/593e9c638c58e1a510c519db0d024527113330f3#diff-34e5085afc62aa2dd21f6e952250f3bfR104)\u3092\u898b\u308b\u3068\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304c\u516c\u958b\u3055\u308c\u3001\u653b\u6483\u53ef\u80fd\u306a\u72b6\u6cc1\u306b\u3064\u3044\u3066\u8aac\u660e\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u8aad\u307f\u307e\u3057\u305f\u3002\n\u3053\u308c\u3092\u898b\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306a\u56f3\u306b\u306a\u3063\u3066\u3044\u307e\u3057\u305f\u3002\n\n```\nrootCA (self-signed)\n   |\ninterCA\n  |\nsubinterCA       subinterCA (self-signed)\n  |                   |\nleaf ------------------\n  |\nbad\n```\n\n\u307e\u305a\u3053\u308c\u3092\u898b\u3066\u601d\u3063\u305f\u306e\u306f\u3001\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u3063\u3066\u5206\u5c90\u3042\u308b\u306e...??\u3068\u3044\u3046\u3053\u3068\u3067\u3057\u305f\u3002\nsubinterCA(self-signed)\u3063\u3066root CA\u306a\u306e\u306b\u3001\u305d\u3053\u306e\u767a\u884c\u3057\u305f\u7f72\u540d\u66f8\u306b\u5bfe\u3057\u3066interCA\u304c\u7f72\u540d\u3059\u308b\u3068\u3044\u3046\u72b6\u6cc1\u3042\u308b\u306e\u304b\u306a\u3002\n\u307e\u305a\u305d\u3053\u304b\u3089\u3044\u304d\u306a\u308a\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u30b0\u30b0\u308a\u7d9a\u3051\u3088\u3046\u3084\u304f\u5206\u304b\u308a\u307e\u3057\u305f\u3002\n\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308b\u3089\u3057\u3044\u3067\u3059\u3002\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u304c\u308f\u304b\u308a\u3084\u3059\u304b\u3063\u305f\u3067\u3059\u3002\n\n- [\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3063\u3066\u4f55\uff1f](http://brenhilt.com/tech/2013/0211)\n\n\u3068\u3044\u3046\u3053\u3068\u3067\u8d77\u304d\u3046\u308b\u72b6\u6cc1\u304c\u7406\u89e3\u3067\u304d\u305f\u306e\u3067\u3001\u6b21\u306b\u306a\u305c\u4eca\u56de\u306e\u8106\u5f31\u6027\u304c\u751f\u307e\u308c\u305f\u306e\u304b\u8abf\u3079\u307e\u3057\u305f\u3002\n\u5148\u307b\u3069\u306eOpenSSL\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u8aad\u3093\u3067\u3044\u3066\u3082\u3001interCA\u304c`roots.pem`\u306b\u5165\u3063\u3066\u3044\u3066rootCA\u306f\u5165\u3063\u3066\u306a\u3044\u306e\u306f\u3069\u3046\u3044\u3046\u3053\u3068\u3060\uff01\u3068\u3044\u3046\u611f\u3058\u3067\u3057\u305f\u3002\n\u300crootCA\u304c\u3044\u308b\u306e\u306b`roots.pem`\u306b\u5165\u3063\u3066\u306a\u3044\u304b\u3089\u30c1\u30a7\u30fc\u30f3\u306e\u6bb5\u5dee\u304c\u5f71\u97ff\u3042\u308b\u3093\u3058\u3083\u306a\u3044\uff1f\u300d\u306a\u3069\u306e\u6307\u6458\u3092\u90e8\u7f72\u306e\u65b9\u304b\u3089\u53d7\u3051\u305f\u308a\u3082\u3057\u307e\u3057\u305f\u304c\u5b8c\u5168\u306b\u306f\u7406\u89e3\u3067\u304d\u305a\u3001\u3069\u3046\u3057\u305f\u3082\u306e\u304b\u3068\u56f0\u3063\u3066\u3044\u305f\u3089\u975e\u5e38\u306b\u308f\u304b\u308a\u3084\u3059\u3044\u89e3\u8aac\u8a18\u4e8b\u304c\u51fa\u3066\u3044\u307e\u3057\u305f\u3002\n\n- [OpenSSL\u306e\u8106\u5f31\u6027(CVE-2015-1793)\u306b\u3088\u308bAlt\u30c1\u30a7\u30fc\u30f3\u8a3c\u660e\u66f8\u507d\u9020\u306e\u4ed5\u7d44\u307f](http://d.hatena.ne.jp/jovi0608/20150710/1436521488)\n\n\u3053\u308c\u8aad\u3081\u3070\u5168\u3066\u7406\u89e3\u3067\u304d\u308b\u306d\u301c\u3068\u3044\u3046\u3053\u3068\u3067\u7279\u306b\u8a00\u3046\u3053\u3068\u306f\u306a\u3044\u3067\u3059\u3002\u7d42\u308f\u308a\u3002\n\u3068\u3044\u3046\u306e\u3082\u30a2\u30ec\u306a\u306e\u3067Ruby\u3067\u4eca\u56de\u306e\u8106\u5f31\u6027\u3092\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u4e0a\u8a18\u3067leaf\u304c`CA=FALSE`\u3067\u3001CA\u3067\u306f\u306a\u3044\u306e\u306b\u8a3c\u660e\u66f8\u304c\u767a\u884c\u3067\u304d\u3066\u3057\u307e\u3046\uff08\u691c\u8a3c\u3092\u901a\u904e\u3057\u3066\u3057\u307e\u3046\uff09\u3068\u3044\u3046\u306e\u304c\u4eca\u56de\u306e\u8106\u5f31\u6027\u306a\u306e\u3067\u3059\u304c\u3001\u72b6\u6cc1\u306e\u8a73\u7d30\u306fopenssl\u306e\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304b\u4e0a\u8a18\u306e\u30d6\u30ed\u30b0\u3092\u53c2\u7167\u3057\u3066\u4e0b\u3055\u3044\u3002\n\u3053\u3053\u3067\u306f\u691c\u8a3c\u3060\u3051\u884c\u3044\u307e\u3059\u3002\n\u4f55\u304b\u691c\u8a3c\u304c\u304a\u304b\u3057\u304b\u3063\u305f\u3089\u6307\u6458\u9802\u3051\u308c\u3070\u3068\u601d\u3044\u307e\u3059\u3002\nRuby\u521d\u5fc3\u8005\u306a\u306e\u3067\u66f8\u304d\u65b9\u306b\u3064\u3044\u3066\u306e\u3054\u6307\u6458\u3082\u304a\u5f85\u3061\u3057\u3066\u304a\u308a\u307e\u3059\u3002\n\n#\u74b0\u5883\n- OS\n - CentOS 6.6\n- OpenSSL\n\t- 1.0.1n(\u8106\u5f31\u7248\uff09\n\t- 1.0.1p(\u4fee\u6b63\u7248\uff09\n- Ruby\n\t- 2.2.0\n\n#\u53c2\u8003\u30b5\u30a4\u30c8\n- [OpenSSL \u306b\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u306e\u691c\u8a3c\u4e0d\u5099\u306e\u8106\u5f31\u6027](http://jvn.jp/vu/JVNVU99160787/)\n- [OpenSSL\u306e\u8106\u5f31\u6027(CVE-2015-1793)\u306b\u3088\u308bAlt\u30c1\u30a7\u30fc\u30f3\u8a3c\u660e\u66f8\u507d\u9020\u306e\u4ed5\u7d44\u307f](http://d.hatena.ne.jp/jovi0608/20150710/1436521488)\n- [\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3063\u3066\u4f55\uff1f](http://brenhilt.com/tech/2013/0211)\n- [Linux\u306bApache\u3068OpenSSL\u3092\u30bd\u30fc\u30b9\u304b\u3089\u30d3\u30eb\u30c9\u3057\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b](http://qiita.com/DQNEO/items/3613cc1d87c01121a9e2)\n- [Ruby\u306eOpenSSL::OPENSSL_VERSION\u306f\u306a\u305c\u5b9a\u6570\uff1f](http://masutaka.net/chalow/2014-04-08-1.html)\n\n#\u691c\u8a3c\n\u307e\u305a\u81ea\u5206\u306eopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u8abf\u3079\u308b\u3068\u30011.0.1e\u3067\u4eca\u56de\u306e\u5bfe\u8c61\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\n``` console\n$ openssl version\nOpenSSL 1.0.1e-fips 11 Feb 2013\n```\n\n\u305d\u3053\u3067\u5bfe\u8c61\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u305d\u308c\u305e\u308c\u843d\u3068\u3057\u3066\u304d\u3066\u3001`/opt`\u4ee5\u4e0b\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n##openssl-1.0.1n\n### openssl\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u6700\u521d\u306bopenssl-1.0.1n\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n``` console\n$ wget ftp://ftp.openssl.org/source/openssl-1.0.1n.tar.gz\n$ tar zxvf openssl-1.0.1n.tar.gz\n$ cd openssl-1.0.1n\n$ ./config --prefix=/opt/openssl-1.0.1n shared zlib\n$ make\n$ sudo make install\n```\n\u3053\u308c\u3067openssl-1.0.1n\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n###Ruby\u306e\u66f4\u65b0\nRuby\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u308bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n``` console\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1e-fips 11 Feb 2013\n```\n\n\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u65b0\u3057\u304f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305fopenssl-1.0.1n\u3092\u6307\u5b9a\u3057\u3066\u518d\u5ea6rbenv\u3067Ruby\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n``` console\n$ CONFIGURE_OPTS=\"--with-openssl-dir=/opt/openssl1.0.1n\" rbenv install -f 2.2.0\n```\n\u4e0a\u8a18\u306e\u3088\u3046\u306bopenssl\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u3068Ruby\u3067\u4f7f\u3046openssl\u3092\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3067\u304d\u307e\u3059\u3002\n\u518d\u5ea6\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u304b\u3081\u307e\u3059\u3002\n\n``` console\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1n 11 Jun 2015\n```\n\u7121\u4e8b\u306b\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u307f\u305f\u3044\u3067\u3059\u3002\n\n###\u691c\u8a3c\u30b3\u30fc\u30c9\n\u3067\u306f\u5b9f\u969b\u306b\u691c\u8a3c\u7528\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u307e\u3059\u3002\n\u8a3c\u660e\u66f8\u306f\u5148\u7a0b\u306eopenssl\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u30c6\u30b9\u30c8\u7528\u306b\u63d0\u4f9b\u3055\u308c\u3066\u304d\u305f\u306e\u3067\u305d\u308c\u3092\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n\u305d\u308c\u3089\u3092\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3068\u3057\u3066\u7528\u3044\u308bSSL\u30b5\u30fc\u30d0\u3068\u3001\u305d\u308c\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n####\u30b5\u30fc\u30d0\n\u30b5\u30fc\u30d0\u5074\u306f12345\u756a\u30dd\u30fc\u30c8\u3067listen\u3057\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u8a3c\u660e\u66f8\u3068\u3057\u3066\u306f`bad.pem`\u3092\u5229\u7528\u3057\u307e\u3059\u3002\u5bfe\u5fdc\u3059\u308b\u79d8\u5bc6\u9375\u306f`bad.key`\u3067\u3059\u3002\n`bad.pem`\u306e\u30b3\u30e2\u30f3\u30cd\u30fc\u30e0\uff08\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u540d\uff09\u306fbad\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\n\u3053\u306e\u30b5\u30fc\u30d0\u306e\u8a3c\u660e\u66f8\u30c1\u30a7\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001leaf\u304b\u3089interCA\u307e\u3067\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306b\u9001\u308a\u307e\u3059\u3002\n\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u306f\u3053\u308c\u3089\u306e\u8a3c\u660e\u66f8\u3092`extra_chain_cert`\u306b\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u30b5\u30fc\u30d0\u3068\u3057\u3066\u306f\u63a5\u7d9a\u3057\u3066\u304d\u305f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306bSuccess\u3092\u8fd4\u3059\u3060\u3051\u3067\u3059\u3002\n\n```\nrootCA (self-signed)\n   |\ninterCA\n  |\nsubinterCA\n  | \nleaf\n  |\nbad\n```\n\n\u4ee5\u4e0b\u304c\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\n```ruby:server.rb\nrequire 'socket'\nrequire 'openssl'\n \nport = 12345\nbad = 'certs/bad.pem'\nbad_key = 'certs/bad.key'\ninterCA = 'certs/interCA.pem'\nsubinterCA = 'certs/subinterCA.pem'\nleaf = 'certs/leaf.pem'\n \nctx = OpenSSL::SSL::SSLContext.new\nctx.cert, *ctx.extra_chain_cert = [bad, leaf, subinterCA, interCA].map{|cert| OpenSSL::X509::Certificate.new File.read(cert)}\nctx.key = OpenSSL::PKey::RSA.new File.read(bad_key)\n \nserver = TCPServer.new port\nsslServer = OpenSSL::SSL::SSLServer.new server, ctx\n \nwhile client = sslServer.accept\n  client.puts \"HTTP/1.1 200 OK\\r\\nContent-Length: 7\\r\\n\\r\\nSuccess\"\nend\n```\n\n####\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\n`roots.pem`\u306f\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u4fe1\u983c\u3059\u308b\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3092\u5165\u308c\u307e\u3059\u3002\n\u4eca\u56de\u306e\u5834\u5408\u306f`interCA.pem`\u3068`subinterCA-ss.pem`\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\nlocalhost\u306e12345\u756a\u30dd\u30fc\u30c8\u3067\u30b5\u30fc\u30d0\u304clisten\u3057\u3066\u3044\u308b\u306e\u3067\u305d\u3053\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\n\u305d\u3057\u3066\u5f97\u3089\u308c\u305f\u30ec\u30b9\u30dd\u30f3\u30b9\u306e\u30dc\u30c7\u30a3\u3092\u8868\u793a\u3059\u308b\u3060\u3051\u306e\u7c21\u5358\u306a\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u3059\u3002\n\u305f\u3060\u3057\u30b5\u30fc\u30d0\u306e\u30c9\u30e1\u30a4\u30f3\u540d\u306fbad\u3067\u3059\u304c`localhost`\u3067listen\u3057\u3066\u3044\u308b\u306e\u3067\u3001bad\u304c`127.0.0.1`\u3067\u89e3\u6c7a\u3055\u308c\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```config:/etc/hosts\n127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6\n127.0.0.1   bad\n```\n\n\u4ee5\u4e0b\u304c\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u306a\u308a\u307e\u3059\u3002\n\n```ruby:client.rb\nrequire 'net/https'\nhttps = Net::HTTP.new('bad', 12345)\nhttps.use_ssl = true\nhttps.verify_mode = OpenSSL::SSL::VERIFY_PEER\nhttps.ca_file = 'certs/roots.pem'\n \nhttps.start { |h|\n  response = h.get(\"/\")\n  puts response.body\n}\n```\n\ngist\u306b\u3082\u6295\u7a3f\u3057\u3066\u304a\u304d\u307e\u3057\u305f\u3002\nhttps://gist.github.com/knqyf263/57ec60dfe0821320505d\n\n###\u5b9f\u884c\n\u6e96\u5099\u304c\u6574\u3063\u305f\u306e\u3067\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\nleaf\u306fCA\u3067\u306f\u306a\u3044\u306e\u3067\u3001\u8a3c\u660e\u66f8\u306e\u691c\u8a3c\u306f\u5931\u6557\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\n```console\n$ ruby server.rb &\n[1] 25798\n$ ruby client.rb\nSuccess\n```\nSuccess\u304c\u8fd4\u3063\u3066\u304d\u3066\u3044\u308b\u3053\u3068\u304b\u3089\u5206\u304b\u308b\u3088\u3046\u306b\u691c\u8a3c\u3092\u901a\u904e\u3057\u63a5\u7d9a\u3067\u304d\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n##openssl-1.0.1p\n### openssl\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u4eca\u56de\u306e\u8106\u5f31\u6027\u304c\u4fee\u6b63\u3055\u308c\u305fopenssl-1.0.1p\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3066\u304d\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n``` console\n$ wget ftp://ftp.openssl.org/source/openssl-1.0.1p.tar.gz\n$ tar zxvf openssl-1.0.1p.tar.gz\n$ cd openssl-1.0.1p\n$ ./config --prefix=/opt/openssl-1.0.1p shared zlib\n$ make\n$ sudo make install\n```\nopenssl-1.0.1p\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\n\n###Ruby\u306e\u66f4\u65b0\nRuby\u3067\u5229\u7528\u3055\u308c\u3066\u3044\u308bopenssl\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092`1.0.1p`\u3078\u66f4\u65b0\u3057\u307e\u3059\u3002\n\n``` console\n$ CONFIGURE_OPTS=\"--with-openssl-dir=/opt/openssl1.0.1p\" rbenv install -f 2.2.0\n$ ruby -ropenssl -rfiddle -e 'puts Fiddle::Function.new(Fiddle.dlopen(nil)[\"SSLeay_version\"], [Fiddle::TYPE_INT], Fiddle::TYPE_VOIDP).call(0)'\nOpenSSL 1.0.1p 9 Jul 2015\n```\nopenssl-1.0.1p\u3078\u66f4\u65b0\u3055\u308c\u307e\u3057\u305f\u3002\n\n###\u5b9f\u884c\n\u3067\u306f\u5148\u307b\u3069\u306e\u691c\u8a3c\u3068\u540c\u3058\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u3066\u307f\u307e\u3059\u3002\n\u305d\u306e\u524d\u306b\u5148\u307b\u3069\u306e\u30d7\u30ed\u30bb\u30b9\u304c\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u306b\u6b8b\u3063\u3066\u3044\u308b\u5834\u5408\u306fkill\u3057\u3066\u304f\u3060\u3055\u3044\uff08\u4e0a\u8a18\u306e\u4f8b\u3067\u306f`kill -9 25798`\uff09\u3002\n\n```console\n$ ruby server.rb &\n[1] 25798\n$ ruby client.rb\n/home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `connect': SSL_connect returned=1 errno=0 state=error: certificate verify failed (OpenSSL::SSL::SSLError)\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `block in connect'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/timeout.rb:67:in `timeout'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:920:in `connect'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:863:in `do_start'\n        from /home/vagrant/.rbenv/versions/2.2.0/lib/ruby/2.2.0/net/http.rb:852:in `start'\n        from client.rb:8:in `<main>'\n```\n\u4eca\u5ea6\u306f`certificate verify failed`\u3068\u8868\u793a\u3055\u308c\u304d\u3061\u3093\u3068\u5931\u6557\u3057\u307e\u3057\u305f\u3002\n\u3068\u3044\u3046\u3053\u3068\u3067\u8106\u5f31\u6027\u304c\u4fee\u6b63\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n#\u307e\u3068\u3081\nPKI\u3092\u7406\u89e3\u3057\u3066\u3044\u308b\u3064\u3082\u308a\u3067\u3057\u305f\u304c\u30af\u30ed\u30b9\u30eb\u30fc\u30c8\u8a3c\u660e\u66f8\u3068\u304b\u3042\u3063\u305f\u308a\u3067\u5168\u7136\u7406\u89e3\u3067\u304d\u3066\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u52c9\u5f37\u306e\u305f\u3081\u306bRuby\u3067\u691c\u8a3c\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u5c11\u3057\u7406\u89e3\u304c\u6df1\u307e\u3063\u305f\u6c17\u304c\u3057\u307e\u3059\u3002\n\u6df1\u523b\u5ea6\u304c\u9ad8\u306e\u3082\u306e\u306f\u4f59\u88d5\u304c\u3042\u308c\u3070\u691c\u8a3c\u3057\u3066\u3044\u304d\u305f\u3044\u306a\u3068\u601d\u3044\u307e\u3059\u3002\n\u5b8c\u5168\u306b\u81ea\u5df1\u6e80\u8db3\u3067\u3059\u304c\u4e00\u5fdc\u6295\u7a3f\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n"}