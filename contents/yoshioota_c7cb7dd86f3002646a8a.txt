{"context": " More than 1 year has passed since last update.\u8868\u984c\u306e\u901a\u308a\nu = User.last\nu.updated_at = nil #=> (1)\nu.with_lock do\n  u.updated_at #=> (1) \u3067\u306f\u7121\u304fDB\u306e\u5024\u306b\u306a\u308b\nend\n\n\u8a72\u5f53\u3059\u308bRails\u306e\u30bd\u30fc\u30b9\u306f\u3053\u3053\n\npessimistic.rb\nmodule ActiveRecord\n  module Locking\n    module Pessimistic\n      def lock!(lock = true)\n        reload(:lock => lock) if persisted?\n        self\n      end\n\n      def with_lock(lock = true)\n        transaction do\n          lock!(lock)\n          yield\n        end\n      end\n    end\n  end\nend\n\n\n\u8868\u984c\u306e\u901a\u308a\n\n```rb\nu = User.last\nu.updated_at = nil #=> (1)\nu.with_lock do\n  u.updated_at #=> (1) \u3067\u306f\u7121\u304fDB\u306e\u5024\u306b\u306a\u308b\nend\n```\n\n\u8a72\u5f53\u3059\u308bRails\u306e\u30bd\u30fc\u30b9\u306f\u3053\u3053\n\n```rb:pessimistic.rb\nmodule ActiveRecord\n  module Locking\n    module Pessimistic\n      def lock!(lock = true)\n        reload(:lock => lock) if persisted?\n        self\n      end\n\n      def with_lock(lock = true)\n        transaction do\n          lock!(lock)\n          yield\n        end\n      end\n    end\n  end\nend\n```\n", "tags": ["Rails", "ActiveRecord"]}