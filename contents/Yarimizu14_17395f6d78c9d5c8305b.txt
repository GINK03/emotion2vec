{"context": "Fluentd\u306e\u521d\u6b69\u306e\u521d\u6b69\u3002\n\n\u74b0\u5883\nUbuntu14.04 trusty\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\u516c\u5f0f\u30da\u30fc\u30b8\u306eInstallation\u304b\u3089\u4f7f\u3046Ubuntu\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30b3\u30de\u30f3\u30c9\u3092\u898b\u3064\u3051\u3066\u5b9f\u884c\u3002\n\u4eca\u56de\u306f14.04\u306a\u306e\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3002\n$curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n\n\n\u8d77\u52d5\u78ba\u8a8d\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8d77\u52d5\u3057\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\nsudo apt-get update\nsudo apt-get install nginx\n\n$sudo service nginx status\n * nginx is running\n\n\ntd-agent.conf\u306e\u8a2d\u5b9a\n\u4e00\u65e6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306e\u8a2d\u5b9a\u3092\u5168\u3066\u6d88\u3059\uff08\u30b5\u30f3\u30d7\u30eb\u306e\u8a2d\u5b9a\u304c\u30a8\u30e9\u30fc\u5410\u304f\u306e\u3067\uff09\nnginx\u306eaccess.log\u3092tail\u3057\u3066\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3059\u3002\n<source>\n  type tail\n  path /var/log/nginx/access.log\n  pos_file /var/log/td-agent/nginx-access.pos\n  format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \\[(?<time>[^\\]]*)\\] \"(?<method>\\S+)(?: +(?<path>[^ ]*) +\\S*)?\" (?<code>[^ ]*) (?<size>[^ ]*)(?: \"(?<referer>[^\\\"]*)\" \"(?<agent>[^\\\"]*)\" \"(?<forwarder>[^\\\"]*)\")?/\n  time_format %d/%b/%Y:%H:%M:%S %z\n  tag nginx.access\n</source>\n\n<match nginx.access>\n  @type stdout\n</match>\n\ntd-agent\u3092\u518d\u8d77\u52d5\u3059\u308b\nsudo service td-agent restart\n\ntd-agent\u306b/var/log/nginx/access.log\u306ePermission\u304c\u306a\u3044\u306e\u3067/var/log/td-agent.log\u306b\u30a8\u30e9\u30fc\u30ed\u30b0\u304c\u6d41\u308c\u305f\u3002\n2016-11-14 16:57:08 +0000 [error]: Permission denied @ rb_sysopen - /var/log/nginx/access.log\n  2016-11-14 16:57:08 +0000 [error]: suppressed same stacktrace\n\n\ntd-agent\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u3092\u5909\u3048\u308b\n/etc/init.d/td-agent\u306btd-agent\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u3092\u5909\u66f4\u3059\u308b\u8a2d\u5b9a\u304c\u3042\u308b\u306e\u3067\u601d\u3044\u5207\u3063\u3066root\u306b\u3059\u308b\u3002\n$ sudo vim /etc/init.d/td-agent\n\nTD_AGENT_USER=root\nTD_AGENT_GROUP=root\n\n\n\u5b9f\u884c\u78ba\u8a8d\n\u518d\u8d77\u52d5\u3059\u308b\u3002\nsudo service td-agent restart\n\nnginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5ea6\u306b/var/log/td-agent/td-agent.log\u306b\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\uff01\nvagrant@vagrant-ubuntu-trusty-64:~$ sudo tail -f /var/log/td-agent/td-agent.log\n2016-11-14 17:02:05 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n2016-11-14 17:02:14 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n2016-11-14 17:04:03 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n\nFluentd\u306e\u521d\u6b69\u306e\u521d\u6b69\u3002\n\n# \u74b0\u5883\n\nUbuntu14.04 trusty\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n[\u516c\u5f0f\u30da\u30fc\u30b8\u306eInstallation](http://docs.fluentd.org/articles/install-by-deb)\u304b\u3089\u4f7f\u3046Ubuntu\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30b3\u30de\u30f3\u30c9\u3092\u898b\u3064\u3051\u3066\u5b9f\u884c\u3002\n\u4eca\u56de\u306f14.04\u306a\u306e\u3067\u4ee5\u4e0b\u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```\n$curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-trusty-td-agent2.sh | sh\n```\n\n# \u8d77\u52d5\u78ba\u8a8d\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5b8c\u4e86\u3057\u305f\u3089\u8d77\u52d5\u3057\u3066\u308b\u304b\u78ba\u8a8d\u3059\u308b\n\n```\nsudo apt-get update\nsudo apt-get install nginx\n```\n\n```\n$sudo service nginx status\n * nginx is running\n```\n\n# `td-agent.conf`\u306e\u8a2d\u5b9a\n\n\u4e00\u65e6\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306e\u8a2d\u5b9a\u3092\u5168\u3066\u6d88\u3059\uff08\u30b5\u30f3\u30d7\u30eb\u306e\u8a2d\u5b9a\u304c\u30a8\u30e9\u30fc\u5410\u304f\u306e\u3067\uff09\n\nnginx\u306eaccess.log\u3092tail\u3057\u3066\u6a19\u6e96\u51fa\u529b\u306b\u51fa\u3059\u3002\n\n```\n<source>\n  type tail\n  path /var/log/nginx/access.log\n  pos_file /var/log/td-agent/nginx-access.pos\n  format /^(?<remote>[^ ]*) (?<host>[^ ]*) (?<user>[^ ]*) \\[(?<time>[^\\]]*)\\] \"(?<method>\\S+)(?: +(?<path>[^ ]*) +\\S*)?\" (?<code>[^ ]*) (?<size>[^ ]*)(?: \"(?<referer>[^\\\"]*)\" \"(?<agent>[^\\\"]*)\" \"(?<forwarder>[^\\\"]*)\")?/\n  time_format %d/%b/%Y:%H:%M:%S %z\n  tag nginx.access\n</source>\n\n<match nginx.access>\n  @type stdout\n</match>\n```\n\ntd-agent\u3092\u518d\u8d77\u52d5\u3059\u308b\n\n```\nsudo service td-agent restart\n```\n\ntd-agent\u306b`/var/log/nginx/access.log`\u306ePermission\u304c\u306a\u3044\u306e\u3067`/var/log/td-agent.log`\u306b\u30a8\u30e9\u30fc\u30ed\u30b0\u304c\u6d41\u308c\u305f\u3002\n\n```\n2016-11-14 16:57:08 +0000 [error]: Permission denied @ rb_sysopen - /var/log/nginx/access.log\n  2016-11-14 16:57:08 +0000 [error]: suppressed same stacktrace\n```\n\n# td-agent\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u3092\u5909\u3048\u308b\n\n`/etc/init.d/td-agent`\u306btd-agent\u306e\u5b9f\u884c\u30e6\u30fc\u30b6\u30fc\u3092\u5909\u66f4\u3059\u308b\u8a2d\u5b9a\u304c\u3042\u308b\u306e\u3067\u601d\u3044\u5207\u3063\u3066root\u306b\u3059\u308b\u3002\n\n```\n$ sudo vim /etc/init.d/td-agent\n```\n\n```\nTD_AGENT_USER=root\nTD_AGENT_GROUP=root\n```\n\n# \u5b9f\u884c\u78ba\u8a8d\n\n\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```\nsudo service td-agent restart\n```\n\nnginx\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5ea6\u306b`/var/log/td-agent/td-agent.log`\u306b\u30ed\u30b0\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u3063\u305f\uff01\n\n```\nvagrant@vagrant-ubuntu-trusty-64:~$ sudo tail -f /var/log/td-agent/td-agent.log\n2016-11-14 17:02:05 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n2016-11-14 17:02:14 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n2016-11-14 17:04:03 +0000 nginx.access: {\"remote\":\"192.168.33.1\",\"host\":\"-\",\"user\":\"-\",\"method\":\"GET\",\"path\":\"/\",\"code\":\"304\",\"size\":\"0\"}\n```\n", "tags": ["fluentd"]}