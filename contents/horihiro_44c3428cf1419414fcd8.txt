{"context": "\n\n\u306f\u3058\u3081\u306b\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\u3001ESP-WROOM-02\u958b\u767a\u30dc\u30fc\u30c9\u3067\u4f5c\u3063\u3066\u307f\u305f\u3002\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u72b6\u614b\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092API Gateway+Lambda\u3067\u3084\u308d\u3046\u3068\u3057\u305f\u304c\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u591a\u304f\u306a\u308b\u3068\u304a\u8ca1\u5e03\u4e8b\u60c5\u304c\u3001\u3001\u3001\u3068\u601d\u3044\u3001AWS IoT\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u3067\u304d\u306a\u3044\u304b\u8abf\u3079\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u30c9\u30f3\u30d4\u30b7\u30e3\u306a\u30e9\u30a4\u30d6\u30e9\u30eaaws-mqtt-websockets\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\n\n\u4e8b\u524d\u6e96\u5099\n\nIAM\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3092\u898b\u308c\u3070\u308f\u304b\u308b\u304c\u3001AWS\u306e\u8a8d\u8a3c\u60c5\u5831\uff08\u30a2\u30af\u30bb\u30b9\u30ad\u30fc,\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\uff09\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001\u5c02\u7528IAM\u30e6\u30fc\u30b6\u3092\u4f5c\u3063\u3066\u3001\u8a8d\u8a3c\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u306f\u3001\u30a4\u30f3\u30e9\u30a4\u30f3\u30dd\u30ea\u30b7\u30fc\u3067\u4ee5\u4e0b\u306e\u3082\u306e\u3092\uff08\u3053\u3053\u307e\u3067\u3044\u3089\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\u30b3\u30e1\u30f3\u30c8\u6c42\u3080\u3002\uff09\u3002\n\npolicy.json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"iot:Connect\",\n                \"iot:Publish\",\n                \"iot:Subscribe\",\n                \"iot:Receive\",\n                \"iot:GetThingShadow\",\n                \"iot:UpdateThingShadow\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n\n\n\nThing\u306e\u4f5c\u6210\nAWS IoT\u3067Thing\u3092aws iot create-thing --thing-name ${thing_name}\u3067\u4f5c\u6210\u3059\u308b\u3002\u4ee5\u4e0b\u306fec2power-switch\u3068\u3044\u3046\u540d\u524d\u306ething\u3092\u4f5c\u308b\u4f8b\u3002\n\n$ aws iot create-thing --thing-name ec2power-switch\n{\n    \"thingArn\": \"arn:aws:iot:${region}:${account}:thing/ec2power-switch\",\n    \"thingName\": \"ec2power-switch\"\n}\n\n# ${region}\u3084${account}\u306f\u3001\u305d\u308c\u305e\u308c\u5b9f\u884c\u74b0\u5883\u3067\u5909\u308f\u308b\u3002\n\u203b\u767b\u9332\u6e08\u307f\u306ething\u306e\u30ea\u30b9\u30c8\u306f\u3001aws iot list-things\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n$ aws iot list-things\n{\n    \"things\": [\n        {\n            \"attributes\": {},\n            \"version\": 1,\n            \"thingName\": \"ec2power-switch\"\n        }\n    ]\n}\n\n\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\nAWS IoT\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n$ aws iot describe-endpoint\n{\n    \"endpointAddress\": \"xxxxxxxxxxxxxx.iot.${region}.amazonaws.com\"\n}\n\n\u3053\u3053\u307e\u3067\u3067\u3001\n\nAWS\u306e\u8a8d\u8a3c\u60c5\u5831\n\n\n\u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\n\n\nThing\u306e\u540d\u524d\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\n\n\u304c\u305d\u308d\u3063\u3066\u3044\u308b\u306f\u305a\u3002\n\u307e\u305f\n\nAWS\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u540d\uff08ex. ap-northeast-1\uff09\n\u5b9f\u884c\u74b0\u5883\u306e\u4e0b\u8a18\u7121\u7ddaLAN\u60c5\u5831\n\n\nssid\npassword\n\n\n\n\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\n\nArduino\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u53d6\u5f97\n\u65e2\u306bArudino IDE\u306e\u69cb\u7bc9\u3084\u3001ESP-WROOM-02\u7528\u306e\u8a2d\u5b9a\u306f\u6e08\u307e\u305b\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001AWS IoT\u306bESP-WROOM-02\u3092\u3064\u306a\u3050\u306e\u306b\u5fc5\u8981\u306a\u90e8\u5206\u3060\u3051\u66f8\u304f\u3002\n\u4ee5\u4e0b\u306e4\u3064\u306e\u8ffd\u52a0\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5165\u308c\u308b\u3002\n\naws-mqtt-websockets\naws-sdk-arduino\nWebSockets for Arduino\nPaho MQTT for Arduino\n\n\naws-mqtt-websockets\naws-mqtt-websockets\ngithub\u304b\u3089\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea12\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\naws-sdk-arduino\naws-sdk-arduino\ngithub\u304b\u3089\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea12\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3057\u305f\u5f8c\u3001src/common\u4ee5\u4e0b\u3092\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30eb\u30fc\u30c8\u306b\u30b3\u30d4\u30fc\u3001\u3055\u3089\u306bsrc/esp8266\u4ee5\u4e0b\u3092\u540c\u3058\u5834\u6240\u306b\u4e0a\u66f8\u304d\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\nWebSockets for Arduino\nArduino IDE\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u3001[\u30b9\u30b1\u30c3\u30c1]\u2192[\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30af\u30eb\u30fc\u30c9]\u2192[\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u7ba1\u7406...]\u3068\u8fbf\u3063\u3066\u691c\u7d22\u30d5\u30a3\u30eb\u30bf\u306bWebSockets for Arduino (Server + Client)\u3068\u5165\u308c\u3066\u51fa\u3066\u304f\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\nPaho MQTT for Arduino\nPaho MQTT for Arduino\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089Arduino Client Library 1.0.0(2017/02/12\u73fe\u5728)\u3092\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea12\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u306e\u5b9f\u884c\nArduino IDE\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089[\u30d5\u30a1\u30a4\u30eb]\u2192[\u30b9\u30b1\u30c3\u30c1\u4f8b]\u2192[aws-mqtt-websocket]\u2192[aws-mqtt-websocket-example]\u3092\u9078\u629e\u3057\u3066\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3092\u958b\u304d\u300130\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b\u4e0b\u8a18\u8a2d\u5b9a\u5024\u3092\u5909\u66f4\u3059\u308b\u3002\n\naws-mqtt-websocket-example\n :\n//AWS IOT config, change these:\nchar wifi_ssid[]       = \"your-ssid\";\nchar wifi_password[]   = \"your-password\";\nchar aws_endpoint[]    = \"your-endpoint.iot.eu-west-1.amazonaws.com\";\nchar aws_key[]         = \"your-iam-key\";\nchar aws_secret[]      = \"your-iam-secret-key\";\nchar aws_region[]      = \"eu-west-1\";\nconst char* aws_topic  = \"$aws/things/your-device/shadow/update\";\n :\n\n\nThing\u306e\u540d\u524d\u306f\u3001aws_topic\u306eyour-device\u306e\u90e8\u5206\u306b\u66f8\u304f\u3002\n\u3053\u306e\u30b9\u30b1\u30c3\u30c1\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u66f8\u304d\u8fbc\u3081\u3070\u3001AWS IoT\u306b\u63a5\u7d9a\u3057\u3066\u5f85\u3061\u53d7\u3051\u3057\u3066\u3001\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u308b\u3002\nconnected with {SSID}, channel 11\ndhcp client start...\n..........ip:192.168.0.16,mask:255.255.255.0,gw:192.168.0.1\n7682 - conn: 1 - (34528)\nplease start sntp first !\nwebsocket layer connected\nMQTT connecting\nMQTT connected\nMQTT subscribed\n\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u63a5\u7d9a\u6210\u529f\u3002\n\u307e\u305f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3067\u306f\u3001\u63a5\u7d9a\u6210\u529f\u6642\u306b\u81ea\u5206\u306eThing\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u3044\u3066\u3001\u305d\u306e\u7d50\u679c\u3082\u4f75\u305b\u3066\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\uff08\u4e0b\u8a182\u884c\uff09\u3002\nMessage 1 arrived: qos 0, retained 0, dup 0, packetid 0\nPayload {\"state\":{\"reported\":{\"on\": false}, \"desired\":{\"on\": false}}}\n\n\n\u4f59\u8ac7\n\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001setup()\u5185\u306e\n  WiFiMulti.addAP(wifi_ssid, wifi_password);\n  Serial.println (\"connecting to wifi\");\n  while(WiFiMulti.run() != WL_CONNECTED) {\n    delay(100);\n    Serial.print (\".\");\n  }\n\n\u306e\u90e8\u5206\uff08175\u884c\u76ee\u4ed8\u8fd1\uff09\u3092\u3001\n  WiFi.begin(wifi_ssid, wifi_password);\n  Serial.println (\"connecting to wifi\");\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(100);\n    Serial.print(\".\");\n  }\n\n\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u306a\u3044\u3068WiFi\u306b\u3064\u306a\u304c\u3089\u306a\u304b\u3063\u305f\u3002\n\u3053\u308c\u306fAWS IoT\u3068\u304bmqtt\u3068\u304bwebsocket\u306f\u95a2\u4fc2\u306a\u304f\u3001\u81ea\u5206\u306e\u7121\u7dda\u74b0\u5883\u306e\u554f\u984c\u304b\u3002\n\n\u304a\u307e\u3051\n\u5192\u982d\u306e\u300cEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\uff5e\u300d\u3068\u3044\u3046\u306e\u3092\u3084\u308b\u306b\u306f\u3001CloudWatch\u306e\u30eb\u30fc\u30eb\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u3092\u76e3\u8996\u3057\u3066\u3001\u5909\u5316\u6642\u306b\u8d77\u52d5\u3055\u308c\u308bLambda\u95a2\u6570\u3067AWS IoT\u306b\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002\nCloudWatch\u306e\u30eb\u30fc\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3002\n\n\u72b6\u614b\u306b\u5909\u5316\u304c\u3042\u3063\u305f\u6642\u306b\u5b9f\u884c\u3055\u308c\u308bLambda\u95a2\u6570\u306e\u3001AWS IoT\u3078\u306e\u901a\u77e5\u90e8\u5206\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3002\n\nindex.js\nvar IoTData = new AWS.IotData({\n  endpoint: 'xxxxxxxxxxxxxx.iot.${region}.amazonaws.com',\n  region: '${region}'\n});\n\nvar params = {\n  topic: '$aws/things/${thingName}/shadow/update',\n  payload: \n};\n\nIoTData.publish(params).promise()\n.then((data) => {\n  :\n});\n\n\n\u3042\u3068\u96fb\u6e90\u306eOn/Off\u306f\u7d50\u5c40API Gateway+Lambda\u3067\u3084\u3063\u305f\u3002\n\n\n\n\n\nWindows\u306e\u5834\u5408: %USERPROFILE%\\Documents\\Arduino\\libraries\u00a0\u21a9\n\n\nmacOS\u306e\u5834\u5408\uff1a~/Documents/Arduino/libraries\u00a0\u21a9\n\n\n\n# \u306f\u3058\u3081\u306b\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\u3001ESP-WROOM-02\u958b\u767a\u30dc\u30fc\u30c9\u3067\u4f5c\u3063\u3066\u307f\u305f\u3002\n\nEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u72b6\u614b\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3092API Gateway+Lambda\u3067\u3084\u308d\u3046\u3068\u3057\u305f\u304c\u3001\u30dd\u30fc\u30ea\u30f3\u30b0\u3067\u30ea\u30af\u30a8\u30b9\u30c8\u304c\u591a\u304f\u306a\u308b\u3068\u304a\u8ca1\u5e03\u4e8b\u60c5\u304c\u3001\u3001\u3001\u3068\u601d\u3044\u3001AWS IoT\u304b\u3089\u30d7\u30c3\u30b7\u30e5\u901a\u77e5\u304c\u3067\u304d\u306a\u3044\u304b\u8abf\u3079\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u30c9\u30f3\u30d4\u30b7\u30e3\u306a\u30e9\u30a4\u30d6\u30e9\u30ea[aws-mqtt-websockets](https://github.com/odelot/aws-mqtt-websockets)\u304c\u3042\u3063\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u3063\u3066\u307f\u308b\u3002\n\n# \u4e8b\u524d\u6e96\u5099\n\n## IAM\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n\n\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3092\u898b\u308c\u3070\u308f\u304b\u308b\u304c\u3001AWS\u306e\u8a8d\u8a3c\u60c5\u5831\uff08\u30a2\u30af\u30bb\u30b9\u30ad\u30fc,\u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\uff09\u3092\u66f8\u304b\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u3001\u5c02\u7528IAM\u30e6\u30fc\u30b6\u3092\u4f5c\u3063\u3066\u3001\u8a8d\u8a3c\u60c5\u5831\u3092\u4fdd\u5b58\u3057\u3066\u304a\u304f\u3002\n\n\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u30dd\u30ea\u30b7\u30fc\u306f\u3001\u30a4\u30f3\u30e9\u30a4\u30f3\u30dd\u30ea\u30b7\u30fc\u3067\u4ee5\u4e0b\u306e\u3082\u306e\u3092\uff08\u3053\u3053\u307e\u3067\u3044\u3089\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u3002\u30b3\u30e1\u30f3\u30c8\u6c42\u3080\u3002\uff09\u3002\n\n```json:policy.json\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"iot:Connect\",\n                \"iot:Publish\",\n                \"iot:Subscribe\",\n                \"iot:Receive\",\n                \"iot:GetThingShadow\",\n                \"iot:UpdateThingShadow\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\n```\n\n## Thing\u306e\u4f5c\u6210\nAWS IoT\u3067Thing\u3092`aws iot create-thing --thing-name ${thing_name}`\u3067\u4f5c\u6210\u3059\u308b\u3002\u4ee5\u4e0b\u306f`ec2power-switch`\u3068\u3044\u3046\u540d\u524d\u306ething\u3092\u4f5c\u308b\u4f8b\u3002\n\n```shell-session\n\n$ aws iot create-thing --thing-name ec2power-switch\n{\n    \"thingArn\": \"arn:aws:iot:${region}:${account}:thing/ec2power-switch\",\n    \"thingName\": \"ec2power-switch\"\n}\n```\n\\# \\${region}\u3084${account}\u306f\u3001\u305d\u308c\u305e\u308c\u5b9f\u884c\u74b0\u5883\u3067\u5909\u308f\u308b\u3002\n\n\u203b\u767b\u9332\u6e08\u307f\u306ething\u306e\u30ea\u30b9\u30c8\u306f\u3001`aws iot list-things`\u3067\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```shell-session\n$ aws iot list-things\n{\n    \"things\": [\n        {\n            \"attributes\": {},\n            \"version\": 1,\n            \"thingName\": \"ec2power-switch\"\n        }\n    ]\n}\n```\n\n## \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\u306e\u78ba\u8a8d\nAWS IoT\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3059\u308b\u3002\n\n```shell-session\n$ aws iot describe-endpoint\n{\n    \"endpointAddress\": \"xxxxxxxxxxxxxx.iot.${region}.amazonaws.com\"\n}\n```\n\n\u3053\u3053\u307e\u3067\u3067\u3001\n\n* AWS\u306e\u8a8d\u8a3c\u60c5\u5831\n  * \u30a2\u30af\u30bb\u30b9\u30ad\u30fc\n  * \u30b7\u30fc\u30af\u30ec\u30c3\u30c8\u30ad\u30fc\n* Thing\u306e\u540d\u524d\n* \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u30a2\u30c9\u30ec\u30b9\n\n\u304c\u305d\u308d\u3063\u3066\u3044\u308b\u306f\u305a\u3002\n\n\u307e\u305f\n\n* AWS\u306e\u30ea\u30fc\u30b8\u30e7\u30f3\u540d\uff08ex. ap-northeast-1\uff09\n* \u5b9f\u884c\u74b0\u5883\u306e\u4e0b\u8a18\u7121\u7ddaLAN\u60c5\u5831\n  * ssid\n  * password\n\n\u3082\u78ba\u8a8d\u3057\u3066\u304a\u304f\u3002\n\n# Arduino\u7528\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u53d6\u5f97\n\u65e2\u306bArudino IDE\u306e\u69cb\u7bc9\u3084\u3001ESP-WROOM-02\u7528\u306e\u8a2d\u5b9a\u306f\u6e08\u307e\u305b\u3066\u3044\u308b\u3082\u306e\u3068\u3057\u3066\u3001AWS IoT\u306bESP-WROOM-02\u3092\u3064\u306a\u3050\u306e\u306b\u5fc5\u8981\u306a\u90e8\u5206\u3060\u3051\u66f8\u304f\u3002\n\n\u4ee5\u4e0b\u306e4\u3064\u306e\u8ffd\u52a0\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5165\u308c\u308b\u3002\n\n 1. aws-mqtt-websockets\n 1. aws-sdk-arduino\n 1. WebSockets for Arduino\n 1. Paho MQTT for Arduino\n\n## aws-mqtt-websockets\n[aws-mqtt-websockets](https://github.com/odelot/aws-mqtt-websockets)\ngithub\u304b\u3089\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea[^aruduino_libraries_windows][^aruduino_libraries_macos]\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n## aws-sdk-arduino\n[aws-sdk-arduino](https://github.com/svdgraaf/aws-sdk-arduino)\ngithub\u304b\u3089\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea[^aruduino_libraries_windows][^aruduino_libraries_macos]\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3057\u305f\u5f8c\u3001src/common\u4ee5\u4e0b\u3092\u3053\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30eb\u30fc\u30c8\u306b\u30b3\u30d4\u30fc\u3001\u3055\u3089\u306bsrc/esp8266\u4ee5\u4e0b\u3092\u540c\u3058\u5834\u6240\u306b\u4e0a\u66f8\u304d\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\n## WebSockets for Arduino\nArduino IDE\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u3001[\u30b9\u30b1\u30c3\u30c1]\u2192[\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30a4\u30f3\u30af\u30eb\u30fc\u30c9]\u2192[\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u7ba1\u7406...]\u3068\u8fbf\u3063\u3066\u691c\u7d22\u30d5\u30a3\u30eb\u30bf\u306b`WebSockets for Arduino (Server + Client)`\u3068\u5165\u308c\u3066\u51fa\u3066\u304f\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n## Paho MQTT for Arduino\n[Paho MQTT for Arduino](https://projects.eclipse.org/projects/technology.paho/downloads)\n\u516c\u5f0f\u30b5\u30a4\u30c8\u304b\u3089Arduino Client Library 1.0.0(2017/02/12\u73fe\u5728)\u3092\u53d6\u5f97\u3057\u3066\u3001libraries\u30c7\u30a3\u30ec\u30af\u30c8\u30ea[^aruduino_libraries_windows][^aruduino_libraries_macos]\u306b\u5c55\u958b\u3057\u3066\u4fdd\u5b58\u3059\u308b\u3002\n\n# \u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u306e\u5b9f\u884c\nArduino IDE\u306e\u30e1\u30cb\u30e5\u30fc\u304b\u3089[\u30d5\u30a1\u30a4\u30eb]\u2192[\u30b9\u30b1\u30c3\u30c1\u4f8b]\u2192[aws-mqtt-websocket]\u2192[aws-mqtt-websocket-example]\u3092\u9078\u629e\u3057\u3066\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3092\u958b\u304d\u300130\u884c\u76ee\u4ed8\u8fd1\u306b\u3042\u308b\u4e0b\u8a18\u8a2d\u5b9a\u5024\u3092\u5909\u66f4\u3059\u308b\u3002\n\n```c++:aws-mqtt-websocket-example\n :\n//AWS IOT config, change these:\nchar wifi_ssid[]       = \"your-ssid\";\nchar wifi_password[]   = \"your-password\";\nchar aws_endpoint[]    = \"your-endpoint.iot.eu-west-1.amazonaws.com\";\nchar aws_key[]         = \"your-iam-key\";\nchar aws_secret[]      = \"your-iam-secret-key\";\nchar aws_region[]      = \"eu-west-1\";\nconst char* aws_topic  = \"$aws/things/your-device/shadow/update\";\n :\n```\nThing\u306e\u540d\u524d\u306f\u3001`aws_topic`\u306e`your-device`\u306e\u90e8\u5206\u306b\u66f8\u304f\u3002\n\n\u3053\u306e\u30b9\u30b1\u30c3\u30c1\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u3057\u3066\u66f8\u304d\u8fbc\u3081\u3070\u3001AWS IoT\u306b\u63a5\u7d9a\u3057\u3066\u5f85\u3061\u53d7\u3051\u3057\u3066\u3001\u30b7\u30ea\u30a2\u30eb\u30b3\u30f3\u30bd\u30fc\u30eb\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u308b\u3002\n\n```shell-session\nconnected with {SSID}, channel 11\ndhcp client start...\n..........ip:192.168.0.16,mask:255.255.255.0,gw:192.168.0.1\n7682 - conn: 1 - (34528)\nplease start sntp first !\nwebsocket layer connected\nMQTT connecting\nMQTT connected\nMQTT subscribed\n```\n\u3053\u3053\u307e\u3067\u304f\u308b\u3068\u63a5\u7d9a\u6210\u529f\u3002\n\n\u307e\u305f\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u30b9\u30b1\u30c3\u30c1\u3067\u306f\u3001\u63a5\u7d9a\u6210\u529f\u6642\u306b\u81ea\u5206\u306eThing\u306b\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u3063\u3066\u3044\u3066\u3001\u305d\u306e\u7d50\u679c\u3082\u4f75\u305b\u3066\u51fa\u529b\u3055\u308c\u3066\u3044\u308b\uff08\u4e0b\u8a182\u884c\uff09\u3002\n\n```shell-session\nMessage 1 arrived: qos 0, retained 0, dup 0, packetid 0\nPayload {\"state\":{\"reported\":{\"on\": false}, \"desired\":{\"on\": false}}}\n```\n\n\n### \u4f59\u8ac7\n\u81ea\u5206\u306e\u74b0\u5883\u3067\u306f\u3001`setup()`\u5185\u306e\n\n```C++\n  WiFiMulti.addAP(wifi_ssid, wifi_password);\n  Serial.println (\"connecting to wifi\");\n  while(WiFiMulti.run() != WL_CONNECTED) {\n    delay(100);\n    Serial.print (\".\");\n  }\n```\n\u306e\u90e8\u5206\uff08175\u884c\u76ee\u4ed8\u8fd1\uff09\u3092\u3001\n\n```C++\n  WiFi.begin(wifi_ssid, wifi_password);\n  Serial.println (\"connecting to wifi\");\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(100);\n    Serial.print(\".\");\n  }\n```\n\u306e\u3088\u3046\u306b\u66f8\u304d\u63db\u3048\u306a\u3044\u3068WiFi\u306b\u3064\u306a\u304c\u3089\u306a\u304b\u3063\u305f\u3002\n\u3053\u308c\u306fAWS IoT\u3068\u304bmqtt\u3068\u304bwebsocket\u306f\u95a2\u4fc2\u306a\u304f\u3001\u81ea\u5206\u306e\u7121\u7dda\u74b0\u5883\u306e\u554f\u984c\u304b\u3002\n\n# \u304a\u307e\u3051\n\u5192\u982d\u306e\u300cEC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u96fb\u6e90\u30dc\u30bf\u30f3\u3092\uff5e\u300d\u3068\u3044\u3046\u306e\u3092\u3084\u308b\u306b\u306f\u3001CloudWatch\u306e\u30eb\u30fc\u30eb\u3067EC2\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u3092\u76e3\u8996\u3057\u3066\u3001\u5909\u5316\u6642\u306b\u8d77\u52d5\u3055\u308c\u308bLambda\u95a2\u6570\u3067AWS IoT\u306b\u901a\u77e5\u3059\u308b\u3088\u3046\u306b\u3057\u305f\u3002\n\nCloudWatch\u306e\u30eb\u30fc\u30eb\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u8a2d\u5b9a\u3002\n![ec2monitoring_cloudwatch.png](https://qiita-image-store.s3.amazonaws.com/0/90361/8e1dab14-c05c-a2d4-f521-0a912f7febd4.png)\n\n\u72b6\u614b\u306b\u5909\u5316\u304c\u3042\u3063\u305f\u6642\u306b\u5b9f\u884c\u3055\u308c\u308bLambda\u95a2\u6570\u306e\u3001AWS IoT\u3078\u306e\u901a\u77e5\u90e8\u5206\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3002\n\n```js:index.js\nvar IoTData = new AWS.IotData({\n  endpoint: 'xxxxxxxxxxxxxx.iot.${region}.amazonaws.com',\n  region: '${region}'\n});\n\nvar params = {\n  topic: '$aws/things/${thingName}/shadow/update',\n  payload: \n};\n\nIoTData.publish(params).promise()\n.then((data) => {\n  :\n});\n```\n\u3042\u3068\u96fb\u6e90\u306eOn/Off\u306f\u7d50\u5c40API Gateway+Lambda\u3067\u3084\u3063\u305f\u3002\n\n----\n[^aruduino_libraries_windows]: Windows\u306e\u5834\u5408: %USERPROFILE%\\Documents\\Arduino\\libraries\n[^aruduino_libraries_macos]: macOS\u306e\u5834\u5408\uff1a~/Documents/Arduino/libraries\n", "tags": ["ESP-WROOM-02", "Arduino", "AWS", "IoT", "lambda"]}