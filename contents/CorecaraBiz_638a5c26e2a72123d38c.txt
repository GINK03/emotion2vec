{"tags": ["AppleScript", "OSX"], "context": " More than 1 year has passed since last update.\u6307\u5b9a\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u62bd\u51fa\u3057\u3001\u62bd\u51fa\u5148\u306e\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3059\u3079\u3066\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u540c\u540d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u8907\u6570\u5b58\u5728\u3057\u305f\u5834\u5408\u306f\u3001\u51e6\u7406\u901f\u5ea6\u3092\u91cd\u8996\u3057\u3066\uff08\u7c21\u6613\u7684\u3067\u306f\u3042\u308a\u307e\u3059\u304c\uff09\u30b5\u30a4\u30ba\u6bd4\u8f03\u3067\u5225\u30d5\u30a1\u30a4\u30eb\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3002\n\u5225\u30d5\u30a1\u30a4\u30eb\u3060\u3063\u305f\u5834\u5408\u306f\u3001\u9023\u756a\u30ea\u30cd\u30fc\u30e0\u3092\u3057\u3066\u300c\u540d\u79f0\u91cd\u8907\u300d\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\nscript ScptObj\n    property parent : parent of me\n    property _contents : {}\nend script\n\non run\n    with timeout of (60 * 120) seconds\n        try\n            activate\n            set target_folder to (choose folder with prompt \"\u62bd\u51fa\u5143\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\") as alias\n            set collect_folder to (choose folder with prompt \"\u62bd\u51fa\u5148\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7a7a\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\") as alias\n\n            tell application \"Finder\"\n                set entire_items to items of collect_folder\n                if 0 < (count of entire_items) then error \"\u62bd\u51fa\u5148\u30d5\u30a9\u30eb\u30c0\u306b\u306f\u7a7a\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\"\n\n                set (_contents of ScptObj) to (files of entire contents of target_folder whose class is document file) as alias list\n                if (count of (_contents of ScptObj)) is 0 then error \"\u62bd\u51fa\u5143\u306b\u306f\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002\"\n\n                repeat with target_file in (_contents of ScptObj)\n                    set collect_path to \"\"\n                    set target_name to (name of target_file) as Unicode text\n\n                    (*\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u67fb*)\n                    if not (exists file target_name in collect_folder) then\n                        set collect_path to (POSIX path of collect_folder) & target_name\n\n                    else if (size of file target_file) is not (size of (file target_name in collect_folder)) then\n                        if not (exists folder \"\u540d\u79f0\u91cd\u8907\" in collect_folder) then\n                            set duplicate_folder to (make folder at collect_folder with properties {name:\"\u540d\u79f0\u91cd\u8907\"}) as alias\n                        else\n                            set duplicate_folder to (folder \"\u540d\u79f0\u91cd\u8907\" of collect_folder) as alias\n                        end if\n\n                        (*\u30d5\u30a1\u30a4\u30eb\u540d\u304b\u3089\u62e1\u5f35\u5b50\u3092\u5206\u96e2*)\n                        set target_ext to (name extension of target_file) as Unicode text\n                        if target_ext is not \"\" then\n                            set ext_num to (count of target_ext) + 2\n                            set target_txt to text 1 thru -ext_num of target_name\n                            set target_ext to (\".\" & target_ext) as Unicode text\n                        else\n                            set target_txt to target_name\n                        end if\n\n                        (*\u30b3\u30d4\u30fc\u6e08\u307f\u306e\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u691c\u67fb*)\n                        set base_name to (target_txt & \"_\") as Unicode text\n                        set overlap_files to (files of duplicate_folder whose name contains base_name) as alias list\n\n                        set overlap_num to (count of overlap_files) + 1\n                        repeat with overlap_file in overlap_files\n                            if (size of target_file) is (size of overlap_file) then\n                                set overlap_num to 0\n                                exit repeat\n                            end if\n                        end repeat\n\n                        if 0 < overlap_num then set collect_path to (POSIX path of duplicate_folder) & base_name & overlap_num & target_ext\n                    end if\n\n                    if collect_path is not \"\" then tell me to do shell script \"cp -fRP \" & quoted form of POSIX path of target_file & \" \" & quoted form of collect_path\n                end repeat\n\n                delay 0.1\n\n                set dup_bool to (exists folder \"\u540d\u79f0\u91cd\u8907\" in collect_folder)\n            end tell\n\n            activate\n            if dup_bool then\n                display dialog \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u304c\u3001\u540c\u540d\u306e\u5225\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u62bd\u51fa\u5148\u306e\u540d\u79f0\u91cd\u8907\u30d5\u30a9\u30eb\u30c0\u5185\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\" buttons {\"OK\"} default button 1\n            else\n                display dialog \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" buttons {\"OK\"} default button 1\n            end if\n\n        on error err_txt\n            if err_txt is \"\u30e6\u30fc\u30b6\u306b\u3088\u3063\u3066\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\" then\n                return\n            else\n                activate\n                display alert \"\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\" message err_txt as warning\n                return\n            end if\n        end try\n    end timeout\nend run\n\n\u6307\u5b9a\u3057\u305f\u30d5\u30a9\u30eb\u30c0\u5185\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u62bd\u51fa\u3057\u3001\u62bd\u51fa\u5148\u306e\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u3059\u3079\u3066\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\u540c\u540d\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u8907\u6570\u5b58\u5728\u3057\u305f\u5834\u5408\u306f\u3001\u51e6\u7406\u901f\u5ea6\u3092\u91cd\u8996\u3057\u3066\uff08\u7c21\u6613\u7684\u3067\u306f\u3042\u308a\u307e\u3059\u304c\uff09\u30b5\u30a4\u30ba\u6bd4\u8f03\u3067\u5225\u30d5\u30a1\u30a4\u30eb\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\u3002\n\u5225\u30d5\u30a1\u30a4\u30eb\u3060\u3063\u305f\u5834\u5408\u306f\u3001\u9023\u756a\u30ea\u30cd\u30fc\u30e0\u3092\u3057\u3066\u300c\u540d\u79f0\u91cd\u8907\u300d\u3068\u3044\u3046\u30d5\u30a9\u30eb\u30c0\u5185\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n\n```applescript\nscript ScptObj\n\tproperty parent : parent of me\n\tproperty _contents : {}\nend script\n\non run\n\twith timeout of (60 * 120) seconds\n\t\ttry\n\t\t\tactivate\n\t\t\tset target_folder to (choose folder with prompt \"\u62bd\u51fa\u5143\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\") as alias\n\t\t\tset collect_folder to (choose folder with prompt \"\u62bd\u51fa\u5148\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff08\u7a7a\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\uff09\") as alias\n\t\t\t\n\t\t\ttell application \"Finder\"\n\t\t\t\tset entire_items to items of collect_folder\n\t\t\t\tif 0 < (count of entire_items) then error \"\u62bd\u51fa\u5148\u30d5\u30a9\u30eb\u30c0\u306b\u306f\u7a7a\u30d5\u30a9\u30eb\u30c0\u3092\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\"\n\t\t\t\t\n\t\t\t\tset (_contents of ScptObj) to (files of entire contents of target_folder whose class is document file) as alias list\n\t\t\t\tif (count of (_contents of ScptObj)) is 0 then error \"\u62bd\u51fa\u5143\u306b\u306f\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u307e\u305b\u3093\u3002\"\n\t\t\t\t\n\t\t\t\trepeat with target_file in (_contents of ScptObj)\n\t\t\t\t\tset collect_path to \"\"\n\t\t\t\t\tset target_name to (name of target_file) as Unicode text\n\t\t\t\t\t\n\t\t\t\t\t(*\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u306e\u691c\u67fb*)\n\t\t\t\t\tif not (exists file target_name in collect_folder) then\n\t\t\t\t\t\tset collect_path to (POSIX path of collect_folder) & target_name\n\t\t\t\t\t\t\n\t\t\t\t\telse if (size of file target_file) is not (size of (file target_name in collect_folder)) then\n\t\t\t\t\t\tif not (exists folder \"\u540d\u79f0\u91cd\u8907\" in collect_folder) then\n\t\t\t\t\t\t\tset duplicate_folder to (make folder at collect_folder with properties {name:\"\u540d\u79f0\u91cd\u8907\"}) as alias\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tset duplicate_folder to (folder \"\u540d\u79f0\u91cd\u8907\" of collect_folder) as alias\n\t\t\t\t\t\tend if\n\t\t\t\t\t\t\n\t\t\t\t\t\t(*\u30d5\u30a1\u30a4\u30eb\u540d\u304b\u3089\u62e1\u5f35\u5b50\u3092\u5206\u96e2*)\n\t\t\t\t\t\tset target_ext to (name extension of target_file) as Unicode text\n\t\t\t\t\t\tif target_ext is not \"\" then\n\t\t\t\t\t\t\tset ext_num to (count of target_ext) + 2\n\t\t\t\t\t\t\tset target_txt to text 1 thru -ext_num of target_name\n\t\t\t\t\t\t\tset target_ext to (\".\" & target_ext) as Unicode text\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tset target_txt to target_name\n\t\t\t\t\t\tend if\n\t\t\t\t\t\t\n\t\t\t\t\t\t(*\u30b3\u30d4\u30fc\u6e08\u307f\u306e\u540c\u540d\u30d5\u30a1\u30a4\u30eb\u691c\u67fb*)\n\t\t\t\t\t\tset base_name to (target_txt & \"_\") as Unicode text\n\t\t\t\t\t\tset overlap_files to (files of duplicate_folder whose name contains base_name) as alias list\n\t\t\t\t\t\t\n\t\t\t\t\t\tset overlap_num to (count of overlap_files) + 1\n\t\t\t\t\t\trepeat with overlap_file in overlap_files\n\t\t\t\t\t\t\tif (size of target_file) is (size of overlap_file) then\n\t\t\t\t\t\t\t\tset overlap_num to 0\n\t\t\t\t\t\t\t\texit repeat\n\t\t\t\t\t\t\tend if\n\t\t\t\t\t\tend repeat\n\t\t\t\t\t\t\n\t\t\t\t\t\tif 0 < overlap_num then set collect_path to (POSIX path of duplicate_folder) & base_name & overlap_num & target_ext\n\t\t\t\t\tend if\n\t\t\t\t\t\n\t\t\t\t\tif collect_path is not \"\" then tell me to do shell script \"cp -fRP \" & quoted form of POSIX path of target_file & \" \" & quoted form of collect_path\n\t\t\t\tend repeat\n\t\t\t\t\n\t\t\t\tdelay 0.1\n\t\t\t\t\n\t\t\t\tset dup_bool to (exists folder \"\u540d\u79f0\u91cd\u8907\" in collect_folder)\n\t\t\tend tell\n\t\t\t\n\t\t\tactivate\n\t\t\tif dup_bool then\n\t\t\t\tdisplay dialog \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u304c\u3001\u540c\u540d\u306e\u5225\u30d5\u30a1\u30a4\u30eb\u304c\u5b58\u5728\u3057\u307e\u3059\u3002\u62bd\u51fa\u5148\u306e\u540d\u79f0\u91cd\u8907\u30d5\u30a9\u30eb\u30c0\u5185\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002\" buttons {\"OK\"} default button 1\n\t\t\telse\n\t\t\t\tdisplay dialog \"\u51e6\u7406\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\" buttons {\"OK\"} default button 1\n\t\t\tend if\n\t\t\t\n\t\ton error err_txt\n\t\t\tif err_txt is \"\u30e6\u30fc\u30b6\u306b\u3088\u3063\u3066\u30ad\u30e3\u30f3\u30bb\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\" then\n\t\t\t\treturn\n\t\t\telse\n\t\t\t\tactivate\n\t\t\t\tdisplay alert \"\u51e6\u7406\u4e2d\u306b\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002\" message err_txt as warning\n\t\t\t\treturn\n\t\t\tend if\n\t\tend try\n\tend timeout\nend run\n```\n"}