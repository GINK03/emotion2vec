{"context": " More than 1 year has passed since last update.\n\n\u80cc\u666f\n\u666e\u6bb5\u306fRuby\u3067\u958b\u767a\u3092\u3057\u3066\u3044\u308b\u3051\u3069\u3001\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u306e\u89e3\u6790\u7cfb\u306e\u4ed5\u4e8b\u304c\u5897\u3048\u3066\u304d\u305f\u306e\u3067\u3001python\u3092\u3044\u3058\u308b\u5fc5\u8981\u6027\u304c\u51fa\u3066\u304d\u3066\u3001\u307e\u305a\u306f\u8efd\u91cf\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306ebottle\u3067\u7c21\u5358\u306aAPI\u7684\u306a\u5f79\u5272\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u7acb\u3061\u307e\u3057\u305f\u3002\n\n\u96d1\u611f\n\u3081\u3061\u3083\u304f\u3061\u3083\u8efd\u91cf\u3067\u3001\u624b\u8efd\u306a\u306e\u3067\u3001python\u306e\u3044\u3044\u90e8\u5206\u3060\u3051\u4f7f\u3063\u3066\u3042\u3068\u306f\u30e1\u30a4\u30f3\u306e\u8a00\u8a9e\u3067\u3063\u3066\u3053\u3068\u3082\u53ef\u80fd\u3002\n\n\u4f5c\u3063\u305f\u3082\u306e\u306e\u6982\u8981\n\u2460ruby\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089API\u3092\u53e9\u304f\n\u2461python\u3067\u66f8\u3044\u305f\u30a2\u30d7\u30ea\u3067MySQL\u306b\u3042\u308b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\n\u2462python\u3067\u8a08\u7b97\n\u2463ruby\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u8a08\u7b97\u7d50\u679c\u3092\u8fd4\u3059\n\n\u5b9f\u88c5\n\uff11\uff0evirtualenv\u3067\u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210\npip install virtualenv\nvirtualenv bottle_sample\ncd bottle_sample\nsource bin/activate\n\n\uff12\uff0ebottle\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\npip install bottle\n\n\uff13\uff0e/update\u3067\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\n\nscore_calculator.py\n# -*- coding: utf-8 -*-\nfrom bottle import route, run\nimport networkx as nx\n\ndb_name = {DATABASE\u540d}\nhost = {DATABASE\u306e\u30db\u30b9\u30c8}\nusername = {MySQL\u306eusername}\npasswd = {MySQL\u306epassword}\n\n@route('/update')\ndef update\n  g = nx.DiGraph()\n  import mysql.connector\n  connect = mysql.connector.connect(db=db_name, host=host, port=3306, user=username, passwd=passwd)\n\n  cur=connect.cursor()\n  cur.execute(\"select from_user_id,to_user_id from awesome_graph_data)                                                                                      \n  rows = cur.fetchall()\n  for row in rows:\n    if row[0] is not None:\n      g.add_node(row[0])\n      g.add_node(row[1])\n      g.add_edge(row[0],row[1])\n\n    cur.close()\n    connect.close()\n  pr=nx.pagerank(g,alpha=0.85,personalization=None, max_iter=500)\n\n  for id, score in pr.items():\n    print id,score #\u4eca\u56de\u306f\u5272\u611b\u3059\u308b\u3051\u3069\u3001\u3053\u3053\u3067mysql\u306b\u4fdd\u5b58\u3059\u308c\u3070\u3044\u3044\n  return str(pr)\n\n\n\u3053\u308c\u3067\u3001\u6709\u5411\u30b0\u30e9\u30d5\u304b\u3089pagerank\u3092\u7b97\u51fa\u3057\u3066\u3001mysql\u306b\u4fdd\u5b58\u3067\u304d\u305f\u3002\n\uff14\uff0e/score/{user_id}\u3067score\u3092\u53d6\u5f97\n\nscore_calculator.py\n@route('/score/<user_id>')\ndef score\n  import mysql.connector\n  connect = mysql.connector.connect(db=db_name, host=host, port=3306, user=username, passwd=passwd)\n\n  cur=connect.cursor()\n  cur.execute(\"select score from scoda_data where user_id = {{user_id}}\")                                                                                      \n  score = cur.fetchall()\n  return score\n\n\n\n\u3053\u308c\u3067\u7279\u5b9a\u306euser_id\u306escore\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3002\n\n\u307e\u3068\u3081\n\u975e\u5e38\u306b\u7c21\u5358\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306a\u3089\u3001python+bottle\u3067\u7c21\u5358\u306b\u4f5c\u308c\u308b\u3002\n\u4ed6\u306b\u3082\u3001view\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u3001Web\u30b5\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u7c21\u5358\u306b\u3067\u304d\u308b\u3002\nruby\u3067\u306f\u76f8\u6027\u306e\u826f\u304f\u306a\u304b\u3063\u305f\u8272\u3093\u306a\u8a08\u7b97\u3092\u5916\u51fa\u3057\u3057\u3066\u3057\u307e\u3046\u3063\u3066\u624b\u3082\u9762\u767d\u3044\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n![python-framework.png](https://qiita-image-store.s3.amazonaws.com/0/1418/ffb502b1-1f13-fc0c-6e81-5553aa6a2af3.png \"python-framework.png\")\n\n\n##\u80cc\u666f\n\u666e\u6bb5\u306fRuby\u3067\u958b\u767a\u3092\u3057\u3066\u3044\u308b\u3051\u3069\u3001\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u306e\u89e3\u6790\u7cfb\u306e\u4ed5\u4e8b\u304c\u5897\u3048\u3066\u304d\u305f\u306e\u3067\u3001python\u3092\u3044\u3058\u308b\u5fc5\u8981\u6027\u304c\u51fa\u3066\u304d\u3066\u3001\u307e\u305a\u306f\u8efd\u91cf\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306ebottle\u3067\u7c21\u5358\u306aAPI\u7684\u306a\u5f79\u5272\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u7acb\u3061\u307e\u3057\u305f\u3002\n\n##\u96d1\u611f\n\u3081\u3061\u3083\u304f\u3061\u3083\u8efd\u91cf\u3067\u3001\u624b\u8efd\u306a\u306e\u3067\u3001python\u306e\u3044\u3044\u90e8\u5206\u3060\u3051\u4f7f\u3063\u3066\u3042\u3068\u306f\u30e1\u30a4\u30f3\u306e\u8a00\u8a9e\u3067\u3063\u3066\u3053\u3068\u3082\u53ef\u80fd\u3002\n\n##\u4f5c\u3063\u305f\u3082\u306e\u306e\u6982\u8981\n\u2460ruby\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089API\u3092\u53e9\u304f\n\u2461python\u3067\u66f8\u3044\u305f\u30a2\u30d7\u30ea\u3067MySQL\u306b\u3042\u308b\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\n\u2462python\u3067\u8a08\u7b97\n\u2463ruby\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u8a08\u7b97\u7d50\u679c\u3092\u8fd4\u3059\n\n##\u5b9f\u88c5\n\n\uff11\uff0evirtualenv\u3067\u4eee\u60f3\u74b0\u5883\u3092\u4f5c\u6210\n\n```console\npip install virtualenv\nvirtualenv bottle_sample\ncd bottle_sample\nsource bin/activate\n```\n\n\uff12\uff0ebottle\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\tconsole\npip install bottle\n```\n\n\uff13\uff0e/update\u3067\u30c7\u30fc\u30bf\u3092\u66f4\u65b0\n\n```score_calculator.py\n# -*- coding: utf-8 -*-\nfrom bottle import route, run\nimport networkx as nx\n\ndb_name = {DATABASE\u540d}\nhost = {DATABASE\u306e\u30db\u30b9\u30c8}\nusername = {MySQL\u306eusername}\npasswd = {MySQL\u306epassword}\n\n@route('/update')\ndef update\n  g = nx.DiGraph()\n  import mysql.connector\n  connect = mysql.connector.connect(db=db_name, host=host, port=3306, user=username, passwd=passwd)\n\n  cur=connect.cursor()\n  cur.execute(\"select from_user_id,to_user_id from awesome_graph_data)                                                                                      \n  rows = cur.fetchall()\n  for row in rows:\n    if row[0] is not None:\n      g.add_node(row[0])\n      g.add_node(row[1])\n      g.add_edge(row[0],row[1])\n\n    cur.close()\n    connect.close()\n  pr=nx.pagerank(g,alpha=0.85,personalization=None, max_iter=500)\n  \n  for id, score in pr.items():\n    print id,score #\u4eca\u56de\u306f\u5272\u611b\u3059\u308b\u3051\u3069\u3001\u3053\u3053\u3067mysql\u306b\u4fdd\u5b58\u3059\u308c\u3070\u3044\u3044\n  return str(pr)\n```\n\n\u3053\u308c\u3067\u3001\u6709\u5411\u30b0\u30e9\u30d5\u304b\u3089pagerank\u3092\u7b97\u51fa\u3057\u3066\u3001mysql\u306b\u4fdd\u5b58\u3067\u304d\u305f\u3002\n\n\uff14\uff0e/score/{user_id}\u3067score\u3092\u53d6\u5f97\n\n```score_calculator.py\n@route('/score/<user_id>')\ndef score\n  import mysql.connector\n  connect = mysql.connector.connect(db=db_name, host=host, port=3306, user=username, passwd=passwd)\n\n  cur=connect.cursor()\n  cur.execute(\"select score from scoda_data where user_id = {{user_id}}\")                                                                                      \n  score = cur.fetchall()\n  return score\n\n```\n\u3053\u308c\u3067\u7279\u5b9a\u306euser_id\u306escore\u304c\u53d6\u5f97\u3067\u304d\u308b\u3088\u3046\u306b\u3002\n\n\n##\u307e\u3068\u3081\n\u975e\u5e38\u306b\u7c21\u5358\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306a\u3089\u3001python+bottle\u3067\u7c21\u5358\u306b\u4f5c\u308c\u308b\u3002\n\u4ed6\u306b\u3082\u3001view\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u3063\u3066\u3001Web\u30b5\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\u3053\u3068\u3082\u7c21\u5358\u306b\u3067\u304d\u308b\u3002\n\nruby\u3067\u306f\u76f8\u6027\u306e\u826f\u304f\u306a\u304b\u3063\u305f\u8272\u3093\u306a\u8a08\u7b97\u3092\u5916\u51fa\u3057\u3057\u3066\u3057\u307e\u3046\u3063\u3066\u624b\u3082\u9762\u767d\u3044\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n", "tags": ["networkx", "MySQL", "bottle", "Ruby", "Python"]}