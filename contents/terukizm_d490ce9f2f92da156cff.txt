{"context": "\u524d\u56dePredictionIO\u306e\u52d5\u4f5c\u78ba\u8a8d\u306f\u3068\u308a\u3042\u3048\u305a\u3067\u304d\u305f\u306e\u3067\u3001Recommendation Engine Template\u3092\u4f7f\u3044\u3001\u30ec\u30b3\u30e1\u30f3\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u57fa\u672c\u7684\u306a\u624b\u9806\u306f\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u3059\u3002\n# pio template get apache/incubator-predictionio-template-recommender ~/MyRecommendation\n# cd ~/MyRecommendation\n\n# pio app new MyApp2\n[INFO] [HBLEvents] The table pio_event:events_2 doesn't exist yet. Creating now...\n[INFO] [App$] Initialized Event Store for this app ID: 2.\n[INFO] [App$] Created new app:\n[INFO] [App$]       Name: MyApp2\n[INFO] [App$]         ID: 2\n[INFO] [App$] Access Key: Dv7p5rYWOtbtBiVKULJwjjGu2oqqPGuuD3eBQNFpRF3HQABXncEWiErHzSEr_eiz\n\n# vi engine.json\n---\n  \"datasource\": {\n    \"params\" : {\n      \"appName\": \"MyApp2\"\n    }\n  },\n---\n\n// \u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u53d6\u5f97\n# curl https://raw.githubusercontent.com/apache/spark/master/data/mllib/sample_movielens_data.txt --create-dirs -o data/sample_movielens_data.txt\n\n# python data/import_eventserver.py --access_key=Dv7p5rYWOtbtBiVKULJwjjGu2oqqPGuuD3eBQNFpRF3HQABXncEWiErHzSEr_eiz\nImporting data...\n1501 events are imported.\n\n\n# pio build\n...\n[INFO] [Console$] Your engine is ready for training.\n\n\n# pio train\n...\n[INFO] [CoreWorkflow$] Training completed successfully.\n\n\n# pio deploy\n...\n[INFO] [HttpListener] Bound to /0.0.0.0:8000\n[INFO] [MasterActor] Engine is deployed and running. Engine API is live at http://0.0.0.0:8000.\n\n\u3042\u3068\u306f\u30db\u30b9\u30c8\u5074\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n$ % curl -sS -H \"Content-Type: application/json\" \\\n-d '{ \"user\": \"1\", \"num\": 4 }' http://localhost:8000/queries.json | jq .\n{\n  \"itemScores\": [\n    {\n      \"item\": \"2396\",\n      \"score\": 6.188385643364221\n    },\n    {\n      \"item\": \"2571\",\n      \"score\": 6.1600449198740215\n    },\n    {\n      \"item\": \"593\",\n      \"score\": 6.010834019720912\n    },\n    {\n      \"item\": \"1221\",\n      \"score\": 6.001154572406882\n    }\n  ]\n}\n\n\u3053\u3061\u3089\u3001\u74b0\u5883\u306b\u3088\u3063\u3066\u306f$ pio train\u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\npio.log\n2016-12-22 13:10:40,969 ERROR org.apache.spark.executor.Executor [Executor task launch worker-0] - Exception in task 3.0 in stage 70.0 (TID 239)\njava.lang.StackOverflowError\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1385)\n        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2018)\n...\n\n\n\u5bfe\u7b56\u3068\u3057\u3066\u306f3\u901a\u308a\u3042\u308a\u3001\n\nJVM\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3001Spark\u5b9f\u884c\u6642\u306e\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u62e1\u5f35\u3059\u308b (\u5f8c\u8ff0)\nEngine\u4e2d\u3067SparkContext\u3092\u4f7f\u3044\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b(\u5f8c\u8ff0)\nengine.json\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u5b66\u7fd2\u30d1\u30e9\u30e1\u30fc\u30bf\u3001numIterations\u306e\u5024\u3092\u5c0f\u3055\u304f\u3059\u308b\n\n\u3053\u3053\u3067\u306f\u3001\u300c3.\u300d\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u7528\u3044\u307e\u3059\u3002\n\nEvalution\u3067\u6700\u9069\u306a\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u5f97\nRecommendation Template\u3067\u306f\u3001engine.json\u5185\u3067\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\nengine.json\n  \"algorithms\": [\n    {\n      \"name\": \"als\",\n      \"params\": {\n        \"rank\": 10,\n        \"numIterations\": 20,\n        \"lambda\": 0.01,\n        \"seed\": 3\n      }\n    }\n  ]\n\n\nnumIterations\u306e\u5024\u3092\u5c11\u306a\u304f\u3059\u308b\u3053\u3068\u3067\u5b66\u7fd2\u306e\u53cd\u5fa9\u56de\u6570\u3092\u6e1b\u3089\u3057\u3001java.lang.StackOverflowError\u3092\u56de\u907f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001PredictionIO\u306b\u306fEvalution\u3068\u547c\u3070\u308c\u308b\u3001\u5b66\u7fd2\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u6a5f\u80fd\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3053\u3061\u3089\u3092\u4f7f\u3044\u3001\u6700\u9069\u306a\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305d\u306e\u524d\u306b\u3001AppName\u306e\u5024\u304cRecommendation Template Engine\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u3066\u3044\u308b\u306e\u30671\u3001\u30a8\u30c7\u30a3\u30bf\u7b49\u3067\u76f4\u63a5\u5909\u66f4\u3057\u3001$ pio build \u3057\u306a\u304a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n# vi src/main/scala/Evaluation.scala\n---\n78        appName = \"INVALID_APP_NAME\",   // -> MyAPP2\n---\n\n\u30d3\u30eb\u30c9\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u5c11\u3005\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u304c\u3001engine.json\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3068\u540c\u3058\u5f62\u5f0f\u306e\u3001\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n# pio eval org.template.recommendation.RecommendationEvaluation \\\norg.template.recommendation.EngineParamsList\n\n...\n\n[INFO] [CoreWorkflow$] Updating evaluation instance with result: MetricEvaluatorResult:\n  # engine params evaluated: 9\nOptimal Engine Params:\n  {\n  \"dataSourceParams\":{\n    \"\":{\n      \"appName\":\"MyApp2\",\n      \"evalParams\":{\n        \"kFold\":5,\n        \"queryNum\":10\n      }\n    }\n  },\n  \"preparatorParams\":{\n    \"\":{\n\n    }\n  },\n  \"algorithmParamsList\":[{\n    \"als\":{\n      \"rank\":5,\n      \"numIterations\":10,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n  }],\n  \"servingParams\":{\n    \"\":{\n\n    }\n  }\n}\nMetrics:\n  Precision@K (k=10, threshold=4.0): 0.0273970398970399\n  PositiveCount (threshold=4.0): 12.386666666666668\n  Precision@K (k=10, threshold=2.0): 0.028571428571428577\n  PositiveCount (threshold=2.0): 19.320000000000004\n  Precision@K (k=10, threshold=1.0): 0.030126984126984134\n  PositiveCount (threshold=1.0): 20.013333333333332\n[INFO] [CoreWorkflow$] runEvaluation completed\n\n\u5f97\u3089\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092engine.json\u306b\u8a2d\u5b9a\u3057\u3001$ pio build $ pio train\u3092\u5b9f\u884c\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\njava.lang.StackOverflowError\u304c\u8d77\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n# vi engine.json\n---\n    \"als\":{\n      \"rank\":5,\n      \"numIterations\":10,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n---\n\n# pio build\n\n# pio train\n...\n[INFO] [CoreWorkflow$] Training completed successfully.\n\n$ pio eval \u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\nincubator-predictionio-template-recommender/Evaluation.scala at develop \u00b7 apache/incubator-predictionio-template-recommender\n\nrank, numIterations\u306e\u5024\u3092\u5909\u66f4\u3057\u306a\u304c\u3089Engine\u3092\u52d5\u304b\u3057\u3001PrecisionAtK\u3068PositiveCount\u3092\u8a55\u4fa1\u5c3a\u5ea6\u3068\u3057\u3066\u3001\u6700\u3082\u826f\u3044\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9078\u629e\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306b\u306fComprehensiveRecommendationEvaluation\u3082\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n# pio eval org.template.recommendation.ComprehensiveRecommendationEvaluation \\\n org.template.recommendation.EngineParamsList\n\n...\n[INFO] [CoreWorkflow$] Updating evaluation instance with result: MetricEvaluatorResult:\n  # engine params evaluated: 9\nOptimal Engine Params:\n  {\n  \"dataSourceParams\":{\n    \"\":{\n      \"appName\":\"MyApp2\",\n      \"evalParams\":{\n        \"kFold\":5,\n        \"queryNum\":10\n      }\n    }\n  },\n  \"preparatorParams\":{\n    \"\":{\n\n    }\n  },\n  \"algorithmParamsList\":[{\n    \"als\":{\n      \"rank\":10,\n      \"numIterations\":1,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n  }],\n  \"servingParams\":{\n    \"\":{\n\n    }\n  }\n}\nMetrics:\n  Precision@K (k=3, threshold=2.0): 0.04000000000000001\n  PositiveCount (threshold=0.0): 20.013333333333332\n  PositiveCount (threshold=2.0): 19.319999999999997\n  PositiveCount (threshold=4.0): 12.386666666666667\n  Precision@K (k=1, threshold=0.0): 0.05333333333333332\n  Precision@K (k=3, threshold=0.0): 0.04\n  Precision@K (k=10, threshold=0.0): 0.014666666666666672\n  Precision@K (k=1, threshold=2.0): 0.05333333333333334\n  Precision@K (k=3, threshold=2.0): 0.04\n  Precision@K (k=10, threshold=2.0): 0.014666666666666672\n  Precision@K (k=1, threshold=4.0): 0.02702702702702703\n  Precision@K (k=3, threshold=4.0): 0.022522522522522518\n  Precision@K (k=10, threshold=4.0): 0.009459459459459462\n[INFO] [CoreWorkflow$] runEvaluation completed\n\n\u305f\u3060\u3001\u3053\u308c\u3089\u304c\u3069\u3046\u9055\u3046\u306e\u304b\u3001\u3069\u3046\u3044\u3046\u5834\u5408\u306b\u3069\u3061\u3089\u3092\u4f7f\u3046\u306e\u304c\u9069\u5207\u306a\u306e\u304b\uff08\u305d\u3057\u3066\u3053\u306e\u5b9f\u88c5\u306f\u9069\u5207\u306a\u306e\u304b\u2026\u2026\uff09\u3068\u3044\u3063\u305f\u3068\u3053\u308d\u306f\u3001\u79c1\u306e\u52c9\u5f37\u4e0d\u8db3\u3067\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u8abf\u3079\u3066\u307f\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\nEngine Template\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b\nRecommendation Template\u306f\u3042\u304f\u307e\u3067\u300c\u30b5\u30f3\u30d7\u30eb\u5b9f\u88c5\u300d\u306a\u306e\u3067\u3001\u8272\u3005\u305d\u3050\u308f\u306a\u3044\u90e8\u5206\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002(\u305f\u3068\u3048\u3070\u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u767b\u9332\u306eevent\u304c\"buy\"\u3068\"rating\"\u306b\u5206\u304b\u308c\u3066\u3044\u307e\u3059\u304c\u3001buy\u3092\u60f3\u5b9a\u3059\u308b\u5fc5\u8981\u6027\u304c\u3042\u307e\u308a\u306a\u3044\u3001\u306a\u3069)\nDocker\u30b3\u30f3\u30c6\u30ca\u5185\u3067vim\u7b49\u3092\u4f7f\u3063\u3066\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u3066\u3082\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u74b0\u5883\u306e\u30a8\u30c7\u30a3\u30bf\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u65b9\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u53c2\u8003\u7a0b\u5ea6\u306b\u3084\u308a\u65b9\u3092\u3054\u7d39\u4ecb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\u307e\u305a\u306fpredictionio\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5225\u540d\u3067commit\u3057\u307e\u3059\u30022\n// predictionio\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\n$ docker ps -a\ndd5c00c48078        predictionio        \"/bin/bash\"              5 days ago          Exited (0) 2 minutes ago                       predictionio_instance\n\n// \u5225\u540d\u3092\u3064\u3051\u3066commit\n$ docker commit dd5c00c48078 my-pio:terukizm\nsha256:9da04b94845e2a22a02eda9166aac06ca68835ba3f188072cce4bc1b9b4547ca\n\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED                  SIZE\nmy-pio              terukizm            9da04b94845e        Less than a second ago   2.55 GB\npredictionio        latest              2a03ed1aef2e        5 days ago               2.34 GB\n\n\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u9069\u5f53\u306a\u5834\u6240\u306b\u7de8\u96c6\u7528\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092git clone\u3057\u3066\u304a\u304d\u3001docker -v\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3068\u5171\u6709\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u5185\u306b /MyCustomRecommender \u3068\u3057\u3066\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n$ cd ~\n$ git clone https://github.com/apache/incubator-predictionio-template-recommender.git\n$ ls ~/incubator-predictionio-template-recommender\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n\n$ docker run -p 8000:8000 -v ~/incubator-predictionio-template-recommender:/MyCustomRecommender -it my-pio:terukizm /bin/bash\n\n\u3042\u3068\u306f\u30b3\u30f3\u30c6\u30ca\u5185\u304b\u3089\u901a\u5e38\u306eEngine Template\u3068\u540c\u3058\u3088\u3046\u306b\u4f7f\u3048\u307e\u3059\u3002\n# cd /MyCustomRecommender/\n# ls\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n\n# pio build\n...\n[INFO] [Console$] Your engine is ready for training.\n\n\nWindows\u306e\u5834\u5408\n\u30b7\u30b9\u30c6\u30e0\u30c8\u30ec\u30a4\u306eDocker\u30a2\u30a4\u30b3\u30f3 > Settings \u304b\u3089\u4ee5\u4e0b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u305f\u4e0a\u3067\u3001\u540c\u69d8\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\nC:\\>docker run -p 8000:8000 -v D:/incubator-predictionio-template-recommender:/MyCustomRecommender -it my-pio:terukizm /bin/bash\n\nroot@dce268437faa:/# ls /MyCustomRecommender/\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n\n\n\u305d\u306e\u4ed6Tips\n\nPredictionIO\u306b\u6295\u5165\u3055\u308c\u3066\u3044\u308b\u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u3092\u524a\u9664\n# pio app data-delete MyApp2\n\npio app data-delete MyApp2\n[INFO] [App$] Data of the following app (default channel only) will be deleted. Are you sure?\n[INFO] [App$]     App Name: MyApp2\n[INFO] [App$]       App ID: 2\n[INFO] [App$]  Description: None\n\nEnter 'YES' to proceed: YES\n\n\u300cYES\u300d\u3068\u6253\u3061\u8fbc\u307e\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002(y \u3068\u304b yes \u3067\u306f\u3060\u3081\u3067\u3057\u305f)\n\nEngine\u4e2d\u3067\u52d5\u3044\u3066\u308bSpark\u306bJVM\u30aa\u30d7\u30b7\u30e7\u30f3(\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u306a\u3069)\u3092\u8a2d\u5b9a\u3057\u305f\u3044\npio\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n# JAVA_OPTS=\"-Xms1g -Xmx2g\" pio-start-all\n\n\n\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066Spark\u306e\u30b9\u30bf\u30c3\u30af\u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u3092\u56de\u907f\u3059\u308b\nSparkContext.setCheckpointDir()\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\nsrc/main/scala/ALSAlgorithm.scala\n   /* $ pio train */\n   def train(sc: SparkContext, data: PreparedData): ALSModel = {\n\n+    sc.setCheckpointDir(\"checkpoint/\")\n\n     // MLLib ALS cannot handle empty training data.\n     require(!data.ratings.take(1).isEmpty,\n\n\n\u3068\u307e\u3042\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u306a\u3093\u3068\u304bRecommendation Template\u3092\u52d5\u304b\u3059\u3053\u3068\u306f\u3067\u304d\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u304f\u306e\u304c\u6b63\u76f4\u5927\u5909\u3067\u3001\u3076\u3063\u3061\u3083\u3051\u632b\u6298\u3057\u307e\u3057\u305f\u2026\n\u5f79\u306b\u305f\u3064\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u6c17\u304c\u5411\u3044\u305f\u3089\u305d\u3061\u3089\u3082\u307e\u3068\u3081\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u2026\u2026\n\n\n\n\n\n\u306a\u3093\u3068\u306a\u304f\u73fe\u5728\u306ePredictIO\u306e\u4ed5\u7d44\u307f\u306e\u90fd\u5408\u3063\u307d\u3044\u6c17\u304c\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u3082\u3057\u304b\u3057\u3059\u308b\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3059\u308c\u3070engine.json\u304b\u3089\u53d6\u5f97\u3057\u305f\u308a\u3067\u304d\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093(\u51fa\u6765\u308b\u306a\u3089\u305d\u3063\u3061\u306e\u307b\u3046\u304c\u3044\u3044\u3067\u3059\u3088\u306d\u2026)\u00a0\u21a9\n\n\n$ docker run\u3067\u3057\u304bvolume\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3067\u304d\u306a\u304b\u3063\u305f\u3081\u3002\u305d\u306e\u3046\u3061$ docker update\u3068\u304b\u3067\u3082\u5909\u66f4\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u305b\u3093\u304b\u306d\u2026\u00a0\u21a9\n\n\n\n[\u524d\u56de](http://qiita.com/terukizm/items/dc0a53944c11653ef406)PredictionIO\u306e\u52d5\u4f5c\u78ba\u8a8d\u306f\u3068\u308a\u3042\u3048\u305a\u3067\u304d\u305f\u306e\u3067\u3001[Recommendation Engine Template](http://predictionio.incubator.apache.org/templates/recommendation/quickstart/)\u3092\u4f7f\u3044\u3001\u30ec\u30b3\u30e1\u30f3\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u304b\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u57fa\u672c\u7684\u306a\u624b\u9806\u306f\u307e\u3063\u305f\u304f\u540c\u3058\u3067\u3059\u3002\n\n```\n# pio template get apache/incubator-predictionio-template-recommender ~/MyRecommendation\n# cd ~/MyRecommendation\n\n# pio app new MyApp2\n[INFO] [HBLEvents] The table pio_event:events_2 doesn't exist yet. Creating now...\n[INFO] [App$] Initialized Event Store for this app ID: 2.\n[INFO] [App$] Created new app:\n[INFO] [App$]       Name: MyApp2\n[INFO] [App$]         ID: 2\n[INFO] [App$] Access Key: Dv7p5rYWOtbtBiVKULJwjjGu2oqqPGuuD3eBQNFpRF3HQABXncEWiErHzSEr_eiz\n\n# vi engine.json\n---\n  \"datasource\": {\n    \"params\" : {\n      \"appName\": \"MyApp2\"\n    }\n  },\n---\n\n// \u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u53d6\u5f97\n# curl https://raw.githubusercontent.com/apache/spark/master/data/mllib/sample_movielens_data.txt --create-dirs -o data/sample_movielens_data.txt\n\n# python data/import_eventserver.py --access_key=Dv7p5rYWOtbtBiVKULJwjjGu2oqqPGuuD3eBQNFpRF3HQABXncEWiErHzSEr_eiz\nImporting data...\n1501 events are imported.\n\n\n# pio build\n...\n[INFO] [Console$] Your engine is ready for training.\n\n\n# pio train\n...\n[INFO] [CoreWorkflow$] Training completed successfully.\n\n\n# pio deploy\n...\n[INFO] [HttpListener] Bound to /0.0.0.0:8000\n[INFO] [MasterActor] Engine is deployed and running. Engine API is live at http://0.0.0.0:8000.\n```\n\n\u3042\u3068\u306f\u30db\u30b9\u30c8\u5074\u304b\u3089\u78ba\u8a8d\u3057\u3066\u307f\u307e\u3059\u3002\n\n```\n$ % curl -sS -H \"Content-Type: application/json\" \\\n-d '{ \"user\": \"1\", \"num\": 4 }' http://localhost:8000/queries.json | jq .\n{\n  \"itemScores\": [\n    {\n      \"item\": \"2396\",\n      \"score\": 6.188385643364221\n    },\n    {\n      \"item\": \"2571\",\n      \"score\": 6.1600449198740215\n    },\n    {\n      \"item\": \"593\",\n      \"score\": 6.010834019720912\n    },\n    {\n      \"item\": \"1221\",\n      \"score\": 6.001154572406882\n    }\n  ]\n}\n```\n\n\u3053\u3061\u3089\u3001\u74b0\u5883\u306b\u3088\u3063\u3066\u306f`$ pio train`\u3092\u5b9f\u884c\u3057\u305f\u3068\u304d\u306b\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u30a8\u30e9\u30fc\u304c\u51fa\u308b\u304b\u3068\u601d\u3044\u307e\u3059\u3002\n\n```pio.log\n2016-12-22 13:10:40,969 ERROR org.apache.spark.executor.Executor [Executor task launch worker-0] - Exception in task 3.0 in stage 70.0 (TID 239)\njava.lang.StackOverflowError\n        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1385)\n        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2018)\n...\n```\n\n\u5bfe\u7b56\u3068\u3057\u3066\u306f3\u901a\u308a\u3042\u308a\u3001\n\n1. JVM\u306b\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6307\u5b9a\u3057\u3001Spark\u5b9f\u884c\u6642\u306e\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u3092\u62e1\u5f35\u3059\u308b (\u5f8c\u8ff0)\n2. Engine\u4e2d\u3067SparkContext\u3092\u4f7f\u3044\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3059\u308b(\u5f8c\u8ff0)\n3. engine.json\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u5b66\u7fd2\u30d1\u30e9\u30e1\u30fc\u30bf\u3001numIterations\u306e\u5024\u3092\u5c0f\u3055\u304f\u3059\u308b\n\n\u3053\u3053\u3067\u306f\u3001\u300c3.\u300d\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u7528\u3044\u307e\u3059\u3002\n\n# Evalution\u3067\u6700\u9069\u306a\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u5f97\n\nRecommendation Template\u3067\u306f\u3001engine.json\u5185\u3067\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n```engine.json\n  \"algorithms\": [\n    {\n      \"name\": \"als\",\n      \"params\": {\n        \"rank\": 10,\n        \"numIterations\": 20,\n        \"lambda\": 0.01,\n        \"seed\": 3\n      }\n    }\n  ]\n```\n\nnumIterations\u306e\u5024\u3092\u5c11\u306a\u304f\u3059\u308b\u3053\u3068\u3067\u5b66\u7fd2\u306e\u53cd\u5fa9\u56de\u6570\u3092\u6e1b\u3089\u3057\u3001java.lang.StackOverflowError\u3092\u56de\u907f\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u304c\u3001PredictionIO\u306b\u306fEvalution\u3068\u547c\u3070\u308c\u308b\u3001\u5b66\u7fd2\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u6a5f\u80fd\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3053\u3061\u3089\u3092\u4f7f\u3044\u3001\u6700\u9069\u306a\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u305d\u306e\u524d\u306b\u3001AppName\u306e\u5024\u304cRecommendation Template Engine\u306e\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u3066\u3044\u308b\u306e\u3067[^1]\u3001\u30a8\u30c7\u30a3\u30bf\u7b49\u3067\u76f4\u63a5\u5909\u66f4\u3057\u3001`$ pio build` \u3057\u306a\u304a\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n[^1]: \u306a\u3093\u3068\u306a\u304f\u73fe\u5728\u306ePredictIO\u306e\u4ed5\u7d44\u307f\u306e\u90fd\u5408\u3063\u307d\u3044\u6c17\u304c\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u3082\u3057\u304b\u3057\u3059\u308b\u3068\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3059\u308c\u3070engine.json\u304b\u3089\u53d6\u5f97\u3057\u305f\u308a\u3067\u304d\u308b\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093(\u51fa\u6765\u308b\u306a\u3089\u305d\u3063\u3061\u306e\u307b\u3046\u304c\u3044\u3044\u3067\u3059\u3088\u306d\u2026)\n\n```\n# vi src/main/scala/Evaluation.scala\n---\n78        appName = \"INVALID_APP_NAME\",   // -> MyAPP2\n---\n```\n\n\u30d3\u30eb\u30c9\u304c\u7d42\u308f\u3063\u305f\u3089\u3001\u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u5c11\u3005\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u304c\u3001`engine.json`\u3067\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u3068\u540c\u3058\u5f62\u5f0f\u306e\u3001\u5b66\u7fd2\u7528\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u8868\u793a\u3055\u308c\u308c\u3070\u6210\u529f\u3067\u3059\u3002\n\n```\n# pio eval org.template.recommendation.RecommendationEvaluation \\\norg.template.recommendation.EngineParamsList\n\n...\n\n[INFO] [CoreWorkflow$] Updating evaluation instance with result: MetricEvaluatorResult:\n  # engine params evaluated: 9\nOptimal Engine Params:\n  {\n  \"dataSourceParams\":{\n    \"\":{\n      \"appName\":\"MyApp2\",\n      \"evalParams\":{\n        \"kFold\":5,\n        \"queryNum\":10\n      }\n    }\n  },\n  \"preparatorParams\":{\n    \"\":{\n\n    }\n  },\n  \"algorithmParamsList\":[{\n    \"als\":{\n      \"rank\":5,\n      \"numIterations\":10,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n  }],\n  \"servingParams\":{\n    \"\":{\n\n    }\n  }\n}\nMetrics:\n  Precision@K (k=10, threshold=4.0): 0.0273970398970399\n  PositiveCount (threshold=4.0): 12.386666666666668\n  Precision@K (k=10, threshold=2.0): 0.028571428571428577\n  PositiveCount (threshold=2.0): 19.320000000000004\n  Precision@K (k=10, threshold=1.0): 0.030126984126984134\n  PositiveCount (threshold=1.0): 20.013333333333332\n[INFO] [CoreWorkflow$] runEvaluation completed\n```\n\n\u5f97\u3089\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092`engine.json`\u306b\u8a2d\u5b9a\u3057\u3001`$ pio build` `$ pio train`\u3092\u5b9f\u884c\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\njava.lang.StackOverflowError\u304c\u8d77\u304d\u306a\u304f\u306a\u3063\u3066\u3044\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n \n```\n# vi engine.json\n---\n    \"als\":{\n      \"rank\":5,\n      \"numIterations\":10,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n---\n\n# pio build\n\n# pio train\n...\n[INFO] [CoreWorkflow$] Training completed successfully.\n```\n\n`$ pio eval` \u304c\u4f55\u3092\u3084\u3063\u3066\u3044\u308b\u306e\u304b\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u3001\u4ee5\u4e0b\u3092\u3054\u53c2\u7167\u304f\u3060\u3055\u3044\u3002\n\n> [incubator\\-predictionio\\-template\\-recommender/Evaluation\\.scala at develop \u00b7 apache/incubator\\-predictionio\\-template\\-recommender](https://github.com/apache/incubator-predictionio-template-recommender/blob/develop/src/main/scala/Evaluation.scala)\n\nrank, numIterations\u306e\u5024\u3092\u5909\u66f4\u3057\u306a\u304c\u3089Engine\u3092\u52d5\u304b\u3057\u3001PrecisionAtK\u3068PositiveCount\u3092\u8a55\u4fa1\u5c3a\u5ea6\u3068\u3057\u3066\u3001\u6700\u3082\u826f\u3044\u7d50\u679c\u304c\u5f97\u3089\u308c\u305f\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u9078\u629e\u3057\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u4e2d\u306b\u306fComprehensiveRecommendationEvaluation\u3082\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n```\n# pio eval org.template.recommendation.ComprehensiveRecommendationEvaluation \\\n org.template.recommendation.EngineParamsList\n\n...\n[INFO] [CoreWorkflow$] Updating evaluation instance with result: MetricEvaluatorResult:\n  # engine params evaluated: 9\nOptimal Engine Params:\n  {\n  \"dataSourceParams\":{\n    \"\":{\n      \"appName\":\"MyApp2\",\n      \"evalParams\":{\n        \"kFold\":5,\n        \"queryNum\":10\n      }\n    }\n  },\n  \"preparatorParams\":{\n    \"\":{\n\n    }\n  },\n  \"algorithmParamsList\":[{\n    \"als\":{\n      \"rank\":10,\n      \"numIterations\":1,\n      \"lambda\":0.01,\n      \"seed\":3\n    }\n  }],\n  \"servingParams\":{\n    \"\":{\n\n    }\n  }\n}\nMetrics:\n  Precision@K (k=3, threshold=2.0): 0.04000000000000001\n  PositiveCount (threshold=0.0): 20.013333333333332\n  PositiveCount (threshold=2.0): 19.319999999999997\n  PositiveCount (threshold=4.0): 12.386666666666667\n  Precision@K (k=1, threshold=0.0): 0.05333333333333332\n  Precision@K (k=3, threshold=0.0): 0.04\n  Precision@K (k=10, threshold=0.0): 0.014666666666666672\n  Precision@K (k=1, threshold=2.0): 0.05333333333333334\n  Precision@K (k=3, threshold=2.0): 0.04\n  Precision@K (k=10, threshold=2.0): 0.014666666666666672\n  Precision@K (k=1, threshold=4.0): 0.02702702702702703\n  Precision@K (k=3, threshold=4.0): 0.022522522522522518\n  Precision@K (k=10, threshold=4.0): 0.009459459459459462\n[INFO] [CoreWorkflow$] runEvaluation completed\n```\n\n\u305f\u3060\u3001\u3053\u308c\u3089\u304c\u3069\u3046\u9055\u3046\u306e\u304b\u3001\u3069\u3046\u3044\u3046\u5834\u5408\u306b\u3069\u3061\u3089\u3092\u4f7f\u3046\u306e\u304c\u9069\u5207\u306a\u306e\u304b\uff08\u305d\u3057\u3066\u3053\u306e\u5b9f\u88c5\u306f\u9069\u5207\u306a\u306e\u304b\u2026\u2026\uff09\u3068\u3044\u3063\u305f\u3068\u3053\u308d\u306f\u3001\u79c1\u306e\u52c9\u5f37\u4e0d\u8db3\u3067\u308f\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u8208\u5473\u304c\u3042\u308b\u65b9\u306f\u8abf\u3079\u3066\u307f\u3066\u3044\u305f\u3060\u3051\u308c\u3070\u5e78\u3044\u3067\u3059\u3002\n\n\n# Engine Template\u958b\u767a\u74b0\u5883\u3092\u4f5c\u308b\n\n[Recommendation Template](https://github.com/apache/incubator-predictionio-template-recommender)\u306f\u3042\u304f\u307e\u3067\u300c\u30b5\u30f3\u30d7\u30eb\u5b9f\u88c5\u300d\u306a\u306e\u3067\u3001\u8272\u3005\u305d\u3050\u308f\u306a\u3044\u90e8\u5206\u304c\u3042\u308b\u3068\u601d\u3044\u307e\u3059\u3002(\u305f\u3068\u3048\u3070\u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u767b\u9332\u306eevent\u304c\"buy\"\u3068\"rating\"\u306b\u5206\u304b\u308c\u3066\u3044\u307e\u3059\u304c\u3001buy\u3092\u60f3\u5b9a\u3059\u308b\u5fc5\u8981\u6027\u304c\u3042\u307e\u308a\u306a\u3044\u3001\u306a\u3069)\n\nDocker\u30b3\u30f3\u30c6\u30ca\u5185\u3067vim\u7b49\u3092\u4f7f\u3063\u3066\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u3092\u4fee\u6b63\u3057\u3066\u3082\u3088\u3044\u306e\u3067\u3059\u304c\u3001\u30db\u30b9\u30c8\u74b0\u5883\u306e\u30a8\u30c7\u30a3\u30bf\u3092\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u65b9\u304c\u697d\u3060\u3068\u601d\u3044\u307e\u3059\u306e\u3067\u3001\u53c2\u8003\u7a0b\u5ea6\u306b\u3084\u308a\u65b9\u3092\u3054\u7d39\u4ecb\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\u307e\u305a\u306fpredictionio\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5225\u540d\u3067commit\u3057\u307e\u3059\u3002[^5]\n\n[^5]: `$ docker run`\u3067\u3057\u304bvolume\u30aa\u30d7\u30b7\u30e7\u30f3\u304c\u6307\u5b9a\u3067\u304d\u306a\u304b\u3063\u305f\u3081\u3002\u305d\u306e\u3046\u3061`$ docker update`\u3068\u304b\u3067\u3082\u5909\u66f4\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u305b\u3093\u304b\u306d\u2026\n\n```\n// predictionio\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u78ba\u8a8d\n$ docker ps -a\ndd5c00c48078        predictionio        \"/bin/bash\"              5 days ago          Exited (0) 2 minutes ago                       predictionio_instance\n\n// \u5225\u540d\u3092\u3064\u3051\u3066commit\n$ docker commit dd5c00c48078 my-pio:terukizm\nsha256:9da04b94845e2a22a02eda9166aac06ca68835ba3f188072cce4bc1b9b4547ca\n\n$ docker images\nREPOSITORY          TAG                 IMAGE ID            CREATED                  SIZE\nmy-pio              terukizm            9da04b94845e        Less than a second ago   2.55 GB\npredictionio        latest              2a03ed1aef2e        5 days ago               2.34 GB\n```\n\n\u30db\u30b9\u30c8\u30de\u30b7\u30f3\u306e\u9069\u5f53\u306a\u5834\u6240\u306b\u7de8\u96c6\u7528\u306e\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092`git clone`\u3057\u3066\u304a\u304d\u3001`docker -v`\u3067\u30b3\u30f3\u30c6\u30ca\u5185\u3068\u5171\u6709\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u5185\u306b `/MyCustomRecommender` \u3068\u3057\u3066\u914d\u7f6e\u3057\u3066\u3044\u307e\u3059\u3002\n\n```\n$ cd ~\n$ git clone https://github.com/apache/incubator-predictionio-template-recommender.git\n$ ls ~/incubator-predictionio-template-recommender\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n\n$ docker run -p 8000:8000 -v ~/incubator-predictionio-template-recommender:/MyCustomRecommender -it my-pio:terukizm /bin/bash\n```\n\n\u3042\u3068\u306f\u30b3\u30f3\u30c6\u30ca\u5185\u304b\u3089\u901a\u5e38\u306eEngine Template\u3068\u540c\u3058\u3088\u3046\u306b\u4f7f\u3048\u307e\u3059\u3002\n\n```\n# cd /MyCustomRecommender/\n# ls\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n\n# pio build\n...\n[INFO] [Console$] Your engine is ready for training.\n```\n\n### Windows\u306e\u5834\u5408\n\n\u30b7\u30b9\u30c6\u30e0\u30c8\u30ec\u30a4\u306eDocker\u30a2\u30a4\u30b3\u30f3 > Settings \u304b\u3089\u4ee5\u4e0b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u306b\u3057\u305f\u4e0a\u3067\u3001\u540c\u69d8\u306b\u30de\u30a6\u30f3\u30c8\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n![ssss.png](https://qiita-image-store.s3.amazonaws.com/0/50184/58544106-03f1-3baf-21bb-014941617797.png)\n\n\n```\nC:\\>docker run -p 8000:8000 -v D:/incubator-predictionio-template-recommender:/MyCustomRecommender -it my-pio:terukizm /bin/bash\n\nroot@dce268437faa:/# ls /MyCustomRecommender/\nREADME.md  build.sbt  data  engine.json  project  src  template.json\n```\n\n## \u305d\u306e\u4ed6Tips\n\n### PredictionIO\u306b\u6295\u5165\u3055\u308c\u3066\u3044\u308b\u5b66\u7fd2\u7528\u30c7\u30fc\u30bf\u3092\u524a\u9664\n\n```\n# pio app data-delete MyApp2\n\npio app data-delete MyApp2\n[INFO] [App$] Data of the following app (default channel only) will be deleted. Are you sure?\n[INFO] [App$]     App Name: MyApp2\n[INFO] [App$]       App ID: 2\n[INFO] [App$]  Description: None\n\nEnter 'YES' to proceed: YES\n```\n\n\u300cYES\u300d\u3068\u6253\u3061\u8fbc\u307e\u306a\u3044\u3068\u3044\u3051\u306a\u3044\u306e\u3067\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002(y \u3068\u304b yes \u3067\u306f\u3060\u3081\u3067\u3057\u305f)\n\n\n\n### Engine\u4e2d\u3067\u52d5\u3044\u3066\u308bSpark\u306bJVM\u30aa\u30d7\u30b7\u30e7\u30f3(\u30d2\u30fc\u30d7\u30b5\u30a4\u30ba\u306a\u3069)\u3092\u8a2d\u5b9a\u3057\u305f\u3044\n\npio\u30b5\u30fc\u30d0\u8d77\u52d5\u6642\u306b\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u3057\u3066\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n```\n# JAVA_OPTS=\"-Xms1g -Xmx2g\" pio-start-all\n```\n\n### \u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066Spark\u306e\u30b9\u30bf\u30c3\u30af\u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u3092\u56de\u907f\u3059\u308b\n\n[SparkContext.setCheckpointDir()](https://spark.apache.org/docs/1.5.1/api/java/org/apache/spark/SparkContext.html#setCheckpointDir(java.lang.String))\u3092\u5229\u7528\u3057\u307e\u3059\u3002\n\n```src/main/scala/ALSAlgorithm.scala\n   /* $ pio train */\n   def train(sc: SparkContext, data: PreparedData): ALSModel = {\n\n+    sc.setCheckpointDir(\"checkpoint/\")\n\n     // MLLib ALS cannot handle empty training data.\n     require(!data.ratings.take(1).isEmpty,\n```\n\n\n\u3068\u307e\u3042\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u306a\u3093\u3068\u304bRecommendation Template\u3092\u52d5\u304b\u3059\u3053\u3068\u306f\u3067\u304d\u305f\u306e\u3067\u3059\u304c\u3001\u3053\u308c\u3092\u30d9\u30fc\u30b9\u306b\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3057\u3066\u3044\u304f\u306e\u304c\u6b63\u76f4\u5927\u5909\u3067\u3001\u3076\u3063\u3061\u3083\u3051\u632b\u6298\u3057\u307e\u3057\u305f\u2026\n\n\u5f79\u306b\u305f\u3064\u304b\u306f\u308f\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u6c17\u304c\u5411\u3044\u305f\u3089\u305d\u3061\u3089\u3082\u307e\u3068\u3081\u3066\u304a\u304d\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u2026\u2026\n\n----\n", "tags": ["\u6a5f\u68b0\u5b66\u7fd2", "PredictionIO", "Spark"]}