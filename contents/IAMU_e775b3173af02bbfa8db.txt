{"tags": ["Xamarin.Android", "C#", "Xamarin", "Android"], "context": "\u25a0 \u52d5\u4f5c\u6761\u4ef6\u3068\u3057\u3066\u3001Google \u7ffb\u8a33\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nclass TranslatableTextView : TextView, ICallback\n{\n    public TranslatableTextView(Context context) : base(context)\n    {\n        Init();\n    }\n\n    public TranslatableTextView(Context context, IAttributeSet attrs) : base(context, attrs)\n    {\n        Init();\n    }\n\n    public TranslatableTextView(Context context, IAttributeSet attrs, int defStyleAttr) : base(context, attrs, defStyleAttr)\n    {\n        Init();\n    }\n\n    private void Init()\n    {\n        SetTextIsSelectable(true);\n        CustomSelectionActionModeCallback = this;\n    }\n\n    public ICharSequence SelectedText()\n    {\n        return new Java.Lang.String(TextFormatted.SubSequence(SelectionStart, SelectionEnd));\n    }\n\n    public bool OnCreateActionMode(ActionMode mode, IMenu menu)\n    {\n        foreach(var n in Context.PackageManager.QueryIntentActivities(CreateProcessTextIntent(), 0))\n        {\n            if(n.ActivityInfo.Name == \"com.google.android.apps.translate.copydrop.CopyDropActivity\")\n            {\n                menu.Add(Menu.None, Menu.None, 100, n.LoadLabel(Context.PackageManager))\n                    .SetIntent(CreateProcessTextIntentForResolveInfo(n))\n                    .SetShowAsAction(ShowAsAction.IfRoom);\n\n                break;\n            }\n        }\n\n        return true;\n    }\n\n    private Intent CreateProcessTextIntent()\n    {\n        return new Intent().SetAction(Intent.ActionProcessText).SetType(\"text/plain\");\n    }\n\n    private Intent CreateProcessTextIntentForResolveInfo(ResolveInfo info)\n    {\n        return CreateProcessTextIntent()\n                .PutExtra(Intent.ExtraProcessTextReadonly, true)\n                .SetClassName(info.ActivityInfo.PackageName, info.ActivityInfo.Name);\n    }\n\n    public bool OnPrepareActionMode(ActionMode mode, IMenu menu)\n    {\n        // UNUSE\n        return false;\n    }\n\n    public bool OnActionItemClicked(ActionMode mode, IMenuItem item)\n    {\n        if (item.Intent != null && item.Intent.Component.ClassName == \"com.google.android.apps.translate.copydrop.CopyDropActivity\")\n        {\n            Context.StartActivity(item.Intent.PutExtra(Intent.ExtraProcessText, SelectedText()));\n\n            mode.Finish();\n\n            return true;\n        }\n\n        return false;\n    }\n\n    public void OnDestroyActionMode(ActionMode mode)\n    {\n        // UNUSE\n    }       \n}\n\n\u25a0 \u52d5\u4f5c\u6761\u4ef6\u3068\u3057\u3066\u3001Google \u7ffb\u8a33\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\tclass TranslatableTextView : TextView, ICallback\n\t{\n\t\tpublic TranslatableTextView(Context context) : base(context)\n\t\t{\n\t\t\tInit();\n\t\t}\n\n\t\tpublic TranslatableTextView(Context context, IAttributeSet attrs) : base(context, attrs)\n\t\t{\n\t\t\tInit();\n\t\t}\n\n\t\tpublic TranslatableTextView(Context context, IAttributeSet attrs, int defStyleAttr) : base(context, attrs, defStyleAttr)\n\t\t{\n\t\t\tInit();\n\t\t}\n\n\t\tprivate void Init()\n\t\t{\n\t\t\tSetTextIsSelectable(true);\n\t\t\tCustomSelectionActionModeCallback = this;\n\t\t}\n\t\t\n\t\tpublic ICharSequence SelectedText()\n\t\t{\n\t\t\treturn new Java.Lang.String(TextFormatted.SubSequence(SelectionStart, SelectionEnd));\n\t\t}\n\n\t\tpublic bool OnCreateActionMode(ActionMode mode, IMenu menu)\n\t\t{\n\t\t\tforeach(var n in Context.PackageManager.QueryIntentActivities(CreateProcessTextIntent(), 0))\n\t\t\t{\n\t\t\t\tif(n.ActivityInfo.Name == \"com.google.android.apps.translate.copydrop.CopyDropActivity\")\n\t\t\t\t{\n\t\t\t\t\tmenu.Add(Menu.None, Menu.None, 100, n.LoadLabel(Context.PackageManager))\n\t\t\t\t\t\t.SetIntent(CreateProcessTextIntentForResolveInfo(n))\n\t\t\t\t\t\t.SetShowAsAction(ShowAsAction.IfRoom);\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tprivate Intent CreateProcessTextIntent()\n\t\t{\n\t\t\treturn new Intent().SetAction(Intent.ActionProcessText).SetType(\"text/plain\");\n\t\t}\n\n\t\tprivate Intent CreateProcessTextIntentForResolveInfo(ResolveInfo info)\n\t\t{\n\t\t\treturn CreateProcessTextIntent()\n\t\t\t\t\t.PutExtra(Intent.ExtraProcessTextReadonly, true)\n\t\t\t\t\t.SetClassName(info.ActivityInfo.PackageName, info.ActivityInfo.Name);\n\t\t}\n\n\t\tpublic bool OnPrepareActionMode(ActionMode mode, IMenu menu)\n\t\t{\n\t\t\t// UNUSE\n\t\t\treturn false;\n\t\t}\n\n\t\tpublic bool OnActionItemClicked(ActionMode mode, IMenuItem item)\n\t\t{\n\t\t\tif (item.Intent != null && item.Intent.Component.ClassName == \"com.google.android.apps.translate.copydrop.CopyDropActivity\")\n\t\t\t{\n\t\t\t\tContext.StartActivity(item.Intent.PutExtra(Intent.ExtraProcessText, SelectedText()));\n\n\t\t\t\tmode.Finish();\n\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tpublic void OnDestroyActionMode(ActionMode mode)\n\t\t{\n\t\t\t// UNUSE\n\t\t}\t\t\n\t}\n"}