{"context": " More than 1 year has passed since last update.Express\u3067\u958b\u767a\u3057\u3066\u3066ORM\u5c0e\u5165\u306b\u7d50\u69cb\u8a70\u307e\u3063\u305f\u306e\u3067\u5099\u5fd8\u9332\nExpress\uff1a Node.js\u306e\u305f\u3081\u306e\u3001\u9ad8\u901f\u3067\u8efd\u91cf\u306aWeb\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\nWaterline\uff1a web\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306eSails\u3067\u4f7f\u308f\u308c\u3066\u3044\u308bORM\nBabel\uff1a ES6\u306e\u6a5f\u80fd\u3092\u30c8\u30e9\u30f3\u30b9\u30d1\u30a4\u30eb\u3059\u308b\u3082\u306e AltJS\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\napp.js\nconfig/\n    connection.js\n    db.js\nmodel/\n    Photo.js\n    Category.js\n\n\n\u3068\u308a\u3042\u3048\u305a\u5fc5\u8981\u306a\u7269\u3060\u3051\n\u5b9f\u969b\u306b\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u90e8\u5206\u3084\u30d3\u30e5\u30fc\u90e8\u5206\u304c\u8ffd\u52a0\u3055\u308c\u308b\u306f\u305a\n\nDB\u63a5\u7d9a\u8a2d\u5b9a\n\nconfig/connections.js\nimport mysqlAdapter from 'sails-mysql'\n\nmodule.exports = {\n\n  adapters: {'sails-mysql': mysqlAdapter},\n\n  connections: {\n    default: {\n      adapter: 'sails-mysql',\n      database: 'foo',\n      host: 'bar',\n      user: 'docker',\n      password: 'docker',\n      pool: false,\n      ssl: false\n    }\n  },\n\n  defaults: {\n    // migrate: 'drop' // \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u8cbc\u3063\u305f\u6642\u70b9\u3067Drop\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\n  }\n}\n\n\n\u63a5\u7d9a\u5148\u3068\u304bDB\u30a2\u30c0\u30d7\u30bf\u3068\u304b\nMySQL\u3068PostgreSQL\u306f\u52d5\u4f5c\u78ba\u8a8d\u6e08\u307f\n\nconfig/db.js\nimport Waterline from 'waterline'\nvar waterline = new Waterline()\nimport connectionConfig from './connections'\n\nvar models = [\n  'photo',\n  'category'\n]\n\nmodels.forEach(function(model){\n  waterline.loadCollection(require('../model/'+model))\n})\n\nmodule.exports = {}\n\nmodule.exports.initialize = function(app, callback) {\n  waterline.initialize(connectionConfig, function(err, models) {\n    if(err) throw err\n      callback(models.collections, models.connections)\n  })\n}\nmodule.exports.getModels = models\n\n\n\u30e2\u30c7\u30eb\u3092\u8aad\u307f\u8fbc\u307f\n\nDB\u63a5\u7d9a\u3068\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\n\napp.js\nimport express from 'express'\n\nvar app = express()\nvar db = require('./config/db')\ndb.initialize(app, function(collections, connections) {\n\n  // \u30e2\u30c7\u30eb\u3092\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3078 example -> \"exampleModel\"\n  db.getModels.forEach(function(model){\n    eval(\"global.\" + model + \"Model = collections.\" + model)\n  })\n\n  app.listen(8080, function () {\n    console.log('Server listening on http://localhost:8080, Ctrl+C to stop')\n  })\n})\n\n\nSails\u98a8\u306b\u30e2\u30c7\u30eb\u3092\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3078\ndb.initialize(app, function(collections, connections) {\n  app.models = collections\n  app.connections = connections\n\n\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306b\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u4e0a\u8a18\n(\u53c2\u8003\uff1ahttps://gist.github.com/particlebanana/8441398)\n\n\u30e2\u30c7\u30eb\u306e\u8a2d\u5b9a\n\nmodel/Photo.js\nimport Waterline from 'waterline'\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'photo',\n  connection: 'default',\n\n  attributes: {\n    name:'string',\n    path:'string',\n\n    has_category:{\n      collection: 'category',\n      via: 'has_photo',\n      dominant: true\n    }\n  }\n\n})\n\n\n\nmodel/Category.js\nimport Waterline from 'waterline'\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'category',\n  connection: 'default',\n\n  attributes: {\n    name:'string',\n\n    has_photo: {\n      collection: 'photo',\n      via: 'has_category'\n    }\n  }\n\n})\n\n\nhas_category, has_photo\u306e\u90e8\u5206\u304c\u591a\u5bfe\u591a\u306e\u5834\u5408\u306e\u8a2d\u5b9a\n$ mysql\n\n> show tables;\n+----------------------------------------+\n| Tables_in_foo                          |\n+----------------------------------------+\n| category                               |\n| category_has_photo__photo_has_category |\n| photo                                  |\n+----------------------------------------+\n\n> show full columns from category;\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| Field     | Type             | Collation       | Null | Key | Default | Extra          | Privileges                      | Comment |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| name      | varchar(255)     | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| id        | int(10) unsigned | NULL            | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| createdAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n| updatedAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n\n> show full columns from category_has_photo__photo_has_category;\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n| Field              | Type             | Collation | Null | Key | Default | Extra          | Privileges                      | Comment |\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n| id                 | int(10) unsigned | NULL      | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| photo_has_category | int(11)          | NULL      | YES  |     | NULL    |                | select,insert,update,references |         |\n| category_has_photo | int(11)          | NULL      | YES  |     | NULL    |                | select,insert,update,references |         |\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n\n> show full columns from photo;\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| Field     | Type             | Collation       | Null | Key | Default | Extra          | Privileges                      | Comment |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| name      | longtext         | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| path     | longtext         | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| id        | int(10) unsigned | NULL            | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| createdAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n| updatedAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n\n\n\u4f7f\u7528\u4f8b\n\ncontroller\nphotoModel.find() // photo\u3092\u5168\u4ef6\nphotoModel.find(1)  // photo\u306eid\u304c1\u306e\u3082\u306e\nphotoModel.find({name:'foo'})  // photo\u306ename\u304c'foo'\u306e\u3082\u306e\nphotoModel.find().populate('has_category') // photo\u306bcategory\u3092join\u3057\u305f\u3082\u306e\u3092\u5168\u4ef6\n\n\n\ncontroller\nimport Q from 'q'\n\nQ.all([\n  photoModel.find(),\n  categoryModel.find(),\n]).spread(function(photos, categories){\n  console.log(photos, categories)\n}).catch(function(err){\n  console.log(err)\n})\n\n\n\nExpress\u3067\u958b\u767a\u3057\u3066\u3066ORM\u5c0e\u5165\u306b\u7d50\u69cb\u8a70\u307e\u3063\u305f\u306e\u3067\u5099\u5fd8\u9332\n\nExpress\uff1a Node.js\u306e\u305f\u3081\u306e\u3001\u9ad8\u901f\u3067\u8efd\u91cf\u306aWeb\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\nWaterline\uff1a web\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306eSails\u3067\u4f7f\u308f\u308c\u3066\u3044\u308bORM\nBabel\uff1a ES6\u306e\u6a5f\u80fd\u3092\u30c8\u30e9\u30f3\u30b9\u30d1\u30a4\u30eb\u3059\u308b\u3082\u306e AltJS\n\n\n# \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\n```text:\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u69cb\u6210\napp.js\nconfig/\n    connection.js\n    db.js\nmodel/\n    Photo.js\n    Category.js\n```\n\u3068\u308a\u3042\u3048\u305a\u5fc5\u8981\u306a\u7269\u3060\u3051\n\u5b9f\u969b\u306b\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u90e8\u5206\u3084\u30d3\u30e5\u30fc\u90e8\u5206\u304c\u8ffd\u52a0\u3055\u308c\u308b\u306f\u305a\n\n# DB\u63a5\u7d9a\u8a2d\u5b9a\n```js:config/connections.js\nimport mysqlAdapter from 'sails-mysql'\n\nmodule.exports = {\n\n  adapters: {'sails-mysql': mysqlAdapter},\n\n  connections: {\n    default: {\n      adapter: 'sails-mysql',\n      database: 'foo',\n      host: 'bar',\n      user: 'docker',\n      password: 'docker',\n      pool: false,\n      ssl: false\n    }\n  },\n\n  defaults: {\n    // migrate: 'drop' // \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u3092\u8cbc\u3063\u305f\u6642\u70b9\u3067Drop\u3059\u308b\u30aa\u30d7\u30b7\u30e7\u30f3\n  }\n}\n```\n\n\u63a5\u7d9a\u5148\u3068\u304bDB\u30a2\u30c0\u30d7\u30bf\u3068\u304b\nMySQL\u3068PostgreSQL\u306f\u52d5\u4f5c\u78ba\u8a8d\u6e08\u307f\n\n```js:config/db.js\nimport Waterline from 'waterline'\nvar waterline = new Waterline()\nimport connectionConfig from './connections'\n\nvar models = [\n  'photo',\n  'category'\n]\n\nmodels.forEach(function(model){\n  waterline.loadCollection(require('../model/'+model))\n})\n\nmodule.exports = {}\n\nmodule.exports.initialize = function(app, callback) {\n  waterline.initialize(connectionConfig, function(err, models) {\n    if(err) throw err\n      callback(models.collections, models.connections)\n  })\n}\nmodule.exports.getModels = models\n```\n\u30e2\u30c7\u30eb\u3092\u8aad\u307f\u8fbc\u307f\n\n\n# DB\u63a5\u7d9a\u3068\u30b5\u30fc\u30d0\u30fc\u8d77\u52d5\n```js:app.js\nimport express from 'express'\n\nvar app = express()\nvar db = require('./config/db')\ndb.initialize(app, function(collections, connections) {\n\n  // \u30e2\u30c7\u30eb\u3092\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3078 example -> \"exampleModel\"\n  db.getModels.forEach(function(model){\n    eval(\"global.\" + model + \"Model = collections.\" + model)\n  })\n\n  app.listen(8080, function () {\n    console.log('Server listening on http://localhost:8080, Ctrl+C to stop')\n  })\n})\n```\nSails\u98a8\u306b\u30e2\u30c7\u30eb\u3092\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u3078\n\n```js:\ndb.initialize(app, function(collections, connections) {\n  app.models = collections\n  app.connections = connections\n```\n\u30b0\u30ed\u30fc\u30d0\u30eb\u5909\u6570\u306b\u3057\u305f\u304f\u306a\u3044\u5834\u5408\u306f\u4e0a\u8a18\n(\u53c2\u8003\uff1ahttps://gist.github.com/particlebanana/8441398)\n\n# \u30e2\u30c7\u30eb\u306e\u8a2d\u5b9a\n```js:model/Photo.js\nimport Waterline from 'waterline'\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'photo',\n  connection: 'default',\n\n  attributes: {\n    name:'string',\n    path:'string',\n\n    has_category:{\n      collection: 'category',\n      via: 'has_photo',\n      dominant: true\n    }\n  }\n\n})\n```\n\n```js:model/Category.js\nimport Waterline from 'waterline'\n\nmodule.exports = Waterline.Collection.extend({\n  identity: 'category',\n  connection: 'default',\n\n  attributes: {\n    name:'string',\n\n    has_photo: {\n      collection: 'photo',\n      via: 'has_category'\n    }\n  }\n\n})\n```\nhas_category, has_photo\u306e\u90e8\u5206\u304c\u591a\u5bfe\u591a\u306e\u5834\u5408\u306e\u8a2d\u5b9a\n\n```bash:\n$ mysql\n\n> show tables;\n+----------------------------------------+\n| Tables_in_foo                          |\n+----------------------------------------+\n| category                               |\n| category_has_photo__photo_has_category |\n| photo                                  |\n+----------------------------------------+\n\n> show full columns from category;\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| Field     | Type             | Collation       | Null | Key | Default | Extra          | Privileges                      | Comment |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| name      | varchar(255)     | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| id        | int(10) unsigned | NULL            | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| createdAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n| updatedAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n\n> show full columns from category_has_photo__photo_has_category;\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n| Field              | Type             | Collation | Null | Key | Default | Extra          | Privileges                      | Comment |\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n| id                 | int(10) unsigned | NULL      | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| photo_has_category | int(11)          | NULL      | YES  |     | NULL    |                | select,insert,update,references |         |\n| category_has_photo | int(11)          | NULL      | YES  |     | NULL    |                | select,insert,update,references |         |\n+--------------------+------------------+-----------+------+-----+---------+----------------+---------------------------------+---------+\n\n> show full columns from photo;\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| Field     | Type             | Collation       | Null | Key | Default | Extra          | Privileges                      | Comment |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n| name      | longtext         | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| path     | longtext         | utf8_general_ci | YES  |     | NULL    |                | select,insert,update,references |         |\n| id        | int(10) unsigned | NULL            | NO   | PRI | NULL    | auto_increment | select,insert,update,references |         |\n| createdAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n| updatedAt | datetime         | NULL            | YES  |     | NULL    |                | select,insert,update,references |         |\n+-----------+------------------+-----------------+------+-----+---------+----------------+---------------------------------+---------+\n```\n\n# \u4f7f\u7528\u4f8b\n```js:controller\nphotoModel.find() // photo\u3092\u5168\u4ef6\nphotoModel.find(1)  // photo\u306eid\u304c1\u306e\u3082\u306e\nphotoModel.find({name:'foo'})  // photo\u306ename\u304c'foo'\u306e\u3082\u306e\nphotoModel.find().populate('has_category') // photo\u306bcategory\u3092join\u3057\u305f\u3082\u306e\u3092\u5168\u4ef6\n```\n\n```js:controller\nimport Q from 'q'\n\nQ.all([\n  photoModel.find(),\n  categoryModel.find(),\n]).spread(function(photos, categories){\n  console.log(photos, categories)\n}).catch(function(err){\n  console.log(err)\n})\n\n```\n", "tags": ["Node.js", "Express", "waterline", "babel"]}