{"context": " More than 1 year has passed since last update.\n\n\u5b9f\u73fe\u3057\u305f\u3053\u3068\nBacklog\u3067\u8ab2\u984c\u3092\u8ffd\u52a0\u3001\u3082\u3057\u304f\u306f\u66f4\u65b0\u30fb\u524a\u9664\u3059\u308b\u3068\u30fb\u30fb\u30fb\n\n\u3068\u3044\u3046\u5f62\u3067\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u901a\u77e5\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067Backlog\u3068\u30c1\u30e3\u30c3\u30c8\u30c4\u30fc\u30eb\u304c\u9023\u643a\u3055\u308c\u308c\u3070\u3001\u30e1\u30fc\u30eb\u304b\u3089\u8ab2\u984c\u3092\u8fbf\u308b\u5fc5\u8981\u304c\u7121\u304f\u306a\u308b\u306e\u3067\u3001\u307e\u3059\u307e\u3059\u30e1\u30fc\u30eb\u306e\u5b58\u5728\u611f\u304c\u6e1b\u3063\u3066\u3044\u304f\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3057\u305f\u3002\n\u5177\u4f53\u7684\u306a\u8a2d\u5b9a\u306b\u95a2\u3057\u3066\u306f\u3001\u307b\u3068\u3093\u3069\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u30fc\u3002\nBacklog\u3067Webhook\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3088!!!Hubot\u7d4c\u7531\u3067Slack\u306b\u9023\u643a\u3057\u3066\u307f\u305f\n\n\u6e96\u5099\n\nBacklog\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7528\u610f\nHubot\u3092\u30b5\u30fc\u30d0\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u304a\u304f\nChatwork\u3067\u901a\u77e5\u3059\u308b\u90e8\u5c4b\u3092\u7528\u610f\n\n\nHubot\u5074\u306e\u8a2d\u5b9a\n\u9069\u5f53\u306a\u540d\u524d\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\nbacklog.coffee\n\n\nbacklogUrl = 'https://XXXXX.backlog.jp/'\n\nmodule.exports = (robot) ->\n  robot.router.post \"/room/:room\", (req, res) ->\n    room = req.params.room\n    body = req.body\n\n    console.log 'body type = ' + body.type\n    console.log 'room = ' + room\n\n    try\n      switch body.type\n          when 1\n              label = '\u8ab2\u984c\u304c\u8ffd\u52a0'\n          when 2, 3\n              label = '\u8ab2\u984c\u304c\u66f4\u65b0'\n          when 4\n              label = '\u8ab2\u984c\u304c\u524a\u9664'\n          else\n              return\n\n\n      url = \"#{backlogUrl}view/#{body.project.projectKey}-#{body.content.key_id}\"\n\n      if body.content.comment?.id?\n          url += \"#comment-#{body.content.comment.id}\"\n\n      message = \"[info][title]Backlog\u3088\u308a[/title]\"\n      message += \"#{body.createdUser.name}\u3055\u3093\u306b\u3088\u3063\u3066#{label}\u3055\u308c\u307e\u3057\u305f\\n\"\n      message += \"[#{body.project.projectKey}-#{body.content.key_id}]\"\n      message += \"#{body.content.summary}\\n\"\n\n      if body.content.comment?.content?\n          message += \"#{body.content.comment.content}\\n\"\n      message += \"#{url}[/info]\"\n\n      console.log 'message = ' + message\n\n      if message?\n          robot.messageRoom room, message\n          res.end \"OK\"\n      else\n          robot.messageRoom room, \"Backlog integration error.\"\n          res.end \"Error\"\n    catch error\n      robot.send\n      res.end \"Error\"\n\n\n\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6574\u5f62\u306e\u3068\u3053\u308d\u306f\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5408\u308f\u305b\u3066\u5f04\u3063\u3066\u307e\u3059\u3002\u3053\u3053\u306b\u6765\u3066\u3001\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u8a18\u6cd5\u304c\u610f\u5916\u306b\u4fbf\u5229\u306a\u3093\u3060\u3068\u601d\u3048\u3066\u304d\u307e\u3057\u305f\u3002\n\nBacklog\u5074\u306e\u8a2d\u5b9a\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u300d\u304b\u3089\u300cWebhook\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u5165\u529b\u3057\u307e\u3059\u3002\nhttp://<Hubot\u306e\u30db\u30b9\u30c8\u540d>/room/<Chatwork\u306e\u30eb\u30fc\u30e0ID>\n\n\n\u4fdd\u5b58\u3059\u308b\u524d\u306b\u3001\u300c\u5b9f\u884c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068Webhook\u306e\u30c6\u30b9\u30c8\u9001\u4fe1\u304c\u53ef\u80fd\u3002\n<\u901a\u77e5\u3059\u308b\u30a4\u30d9\u30f3\u30c8>\u3067Backlog\u306e\u4f55\u306e\u64cd\u4f5c\u3092\u9001\u4fe1\u3059\u308b\u304b\u3092\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u3010\u3059\u3079\u3066\u3011\u306b\u2714\ufe0f\u3092\u5165\u308c\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u30dc\u30c7\u30a3\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\n[\n    {\n        \"id\": 3153,\n        \"project\": {\n            \"id\": 92,\n            \"projectKey\": \"SUB\",\n            \"name\": \"\u30b5\u30d6\u30bf\u30b9\u30af\",\n            \"chartEnabled\": true,\n            \"subtaskingEnabled\": true,\n            \"textFormattingRule\": null,\n            \"archived\": false,\n            \"displayOrder\": 0\n        },\n        \"type\": 2,\n        \"content\": {\n            \"id\": 4809,\n            \"key_id\": 121,\n            \"summary\": \"\u30b3\u30e1\u30f3\u30c8\",\n            \"description\": \"\",\n            \"comment\": {\n                \"id\": 7237,\n                \"content\": \"\"\n            },\n            \"changes\": [\n                {\n                    \"field\": \"milestone\",\n                    \"new_value\": \"R2014-07-23\",\n                    \"old_value\": \"\",\n                    \"type\": \"standard\"\n                },\n                {\n                    \"field\": \"status\",\n                    \"new_value\": \"4\",\n                    \"old_value\": \"1\",\n                    \"type\": \"standard\"\n                }\n            ]\n        },\n        \"notifications\": [\n            {\n                \"id\": 25,\n                \"alreadyRead\": false,\n                \"reason\": 2,\n                \"user\": {\n                    \"id\": 5686,\n                    \"userId\": \"takada\",\n                    \"name\": \"takada\",\n                    \"roleType\": 2,\n                    \"lang\": \"ja\",\n                    \"mailAddress\": \"takada@nulab.example\"\n                }\n                \"resourceAlreadyRead\":false\n            },\n        ],\n        \"createdUser\": {\n            \"id\": 1,\n            \"userId\": \"admin\",\n            \"name\": \"admin\",\n            \"roleType\": 1,\n            \"lang\": \"ja\",\n            \"mailAddress\": \"eguchi@nulab.example\"\n        },\n        \"created\": \"2013-12-27T07:50:44Z\"\n    },\n\n]\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u300ctype\u300d\u30821\u301c17\u307e\u3067\u3042\u308b\u306e\u3067\u3001\u901a\u77e5\u3057\u305f\u3044\u5185\u5bb9\u306b\u3088\u3063\u3066\u3046\u307e\u304f\u8868\u793a\u3092\u5909\u3048\u308c\u307e\u3059\u306d\u3002\n\u201dbacklog.coffee\u201d\u5074\u3067\u300ctype\u300d\u306b\u3088\u3063\u3066\u8868\u793a\u3092\u6574\u5f62\u3059\u308c\u3070\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u8a73\u3057\u304f\u306f\u6700\u8fd1\u306e\u66f4\u65b0\u306e\u53d6\u5f97\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n#\u5b9f\u73fe\u3057\u305f\u3053\u3068\n\nBacklog\u3067\u8ab2\u984c\u3092\u8ffd\u52a0\u3001\u3082\u3057\u304f\u306f\u66f4\u65b0\u30fb\u524a\u9664\u3059\u308b\u3068\u30fb\u30fb\u30fb\n\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-03-19 20.36.05.png](https://qiita-image-store.s3.amazonaws.com/0/67591/ff8119bd-5b72-44b3-c907-e3945cf28814.png)\n\n\n\u3068\u3044\u3046\u5f62\u3067\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u3067\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u901a\u77e5\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\u3053\u3093\u306a\u611f\u3058\u3067Backlog\u3068\u30c1\u30e3\u30c3\u30c8\u30c4\u30fc\u30eb\u304c\u9023\u643a\u3055\u308c\u308c\u3070\u3001\u30e1\u30fc\u30eb\u304b\u3089\u8ab2\u984c\u3092\u8fbf\u308b\u5fc5\u8981\u304c\u7121\u304f\u306a\u308b\u306e\u3067\u3001\u307e\u3059\u307e\u3059\u30e1\u30fc\u30eb\u306e\u5b58\u5728\u611f\u304c\u6e1b\u3063\u3066\u3044\u304f\u3088\u3046\u306a\u6c17\u304c\u3057\u307e\u3057\u305f\u3002\n\n\u5177\u4f53\u7684\u306a\u8a2d\u5b9a\u306b\u95a2\u3057\u3066\u306f\u3001\u307b\u3068\u3093\u3069\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u3055\u305b\u3066\u3044\u305f\u3060\u3044\u3066\u307e\u3059\u30fc\u3002\n[Backlog\u3067Webhook\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3088!!!Hubot\u7d4c\u7531\u3067Slack\u306b\u9023\u643a\u3057\u3066\u307f\u305f](http://qiita.com/mayukojpn/items/a9a9408c21a761adb7d0 \"Backlog\u3067Webhook\u304c\u8ffd\u52a0\u3055\u308c\u305f\u3088!!!Hubot\u7d4c\u7531\u3067Slack\u306b\u9023\u643a\u3057\u3066\u307f\u305f\")\n\n\n#\u6e96\u5099\n\n- Backlog\u3067\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u7528\u610f\n- Hubot\u3092\u30b5\u30fc\u30d0\u306b\u30c7\u30d7\u30ed\u30a4\u3057\u3066\u304a\u304f\n- Chatwork\u3067\u901a\u77e5\u3059\u308b\u90e8\u5c4b\u3092\u7528\u610f\n\n\n#Hubot\u5074\u306e\u8a2d\u5b9a\n\n\u9069\u5f53\u306a\u540d\u524d\u3067\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\n\n```coffeescript:backlog.coffee\n\n\nbacklogUrl = 'https://XXXXX.backlog.jp/'\n\nmodule.exports = (robot) ->\n  robot.router.post \"/room/:room\", (req, res) ->\n    room = req.params.room\n    body = req.body\n\n    console.log 'body type = ' + body.type\n    console.log 'room = ' + room\n\n    try\n      switch body.type\n          when 1\n              label = '\u8ab2\u984c\u304c\u8ffd\u52a0'\n          when 2, 3\n              label = '\u8ab2\u984c\u304c\u66f4\u65b0'\n          when 4\n              label = '\u8ab2\u984c\u304c\u524a\u9664'\n          else\n              return\n              \n\n      url = \"#{backlogUrl}view/#{body.project.projectKey}-#{body.content.key_id}\"\n      \n      if body.content.comment?.id?\n          url += \"#comment-#{body.content.comment.id}\"\n\n      message = \"[info][title]Backlog\u3088\u308a[/title]\"\n      message += \"#{body.createdUser.name}\u3055\u3093\u306b\u3088\u3063\u3066#{label}\u3055\u308c\u307e\u3057\u305f\\n\"\n      message += \"[#{body.project.projectKey}-#{body.content.key_id}]\"\n      message += \"#{body.content.summary}\\n\"\n      \n      if body.content.comment?.content?\n          message += \"#{body.content.comment.content}\\n\"\n      message += \"#{url}[/info]\"\n\n      console.log 'message = ' + message\n      \n      if message?\n          robot.messageRoom room, message\n          res.end \"OK\"\n      else\n          robot.messageRoom room, \"Backlog integration error.\"\n          res.end \"Error\"\n    catch error\n      robot.send\n      res.end \"Error\"\n\n```\n\u30e1\u30c3\u30bb\u30fc\u30b8\u306e\u6574\u5f62\u306e\u3068\u3053\u308d\u306f\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u306b\u5408\u308f\u305b\u3066\u5f04\u3063\u3066\u307e\u3059\u3002\u3053\u3053\u306b\u6765\u3066\u3001\u30c1\u30e3\u30c3\u30c8\u30ef\u30fc\u30af\u8a18\u6cd5\u304c\u610f\u5916\u306b\u4fbf\u5229\u306a\u3093\u3060\u3068\u601d\u3048\u3066\u304d\u307e\u3057\u305f\u3002\n\n#Backlog\u5074\u306e\u8a2d\u5b9a\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u300c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u8a2d\u5b9a\u300d\u304b\u3089\u300cWebhook\u300d\u3092\u9078\u629e\u3057\u307e\u3059\u3002\n<webhook url>\u306b\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5f62\u5f0f\u3067\u5165\u529b\u3057\u307e\u3059\u3002\n\n```\nhttp://<Hubot\u306e\u30db\u30b9\u30c8\u540d>/room/<Chatwork\u306e\u30eb\u30fc\u30e0ID>\n```\n\n![\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2015-03-20 10.49.34.png](https://qiita-image-store.s3.amazonaws.com/0/67591/bee001e8-1ce4-8f44-8d81-2297662836ec.png)\n\n\u4fdd\u5b58\u3059\u308b\u524d\u306b\u3001\u300c\u5b9f\u884c\u300d\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3068Webhook\u306e\u30c6\u30b9\u30c8\u9001\u4fe1\u304c\u53ef\u80fd\u3002\n\n<\u901a\u77e5\u3059\u308b\u30a4\u30d9\u30f3\u30c8>\u3067Backlog\u306e\u4f55\u306e\u64cd\u4f5c\u3092\u9001\u4fe1\u3059\u308b\u304b\u3092\u9078\u3079\u308b\u3088\u3046\u306b\u306a\u3063\u3066\u3044\u3066\u3001\u3010\u3059\u3079\u3066\u3011\u306b\u2714\ufe0f\u3092\u5165\u308c\u308b\u3068\u4ee5\u4e0b\u306e\u69d8\u306a\u30ec\u30b9\u30dd\u30f3\u30b9\u30dc\u30c7\u30a3\u304c\u9001\u3089\u308c\u307e\u3059\u3002\n\n```json:\n\n[\n    {\n        \"id\": 3153,\n        \"project\": {\n            \"id\": 92,\n            \"projectKey\": \"SUB\",\n            \"name\": \"\u30b5\u30d6\u30bf\u30b9\u30af\",\n            \"chartEnabled\": true,\n            \"subtaskingEnabled\": true,\n            \"textFormattingRule\": null,\n            \"archived\": false,\n            \"displayOrder\": 0\n        },\n        \"type\": 2,\n        \"content\": {\n            \"id\": 4809,\n            \"key_id\": 121,\n            \"summary\": \"\u30b3\u30e1\u30f3\u30c8\",\n            \"description\": \"\",\n            \"comment\": {\n                \"id\": 7237,\n                \"content\": \"\"\n            },\n            \"changes\": [\n                {\n                    \"field\": \"milestone\",\n                    \"new_value\": \"R2014-07-23\",\n                    \"old_value\": \"\",\n                    \"type\": \"standard\"\n                },\n                {\n                    \"field\": \"status\",\n                    \"new_value\": \"4\",\n                    \"old_value\": \"1\",\n                    \"type\": \"standard\"\n                }\n            ]\n        },\n        \"notifications\": [\n            {\n                \"id\": 25,\n                \"alreadyRead\": false,\n                \"reason\": 2,\n                \"user\": {\n                    \"id\": 5686,\n                    \"userId\": \"takada\",\n                    \"name\": \"takada\",\n                    \"roleType\": 2,\n                    \"lang\": \"ja\",\n                    \"mailAddress\": \"takada@nulab.example\"\n                }\n                \"resourceAlreadyRead\":false\n            },\n        ],\n        \"createdUser\": {\n            \"id\": 1,\n            \"userId\": \"admin\",\n            \"name\": \"admin\",\n            \"roleType\": 1,\n            \"lang\": \"ja\",\n            \"mailAddress\": \"eguchi@nulab.example\"\n        },\n        \"created\": \"2013-12-27T07:50:44Z\"\n    },\n    \n]\n\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u300ctype\u300d\u30821\u301c17\u307e\u3067\u3042\u308b\u306e\u3067\u3001\u901a\u77e5\u3057\u305f\u3044\u5185\u5bb9\u306b\u3088\u3063\u3066\u3046\u307e\u304f\u8868\u793a\u3092\u5909\u3048\u308c\u307e\u3059\u306d\u3002\n\n\u201dbacklog.coffee\u201d\u5074\u3067\u300ctype\u300d\u306b\u3088\u3063\u3066\u8868\u793a\u3092\u6574\u5f62\u3059\u308c\u3070\u3001\u308f\u304b\u308a\u3084\u3059\u304f\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u8a73\u3057\u304f\u306f[\u6700\u8fd1\u306e\u66f4\u65b0\u306e\u53d6\u5f97](http://developer.nulab-inc.com/ja/docs/backlog/api/2/get-activities \"\u6700\u8fd1\u306e\u66f4\u65b0\u306e\u53d6\u5f97\")\u3092\u53c2\u8003\u306b\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n", "tags": ["Hubot", "backlog", "chatwork"]}