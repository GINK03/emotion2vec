{"tags": ["OpenStreetMap", "centos7"], "context": "\u672c\u30dd\u30b9\u30c8\u306f\n\u3000https://switch2osm.org/serving-tiles/manually-building-a-tile-server-14-04/\n\u306e\u713c\u304d\u76f4\u3057\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u79c1\u306f\u30b3\u30ec\u3067\u52d5\u304d\u307e\u3057\u305f\u3063\u3066\u3053\u3068\u3067\u3002\n\nOS\u306b\u3064\u3044\u3066\nCentOS7\u3067\u9069\u5f53\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\n\u203b\u30e6\u30fc\u30b6\u30fc\u540d\u306fosm\u3068\u3057\u3066\u3044\u307e\u3059\n\n\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u7fa4\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install epel-release\nyum -y update\nyum -y install postgresql-server postgresql-contrib postgresql-devel postgis postgis-utils git make automake gcc gcc-c++ libtool policycoreutils-python php-pgsql php php-pear php-pear-DB libpqxx-devel proj-epsg bzip2-devel bzip2 proj-devel geos-devel libxml2-devel protobuf-c-devel lua-devel boost-devel expat-devel cmake httpd-devel freetype-devel libtool-ltdl-devel libpng-devel libtiff-devel libicu-devel libjpeg-devel libcurl-devel cairo-devel pycairo-devel harfbuzz-devel ipa*fonts vlgothic*fonts unzip npm wget\nnpm -g install carto\n\nDB\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nsudo postgresql-setup initdb\nsudo systemctl enable postgresql\nsudo systemctl start postgresql\nsudo -u postgres createuser -s osm\nsudo -u postgres createuser apache\nsudo -u postgres createdb -E UTF8 -O osm gis\nsudo -u postgres psql\n\\c gis\nCREATE EXTENSION postgis;\nALTER TABLE geometry_columns OWNER TO osm;\nALTER TABLE spatial_ref_sys OWNER TO osm;\n\\q\n\nnominatim\u306emake\nsu -\ncd /srv\ntar xvf /home/osm/Nominatim-2.4.0.tar.bz2\nmv Nominatim-2.4.0 Nominatim && cd Nominatim && ./configure && make\nvi setting/setting.php\n\u4e0b\u8a18\u306b\u5909\u3048\u305f\n   @define('CONST_Database_DSN', 'pgsql://@/osm');\n   @define('CONST_Database_Web_User', 'apache');\n   @define('CONST_Postgresql_Version', '9.2');\n   @define('CONST_Postgis_Version', '2.0');\n   @define('CONST_Website_BaseURL', 'http://'.php_uname('n').'/osm/');\n\nsemanage fcontext -a -t httpd_sys_content_t \"/srv/Nominatim/(website|lib|settings)(/.*)?\"\nsemanage fcontext -a -t lib_t \"/srv/Nominatim/module/nominatim.so\"\nrestorecon -R -v /srv/Nominatim\nosm\u30e6\u30fc\u30b6\u30fc\u3067\nnohup /srv/Nominatim/utils/setup.php --osm-file /tmp/japan-latest.osm.pbf --all --osm2pgsql-cache 6400 &\nsudo mkdir -m 755 /var/www/html/osm\nsudo chown osm  /var/www/html/osm\n/srv/Nominatim/utils/setup.php --create-website /var/www/html/osm\n/etc/httpd/conf.d/osm.conf\n  <Directory \"/var/www/html/osm/\">\n    Options FollowSymLinks MultiViews\n    AddType text/html   .php     \n  </Directory>\n\nsystemctl restart httpd\n\n\u5404\u7a2e\u30bd\u30d5\u30c8\u3092clone\u3057\u3066\u304a\u304f\ngit clone https://github.com/openstreetmap/osm2pgsql.git\ngit clone https://github.com/mapnik/mapnik\ngit clone https://github.com/openstreetmap/mod_tile.git\n\nosm2pgsql\u306emake\ncd osm2pgsql\nmkdir build && cd build && cmake .. && make && sudo make install\n\nmapnik\u306emake\ncd mapnik\ngit checkout -b 2.3 origin/2.3.x\npython scons/scons.py configure INPUT_PLUGINS=all OPTIMIZATION=3 SYSTEM_FONTS=/usr/share/fonts/ PREFIX=/usr\nsudo make install\nsudo ldconfig\npython\u306b\u3066\nimport mapnik\n\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\nmodule_tile\u306emake\ncd mod_tile\n./autogen.sh\n./configure\nsudo make install\nsudo make install-mod_tile\nsudo ldconfig\nvi /etc/httpd/conf/httpd.conf\nLoadModule tile_module modules/mod_tile.so\nLoadTileConfigFile /usr/local/etc/renderd.conf\nModTileRenderdSocketName /var/run/renderd/renderd.sock\nModTileRequestTimeout 0\nModTileMissingRequestTimeout 30\n\n\n\u5730\u56f3style\u306e\u4f5c\u6210\nsudo mkdir -p /usr/local/share/maps/style\nsudo chown osm /usr/local/share/maps/style\ncd /usr/local/share/maps/style\nmkdir ne_10m_populated_places_simple\ncd ne_10m_populated_places_simple\nunzip ~/ne_10m_populated_places_simple.zip \ncd ..\nunzip ~/master.zip \nunzip ~/simplified-land-polygons-complete-3857.zip \nunzip ~/land-polygons-split-3857.zip\nmkdir osm-bright-master/shp\nmv land-polygons-split-3857 osm-bright-master/shp/\nmv simplified-land-polygons-complete-3857 osm-bright-master/shp/\nmv ne_10m_populated_places_simple osm-bright-master/shp/\ncd osm-bright-master/shp/land-polygons-split-3857\nshapeindex land_polygons.shp\ncd ../simplified-land-polygons-complete-3857/\nshapeindex simplified_land_polygons.shp\ncd ../..\nvi osm-bright/osm-bright.osm2pgsql.mml\ncp ~/configure.py .\n./make.py\ncd ../OSMBright/\ncarto project.mml > OSMBright.xml\nOSMBright.xml\u306e\u30d5\u30a9\u30f3\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\n\n\u3068\u304b\u3092\u8ffd\u52a0\u3059\u308b\nvi /usr/loca/etc/re\n\nXML=/usr/local/share/maps/style/OSMBright/OSMBright.xml\nHOST=localhost\n\nsudo mkdir -p /var/run/renderd\nsudo chown osm /var/run/renderd\nsudo mkdir -p /var/lib/mod_tile\nsudo chown osm /var/lib/mod_tile\n\nconvert data\n\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067nohup\u3067\u5b9f\u884c\u3002\nnohup time osm2pgsql --slim -S /usr/local/share/osm2pgsql/default.style -d gis -C 4000 /tmp/japan.osm.bz2 &\n\nSELINUX\u3092\u5207\u308b\nsetenforce 0\n\u203b\u6c17\u3092\u3064\u3051\u308b\n\n\u5b9f\u884c\nrenderd -f -c /usr/local/etc/renderd.conf\n\ntest\nhttp://192.168.1.xxx/osm_tiles/0/0/0.png\nhttp://192.168.1.xxx/osm/reverse.php?format=json&lat=35.905207&lon=139.620168\n\nubuntu\u306e\u5834\u5408\nyum\u3058\u3083\u306a\u304f\u3066apt-get\u3067\nsudo apt-get install libboost-all-dev subversion git-core tar unzip wget bzip2 build-essential autoconf libtool libxml2-dev libgeos-dev libgeos++-dev libpq-dev libbz2-dev libproj-dev munin-node munin libprotobuf-c0-dev protobuf-c-compiler libfreetype6-dev libpng12-dev libtiff4-dev libicu-dev libgdal-dev libcairo-dev libcairomm-1.0-dev apache2 apache2-dev libagg-dev liblua5.2-dev ttf-unifont lua5.1 liblua5.1-dev libgeotiff-epsg node-carto postgresql postgresql-contrib postgis postgresql-9.3-postgis-2.1\n\u3068\u304b\u3059\u308c\u3070\u3088\u3044\u3002\n\u672c\u30dd\u30b9\u30c8\u306f\n\u3000https://switch2osm.org/serving-tiles/manually-building-a-tile-server-14-04/\n\u306e\u713c\u304d\u76f4\u3057\u3067\u3059\u3002\n\u3068\u308a\u3042\u3048\u305a\u79c1\u306f\u30b3\u30ec\u3067\u52d5\u304d\u307e\u3057\u305f\u3063\u3066\u3053\u3068\u3067\u3002\n\n\n#OS\u306b\u3064\u3044\u3066\nCentOS7\u3067\u9069\u5f53\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3057\u305f\n\u203b\u30e6\u30fc\u30b6\u30fc\u540d\u306fosm\u3068\u3057\u3066\u3044\u307e\u3059\n\n\n#\u5fc5\u8981\u306a\u30bd\u30d5\u30c8\u30a6\u30a8\u30a2\u7fa4\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum -y install epel-release\nyum -y update\nyum -y install postgresql-server postgresql-contrib postgresql-devel postgis postgis-utils git make automake gcc gcc-c++ libtool policycoreutils-python php-pgsql php php-pear php-pear-DB libpqxx-devel proj-epsg bzip2-devel bzip2 proj-devel geos-devel libxml2-devel protobuf-c-devel lua-devel boost-devel expat-devel cmake httpd-devel freetype-devel libtool-ltdl-devel libpng-devel libtiff-devel libicu-devel libjpeg-devel libcurl-devel cairo-devel pycairo-devel harfbuzz-devel ipa*fonts vlgothic*fonts unzip npm wget\nnpm -g install carto\n\n\n\n\n#DB\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\nsudo postgresql-setup initdb\nsudo systemctl enable postgresql\nsudo systemctl start postgresql\nsudo -u postgres createuser -s osm\nsudo -u postgres createuser apache\nsudo -u postgres createdb -E UTF8 -O osm gis\nsudo -u postgres psql\n\\c gis\nCREATE EXTENSION postgis;\nALTER TABLE geometry_columns OWNER TO osm;\nALTER TABLE spatial_ref_sys OWNER TO osm;\n\\q\n\n\n#nominatim\u306emake\nsu -\ncd /srv\ntar xvf /home/osm/Nominatim-2.4.0.tar.bz2\nmv Nominatim-2.4.0 Nominatim && cd Nominatim && ./configure && make\n\n\nvi setting/setting.php\n\n\u4e0b\u8a18\u306b\u5909\u3048\u305f\n\n```\n   @define('CONST_Database_DSN', 'pgsql://@/osm');\n   @define('CONST_Database_Web_User', 'apache');\n   @define('CONST_Postgresql_Version', '9.2');\n   @define('CONST_Postgis_Version', '2.0');\n   @define('CONST_Website_BaseURL', 'http://'.php_uname('n').'/osm/');\n```  \n \n\nsemanage fcontext -a -t httpd_sys_content_t \"/srv/Nominatim/(website|lib|settings)(/.*)?\"\nsemanage fcontext -a -t lib_t \"/srv/Nominatim/module/nominatim.so\"\nrestorecon -R -v /srv/Nominatim\n\nosm\u30e6\u30fc\u30b6\u30fc\u3067\nnohup /srv/Nominatim/utils/setup.php --osm-file /tmp/japan-latest.osm.pbf --all --osm2pgsql-cache 6400 &\n\nsudo mkdir -m 755 /var/www/html/osm\nsudo chown osm  /var/www/html/osm\n/srv/Nominatim/utils/setup.php --create-website /var/www/html/osm\n\n/etc/httpd/conf.d/osm.conf\n\n```\n  <Directory \"/var/www/html/osm/\">\n    Options FollowSymLinks MultiViews\n    AddType text/html   .php     \n  </Directory>\n```  \n\nsystemctl restart httpd\n\n\n\n#\u5404\u7a2e\u30bd\u30d5\u30c8\u3092clone\u3057\u3066\u304a\u304f\ngit clone https://github.com/openstreetmap/osm2pgsql.git\ngit clone https://github.com/mapnik/mapnik\ngit clone https://github.com/openstreetmap/mod_tile.git\n\n\n#osm2pgsql\u306emake\n\ncd osm2pgsql\nmkdir build && cd build && cmake .. && make && sudo make install\n\n\n#mapnik\u306emake\n\ncd mapnik\ngit checkout -b 2.3 origin/2.3.x\npython scons/scons.py configure INPUT_PLUGINS=all OPTIMIZATION=3 SYSTEM_FONTS=/usr/share/fonts/ PREFIX=/usr\nsudo make install\nsudo ldconfig\n\n\npython\u306b\u3066\n\nimport mapnik\n\n\u3067\u30a8\u30e9\u30fc\u304c\u51fa\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n\n#module_tile\u306emake\n\ncd mod_tile\n./autogen.sh\n./configure\nsudo make install\nsudo make install-mod_tile\nsudo ldconfig\n\n\nvi /etc/httpd/conf/httpd.conf\n\n```\nLoadModule tile_module modules/mod_tile.so\nLoadTileConfigFile /usr/local/etc/renderd.conf\nModTileRenderdSocketName /var/run/renderd/renderd.sock\nModTileRequestTimeout 0\nModTileMissingRequestTimeout 30\n```\n\n#\u5730\u56f3style\u306e\u4f5c\u6210\n\nsudo mkdir -p /usr/local/share/maps/style\nsudo chown osm /usr/local/share/maps/style\ncd /usr/local/share/maps/style\nmkdir ne_10m_populated_places_simple\ncd ne_10m_populated_places_simple\nunzip ~/ne_10m_populated_places_simple.zip \ncd ..\nunzip ~/master.zip \nunzip ~/simplified-land-polygons-complete-3857.zip \nunzip ~/land-polygons-split-3857.zip\nmkdir osm-bright-master/shp\nmv land-polygons-split-3857 osm-bright-master/shp/\nmv simplified-land-polygons-complete-3857 osm-bright-master/shp/\nmv ne_10m_populated_places_simple osm-bright-master/shp/\n\n\n\ncd osm-bright-master/shp/land-polygons-split-3857\nshapeindex land_polygons.shp\ncd ../simplified-land-polygons-complete-3857/\nshapeindex simplified_land_polygons.shp\ncd ../..\n\nvi osm-bright/osm-bright.osm2pgsql.mml\n\ncp ~/configure.py .\n./make.py\ncd ../OSMBright/\ncarto project.mml > OSMBright.xml\n\n\nOSMBright.xml\u306e\u30d5\u30a9\u30f3\u30c8\u30b0\u30eb\u30fc\u30d7\u306b\n<Font face-name=\"VL Gothic regular\"/>\n\u3068\u304b\u3092\u8ffd\u52a0\u3059\u308b\n\n\n\n\nvi /usr/loca/etc/re\n```\nXML=/usr/local/share/maps/style/OSMBright/OSMBright.xml\nHOST=localhost\n```\n\nsudo mkdir -p /var/run/renderd\nsudo chown osm /var/run/renderd\nsudo mkdir -p /var/lib/mod_tile\nsudo chown osm /var/lib/mod_tile\n\n\n#convert data\n\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u3067nohup\u3067\u5b9f\u884c\u3002\nnohup time osm2pgsql --slim -S /usr/local/share/osm2pgsql/default.style -d gis -C 4000 /tmp/japan.osm.bz2 &\n\n\n#SELINUX\u3092\u5207\u308b\nsetenforce 0\n\u203b\u6c17\u3092\u3064\u3051\u308b\n\n#\u5b9f\u884c\nrenderd -f -c /usr/local/etc/renderd.conf\n\n\n#test\nhttp://192.168.1.xxx/osm_tiles/0/0/0.png\nhttp://192.168.1.xxx/osm/reverse.php?format=json&lat=35.905207&lon=139.620168\n\n\n#ubuntu\u306e\u5834\u5408\nyum\u3058\u3083\u306a\u304f\u3066apt-get\u3067\n\nsudo apt-get install libboost-all-dev subversion git-core tar unzip wget bzip2 build-essential autoconf libtool libxml2-dev libgeos-dev libgeos++-dev libpq-dev libbz2-dev libproj-dev munin-node munin libprotobuf-c0-dev protobuf-c-compiler libfreetype6-dev libpng12-dev libtiff4-dev libicu-dev libgdal-dev libcairo-dev libcairomm-1.0-dev apache2 apache2-dev libagg-dev liblua5.2-dev ttf-unifont lua5.1 liblua5.1-dev libgeotiff-epsg node-carto postgresql postgresql-contrib postgis postgresql-9.3-postgis-2.1\n\n\u3068\u304b\u3059\u308c\u3070\u3088\u3044\u3002\n"}