{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306b\u5f93\u3063\u3066\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea Zulip \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u304c\u3001\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u4f55\u304b\u304c\u52d5\u3044\u3066\u3044\u306a\u3044\u3063\u307d\u3044\u30fb\u30fb\u30fbREADME.prod.md \u306b\u3088\u308b\u3068\u3001Zulip \u306f\u4e0b\u8a18\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\n\npostgresql\nrabbitmq-server\nnginx\nredis\nmemcached\n\n\u79c1\u306f Zulip \u3092 AWS EC2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u8aad\u3080\u3068 RabbitMQ \u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3067\u4f55\u304c\u3069\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u52d5\u3044\u3066\u3044\u308b\u304b\u3092\u899a\u66f8\u306b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n\u5bfe\u8c61\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n\u30ea\u30f3\u30af\u5148\u306e\u30da\u30fc\u30b8\u3092\u8aad\u3093\u3067 Zulip 1.3.7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\nZulip 1.3.7\nRun your own Zulip server\nzulip/README.prod.md\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\n\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u6b21\u306e\u9806\u5e8f\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\nzulip/scripts/setup/install\nzulip/scripts/lib/install\nzulip/scripts/zulip-puppet-apply\nzulip/puppet/zulip/manifests/voyager.pp\nzulip/scripts/setup/configure-rabbitmq\nzulip/scripts/setup/initialize-database\n\n\nzulip/scripts/setup/install\n\n#!/bin/bash\nset -e\nset -o pipefail\nif [ \"$EUID\" -ne 0 ]; then\n    echo \"Error: The installation script must be run as root\" >&2\n    exit 1\nfi\nmkdir -p /var/log/zulip\n\"$(dirname \"$(dirname \"$0\")\")/lib/install\" \"$@\" 2>&1 | tee -a /var/log/zulip/install.log\n\n\u30a8\u30e9\u30fc\u304c\u3042\u308c\u3070\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e2d\u6b62\u3059\u308b\u3002\n\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5185\u306e\u30a8\u30e9\u30fc\u3067\u4e2d\u6b62\u3059\u308b\u3002\nroot \u30e6\u30fc\u30b6\u30fc\u3067\u306a\u3051\u308c\u3070\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7570\u5e38\u7d42\u4e86\u3055\u305b\u308b\u3002\n/var/log/zulip \u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u3002\nzulip/scripts/lib/install \u3092\u5b9f\u884c\u3059\u308b\u3002\n\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u6a19\u6e96\u51fa\u529b\u306b\u7d50\u5408\u3057\u3066 /var/log/zulip/install.log \u306b\u30ed\u30b0\u51fa\u529b\u3059\u308b\u3002\n\nzulip/scripts/lib/install\n\n\nFirst, install any updates from the apt repo that may be needed\n#!/bin/bash -xe\n\n0 \u4ee5\u5916\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3067\u7d42\u4e86\u3057\u305f\u5834\u5408\u306f\u76f4\u3061\u306b\u7d42\u4e86\u3059\u308b\u3002\nreadline \u3067\u884c\u3092\u53d6\u5f97\u3059\u308b\u3002\n# Assumes we've already been untarred\n\n# First, install any updates from the apt repo that may be needed\nwget -O /root/zulip-ppa.asc https://zulip.com/dist/keys/zulip-ppa.asc\napt-key add /root/zulip-ppa.asc\ncat >/etc/apt/sources.list.d/zulip.list <<EOF\ndeb http://ppa.launchpad.net/tabbott/zulip/ubuntu trusty main\ndeb-src http://ppa.launchpad.net/tabbott/zulip/ubuntu trusty main\nEOF\n\napt-get update\napt-get -y dist-upgrade\napt-get install -y puppet git python\n\napt \u306e\u516c\u958b\u9375\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5143\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u3092\u66f4\u65b0\u3059\u308b\u3002\n\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3059\u308b\u3002\npuppet git python \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\nmkdir -p /etc/zulip\necho -e \"[machine]\\npuppet_classes = zulip::voyager\\ndeploy_type = voyager\" > /etc/zulip/zulip.conf\n/root/zulip/scripts/zulip-puppet-apply -f\n\n/etc/zulip \u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u3002\n/etc/zulip/zulip.conf \u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u8fbc\u3080\u3002\n\nzulip.conf\n[machine]\npuppet_classes = zulip::voyager\ndeploy_type = voyager\n\n\nzulip/scripts/zulip-puppet-apply \u3092\u5b9f\u884c\u3059\u308b\u3002\n\nThese server restarting bits should be moveable into puppet-land, ideally\napt-get -y upgrade\nif [ -e \"/etc/init.d/nginx\" ]; then\n    service nginx restart\nfi\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3059\u308b\u3002\nNginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n/root/zulip/scripts/setup/generate_secrets.py\ncp -a /root/zulip/zproject/local_settings_template.py /etc/zulip/settings.py\nln -nsf /etc/zulip/settings.py /root/zulip/zproject/local_settings.py\n\ngenerate_secrets.py \u3092\u5b9f\u884c\u3059\u308b\u3002\nlocal_settings_template.py \u3092 /etc/zulip/settings.py \u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n/etc/zulip/settings.py \u306b /root/zulip/zproject/local_settings.py \u304b\u3089\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\u3002\nif ! rabbitmqctl status >/dev/null; then\n    set +x\n    echo; echo \"RabbitMQ seems to not have started properly after the installation process.\"\n    echo \"Often, this can be caused by misconfigured /etc/hosts in virtualized environments\"\n    echo \"See https://github.com/zulip/zulip/issues/53#issuecomment-143805121\"\n    echo \"for more information\"\n    echo\n    set -x\n    exit 1\nfi\n\n/root/zulip/scripts/setup/configure-rabbitmq\n\nRabbitMQ \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u7570\u5e38\u7d42\u4e86\u3059\u308b\u3002\n/root/zulip/scripts/setup/configure-rabbitmq\n\n/root/zulip/scripts/setup/postgres-init-db\n\nconfigure-rabbitmq \u3092\u5b9f\u884c\u3059\u308b\u3002\npostgres-init-db \u3092\u5b9f\u884c\u3059\u308b\u3002\ndeploy_path=$(/root/zulip/zulip_tools.py make_deploy_path)\nmv /root/zulip \"$deploy_path\"\nln -nsf /home/zulip/deployments/next /root/zulip\nln -nsf \"$deploy_path\" /home/zulip/deployments/next\nln -nsf \"$deploy_path\" /home/zulip/deployments/current\nln -nsf /etc/zulip/settings.py \"$deploy_path\"/zproject/local_settings.py\ncp -rT \"$deploy_path\"/prod-static/serve /home/zulip/prod-static\nchown -R zulip:zulip /home/zulip /var/log/zulip /etc/zulip/settings.py\nchown zulip:zulip /var/run/supervisor.sock\n\nzulip_tools.py  make_deploy_path \u3092\u5b9f\u884c\u3057 deploy_path \u3092\u53d6\u5f97\u3059\u308b\u3002\n/root/zulip \u3092 $deploy_path \u306b\u79fb\u52d5\u3059\u308b\u3002\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\u3002\n\n\n\n\u5148\n\u5143\n\n\n\n\n/home/zulip/deployments/next\n/root/zulip\n\n\n\"$deploy_path\"\n/home/zulip/deployments/next\n\n\n\"$deploy_path\"\n/home/zulip/deployments/current\n\n\n/etc/zulip/settings.py\n\"$deploy_path\"/zproject/local_settings.py\n\n\n\n\"$deploy_path\"/prod-static/serve \u3092 /home/zulip/prod-static \u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u6240\u6709\u8005\u3092 zulip:zulip \u306b\u5909\u66f4\u3059\u308b\u3002\ncd /home/zulip/deployments/current\n\nset +x\ncat <<EOF\n Installation complete!\n Now edit /etc/zulip/settings.py and fill in the mandatory values.\n Once you've done that, please run:\n su zulip -c /home/zulip/deployments/current/scripts/setup/initialize-database\n To configure the initial database.\nEOF\n\n/home/zulip/deployments/current \u306b\u79fb\u52d5\u3059\u308b\u3002\n\nzulip/scripts/zulip-puppet-apply\n\n#!/usr/bin/python\n\nimport sys\nimport subprocess\nimport ConfigParser\nimport re\n\n\u6b21\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u3002\n\n\u30b7\u30b9\u30c6\u30e0\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u95a2\u6570\n\u30b5\u30d6\u30d7\u30ed\u30bb\u30b9\u7ba1\u7406\n\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u89e3\u6790\u5668\n\u6b63\u898f\u8868\u73fe\u64cd\u4f5c\n\nforce = False\nextra_args = sys.argv[1:]\n\nif len(extra_args) and extra_args[0] in ('-f', '--force'):\n    force = True\n    extra_args = extra_args[1:]\n\nconfig = ConfigParser.RawConfigParser()\nconfig.read(\"/etc/zulip/zulip.conf\")\n\n\u7b2c\u4e00\u5f15\u6570\u304c -f \u306a\u3089\u3070 force = True \u306b\u3059\u308b\u3002\nzulip.conf \u3092\u8aad\u307f\u8fbc\u3080\u3002\npuppet_config = \"\"\"\nExec { path => \"/usr/sbin:/usr/bin:/sbin:/bin\" }\ninclude apt\n\"\"\"\n\npuppet_config \u3092\u8a2d\u5b9a\u3059\u308b\u3002\nfor pclass in re.split(r'\\s*,\\s*', config.get('machine', 'puppet_classes')):\n    puppet_config += \"include %s\\n\" % (pclass,)\n\nPuppet \u306e\u30af\u30e9\u30b9\u3092 puppet_config \u306b\u8ffd\u52a0\u3059\u308b\u3002\npuppet_cmd = [\"puppet\", \"apply\", \"--modulepath=/root/zulip/puppet\", \"-e\", puppet_config]\npuppet_cmd += extra_args\n\n/root/zulip/puppet \u3092 Puppet \u306e\u5b9f\u884c\u5bfe\u8c61\u306b\u3059\u308b\u3002\nif force:\n    subprocess.check_call(puppet_cmd)\n    sys.exit(0)\n\nforce \u304c True \u306a\u3089\u3001Puppet \u3092\u5b9f\u884c\u3059\u308b\u3002\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u3001\u6b63\u5e38\u7d42\u4e86\u3059\u308b\u3002\nsubprocess.check_call(puppet_cmd + ['--noop', '--show_diff'])\n\nPuppet \u3092\u5b9f\u884c\u305b\u305a\u3001\u5dee\u5206\u3092\u8868\u793a\u3059\u308b\u3002\ndo_apply = None\nwhile not (do_apply == 'y' or do_apply == 'n'):\n    sys.stdout.write(\"Apply changes? [y/N] \")\n    do_apply = sys.stdin.readline().strip().lower()\n    if do_apply == '':\n        do_apply = 'n'\n\n\u5909\u66f4\u3092\u9069\u7528\u3059\u308b\u304b\u3092\u554f\u3044\u5408\u308f\u305b\u308b\u3002\nif do_apply == 'y':\n    subprocess.check_call(puppet_cmd)\n\n\u9078\u629e\u304c 'y' \u306a\u3089\u3001Puppet \u3092\u5b9f\u884c\u3059\u308b\u3002\n\nzulip/puppet/zulip/manifests/voyager.pp\n\nclass zulip::voyager {\n  include zulip::base\n  include zulip::app_frontend\n  include zulip::postgres_appdb\n  include zulip::redis\n\n\u4ed6\u306e\u30af\u30e9\u30b9\u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u3002\n\u3053\u308c\u3089\u306e\u8a73\u7d30\u306f Zulip \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3060 (2/2) \u306b\u66f8\u304d\u307e\u3059\u3002\n\nzulip/puppet/zulip/manifests/base.pp\nzulip/puppet/zulip/manifests/app_frontend.pp\n\nzulip/puppet/zulip/manifests/postgres_appdb.pp\nzulip/puppet/zulip/manifests/redis.pp\n\n  apt::source {'zulip':\n    location    => 'http://ppa.launchpad.net/tabbott/zulip/ubuntu',\n    release     => 'trusty',\n    repos       => 'main',\n    key         => '84C2BE60E50E336456E4749CE84240474E26AE47',\n    key_source  => 'https://zulip.com/dist/keys/zulip.asc',\n    pin         => '995',\n    include_src => true,\n  }\n\napt::source \u30af\u30e9\u30b9\u306b\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nzulip/puppet/apt/manifests/source.pp\n\n  file { \"/etc/nginx/sites-available/zulip-enterprise\":\n    require => Package[\"nginx-full\"],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/nginx/sites-available/zulip-enterprise\",\n    notify => Service[\"nginx\"],\n  }\n  file { '/etc/nginx/sites-enabled/zulip-enterprise':\n    require => Package[\"nginx-full\"],\n    ensure => 'link',\n    target => '/etc/nginx/sites-available/zulip-enterprise',\n    notify => Service[\"nginx\"],\n  }\n\n\nzulip/puppet/zulip/files/nginx/sites-available/zulip-enterprise\n\n  file { '/home/zulip/prod-static':\n    ensure => 'directory',\n    owner  => 'zulip',\n    group  => 'zulip',\n  }\n\n  file { \"/etc/cron.d/restart-zulip\":\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/cron.d/restart-zulip\",\n  }\n\n\nzulip/puppet/zulip/files/cron.d/restart-zulip\n\n  file { '/etc/postgresql/9.3/main/postgresql.conf.template':\n    require => Package[\"postgresql-9.3\"],\n    ensure => file,\n    owner  => \"postgres\",\n    group  => \"postgres\",\n    mode   => 644,\n    source => \"puppet:///modules/zulip/postgresql/postgresql.conf.template\"\n  }\n\n\nzulip/puppet/zulip/files/postgresql/postgresql.conf.template\n\n  # We can't use the built-in $memorysize fact because it's a string with human-readable units\n  $total_memory = regsubst(file('/proc/meminfo'), '^.*MemTotal:\\s*(\\d+) kB.*$', '\\1', 'M') * 1024\n  $half_memory = $total_memory / 2\n  $half_memory_pages = $half_memory / 4096\n\n  file {'/etc/sysctl.d/40-postgresql.conf':\n    ensure => file,\n    owner  => 'root',\n    group  => 'root',\n    mode   => 644,\n    content =>\n\"kernel.shmall = $half_memory_pages\nkernel.shmmax = $half_memory\n# These are the defaults on newer kernels\nvm.dirty_ratio = 10\nvm.dirty_background_ratio = 5\n\"\n    }\n\n\u5171\u6709\u30e1\u30e2\u30ea\u3068\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\nzulip/puppet/zulip_internal/files/postgresql/40-postgresql.conf.master\n\n  exec { \"sysctl_p\":\n    command   => \"/sbin/sysctl -p /etc/sysctl.d/40-postgresql.conf\",\n    subscribe => File['/etc/sysctl.d/40-postgresql.conf'],\n    refreshonly => true,\n  }\n\n\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u66f4\u3059\u308b\u3002\n  exec { 'pgtune':\n    require => Package[\"pgtune\"],\n    # Let Postgres use half the memory on the machine\n    command => \"pgtune -T Web -M $half_memory -i /etc/postgresql/9.3/main/postgresql.conf.template -o /etc/postgresql/9.3/main/postgresql.conf\",\n    refreshonly => true,\n    subscribe => File['/etc/postgresql/9.3/main/postgresql.conf.template']\n  }\n\nPGTune \u3067 PostgreSQL \u3092\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3002\u30de\u30b7\u30f3\u306e\u30e1\u30e2\u30ea\u306e\u534a\u5206\u3092\u4f7f\u7528\u3059\u308b\u3002\n\nzulip/puppet/zulip/files/postgresql/postgresql.conf.template\n\n  exec { 'pg_ctlcluster 9.3 main restart':\n    require => Exec[\"sysctl_p\"],\n    refreshonly => true,\n    subscribe => [ Exec['pgtune'], File['/etc/sysctl.d/40-postgresql.conf'] ]\n  }\n}\n\npgtune \u3092\u5b9f\u884c\u3059\u308b\u3002\n\nzulip/scripts/setup/configure-rabbitmq\n\n#!/bin/sh -xe\n#\n# Delete the \"guest\" default user and replace it with a Zulip user\n# with a real password\n\nRMQPW=$(\"$(dirname \"$0\")/../../bin/get-django-setting\" RABBITMQ_PASSWORD)\nsudo rabbitmqctl delete_user zulip || true\nsudo rabbitmqctl delete_user guest || true\nsudo rabbitmqctl add_user zulip \"$RMQPW\"\nsudo rabbitmqctl set_user_tags zulip administrator\nsudo rabbitmqctl set_permissions -p / zulip '.*' '.*' '.*'\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30e6\u30fc\u30b6\u30fc\u3092\u524a\u9664\u3057\u3001Zulip \u30e6\u30fc\u30b6\u30fc\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\n\nzulip/bin/get-django-setting\n\n\nzulip/scripts/setup/initialize-database\n\n#!/bin/bash -xe\n\n# Change to root directory of the checkout that we're running from\ncd \"$(dirname \"$0\")/../..\"\n\npython manage.py checkconfig\n\npython manage.py migrate --noinput\npython manage.py createcachetable third_party_api_results\n\nif ! python manage.py initialize_voyager_db; then\n    set +x\n    echo\n    echo -e \"\\033[32mPopulating default database failed.\"\n    echo \"After you fix the problem, you will need to do the following before rerunning this:\"\n    echo \"  * supervisorctl stop all # to stop all services that might be accessing the database\"\n    echo \"  * scripts/setup/postgres-init-db # run as root to drop and re-create the database\"\n    echo -e \"\\033[0m\"\n    set -x\n    exit 1\nfi\n\nsupervisorctl restart all\n\necho \"Congratulations!  You have successfully configured your Zulip database.\"\necho \"If you haven't already, you should configure email in /etc/zulip/settings.py\"\necho \"And then you should now be able to visit your server over https and sign up using\"\necho \"an email address that ends with @ADMIN_DOMAIN (from your settings file).\"\necho \"\"\necho \"See README.prod.md for instructions on how to confirm your Zulip install is healthy, \"\necho \" change ADMIN_DOMAIN, debug common issues, and otherwise finish setting things up.\"\n\n# \u306f\u3058\u3081\u306b\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\u306b\u5f93\u3063\u3066\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u30a2\u30d7\u30ea [Zulip](https://zulip.org/index.html) \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u52d5\u304b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\u304c\u3001\u30de\u30b7\u30f3\u3092\u518d\u8d77\u52d5\u3059\u308b\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u9001\u53d7\u4fe1\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u4f55\u304b\u304c\u52d5\u3044\u3066\u3044\u306a\u3044\u3063\u307d\u3044\u30fb\u30fb\u30fbREADME.prod.md \u306b\u3088\u308b\u3068\u3001Zulip \u306f\u4e0b\u8a18\u306e\u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3057\u3066\u3044\u308b\u3068\u306e\u3053\u3068\u3002\n\n- postgresql\n- rabbitmq-server\n- nginx\n- redis\n- memcached\n\n\u79c1\u306f Zulip \u3092 AWS EC2 \u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u305f\u306e\u3067\u3059\u304c\u3001\u30a8\u30e9\u30fc\u30ed\u30b0\u3092\u8aad\u3080\u3068 RabbitMQ \u306e\u8d77\u52d5\u306b\u5931\u6557\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u3068\u3044\u3046\u3053\u3068\u3067\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3067\u4f55\u304c\u3069\u306e\u3088\u3046\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u52d5\u3044\u3066\u3044\u308b\u304b\u3092\u899a\u66f8\u306b\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n## \u5bfe\u8c61\u30d0\u30fc\u30b8\u30e7\u30f3\u3068\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u624b\u9806\n\u30ea\u30f3\u30af\u5148\u306e\u30da\u30fc\u30b8\u3092\u8aad\u3093\u3067 Zulip 1.3.7 \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u305f\u3002\n\n- Zulip 1.3.7\n- [Run your own Zulip server](https://zulip.org/server.html)\n- [zulip/README.prod.md](https://github.com/zulip/zulip/blob/1.3.7/README.prod.md)\n\n# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\n\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u6b21\u306e\u9806\u5e8f\u3067\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002\n\n1. [zulip/scripts/setup/install](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/install)\n2. [zulip/scripts/lib/install](https://github.com/zulip/zulip/blob/1.3.7/scripts/lib/install)\n3. [zulip/scripts/zulip-puppet-apply](https://github.com/zulip/zulip/blob/1.3.7/scripts/zulip-puppet-apply)\n4. [zulip/puppet/zulip/manifests/voyager.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/voyager.pp)\n5. [zulip/scripts/setup/configure-rabbitmq](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/configure-rabbitmq)\n6. [zulip/scripts/setup/initialize-database](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/initialize-database)\n\n## [zulip/scripts/setup/install](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/install)\n\n```bash\n#!/bin/bash\nset -e\nset -o pipefail\nif [ \"$EUID\" -ne 0 ]; then\n    echo \"Error: The installation script must be run as root\" >&2\n    exit 1\nfi\nmkdir -p /var/log/zulip\n\"$(dirname \"$(dirname \"$0\")\")/lib/install\" \"$@\" 2>&1 | tee -a /var/log/zulip/install.log\n```\n\n\u30a8\u30e9\u30fc\u304c\u3042\u308c\u3070\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4e2d\u6b62\u3059\u308b\u3002\n\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5185\u306e\u30a8\u30e9\u30fc\u3067\u4e2d\u6b62\u3059\u308b\u3002\nroot \u30e6\u30fc\u30b6\u30fc\u3067\u306a\u3051\u308c\u3070\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u7570\u5e38\u7d42\u4e86\u3055\u305b\u308b\u3002\n/var/log/zulip \u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u3002\n[zulip/scripts/lib/install](https://github.com/zulip/zulip/blob/1.3.7/scripts/lib/install) \u3092\u5b9f\u884c\u3059\u308b\u3002\n\u30a8\u30e9\u30fc\u51fa\u529b\u3092\u6a19\u6e96\u51fa\u529b\u306b\u7d50\u5408\u3057\u3066 /var/log/zulip/install.log \u306b\u30ed\u30b0\u51fa\u529b\u3059\u308b\u3002\n\n## [zulip/scripts/lib/install](https://github.com/zulip/zulip/blob/1.3.7/scripts/lib/install)\n### First, install any updates from the apt repo that may be needed\n\n```bash\n#!/bin/bash -xe\n```\n\n0 \u4ee5\u5916\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3067\u7d42\u4e86\u3057\u305f\u5834\u5408\u306f\u76f4\u3061\u306b\u7d42\u4e86\u3059\u308b\u3002\nreadline \u3067\u884c\u3092\u53d6\u5f97\u3059\u308b\u3002\n\n```bash\n# Assumes we've already been untarred\n\n# First, install any updates from the apt repo that may be needed\nwget -O /root/zulip-ppa.asc https://zulip.com/dist/keys/zulip-ppa.asc\napt-key add /root/zulip-ppa.asc\ncat >/etc/apt/sources.list.d/zulip.list <<EOF\ndeb http://ppa.launchpad.net/tabbott/zulip/ubuntu trusty main\ndeb-src http://ppa.launchpad.net/tabbott/zulip/ubuntu trusty main\nEOF\n\napt-get update\napt-get -y dist-upgrade\napt-get install -y puppet git python\n```\n\napt \u306e\u516c\u958b\u9375\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5143\u3092\u6307\u5b9a\u3059\u308b\u3002\n\u30d1\u30c3\u30b1\u30fc\u30b8\u30ea\u30b9\u30c8\u3092\u66f4\u65b0\u3059\u308b\u3002\n\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3059\u308b\u3002\npuppet git python \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3002\n\n```bash\nmkdir -p /etc/zulip\necho -e \"[machine]\\npuppet_classes = zulip::voyager\\ndeploy_type = voyager\" > /etc/zulip/zulip.conf\n/root/zulip/scripts/zulip-puppet-apply -f\n```\n\n/etc/zulip \u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308b\u3002\n/etc/zulip/zulip.conf \u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u66f8\u304d\u8fbc\u3080\u3002\n\n```zulip.conf\n[machine]\npuppet_classes = zulip::voyager\ndeploy_type = voyager\n```\n\n[zulip/scripts/zulip-puppet-apply](https://github.com/zulip/zulip/blob/1.3.7/scripts/zulip-puppet-apply) \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n### These server restarting bits should be moveable into puppet-land, ideally\n\n```bash\napt-get -y upgrade\nif [ -e \"/etc/init.d/nginx\" ]; then\n    service nginx restart\nfi\n```\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u66f4\u65b0\u3059\u308b\u3002\nNginx \u3092\u518d\u8d77\u52d5\u3059\u308b\u3002\n\n```bash\n/root/zulip/scripts/setup/generate_secrets.py\ncp -a /root/zulip/zproject/local_settings_template.py /etc/zulip/settings.py\nln -nsf /etc/zulip/settings.py /root/zulip/zproject/local_settings.py\n```\n\n[generate_secrets.py](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/generate_secrets.py) \u3092\u5b9f\u884c\u3059\u308b\u3002\n[local_settings_template.py](https://github.com/zulip/zulip/blob/1.3.7/zproject/local_settings_template.py) \u3092 /etc/zulip/settings.py \u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n/etc/zulip/settings.py \u306b /root/zulip/zproject/local_settings.py \u304b\u3089\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\u3002\n\n```bash\nif ! rabbitmqctl status >/dev/null; then\n    set +x\n    echo; echo \"RabbitMQ seems to not have started properly after the installation process.\"\n    echo \"Often, this can be caused by misconfigured /etc/hosts in virtualized environments\"\n    echo \"See https://github.com/zulip/zulip/issues/53#issuecomment-143805121\"\n    echo \"for more information\"\n    echo\n    set -x\n    exit 1\nfi\n\n/root/zulip/scripts/setup/configure-rabbitmq\n```\n\nRabbitMQ \u304c\u8d77\u52d5\u3057\u3066\u3044\u306a\u3051\u308c\u3070\u7570\u5e38\u7d42\u4e86\u3059\u308b\u3002\n\n```bash\n/root/zulip/scripts/setup/configure-rabbitmq\n\n/root/zulip/scripts/setup/postgres-init-db\n```\n\n[configure-rabbitmq](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/configure-rabbitmq) \u3092\u5b9f\u884c\u3059\u308b\u3002\n[postgres-init-db](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/initialize-database) \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n```bash\ndeploy_path=$(/root/zulip/zulip_tools.py make_deploy_path)\nmv /root/zulip \"$deploy_path\"\nln -nsf /home/zulip/deployments/next /root/zulip\nln -nsf \"$deploy_path\" /home/zulip/deployments/next\nln -nsf \"$deploy_path\" /home/zulip/deployments/current\nln -nsf /etc/zulip/settings.py \"$deploy_path\"/zproject/local_settings.py\ncp -rT \"$deploy_path\"/prod-static/serve /home/zulip/prod-static\nchown -R zulip:zulip /home/zulip /var/log/zulip /etc/zulip/settings.py\nchown zulip:zulip /var/run/supervisor.sock\n```\n[zulip_tools.py](https://github.com/zulip/zulip/blob/1.3.7/zulip_tools.py)  make_deploy_path \u3092\u5b9f\u884c\u3057 deploy_path \u3092\u53d6\u5f97\u3059\u308b\u3002\n/root/zulip \u3092 $deploy_path \u306b\u79fb\u52d5\u3059\u308b\u3002\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u5f35\u308b\u3002\n\n| \u5148 | \u5143 |\n|---|---|\n| /home/zulip/deployments/next | /root/zulip |\n| \"$deploy_path\"| /home/zulip/deployments/next |\n| \"$deploy_path\"| /home/zulip/deployments/current |\n| /etc/zulip/settings.py | \"$deploy_path\"/zproject/local_settings.py |\n\n\"$deploy_path\"/prod-static/serve \u3092 /home/zulip/prod-static \u306b\u30b3\u30d4\u30fc\u3059\u308b\u3002\n\u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3068\u6240\u6709\u8005\u3092 zulip:zulip \u306b\u5909\u66f4\u3059\u308b\u3002\n\n```bash\ncd /home/zulip/deployments/current\n\nset +x\ncat <<EOF\n Installation complete!\n Now edit /etc/zulip/settings.py and fill in the mandatory values.\n Once you've done that, please run:\n su zulip -c /home/zulip/deployments/current/scripts/setup/initialize-database\n To configure the initial database.\nEOF\n```\n\n/home/zulip/deployments/current \u306b\u79fb\u52d5\u3059\u308b\u3002\n\n## [zulip/scripts/zulip-puppet-apply](https://github.com/zulip/zulip/blob/1.3.7/scripts/zulip-puppet-apply)\n\n```py\n#!/usr/bin/python\n\nimport sys\nimport subprocess\nimport ConfigParser\nimport re\n```\n\n\u6b21\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u30a4\u30f3\u30dd\u30fc\u30c8\u3059\u308b\u3002\n\n- \u30b7\u30b9\u30c6\u30e0\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u95a2\u6570\n- \u30b5\u30d6\u30d7\u30ed\u30bb\u30b9\u7ba1\u7406\n- \u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306e\u69cb\u6587\u89e3\u6790\u5668\n- \u6b63\u898f\u8868\u73fe\u64cd\u4f5c\n\n```py\nforce = False\nextra_args = sys.argv[1:]\n\nif len(extra_args) and extra_args[0] in ('-f', '--force'):\n    force = True\n    extra_args = extra_args[1:]\n\nconfig = ConfigParser.RawConfigParser()\nconfig.read(\"/etc/zulip/zulip.conf\")\n```\n\n\u7b2c\u4e00\u5f15\u6570\u304c -f \u306a\u3089\u3070 force = True \u306b\u3059\u308b\u3002\nzulip.conf \u3092\u8aad\u307f\u8fbc\u3080\u3002\n\n```py\npuppet_config = \"\"\"\nExec { path => \"/usr/sbin:/usr/bin:/sbin:/bin\" }\ninclude apt\n\"\"\"\n```\n\npuppet_config \u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n```py\nfor pclass in re.split(r'\\s*,\\s*', config.get('machine', 'puppet_classes')):\n    puppet_config += \"include %s\\n\" % (pclass,)\n```\n\nPuppet \u306e\u30af\u30e9\u30b9\u3092 puppet_config \u306b\u8ffd\u52a0\u3059\u308b\u3002\n\n```py\npuppet_cmd = [\"puppet\", \"apply\", \"--modulepath=/root/zulip/puppet\", \"-e\", puppet_config]\npuppet_cmd += extra_args\n```\n\n/root/zulip/puppet \u3092 Puppet \u306e\u5b9f\u884c\u5bfe\u8c61\u306b\u3059\u308b\u3002\n\n```py\nif force:\n    subprocess.check_call(puppet_cmd)\n    sys.exit(0)\n```\n\nforce \u304c True \u306a\u3089\u3001Puppet \u3092\u5b9f\u884c\u3059\u308b\u3002\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5f8c\u3001\u6b63\u5e38\u7d42\u4e86\u3059\u308b\u3002\n\n```py\nsubprocess.check_call(puppet_cmd + ['--noop', '--show_diff'])\n```\n\nPuppet \u3092\u5b9f\u884c\u305b\u305a\u3001\u5dee\u5206\u3092\u8868\u793a\u3059\u308b\u3002\n\n```py\ndo_apply = None\nwhile not (do_apply == 'y' or do_apply == 'n'):\n    sys.stdout.write(\"Apply changes? [y/N] \")\n    do_apply = sys.stdin.readline().strip().lower()\n    if do_apply == '':\n        do_apply = 'n'\n```\n\n\u5909\u66f4\u3092\u9069\u7528\u3059\u308b\u304b\u3092\u554f\u3044\u5408\u308f\u305b\u308b\u3002\n\n```py\nif do_apply == 'y':\n    subprocess.check_call(puppet_cmd)\n```\n\n\u9078\u629e\u304c 'y' \u306a\u3089\u3001Puppet \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n## [zulip/puppet/zulip/manifests/voyager.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/voyager.pp)\n\n```pp\nclass zulip::voyager {\n  include zulip::base\n  include zulip::app_frontend\n  include zulip::postgres_appdb\n  include zulip::redis\n```\n\n\u4ed6\u306e\u30af\u30e9\u30b9\u3092\u30a4\u30f3\u30af\u30eb\u30fc\u30c9\u3059\u308b\u3002\n\u3053\u308c\u3089\u306e\u8a73\u7d30\u306f [Zulip \u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8aad\u3093\u3060 (2/2)](http://qiita.com/usutani/items/8a1862c13ab056fc7197) \u306b\u66f8\u304d\u307e\u3059\u3002\n\n- [zulip/puppet/zulip/manifests/base.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/base.pp)\n- [zulip/puppet/zulip/manifests/app_frontend.pp\n](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/app_frontend.pp)\n- [zulip/puppet/zulip/manifests/postgres_appdb.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/postgres_appdb.pp)\n- [zulip/puppet/zulip/manifests/redis.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/manifests/redis.pp)\n\n```pp\n  apt::source {'zulip':\n    location    => 'http://ppa.launchpad.net/tabbott/zulip/ubuntu',\n    release     => 'trusty',\n    repos       => 'main',\n    key         => '84C2BE60E50E336456E4749CE84240474E26AE47',\n    key_source  => 'https://zulip.com/dist/keys/zulip.asc',\n    pin         => '995',\n    include_src => true,\n  }\n```\n\napt::source \u30af\u30e9\u30b9\u306b\u5024\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n- [zulip/puppet/apt/manifests/source.pp](https://github.com/zulip/zulip/blob/1.3.7/puppet/apt/manifests/source.pp)\n\n```pp\n  file { \"/etc/nginx/sites-available/zulip-enterprise\":\n    require => Package[\"nginx-full\"],\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/nginx/sites-available/zulip-enterprise\",\n    notify => Service[\"nginx\"],\n  }\n  file { '/etc/nginx/sites-enabled/zulip-enterprise':\n    require => Package[\"nginx-full\"],\n    ensure => 'link',\n    target => '/etc/nginx/sites-available/zulip-enterprise',\n    notify => Service[\"nginx\"],\n  }\n```\n\n- [zulip/puppet/zulip/files/nginx/sites-available/zulip-enterprise](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/nginx/sites-available/zulip-enterprise)\n\n```pp\n  file { '/home/zulip/prod-static':\n    ensure => 'directory',\n    owner  => 'zulip',\n    group  => 'zulip',\n  }\n```\n\n```pp\n  file { \"/etc/cron.d/restart-zulip\":\n    ensure => file,\n    owner  => \"root\",\n    group  => \"root\",\n    mode => 644,\n    source => \"puppet:///modules/zulip/cron.d/restart-zulip\",\n  }\n```\n\n- [zulip/puppet/zulip/files/cron.d/restart-zulip](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/cron.d/restart-zulip)\n\n```pp\n  file { '/etc/postgresql/9.3/main/postgresql.conf.template':\n    require => Package[\"postgresql-9.3\"],\n    ensure => file,\n    owner  => \"postgres\",\n    group  => \"postgres\",\n    mode   => 644,\n    source => \"puppet:///modules/zulip/postgresql/postgresql.conf.template\"\n  }\n```\n\n- [zulip/puppet/zulip/files/postgresql/postgresql.conf.template](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip/files/postgresql/postgresql.conf.template)\n\n```pp\n  # We can't use the built-in $memorysize fact because it's a string with human-readable units\n  $total_memory = regsubst(file('/proc/meminfo'), '^.*MemTotal:\\s*(\\d+) kB.*$', '\\1', 'M') * 1024\n  $half_memory = $total_memory / 2\n  $half_memory_pages = $half_memory / 4096\n\n  file {'/etc/sysctl.d/40-postgresql.conf':\n    ensure => file,\n    owner  => 'root',\n    group  => 'root',\n    mode   => 644,\n    content =>\n\"kernel.shmall = $half_memory_pages\nkernel.shmmax = $half_memory\n# These are the defaults on newer kernels\nvm.dirty_ratio = 10\nvm.dirty_background_ratio = 5\n\"\n    }\n```\n\n\u5171\u6709\u30e1\u30e2\u30ea\u3068\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u8a2d\u5b9a\u3059\u308b\u3002\n\n- [zulip/puppet/zulip_internal/files/postgresql/40-postgresql.conf.master](https://github.com/zulip/zulip/blob/1.3.7/puppet/zulip_internal/files/postgresql/40-postgresql.conf.master)\n\n```pp\n  exec { \"sysctl_p\":\n    command   => \"/sbin/sysctl -p /etc/sysctl.d/40-postgresql.conf\",\n    subscribe => File['/etc/sysctl.d/40-postgresql.conf'],\n    refreshonly => true,\n  }\n```\n\n\u30ab\u30fc\u30cd\u30eb\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u5909\u66f4\u3059\u308b\u3002\n\n```pp\n  exec { 'pgtune':\n    require => Package[\"pgtune\"],\n    # Let Postgres use half the memory on the machine\n    command => \"pgtune -T Web -M $half_memory -i /etc/postgresql/9.3/main/postgresql.conf.template -o /etc/postgresql/9.3/main/postgresql.conf\",\n    refreshonly => true,\n    subscribe => File['/etc/postgresql/9.3/main/postgresql.conf.template']\n  }\n```\n\n[PGTune](http://pgtune.leopard.in.ua) \u3067 PostgreSQL \u3092\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3002\u30de\u30b7\u30f3\u306e\u30e1\u30e2\u30ea\u306e\u534a\u5206\u3092\u4f7f\u7528\u3059\u308b\u3002\n\n- [zulip/puppet/zulip/files/postgresql/postgresql.conf.template](https://github.com/zulip/zulip/blob/master/puppet/zulip/files/postgresql/postgresql.conf.template)\n\n```pp\n  exec { 'pg_ctlcluster 9.3 main restart':\n    require => Exec[\"sysctl_p\"],\n    refreshonly => true,\n    subscribe => [ Exec['pgtune'], File['/etc/sysctl.d/40-postgresql.conf'] ]\n  }\n}\n```\n\npgtune \u3092\u5b9f\u884c\u3059\u308b\u3002\n\n## [zulip/scripts/setup/configure-rabbitmq](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/configure-rabbitmq)\n\n```bash\n#!/bin/sh -xe\n#\n# Delete the \"guest\" default user and replace it with a Zulip user\n# with a real password\n\nRMQPW=$(\"$(dirname \"$0\")/../../bin/get-django-setting\" RABBITMQ_PASSWORD)\nsudo rabbitmqctl delete_user zulip || true\nsudo rabbitmqctl delete_user guest || true\nsudo rabbitmqctl add_user zulip \"$RMQPW\"\nsudo rabbitmqctl set_user_tags zulip administrator\nsudo rabbitmqctl set_permissions -p / zulip '.*' '.*' '.*'\n```\n\n\u30c7\u30d5\u30a9\u30eb\u30c8\u30e6\u30fc\u30b6\u30fc\u3092\u524a\u9664\u3057\u3001Zulip \u30e6\u30fc\u30b6\u30fc\u306b\u7f6e\u304d\u63db\u3048\u308b\u3002\n\n- [zulip/bin/get-django-setting](https://github.com/zulip/zulip/blob/1.3.7/bin/get-django-setting)\n\n## [zulip/scripts/setup/initialize-database](https://github.com/zulip/zulip/blob/1.3.7/scripts/setup/initialize-database)\n\n```bash\n#!/bin/bash -xe\n\n# Change to root directory of the checkout that we're running from\ncd \"$(dirname \"$0\")/../..\"\n\npython manage.py checkconfig\n\npython manage.py migrate --noinput\npython manage.py createcachetable third_party_api_results\n\nif ! python manage.py initialize_voyager_db; then\n    set +x\n    echo\n    echo -e \"\\033[32mPopulating default database failed.\"\n    echo \"After you fix the problem, you will need to do the following before rerunning this:\"\n    echo \"  * supervisorctl stop all # to stop all services that might be accessing the database\"\n    echo \"  * scripts/setup/postgres-init-db # run as root to drop and re-create the database\"\n    echo -e \"\\033[0m\"\n    set -x\n    exit 1\nfi\n\nsupervisorctl restart all\n\necho \"Congratulations!  You have successfully configured your Zulip database.\"\necho \"If you haven't already, you should configure email in /etc/zulip/settings.py\"\necho \"And then you should now be able to visit your server over https and sign up using\"\necho \"an email address that ends with @ADMIN_DOMAIN (from your settings file).\"\necho \"\"\necho \"See README.prod.md for instructions on how to confirm your Zulip install is healthy, \"\necho \" change ADMIN_DOMAIN, debug common issues, and otherwise finish setting things up.\"\n```\n", "tags": ["Zulip", "Puppet"]}