{"tags": ["\u3069\u3046\u66f8\u304f", "SQL", "yhpg"], "context": " More than 1 year has passed since last update.\u554f\u984c\u306f\u3053\u3061\u3089\u3002\nhttp://nabetani.sakura.ne.jp/hena/ord9busfare/\n\u30c6\u30b9\u30c8\u306b\u4f7f\u7528\u3057\u305fDB\u306fMySQL\u3067\u3059\u3002\n\u307e\u305a\u554f\u984c\u3092\u5165\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3002\n\u554f\u984c\u756a\u53f7\u306e\u30ab\u30e9\u30e0\u306f\u7701\u7565\u3002\u4e00\u554f\u6bce\u306b\u4f5c\u308a\u306a\u304a\u3059\u3002\nDROP TABLE IF EXISTS charge;\nCREATE TABLE charge(charge INT,expect INT);\nDROP TABLE IF EXISTS PASSENGERS;\nCREATE TABLE passengers(age CHAR(1),type CHAR(1));\n\n\u554f\u984c\u767b\u9332\u3002\nINSERT INTO charge VALUES(210,170);\nINSERT INTO passengers VALUES('C','n');\nINSERT INTO passengers VALUES('I','n');\nINSERT INTO passengers VALUES('I','w');\nINSERT INTO passengers VALUES('A','p');\nINSERT INTO passengers VALUES('I','w');\n\n\u305d\u3057\u3066\u89e3\u304f\u3002\nOFFSET\u6307\u5b9a\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u304c\u4f7f\u3048\u305f\u3089\u30c6\u30f3\u30dd\u30e9\u30ea\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u3089\u306a\u304f\u3066\u3059\u3093\u3060\u306e\u306b\u30fb\u30fb\u3002\nCREATE TEMPORARY TABLE wk(id INT PRIMARY KEY AUTO_INCREMENT,charge INT)\n  SELECT * FROM(\n    SELECT TRUNCATE(charge/20+0.9,0)*10 AS charge FROM passengers JOIN charge WHERE age='I' AND type='n'\n    UNION ALL\n    SELECT TRUNCATE((TRUNCATE(charge/20+0.9,0)*10)/20+0.9,0)*10 AS charge FROM passengers JOIN charge WHERE age='I' AND type='w'\n  ) AS wk ORDER BY charge DESC;\n\nSELECT SUM(charge) AS charge, SUM(charge) = (SELECT expect FROM charge) AS result FROM(\n  SELECT SUM(charge) AS charge FROM passengers JOIN charge WHERE age='A' AND type='n'\n  UNION ALL\n  SELECT SUM(TRUNCATE(charge/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='A' AND type='w'\n  UNION ALL\n  SELECT SUM(TRUNCATE(charge/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='C' AND type='n'\n  UNION ALL\n  SELECT SUM(TRUNCATE((TRUNCATE(charge/20+0.9,0)*10)/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='C' AND type='w'\n  UNION ALL\n  SELECT SUM(charge) AS charge FROM wk WHERE id > (SELECT COUNT(*)*2 FROM passengers WHERE age='A')\n) AS total;\n\n\u554f\u984c\u306f\u3053\u3061\u3089\u3002\nhttp://nabetani.sakura.ne.jp/hena/ord9busfare/\n\u30c6\u30b9\u30c8\u306b\u4f7f\u7528\u3057\u305fDB\u306fMySQL\u3067\u3059\u3002\n\n\u307e\u305a\u554f\u984c\u3092\u5165\u308c\u308b\u30c6\u30fc\u30d6\u30eb\u4f5c\u6210\u3002\n\u554f\u984c\u756a\u53f7\u306e\u30ab\u30e9\u30e0\u306f\u7701\u7565\u3002\u4e00\u554f\u6bce\u306b\u4f5c\u308a\u306a\u304a\u3059\u3002\n\n```SQL\nDROP TABLE IF EXISTS charge;\nCREATE TABLE charge(charge INT,expect INT);\nDROP TABLE IF EXISTS PASSENGERS;\nCREATE TABLE passengers(age CHAR(1),type CHAR(1));\n```\n\n\u554f\u984c\u767b\u9332\u3002\n\n```SQL\nINSERT INTO charge VALUES(210,170);\nINSERT INTO passengers VALUES('C','n');\nINSERT INTO passengers VALUES('I','n');\nINSERT INTO passengers VALUES('I','w');\nINSERT INTO passengers VALUES('A','p');\nINSERT INTO passengers VALUES('I','w');\n```\n\n\u305d\u3057\u3066\u89e3\u304f\u3002\nOFFSET\u6307\u5b9a\u3067\u30b5\u30d6\u30af\u30a8\u30ea\u304c\u4f7f\u3048\u305f\u3089\u30c6\u30f3\u30dd\u30e9\u30ea\u30c6\u30fc\u30d6\u30eb\u3092\u4f5c\u3089\u306a\u304f\u3066\u3059\u3093\u3060\u306e\u306b\u30fb\u30fb\u3002\n\n```SQL\nCREATE TEMPORARY TABLE wk(id INT PRIMARY KEY AUTO_INCREMENT,charge INT)\n  SELECT * FROM(\n\tSELECT TRUNCATE(charge/20+0.9,0)*10 AS charge FROM passengers JOIN charge WHERE age='I' AND type='n'\n  \tUNION ALL\n  \tSELECT TRUNCATE((TRUNCATE(charge/20+0.9,0)*10)/20+0.9,0)*10 AS charge FROM passengers JOIN charge WHERE age='I' AND type='w'\n  ) AS wk ORDER BY charge DESC;\n\nSELECT SUM(charge) AS charge, SUM(charge) = (SELECT expect FROM charge) AS result FROM(\n  SELECT SUM(charge) AS charge FROM passengers JOIN charge WHERE age='A' AND type='n'\n  UNION ALL\n  SELECT SUM(TRUNCATE(charge/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='A' AND type='w'\n  UNION ALL\n  SELECT SUM(TRUNCATE(charge/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='C' AND type='n'\n  UNION ALL\n  SELECT SUM(TRUNCATE((TRUNCATE(charge/20+0.9,0)*10)/20+0.9,0)*10) AS charge FROM passengers JOIN charge WHERE age='C' AND type='w'\n  UNION ALL\n  SELECT SUM(charge) AS charge FROM wk WHERE id > (SELECT COUNT(*)*2 FROM passengers WHERE age='A')\n) AS total;\n```"}