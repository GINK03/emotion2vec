{"context": " More than 1 year has passed since last update.AWS \u306e CentOS 6 \u306b cloud-init \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u52d5\u304d\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3044\u3061\u3044\u3061\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3044\u305f\u306e\u3067\u306f\u305f\u307e\u3089\u3093\u308f\u30fc\u3063\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001None \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u306e\u74b0\u5883\u3067\u7c21\u5358\u306b\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nhttp://cloudinit.readthedocs.org/en/latest/topics/datasources.html#fallback-none\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nyum \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nyum install cloud-init\n\n\ncloud.cfg\ndatasource_list \u3067 None \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3060\u3051\u3092\u6307\u5b9a\u3057\u3001datasource \u3067\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u306f #include \u3067 /etc/cloud/user-data \u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u307e\u3059\u3002\ncloud_***_modules \u306b\u306f\u52d5\u4f5c\u3092\u8a66\u3057\u305f\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n/etc/cloud/cloud.cfg\ndatasource_list: [None]\ndatasource:\n  None:\n    metadata:\n    userdata_raw: |\n      #include\n      /etc/cloud/user-data\n\ncloud_init_modules:\n - bootcmd\n - set-hostname\n - update-hostname\n\ncloud_config_modules:\n - runcmd\n\ncloud_final_modules:\n - scripts-user\n\n\n\nuser-data\n\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u305d\u308c\u3063\u307d\u304f\u4f5c\u308a\u307e\u3059\u3002\n\n/etc/cloud/user-data\n#cloud-config\n\nhostname: oreore.example.net\nfqdn: oreore.example.net\n\nbootcmd:\n - [\"bash\", \"-c\", \"echo `date`: bootcmd | tee -a /tmp/bootcmd\"]\n\nruncmd:\n - [\"bash\", \"-c\", \"echo `date`: runcmd | tee -a /tmp/runcmd\"]\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\u30ea\u30d6\u30fc\u30c8\u305b\u305a\u306b\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u6b21\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncloud-init-test\n#!/bin/bash\n\nrm -f /etc/hostname\nhostname localhost.localdomain\n\nrm -f /tmp/bootcmd\nrm -f /tmp/runcmd\n\nif [ \"first\" == \"$1\" ]; then\n  rm -fr /var/lib/cloud/*\nfi\n\nfor x in cloud-init-local cloud-init cloud-config cloud-final; do\n  service $x start\ndone\n\n\n\n\u521d\u56de\u30d6\u30fc\u30c8\u6642\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b first \u3068\u5f15\u6570\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u521d\u56de\u30d6\u30fc\u30c8\u6642\u306e\u52d5\u4f5c\u3067\u3059\u3002\n# ./cloud-init-test first\n\n\u30db\u30b9\u30c8\u540d\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# hostname\noreore.example.net\n\n# cat /etc/hostname \noreore.example.net\n\nbootcmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# cat /tmp/bootcmd\nSun Nov 16 16:58:36 JST 2014: bootcmd\n\nruncmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# cat /tmp/runcmd\nSun Nov 16 16:58:37 JST 2014: runcmd\n\n\n\uff12\u56de\u76ee\u4ee5\u964d\u306e\u30d6\u30fc\u30c8\u6642\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5f15\u6570\u3092\u4ed8\u3051\u305a\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u306f\uff12\u56de\u76ee\u4ee5\u964d\u306e\u30d6\u30fc\u30c8\u6642\u306e\u52d5\u4f5c\u3067\u3059\u3002\n# ./cloud-init-test\n\n\u30db\u30b9\u30c8\u540d\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# hostname\noreore.example.net\n\n# cat /etc/hostname \noreore.example.net\n\nbootcmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n# cat /tmp/bootcmd\nSun Nov 16 16:59:23 JST 2014: bootcmd\n\nruncmd \u306f\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002runcmd \u306f\u521d\u56de\u306e\u30d6\u30fc\u30c8\u6642\u306b\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002\n# cat /tmp/runcmd\ncat: /tmp/runcmd: No such file or directory\n\nAWS \u306e CentOS 6 \u306b cloud-init \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u308d\u3044\u308d\u8a66\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u52d5\u304d\u3092\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u3044\u3061\u3044\u3061\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8d77\u52d5\u3057\u3066\u3044\u305f\u306e\u3067\u306f\u305f\u307e\u3089\u3093\u308f\u30fc\u3063\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n\u305d\u3053\u3067\u3001None \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u30ed\u30fc\u30ab\u30eb\u306e\u74b0\u5883\u3067\u7c21\u5358\u306b\u78ba\u8a8d\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n - http://cloudinit.readthedocs.org/en/latest/topics/datasources.html#fallback-none\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nyum \u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```\nyum install cloud-init\n```\n\n## cloud.cfg\n\n`datasource_list` \u3067 `None` \u30c7\u30fc\u30bf\u30bd\u30fc\u30b9\u3060\u3051\u3092\u6307\u5b9a\u3057\u3001`datasource` \u3067\u30e1\u30bf\u30c7\u30fc\u30bf\u3068\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u6307\u5b9a\u3057\u307e\u3059\u3002\n\n\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u306f `#include` \u3067 `/etc/cloud/user-data` \u3092\u8aad\u307f\u8fbc\u3080\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n`cloud_***_modules` \u306b\u306f\u52d5\u4f5c\u3092\u8a66\u3057\u305f\u3044\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```yaml:/etc/cloud/cloud.cfg\ndatasource_list: [None]\ndatasource:\n  None:\n    metadata:\n    userdata_raw: |\n      #include\n      /etc/cloud/user-data\n\ncloud_init_modules:\n - bootcmd\n - set-hostname\n - update-hostname\n\ncloud_config_modules:\n - runcmd\n\ncloud_final_modules:\n - scripts-user\n```\n\n## user-data\n\n\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\u3092\u305d\u308c\u3063\u307d\u304f\u4f5c\u308a\u307e\u3059\u3002\n\n```yaml:/etc/cloud/user-data\n#cloud-config\n\nhostname: oreore.example.net\nfqdn: oreore.example.net\n\nbootcmd:\n - [\"bash\", \"-c\", \"echo `date`: bootcmd | tee -a /tmp/bootcmd\"]\n\nruncmd:\n - [\"bash\", \"-c\", \"echo `date`: runcmd | tee -a /tmp/runcmd\"]\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\u7528\u306e\u30b9\u30af\u30ea\u30d7\u30c8\n\n\u30ea\u30d6\u30fc\u30c8\u305b\u305a\u306b\u52d5\u4f5c\u78ba\u8a8d\u3059\u308b\u305f\u3081\u306b\u6b21\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:cloud-init-test\n#!/bin/bash\n\nrm -f /etc/hostname\nhostname localhost.localdomain\n\nrm -f /tmp/bootcmd\nrm -f /tmp/runcmd\n\nif [ \"first\" == \"$1\" ]; then\n  rm -fr /var/lib/cloud/*\nfi\n\nfor x in cloud-init-local cloud-init cloud-config cloud-final; do\n  service $x start\ndone\n```\n\n## \u521d\u56de\u30d6\u30fc\u30c8\u6642\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b `first` \u3068\u5f15\u6570\u3092\u4ed8\u3051\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u521d\u56de\u30d6\u30fc\u30c8\u6642\u306e\u52d5\u4f5c\u3067\u3059\u3002\n\n```console\n# ./cloud-init-test first\n```\n\n\u30db\u30b9\u30c8\u540d\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```console\n# hostname\noreore.example.net\n\n# cat /etc/hostname \noreore.example.net\n```\n\nbootcmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```console\n# cat /tmp/bootcmd\nSun Nov 16 16:58:36 JST 2014: bootcmd\n```\n\nruncmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```console\n# cat /tmp/runcmd\nSun Nov 16 16:58:37 JST 2014: runcmd\n```\n\n## \uff12\u56de\u76ee\u4ee5\u964d\u306e\u30d6\u30fc\u30c8\u6642\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306b\u5f15\u6570\u3092\u4ed8\u3051\u305a\u306b\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u308c\u306f\uff12\u56de\u76ee\u4ee5\u964d\u306e\u30d6\u30fc\u30c8\u6642\u306e\u52d5\u4f5c\u3067\u3059\u3002\n\n```console\n# ./cloud-init-test\n```\n\n\u30db\u30b9\u30c8\u540d\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```console\n# hostname\noreore.example.net\n\n# cat /etc/hostname \noreore.example.net\n```\n\nbootcmd \u304c\u5b9f\u884c\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```console\n# cat /tmp/bootcmd\nSun Nov 16 16:59:23 JST 2014: bootcmd\n```\n\nruncmd \u306f\u5b9f\u884c\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\u3002runcmd \u306f\u521d\u56de\u306e\u30d6\u30fc\u30c8\u6642\u306b\u3060\u3051\u5b9f\u884c\u3055\u308c\u308b\u3082\u306e\u306e\u3088\u3046\u3067\u3059\u3002\n\n```console\n# cat /tmp/runcmd\ncat: /tmp/runcmd: No such file or directory\n```\n", "tags": ["AWS", "CentOS", "cloud-init"]}