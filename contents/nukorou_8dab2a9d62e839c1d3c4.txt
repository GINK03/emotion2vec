{"tags": ["Ruby", "\u6cd5\u4eba\u30a4\u30f3\u30d5\u30a9", "api", "SPARQL"], "context": "\n\n\u306f\u3058\u3081\u306b\n\n\u3053\u306e\u8a18\u4e8b\u306f\u30d6\u30ed\u30b0\u306b\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u6628\u65e5(2017\u5e741\u670819\u65e5)\u3001\u6cd5\u4eba\u30a4\u30f3\u30d5\u30a9\u30e1\u30fc\u30b7\u30e7\u30f3(\u7565\u79f0\uff1a\u6cd5\u4eba\u30a4\u30f3\u30d5\u30a9)\u304c\u516c\u958b\u3055\u308c\u305f\u306e\u3067\u3001Ruby\u3067\u53d6\u5f97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u6e96\u5099\n\u3053\u306eAPI\u306fSPARQL(\u30b9\u30d1\u30fc\u30af\u30eb)\u3068\u3044\u3046RDF\u306e\u30af\u30a8\u30ea\u8a00\u8a9e\u3067\u30af\u30a8\u30ea\u3092\u66f8\u304f\u307f\u305f\u3044\u3067\u3059\u3002\u3061\u306a\u307f\u306bRDF\u3082SPARQL\u3082\u521d\u3081\u3066\u6271\u3044\u307e\u3059\u3002(SQL\u306fSELECT\u3068FROM\u3050\u3089\u3057\u304b\u308f\u304b\u3063\u3066\u307e\u305b\u3093\u3002)\ngem install linkeddata\n\u3067RDF\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u305d\u3046\u3067\u3059\u3002\n\n\u30b3\u30fc\u30c9\n\u3056\u3063\u304f\u308a\u8aac\u660e\u3057\u307e\u3059\u3068\u3001get_all_hojin_id\u95a2\u6570\u3067\u6cd5\u4eba\u756a\u53f7(ID)\u3092\u53d6\u5f97\u3057\u3066\u3001get_hojin_base_info\u95a2\u6570\u306bID\u3092\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\nSPARQL\u3067\u306f\u3001?\u5909\u6570\u540d\u304c\u5909\u6570\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\u60c5\u5831\u3066\u3093\u3053\u3082\u308a\u306eget_hojin_base_info\u95a2\u6570\u306f\u6700\u521d\u306f\u7406\u89e3\u3057\u306b\u304f\u3044\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u6700\u5c0f\u69cb\u6210\u306eSPARQL\u306e\u4f8b\u793a\u3068\u3057\u3066\u3001get_name\u95a2\u6570\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\u3042\u3068\u3001get_all_hojin_id\u95a2\u6570\u3067\u306f\u5b9f\u306f\u5168\u90e8\u306eID\u306f\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002SQL\u304c\u5206\u304b\u308b\u4eba\u306b\u306f\u5f53\u305f\u308a\u524d\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001OFFSET\u304c\u5fc5\u8981\u3067\u3059\u3002\u3042\u3048\u3066\u3001\u628a\u63e1\u3057\u306b\u304f\u304f\u306b\u306a\u308b\u304b\u3089OFFSET\u306f\u66f8\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u5225\u306b\u554f\u984c\u306a\u3044\u3067\u3059\u3088\u306d\u3002\n\u3042\u3068\u3001\u5730\u5473\u306bOPTIONAL\u3063\u3066\u306e\u306f\u91cd\u8981\u3067\u3059\uff01\u3053\u308c\u304c\u306a\u3044\u3068\u3001\u5168\u90e8\u306e\u60c5\u5831\u304c\u5fc5\u9808\u306e\u6761\u4ef6\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u30d2\u30c3\u30c8\u3057\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001\u5fc5\u9808\u3067\u306f\u306a\u3044\u3088\u3063\u3066\u660e\u793a\u3057\u3066\u3044\u308b\u306e\u304c\u3001OPTIONAL\u307f\u305f\u3044\u3067\u3059\u3002\u3053\u3053\u3067\u3064\u307e\u308a\u307e\u3057\u305f\u3002\nrequire 'sparql/client'\n\ndef get_all_hojin_id(client=nil, limit)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n  query_string = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT ?id FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 ?id .\n    }\n    limit #{limit}\n  \"\n  results = client.query(query_string)\nend\n\n\ndef get_name(client=nil, id)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n\n  q1 = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT ?name FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 '#{id}' .\n      ?key ic:\u540d\u79f0/ic:\u8868\u8a18 ?name\n    }\n  \"\n  results = client.query(q1)\n\nend\n\n#\u500b\u4eba\u7684\u306b\u5fc5\u8981\u305d\u3046\u306a\u60c5\u5831\u3057\u304b\u53d6\u5f97\u3057\u3066\u307e\u305b\u3093\ndef get_hojin_base_info(client=nil, id)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n\n  query_string = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT DISTINCT * FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 '#{id}' .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 ?id .\n      OPTIONAL{?key ic:\u540d\u79f0/ic:\u8868\u8a18 ?name .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u8868\u8a18 ?address .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u90f5\u4fbf\u756a\u53f7 ?zip_code .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u90fd\u9053\u5e9c\u770c ?prefecture .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u5e02\u533a\u753a\u6751 ?city .}\n      OPTIONAL{?key ic:\u4f4f\u6240/hj:\u4e01\u76ee\u756a\u5730\u7b49 ?chome .}\n      OPTIONAL{?key ic:\u6d3b\u52d5\u72b6\u6cc1/ic:\u767a\u751f\u65e5 ?start_day .}\n      OPTIONAL{?key hj:\u66f4\u65b0\u65e5\u6642/ic:\u6a19\u6e96\u578b\u65e5\u6642 ?updated_at .}\n    }\n  \"\n  results = client.query(query_string)\nend\n\nif __FILE__ == $0\n  client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  ids = get_all_hojin_id(client, limit=10)\n\n  ids.each do |i|\n    name = get_name(client, i.id.to_s)[0].to_h[:name].to_s\n    puts name\n\n    base_info = get_hojin_base_info(client, i.id.to_s)[0].to_h\n    puts \"id:#{base_info[:id]} name:#{base_info[:name]} address:#{base_info[:address]}\\n\\n\"\n  end\nend\n\n\n\n\u6539\u826f\u3059\u308b\u306a\u3089\n\u516c\u5f0fPDF\u306e\u3001\u8ffd\u52a0\u3057\u305f\u3044\u30c7\u30fc\u30bf\u540d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30d1\u30b9\u3063\u3066\u3044\u3046\u30ab\u30e9\u30e0\u3092\u30b3\u30d4\u30da\u3057\u3066\u3001\u5909\u6570\u540d\u3092\u81ea\u5206\u3067\u3064\u3051\u305f\u3089\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3063\u3066\u8ab0\u3067\u3082\u308f\u304b\u308b\u304b\uff57\n\n\u53c2\u8003\nhanzomemo: DBpedia\u65e5\u672c\u8a9e\u7248\uff1aSPARQL\u3092Ruby\u304b\u3089\u5b9f\u884c\nRDF.rb\u3092\u7528\u3044\u305fRDF\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f - Qiita\n##\u306f\u3058\u3081\u306b\n> \u3053\u306e\u8a18\u4e8b\u306f[\u30d6\u30ed\u30b0](http://nukorou.hatenablog.com/entry/2017/01/20/120000)\u306b\u3082\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u6628\u65e5(2017\u5e741\u670819\u65e5)\u3001\u6cd5\u4eba\u30a4\u30f3\u30d5\u30a9\u30e1\u30fc\u30b7\u30e7\u30f3(\u7565\u79f0\uff1a\u6cd5\u4eba\u30a4\u30f3\u30d5\u30a9)\u304c\u516c\u958b\u3055\u308c\u305f\u306e\u3067\u3001Ruby\u3067\u53d6\u5f97\u3059\u308b\u3068\u3053\u308d\u307e\u3067\u3084\u3063\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n##\u6e96\u5099\n\u3053\u306eAPI\u306f[SPARQL(\u30b9\u30d1\u30fc\u30af\u30eb)](https://ja.wikipedia.org/wiki/SPARQL)\u3068\u3044\u3046RDF\u306e\u30af\u30a8\u30ea\u8a00\u8a9e\u3067\u30af\u30a8\u30ea\u3092\u66f8\u304f\u307f\u305f\u3044\u3067\u3059\u3002\u3061\u306a\u307f\u306bRDF\u3082SPARQL\u3082\u521d\u3081\u3066\u6271\u3044\u307e\u3059\u3002(SQL\u306fSELECT\u3068FROM\u3050\u3089\u3057\u304b\u308f\u304b\u3063\u3066\u307e\u305b\u3093\u3002)\n\n`gem install linkeddata`\n\n\n\u3067RDF\u3092\u6271\u3046\u305f\u3081\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u307e\u3068\u3081\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u308c\u308b\u305d\u3046\u3067\u3059\u3002\n\n##\u30b3\u30fc\u30c9\n\u3056\u3063\u304f\u308a\u8aac\u660e\u3057\u307e\u3059\u3068\u3001`get_all_hojin_id\u95a2\u6570`\u3067\u6cd5\u4eba\u756a\u53f7(ID)\u3092\u53d6\u5f97\u3057\u3066\u3001`get_hojin_base_info\u95a2\u6570`\u306bID\u3092\u6e21\u3057\u3066\u3044\u307e\u3059\u3002\n\nSPARQL\u3067\u306f\u3001?\u5909\u6570\u540d\u304c\u5909\u6570\u306b\u306a\u308b\u3088\u3046\u3067\u3059\u3002\n\n\u60c5\u5831\u3066\u3093\u3053\u3082\u308a\u306e`get_hojin_base_info\u95a2\u6570`\u306f\u6700\u521d\u306f\u7406\u89e3\u3057\u306b\u304f\u3044\u304b\u3068\u601d\u3063\u305f\u306e\u3067\u3001\u6700\u5c0f\u69cb\u6210\u306eSPARQL\u306e\u4f8b\u793a\u3068\u3057\u3066\u3001`get_name\u95a2\u6570`\u3082\u7528\u610f\u3057\u307e\u3057\u305f\u3002\n\n\u3042\u3068\u3001`get_all_hojin_id\u95a2\u6570`\u3067\u306f\u5b9f\u306f\u5168\u90e8\u306eID\u306f\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3002SQL\u304c\u5206\u304b\u308b\u4eba\u306b\u306f\u5f53\u305f\u308a\u524d\u306a\u306e\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001OFFSET\u304c\u5fc5\u8981\u3067\u3059\u3002\u3042\u3048\u3066\u3001\u628a\u63e1\u3057\u306b\u304f\u304f\u306b\u306a\u308b\u304b\u3089OFFSET\u306f\u66f8\u304b\u306a\u304b\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u5225\u306b\u554f\u984c\u306a\u3044\u3067\u3059\u3088\u306d\u3002\n\n\u3042\u3068\u3001\u5730\u5473\u306bOPTIONAL\u3063\u3066\u306e\u306f\u91cd\u8981\u3067\u3059\uff01\u3053\u308c\u304c\u306a\u3044\u3068\u3001\u5168\u90e8\u306e\u60c5\u5831\u304c\u5fc5\u9808\u306e\u6761\u4ef6\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u305f\u3081\u3001\u30d2\u30c3\u30c8\u3057\u307e\u305b\u3093\u3002\u3053\u308c\u306f\u3001\u5fc5\u9808\u3067\u306f\u306a\u3044\u3088\u3063\u3066\u660e\u793a\u3057\u3066\u3044\u308b\u306e\u304c\u3001OPTIONAL\u307f\u305f\u3044\u3067\u3059\u3002\u3053\u3053\u3067\u3064\u307e\u308a\u307e\u3057\u305f\u3002\n\n\n\n```ruby\nrequire 'sparql/client'\n\ndef get_all_hojin_id(client=nil, limit)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n  query_string = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT ?id FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 ?id .\n    }\n    limit #{limit}\n  \"\n  results = client.query(query_string)\nend\n\n\ndef get_name(client=nil, id)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n\n  q1 = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT ?name FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 '#{id}' .\n      ?key ic:\u540d\u79f0/ic:\u8868\u8a18 ?name\n    }\n  \"\n  results = client.query(q1)\n\nend\n\n#\u500b\u4eba\u7684\u306b\u5fc5\u8981\u305d\u3046\u306a\u60c5\u5831\u3057\u304b\u53d6\u5f97\u3057\u3066\u307e\u305b\u3093\ndef get_hojin_base_info(client=nil, id)\n  if client.nil?\n    client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  end\n\n  query_string = \"\n    PREFIX hj: <http://hojin-info.go.jp/ns/domain/biz/1#>\n    PREFIX ic: <http://imi.go.jp/ns/core/rdf#>\n\n    SELECT DISTINCT * FROM <http://hojin-info.go.jp/graph/hojin>\n    WHERE {\n      ?s hj:\u6cd5\u4eba\u57fa\u672c\u60c5\u5831 ?key .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 '#{id}' .\n      ?key ic:ID/ic:\u8b58\u5225\u5024 ?id .\n      OPTIONAL{?key ic:\u540d\u79f0/ic:\u8868\u8a18 ?name .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u8868\u8a18 ?address .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u90f5\u4fbf\u756a\u53f7 ?zip_code .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u90fd\u9053\u5e9c\u770c ?prefecture .}\n      OPTIONAL{?key ic:\u4f4f\u6240/ic:\u5e02\u533a\u753a\u6751 ?city .}\n      OPTIONAL{?key ic:\u4f4f\u6240/hj:\u4e01\u76ee\u756a\u5730\u7b49 ?chome .}\n      OPTIONAL{?key ic:\u6d3b\u52d5\u72b6\u6cc1/ic:\u767a\u751f\u65e5 ?start_day .}\n      OPTIONAL{?key hj:\u66f4\u65b0\u65e5\u6642/ic:\u6a19\u6e96\u578b\u65e5\u6642 ?updated_at .}\n    }\n  \"\n  results = client.query(query_string)\nend\n\nif __FILE__ == $0\n  client = SPARQL::Client.new('http://api.hojin-info.go.jp/sparql')\n  ids = get_all_hojin_id(client, limit=10)\n\n  ids.each do |i|\n    name = get_name(client, i.id.to_s)[0].to_h[:name].to_s\n    puts name\n\n    base_info = get_hojin_base_info(client, i.id.to_s)[0].to_h\n    puts \"id:#{base_info[:id]} name:#{base_info[:name]} address:#{base_info[:address]}\\n\\n\"\n  end\nend\n\n```\n\n##\u6539\u826f\u3059\u308b\u306a\u3089\n[\u516c\u5f0fPDF](http://hojin-info.go.jp/hojin/pdf/API.pdf#page=8)\u306e\u3001\u8ffd\u52a0\u3057\u305f\u3044\u30c7\u30fc\u30bf\u540d\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30d1\u30b9\u3063\u3066\u3044\u3046\u30ab\u30e9\u30e0\u3092\u30b3\u30d4\u30da\u3057\u3066\u3001\u5909\u6570\u540d\u3092\u81ea\u5206\u3067\u3064\u3051\u305f\u3089\u3044\u3044\u3068\u601d\u3044\u307e\u3059\u3002\u3063\u3066\u8ab0\u3067\u3082\u308f\u304b\u308b\u304b\uff57\n\n##\u53c2\u8003\n\n[hanzomemo: DBpedia\u65e5\u672c\u8a9e\u7248\uff1aSPARQL\u3092Ruby\u304b\u3089\u5b9f\u884c](http://hanzomemo.blogspot.jp/2013/04/dbpediasparqlruby.html)\n[RDF.rb\u3092\u7528\u3044\u305fRDF\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f - Qiita](http://qiita.com/tsunagun/items/1ee19c9d2cf1767adf95)\n\n\n"}