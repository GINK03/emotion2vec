{"context": "\u3010\u8ffd\u8a18\u3011\nAmazon Linux AMI\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3066\n\u3082\u3063\u3068\u5bb9\u6613\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\nWordPress(PHP7+nginx) for Amazon Linux AMI 2016.09\n\u5404\u3005\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306f\u5404\u6240\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u3051\u308c\u3069\n\u74b0\u5883\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u3042\u308c\u306a\u306e\u3067\u81ea\u5206\u306e\u74b0\u5883\u7528\u306b\u3002\n\u8a73\u3057\u3044\u89e3\u8aac\u306f\u30ea\u30f3\u30af\u3057\u3066\u3044\u308b\u30da\u30fc\u30b8\u3078\u3002\nsudo\u306f\u9069\u5b9c\u3002\n\nAWS\n\n\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\nAWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3089\u901f\u653b\u3067\u3084\u3063\u3066\u304a\u304f\u3079\u304d\u521d\u671f\u8a2d\u5b9a\u307e\u3068\u3081\n\nEC2(VPC)\n0\u304b\u3089\u59cb\u3081\u308bAWS\u5165\u9580\u2460\uff1aVPC\u7de8\n\n\u8a2d\u5b9a\n$ passwd ec2-user\n\n#\u30ed\u30fc\u30ab\u30eb\u30bf\u30a4\u30e0\u5909\u66f4\n$ cp -rp /etc/localtime /etc/localtime.org\n$ cp -rp /usr/share/zoneinfo/Japan /etc/localtime\n\n\n/etc/sysconfig/clock\n#yum update\u306a\u3069\u3067UTC\u306b\u3082\u3069\u308b\u306e\u3092\u9632\u3050\n-ZONE=\"UTC\"\n-UTC=true\n+ZONE=\"Asia/Tokyo\"\n+UTC=false\n\n\n\n/etc/sysconfig/i18n\n-LANG=en_US.UTF-8\n+LANG=ja_JP.UTF-8\n\n\n\nFTP\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y vsftpd\n$ cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.org\n\n\n\u8a2d\u5b9a\n\n/etc/vsftpd/vsftpd.conf\n+pasv_enable=YES\n+pasv_addr_resolve=YES\n+pasv_min_port=60001\n+pasv_max_port=60100\n\n\n#\u8d77\u52d5\n$ service vsftpd start\n$ chkconfig vsftpd on\n\n\nPHP7\nAWS EC2(Amazon Linux)\u3067\u3001PHP7+NginX\u3092\u74b0\u5883\u3092\u3001yum\u3092\u4f7f\u3063\u3066\u30b5\u30af\u30c3\u3068\u5b9f\u88c5\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ rpm -Uvh ftp://ftp.scientificlinux.org/linux/scientific/6.4/x86_64/updates/fastbugs/scl-utils-20120927-8.el6.x86_64.rpm\n$ rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n$ yum install -y php70 php70-php-fpm php70-php-mbstring php70-php-mysqlnd php70-php-mcrypt\n\nAmazon Linux \u306b PHP7(remi)\u3092\u5165\u308c\u308b\u624b\u9806\u30e1\u30e2\n#epel\u304b\u3089libwebp \u3092\u5165\u308c\u308b\n$ yum -y install libwebp --disablerepo=amzn-main --enablerepo=epel\n#amzn-main\u304b\u3089\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u90e1\u3092\u5165\u308c\u308b\n$ yum -y install libmcrypt libtool-ltdl libtidy libXpm libtiff gd-last autoconf automake\n$ yum install -y php70-php-gd\n\n\u4ed6\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3059\u5834\u5408\u306f\n$ yum list | grep php70\n\n\u306a\u3069\u3067\u3002\n\n\u8a2d\u5b9a\n$ cp /etc/opt/remi/php70/php-fpm.d/www.conf /etc/opt/remi/php70/php-fpm.d/www.conf.org\n\n\n/etc/opt/remi/php70/php-fpm.d/www.conf\n-user = apache\n+user = nginx\n-group = apache\n+group = nginx\n\n\n\n/etc/opt/remi/php70/php.ini\n+date.timezone = \"Asia/Tokyo\"\n\n\n\nnginx\nAWS EC2(Amazon Linux)\u3067\u3001PHP7+NginX\u3092\u74b0\u5883\u3092\u3001yum\u3092\u4f7f\u3063\u3066\u30b5\u30af\u30c3\u3068\u5b9f\u88c5\nnginx\u3067HTTP/2\u3053\u3068\u306f\u3058\u3081\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\nHTTP/2\u5bfe\u5fdc\u306e\u305f\u3081v1.9.5\u4ee5\u964d\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum remove nginx\n$ rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n\n\n/etc/yum.repos.d/nginx.repo\n# nginx.repo\n\n[nginx]\nname=nginx repo\n-baseurl=http://nginx.org/packages/centos/6/$basearch/\n+baseurl=http://nginx.org/packages/mainline/centos/6/$basearch/\ngpgcheck=0\nenabled=1\n+priority=1\n\n\n$ yum install -y nginx\n$ nginx -v\nnginx version: nginx/1.9.15\n\n\n\u8a2d\u5b9a\n$ mkdir -p /var/www/html\n$ chown -R nginx:nginx /var/www/html\n$ cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org\n\n\n/etc/nginx/nginx.conf\nerror_log  /var/log/nginx/error.log warn;\naccess_log  /var/log/nginx/access.log  main;\n\nserver {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  localhost;\n        root        /var/www/html;\n        index       index.php index.html;\n\n        include /etc/nginx/default.d/*.conf;\n\n        location ~ \\.php$ {\n            fastcgi_pass 127.0.0.1:9000;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $fastcgi_script_name;\n            include fastcgi_params;\n        }\n\n        location ~* ^.+.(jpg|jpeg|gif|png|css|js|flv|swf|ico|xml)$ {\n                access_log  off;\n                log_not_found off;\n                expires 30d;\n        }\n\n}\n\n\n#\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n$ chown -R nginx:nginx /var/opt/remi/php70/lib/php/session/\n\n$ service nginx start\n$ service php70-php-fpm start\n\n$ chkconfig nginx on\n$ chkconfig php70-php-fpm on\n\nnginx\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\n\nnginx: [warn] conflicting server name \"localhost\" on 0.0.0.0:80, ignored\n\n\u3063\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30b5\u30fc\u30d0\u30fc\u540d\u304c\u88ab\u3063\u3066\u6012\u3089\u308c\u308b\u306e\u3067\n$ mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default._conf\n\n\u3068\u6d88\u3059\u304b\u3001\u8aad\u307e\u308c\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\n\n/var/www/html/phpinfo.php\n<?php echo phpinfo();?>\n\n\n\nBASIC\u8a8d\u8a3c\u304b\u3051\u308b\u5834\u5408\nnginx\u3067Basic\u8a8d\u8a3c\u3092\u3059\u308b\n$ yum install -y httpd-tools\n$ cd /etc/nginx\n$ htpasswd -c .htpasswd [\u30e6\u30fc\u30b6\u30fc\u540d]\n\n\u9069\u5b9c\u8a2d\u5b9a\n\n/etc/nginx/nginx.conf\nserver {\n    location / {\n        auth_basic \"Restricted\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n}\n\n\n\nWordpress\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ cd /var/www/html/\n$ wget https://ja.wordpress.org/latest-ja.tar.gz\n$ tar zxvf latest-ja.tar.gz \n$ rm latest-ja.tar.gz\n$ cp -rpf wordpress/* ./\n$ rm -rf wordpress\n$ cp wp-config-sample.php wp-config.php\n#wp-config.php\u8a2d\u5b9a\n$ chown -R nginx:nginx /var/www/html/\n\n\u79c1\u7684\u4fbf\u5229\u30d7\u30e9\u30b0\u30a4\u30f3\u96c6\n\u7ba1\u7406\u753b\u9762\u3067\u306eSSL\u901a\u4fe1\n\n/var/www/html/wp-config.php\n//\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\ndefine('FORCE_SSL_ADMIN', true);\n\nif ( isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === \"https\" ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n\n//\u3055\u304f\u3089\u306e\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u306e\u5834\u5408\nif ( isset($_SERVER['HTTP_X_SAKURA_FORWARDED_FOR']) ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n\n\n\n\u8a2d\u5b9a\n\n/etc/nginx/nginx.conf\nserver {\n        #For Wordpress\n        location / { \n                if (-f $request_filename) {\n                        expires 30d;\n                        break;\n                }\n                if (!-e $request_filename) {\n                        rewrite ^.+?(/wp-.*) $1 last;\n                        rewrite ^.+?(/.*\\.php)$ $1 last;\n                        rewrite ^ /index.php last;\n                }\n        }\n}\n\n\n\nMySQL\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y mysql mysql-server\n$ service mysqld start\n$ chkconfig mysqld on\n\n$ mysql -u root\n\n> SET PASSWORD FOR root@localhost=PASSWORD('root');\n\n$ service mysqld restart\n\n\nphpMyAdmin\n\u6700\u65b0\u7248\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ cd /var/www/\n$ wget https://files.phpmyadmin.net/phpMyAdmin/4.6.0/phpMyAdmin-4.6.0-all-languages.tar.gz\n$ tar zxvf phpMyAdmin-4.6.0-all-languages.tar.gz\n$ rm phpMyAdmin-4.6.0-all-languages.tar.gz\n$ mv phpMyAdmin-4.6.0-all-languages phpmyadmin\n$ cd /var/www/phpmyadmin/\n$ cp config.sample.inc.php config.inc.php\n\n\n\u8a2d\u5b9a\n\n/var/www/phpmyadmin/config.inc.php\n/* Authentication type */\n$cfg['Servers'][$i]['auth_type'] = 'http';//BASIC\u8a8d\u8a3c\n\n/* Server parameters */\n$cfg['Servers'][$i]['host'] = 'localhost';\n$cfg['Servers'][$i]['connect_type'] = 'tcp';\n$cfg['Servers'][$i]['compress'] = false;\n\n/* Select mysql if your server does not have mysqli */\n$cfg['Servers'][$i]['extension'] = 'mysqli';\n$cfg['Servers'][$i]['AllowNoPassword'] = false;\n\n\n\n/etc/nginx/nginx.conf\nserver {\n        #For phpMyAdmin\n        location ^~ /phpmyadmin {\n                allow 0.0.0.0;#IP\u5236\u9650\n                deny all;\n\n                alias /var/www/phpmyadmin;\n                index index.php;\n\n                location ~ \\.php$  {\n                        fastcgi_pass    127.0.0.1:9000;\n                        fastcgi_index   index.php;\n                        fastcgi_split_path_info ^/phpmyadmin(.+\\.php)(.*)$;\n                        fastcgi_param   SCRIPT_FILENAME /var/www/phpmyadmin$fastcgi_script_name;\n                        include         /etc/nginx/fastcgi_params;\n                }\n        }\n}\n\n\n$ service nginx reload\n\n\nSSL\n\u5149\u306e\u901f\u3055\u306eWEB\u30b5\u30fc\u30d0\u30fc(nginx)\u3092let's encrypt\u3067SSL\u5316\u53ca\u3073HTTP/2\u5316\u3002\u3064\u3044\u3067\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\u3092A\uff0b\u306b\u3059\u308b\u3002\nnginx\u9023\u8f096\u56de\u76ee: nginx\u306e\u8a2d\u5b9a\u3001\u305d\u306e4 - TLS/SSL\u306e\u8a2d\u5b9a\nAmazon Linux \u3067 certbot(letsencrypt) \u3092\u4f7f\u3063\u3066 SSL \u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b\n\n/etc/nginx/nginx.conf\nserver {\n        listen       443 ssl;\n        listen       [::]:443 ssl;\n        server_name  localhost;\n        root         /var/www/html;\n        index        index.php index.html;\n\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:60m;\n\n        include /etc/nginx/default.d/*.conf;\n}\n\n\n\nLet's Encrypt\n#Git\u7121\u3044\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y git\n\n$ cd /etc/\n$ git clone https://github.com/letsencrypt/letsencrypt\n#git clone https://github.com/certbot/certbot\n$ cd letsencrypt\n$ ./letsencrypt-auto --debug\n$ ./letsencrypt-auto certonly --webroot --agree-tos -w /var/www/html -d [\u30c9\u30e1\u30a4\u30f3] -m [\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9]\n\n2016/08\u73fe\u5728\u3001certbot\u306b\u540d\u79f0\u304c\u5909\u308f\u3063\u305f\u308apip\u3068\u304bvirtualenv\u3068\u304b\u8272\u3005\u304c\u8272\u3005\u3067\u8272\u3005\u8a66\u3057\u305f\u3051\u3069\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044\n\u8a3c\u660e\u66f8\u30fb\u79d8\u5bc6\u9375\u306f /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/ \u4ee5\u4e0b\n\n/etc/nginx/nginx.conf\nserver {\n    listen       443 ssl;\n\n    ssl_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/privkey.pem;\n\n}\n\n\n\u6709\u52b9\u671f\u9650\u306f3\u30f6\u6708\u306a\u306e\u3067\u30af\u30fc\u30ed\u30f3\u3067\u66f4\u65b0\n\ncrontab(\u6bce\u67083\u65e5\u5348\u524d3\u6642)\n+0 3 3 * * /etc/letsencrypt/letsencrypt-auto certonly --webroot --agree-tos -w /var/www/html -d [\u30c9\u30e1\u30a4\u30f3] -d [\u30c9\u30e1\u30a4\u30f3] --renew-by-default && service nginx reload\n\n\n\nhttps\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u5834\u5408\n\n/etc/nginx/nginx.conf\nserver {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  localhost;\n    return 301 https://$host$request_uri;\n}\n\n\n\nHSTS\n\n/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        #HTTPS\u306e\u307f\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u306e\u307f\n        add_header Strict-Transport-Security max-age=15768000;\n\n}\n\n\n\nPerfect Forward Security (PFS)\n\u751f\u6210\u306b\u6642\u9593\u304b\u304b\u308b\u3051\u3069\u5fc5\u9808\u3002\n$ cd /etc/ssl\n$ openssl dhparam 2048 -out dhparam.pem\n\n\n/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        ssl_dhparam /etc/ssl/dhparam.pem;\n\n}\n\n\n\nHTTP/2\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n}\n\n\n\nTLS/SSL\nSSLv1.0,SSLv2.0,SSLv3.0\u306f\u7121\u52b9\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n\n}\n\n\n\n\u6697\u53f7\u30b9\u30a4\u30fc\u30c8\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';\n\n}\n\n\n\nOCSP Stapling\n\n/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    resolver 8.8.8.8;\n\n}\n\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\nQualys SSL Report\n\n\u826f\u3044\u611f\u3058\u307f\u305f\u3044\u3067\u4f55\u3088\u308a\u3002\n\u3010\u8ffd\u8a18\u3011\nAmazon Linux AMI\u304c\u30d0\u30fc\u30b8\u30e7\u30f3\u30a2\u30c3\u30d7\u3057\u3066\n\u3082\u3063\u3068\u5bb9\u6613\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\n[WordPress(PHP7+nginx) for Amazon Linux AMI 2016.09](http://qiita.com/ki6ool/items/8e929a460da3bb7a878a)\n\n\n\u5404\u3005\u306e\u8a2d\u5b9a\u65b9\u6cd5\u306f\u5404\u6240\u3067\u89e3\u8aac\u3055\u308c\u3066\u3044\u308b\u3051\u308c\u3069\n\u74b0\u5883\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u3088\u3063\u3066\u3042\u308c\u306a\u306e\u3067\u81ea\u5206\u306e\u74b0\u5883\u7528\u306b\u3002\n\u8a73\u3057\u3044\u89e3\u8aac\u306f\u30ea\u30f3\u30af\u3057\u3066\u3044\u308b\u30da\u30fc\u30b8\u3078\u3002\nsudo\u306f\u9069\u5b9c\u3002\n\n# AWS\n\n#### \u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210\n\n[AWS\u30a2\u30ab\u30a6\u30f3\u30c8\u3092\u53d6\u5f97\u3057\u305f\u3089\u901f\u653b\u3067\u3084\u3063\u3066\u304a\u304f\u3079\u304d\u521d\u671f\u8a2d\u5b9a\u307e\u3068\u3081](http://qiita.com/tmknom/items/303db2d1d928db720888)\n\n#### EC2(VPC)\n[0\u304b\u3089\u59cb\u3081\u308bAWS\u5165\u9580\u2460\uff1aVPC\u7de8](http://qiita.com/hiroshik1985/items/9de2dd02c9c2f6911f3b)\n\n##### \u8a2d\u5b9a\n\n```console\n$ passwd ec2-user\n\n#\u30ed\u30fc\u30ab\u30eb\u30bf\u30a4\u30e0\u5909\u66f4\n$ cp -rp /etc/localtime /etc/localtime.org\n$ cp -rp /usr/share/zoneinfo/Japan /etc/localtime\n```\n\n```diff:/etc/sysconfig/clock\n#yum update\u306a\u3069\u3067UTC\u306b\u3082\u3069\u308b\u306e\u3092\u9632\u3050\n-ZONE=\"UTC\"\n-UTC=true\n+ZONE=\"Asia/Tokyo\"\n+UTC=false\n```\n\n```diff:/etc/sysconfig/i18n\n-LANG=en_US.UTF-8\n+LANG=ja_JP.UTF-8\n```\n\n# FTP\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ yum install -y vsftpd\n$ cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.org\n```\n\n#### \u8a2d\u5b9a\n```diff:/etc/vsftpd/vsftpd.conf\n+pasv_enable=YES\n+pasv_addr_resolve=YES\n+pasv_min_port=60001\n+pasv_max_port=60100\n```\n\n```console\n#\u8d77\u52d5\n$ service vsftpd start\n$ chkconfig vsftpd on\n```\n\n# PHP7\n[AWS EC2(Amazon Linux)\u3067\u3001PHP7+NginX\u3092\u74b0\u5883\u3092\u3001yum\u3092\u4f7f\u3063\u3066\u30b5\u30af\u30c3\u3068\u5b9f\u88c5](http://qiita.com/KeijiYONEDA/items/639e2ca0d080bc7decf3#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ rpm -Uvh ftp://ftp.scientificlinux.org/linux/scientific/6.4/x86_64/updates/fastbugs/scl-utils-20120927-8.el6.x86_64.rpm\n$ rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm\n$ yum install -y php70 php70-php-fpm php70-php-mbstring php70-php-mysqlnd php70-php-mcrypt\n```\n\n[Amazon Linux \u306b PHP7(remi)\u3092\u5165\u308c\u308b\u624b\u9806\u30e1\u30e2](http://qiita.com/Ikumi/items/8f76d074134b7080d102)\n\n```console\n#epel\u304b\u3089libwebp \u3092\u5165\u308c\u308b\n$ yum -y install libwebp --disablerepo=amzn-main --enablerepo=epel\n#amzn-main\u304b\u3089\u5fc5\u8981\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u90e1\u3092\u5165\u308c\u308b\n$ yum -y install libmcrypt libtool-ltdl libtidy libXpm libtiff gd-last autoconf automake\n$ yum install -y php70-php-gd\n```\n\n\u4ed6\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u63a2\u3059\u5834\u5408\u306f\n\n```console\n$ yum list | grep php70\n```\n\n\u306a\u3069\u3067\u3002\n\n#### \u8a2d\u5b9a\n```console\n$ cp /etc/opt/remi/php70/php-fpm.d/www.conf /etc/opt/remi/php70/php-fpm.d/www.conf.org\n```\n\n```diff:/etc/opt/remi/php70/php-fpm.d/www.conf\n-user = apache\n+user = nginx\n-group = apache\n+group = nginx\n```\n\n```diff:/etc/opt/remi/php70/php.ini\n+date.timezone = \"Asia/Tokyo\"\n```\n\n# nginx\n[AWS EC2(Amazon Linux)\u3067\u3001PHP7+NginX\u3092\u74b0\u5883\u3092\u3001yum\u3092\u4f7f\u3063\u3066\u30b5\u30af\u30c3\u3068\u5b9f\u88c5](http://qiita.com/KeijiYONEDA/items/639e2ca0d080bc7decf3#\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb)\n[nginx\u3067HTTP/2\u3053\u3068\u306f\u3058\u3081](https://saku.io/introduce-http2-with-nginx/)\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\nHTTP/2\u5bfe\u5fdc\u306e\u305f\u3081v1.9.5\u4ee5\u964d\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ yum remove nginx\n$ rpm -ivh http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm\n```\n\n```diff:/etc/yum.repos.d/nginx.repo\n# nginx.repo\n \n[nginx]\nname=nginx repo\n-baseurl=http://nginx.org/packages/centos/6/$basearch/\n+baseurl=http://nginx.org/packages/mainline/centos/6/$basearch/\ngpgcheck=0\nenabled=1\n+priority=1\n```\n\n```consle\n$ yum install -y nginx\n$ nginx -v\nnginx version: nginx/1.9.15\n```\n\n#### \u8a2d\u5b9a\n\n```console\n$ mkdir -p /var/www/html\n$ chown -R nginx:nginx /var/www/html\n$ cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.org\n```\n\n```nginx:/etc/nginx/nginx.conf\nerror_log  /var/log/nginx/error.log warn;\naccess_log  /var/log/nginx/access.log  main;\n\nserver {\n        listen       80 default_server;\n        listen       [::]:80 default_server;\n        server_name  localhost;\n        root        /var/www/html;\n        index       index.php index.html;\n\n        include /etc/nginx/default.d/*.conf;\n\n        location ~ \\.php$ {\n            fastcgi_pass 127.0.0.1:9000;\n            fastcgi_index index.php;\n            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;\n            fastcgi_param PATH_INFO $fastcgi_script_name;\n            include fastcgi_params;\n        }\n\n        location ~* ^.+.(jpg|jpeg|gif|png|css|js|flv|swf|ico|xml)$ {\n                access_log  off;\n                log_not_found off;\n                expires 30d;\n        }\n\n}\n```\n\n```\n#\u30bb\u30c3\u30b7\u30e7\u30f3\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\n$ chown -R nginx:nginx /var/opt/remi/php70/lib/php/session/\n\n$ service nginx start\n$ service php70-php-fpm start\n\n$ chkconfig nginx on\n$ chkconfig php70-php-fpm on\n```\n\nnginx\u3092\u8d77\u52d5\u3057\u305f\u3068\u304d\n>nginx: [warn] conflicting server name \"localhost\" on 0.0.0.0:80, ignored\n\n\u3063\u3066\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3068\u30b5\u30fc\u30d0\u30fc\u540d\u304c\u88ab\u3063\u3066\u6012\u3089\u308c\u308b\u306e\u3067\n\n```console\n$ mv /etc/nginx/conf.d/default.conf /etc/nginx/conf.d/default._conf\n```\n\n\u3068\u6d88\u3059\u304b\u3001\u8aad\u307e\u308c\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n\n#### \u30d6\u30e9\u30a6\u30b6\u3067\u78ba\u8a8d\n```php:/var/www/html/phpinfo.php\n<?php echo phpinfo();?>\n```\n\n#### BASIC\u8a8d\u8a3c\u304b\u3051\u308b\u5834\u5408\n\n[nginx\u3067Basic\u8a8d\u8a3c\u3092\u3059\u308b](http://qiita.com/hayak/items/97c99dfbc82daed0ad45)\n\n```console\n$ yum install -y httpd-tools\n$ cd /etc/nginx\n$ htpasswd -c .htpasswd [\u30e6\u30fc\u30b6\u30fc\u540d]\n```\n\n\u9069\u5b9c\u8a2d\u5b9a\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    location / {\n        auth_basic \"Restricted\";\n        auth_basic_user_file /etc/nginx/.htpasswd;\n    }\n}\n```\n\n# Wordpress\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ cd /var/www/html/\n$ wget https://ja.wordpress.org/latest-ja.tar.gz\n$ tar zxvf latest-ja.tar.gz \n$ rm latest-ja.tar.gz\n$ cp -rpf wordpress/* ./\n$ rm -rf wordpress\n$ cp wp-config-sample.php wp-config.php\n#wp-config.php\u8a2d\u5b9a\n$ chown -R nginx:nginx /var/www/html/\n```\n\n[\u79c1\u7684\u4fbf\u5229\u30d7\u30e9\u30b0\u30a4\u30f3\u96c6](http://qiita.com/ki6ool/items/1e8bcab7e3bcb7f2a6ea)\n[\u7ba1\u7406\u753b\u9762\u3067\u306eSSL\u901a\u4fe1](https://wpdocs.osdn.jp/\u7ba1\u7406\u753b\u9762\u3067\u306e_SSL_\u901a\u4fe1)\n\n```php:/var/www/html/wp-config.php\n//\u30ed\u30b0\u30a4\u30f3\u753b\u9762\u3068\u7ba1\u7406\u753b\u9762\u3092https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\ndefine('FORCE_SSL_ADMIN', true);\n\nif ( isset($_SERVER['HTTP_X_FORWARDED_PROTO']) && $_SERVER['HTTP_X_FORWARDED_PROTO'] === \"https\" ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n\n//\u3055\u304f\u3089\u306e\u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d0\u30fc\u306e\u5834\u5408\nif ( isset($_SERVER['HTTP_X_SAKURA_FORWARDED_FOR']) ) {\n    $_SERVER['HTTPS'] = 'on';\n}\n```\n\n#### \u8a2d\u5b9a\n```nginx:/etc/nginx/nginx.conf\nserver {\n        #For Wordpress\n        location / { \n                if (-f $request_filename) {\n                        expires 30d;\n                        break;\n                }\n                if (!-e $request_filename) {\n                        rewrite ^.+?(/wp-.*) $1 last;\n                        rewrite ^.+?(/.*\\.php)$ $1 last;\n                        rewrite ^ /index.php last;\n                }\n        }\n}\n```\n\n# MySQL\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ yum install -y mysql mysql-server\n$ service mysqld start\n$ chkconfig mysqld on\n\n$ mysql -u root\n```\n\n```mysql\n> SET PASSWORD FOR root@localhost=PASSWORD('root');\n```\n\n```console\n$ service mysqld restart\n```\n\n# phpMyAdmin\n[\u6700\u65b0\u7248](https://www.phpmyadmin.net/downloads/)\n\n#### \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n```console\n$ cd /var/www/\n$ wget https://files.phpmyadmin.net/phpMyAdmin/4.6.0/phpMyAdmin-4.6.0-all-languages.tar.gz\n$ tar zxvf phpMyAdmin-4.6.0-all-languages.tar.gz\n$ rm phpMyAdmin-4.6.0-all-languages.tar.gz\n$ mv phpMyAdmin-4.6.0-all-languages phpmyadmin\n$ cd /var/www/phpmyadmin/\n$ cp config.sample.inc.php config.inc.php\n```\n\n#### \u8a2d\u5b9a\n\n```php:/var/www/phpmyadmin/config.inc.php \n/* Authentication type */\n$cfg['Servers'][$i]['auth_type'] = 'http';//BASIC\u8a8d\u8a3c\n\n/* Server parameters */\n$cfg['Servers'][$i]['host'] = 'localhost';\n$cfg['Servers'][$i]['connect_type'] = 'tcp';\n$cfg['Servers'][$i]['compress'] = false;\n\n/* Select mysql if your server does not have mysqli */\n$cfg['Servers'][$i]['extension'] = 'mysqli';\n$cfg['Servers'][$i]['AllowNoPassword'] = false;\n```\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        #For phpMyAdmin\n        location ^~ /phpmyadmin {\n                allow 0.0.0.0;#IP\u5236\u9650\n                deny all;\n\n                alias /var/www/phpmyadmin;\n                index index.php;\n\n                location ~ \\.php$  {\n                        fastcgi_pass    127.0.0.1:9000;\n                        fastcgi_index   index.php;\n                        fastcgi_split_path_info ^/phpmyadmin(.+\\.php)(.*)$;\n                        fastcgi_param   SCRIPT_FILENAME /var/www/phpmyadmin$fastcgi_script_name;\n                        include         /etc/nginx/fastcgi_params;\n                }\n        }\n}\n```\n\n```console\n$ service nginx reload\n```\n\n# SSL\n\n[\u5149\u306e\u901f\u3055\u306eWEB\u30b5\u30fc\u30d0\u30fc(nginx)\u3092let's encrypt\u3067SSL\u5316\u53ca\u3073HTTP/2\u5316\u3002\u3064\u3044\u3067\u306b\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\u3092A\uff0b\u306b\u3059\u308b\u3002](http://qiita.com/sak_2/items/ff835b669c0a7e110b09)\n[nginx\u9023\u8f096\u56de\u76ee: nginx\u306e\u8a2d\u5b9a\u3001\u305d\u306e4 - TLS/SSL\u306e\u8a2d\u5b9a](http://heartbeats.jp/hbblog/2012/06/nginx06.html)\n[Amazon Linux \u3067 certbot(letsencrypt) \u3092\u4f7f\u3063\u3066 SSL \u8a3c\u660e\u66f8\u3092\u53d6\u5f97\u3059\u308b](http://tkuchiki.hatenablog.com/entry/2016/05/16/195420)\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen       443 ssl;\n        listen       [::]:443 ssl;\n        server_name  localhost;\n        root         /var/www/html;\n        index        index.php index.html;\n\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:60m;\n\n        include /etc/nginx/default.d/*.conf;\n}\n```\n\n#### Let's Encrypt\n\n```console\n#Git\u7121\u3044\u5834\u5408\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n$ yum install -y git\n```\n\n```console\n$ cd /etc/\n$ git clone https://github.com/letsencrypt/letsencrypt\n#git clone https://github.com/certbot/certbot\n$ cd letsencrypt\n$ ./letsencrypt-auto --debug\n$ ./letsencrypt-auto certonly --webroot --agree-tos -w /var/www/html -d [\u30c9\u30e1\u30a4\u30f3] -m [\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9]\n```\n\n*2016/08\u73fe\u5728\u3001certbot\u306b\u540d\u79f0\u304c\u5909\u308f\u3063\u305f\u308apip\u3068\u304bvirtualenv\u3068\u304b\u8272\u3005\u304c\u8272\u3005\u3067\u8272\u3005\u8a66\u3057\u305f\u3051\u3069\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u306a\u3044*\n\n\n\u8a3c\u660e\u66f8\u30fb\u79d8\u5bc6\u9375\u306f /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/ \u4ee5\u4e0b\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen       443 ssl;\n\n    ssl_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/privkey.pem;\n\n}\n```\n\n\u6709\u52b9\u671f\u9650\u306f3\u30f6\u6708\u306a\u306e\u3067\u30af\u30fc\u30ed\u30f3\u3067\u66f4\u65b0\n\n```diff:crontab(\u6bce\u67083\u65e5\u5348\u524d3\u6642)\n+0 3 3 * * /etc/letsencrypt/letsencrypt-auto certonly --webroot --agree-tos -w /var/www/html -d [\u30c9\u30e1\u30a4\u30f3] -d [\u30c9\u30e1\u30a4\u30f3] --renew-by-default && service nginx reload\n```\n\n#### https\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u305b\u308b\u5834\u5408\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen       80 default_server;\n    listen       [::]:80 default_server;\n    server_name  localhost;\n    return 301 https://$host$request_uri;\n}\n```\n\n#### HSTS\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        #HTTPS\u306e\u307f\u3067\u904b\u7528\u3059\u308b\u5834\u5408\u306e\u307f\n        add_header Strict-Transport-Security max-age=15768000;\n\n}\n```\n\n#### Perfect Forward Security (PFS)\n\n\u751f\u6210\u306b\u6642\u9593\u304b\u304b\u308b\u3051\u3069\u5fc5\u9808\u3002\n\n```\n$ cd /etc/ssl\n$ openssl dhparam 2048 -out dhparam.pem\n```\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n        listen 443 ssl;\n\n        ssl_dhparam /etc/ssl/dhparam.pem;\n\n}\n```\n\n#### HTTP/2\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n}\n```\n\n#### TLS/SSL\n\nSSLv1.0,SSLv2.0,SSLv3.0\u306f\u7121\u52b9\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n\n}\n```\n\n#### \u6697\u53f7\u30b9\u30a4\u30fc\u30c8\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_prefer_server_ciphers on;\n    ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';\n\n}\n```\n\n#### OCSP Stapling\n\n```nginx:/etc/nginx/nginx.conf\nserver {\n    listen 443 ssl http2;\n\n    ssl_stapling on;\n    ssl_stapling_verify on;\n    ssl_trusted_certificate /etc/letsencrypt/live/[\u30c9\u30e1\u30a4\u30f3]/fullchain.pem;\n    resolver 8.8.8.8;\n\n}\n```\n\n#### \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8a55\u4fa1\n[Qualys SSL Report](https://www.ssllabs.com/ssltest/)\n<img width=\"1001\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-05-11 15.15.01.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/97451/75797e5f-cec9-ab44-2fd0-27fb515a88f8.png\">\n\n\u826f\u3044\u611f\u3058\u307f\u305f\u3044\u3067\u4f55\u3088\u308a\u3002\n", "tags": ["PHP7", "nginx", "EC2", "SSL", "WordPress"]}