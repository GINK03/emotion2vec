{"context": " More than 1 year has passed since last update.\u4eca\u4f7f\u3063\u3066\u3044\u308b\u30af\u30e9\u30a6\u30c9\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u304c15GB\u3057\u304b\u306a\u3044\u306e\u3067Docker Compose\u3067\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u958b\u767a\u3057\u3066\u3044\u308b\u3068\u3059\u3050\u306b\u5bb9\u91cf\u4e0d\u8db3\u306b\u306a\u308a\u307e\u3059\u3002\u958b\u767a\u4e2d\u306f\u3088\u304f\u30b4\u30df\u304c\u51fa\u308b\u306e\u3067\u5b9a\u671f\u7684\u306b/var/lib/docker\u306f\u518d\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3082\u3046\u5c11\u3057\u5927\u304d\u306a\u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u3066\u79fb\u52d5\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\u6700\u521d\u306f/etc/fstab\u306e\u8a18\u8ff0\u3092\u9593\u9055\u3048\u3066\u30ea\u30ab\u30d0\u30ea\u30fc\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3057\u304b\u3082root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5fd8\u308c\u3066\u3057\u307e\u3044\u30b7\u30f3\u30b0\u30eb\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u3001\u4f5c\u696d\u306b\u306f\u5341\u5206\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\u6700\u521d\u306b\u8aad\u3093\u3067\u3044\u305f\u30b5\u30a4\u30c8\u306fmount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u4f7f\u3044\u65b9\u304c\u9593\u9055\u3063\u3066\u3044\u3066\u6df7\u4e71\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\nMoving docker images location to different partition\nMoving Docker \"stuff\" to a Different Drive\n\n\n\u74b0\u5883\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\u6700\u521d\u306b\u4f5c\u696d\u74b0\u5883\u306eDocker\u3084OS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\nDocker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ docker version\nClient version: 1.6.2\nClient API version: 1.18\nGo version (client): go1.4.2\nGit commit (client): 7c8fca2\nOS/Arch (client): linux/amd64\nServer version: 1.6.2\nServer API version: 1.18\nGo version (server): go1.4.2\nGit commit (server): 7c8fca2\nOS/Arch (server): linux/amd64\n\n\u30ab\u30fc\u30cd\u30eb\n$ cat /proc/version\nLinux version 3.13.0-33-generic (buildd@tipua) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #58-Ubuntu SMP Tue Jul 29 16:45:05 UTC 2014\n\nUbuntu 14.04.2\n$ cat /etc/lsb-release\nNAME=\"Ubuntu\"\nVERSION=\"14.04.2 LTS, Trusty Tahr\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 14.04.2 LTS\"\nVERSION_ID=\"14.04\"\nHOME_URL=\"http://www.ubuntu.com/\"\nSUPPORT_URL=\"http://help.ubuntu.com/\"\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\n\n\n\u30c7\u30a3\u30b9\u30af\u306e\u8ffd\u52a0\n\u4f5c\u696d\u524d\u306e\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u72b6\u6cc1\u3067\u3059\u3002\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1        15G  4.1G  9.9G  29% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nudev            2.0G  4.0K  2.0G   1% /dev\ntmpfs           395M  816K  394M   1% /run\nnone            5.0M     0  5.0M   0% /run/lock\nnone            2.0G  476K  2.0G   1% /run/shm\nnone            100M     0  100M   0% /run/user\n\n40GB\u306e\u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u305f\u72b6\u614b\u3067\u3059\u3002\u4eca\u56de\u306f\u30af\u30e9\u30a6\u30c9\u4e0a\u3067\u3059\u304cfdisk\u3067\u30c7\u30d0\u30a4\u30b9\u304c\u8a8d\u8b58\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u3060\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3042\u308a\u307e\u305b\u3093\u3002\n$ sudo fdisk -l\n\nDisk /dev/sda: 16.1 GB, 16106127360 bytes\n255 heads, 63 sectors/track, 1958 cylinders, total 31457280 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x000db9c4\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048    31455231    15726592   83  Linux\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\nDisk /dev/sdb doesn't contain a valid partition table\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\nfdisk\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066\u306fn\u3001p\u3001[Enter]x3\u56de\u3001w\u3092\u30ad\u30fc\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n$ sudo fdisk /dev/sdb\nDevice contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel\nBuilding a new DOS disklabel with disk identifier 0xef0c9f8a.\nChanges will remain in memory only, until you decide to write them.\nAfter that, of course, the previous content won't be recoverable.\n\nWarning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)\n\nCommand (m for help): n\nPartition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 1):\nUsing default value 1\nFirst sector (2048-83886079, default 2048):\nUsing default value 2048\nLast sector, +sectors or +size{K,M,G} (2048-83886079, default 83886079):\nUsing default value 83886079\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002/dev/sdb1\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n$ sudo fdisk -l\n\n\nDisk /dev/sda: 16.1 GB, 16106127360 bytes\n255 heads, 63 sectors/track, 1958 cylinders, total 31457280 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x000db9c4\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048    31455231    15726592   83  Linux\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n171 heads, 5 sectors/track, 98112 cylinders, total 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0xef0c9f8a\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdb1            2048    83886079    41942016   83  Linux\n\n\n\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u4f5c\u6210\n\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306fext4\u306a\u306e\u3067\u540c\u3058\u30bf\u30a4\u30d7\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ df -T\nFilesystem     Type     1K-blocks    Used Available Use% Mounted on\n/dev/sda1      ext4      15348720 4212380  10333628  29% /\nnone           tmpfs            4       0         4   0% /sys/fs/cgroup\nudev           devtmpfs   2009748       4   2009744   1% /dev\ntmpfs          tmpfs       404100     820    403280   1% /run\nnone           tmpfs         5120       0      5120   0% /run/lock\nnone           tmpfs      2020484     476   2020008   1% /run/shm\nnone           tmpfs       102400       0    102400   0% /run/user\n\next4\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo mkfs.ext4 /dev/sdb1\nmke2fs 1.42.9 (4-Feb-2014)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n2621440 inodes, 10485504 blocks\n524275 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=4294967296\n320 block groups\n32768 blocks per group, 32768 fragments per group\n8192 inodes per group\nSuperblock backups stored on blocks:\n    32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,\n    4096000, 7962624\n\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30de\u30a6\u30f3\u30c8\n\u65b0\u3057\u304f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066Docker\u306e/var/lib/docker\u3092\u79fb\u52d5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u307e\u305aDocker\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n$ sudo service docker stop\ndocker stop/waiting\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Ubuntu\u306f/media\u306b\u4f5c\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002\n$ sudo mkdir /media/data\n\n/etc/fstab\u306e\u7de8\u96c6\u306f\u5371\u967a\u306a\u306e\u3067\u5fc5\u305a\u30d1\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u3068\u308a\u307e\u3059\u3002\n$ sudo cp -ip /etc/fstab{,.`date +%Y%m%d`}\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e UUID \u3092blkid\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n$ sudo  blkid | grep sdb1\n/dev/sdb1: UUID=\"d45eaaab-e223-4162-96b3-fefea9392cad\" TYPE=\"ext4\"}}}\n\n/etc/fstab\u306b\u65b0\u3057\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306eUUID\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/fstab\nUUID=ed7bdb81-136d-458b-8121-2c4e5d3f569f /               ext4    errors=remount-ro 0       1\n/dev/fd0        /media/floppy0  auto    rw,user,noauto,exec,utf8 0       0\n\nUUID=d45eaaab-e223-4162-96b3-fefea9392cad /media/data ext4 defaults 0  2\n\n\n\u3044\u3064\u3082\u5fd8\u308c\u308b\u306e\u3067\u3059\u304c\u30014,5,6\u5217\u76ee\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n4\u5217\u76ee: \u30c7\u30d5\u30a9\u30eb\u30c8\n5\u5217\u76ee: 0: dump\u3059\u308b\n6\u5217\u76ee: 2: fsck\u3059\u308b\n\n/etc/fstab\u306e\u8a2d\u5b9a\u3092\u518d\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n$ sudo mount -a\n\n/dev/sdb1\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1        15G  4.1G  9.9G  29% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nudev            2.0G  8.0K  2.0G   1% /dev\ntmpfs           395M  792K  394M   1% /run\nnone            5.0M     0  5.0M   0% /run/lock\nnone            2.0G     0  2.0G   0% /run/shm\nnone            100M     0  100M   0% /run/user\n/dev/sdb1        40G   48M   38G   1% /media/data\n\n\n/var/lib/docker\u306e\u79fb\u52d5\n\nrsync\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30d4\u30fc\nrsync\u3067/var/lib/docker\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u3057\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n$ sudo mkdir /media/data/docker\n$ sudo rsync -aXS /var/lib/docker/. /media/data/docker/\n\nrsync\u304c\u7d42\u4e86\u3057\u3066\u3001/var/lib/docker\u3068/media/data/docker/\u304c\u540c\u3058\u5185\u5bb9\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n$ sudo du -sch /var/lib/docker/*\n2.1G    /var/lib/docker/aufs\n140K    /var/lib/docker/containers\n808K    /var/lib/docker/graph\n15M /var/lib/docker/init\n12K /var/lib/docker/linkgraph.db\n4.0K    /var/lib/docker/repositories-aufs\n4.0K    /var/lib/docker/tmp\n8.0K    /var/lib/docker/trust\n44K /var/lib/docker/volumes\n2.2G    total\n$ sudo du -sch /media/data/docker/*\n2.1G    /media/data/docker/aufs\n140K    /media/data/docker/containers\n808K    /media/data/docker/graph\n15M /media/data/docker/init\n12K /media/data/docker/linkgraph.db\n4.0K    /media/data/docker/repositories-aufs\n4.0K    /media/data/docker/tmp\n8.0K    /media/data/docker/trust\n44K /media/data/docker/volumes\n2.1G    total\n\n\n\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30de\u30a6\u30f3\u30c8\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306e/var/lib/docker\u3092\u5ff5\u306e\u305f\u3081\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7a7a\u306b\u3057\u3066\u4f5c\u308a\u76f4\u3057\u307e\u3059\u3002\n$ sudo mv /var/lib/docker /var/lib/docker.bak\n$ sudo mkdir /var/lib/docker\n\n/var/lib/docker\u306f\u7a7a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u72b6\u614b\u3067\u3059\u3002\n$ ls /media/data/docker/\naufs        graph  linkgraph.db       tmp    volumes\ncontainers  init   repositories-aufs  trust\n$ ls /var/lib/docker\n\n/media/data/docker\u3092/var/lib/docker\u306bbind\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002BIND\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u306emount\u306b\u8a73\u3057\u304f\u89e3\u8aac\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3059\u3002mount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3068\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u72ec\u81ea\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u3042\u308b\u30c7\u30d0\u30a4\u30b9\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n$ sudo mount -o bind  /media/data/docker /var/lib/docker\n$ sudo du -sch /var/lib/docker/*\n2.1G    /var/lib/docker/aufs\n140K    /var/lib/docker/containers\n808K    /var/lib/docker/graph\n15M /var/lib/docker/init\n12K /var/lib/docker/linkgraph.db\n4.0K    /var/lib/docker/repositories-aufs\n4.0K    /var/lib/docker/tmp\n8.0K    /var/lib/docker/trust\n44K /var/lib/docker/volumes\n2.1G    total\n\n/media/data/docker\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c/var/lib/docker\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\u6700\u521d\u306f\u3053\u308c\u3092fstab\u306b\u9006\u3067\u66f8\u3044\u3066\u3057\u3066\u3057\u307e\u3044\u8d77\u52d5\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n$ df -ha\nFilesystem       Size  Used Avail Use% Mounted on\n/dev/sda1            15G  4.1G  9.9G  29% /\n...\n/dev/sdb1            40G  2.2G   36G   6% /media/data\n/media/data/docker   40G  2.2G   36G   6% /var/lib/docker\n\n/etc/fstab\u3092\u7de8\u96c6\u3057\u3066\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n/etc/fstab\n/media/data/docker /var/lib/docker  none bind 0 0\n\n\nmount\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n$ sudo mount -a\n\n\n\u79fb\u52d5\u5148\u304b\u3089Docker\u3092\u8d77\u52d5\u3057\u3066\u78ba\u8a8d\n\naufs\u3060\u3051\u53e4\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u5897\u52a0\u3057\u3066\u3057\u307e\u3046\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo service docker start\ndocker start/running, process 4276\n\n/var/lib/docker/aufs\u3060\u30514.3G\u306b\u5897\u52a0\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002 /media/data/docker/aufs\u306f\u5909\u5316\u3057\u3066\u3044\u307e\u305b\u3093\u3002aufs\u306f\u4ee5\u524d\u306e\u5834\u6240\u306e\u307e\u307e\u306e\u3088\u3046\u3067\u3059\u3002\u3053\u306e\u72b6\u614b\u3067\u65b0\u3057\u3044\u30a4\u30e1\u30fc\u30b8\u3092docker pull\u3057\u3066\u3082/var/lib/docker\u306f\u5897\u52a0\u3057\u307e\u305b\u3093\u3002\n$ sudo du -sch /var/lib/docker/*\n4.3G    /var/lib/docker/aufs\n168K    /var/lib/docker/containers\n808K    /var/lib/docker/graph\n15M /var/lib/docker/init\n12K /var/lib/docker/linkgraph.db\n4.0K    /var/lib/docker/repositories-aufs\n4.0K    /var/lib/docker/tmp\n8.0K    /var/lib/docker/trust\n44K /var/lib/docker/volumes\n4.3G    total\n$ sudo du -sch /media/data/docker/*\n2.1G    /media/data/docker/aufs\n168K    /media/data/docker/containers\n808K    /media/data/docker/graph\n15M /media/data/docker/init\n12K /media/data/docker/linkgraph.db\n4.0K    /media/data/docker/repositories-aufs\n4.0K    /media/data/docker/tmp\n8.0K    /media/data/docker/trust\n44K /media/data/docker/volumes\n2.1G    total\n\naufs\u304c\u5897\u3048\u305f\u539f\u56e0\u306f\u3001docker-compose.yml\u306e\u30b5\u30fc\u30d3\u30b9\u3092restart: always\u306b\u3057\u3066\u3044\u308b\u306e\u3067Docker\u306e\u8d77\u52d5\u6642\u306b\u958b\u59cb\u3057\u305f\u305f\u3081\u3067\u3059\u3002\u3059\u3067\u306b\u4f5c\u6210\u6e08\u307f\u306e\u30b3\u30f3\u30c6\u30ca\u306fmount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u79fb\u52d5\u3067\u304d\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n$ docker-compose ps\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 9000/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up\npenresty_run_1     inx/nginx. ...\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n\n\nDOCKER_OPTS\u306b\u8ffd\u52a0\u3059\u308b\nDocker\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u65b0\u3057\u3044/var/lib/docker\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002Docker\u3092\u505c\u6b62\u3057\u3066\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n/etc/default/docker\nDOCKER_OPTS=\"-g /media/data/docker\"\n\n\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n$ sudo service docker start\ndocker start/running, process 5786\n\n\u3088\u3046\u3084\u304f/var/lib/docker\u304c\u5897\u52a0\u305b\u305a\u3001/media/data/docker/\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306eaufs\u304c\u5897\u52a0\u3057\u307e\u3057\u305f\u3002/var/lib/docker\u306e\u79fb\u52d5\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n$ sudo du -sch /var/lib/docker/*\n2.1G    /var/lib/docker/aufs\n180K    /var/lib/docker/containers\n808K    /var/lib/docker/graph\n15M /var/lib/docker/init\n12K /var/lib/docker/linkgraph.db\n4.0K    /var/lib/docker/repositories-aufs\n4.0K    /var/lib/docker/tmp\n8.0K    /var/lib/docker/trust\n44K /var/lib/docker/volumes\n2.1G    total\n$ sudo du -sch /media/data/docker/*\n4.3G    /media/data/docker/aufs\n180K    /media/data/docker/containers\n808K    /media/data/docker/graph\n15M /media/data/docker/init\n12K /media/data/docker/linkgraph.db\n4.0K    /media/data/docker/repositories-aufs\n4.0K    /media/data/docker/tmp\n8.0K    /media/data/docker/trust\n44K /media/data/docker/volumes\n4.3G    total\n\n\u4eca\u4f7f\u3063\u3066\u3044\u308b\u30af\u30e9\u30a6\u30c9\u306e\u30eb\u30fc\u30c8\u30c7\u30a3\u30b9\u30af\u304c15GB\u3057\u304b\u306a\u3044\u306e\u3067Docker Compose\u3067\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u8d77\u52d5\u3057\u3066\u958b\u767a\u3057\u3066\u3044\u308b\u3068\u3059\u3050\u306b\u5bb9\u91cf\u4e0d\u8db3\u306b\u306a\u308a\u307e\u3059\u3002\u958b\u767a\u4e2d\u306f\u3088\u304f\u30b4\u30df\u304c\u51fa\u308b\u306e\u3067\u5b9a\u671f\u7684\u306b`/var/lib/docker`\u306f\u518d\u4f5c\u6210\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3082\u3046\u5c11\u3057\u5927\u304d\u306a\u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u3066\u79fb\u52d5\u3057\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\u6700\u521d\u306f`/etc/fstab`\u306e\u8a18\u8ff0\u3092\u9593\u9055\u3048\u3066\u30ea\u30ab\u30d0\u30ea\u30fc\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3057\u304b\u3082root\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u3092\u5fd8\u308c\u3066\u3057\u307e\u3044\u30b7\u30f3\u30b0\u30eb\u30e2\u30fc\u30c9\u3067\u8d77\u52d5\u3059\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3068\u3001\u4f5c\u696d\u306b\u306f\u5341\u5206\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u4ee5\u4e0b\u306e\u30b5\u30a4\u30c8\u3092\u53c2\u8003\u306b\u3057\u307e\u3057\u305f\u3002\u6700\u521d\u306b\u8aad\u3093\u3067\u3044\u305f\u30b5\u30a4\u30c8\u306fmount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u4f7f\u3044\u65b9\u304c\u9593\u9055\u3063\u3066\u3044\u3066\u6df7\u4e71\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n* [Moving docker images location to different partition](http://alexander.holbreich.org/2014/07/moving-docker-images-different-partition/)\n* [Moving Docker \"stuff\" to a Different Drive](http://peterjolson.com/moving-docker-stuff-to-a-different-drive/)\n\n<!-- more -->\n\n## \u74b0\u5883\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u6700\u521d\u306b\u4f5c\u696d\u74b0\u5883\u306eDocker\u3084OS\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\nDocker\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n``` bash\n$ docker version\nClient version: 1.6.2\nClient API version: 1.18\nGo version (client): go1.4.2\nGit commit (client): 7c8fca2\nOS/Arch (client): linux/amd64\nServer version: 1.6.2\nServer API version: 1.18\nGo version (server): go1.4.2\nGit commit (server): 7c8fca2\nOS/Arch (server): linux/amd64\n```\n\n\u30ab\u30fc\u30cd\u30eb\n\n```bash\n$ cat /proc/version\nLinux version 3.13.0-33-generic (buildd@tipua) (gcc version 4.8.2 (Ubuntu 4.8.2-19ubuntu1) ) #58-Ubuntu SMP Tue Jul 29 16:45:05 UTC 2014\n```\n\nUbuntu 14.04.2\n\n```bash\n$ cat /etc/lsb-release\nNAME=\"Ubuntu\"\nVERSION=\"14.04.2 LTS, Trusty Tahr\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 14.04.2 LTS\"\nVERSION_ID=\"14.04\"\nHOME_URL=\"http://www.ubuntu.com/\"\nSUPPORT_URL=\"http://help.ubuntu.com/\"\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\n```\n\n## \u30c7\u30a3\u30b9\u30af\u306e\u8ffd\u52a0\n\n\u4f5c\u696d\u524d\u306e\u30c7\u30a3\u30b9\u30af\u306e\u4f7f\u7528\u72b6\u6cc1\u3067\u3059\u3002\n\n```bash\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1        15G  4.1G  9.9G  29% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nudev            2.0G  4.0K  2.0G   1% /dev\ntmpfs           395M  816K  394M   1% /run\nnone            5.0M     0  5.0M   0% /run/lock\nnone            2.0G  476K  2.0G   1% /run/shm\nnone            100M     0  100M   0% /run/user\n```\n\n40GB\u306e\u30c7\u30a3\u30b9\u30af\u3092\u8ffd\u52a0\u3057\u305f\u72b6\u614b\u3067\u3059\u3002\u4eca\u56de\u306f\u30af\u30e9\u30a6\u30c9\u4e0a\u3067\u3059\u304cfdisk\u3067\u30c7\u30d0\u30a4\u30b9\u304c\u8a8d\u8b58\u3055\u308c\u305f\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u307e\u3060\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3042\u308a\u307e\u305b\u3093\u3002\n\n```bash\n$ sudo fdisk -l\n\nDisk /dev/sda: 16.1 GB, 16106127360 bytes\n255 heads, 63 sectors/track, 1958 cylinders, total 31457280 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x000db9c4\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048    31455231    15726592   83  Linux\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n255 heads, 63 sectors/track, 5221 cylinders, total 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x00000000\n\nDisk /dev/sdb doesn't contain a valid partition table\n```\n\n### \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u4f5c\u6210\n\nfdisk\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066\u306f`n\u3001p\u3001[Enter]x3\u56de\u3001w`\u3092\u30ad\u30fc\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\n``` bash\n$ sudo fdisk /dev/sdb\nDevice contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel\nBuilding a new DOS disklabel with disk identifier 0xef0c9f8a.\nChanges will remain in memory only, until you decide to write them.\nAfter that, of course, the previous content won't be recoverable.\n\nWarning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)\n\nCommand (m for help): n\nPartition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\nSelect (default p): p\nPartition number (1-4, default 1):\nUsing default value 1\nFirst sector (2048-83886079, default 2048):\nUsing default value 2048\nLast sector, +sectors or +size{K,M,G} (2048-83886079, default 83886079):\nUsing default value 83886079\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\nSyncing disks.\n```\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u4f5c\u6210\u306e\u78ba\u8a8d\u3092\u3057\u307e\u3059\u3002`/dev/sdb1`\u304c\u4f5c\u6210\u3055\u308c\u307e\u3057\u305f\u3002\n\n``` bash\n$ sudo fdisk -l\n\n\nDisk /dev/sda: 16.1 GB, 16106127360 bytes\n255 heads, 63 sectors/track, 1958 cylinders, total 31457280 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0x000db9c4\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1   *        2048    31455231    15726592   83  Linux\n\nDisk /dev/sdb: 42.9 GB, 42949672960 bytes\n171 heads, 5 sectors/track, 98112 cylinders, total 83886080 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk identifier: 0xef0c9f8a\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sdb1            2048    83886079    41942016   83  Linux\n```\n\n### \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u4f5c\u6210\n\n\u65e2\u5b58\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306fext4\u306a\u306e\u3067\u540c\u3058\u30bf\u30a4\u30d7\u3067\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n``` bash\n$ df -T\nFilesystem     Type     1K-blocks    Used Available Use% Mounted on\n/dev/sda1      ext4      15348720 4212380  10333628  29% /\nnone           tmpfs            4       0         4   0% /sys/fs/cgroup\nudev           devtmpfs   2009748       4   2009744   1% /dev\ntmpfs          tmpfs       404100     820    403280   1% /run\nnone           tmpfs         5120       0      5120   0% /run/lock\nnone           tmpfs      2020484     476   2020008   1% /run/shm\nnone           tmpfs       102400       0    102400   0% /run/user\n```\n\next4\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo mkfs.ext4 /dev/sdb1\nmke2fs 1.42.9 (4-Feb-2014)\nFilesystem label=\nOS type: Linux\nBlock size=4096 (log=2)\nFragment size=4096 (log=2)\nStride=0 blocks, Stripe width=0 blocks\n2621440 inodes, 10485504 blocks\n524275 blocks (5.00%) reserved for the super user\nFirst data block=0\nMaximum filesystem blocks=4294967296\n320 block groups\n32768 blocks per group, 32768 fragments per group\n8192 inodes per group\nSuperblock backups stored on blocks:\n\t32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208,\n\t4096000, 7962624\n\nAllocating group tables: done\nWriting inode tables: done\nCreating journal (32768 blocks): done\nWriting superblocks and filesystem accounting information: done\n```\n\n## \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30de\u30a6\u30f3\u30c8\n\n\u65b0\u3057\u304f\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30de\u30a6\u30f3\u30c8\u3057\u3066Docker\u306e`/var/lib/docker`\u3092\u79fb\u52d5\u3057\u3066\u3044\u304d\u307e\u3059\u3002\u307e\u305aDocker\u3092\u505c\u6b62\u3057\u307e\u3059\u3002\n\n``` bash\n$ sudo service docker stop\ndocker stop/waiting\n```\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u3092\u30de\u30a6\u30f3\u30c8\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002Ubuntu\u306f`/media`\u306b\u4f5c\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u3002\n\n```bash\n$ sudo mkdir /media/data\n```\n\n`/etc/fstab`\u306e\u7de8\u96c6\u306f\u5371\u967a\u306a\u306e\u3067\u5fc5\u305a\u30d1\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u3068\u308a\u307e\u3059\u3002\n\n``` bash\n$ sudo cp -ip /etc/fstab{,.`date +%Y%m%d`}\n```\n\n\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e UUID \u3092`blkid`\u30b3\u30de\u30f3\u30c9\u3067\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo  blkid | grep sdb1\n/dev/sdb1: UUID=\"d45eaaab-e223-4162-96b3-fefea9392cad\" TYPE=\"ext4\"}}}\n```\n\n`/etc/fstab`\u306b\u65b0\u3057\u3044\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306eUUID\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```bash:/etc/fstab\nUUID=ed7bdb81-136d-458b-8121-2c4e5d3f569f /               ext4    errors=remount-ro 0       1\n/dev/fd0        /media/floppy0  auto    rw,user,noauto,exec,utf8 0       0\n\nUUID=d45eaaab-e223-4162-96b3-fefea9392cad /media/data ext4 defaults 0  2\n```\n\n\u3044\u3064\u3082\u5fd8\u308c\u308b\u306e\u3067\u3059\u304c\u30014,5,6\u5217\u76ee\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\n\n* 4\u5217\u76ee: \u30c7\u30d5\u30a9\u30eb\u30c8\n* 5\u5217\u76ee: 0: dump\u3059\u308b\n* 6\u5217\u76ee: 2: fsck\u3059\u308b\n\n`/etc/fstab`\u306e\u8a2d\u5b9a\u3092\u518d\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo mount -a\n```\n\n`/dev/sdb1`\u306e\u30c7\u30d0\u30a4\u30b9\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\n\n```bash\n$ df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1        15G  4.1G  9.9G  29% /\nnone            4.0K     0  4.0K   0% /sys/fs/cgroup\nudev            2.0G  8.0K  2.0G   1% /dev\ntmpfs           395M  792K  394M   1% /run\nnone            5.0M     0  5.0M   0% /run/lock\nnone            2.0G     0  2.0G   0% /run/shm\nnone            100M     0  100M   0% /run/user\n/dev/sdb1        40G   48M   38G   1% /media/data\n```\n\n## /var/lib/docker\u306e\u79fb\u52d5\n\n### rsync\u3067\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u30b3\u30d4\u30fc\n\n`rsync`\u3067`/var/lib/docker`\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u65b0\u3057\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002\n\n``` bash\n$ sudo mkdir /media/data/docker\n$ sudo rsync -aXS /var/lib/docker/. /media/data/docker/\n```\n\n`rsync`\u304c\u7d42\u4e86\u3057\u3066\u3001`/var/lib/docker`\u3068`/media/data/docker/`\u304c\u540c\u3058\u5185\u5bb9\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n```bash\n$ sudo du -sch /var/lib/docker/*\n2.1G\t/var/lib/docker/aufs\n140K\t/var/lib/docker/containers\n808K\t/var/lib/docker/graph\n15M\t/var/lib/docker/init\n12K\t/var/lib/docker/linkgraph.db\n4.0K\t/var/lib/docker/repositories-aufs\n4.0K\t/var/lib/docker/tmp\n8.0K\t/var/lib/docker/trust\n44K\t/var/lib/docker/volumes\n2.2G\ttotal\n$ sudo du -sch /media/data/docker/*\n2.1G\t/media/data/docker/aufs\n140K\t/media/data/docker/containers\n808K\t/media/data/docker/graph\n15M\t/media/data/docker/init\n12K\t/media/data/docker/linkgraph.db\n4.0K\t/media/data/docker/repositories-aufs\n4.0K\t/media/data/docker/tmp\n8.0K\t/media/data/docker/trust\n44K\t/media/data/docker/volumes\n2.1G\ttotal\n```\n\n\n## \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u30de\u30a6\u30f3\u30c8\n\n\u30aa\u30ea\u30b8\u30ca\u30eb\u306e`/var/lib/docker`\u3092\u5ff5\u306e\u305f\u3081\u30ea\u30cd\u30fc\u30e0\u3057\u3066\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u7a7a\u306b\u3057\u3066\u4f5c\u308a\u76f4\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo mv /var/lib/docker /var/lib/docker.bak\n$ sudo mkdir /var/lib/docker\n```\n\n`/var/lib/docker`\u306f\u7a7a\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u72b6\u614b\u3067\u3059\u3002\n\n```bash\n$ ls /media/data/docker/\naufs        graph  linkgraph.db       tmp    volumes\ncontainers  init   repositories-aufs  trust\n$ ls /var/lib/docker\n```\n\n`/media/data/docker`\u3092`/var/lib/docker`\u306bbind\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u3066\u30de\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002[BIND\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u306emount](http://wiki.bit-hive.com/north/pg/BIND%A5%AA%A5%D7%A5%B7%A5%E7%A5%F3%A4%C7%A4%CEmount)\u306b\u8a73\u3057\u304f\u89e3\u8aac\u3057\u3066\u304f\u308c\u3066\u3044\u307e\u3059\u3002mount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u3092\u4f7f\u3046\u3068\u4efb\u610f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u72ec\u81ea\u306e\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3068\u3057\u3066\u30a2\u30bf\u30c3\u30c1\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u3042\u308b\u30c7\u30d0\u30a4\u30b9\u306e\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u304c\u30de\u30a6\u30f3\u30c8\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n```bash\n$ sudo mount -o bind  /media/data/docker /var/lib/docker\n$ sudo du -sch /var/lib/docker/*\n2.1G\t/var/lib/docker/aufs\n140K\t/var/lib/docker/containers\n808K\t/var/lib/docker/graph\n15M\t/var/lib/docker/init\n12K\t/var/lib/docker/linkgraph.db\n4.0K\t/var/lib/docker/repositories-aufs\n4.0K\t/var/lib/docker/tmp\n8.0K\t/var/lib/docker/trust\n44K\t/var/lib/docker/volumes\n2.1G\ttotal\n```\n\n`/media/data/docker`\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c`/var/lib/docker`\u306b\u30de\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3057\u305f\u3002\u6700\u521d\u306f\u3053\u308c\u3092fstab\u306b\u9006\u3067\u66f8\u3044\u3066\u3057\u3066\u3057\u307e\u3044\u8d77\u52d5\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\n\n```bash\n$ df -ha\nFilesystem       Size  Used Avail Use% Mounted on\n/dev/sda1            15G  4.1G  9.9G  29% /\n...\n/dev/sdb1            40G  2.2G   36G   6% /media/data\n/media/data/docker   40G  2.2G   36G   6% /var/lib/docker\n```\n\n`/etc/fstab`\u3092\u7de8\u96c6\u3057\u3066\u518d\u8d77\u52d5\u5f8c\u3082\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\n\n```bash:/etc/fstab\n/media/data/docker /var/lib/docker  none bind 0 0\n```\n\nmount\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n``` bash\n$ sudo mount -a\n```\n\n## \u79fb\u52d5\u5148\u304b\u3089Docker\u3092\u8d77\u52d5\u3057\u3066\u78ba\u8a8d\n\n### aufs\u3060\u3051\u53e4\u3044\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3067\u5897\u52a0\u3057\u3066\u3057\u307e\u3046\n\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo service docker start\ndocker start/running, process 4276\n```\n\n`/var/lib/docker/aufs`\u3060\u30514.3G\u306b\u5897\u52a0\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002 `/media/data/docker/aufs`\u306f\u5909\u5316\u3057\u3066\u3044\u307e\u305b\u3093\u3002aufs\u306f\u4ee5\u524d\u306e\u5834\u6240\u306e\u307e\u307e\u306e\u3088\u3046\u3067\u3059\u3002\u3053\u306e\u72b6\u614b\u3067\u65b0\u3057\u3044\u30a4\u30e1\u30fc\u30b8\u3092`docker pull`\u3057\u3066\u3082`/var/lib/docker`\u306f\u5897\u52a0\u3057\u307e\u305b\u3093\u3002\n\n```bash\n$ sudo du -sch /var/lib/docker/*\n4.3G\t/var/lib/docker/aufs\n168K\t/var/lib/docker/containers\n808K\t/var/lib/docker/graph\n15M\t/var/lib/docker/init\n12K\t/var/lib/docker/linkgraph.db\n4.0K\t/var/lib/docker/repositories-aufs\n4.0K\t/var/lib/docker/tmp\n8.0K\t/var/lib/docker/trust\n44K\t/var/lib/docker/volumes\n4.3G\ttotal\n$ sudo du -sch /media/data/docker/*\n2.1G\t/media/data/docker/aufs\n168K\t/media/data/docker/containers\n808K\t/media/data/docker/graph\n15M\t/media/data/docker/init\n12K\t/media/data/docker/linkgraph.db\n4.0K\t/media/data/docker/repositories-aufs\n4.0K\t/media/data/docker/tmp\n8.0K\t/media/data/docker/trust\n44K\t/media/data/docker/volumes\n2.1G\ttotal\n```\n\naufs\u304c\u5897\u3048\u305f\u539f\u56e0\u306f\u3001docker-compose.yml\u306e\u30b5\u30fc\u30d3\u30b9\u3092`restart: always`\u306b\u3057\u3066\u3044\u308b\u306e\u3067Docker\u306e\u8d77\u52d5\u6642\u306b\u958b\u59cb\u3057\u305f\u305f\u3081\u3067\u3059\u3002\u3059\u3067\u306b\u4f5c\u6210\u6e08\u307f\u306e\u30b3\u30f3\u30c6\u30ca\u306fmount\u306ebind\u30aa\u30d7\u30b7\u30e7\u30f3\u3060\u3051\u3067\u306f\u3046\u307e\u304f\u79fb\u52d5\u3067\u304d\u306a\u3044\u307f\u305f\u3044\u3067\u3059\u3002\n\n```bash\n$ docker-compose ps\n      Name             Command             State              Ports\n-------------------------------------------------------------------------\nmeshblucompose_m   npm start          Up                 0.0.0.0:1883->18\neshblu_1                                                 83/tcp, 9000/tcp\nmeshblucompose_m   /entrypoint.sh     Up                 27017/tcp\nongo_1             mongod\nmeshblucompose_o   nginx -c /etc/ng   Up\npenresty_run_1     inx/nginx. ...\nmeshblucompose_r   /entrypoint.sh     Up                 6379/tcp\nedis_1             redis-server\n```\n\n### DOCKER_OPTS\u306b\u8ffd\u52a0\u3059\u308b\n\nDocker\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u65b0\u3057\u3044`/var/lib/docker`\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3057\u305f\u3002Docker\u3092\u505c\u6b62\u3057\u3066\u304b\u3089\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u306b\u8ffd\u8a18\u3057\u307e\u3059\u3002\n\n```bash:/etc/default/docker\nDOCKER_OPTS=\"-g /media/data/docker\"\n```\n\nDocker\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n``` bash\n$ sudo service docker start\ndocker start/running, process 5786\n```\n\n\u3088\u3046\u3084\u304f`/var/lib/docker`\u304c\u5897\u52a0\u305b\u305a\u3001`/media/data/docker/`\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306eaufs\u304c\u5897\u52a0\u3057\u307e\u3057\u305f\u3002`/var/lib/docker`\u306e\u79fb\u52d5\u304c\u3067\u304d\u307e\u3057\u305f\u3002\n\n```bash\n$ sudo du -sch /var/lib/docker/*\n2.1G\t/var/lib/docker/aufs\n180K\t/var/lib/docker/containers\n808K\t/var/lib/docker/graph\n15M\t/var/lib/docker/init\n12K\t/var/lib/docker/linkgraph.db\n4.0K\t/var/lib/docker/repositories-aufs\n4.0K\t/var/lib/docker/tmp\n8.0K\t/var/lib/docker/trust\n44K\t/var/lib/docker/volumes\n2.1G\ttotal\n$ sudo du -sch /media/data/docker/*\n4.3G\t/media/data/docker/aufs\n180K\t/media/data/docker/containers\n808K\t/media/data/docker/graph\n15M\t/media/data/docker/init\n12K\t/media/data/docker/linkgraph.db\n4.0K\t/media/data/docker/repositories-aufs\n4.0K\t/media/data/docker/tmp\n8.0K\t/media/data/docker/trust\n44K\t/media/data/docker/volumes\n4.3G\ttotal\n```\n", "tags": ["docker1.6.2", "Ubuntu14.04.2", "docker-compose1.2.0"]}