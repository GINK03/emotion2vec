{"context": "\n\n\u306f\u3058\u3081\u306b\n\u5148\u6708\uff082016/11/18\uff09\u306b AWS Lambda \u304c \u74b0\u5883\u5909\u6570\u3092\u30b5\u30dd\u30fc\u30c8 \u3057\u307e\u3057\u305f\u3002\n\u305d\u308c\u306b\u5408\u308f\u305b\u3066\u3001Terraform \u3082 \u30d0\u30fc\u30b8\u30e7\u30f30.7.12\u3067\u5bfe\u5fdc \u3057\u307e\u3057\u305f\u3002\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Terraform\u304b\u3089AWS Lambda\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f2016/12/11\u6642\u70b9\u3067\u306e\u6700\u65b0 0.7.13 \u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\nTerraform\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ terraform.exe -v\nTerraform v0.7.13\n\n\n\n\u74b0\u5883\u5909\u6570\u306e\u3046\u308c\u3057\u3055\n\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3046\u3068\u3001\u95a2\u6570(zip)\u5185\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\u4eca\u307e\u3067\u3060\u3063\u305f\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u3046\u6642\u3001\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u65b9\u6cd5\u304c\u53d6\u3063\u3066\u3044\u305f\u304b\u3068\u304a\u3082\u3044\u307e\u3059\u3002\n\n\u95a2\u6570\u5185\u306b\u76f4\u66f8\u304d\n\u95a2\u6570\u540d\u306b\u5165\u308c\u3066\u30d1\u30fc\u30b9\nDB\u306b\u6301\u305f\u305b\u308b\n\n\u3057\u304b\u3057\u3001\u95a2\u6570\u5185\u306b\u76f4\u66f8\u304d\u3057\u3066\u3044\u308b\u3068\u3001\u95a2\u6570\u306e\u4f55\u304b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5909\u308f\u308b\u305f\u3073\u306bzip\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u76f4\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u306a\u304f\u3066\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u95a2\u6570\u540d\u306b\u5165\u308c\u3066\u30d1\u30fc\u30b9\u306f\u4e8b\u6545\u306e\u5143\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nDB\u306b\u6301\u305f\u305b\u308b\u306e\u306f\u624b\u8efd\u3055\u306b\u6b20\u3051\u307e\u3059\u3002\n\u4eca\u56de\u306eLambda\u306b\u3088\u308b\u74b0\u5883\u5909\u6570\u306e\u30b5\u30dd\u30fc\u30c8\u3067\u3001\u624b\u8efd\u304b\u3064\u30b9\u30de\u30fc\u30c8\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u30fb\u5909\u66f4\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u203b \u305f\u3060\u3057\u3001\u74b0\u5883\u5909\u6570\u306e\u30b5\u30a4\u30ba\u306b\u306f\u4e0a\u9650\uff084 KB\uff09\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u74b0\u5883\u5909\u6570\u306e\u4f7f\u3044\u65b9\n\n\u8a2d\u5b9a\u65b9\u6cd5\uff08Terraform\u5074\uff09\nenvironment \u5f15\u6570\u306e\u4e2d\u306b \u5c5e\u6027\u540d\u3092 variables\u3001\u5024\u3092Map\u5f62\u5f0f\u3067\u66f8\u304d\u307e\u3059\u3002\n\naws_lambda_function.tf\n    environment {\n        variables = {\n            key1 = \"aaaabbbb\"\n            key2 = \"aaaa\\nbbbb\"\n            key3 = \"${var.value3}\"\n            key4 = \"${var.value4}\"\n            key6 = \"${var.value6}\"\n        }\n    }\n\n\n\u203b \u4e0b\u306baws_lambda_function\u30ea\u30bd\u30fc\u30b9\u5168\u4f53\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n\u53d6\u5f97\u65b9\u6cd5\uff08Node.js\u5074\uff09\nprocess.env \u5909\u6570\u304b\u3089\u53d6\u5f97\n\nNode.js\nconst value1 = process.env.key1;\nconst value2 = process.env.key2;\nconst keyName = \"key3\"\nconst value3 = process.env[keyName];\n\n\n\n\u30b5\u30f3\u30d7\u30eb\nhttps://github.com/tksugimoto/terraform_aws-lambda-environment-variables-sample\n\nTerraform\n\nvariables.tf\nvariable \"value3\" {\n    default = \"aaaa\\nbbbb\"\n}\nvariable \"value4\" {\n    default = \"aaaa\\\\nbbbb\"\n}\nvariable \"value6\" {\n    default = \"\u65e5\u672c\u8a9e\u3082OK\"\n}\n\n\n\nlambda-function.tf\nresource \"aws_lambda_function\" \"env_test\" {\n    function_name = \"${var.prefix}\"\n    role = \"${aws_iam_role.iam_for_lambda.arn}\"\n    runtime = \"nodejs4.3\"\n    handler = \"index.handler\"\n    filename = \"index.zip\"\n    source_code_hash = \"${base64sha256(file(\"index.zip\"))}\"\n    environment {\n        variables = {\n            key1 = \"aaaabbbb\"\n            key2 = \"aaaa\\nbbbb\"\n            key3 = \"${var.value3}\"\n            key4 = \"${var.value4}\"\n            key6 = \"${var.value6}\"\n        }\n    }\n}\n\n\n\nNode.js\n\nindex.js\nexports.handler = () => {\n    console.log(\"Fired!\");\n\n    const value1 = process.env.key1;\n    console.log(`key1: ${value1}`);\n\n    const value2 = process.env.key2;\n    console.log(`key2: ${value2}`);\n\n    const keyName = \"key3\"\n    const value3 = process.env[keyName];\n    console.log(`key3: ${value3}`);\n\n    console.log(`key4: ${process.env.key4}`);\n    console.log(`key5: ${process.env.key5}`);\n    console.log(`typeof key5: ${typeof process.env.key5}`);\n    console.log(`key6: ${process.env.key6}`);\n};\n\n\n\n\u5099\u8003\n\n\u6539\u884c\u306f \\n \u3067\u306f\u306a\u304f \\\\n \u63a8\u5968\n\n\u7406\u75311) \u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u5909\u6570\u306e\u5024\u5185\u306e\u6539\u884c\u3092\u78ba\u8a8d\u3067\u304d\u306a\u3044\n\n\u203b key\u540d\u3067\u30bd\u30fc\u30c8\u3057\u3066\u304f\u308c\u306a\u3044\u307f\u305f\u3044\u3067\u3059\n\n\nkey2, key3 \u306b \\n \u3092\u3044\u308c\u3066\u3042\u308b\u304c\u6539\u884c\u304c\u898b\u3048\u306a\u3044\n\n\n\nkey4 \u306b\u306f \\\\n (value4)\u3092\u6e21\u3057\u305f\u306e\u3067\u3001\u8868\u793a\u304c \\n \u306b\u306a\u3063\u3066\u3044\u307e\u3059\n\n\n\n\u4e0b\u306e\u51fa\u529b\u7d50\u679c\u3067\u306f\u6539\u884c\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5185\u90e8\u3067\u306f\u6539\u884c\u304c\u5b58\u5728\u3059\u308b\u3088\u3046\u3067\u3059\n\nkey1-4\u306e\u51fa\u529b\u7d50\u679c\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key1: aaaabbbb\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key2: aaaa\nbbbb\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key3: aaaa\nbbbb\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key4: aaaa\nbbbb\n\n\n\n\n\n\u7406\u75312) \u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u7de8\u96c6\u3059\u308b\u3068\u3001\u6539\u884c\u304c\u306a\u304f\u306a\u308b\n\u4f8b) key2, key3, key4 \u306b cccc \u3092\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u8ffd\u52a0\u3057\u305f\u5834\u5408\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u6539\u884c\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f key2, key3 \u306e\u6539\u884c\u304c\u6d88\u3048\u307e\u3057\u305f\n\nkey1-4\u306e\u51fa\u529b\u7d50\u679c\uff08\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u7de8\u96c6\u5f8c\uff09\n2016-12-11T06:14:46.537Z    1d359235-bf69-11e6-bdcc-73d201f9fb5d    key1: aaaabbbb\n2016-12-11T06:14:46.537Z    1d359235-bf69-11e6-bdcc-73d201f9fb5d    key2: aaaabbbbcccc\n2016-12-11T06:14:46.537Z    1d359235-bf69-11e6-bdcc-73d201f9fb5d    key3: aaaabbbbcccc\n2016-12-11T06:14:46.537Z    1d359235-bf69-11e6-bdcc-73d201f9fb5d    key4: aaaa\nbbbbcccc\n\n\n\n\u65e5\u672c\u8a9e\u3082\u4f7f\u7528\u53ef\n\nkey6\u306e\u51fa\u529b\u7d50\u679c\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key6: \u65e5\u672c\u8a9e\u3082OK\n\n\n\n\u30ab\u30f3\u30de , \u304c\u4f7f\u3048\u306a\u3044\nTerraform\u95a2\u4fc2\u306a\u304f\u3001AWS Lambda\u306e\u74b0\u5883\u5909\u6570\u306e\u4ed5\u69d8\u3067\u3059\u3002\nterraform apply \u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u307e\u3059\u3002\n\n\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\nValidationException: 1 validation error detected: Value at 'environment.variables' failed to satisfy constraint: Map value must satisfy constraint: [Member must satisfy regular expression pattern: [^,]*]\n\n\n\u203b terraform plan \u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n\n\u6307\u5b9a\u3057\u3066\u3044\u306a\u3044key\u306e\u74b0\u5883\u5909\u6570\u3092\u53d6\u5f97\u3059\u308b\u3068 undefined \u306b\u306a\u308b\nTerraform\u95a2\u4fc2\u306a\u304f\u3001AWS Lambda (Node.js) \u306e\u74b0\u5883\u5909\u6570\u306e\u4ed5\u69d8\u3067\u3059\u3002\n\nkey5\u306e\u51fa\u529b\u7d50\u679c\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    key5: undefined\n2016-12-11T06:02:02.678Z    55e4239f-bf67-11e6-956c-4d9dde297bec    typeof key5: undefined\n\n\n\u203b String\u578b\u306e undefined \uff08\u6587\u5b57\u5217\uff09\u3067\u306f\u306a\u304f undefined\u578b\u3067\u3059\u3002\nprocess.env.key5.replace(\"unde\", \"----\")\n\n\u306e\u3088\u3046\u306bmethod\u3092\u3064\u306a\u3052\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\nTypeError: Cannot read property 'replace' of undefined\n\n\n\n\n\u3042\u3068\u304c\u304d\n\nTerraform\u306ecode\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u30cf\u30a4\u30e9\u30a4\u30c8\u3063\u3066\u4f55\u3092\u6307\u5b9a\u3059\u308b\u3068\u826f\u3044\u3093\u3067\u3057\u3087\u3046\uff1f\ntext \u3060\u3068\u8aad\u307f\u3065\u3089\u3044\u306e\u3067 js (JavaScript) \u3092\u6307\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u4e00\u90e8\u304a\u304b\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u3002\n\nAmazon Web Services Advent Calendar 2016 - Qiita \u304c\u30ac\u30e9\u7a7a\u304d\u3060\u3063\u305f\u306e\u3067\u5165\u308c\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n\n# \u306f\u3058\u3081\u306b\n\u5148\u6708\uff082016/11/18\uff09\u306b [AWS Lambda \u304c \u74b0\u5883\u5909\u6570\u3092\u30b5\u30dd\u30fc\u30c8](https://aws.amazon.com/jp/about-aws/whats-new/2016/11/aws-lambda-supports-environment-variables/ \"https://aws.amazon.com/jp/about-aws/whats-new/2016/11/aws-lambda-supports-environment-variables/\") \u3057\u307e\u3057\u305f\u3002\n\u305d\u308c\u306b\u5408\u308f\u305b\u3066\u3001[Terraform](https://www.terraform.io/ \"https://www.terraform.io/\") \u3082 [\u30d0\u30fc\u30b8\u30e7\u30f30.7.12\u3067\u5bfe\u5fdc](https://github.com/hashicorp/terraform/blob/v0.7.13/CHANGELOG.md#0712-november-22-2016 \"terraform/CHANGELOG.md\") \u3057\u307e\u3057\u305f\u3002\n\n\u3053\u306e\u8a18\u4e8b\u3067\u306f\u3001Terraform\u304b\u3089AWS Lambda\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u306a\u304a\u3001Terraform \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306f2016/12/11\u6642\u70b9\u3067\u306e\u6700\u65b0 `0.7.13` \u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u3002\n\n```bash:Terraform\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n$ terraform.exe -v\nTerraform v0.7.13\n```\n\n# \u74b0\u5883\u5909\u6570\u306e\u3046\u308c\u3057\u3055\n\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3046\u3068\u3001\u95a2\u6570(zip)\u5185\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u5909\u66f4\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4eca\u307e\u3067\u3060\u3063\u305f\u3089\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u3046\u6642\u3001\u4f8b\u3048\u3070\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u65b9\u6cd5\u304c\u53d6\u3063\u3066\u3044\u305f\u304b\u3068\u304a\u3082\u3044\u307e\u3059\u3002\n\n* \u95a2\u6570\u5185\u306b\u76f4\u66f8\u304d\n* \u95a2\u6570\u540d\u306b\u5165\u308c\u3066\u30d1\u30fc\u30b9\n* DB\u306b\u6301\u305f\u305b\u308b\n\n\u3057\u304b\u3057\u3001\u95a2\u6570\u5185\u306b\u76f4\u66f8\u304d\u3057\u3066\u3044\u308b\u3068\u3001\u95a2\u6570\u306e\u4f55\u304b\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5909\u308f\u308b\u305f\u3073\u306bzip\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u308a\u76f4\u3057\u3066\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3057\u306a\u304f\u3066\u306f\u306a\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u95a2\u6570\u540d\u306b\u5165\u308c\u3066\u30d1\u30fc\u30b9\u306f\u4e8b\u6545\u306e\u5143\u306b\u306a\u308a\u305d\u3046\u3067\u3059\u3002\nDB\u306b\u6301\u305f\u305b\u308b\u306e\u306f\u624b\u8efd\u3055\u306b\u6b20\u3051\u307e\u3059\u3002\n\n\u4eca\u56de\u306eLambda\u306b\u3088\u308b\u74b0\u5883\u5909\u6570\u306e\u30b5\u30dd\u30fc\u30c8\u3067\u3001\u624b\u8efd\u304b\u3064\u30b9\u30de\u30fc\u30c8\u306b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u30fb\u5909\u66f4\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u203b \u305f\u3060\u3057\u3001\u74b0\u5883\u5909\u6570\u306e\u30b5\u30a4\u30ba\u306b\u306f\u4e0a\u9650\uff08[4 KB](http://docs.aws.amazon.com/lambda/latest/dg/env_variables.html#env_limits \"Environment Variables - AWS Lambda #env_limits\")\uff09\u304c\u3042\u308a\u307e\u3059\u3002\n\n\n# \u74b0\u5883\u5909\u6570\u306e\u4f7f\u3044\u65b9\n## \u8a2d\u5b9a\u65b9\u6cd5\uff08Terraform\u5074\uff09\n`environment` \u5f15\u6570\u306e\u4e2d\u306b \u5c5e\u6027\u540d\u3092 `variables`\u3001\u5024\u3092Map\u5f62\u5f0f\u3067\u66f8\u304d\u307e\u3059\u3002\n\n```js:aws_lambda_function.tf\n\tenvironment {\n\t\tvariables = {\n\t\t\tkey1 = \"aaaabbbb\"\n\t\t\tkey2 = \"aaaa\\nbbbb\"\n\t\t\tkey3 = \"${var.value3}\"\n\t\t\tkey4 = \"${var.value4}\"\n\t\t\tkey6 = \"${var.value6}\"\n\t\t}\n\t}\n```\n\u203b \u4e0b\u306baws_lambda_function\u30ea\u30bd\u30fc\u30b9\u5168\u4f53\u3082\u66f8\u3044\u3066\u3042\u308a\u307e\u3059\u3002\n\n## \u53d6\u5f97\u65b9\u6cd5\uff08Node.js\u5074\uff09\n`process.env` \u5909\u6570\u304b\u3089\u53d6\u5f97\n\n```js:Node.js\nconst value1 = process.env.key1;\nconst value2 = process.env.key2;\nconst keyName = \"key3\"\nconst value3 = process.env[keyName];\n```\n\n# \u30b5\u30f3\u30d7\u30eb\nhttps://github.com/tksugimoto/terraform_aws-lambda-environment-variables-sample\n\n## Terraform\n```js:variables.tf\nvariable \"value3\" {\n\tdefault = \"aaaa\\nbbbb\"\n}\nvariable \"value4\" {\n\tdefault = \"aaaa\\\\nbbbb\"\n}\nvariable \"value6\" {\n\tdefault = \"\u65e5\u672c\u8a9e\u3082OK\"\n}\n```\n\n```js:lambda-function.tf\nresource \"aws_lambda_function\" \"env_test\" {\n\tfunction_name = \"${var.prefix}\"\n\trole = \"${aws_iam_role.iam_for_lambda.arn}\"\n\truntime = \"nodejs4.3\"\n\thandler = \"index.handler\"\n\tfilename = \"index.zip\"\n\tsource_code_hash = \"${base64sha256(file(\"index.zip\"))}\"\n\tenvironment {\n\t\tvariables = {\n\t\t\tkey1 = \"aaaabbbb\"\n\t\t\tkey2 = \"aaaa\\nbbbb\"\n\t\t\tkey3 = \"${var.value3}\"\n\t\t\tkey4 = \"${var.value4}\"\n\t\t\tkey6 = \"${var.value6}\"\n\t\t}\n\t}\n}\n```\n\n## Node.js\n```js:index.js\nexports.handler = () => {\n\tconsole.log(\"Fired!\");\n\n\tconst value1 = process.env.key1;\n\tconsole.log(`key1: ${value1}`);\n\n\tconst value2 = process.env.key2;\n\tconsole.log(`key2: ${value2}`);\n\n\tconst keyName = \"key3\"\n\tconst value3 = process.env[keyName];\n\tconsole.log(`key3: ${value3}`);\n\n\tconsole.log(`key4: ${process.env.key4}`);\n\tconsole.log(`key5: ${process.env.key5}`);\n\tconsole.log(`typeof key5: ${typeof process.env.key5}`);\n\tconsole.log(`key6: ${process.env.key6}`);\n};\n```\n\n# \u5099\u8003\n\n## \u6539\u884c\u306f `\\n` \u3067\u306f\u306a\u304f `\\\\n` \u63a8\u5968\n\n### \u7406\u75311) \u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u5909\u6570\u306e\u5024\u5185\u306e\u6539\u884c\u3092\u78ba\u8a8d\u3067\u304d\u306a\u3044\n![\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u74b0\u5883\u5909\u6570\u8868\u793a\u753b\u50cf](https://qiita-image-store.s3.amazonaws.com/0/92375/4c0c2d31-4a23-f3e1-be02-ca9053bc1790.png \"\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u74b0\u5883\u5909\u6570\u8868\u793a\")\n\u203b key\u540d\u3067\u30bd\u30fc\u30c8\u3057\u3066\u304f\u308c\u306a\u3044\u307f\u305f\u3044\u3067\u3059\n\n* `key2`, `key3` \u306b `\\n` \u3092\u3044\u308c\u3066\u3042\u308b\u304c\u6539\u884c\u304c\u898b\u3048\u306a\u3044\n    * `key4` \u306b\u306f `\\\\n` (`value4`)\u3092\u6e21\u3057\u305f\u306e\u3067\u3001\u8868\u793a\u304c `\\n` \u306b\u306a\u3063\u3066\u3044\u307e\u3059\n* \u4e0b\u306e\u51fa\u529b\u7d50\u679c\u3067\u306f\u6539\u884c\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u5185\u90e8\u3067\u306f\u6539\u884c\u304c\u5b58\u5728\u3059\u308b\u3088\u3046\u3067\u3059\n\n    ```text:key1-4\u306e\u51fa\u529b\u7d50\u679c\n    2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey1: aaaabbbb\n    2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey2: aaaa\n    bbbb\n    2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey3: aaaa\n    bbbb\n    2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey4: aaaa\n    bbbb\n    ```\n\n### \u7406\u75312) \u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u7de8\u96c6\u3059\u308b\u3068\u3001\u6539\u884c\u304c\u306a\u304f\u306a\u308b\n\u4f8b) `key2`, `key3`, `key4` \u306b `cccc` \u3092\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u304b\u3089\u8ffd\u52a0\u3057\u305f\u5834\u5408\n\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u4e0a\u3067\u6539\u884c\u304c\u8868\u793a\u3055\u308c\u3066\u3044\u306a\u304b\u3063\u305f `key2`, `key3` \u306e\u6539\u884c\u304c\u6d88\u3048\u307e\u3057\u305f\n\n```text:key1-4\u306e\u51fa\u529b\u7d50\u679c\uff08\u30de\u30cd\u30b8\u30e1\u30f3\u30c8\u30b3\u30f3\u30bd\u30fc\u30eb\u3067\u7de8\u96c6\u5f8c\uff09\n2016-12-11T06:14:46.537Z\t1d359235-bf69-11e6-bdcc-73d201f9fb5d\tkey1: aaaabbbb\n2016-12-11T06:14:46.537Z\t1d359235-bf69-11e6-bdcc-73d201f9fb5d\tkey2: aaaabbbbcccc\n2016-12-11T06:14:46.537Z\t1d359235-bf69-11e6-bdcc-73d201f9fb5d\tkey3: aaaabbbbcccc\n2016-12-11T06:14:46.537Z\t1d359235-bf69-11e6-bdcc-73d201f9fb5d\tkey4: aaaa\nbbbbcccc\n```\n\n\n## \u65e5\u672c\u8a9e\u3082\u4f7f\u7528\u53ef\n```text:key6\u306e\u51fa\u529b\u7d50\u679c\n2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey6: \u65e5\u672c\u8a9e\u3082OK\n```\n\n\n## \u30ab\u30f3\u30de `,` \u304c\u4f7f\u3048\u306a\u3044\nTerraform\u95a2\u4fc2\u306a\u304f\u3001AWS Lambda\u306e\u74b0\u5883\u5909\u6570\u306e\u4ed5\u69d8\u3067\u3059\u3002\n`terraform apply` \u3059\u308b\u3068\u4ee5\u4e0b\u306e\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u51fa\u307e\u3059\u3002\n\n```text:\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\nValidationException: 1 validation error detected: Value at 'environment.variables' failed to satisfy constraint: Map value must satisfy constraint: [Member must satisfy regular expression pattern: [^,]*]\n```\n\n\u203b `terraform plan` \u3067\u306f\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u305b\u3093\u3002\n\n## \u6307\u5b9a\u3057\u3066\u3044\u306a\u3044key\u306e\u74b0\u5883\u5909\u6570\u3092\u53d6\u5f97\u3059\u308b\u3068 `undefined` \u306b\u306a\u308b\nTerraform\u95a2\u4fc2\u306a\u304f\u3001AWS Lambda (Node.js) \u306e\u74b0\u5883\u5909\u6570\u306e\u4ed5\u69d8\u3067\u3059\u3002\n\n```text:key5\u306e\u51fa\u529b\u7d50\u679c\n2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\tkey5: undefined\n2016-12-11T06:02:02.678Z\t55e4239f-bf67-11e6-956c-4d9dde297bec\ttypeof key5: undefined\n```\n\u203b String\u578b\u306e `undefined` \uff08\u6587\u5b57\u5217\uff09\u3067\u306f\u306a\u304f **undefined**\u578b\u3067\u3059\u3002\n\n```js\nprocess.env.key5.replace(\"unde\", \"----\")\n```\n\u306e\u3088\u3046\u306bmethod\u3092\u3064\u306a\u3052\u308b\u3068\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:\u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\nTypeError: Cannot read property 'replace' of undefined\n```\n\n\n----\n# \u3042\u3068\u304c\u304d\n* Terraform\u306ecode\u306e\u30b7\u30f3\u30bf\u30c3\u30af\u30b9\u30cf\u30a4\u30e9\u30a4\u30c8\u3063\u3066\u4f55\u3092\u6307\u5b9a\u3059\u308b\u3068\u826f\u3044\u3093\u3067\u3057\u3087\u3046\uff1f  \n    `text` \u3060\u3068\u8aad\u307f\u3065\u3089\u3044\u306e\u3067 `js` (JavaScript) \u3092\u6307\u5b9a\u3057\u3066\u307f\u307e\u3057\u305f\u304c\u3001\u4e00\u90e8\u304a\u304b\u3057\u304f\u306a\u308a\u307e\u3059\u3002\u3002\n* [Amazon Web Services Advent Calendar 2016 - Qiita](http://qiita.com/advent-calendar/2016/aws \"http://qiita.com/advent-calendar/2016/aws\") \u304c\u30ac\u30e9\u7a7a\u304d\u3060\u3063\u305f\u306e\u3067\u5165\u308c\u3066\u304a\u304d\u307e\u3057\u305f\u3002\n", "tags": ["Node.js", "AWS", "lambda", "AWSLambda", "Terraform"]}