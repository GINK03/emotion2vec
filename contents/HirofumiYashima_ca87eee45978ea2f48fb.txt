{"context": "Preferred Network \u306e \u516c\u5f0fGitHub \u304b\u3089 git clone \u3057\u305f Chainer \u306b\u306f\u3001DeepLearning \u3092\u7528\u3044\u3066\u53d6\u308a\u7d44\u3080\u4e3b\u8981\u30bf\u30b9\u30af\u306e\u30b5\u30f3\u30d7\u30eb\u30fb\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u6587\u7ae0\u751f\u6210\u30bf\u30b9\u30af\u306b\u3064\u3044\u3066\u306f\u3001train_ptb.py \u30d5\u30a1\u30a4\u30eb \u304c \u7528\u610f\u3055\u308c\u3066\u3044\u308b\u304c\u3001\u3053\u3044\u3064\u306f\u6df1\u5c64\u30e2\u30c7\u30eb\u3092\u5b66\u7fd2\u3059\u308b\u3060\u3051\u306e\u30d5\u30a1\u30a4\u30eb\u3002\n\u3067\u3001\u751f\u6210\u3055\u308c\u305f\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f cv \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\uff08\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570\u3067\u5225\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306f\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\uff09\u306b\u683c\u7d0d\u3055\u308c\u308b\u3002\n\u3057\u304b\u3057\u3001\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\uff08\u5b66\u7fd2\u56f3\u6e08\u307f\u306e\u30b3\u30fc\u30d1\u30b9\u306b\u5b58\u5728\u3059\u308b\uff09\u4efb\u610f\u306e\u5358\u8a9e\u3092\u4e0e\u3048\u3066\u3001\u4e0e\u3048\u305f\u5358\u8a9e\u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c\u3055\u305b\u3066\u3001\u4e88\u6e2c\u7d50\u679c\u306e\u5358\u8a9e\u5217 \u3092 \u51fa\u529b\u3055\u305b\u308b\u51e6\u7406 \u3092 \u884c\u3046\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u304b\u304c\u3001\u3057\u3070\u3089\u304f\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u3002\n\u3053\u306e\u305f\u3081\u3001\u3053\u306e\u8a18\u4e8b\u306e\u7d42\u308f\u308a\u306e\u300c\u53c2\u8003\u300d\u6b04\u3067\u5f15\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001\u5358\u8a9e\u4e88\u6e2c\u7528\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8 \u3092 \u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\nHatena::Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d\nHatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d\n\n\n\u4eca\u56de\u3001Chainer\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u773a\u3081\u3066\u3044\u305f\u3068\u3053\u308d\u3001train_ptb.py \u30d5\u30a1\u30a4\u30eb \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea \u306b gentxt.py \u3068\u3044\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u3001\u3053\u308c\u3053\u305d\u3001\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\u4e0e\u3048\u305f\u5358\u8a9e\u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c&\u51fa\u529b \u3055\u305b\u308b\u51e6\u7406 \u3092 \u884c\u3046 Python\u30d5\u30a1\u30a4\u30eb \u3067\u3042\u308b\u3053\u3068\u306b\u6c17\u3065\u3044\u305f \u306e\u3067\u3001\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n\uff08\u7d50\u679c\u306f\u554f\u984c\u306a\u304f\u52d5\u304d\u307e\u3057\u305f\uff01\uff09\n\n\u4ee5\u4e0b\u3092\u901a\u3057\u3066\u3067\u884c\u3063\u3066\u307f\u307e\u3059\u3002\n\n\n\uff081\uff09 train_ptb.py \u3067 \u30e2\u30c7\u30eb\u5b66\u7fd2\n\uff082\uff09 gentxt.py \u3067 \u4e0e\u3048\u305f\u5358\u8a9e \u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c\u3057\u3066 \u51fa\u529b\n\n\n\n\uff08\uff11\uff09\u30e2\u30c7\u30eb\u5b66\u7fd2\n\n\n\u30b3\u30fc\u30c9\u306b\u4f55\u3082\u624b\u3092\u52a0\u3048\u306a\u3044\u3067\u3001train_ptb.py \u3092 \u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n\nCPU\u30e2\u30fc\u30c9 \u3067 \u8d70\u3089\u305b\u3066\u307f\u305f\u306e\u3067\u3001\u4e88\u60f3\u6240\u8981\u6642\u9593\u306f\u3001\u4f55\u3068\uff13\u65e5\u9593  \n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ pwd\n/Users/hirofumiyashima/chainer/examples/ptb\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python --version\nPython 3.5.2\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ time python train_ptb.py --gpu=-1\n\n\n\n\uff08 1\u6642\u9593\u307b\u3069\u7d4c\u3063\u305f\u5f8c\u306e\u753b\u9762 \uff09\n\n\nepoch\u6570\u3092\uff15\u306b\u4e0b\u3052\u3066\u518d\u5ea6\u3001\u5b9f\u884c\n\n\nTerminal\ntime python train_ptb.py \u2014gpu=-1 \u2014epoch 5 \n\n\n\uff11\u65e5\u7d4c\u3063\u3066\u3082\u7d42\u308f\u3089\u306a\u3044\u306e\u3067\u3001\u5f37\u5236\u7d42\u4e86\n\n\uff08 Ctrl-D \u62bc\u4e0b\u3057\u3066\u5f37\u5236\u7d42\u4e86 \uff09\n\n\n\u9014\u4e2d\u306eepoch\u6570\u306e\u5b66\u7fd2\u6bb5\u968e\u3067\u5f37\u5236\u7d42\u4e86\u304b\u3051\u305f\u304c\u3001\u305d\u306eepoch\u6570\u307e\u3067\u306b\u751f\u6210\u3055\u308c\u305f\u30e2\u30c7\u30eb\u304c\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\n\n\nresult\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002\n\n\nresult\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b\u3001\u4ee5\u4e0b \u306e \uff12\u3064\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8 \u306e Chainer\u30e2\u30c7\u30eb\u30d5\u30a1\u30a4\u30eb \u304c \u751f\u6210\u3055\u308c\u3066\u3044\u308b\n\n\nmodel_iter_1328\nsnapshot_iter_1328\n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls\nREADME.md   __pycache__ gentxt.py   result      train_ptb.py\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls result\nlog         model_iter_1328     snapshot_iter_1328\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ pwd\n/Users/hirofumiyashima/chainer/examples/ptb\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls\nREADME.md   __pycache__ gentxt.py   result      train_ptb.py\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\n\ntrain_ptb \u306f\u3001\u30e2\u30c7\u30eb\u5b66\u7fd2\u307e\u3067\u3002\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\u6587\u7ae0\u751f\u6210\u3059\u308b\u5358\u8a9e\u4e88\u6e2c\u30bf\u30b9\u30af\u306f\u3001gentxt.py \u3067\u5b9f\u884c\u3059\u308b\n\n\n\uff082\uff09\u6307\u5b9a\u3057\u305f\u5358\u8a9e \u306b \u3064\u3065\u304f\u5358\u8a9e\u5217 \u306e \u4e88\u6e2c\uff06\u51fa\u529b\n\n\n\u305d\u306e\u30e2\u30c7\u30eb \u3092\u3001gentxt.py \u304b\u3089\u547c\u3073\u51fa\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u304d\u6570\u3067\u6e21\u3057\u305f\u5358\u8a9e\u306e\u6b21\u306b\u7d9a\u304f\u5358\u8a9e\u5217\u3092\u4e88\u6e2c\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b\n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570 \u2014-primetext \u306b was \u3092 \u6307\u5b9a\u3057\u3066\u5b9f\u884c\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext was\nwas at the most nih thrift .the opposite name the american declaration of the trade shipyard of over airline the \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09\n\nwas at the most nih thrift .the opposite name the american declaration of the trade shipyard of over airline the\n\n\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3067\u78ba\u304b\u3081\u305f\u3088\u3046\u306b\u3001train_ptb.py \u304c \u30e2\u30c7\u30eb\u5b66\u7fd2\u6642\u306b\u5229\u7528\u3057\u305f\u30b3\u30fc\u30d1\u30b9\u306f\u3001\u4ee5\u4e0b\u304b\u3089\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u30b3\u30fc\u30d1\u30b9\u306b\u3001was \u306f\u51fa\u73fe\u3057\u3066\u3044\u308b\u3002\nhttps://raw.githubusercontent.com/tomsercu/lstm/master/data/ptb.train.txt\nHirofumiYashima Qiita\u8a18\u4e8b\uff082016/08/04\uff09\u300cChainer ver.1.11.0 \u306e \u6587\u7ae0\u751f\u6210\u30bf\u30b9\u30af\uff08\u6b21\u306e\u51fa\u73fe\u5358\u8a9e\u4e88\u6e2c\uff09\u5b66\u7fd2\u7528 Chainer\u30b3\u30fc\u30c9\u300cptb\u300d\u3067\u3001\u5b66\u7fd2\u7528\u6587\u7ae0\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u5de5\u7a0b \u306e \u30b3\u30fc\u30c9\u8a18\u8ff0\u7b87\u6240 \u304c \u5206\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067 \u7a81\u304d\u6b62\u3081\u3066\u307f\u305f\u300d\n\n\u5b66\u7fd2\u7528\u30b3\u30fc\u30d1\u30b9\u306b\u51fa\u73fe\u3057\u3066\u3044\u305f\u4ed6\u306e\u5358\u8a9e\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570\u306b\u4e0e\u3048\u3066\u3001\u305d\u306e\u5358\u8a9e\u306b\u7d9a\u304f\u5358\u8a9e\u5217\u3092\u4e88\u6e2c\u3055\u305b\u3066\u307f\u308b\u3002\n\n\u4e0e\u3048\u305f\u5358\u8a9e\uff1a american\n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext american\namerican york 's u.s. lives .the national airline company the state house sold to about $ N million certainly is \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09\n\namerican york 's u.s. lives .the national airline company the state house sold to about $ N million certainly is \n\n\n\n\u4e0e\u3048\u305f\u5358\u8a9e\uff1a researchers\n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext researchers\nresearchers it in the retail economy .the difficulties were of one of the big two trump the surged shared <unk> \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09\n\nresearchers it in the retail economy .the difficulties were of one of the big two trump the surged shared  \n\n\n\n\u4e0e\u3048\u305f\u5358\u8a9e\uff1a kind\n\n\nTerminal\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext kind\nkind of mr. <unk> said .the institute tourism on the prospects of the attempt and ballooning as one thatcher is \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n\n\n\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09\n\nkind of mr.  said .the institute tourism on the prospects of the attempt and ballooning as one thatcher is \n\n\n\n\n\u3010 \u5099\u8003 \u3011\n\n\n\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001\u5358\u8a9e\u4e88\u6e2c\u7528\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8 \u3092 \u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\n\nHatena::Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d\nHatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d\n\nHatena**Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d\n\n\u307e\u3042\u3068\u306b\u304b\u304f\u5b66\u7fd2\u304c\u9032\u3093\u3060\u3053\u3068\u3060\u3051\u308f\u304b\u308b\u3002\n\u3053\u306eptb\u30b5\u30f3\u30d7\u30eb\u306b\u95a2\u3057\u3066\u306f\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u4fdd\u5b58\u3055\u3048\u3057\u306a\u3044\u306e\u3067\u3001\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u307f\u308b\u3002\ntrain_ptb.py\u306e138\u884c\u76ee\u3042\u305f\u308a\u3092\n\ntrain_ptb.py\n if (i + 1) % 10000 == 0:\n       now = time.time()\n       throuput = 10000. / (now - cur_at)\n       perp = math.exp(cuda.to_cpu(cur_log_perp) / 10000)\n       print('iter {} training perplexity: {:.2f} ({:.2f} iters/sec)'.format(\n           i + 1, perp, throuput))\n       cur_at = now\n       cur_log_perp.fill(0)\n       pickle.dump(model, open('model%04d' % (i+1), 'wb'), -1) #\u3053\u308c\u3092\u8ffd\u52a0\n\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u6700\u5f8c\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n\u3059\u308b\u306810000\u30b9\u30c6\u30c3\u30d7\u3054\u3068\u306b\u30e2\u30c7\u30eb\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\u4fdd\u5b58\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u63a8\u5b9a\u3059\u308b\u306b\u306f\u5225\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n\u4eca\u56de\u306f\u3068\u308a\u3042\u3048\u305a\u306e\u7d50\u679c\u3060\u3051\u898b\u305f\u304b\u3063\u305f\u306e\u3067\u3001train_ptb.py\u3092\u6539\u9020\u3057\u3066\u3053\u3093\u306a\u96d1\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u305f\u3002\n\nPython\n\uff08\u524d\u7565\uff09\n\n# Evaluation routine\ndef evaluate(dataset):\n   sum_log_perp = mod.zeros(())\n   state = make_initial_state(batchsize=1, train=False)\n   data = dataset[101:] #\u9069\u5f53\u306a\u5358\u8a9e\u3092\u9078\u3076\n   rand = np.random.uniform(0.0, 1.0,dataset.size)\n   for i in six.moves.range(dataset.size - 1): #\u30eb\u30fc\u30d7\u306e\u6570\u306f\u9069\u5f53\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u3053\u306e\u307e\u307e\n       x_batch = data[0:1] #\u6700\u521d\u306e\u5358\u8a9e\u3060\u3051\u3092\u6e21\u3059\n       print(inv_vocab[x_batch[0]]), #\u9006\u5f15\u304d\u8f9e\u66f8\u3092\u4f7f\u3063\u3066\u5358\u8a9e\u3092\u8868\u793a\n       state, predict = forward_one_step(x_batch, x_batch, state, train=False)\n       score = cuda.to_cpu(predict)\n       top_k=1\n       prediction = zip(score.data[0].get().tolist(), vocab)\n       prediction.sort(cmp=lambda x, y: cmp(x[0], y[0]), reverse=True)\n       m = rand[i] #\u4e71\u6570\n       total = 0.0\n       for rank, (score, name) in enumerate(prediction, start=1):\n           data[0] = vocab[name] #\u6700\u521d\u306e\u5358\u8a9e\u3092\u63a8\u5b9a\u3057\u305f\u5358\u8a9e\u306b\u66f4\u65b0\u3059\u308b\n           total += score\n           if total>m : #\u63a8\u5b9a\u3055\u308c\u305f\u5358\u8a9e\u306e\u78ba\u7387\u306b\u3057\u305f\u304c\u3063\u3066\u5358\u8a9e\u3092\u9078\u3076\n               break\n   return math.exp(cuda.to_cpu(sum_log_perp) / (dataset.size - 1))\n\n# Evaluate on test dataset\ntest_perp = evaluate(train_data)\n\n\n\u4e2d\u8eab\u306f\u307b\u3068\u3093\u3069train_ptb.py\u306e\u307e\u3093\u307e\u306a\u3093\u3060\u3051\u3069\u3001\u9006\u5f15\u304d\u8f9e\u66f8\u3092\u4f5c\u3063\u305f\u308a\u3001\u30e2\u30c7\u30eb\n\u3092\u8aad\u307f\u8fbc\u3093\u3060\u308a\u3001Softmax_cross_entropy\u3067\u306f\u306a\u304f\u3066Sotfmat\u95a2\u6570\u3092\u4f7f\u3063\u3066\u6b21\u306e\u5358\u8a9e\n\u3092\u63a8\u5b9a\u3057\u305f\u308a\u3057\u3066\u3001\u6587\u7ae0\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n\u3000\u6700\u521d\u306f\u4e00\u756a\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u5019\u88dc\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u3044\u305f\u3093\u3060\u3051\u3069\u3001\u5802\u3005\u5de1\u308a\u306b\u306a\u3063\u3066\n\u3068\u3066\u3082\u6587\u7ae0\u3092\u81ea\u52d5\u751f\u6210\u3057\u3066\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u307e\u3067\u3044\u304b\u306a\u304b\u3063\u305f\u3002\u305d\u3053\u3067\u6628\u65e5\u306e\u30cb\u30b3\n\u751f\u306e\u30b2\u30b9\u30c8\u3060\u3063\u305f\u30c9\u30ef\u30f3\u30b4\u4eba\u5de5\u77e5\u80fd\u7814\u7a76\u6240\u306e\u4e2d\u6751\u3055\u3093\u306b\u805e\u3044\u305f\u3089\u3001\u300c\u4e00\u756a\u4e0a\u306e\u3084>\u3064\u3060\u3051\u306b\u3059\u308b\u3068\u5802\u3005\u5de1\u308a\u306b\u306a\u308b\u306e\u3067\u3001\u78ba\u7387\u5206\u5e03\u306b\u5f93\u3063\u3066\u5358\u8a9e\u9078\u629e\u3059\u3079\u3057\u300d\u3068\u306e\u3053\n\u3068\u3060\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u3088\u3046\u306b\u3057\u305f\u3002\n\n\nHatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d\n\n\u4eca\u56de\u306f\u3001\u5b66\u7fd2\u306f\u30ea\u30e2\u30fc\u30c8\u306eGPU\u74b0\u5883\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u7d50\u679c\u51fa\u529b\u306f\u30ed\u30fc\u30ab\u30eb\u306eCPU\u74b0\u5883\u3067\u884c\u3044\u307e\u3057\u305f\u3002 \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f Chainer 1.7.1 \u306b\u4ed8\u5c5e\u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u3061\u306a\u307f\u306b\u3001\u7d50\u679c\u51fa\u529b\u7528\u306e\u30b3\u30fc\u30c9\u306f\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\nPython\n\uff08\u524d\u7565\uff09\n\nfor i in six.moves.range(10):\n   data = test_data[i:i+1]\nprint(inv_vocab[data[0]])\n\nx = chainer.Variable(data, volatile=False)\nh0 = model.predictor.embed(x)\nh1 = model.predictor.l1(h0)\nh2 = model.predictor.l2(h1)\ny = model.predictor.l3(h2)\n\n# \u51fa\u529b\u7d50\u679c\u306e\u3046\u3061\u4e0a\u4f4d3\u500b\u3092\u51fa\u529b\nprediction = list(zip(y.data[0].tolist(), inv_vocab.values()))\nprediction.sort()\nprediction.reverse()\n\nfor i, (score, word) in enumerate(prediction):\n      print('{},{}'.format(word, score))\n      if i >= 2: break\n\n\n\n\u4e0a\u3067\u66f8\u3044\u305f\u3088\u3046\u306b\u3001RNN\u306e\u5b66\u7fd2\u306f\u305d\u308c\u307e\u3067\u306b\u3069\u3093\u306a\u5024\u3092\u5165\u529b\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u3067\u5909\u5316\u3057\u307e\n\u3059\u3002 \u4eca\u56de\u306f\u3001\u30b5\u30f3\u30d7\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\u5185\u306e\u300cno it was n't black monday\u300d\u3068\u3044\u3046\u6587\u3092\n\u4f7f\u7528\u3057\u3066\u3001\u6bce\u56deLSTM\u5c64\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u305f\u6587\u8108\u3092\u7121\u8996\u3057\u305f\u5834\u5408\u3068\u3001\u6700\u521d\u306e\u5358\n\u8a9e\u306e\u6642\u306e\u307fLSTM\u5c64\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u305f\u6587\u8108\u3092\u8003\u616e\u3057\u305f\u5834\u5408\u3067\u305d\u308c\u305e\u308c\u7d50\u679c\u3092\u6bd4\n\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n\nPreferred Network \u306e \u516c\u5f0fGitHub \u304b\u3089 git clone \u3057\u305f Chainer \u306b\u306f\u3001DeepLearning \u3092\u7528\u3044\u3066\u53d6\u308a\u7d44\u3080\u4e3b\u8981\u30bf\u30b9\u30af\u306e\u30b5\u30f3\u30d7\u30eb\u30fb\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u540c\u68b1\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u6587\u7ae0\u751f\u6210\u30bf\u30b9\u30af\u306b\u3064\u3044\u3066\u306f\u3001train_ptb.py \u30d5\u30a1\u30a4\u30eb \u304c \u7528\u610f\u3055\u308c\u3066\u3044\u308b\u304c\u3001**\u3053\u3044\u3064\u306f\u6df1\u5c64\u30e2\u30c7\u30eb\u3092\u5b66\u7fd2\u3059\u308b\u3060\u3051**\u306e\u30d5\u30a1\u30a4\u30eb\u3002\n\n\u3067\u3001\u751f\u6210\u3055\u308c\u305f\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u306f\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u306f cv \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\uff08\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570\u3067\u5225\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u540d\u3092\u6307\u5b9a\u3057\u305f\u5834\u5408\u306f\u305d\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u76f4\u4e0b\uff09\u306b\u683c\u7d0d\u3055\u308c\u308b\u3002\n\n**\u3057\u304b\u3057\u3001\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\uff08\u5b66\u7fd2\u56f3\u6e08\u307f\u306e\u30b3\u30fc\u30d1\u30b9\u306b\u5b58\u5728\u3059\u308b\uff09\u4efb\u610f\u306e\u5358\u8a9e\u3092\u4e0e\u3048\u3066\u3001\u4e0e\u3048\u305f\u5358\u8a9e\u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c\u3055\u305b\u3066\u3001\u4e88\u6e2c\u7d50\u679c\u306e\u5358\u8a9e\u5217 \u3092 \u51fa\u529b\u3055\u305b\u308b\u51e6\u7406 \u3092 \u884c\u3046\u306b\u306f\u3069\u3046\u3057\u305f\u3089\u826f\u3044\u304b\u304c\u3001\u3057\u3070\u3089\u304f\u5206\u304b\u3089\u306a\u304b\u3063\u305f\u3002**\n\n\u3053\u306e\u305f\u3081\u3001\u3053\u306e\u8a18\u4e8b\u306e\u7d42\u308f\u308a\u306e\u300c\u53c2\u8003\u300d\u6b04\u3067\u5f15\u7528\u3055\u305b\u3066\u3044\u305f\u3060\u304d\u307e\u3057\u305f\u304c\u3001\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001\u5358\u8a9e\u4e88\u6e2c\u7528\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8 \u3092 \u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002\n\n___\n\n[Hatena::Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d](http://d.hatena.ne.jp/shi3z/20150714/1436832305)\n\n\n[Hatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d](http://ksksksks2.hatenadiary.jp/entry/20160319/1458391617)\n\n___\n\n####\u4eca\u56de\u3001Chainer\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u773a\u3081\u3066\u3044\u305f\u3068\u3053\u308d\u3001**train_ptb.py \u30d5\u30a1\u30a4\u30eb \u3068\u540c\u3058\u30c7\u30a3\u30ec\u30af\u30c8\u30ea \u306b gentxt.py \u3068\u3044\u3046\u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u304c\u3042\u308a\u3001\u3053\u308c\u3053\u305d\u3001\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\u4e0e\u3048\u305f\u5358\u8a9e\u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c&\u51fa\u529b \u3055\u305b\u308b\u51e6\u7406 \u3092 \u884c\u3046 Python\u30d5\u30a1\u30a4\u30eb \u3067\u3042\u308b\u3053\u3068\u306b\u6c17\u3065\u3044\u305f** \u306e\u3067\u3001\u5b9f\u884c\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n###__\uff08\u7d50\u679c\u306f\u554f\u984c\u306a\u304f\u52d5\u304d\u307e\u3057\u305f\uff01\uff09__\n\n__\u4ee5\u4e0b\u3092\u901a\u3057\u3066\u3067\u884c\u3063\u3066\u307f\u307e\u3059\u3002__\n\n___\n\n* \uff081\uff09 train_ptb.py \u3067 \u30e2\u30c7\u30eb\u5b66\u7fd2\n* \uff082\uff09 gentxt.py \u3067 \u4e0e\u3048\u305f\u5358\u8a9e \u306b\u3064\u3065\u304f\u5358\u8a9e\u5217 \u3092 \u4e88\u6e2c\u3057\u3066 \u51fa\u529b\n\n___\n\n\n#__\uff08\uff11\uff09\u30e2\u30c7\u30eb\u5b66\u7fd2__\n\n####__\u30b3\u30fc\u30c9\u306b\u4f55\u3082\u624b\u3092\u52a0\u3048\u306a\u3044\u3067\u3001train_ptb.py \u3092 \u305d\u306e\u307e\u307e\u5b9f\u884c\u3057\u307e\u3059\u3002__\n\n* CPU\u30e2\u30fc\u30c9 \u3067 \u8d70\u3089\u305b\u3066\u307f\u305f\u306e\u3067\u3001\u4e88\u60f3\u6240\u8981\u6642\u9593\u306f\u3001\u4f55\u3068\uff13\u65e5\u9593 :disappointed_relieved: \n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ pwd\n/Users/hirofumiyashima/chainer/examples/ptb\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python --version\nPython 3.5.2\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ time python train_ptb.py --gpu=-1\n```\n\n<img width=\"826\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-08-04 19.11.48.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43487/e88d1a5c-8625-c2f2-8464-e8ec47806d19.png\">\n\n__\uff08 1\u6642\u9593\u307b\u3069\u7d4c\u3063\u305f\u5f8c\u306e\u753b\u9762 \uff09__\n\n<img width=\"824\" alt=\"\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8 2016-08-04 20.19.36.png\" src=\"https://qiita-image-store.s3.amazonaws.com/0/43487/0d1dddec-763f-3500-df06-96a0cc760b36.png\">\n\n\n###__epoch\u6570\u3092\uff15\u306b\u4e0b\u3052\u3066\u518d\u5ea6\u3001\u5b9f\u884c__\n\n\n```{bash:Terminal}\ntime python train_ptb.py \u2014gpu=-1 \u2014epoch 5 \n```\n\n__\uff11\u65e5\u7d4c\u3063\u3066\u3082\u7d42\u308f\u3089\u306a\u3044\u306e\u3067\u3001\u5f37\u5236\u7d42\u4e86__\n\n\n####__\uff08 Ctrl-D \u62bc\u4e0b\u3057\u3066\u5f37\u5236\u7d42\u4e86 \uff09__\n\n\n####__\u9014\u4e2d\u306eepoch\u6570\u306e\u5b66\u7fd2\u6bb5\u968e\u3067\u5f37\u5236\u7d42\u4e86\u304b\u3051\u305f\u304c\u3001\u305d\u306eepoch\u6570\u307e\u3067\u306b\u751f\u6210\u3055\u308c\u305f\u30e2\u30c7\u30eb\u304c\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b__\n\n###__result\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u751f\u6210\u3055\u308c\u3066\u3044\u308b\u3002__\n\n####__result\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4e2d\u306b\u3001\u4ee5\u4e0b \u306e \uff12\u3064\u306e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8 \u306e Chainer\u30e2\u30c7\u30eb\u30d5\u30a1\u30a4\u30eb \u304c \u751f\u6210\u3055\u308c\u3066\u3044\u308b__\n\n* model_iter_1328\n* snapshot_iter_1328\n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls\nREADME.md\t__pycache__\tgentxt.py\tresult\t\ttrain_ptb.py\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls result\nlog\t\t\tmodel_iter_1328\t\tsnapshot_iter_1328\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ pwd\n/Users/hirofumiyashima/chainer/examples/ptb\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ ls\nREADME.md\t__pycache__\tgentxt.py\tresult\t\ttrain_ptb.py\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n___\n\n###__train_ptb \u306f\u3001\u30e2\u30c7\u30eb\u5b66\u7fd2\u307e\u3067\u3002\u30e2\u30c7\u30eb\u3092\u7528\u3044\u3066\u3001\u6587\u7ae0\u751f\u6210\u3059\u308b\u5358\u8a9e\u4e88\u6e2c\u30bf\u30b9\u30af\u306f\u3001gentxt.py \u3067\u5b9f\u884c\u3059\u308b__\n\n#__\uff082\uff09\u6307\u5b9a\u3057\u305f\u5358\u8a9e \u306b \u3064\u3065\u304f\u5358\u8a9e\u5217 \u306e \u4e88\u6e2c\uff06\u51fa\u529b__\n\n####__\u305d\u306e\u30e2\u30c7\u30eb \u3092\u3001gentxt.py \u304b\u3089\u547c\u3073\u51fa\u3057\u3066\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u304d\u6570\u3067\u6e21\u3057\u305f\u5358\u8a9e\u306e\u6b21\u306b\u7d9a\u304f\u5358\u8a9e\u5217\u3092\u4e88\u6e2c\u51fa\u529b\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u308b__ \n\n\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570 \u2014-primetext \u306b was \u3092 \u6307\u5b9a\u3057\u3066\u5b9f\u884c\n\n```{bash:Terminal} \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext was\nwas at the most nih thrift .the opposite name the american declaration of the trade shipyard of over airline the \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n__\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09__\n\n> was at the most nih thrift .the opposite name the american declaration of the trade shipyard of over airline the\n\n___\n\n\u4ee5\u4e0b\u306e\u8a18\u4e8b\u3067\u78ba\u304b\u3081\u305f\u3088\u3046\u306b\u3001train_ptb.py \u304c \u30e2\u30c7\u30eb\u5b66\u7fd2\u6642\u306b\u5229\u7528\u3057\u305f\u30b3\u30fc\u30d1\u30b9\u306f\u3001\u4ee5\u4e0b\u304b\u3089\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\u3053\u306e\u30b3\u30fc\u30d1\u30b9\u306b\u3001was \u306f\u51fa\u73fe\u3057\u3066\u3044\u308b\u3002\n\nhttps://raw.githubusercontent.com/tomsercu/lstm/master/data/ptb.train.txt\n\n[HirofumiYashima Qiita\u8a18\u4e8b\uff082016/08/04\uff09\u300cChainer ver.1.11.0 \u306e \u6587\u7ae0\u751f\u6210\u30bf\u30b9\u30af\uff08\u6b21\u306e\u51fa\u73fe\u5358\u8a9e\u4e88\u6e2c\uff09\u5b66\u7fd2\u7528 Chainer\u30b3\u30fc\u30c9\u300cptb\u300d\u3067\u3001\u5b66\u7fd2\u7528\u6587\u7ae0\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u5de5\u7a0b \u306e \u30b3\u30fc\u30c9\u8a18\u8ff0\u7b87\u6240 \u304c \u5206\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067 \u7a81\u304d\u6b62\u3081\u3066\u307f\u305f\u300d](http://qiita.com/HirofumiYashima/items/432033c9a007bc786000)\n\n___\n\n\n\u5b66\u7fd2\u7528\u30b3\u30fc\u30d1\u30b9\u306b\u51fa\u73fe\u3057\u3066\u3044\u305f\u4ed6\u306e\u5358\u8a9e\u3092\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u5f15\u6570\u306b\u4e0e\u3048\u3066\u3001\u305d\u306e\u5358\u8a9e\u306b\u7d9a\u304f\u5358\u8a9e\u5217\u3092\u4e88\u6e2c\u3055\u305b\u3066\u307f\u308b\u3002\n\n* \u4e0e\u3048\u305f\u5358\u8a9e\uff1a american\n\n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext american\namerican york 's u.s. lives .the national airline company the state house sold to about $ N million certainly is \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n__\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09__\n\n> american york 's u.s. lives .the national airline company the state house sold to about $ N million certainly is \n\n___\n\n* \u4e0e\u3048\u305f\u5358\u8a9e\uff1a researchers\n\n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext researchers\nresearchers it in the retail economy .the difficulties were of one of the big two trump the surged shared <unk> \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n__\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09__\n\n> researchers it in the retail economy .the difficulties were of one of the big two trump the surged shared <unk> \n\n___\n\n* \u4e0e\u3048\u305f\u5358\u8a9e\uff1a kind\n\n```{bash:Terminal}\nHirofumiYashima-no-MacBook:ptb hirofumiyashima$ python gentxt.py --model ./result/model_iter_1328 --primetext kind\nkind of mr. <unk> said .the institute tourism on the prospects of the attempt and ballooning as one thatcher is \nHirofumiYashima-no-MacBook:ptb hirofumiyashima$\n```\n\n__\uff08 \u51fa\u529b\u3055\u308c\u305f\u5358\u8a9e\u5217 \uff09__\n\n> kind of mr. <unk> said .the institute tourism on the prospects of the attempt and ballooning as one thatcher is \n\n___\n\n___\n\n##__\u3010 \u5099\u8003 \u3011__\n\n####__\u4ee5\u4e0b\u306e\uff12\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001\u5358\u8a9e\u4e88\u6e2c\u7528\u306ePython\u30b9\u30af\u30ea\u30d7\u30c8 \u3092 \u81ea\u5206\u3067\u5b9f\u88c5\u3057\u3066\u3044\u307e\u3059\u3002__\n\n___\n\n[Hatena::Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d](http://d.hatena.ne.jp/shi3z/20150714/1436832305)\n\n\n[Hatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d](http://ksksksks2.hatenadiary.jp/entry/20160319/1458391617)\n\n___\n\n\n [Hatena**Diary shi3z\u306e\u9577\u6587\u65e5\u8a18\uff082015-07-14\uff09\u300cChainer\u306eptb\u30b5\u30f3\u30d7\u30eb\u3092\u89e3\u8aac\u3057\u3064\u3064\u3001\u81ea\u5206\u306e\u6587\u7ae0\u3092\u6df1\u5c64\u5b66\u7fd2\u3055\u305b\u3066\u3001\u50d5\u306e\u6587\u7ae0\u3063\u307d\u3044\u6587\u3092\u81ea\u52d5\u751f\u6210\u3055\u305b\u3066\u307f\u308b\u300d](http://d.hatena.ne.jp/shi3z/20150714/1436832305)\n\n\n>\u307e\u3042\u3068\u306b\u304b\u304f\u5b66\u7fd2\u304c\u9032\u3093\u3060\u3053\u3068\u3060\u3051\u308f\u304b\u308b\u3002\n>\u3053\u306eptb\u30b5\u30f3\u30d7\u30eb\u306b\u95a2\u3057\u3066\u306f\u5b66\u7fd2\u6e08\u307f\u306e\u30e2\u30c7\u30eb\u3092\u4fdd\u5b58\u3055\u3048\u3057\u306a\u3044\u306e\u3067\u3001\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u3066\u307f\u308b\u3002\n>\n>train_ptb.py\u306e138\u884c\u76ee\u3042\u305f\u308a\u3092\n>\n>```{Python:train_ptb.py}\n>  if (i + 1) % 10000 == 0:\n>        now = time.time()\n>        throuput = 10000. / (now - cur_at)\n>        perp = math.exp(cuda.to_cpu(cur_log_perp) / 10000)\n>        print('iter {} training perplexity: {:.2f} ({:.2f} iters/sec)'.format(\n>            i + 1, perp, throuput))\n>        cur_at = now\n>        cur_log_perp.fill(0)\n>        pickle.dump(model, open('model%04d' % (i+1), 'wb'), -1) #\u3053\u308c\u3092\u8ffd\u52a0\n>```\n>\n>\u3053\u3093\u306a\u611f\u3058\u3067\u6700\u5f8c\u306e\u884c\u3092\u8ffd\u52a0\u3059\u308b\u3002\n>\u3059\u308b\u306810000\u30b9\u30c6\u30c3\u30d7\u3054\u3068\u306b\u30e2\u30c7\u30eb\u3092\u4fdd\u5b58\u3059\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n>\n>\u4fdd\u5b58\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3092\u4f7f\u3063\u3066\u63a8\u5b9a\u3059\u308b\u306b\u306f\u5225\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u66f8\u304f\u5fc5\u8981\u304c\u3042\u308b\u3002\n>\u4eca\u56de\u306f\u3068\u308a\u3042\u3048\u305a\u306e\u7d50\u679c\u3060\u3051\u898b\u305f\u304b\u3063\u305f\u306e\u3067\u3001train_ptb.py\u3092\u6539\u9020\u3057\u3066\u3053\u3093\u306a\u96d1\u306a\u30b3\u30fc\u30c9\u3092\u66f8\u3044\u3066\u307f\u305f\u3002\n>\n>```{Python:Python}\n>\uff08\u524d\u7565\uff09\n>\n># Evaluation routine\n>def evaluate(dataset):\n>    sum_log_perp = mod.zeros(())\n>    state = make_initial_state(batchsize=1, train=False)\n>    data = dataset[101:] #\u9069\u5f53\u306a\u5358\u8a9e\u3092\u9078\u3076\n>    rand = np.random.uniform(0.0, 1.0,dataset.size)\n>    for i in six.moves.range(dataset.size - 1): #\u30eb\u30fc\u30d7\u306e\u6570\u306f\u9069\u5f53\u306a\u306e\u3067\u3068\u308a\u3042\u3048\u305a\u3053\u306e\u307e\u307e\n>        x_batch = data[0:1] #\u6700\u521d\u306e\u5358\u8a9e\u3060\u3051\u3092\u6e21\u3059\n>        print(inv_vocab[x_batch[0]]), #\u9006\u5f15\u304d\u8f9e\u66f8\u3092\u4f7f\u3063\u3066\u5358\u8a9e\u3092\u8868\u793a\n>        state, predict = forward_one_step(x_batch, x_batch, state, train=False)\n>        score = cuda.to_cpu(predict)\n>        top_k=1\n>        prediction = zip(score.data[0].get().tolist(), vocab)\n>        prediction.sort(cmp=lambda x, y: cmp(x[0], y[0]), reverse=True)\n>        m = rand[i] #\u4e71\u6570\n>        total = 0.0\n>        for rank, (score, name) in enumerate(prediction, start=1):\n>            data[0] = vocab[name] #\u6700\u521d\u306e\u5358\u8a9e\u3092\u63a8\u5b9a\u3057\u305f\u5358\u8a9e\u306b\u66f4\u65b0\u3059\u308b\n>            total += score\n>            if total>m : #\u63a8\u5b9a\u3055\u308c\u305f\u5358\u8a9e\u306e\u78ba\u7387\u306b\u3057\u305f\u304c\u3063\u3066\u5358\u8a9e\u3092\u9078\u3076\n>                break\n>    return math.exp(cuda.to_cpu(sum_log_perp) / (dataset.size - 1))\n>\n># Evaluate on test dataset\n>test_perp = evaluate(train_data)\n>```\n>\n>\n>\u4e2d\u8eab\u306f\u307b\u3068\u3093\u3069train_ptb.py\u306e\u307e\u3093\u307e\u306a\u3093\u3060\u3051\u3069\u3001\u9006\u5f15\u304d\u8f9e\u66f8\u3092\u4f5c\u3063\u305f\u308a\u3001\u30e2\u30c7\u30eb\n>\u3092\u8aad\u307f\u8fbc\u3093\u3060\u308a\u3001Softmax_cross_entropy\u3067\u306f\u306a\u304f\u3066Sotfmat\u95a2\u6570\u3092\u4f7f\u3063\u3066\u6b21\u306e\u5358\u8a9e\n>\u3092\u63a8\u5b9a\u3057\u305f\u308a\u3057\u3066\u3001\u6587\u7ae0\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u308b\u3002\n>\n>\u3000\u6700\u521d\u306f\u4e00\u756a\u53ef\u80fd\u6027\u304c\u9ad8\u3044\u5019\u88dc\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u3044\u305f\u3093\u3060\u3051\u3069\u3001\u5802\u3005\u5de1\u308a\u306b\u306a\u3063\u3066\n>\u3068\u3066\u3082\u6587\u7ae0\u3092\u81ea\u52d5\u751f\u6210\u3057\u3066\u308b\u3068\u3044\u3046\u3068\u3053\u308d\u307e\u3067\u3044\u304b\u306a\u304b\u3063\u305f\u3002\u305d\u3053\u3067\u6628\u65e5\u306e\u30cb\u30b3\n>\u751f\u306e\u30b2\u30b9\u30c8\u3060\u3063\u305f\u30c9\u30ef\u30f3\u30b4\u4eba\u5de5\u77e5\u80fd\u7814\u7a76\u6240\u306e\u4e2d\u6751\u3055\u3093\u306b\u805e\u3044\u305f\u3089\u3001\u300c\u4e00\u756a\u4e0a\u306e\u3084>\u3064\u3060\u3051\u306b\u3059\u308b\u3068\u5802\u3005\u5de1\u308a\u306b\u306a\u308b\u306e\u3067\u3001\u78ba\u7387\u5206\u5e03\u306b\u5f93\u3063\u3066\u5358\u8a9e\u9078\u629e\u3059\u3079\u3057\u300d\u3068\u306e\u3053\n>\u3068\u3060\u3063\u305f\u306e\u3067\u3001\u305d\u306e\u3088\u3046\u306b\u3057\u305f\u3002\n\n___\n\n[Hatena Blog \u7d42\u672bA.I.\uff082016-03-19\uff09\u300cChainer \u306e ptb \u30b5\u30f3\u30d7\u30eb\u3067\u904a\u3093\u3067\u307f\u308b\u300d](http://ksksksks2.hatenadiary.jp/entry/20160319/1458391617)\n\n\n>\u4eca\u56de\u306f\u3001\u5b66\u7fd2\u306f\u30ea\u30e2\u30fc\u30c8\u306eGPU\u74b0\u5883\u3001\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u7d50\u679c\u51fa\u529b\u306f\u30ed\u30fc\u30ab\u30eb\u306eCPU\u74b0\u5883\u3067\u884c\u3044\u307e\u3057\u305f\u3002 \u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u306f Chainer 1.7.1 \u306b\u4ed8\u5c5e\u306e\u3082\u306e\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 \u3061\u306a\u307f\u306b\u3001\u7d50\u679c\u51fa\u529b\u7528\u306e\u30b3\u30fc\u30c9\u306f\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n>\n>```{Python:Python}\n>\uff08\u524d\u7565\uff09\n>\n>for i in six.moves.range(10):\n>    data = test_data[i:i+1]\n> print(inv_vocab[data[0]])\n>\n> x = chainer.Variable(data, volatile=False)\n> h0 = model.predictor.embed(x)\n> h1 = model.predictor.l1(h0)\n> h2 = model.predictor.l2(h1)\n> y = model.predictor.l3(h2)\n>\n> # \u51fa\u529b\u7d50\u679c\u306e\u3046\u3061\u4e0a\u4f4d3\u500b\u3092\u51fa\u529b\n> prediction = list(zip(y.data[0].tolist(), inv_vocab.values()))\n> prediction.sort()\n> prediction.reverse()\n>\n> for i, (score, word) in enumerate(prediction):\n>       print('{},{}'.format(word, score))\n>       if i >= 2: break\n>\n>```\n>\n>\u4e0a\u3067\u66f8\u3044\u305f\u3088\u3046\u306b\u3001RNN\u306e\u5b66\u7fd2\u306f\u305d\u308c\u307e\u3067\u306b\u3069\u3093\u306a\u5024\u3092\u5165\u529b\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u3067\u5909\u5316\u3057\u307e\n>\u3059\u3002 \u4eca\u56de\u306f\u3001\u30b5\u30f3\u30d7\u30eb\u306e\u30c6\u30b9\u30c8\u7528\u30c7\u30fc\u30bf\u5185\u306e\u300cno it was n't black monday\u300d\u3068\u3044\u3046\u6587\u3092\n>\u4f7f\u7528\u3057\u3066\u3001\u6bce\u56deLSTM\u5c64\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u305f\u6587\u8108\u3092\u7121\u8996\u3057\u305f\u5834\u5408\u3068\u3001\u6700\u521d\u306e\u5358\n>\u8a9e\u306e\u6642\u306e\u307fLSTM\u5c64\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u30ea\u30bb\u30c3\u30c8\u3057\u305f\u6587\u8108\u3092\u8003\u616e\u3057\u305f\u5834\u5408\u3067\u305d\u308c\u305e\u308c\u7d50\u679c\u3092\u6bd4\n>\u3079\u3066\u307f\u307e\u3057\u305f\u3002\n", "tags": ["DeepLearning", "\u30c7\u30a3\u30fc\u30d7\u30e9\u30fc\u30cb\u30f3\u30b0", "NLP", "\u81ea\u7136\u8a00\u8a9e\u51e6\u7406", "Chainer"]}