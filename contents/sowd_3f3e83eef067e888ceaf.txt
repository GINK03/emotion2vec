{"context": "\n\n\u6982\u8981\n\u4ee5\u4e0b\u306e\u4f5c\u696d\u306e\u307f\u5b9f\u65bd\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3001OS\u30e6\u30fc\u30b6\"oramnt\"\u3068Oracle\u30e6\u30fc\u30b6\"ops$oramnt\"\u3092\u4f5c\u6210\u3059\u308b\u3002\n\nOS\u30e6\u30fc\u30b6oramnt\u304c\u4f7f\u7528\u3067\u304d\u308bOS\u30b3\u30de\u30f3\u30c9\u306f\u300csqlplus\u300d\u300cexit\u300d\u306e\u307f\u3002\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u306f\u6975\u529b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u8a2d\u5b9a\u3002\nOS\u30e6\u30fc\u30b6oramnt\u306f\u3001oracle\u306bsqlplus\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u3092\u53d6\u5f97\u51fa\u6765\u308b\u3002\nOS\u30e6\u30fc\u30b6oramnt\u306f\u3001cron\u3067\u5b9a\u671f\u7684\u306b\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u3092\u53d6\u5f97\u3059\u308b\u3002\nOracle\u30e6\u30fc\u30b6ops$oramnt\u306f\u3001\u300c\u63a5\u7d9a\u300d\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u306e\u53d6\u5f97\u300d\u4ee5\u5916\u306f\u4f55\u3082\u3067\u304d\u306a\u3044\u3002\n\n\n\u5185\u5bb9\n\nOS\u3068Oracle\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3068\u3059\u308b\u3002\n\u5236\u9650\u4ed8\u304d\u306ebash\"rbash\"\u3092\u4f7f\u7528\u3059\u308b\u3002\nbash\u306e\u88dc\u5b8c\u6a5f\u80fd\u306f\u7121\u52b9\u306b\u3059\u308b\u3002\n.bash_profile\u3001.inputrc\u306froot\u304c\u4fdd\u6301\u3057\u3001oramnt\u30e6\u30fc\u30b6\u304c\u66f4\u65b0\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\noramnt\u30e6\u30fc\u30b6\u306b\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u306f\"/home/oramnt/bin\"\u306b\u914d\u7f6e\u3059\u308b\u3002\n\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3059\u308b\u304b\u3001\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u914d\u7f6e\u3059\u308b\u3002\n\"/home/oramnt/bin\"\u306b\u914d\u7f6e\u3057\u305f\u30b3\u30de\u30f3\u30c9\u4ee5\u5916\u306f\u3001\u6975\u529b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\noracle\u3078\u306e\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u306fOS_AUTHENT_PREFIX\u3092\u4f7f\u7528\u3057\u305f\u5916\u90e8\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u3002\n(\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u3092\u60f3\u5b9a)\nOS_AUTHENT_PREFIX\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306eops$\u3092\u4f7f\u7528\u3057\u3001ops$oramnt\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\n\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u306f\u30d3\u30e5\u30fc\u3092\u4f5c\u6210\u3057\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n\u6240\u6709\u8005\u306fsys\u3068\u3057\u3001\u30d3\u30e5\u30fc\u540d\u306f\u4ee5\u4e0b\u3068\u3059\u308b\u3002\n\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831 \u2192 view_sinfo\n\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf \u2192 view_dinfo\n\u203b\u4eca\u56de\u306f\u624b\u9593\u3092\u7701\u304f\u305f\u3081sys\u30b9\u30ad\u30fc\u30de\u306b\u4f5c\u6210\u3057\u3066\u3044\u308b\u304c\u3001\u901a\u5e38\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002\nops$oramnt\u306f\u3001view_sinfo/view_dinfo\u306eselect\u306e\u307f\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n\n\u74b0\u5883\u69cb\u6210\n\u25bc OS\n$ cat /etc/redhat-release\nRed Hat Enterprise Linux Server release 6.4 (Santiago)\n\n\u25bc Oracle\nSQL> select * from V$VERSION;\nOracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production\nPL/SQL Release 11.2.0.4.0 - Production\nCORE    11.2.0.4.0      Production\nTNS for Linux: Version 11.2.0.4.0 - Production\nNLSRTL Version 11.2.0.4.0 - Production\n\n\n\n\u624b\u9806\n\nOS\u30e6\u30fc\u30b6\u300coramnt\u300d\u4f5c\u6210\nsu -\n\n# \u30e6\u30fc\u30b6\u4f5c\u6210\nuseradd oramnt\npasswd oramnt\n\n# \u5236\u9650\u4ed8\u304d\u30b7\u30a7\u30eb\u306e\u8a2d\u5b9a\n# \u203b bash\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\"rbash\"\u3092\u4f5c\u6210\u3057\u8d77\u52d5\u3059\u308b\u3068\u3001\u5236\u9650\u4ed8\u304d\u306e\u30b7\u30a7\u30eb\u306b\u306a\u308b\nln -s /bin/bash /bin/rbash\nvi /etc/shells\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# /bin/rbash\n# #-------------------\n\n# oramnt\u30e6\u30fc\u30b6\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a2d\u5b9a\nsu - oramnt\nchsh\n# oramnt \u306e\u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n# \u30d1\u30b9\u30ef\u30fc\u30c9:\n# \u65b0\u3057\u3044\u30b7\u30a7\u30eb [/bin/bash]: /bin/rbash\n# \u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\nexit\n\n# oramnt\u30e6\u30fc\u30b6\u306e\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nmkdir /home/oramnt/bin\n\n# .bash_profile\u306e\u8a2d\u5b9a\n# .bash_profile\u3092root\u306b\u5909\u66f4\u3002oramnt\u30e6\u30fc\u30b6\u304c\u5909\u66f4\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\nchown root:root /home/oramnt/.bash_profile\nls -l /home/oramnt/.bash_profile\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# umask 077                     # \u6240\u6709\u8005\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n# export PATH=/home/oramnt/bin  # \u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u7f6e\n# #-------------------\n\n# bash\u306e\u88dc\u5b8c\u6a5f\u80fd\u3092\u7121\u52b9\u306b\u3059\u308b\u3002\nvi /home/oramnt/.inputrc\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# set disable-completion on\n# #-------------------\nchown root:root /home/oramnt/.inputrc\nls -l /home/oramnt/.inputrc\n\n\u25bc bash\u306e\u30d3\u30eb\u30c9\u30a4\u30f3\u30b3\u30de\u30f3\u30c9\u3092\u7121\u52b9\u5316\u3059\u308b\u3002\n# help\u30b3\u30de\u30f3\u30c9\u3067\u5185\u90e8\u30b3\u30de\u30f3\u30c9\u3092\u78ba\u8a8d\u3057\u3001enable\u30b3\u30de\u30f3\u30c9\u3067\u7121\u52b9\u5316\u3059\u308b\u3002\n# \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u7121\u52b9\u5316\u3057\u306a\u3044\u3002\n# - exit\n# - echo,printf (rbash\u306e\u52d5\u4f5c\u304c\u304a\u304b\u3057\u304f\u306a\u308b)\n# - enable\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30a8\u30e9\u30fc \"-rbash: enable: *******: not a shell builtin\"\u304c\u51fa\u308b\u30b3\u30de\u30f3\u30c9\n# enable\u30b3\u30de\u30f3\u30c9\u306e\u7121\u52b9\u5316\u306f\u6700\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3002 \u203benable\u30b3\u30de\u30f3\u30c9\u306frbash\u3067\u5b9f\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u7121\u52b9\u5316\u3057\u306a\u304f\u3066\u3082\u554f\u984c\u306a\u3044)\n\nsu -\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# enable -n alias\n# enable -n bg\n# enable -n bind\n# enable -n break\n# enable -n builtin\n# enable -n caller\n# enable -n cd\n# enable -n command\n# enable -n compgen\n# enable -n complete\n# enable -n compopt\n# enable -n continue\n# enable -n declare\n# enable -n dirs\n# enable -n disown\n# enable -n eval\n# enable -n exec\n# enable -n export\n# enable -n fc\n# enable -n fg\n# enable -n getopts\n# enable -n hash\n# enable -n help\n# enable -n history\n# enable -n jobs\n# enable -n kill\n# enable -n let\n# enable -n local\n# enable -n logout\n# enable -n mapfile\n# enable -n popd\n# enable -n pushd\n# enable -n pwd\n# enable -n read\n# enable -n readarray\n# enable -n readonly\n# enable -n return\n# enable -n set\n# enable -n shift\n# enable -n shopt\n# enable -n source\n# enable -n suspend\n# enable -n test\n# enable -n times\n# enable -n trap\n# enable -n type\n# enable -n typeset\n# enable -n ulimit\n# enable -n umask\n# enable -n unalias\n# enable -n unset\n# enable -n wait\n# enable -n enable\n# #-------------------\n\n# \u52d5\u4f5c\u78ba\u8a8d\nsu - oramnt\n\n# \u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\nls    \n# -rbash: ls: \u30b3\u30de\u30f3\u30c9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\n\n# \u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\nkill  \n# -rbash: kill: \u30b3\u30de\u30f3\u30c9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\n\n\nOracle\u95a2\u9023\u306e\u8a2d\u5b9a\n\u25bc \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7528Oracle\u30e6\u30fc\u30b6\u300cops$oramnt\u300d\u306e\u4f5c\u6210\nsu - oracle\n\n-- view\u306e\u4f5c\u6210\nsqlplus / as sysdba\ncreate view view_sinfo as select sid,serial#,username,osuser,program,machine from v$session where type = 'USER';\ncreate view view_dinfo as\nWITH\nT AS (\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_DATA_FILES GROUP BY TABLESPACE_NAME\n  UNION ALL\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_TEMP_FILES GROUP BY TABLESPACE_NAME) ,\nF AS (\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_FREE_SPACE GROUP BY TABLESPACE_NAME\n  UNION ALL\n  SELECT TABLESPACE_NAME, SUM(BYTES_FREE)/1024/1024 \"MBYTES\" FROM V$TEMP_SPACE_HEADER GROUP BY TABLESPACE_NAME)\nSELECT\n  T.TABLESPACE_NAME          \"TABLESPACE_NAME\",\n  TRUNC(T.MBYTES,1)          \"TOTAL (MB)\",\n  TRUNC(NVL(F.MBYTES, 0),1)  \"FREE (MB)\",\n  TRUNC(DECODE(T.MBYTES, 0 , 0, (1-NVL(F.MBYTES,0)/T.MBYTES)*100),1) \"USED (%)\"\nFROM T, F\nWHERE T.TABLESPACE_NAME = F.TABLESPACE_NAME (+)\nORDER BY T.TABLESPACE_NAME;\n\nselect * from view_sinfo;\nselect * from view_dinfo;\n\n\n-- \u30e1\u30f3\u30c6\u7528\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n-- os_authent_prefix\u30d1\u30e9\u30e1\u30fc\u30bf\u78ba\u8a8d\nshow parameter os_authent_prefix\n-- ops$\n\n-- \u30e6\u30fc\u30b6\u4f5c\u6210\ncreate user ops$oramnt identified externally;\ngrant create session to ops$oramnt;\ngrant select on sys.view_sinfo to ops$oramnt;\ngrant select on sys.view_dinfo to ops$oramnt;\nexit\n\n\n\u25bc sqlplus\u63a5\u7d9a\u8a2d\u5b9a\nsu -\n# sqlplus\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b/home/oramnt/bin\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u914d\u7f6e\u3002\nln -s /u01/app/oracle/product/11.2.0/dbhome_1/bin/sqlplus /home/oramnt/bin/sqlplus\n\n# .bash_profile\u306boracle\u74b0\u5883\u8a2d\u5b9a\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\uff08\u74b0\u5883\u306b\u5408\u308f\u305b\u308b\uff09\n# #-------------------\n# export ORACLE_BASE=/u01/app/oracle\n# export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1\n# export ORACLE_SID=TEST01\n# export LANG=ja_JP.UTF-8\n# #-------------------\n\n# \u52d5\u4f5c\u78ba\u8a8d\nsu - oramnt\necho \"select * from sys.view_sinfo;\" | sqlplus -S /\necho \"select * from sys.view_dinfo;\" | sqlplus -S /\nexit\n\n\n\n\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9a\u671f\u7684\u5b9f\u884c\u8a2d\u5b9a\n\u25bcOracle\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\nsu -\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\nvi /home/oramnt/bin/orainf.sh\n# \u4ee5\u4e0b\u3092\u8a18\u8f09\u3059\u308b\u3002\n# #-------------------\n# #!/bin/sh\n# echo \"select * from sys.view_sinfo;\" | sqlplus -S /\n# echo \"select * from sys.view_dinfo;\" | sqlplus -S /\n# #-------------------\n\n# \u30d5\u30a1\u30a4\u30eb\u306e\u6a29\u9650\u5909\u66f4\nchmod 700 /home/oramnt/bin/orainf.sh\nchown oramnt:oramnt /home/oramnt/bin/orainf.sh\n# \u78ba\u8a8d\nls -l /home/oramnt/bin/orainf.sh\n\nsu - oramnt\norainf.sh\nexit\n\n\u25bccron\u3078\u306e\u767b\u9332(root\u30e6\u30fc\u30b6\u3067\u5b9f\u65bd)\n\u4eca\u56de\u306f1\u5206\u6bce\u306borainf.sh\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\nsu -\n\n# oramnt\u30e6\u30fc\u30b6\u306ecron\u306b\u767b\u9332\ncrontab -u oramnt -e\n# \u4ee5\u4e0b\u3092\u8ffd\u52a0\n# # -------------------\n# */1 * * * * orainf.sh > orainf.log\n# # -------------------\n\n# \u767b\u9332\u5185\u5bb9\u306e\u78ba\u8a8d\ncrontab -u oramnt -l\n\n# \u52d5\u4f5c\u78ba\u8a8d\n# 1\u5206\u6bce\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\nls -l /home/oramnt/orainf.log\ncat /home/oramnt/orainf.log\n\n\n## \u6982\u8981\n\u4ee5\u4e0b\u306e\u4f5c\u696d\u306e\u307f\u5b9f\u65bd\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3001OS\u30e6\u30fc\u30b6\"oramnt\"\u3068Oracle\u30e6\u30fc\u30b6\"ops$oramnt\"\u3092\u4f5c\u6210\u3059\u308b\u3002\n\n- OS\u30e6\u30fc\u30b6oramnt\u304c\u4f7f\u7528\u3067\u304d\u308bOS\u30b3\u30de\u30f3\u30c9\u306f\u300csqlplus\u300d\u300cexit\u300d\u306e\u307f\u3002\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u306f\u6975\u529b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u8a2d\u5b9a\u3002\n- OS\u30e6\u30fc\u30b6oramnt\u306f\u3001oracle\u306bsqlplus\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3001\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u3092\u53d6\u5f97\u51fa\u6765\u308b\u3002\n- OS\u30e6\u30fc\u30b6oramnt\u306f\u3001cron\u3067\u5b9a\u671f\u7684\u306b\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u3092\u53d6\u5f97\u3059\u308b\u3002\n- Oracle\u30e6\u30fc\u30b6ops$oramnt\u306f\u3001\u300c\u63a5\u7d9a\u300d\u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u306e\u53d6\u5f97\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u306e\u53d6\u5f97\u300d\u4ee5\u5916\u306f\u4f55\u3082\u3067\u304d\u306a\u3044\u3002\n\n## \u5185\u5bb9\n\n- OS\u3068Oracle\u306f\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6e08\u307f\u3068\u3059\u308b\u3002\n- \u5236\u9650\u4ed8\u304d\u306ebash\"rbash\"\u3092\u4f7f\u7528\u3059\u308b\u3002\n- bash\u306e\u88dc\u5b8c\u6a5f\u80fd\u306f\u7121\u52b9\u306b\u3059\u308b\u3002\n- .bash_profile\u3001.inputrc\u306froot\u304c\u4fdd\u6301\u3057\u3001oramnt\u30e6\u30fc\u30b6\u304c\u66f4\u65b0\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u3002\n- oramnt\u30e6\u30fc\u30b6\u306b\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u306f\"/home/oramnt/bin\"\u306b\u914d\u7f6e\u3059\u308b\u3002<br>\n  \u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u4f5c\u6210\u3059\u308b\u304b\u3001\u5b9f\u884c\u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u914d\u7f6e\u3059\u308b\u3002\n- \"/home/oramnt/bin\"\u306b\u914d\u7f6e\u3057\u305f\u30b3\u30de\u30f3\u30c9\u4ee5\u5916\u306f\u3001\u6975\u529b\u4f7f\u7528\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\n- oracle\u3078\u306e\u30ed\u30b0\u30a4\u30f3\u8a8d\u8a3c\u306fOS_AUTHENT_PREFIX\u3092\u4f7f\u7528\u3057\u305f\u5916\u90e8\u8a8d\u8a3c\u3092\u4f7f\u7528\u3059\u308b\u3002<br>\n    (\u30d1\u30b9\u30ef\u30fc\u30c9\u306a\u3057\u3067\u306e\u30ed\u30b0\u30a4\u30f3\u3092\u60f3\u5b9a)<br>\n  OS_AUTHENT_PREFIX\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u306eops\\$\u3092\u4f7f\u7528\u3057\u3001ops$oramnt\u30e6\u30fc\u30b6\u3092\u4f5c\u6210\u3059\u308b\u3002\n- \u300c\u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831\u300d\u300c\u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf\u300d\u306f\u30d3\u30e5\u30fc\u3092\u4f5c\u6210\u3057\u53d6\u5f97\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3002\n    \u6240\u6709\u8005\u306fsys\u3068\u3057\u3001\u30d3\u30e5\u30fc\u540d\u306f\u4ee5\u4e0b\u3068\u3059\u308b\u3002\n    \u30bb\u30c3\u30b7\u30e7\u30f3\u60c5\u5831 \u2192 view_sinfo\n    \u8868\u9818\u57df\u306e\u4f7f\u7528\u91cf \u2192 view_dinfo\n    \u203b\u4eca\u56de\u306f\u624b\u9593\u3092\u7701\u304f\u305f\u3081sys\u30b9\u30ad\u30fc\u30de\u306b\u4f5c\u6210\u3057\u3066\u3044\u308b\u304c\u3001\u901a\u5e38\u306f\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u3092\u3057\u3066\u306f\u3044\u3051\u306a\u3044\u3002\n\n- ops$oramnt\u306f\u3001view_sinfo/view_dinfo\u306eselect\u306e\u307f\u5b9f\u884c\u3067\u304d\u308b\u3002\n\n## \u74b0\u5883\u69cb\u6210\n\n\u25bc OS\n\n```bash:\n$ cat /etc/redhat-release\nRed Hat Enterprise Linux Server release 6.4 (Santiago)\n```\n\n\u25bc Oracle\n\n```sql:\nSQL> select * from V$VERSION;\nOracle Database 11g Enterprise Edition Release 11.2.0.4.0 - 64bit Production\nPL/SQL Release 11.2.0.4.0 - Production\nCORE    11.2.0.4.0      Production\nTNS for Linux: Version 11.2.0.4.0 - Production\nNLSRTL Version 11.2.0.4.0 - Production\n\n```\n\n\n## \u624b\u9806\n### OS\u30e6\u30fc\u30b6\u300coramnt\u300d\u4f5c\u6210\n\n```bash:\nsu -\n\n# \u30e6\u30fc\u30b6\u4f5c\u6210\nuseradd oramnt\npasswd oramnt\n\n# \u5236\u9650\u4ed8\u304d\u30b7\u30a7\u30eb\u306e\u8a2d\u5b9a\n# \u203b bash\u306e\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\"rbash\"\u3092\u4f5c\u6210\u3057\u8d77\u52d5\u3059\u308b\u3068\u3001\u5236\u9650\u4ed8\u304d\u306e\u30b7\u30a7\u30eb\u306b\u306a\u308b\nln -s /bin/bash /bin/rbash\nvi /etc/shells\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# /bin/rbash\n# #-------------------\n\n# oramnt\u30e6\u30fc\u30b6\u306b\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a2d\u5b9a\nsu - oramnt\nchsh\n# oramnt \u306e\u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n# \u30d1\u30b9\u30ef\u30fc\u30c9:\n# \u65b0\u3057\u3044\u30b7\u30a7\u30eb [/bin/bash]: /bin/rbash\n# \u30b7\u30a7\u30eb\u3092\u5909\u66f4\u3057\u307e\u3057\u305f\u3002\nexit\n\n# oramnt\u30e6\u30fc\u30b6\u306e\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u7f6e\u3059\u308b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\nmkdir /home/oramnt/bin\n\n# .bash_profile\u306e\u8a2d\u5b9a\n# .bash_profile\u3092root\u306b\u5909\u66f4\u3002oramnt\u30e6\u30fc\u30b6\u304c\u5909\u66f4\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u8a2d\u5b9a\u3059\u308b\u3002\nchown root:root /home/oramnt/.bash_profile\nls -l /home/oramnt/.bash_profile\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# umask 077                     # \u6240\u6709\u8005\u306e\u307f\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\n# export PATH=/home/oramnt/bin  # \u3053\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u5b9f\u884c\u3092\u8a31\u53ef\u3059\u308b\u30b3\u30de\u30f3\u30c9\u3092\u914d\u7f6e\n# #-------------------\n\n# bash\u306e\u88dc\u5b8c\u6a5f\u80fd\u3092\u7121\u52b9\u306b\u3059\u308b\u3002\nvi /home/oramnt/.inputrc\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# set disable-completion on\n# #-------------------\nchown root:root /home/oramnt/.inputrc\nls -l /home/oramnt/.inputrc\n```\n\n\u25bc bash\u306e\u30d3\u30eb\u30c9\u30a4\u30f3\u30b3\u30de\u30f3\u30c9\u3092\u7121\u52b9\u5316\u3059\u308b\u3002\n\n``` bash:\n# help\u30b3\u30de\u30f3\u30c9\u3067\u5185\u90e8\u30b3\u30de\u30f3\u30c9\u3092\u78ba\u8a8d\u3057\u3001enable\u30b3\u30de\u30f3\u30c9\u3067\u7121\u52b9\u5316\u3059\u308b\u3002\n# \u4ee5\u4e0b\u306e\u30b3\u30de\u30f3\u30c9\u306f\u7121\u52b9\u5316\u3057\u306a\u3044\u3002\n# - exit\n# - echo,printf (rbash\u306e\u52d5\u4f5c\u304c\u304a\u304b\u3057\u304f\u306a\u308b)\n# - enable\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u30a8\u30e9\u30fc \"-rbash: enable: *******: not a shell builtin\"\u304c\u51fa\u308b\u30b3\u30de\u30f3\u30c9\n# enable\u30b3\u30de\u30f3\u30c9\u306e\u7121\u52b9\u5316\u306f\u6700\u5f8c\u306b\u5b9f\u884c\u3059\u308b\u3002 \u203benable\u30b3\u30de\u30f3\u30c9\u306frbash\u3067\u5b9f\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u7121\u52b9\u5316\u3057\u306a\u304f\u3066\u3082\u554f\u984c\u306a\u3044)\n\nsu -\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\n# #-------------------\n# enable -n alias\n# enable -n bg\n# enable -n bind\n# enable -n break\n# enable -n builtin\n# enable -n caller\n# enable -n cd\n# enable -n command\n# enable -n compgen\n# enable -n complete\n# enable -n compopt\n# enable -n continue\n# enable -n declare\n# enable -n dirs\n# enable -n disown\n# enable -n eval\n# enable -n exec\n# enable -n export\n# enable -n fc\n# enable -n fg\n# enable -n getopts\n# enable -n hash\n# enable -n help\n# enable -n history\n# enable -n jobs\n# enable -n kill\n# enable -n let\n# enable -n local\n# enable -n logout\n# enable -n mapfile\n# enable -n popd\n# enable -n pushd\n# enable -n pwd\n# enable -n read\n# enable -n readarray\n# enable -n readonly\n# enable -n return\n# enable -n set\n# enable -n shift\n# enable -n shopt\n# enable -n source\n# enable -n suspend\n# enable -n test\n# enable -n times\n# enable -n trap\n# enable -n type\n# enable -n typeset\n# enable -n ulimit\n# enable -n umask\n# enable -n unalias\n# enable -n unset\n# enable -n wait\n# enable -n enable\n# #-------------------\n\n# \u52d5\u4f5c\u78ba\u8a8d\nsu - oramnt\n\n# \u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\nls    \n# -rbash: ls: \u30b3\u30de\u30f3\u30c9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\n\n# \u5b9f\u884c\u3067\u304d\u306a\u3044\u3053\u3068\u3092\u78ba\u8a8d\nkill  \n# -rbash: kill: \u30b3\u30de\u30f3\u30c9\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\n```\n\n### Oracle\u95a2\u9023\u306e\u8a2d\u5b9a\n\n\u25bc \u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u7528Oracle\u30e6\u30fc\u30b6\u300cops$oramnt\u300d\u306e\u4f5c\u6210\n\n``` sql:\nsu - oracle\n\n-- view\u306e\u4f5c\u6210\nsqlplus / as sysdba\ncreate view view_sinfo as select sid,serial#,username,osuser,program,machine from v$session where type = 'USER';\ncreate view view_dinfo as\nWITH\nT AS (\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_DATA_FILES GROUP BY TABLESPACE_NAME\n  UNION ALL\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_TEMP_FILES GROUP BY TABLESPACE_NAME) ,\nF AS (\n  SELECT TABLESPACE_NAME, SUM(BYTES)/1024/1024 \"MBYTES\" FROM DBA_FREE_SPACE GROUP BY TABLESPACE_NAME\n  UNION ALL\n  SELECT TABLESPACE_NAME, SUM(BYTES_FREE)/1024/1024 \"MBYTES\" FROM V$TEMP_SPACE_HEADER GROUP BY TABLESPACE_NAME)\nSELECT\n  T.TABLESPACE_NAME          \"TABLESPACE_NAME\",\n  TRUNC(T.MBYTES,1)          \"TOTAL (MB)\",\n  TRUNC(NVL(F.MBYTES, 0),1)  \"FREE (MB)\",\n  TRUNC(DECODE(T.MBYTES, 0 , 0, (1-NVL(F.MBYTES,0)/T.MBYTES)*100),1) \"USED (%)\"\nFROM T, F\nWHERE T.TABLESPACE_NAME = F.TABLESPACE_NAME (+)\nORDER BY T.TABLESPACE_NAME;\n\nselect * from view_sinfo;\nselect * from view_dinfo;\n\n\n-- \u30e1\u30f3\u30c6\u7528\u30e6\u30fc\u30b6\u306e\u4f5c\u6210\n-- os_authent_prefix\u30d1\u30e9\u30e1\u30fc\u30bf\u78ba\u8a8d\nshow parameter os_authent_prefix\n-- ops$\n\n-- \u30e6\u30fc\u30b6\u4f5c\u6210\ncreate user ops$oramnt identified externally;\ngrant create session to ops$oramnt;\ngrant select on sys.view_sinfo to ops$oramnt;\ngrant select on sys.view_dinfo to ops$oramnt;\nexit\n\n```\n\n\u25bc sqlplus\u63a5\u7d9a\u8a2d\u5b9a\n\n``` bash:\nsu -\n# sqlplus\u3092\u5b9f\u884c\u3067\u304d\u308b\u3088\u3046\u306b/home/oramnt/bin\u306b\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u30ea\u30f3\u30af\u3092\u914d\u7f6e\u3002\nln -s /u01/app/oracle/product/11.2.0/dbhome_1/bin/sqlplus /home/oramnt/bin/sqlplus\n\n# .bash_profile\u306boracle\u74b0\u5883\u8a2d\u5b9a\nvi /home/oramnt/.bash_profile\n# \u4ee5\u4e0b\u3092\u8ffd\u8a18\u3059\u308b\u3002\uff08\u74b0\u5883\u306b\u5408\u308f\u305b\u308b\uff09\n# #-------------------\n# export ORACLE_BASE=/u01/app/oracle\n# export ORACLE_HOME=$ORACLE_BASE/product/11.2.0/dbhome_1\n# export ORACLE_SID=TEST01\n# export LANG=ja_JP.UTF-8\n# #-------------------\n\n# \u52d5\u4f5c\u78ba\u8a8d\nsu - oramnt\necho \"select * from sys.view_sinfo;\" | sqlplus -S /\necho \"select * from sys.view_dinfo;\" | sqlplus -S /\nexit\n\n```\n\n### \u30b9\u30af\u30ea\u30d7\u30c8\u306e\u5b9a\u671f\u7684\u5b9f\u884c\u8a2d\u5b9a\n\n\u25bcOracle\u304b\u3089\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n``` bash:\nsu -\n\n# \u30b9\u30af\u30ea\u30d7\u30c8\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\nvi /home/oramnt/bin/orainf.sh\n# \u4ee5\u4e0b\u3092\u8a18\u8f09\u3059\u308b\u3002\n# #-------------------\n# #!/bin/sh\n# echo \"select * from sys.view_sinfo;\" | sqlplus -S /\n# echo \"select * from sys.view_dinfo;\" | sqlplus -S /\n# #-------------------\n\n# \u30d5\u30a1\u30a4\u30eb\u306e\u6a29\u9650\u5909\u66f4\nchmod 700 /home/oramnt/bin/orainf.sh\nchown oramnt:oramnt /home/oramnt/bin/orainf.sh\n# \u78ba\u8a8d\nls -l /home/oramnt/bin/orainf.sh\n\nsu - oramnt\norainf.sh\nexit\n```\n\n\u25bccron\u3078\u306e\u767b\u9332(root\u30e6\u30fc\u30b6\u3067\u5b9f\u65bd)\n\u4eca\u56de\u306f1\u5206\u6bce\u306borainf.sh\u3092\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u8a2d\u5b9a\u3002\n\n``` bash:\nsu -\n\n# oramnt\u30e6\u30fc\u30b6\u306ecron\u306b\u767b\u9332\ncrontab -u oramnt -e\n# \u4ee5\u4e0b\u3092\u8ffd\u52a0\n# # -------------------\n# */1 * * * * orainf.sh > orainf.log\n# # -------------------\n\n# \u767b\u9332\u5185\u5bb9\u306e\u78ba\u8a8d\ncrontab -u oramnt -l\n\n# \u52d5\u4f5c\u78ba\u8a8d\n# 1\u5206\u6bce\u306b\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\nls -l /home/oramnt/orainf.log\ncat /home/oramnt/orainf.log\n```\n", "tags": ["Linux", "oracle", "Sqlplus", "Security"]}