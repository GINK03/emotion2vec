{"context": "\n\n\u524d\u63d0\u6761\u4ef6\n\nRDS\u3078\u306e\u6a29\u9650\n\u4ee5\u4e0b\u306e\u6a29\u9650\u3067\u3042\u308b\u3053\u3068\n\n\u30dd\u30ea\u30b7\u30fc\n{\n         \"GroupName\": \"rdsFull\", \n         \"PolicyDocument\": {\n             \"Version\": \"2012-10-17\", \n             \"Statement\": [\n                 {\n                     \"Action\": [\n                         \"rds:*\", \n                         \"cloudwatch:DescribeAlarms\", \n                         \"cloudwatch:GetMetricStatistics\", \n                         \"ec2:AuthorizeSecurityGroupIngress\",\n                         \"ec2:CreateSecurityGroup\",\n                         \"ec2:DeleteSecurityGroup\",\n                         \"ec2:DescribeAccountAttributes\", \n                         \"ec2:DescribeAvailabilityZones\", \n                         \"ec2:DescribeSecurityGroups\", \n                         \"ec2:DescribeSubnets\", \n                         \"ec2:DescribeVpcs\", \n                         \"sns:ListSubscriptions\", \n                         \"sns:ListTopics\"\n                     ], \n                     \"Resource\": \"*\", \n                     \"Effect\": \"Allow\"\n                 }\n             ]\n         }, \n         \"PolicyName\": \"rdsFull-prj04\"\n     }\n\n\n\n\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u306e\u5b58\u5728\n\n\u30b3\u30de\u30f3\u30c9\nVPC_ID=`aws ec2 describe-vpcs --filters Name=isDefault,Values=true --query 'Vpcs[].VpcId' --output text` \\\n        && echo ${VPC_ID}\n\n\n\n\u7d50\u679c(\u4f8b)\nvpc-xxxxxxxx\n\n\n\nAWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n\u30b3\u30de\u30f3\u30c9\naws --version\n\n\n\n\u7d50\u679c(\u4f8b)\naws-cli/1.7.42 Python/2.7.5 Linux/3.10.0-123.el7.x86_64\n\n\n\nmysql 5.6\u30ea\u30dd\u30b8\u30c8\u30ea\u5c0e\u5165\n\n\u30b3\u30de\u30f3\u30c9\nyum install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n\n\n\nmysql client\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n\u30b3\u30de\u30f3\u30c9\nyum install mysql-community-client\n\n\n\nmysql\u30b3\u30de\u30f3\u30c9\n\n\u30b3\u30de\u30f3\u30c9\nwhich mysql\n\n\n\n\u7d50\u679c(\u5b58\u5728\u3059\u308b\u5834\u5408\u306e\u4f8b)\n/usr/bin/mysql\n\n\n\n\u7d50\u679c(\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306e\u4f8b)\n/usr/bin/which: no mysql in (/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/hiruta/.local/bin:/home/hiruta/bin)\n\n\n\n0.\u6e96\u5099\n\n\u30b3\u30de\u30f3\u30c9\nAWS_DEFAULT_REGION='us-west-2'\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws configure list\n\n\n\n\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************33RQ shared-credentials-file\nsecret_key     ****************X9G/ shared-credentials-file\n\n\n\n1.\u4e8b\u524d\u4f5c\u696d\n\n1.1. VPC Security Group\u306e\u540d\u79f0\u3068\u8aac\u660e\u306e\u6c7a\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nVPC_SG_NAME='rds-mysql-inbound'\nVPC_SG_DESC='RDS MySQL inbound'\n\n\n\n1.2. VPC Security Group\u306e\u8a2d\u5b9a\u5185\u5bb9\u6c7a\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\nVPC_SG_PROTOCOL='tcp'\nVPC_SG_PORT='3306'\nVPC_SG_CIDR='0.0.0.0/0'\n\n\n\nVPC Security Group\u306e\u4e0d\u5b58\u5728\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-names ${VPC_SG_NAME}\n\n\n\n\u7d50\u679c\nA client error (InvalidGroup.NotFound) occurred when calling the DescribeSecurityGroups operation: The security group 'rds-posgre-inbound' does not exist in default VPC 'vpc-xxxxxxxx'\n\n\n\n1.4. VPC Security Group\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n        VPC_SG_NAME: ${VPC_SG_NAME}\n        VPC_SG_DESC: \"${VPC_SG_DESC}\"\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 create-security-group \\\n        --group-name ${VPC_SG_NAME} \\\n        --description \"${VPC_SG_DESC}\"\n\n\n\n\u7d50\u679c\n {\n          \"GroupId\": \"sg-xxxxxxxx\"\n      }\n\n\n\n1.5. VPC Security Group\u306e\u5b58\u5728\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-names ${VPC_SG_NAME}\n\n\n\n\u7d50\u679c\n{\n        \"SecurityGroups\": [\n          {\n              \"Description\": \"RDS MySQL inbound\",\n              \"GroupName\": \"rds-mysql-inbound\",\n              \"VpcId\": \"vpc-xxxxxxxx\",\n              \"OwnerId\": \"XXXXXXXXXXXX\",\n              \"GroupId\": \"sg-xxxxxxxx\"\n          }\n        ]\n      }\n\n\n\n1.7. \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u306e\u8a2d\u5b9a\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n      VPC_SG_PROTOCOL: ${VPC_SG_PROTOCOL}\n      VPC_SG_PORT:     ${VPC_SG_PORT}\n      VPC_SG_CIDR:     ${VPC_SG_CIDR}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n        --group-id ${VPC_SG_ID} \\\n        --protocol ${VPC_SG_PROTOCOL} \\\n        --port ${VPC_SG_PORT} \\\n        --cidr ${VPC_SG_CIDR}\n\n\n (\u623b\u308a\u5024\u306a\u3057)\n\nVPC_SG_ID=\"sg-xxxxx\"\n\n\n1.8. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u5185\u5bb9\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-ids ${VPC_SG_ID}\n\n\n\n2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(\u5fc5\u9808\u9805\u76ee)\u306e\u8a2d\u5b9a\n\n2.1. DB\u30a8\u30f3\u30b8\u30f3\u95a2\u9023\n\n\u30b3\u30de\u30f3\u30c9\nRDS_ENGINE_NAME='aurora'\n\n\n\n2.2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u95a2\u9023\n\nDB Instance Class\n\n\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_CLASS='db.r3.xlarge'\n\n\n\nAllocated Storage\n\n\u30b3\u30de\u30f3\u30c9\nRDS_STORAGE_SIZE='100'\n\n\n100 GB \u5206\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7528\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002\n\nDB Cluster Instance Identifier\nDB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u3067\u3001\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4e00\u610f\u3067\u3042\u308b\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRDS_CLS_INSTANCE_IDENT=\"aurora-cls-handson-${AWS_DEFAULT_REGION}\" \\\n        && echo ${RDS_CLS_INSTANCE_IDENT}\n\n\n\nDB Instance Identifier\nDB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u3067\u3001\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4e00\u610f\u3067\u3042\u308b\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_IDENT=\"aurora-handson-${AWS_DEFAULT_REGION}\" \\\n        && echo ${RDS_INSTANCE_IDENT}\n\n\nNote: \u308f\u304b\u308a\u3084\u3059\u3044\u540d\u524d\u306b\u3059\u308b\u306b\u306f\u3001\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u3068 DB \u30a8\u30f3\u30b8\u30f3\u3092\u540d\u524d\u306b\u542b\u3081\u307e\u3059\u3002\n\n2.3. DB\u7ba1\u7406\u30e6\u30fc\u30b6\u95a2\u9023\n\nMaster Username\n\n\u30b3\u30de\u30f3\u30c9\nRDS_USER_NAME='root'\n\n\n\nMaster Password\n\n\u30b3\u30de\u30f3\u30c9\nRDS_USER_PASS='#dbPass123'\n\n\n\n3. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(\u4efb\u610f\u9805\u76ee)\u306e\u8a2d\u5b9a\n\n3.1. \u8d77\u52d5\u5f8c\u306b\u8ffd\u52a0\u3067\u304d\u306a\u3044\u3082\u306e\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306e\u6307\u5b9a\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u540d\u524d\u3092\u3001\u82f1\u6570\u5b57 63 \u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRDS_DB_NAME='handson'\n\n\nNote: \u540d\u524d\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001DB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u3002\n\n3.2. \u8d77\u52d5\u5f8c\u306b\u5909\u66f4\u3067\u304d\u306a\u3044\u3082\u306e\n\n\u30dd\u30fc\u30c8\u306e\u6307\u5b9a (\u7701\u7565)\n\u3044\u3063\u305f\u3093 DB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u7570\u306a\u308b\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024: 3306 (MySQL\u306e\u5834\u5408)\n\n3.3. \u8d77\u52d5\u5f8c\u306b\u5909\u66f4\u3067\u304d\u308b\u3082\u306e\n\n\u30b3\u30de\u30f3\u30c9\nARRAY_SG_ID=\"${VPC_SG_ID}\"\n\n\n\n3.4. DB Subnet Group\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nSUBNET_GROUP_ID=\"handon-db-subnet\"\n\n\nVPC\u306e\u30b5\u30d6\u30cd\u30c3\u30c8ID\u306f\u4e0b\u8a18\u3067\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\nRDS_SUBNET=`aws ec2 describe-subnets --filters Name=vpc-id,Values=${VPC_ID}  --query 'Subnets[].SubnetId' --output text`\n\n\naws rds create-db-subnet-group \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--db-subnet-group-description ${SUBNET_GROUP_ID} \\\n--subnet-ids ${RDS_SUBNET}\n\n\n\u7d50\u679c\n{\n    \"DBSubnetGroup\": {\n        \"Subnets\": [\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-xxxxxxx\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2c\"\n                }\n            },\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-yyy\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2b\"\n                }\n            },\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-zzz\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2a\"\n                }\n            }\n        ],\n        \"DBSubnetGroupName\": \"handon-db-subnet\",\n        \"VpcId\": \"vpc-a676c0c3\",\n        \"DBSubnetGroupDescription\": \"handon-db-subnet\",\n        \"SubnetGroupStatus\": \"Complete\"\n    }\n}\n\n\n\n3.5. DB Cluster Parameter Group\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nDB_CLUSTER_PARAM=\"handon-cluster-db-param\"\n\n\naws rds create-db-cluster-parameter-group \\\n--db-cluster-parameter-group-name ${DB_CLUSTER_PARAM} \\\n--db-parameter-group-family aurora5.6 \\\n--description ${DB_CLUSTER_PARAM}\n\n\n3.6. DB Parameter Group\u306e\u4f5c\u6210\n\n\u30b3\u30de\u30f3\u30c9\nDB_PARAM=\"handon-db-param\"\n\n\naws rds create-db-parameter-group \\\n--db-parameter-group-name ${DB_PARAM} \\\n--db-parameter-group-family aurora5.6 \\\n--description ${DB_PARAM}\n\n\n4. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\n4.1. \u8d77\u52d5\u6642\u523b\u306e\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nDATETIME_UTC=`date -u '+%Y-%m-%dT%H:%MZ'` \\\n        && echo ${DATETIME_UTC}\n\n\n\n\u7d50\u679c\n2015-03-14T02:02Z\n\n\n\n4.2. \u8d77\u52d5\n\n\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n        RDS_INSTANCE_IDENT: ${RDS_INSTANCE_IDENT}\n        RDS_STORAGE_SIZE:   ${RDS_STORAGE_SIZE}\n        RDS_INSTANCE_CLASS: ${RDS_INSTANCE_CLASS}\n        RDS_ENGINE_NAME:    ${RDS_ENGINE_NAME}\n        RDS_USER_NAME:      ${RDS_USER_NAME}\n        RDS_USER_PASS:      ${RDS_USER_PASS}\n        RDS_DB_NAME:        ${RDS_DB_NAME}\n        ARRAY_SG_ID:        ${ARRAY_SG_ID}\n\nETX\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds  create-db-cluster \\\n --backup-retention-period 3 \\\n  --db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n  --db-cluster-parameter-group-name ${DB_CLUSTER_PARAM} \\\n  --vpc-security-group-ids ${ARRAY_SG_ID} \\\n  --db-subnet-group-name ${SUBNET_GROUP_ID} \\\n  --master-username ${RDS_USER_NAME} \\\n  --master-user-password ${RDS_USER_PASS} \\\n  --preferred-backup-window 15:30-16:00 \\\n  --preferred-maintenance-window Mon:15:00-Mon:15:30 \\\n  --engine ${RDS_ENGINE_NAME}\n\n\n\n\u7d50\u679c(\u4f8b)\n{\n    \"DBClusters\": [\n        {\n            \"Status\": \"available\",\n            \"Engine\": \"aurora\",\n            \"Endpoint\": \"\",\n            \"DBClusterIdentifier\": \"1\",\n            \"MasterUsername\": \"root\",\n            \"EarliestRestorableTime\": \"2015-08-02T02:02:24.568Z\",\n            \"DBClusterMembers\": [],\n            \"Port\": 3306,\n            \"PreferredBackupWindow\": \"15:30-16:00\",\n            \"VpcSecurityGroups\": [\n                {\n                    \"Status\": \"active\",\n                    \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n                }\n            ],\n            \"DBSubnetGroup\": \"\",\n            \"AllocatedStorage\": 1,\n            \"EngineVersion\": \"5.6.10a\",\n            \"DBClusterParameterGroup\": \"\",\n            \"BackupRetentionPeriod\": 3,\n            \"AvailabilityZones\": [\n                \"us-west-2a\",\n                \"us-west-2b\",\n                \"us-west-2c\"\n            ],\n            \"LatestRestorableTime\": \"2015-08-02T02:02:24.568Z\",\n            \"PreferredMaintenanceWindow\": \"mon:15:00-mon:15:30\"\n        }\n    ]\n}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds  create-db-instance \\\n--db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n--db-instance-class ${RDS_INSTANCE_CLASS} \\\n--engine ${RDS_ENGINE_NAME} \\\n--db-parameter-group-name ${DB_PARAM} \\\n--no-auto-minor-version-upgrade \\\n--no-publicly-accessible \\\n--db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--preferred-maintenance-window Mon:15:00-Mon:15:30 \n\n\n\n\u7d50\u679c(\u4f8b)\n{\n    \"DBInstance\": {\n        \"PubliclyAccessible\": false,\n        \"MasterUsername\": \"root\",\n        \"LicenseModel\": \"general-public-license\",\n        \"VpcSecurityGroups\": [\n            {\n                \"Status\": \"active\",\n                \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n            }\n        ],\n        \"CopyTagsToSnapshot\": false,\n        \"OptionGroupMemberships\": [\n            {\n                \"Status\": \"in-sync\",\n                \"OptionGroupName\": \"default:aurora-5-6\"\n            }\n        ],\n        \"PendingModifiedValues\": {},\n        \"Engine\": \"aurora\",\n        \"MultiAZ\": false,\n        \"DBSecurityGroups\": [],\n        \"DBParameterGroups\": [\n            {\n                \"DBParameterGroupName\": \"\",\n                \"ParameterApplyStatus\": \"in-sync\"\n            }\n        ],\n        \"AutoMinorVersionUpgrade\": false,\n        \"PreferredBackupWindow\": \"15:30-16:00\",\n        \"DBSubnetGroup\": {\n            \"Subnets\": [\n                {\n                    \"SubnetStatus\": \"Active\",\n                    \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                    \"SubnetAvailabilityZone\": {\n                        \"Name\": \"us-west-2a\"\n                    }\n                },\n                {\n                    \"SubnetStatus\": \"Active\",\n                    \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                    \"SubnetAvailabilityZone\": {\n                        \"Name\": \"us-west-2b\"\n                    }\n                }\n            ],\n            \"DBSubnetGroupName\": \"\",\n            \"VpcId\": \"vpc-xxxxxxxx\",\n            \"DBSubnetGroupDescription\": \"\",\n            \"SubnetGroupStatus\": \"Complete\"\n        },\n        \"ReadReplicaDBInstanceIdentifiers\": [],\n        \"AllocatedStorage\": 1,\n        \"BackupRetentionPeriod\": 0,\n        \"PreferredMaintenanceWindow\": \"sun:12:27-sun:12:57\",\n        \"DBInstanceStatus\": \"creating\",\n        \"EngineVersion\": \"5.6.10a\",\n        \"DomainMemberships\": [],\n        \"DBClusterIdentifier\": \"\",\n        \"StorageType\": \"grover\",\n        \"DbiResourceId\": \"db-6YPT426JMQQBPS6W7PNSAQCOX4\",\n        \"CACertificateIdentifier\": \"rds-ca-2015\",\n        \"StorageEncrypted\": false,\n        \"DBInstanceClass\": \"db.r3.xlarge\",\n        \"DbInstancePort\": 0,\n        \"DBInstanceIdentifier\": \"\"\n    }\n}\n\n\nAmazon Aurora\u306e\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u500b\u5225\u306b\u6307\u5b9a\u3059\u308b\u3068\u3001\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002DB Cluster\u4f5c\u6210\u6642\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u30b3\u30de\u30f3\u30c9\naws rds  create-db-instance \\\n--db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n--db-instance-class {RDS_INSTANCE_CLASS} \\\n--engine ${RDS_ENGINE_NAME} \\\n--db-parameter-group-name ${DB_PARAM} \\\n--no-auto-minor-version-upgrade \\\n--no-publicly-accessible \\\n--db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--preferred-backup-window 15:30-16:00 \\\n--preferred-maintenance-window Mon:15:00-Mon:15:30\n\n\n\n\u7d50\u679c(\u4f8b)\nA client error (InvalidParameterCombination) occurred when calling the CreateDBInstance operation: The requested DB Instance will be a member of a DB Cluster and its backup window should not be set directly.\n\n\n\n4.3. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\nRDS_INSTANCE_STATUS=`aws rds describe-db-instances --db-instance-identifier ${RDS_INSTANCE_IDENT} --query 'DBInstances[].DBInstanceStatus' --output text` \\\n        && echo ${RDS_INSTANCE_STATUS}\n\ncreating\n\n\n5. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u78ba\u8a8d\n\n5.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_STATUS=`aws rds describe-db-instances --db-instance-identifier ${RDS_INSTANCE_IDENT} --query 'DBInstances[].DBInstanceStatus' --output text` \\\n        && echo ${RDS_INSTANCE_STATUS}\n\n\n\n\u7d50\u679c(\u4f8b)\navailable\n\n\n\n6. \u5f8c\u7247\u4ed8\u3051\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-instance --db-instance-identifier ${RDS_INSTANCE_IDENT}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-cluster --db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} --skip-final-snapshot\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-parameter-group  --db-parameter-group-name ${DB_PARAM}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-cluster-parameter-group  --db-cluster-parameter-group-name ${DB_CLUSTER_PARAM}\n\n\n\n\u30b3\u30de\u30f3\u30c9\naws rds delete-db-subnet-group --db-subnet-group-name ${SUBNET_GROUP_ID}\n\n\n#\u524d\u63d0\u6761\u4ef6\n\n##RDS\u3078\u306e\u6a29\u9650\n\n\u4ee5\u4e0b\u306e\u6a29\u9650\u3067\u3042\u308b\u3053\u3068\n\n```\u30dd\u30ea\u30b7\u30fc:\u30dd\u30ea\u30b7\u30fc\n{\n         \"GroupName\": \"rdsFull\", \n         \"PolicyDocument\": {\n             \"Version\": \"2012-10-17\", \n             \"Statement\": [\n                 {\n                     \"Action\": [\n                         \"rds:*\", \n                         \"cloudwatch:DescribeAlarms\", \n                         \"cloudwatch:GetMetricStatistics\", \n                         \"ec2:AuthorizeSecurityGroupIngress\",\n                         \"ec2:CreateSecurityGroup\",\n                         \"ec2:DeleteSecurityGroup\",\n                         \"ec2:DescribeAccountAttributes\", \n                         \"ec2:DescribeAvailabilityZones\", \n                         \"ec2:DescribeSecurityGroups\", \n                         \"ec2:DescribeSubnets\", \n                         \"ec2:DescribeVpcs\", \n                         \"sns:ListSubscriptions\", \n                         \"sns:ListTopics\"\n                     ], \n                     \"Resource\": \"*\", \n                     \"Effect\": \"Allow\"\n                 }\n             ]\n         }, \n         \"PolicyName\": \"rdsFull-prj04\"\n     }\n```\n\n###\u30c7\u30d5\u30a9\u30eb\u30c8VPC\u306e\u5b58\u5728\n\n```command:\u30b3\u30de\u30f3\u30c9\nVPC_ID=`aws ec2 describe-vpcs --filters Name=isDefault,Values=true --query 'Vpcs[].VpcId' --output text` \\\n        && echo ${VPC_ID}\n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\nvpc-xxxxxxxx\n```\n\n##AWS CLI\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws --version\n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\naws-cli/1.7.42 Python/2.7.5 Linux/3.10.0-123.el7.x86_64\n```\n\n##mysql 5.6\u30ea\u30dd\u30b8\u30c8\u30ea\u5c0e\u5165\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nyum install http://dev.mysql.com/get/mysql-community-release-el6-5.noarch.rpm\n```\n\n##mysql client\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nyum install mysql-community-client\n```\n\n##mysql\u30b3\u30de\u30f3\u30c9\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nwhich mysql\n```\n\n```\u7d50\u679c(\u5b58\u5728\u3059\u308b\u5834\u5408\u306e\u4f8b):\u7d50\u679c(\u5b58\u5728\u3059\u308b\u5834\u5408\u306e\u4f8b)\n/usr/bin/mysql\n```\n\n```\u7d50\u679c(\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306e\u4f8b):\u7d50\u679c(\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306e\u4f8b)\n/usr/bin/which: no mysql in (/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/hiruta/.local/bin:/home/hiruta/bin)\n```\n\n##0.\u6e96\u5099\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nAWS_DEFAULT_REGION='us-west-2'\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws configure list\n```\n\n```\u7d50\u679c:\u7d50\u679c\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************33RQ shared-credentials-file\nsecret_key     ****************X9G/ shared-credentials-file\n```\n\n##1.\u4e8b\u524d\u4f5c\u696d\n\n###1.1. VPC Security Group\u306e\u540d\u79f0\u3068\u8aac\u660e\u306e\u6c7a\u5b9a\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nVPC_SG_NAME='rds-mysql-inbound'\nVPC_SG_DESC='RDS MySQL inbound'\n```\n\n###1.2. VPC Security Group\u306e\u8a2d\u5b9a\u5185\u5bb9\u6c7a\u5b9a\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nVPC_SG_PROTOCOL='tcp'\nVPC_SG_PORT='3306'\nVPC_SG_CIDR='0.0.0.0/0'\n```\n\n###VPC Security Group\u306e\u4e0d\u5b58\u5728\u78ba\u8a8d\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-names ${VPC_SG_NAME}\n```\n\n```\u7d50\u679c:\u7d50\u679c\nA client error (InvalidGroup.NotFound) occurred when calling the DescribeSecurityGroups operation: The security group 'rds-posgre-inbound' does not exist in default VPC 'vpc-xxxxxxxx'\n```\n\n##1.4. VPC Security Group\u306e\u4f5c\u6210\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n        VPC_SG_NAME: ${VPC_SG_NAME}\n        VPC_SG_DESC: \"${VPC_SG_DESC}\"\n\nETX\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws ec2 create-security-group \\\n        --group-name ${VPC_SG_NAME} \\\n        --description \"${VPC_SG_DESC}\"\n```\n\n```\u7d50\u679c:\u7d50\u679c\n {\n          \"GroupId\": \"sg-xxxxxxxx\"\n      }\n```\n\n##1.5. VPC Security Group\u306e\u5b58\u5728\u78ba\u8a8d\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-names ${VPC_SG_NAME}\n```\n\n```\u7d50\u679c:\u7d50\u679c\n{\n        \"SecurityGroups\": [\n          {\n              \"Description\": \"RDS MySQL inbound\",\n              \"GroupName\": \"rds-mysql-inbound\",\n              \"VpcId\": \"vpc-xxxxxxxx\",\n              \"OwnerId\": \"XXXXXXXXXXXX\",\n              \"GroupId\": \"sg-xxxxxxxx\"\n          }\n        ]\n      }\n```\n\n##1.7. \u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u306e\u8a2d\u5b9a\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n      VPC_SG_PROTOCOL: ${VPC_SG_PROTOCOL}\n      VPC_SG_PORT:     ${VPC_SG_PORT}\n      VPC_SG_CIDR:     ${VPC_SG_CIDR}\n\nETX\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws ec2 authorize-security-group-ingress \\\n        --group-id ${VPC_SG_ID} \\\n        --protocol ${VPC_SG_PROTOCOL} \\\n        --port ${VPC_SG_PORT} \\\n        --cidr ${VPC_SG_CIDR}\n```\n\n```\n (\u623b\u308a\u5024\u306a\u3057)\n```\n\n```\nVPC_SG_ID=\"sg-xxxxx\"\n```\n\n##1.8. \u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u30b0\u30eb\u30fc\u30d7\u306e\u5185\u5bb9\u78ba\u8a8d\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws ec2 describe-security-groups \\\n        --group-ids ${VPC_SG_ID}\n```\n\n#2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(\u5fc5\u9808\u9805\u76ee)\u306e\u8a2d\u5b9a\n\n##2.1. DB\u30a8\u30f3\u30b8\u30f3\u95a2\u9023\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_ENGINE_NAME='aurora'\n```\n\n##2.2. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u95a2\u9023\n\n###DB Instance Class\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_CLASS='db.r3.xlarge'\n```\n\n###Allocated Storage\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_STORAGE_SIZE='100'\n```\n\n100 GB \u5206\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u7528\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002\n\n###DB Cluster Instance Identifier\n\nDB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u3067\u3001\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4e00\u610f\u3067\u3042\u308b\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_CLS_INSTANCE_IDENT=\"aurora-cls-handson-${AWS_DEFAULT_REGION}\" \\\n        && echo ${RDS_CLS_INSTANCE_IDENT}\n```\n\n\n\n###DB Instance Identifier\n\nDB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u540d\u3092\u5165\u529b\u3057\u307e\u3059\u3002\n\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u5185\u3067\u3001\u81ea\u5206\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u306b\u5bfe\u3057\u3066\u4e00\u610f\u3067\u3042\u308b\u3053\u3068\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_IDENT=\"aurora-handson-${AWS_DEFAULT_REGION}\" \\\n        && echo ${RDS_INSTANCE_IDENT}\n```\n\nNote: \u308f\u304b\u308a\u3084\u3059\u3044\u540d\u524d\u306b\u3059\u308b\u306b\u306f\u3001\u9078\u629e\u3057\u305f\u30ea\u30fc\u30b8\u30e7\u30f3\u3068 DB \u30a8\u30f3\u30b8\u30f3\u3092\u540d\u524d\u306b\u542b\u3081\u307e\u3059\u3002\n\n##2.3. DB\u7ba1\u7406\u30e6\u30fc\u30b6\u95a2\u9023\n\n###Master Username\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_USER_NAME='root'\n```\n\n###Master Password\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_USER_PASS='#dbPass123'\n```\n\n#3. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9(\u4efb\u610f\u9805\u76ee)\u306e\u8a2d\u5b9a\n\n##3.1. \u8d77\u52d5\u5f8c\u306b\u8ffd\u52a0\u3067\u304d\u306a\u3044\u3082\u306e\n\n###\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u540d\u306e\u6307\u5b9a\n\n\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u540d\u524d\u3092\u3001\u82f1\u6570\u5b57 63 \u6587\u5b57\u4ee5\u5185\u3067\u5165\u529b\u3057\u307e\u3059\u3002\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_DB_NAME='handson'\n```\n\nNote: \u540d\u524d\u3092\u6307\u5b9a\u3057\u306a\u3044\u5834\u5408\u3001DB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3067\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u4f5c\u6210\u3055\u308c\u307e\u305b\u3093\u3002\n\n##3.2. \u8d77\u52d5\u5f8c\u306b\u5909\u66f4\u3067\u304d\u306a\u3044\u3082\u306e\n\n###\u30dd\u30fc\u30c8\u306e\u6307\u5b9a (\u7701\u7565)\n\n\u3044\u3063\u305f\u3093 DB \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u4f5c\u6210\u3059\u308b\u3068\u30dd\u30fc\u30c8\u3092\u5909\u66f4\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u3068\u7570\u306a\u308b\u30dd\u30fc\u30c8\u3092\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u4f5c\u6210\u6642\u306b\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u30c7\u30d5\u30a9\u30eb\u30c8\u5024: 3306 (MySQL\u306e\u5834\u5408)\n\n\n##3.3. \u8d77\u52d5\u5f8c\u306b\u5909\u66f4\u3067\u304d\u308b\u3082\u306e\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nARRAY_SG_ID=\"${VPC_SG_ID}\"\n```\n\n##3.4. DB Subnet Group\u306e\u4f5c\u6210\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nSUBNET_GROUP_ID=\"handon-db-subnet\"\n```\n\nVPC\u306e\u30b5\u30d6\u30cd\u30c3\u30c8ID\u306f\u4e0b\u8a18\u3067\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_SUBNET=`aws ec2 describe-subnets --filters Name=vpc-id,Values=${VPC_ID}  --query 'Subnets[].SubnetId' --output text`\n```\n\n```\naws rds create-db-subnet-group \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--db-subnet-group-description ${SUBNET_GROUP_ID} \\\n--subnet-ids ${RDS_SUBNET}\n```\n\n```\u7d50\u679c:\u7d50\u679c\n{\n    \"DBSubnetGroup\": {\n        \"Subnets\": [\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-xxxxxxx\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2c\"\n                }\n            },\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-yyy\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2b\"\n                }\n            },\n            {\n                \"SubnetStatus\": \"Active\",\n                \"SubnetIdentifier\": \"subnet-zzz\",\n                \"SubnetAvailabilityZone\": {\n                    \"Name\": \"us-west-2a\"\n                }\n            }\n        ],\n        \"DBSubnetGroupName\": \"handon-db-subnet\",\n        \"VpcId\": \"vpc-a676c0c3\",\n        \"DBSubnetGroupDescription\": \"handon-db-subnet\",\n        \"SubnetGroupStatus\": \"Complete\"\n    }\n}\n```\n\n##3.5. DB Cluster Parameter Group\u306e\u4f5c\u6210\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nDB_CLUSTER_PARAM=\"handon-cluster-db-param\"\n```\n\n```\naws rds create-db-cluster-parameter-group \\\n--db-cluster-parameter-group-name ${DB_CLUSTER_PARAM} \\\n--db-parameter-group-family aurora5.6 \\\n--description ${DB_CLUSTER_PARAM}\n```\n\n##3.6. DB Parameter Group\u306e\u4f5c\u6210\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nDB_PARAM=\"handon-db-param\"\n```\n\n```\naws rds create-db-parameter-group \\\n--db-parameter-group-name ${DB_PARAM} \\\n--db-parameter-group-family aurora5.6 \\\n--description ${DB_PARAM}\n```\n\n#4. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\n\n##4.1. \u8d77\u52d5\u6642\u523b\u306e\u78ba\u8a8d\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nDATETIME_UTC=`date -u '+%Y-%m-%dT%H:%MZ'` \\\n        && echo ${DATETIME_UTC}\n```\n\n```\u7d50\u679c:\u7d50\u679c\n2015-03-14T02:02Z\n```\n\n##4.2. \u8d77\u52d5\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\ncat << ETX\n\n        RDS_INSTANCE_IDENT: ${RDS_INSTANCE_IDENT}\n        RDS_STORAGE_SIZE:   ${RDS_STORAGE_SIZE}\n        RDS_INSTANCE_CLASS: ${RDS_INSTANCE_CLASS}\n        RDS_ENGINE_NAME:    ${RDS_ENGINE_NAME}\n        RDS_USER_NAME:      ${RDS_USER_NAME}\n        RDS_USER_PASS:      ${RDS_USER_PASS}\n        RDS_DB_NAME:        ${RDS_DB_NAME}\n        ARRAY_SG_ID:        ${ARRAY_SG_ID}\n\nETX\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds  create-db-cluster \\\n --backup-retention-period 3 \\\n  --db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n  --db-cluster-parameter-group-name ${DB_CLUSTER_PARAM} \\\n  --vpc-security-group-ids ${ARRAY_SG_ID} \\\n  --db-subnet-group-name ${SUBNET_GROUP_ID} \\\n  --master-username ${RDS_USER_NAME} \\\n  --master-user-password ${RDS_USER_PASS} \\\n  --preferred-backup-window 15:30-16:00 \\\n  --preferred-maintenance-window Mon:15:00-Mon:15:30 \\\n  --engine ${RDS_ENGINE_NAME}\n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\n{\n    \"DBClusters\": [\n        {\n            \"Status\": \"available\",\n            \"Engine\": \"aurora\",\n            \"Endpoint\": \"\",\n            \"DBClusterIdentifier\": \"1\",\n            \"MasterUsername\": \"root\",\n            \"EarliestRestorableTime\": \"2015-08-02T02:02:24.568Z\",\n            \"DBClusterMembers\": [],\n            \"Port\": 3306,\n            \"PreferredBackupWindow\": \"15:30-16:00\",\n            \"VpcSecurityGroups\": [\n                {\n                    \"Status\": \"active\",\n                    \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n                }\n            ],\n            \"DBSubnetGroup\": \"\",\n            \"AllocatedStorage\": 1,\n            \"EngineVersion\": \"5.6.10a\",\n            \"DBClusterParameterGroup\": \"\",\n            \"BackupRetentionPeriod\": 3,\n            \"AvailabilityZones\": [\n                \"us-west-2a\",\n                \"us-west-2b\",\n                \"us-west-2c\"\n            ],\n            \"LatestRestorableTime\": \"2015-08-02T02:02:24.568Z\",\n            \"PreferredMaintenanceWindow\": \"mon:15:00-mon:15:30\"\n        }\n    ]\n}\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds  create-db-instance \\\n--db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n--db-instance-class ${RDS_INSTANCE_CLASS} \\\n--engine ${RDS_ENGINE_NAME} \\\n--db-parameter-group-name ${DB_PARAM} \\\n--no-auto-minor-version-upgrade \\\n--no-publicly-accessible \\\n--db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--preferred-maintenance-window Mon:15:00-Mon:15:30 \n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\n{\n    \"DBInstance\": {\n        \"PubliclyAccessible\": false,\n        \"MasterUsername\": \"root\",\n        \"LicenseModel\": \"general-public-license\",\n        \"VpcSecurityGroups\": [\n            {\n                \"Status\": \"active\",\n                \"VpcSecurityGroupId\": \"sg-xxxxxxxx\"\n            }\n        ],\n        \"CopyTagsToSnapshot\": false,\n        \"OptionGroupMemberships\": [\n            {\n                \"Status\": \"in-sync\",\n                \"OptionGroupName\": \"default:aurora-5-6\"\n            }\n        ],\n        \"PendingModifiedValues\": {},\n        \"Engine\": \"aurora\",\n        \"MultiAZ\": false,\n        \"DBSecurityGroups\": [],\n        \"DBParameterGroups\": [\n            {\n                \"DBParameterGroupName\": \"\",\n                \"ParameterApplyStatus\": \"in-sync\"\n            }\n        ],\n        \"AutoMinorVersionUpgrade\": false,\n        \"PreferredBackupWindow\": \"15:30-16:00\",\n        \"DBSubnetGroup\": {\n            \"Subnets\": [\n                {\n                    \"SubnetStatus\": \"Active\",\n                    \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                    \"SubnetAvailabilityZone\": {\n                        \"Name\": \"us-west-2a\"\n                    }\n                },\n                {\n                    \"SubnetStatus\": \"Active\",\n                    \"SubnetIdentifier\": \"subnet-xxxxxxxx\",\n                    \"SubnetAvailabilityZone\": {\n                        \"Name\": \"us-west-2b\"\n                    }\n                }\n            ],\n            \"DBSubnetGroupName\": \"\",\n            \"VpcId\": \"vpc-xxxxxxxx\",\n            \"DBSubnetGroupDescription\": \"\",\n            \"SubnetGroupStatus\": \"Complete\"\n        },\n        \"ReadReplicaDBInstanceIdentifiers\": [],\n        \"AllocatedStorage\": 1,\n        \"BackupRetentionPeriod\": 0,\n        \"PreferredMaintenanceWindow\": \"sun:12:27-sun:12:57\",\n        \"DBInstanceStatus\": \"creating\",\n        \"EngineVersion\": \"5.6.10a\",\n        \"DomainMemberships\": [],\n        \"DBClusterIdentifier\": \"\",\n        \"StorageType\": \"grover\",\n        \"DbiResourceId\": \"db-6YPT426JMQQBPS6W7PNSAQCOX4\",\n        \"CACertificateIdentifier\": \"rds-ca-2015\",\n        \"StorageEncrypted\": false,\n        \"DBInstanceClass\": \"db.r3.xlarge\",\n        \"DbInstancePort\": 0,\n        \"DBInstanceIdentifier\": \"\"\n    }\n}\n```\n\nAmazon Aurora\u306e\u5834\u5408\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u500b\u5225\u306b\u6307\u5b9a\u3059\u308b\u3068\u3001\u30a8\u30e9\u30fc\u306b\u306a\u308a\u307e\u3059\u3002DB Cluster\u4f5c\u6210\u6642\u306b\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u6307\u5b9a\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds  create-db-instance \\\n--db-instance-identifier ${RDS_INSTANCE_IDENT} \\\n--db-instance-class {RDS_INSTANCE_CLASS} \\\n--engine ${RDS_ENGINE_NAME} \\\n--db-parameter-group-name ${DB_PARAM} \\\n--no-auto-minor-version-upgrade \\\n--no-publicly-accessible \\\n--db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} \\\n--db-subnet-group-name ${SUBNET_GROUP_ID} \\\n--preferred-backup-window 15:30-16:00 \\\n--preferred-maintenance-window Mon:15:00-Mon:15:30\n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\nA client error (InvalidParameterCombination) occurred when calling the CreateDBInstance operation: The requested DB Instance will be a member of a DB Cluster and its backup window should not be set directly.\n```\n\n##4.3. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n```\nRDS_INSTANCE_STATUS=`aws rds describe-db-instances --db-instance-identifier ${RDS_INSTANCE_IDENT} --query 'DBInstances[].DBInstanceStatus' --output text` \\\n        && echo ${RDS_INSTANCE_STATUS}\n```\n\n```\ncreating\n```\n\n#5. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u8d77\u52d5\u78ba\u8a8d\n\n##5.1. DB\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306e\u72b6\u614b\u78ba\u8a8d\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\nRDS_INSTANCE_STATUS=`aws rds describe-db-instances --db-instance-identifier ${RDS_INSTANCE_IDENT} --query 'DBInstances[].DBInstanceStatus' --output text` \\\n        && echo ${RDS_INSTANCE_STATUS}\n```\n\n```\u7d50\u679c(\u4f8b):\u7d50\u679c(\u4f8b)\navailable\n```\n\n#6. \u5f8c\u7247\u4ed8\u3051\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-instance --db-instance-identifier ${RDS_INSTANCE_IDENT}\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-cluster --db-cluster-identifier ${RDS_CLS_INSTANCE_IDENT} --skip-final-snapshot\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-parameter-group  --db-parameter-group-name ${DB_PARAM}\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-cluster-parameter-group  --db-cluster-parameter-group-name ${DB_CLUSTER_PARAM}\n```\n\n```\u30b3\u30de\u30f3\u30c9:\u30b3\u30de\u30f3\u30c9\naws rds delete-db-subnet-group --db-subnet-group-name ${SUBNET_GROUP_ID}\n```\n\n\n\n\n\n", "tags": ["Aurora", "AWS"]}