{"context": "\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Route53\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u306bA\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n\nRoute53\u3078\u306e\u30d5\u30eb\u30a2\u30af\u30bb\u30b9\u6a29\u9650\nhosted zone\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3002\n\n\n0. \u4e8b\u524d\u4f5c\u696d\n\n0.1. \u30ec\u30b3\u30fc\u30c9\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u4f5c\u6210\n\u30ea\u30bd\u30fc\u30b9\u30ec\u30b3\u30fc\u30c9\u30bb\u30c3\u30c8\u306e\u5b9a\u7fa9\u3092JSON\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\ncommand\nR53_ZONE_NAME='example.jp'\nR53_NODE_NAME=\"test.${R53_ZONE_NAME}\"\nR53_ACT='CREATE'\nR53_TYPE='A'\nR53_VALUE='192.0.2.1'\nR53_TTL='86400'\nFILE_R53_RECORD_SET='create-a.json'\n\n\n\ncommand\ncat << EOF > ${FILE_R53_RECORD_SET}\n  {\n     \"Changes\": [\n       {\n         \"Action\": \"${R53_ACT}\",\n         \"ResourceRecordSet\": {\n           \"Name\": \"${R53_NODE_NAME}.\",\n           \"ResourceRecords\": [\n             {\n               \"Value\": \"${R53_VALUE}\"\n             }\n           ],\n           \"Type\": \"${R53_TYPE}\",\n           \"TTL\": ${R53_TTL}\n         }\n       }\n     ]\n  }\nEOF\n\n\n\ncreate-a.json(sample)\n{\n     \"Changes\": [\n       {\n         \"Action\": \"CREATE\",\n         \"ResourceRecordSet\": {\n           \"Name\": \"test.example.jp.\",\n           \"ResourceRecords\": [\n             {\n               \"Value\": \"192.0.2.1\"\n             }\n           ],\n           \"Type\": \"A\",\n           \"TTL\": 86400\n         }\n       }\n     ]\n}\n\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\ncommand\njsonlint -q ${FILE_R53_RECORD_SET} \n\n\n\nresult\n(\u623b\u308a\u5024\u306a\u3057)\n\n\n\n0.2. hosted zone id\u306e\u53d6\u5f97\nA\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306ehosted zone id\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\ncommand\nR53_ZONE_ID=$( \\\n        aws route53 list-hosted-zones \\\n          --query \"HostedZones[?Name == \\`${R53_ZONE_NAME}.\\`].Id\" \\\n          --output text \\\n        | sed 's/\\/hostedzone\\///' \\\n) && echo ${R53_ZONE_ID}\n\n\n\nresult(sample)\nZXXXXXXXXXXXXX\n\n\n\n1. A\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\nA\u30ec\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\ncommand\naws route53 change-resource-record-sets \\\n  --hosted-zone-id ${R53_ZONE_ID} \\\n  --change-batch file://${FILE_R53_RECORD_SET}\n\n\n\nresult\n{\n       \"ChangeInfo\": {\n           \"Status\": \"PENDING\", \n           \"SubmittedAt\": \"2014-05-27T07:56:56.970Z\", \n           \"Id\": \"/change/CXXXXXXXXXXXXX\"\n       }\n}\n\n\n\n2. A\u30ec\u30b3\u30fc\u30c9\u306e\u78ba\u8a8d\nA\u30ec\u30b3\u30fc\u30c9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\ncommand\naws route53 list-resource-record-sets \\\n  --hosted-zone-id /hostedzone/${R53_ZONE_ID}\n\n\n\nresult\n{\n       \"ResourceRecordSets\": [\n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"ns-X.awsdns-XX.com.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXXX.awsdns-XX.co.uk.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXX.awsdns-XX.net.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXXX.awsdns-XX.org.\"\n                   }\n               ], \n               \"Type\": \"NS\", \n               \"Name\": \"example.jp.\", \n               \"TTL\": 172800\n           }, \n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"ns-8.awsdns-01.com. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400\"\n                   }\n               ], \n               \"Type\": \"SOA\", \n               \"Name\": \"example.jp.\", \n               \"TTL\": 900\n           }, \n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"192.0.2.1\"\n                   }\n               ], \n               \"Type\": \"A\", \n               \"Name\": \"test.example.jp.\", \n               \"TTL\": 86400\n           }, \n           {\n               \"AliasTarget\": {\n                   \"HostedZoneId\": \"ZXXXXXXXXXXXXX\", \n                   \"EvaluateTargetHealth\": false, \n                   \"DNSName\": \"s3-website-us-east-1.amazonaws.com.\"\n               }, \n               \"Type\": \"A\", \n               \"Name\": \"www.example.jp.\"\n           }\n       ]\n}\n\n\n\n\u4eca\u56de\u4f5c\u6210\u3057\u305fA\u30a8\u30a4\u30ea\u30a2\u30b9\u30ec\u30b3\u30fc\u30c9\u306e\u767b\u9332\u5185\u5bb9\u306f\u3001\"Type\":\"A\"\u304c\u542b\u307e\u308c\u308b\u30d6\u30ed\u30c3\u30af\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n3. \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u3067\u306e\u540d\u524d\u89e3\u6c7a\u78ba\u8a8d\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3055\u308c\u305f\u30db\u30b9\u30c8\u3067\u3001\u767b\u9332\u3057\u305fA\u30ec\u30b3\u30fc\u30c9\u304c\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\ncommand\ndig ${R53_NODE_NAME} |grep ^${R53_NODE_NAME}\n\n\n\nresult\nwww.example.jp.               60      IN      A       xxx.xxx.xxx.xxx\n\n\n\n4. \u30db\u30b9\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\n\u5b9f\u969b\u306b\u30db\u30b9\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002(\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306fping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002)\n\ncommand\nping -c 3 ${R53_NODE_NAME}\n\n\n\nresult\n   PING test.example.jp (192.0.2.1): 56 data bytes\n   64 bytes from 192.0.2.1: icmp_seq=0 ttl=58 time=72.463 ms\n   64 bytes from 192.0.2.1: icmp_seq=1 ttl=58 time=12.172 ms\n   64 bytes from 192.0.2.1: icmp_seq=2 ttl=58 time=12.750 ms\n\n   --- test.example.jp ping statistics ---\n   3 packets transmitted, 3 packets received, 0.0% packet loss\n   round-trip min/avg/max/stddev = 12.172/32.462/72.463/28.286 ms\n\n\n\n\u5b8c\u4e86\n\u4ee5\u4e0a\u3067\u3001Route53\u3078\u306eA\u30ec\u30b3\u30fc\u30c9\u306e\u767b\u9332\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306f\u3001Route53\u3067\u7ba1\u7406\u3057\u3066\u3044\u308b\u30c9\u30e1\u30a4\u30f3\u306bA\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3057\u3066\u307f\u307e\u3059\u3002\n\n\u524d\u63d0\u6761\u4ef6\n========\n\n- Route53\u3078\u306e\u30d5\u30eb\u30a2\u30af\u30bb\u30b9\u6a29\u9650\n- hosted zone\u306e\u4f5c\u6210\u304c\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3002\n\n\n0. \u4e8b\u524d\u4f5c\u696d\n===========\n\n0.1. \u30ec\u30b3\u30fc\u30c9\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u4f5c\u6210\n-------------------------------\n\n\u30ea\u30bd\u30fc\u30b9\u30ec\u30b3\u30fc\u30c9\u30bb\u30c3\u30c8\u306e\u5b9a\u7fa9\u3092JSON\u5f62\u5f0f\u3067\u8a18\u8ff0\u3057\u307e\u3059\u3002\n\n```bash:command:\nR53_ZONE_NAME='example.jp'\nR53_NODE_NAME=\"test.${R53_ZONE_NAME}\"\nR53_ACT='CREATE'\nR53_TYPE='A'\nR53_VALUE='192.0.2.1'\nR53_TTL='86400'\nFILE_R53_RECORD_SET='create-a.json'\n```\n\n```bash:command:\ncat << EOF > ${FILE_R53_RECORD_SET}\n  {\n     \"Changes\": [\n       {\n         \"Action\": \"${R53_ACT}\",\n         \"ResourceRecordSet\": {\n           \"Name\": \"${R53_NODE_NAME}.\",\n           \"ResourceRecords\": [\n             {\n               \"Value\": \"${R53_VALUE}\"\n             }\n           ],\n           \"Type\": \"${R53_TYPE}\",\n           \"TTL\": ${R53_TTL}\n         }\n       }\n     ]\n  }\nEOF\n```\n\n\n```json:create-a.json(sample):\n{\n     \"Changes\": [\n       {\n         \"Action\": \"CREATE\",\n         \"ResourceRecordSet\": {\n           \"Name\": \"test.example.jp.\",\n           \"ResourceRecords\": [\n             {\n               \"Value\": \"192.0.2.1\"\n             }\n           ],\n           \"Type\": \"A\",\n           \"TTL\": 86400\n         }\n       }\n     ]\n}\n```\n\nJSON\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3057\u305f\u3089\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u58ca\u308c\u3066\u306a\u3044\u304b\u5fc5\u305a\u78ba\u8a8d\u3057\u307e\u3057\u3087\u3046\u3002\n\n```bash:command:\njsonlint -q ${FILE_R53_RECORD_SET} \n```\n\n```text:result:\n(\u623b\u308a\u5024\u306a\u3057)\n```\n\n\n0.2. hosted zone id\u306e\u53d6\u5f97\n-------------------------\n\nA\u30ec\u30b3\u30fc\u30c9\u3092\u767b\u9332\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u306ehosted zone id\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002\n\n```bash:command:\nR53_ZONE_ID=$( \\\n        aws route53 list-hosted-zones \\\n          --query \"HostedZones[?Name == \\`${R53_ZONE_NAME}.\\`].Id\" \\\n          --output text \\\n        | sed 's/\\/hostedzone\\///' \\\n) && echo ${R53_ZONE_ID}\n```\n\n```text:result(sample):\nZXXXXXXXXXXXXX\n```\n\n\n1. A\u30ec\u30b3\u30fc\u30c9\u306e\u4f5c\u6210\n==================\n\nA\u30ec\u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash:command:\naws route53 change-resource-record-sets \\\n  --hosted-zone-id ${R53_ZONE_ID} \\\n  --change-batch file://${FILE_R53_RECORD_SET}\n```\n\n```json:result:\n{\n       \"ChangeInfo\": {\n           \"Status\": \"PENDING\", \n           \"SubmittedAt\": \"2014-05-27T07:56:56.970Z\", \n           \"Id\": \"/change/CXXXXXXXXXXXXX\"\n       }\n}\n```\n\n2. A\u30ec\u30b3\u30fc\u30c9\u306e\u78ba\u8a8d\n==================\n\nA\u30ec\u30b3\u30fc\u30c9\u304c\u4f5c\u6210\u3055\u308c\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:command:\naws route53 list-resource-record-sets \\\n  --hosted-zone-id /hostedzone/${R53_ZONE_ID}\n```\n\n```json:result:\n{\n       \"ResourceRecordSets\": [\n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"ns-X.awsdns-XX.com.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXXX.awsdns-XX.co.uk.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXX.awsdns-XX.net.\"\n                   }, \n                   {\n                       \"Value\": \"ns-XXXX.awsdns-XX.org.\"\n                   }\n               ], \n               \"Type\": \"NS\", \n               \"Name\": \"example.jp.\", \n               \"TTL\": 172800\n           }, \n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"ns-8.awsdns-01.com. awsdns-hostmaster.amazon.com. 1 7200 900 1209600 86400\"\n                   }\n               ], \n               \"Type\": \"SOA\", \n               \"Name\": \"example.jp.\", \n               \"TTL\": 900\n           }, \n           {\n               \"ResourceRecords\": [\n                   {\n                       \"Value\": \"192.0.2.1\"\n                   }\n               ], \n               \"Type\": \"A\", \n               \"Name\": \"test.example.jp.\", \n               \"TTL\": 86400\n           }, \n           {\n               \"AliasTarget\": {\n                   \"HostedZoneId\": \"ZXXXXXXXXXXXXX\", \n                   \"EvaluateTargetHealth\": false, \n                   \"DNSName\": \"s3-website-us-east-1.amazonaws.com.\"\n               }, \n               \"Type\": \"A\", \n               \"Name\": \"www.example.jp.\"\n           }\n       ]\n}\n```\n\n* \u4eca\u56de\u4f5c\u6210\u3057\u305fA\u30a8\u30a4\u30ea\u30a2\u30b9\u30ec\u30b3\u30fc\u30c9\u306e\u767b\u9332\u5185\u5bb9\u306f\u3001\"Type\":\"A\"\u304c\u542b\u307e\u308c\u308b\u30d6\u30ed\u30c3\u30af\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n3. \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u3067\u306e\u540d\u524d\u89e3\u6c7a\u78ba\u8a8d\n===================================\n\n\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u63a5\u7d9a\u3055\u308c\u305f\u30db\u30b9\u30c8\u3067\u3001\u767b\u9332\u3057\u305fA\u30ec\u30b3\u30fc\u30c9\u304c\u540d\u524d\u89e3\u6c7a\u3067\u304d\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n```bash:command:\ndig ${R53_NODE_NAME} |grep ^${R53_NODE_NAME}\n```\n\n\n```text:result:\nwww.example.jp.               60      IN      A       xxx.xxx.xxx.xxx\n```\n\n\n4. \u30db\u30b9\u30c8\u3078\u306e\u30a2\u30af\u30bb\u30b9\u78ba\u8a8d\n=========================\n\n\u5b9f\u969b\u306b\u30db\u30b9\u30c8\u306b\u30a2\u30af\u30bb\u30b9\u3057\u3066\u307f\u307e\u3059\u3002(\u3053\u306e\u30cf\u30f3\u30ba\u30aa\u30f3\u3067\u306fping\u3092\u6253\u3063\u3066\u307f\u307e\u3059\u3002)\n\n```bash:command:\nping -c 3 ${R53_NODE_NAME}\n```\n\n```text:result:\n   PING test.example.jp (192.0.2.1): 56 data bytes\n   64 bytes from 192.0.2.1: icmp_seq=0 ttl=58 time=72.463 ms\n   64 bytes from 192.0.2.1: icmp_seq=1 ttl=58 time=12.172 ms\n   64 bytes from 192.0.2.1: icmp_seq=2 ttl=58 time=12.750 ms\n\n   --- test.example.jp ping statistics ---\n   3 packets transmitted, 3 packets received, 0.0% packet loss\n   round-trip min/avg/max/stddev = 12.172/32.462/72.463/28.286 ms\n```\n\n\u5b8c\u4e86\n====\n\n\u4ee5\u4e0a\u3067\u3001Route53\u3078\u306eA\u30ec\u30b3\u30fc\u30c9\u306e\u767b\u9332\u4f5c\u696d\u306f\u5b8c\u4e86\u3067\u3059\u3002\n", "tags": ["AWS", "aws-cli", "route53"]}