{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u672c\u8a18\u4e8b\u306f\u8907\u96d1\u306a\u69cb\u6210\u3092\u3068\u308brails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092docker\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\u3053\u308c\u307e\u3067\u306brails\u3092\u52d5\u4f5c\u3055\u305b\u308b\u30b3\u30f3\u30c6\u30ca\u306eDockerfile\u3092\u3069\u3046\u8a18\u8ff0\u3059\u308b\u306e\u304c\u826f\u3044\u304b\u3068\u3044\u3046\u89b3\u70b9\u3068\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ec\u30d3\u30e5\u30fc\u74b0\u5883\u3092docker\u3067\u69cb\u7bc9\u51fa\u6765\u308b\u304b\u3068\u3044\u3046\u691c\u8a3c\u306e\u4e8c\u3064\u306e\u8a18\u4e8b\u3092\u516c\u958b\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n\nrails\u3092docker\u3067\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306e\u69cb\u6210\u306f\u3069\u3046\u3059\u308b\u3079\u304d\u304b - Qiita\nDocker(pool)\u3092\u7528\u3044\u305f\u30d7\u30ec\u30d3\u30e5\u30fc\u74b0\u5883\u3092\u691c\u8a3c\u3059\u308b(rails\u30a2\u30d7\u30ea\u958b\u767a\u30c1\u30fc\u30e0\u306e\u6d3b\u7528\u4f8b) - Qiita\n\n\u5148\u306b\u516c\u958b\u3057\u305f\u4e8c\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5358\u72ec\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u8a00\u53ca\u3057\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u898f\u6a21\u304c\u5927\u304d\u304f\u306a\u308b\u3068rails\u5358\u4f53\u3060\u3051\u3067\u306f\u7121\u304f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306bmemcached\u3084redis, \u691c\u7d22\u306bsolr\u306belasticsearch, \u30d5\u30ed\u30f3\u30c8\u306b\u306fapache, nginx\u3068\u8907\u6570\u306e\u8981\u7d20\u3067\u4e00\u3064\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306a\u74b0\u5883\u3092\u51fa\u6765\u308b\u3060\u3051\u7c21\u5358\u305d\u3057\u3066\u7c21\u6f54\u306b\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u672c\u8a18\u4e8b\u306e\u76ee\u7684\u3067\u3059\u3002\n\n\u30b3\u30f3\u30bb\u30d7\u30c8\n\u8907\u6570\u306e\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u5927\u304d\u306a\u65b9\u5411\u6027\u3068\u3057\u3066\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u5168\u90e8\u5165\u308a\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3082\u306e\u3068\u3001\u5404\u6a5f\u80fd\u6bce\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3082\u306e\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\"\u5168\u90e8\u5165\u308a\"\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3068\u306a\u308b\u3068\u3001Dockerfile\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3054\u308a\u3054\u308a\u3068\u8a18\u8ff0\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\nDockerfile\u306e\u8a18\u8ff0\u306f\u8907\u96d1\u306b\u306a\u3089\u3056\u308b\u3092\u5f97\u305a\u3001\u5c11\u3057\u306e\u5909\u66f4\u3067\u30b3\u30f3\u30c6\u30ca\u5168\u4f53\u306e\u30d3\u30eb\u30c9\u3092\u3084\u308a\u76f4\u3059\u5fc5\u8981\u3082\u51fa\u3066\u304d\u307e\u3059\u3002\n\u305d\u3053\u3067\u672c\u8a18\u4e8b\u3067\u306f\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u6bce\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5206\u96e2\u3059\u308b\u65b9\u6cd5\u3092\u3068\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u304a\u3088\u3073\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3042\u308bdocker/compose\u3092\u7528\u3044\u307e\u3059\u3002\n\nFig\u306e\u958b\u767a\u5143\u3067\u3042\u308bOrchard Labs\u306fDocker Inc\u306b\u8cb7\u53ce\u3055\u308c\u305f\u305f\u3081\u3001fig\u306f\u4eca\u5f8c\u306fdocker-compose\u3068\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002(Releases \u00b7 docker/fig)\n\u672c\u8a18\u4e8b\u3067\u306f 1.1.0\u304c\u307e\u3060release candidate\u3067\u3042\u308b\u305f\u3081fig\u30b3\u30de\u30f3\u30c9\u306e\u307e\u307e\u3067\u3059\u304c\u3001\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u5f8c\u306b\u306ffig\u30b3\u30de\u30f3\u30c9\u3092docker-compose\u3068\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n2015/02/26\u8ffd\u8a18\uff1a1.1.0\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u305f\u306e\u3067docker-compose\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\u76ee\u6307\u3059\u69cb\u6210\u3068\u3057\u3066\u306f\u30d5\u30ed\u30f3\u30c8\u306bnginx, rails\u30a2\u30d7\u30ea\u306funicorn\u3092\u52d5\u4f5c\u3055\u305b\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u306fmysql\u3092\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u5168\u6587\u691c\u7d22\u3068\u3057\u3066redis, elasticsearch\u3092\u53d6\u308a\u6271\u3044\u307e\u3059\u3002\n\n\u691c\u8a3c\u74b0\u5883\n\u691c\u8a3c\u306fmac\u4e0a\u306bboot2docker\u3067docker\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u884c\u3063\u3066\u3044\u307e\u3059\u3002\ndocker\u306f1.5.0, docker-compose 1.0.1 \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n$ boot2docker version\nBoot2Docker-cli version: v1.5.0\nGit commit: ccd9032\n\n$ docker version\nClient version: 1.5.0\nClient API version: 1.17\nGo version (client): go1.4.1\nGit commit (client): a8a31ef\nOS/Arch (client): darwin/amd64\nServer version: 1.5.0\nServer API version: 1.17\nGo version (server): go1.4.1\nGit commit (server): a8a31ef\n\n$ docker-compose --version\ndocker-compose 1.1.0\n\n\u672c\u8a18\u4e8b\u3067\u63b2\u8f09\u3057\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5168\u4f53\u3092k-shogo/mini_doc at fig\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\nrails\u30b3\u30f3\u30c6\u30ca\n\u4e3b\u5f79\u306frails\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\u5f93\u3063\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3082rails\u304c\u30e1\u30a4\u30f3\u3067\u3001\u305d\u306e\u4e2d\u306b\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u3092\u542b\u3081\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nrails\u30a2\u30d7\u30ea\u306eDockerfile\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u8a2d\u7f6e\u3057\u307e\u3059\u3002\n\nDockerfile\nFROM ruby:2.2.0\n\nRUN apt-get update && apt-get install -y nodejs mysql-client --no-install-recommends && rm -rf /var/lib/apt/lists/*\n\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY Gemfile /usr/src/app/\nCOPY Gemfile.lock /usr/src/app/\nRUN bundle install -j4 --without development test\n\nCOPY . /usr/src/app\n\nEXPOSE 3000\nCMD [\"bundle\", \"exec\", \"unicorn\", \"-c\", \"config/unicorn.rb\"]\n\n\nruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u5834\u5408\u306b\u306fFROM\u306e\u516c\u5f0fruby\u30b3\u30f3\u30c6\u30ca\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u5bb9\u6613\u306b\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\n\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306bmysql\u3092\u9078\u629e\u3057\u305f\u3053\u3068\u3068\u3001assets\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u76ee\u7684\u3067 mysql-client\u3068node\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\nGemfile\u53ca\u3073Gemfile.lock\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30bd\u30fc\u30b9\u306e\u524d\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7528\u3044\u3066bundle install\u304c\u5fc5\u8981\u306a\u3044\u5834\u5408\u306b\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u9ad8\u901f\u5316\u3092\u56f3\u308b\u305f\u3081\u3067\u3059\u3002\nRUN bundle install\u3067Gemfile\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u304c\u3001development\u3084test\u30b0\u30eb\u30fc\u30d7\u3092\u9664\u5916\u3059\u308b\u304b\u306f\u597d\u307f\u3067\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306frails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306eDockerfile\u5185\u90e8\u3067\u306fdb:create\u3084db:migrate\u3092\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n\u3053\u308c\u306fdb\u306b\u95a2\u3059\u308brake\u30bf\u30b9\u30af\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u5b9f\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3067\u3042\u308a\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5358\u72ec\u3067\u3082\u30d3\u30eb\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\nGemfile\u306b\u306fmysql, redis, elasticsearch\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3001\u305d\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc\u3067\u3042\u308bunicorn\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nGemfile\n# database\ngem 'mysql2'\n\n# redis\ngem 'redis'\n\n# elasticsearch\ngem 'elasticsearch-model'\ngem 'elasticsearch-rails'\n\n# Use Unicorn as the app server\ngem 'unicorn'\n\n\n\n\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n\u69cb\u6210\u5168\u4f53\u306e\u8a2d\u5b9a\u3092\u5b9a\u7fa9\u3059\u308bdocker-compose.yml\u3082\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\ndocker-compose.yml\u3067\u306fmysql, elasticsearech, redis, nginx, rails\u305d\u3057\u3066datastore\u306e5\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067datastore\u306fData Volume Container\u30d1\u30bf\u30fc\u30f3\u3067\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u3068\u5171\u6709\u3092\u884c\u3046\u305f\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\n\u8a18\u8ff0\u65b9\u6cd5\u306e\u8a73\u7d30\u306fcompose/yml.md at 1.1.0 \u00b7 docker/compose\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\ndocker-compose.yml\nmysql:\n  image: mysql:5.6.23\n  environment:\n    MYSQL_ROOT_PASSWORD: 'pass'\n  ports:\n    - '3306:3306'\n  volumes_from:\n    - datastore\n\nelasticsearch:\n  build: containers/elasticsearch\n  ports:\n    - '9200:9200'\n    - '9300:9300'\n  volumes_from:\n    - datastore\n\nredis:\n  image: redis:2.8.19\n  ports:\n    - '6379:6379'\n  volumes_from:\n    - datastore\n\nnginx:\n  build: containers/nginx\n  ports:\n    - '8080:80'\n  volumes_from:\n    - datastore\n  links:\n    - rails\n\ndatastore:\n  build: containers/datastore\n\nrails:\n  build: .\n  ports:\n    - '3000:3000'\n  environment:\n    RAILS_ENV: preview\n    MYSQL_ROOT_PASSWORD: 'pass'\n    DATABASE_URL: mysql2://root:pass@mysql:3306\n    REDIS_URL: redis://redis:6379\n    ELASTICSEARCH_URL: http://elasticsearch:9200\n    SECRET_KEY_BASE: hogehoge\n  volumes_from:\n    - datastore\n  links:\n    - mysql\n    - elasticsearch\n    - redis\n\n\n\n\u30b5\u30fc\u30d3\u30b9\u6bce\u306e\u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\n\u307e\u305a\u306fimage\u3068build\u306b\u3064\u3044\u3066\u3002\nmysql\u3068redis\u306fimage\u306b\u3088\u3063\u3066docker hub\u306e\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\nelasticsearch\u306f\u65e5\u672c\u8a9e\u7528\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067\u3001build\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u81ea\u524d\u306eDockerfile\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u72ec\u81ea\u306eDockerfile\u306f\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u4ee5\u4e0b\u306bcontainers\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308a\u3001\u3055\u3089\u306b\u30b5\u30fc\u30d3\u30b9\u6bce\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5206\u5272\u3057\u3066\u3044\u307e\u3059\u3002\n- containers/                  \n |- datastore/                 \n  |  Dockerfile                \n |- elasticsearch/             \n  |  Dockerfile                \n |- nginx/                     \n  |  Dockerfile                \n  |  nginx.conf\n\n\ncontainers/elasticsearch/Dockerfile\nFROM elasticsearch:1.4.3\n\nRUN plugin install mobz/elasticsearch-head\nRUN plugin install elasticsearch/elasticsearch-analysis-kuromoji/2.4.2\n\n\nelasticsearch\u306eDockerfile\u306b\u3064\u3044\u3066\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u72ec\u81ea\u306e\u5b9a\u7fa9\u3068\u306f\u3044\u3063\u3066\u3082\u30d9\u30fc\u30b9\u306f\u516c\u5f0f\u306eelasticsearch\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u8ffd\u52a0\u3067\u5fc5\u8981\u306b\u306a\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u307f\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u610f\u56f3\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002\n\ncontainers/nginx/Dockerfile\nFROM nginx:1.7.9\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n\nnginx\u3082\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u3092\u30d9\u30fc\u30b9\u306b\u3057\u307e\u3059\u3002\njs, css\u306a\u3069\u306e\u9759\u7684\u30a2\u30bb\u30c3\u30c8\u3092\u914d\u4fe1\u3057\u3064\u3064\u3001unicorn\u306b\u5bfe\u3057\u3066\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u3082\u52d5\u4f5c\u3055\u305b\u308b\u306e\u3067\u3001\u3053\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\nmysql\u3084redis\u3082\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u306b\u8a2d\u5b9a\u3092\u4e0a\u66f8\u304d\u3059\u308b\u904b\u7528\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\ndocker-compose.yml\u306elinks\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u306e\u65b9\u5411\u6027\u306f nginx -> rails -> (mysql, redis, elasticsearch)\u306e\u305f\u3081\u3001nginx\u306elinks\u306b\u306frails\u3092\u3001rails\u306elinks\u306b\u306fmysql, redis, elasticsearch\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u3055\u3066\u3001rails\u306edatabase.yml\u3092\u6307\u5b9a\u3059\u308b\u3068\u304d\u306b\u306f\u3069\u3046\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3002\ndocker\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\u306e\u5834\u5408\u3001MYSQL_PORT_3306_TCP_ADDR\u306e\u3088\u3046\u306adocker\u304c\u81ea\u52d5\u7684\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u308b\u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\u4f8b\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u3053\u308c\u306f\u5f97\u7b56\u3068\u306f\u3044\u3048\u307e\u305b\u3093\u3002\nredis\u3078\u306e\u63a5\u7d9a\u3092\u4f8b\u306b\u8003\u3048\u3066\u307f\u308b\u3068\u3001REDIS_PORT_6379_TCP_ADDR\u306e\u3088\u3046\u306a\u74b0\u5883\u5909\u6570\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u306e\u4f7f\u3044\u306b\u304f\u3044\u74b0\u5883\u5909\u6570\u3092\u6d3b\u7528\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001config/initializers/redis.rb\u7b49\u3067\u5207\u308a\u5206\u3051\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\nconfig/initializers/redis.rb\nif Rails.env.docker?\n  # docker\u74b0\u5883\u306e\u5834\u5408\n  Redis.current = Redis.new host: ['REDIS_PORT_6379_TCP_ADDR'], port: ENV['REDIS_PORT_6379_TCP_PORT']\nelse\n  # \u305d\u308c\u4ee5\u5916\u306e\u5834\u5408...\nend\n\n\n\u3053\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u3057\u306a\u3044\u305f\u3081\u306e\u8a2d\u5b9a\u304crails\u306eenvironment\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u3059\u3002\nDATABASE_URL: mysql2://root:pass@mysql:3306\nREDIS_URL: redis://redis:6379\nELASTICSEARCH_URL: http://elasticsearch:9200\n\ndocker-compose\u3067link\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001hosts\u306b\u4ed6\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n$ docker-compose run rails cat /etc/hosts\n172.17.2.69 6866a8e73892\n127.0.0.1   localhost\n::1 localhost ip6-localhost ip6-loopback\nfe00::0 ip6-localnet\nff00::0 ip6-mcastprefix\nff02::1 ip6-allnodes\nff02::2 ip6-allrouters\n172.17.2.66 minidoc_elasticsearch_1\n172.17.2.67 minidoc_redis_1\n172.17.2.67 redis\n172.17.2.67 redis_1\n172.17.2.66 elasticsearch\n172.17.2.66 elasticsearch_1\n172.17.2.65 mysql_1\n172.17.2.65 minidoc_mysql_1\n172.17.2.65 mysql\n\n\u76f4\u63a5rails\u304b\u3089hosts\u306e\u5024\u3092\u7528\u3044\u3066\u3082\u826f\u3044\u3067\u3059\u304c\u3001environment\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u6574\u7406\u3057\u3066rails\u306b\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u6e21\u3059\u3053\u3068\u3067\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306a\u3069\u306e\u4ed6\u74b0\u5883\u306b\u79fb\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070redis, elasticsearch\u306fgem\u306e\u8a2d\u8a08\u3068\u3057\u3066\u3001\u305d\u308c\u305e\u308c REDIS_URL, ELASTICSEARCH_URL\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u305f\u5834\u5408\u306b\u63a5\u7d9a\u5148\u3068\u3057\u3066\u7528\u3044\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3089\u306b\u5408\u308f\u305b\u308b\u3053\u3068\u3067docker\u74b0\u5883\u3067\u3082\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3067\u3082\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\ndatabase.yaml\u3067\u3082\u74b0\u5883\u5909\u6570DATABASE_URL\u3067\u63a5\u7d9a\u60c5\u5831\u3092\u6e21\u3059\u3068\u6c7a\u3081\u3066\u3044\u308c\u3070\u74b0\u5883\u306e\u5207\u308a\u66ff\u3048\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\ndatabase.yml\ndefault: &default\n  adapter: mysql2\n  encoding: utf8\n  pool: 5\n\ndevelopment:\n  <<: *default\n  database: minidoc_development\n  username: root\n  password:\n  host: localhost\n\ntest:\n  <<: *default\n  database: minidoc_test\n  username: root\n  password:\n  host: localhost\n\npreview:\n  <<: *default\n  database: minidoc_preview\n  url: <%= ENV['DATABASE_URL'] %>\n\nproduction:\n  <<: *default\n  database: minidoc_production\n  url: <%= ENV['DATABASE_URL'] %>\n\n\n\n\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\n\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u6c38\u7d9a\u5316\u3001\u5171\u6709\u3057\u305f\u3044\u30d1\u30b9\u3092VOLUME\u30b3\u30de\u30f3\u30c9\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\ncontainers/datastore/Dockerfile\nFROM busybox:latest\n\nVOLUME /var/lib/mysql\nVOLUME /usr/share/elasticsearch/data\nVOLUME /data\nVOLUME /usr/src/app/public\nVOLUME /usr/src/app/log\n\nCMD /bin/sh\n\n\nmysql\u3084elasticsearch\u7528\u306b\u306f\u6c38\u7d9a\u5316\u3059\u308b\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306e\u30dd\u30a4\u30f3\u30c8\u306frails\u304c\u751f\u6210\u3059\u308bassets\u306e\u6271\u3044\u3067\u3059\u3002\n\u4eca\u56de\u30d5\u30ed\u30f3\u30c8\u306enginx\u304b\u3089\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u4fe1\u3057\u305f\u3044\u306e\u3067\u3001\u30a2\u30bb\u30c3\u30c8\u3092nginx\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\u3082\u3061\u308d\u3093\u30ed\u30fc\u30ab\u30eb\u3067assets:precompile\u3057\u305f\u3082\u306e\u3092nginx\u30b3\u30f3\u30c6\u30ca\u306bADD\u3059\u308b\u65b9\u6cd5\u3082\u3068\u308c\u307e\u3059\u3002\n\u305d\u306e\u5834\u5408\u3001\u30ed\u30fc\u30ab\u30eb\u306bnode.js\u7b49\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u304f\u308b\u305f\u3081\u3001\u4eca\u56de\u306e\u4f8b\u3067\u306fnode\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308brails\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u884c\u3044\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u6709\u3057\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u3088\u3063\u3066nginx\u304b\u3089\u8aad\u307f\u51fa\u3059\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306e\u30d1\u30b9\u304c/usr/src/app/public\u3067\u3059\u3002\nnginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\ncontainers/nginx/nginx.conf\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n  worker_connections 1024; # increase if you have lots of clients\n  accept_mutex off; # \"on\" if nginx worker_processes > 1\n}\n\nhttp {\n  include mime.types;\n  default_type application/octet-stream;\n  log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n  access_log  /var/log/nginx/access.log  main;\n\n  sendfile on;\n\n  tcp_nopush on; # off may be better for *some* Comet/long-poll stuff\n  tcp_nodelay off; # on may be better for some Comet/long-poll stuff\n\n  gzip on;\n  gzip_http_version 1.0;\n  gzip_proxied any;\n  gzip_min_length 500;\n  gzip_disable \"MSIE [1-6]\\.\";\n  gzip_types text/plain text/html text/xml text/css\n             text/comma-separated-values\n             text/javascript application/x-javascript\n             application/atom+xml;\n\n  upstream app_server {\n    # for UNIX domain socket setups:\n    # server unix:/path/to/.unicorn.sock fail_timeout=0;\n\n    # for TCP setups, point these to your backend servers\n    # server 192.168.0.7:8080 fail_timeout=0;\n    server rails:3000 fail_timeout=0;\n  }\n\n  server {\n    listen       80;\n    server_name  localhost;\n    client_max_body_size 4G;\n    keepalive_timeout 5;\n\n    # path for static files\n    root /usr/src/app/public;\n\n    try_files $uri/index.html $uri.html $uri @app;\n\n    location @app {\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header Host $http_host;\n      proxy_redirect off;\n      proxy_pass http://app_server;\n    }\n\n    # Rails error pages\n    error_page 500 502 503 504 /500.html;\n    location = /500.html {\n      root /usr/src/app/public;\n    }\n  }\n}\n\n\n\u30dd\u30a4\u30f3\u30c8\u306froot /usr/src/app/public;\u306e\u90e8\u5206\u3067\u3059\u3002\n/usr/src/app\u306frails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u5834\u6240\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081rails\u30b3\u30f3\u30c6\u30ca\u3067rake assets:precompile\u3059\u308b\u3068/usr/src/app/public\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u30a2\u30bb\u30c3\u30c8\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u30d1\u30b9\u3092\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3059\u308b\u3053\u3068\u3067nginx\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u8aad\u307f\u51fa\u3059\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n\u305d\u306e\u4ed6\u8a2d\u5b9a dockerignore\ndockerignore\u30d5\u30a1\u30a4\u30eb\u3082\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u30ed\u30b0\u3084\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u9664\u5916\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5909\u66f4\u3060\u3068\u898b\u306a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n.dockerignore\n## Rails\npublic/assets/*\n\n## Environment normalisation:\n.bundle\nvendor/bundle\n.git\n\n## log\nlog\ntmp\n\n## OSX\n.DS_Store\n\n## docker\n.dockerignore\ncontainers\n\n\n\n\u30d3\u30eb\u30c9 & \u5b9f\u884c\n\u4e00\u6c17\u306b\u30d3\u30eb\u30c9\u3059\u308b\u4e8b\u3082\u51fa\u6765\u307e\u3059\u3057\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n$ docker-compose build\n$ docker-compose build rails\n\nrake\u30bf\u30b9\u30af\u306a\u3069\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306fdocker-compose run rails\u306b\u7d9a\u3051\u3066\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\ndocker-compose.yml\u306e\u306a\u304b\u3067RAILS_ENV\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u305d\u306eRails.env\u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002\n$ docker-compose run rails rake db:create\n$ docker-compose run rails rake db:migrate\n$ docker-compose run rails rake db:seed_fu\n$ docker-compose run rails rake assets:precompile\n\ndocker-compose up\u3067\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4e00\u6c17\u306b\u7acb\u3061\u4e0a\u3052\u307e\u3057\u3087\u3046\u3002\n$ docker-compose up\n\n\u3042\u3068\u306fboot2docker ip\u3067\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3001\u4eca\u56de\u306e\u5834\u5408\u306fnginx\u306e80\u30688080\u756a\u3092\u7e4b\u3044\u3067\u3044\u308b\u306e\u3067\u3001http://192.168.59.103:8080 \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\uff08IP\u30a2\u30c9\u30ec\u30b9\u306f\u4eba\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\uff09\n\n\u307e\u3068\u3081\n\u672c\u8a18\u4e8b\u3067\u306f\u8907\u96d1\u306a\u69cb\u6210\u306erails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092docker\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306frails\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308c\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u76f8\u5f53\u3067\u7a3c\u50cd\u3055\u305b\u308b\u4f8b\u3067\u3057\u305f\u3002\n\u672c\u756a\u74b0\u5883\u3082docker\u3067\u904b\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u305f\u306a\u3089\u3001\u30d3\u30eb\u30c9\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u672c\u756a\u306b\u6301\u3063\u3066\u884c\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3067\u3059\u3002\n\u958b\u767a\u74b0\u5883\u3067\u4f7f\u3044\u305f\u3044\u3001\u3064\u307e\u308a\u30ed\u30fc\u30ab\u30eb\u3067\u30b3\u30fc\u30c9\u3092\u7de8\u96c6\u3057\u3001\u7d50\u679c\u3092\u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3055\u305b\u3066\u3044\u308brails\u3067\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306f\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u3092Data Volume\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u904b\u7528\u3082\u51fa\u6765\u308b\u3067\u3057\u3087\u3046\u3002\n\u3053\u306e\u65b9\u6cd5\u306a\u3089docker build\u3084\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066rsync\u7b49\u3059\u308b\u3053\u3068\u7121\u304f\u30b3\u30fc\u30c9\u306e\u53cd\u6620\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\ndocker\u3092\u7528\u3044\u305f\u74b0\u5883\u306e\u69cb\u7bc9\u3067\u306f\u3001rails\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3081\u3089\u308c\u308b\u3053\u3068\u3001\u958b\u767a\u74b0\u5883\u3092\u8907\u6570\u958b\u767a\u8005\u3067\u63c3\u3048\u3089\u308c\u308b\u3053\u3068\u3001\u305d\u3057\u3066\u5bb9\u6613\u306b\u74b0\u5883\u306e\u7834\u68c4\u304c\u53ef\u80fd\u306b\u306a\u308b\u3053\u3068\uff08\u4f8b\u3048\u3070\u30d6\u30e9\u30f3\u30c1\u306e\u5207\u308a\u66ff\u3048\u6642\u306b\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u3092\u5dee\u3057\u66ff\u3048\u308b\u306a\u3069\uff09\u306e\u30e1\u30ea\u30c3\u30c8\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\n\n\u672c\u8a18\u4e8b\u306f\u8907\u96d1\u306a\u69cb\u6210\u3092\u3068\u308brails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092docker\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u3066\u3044\u307e\u3059\u3002\n\n\u3053\u308c\u307e\u3067\u306brails\u3092\u52d5\u4f5c\u3055\u305b\u308b\u30b3\u30f3\u30c6\u30ca\u306eDockerfile\u3092\u3069\u3046\u8a18\u8ff0\u3059\u308b\u306e\u304c\u826f\u3044\u304b\u3068\u3044\u3046\u89b3\u70b9\u3068\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ec\u30d3\u30e5\u30fc\u74b0\u5883\u3092docker\u3067\u69cb\u7bc9\u51fa\u6765\u308b\u304b\u3068\u3044\u3046\u691c\u8a3c\u306e\u4e8c\u3064\u306e\u8a18\u4e8b\u3092\u516c\u958b\u3057\u3066\u3044\u307e\u3057\u305f\u3002\n\n* [rails\u3092docker\u3067\u52d5\u304b\u3057\u305f\u3044\u5834\u5408\u306e\u69cb\u6210\u306f\u3069\u3046\u3059\u308b\u3079\u304d\u304b - Qiita](http://qiita.com/k-shogo/items/592e243f9763d0c3b10a)\n* [Docker(pool)\u3092\u7528\u3044\u305f\u30d7\u30ec\u30d3\u30e5\u30fc\u74b0\u5883\u3092\u691c\u8a3c\u3059\u308b(rails\u30a2\u30d7\u30ea\u958b\u767a\u30c1\u30fc\u30e0\u306e\u6d3b\u7528\u4f8b) - Qiita](http://qiita.com/k-shogo/items/cc47e448fa0c07ac3189)\n\n\u5148\u306b\u516c\u958b\u3057\u305f\u4e8c\u3064\u306e\u8a18\u4e8b\u3067\u306f\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u5358\u72ec\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u8a00\u53ca\u3057\u3066\u3044\u307e\u3059\u3002\n\u3057\u304b\u3057\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u898f\u6a21\u304c\u5927\u304d\u304f\u306a\u308b\u3068rails\u5358\u4f53\u3060\u3051\u3067\u306f\u7121\u304f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306bmemcached\u3084redis, \u691c\u7d22\u306bsolr\u306belasticsearch, \u30d5\u30ed\u30f3\u30c8\u306b\u306fapache, nginx\u3068\u8907\u6570\u306e\u8981\u7d20\u3067\u4e00\u3064\u306e\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u306a\u3063\u3066\u304d\u307e\u3059\u3002\n\u3053\u306e\u3088\u3046\u306a\u74b0\u5883\u3092\u51fa\u6765\u308b\u3060\u3051\u7c21\u5358\u305d\u3057\u3066\u7c21\u6f54\u306b\u69cb\u7bc9\u3059\u308b\u3053\u3068\u304c\u672c\u8a18\u4e8b\u306e\u76ee\u7684\u3067\u3059\u3002\n\n# \u30b3\u30f3\u30bb\u30d7\u30c8\n\u8907\u6570\u306e\u30b5\u30fc\u30d3\u30b9\u304b\u3089\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u5927\u304d\u306a\u65b9\u5411\u6027\u3068\u3057\u3066\u306f\u3001\u30b5\u30fc\u30d3\u30b9\u5168\u90e8\u5165\u308a\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3082\u306e\u3068\u3001\u5404\u6a5f\u80fd\u6bce\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3082\u306e\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n\"\u5168\u90e8\u5165\u308a\"\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u7528\u610f\u3059\u308b\u3068\u306a\u308b\u3068\u3001Dockerfile\u306b\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3092\u3054\u308a\u3054\u308a\u3068\u8a18\u8ff0\u3057\u3066\u3044\u304f\u3053\u3068\u306b\u306a\u308b\u3067\u3057\u3087\u3046\u3002\nDockerfile\u306e\u8a18\u8ff0\u306f\u8907\u96d1\u306b\u306a\u3089\u3056\u308b\u3092\u5f97\u305a\u3001\u5c11\u3057\u306e\u5909\u66f4\u3067\u30b3\u30f3\u30c6\u30ca\u5168\u4f53\u306e\u30d3\u30eb\u30c9\u3092\u3084\u308a\u76f4\u3059\u5fc5\u8981\u3082\u51fa\u3066\u304d\u307e\u3059\u3002\n\u305d\u3053\u3067\u672c\u8a18\u4e8b\u3067\u306f\u3001\u5404\u30b5\u30fc\u30d3\u30b9\u6bce\u306b\u30b3\u30f3\u30c6\u30ca\u3092\u5206\u96e2\u3059\u308b\u65b9\u6cd5\u3092\u3068\u308a\u307e\u3059\u3002\n\u4eca\u56de\u306f\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u304a\u3088\u3073\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u30c4\u30fc\u30eb\u3067\u3042\u308b[docker/compose](https://github.com/docker/compose)\u3092\u7528\u3044\u307e\u3059\u3002\n\n> Fig\u306e\u958b\u767a\u5143\u3067\u3042\u308bOrchard Labs\u306fDocker Inc\u306b\u8cb7\u53ce\u3055\u308c\u305f\u305f\u3081\u3001fig\u306f\u4eca\u5f8c\u306fdocker-compose\u3068\u3057\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002([Releases \u00b7 docker/fig](https://github.com/docker/fig/releases))\n\u672c\u8a18\u4e8b\u3067\u306f 1.1.0\u304c\u307e\u3060release candidate\u3067\u3042\u308b\u305f\u3081fig\u30b3\u30de\u30f3\u30c9\u306e\u307e\u307e\u3067\u3059\u304c\u3001\u6b63\u5f0f\u30ea\u30ea\u30fc\u30b9\u5f8c\u306b\u306f`fig`\u30b3\u30de\u30f3\u30c9\u3092`docker-compose`\u3068\u8aad\u307f\u66ff\u3048\u3066\u304f\u3060\u3055\u3044\u3002\n\n2015/02/26\u8ffd\u8a18\uff1a1.1.0\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u3066\u3044\u305f\u306e\u3067docker-compose\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\u76ee\u6307\u3059\u69cb\u6210\u3068\u3057\u3066\u306f\u30d5\u30ed\u30f3\u30c8\u306bnginx, rails\u30a2\u30d7\u30ea\u306funicorn\u3092\u52d5\u4f5c\u3055\u305b\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u306fmysql\u3092\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3068\u5168\u6587\u691c\u7d22\u3068\u3057\u3066redis, elasticsearch\u3092\u53d6\u308a\u6271\u3044\u307e\u3059\u3002\n\n# \u691c\u8a3c\u74b0\u5883\n\n\u691c\u8a3c\u306fmac\u4e0a\u306bboot2docker\u3067docker\u74b0\u5883\u3092\u69cb\u7bc9\u3057\u3066\u884c\u3063\u3066\u3044\u307e\u3059\u3002\ndocker\u306f1.5.0, docker-compose 1.0.1 \u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\n```shell\n$ boot2docker version\nBoot2Docker-cli version: v1.5.0\nGit commit: ccd9032\n\n$ docker version\nClient version: 1.5.0\nClient API version: 1.17\nGo version (client): go1.4.1\nGit commit (client): a8a31ef\nOS/Arch (client): darwin/amd64\nServer version: 1.5.0\nServer API version: 1.17\nGo version (server): go1.4.1\nGit commit (server): a8a31ef\n\n$ docker-compose --version\ndocker-compose 1.1.0\n```\n\n\u672c\u8a18\u4e8b\u3067\u63b2\u8f09\u3057\u3066\u3044\u308b\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9\u306e\u5168\u4f53\u3092[k-shogo/mini_doc at fig](https://github.com/k-shogo/mini_doc/tree/fig)\u3067\u516c\u958b\u3057\u3066\u3044\u307e\u3059\u3002\n\n# rails\u30b3\u30f3\u30c6\u30ca\n\n\u4e3b\u5f79\u306frails\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\u5f93\u3063\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3082rails\u304c\u30e1\u30a4\u30f3\u3067\u3001\u305d\u306e\u4e2d\u306b\u4ed6\u306e\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u3092\u542b\u3081\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\nrails\u30a2\u30d7\u30ea\u306eDockerfile\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u306b\u8a2d\u7f6e\u3057\u307e\u3059\u3002\n\n```shell:Dockerfile\nFROM ruby:2.2.0\n\nRUN apt-get update && apt-get install -y nodejs mysql-client --no-install-recommends && rm -rf /var/lib/apt/lists/*\n\nRUN mkdir -p /usr/src/app\nWORKDIR /usr/src/app\n\nCOPY Gemfile /usr/src/app/\nCOPY Gemfile.lock /usr/src/app/\nRUN bundle install -j4 --without development test\n\nCOPY . /usr/src/app\n\nEXPOSE 3000\nCMD [\"bundle\", \"exec\", \"unicorn\", \"-c\", \"config/unicorn.rb\"]\n```\n\nruby\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u5207\u308a\u66ff\u3048\u308b\u5834\u5408\u306b\u306f`FROM`\u306e\u516c\u5f0fruby\u30b3\u30f3\u30c6\u30ca\u3092\u5207\u308a\u66ff\u3048\u308b\u3053\u3068\u3067\u5bb9\u6613\u306b\u5bfe\u5fdc\u53ef\u80fd\u3067\u3059\u3002\n\u4eca\u56de\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306bmysql\u3092\u9078\u629e\u3057\u305f\u3053\u3068\u3068\u3001assets\u306e\u30b3\u30f3\u30d1\u30a4\u30eb\u76ee\u7684\u3067 mysql-client\u3068node\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u307e\u3059\u3002\n`Gemfile`\u53ca\u3073`Gemfile.lock`\u3092\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30bd\u30fc\u30b9\u306e\u524d\u306b\u8ffd\u52a0\u3057\u3066\u3044\u308b\u306e\u306f\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u7528\u3044\u3066bundle install\u304c\u5fc5\u8981\u306a\u3044\u5834\u5408\u306b\u30b9\u30ad\u30c3\u30d7\u3057\u3066\u9ad8\u901f\u5316\u3092\u56f3\u308b\u305f\u3081\u3067\u3059\u3002\n`RUN bundle install`\u3067Gemfile\u306b\u8a18\u8ff0\u3055\u308c\u305f\u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u304c\u3001`development`\u3084`test`\u30b0\u30eb\u30fc\u30d7\u3092\u9664\u5916\u3059\u308b\u304b\u306f\u597d\u307f\u3067\u5909\u66f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u4eca\u56de\u306frails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306eDockerfile\u5185\u90e8\u3067\u306f`db:create`\u3084`db:migrate`\u3092\u884c\u3063\u3066\u3044\u307e\u305b\u3093\u3002\n\u3053\u308c\u306fdb\u306b\u95a2\u3059\u308brake\u30bf\u30b9\u30af\u306f\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u3055\u308c\u3066\u3044\u306a\u3051\u308c\u3070\u5b9f\u884c\u3067\u304d\u306a\u3044\u305f\u3081\u3067\u3042\u308a\u3001rails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u5358\u72ec\u3067\u3082\u30d3\u30eb\u30c9\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u3067\u3059\u3002\n\nGemfile\u306b\u306fmysql, redis, elasticsearch\u306b\u63a5\u7d9a\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3001\u305d\u3057\u3066\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d0\u30fc\u3067\u3042\u308bunicorn\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```ruby:Gemfile\n# database\ngem 'mysql2'\n\n# redis\ngem 'redis'\n\n# elasticsearch\ngem 'elasticsearch-model'\ngem 'elasticsearch-rails'\n\n# Use Unicorn as the app server\ngem 'unicorn'\n```\n\n# \u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n\n\u69cb\u6210\u5168\u4f53\u306e\u8a2d\u5b9a\u3092\u5b9a\u7fa9\u3059\u308bdocker-compose.yml\u3082\u30eb\u30fc\u30c8\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u7f6e\u3044\u3066\u304a\u304d\u307e\u3059\u3002\ndocker-compose.yml\u3067\u306fmysql, elasticsearech, redis, nginx, rails\u305d\u3057\u3066datastore\u306e5\u3064\u306e\u30b3\u30f3\u30c6\u30ca\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\u3053\u3053\u3067datastore\u306fData Volume Container\u30d1\u30bf\u30fc\u30f3\u3067\u30c7\u30fc\u30bf\u306e\u6c38\u7d9a\u5316\u3068\u5171\u6709\u3092\u884c\u3046\u305f\u3081\u306e\u30b3\u30f3\u30c6\u30ca\u3067\u3059\u3002\n\u8a18\u8ff0\u65b9\u6cd5\u306e\u8a73\u7d30\u306f[compose/yml.md at 1.1.0 \u00b7 docker/compose](https://github.com/docker/compose/blob/1.1.0/docs/yml.md)\u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n```yaml:docker-compose.yml\nmysql:\n  image: mysql:5.6.23\n  environment:\n    MYSQL_ROOT_PASSWORD: 'pass'\n  ports:\n    - '3306:3306'\n  volumes_from:\n    - datastore\n\nelasticsearch:\n  build: containers/elasticsearch\n  ports:\n    - '9200:9200'\n    - '9300:9300'\n  volumes_from:\n    - datastore\n\nredis:\n  image: redis:2.8.19\n  ports:\n    - '6379:6379'\n  volumes_from:\n    - datastore\n\nnginx:\n  build: containers/nginx\n  ports:\n    - '8080:80'\n  volumes_from:\n    - datastore\n  links:\n    - rails\n\ndatastore:\n  build: containers/datastore\n\nrails:\n  build: .\n  ports:\n    - '3000:3000'\n  environment:\n    RAILS_ENV: preview\n    MYSQL_ROOT_PASSWORD: 'pass'\n    DATABASE_URL: mysql2://root:pass@mysql:3306\n    REDIS_URL: redis://redis:6379\n    ELASTICSEARCH_URL: http://elasticsearch:9200\n    SECRET_KEY_BASE: hogehoge\n  volumes_from:\n    - datastore\n  links:\n    - mysql\n    - elasticsearch\n    - redis\n```\n\n## \u30b5\u30fc\u30d3\u30b9\u6bce\u306e\u30b3\u30f3\u30c6\u30ca\u5b9a\u7fa9\n\n\u307e\u305a\u306fimage\u3068build\u306b\u3064\u3044\u3066\u3002\nmysql\u3068redis\u306fimage\u306b\u3088\u3063\u3066[docker hub\u306e\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8](https://registry.hub.docker.com/repos/stackbrew/)\u3092\u53d6\u5f97\u3057\u3066\u3044\u307e\u3059\u3002\nelasticsearch\u306f\u65e5\u672c\u8a9e\u7528\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u5c0e\u5165\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u3092\u4f7f\u3044\u305f\u304b\u3063\u305f\u306e\u3067\u3001build\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u81ea\u524d\u306eDockerfile\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\u4eca\u56de\u306f\u72ec\u81ea\u306eDockerfile\u306f\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30eb\u30fc\u30c8\u4ee5\u4e0b\u306bcontainers\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u308a\u3001\u3055\u3089\u306b\u30b5\u30fc\u30d3\u30b9\u6bce\u306b\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u5206\u5272\u3057\u3066\u3044\u307e\u3059\u3002\n\n```shell\n- containers/                  \n |- datastore/                 \n  |  Dockerfile                \n |- elasticsearch/             \n  |  Dockerfile                \n |- nginx/                     \n  |  Dockerfile                \n  |  nginx.conf\n```\n\n```shell:containers/elasticsearch/Dockerfile\nFROM elasticsearch:1.4.3\n\nRUN plugin install mobz/elasticsearch-head\nRUN plugin install elasticsearch/elasticsearch-analysis-kuromoji/2.4.2\n```\n\nelasticsearch\u306eDockerfile\u306b\u3064\u3044\u3066\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\u72ec\u81ea\u306e\u5b9a\u7fa9\u3068\u306f\u3044\u3063\u3066\u3082\u30d9\u30fc\u30b9\u306f\u516c\u5f0f\u306eelasticsearch\u3092\u5229\u7528\u3057\u3066\u3044\u307e\u3059\u3002\n\u8ffd\u52a0\u3067\u5fc5\u8981\u306b\u306a\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306e\u307f\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u610f\u56f3\u304c\u660e\u78ba\u306b\u306a\u308a\u307e\u3059\u3002\n\n```shell:containers/nginx/Dockerfile\nFROM nginx:1.7.9\nCOPY nginx.conf /etc/nginx/nginx.conf\n```\n\nnginx\u3082\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u3092\u30d9\u30fc\u30b9\u306b\u3057\u307e\u3059\u3002\njs, css\u306a\u3069\u306e\u9759\u7684\u30a2\u30bb\u30c3\u30c8\u3092\u914d\u4fe1\u3057\u3064\u3064\u3001unicorn\u306b\u5bfe\u3057\u3066\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3068\u3057\u3066\u3082\u52d5\u4f5c\u3055\u305b\u308b\u306e\u3067\u3001\u3053\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u306f\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\nmysql\u3084redis\u3082\u8a2d\u5b9a\u3092\u5909\u66f4\u3057\u305f\u3044\u5834\u5408\u306f\u516c\u5f0f\u30a4\u30e1\u30fc\u30b8\u306b\u8a2d\u5b9a\u3092\u4e0a\u66f8\u304d\u3059\u308b\u904b\u7528\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002\n\n## \u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\n\ndocker-compose.yml\u306elinks\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u306f\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\u30a2\u30af\u30bb\u30b9\u306e\u65b9\u5411\u6027\u306f nginx -> rails -> (mysql, redis, elasticsearch)\u306e\u305f\u3081\u3001nginx\u306elinks\u306b\u306frails\u3092\u3001rails\u306elinks\u306b\u306fmysql, redis, elasticsearch\u3092\u6307\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\n\n\u3055\u3066\u3001rails\u306edatabase.yml\u3092\u6307\u5b9a\u3059\u308b\u3068\u304d\u306b\u306f\u3069\u3046\u3059\u308b\u3067\u3057\u3087\u3046\u304b\u3002\ndocker\u306e\u30b3\u30f3\u30c6\u30ca\u9593\u306e\u30ea\u30f3\u30af\u306e\u5834\u5408\u3001`MYSQL_PORT_3306_TCP_ADDR`\u306e\u3088\u3046\u306adocker\u304c\u81ea\u52d5\u7684\u306b\u8a2d\u5b9a\u3057\u3066\u304f\u308c\u308b\u74b0\u5883\u5909\u6570\u3092\u7528\u3044\u308b\u4f8b\u304c\u51fa\u3066\u304d\u307e\u3059\u3002\n\u3057\u304b\u3057\u3053\u308c\u306f\u5f97\u7b56\u3068\u306f\u3044\u3048\u307e\u305b\u3093\u3002\nredis\u3078\u306e\u63a5\u7d9a\u3092\u4f8b\u306b\u8003\u3048\u3066\u307f\u308b\u3068\u3001`REDIS_PORT_6379_TCP_ADDR`\u306e\u3088\u3046\u306a\u74b0\u5883\u5909\u6570\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u3053\u306e\u4f7f\u3044\u306b\u304f\u3044\u74b0\u5883\u5909\u6570\u3092\u6d3b\u7528\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001`config/initializers/redis.rb`\u7b49\u3067\u5207\u308a\u5206\u3051\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n```ruby:config/initializers/redis.rb\nif Rails.env.docker?\n  # docker\u74b0\u5883\u306e\u5834\u5408\n  Redis.current = Redis.new host: ['REDIS_PORT_6379_TCP_ADDR'], port: ENV['REDIS_PORT_6379_TCP_PORT']\nelse\n  # \u305d\u308c\u4ee5\u5916\u306e\u5834\u5408...\nend\n```\n\n\u3053\u306e\u3088\u3046\u306a\u8a18\u8ff0\u3092\u3057\u306a\u3044\u305f\u3081\u306e\u8a2d\u5b9a\u304crails\u306eenvironment\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u3059\u3002\n\n```yaml\nDATABASE_URL: mysql2://root:pass@mysql:3306\nREDIS_URL: redis://redis:6379\nELASTICSEARCH_URL: http://elasticsearch:9200\n```\n\ndocker-compose\u3067link\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3092\u6307\u5b9a\u3059\u308b\u3068\u3001hosts\u306b\u4ed6\u30b3\u30f3\u30c6\u30ca\u306e\u8a2d\u5b9a\u304c\u8ffd\u52a0\u3055\u308c\u307e\u3059\u3002\n\n```shell\n$ docker-compose run rails cat /etc/hosts\n172.17.2.69\t6866a8e73892\n127.0.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nff00::0\tip6-mcastprefix\nff02::1\tip6-allnodes\nff02::2\tip6-allrouters\n172.17.2.66\tminidoc_elasticsearch_1\n172.17.2.67\tminidoc_redis_1\n172.17.2.67\tredis\n172.17.2.67\tredis_1\n172.17.2.66\telasticsearch\n172.17.2.66\telasticsearch_1\n172.17.2.65\tmysql_1\n172.17.2.65\tminidoc_mysql_1\n172.17.2.65\tmysql\n```\n\n\u76f4\u63a5rails\u304b\u3089hosts\u306e\u5024\u3092\u7528\u3044\u3066\u3082\u826f\u3044\u3067\u3059\u304c\u3001environment\u30c7\u30a3\u30ec\u30af\u30c6\u30a3\u30d6\u3067\u6574\u7406\u3057\u3066rails\u306b\u74b0\u5883\u5909\u6570\u3068\u3057\u3066\u6e21\u3059\u3053\u3068\u3067\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u306a\u3069\u306e\u4ed6\u74b0\u5883\u306b\u79fb\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\n\u4f8b\u3048\u3070redis, elasticsearch\u306fgem\u306e\u8a2d\u8a08\u3068\u3057\u3066\u3001\u305d\u308c\u305e\u308c `REDIS_URL`, `ELASTICSEARCH_URL`\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u305f\u5834\u5408\u306b\u63a5\u7d9a\u5148\u3068\u3057\u3066\u7528\u3044\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3089\u306b\u5408\u308f\u305b\u308b\u3053\u3068\u3067docker\u74b0\u5883\u3067\u3082\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u74b0\u5883\u3067\u3082\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\n`database.yaml`\u3067\u3082\u74b0\u5883\u5909\u6570`DATABASE_URL`\u3067\u63a5\u7d9a\u60c5\u5831\u3092\u6e21\u3059\u3068\u6c7a\u3081\u3066\u3044\u308c\u3070\u74b0\u5883\u306e\u5207\u308a\u66ff\u3048\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\n\n```yaml:database.yml\ndefault: &default\n  adapter: mysql2\n  encoding: utf8\n  pool: 5\n\ndevelopment:\n  <<: *default\n  database: minidoc_development\n  username: root\n  password:\n  host: localhost\n\ntest:\n  <<: *default\n  database: minidoc_test\n  username: root\n  password:\n  host: localhost\n\npreview:\n  <<: *default\n  database: minidoc_preview\n  url: <%= ENV['DATABASE_URL'] %>\n\nproduction:\n  <<: *default\n  database: minidoc_production\n  url: <%= ENV['DATABASE_URL'] %>\n```\n\n## \u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\n\n\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u306b\u306f\u6c38\u7d9a\u5316\u3001\u5171\u6709\u3057\u305f\u3044\u30d1\u30b9\u3092VOLUME\u30b3\u30de\u30f3\u30c9\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u308b\u3060\u3051\u3067\u3059\u3002\n\n```yaml:containers/datastore/Dockerfile\nFROM busybox:latest\n\nVOLUME /var/lib/mysql\nVOLUME /usr/share/elasticsearch/data\nVOLUME /data\nVOLUME /usr/src/app/public\nVOLUME /usr/src/app/log\n\nCMD /bin/sh\n```\n\nmysql\u3084elasticsearch\u7528\u306b\u306f\u6c38\u7d9a\u5316\u3059\u308b\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3053\u3067\u306e\u30dd\u30a4\u30f3\u30c8\u306frails\u304c\u751f\u6210\u3059\u308bassets\u306e\u6271\u3044\u3067\u3059\u3002\n\u4eca\u56de\u30d5\u30ed\u30f3\u30c8\u306enginx\u304b\u3089\u9759\u7684\u30d5\u30a1\u30a4\u30eb\u3092\u914d\u4fe1\u3057\u305f\u3044\u306e\u3067\u3001\u30a2\u30bb\u30c3\u30c8\u3092nginx\u30b3\u30f3\u30c6\u30ca\u306b\u6e21\u3055\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\n\u3082\u3061\u308d\u3093\u30ed\u30fc\u30ab\u30eb\u3067assets:precompile\u3057\u305f\u3082\u306e\u3092nginx\u30b3\u30f3\u30c6\u30ca\u306bADD\u3059\u308b\u65b9\u6cd5\u3082\u3068\u308c\u307e\u3059\u3002\n\u305d\u306e\u5834\u5408\u3001\u30ed\u30fc\u30ab\u30eb\u306bnode.js\u7b49\u304c\u5fc5\u8981\u306b\u306a\u3063\u3066\u304f\u308b\u305f\u3081\u3001\u4eca\u56de\u306e\u4f8b\u3067\u306fnode\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u308brails\u30b3\u30f3\u30c6\u30ca\u3067\u30b3\u30f3\u30d1\u30a4\u30eb\u3092\u884c\u3044\u3001\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u5171\u6709\u3057\u305f\u30dc\u30ea\u30e5\u30fc\u30e0\u306b\u3088\u3063\u3066nginx\u304b\u3089\u8aad\u307f\u51fa\u3059\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\n\u305d\u306e\u305f\u3081\u306e\u30d1\u30b9\u304c`/usr/src/app/public`\u3067\u3059\u3002\nnginx\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u898b\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n```conf:containers/nginx/nginx.conf\nuser  nginx;\nworker_processes  1;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n  worker_connections 1024; # increase if you have lots of clients\n  accept_mutex off; # \"on\" if nginx worker_processes > 1\n}\n\nhttp {\n  include mime.types;\n  default_type application/octet-stream;\n  log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                    '$status $body_bytes_sent \"$http_referer\" '\n                    '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n  access_log  /var/log/nginx/access.log  main;\n\n  sendfile on;\n\n  tcp_nopush on; # off may be better for *some* Comet/long-poll stuff\n  tcp_nodelay off; # on may be better for some Comet/long-poll stuff\n\n  gzip on;\n  gzip_http_version 1.0;\n  gzip_proxied any;\n  gzip_min_length 500;\n  gzip_disable \"MSIE [1-6]\\.\";\n  gzip_types text/plain text/html text/xml text/css\n             text/comma-separated-values\n             text/javascript application/x-javascript\n             application/atom+xml;\n\n  upstream app_server {\n    # for UNIX domain socket setups:\n    # server unix:/path/to/.unicorn.sock fail_timeout=0;\n\n    # for TCP setups, point these to your backend servers\n    # server 192.168.0.7:8080 fail_timeout=0;\n    server rails:3000 fail_timeout=0;\n  }\n\n  server {\n    listen       80;\n    server_name  localhost;\n    client_max_body_size 4G;\n    keepalive_timeout 5;\n\n    # path for static files\n    root /usr/src/app/public;\n\n    try_files $uri/index.html $uri.html $uri @app;\n\n    location @app {\n      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n      proxy_set_header Host $http_host;\n      proxy_redirect off;\n      proxy_pass http://app_server;\n    }\n\n    # Rails error pages\n    error_page 500 502 503 504 /500.html;\n    location = /500.html {\n      root /usr/src/app/public;\n    }\n  }\n}\n```\n\n\u30dd\u30a4\u30f3\u30c8\u306f`root /usr/src/app/public;`\u306e\u90e8\u5206\u3067\u3059\u3002\n`/usr/src/app`\u306frails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304c\u914d\u7f6e\u3055\u308c\u3066\u3044\u308b\u5834\u6240\u3067\u3059\u3002\n\u305d\u306e\u305f\u3081rails\u30b3\u30f3\u30c6\u30ca\u3067`rake assets:precompile`\u3059\u308b\u3068`/usr/src/app/public`\u306b\u30b3\u30f3\u30d1\u30a4\u30eb\u3055\u308c\u305f\u30a2\u30bb\u30c3\u30c8\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\n\u3053\u306e\u30d1\u30b9\u3092\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u3067\u5171\u6709\u3059\u308b\u3053\u3068\u3067nginx\u30b3\u30f3\u30c6\u30ca\u304b\u3089\u8aad\u307f\u51fa\u3059\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\n\n## \u305d\u306e\u4ed6\u8a2d\u5b9a dockerignore\n\ndockerignore\u30d5\u30a1\u30a4\u30eb\u3082\u7528\u610f\u3057\u3066\u304a\u304d\u307e\u3057\u3087\u3046\u3002\n\u30ed\u30b0\u3084\u4e00\u6642\u30d5\u30a1\u30a4\u30eb\u306a\u3069\u3092\u9664\u5916\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u5909\u66f4\u3060\u3068\u898b\u306a\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\n\n```:.dockerignore\n## Rails\npublic/assets/*\n\n## Environment normalisation:\n.bundle\nvendor/bundle\n.git\n\n## log\nlog\ntmp\n\n## OSX\n.DS_Store\n\n## docker\n.dockerignore\ncontainers\n```\n\n# \u30d3\u30eb\u30c9 & \u5b9f\u884c\n\n\u4e00\u6c17\u306b\u30d3\u30eb\u30c9\u3059\u308b\u4e8b\u3082\u51fa\u6765\u307e\u3059\u3057\u3001\u30b5\u30fc\u30d3\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n```\n$ docker-compose build\n$ docker-compose build rails\n```\n\nrake\u30bf\u30b9\u30af\u306a\u3069\u3092\u5b9f\u884c\u3059\u308b\u5834\u5408\u306b\u306f`docker-compose run rails`\u306b\u7d9a\u3051\u3066\u6307\u5b9a\u3067\u304d\u307e\u3059\u3002\n`docker-compose.yml`\u306e\u306a\u304b\u3067`RAILS_ENV`\u3092\u6307\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u306f\u305d\u306eRails.env\u3067\u52d5\u4f5c\u3057\u307e\u3059\u3002\n\n```\n$ docker-compose run rails rake db:create\n$ docker-compose run rails rake db:migrate\n$ docker-compose run rails rake db:seed_fu\n$ docker-compose run rails rake assets:precompile\n```\n\n`docker-compose up`\u3067\u8907\u6570\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4e00\u6c17\u306b\u7acb\u3061\u4e0a\u3052\u307e\u3057\u3087\u3046\u3002\n\n```\n$ docker-compose up\n```\n\n\u3042\u3068\u306f`boot2docker ip`\u3067\u30a2\u30c9\u30ec\u30b9\u3092\u78ba\u8a8d\u3057\u3001\u4eca\u56de\u306e\u5834\u5408\u306fnginx\u306e80\u30688080\u756a\u3092\u7e4b\u3044\u3067\u3044\u308b\u306e\u3067\u3001`http://192.168.59.103:8080` \u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\uff08IP\u30a2\u30c9\u30ec\u30b9\u306f\u4eba\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\uff09\n\n# \u307e\u3068\u3081\n\n\u672c\u8a18\u4e8b\u3067\u306f\u8907\u96d1\u306a\u69cb\u6210\u306erails\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092docker\u3067\u52d5\u4f5c\u3055\u305b\u308b\u5834\u5408\u306b\u3064\u3044\u3066\u307e\u3068\u3081\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306frails\u306e\u30b3\u30fc\u30c9\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u5165\u308c\u3001\u30d7\u30ed\u30c0\u30af\u30b7\u30e7\u30f3\u76f8\u5f53\u3067\u7a3c\u50cd\u3055\u305b\u308b\u4f8b\u3067\u3057\u305f\u3002\n\u672c\u756a\u74b0\u5883\u3082docker\u3067\u904b\u7528\u3059\u308b\u3053\u3068\u304c\u51fa\u6765\u305f\u306a\u3089\u3001\u30d3\u30eb\u30c9\u3057\u305f\u30b3\u30f3\u30c6\u30ca\u3092\u305d\u306e\u307e\u307e\u672c\u756a\u306b\u6301\u3063\u3066\u884c\u304f\u3053\u3068\u304c\u51fa\u6765\u308b\u3088\u3046\u306b\u3067\u3059\u3002\n\n\u958b\u767a\u74b0\u5883\u3067\u4f7f\u3044\u305f\u3044\u3001\u3064\u307e\u308a\u30ed\u30fc\u30ab\u30eb\u3067\u30b3\u30fc\u30c9\u3092\u7de8\u96c6\u3057\u3001\u7d50\u679c\u3092\u30b3\u30f3\u30c6\u30ca\u3067\u5b9f\u884c\u3055\u305b\u3066\u3044\u308brails\u3067\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u306a\u3069\u306f\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u30eb\u30fc\u30c8\u3092Data Volume\u3067\u30de\u30a6\u30f3\u30c8\u3059\u308b\u904b\u7528\u3082\u51fa\u6765\u308b\u3067\u3057\u3087\u3046\u3002\n\u3053\u306e\u65b9\u6cd5\u306a\u3089`docker build`\u3084\u30b3\u30f3\u30c6\u30ca\u306b\u5bfe\u3057\u3066`rsync`\u7b49\u3059\u308b\u3053\u3068\u7121\u304f\u30b3\u30fc\u30c9\u306e\u53cd\u6620\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\n\ndocker\u3092\u7528\u3044\u305f\u74b0\u5883\u306e\u69cb\u7bc9\u3067\u306f\u3001rails\u306e\u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u5fc5\u8981\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u542b\u3081\u3089\u308c\u308b\u3053\u3068\u3001\u958b\u767a\u74b0\u5883\u3092\u8907\u6570\u958b\u767a\u8005\u3067\u63c3\u3048\u3089\u308c\u308b\u3053\u3068\u3001\u305d\u3057\u3066\u5bb9\u6613\u306b\u74b0\u5883\u306e\u7834\u68c4\u304c\u53ef\u80fd\u306b\u306a\u308b\u3053\u3068\uff08\u4f8b\u3048\u3070\u30d6\u30e9\u30f3\u30c1\u306e\u5207\u308a\u66ff\u3048\u6642\u306b\u30c7\u30fc\u30bf\u30dc\u30ea\u30e5\u30fc\u30e0\u30b3\u30f3\u30c6\u30ca\u3092\u5dee\u3057\u66ff\u3048\u308b\u306a\u3069\uff09\u306e\u30e1\u30ea\u30c3\u30c8\u304c\u8003\u3048\u3089\u308c\u307e\u3059\u3002\n", "tags": ["Rails", "docker", "fig", "dockerfile", "docker-compose"]}