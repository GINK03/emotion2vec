{"tags": ["EC-CUBE", "Ajax"], "context": "EC-CUBE (v2.13.5)\nPHP (v5.6.10)\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\n\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u5909\u66f4\u3067\u8907\u6570\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u9078\u629e\u80a2\u3092\u304b\u3048\u308b\u5834\u5408\nSmarty\u306f\u3088\u304f\u5206\u304b\u3089\u3093\u306e\u3067\n\u5206\u304b\u308c\u3070\u3082\u3063\u3068\u7dba\u9e97\u306b\u306a\u308b\u3084\u3082\u3057\u308c\u3093\u306d\n\nsample.tpl\n<script type=\"text/javascript\">\n$(function($) {\n    $('select[name=A]').change(function() {\n        $.ajax({\n            type: \"POST\",\n            url:  \"/ajax/index.php\",\n            data: {value:$(this).val()},\n            dataType: \"json\",\n            success: function(r) {\n                //console.log(r);\n                $.each(r, function(k, v) {\n                    var $select = $(\"select[name=\"+k+\"]\");\n                    $select.text(\"\");\n                    $.each(v, function(k2, v2) {\n                        $select.append(\"<option value=\\\"\"+v2['id']+\"\\\">\"+v2['name']+\"</option>\");\n                    })\n                })\n            },\n            error: function(){\n            }\n        });\n    });\n});\n</script>\n\n<select name=\"A\">\n<option value=\"1\">A1<option>\n<option value=\"2\">A2<option>\n<option value=\"3\">A3<option>\n</select>\n\n\n<select name=\"B\">\n<option value=\"\">-<option>\n</select>\n\n<select name=\"C\">\n<option value=\"\">-<option>\n</select>\n\n\n\n/html/ajax/index.php\n<?php\nrequire_once '../require.php';\nrequire_once CLASS_REALDIR . 'pages/ajax/LC_Page_Ajax.php';\n$objPage = new LC_Page_Ajax();\n$objPage->init();\n$objPage->process();\n\n\n\n/data/class/pages/ajax/LC_Page_Ajax.php\n<?php\nclass LC_Page_Ajax {\n\n    public function init() {}\n\n    public function process() {\n        $this->action();\n    }\n\n    public function action() {\n        $data = self::sample();\n        @header('Content-Type: application/json; charset=utf-8');\n        echo json_encode($data);\n        return;\n    }\n\n    public function sample() {\n        $value = $_POST['value'];\n        $relations = ['B', 'C'];\n\n        $query = new SC_Query();\n        foreach ($relations as $r) {\n            $cols = \"id, name\";\n            $from = \"**table**\";\n            $where = \"**where**\";\n            $data[$r] = $query->select($cols, $from, $where);\n        }\n        return $data;\n    }\n\n}\n\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e91\u3005\u306f\u5404\u3005\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\nEC-CUBE (v2.13.5)\nPHP (v5.6.10)\n\n\u30b5\u30f3\u30d7\u30eb\u3068\u3057\u3066\n\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u5909\u66f4\u3067\u8907\u6570\u306e\u30bb\u30ec\u30af\u30c8\u30dc\u30c3\u30af\u30b9\u306e\u9078\u629e\u80a2\u3092\u304b\u3048\u308b\u5834\u5408\n\nSmarty\u306f\u3088\u304f\u5206\u304b\u3089\u3093\u306e\u3067\n\u5206\u304b\u308c\u3070\u3082\u3063\u3068\u7dba\u9e97\u306b\u306a\u308b\u3084\u3082\u3057\u308c\u3093\u306d\n\n```html:sample.tpl\n<script type=\"text/javascript\">\n$(function($) {\n\t$('select[name=A]').change(function() {\n\t    $.ajax({\n\t        type: \"POST\",\n\t        url:  \"/ajax/index.php\",\n\t        data: {value:$(this).val()},\n\t        dataType: \"json\",\n\t        success: function(r) {\n\t            //console.log(r);\n\t\t\t\t$.each(r, function(k, v) {\n\t\t\t\t\tvar $select = $(\"select[name=\"+k+\"]\");\n\t\t\t\t\t$select.text(\"\");\n\t\t\t\t\t$.each(v, function(k2, v2) {\n\t\t\t\t\t\t$select.append(\"<option value=\\\"\"+v2['id']+\"\\\">\"+v2['name']+\"</option>\");\n\t\t\t\t\t})\n\t            })\n\t        },\n\t        error: function(){\n\t        }\n\t    });\n\t});\n});\n</script>\n\n<select name=\"A\">\n<option value=\"1\">A1<option>\n<option value=\"2\">A2<option>\n<option value=\"3\">A3<option>\n</select>\n\n\n<select name=\"B\">\n<option value=\"\">-<option>\n</select>\n\n<select name=\"C\">\n<option value=\"\">-<option>\n</select>\n```\n\n```php:/html/ajax/index.php\n<?php\nrequire_once '../require.php';\nrequire_once CLASS_REALDIR . 'pages/ajax/LC_Page_Ajax.php';\n$objPage = new LC_Page_Ajax();\n$objPage->init();\n$objPage->process();\n```\n\n```php:/data/class/pages/ajax/LC_Page_Ajax.php\n<?php\nclass LC_Page_Ajax {\n\n\tpublic function init() {}\n\n\tpublic function process() {\n\t\t$this->action();\n\t}\n\n\tpublic function action() {\n\t\t$data = self::sample();\n\t\t@header('Content-Type: application/json; charset=utf-8');\n\t\techo json_encode($data);\n\t\treturn;\n\t}\n\n\tpublic function sample() {\n\t\t$value = $_POST['value'];\n\t\t$relations = ['B', 'C'];\n\n\t\t$query = new SC_Query();\n\t\tforeach ($relations as $r) {\n\t\t\t$cols = \"id, name\";\n\t\t\t$from = \"**table**\";\n\t\t\t$where = \"**where**\";\n\t\t\t$data[$r] = $query->select($cols, $from, $where);\n\t\t}\n\t\treturn $data;\n\t}\n\n}\n```\n\n\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u4e91\u3005\u306f\u5404\u3005\u8ffd\u8a18\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n"}