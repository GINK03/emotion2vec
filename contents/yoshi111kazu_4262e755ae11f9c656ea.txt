{"context": "\n\n\u306f\u3058\u3081\u306b\nChatOps\u306e\u624b\u59cb\u3081\u3068\u3057\u3066\u3001ChatBot\u3067\u4f1a\u8a71API\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30fbUserLocal \u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API\n\u30fbCotoGoto::Noby API\n\u30fbDocomo \u96d1\u8ac7\u4f1a\u8a71API\nChatwork\u3067\u3082Slack\u3067\u3082\u624b\u9806\u306f\u540c\u3058\u3067\u3001hubot\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3069\u3061\u3089\u304b\u3092\u9078\u3079\u3070\u3088\u3044\u3060\u3051\u3067\u3059\u3002\n\n\u4e8b\u524d\u6e96\u5099\n\nChat\u5074\n\nChatwork\nbot\u7528\u306e\u30e6\u30fc\u30b6\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3001API\u7533\u8acb\u3092\u3059\u308b\u3002\nAPI\u30ad\u30fc\u3068\u30eb\u30fc\u30e0ID\u3092\u53d6\u5f97\nSlack\u767b\u9332\nApps & Integration\u3067hubot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066API\u30ad\u30fc\u3092\u53d6\u5f97\n\n\n\u4f1a\u8a71API\u5074\n\nUserLocal\n\u7121\u6599\u767b\u9332\u3057\u3066API Key\u53d6\u5f97\nCotoGoto\n\u7121\u6599\u767b\u9332\u3057\u3066API Key\u53d6\u5f97\nDocomo\n\u8272\u3005\u306a\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u6700\u4f4e\u9650\u306e\u4f1a\u8a71API\u3067\u3042\u308c\u3070\u5373API Key\u767a\u884c\u3055\u308c\u307e\u3059\u304c\u3001\n\u8ffd\u52a0\u306e\u6a5f\u80fd\u306b\u3088\u3063\u3066\u306f\u30b5\u30a4\u30c8\u306e\u5be9\u67fb\u3084\u6cd5\u4eba\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n\n\u30b5\u30fc\u30d0\u8a2d\u5b9a(EC2\u3067\u69cb\u7bc9)\n\n\u30e2\u30b8\u30e5\u30fc\u30eb\n// \u6700\u65b0\u306eNode.js\u3092\u5165\u308c\u308b\u305f\u3081\u306bNVM\u304b\u3089\n$ git clone https://github.com/creationix/nvm.git ~/.nvm\n$ source ~/.nvm/nvm.sh\n$ vi .bash_profile\n  # nvm\n    if [[ -s ~/.nvm/nvm.sh ]] ; then\n      source ~/.nvm/nvm.sh ;\n    fi\n$ nvm ls-remote\n$ nvm install 7.4.0\n$ nvm use v7.4.0\n$ node -v\n\n$ sudo yum install -y npm redis\n$ sudo npm install -g hubot coffee-script yo generator-hubot\n\n$ cd /var/www/bot\n$ mkdir hubot-cw\n$ cd hubot-cw\n$ yo hubot\n  \u5168\u3066Enter\u3067OK\n$ npm install hubot-chatwork --save\n$ npm install forever request --save\n\n\n./scripts\u4ee5\u4e0b\u3078\u65b0\u898f\u4f5c\u6210\n\nhubot.coffee\n\nmodule.exports = (robot) ->\n    status  = {}\n\n    robot.respond /(.*)/i, (res) ->\n        message = res.match[1]\n        if message.length == 0\n            res.reply \"What?\"\n\n    lunch = ['\u30b3\u30f3\u30d3\u30cb', '\u4e2d\u83ef', '\u30a4\u30bf\u30ea\u30a2\u30f3', '\u548c\u98df', '\u30ab\u30ec\u30fc', '\u6628\u65e5\u3068\u540c\u3058']\n    robot.respond /\u304a\u663c/i, (res) ->\n        res.reply res.random lunch\n\n    robot.respond /site (.*)/i, (msg) ->\n      url = msg.match[1]\n      options =\n        url: url\n        timeout: 2000\n        headers: {'user-agent': 'node title fetcher'}\n\n      request = require 'request'\n      cheerio = require 'cheerio'\n\n      request options, (error, response, body) ->\n        $ = cheerio.load body\n        title = $('title').text().replace(/\\n/g, '')\n        msg.reply(title)\n\n\napi_userlocal.coffee\n\nmodule.exports = (robot) ->\n    robot.respond /ul (.*)/i, (res) ->\n        url = \"https://chatbot-api.userlocal.jp/api/chat\"\n        api_key = process.env.HUBOT_UL_API_KEY\n        message = res.match[1]\n        params = {\n          \"message\": message,\n          \"key\": api_key\n        }\n        robot.http(url).query(params).get() (err, response, body) ->\n          return response.send \"Encountered an error :( #{err}\" if err\n          body = JSON.parse(body)\n          res.reply \"#{body.result}\"\n\n\napi_cotogoto.coffee\n\nmodule.exports = (robot) ->\n      robot.respond /cg (.*)/i, (res) ->\n          url = \"https://www.cotogoto.ai/webapi/noby.json\"\n          api_key = process.env.HUBOT_CG_API_KEY\n          message = res.match[1]\n          params = {\n            \"text\": message,\n            \"app_key\": api_key\n          }\n          robot.http(url).query(params).get() (err, response, body) ->\n            return response.send \"Encountered an error :( #{err}\" if err\n            body = JSON.parse(body)\n            res.reply \"#{body.text}\"\n\n\napi_docomo.coffee\n\ngetTimeDiffAsMinutes = (old_msec) ->\n  now = new Date()\n  old = new Date(old_msec)\n  diff_msec = now.getTime() - old.getTime()\n  diff_minutes = parseInt( diff_msec / (60*1000), 10 )\n  return diff_minutes\n\nmodule.exports = (robot) ->\n  robot.respond /d (.*)/i, (msg) ->\n    HUBOT_D_API_KEY = process.env.HUBOT_D_API_KEY\n    message = msg.match[1]\n    return unless HUBOT_D_API_KEY && message\n\n    ## ContextID\u3092\u8aad\u307f\u8fbc\u3080\n    KEY_DOCOMO_CONTEXT = 'docomo-talk-context'\n    context = robot.brain.get KEY_DOCOMO_CONTEXT || ''\n\n    ## \u524d\u56de\u4f1a\u8a71\u3057\u3066\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593\u8abf\u3079\u308b\n    KEY_DOCOMO_CONTEXT_TTL = 'docomo-talk-context-ttl'\n    TTL_MINUTES = 20\n    old_msec = robot.brain.get KEY_DOCOMO_CONTEXT_TTL\n    diff_minutes = getTimeDiffAsMinutes old_msec\n\n    ## \u524d\u56de\u4f1a\u8a71\u3057\u3066\u304b\u3089\u4e00\u5b9a\u6642\u9593\u7d4c\u3063\u3066\u3044\u305f\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u7834\u68c4\n    if diff_minutes > TTL_MINUTES\n      context = ''\n\n    url = 'https://api.apigw.smt.docomo.ne.jp/dialogue/v1/dialogue?APIKEY=' + HUBOT_D_API_KEY\n    user_name = msg.message.user.name\n\n    request = require('request');\n    request.post\n      url: url\n      json:\n        utt: message\n        nickname: user_name if user_name\n        context: context if context\n      , (err, response, body) ->\n        ## ContextID\u306e\u4fdd\u5b58\n        robot.brain.set KEY_DOCOMO_CONTEXT, body.context\n\n        ## \u4f1a\u8a71\u767a\u751f\u6642\u9593\u306e\u4fdd\u5b58\n        now_msec = new Date().getTime()\n        robot.brain.set KEY_DOCOMO_CONTEXT_TTL, now_msec\n\n        msg.send body.utt\n\n\n\u8d77\u52d5\u8a2d\u5b9a\uff08\u5e38\u99d0\u5316\u3001\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\uff09\n\n./bin/hubot\u3092\u7de8\u96c6\n\n#!/bin/sh\n\nset -e\n\nARG1=$1\n\nexport PATH=\"node_modules/.bin:node_modules/hubot/node_modules/.bin:$PATH\"\nexport HUBOT_SLACK_TOKEN=xoxb-xxx\nexport HUBOT_CHATWORK_TOKEN=\"xxx\"\nexport HUBOT_CHATWORK_ROOMS=\"xxx\"\nexport HUBOT_CHATWORK_API_RATE=\"900\" #\u6642\u9593\u3042\u305f\u308a\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u56de\u6570(4\u79d2\u306b1\u56de)\nexport HUBOT_UL_API_KEY=xxx\nexport HUBOT_CG_API_KEY=xxx\nexport HUBOT_D_API_KEY=xxx\n\n#exec node_modules/.bin/hubot -a chatwork -n mohi\n\nstart() {\n        forever start -c coffee node_modules/.bin/hubot -a chatwork -n mohi\n}\nstop () {\n        forever stop -c coffee node_modules/.bin/hubot\n}\nstatus() {\n        forever list\n}\nrestart() {\n        forever restartall\n}\n\ncase \"$ARG1\" in\n        \"stop\" )\n                stop\n                ;;\n        \"restart\" )\n                restart\n                ;;\n        \"start\" )\n                start\n                ;;\n        \"status\" )\n                status\n                ;;\nesac\n\n\n\u8d77\u52d5\n\n$ bin/hubot start\n\n\n\u6700\u5f8c\u306b\n\n\u4f7f\u3044\u65b9\n\u300cmohi API\u30aa\u30d7\u30b7\u30e7\u30f3 \u4f1a\u8a71\u5185\u5bb9\u300d\n\u30fbCoto Goto API\u306e\u5834\u5408\uff08mohi cg \u4f1a\u8a71\u5185\u5bb9\uff09\n\u3000\u3000\u4e0b\u8a18\u3092\u805e\u304f\u3068\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\n\u3000\u3000\u3000\u30fb\u30cb\u30e5\u30fc\u30b9\n\u3000\u3000\u3000\u30fb\u304a\u307f\u304f\u3058\u5f15\u304f\n\u3000\u3000\u3000\u30fb\u25cb\u25cb\u306e\u5929\u6c17\n\u3000\u3000\u3000\u30fb\u25cb\u25cb\u306e\u610f\u5473\u3092\u77e5\u308a\u305f\u3044\n\u30fbUser Local\u306e\u5834\u5408\uff08mohi ul \u4f1a\u8a71\u5185\u5bb9\uff09\n\u30fbDocomo\u96d1\u8ac7API\u306e\u5834\u5408\uff08mohi d \u4f1a\u8a71\u5185\u5bb9\uff09\n\n\u4eca\u5f8c\n\u4eca\u5f8c\u306fDocomo\u306eAPI\u3084\u4ed6\u793e\u3082\u5229\u7528\u3057\u3066\u3001\u753b\u50cf\u8a8d\u8b58\u3084\u5f62\u614b\u7d20\u89e3\u6790\u3082\u5b9f\u88c5\u3057\u305f\u3042\u3068\u3001\n\u72ec\u81ea\u3067\u60c5\u5831\u3092\u53d6\u3063\u3066\u304f\u308b\u3082\u306e\u3092\u4f5c\u308a\u305f\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u3002\n# \u306f\u3058\u3081\u306b\nChatOps\u306e\u624b\u59cb\u3081\u3068\u3057\u3066\u3001ChatBot\u3067\u4f1a\u8a71API\u3092\u5b9f\u88c5\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\u30fbUserLocal \u4eba\u5de5\u77e5\u80fd\u30dc\u30c3\u30c8API\n\u30fbCotoGoto::Noby API\n\u30fbDocomo \u96d1\u8ac7\u4f1a\u8a71API\nChatwork\u3067\u3082Slack\u3067\u3082\u624b\u9806\u306f\u540c\u3058\u3067\u3001hubot\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u3069\u3061\u3089\u304b\u3092\u9078\u3079\u3070\u3088\u3044\u3060\u3051\u3067\u3059\u3002\n\n# \u4e8b\u524d\u6e96\u5099\n## Chat\u5074\n- Chatwork  \n bot\u7528\u306e\u30e6\u30fc\u30b6\u3092\u65b0\u898f\u4f5c\u6210\u3057\u3001API\u7533\u8acb\u3092\u3059\u308b\u3002\n API\u30ad\u30fc\u3068\u30eb\u30fc\u30e0ID\u3092\u53d6\u5f97\n- Slack\u767b\u9332  \n Apps & Integration\u3067hubot\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066API\u30ad\u30fc\u3092\u53d6\u5f97\n\n## \u4f1a\u8a71API\u5074\n- UserLocal  \n \u7121\u6599\u767b\u9332\u3057\u3066API Key\u53d6\u5f97\n- CotoGoto  \n \u7121\u6599\u767b\u9332\u3057\u3066API Key\u53d6\u5f97\n- Docomo  \n \u8272\u3005\u306a\u6a5f\u80fd\u304c\u3042\u308b\u306e\u3067\u3001\u6700\u4f4e\u9650\u306e\u4f1a\u8a71API\u3067\u3042\u308c\u3070\u5373API Key\u767a\u884c\u3055\u308c\u307e\u3059\u304c\u3001  \n \u8ffd\u52a0\u306e\u6a5f\u80fd\u306b\u3088\u3063\u3066\u306f\u30b5\u30a4\u30c8\u306e\u5be9\u67fb\u3084\u6cd5\u4eba\u767b\u9332\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n# \u30b5\u30fc\u30d0\u8a2d\u5b9a(EC2\u3067\u69cb\u7bc9)\n## \u30e2\u30b8\u30e5\u30fc\u30eb\n```\n// \u6700\u65b0\u306eNode.js\u3092\u5165\u308c\u308b\u305f\u3081\u306bNVM\u304b\u3089\n$ git clone https://github.com/creationix/nvm.git ~/.nvm\n$ source ~/.nvm/nvm.sh\n$ vi .bash_profile\n  # nvm\n    if [[ -s ~/.nvm/nvm.sh ]] ; then\n      source ~/.nvm/nvm.sh ;\n    fi\n$ nvm ls-remote\n$ nvm install 7.4.0\n$ nvm use v7.4.0\n$ node -v\n\n$ sudo yum install -y npm redis\n$ sudo npm install -g hubot coffee-script yo generator-hubot\n\n$ cd /var/www/bot\n$ mkdir hubot-cw\n$ cd hubot-cw\n$ yo hubot\n  \u5168\u3066Enter\u3067OK\n$ npm install hubot-chatwork --save\n$ npm install forever request --save\n```\n\n## ./scripts\u4ee5\u4e0b\u3078\u65b0\u898f\u4f5c\u6210\n- hubot.coffee\n\n```\nmodule.exports = (robot) ->\n    status  = {}\n\n    robot.respond /(.*)/i, (res) ->\n        message = res.match[1]\n        if message.length == 0\n            res.reply \"What?\"\n\n    lunch = ['\u30b3\u30f3\u30d3\u30cb', '\u4e2d\u83ef', '\u30a4\u30bf\u30ea\u30a2\u30f3', '\u548c\u98df', '\u30ab\u30ec\u30fc', '\u6628\u65e5\u3068\u540c\u3058']\n    robot.respond /\u304a\u663c/i, (res) ->\n        res.reply res.random lunch\n\n    robot.respond /site (.*)/i, (msg) ->\n      url = msg.match[1]\n      options =\n        url: url\n        timeout: 2000\n        headers: {'user-agent': 'node title fetcher'}\n\n      request = require 'request'\n      cheerio = require 'cheerio'\n\n      request options, (error, response, body) ->\n        $ = cheerio.load body\n        title = $('title').text().replace(/\\n/g, '')\n        msg.reply(title)\n```\n- api_userlocal.coffee\n\n```\nmodule.exports = (robot) ->\n    robot.respond /ul (.*)/i, (res) ->\n        url = \"https://chatbot-api.userlocal.jp/api/chat\"\n        api_key = process.env.HUBOT_UL_API_KEY\n        message = res.match[1]\n        params = {\n          \"message\": message,\n          \"key\": api_key\n        }\n        robot.http(url).query(params).get() (err, response, body) ->\n          return response.send \"Encountered an error :( #{err}\" if err\n          body = JSON.parse(body)\n          res.reply \"#{body.result}\"\n```\n- api_cotogoto.coffee\n\n```\nmodule.exports = (robot) ->\n      robot.respond /cg (.*)/i, (res) ->\n          url = \"https://www.cotogoto.ai/webapi/noby.json\"\n          api_key = process.env.HUBOT_CG_API_KEY\n          message = res.match[1]\n          params = {\n            \"text\": message,\n            \"app_key\": api_key\n          }\n          robot.http(url).query(params).get() (err, response, body) ->\n            return response.send \"Encountered an error :( #{err}\" if err\n            body = JSON.parse(body)\n            res.reply \"#{body.text}\"\n```\n- api_docomo.coffee\n\n```\ngetTimeDiffAsMinutes = (old_msec) ->\n  now = new Date()\n  old = new Date(old_msec)\n  diff_msec = now.getTime() - old.getTime()\n  diff_minutes = parseInt( diff_msec / (60*1000), 10 )\n  return diff_minutes\n\nmodule.exports = (robot) ->\n  robot.respond /d (.*)/i, (msg) ->\n    HUBOT_D_API_KEY = process.env.HUBOT_D_API_KEY\n    message = msg.match[1]\n    return unless HUBOT_D_API_KEY && message\n\n    ## ContextID\u3092\u8aad\u307f\u8fbc\u3080\n    KEY_DOCOMO_CONTEXT = 'docomo-talk-context'\n    context = robot.brain.get KEY_DOCOMO_CONTEXT || ''\n\n    ## \u524d\u56de\u4f1a\u8a71\u3057\u3066\u304b\u3089\u306e\u7d4c\u904e\u6642\u9593\u8abf\u3079\u308b\n    KEY_DOCOMO_CONTEXT_TTL = 'docomo-talk-context-ttl'\n    TTL_MINUTES = 20\n    old_msec = robot.brain.get KEY_DOCOMO_CONTEXT_TTL\n    diff_minutes = getTimeDiffAsMinutes old_msec\n\n    ## \u524d\u56de\u4f1a\u8a71\u3057\u3066\u304b\u3089\u4e00\u5b9a\u6642\u9593\u7d4c\u3063\u3066\u3044\u305f\u3089\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u7834\u68c4\n    if diff_minutes > TTL_MINUTES\n      context = ''\n\n    url = 'https://api.apigw.smt.docomo.ne.jp/dialogue/v1/dialogue?APIKEY=' + HUBOT_D_API_KEY\n    user_name = msg.message.user.name\n\n    request = require('request');\n    request.post\n      url: url\n      json:\n        utt: message\n        nickname: user_name if user_name\n        context: context if context\n      , (err, response, body) ->\n        ## ContextID\u306e\u4fdd\u5b58\n        robot.brain.set KEY_DOCOMO_CONTEXT, body.context\n\n        ## \u4f1a\u8a71\u767a\u751f\u6642\u9593\u306e\u4fdd\u5b58\n        now_msec = new Date().getTime()\n        robot.brain.set KEY_DOCOMO_CONTEXT_TTL, now_msec\n\n        msg.send body.utt\n```\n\n## \u8d77\u52d5\u8a2d\u5b9a\uff08\u5e38\u99d0\u5316\u3001\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\uff09\n- ./bin/hubot\u3092\u7de8\u96c6\n\n```\n#!/bin/sh\n\nset -e\n\nARG1=$1\n\nexport PATH=\"node_modules/.bin:node_modules/hubot/node_modules/.bin:$PATH\"\nexport HUBOT_SLACK_TOKEN=xoxb-xxx\nexport HUBOT_CHATWORK_TOKEN=\"xxx\"\nexport HUBOT_CHATWORK_ROOMS=\"xxx\"\nexport HUBOT_CHATWORK_API_RATE=\"900\" #\u6642\u9593\u3042\u305f\u308a\u306e\u30dd\u30fc\u30ea\u30f3\u30b0\u56de\u6570(4\u79d2\u306b1\u56de)\nexport HUBOT_UL_API_KEY=xxx\nexport HUBOT_CG_API_KEY=xxx\nexport HUBOT_D_API_KEY=xxx\n\n#exec node_modules/.bin/hubot -a chatwork -n mohi\n\nstart() {\n        forever start -c coffee node_modules/.bin/hubot -a chatwork -n mohi\n}\nstop () {\n        forever stop -c coffee node_modules/.bin/hubot\n}\nstatus() {\n        forever list\n}\nrestart() {\n        forever restartall\n}\n\ncase \"$ARG1\" in\n        \"stop\" )\n                stop\n                ;;\n        \"restart\" )\n                restart\n                ;;\n        \"start\" )\n                start\n                ;;\n        \"status\" )\n                status\n                ;;\nesac\n```\n- \u8d77\u52d5\n\n```\n$ bin/hubot start\n```\n\n# \u6700\u5f8c\u306b\n## \u4f7f\u3044\u65b9\n\u300cmohi API\u30aa\u30d7\u30b7\u30e7\u30f3 \u4f1a\u8a71\u5185\u5bb9\u300d\n\u30fbCoto Goto API\u306e\u5834\u5408\uff08mohi cg \u4f1a\u8a71\u5185\u5bb9\uff09\n\u3000\u3000\u4e0b\u8a18\u3092\u805e\u304f\u3068\u6559\u3048\u3066\u304f\u308c\u307e\u3059\u3002\n\u3000\u3000\u3000\u30fb\u30cb\u30e5\u30fc\u30b9\n\u3000\u3000\u3000\u30fb\u304a\u307f\u304f\u3058\u5f15\u304f\n\u3000\u3000\u3000\u30fb\u25cb\u25cb\u306e\u5929\u6c17\n\u3000\u3000\u3000\u30fb\u25cb\u25cb\u306e\u610f\u5473\u3092\u77e5\u308a\u305f\u3044\n\u30fbUser Local\u306e\u5834\u5408\uff08mohi ul \u4f1a\u8a71\u5185\u5bb9\uff09\n\u30fbDocomo\u96d1\u8ac7API\u306e\u5834\u5408\uff08mohi d \u4f1a\u8a71\u5185\u5bb9\uff09\n## \u4eca\u5f8c\n\u4eca\u5f8c\u306fDocomo\u306eAPI\u3084\u4ed6\u793e\u3082\u5229\u7528\u3057\u3066\u3001\u753b\u50cf\u8a8d\u8b58\u3084\u5f62\u614b\u7d20\u89e3\u6790\u3082\u5b9f\u88c5\u3057\u305f\u3042\u3068\u3001\n\u72ec\u81ea\u3067\u60c5\u5831\u3092\u53d6\u3063\u3066\u304f\u308b\u3082\u306e\u3092\u4f5c\u308a\u305f\u3044\u3068\u601d\u3063\u3066\u307e\u3059\u3002\n", "tags": ["Hubot", "chatbot", "ChatOps", "chatwork", "slackbot"]}