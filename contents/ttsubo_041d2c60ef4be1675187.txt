{"context": "\u4ee5\u524d\u306e\u8a18\u4e8b\"Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\"\u3067\u3001ZooKeeper\u3092\u6d3b\u7528\u3057\u305fGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u3092\u7d39\u4ecb\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u3053\u3067\u306e\u8a18\u4e8b\u306e\u8ab2\u984c\u306f\u3001\u300cZooKeeper\u304cStandAlone\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3082\u3057\u3001ZooKeeper\u304c\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001Golang\u30a2\u30d7\u30ea\u3082\u52d5\u4f5c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u3001ZooKeeper\u306eSPOF\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u2b1b\ufe0e ZooKeeper\u306e\u74b0\u5883\u6574\u5099\nZookeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u306b\u3042\u305f\u308a\u3001Ubuntu\u30b5\u30fc\u30d0\u3092\uff13\u53f0\u7528\u610f\u3057\u307e\u3059\u3002\n\nzookeeper-1\uff08IP: 192.168.0.1\uff09\nzookeeper-2\uff08IP: 192.168.0.2\uff09\nzookeeper-3\uff08IP: 192.168.0.3\uff09\n\n\n(1) Linux\u74b0\u5883\u6e96\u5099\nzookeeper-1\u3067\u306e\u4f5c\u696d\u5c65\u6b74\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\nUbunts\u74b0\u5883\u6574\u5099\u3059\u308b\n\n$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.3 LTS\"\n\n$ sudo apt-get install git\n\n\n\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\n\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:57:33:bd brd ff:ff:ff:ff:ff:ff\n    inet 192.168.195.168/24 brd 192.168.195.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe57:33bd/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:57:33:c7 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.1/24 brd 192.168.0.255 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe57:33c7/64 scope link \n       valid_lft forever preferred_lft forever\n\n\n\u4ed6\u306eUbuntu\u30b5\u30fc\u30d0\u3068\u306e\u63a5\u7d9a\u6027\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n$ ping 192.168.0.2\nPING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.\n64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=0.598 ms\n64 bytes from 192.168.0.2: icmp_seq=2 ttl=64 time=0.495 ms\n64 bytes from 192.168.0.2: icmp_seq=3 ttl=64 time=0.493 ms\n^C\n--- 192.168.0.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2000ms\nrtt min/avg/max/mdev = 0.493/0.528/0.598/0.055 ms\n\n$ ping 192.168.0.3\nPING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.\n64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.815 ms\n64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.462 ms\n64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.475 ms\n^C\n--- 192.168.0.3 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1999ms\nrtt min/avg/max/mdev = 0.462/0.584/0.815/0.163 ms\n\n\nJDK\u74b0\u5883\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001JAVA_HOME\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3059\u308b\n\n$ sudo apt-get install default-jdk\n$ sudo update-alternatives --list java\n/usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java\n\n$ cd $HOME\n$ vi .profile\n\n...(snip)\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n\n\n(2) golang\u74b0\u5883\u6574\u5099\n\u4ee5\u524d\u306e\u8a18\u4e8b\"Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\"\u3067\u306f\u3001Mac OS X\u74b0\u5883\u3092\u524d\u63d0\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u3001Ubuntu\u74b0\u5883\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\ngolang\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n$ cd $HOME\n$ wget --no-check-certificate https://storage.googleapis.com/golang/go1.6.linux-amd64.tar.gz\n$ sudo tar -C /usr/local -xzf go1.6.linux-amd64.tar.gz\n$ mkdir $HOME/golang\n$ vi .profile\n\n...(snip)\nexport GOPATH=$HOME/golang\nexport PATH=$GOPATH/bin:/usr/local/go/bin:$PATH\n\n$ source .profile\n$ go version\ngo version go1.6 linux/amd64\n\n\nNative Go Zookeeper Client Library\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n$ go get github.com/samuel/go-zookeeper/zk\n\n\n(3) ZooKeeper\u74b0\u5883\u69cb\u7bc9\n\u300cZooKeeper \u30b9\u30bf\u30fc\u30c8\u30ac\u30a4\u30c9 / \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e ZooKeeper \u306e\u5b9f\u884c\u300d\u3092\u53c2\u8003\u306b\u3057\u3066\u3001ZooKeeper\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\u3002\n\nZooKeeper\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n$ cd $HOME\n$ wget http://www-eu.apache.org/dist/zookeeper/zookeeper-3.4.8/zookeeper-3.4.8.tar.gz\n$ sudo tar -C /opt -xzf zookeeper-3.4.8.tar.gz\n$ cd /opt/zookeeper-3.4.8\n$ mkdir data\n$ cd conf\n\n\nZooKeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n$ vi zoo.cfg \ntickTime=2000\ndataDir=/opt/zookeeper-3.4.8/data\nclientPort=2181\ninitLimit=5\nsyncLimit=2\n\n## the zookeeper server quorum\nserver.1=192.168.0.1:2888:3888\nserver.2=192.168.0.2:2888:3888\nserver.3=192.168.0.3:2888:3888\n\n\nZooKeeper\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3067\u306e\u30b5\u30fc\u30d0\u8b58\u5225ID\u3092\u8a2d\u5b9a\u3059\u308b\uff08zooker-1\u306e\u5834\u5408\u306a\u306e\u3067\u3001\"1\"\u3092\u8a2d\u5b9a\u3059\u308b\uff09\n\n$ cd /opt/zookeeper-3.4.8/data\n$ vi myid\n1\n\n\nZooKeep\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u3001\u30ed\u30b0\u30a4\u30f3\u74b0\u5883\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\n\n$ cd $HOME\n$ vi .profile\n\n...(snip)\nexport PATH=/opt/zookeeper-3.4.8/bin:$GOPATH/bin:/usr/local/go/bin:$PATH\n\n$ source .profile\n\n\n\u2b1b\ufe0e ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\n\n(1) ZooKeeper\u306e\u8d77\u52d5\n\"zookeeper-1\", \"zookeeper-2\", \"zookeeper-3\"\u306e\u74b0\u5883\u6574\u5099\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\uff13\u53f0\u3068\u3082Zookeeper\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u300cZooKeeper \u7ba1\u7406\u8005\u30ac\u30a4\u30c9\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\nZooKeeper\u3092\u8d77\u52d5\u3059\u308b\n\n$ zkServer.sh start\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n\n\nZooKeeper\u8d77\u52d5\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\n\n$ echo ruok | nc localhost 2181\nimok\n\n\n(2) ZooKeeper\u306eLeader\u78ba\u8a8d\n\uff13\u53f0\u3068\u3082\u3001ZooKeeper\u304c\u8d77\u52d5\u3057\u305f\u306e\u3061\u306b\u3001ZooKeeper\u306eLeader\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ jps\n3119 Jps\n2980 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: follower\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 4\nSent: 3\nConnections: 1\nOutstanding: 0\nZxid: 0x2400000000\nMode: follower\nNode count: 4\n\n\n\"zookeeper-2\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ jps\n2064 Jps\n1873 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: follower\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 8\nSent: 7\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: follower\nNode count: 4\n\n\n\"zookeeper-3\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ jps\n2020 Jps\n1918 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 8\nSent: 7\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: leader\nNode count: 4\n\n\u4ee5\u4e0a\u3088\u308a\u3001\"zookeeper-3\"\u304c\u3001Leader\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n(3) \u8a66\u3057\u306b\u3001\u73fe\u884cLeader\u306e\"zookeeper-3\"\u3092OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\u73fe\u884cLeader\u304c\u505c\u6b62\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u6b8b\u308a\u306e\uff12\u53f0\u306eZooKeeper\u3067\u65b0\u305f\u306aLeader\u304c\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\"zookeeper-3\"\u306eOS\u3092\u505c\u6b62\u3059\u308b\n\n$ sudo halt\nBroadcast message from tsubo@zookeeper-3\n    (/dev/pts/0) at 14:56 ...\n\nThe system is going down for halt NOW!\n\n\n\"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 2\nSent: 1\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: follower\nNode count: 4\n\n\n\"zookeeper-2\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 2\nSent: 1\nConnections: 1\nOutstanding: 0\nZxid: 0x2600000000\nMode: leader\nNode count: 4\n\n\"zookeeper-3\"\u306eOS\u505c\u6b62\u306b\u4f34\u3044\u3001\"zookeeper-2\"\u304c\u65b0Leader\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n(4) \u3055\u3089\u306b\u3001\u73fe\u884cLeader\u306e\"zookeeper-2\"\u3092OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\u3055\u3089\u306b\u3001\u73fe\u884cLeader\u304c\u505c\u6b62\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u6b8b\u308a\u306e\uff11\u53f0\u306eZooKeeper\u3067\u65b0\u305f\u306aLeader\u304c\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n\"zookeeper-2\"\u306eOS\u3092\u505c\u6b62\u3059\u308b\n\n$ sudo halt\nBroadcast message from tsubo@zookeeper-2\n    (/dev/pts/0) at 15:00 ...\n\nThe system is going down for halt NOW!\n\n\n\"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n$ echo srvr | nc localhost 2181\nThis ZooKeeper instance is not currently serving requests\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nError contacting service. It is probably not running.\n\nZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306f\u3001\uff11\u53f0\u306eZooKeeper\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n\u305d\u3053\u3067\u3001\u300cZooKeeper \u7ba1\u7406\u8005\u30ac\u30a4\u30c9 / \u30af\u30e9\u30b9\u30bf (\u30de\u30eb\u30c1\u30b5\u30fc\u30d0\u30fc) \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u300d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u8a18\u8f09\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u4fe1\u983c\u6027\u306e\u9ad8\u3044 ZooKeeper \u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u306b\u306f\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u30af\u30e9\u30b9\u30bf\u306b ZooKeeper \u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u306e\u904e\u534a\u6570\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u9650\u308a\u3001ZooKeeper \u30b5\u30fc\u30d3\u30b9\u306f\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002ZooKeeper \u3067\u306f\u904e\u534a\u6570\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u5947\u6570\u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u306e\u304c\u30d9\u30b9\u30c8\u3067\u3059\u3002\u305f\u3068\u3048\u3070 4 \u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u5834\u5408\u3001ZooKeeper \u304c\u5bfe\u5fdc\u3067\u304d\u308b\u306e\u306f\u30de\u30b7\u30f3 1 \u53f0\u306e\u969c\u5bb3\u307e\u3067\u3067\u3059\u3002\u306a\u305c\u306a\u3089\u30012 \u53f0\u306e\u30de\u30b7\u30f3\u306b\u969c\u5bb3\u304c\u767a\u751f\u3059\u308b\u3068\u3001\u6b8b\u308a\u306e 2 \u53f0\u3067\u306f\u904e\u534a\u6570\u306b\u306a\u3089\u306a\u3044\u305f\u3081\u3067\u3059\u3002\u4e00\u65b9\u30015 \u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3048\u3070\u3001ZooKeeper \u306f\u30de\u30b7\u30f3 2 \u53f0\u307e\u3067\u306e\u969c\u5bb3\u306b\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\n\n\u306a\u308b\u307b\u3069\u3001\n\uff11\u53f0\u306eZooKeeper\u3067\u306f\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u304c\u52d5\u4f5c\u3057\u306a\u3044\u7406\u7531\u304c\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\n(5) ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306eLeader Election\u306e\u4ed5\u7d44\u307f\u306f\uff1f\n\u300cZooKeeper \u306e\u5185\u90e8 / Leader Activation\u300d\u306b\u3066\u3001ZooKeeper\u3067\u306eLeader Election\u65b9\u6cd5\u304c\u8a18\u8f09\u3055\u308c\u3066\u304a\u308a\u307e\u3059\u306d\u3002\n\n\u2b1b\ufe0e Golang\u30a2\u30d7\u30ea\u3067HA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u3044\u3088\u3044\u3088\u3001\u3053\u3053\u304b\u3089\u304c\u672c\u756a\u3067\u3059\u3002\nGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u306b\u304a\u3044\u3066\u3001ZooKeeper\u306eSPOF\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n(1) Golang\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3059\u308b\nGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u3092\u8a66\u3059\u305f\u3081\u306e\u74b0\u5883\u6e96\u5099\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\"zookeeper-1\", \"zookeeper-2\", \"zookeeper-3\"\u3001\u5404\u3005\u306b\u3001Golang\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\nstored\u30c7\u30fc\u30bf\u78ba\u8a8d\u7528\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3059\u308b\n\n\nsample_zookeeper_myApp.go\npackage main\n\nimport (\n    \"github.com/samuel/go-zookeeper/zk\"\n    \"os\"\n    \"os/signal\"\n    \"strings\"\n    \"strconv\"\n    \"time\"\n    \"log\"\n)\n\nvar RootPath string = \"/zookeeper-for-myApp\"\nvar zksStr string = os.Getenv(\"ZOOKEEPER_SERVERS\")\n\nfunc CreateRootPath(zks []string) *zk.Conn {\n    flags := int32(0)\n    acl := zk.WorldACL(zk.PermAll)\n    conn, _, err := zk.Connect(zks, time.Second)\n    conn.Create(RootPath, []byte{0}, flags, acl)\n    if err != nil {\n        panic(err)\n    }\n    defer conn.Close()\n    return conn\n}\n\n\nfunc JoinRootPath(zks []string) {\n    acl := zk.WorldACL(zk.PermAll)\n    conn, _, err := zk.Connect(zks, time.Second)\n    if err != nil {\n        panic(err)\n    }\n    lockPrefix := \"/lock-\"\n\n    path, err := conn.CreateProtectedEphemeralSequential(RootPath+lockPrefix,\n                                                         []byte{0}, acl)\n    myData := getParse(path)\n    ticker := time.NewTicker(time.Second)\n    for {\n        var isLeader bool = true\n        children, _, err := conn.Children(RootPath)\n        if err != nil {\n            isLeader = false\n        }\n        if children == nil {\n            isLeader = false\n        }\n        for _, c := range children {\n            otherData := getParse(c)\n            if myData > otherData {\n                isLeader = false\n                break\n            }\n        }\n\n        if isLeader == true {\n            log.Println(\"### I am Leader !! ###\")\n        }\n        <-ticker.C\n    }\n}\n\nfunc getParse(path string) int {\n    splits := strings.Split(path, \"-\")\n    seq := splits[len(splits)-1]\n    data, _ := strconv.Atoi(seq)\n    return data\n}\n\nfunc main() {\n    zks := strings.Split(zksStr, \",\")\n    CreateRootPath(zks)\n    quit_channel := make(chan os.Signal, 1)\n    signal.Notify(quit_channel, os.Interrupt)\n    go JoinRootPath(zks)\n    <-quit_channel\n}\n\n\n\n(2) Golang\u30a2\u30d7\u30ea\u81ea\u4f53\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u305d\u308c\u3067\u306f\u3001\u5404\u3005\u306eUbuntu\u30b5\u30fc\u30d0\u3067\u3001\"ZooKeeper\"\u3068\"sample_zookeeper_myApp\"\u3092\u8d77\u52d5\u3057\u3066\u3001Golang\u30a2\u30d7\u30ea\u81ea\u4f53\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n\nzookeeper-2\u4e0a\u3067\u3001Leader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n\n\u5404\u3005\u306eUbuntu\u30b5\u30fc\u30d0\u4e0a\u3067\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\n\n$ export ZOOKEEPER_SERVERS=\"192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181\"\n\n\nzookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:32 Connected to 192.168.0.1:2181\n2016/04/10 17:56:32 Authenticated: id=95700235219042308, timeout=4000\n2016/04/10 17:56:33 Recv loop terminated: err=EOF\n2016/04/10 17:56:33 Send loop terminated: err=<nil>\n2016/04/10 17:56:33 Connected to 192.168.0.2:2181\n2016/04/10 17:56:33 Authenticated: id=167757829242421252, timeout=4000\n2016/04/10 17:56:33 ### I am Leader !! ###\n2016/04/10 17:56:34 ### I am Leader !! ###\n2016/04/10 17:56:35 ### I am Leader !! ###\n2016/04/10 17:56:36 ### I am Leader !! ###\n\n...(snip)\n\n\nzookeeper-2\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:36 Connected to 192.168.0.1:2181\n2016/04/10 17:56:36 Authenticated: id=95700235219042309, timeout=4000\n2016/04/10 17:56:36 Recv loop terminated: err=EOF\n2016/04/10 17:56:36 Send loop terminated: err=<nil>\n2016/04/10 17:56:36 Connected to 192.168.0.2:2181\n2016/04/10 17:56:36 Authenticated: id=167757829242421253, timeout=4000\n\n\nzookeeper-3\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:38 Connected to 192.168.0.1:2181\n2016/04/10 17:56:38 Authenticated: id=95700235219042310, timeout=4000\n2016/04/10 17:56:38 Recv loop terminated: err=EOF\n2016/04/10 17:56:38 Send loop terminated: err=<nil>\n2016/04/10 17:56:38 Connected to 192.168.0.2:2181\n2016/04/10 17:56:38 Authenticated: id=167757829242421254, timeout=4000\n\n\nzookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u5f37\u5236\u505c\u6b62\u3057\u3066\u307f\u308b\n\n...(snip)\n\n2016/04/10 17:56:37 ### I am Leader !! ###\n2016/04/10 17:56:38 ### I am Leader !! ###\n2016/04/10 17:56:39 ### I am Leader !! ###\n2016/04/10 17:56:40 ### I am Leader !! ###\n2016/04/10 17:56:41 ### I am Leader !! ###\n2016/04/10 17:56:42 ### I am Leader !! ###\n2016/04/10 17:56:43 ### I am Leader !! ###\n^C\n\n\n\u3059\u308b\u3068\u3001zookeeper-2\u4e0a\u306e\u3001sample_zookeeper_myApp\u304c\u65b0\u305f\u306aLeader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\u3055\u3089\u306b\u3001zookeeper-2\u3067\u3001sample_zookeeper_myApp.go\u3092\u5f37\u5236\u505c\u6b62\u3057\u3066\u307f\u308b\u3002\n\n...(snip)\n\n2016/04/10 17:56:36 Authenticated: id=167757829242421253, timeout=4000\n2016/04/10 17:56:48 ### I am Leader !! ###\n2016/04/10 17:56:49 ### I am Leader !! ###\n2016/04/10 17:56:50 ### I am Leader !! ###\n2016/04/10 17:56:51 ### I am Leader !! ###\n2016/04/10 17:56:52 ### I am Leader !! ###\n2016/04/10 17:56:53 ### I am Leader !! ###\n2016/04/10 17:56:54 ### I am Leader !! ###\n2016/04/10 17:56:55 ### I am Leader !! ###\n2016/04/10 17:56:56 ### I am Leader !! ###\n^C\n\n\n\u3059\u308b\u3068\u3001zookeeper-3\u4e0a\u306e\u3001sample_zookeeper_myApp\u304c\u65b0\u305f\u306aLeader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n...(snip)\n\n2016/04/10 17:56:38 Authenticated: id=167757829242421254, timeout=4000\n2016/04/10 17:57:02 ### I am Leader !! ###\n2016/04/10 17:57:03 ### I am Leader !! ###\n2016/04/10 17:57:04 ### I am Leader !! ###\n2016/04/10 17:57:05 ### I am Leader !! ###\n2016/04/10 17:57:06 ### I am Leader !! ###\n2016/04/10 17:57:07 ### I am Leader !! ###\n2016/04/10 17:57:08 ### I am Leader !! ###\n\n\u4ee5\u4e0a\u3088\u308a\u3001\u4ee5\u524d\u306e\u8a18\u4e8b\"Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\"\u3067\u306eGolang\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u304c\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u518d\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n(3) \u3044\u3088\u3044\u3088\u3001Golang\u30a2\u30d7\u30ea\u52d5\u4f5c\u4e2d\u306b\u3001ZooKeeper\u306eLeader\u9078\u5b9a\u3092\u884c\u3063\u3066\u307f\u308b\n\n\nzookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n$ go run sample_zookeeper_myApp.go \n2016/04/10 18:34:04 Connected to 192.168.0.1:2181\n2016/04/10 18:34:04 Authenticated: id=95700235219042311, timeout=4000\n2016/04/10 18:34:04 Recv loop terminated: err=EOF\n2016/04/10 18:34:04 Send loop terminated: err=<nil>\n2016/04/10 18:34:04 Connected to 192.168.0.2:2181\n2016/04/10 18:34:04 Authenticated: id=167757829242421255, timeout=4000\n2016/04/10 18:34:04 ### I am Leader !! ###\n2016/04/10 18:34:05 ### I am Leader !! ###\n2016/04/10 18:34:06 ### I am Leader !! ###\n\n...(snip)\n\n\nLeader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u3066\u3044\u308bzookeeper-2\u4e0a\u3067\u3001OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n$ sudo halt\nBroadcast message from tsubo@zookeeper-2\n    (/dev/pts/0) at 18:34 ...\n\nThe system is going down for halt NOW!\n\n\n\u3059\u308b\u3068\u3001\u6570\u79d2\u306e\u9593\u3001Golang\u30a2\u30d7\u30ea\u306f\u3001\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308b\u304c\u3001\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u52d5\u4f5c\u306f\u56de\u5fa9\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n...(snip)\n\n2016/04/10 18:34:09 ### I am Leader !! ###\n2016/04/10 18:34:10 ### I am Leader !! ###\n2016/04/10 18:34:11 ### I am Leader !! ###\n2016/04/10 18:34:12 ### I am Leader !! ###\n2016/04/10 18:34:13 ### I am Leader !! ###\n2016/04/10 18:34:14 Recv loop terminated: err=EOF\n2016/04/10 18:34:14 Send loop terminated: err=<nil>\n2016/04/10 18:34:14 Connected to 192.168.0.3:2181\n2016/04/10 18:34:14 Authentication failed: EOF\n2016/04/10 18:34:14 Connected to 192.168.0.1:2181\n2016/04/10 18:34:14 Authentication failed: EOF\n2016/04/10 18:34:16 Failed to connect to 192.168.0.2:2181: dial tcp 192.168.0.2:2181: i/o timeout\n2016/04/10 18:34:16 Connected to 192.168.0.3:2181\n2016/04/10 18:34:16 Authenticated: id=167757829242421255, timeout=4000\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:17 ### I am Leader !! ###\n2016/04/10 18:34:18 ### I am Leader !! ###\n2016/04/10 18:34:19 ### I am Leader !! ###\n2016/04/10 18:34:20 ### I am Leader !! ###\n2016/04/10 18:34:21 ### I am Leader !! ###\n2016/04/10 18:34:22 ### I am Leader !! ###\n2016/04/10 18:34:23 ### I am Leader !! ###\n\n\nzookeeper-3\u4e0a\u3067\u3001\u65b0Leader\u3068\u3057\u3066\u3001\u9078\u5b9a\u3055\u308c\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n\u4ee5\u4e0a\u3088\u308a\u3001ZooKeeper\u30ec\u30d4\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u52d5\u4f5c\u306b\u3088\u308a\u3001zooKeeper\u306eSPOF\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002\n\n\n\u2b1b\ufe0e \u7d42\u308f\u308a\u306b\nBig data\u7528\u9014\u306e\u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3067\u306eHA\u52d5\u4f5c\u3068\u3057\u3066\u3001ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u52d5\u4f5c\u304c\u6d3b\u7528\u3055\u308c\u3066\u304a\u308a\u307e\u3059\u3002\u7d50\u69cb\u3001\u7e01\u306e\u4e0b\u306e\u529b\u3082\u3061\u7684\u306a\u5b58\u5728\u3060\u3063\u305f\u308a\u3057\u307e\u3059\u304c\u3001\u305d\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u3066\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\u4ee5\u524d\u306e\u8a18\u4e8b\"[Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b](http://qiita.com/ttsubo/items/554b780d7b22347bab5f)\"\u3067\u3001ZooKeeper\u3092\u6d3b\u7528\u3057\u305fGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u3092\u7d39\u4ecb\u3057\u307e\u3057\u305f\u304c\u3001\u3053\u3053\u3067\u306e\u8a18\u4e8b\u306e\u8ab2\u984c\u306f\u3001\u300cZooKeeper\u304cStandAlone\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u3082\u3057\u3001ZooKeeper\u304c\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3057\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3063\u305f\u3089\u3001Golang\u30a2\u30d7\u30ea\u3082\u52d5\u4f5c\u3067\u304d\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u300d\u3068\u3044\u3046\u3082\u306e\u304c\u3042\u308a\u307e\u3057\u305f\u3002\n\u305d\u3053\u3067\u3001\u4eca\u56de\u306f\u3001ZooKeeper\u306eSPOF\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3068\u3057\u3066\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u52d5\u4f5c\u3055\u305b\u3066\u307f\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u2b1b\ufe0e ZooKeeper\u306e\u74b0\u5883\u6574\u5099\n\nZookeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e\u52d5\u4f5c\u3092\u78ba\u8a8d\u3059\u308b\u306b\u3042\u305f\u308a\u3001Ubuntu\u30b5\u30fc\u30d0\u3092\uff13\u53f0\u7528\u610f\u3057\u307e\u3059\u3002\n\n- zookeeper-1\uff08IP: 192.168.0.1\uff09\n- zookeeper-2\uff08IP: 192.168.0.2\uff09\n- zookeeper-3\uff08IP: 192.168.0.3\uff09\n\n##(1) Linux\u74b0\u5883\u6e96\u5099\nzookeeper-1\u3067\u306e\u4f5c\u696d\u5c65\u6b74\u3092\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n- Ubunts\u74b0\u5883\u6574\u5099\u3059\u308b\n\n```\n$ cat /etc/lsb-release\nDISTRIB_ID=Ubuntu\nDISTRIB_RELEASE=14.04\nDISTRIB_CODENAME=trusty\nDISTRIB_DESCRIPTION=\"Ubuntu 14.04.3 LTS\"\n\n$ sudo apt-get install git\n```\n\n- \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8a2d\u5b9a\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ ip addr\n1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default \n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host \n       valid_lft forever preferred_lft forever\n2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:57:33:bd brd ff:ff:ff:ff:ff:ff\n    inet 192.168.195.168/24 brd 192.168.195.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe57:33bd/64 scope link \n       valid_lft forever preferred_lft forever\n3: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000\n    link/ether 00:0c:29:57:33:c7 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.0.1/24 brd 192.168.0.255 scope global eth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe57:33c7/64 scope link \n       valid_lft forever preferred_lft forever\n```\n\n- \u4ed6\u306eUbuntu\u30b5\u30fc\u30d0\u3068\u306e\u63a5\u7d9a\u6027\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304f\n\n```\n$ ping 192.168.0.2\nPING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.\n64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=0.598 ms\n64 bytes from 192.168.0.2: icmp_seq=2 ttl=64 time=0.495 ms\n64 bytes from 192.168.0.2: icmp_seq=3 ttl=64 time=0.493 ms\n^C\n--- 192.168.0.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2000ms\nrtt min/avg/max/mdev = 0.493/0.528/0.598/0.055 ms\n\n$ ping 192.168.0.3\nPING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.\n64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.815 ms\n64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.462 ms\n64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.475 ms\n^C\n--- 192.168.0.3 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 1999ms\nrtt min/avg/max/mdev = 0.462/0.584/0.815/0.163 ms\n```\n- JDK\u74b0\u5883\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3001JAVA_HOME\u74b0\u5883\u5909\u6570\u306b\u30bb\u30c3\u30c8\u3059\u308b\n\n```\n$ sudo apt-get install default-jdk\n$ sudo update-alternatives --list java\n/usr/lib/jvm/java-7-openjdk-amd64/jre/bin/java\n\n$ cd $HOME\n$ vi .profile\n\n...(snip)\nexport JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64\n```\n\n## (2) golang\u74b0\u5883\u6574\u5099\n\u4ee5\u524d\u306e\u8a18\u4e8b\"[Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b](http://qiita.com/ttsubo/items/554b780d7b22347bab5f)\"\u3067\u306f\u3001Mac OS X\u74b0\u5883\u3092\u524d\u63d0\u3068\u3057\u307e\u3057\u305f\u304c\u3001\u4eca\u56de\u306f\u3001Ubuntu\u74b0\u5883\u4e0a\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\n- golang\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n```\n$ cd $HOME\n$ wget --no-check-certificate https://storage.googleapis.com/golang/go1.6.linux-amd64.tar.gz\n$ sudo tar -C /usr/local -xzf go1.6.linux-amd64.tar.gz\n$ mkdir $HOME/golang\n$ vi .profile\n\n...(snip)\nexport GOPATH=$HOME/golang\nexport PATH=$GOPATH/bin:/usr/local/go/bin:$PATH\n\n$ source .profile\n$ go version\ngo version go1.6 linux/amd64\n```\n- Native Go Zookeeper Client Library\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3059\u308b\n\n```\n$ go get github.com/samuel/go-zookeeper/zk\n```\n\n\n\n## (3) ZooKeeper\u74b0\u5883\u69cb\u7bc9\n\u300c[ZooKeeper \u30b9\u30bf\u30fc\u30c8\u30ac\u30a4\u30c9 / \u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e ZooKeeper \u306e\u5b9f\u884c](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperStarted.html#sc_RunningReplicatedZooKeeper)\u300d\u3092\u53c2\u8003\u306b\u3057\u3066\u3001ZooKeeper\u74b0\u5883\u3092\u6574\u5099\u3057\u307e\u3059\u3002\n\n- ZooKeeper\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\n\n```\n$ cd $HOME\n$ wget http://www-eu.apache.org/dist/zookeeper/zookeeper-3.4.8/zookeeper-3.4.8.tar.gz\n$ sudo tar -C /opt -xzf zookeeper-3.4.8.tar.gz\n$ cd /opt/zookeeper-3.4.8\n$ mkdir data\n$ cd conf\n```\n\n- ZooKeeper\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u7de8\u96c6\u3059\u308b\n\n```\n$ vi zoo.cfg \ntickTime=2000\ndataDir=/opt/zookeeper-3.4.8/data\nclientPort=2181\ninitLimit=5\nsyncLimit=2\n\n## the zookeeper server quorum\nserver.1=192.168.0.1:2888:3888\nserver.2=192.168.0.2:2888:3888\nserver.3=192.168.0.3:2888:3888\n```\n- ZooKeeper\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3067\u306e\u30b5\u30fc\u30d0\u8b58\u5225ID\u3092\u8a2d\u5b9a\u3059\u308b\uff08zooker-1\u306e\u5834\u5408\u306a\u306e\u3067\u3001\"1\"\u3092\u8a2d\u5b9a\u3059\u308b\uff09\n\n```\n$ cd /opt/zookeeper-3.4.8/data\n$ vi myid\n1\n```\n\n- ZooKeep\u30b3\u30de\u30f3\u30c9\u306e\u30d1\u30b9\u3092\u3001\u30ed\u30b0\u30a4\u30f3\u74b0\u5883\u8a2d\u5b9a\u306b\u8ffd\u52a0\u3059\u308b\n\n```\n$ cd $HOME\n$ vi .profile\n\n...(snip)\nexport PATH=/opt/zookeeper-3.4.8/bin:$GOPATH/bin:/usr/local/go/bin:$PATH\n\n$ source .profile\n```\n\n# \u2b1b\ufe0e ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\n## (1) ZooKeeper\u306e\u8d77\u52d5\n\"zookeeper-1\", \"zookeeper-2\", \"zookeeper-3\"\u306e\u74b0\u5883\u6574\u5099\u304c\u5b8c\u4e86\u3057\u305f\u3089\u3001\uff13\u53f0\u3068\u3082Zookeeper\u3092\u8d77\u52d5\u3057\u307e\u3059\u3002\n\u300c[ZooKeeper \u7ba1\u7406\u8005\u30ac\u30a4\u30c9](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperStarted.html#sc_RunningReplicatedZooKeeper)\u300d\u304c\u53c2\u8003\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n- ZooKeeper\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ zkServer.sh start\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nStarting zookeeper ... STARTED\n```\n- ZooKeeper\u8d77\u52d5\u7d50\u679c\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ echo ruok | nc localhost 2181\nimok\n```\n## (2) ZooKeeper\u306eLeader\u78ba\u8a8d\n\uff13\u53f0\u3068\u3082\u3001ZooKeeper\u304c\u8d77\u52d5\u3057\u305f\u306e\u3061\u306b\u3001ZooKeeper\u306eLeader\u3092\u78ba\u8a8d\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n- \"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ jps\n3119 Jps\n2980 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: follower\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 4\nSent: 3\nConnections: 1\nOutstanding: 0\nZxid: 0x2400000000\nMode: follower\nNode count: 4\n```\n\n- \"zookeeper-2\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ jps\n2064 Jps\n1873 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: follower\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 8\nSent: 7\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: follower\nNode count: 4\n```\n\n- \"zookeeper-3\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ jps\n2020 Jps\n1918 QuorumPeerMain\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 8\nSent: 7\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: leader\nNode count: 4\n```\n<b>\u4ee5\u4e0a\u3088\u308a\u3001\"zookeeper-3\"\u304c\u3001Leader\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002</b>\n\n## (3) \u8a66\u3057\u306b\u3001\u73fe\u884cLeader\u306e\"zookeeper-3\"\u3092OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\u73fe\u884cLeader\u304c\u505c\u6b62\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u6b8b\u308a\u306e\uff12\u53f0\u306eZooKeeper\u3067\u65b0\u305f\u306aLeader\u304c\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n- \"zookeeper-3\"\u306eOS\u3092\u505c\u6b62\u3059\u308b\n\n```\n$ sudo halt\nBroadcast message from tsubo@zookeeper-3\n\t(/dev/pts/0) at 14:56 ...\n\nThe system is going down for halt NOW!\n```\n\n- \"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 2\nSent: 1\nConnections: 1\nOutstanding: 0\nZxid: 0x2500000000\nMode: follower\nNode count: 4\n```\n\n- \"zookeeper-2\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ echo srvr | nc localhost 2181\nZookeeper version: 3.4.8--1, built on 02/06/2016 03:18 GMT\nLatency min/avg/max: 0/0/0\nReceived: 2\nSent: 1\nConnections: 1\nOutstanding: 0\nZxid: 0x2600000000\nMode: leader\nNode count: 4\n```\n<b>\"zookeeper-3\"\u306eOS\u505c\u6b62\u306b\u4f34\u3044\u3001\"zookeeper-2\"\u304c\u65b0Leader\u3068\u3057\u3066\u52d5\u4f5c\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002</b>\n\n## (4) \u3055\u3089\u306b\u3001\u73fe\u884cLeader\u306e\"zookeeper-2\"\u3092OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\u3055\u3089\u306b\u3001\u73fe\u884cLeader\u304c\u505c\u6b62\u3057\u3066\u3057\u307e\u3063\u305f\u5834\u5408\u3001\u6b8b\u308a\u306e\uff11\u53f0\u306eZooKeeper\u3067\u65b0\u305f\u306aLeader\u304c\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\n\n- \"zookeeper-2\"\u306eOS\u3092\u505c\u6b62\u3059\u308b\n\n```\n$ sudo halt\nBroadcast message from tsubo@zookeeper-2\n\t(/dev/pts/0) at 15:00 ...\n\nThe system is going down for halt NOW!\n```\n\n- \"zookeeper-1\"\u3067\u3001ZooKeeper\u52d5\u4f5c\u72b6\u614b\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ echo srvr | nc localhost 2181\nThis ZooKeeper instance is not currently serving requests\n\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nError contacting service. It is probably not running.\n```\n\n<b>ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306f\u3001\uff11\u53f0\u306eZooKeeper\u3067\u306f\u52d5\u4f5c\u3057\u306a\u3044\u3088\u3046\u3067\u3059\u3002\n</b>\u305d\u3053\u3067\u3001\u300c[ZooKeeper \u7ba1\u7406\u8005\u30ac\u30a4\u30c9 / \u30af\u30e9\u30b9\u30bf (\u30de\u30eb\u30c1\u30b5\u30fc\u30d0\u30fc) \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperStarted.html#sc_RunningReplicatedZooKeeper)\u300d\u3092\u78ba\u8a8d\u3057\u3066\u307f\u308b\u3068\u3001\u6b21\u306e\u3088\u3046\u306a\u8a18\u8f09\u304c\u3042\u308a\u307e\u3059\u3002\n> \u4fe1\u983c\u6027\u306e\u9ad8\u3044 ZooKeeper \u30b5\u30fc\u30d3\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u306b\u306f\u3001\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u3068\u547c\u3070\u308c\u308b\u30af\u30e9\u30b9\u30bf\u306b ZooKeeper \u3092\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30a2\u30f3\u30b5\u30f3\u30d6\u30eb\u306e\u904e\u534a\u6570\u304c\u52d5\u4f5c\u3057\u3066\u3044\u308b\u9650\u308a\u3001ZooKeeper \u30b5\u30fc\u30d3\u30b9\u306f\u5229\u7528\u53ef\u80fd\u3067\u3059\u3002ZooKeeper \u3067\u306f\u904e\u534a\u6570\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3001\u5947\u6570\u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u306e\u304c\u30d9\u30b9\u30c8\u3067\u3059\u3002\u305f\u3068\u3048\u3070 4 \u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3046\u5834\u5408\u3001ZooKeeper \u304c\u5bfe\u5fdc\u3067\u304d\u308b\u306e\u306f\u30de\u30b7\u30f3 1 \u53f0\u306e\u969c\u5bb3\u307e\u3067\u3067\u3059\u3002\u306a\u305c\u306a\u3089\u30012 \u53f0\u306e\u30de\u30b7\u30f3\u306b\u969c\u5bb3\u304c\u767a\u751f\u3059\u308b\u3068\u3001\u6b8b\u308a\u306e 2 \u53f0\u3067\u306f\u904e\u534a\u6570\u306b\u306a\u3089\u306a\u3044\u305f\u3081\u3067\u3059\u3002\u4e00\u65b9\u30015 \u53f0\u306e\u30de\u30b7\u30f3\u3092\u4f7f\u3048\u3070\u3001ZooKeeper \u306f\u30de\u30b7\u30f3 2 \u53f0\u307e\u3067\u306e\u969c\u5bb3\u306b\u5bfe\u5fdc\u3067\u304d\u307e\u3059\u3002\n\n\u306a\u308b\u307b\u3069\u3001\n\uff11\u53f0\u306eZooKeeper\u3067\u306f\u3001\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u304c\u52d5\u4f5c\u3057\u306a\u3044\u7406\u7531\u304c\u7406\u89e3\u3067\u304d\u307e\u3057\u305f\u3002\n\n## (5) ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u3067\u306eLeader Election\u306e\u4ed5\u7d44\u307f\u306f\uff1f\n\n\u300c[ZooKeeper \u306e\u5185\u90e8 / Leader Activation](http://oss.infoscience.co.jp/hadoop/zookeeper/docs/r3.3.1/zookeeperInternals.html#sc_quorum)\u300d\u306b\u3066\u3001ZooKeeper\u3067\u306eLeader Election\u65b9\u6cd5\u304c\u8a18\u8f09\u3055\u308c\u3066\u304a\u308a\u307e\u3059\u306d\u3002\n\n# \u2b1b\ufe0e Golang\u30a2\u30d7\u30ea\u3067HA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u3044\u3088\u3044\u3088\u3001\u3053\u3053\u304b\u3089\u304c\u672c\u756a\u3067\u3059\u3002\nGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u306b\u304a\u3044\u3066\u3001ZooKeeper\u306eSPOF\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n## (1) Golang\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3059\u308b\nGolang\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u3092\u8a66\u3059\u305f\u3081\u306e\u74b0\u5883\u6e96\u5099\u304b\u3089\u59cb\u3081\u307e\u3059\u3002\n\"zookeeper-1\", \"zookeeper-2\", \"zookeeper-3\"\u3001\u5404\u3005\u306b\u3001Golang\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3057\u307e\u3059\u3002\n\n- stored\u30c7\u30fc\u30bf\u78ba\u8a8d\u7528\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u3092\u914d\u7f6e\u3059\u308b\n\n```golang:sample_zookeeper_myApp.go\npackage main\n\nimport (\n    \"github.com/samuel/go-zookeeper/zk\"\n    \"os\"\n    \"os/signal\"\n    \"strings\"\n    \"strconv\"\n    \"time\"\n    \"log\"\n)\n\nvar RootPath string = \"/zookeeper-for-myApp\"\nvar zksStr string = os.Getenv(\"ZOOKEEPER_SERVERS\")\n\nfunc CreateRootPath(zks []string) *zk.Conn {\n    flags := int32(0)\n    acl := zk.WorldACL(zk.PermAll)\n    conn, _, err := zk.Connect(zks, time.Second)\n    conn.Create(RootPath, []byte{0}, flags, acl)\n    if err != nil {\n        panic(err)\n    }\n    defer conn.Close()\n    return conn\n}\n\n\nfunc JoinRootPath(zks []string) {\n    acl := zk.WorldACL(zk.PermAll)\n    conn, _, err := zk.Connect(zks, time.Second)\n    if err != nil {\n        panic(err)\n    }\n    lockPrefix := \"/lock-\"\n\n    path, err := conn.CreateProtectedEphemeralSequential(RootPath+lockPrefix,\n                                                         []byte{0}, acl)\n    myData := getParse(path)\n    ticker := time.NewTicker(time.Second)\n    for {\n        var isLeader bool = true\n        children, _, err := conn.Children(RootPath)\n        if err != nil {\n            isLeader = false\n        }\n        if children == nil {\n            isLeader = false\n        }\n        for _, c := range children {\n            otherData := getParse(c)\n            if myData > otherData {\n                isLeader = false\n                break\n            }\n        }\n\n        if isLeader == true {\n            log.Println(\"### I am Leader !! ###\")\n        }\n        <-ticker.C\n    }\n}\n\nfunc getParse(path string) int {\n    splits := strings.Split(path, \"-\")\n    seq := splits[len(splits)-1]\n    data, _ := strconv.Atoi(seq)\n    return data\n}\n\nfunc main() {\n    zks := strings.Split(zksStr, \",\")\n    CreateRootPath(zks)\n    quit_channel := make(chan os.Signal, 1)\n    signal.Notify(quit_channel, os.Interrupt)\n    go JoinRootPath(zks)\n    <-quit_channel\n}\n```\n\n## (2) Golang\u30a2\u30d7\u30ea\u81ea\u4f53\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b\n\u305d\u308c\u3067\u306f\u3001\u5404\u3005\u306eUbuntu\u30b5\u30fc\u30d0\u3067\u3001\"ZooKeeper\"\u3068\"sample_zookeeper_myApp\"\u3092\u8d77\u52d5\u3057\u3066\u3001Golang\u30a2\u30d7\u30ea\u81ea\u4f53\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u307e\u3059\u3002\n\n![sample_zookeeper1.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/efc4dd22-714f-4c21-18ff-97e678f8a76a.jpeg)\n\n\n\n- zookeeper-2\u4e0a\u3067\u3001Leader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\n\n```\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n```\n\n- \u5404\u3005\u306eUbuntu\u30b5\u30fc\u30d0\u4e0a\u3067\u306e\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3059\u308b\n\n```\n$ export ZOOKEEPER_SERVERS=\"192.168.0.1:2181,192.168.0.2:2181,192.168.0.3:2181\"\n```\n\n- zookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:32 Connected to 192.168.0.1:2181\n2016/04/10 17:56:32 Authenticated: id=95700235219042308, timeout=4000\n2016/04/10 17:56:33 Recv loop terminated: err=EOF\n2016/04/10 17:56:33 Send loop terminated: err=<nil>\n2016/04/10 17:56:33 Connected to 192.168.0.2:2181\n2016/04/10 17:56:33 Authenticated: id=167757829242421252, timeout=4000\n2016/04/10 17:56:33 ### I am Leader !! ###\n2016/04/10 17:56:34 ### I am Leader !! ###\n2016/04/10 17:56:35 ### I am Leader !! ###\n2016/04/10 17:56:36 ### I am Leader !! ###\n\n...(snip)\n```\n\n- zookeeper-2\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:36 Connected to 192.168.0.1:2181\n2016/04/10 17:56:36 Authenticated: id=95700235219042309, timeout=4000\n2016/04/10 17:56:36 Recv loop terminated: err=EOF\n2016/04/10 17:56:36 Send loop terminated: err=<nil>\n2016/04/10 17:56:36 Connected to 192.168.0.2:2181\n2016/04/10 17:56:36 Authenticated: id=167757829242421253, timeout=4000\n```\n- zookeeper-3\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ go run sample_zookeeper_myApp.go \n2016/04/10 17:56:38 Connected to 192.168.0.1:2181\n2016/04/10 17:56:38 Authenticated: id=95700235219042310, timeout=4000\n2016/04/10 17:56:38 Recv loop terminated: err=EOF\n2016/04/10 17:56:38 Send loop terminated: err=<nil>\n2016/04/10 17:56:38 Connected to 192.168.0.2:2181\n2016/04/10 17:56:38 Authenticated: id=167757829242421254, timeout=4000\n```\n- zookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u5f37\u5236\u505c\u6b62\u3057\u3066\u307f\u308b\n\n```\n...(snip)\n\n2016/04/10 17:56:37 ### I am Leader !! ###\n2016/04/10 17:56:38 ### I am Leader !! ###\n2016/04/10 17:56:39 ### I am Leader !! ###\n2016/04/10 17:56:40 ### I am Leader !! ###\n2016/04/10 17:56:41 ### I am Leader !! ###\n2016/04/10 17:56:42 ### I am Leader !! ###\n2016/04/10 17:56:43 ### I am Leader !! ###\n^C\n```\n- \u3059\u308b\u3068\u3001zookeeper-2\u4e0a\u306e\u3001sample_zookeeper_myApp\u304c\u65b0\u305f\u306aLeader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\u3055\u3089\u306b\u3001zookeeper-2\u3067\u3001sample_zookeeper_myApp.go\u3092\u5f37\u5236\u505c\u6b62\u3057\u3066\u307f\u308b\u3002\n\n```\n...(snip)\n\n2016/04/10 17:56:36 Authenticated: id=167757829242421253, timeout=4000\n2016/04/10 17:56:48 ### I am Leader !! ###\n2016/04/10 17:56:49 ### I am Leader !! ###\n2016/04/10 17:56:50 ### I am Leader !! ###\n2016/04/10 17:56:51 ### I am Leader !! ###\n2016/04/10 17:56:52 ### I am Leader !! ###\n2016/04/10 17:56:53 ### I am Leader !! ###\n2016/04/10 17:56:54 ### I am Leader !! ###\n2016/04/10 17:56:55 ### I am Leader !! ###\n2016/04/10 17:56:56 ### I am Leader !! ###\n^C\n```\n- \u3059\u308b\u3068\u3001zookeeper-3\u4e0a\u306e\u3001sample_zookeeper_myApp\u304c\u65b0\u305f\u306aLeader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\u3002\n\n```\n...(snip)\n\n2016/04/10 17:56:38 Authenticated: id=167757829242421254, timeout=4000\n2016/04/10 17:57:02 ### I am Leader !! ###\n2016/04/10 17:57:03 ### I am Leader !! ###\n2016/04/10 17:57:04 ### I am Leader !! ###\n2016/04/10 17:57:05 ### I am Leader !! ###\n2016/04/10 17:57:06 ### I am Leader !! ###\n2016/04/10 17:57:07 ### I am Leader !! ###\n2016/04/10 17:57:08 ### I am Leader !! ###\n```\n\n\u4ee5\u4e0a\u3088\u308a\u3001\u4ee5\u524d\u306e\u8a18\u4e8b\"[Go\u8a00\u8a9e\u304b\u3089\u3001Zookeeper\u3067\u306eHA\u52d5\u4f5c\u3092\u8a66\u3057\u3066\u307f\u308b](http://qiita.com/ttsubo/items/554b780d7b22347bab5f)\"\u3067\u306eGolang\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u306eHA\u52d5\u4f5c\u304c\u671f\u5f85\u901a\u308a\u306b\u52d5\u4f5c\u3059\u308b\u3053\u3068\u3092\u518d\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n## (3) \u3044\u3088\u3044\u3088\u3001Golang\u30a2\u30d7\u30ea\u52d5\u4f5c\u4e2d\u306b\u3001ZooKeeper\u306eLeader\u9078\u5b9a\u3092\u884c\u3063\u3066\u307f\u308b\n\n![sample_zookeeper2.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/8e32bbdf-653f-2633-0494-7137959706bc.jpeg)\n\n- zookeeper-1\u3067\u3001sample_zookeeper_myApp.go\u3092\u8d77\u52d5\u3059\u308b\n\n```\n$ go run sample_zookeeper_myApp.go \n2016/04/10 18:34:04 Connected to 192.168.0.1:2181\n2016/04/10 18:34:04 Authenticated: id=95700235219042311, timeout=4000\n2016/04/10 18:34:04 Recv loop terminated: err=EOF\n2016/04/10 18:34:04 Send loop terminated: err=<nil>\n2016/04/10 18:34:04 Connected to 192.168.0.2:2181\n2016/04/10 18:34:04 Authenticated: id=167757829242421255, timeout=4000\n2016/04/10 18:34:04 ### I am Leader !! ###\n2016/04/10 18:34:05 ### I am Leader !! ###\n2016/04/10 18:34:06 ### I am Leader !! ###\n\n...(snip)\n```\n- Leader\u3068\u3057\u3066\u9078\u5b9a\u3055\u308c\u3066\u3044\u308bzookeeper-2\u4e0a\u3067\u3001OS\u505c\u6b62\u3057\u3066\u307f\u308b\n\n```\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n\n$ sudo halt\nBroadcast message from tsubo@zookeeper-2\n\t(/dev/pts/0) at 18:34 ...\n\nThe system is going down for halt NOW!\n```\n- \u3059\u308b\u3068\u3001\u6570\u79d2\u306e\u9593\u3001Golang\u30a2\u30d7\u30ea\u306f\u3001\u52d5\u4f5c\u3057\u306a\u304f\u306a\u308b\u304c\u3001\u3057\u3070\u3089\u304f\u3059\u308b\u3068\u3001\u52d5\u4f5c\u306f\u56de\u5fa9\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n```\n...(snip)\n\n2016/04/10 18:34:09 ### I am Leader !! ###\n2016/04/10 18:34:10 ### I am Leader !! ###\n2016/04/10 18:34:11 ### I am Leader !! ###\n2016/04/10 18:34:12 ### I am Leader !! ###\n2016/04/10 18:34:13 ### I am Leader !! ###\n2016/04/10 18:34:14 Recv loop terminated: err=EOF\n2016/04/10 18:34:14 Send loop terminated: err=<nil>\n2016/04/10 18:34:14 Connected to 192.168.0.3:2181\n2016/04/10 18:34:14 Authentication failed: EOF\n2016/04/10 18:34:14 Connected to 192.168.0.1:2181\n2016/04/10 18:34:14 Authentication failed: EOF\n2016/04/10 18:34:16 Failed to connect to 192.168.0.2:2181: dial tcp 192.168.0.2:2181: i/o timeout\n2016/04/10 18:34:16 Connected to 192.168.0.3:2181\n2016/04/10 18:34:16 Authenticated: id=167757829242421255, timeout=4000\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:16 ### I am Leader !! ###\n2016/04/10 18:34:17 ### I am Leader !! ###\n2016/04/10 18:34:18 ### I am Leader !! ###\n2016/04/10 18:34:19 ### I am Leader !! ###\n2016/04/10 18:34:20 ### I am Leader !! ###\n2016/04/10 18:34:21 ### I am Leader !! ###\n2016/04/10 18:34:22 ### I am Leader !! ###\n2016/04/10 18:34:23 ### I am Leader !! ###\n```\n\n- zookeeper-3\u4e0a\u3067\u3001\u65b0Leader\u3068\u3057\u3066\u3001\u9078\u5b9a\u3055\u308c\u305f\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u308b\n\n```\n$ zkServer.sh status\nZooKeeper JMX enabled by default\nUsing config: /opt/zookeeper-3.4.8/bin/../conf/zoo.cfg\nMode: leader\n```\n\n<b>\u4ee5\u4e0a\u3088\u308a\u3001ZooKeeper\u30ec\u30d4\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u52d5\u4f5c\u306b\u3088\u308a\u3001zooKeeper\u306eSPOF\u554f\u984c\u304c\u89e3\u6c7a\u3067\u304d\u305f\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002</b>\n\n![sample_zookeeper3.jpeg](https://qiita-image-store.s3.amazonaws.com/0/103595/fe50d78d-5364-fab2-616a-ad4dac4638fa.jpeg)\n\n\n# \u2b1b\ufe0e \u7d42\u308f\u308a\u306b\nBig data\u7528\u9014\u306e\u5404\u7a2e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3067\u306eHA\u52d5\u4f5c\u3068\u3057\u3066\u3001ZooKeeper\u30ec\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30e2\u30fc\u30c9\u52d5\u4f5c\u304c\u6d3b\u7528\u3055\u308c\u3066\u304a\u308a\u307e\u3059\u3002\u7d50\u69cb\u3001\u7e01\u306e\u4e0b\u306e\u529b\u3082\u3061\u7684\u306a\u5b58\u5728\u3060\u3063\u305f\u308a\u3057\u307e\u3059\u304c\u3001\u305d\u306e\u57fa\u672c\u52d5\u4f5c\u3092\u5b9f\u969b\u306b\u52d5\u304b\u3057\u3066\u307f\u3066\u671f\u5f85\u901a\u308a\u52d5\u4f5c\u3059\u308b\u3053\u3068\u304c\u78ba\u8a8d\u3067\u304d\u307e\u3057\u305f\u3002\n\n", "tags": ["ZooKeeper"]}