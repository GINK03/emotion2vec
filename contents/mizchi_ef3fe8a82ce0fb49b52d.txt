{"tags": ["react.js"], "context": " More than 1 year has passed since last update.\n\n\u4f55\u306e\u76ee\u7684\u3067\u4f7f\u3046\u304b\n\u3042\u308b\u89aa\u306e\u8981\u7d20\u4ee5\u4e0b\u3067\u306f\u3001\u5b50\u4f9b\u306f\u3042\u308b\u7279\u5b9a\u306e\u89aa(\u304a\u305d\u3089\u304f\u306f\u6839)\u306b\u4f9d\u5b58\u3057\u305f\u7279\u5b9a\u306e this.context \u306e\u72b6\u614b\u3092\u6301\u3066\u308b\u6a5f\u80fd\u304cContext\u3067\u3042\u308b\u3002\nReact\u3067\u306f\u8981\u7d20\u306e\u53d7\u3051\u6e21\u3057\u306b\u3072\u305f\u3059\u3089\u5b50\u3078\u30ea\u30ec\u30fc\u3059\u308b\u65b9\u6cd5\u304c\u30e1\u30b8\u30e3\u30fc\u3060\u304c\u3001mixin\u3067\u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u306f\u96a0\u3057\u305f\u3044\u4e8b\u304c\u591a\u3044\u3002\u305d\u3053\u3067context\u3092\u4f7f\u3046\u3002\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u3053\u308c\u306fReact\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5b9f\u88c5\u8005\u3084mixin\u63d0\u4f9b\u8005\u306b\u5fc5\u8981\u306a\u77e5\u8b58\u3067\u3042\u3063\u3066\u3001\u4e00\u822c\u7684\u306aReact\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u3067Context\u3092\u4f7f\u3046\u306e\u306f\u8907\u96d1\u3059\u304e\u308b\u306e\u3067\u500b\u4eba\u7684\u306b\u306f\u63a8\u5968\u3057\u306a\u3044\u3002React\u3068\u3057\u3066\u3082undocumeted\u3067\u3042\u308b\u3002\n\u53c2\u8003: React.js: Communication between Components with ContextsJScrambler Blog\n\n\u6982\u8981\n\n\u89aa\u3067 static childContextTypes = {...} \u3068 getChildContext() \u3092\u5b9f\u88c5\u3059\u308b\n\u5b50\u3067 static contextTypes = {...} \u3092\u5b9f\u88c5\u3059\u308b\n\u5b50\u3067 this.context \u306f getChildContext \u306e\u7d50\u679c\u3092\u53c2\u7167\u3067\u304d\u308b\n\n\n\u6700\u5c0f\u30b3\u30fc\u30c9\u4f8b\nimport React from 'react';\nimport Dom from 'react-dom/server';\n\nclass Child extends React.Component {\n  static get contextTypes() {\n    return {a: React.PropTypes.any};\n  }\n\n  render() {\n    return <span>{this.context.a}</span>;\n  }\n}\n\nclass Parent extends React.Component {\n  static get childContextTypes() {\n    return {a: React.PropTypes.any};\n  }\n\n  getChildContext() {\n    return {a: 1};\n  }\n\n  render() {\n    return <Child/>;\n  }\n}\n\nconst ret = Dom.renderToString(<Parent/>);\nconsole.log(ret); // <span data-reactid=\".1rrwza5woao\" data-react-checksum=\"1038880381\">1</span>\n\na = 1 \u3068\u3057\u3066\u3061\u3083\u3093\u3068\u63cf\u753b\u3055\u308c\u3066\u3044\u308b\u3002\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u5b50\u3068\u89aa\u306e contextTypes \u306f\u76f4\u611f\u306b\u53cd\u3057\u3066\u300c\u578b\u3092\u660e\u8a18\u3059\u308b\u306e\u306b\u3042\u308b\u3068\u4fbf\u5229\u300d\u3067\u306f\u306a\u304f\u300c\u5fc5\u9808\u300d\u3067\u3042\u308b\u3002\u3053\u3053\u304cpropTypes\u3068\u5927\u304d\u304f\u7570\u306a\u308b\u3002\n\nFlux \u3092\u5b9f\u88c5\u3059\u308b\n\u3042\u308b\u89aa\u4ee5\u4e0b\u306e\u8981\u7d20\u306e\u4ee5\u4e0b\u3067\u306f\u540c\u4e00\u306eEventEmitter \u3078\u306e\u53c2\u7167\u3092\u6301\u3061\u305f\u3044\nArda\u3067\u3084\u3063\u3066\u308b dispatch mixin \u3068\u540c\u7b49\u306e\u5b9f\u88c5\n// context\nimport React from 'react';\nimport Dom from 'react-dom';\nimport {EventEmitter} from 'events';\n\nconst SharedTypes = {emitter: React.PropTypes.any};\n\nclass Provider extends React.Component {\n  static get childContextTypes() {\n    return SharedTypes;\n  }\n\n  getChildContext() {\n    return {emitter: this.props.emitter};\u3000\n  }\u3000\n}\n\nclass DispatchableComponent extends React.Component {\n  static get contextTypes() {\n    return SharedTypes;\n  }\n  dispatch(...args) {\n    return this.context.emitter.emit(...args);\n  }\n}\n\n// Usage\nclass App extends Provider {\n  render() {\n    return (<Content {...this.props.childState} />);\n  }\n}\n\nclass Content extends DispatchableComponent {\n  render() {\n    return (\n      <span\n        onClick={() => this.dispatch('foo')}\n      >\n      {this.props.count}\n      </span>\n    );\n  }\n}\n\nconst emitter = new EventEmitter();\nfunction render(state) {\n  Dom.render(<App emitter={emitter} childState={state}/>, document.body);\n}\n\n// flux loop \u306e Dispatcher \u76f8\u5f53\nconst state = {count: 1};\nemitter.on('foo', () => {\n  // \u4f55\u304b\u64cd\u4f5c\u3059\u308b\n  state.count += 1;\n  // \u518d\u63cf\u753b\n  render(state);\n});\nrender(state);\n\nEmitter\u3068dispatch\u306e\u95a2\u4fc2\u3001dispatch\u306e\u5b9f\u88c5\u306e\u4e2d\u8eab\u3001React\u3068Emitter\u306e\u95a2\u4fc2\u3092\u96a0\u853d\u3067\u304d\u305f\u3002\u5f8c\u306f state \u3068 emitter \u306e\u30ed\u30b8\u30c3\u30af\u3092\u7d44\u307f\u7acb\u3066\u308b\u5b9f\u88c5\u3001state\u3068ReactElement\u306e\u95a2\u4fc2\u3092\u5225\u306b\u8a18\u8ff0\u3057\u3066\u958b\u767a\u3059\u308c\u3070\u826f\u3044\u3002\n\n## \u4f55\u306e\u76ee\u7684\u3067\u4f7f\u3046\u304b\n\n\u3042\u308b\u89aa\u306e\u8981\u7d20\u4ee5\u4e0b\u3067\u306f\u3001\u5b50\u4f9b\u306f\u3042\u308b\u7279\u5b9a\u306e\u89aa(\u304a\u305d\u3089\u304f\u306f\u6839)\u306b\u4f9d\u5b58\u3057\u305f\u7279\u5b9a\u306e this.context \u306e\u72b6\u614b\u3092\u6301\u3066\u308b\u6a5f\u80fd\u304cContext\u3067\u3042\u308b\u3002\n\nReact\u3067\u306f\u8981\u7d20\u306e\u53d7\u3051\u6e21\u3057\u306b\u3072\u305f\u3059\u3089\u5b50\u3078\u30ea\u30ec\u30fc\u3059\u308b\u65b9\u6cd5\u304c\u30e1\u30b8\u30e3\u30fc\u3060\u304c\u3001mixin\u3067\u5fc5\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u306f\u30e6\u30fc\u30b6\u30fc\u304b\u3089\u306f\u96a0\u3057\u305f\u3044\u4e8b\u304c\u591a\u3044\u3002\u305d\u3053\u3067context\u3092\u4f7f\u3046\u3002\n\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u3053\u308c\u306fReact\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5b9f\u88c5\u8005\u3084mixin\u63d0\u4f9b\u8005\u306b\u5fc5\u8981\u306a\u77e5\u8b58\u3067\u3042\u3063\u3066\u3001\u4e00\u822c\u7684\u306aReact\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u4e2d\u3067Context\u3092\u4f7f\u3046\u306e\u306f\u8907\u96d1\u3059\u304e\u308b\u306e\u3067\u500b\u4eba\u7684\u306b\u306f\u63a8\u5968\u3057\u306a\u3044\u3002React\u3068\u3057\u3066\u3082undocumeted\u3067\u3042\u308b\u3002\n\n\u53c2\u8003: [React.js: Communication between Components with ContextsJScrambler Blog](https://blog.jscrambler.com/react-js-communication-between-components-with-contexts/ \"React.js: Communication between Components with ContextsJScrambler Blog\")\n\n## \u6982\u8981\n\n1. \u89aa\u3067 static childContextTypes = {...} \u3068 getChildContext() \u3092\u5b9f\u88c5\u3059\u308b\n2. \u5b50\u3067 static contextTypes = {...} \u3092\u5b9f\u88c5\u3059\u308b\n3. \u5b50\u3067 this.context \u306f getChildContext \u306e\u7d50\u679c\u3092\u53c2\u7167\u3067\u304d\u308b\n\n## \u6700\u5c0f\u30b3\u30fc\u30c9\u4f8b\n\n```js\nimport React from 'react';\nimport Dom from 'react-dom/server';\n\nclass Child extends React.Component {\n  static get contextTypes() {\n    return {a: React.PropTypes.any};\n  }\n\n  render() {\n    return <span>{this.context.a}</span>;\n  }\n}\n\nclass Parent extends React.Component {\n  static get childContextTypes() {\n    return {a: React.PropTypes.any};\n  }\n\n  getChildContext() {\n    return {a: 1};\n  }\n\n  render() {\n    return <Child/>;\n  }\n}\n\nconst ret = Dom.renderToString(<Parent/>);\nconsole.log(ret); // <span data-reactid=\".1rrwza5woao\" data-react-checksum=\"1038880381\">1</span>\n```\n\na = 1 \u3068\u3057\u3066\u3061\u3083\u3093\u3068\u63cf\u753b\u3055\u308c\u3066\u3044\u308b\u3002\n\n\u6ce8\u610f\u70b9\u3068\u3057\u3066\u3001\u5b50\u3068\u89aa\u306e contextTypes \u306f\u76f4\u611f\u306b\u53cd\u3057\u3066\u300c\u578b\u3092\u660e\u8a18\u3059\u308b\u306e\u306b\u3042\u308b\u3068\u4fbf\u5229\u300d\u3067\u306f\u306a\u304f\u300c\u5fc5\u9808\u300d\u3067\u3042\u308b\u3002\u3053\u3053\u304cpropTypes\u3068\u5927\u304d\u304f\u7570\u306a\u308b\u3002\n\n## Flux \u3092\u5b9f\u88c5\u3059\u308b\n\n\u3042\u308b\u89aa\u4ee5\u4e0b\u306e\u8981\u7d20\u306e\u4ee5\u4e0b\u3067\u306f\u540c\u4e00\u306eEventEmitter \u3078\u306e\u53c2\u7167\u3092\u6301\u3061\u305f\u3044\n\nArda\u3067\u3084\u3063\u3066\u308b dispatch mixin \u3068\u540c\u7b49\u306e\u5b9f\u88c5\n\n```js\n// context\nimport React from 'react';\nimport Dom from 'react-dom';\nimport {EventEmitter} from 'events';\n\nconst SharedTypes = {emitter: React.PropTypes.any};\n\nclass Provider extends React.Component {\n  static get childContextTypes() {\n    return SharedTypes;\n  }\n\n  getChildContext() {\n    return {emitter: this.props.emitter};\u3000\n  }\u3000\n}\n\nclass DispatchableComponent extends React.Component {\n  static get contextTypes() {\n    return SharedTypes;\n  }\n  dispatch(...args) {\n    return this.context.emitter.emit(...args);\n  }\n}\n\n// Usage\nclass App extends Provider {\n  render() {\n    return (<Content {...this.props.childState} />);\n  }\n}\n\nclass Content extends DispatchableComponent {\n  render() {\n    return (\n      <span\n        onClick={() => this.dispatch('foo')}\n      >\n      {this.props.count}\n      </span>\n    );\n  }\n}\n\nconst emitter = new EventEmitter();\nfunction render(state) {\n  Dom.render(<App emitter={emitter} childState={state}/>, document.body);\n}\n\n// flux loop \u306e Dispatcher \u76f8\u5f53\nconst state = {count: 1};\nemitter.on('foo', () => {\n  // \u4f55\u304b\u64cd\u4f5c\u3059\u308b\n  state.count += 1;\n  // \u518d\u63cf\u753b\n  render(state);\n});\nrender(state);\n```\n\nEmitter\u3068dispatch\u306e\u95a2\u4fc2\u3001dispatch\u306e\u5b9f\u88c5\u306e\u4e2d\u8eab\u3001React\u3068Emitter\u306e\u95a2\u4fc2\u3092\u96a0\u853d\u3067\u304d\u305f\u3002\u5f8c\u306f state \u3068 emitter \u306e\u30ed\u30b8\u30c3\u30af\u3092\u7d44\u307f\u7acb\u3066\u308b\u5b9f\u88c5\u3001state\u3068ReactElement\u306e\u95a2\u4fc2\u3092\u5225\u306b\u8a18\u8ff0\u3057\u3066\u958b\u767a\u3059\u308c\u3070\u826f\u3044\u3002\n"}