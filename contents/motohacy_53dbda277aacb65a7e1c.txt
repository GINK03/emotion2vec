{"context": " More than 1 year has passed since last update.\n\n\u76ee\u7684\n\u8907\u6570\u306eRole\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u5404API\u3054\u3068\u306b\u4f7f\u7528\u3057\u3066\u3044\u3044Role\u306e\u5236\u5fa1\u3092\u3057\u305f\u3044\u3002\n\n\u5404API\u306e\u4f7f\u7528\u6761\u4ef6\u306f\u8907\u6570\u306eRole\u306e\u7d44\u307f\u5408\u308f\u305b\n\u30a2\u30af\u30b7\u30e7\u30f3\u30af\u30e9\u30b9\u306f1\u3064\u306b\u307e\u3068\u3081\u305f\u3044\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u5f15\u6570\u4ed8\u304d\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\n\u3068\u308a\u3042\u3048\u305aRole\u3092\u9069\u5f53\u306b\u5b9a\u7fa9\n\u30e6\u30fc\u30b6\u3001\u7ba1\u7406\u8005\u3001\u30b7\u30b9\u30c6\u30e0\u3001\u306a\u3057\u306e4\u3064\u306eRole\u304c\u3042\u308b\u3068\u3059\u308b\u3002\n\nRoles.java\npublic enum Roles {\n\n    USER((short)0),            // \u30e6\u30fc\u30b6\n    ADMINISRATOR((short)1),    // \u7ba1\u7406\u8005\n    SYSTEM((short)2),          // \u30b7\u30b9\u30c6\u30e0\n    NONE((short)99);           // \u306a\u3057\n\n    private short id;\n\n    Roles(short id) {\n        this.id = id;\n    }\n\n    public Short getId() { return id; }\n}\n\n\n\n\u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\u5f15\u6570\u3067\u53d7\u3051\u53d6\u3063\u305fRole\u3092\u30e6\u30fc\u30b6\u304c\u6301\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u6301\u3063\u3066\u3044\u306a\u3051\u308c\u3070403\u3092\u8fd4\u3057\u3001\n\u6301\u3063\u3066\u3044\u305f\u3089\u5143\u306eAction\u3078\u8fd4\u3059\u51e6\u7406\u3092\u9069\u5f53\u306b\u66f8\u304f\u3002\n\nAuthRoleAction.java\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\nimport play.libs.F.Promise;\nimport play.mvc.Action;\nimport play.mvc.With;\nimport play.mvc.Http.Context;\nimport play.mvc.Result;\n\n@With(AuthRoleAction.class)\n@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(RetentionPolicy.RUNTIME)\n@interface AuthRole {\n   Roles[] value() default Roles.NONE;\n}\n\npublic class AuthRoleAction extends Action<AuthRole> {\n\n    @Override\n    public Promise<Result> call(Context ctx) throws Throwable {\n\n        // \u5f15\u6570\u3067\u8a31\u53ef\u3055\u308c\u308bRole\u3092\u53d7\u3051\u53d6\u308b\n        Roles[] roles = configuration.value();\n\n        // \u30b5\u30a4\u30f3\u30a4\u30f3\u30e6\u30fc\u30b6\u306eRole\u60c5\u5831\u3068\u5f15\u6570\u3067\u6e21\u3055\u308c\u305fRole\u306e\u30c1\u30a7\u30c3\u30af\n\u3000\u3000\u3000\u3000 Boolean authResult = isAuthorizedRole(roles);\n\n        if(authResult)\n        {\n            // \u6a29\u9650OK\n            return delegate.call(ctx);\n        }\n        else\n        {\n            // \u6a29\u9650NG\n            return F.Promise.pure((Result) unauthorized());\n        }\n    }\n}\n\n\n\nAction\u306b\u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\nController\u306e\u5404\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u3001\u8a31\u53ef\u3059\u308bRole\u3092\u5f15\u6570\u306b\u3057\u3066@AuthRole\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308b\u3002\n\nController.java\npublic class TestAuthController extends Controller{\n\n    // \u4f7f\u7528\u3057\u3066\u3044\u3044Role\u3092\u6e21\u3059\n    @AuthRole({Roles.USER, Roles.ADMINISRATOR})\n    public static Result test() {\n\n        return ok();\n    }\n}\n\n\n\n# \u76ee\u7684\n\u8907\u6570\u306eRole\u304c\u5b9a\u7fa9\u3055\u308c\u3066\u3044\u308b\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u5404API\u3054\u3068\u306b\u4f7f\u7528\u3057\u3066\u3044\u3044Role\u306e\u5236\u5fa1\u3092\u3057\u305f\u3044\u3002\n\n* \u5404API\u306e\u4f7f\u7528\u6761\u4ef6\u306f\u8907\u6570\u306eRole\u306e\u7d44\u307f\u5408\u308f\u305b\n* \u30a2\u30af\u30b7\u30e7\u30f3\u30af\u30e9\u30b9\u306f1\u3064\u306b\u307e\u3068\u3081\u305f\u3044\n\n\u3068\u3044\u3046\u308f\u3051\u3067\u5f15\u6570\u4ed8\u304d\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3067\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\n## \u3068\u308a\u3042\u3048\u305aRole\u3092\u9069\u5f53\u306b\u5b9a\u7fa9\n\u30e6\u30fc\u30b6\u3001\u7ba1\u7406\u8005\u3001\u30b7\u30b9\u30c6\u30e0\u3001\u306a\u3057\u306e4\u3064\u306eRole\u304c\u3042\u308b\u3068\u3059\u308b\u3002\n\n```java:Roles.java\npublic enum Roles {\n\n    USER((short)0),            // \u30e6\u30fc\u30b6\n    ADMINISRATOR((short)1),    // \u7ba1\u7406\u8005\n    SYSTEM((short)2),          // \u30b7\u30b9\u30c6\u30e0\n    NONE((short)99);           // \u306a\u3057\n\n    private short id;\n\n    Roles(short id) {\n    \tthis.id = id;\n    }\n\n    public Short getId() { return id; }\n}\n```\n\n## \u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3059\u308b\n\u5f15\u6570\u3067\u53d7\u3051\u53d6\u3063\u305fRole\u3092\u30e6\u30fc\u30b6\u304c\u6301\u3063\u3066\u3044\u308b\u304b\u30c1\u30a7\u30c3\u30af\u3057\u3001\u6301\u3063\u3066\u3044\u306a\u3051\u308c\u3070403\u3092\u8fd4\u3057\u3001\n\u6301\u3063\u3066\u3044\u305f\u3089\u5143\u306eAction\u3078\u8fd4\u3059\u51e6\u7406\u3092\u9069\u5f53\u306b\u66f8\u304f\u3002\n\n```java:AuthRoleAction.java\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\nimport play.libs.F.Promise;\nimport play.mvc.Action;\nimport play.mvc.With;\nimport play.mvc.Http.Context;\nimport play.mvc.Result;\n\n@With(AuthRoleAction.class)\n@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(RetentionPolicy.RUNTIME)\n@interface AuthRole {\n   Roles[] value() default Roles.NONE;\n}\n\npublic class AuthRoleAction extends Action<AuthRole> {\n\n    @Override\n    public Promise<Result> call(Context ctx) throws Throwable {\n\n        // \u5f15\u6570\u3067\u8a31\u53ef\u3055\u308c\u308bRole\u3092\u53d7\u3051\u53d6\u308b\n        Roles[] roles = configuration.value();\n        \n        // \u30b5\u30a4\u30f3\u30a4\u30f3\u30e6\u30fc\u30b6\u306eRole\u60c5\u5831\u3068\u5f15\u6570\u3067\u6e21\u3055\u308c\u305fRole\u306e\u30c1\u30a7\u30c3\u30af\n\u3000\u3000\u3000\u3000 Boolean authResult = isAuthorizedRole(roles);\n\n        if(authResult)\n        {\n            // \u6a29\u9650OK\n            return delegate.call(ctx);\n        }\n        else\n        {\n            // \u6a29\u9650NG\n            return F.Promise.pure((Result) unauthorized());\n        }\n    }\n}\n```\n\n## Action\u306b\u30a2\u30af\u30b7\u30e7\u30f3\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u3051\u308b\nController\u306e\u5404\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u3001\u8a31\u53ef\u3059\u308bRole\u3092\u5f15\u6570\u306b\u3057\u3066@AuthRole\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u4ed8\u52a0\u3059\u308b\u3002\n\n```java:Controller.java\npublic class TestAuthController extends Controller{\n\n    // \u4f7f\u7528\u3057\u3066\u3044\u3044Role\u3092\u6e21\u3059\n    @AuthRole({Roles.USER, Roles.ADMINISRATOR})\n    public static Result test() {\n\n        return ok();\n    }\n}\n\n```\n", "tags": ["Java", "PlayFramework"]}