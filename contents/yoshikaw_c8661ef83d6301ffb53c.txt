{"context": "\n\n\u306f\u3058\u3081\u306b\n\u3044\u308d\u3044\u308d\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306e\u53ef\u80fd\u6027\u3092\u63a2\u3063\u3066\u3044\u308b\u3068\u3001\u3068\u3066\u3082\u8208\u5473\u3092\u60f9\u304b\u308c\u308b\u8a18\u4e8b\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\nVim\u3067\u306e\u4f5c\u696d\u3092Kibana\u3067\u53ef\u8996\u5316\u3057\u3066\u307f\u305f\n\nVim\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092Elasticsearch\u306b\u6295\u5165\u3059\u308b\u70ba\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u6210\u3055\u308c\u3066\u3044\u3066\u7d20\u76f4\u306b\u3059\u3054\u3044\u306a\u3041\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n\u30d6\u30e9\u30a6\u30b6\u306e\u95b2\u89a7\u5c65\u6b74\u3067\u4eba\u751f\u306e\u68da\u5378\u3057\uff08embulk + elasticsearch + kibana\u3067\u53ef\u8996\u5316\uff09\n\n\u305d\u3053\u306b\u62bd\u51fa\u3067\u304d\u308b\u5c65\u6b74\u30c7\u30fc\u30bf\u304c\u3042\u308c\u3070\u632f\u308a\u8fd4\u308a\u305f\u304f\u306a\u308a\u307e\u3059\u3088\u306d\u3002\n\u6628\u5e7411\u6708\u304f\u3089\u3044\u304b\u3089\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306e\u305f\u3081\u306bEmbulk\u3001Elasticsearch\u3001Kibana\u3092\u5c11\u3057\u89e6\u3063\u3066\u304d\u3066\u3001\u3042\u308b\u7a0b\u5ea6\u4f7f\u3044\u65b9\u304c\u5206\u304b\u3063\u3066\u304d\u307e\u3057\u305f\u306e\u3067\u3001\u304a\u3055\u3089\u3044\u3092\u517c\u306d\u3066\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u53ef\u8996\u5316\u3092\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5fc5\u8981\u306a\u3082\u306e\uff08\u74b0\u5883\uff09\n\n\u305d\u3053\u305d\u3053\u6e9c\u307e\u3063\u3066\u3044\u308b \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u4ed8\u304d \u306e\u30b7\u30a7\u30eb\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\nEmbulk 0.8.8\nDocker\n\n\nElasticsearch 2.2.1\nKibana 4.4.2\n\n\n\n\u8a66\u3057\u305f\u74b0\u5883\u306f Debian GNU/Linux 8.2 (jessie) \u3067\u3059\u3002Docker\u306fElastic\u74b0\u5883\u69cb\u7bc9\u306e\u624b\u9593\u3092\u7701\u304f\u305f\u3081\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n\u53ef\u8996\u5316\u7d50\u679c\n\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306a\u306e\u3067\u5b9f\u884c\u983b\u5ea6\u306e\u9ad8\u3044\u30b3\u30de\u30f3\u30c9\u7a0b\u5ea6\u3057\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3053\u3068\u3067\u30db\u30b9\u30c8\u6bce\u3084\u6642\u9593\u5e2f\u3067\u306e\u9055\u3044\u304c\u898b\u3048\u3066\u9762\u767d\u3044\u3082\u306e\u3067\u3059\u3002\n\n\n\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u8a2d\u5b9a\n\nzsh\n\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u91cd\u8981\u306a\u306e\u3067 extended_history \u5fc5\u9808\u3067\u3059\u3002\n\u3053\u308c\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306f\u6b21\u306e\u3088\u3046\u306b\u8a18\u9332\u3055\u308c\u307e\u3059\u3002\n: 1421072025:0;ls -l\n\n: \u6642\u523b:\u7d4c\u904e\u79d2;\u30b3\u30de\u30f3\u30c9\n\n\u3061\u306a\u307f\u306b\u79c1\u304c\u4f7f\u7528\u3057\u3066\u3044\u308bzsh\u306e\u30d2\u30b9\u30c8\u30ea\u95a2\u9023\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\u30d2\u30b9\u30c8\u30ea\u884c\u6570\u591a\u3081\u306e\u8a2d\u5b9a\u3002\u8a73\u3057\u304f\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u3002\n\nzsh: 16 Options - ZSH Documentation\n\nHISTSIZE=1000000\nSAVEHIST=$HISTSIZE\n\nsetopt extended_history\nsetopt hist_expire_dups_first\nsetopt hist_ignore_dups\nsetopt hist_ignore_space\nsetopt inc_append_history\nsetopt share_history\n\nalias history='history -t \"%Y-%m-%d %a %H:%M:%S\"'\nfunction history-all { history 1 }\n\n\nbash\nHISTTIMEFORMAT \u3092\u6307\u5b9a\u3059\u308b\u3068\u7d4c\u904e\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n.bash_history\n#1446886196\nls -l\n\n\n\n.bashrc\nHISTTIMEFORMAT='%Y-%m-%dT%T%z '\n\n\n\nBash Reference Manual: Bash Variables\n\n\nElasticsearch\nJava\u306e\u74b0\u5883\u308f\u304b\u3089\u306a\u3044\u306e\u3067docker\u3092\u4f7f\u3063\u3066\u697d\u3057\u307e\u3059\u3002\nsudo docker run -p 9200:9200 -p 9300:9300 --name es -d elasticsearch\n\n\nElasticsearch\u30d7\u30e9\u30b0\u30a4\u30f3\n\nelasticsearch-kopf\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306f\u30d6\u30e9\u30a6\u30b6\u3067\u697d\u3092\u3057\u305f\u3044\u306e\u3067kopf\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\nlmenezes/elasticsearch-kopf\nelasticsearch-kopf\u306e\u7d39\u4ecb\uff08\u6982\u8981\uff09 - @johtani\u306e\u65e5\u8a18 2nd\n\nsudo docker exec es /bin/bash -c '/usr/share/elasticsearch/bin/plugin install lmenezes/elasticsearch-kopf'\n\n\nelasticsearch-head\n\u597d\u307f\u3067\u3059\u304chead\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3082\u3088\u3044\u304b\u3082\u3067\u3059\u3002\n\nElasticSearch Head\n\nsudo docker exec es /bin/bash -c '/usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head'\n\n\nKibana\nNode\u306e\u74b0\u5883\u308f\u304b\u3089\u306a\u3044\u306e\u3067docker\u3092\u4f7f\u3063\u3066\u697d\u3057\u307e\u3059\u3002\nsudo docker run -p 5601:5601 --link es:elasticsearch --name kibana -d kibana\n\nElasticsaerch\u30af\u30e9\u30b9\u30bf\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30b0\u30ea\u30fc\u30f3\u306b\u3059\u308b\u305f\u3081\u3060\u3051\u306b\u3001Kibana\u304c\u4f7f\u7528\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9(.kibana)\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u30920\u306b\u3057\u307e\u3059\u3002\ncurl -XPUT 'localhost:9200/.kibana/_settings' -d '\n{\n    \"index\" : {\n        \"number_of_replicas\" : 0\n    }\n}'\n\n\nKibana\u30d7\u30e9\u30b0\u30a4\u30f3\n\ntagcloud\n\nstormpython/tagcloud: Tag Cloud Plugin for Kibana 4\n\ndocker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin -i tagcloud -u https://github.com/stormpython/tagcloud/archive/master.zip'\n\n\nheatmap\n\nstormpython/heatmap: Heatmap Plugin for Kibana 4\n\nKibana 4.3\u4ee5\u4e0a\u5411\u3051\u306e\u30a2\u30eb\u30d5\u30a1\u7248\u3067\u3059\u304c\u3001\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f\u52d5\u4f5c\u3057\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\nsudo docker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin -i heatmap -u https://github.com/stormpython/heatmap/archive/master.zip'\n\n\nsense\n\u767b\u9332\u3057\u305f\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u306a\u3069\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u697d\u3092\u3057\u305f\u3044\u306e\u3067sense\u3092\u5165\u308c\u307e\u3059\u3002\n\nElasticsearch 2.0.0\u30ea\u30ea\u30fc\u30b9(\u65e5\u672c\u8a9e\u8a33) - @johtani\u306e\u65e5\u8a18 2nd\nThe Sense UI\n\ndocker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin --install elastic/sense'\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\u305f\u3081\u306bKibana\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\nsudo docker retsart kibana\n\n\nEmbulk\nElasticsearch\u3078\u306e\u30c7\u30fc\u30bf\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066Embulk\u3092\u4f7f\u3044\u307e\u3059\u3002\n\nhttp://www.embulk.org/\n\n\u5b9f\u884c\u306b\u306fJava\u306e\u30e9\u30f3\u30bf\u30a4\u30e0\u304c\u5fc5\u8981\u306a\u306e\u3067\u4eca\u56de\u306fOpenJDK\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\nsudo apt-get install openjdk-7-jdk\n\nembulk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u57fa\u672c\u7684\u306b\u516c\u5f0f\u306b\u3042\u308b\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002\n\nQuick Start - Linux & Mac & BSD\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148\u304cSSL\u306eCDN\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\u306e\u3067curl\u30aa\u30d7\u30b7\u30e7\u30f3\u306b--insecure (-k)\u3092\u4ed8\u3051\u3066\u304a\u304d\u307e\u3059\u3002\ncurl -k --create-dirs -o ~/.embulk/bin/embulk -L 'http://dl.embulk.org/embulk-latest.jar'\nchmod +x ~/.embulk/bin/embulk\n\nembulk\u306e\u30d1\u30b9\u3092\u6c38\u7d9a\u5316\u3059\u308b\u5834\u5408\u306f\u624b\u9806\u901a\u308a\u306b\u3057\u307e\u3059\u304c\u3001\necho 'export PATH=\"$HOME/.embulk/bin:$PATH\"' >> ~/.bashrc\nsource ~/.bashrc\n\n\u4eca\u56de\u306f\u4e00\u6642\u7684\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\nexport PATH=$HOME/.embulk/bin:$PATH\n\n\nEmbulk\u30d7\u30e9\u30b0\u30a4\u30f3\n\nembulk-filter_add_time\n\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u578b\u5909\u63db\u306a\u3069\u3092\u884c\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\ntreasure-data/embulk-filter-add_time\n\nembulk gem install embulk-filter-add_time\n\ntimestamp\u578b\u3092long\u578b\u306b\u8907\u88fd\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nembulk-filter-column\n\u30ab\u30e9\u30e0\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\nsonots/embulk-filter-column\n\nembulk gem install embulk-filter-column\n\n\u5f8c\u7d9a\u306e\u30d5\u30a3\u30eb\u30bf\u7528\u306b\u8907\u6570\u306e\u30ab\u30e9\u30e0\u306b\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\nembulk-filter-eval\nRuby\u306e\u8a55\u4fa1\u5f0f\u3067\u5024\u3092\u66f8\u304d\u63db\u3048\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\nembulk-filter-eval \u3068\u3044\u3046\u30d5\u30a3\u30eb\u30bf\u30fc\u30d7\u30e9\u30b0\u30a4\u30f3\u66f8\u3044\u305f - scramble cadenza\nmgi166/embulk-filter-eval\nA-AUTO 50 \u958b\u767a\u8005\u30d6\u30ed\u30b0: embulk-filter-eval\u3067\u3069\u3093\u306a\u30c7\u30fc\u30bf\u5909\u63db\u304c\u3067\u304d\u308b\u306e\u304b\u8a66\u3057\u3066\u307f\u308b\n\n\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304b\u3089\u66dc\u65e5\u3001\u6642\u9593\u306b\u5909\u63db\u3057\u305f\u308a\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30b3\u30de\u30f3\u30c9\u3068\u5f15\u6570\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nembulk gem install embulk-filter-eval\n\n\nembulk-filter-insert\n\u4efb\u610f\u306e\u30ab\u30e9\u30e0\u3068\u3057\u3066\u6307\u5b9a\u3057\u305f\u5024\u3092\u8ffd\u52a0\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\nmuziyoshiz/embulk-filter-insert\n\n\u30db\u30b9\u30c8\u540d\u3092liquid\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5909\u6570\u3068\u3057\u3066\u3001\u3069\u306e\u30db\u30b9\u30c8\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b\u304b\u3092\u8a8d\u8b58\u3055\u305b\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nembulk gem install embulk-filter-insert\n\n\nembulk-filter-row\n\u6307\u5b9a\u3057\u305f\u6761\u4ef6\u3067\u30c7\u30fc\u30bf\u3092\u30d5\u30a3\u30eb\u30bf\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\nsonots/embulk-filter-row\n\n\u7570\u5e38\u5024\u3092\u5f3e\u304f\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\uff08grep -v\u4ee3\u308f\u308a\uff09\nembulk gem install embulk-filter-row\n\n\nembulk-filter-split\n\u6307\u5b9a\u3057\u305f\u6761\u4ef6\u3067\u30c7\u30fc\u30bf\u3092\u8907\u6570\u8981\u7d20\u306b\u5206\u5272\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\ntoyama0919/embulk-filter-split\n\n\u30bb\u30df\u30b3\u30ed\u30f31\u884c\u306b\u307e\u3068\u3081\u3066\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3084\u30d1\u30a4\u30d7\u3067\u7e4b\u3044\u3067\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\nembulk gem install embulk-filter-split\n\n\nembulk-output-elasticsearch\nElasticserach\u3078\u306e\u51fa\u529b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\nmuga/embulk-output-elasticsearch\n\nembulk gem install embulk-output-elasticsearch\n\n\n\u30c7\u30fc\u30bf\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u767b\u9332\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u5b9a\u7fa9\u3092\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\nIndex Templates\n\n\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\nKibana\u3067\u306e\u8a2d\u5b9a\u3092\u624b\u8efd\u306b\u3059\u308b\u305f\u3081\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u306flogstash-command_history\n\n\u304a\u8a66\u3057\u74b0\u5883\u306a\u306e\u3067\u30ec\u30d7\u30ea\u30ab\u6570\u306f0\n\u5168\u6587\u691c\u7d22\u306f\u4e0d\u8981\u306a\u306e\u3067_all\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u4f7f\u7528\u3057\u306a\u3044\n\u30d5\u30a3\u30fc\u30eb\u30c9\u5b9a\u7fa9\n\n\n\n@timestamp \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u3002Kibana\u3067\u8b58\u5225\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3053\u306e\u540d\u524d\u3092\u4f7f\u3044\u307e\u3059\n\n@wday \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u306e\u66dc\u65e5(1:\u6708\u66dc\u301c7:\u65e5\u66dc)\n\n@hour \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u306e\u6642\u9593\n\n@host \u30b7\u30a7\u30eb\u5b9f\u884c\u30db\u30b9\u30c8\u540d\n\n@shell \u30b7\u30a7\u30eb\u7a2e\u5225\n\n@command \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\uff08Analyze\u3057\u306a\u3044\u3082\u306e\u3092@command.raw\uff09\n\ncommand \u30b3\u30de\u30f3\u30c9\u540d\n\nargs \u30b3\u30de\u30f3\u30c9\u5f15\u6570\n\n\n\ncurl -XPUT localhost:9200/_template/command_history_template -d'\n{\n  \"template\": \"logstash-*\",\n  \"settings\": { \"number_of_replicas\" : 0 },\n  \"mappings\": {\n    \"command_history\": {\n      \"_all\": { \"enabled\": false },\n      \"properties\": {\n        \"@timestamp\": {\n          \"type\": \"date\"\n        },\n        \"@wday\": {\n          \"type\": \"byte\"\n        },\n        \"@hour\": {\n          \"type\": \"byte\"\n        },\n        \"@host\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"@shell\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"@command\": {\n          \"type\": \"string\",\n          \"fields\": {\n            \"raw\": {\n              \"index\": \"not_analyzed\",\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"command\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"args\": {\n          \"type\": \"string\"\n          }\n        }\n      }\n    }\n  }\n}'\n\n\nEmbulk\u306e\u8a2d\u5b9a\nEmbulk\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3079\u3066\u671b\u307f\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u306f\u96e3\u3057\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u30b7\u30a7\u30eb\u3067\u52a0\u5de5\u3057\u305f\u3082\u306e\u3092\u6a19\u6e96\u5165\u529b\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u305b\u308b\u65b9\u91dd\u3067\u3059\u3002\n\n\u5165\u529b\u306fTSV\u3092\u6a19\u6e96\u5165\u529b\u304b\u3089\n\u5f15\u6570\u3067\u30db\u30b9\u30c8\u540d\u3068\u30b7\u30a7\u30eb\u3092\u4e0e\u3048\u308b\n\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4fdd\u6301\u3055\u308c\u3066\u3044\u306a\u3044\u30d2\u30b9\u30c8\u30ea\u3092\u9664\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002(1327083640 2012-01-21 03:20:40)\n\n\ncommand_history.yml.liquid\nin:\n  type: file\n  path_prefix: /dev/stdin\n  parser:\n    type: csv\n    delimiter: \"\\t\"\n    columns:\n    - {name: '@timestamp', type: timestamp, format: '%s'}\n    - {name: '@command', type: string}\n\nfilters:\n  - type: row\n    conditions:\n      - {column: '@timestamp', operator: \">\", argument: \"1327083640\", format: '%s' }\n\n  - type: insert\n    columns:\n      - '@host': {{ env.host }}\n      - '@shell': {{ env.shell }}\n    at: 1\n\n  - type: split\n    delimiter: '|'\n    keep_input: true\n    target_key: '@command'\n\n  - type: add_time\n    to_column:\n      name: '@wday'\n      type: long\n    from_column:\n      name: '@timestamp'\n\n  - type: column\n    add_columns:\n      - {name: '@hour', src: '@wday' }\n      - {name: command, src: '@command' }\n      - {name: args, src: '@command' }\n\n  - type: eval\n    eval_columns:\n      - '@wday': Time.at(value).strftime('%u')\n      - '@hour': Time.at(value).strftime('%H')\n      - command: value.sub(/^\\s*(?:(?:env )?[^=]+=\\S+ )*(\\S+).*$/, '\\1')\n      - args: if value.match(/^\\s*\\S+ (.*?)\\s*$/) then\n                value=$1\n              else\n                value=nil\n              end\n\nout:\n  type: elasticsearch\n  cluster_name: elasticsearch\n  nodes:\n    - {host: localhost, port: 9300}\n  index: logstash-command_history\n  index_type: command_history\n\n\n\n\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb(bash)\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\nawk\u3067\u6642\u523b\u6587\u5b57\u5217\u3068\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30921\u884c\u306b\u3057\u3066\u30bf\u30d6\u533a\u5207\u308a\u306b\u3057\u307e\u3059\n\nfile \u306b\u4efb\u610f\u306e.bash_history\u306e\u30d1\u30b9\n\nhost \u306b\u4efb\u610f\u306e\u30db\u30b9\u30c8\u540d\n\nfile=/path/to/bash_history\nhost=somehost\n\ncat $file | awk '{getline ts; print substr(ts,2)\"\\t\"$0}' |\n  host=$host shell=bash embulk run ./command_history.yml.liquid\n\n\n\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb(zsh)\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\nsed\u3067\u30bf\u30d6\u533a\u5207\u308a\u306b\u3057\u307e\u3059\uff08\u8907\u6570\u884c\u306b\u306f\u5bfe\u5fdc\u3057\u307e\u305b\u3093\uff09\n\nfile \u306b\u4efb\u610f\u306e.zsh_history\u306e\u30d1\u30b9\n\nhost \u306b\u4efb\u610f\u306e\u30db\u30b9\u30c8\u540d\n\nfile=/path/to/bash_history\nhost=somehost\n\ncat $file | cut -b 3- | sed -e 's/:0;/\\t/' |\n  host=$host shell=zsh embulk run ./command_history.yml.liquid\n\n\n\u304a\u308f\u308a\u306b\n\u3053\u306e\u8a18\u4e8b\u306f\u6628\u5e74\u672b\u306b\u66f8\u304d\u59cb\u3081\u305f\u306e\u3067\u3059\u304c\u3001\u3044\u308d\u3044\u308d\u3042\u3063\u3066\u516c\u958b\u304c\u9045\u308c\u3066\u3044\u308b\u3046\u3061\u306b embulk-output-plugin\u304cElasticsearch 2\u7cfb\u306b\u6b63\u5f0f\u5bfe\u5fdc\u3057\u305f\u308a\u3001embulk-filter_add_time\u304c\u4f5c\u6210\u3055\u308c\u305f\u308a\u3001Elasticsearch\u3078\u306e\u767b\u9332\u304c\u697d\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\u307e\u305f\u3001Kibana\u306eheatmap\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30a2\u30eb\u30d5\u30a1\u7248\u3068\u306f\u3044\u3048\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u66dc\u65e5\u3084\u6642\u9593\u5e2f\u306e\u68d2\u30b0\u30e9\u30d5\u3092\u4e26\u3079\u306a\u304f\u3066\u6e08\u3080\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u3002\n\u305d\u3057\u3066\u5bb6\u3067\u4f7f\u3063\u3066\u3044\u308b\u30db\u30b9\u30c8\u306b\u7d5e\u308b\u3068\u3001\u571f\u65e5\u306e\u4e0d\u898f\u5247\u306a\u6d3b\u52d5\u6642\u9593\u3082\u660e\u3089\u304b\u3067\u3059\u306d\u3002\u3002\u3002\n\n\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u3068\u306f\u8a00\u308f\u305a\u3001\u307f\u306a\u3055\u3093\u3082\u624b\u5143\u306b\u3042\u308b\u5c65\u6b74\u30c7\u30fc\u30bf\u3092Elastic\u74b0\u5883\u3067\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\u3068\u65b0\u305f\u306a\u767a\u898b\u304c\u3042\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n# \u306f\u3058\u3081\u306b\n\u3044\u308d\u3044\u308d\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306e\u53ef\u80fd\u6027\u3092\u63a2\u3063\u3066\u3044\u308b\u3068\u3001\u3068\u3066\u3082\u8208\u5473\u3092\u60f9\u304b\u308c\u308b\u8a18\u4e8b\u3092\u898b\u3064\u3051\u307e\u3057\u305f\u3002\n\n * [Vim\u3067\u306e\u4f5c\u696d\u3092Kibana\u3067\u53ef\u8996\u5316\u3057\u3066\u307f\u305f](http://qiita.com/uochan/items/6232d7203cef1ac167ab)\n\nVim\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u3092Elasticsearch\u306b\u6295\u5165\u3059\u308b\u70ba\u306b\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u4f5c\u6210\u3055\u308c\u3066\u3044\u3066\u7d20\u76f4\u306b\u3059\u3054\u3044\u306a\u3041\u3068\u601d\u3044\u307e\u3057\u305f\u3002\n\n * [\u30d6\u30e9\u30a6\u30b6\u306e\u95b2\u89a7\u5c65\u6b74\u3067\u4eba\u751f\u306e\u68da\u5378\u3057\uff08embulk + elasticsearch + kibana\u3067\u53ef\u8996\u5316\uff09](http://qiita.com/maeharin/items/a2fb6242d26555c85dec)\n\n\u305d\u3053\u306b\u62bd\u51fa\u3067\u304d\u308b\u5c65\u6b74\u30c7\u30fc\u30bf\u304c\u3042\u308c\u3070\u632f\u308a\u8fd4\u308a\u305f\u304f\u306a\u308a\u307e\u3059\u3088\u306d\u3002\n\n\u6628\u5e7411\u6708\u304f\u3089\u3044\u304b\u3089\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306e\u305f\u3081\u306bEmbulk\u3001Elasticsearch\u3001Kibana\u3092\u5c11\u3057\u89e6\u3063\u3066\u304d\u3066\u3001\u3042\u308b\u7a0b\u5ea6\u4f7f\u3044\u65b9\u304c\u5206\u304b\u3063\u3066\u304d\u307e\u3057\u305f\u306e\u3067\u3001\u304a\u3055\u3089\u3044\u3092\u517c\u306d\u3066\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306e\u53ef\u8996\u5316\u3092\u3057\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u5fc5\u8981\u306a\u3082\u306e\uff08\u74b0\u5883\uff09\n\n1. \u305d\u3053\u305d\u3053\u6e9c\u307e\u3063\u3066\u3044\u308b **\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u4ed8\u304d** \u306e\u30b7\u30a7\u30eb\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\n1. Embulk 0.8.8\n1. Docker\n  1. Elasticsearch 2.2.1\n  1. Kibana 4.4.2\n\n\u8a66\u3057\u305f\u74b0\u5883\u306f `Debian GNU/Linux 8.2 (jessie)` \u3067\u3059\u3002Docker\u306fElastic\u74b0\u5883\u69cb\u7bc9\u306e\u624b\u9593\u3092\u7701\u304f\u305f\u3081\u306b\u4f7f\u7528\u3057\u3066\u3044\u308b\u306e\u3067\u5fc5\u9808\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\n\n# \u53ef\u8996\u5316\u7d50\u679c\n\n\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306a\u306e\u3067\u5b9f\u884c\u983b\u5ea6\u306e\u9ad8\u3044\u30b3\u30de\u30f3\u30c9\u7a0b\u5ea6\u3057\u304b\u5206\u304b\u308a\u307e\u305b\u3093\u304c\u3001\u8907\u6570\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\u3053\u3068\u3067\u30db\u30b9\u30c8\u6bce\u3084\u6642\u9593\u5e2f\u3067\u306e\u9055\u3044\u304c\u898b\u3048\u3066\u9762\u767d\u3044\u3082\u306e\u3067\u3059\u3002\n\n![\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u306e\u53ef\u8996\u5316\u7d50\u679c](https://qiita-image-store.s3.amazonaws.com/0/6124/a1d36c77-22c3-3e41-6eb6-e749fd3b2799.png)\n\n# \u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u8a2d\u5b9a\n\n## zsh\n\n\u30c7\u30fc\u30bf\u53ef\u8996\u5316\u306b\u306f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u91cd\u8981\u306a\u306e\u3067 `extended_history` \u5fc5\u9808\u3067\u3059\u3002\n\n\u3053\u308c\u3092\u8a2d\u5b9a\u3059\u308b\u3068\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u306f\u6b21\u306e\u3088\u3046\u306b\u8a18\u9332\u3055\u308c\u307e\u3059\u3002\n\n```.zsh_history\n: 1421072025:0;ls -l\n\n: \u6642\u523b:\u7d4c\u904e\u79d2;\u30b3\u30de\u30f3\u30c9\n```\n\n\u3061\u306a\u307f\u306b\u79c1\u304c\u4f7f\u7528\u3057\u3066\u3044\u308bzsh\u306e\u30d2\u30b9\u30c8\u30ea\u95a2\u9023\u306e\u8a2d\u5b9a\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\u30d2\u30b9\u30c8\u30ea\u884c\u6570\u591a\u3081\u306e\u8a2d\u5b9a\u3002\u8a73\u3057\u304f\u306f\u30de\u30cb\u30e5\u30a2\u30eb\u3092\u3002\n\n * [zsh: 16 Options - ZSH Documentation](http://zsh.sourceforge.net/Doc/Release/Options.html#History)\n\n```.zshrc\nHISTSIZE=1000000\nSAVEHIST=$HISTSIZE\n\nsetopt extended_history\nsetopt hist_expire_dups_first\nsetopt hist_ignore_dups\nsetopt hist_ignore_space\nsetopt inc_append_history\nsetopt share_history\n\nalias history='history -t \"%Y-%m-%d %a %H:%M:%S\"'\nfunction history-all { history 1 }\n```\n\n## bash\n\n`HISTTIMEFORMAT` \u3092\u6307\u5b9a\u3059\u308b\u3068\u7d4c\u904e\u6642\u9593\u304c\u51fa\u529b\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```text:.bash_history\n#1446886196\nls -l\n```\n\n```bash:.bashrc\nHISTTIMEFORMAT='%Y-%m-%dT%T%z '\n```\n\n * [Bash Reference Manual: Bash Variables](https://www.gnu.org/software/bash/manual/html_node/Bash-Variables.html#Bash-Variables)\n\n# Elasticsearch\n\nJava\u306e\u74b0\u5883\u308f\u304b\u3089\u306a\u3044\u306e\u3067docker\u3092\u4f7f\u3063\u3066\u697d\u3057\u307e\u3059\u3002\n\n```bash\nsudo docker run -p 9200:9200 -p 9300:9300 --name es -d elasticsearch\n```\n\n## Elasticsearch\u30d7\u30e9\u30b0\u30a4\u30f3\n\n### elasticsearch-kopf\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u306f\u30d6\u30e9\u30a6\u30b6\u3067\u697d\u3092\u3057\u305f\u3044\u306e\u3067kopf\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n * [lmenezes/elasticsearch-kopf](https://github.com/lmenezes/elasticsearch-kopf)\n * [elasticsearch-kopf\u306e\u7d39\u4ecb\uff08\u6982\u8981\uff09 - @johtani\u306e\u65e5\u8a18 2nd](http://blog.johtani.info/blog/2014/04/05/intro-elasticsearch-kopf-1/)\n\n```bash\nsudo docker exec es /bin/bash -c '/usr/share/elasticsearch/bin/plugin install lmenezes/elasticsearch-kopf'\n```\n\n### elasticsearch-head\n\n\u597d\u307f\u3067\u3059\u304chead\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3082\u3088\u3044\u304b\u3082\u3067\u3059\u3002\n\n * [ElasticSearch Head](https://mobz.github.io/elasticsearch-head/)\n\n```bash\nsudo docker exec es /bin/bash -c '/usr/share/elasticsearch/bin/plugin install mobz/elasticsearch-head'\n```\n\n# Kibana\n\nNode\u306e\u74b0\u5883\u308f\u304b\u3089\u306a\u3044\u306e\u3067docker\u3092\u4f7f\u3063\u3066\u697d\u3057\u307e\u3059\u3002\n\n```bash\nsudo docker run -p 5601:5601 --link es:elasticsearch --name kibana -d kibana\n```\n\nElasticsaerch\u30af\u30e9\u30b9\u30bf\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u3092\u30b0\u30ea\u30fc\u30f3\u306b\u3059\u308b\u305f\u3081\u3060\u3051\u306b\u3001Kibana\u304c\u4f7f\u7528\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9(`.kibana`)\u306e\u30ec\u30d7\u30ea\u30ab\u6570\u30920\u306b\u3057\u307e\u3059\u3002\n\n```bash\ncurl -XPUT 'localhost:9200/.kibana/_settings' -d '\n{\n    \"index\" : {\n        \"number_of_replicas\" : 0\n    }\n}'\n```\n\n## Kibana\u30d7\u30e9\u30b0\u30a4\u30f3\n\n### tagcloud\n\n * [stormpython/tagcloud: Tag Cloud Plugin for Kibana 4](https://github.com/stormpython/tagcloud)\n\n```bash\ndocker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin -i tagcloud -u https://github.com/stormpython/tagcloud/archive/master.zip'\n```\n\n### heatmap\n\n * [stormpython/heatmap: Heatmap Plugin for Kibana 4](https://github.com/stormpython/heatmap)\n\nKibana 4.3\u4ee5\u4e0a\u5411\u3051\u306e\u30a2\u30eb\u30d5\u30a1\u7248\u3067\u3059\u304c\u3001\u8a66\u3057\u305f\u74b0\u5883\u3067\u306f\u52d5\u4f5c\u3057\u305f\u306e\u3067\u3053\u308c\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```bash\nsudo docker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin -i heatmap -u https://github.com/stormpython/heatmap/archive/master.zip'\n```\n\n### sense\n\n\u767b\u9332\u3057\u305f\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u306a\u3069\u306b\u30d6\u30e9\u30a6\u30b6\u3067\u697d\u3092\u3057\u305f\u3044\u306e\u3067sense\u3092\u5165\u308c\u307e\u3059\u3002\n\n * [Elasticsearch 2.0.0\u30ea\u30ea\u30fc\u30b9(\u65e5\u672c\u8a9e\u8a33) - @johtani\u306e\u65e5\u8a18 2nd](http://blog.johtani.info/blog/2015/10/29/elasticsearch-2-0-0-released-ja/)\n * [The Sense UI](https://www.elastic.co/guide/en/sense/current/sense-ui.html)\n\n```bash\ndocker exec kibana /bin/bash -c '/opt/kibana/bin/kibana plugin --install elastic/sense'\n```\n\n\u30d7\u30e9\u30b0\u30a4\u30f3\u3092\u8aad\u307f\u8fbc\u307e\u305b\u308b\u305f\u3081\u306bKibana\u3092\u518d\u8d77\u52d5\u3057\u307e\u3059\u3002\n\n```bash\nsudo docker retsart kibana\n```\n\n# Embulk\n\nElasticsearch\u3078\u306e\u30c7\u30fc\u30bf\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\u30c4\u30fc\u30eb\u3068\u3057\u3066Embulk\u3092\u4f7f\u3044\u307e\u3059\u3002\n\n * http://www.embulk.org/\n\n\u5b9f\u884c\u306b\u306fJava\u306e\u30e9\u30f3\u30bf\u30a4\u30e0\u304c\u5fc5\u8981\u306a\u306e\u3067\u4eca\u56de\u306fOpenJDK\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3059\u3002\n\n```bash\nsudo apt-get install openjdk-7-jdk\n```\n\nembulk\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u306f\u57fa\u672c\u7684\u306b\u516c\u5f0f\u306b\u3042\u308b\u624b\u9806\u3067\u884c\u3044\u307e\u3059\u3002\n\n * [Quick Start - Linux & Mac & BSD](https://github.com/embulk/embulk#linux--mac--bsd)\n\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u5148\u304cSSL\u306eCDN\u306b\u30ea\u30c0\u30a4\u30ec\u30af\u30c8\u3055\u308c\u308b\u306e\u3067curl\u30aa\u30d7\u30b7\u30e7\u30f3\u306b`--insecure (-k)`\u3092\u4ed8\u3051\u3066\u304a\u304d\u307e\u3059\u3002\n\n```bash\ncurl -k --create-dirs -o ~/.embulk/bin/embulk -L 'http://dl.embulk.org/embulk-latest.jar'\nchmod +x ~/.embulk/bin/embulk\n```\n\nembulk\u306e\u30d1\u30b9\u3092\u6c38\u7d9a\u5316\u3059\u308b\u5834\u5408\u306f\u624b\u9806\u901a\u308a\u306b\u3057\u307e\u3059\u304c\u3001\n\n```bash\necho 'export PATH=\"$HOME/.embulk/bin:$PATH\"' >> ~/.bashrc\nsource ~/.bashrc\n```\n\n\u4eca\u56de\u306f\u4e00\u6642\u7684\u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```bash\nexport PATH=$HOME/.embulk/bin:$PATH\n```\n\n## Embulk\u30d7\u30e9\u30b0\u30a4\u30f3\n\n### embulk-filter_add_time\n\n\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u578b\u5909\u63db\u306a\u3069\u3092\u884c\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [treasure-data/embulk-filter-add_time](https://github.com/treasure-data/embulk-filter-add_time)\n\n```bash\nembulk gem install embulk-filter-add_time\n```\n\ntimestamp\u578b\u3092long\u578b\u306b\u8907\u88fd\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n### embulk-filter-column\n\n\u30ab\u30e9\u30e0\u306e\u8ffd\u52a0\u3001\u524a\u9664\u3092\u884c\u3046\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [sonots/embulk-filter-column](https://github.com/sonots/embulk-filter-column)\n\n```bash\nembulk gem install embulk-filter-column\n```\n\n\u5f8c\u7d9a\u306e\u30d5\u30a3\u30eb\u30bf\u7528\u306b\u8907\u6570\u306e\u30ab\u30e9\u30e0\u306b\u30b3\u30d4\u30fc\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n### embulk-filter-eval\n\nRuby\u306e\u8a55\u4fa1\u5f0f\u3067\u5024\u3092\u66f8\u304d\u63db\u3048\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [embulk-filter-eval \u3068\u3044\u3046\u30d5\u30a3\u30eb\u30bf\u30fc\u30d7\u30e9\u30b0\u30a4\u30f3\u66f8\u3044\u305f - scramble cadenza](http://mgi.hatenablog.com/entry/2015/03/19/084430)\n * [mgi166/embulk-filter-eval](https://github.com/mgi166/embulk-filter-eval)\n * [A-AUTO 50 \u958b\u767a\u8005\u30d6\u30ed\u30b0: embulk-filter-eval\u3067\u3069\u3093\u306a\u30c7\u30fc\u30bf\u5909\u63db\u304c\u3067\u304d\u308b\u306e\u304b\u8a66\u3057\u3066\u307f\u308b](http://a-auto50.blogspot.jp/2015/06/embulk-filter-eval.html)\n\n\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304b\u3089\u66dc\u65e5\u3001\u6642\u9593\u306b\u5909\u63db\u3057\u305f\u308a\u3001\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u304b\u3089\u30b3\u30de\u30f3\u30c9\u3068\u5f15\u6570\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```bash\nembulk gem install embulk-filter-eval\n```\n\n### embulk-filter-insert\n\n\u4efb\u610f\u306e\u30ab\u30e9\u30e0\u3068\u3057\u3066\u6307\u5b9a\u3057\u305f\u5024\u3092\u8ffd\u52a0\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [muziyoshiz/embulk-filter-insert](https://github.com/muziyoshiz/embulk-filter-insert)\n\n\u30db\u30b9\u30c8\u540d\u3092liquid\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u5909\u6570\u3068\u3057\u3066\u3001\u3069\u306e\u30db\u30b9\u30c8\u306e\u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb\u3067\u3042\u308b\u304b\u3092\u8a8d\u8b58\u3055\u305b\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```bash\nembulk gem install embulk-filter-insert\n```\n\n### embulk-filter-row\n\n\u6307\u5b9a\u3057\u305f\u6761\u4ef6\u3067\u30c7\u30fc\u30bf\u3092\u30d5\u30a3\u30eb\u30bf\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [sonots/embulk-filter-row](https://github.com/sonots/embulk-filter-row)\n\n\u7570\u5e38\u5024\u3092\u5f3e\u304f\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\uff08`grep -v`\u4ee3\u308f\u308a\uff09\n\n```bash\nembulk gem install embulk-filter-row\n```\n\n### embulk-filter-split\n\n\u6307\u5b9a\u3057\u305f\u6761\u4ef6\u3067\u30c7\u30fc\u30bf\u3092\u8907\u6570\u8981\u7d20\u306b\u5206\u5272\u3059\u308b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [toyama0919/embulk-filter-split](https://github.com/toyama0919/embulk-filter-split)\n\n\u30bb\u30df\u30b3\u30ed\u30f31\u884c\u306b\u307e\u3068\u3081\u3066\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3084\u30d1\u30a4\u30d7\u3067\u7e4b\u3044\u3067\u5b9f\u884c\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u5206\u5272\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002\n\n```bash\nembulk gem install embulk-filter-split\n```\n\n### embulk-output-elasticsearch\n\nElasticserach\u3078\u306e\u51fa\u529b\u30d7\u30e9\u30b0\u30a4\u30f3\u3002\n\n * [muga/embulk-output-elasticsearch](https://github.com/muga/embulk-output-elasticsearch)\n\n```bash\nembulk gem install embulk-output-elasticsearch\n```\n\n# \u30c7\u30fc\u30bf\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\n## \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u767b\u9332\n\n\u4eca\u56de\u4f5c\u6210\u3059\u308b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u5b9a\u7fa9\u3092\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u3057\u3066\u767b\u9332\u3057\u307e\u3059\u3002\n\n * [Index Templates](https://www.elastic.co/guide/en/elasticsearch/reference/2.2/indices-templates.html)\n\n\u5b9a\u7fa9\u306f\u4ee5\u4e0b\u306e\u901a\u308a\u3002\n\n * Kibana\u3067\u306e\u8a2d\u5b9a\u3092\u624b\u8efd\u306b\u3059\u308b\u305f\u3081\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u540d\u306f`logstash-command_history`\n * \u304a\u8a66\u3057\u74b0\u5883\u306a\u306e\u3067\u30ec\u30d7\u30ea\u30ab\u6570\u306f0\n * \u5168\u6587\u691c\u7d22\u306f\u4e0d\u8981\u306a\u306e\u3067`_all`\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u4f7f\u7528\u3057\u306a\u3044\n * \u30d5\u30a3\u30fc\u30eb\u30c9\u5b9a\u7fa9\n  * `@timestamp` \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u3002Kibana\u3067\u8b58\u5225\u3057\u3084\u3059\u3044\u3088\u3046\u306b\u3053\u306e\u540d\u524d\u3092\u4f7f\u3044\u307e\u3059\n  * `@wday` \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u306e\u66dc\u65e5(1:\u6708\u66dc\u301c7:\u65e5\u66dc)\n  * `@hour` \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u523b\u306e\u6642\u9593\n  * `@host` \u30b7\u30a7\u30eb\u5b9f\u884c\u30db\u30b9\u30c8\u540d\n  * `@shell` \u30b7\u30a7\u30eb\u7a2e\u5225\n  * `@command` \u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\uff08Analyze\u3057\u306a\u3044\u3082\u306e\u3092`@command.raw`\uff09\n  * `command` \u30b3\u30de\u30f3\u30c9\u540d\n  * `args` \u30b3\u30de\u30f3\u30c9\u5f15\u6570\n\n```bash\ncurl -XPUT localhost:9200/_template/command_history_template -d'\n{\n  \"template\": \"logstash-*\",\n  \"settings\": { \"number_of_replicas\" : 0 },\n  \"mappings\": {\n    \"command_history\": {\n      \"_all\": { \"enabled\": false },\n      \"properties\": {\n        \"@timestamp\": {\n          \"type\": \"date\"\n        },\n        \"@wday\": {\n          \"type\": \"byte\"\n        },\n        \"@hour\": {\n          \"type\": \"byte\"\n        },\n        \"@host\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"@shell\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"@command\": {\n          \"type\": \"string\",\n          \"fields\": {\n            \"raw\": {\n              \"index\": \"not_analyzed\",\n              \"type\": \"string\"\n            }\n          }\n        },\n        \"command\": {\n          \"index\": \"not_analyzed\",\n          \"type\": \"string\"\n        },\n        \"args\": {\n          \"type\": \"string\"\n          }\n        }\n      }\n    }\n  }\n}'\n```\n\n## Embulk\u306e\u8a2d\u5b9a\n\nEmbulk\u30d7\u30e9\u30b0\u30a4\u30f3\u3067\u3059\u3079\u3066\u671b\u307f\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u306f\u96e3\u3057\u305d\u3046\u3060\u3063\u305f\u306e\u3067\u3001\u30b7\u30a7\u30eb\u3067\u52a0\u5de5\u3057\u305f\u3082\u306e\u3092\u6a19\u6e96\u5165\u529b\u3068\u3057\u3066\u8aad\u307f\u8fbc\u307e\u305b\u308b\u65b9\u91dd\u3067\u3059\u3002\n\n * \u5165\u529b\u306fTSV\u3092\u6a19\u6e96\u5165\u529b\u304b\u3089\n * \u5f15\u6570\u3067\u30db\u30b9\u30c8\u540d\u3068\u30b7\u30a7\u30eb\u3092\u4e0e\u3048\u308b\n * \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u304c\u4fdd\u6301\u3055\u308c\u3066\u3044\u306a\u3044\u30d2\u30b9\u30c8\u30ea\u3092\u9664\u304f\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002(`1327083640` `2012-01-21 03:20:40`)\n\n```yaml:command_history.yml.liquid\nin:\n  type: file\n  path_prefix: /dev/stdin\n  parser:\n    type: csv\n    delimiter: \"\\t\"\n    columns:\n    - {name: '@timestamp', type: timestamp, format: '%s'}\n    - {name: '@command', type: string}\n\nfilters:\n  - type: row\n    conditions:\n      - {column: '@timestamp', operator: \">\", argument: \"1327083640\", format: '%s' }\n\n  - type: insert\n    columns:\n      - '@host': {{ env.host }}\n      - '@shell': {{ env.shell }}\n    at: 1\n\n  - type: split\n    delimiter: '|'\n    keep_input: true\n    target_key: '@command'\n\n  - type: add_time\n    to_column:\n      name: '@wday'\n      type: long\n    from_column:\n      name: '@timestamp'\n\n  - type: column\n    add_columns:\n      - {name: '@hour', src: '@wday' }\n      - {name: command, src: '@command' }\n      - {name: args, src: '@command' }\n\n  - type: eval\n    eval_columns:\n      - '@wday': Time.at(value).strftime('%u')\n      - '@hour': Time.at(value).strftime('%H')\n      - command: value.sub(/^\\s*(?:(?:env )?[^=]+=\\S+ )*(\\S+).*$/, '\\1')\n      - args: if value.match(/^\\s*\\S+ (.*?)\\s*$/) then\n                value=$1\n              else\n                value=nil\n              end\n\nout:\n  type: elasticsearch\n  cluster_name: elasticsearch\n  nodes:\n    - {host: localhost, port: 9300}\n  index: logstash-command_history\n  index_type: command_history\n```\n\n## \u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb(bash)\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\n * awk\u3067\u6642\u523b\u6587\u5b57\u5217\u3068\u30b3\u30de\u30f3\u30c9\u30e9\u30a4\u30f3\u30921\u884c\u306b\u3057\u3066\u30bf\u30d6\u533a\u5207\u308a\u306b\u3057\u307e\u3059\n * `file` \u306b\u4efb\u610f\u306e.bash_history\u306e\u30d1\u30b9\n * `host` \u306b\u4efb\u610f\u306e\u30db\u30b9\u30c8\u540d\n\n```bash\nfile=/path/to/bash_history\nhost=somehost\n\ncat $file | awk '{getline ts; print substr(ts,2)\"\\t\"$0}' |\n  host=$host shell=bash embulk run ./command_history.yml.liquid\n```\n\n## \u30d2\u30b9\u30c8\u30ea\u30d5\u30a1\u30a4\u30eb(zsh)\u306e\u30ed\u30fc\u30c7\u30a3\u30f3\u30b0\n\n * sed\u3067\u30bf\u30d6\u533a\u5207\u308a\u306b\u3057\u307e\u3059\uff08\u8907\u6570\u884c\u306b\u306f\u5bfe\u5fdc\u3057\u307e\u305b\u3093\uff09\n * `file` \u306b\u4efb\u610f\u306e.zsh_history\u306e\u30d1\u30b9\n * `host` \u306b\u4efb\u610f\u306e\u30db\u30b9\u30c8\u540d\n\n```bash\nfile=/path/to/bash_history\nhost=somehost\n\ncat $file | cut -b 3- | sed -e 's/:0;/\\t/' |\n  host=$host shell=zsh embulk run ./command_history.yml.liquid\n```\n\n# \u304a\u308f\u308a\u306b\n\n\u3053\u306e\u8a18\u4e8b\u306f\u6628\u5e74\u672b\u306b\u66f8\u304d\u59cb\u3081\u305f\u306e\u3067\u3059\u304c\u3001\u3044\u308d\u3044\u308d\u3042\u3063\u3066\u516c\u958b\u304c\u9045\u308c\u3066\u3044\u308b\u3046\u3061\u306b embulk-output-plugin\u304cElasticsearch 2\u7cfb\u306b\u6b63\u5f0f\u5bfe\u5fdc\u3057\u305f\u308a\u3001embulk-filter_add_time\u304c\u4f5c\u6210\u3055\u308c\u305f\u308a\u3001Elasticsearch\u3078\u306e\u767b\u9332\u304c\u697d\u306b\u306a\u308a\u307e\u3057\u305f\u3002\n\n\u307e\u305f\u3001Kibana\u306eheatmap\u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u30a2\u30eb\u30d5\u30a1\u7248\u3068\u306f\u3044\u3048\u52d5\u304f\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u66dc\u65e5\u3084\u6642\u9593\u5e2f\u306e\u68d2\u30b0\u30e9\u30d5\u3092\u4e26\u3079\u306a\u304f\u3066\u6e08\u3080\u3053\u3068\u3092\u77e5\u308a\u307e\u3057\u305f\u3002\n\n\u305d\u3057\u3066\u5bb6\u3067\u4f7f\u3063\u3066\u3044\u308b\u30db\u30b9\u30c8\u306b\u7d5e\u308b\u3068\u3001\u571f\u65e5\u306e\u4e0d\u898f\u5247\u306a\u6d3b\u52d5\u6642\u9593\u3082\u660e\u3089\u304b\u3067\u3059\u306d\u3002\u3002\u3002\n\n![\u30b7\u30a7\u30eb\u306e\u30d2\u30b9\u30c8\u30ea\u306e\u53ef\u8996\u5316\u7d50\u679c(@home)](https://qiita-image-store.s3.amazonaws.com/0/6124/aa5587f6-175a-4233-1940-d28dc41139f2.png)\n\n\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u3068\u306f\u8a00\u308f\u305a\u3001\u307f\u306a\u3055\u3093\u3082\u624b\u5143\u306b\u3042\u308b\u5c65\u6b74\u30c7\u30fc\u30bf\u3092Elastic\u74b0\u5883\u3067\u53ef\u8996\u5316\u3057\u3066\u307f\u308b\u3068\u65b0\u305f\u306a\u767a\u898b\u304c\u3042\u308b\u304b\u3082\u77e5\u308c\u307e\u305b\u3093\u3002\n", "tags": ["Bash", "Elasticsearch", "Embulk", "kibana", "Zsh"]}