{"context": "Mongoose\u3092\u4f7f\u3046\u969b\u306b\u8272\u3005\u3068\u5ba3\u8a00\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u30e9\u30c3\u30d1\u30fc\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\u968f\u6642\u66f4\u65b0\u4e88\u5b9a\u3002\n\n\u672c\u4f53\n\nmodels/model.js\nvar mongoose = require('mongoose'),\n    Schema = mongoose.Schema;\n\n/*---------------------------------------------\n * ModelModule\u5b9a\u7fa9\n *--------------------------------------------*/\n/**\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n * @document : \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u540d\n * @field    : \u30d5\u30a3\u30fc\u30eb\u30c9\u5b9a\u7fa9 \n */\nvar ModelModule  = function(){};\n\n/**\n * \u30b9\u30ad\u30fc\u30de\u4f5c\u6210\n */\nModelModule.prototype.create = function(){\n  var ModelSchema = new Schema(this.field);\n  mongoose.model(this.document,ModelSchema);\n  this.scheme = mongoose.model(this.document);\n  console.log('create collection '+this.document);\n\n};\n\n/**\n * \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a\n */\n\nModelModule.prototype.connection = function(){\n  mongoose.connect('mongodb://localhost/sample_db');\n};\n\n/**\n * \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\n */\n ModelModule.prototype.close = function(){\n   mongoose.disconnect(function(err) {\n     console.log(err ? err : 'connection close');\n   }); \n };\n\n/*---------------------------------------------\n * Model\u5b9a\u7fa9\n *--------------------------------------------*/\nvar Model = function(document,field){\n  this.document = document;\n  this.field = field;\n  this.scheme;\n};\n\nModel.prototype = new ModelModule();\n\n/**\n * \u66f4\u65b0\u7528\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\n */\nModel.prototype.getInstance = function(){\n  return new this.scheme();\n};\n\n/**\n * SELECT\n */\nModel.prototype.find = function(select,where,option){\n  var own = this;\n\n  return new Promise(function(resolve, reject) {\n\n    own.scheme.find( where || null, select || null, option || null,function(err, docs){\n      if(err) return err;\n      result = [];\n\n      docs.forEach(function(record){\n        result.push(record);\n      });\n      resolve(result);\n    });\n  });\n};\n\n/**\n * UPDATE\n */\nModel.prototype.update = function(values,where,atomic){\n  this.scheme.update(where || {}, values, atomic || null, function(err){\n    console.log(err ? err : \"update success\");\n  });\n};\n\n/**\n * DELETE\n */\nModel.prototype.remove = function(where){\n  this.scheme.remove( where || null, function(err){\n    console.log(err ? err : \"update success\");\n  });\n};\n\n/*---------------------------------------------\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30e1\u30bd\u30c3\u30c9\u5b9a\u7fa9\n *--------------------------------------------*/\nvar ModelCreate = function(document,field){\n\n  //\u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\n  model =  new Model(document,field);\n  model.create();\n  return model;\n};\n\nmodule.exports = ModelCreate;\n\n\n\n\u5b9f\u88c5\u65b9\u6cd5\n\nrootes/task.js\n//Model\u3092\u5ba3\u8a00\nvar TaskModel = require('./model')('task',{'text':String});\n\nrouter.post('/tasks', function(req, res, next) {\n\n  //\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a \n  TaskModel.connection();\n\n  //Delete \n  TaskModel.remove({'text':''});\n\n  //Insert \n  task = TaskModel.getInstance();\n  task.text = req.body.text;\n\n  task.save(function(err){\n    console.log( err ? err : 'insert success' );\n  });\n\n  //Update \n  TaskModel.update({'text':'UPDATE!!'},{'text':'CHANGE'});\n\n  //Select\n  var result = TaskModel.find('text').then(function(result){\n    res.json(result);\n  });\n\n\n\n\u6ce8\u610f\u70b9\n\u30fb\u975e\u540c\u671f\u3067\u306e\u53d6\u5f97\u3068\u306a\u308b\u305f\u3081find\u30e1\u30bd\u30c3\u30c9\u5229\u7528\u6642\u3001\u5fc5\u305a then \u3092\u4f7f\u3063\u3066\u53d6\u5f97\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  \u30fbCRUD\u51e6\u7406\u306e\u5f15\u6570\u5024\u306f Mongoose \u306e\u5404CRUD\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u3068\u540c\u4e00\u3067\u3059\u3002\n\n\u554f\u984c\u70b9\n\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304c\u5e38\u6642\u63a5\u7d9a\u3067\u306f\u306a\u3044\u305f\u3081\u3001\u5b9f\u88c5\u5074\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u7ba1\u7406\u304c\u5fc5\u8981\u3002\n  \u5e38\u6642\u63a5\u7d9a\u3067\u554f\u984c\u304c\u7121\u3044\u306e\u3067\u3042\u308c\u3070\u3000ModelModule\u5074\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a\u3092\u5b9f\u88c5\nMongoose\u3092\u4f7f\u3046\u969b\u306b\u8272\u3005\u3068\u5ba3\u8a00\u3059\u308b\u306e\u304c\u9762\u5012\u306a\u306e\u3067\u30e9\u30c3\u30d1\u30fc\u3092\u5b9f\u88c5\u3057\u3066\u307f\u305f\u3002\n\u968f\u6642\u66f4\u65b0\u4e88\u5b9a\u3002\n\n#\u672c\u4f53\n``` models/model.js\nvar mongoose = require('mongoose'),\n    Schema = mongoose.Schema;\n\n/*---------------------------------------------\n * ModelModule\u5b9a\u7fa9\n *--------------------------------------------*/\n/**\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\n * @document : \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u540d\n * @field    : \u30d5\u30a3\u30fc\u30eb\u30c9\u5b9a\u7fa9 \n */\nvar ModelModule  = function(){};\n\n/**\n * \u30b9\u30ad\u30fc\u30de\u4f5c\u6210\n */\nModelModule.prototype.create = function(){\n  var ModelSchema = new Schema(this.field);\n  mongoose.model(this.document,ModelSchema);\n  this.scheme = mongoose.model(this.document);\n  console.log('create collection '+this.document);\n\n};\n\n/**\n * \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a\n */\n \nModelModule.prototype.connection = function(){\n  mongoose.connect('mongodb://localhost/sample_db');\n};\n \n/**\n * \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u5207\u65ad\n */\n ModelModule.prototype.close = function(){\n   mongoose.disconnect(function(err) {\n     console.log(err ? err : 'connection close');\n   }); \n };\n\n/*---------------------------------------------\n * Model\u5b9a\u7fa9\n *--------------------------------------------*/\nvar Model = function(document,field){\n  this.document = document;\n  this.field = field;\n  this.scheme;\n};\n\nModel.prototype = new ModelModule();\n\n/**\n * \u66f4\u65b0\u7528\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\n */\nModel.prototype.getInstance = function(){\n  return new this.scheme();\n};\n\n/**\n * SELECT\n */\nModel.prototype.find = function(select,where,option){\n  var own = this;\n  \n  return new Promise(function(resolve, reject) {\n    \n    own.scheme.find( where || null, select || null, option || null,function(err, docs){\n      if(err) return err;\n      result = [];\n      \n      docs.forEach(function(record){\n        result.push(record);\n      });\n      resolve(result);\n    });\n  });\n};\n\n/**\n * UPDATE\n */\nModel.prototype.update = function(values,where,atomic){\n  this.scheme.update(where || {}, values, atomic || null, function(err){\n    console.log(err ? err : \"update success\");\n  });\n};\n\n/**\n * DELETE\n */\nModel.prototype.remove = function(where){\n  this.scheme.remove( where || null, function(err){\n    console.log(err ? err : \"update success\");\n  });\n};\n\n/*---------------------------------------------\n * \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u30e1\u30bd\u30c3\u30c9\u5b9a\u7fa9\n *--------------------------------------------*/\nvar ModelCreate = function(document,field){\n  \n  //\u30e2\u30c7\u30eb\u3092\u751f\u6210\u3057\u3001\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\n  model =  new Model(document,field);\n  model.create();\n  return model;\n};\n\nmodule.exports = ModelCreate;\n```\n\n#\u5b9f\u88c5\u65b9\u6cd5\n\n```rootes/task.js\n//Model\u3092\u5ba3\u8a00\nvar TaskModel = require('./model')('task',{'text':String});\n\nrouter.post('/tasks', function(req, res, next) {\n  \n  //\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a \n  TaskModel.connection();\n  \n  //Delete \n  TaskModel.remove({'text':''});\n  \n  //Insert \n  task = TaskModel.getInstance();\n  task.text = req.body.text;\n  \n  task.save(function(err){\n    console.log( err ? err : 'insert success' );\n  });\n\n  //Update \n  TaskModel.update({'text':'UPDATE!!'},{'text':'CHANGE'});\n\n  //Select\n  var result = TaskModel.find('text').then(function(result){\n    res.json(result);\n  });\n```\n\n#\u6ce8\u610f\u70b9\n  \u30fb\u975e\u540c\u671f\u3067\u306e\u53d6\u5f97\u3068\u306a\u308b\u305f\u3081find\u30e1\u30bd\u30c3\u30c9\u5229\u7528\u6642\u3001\u5fc5\u305a then \u3092\u4f7f\u3063\u3066\u53d6\u5f97\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n  \u30fbCRUD\u51e6\u7406\u306e\u5f15\u6570\u5024\u306f Mongoose \u306e\u5404CRUD\u30e1\u30bd\u30c3\u30c9\u306e\u5f15\u6570\u3068\u540c\u4e00\u3067\u3059\u3002\n\n#\u554f\u984c\u70b9\n  \u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u304c\u5e38\u6642\u63a5\u7d9a\u3067\u306f\u306a\u3044\u305f\u3081\u3001\u5b9f\u88c5\u5074\u3067\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u306e\u7ba1\u7406\u304c\u5fc5\u8981\u3002\n  \u5e38\u6642\u63a5\u7d9a\u3067\u554f\u984c\u304c\u7121\u3044\u306e\u3067\u3042\u308c\u3070\u3000ModelModule\u5074\u306b\u30b3\u30cd\u30af\u30b7\u30e7\u30f3\u63a5\u7d9a\u3092\u5b9f\u88c5\n", "tags": ["mongoose", "Node.js", "JavaScript", "MongoDB"]}