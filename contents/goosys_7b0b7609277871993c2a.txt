{"context": " More than 1 year has passed since last update.\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3082\u8ffd\u52a0\u3067\u304d\u308b\u3051\u3069\u3001\u904b\u7528\u5f8c\u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3060\u3051\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u3057\u305f\u3044\u5834\u5408\u306b\u4e0d\u4fbf\u306a\u306e\u3067\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u95a2\u4fc2\u3060\u3051\u30bf\u30b9\u30af\u306b\u307e\u3068\u3081\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u3053\u3068\u3002\n\n\u30bf\u30b9\u30af\u3092\u4f5c\u6210\n\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9(Gist)\n\nfuel/app/tasks/migrate_indexes.php\n<?php\n\nnamespace Fuel\\Tasks;\n\nclass Migrate_indexes\n{\n\n    public static function run()\n    {\n    }\n\n    public static function up()\n    {\n        static::_up('topics', array('id'), 'idx_id');\n        static::_up('topics', array('deleted_at'), 'idx_dl');\n        static::_up('topics', array('id','deleted_at'), 'idx_id_dl');\n        static::_up('topics', array('deleted_at','created_at'), 'idx_dl_cr');\n        static::_up('topics', array('created_at'), 'idx_cr');\n\n        static::_up('comments', array('id'), 'idx_id');\n        static::_up('comments', array('deleted_at'), 'idx_dl');\n        static::_up('comments', array('id','deleted_at'), 'idx_id_dl');\n        static::_up('comments', array('deleted_at','created_at'), 'idx_dl_cr');\n    }\n\n    public static function down()\n    {\n        static::_down('topics', 'idx_id');\n        static::_down('topics', 'idx_dl');\n        static::_down('topics', 'idx_id_dl');\n        static::_down('topics', 'idx_dl_cr');\n        static::_down('topics', 'idx_cr');\n\n        static::_down('comments', 'idx_id');\n        static::_down('comments', 'idx_dl');\n        static::_down('comments', 'idx_dl_cr');\n        static::_down('comments', 'idx_cr');\n    }\n\n    protected static function _up($table, $index_columns, $index_name)\n    {\n        try{\n            \\DBUtil::create_index($table, $index_columns, $index_name);\n            \\Cli::write(\\Cli::color('Created index: '.$table. ' : '. implode(',',$index_columns). ' : '. $index_name, 'green'));\n        }catch( \\Fuel\\Core\\Database_Exception $e ){\n        }\n    }\n\n    protected static function _down($table, $index_name)\n    {\n        try{\n            \\DBUtil::drop_index($table, $index_name);\n            \\Cli::write(\\Cli::color('Dropped index: '.$table. ' : '. $index_name, 'green'));\n        }catch( \\Fuel\\Core\\Database_Exception $e ){\n        }\n    }\n}\n\n\n\n\u5b9f\u884c\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\nphp oil r migrate_indexes:up\n\n\n\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\nphp oil r migrate_indexes:down\n\n\u30de\u30a4\u30b0\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3082\u8ffd\u52a0\u3067\u304d\u308b\u3051\u3069\u3001\u904b\u7528\u5f8c\u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3060\u3051\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u3057\u305f\u3044\u5834\u5408\u306b\u4e0d\u4fbf\u306a\u306e\u3067\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u95a2\u4fc2\u3060\u3051\u30bf\u30b9\u30af\u306b\u307e\u3068\u3081\u3066\u3057\u307e\u304a\u3046\u3068\u3044\u3046\u3053\u3068\u3002\n\n# \u30bf\u30b9\u30af\u3092\u4f5c\u6210\n\n[\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9(Gist)](https://gist.github.com/goosys/01e588dbc15235d4a908)\n\n```php:fuel/app/tasks/migrate_indexes.php\n<?php\n\nnamespace Fuel\\Tasks;\n\nclass Migrate_indexes\n{\n\t\n\tpublic static function run()\n\t{\n\t}\n\t\n\tpublic static function up()\n\t{\n\t\tstatic::_up('topics', array('id'), 'idx_id');\n\t\tstatic::_up('topics', array('deleted_at'), 'idx_dl');\n\t\tstatic::_up('topics', array('id','deleted_at'), 'idx_id_dl');\n\t\tstatic::_up('topics', array('deleted_at','created_at'), 'idx_dl_cr');\n\t\tstatic::_up('topics', array('created_at'), 'idx_cr');\n\t\t\n\t\tstatic::_up('comments', array('id'), 'idx_id');\n\t\tstatic::_up('comments', array('deleted_at'), 'idx_dl');\n\t\tstatic::_up('comments', array('id','deleted_at'), 'idx_id_dl');\n\t\tstatic::_up('comments', array('deleted_at','created_at'), 'idx_dl_cr');\n\t}\n\t\n\tpublic static function down()\n\t{\n\t\tstatic::_down('topics', 'idx_id');\n\t\tstatic::_down('topics', 'idx_dl');\n\t\tstatic::_down('topics', 'idx_id_dl');\n\t\tstatic::_down('topics', 'idx_dl_cr');\n\t\tstatic::_down('topics', 'idx_cr');\n\t\t\n\t\tstatic::_down('comments', 'idx_id');\n\t\tstatic::_down('comments', 'idx_dl');\n\t\tstatic::_down('comments', 'idx_dl_cr');\n\t\tstatic::_down('comments', 'idx_cr');\n\t}\n\t\n\tprotected static function _up($table, $index_columns, $index_name)\n\t{\n\t\ttry{\n\t\t\t\\DBUtil::create_index($table, $index_columns, $index_name);\n\t\t\t\\Cli::write(\\Cli::color('Created index: '.$table. ' : '. implode(',',$index_columns). ' : '. $index_name, 'green'));\n\t\t}catch( \\Fuel\\Core\\Database_Exception $e ){\n\t\t}\n\t}\n\t\n\tprotected static function _down($table, $index_name)\n\t{\n\t\ttry{\n\t\t\t\\DBUtil::drop_index($table, $index_name);\n\t\t\t\\Cli::write(\\Cli::color('Dropped index: '.$table. ' : '. $index_name, 'green'));\n\t\t}catch( \\Fuel\\Core\\Database_Exception $e ){\n\t\t}\n\t}\n}\n```\n\n# \u5b9f\u884c\n## \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u8ffd\u52a0\n\n```shell-session\nphp oil r migrate_indexes:up\n```\n\n## \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u524a\u9664\n\n```shell-session\nphp oil r migrate_indexes:down\n```\n", "tags": ["FuelPHP1.7.2"]}