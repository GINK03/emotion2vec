{"tags": ["Rails", "devise"], "context": " More than 1 year has passed since last update.\u74b0\u5883\u306f rails4.0.2 devise3.2.2 \u3067\u3059\u3002\ndevise\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u306e\u767b\u9332\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u306f\u306a\u304f\u30e6\u30fc\u30b6\u30fc\u540d\u3067\u767b\u9332\u30fb\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\nrails g devise user\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3001\u307e\u305a\u306f\u767b\u9332\u6a5f\u80fd\u306e\u4fee\u6b63\u3092\u3057\u307e\u3059\u3002\nuser\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\u3068view\u5074\u306e\u4fee\u6b63\u306f\u9069\u5b9c\u884c\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u59cb\u3081\u306b\u3001POST\u3057\u305fusername\u3092\u767b\u9332\u3067\u304d\u308b\u3088\u3046\u306b\u3001application_controller.rb\u3092\u4fee\u6b63\u3057strong parameter\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\napplication_controller.rb\n  #before_filter\u3092\u8a2d\u5b9a\n  before_filter :configure_permitted_parameters, if: :devise_controller?\n\n  protected\n\n  def configure_permitted_parameters\n    #strong parameters\u3092\u8a2d\u5b9a\u3057\u3001username\u3092\u8a31\u53ef\n    devise_parameter_sanitizer.for(:sign_up) { |u| u.permit(:username, :password, :password_confirmation) }\n  end  \n\n\n\u6b21\u306b\u30e2\u30c7\u30eb\u5074\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\nuser.rb\nclass User < ActiveRecord::Base\n  devise :database_authenticatable, :registerable,\n         :recoverable, :rememberable, :trackable, :validatable\n\n  #username\u3092\u5fc5\u9808\u30fb\u4e00\u610f\u3068\u3059\u308b\n  validates_uniqueness_of :username\n  validates_presence_of :username\n\n  #\u767b\u9332\u6642\u306bemail\u3092\u4e0d\u8981\u3068\u3059\u308b\n  def email_required?\n    false\n  end\n\n  def email_changed?\n    false\n  end\n\nend\n\n\n\u30dd\u30a4\u30f3\u30c8\u306femail_required?\u3068email_changed?\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3001false\u3092\u8fd4\u5374\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u70b9\u3067\u3059\u3002\n\u3053\u308c\u3092\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u767b\u9332\u6642\u306bemail\u304c\u5fc5\u9808\u306b\u306a\u308a\u307e\u3059\u3002\n\u3053\u308c\u3067\u767b\u9332\u306f\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u6b21\u306f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\napplication_controller.rb\u306econfigure_permitted_parameters\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\napplication_controller.rb\n    devise_parameter_sanitizer.for(:sign_in) { |u| u.permit(:username, :password, :remember_me) }\n\n\n\u3053\u308c\u3067\u30ed\u30b0\u30a4\u30f3\u6642\u306bPOST\u3057\u305fusername\u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306f\u30e2\u30c7\u30eb\u3067\u3059\u3002\n\nuser.rb\nclass User < ActiveRecord::Base\n  # Include default devise modules. Others available are:\n  # :confirmable, :lockable, :timeoutable and :omniauthable\n  devise :database_authenticatable, :registerable,\n         :recoverable, :rememberable, :trackable, :validatable,\n         :authentication_keys => [:username]\n\n  #username\u3092\u5fc5\u9808\u3068\u3059\u308b\n  validates_uniqueness_of :username\n  validates_presence_of :username\n\n  #username\u3092\u5229\u7528\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n  def self.find_first_by_auth_conditions(warden_conditions)\n    conditions = warden_conditions.dup\n    if login = conditions.delete(:login)\n      #\u8a8d\u8a3c\u306e\u6761\u4ef6\u5f0f\u3092\u5909\u66f4\u3059\u308b\n      where(conditions).where([\"username = :value\", { :value => username }]).first\n    else\n      where(conditions).first\n    end\n  end\n\n  #email\u3092\u4e0d\u8981\u3068\u3059\u308b\n  def email_required?\n    false\n  end\n\n  def email_changed?\n    false\n  end\n\nend\n\n\n\u307e\u305a:authentication_keys => [:username]\u3092\u8ffd\u52a0\u3057\u3066\u3001\u8a8d\u8a3c\u30ad\u30fc\u3092username\u306b\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u6b21\u306bdevise\u306efind_first_by_auth_condition\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u8a8d\u8a3c\u306e\u6761\u4ef6\u5f0f\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\u4eca\u56de\u306fusername\u306e\u307f\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304b\u30e6\u30fc\u30b6\u30fc\u540d\u3069\u3061\u3089\u3067\u3082\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306a\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002\n\n\u74b0\u5883\u306f rails4.0.2 devise3.2.2 \u3067\u3059\u3002\n\ndevise\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3068\u30d1\u30b9\u30ef\u30fc\u30c9\u3067\u306e\u767b\u9332\u3068\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3059\u304c\u3001\n\u4eca\u56de\u306f\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u306f\u306a\u304f\u30e6\u30fc\u30b6\u30fc\u540d\u3067\u767b\u9332\u30fb\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\nrails g devise user\u3067\u30ea\u30bd\u30fc\u30b9\u3092\u4f5c\u6210\u3057\u3001\u307e\u305a\u306f\u767b\u9332\u6a5f\u80fd\u306e\u4fee\u6b63\u3092\u3057\u307e\u3059\u3002\nuser\u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u6b63\u3068view\u5074\u306e\u4fee\u6b63\u306f\u9069\u5b9c\u884c\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u59cb\u3081\u306b\u3001POST\u3057\u305fusername\u3092\u767b\u9332\u3067\u304d\u308b\u3088\u3046\u306b\u3001application_controller.rb\u3092\u4fee\u6b63\u3057strong parameter\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\n```ruby:application_controller.rb\n  #before_filter\u3092\u8a2d\u5b9a\n  before_filter :configure_permitted_parameters, if: :devise_controller?\n\n  protected\n\n  def configure_permitted_parameters\n    #strong parameters\u3092\u8a2d\u5b9a\u3057\u3001username\u3092\u8a31\u53ef\n    devise_parameter_sanitizer.for(:sign_up) { |u| u.permit(:username, :password, :password_confirmation) }\n  end  \n```\n\u6b21\u306b\u30e2\u30c7\u30eb\u5074\u3092\u4fee\u6b63\u3057\u307e\u3059\u3002\n\n```ruby:user.rb\nclass User < ActiveRecord::Base\n  devise :database_authenticatable, :registerable,\n         :recoverable, :rememberable, :trackable, :validatable\n\n  #username\u3092\u5fc5\u9808\u30fb\u4e00\u610f\u3068\u3059\u308b\n  validates_uniqueness_of :username\n  validates_presence_of :username\n\n  #\u767b\u9332\u6642\u306bemail\u3092\u4e0d\u8981\u3068\u3059\u308b\n  def email_required?\n    false\n  end\n\n  def email_changed?\n    false\n  end\n\nend\n```\n\n\u30dd\u30a4\u30f3\u30c8\u306femail_required?\u3068email_changed?\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3001false\u3092\u8fd4\u5374\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u70b9\u3067\u3059\u3002\n\u3053\u308c\u3092\u3057\u3066\u304a\u304b\u306a\u3044\u3068\u3001\u767b\u9332\u6642\u306bemail\u304c\u5fc5\u9808\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u3053\u308c\u3067\u767b\u9332\u306f\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u3063\u305f\u306e\u3067\u3001\u6b21\u306f\u30ed\u30b0\u30a4\u30f3\u3067\u304d\u308b\u3088\u3046\u306b\u4fee\u6b63\u3057\u307e\u3059\u3002\n\napplication_controller.rb\u306econfigure_permitted_parameters\u306b\u4e0b\u8a18\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```ruby:application_controller.rb\n    devise_parameter_sanitizer.for(:sign_in) { |u| u.permit(:username, :password, :remember_me) }\n```\n\n\u3053\u308c\u3067\u30ed\u30b0\u30a4\u30f3\u6642\u306bPOST\u3057\u305fusername\u3092\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\u6b21\u306f\u30e2\u30c7\u30eb\u3067\u3059\u3002\n\n```ruby:user.rb\nclass User < ActiveRecord::Base\n  # Include default devise modules. Others available are:\n  # :confirmable, :lockable, :timeoutable and :omniauthable\n  devise :database_authenticatable, :registerable,\n         :recoverable, :rememberable, :trackable, :validatable,\n         :authentication_keys => [:username]\n\n  #username\u3092\u5fc5\u9808\u3068\u3059\u308b\n  validates_uniqueness_of :username\n  validates_presence_of :username\n\n  #username\u3092\u5229\u7528\u3057\u3066\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\n  def self.find_first_by_auth_conditions(warden_conditions)\n    conditions = warden_conditions.dup\n    if login = conditions.delete(:login)\n      #\u8a8d\u8a3c\u306e\u6761\u4ef6\u5f0f\u3092\u5909\u66f4\u3059\u308b\n      where(conditions).where([\"username = :value\", { :value => username }]).first\n    else\n      where(conditions).first\n    end\n  end\n\n  #email\u3092\u4e0d\u8981\u3068\u3059\u308b\n  def email_required?\n    false\n  end\n\n  def email_changed?\n    false\n  end\n\nend\n```\n\n\n\u307e\u305a:authentication_keys => [:username]\u3092\u8ffd\u52a0\u3057\u3066\u3001\u8a8d\u8a3c\u30ad\u30fc\u3092username\u306b\u3059\u308b\u3088\u3046\u8a2d\u5b9a\u3057\u307e\u3059\u3002\n\u6b21\u306bdevise\u306efind_first_by_auth_condition\u3092\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9\u3057\u3066\u8a8d\u8a3c\u306e\u6761\u4ef6\u5f0f\u3092\u5909\u66f4\u3057\u307e\u3059\u3002\n\n\u4eca\u56de\u306fusername\u306e\u307f\u3067\u30ed\u30b0\u30a4\u30f3\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3057\u305f\u304c\u3001\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304b\u30e6\u30fc\u30b6\u30fc\u540d\u3069\u3061\u3089\u3067\u3082\u30ed\u30b0\u30a4\u30f3\u53ef\u80fd\u306a\u3088\u3046\u306b\u5909\u66f4\u3059\u308b\u4e8b\u3082\u53ef\u80fd\u3067\u3059\u3002\n"}