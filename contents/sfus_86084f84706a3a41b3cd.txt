{"context": "\n\n\u6ce8\u610f\n\u4ee5\u4e0b\u306e\u6587\u7ae0\u306f2016\u5e74\u4e0a\u534a\u671f\u306b\u5229\u7528\u53ef\u80fd\u3060\u3063\u305f\u65e7 API \u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8 (LINE BOT API Trial Account) \u306b\u3064\u3044\u3066\u306e\u5185\u5bb9\u3067\u3059\u3002\n\u3053\u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u306f 2016/11/16 \u306b\u524a\u9664\u3055\u308c\u3001\u4eca\u5f8c\u4f7f\u7528\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\u4ee5\u964d\u306f Developer Trial \u306b\u3066\u65b0 API \u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u307e\u305f\u3001 Developer Trial \u3067\u306f\u4eca\u306e\u3068\u3053\u308d\u4e0b\u8a18\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u305f\u3081\u672c\u8a18\u4e8b\u306f\u53c2\u8003\u7a0b\u5ea6\u306b\u7559\u3081\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n-- \u6ce8\u610f\u3053\u3053\u307e\u3067 --\n\n\u306f\u3058\u3081\u306b\n\u306f\u3058\u3081\u307e\u3057\u3066\u3001sfus\u3067\u3059\u3002\n\u4ee5\u524d\u304b\u3089 Slack \u3067\u732e\u7acb\u63d0\u6848 Bot \u3092\u500b\u4eba\u7528\u306b\u4f5c\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3046\u3069 LINE BOT API Trial Account \u304c\u516c\u958b\u3055\u308c\u305f\u306e\u3067\u3001Slack BOT \u3067\u306f\u306a\u304f LINE BOT \u3067\u904b\u7528\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nLINE BOT API \u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u3067\u5404\u8a00\u8a9e\u306e SDK \u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u3061\u3089\u3067\u306f\u306a\u304f GitHub \u793e\u88fd Bot \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af HUBOT \u3068\u305d\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u306e hubot-line \u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\nhubot-line \u306b\u3064\u3044\u3066\u306f\u540c\u50da\u3067\u4f5c\u8005\u306e @umakoz \u3055\u3093\u304c\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306b\u4e00\u901a\u308a\u8aac\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3053\u3061\u3089\u3092\u3054\u53c2\u8003\u304f\u3060\u3055\u3044\u3002\nLINE BOT API \u3092 Hubot \u304b\u3089\u4f7f\u3048\u308b hubot-line \u3092\u4f5c\u3063\u305f - Qiita\n\n\u4e8b\u524d\u6e96\u5099\n\u307e\u305a\u3001LINE BUSINESS CENTER \u304b\u3089 LINE BOT API Trial Account \u306b\u7533\u3057\u8fbc\u307f\u307e\u3059\u3002\n2016/05/05 \u73fe\u5728\u3001\u521d\u56de1\u4e07\u4eba\u306e\u52df\u96c6\u304c\u7de0\u3081\u5207\u3089\u308c\u305f\u5f8c\u306e\u3001\u8ffd\u52a0\u52df\u96c6\u4e2d\u306a\u306e\u3067\u307e\u3060\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3044\u65b9\u306f\u304a\u65e9\u3081\u306b\u3069\u3046\u305e\u3002\n\u3010LINE\u3011\u300cLINE BOT API Trial Account\u300d\u306e\u8ffd\u52a0\u52df\u96c6\u3092\u958b\u59cb | LINE Corporation | \u30cb\u30e5\u30fc\u30b9\n\u305d\u3057\u3066 hubot-line \u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u3082 @umakoz \u3055\u3093\u304c\u4f5c\u3063\u3066\u304f\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u958b\u767a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\numakoz/hubot-line-example: Example code for hubot-line.\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u306f Heroku \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001Heroku \u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7121\u3044\u5834\u5408\u306f\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\nHeroku: Cloud Application Platform\n\u305d\u3057\u3066 LINE BOT API \u306f Server IP Whitelist \u306b\u63a5\u7d9a\u5143 IP \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u305f\u3081\u3001Heroku \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e IP \u3092\u56fa\u5b9a\u3059\u308b\u305f\u3081\u306b Fixie \u3068\u3044\u3046\u30d7\u30ed\u30ad\u30b7\u3092\u4f7f\u3063\u3066\u5bfe\u5fdc\u3057\u307e\u3059\u3002Fixie \u306f\u6708500\u30ea\u30af\u30a8\u30b9\u30c8\u307e\u3067\u306f\u7121\u6599\u3067\u4f7f\u3048\u307e\u3059\u304c\u3001\u305d\u306e\u5834\u5408\u3067\u3082\u5229\u7528\u6642\u306b\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u767b\u9332\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\u53c2\u8003\uff1aLINE BOT \u3092\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067 Heroku \u3067\u52d5\u304b\u3059 - Qiita \n\nhubot-line-example \u306e\u52d5\u4f5c\u624b\u9806\nhubot-line-example \u3092 git clone \u3057\u3066\u30ed\u30fc\u30ab\u30eb\u306b\u6301\u3063\u3066\u304d\u307e\u3059\u3002\nHeroku \u4e0a\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306e\u65b9\u6cd5\u3082\u5168\u90e8 Readme \u306b\u66f8\u3044\u3066\u9802\u3044\u3066\u3044\u308b\u306e\u3067\u305d\u306e\u307e\u307e\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\nHeroku \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n$ heroku apps:create\n\n\uff08\u5fc5\u8981\u304c\u3042\u308c\u3070\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d\u306e\u5909\u66f4\u3082\uff09\n\nHeroku \u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\n$ heroku config:add HUBOT_LINE_CHANNEL_ID=\"your_channel_id\"\n$ heroku config:add HUBOT_LINE_CHANNEL_SECRET=\"your_channel_secret\"\n$ heroku config:add HUBOT_LINE_CHANNEL_MID=\"your_channel_mid\"\n\n\u3053\u3053\u306b\u8a2d\u5b9a\u3059\u308b\u5024\u306f\u3001LINE BUSINESS CENTER \u306e\u300c\u3042\u306a\u305f\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u30da\u30fc\u30b8\u306e\u300c\u4f7f\u3046\u300d\u3092\u62bc\u3057\u305f\u5148\u306e LINE developers \u306e\u30da\u30fc\u30b8\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n\n\u52d5\u4f5c\u78ba\u8a8d\u7528\u306b\u30ed\u30b0\u30ec\u30d9\u30eb\u3092\u4e0a\u3052\u3066\u304a\u304d\u307e\u3059\u3002\n$ heroku config:add HUBOT_LOG_LEVEL=\"debug\"\n\n\u52d5\u4f5c\u30ed\u30b0\u306f heroku logs --tail \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\u203b \u3061\u306a\u307f\u306b\u3053\u3061\u3089\u306e\u30a2\u30d7\u30ea\u30a2\u30a4\u30b3\u30f3\u306f\u3081\u3057\u4e38\u304f\u3093\u306b\u306a\u308a\u307e\u3059\u3002\u672c Bot \u306f\u500b\u4eba\u7528\u9014\u306b\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6a29\u5229\u8005\u306e\u65b9\u3067\u554f\u984c\u7b49\u3042\u308c\u3070\u304a\u77e5\u3089\u305b\u304f\u3060\u3055\u3044\u3002\u798f\u5ca1\u770c\u7523\u7c73\u304a\u3044\u3057\u3044\u3088\uff01\uff08\u30b9\u30c6\u30de\uff09\n\u91d1\u306e\u3081\u3057\u4e38\u304f\u3093\uff5cJA\u5168\u8fb2\u3075\u304f\u308c\u3093 \u3081\u3057\u4e38\u304f\u3093\n\nHeroku \u30a2\u30c9\u30aa\u30f3\u8ffd\u52a0\nRedis \u3068 Fixie \u30a2\u30c9\u30aa\u30f3\u3092\u5165\u308c\u307e\u3059\uff08\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f Redis \u306f\u4f7f\u3063\u3066\u3044\u307e\u305b\u3093\u304c\uff09\n$ heroku addons:create rediscloud:30\n$ heroku addons:create fixie:tricycle\n\n\nLINE BOT \u8a2d\u5b9a\nFixie \u8ffd\u52a0\u6642\u306b\u8868\u793a\u3055\u308c\u305f IP \u30a2\u30c9\u30ec\u30b9\u30922\u3064\u3092\u3001 LINE developers \u306e Server IP Whitelist \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff08\u4e0b\u56f3\u306f\u8ffd\u52a0\u5f8c\u306e\u72b6\u614b\uff09\n\n\u3053\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f Heroku \u306e\u7ba1\u7406\u753b\u9762\u304b\u3089\u8fbf\u308c\u308b Fixie \u306e\u30da\u30fc\u30b8\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\u305d\u3057\u3066\u3001LINE developers \u306e Basic Information \u306e\u4e0b\u306e\u65b9\u306b\u3042\u308b Edit \u30dc\u30bf\u30f3\u304b\u3089\u3053\u306e Heroku \u30a2\u30d7\u30ea\u306e URL \u3092 Callback URL \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff08\u3053\u306e Heroku \u30a2\u30d7\u30ea\u306e\u60c5\u5831\u306f heroku apps:info \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff09\nhttps://your-app-name.herokuapp.com:443/hubot/line/callback\n\n\n\nhubot-line-example \u8a2d\u5b9a\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001 ./scripts/line.coffee \u30d5\u30a1\u30a4\u30eb\u306e\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u81ea\u5206\u306e Heroku \u30a2\u30d7\u30ea\u306e URL \u306b\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\uff08\u753b\u50cf\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3059\u3002\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u4f7f\u7528\u3057\u3066\u3044\u307e\u305b\u3093\uff09\n\n./scripts/line.coffee\ncontentEndpoint = 'https://your-app-name.herokuapp.com:443/download'\n\n\n\nHeroku \u30c7\u30d7\u30ed\u30a4\uff06\u52d5\u4f5c\u78ba\u8a8d\n$ git add .\n$ git commit -m 'set contentEndpoint.'\n$ git push heroku master\n\n\uff08remote \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u4eba\u306f git remote add heroku https://git.heroku.com/your-app-name.git \u3092 push \u524d\u306b\u5b9f\u65bd\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n\u3042\u3068\u306f\u3001 LINE developers \u306e QR\u30b3\u30fc\u30c9\u304b\u3089\u81ea\u5206\u306e Bot \u3092\u304a\u53cb\u9054\u306b\u8ffd\u52a0\u3057\u3066\u3001badger \u3068\u8a71\u3057\u304b\u3051\u305f\u3089\u8fd4\u4e8b\u3092\u3057\u3066\u304f\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n\uff08\u30b9\u30bf\u30f3\u30d7\u3084\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u3063\u3066\u3082\u8fd4\u4e8b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u30b9\u30bf\u30f3\u30d7\u306b\u3064\u3044\u3066\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u7279\u5b9a\u306e\u30b9\u30bf\u30f3\u30d7\u3057\u304b\u4f7f\u3048\u307e\u305b\u3093\u3002\u4f4d\u7f6e\u60c5\u5831\u306b\u3064\u3044\u3066\u3082\u3001\u30b5\u30f3\u30d7\u30ebbot\u306f\u672c\u6587\u304c\u7a7a\u3060\u3068\u8fd4\u4e8b\u3057\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001\u73fe\u5728\u4f4d\u7f6e\u304b\u3089\u52d5\u304b\u3055\u305a\u306b\u4f4f\u6240\u6587\u5b57\u5217\u304c\u9001\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u8fd4\u4e8b\u304c\u6765\u307e\u3059\uff09\n\n\u732e\u7acb\u63d0\u6848Bot\u306e\u5b9f\u88c5\n\u524d\u30d5\u30ea\u304c\u9577\u304b\u3063\u305f\u3067\u3059\u304c\u3001\u30b5\u30f3\u30d7\u30eb Bot \u306e\u52d5\u4f5c\u78ba\u8a8d\u304c\u3067\u304d\u305f\u3089\u3001Hubot \u30a2\u30d7\u30ea\u306e\u5b9f\u88c5\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\uff08Hubot \u30a2\u30d7\u30ea\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3057\u307e\u3059\uff09\n\u732e\u7acb\u30c7\u30fc\u30bf\u3092\u3069\u3053\u304b\u3089\u53d6\u3063\u3066\u304f\u308b\u304b\u60a9\u307f\u307e\u3057\u305f\u304c\u3001\u6700\u5927\u624b\u306e\u30af\u30c3\u30af\u30d1\u30c3\u30c9\u3055\u3093\u306f API \u3092\u516c\u958b\u3057\u3066\u3044\u306a\u3044\uff08\uff06\u30af\u30ed\u30fc\u30e9\u306f\u8ff7\u60d1\u3092\u304b\u3051\u308b)\u306e\u3067\u3001\u697d\u5929\u30ec\u30b7\u30d4\u306e\u691c\u7d22API\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\nAPI \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001\u4e8b\u524d\u306b\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u767b\u9332\u3092\u884c\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9(RAKUTEN WEBSERVICE)\n\n\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\nHubot \u306e\u5b9f\u88c5\u3067\u3059\u304c\u3001\u697d\u5929\u30ec\u30b7\u30d4\u306e WebService API \u3092\u8abf\u3079\u3066\u3044\u3066\u4ee5\u4e0b\u306e\u6295\u7a3f\u3092\u77e5\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u30af\u30ed\u30fc\u30f3\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u8868\u984c\u3082\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff09\n\u6669\u3054\u306f\u3093\u306e\u732e\u7acb\u3092\u4e00\u7dd2\u306b\u8003\u3048\u3066\u304f\u308c\u308bbot\u3092\u4f5c\u3063\u3066\u307f\u305f - Qiita\n\u4e0a\u8a18\u30a8\u30f3\u30c8\u30ea\u3067\u306f Slack + Ruboty(Ruby) \u3067\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u4f3c\u305f\u3088\u3046\u306a\u4f5c\u308a\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\u4ee5\u4e0b\u3001\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\n./scripts/line.coffee\n{LineRawMessageListener, LineImageListener, LineVideoListener, LineAudioListener, LineLocationListener,\nLineStickerListener, LineContactListener, LineRawOperationListener, LineFriendListener, LineBlockListener,\nLineTextAction, LineImageAction, LineVideoAction, LineAudioAction, LineLocationAction, LineStickerAction\n} = require 'hubot-line'\n\n_ = require 'underscore';\n\napplicationId = process.env.HUBOT_LINE_APPLICATION_ID\n\ncategoryEndpoint = \"/services/api/Recipe/CategoryList/20121121?format=json&formatVersion=2&elements=categoryName%2CcategoryId%2CparentCategoryId&categoryType=medium&applicationId=#{applicationId}\"\nrecipeEndpoint = (categoryId) -> \"/services/api/Recipe/CategoryRanking/20121121?format=json&formatVersion=2&categoryId=#{categoryId}&applicationId=#{applicationId}\"\n\ncategoryMap = {}\n\nmodule.exports = (robot) ->\n  createCategoryMap(robot)\n\n  robot.respond /(?:(?:\u4eca\u65e5|\u304d\u3087\u3046)(?:\u306f|\u3082)\u3001?)?(.+)/, (msg) ->\n    foodName = msg.match[1].replace(/\u304b\u306a$/, '')\n\n    if foodName?.match(/(\u4f55|\u306a\u3093)\u3067\u3082\u3044\u3044/)\n      categoryId = categoryMap[_.sample(Object.keys(categoryMap))]\n      callRecipeServiceApi msg, recipeEndpoint(categoryId), (results) ->\n        recipe = _.sample(results)\n        msg.send recommendRecipe(foodName, \"\u306a\u3089\", recipe)\n\n    else if categoryMap[foodName]?\n      categoryId = categoryMap[foodName]\n      callRecipeServiceApi msg, recipeEndpoint(categoryId), (results) ->\n        recipe = _.sample(results)\n        msg.send recommendRecipe(foodName, \"\u3060\u3068\", recipe)\n    else\n      msg.send recommendFood(categoryMap, foodName)\n\ncreateCategoryMap = (robot) ->\n  callRecipeServiceApi robot, categoryEndpoint, (results) ->\n    for cat in results.medium\n      categoryMap[cat.categoryName] = \"#{cat.parentCategoryId}-#{cat.categoryId}\"\n    console.log(\"category: #{JSON.stringify(categoryMap)}\")\n\ncallRecipeServiceApi = (robot, apiPath, callback) ->\n  robot.http(\"https://app.rakuten.co.jp\" + apiPath)\n    .header('Accept', 'application/json')\n    .get() (err, res, body) ->\n      if err\n        if res.statusCode is 503\n          robot.send \"\u4eca\u3061\u3087\u3063\u3068\u5fd9\u3057\u3044\u307f\u305f\u3044\u3002\u307e\u305f\u3042\u3068\u3067\u8a71\u3057\u304b\u3051\u3066\u307f\u3066\u306d\"\n        else\n          robot.send \"\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u304b\u3063\u305f\u307f\u305f\u3044\u3002\u3054\u3081\u3093\u306d\\n(ERROR: #{err} (#{res.statusCode}))\"\n        console.log \"Error Occurred: #{res.statusCode}: #{err}\"\n        return\n      if res.statusCode isnt 200\n        robot.send \"\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u304b\u3063\u305f\u307f\u305f\u3044\u3002\u3054\u3081\u3093\u306d\\n(STATUS: #{res.statusCode})\"\n        console.log \"Bad Response: #{res.statusCode}: #{body}\"\n        return\n\n      return callback(JSON.parse(body).result)\n\nrecommendRecipe = (foodName, phrase, recipe) ->\n  \"\"\"\n  #{foodName}#{phrase}\u3001#{recipe.recipeTitle} \u3068\u304b\u306f\u3069\u3046\uff1f\n  #{recipe.recipeUrl}\n  \"\"\"\n\nrecommendFood = (categoryMap, foodName) ->\n  matchCat = Object.keys(categoryMap).filter((cat) ->\n    cat.match(foodName))\n\n  if not matchCat? or matchCat.length is 0\n    return \"#{foodName} \u3060\u3068\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u3082\u3046\u3061\u3087\u3063\u3068\u8a73\u3057\u304f\u6559\u3048\u3066\"\n  else if matchCat.length is 1\n    return \"#{foodName}\u3063\u3066\u3001#{matchCat[0]} \u306e\u3053\u3068\uff1f\"\n  else\n    return \"#{foodName}\u3063\u3066\u3001#{matchCat.join(\"\u3001\")} \u306e\u3069\u308c\u306e\u3053\u3068\uff1f\"\n\n\n\n\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\n\u4e0a\u8a18\u30bd\u30fc\u30b9\u3067\u5229\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 package.json \u306b\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ npm install --save underscore\n\n\n\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u306e\u78ba\u8a8d\uff06\u8a2d\u5b9a\n\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9: \u30a2\u30d7\u30ea\u4e00\u89a7 \u304b\u3089\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n\nHubot \u306e\u30ed\u30fc\u30ab\u30eb\u30c6\u30b9\u30c8\n\u4e0a\u8a18\u5b9f\u88c5\u3067\u306f HUBOT_LINE_APPLICATION_ID \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30b3\u30d4\u30fc\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ export HUBOT_LINE_APPLICATION_ID=XXXXXXXXXXXXXXXXXXX\n$ bin/hubot\n> \u304d\u3087\u3046\u306f\u30b9\u30c6\u30fc\u30ad\u304b\u306a\n> \u30b9\u30c6\u30fc\u30ad\u3060\u3068\u3001\u30d0\u30eb\u30b5\u30df\u30b3\u91a4\u6cb9\u30bd\u30fc\u30b9 de \u7d76\u54c1\u30dd\u30fc\u30af\u30bd\u30c6\u30fc \u3068\u304b\u306f\u3069\u3046\uff1f\nhttp://recipe.rakuten.co.jp/recipe/1570007081/\n\n\nHeroku \u30c7\u30d7\u30ed\u30a4\uff06\u52d5\u4f5c\u78ba\u8a8d\nHeroku \u5074\u306b\u3082\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n$ heroku config:add HUBOT_LINE_APPLICATION_ID=\"XXXXXXXXXXXXXXXXXXX\"\n$ git add .\n$ git commit -m 'Change hubot logic to use Rakuten recipe API'\n$ git push heroku master\n\n\n\n\u611f\u60f3\nHeroku \u3082 Hubot \u3082 CoffeeScript \u3082\u6163\u308c\u3066\u306f\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001hubot-line \u3068 hubot-line-example \u306e\u304a\u304b\u3052\u3067\u7c21\u5358\u306b LINE BOT \u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\uff08\u4f5c\u8005\u306e @umakoz \u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff09\n\u73fe\u5728\u3001Trial Account \u3067\u3082\u7533\u8acb\u3059\u308c\u3070\u6700\u59275000\u4eba\u307e\u3067\u304a\u53cb\u9054\u767b\u9332\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306f50\u4eba\uff09\u3001\u500b\u4eba\u3067\u3082\u8272\u3005\u9762\u767d\u3044\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u3061\u306a\u307f\u306b\u3001\u3082\u3068\u3082\u3068\u306f\u5bb6\u65cf\u306e\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b Bot \u3092\u4f4f\u307e\u308f\u305b\u3088\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\uff08\u7ffb\u8a33 Bot \u306e\u3088\u3046\u306b\uff09\u3001\u73fe\u5728\u516c\u958b\u3055\u308c\u3066\u3044\u308b LINE BOT API \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u5bb6\u65cf\u3067\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u306f\u3061\u3087\u3063\u3068\u8003\u3048\u4e2d\u3067\u3059\u3002\n\u307e\u305f\u3001\u672b\u5c3e\u306b URL \u3092\u66f8\u3044\u3066\u3044\u3066\u3082\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u52dd\u624b\u306b\u306f\u8868\u793a\u3055\u308c\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u305d\u306e\u8fba\u308a\u306f\u6539\u826f\u3057\u3088\u3046\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\u306a\u304a\u3001\u672c\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u306f hubot-line-example \u3068\u540c\u3058\u304f\u5b9f\u904b\u7528\u3092\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4e0d\u7279\u5b9a\u591a\u6570\u306b\u516c\u958b\u3059\u308b\u5834\u5408\u306b\u306f\u5225\u9014\u69cb\u6210\u3092\u3054\u691c\u8a0e\u304f\u3060\u3055\u3044\u3002\n\u53c2\u8003\uff1a\u5927\u91cf\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u3066\u3082\u5b89\u5fc3\u306aLINE BOT\u30b5\u30fc\u30d0\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 - Qiita\n\u305d\u308c\u3067\u306f\u7d20\u6575\u306aBOT LIFE\u3092\uff01\n# \u6ce8\u610f\n\u4ee5\u4e0b\u306e\u6587\u7ae0\u306f2016\u5e74\u4e0a\u534a\u671f\u306b\u5229\u7528\u53ef\u80fd\u3060\u3063\u305f\u65e7 API \u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8 (LINE BOT API Trial Account) \u306b\u3064\u3044\u3066\u306e\u5185\u5bb9\u3067\u3059\u3002\n\n\u3053\u306e\u30c8\u30e9\u30a4\u30a2\u30eb\u30a2\u30ab\u30a6\u30f3\u30c8\u306f 2016/11/16 \u306b\u524a\u9664\u3055\u308c\u3001\u4eca\u5f8c\u4f7f\u7528\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\u4ee5\u964d\u306f Developer Trial \u306b\u3066\u65b0 API \u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\n\u307e\u305f\u3001 Developer Trial \u3067\u306f\u4eca\u306e\u3068\u3053\u308d\u4e0b\u8a18\u30b3\u30fc\u30c9\u305d\u306e\u307e\u307e\u3067\u306f\u52d5\u304b\u306a\u3044\u305f\u3081\u672c\u8a18\u4e8b\u306f\u53c2\u8003\u7a0b\u5ea6\u306b\u7559\u3081\u3066\u304a\u3044\u3066\u4e0b\u3055\u3044\u3002\n\n-- \u6ce8\u610f\u3053\u3053\u307e\u3067 --\n\n## \u306f\u3058\u3081\u306b\n\n\u306f\u3058\u3081\u307e\u3057\u3066\u3001[sfus](http://sfus.net)\u3067\u3059\u3002\n\n\u4ee5\u524d\u304b\u3089 Slack \u3067\u732e\u7acb\u63d0\u6848 Bot \u3092\u500b\u4eba\u7528\u306b\u4f5c\u308d\u3046\u3068\u3057\u3066\u3044\u307e\u3057\u305f\u304c\u3001\u3061\u3087\u3046\u3069 LINE BOT API Trial Account \u304c\u516c\u958b\u3055\u308c\u305f\u306e\u3067\u3001Slack BOT \u3067\u306f\u306a\u304f LINE BOT \u3067\u904b\u7528\u3057\u3066\u307f\u308b\u3053\u3068\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nLINE BOT API \u306f\u30aa\u30d5\u30a3\u30b7\u30e3\u30eb\u3067[\u5404\u8a00\u8a9e\u306e SDK](https://github.com/line) \u304c\u516c\u958b\u3055\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u4eca\u56de\u306f\u305d\u3061\u3089\u3067\u306f\u306a\u304f GitHub \u793e\u88fd Bot \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af [HUBOT](https://hubot.github.com/) \u3068\u305d\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u306e [hubot-line](https://github.com/umakoz/hubot-line) \u3092\u4f7f\u3063\u3066\u4f5c\u6210\u3057\u3066\u307f\u307e\u3059\u3002\n\nhubot-line \u306b\u3064\u3044\u3066\u306f\u540c\u50da\u3067\u4f5c\u8005\u306e @umakoz \u3055\u3093\u304c\u4ee5\u4e0b\u306e\u8a18\u4e8b\u306b\u4e00\u901a\u308a\u8aac\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u306e\u3067\u3053\u3061\u3089\u3092\u3054\u53c2\u8003\u304f\u3060\u3055\u3044\u3002\n\n[LINE BOT API \u3092 Hubot \u304b\u3089\u4f7f\u3048\u308b hubot-line \u3092\u4f5c\u3063\u305f - Qiita](http://qiita.com/umakoz/items/6a0f36c9fc4eda1e839b)\n\n## \u4e8b\u524d\u6e96\u5099\n\n\u307e\u305a\u3001[LINE BUSINESS CENTER](https://business.line.me) \u304b\u3089 LINE BOT API Trial Account \u306b\u7533\u3057\u8fbc\u307f\u307e\u3059\u3002\n2016/05/05 \u73fe\u5728\u3001\u521d\u56de1\u4e07\u4eba\u306e\u52df\u96c6\u304c\u7de0\u3081\u5207\u3089\u308c\u305f\u5f8c\u306e\u3001\u8ffd\u52a0\u52df\u96c6\u4e2d\u306a\u306e\u3067\u307e\u3060\u4f5c\u6210\u3055\u308c\u3066\u3044\u306a\u3044\u65b9\u306f\u304a\u65e9\u3081\u306b\u3069\u3046\u305e\u3002\n\n[\u3010LINE\u3011\u300cLINE BOT API Trial Account\u300d\u306e\u8ffd\u52a0\u52df\u96c6\u3092\u958b\u59cb | LINE Corporation | \u30cb\u30e5\u30fc\u30b9](https://linecorp.com/ja/pr/news/ja/2016/1340)\n\n\n\u305d\u3057\u3066 hubot-line \u3092\u4f7f\u3063\u305f\u30b5\u30f3\u30d7\u30eb\u3082 @umakoz \u3055\u3093\u304c\u4f5c\u3063\u3066\u304f\u308c\u3066\u3044\u308b\u306e\u3067\u3001\u3053\u3061\u3089\u3092\u53c2\u8003\u306b\u958b\u767a\u3057\u3066\u3044\u304d\u307e\u3059\u3002\n\n[umakoz/hubot-line-example: Example code for hubot-line.](https://github.com/umakoz/hubot-line-example)\n\n\u3053\u306e\u30b5\u30f3\u30d7\u30eb\u306f Heroku \u4e0a\u3067\u52d5\u4f5c\u3055\u305b\u308b\u3082\u306e\u306b\u306a\u3063\u3066\u3044\u308b\u306e\u3067\u3001Heroku \u30a2\u30ab\u30a6\u30f3\u30c8\u304c\u7121\u3044\u5834\u5408\u306f\u767b\u9332\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n[Heroku: Cloud Application Platform](https://www.heroku.com/)\n\n\u305d\u3057\u3066 LINE BOT API \u306f Server IP Whitelist \u306b\u63a5\u7d9a\u5143 IP \u306e\u6307\u5b9a\u304c\u5fc5\u8981\u306a\u305f\u3081\u3001Heroku \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e IP \u3092\u56fa\u5b9a\u3059\u308b\u305f\u3081\u306b [Fixie](https://elements.heroku.com/addons/fixie) \u3068\u3044\u3046\u30d7\u30ed\u30ad\u30b7\u3092\u4f7f\u3063\u3066\u5bfe\u5fdc\u3057\u307e\u3059\u3002Fixie \u306f\u6708500\u30ea\u30af\u30a8\u30b9\u30c8\u307e\u3067\u306f\u7121\u6599\u3067\u4f7f\u3048\u307e\u3059\u304c\u3001\u305d\u306e\u5834\u5408\u3067\u3082\u5229\u7528\u6642\u306b\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\u306e\u767b\u9332\u304c\u5fc5\u8981\u306b\u306a\u308b\u306e\u3067\u3054\u6ce8\u610f\u304f\u3060\u3055\u3044\u3002\n\n\u53c2\u8003\uff1a[LINE BOT \u3092\u3068\u308a\u3042\u3048\u305a\u30bf\u30c0\u3067 Heroku \u3067\u52d5\u304b\u3059 - Qiita](http://qiita.com/yuya_takeyama/items/0660a59d13e2cd0b2516) \n\n## hubot-line-example \u306e\u52d5\u4f5c\u624b\u9806\n\n[hubot-line-example](https://github.com/umakoz/hubot-line-example) \u3092 git clone \u3057\u3066\u30ed\u30fc\u30ab\u30eb\u306b\u6301\u3063\u3066\u304d\u307e\u3059\u3002\n\nHeroku \u4e0a\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u306e\u65b9\u6cd5\u3082\u5168\u90e8 [Readme](https://github.com/umakoz/hubot-line-example) \u306b\u66f8\u3044\u3066\u9802\u3044\u3066\u3044\u308b\u306e\u3067\u305d\u306e\u307e\u307e\u5b9f\u65bd\u3057\u307e\u3059\u3002\n\n### Heroku \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u4f5c\u6210\n\n```\n$ heroku apps:create\n```\n\n\uff08\u5fc5\u8981\u304c\u3042\u308c\u3070\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u540d\u306e\u5909\u66f4\u3082\uff09\n\n### Heroku \u306e\u74b0\u5883\u5909\u6570\u8a2d\u5b9a\n\n```\n$ heroku config:add HUBOT_LINE_CHANNEL_ID=\"your_channel_id\"\n$ heroku config:add HUBOT_LINE_CHANNEL_SECRET=\"your_channel_secret\"\n$ heroku config:add HUBOT_LINE_CHANNEL_MID=\"your_channel_mid\"\n```\n\n\u3053\u3053\u306b\u8a2d\u5b9a\u3059\u308b\u5024\u306f\u3001[LINE BUSINESS CENTER](https://business.line.me) \u306e\u300c\u3042\u306a\u305f\u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u300d\u30da\u30fc\u30b8\u306e\u300c\u4f7f\u3046\u300d\u3092\u62bc\u3057\u305f\u5148\u306e [LINE developers](https://developers.line.me/channels/) \u306e\u30da\u30fc\u30b8\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\n\n![LINE_Business_Center.png](https://qiita-image-store.s3.amazonaws.com/0/46167/a797f582-c85d-6c87-5dcf-3cca0cc72249.png \"LINE_Business_Center.png\")\n\n![LINE_developers.png](https://qiita-image-store.s3.amazonaws.com/0/46167/be0d4de7-7071-751e-4a9c-5725287a4d3d.png \"LINE_developers.png\")\n\n\u52d5\u4f5c\u78ba\u8a8d\u7528\u306b\u30ed\u30b0\u30ec\u30d9\u30eb\u3092\u4e0a\u3052\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ heroku config:add HUBOT_LOG_LEVEL=\"debug\"\n```\n\n\u52d5\u4f5c\u30ed\u30b0\u306f `heroku logs --tail` \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002\n\n\u203b \u3061\u306a\u307f\u306b\u3053\u3061\u3089\u306e\u30a2\u30d7\u30ea\u30a2\u30a4\u30b3\u30f3\u306f\u3081\u3057\u4e38\u304f\u3093\u306b\u306a\u308a\u307e\u3059\u3002\u672c Bot \u306f\u500b\u4eba\u7528\u9014\u306b\u9650\u5b9a\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u6a29\u5229\u8005\u306e\u65b9\u3067\u554f\u984c\u7b49\u3042\u308c\u3070\u304a\u77e5\u3089\u305b\u304f\u3060\u3055\u3044\u3002\u798f\u5ca1\u770c\u7523\u7c73\u304a\u3044\u3057\u3044\u3088\uff01\uff08\u30b9\u30c6\u30de\uff09\n\n[\u91d1\u306e\u3081\u3057\u4e38\u304f\u3093\uff5cJA\u5168\u8fb2\u3075\u304f\u308c\u3093 \u3081\u3057\u4e38\u304f\u3093](http://www.meshimaru.com/)\n\n### Heroku \u30a2\u30c9\u30aa\u30f3\u8ffd\u52a0\n\nRedis \u3068 Fixie \u30a2\u30c9\u30aa\u30f3\u3092\u5165\u308c\u307e\u3059\uff08\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f Redis \u306f\u4f7f\u3063\u3066\u3044\u307e\u305b\u3093\u304c\uff09\n\n```\n$ heroku addons:create rediscloud:30\n$ heroku addons:create fixie:tricycle\n```\n\n### LINE BOT \u8a2d\u5b9a\n\nFixie \u8ffd\u52a0\u6642\u306b\u8868\u793a\u3055\u308c\u305f IP \u30a2\u30c9\u30ec\u30b9\u30922\u3064\u3092\u3001 [LINE developers](https://developers.line.me/channels/) \u306e Server IP Whitelist \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff08\u4e0b\u56f3\u306f\u8ffd\u52a0\u5f8c\u306e\u72b6\u614b\uff09\n\n![LINE_developers_WL.png](https://qiita-image-store.s3.amazonaws.com/0/46167/7a73779e-4dce-a25a-170d-bff84cd318bd.png \"LINE_developers_WL.png\")\n\n\u3053\u306e IP \u30a2\u30c9\u30ec\u30b9\u306f Heroku \u306e\u7ba1\u7406\u753b\u9762\u304b\u3089\u8fbf\u308c\u308b Fixie \u306e\u30da\u30fc\u30b8\u304b\u3089\u78ba\u8a8d\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002\n\n\u305d\u3057\u3066\u3001[LINE developers](https://developers.line.me/channels/) \u306e Basic Information \u306e\u4e0b\u306e\u65b9\u306b\u3042\u308b Edit \u30dc\u30bf\u30f3\u304b\u3089\u3053\u306e Heroku \u30a2\u30d7\u30ea\u306e URL \u3092 Callback URL \u306b\u8a2d\u5b9a\u3057\u307e\u3059\u3002\uff08\u3053\u306e Heroku \u30a2\u30d7\u30ea\u306e\u60c5\u5831\u306f `heroku apps:info` \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff09\n\n```\nhttps://your-app-name.herokuapp.com:443/hubot/line/callback\n```\n\n![LINE_developers_BI.png](https://qiita-image-store.s3.amazonaws.com/0/46167/ecc216e5-d44a-419e-5829-ff3b9681952a.png \"LINE_developers_BI.png\")\n\n### hubot-line-example \u8a2d\u5b9a\n\n\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001 `./scripts/line.coffee` \u30d5\u30a1\u30a4\u30eb\u306e\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092\u81ea\u5206\u306e Heroku \u30a2\u30d7\u30ea\u306e URL \u306b\u66f8\u304d\u63db\u3048\u3066\u304a\u304d\u307e\u3059\u3002\uff08\u753b\u50cf\u306a\u3069\u306e\u30d0\u30a4\u30ca\u30ea\u30c7\u30fc\u30bf\u3092\u3084\u308a\u53d6\u308a\u3059\u308b\u305f\u3081\u306e\u8a2d\u5b9a\u3067\u3059\u3002\u4eca\u56de\u306e\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u4f7f\u7528\u3057\u3066\u3044\u307e\u305b\u3093\uff09\n\n```coffeescript:./scripts/line.coffee\ncontentEndpoint = 'https://your-app-name.herokuapp.com:443/download'\n```\n\n### Heroku \u30c7\u30d7\u30ed\u30a4\uff06\u52d5\u4f5c\u78ba\u8a8d\n\n```\n$ git add .\n$ git commit -m 'set contentEndpoint.'\n$ git push heroku master\n```\n\n\uff08remote \u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u4eba\u306f `git remote add heroku https://git.heroku.com/your-app-name.git` \u3092 push \u524d\u306b\u5b9f\u65bd\u3057\u3066\u304f\u3060\u3055\u3044\uff09\n\n\u3042\u3068\u306f\u3001 [LINE developers](https://developers.line.me/channels/) \u306e QR\u30b3\u30fc\u30c9\u304b\u3089\u81ea\u5206\u306e Bot \u3092\u304a\u53cb\u9054\u306b\u8ffd\u52a0\u3057\u3066\u3001`badger` \u3068\u8a71\u3057\u304b\u3051\u305f\u3089\u8fd4\u4e8b\u3092\u3057\u3066\u304f\u308c\u308b\u306f\u305a\u3067\u3059\u3002\n\n![IMG_2047.jpg](https://qiita-image-store.s3.amazonaws.com/0/46167/ba63f408-50e2-6090-5ac1-25fac454a3a9.jpeg \"IMG_2047.jpg\")\n\n\uff08\u30b9\u30bf\u30f3\u30d7\u3084\u4f4d\u7f6e\u60c5\u5831\u3092\u9001\u3063\u3066\u3082\u8fd4\u4e8b\u3092\u3057\u3066\u304f\u308c\u307e\u3059\u304c\u3001\u30b9\u30bf\u30f3\u30d7\u306b\u3064\u3044\u3066\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5165\u3063\u3066\u3044\u308b\u3088\u3046\u306a\u7279\u5b9a\u306e\u30b9\u30bf\u30f3\u30d7\u3057\u304b\u4f7f\u3048\u307e\u305b\u3093\u3002\u4f4d\u7f6e\u60c5\u5831\u306b\u3064\u3044\u3066\u3082\u3001\u30b5\u30f3\u30d7\u30ebbot\u306f\u672c\u6587\u304c\u7a7a\u3060\u3068\u8fd4\u4e8b\u3057\u3066\u304f\u308c\u306a\u3044\u306e\u3067\u3001\u73fe\u5728\u4f4d\u7f6e\u304b\u3089\u52d5\u304b\u3055\u305a\u306b\u4f4f\u6240\u6587\u5b57\u5217\u304c\u9001\u3089\u308c\u308b\u3088\u3046\u306b\u3059\u308c\u3070\u8fd4\u4e8b\u304c\u6765\u307e\u3059\uff09\n\n## \u732e\u7acb\u63d0\u6848Bot\u306e\u5b9f\u88c5\n\n\u524d\u30d5\u30ea\u304c\u9577\u304b\u3063\u305f\u3067\u3059\u304c\u3001\u30b5\u30f3\u30d7\u30eb Bot \u306e\u52d5\u4f5c\u78ba\u8a8d\u304c\u3067\u304d\u305f\u3089\u3001Hubot \u30a2\u30d7\u30ea\u306e\u5b9f\u88c5\u3092\u9032\u3081\u3066\u3044\u304d\u307e\u3059\u3002\uff08Hubot \u30a2\u30d7\u30ea\u306e\u4f5c\u308a\u65b9\u306b\u3064\u3044\u3066\u306f\u3053\u3053\u3067\u306f\u7701\u7565\u3057\u307e\u3059\uff09\n\n\u732e\u7acb\u30c7\u30fc\u30bf\u3092\u3069\u3053\u304b\u3089\u53d6\u3063\u3066\u304f\u308b\u304b\u60a9\u307f\u307e\u3057\u305f\u304c\u3001\u6700\u5927\u624b\u306e[\u30af\u30c3\u30af\u30d1\u30c3\u30c9](http://cookpad.com/)\u3055\u3093\u306f API \u3092\u516c\u958b\u3057\u3066\u3044\u306a\u3044\uff08\uff06[\u30af\u30ed\u30fc\u30e9\u306f\u8ff7\u60d1\u3092\u304b\u3051\u308b](http://techlife.cookpad.com/entry/2015/02/24/161915))\u306e\u3067\u3001[\u697d\u5929\u30ec\u30b7\u30d4](http://recipe.rakuten.co.jp/)\u306e\u691c\u7d22API\u3092\u516c\u958b\u3057\u3066\u304f\u308c\u3066\u3044\u308b[\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9](http://webservice.rakuten.co.jp/)\u3092\u4f7f\u308f\u305b\u3066\u3044\u305f\u3060\u304f\u3053\u3068\u306b\u3057\u307e\u3059\u3002\n\nAPI \u3092\u5229\u7528\u3059\u308b\u305f\u3081\u3001\u4e8b\u524d\u306b\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u5229\u7528\u767b\u9332\u3092\u884c\u3063\u3066\u304a\u3044\u3066\u304f\u3060\u3055\u3044\u3002\n\n[\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9(RAKUTEN WEBSERVICE)](http://webservice.rakuten.co.jp/)\n\n### \u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\n\nHubot \u306e\u5b9f\u88c5\u3067\u3059\u304c\u3001\u697d\u5929\u30ec\u30b7\u30d4\u306e WebService API \u3092\u8abf\u3079\u3066\u3044\u3066\u4ee5\u4e0b\u306e\u6295\u7a3f\u3092\u77e5\u3063\u305f\u306e\u3067\u3001\u3053\u3061\u3089\u306e\u30af\u30ed\u30fc\u30f3\u3092\u4f5c\u3063\u3066\u307f\u3088\u3046\u3068\u601d\u3044\u307e\u3059\u3002\uff08\u8868\u984c\u3082\u3053\u306e\u30a8\u30f3\u30c8\u30ea\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff09\n\n[\u6669\u3054\u306f\u3093\u306e\u732e\u7acb\u3092\u4e00\u7dd2\u306b\u8003\u3048\u3066\u304f\u308c\u308bbot\u3092\u4f5c\u3063\u3066\u307f\u305f - Qiita](http://qiita.com/nwatanabe/items/7b30de9e7402d3589d00)\n\n\u4e0a\u8a18\u30a8\u30f3\u30c8\u30ea\u3067\u306f Slack + Ruboty(Ruby) \u3067\u306e\u5b9f\u88c5\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u3060\u3044\u305f\u3044\u4f3c\u305f\u3088\u3046\u306a\u4f5c\u308a\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u4ee5\u4e0b\u3001\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u3067\u3059\u3002\n\n```coffeescript:./scripts/line.coffee\n{LineRawMessageListener, LineImageListener, LineVideoListener, LineAudioListener, LineLocationListener,\nLineStickerListener, LineContactListener, LineRawOperationListener, LineFriendListener, LineBlockListener,\nLineTextAction, LineImageAction, LineVideoAction, LineAudioAction, LineLocationAction, LineStickerAction\n} = require 'hubot-line'\n\n_ = require 'underscore';\n\napplicationId = process.env.HUBOT_LINE_APPLICATION_ID\n\ncategoryEndpoint = \"/services/api/Recipe/CategoryList/20121121?format=json&formatVersion=2&elements=categoryName%2CcategoryId%2CparentCategoryId&categoryType=medium&applicationId=#{applicationId}\"\nrecipeEndpoint = (categoryId) -> \"/services/api/Recipe/CategoryRanking/20121121?format=json&formatVersion=2&categoryId=#{categoryId}&applicationId=#{applicationId}\"\n\ncategoryMap = {}\n\nmodule.exports = (robot) ->\n  createCategoryMap(robot)\n\n  robot.respond /(?:(?:\u4eca\u65e5|\u304d\u3087\u3046)(?:\u306f|\u3082)\u3001?)?(.+)/, (msg) ->\n    foodName = msg.match[1].replace(/\u304b\u306a$/, '')\n\n    if foodName?.match(/(\u4f55|\u306a\u3093)\u3067\u3082\u3044\u3044/)\n      categoryId = categoryMap[_.sample(Object.keys(categoryMap))]\n      callRecipeServiceApi msg, recipeEndpoint(categoryId), (results) ->\n        recipe = _.sample(results)\n        msg.send recommendRecipe(foodName, \"\u306a\u3089\", recipe)\n\n    else if categoryMap[foodName]?\n      categoryId = categoryMap[foodName]\n      callRecipeServiceApi msg, recipeEndpoint(categoryId), (results) ->\n        recipe = _.sample(results)\n        msg.send recommendRecipe(foodName, \"\u3060\u3068\", recipe)\n    else\n      msg.send recommendFood(categoryMap, foodName)\n\ncreateCategoryMap = (robot) ->\n  callRecipeServiceApi robot, categoryEndpoint, (results) ->\n    for cat in results.medium\n      categoryMap[cat.categoryName] = \"#{cat.parentCategoryId}-#{cat.categoryId}\"\n    console.log(\"category: #{JSON.stringify(categoryMap)}\")\n\ncallRecipeServiceApi = (robot, apiPath, callback) ->\n  robot.http(\"https://app.rakuten.co.jp\" + apiPath)\n    .header('Accept', 'application/json')\n    .get() (err, res, body) ->\n      if err\n        if res.statusCode is 503\n          robot.send \"\u4eca\u3061\u3087\u3063\u3068\u5fd9\u3057\u3044\u307f\u305f\u3044\u3002\u307e\u305f\u3042\u3068\u3067\u8a71\u3057\u304b\u3051\u3066\u307f\u3066\u306d\"\n        else\n          robot.send \"\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u304b\u3063\u305f\u307f\u305f\u3044\u3002\u3054\u3081\u3093\u306d\\n(ERROR: #{err} (#{res.statusCode}))\"\n        console.log \"Error Occurred: #{res.statusCode}: #{err}\"\n        return\n      if res.statusCode isnt 200\n        robot.send \"\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u306a\u304b\u3063\u305f\u307f\u305f\u3044\u3002\u3054\u3081\u3093\u306d\\n(STATUS: #{res.statusCode})\"\n        console.log \"Bad Response: #{res.statusCode}: #{body}\"\n        return\n\n      return callback(JSON.parse(body).result)\n\nrecommendRecipe = (foodName, phrase, recipe) ->\n  \"\"\"\n  #{foodName}#{phrase}\u3001#{recipe.recipeTitle} \u3068\u304b\u306f\u3069\u3046\uff1f\n  #{recipe.recipeUrl}\n  \"\"\"\n\nrecommendFood = (categoryMap, foodName) ->\n  matchCat = Object.keys(categoryMap).filter((cat) ->\n    cat.match(foodName))\n\n  if not matchCat? or matchCat.length is 0\n    return \"#{foodName} \u3060\u3068\u308f\u304b\u3089\u306a\u3044\u304b\u3089\u3082\u3046\u3061\u3087\u3063\u3068\u8a73\u3057\u304f\u6559\u3048\u3066\"\n  else if matchCat.length is 1\n    return \"#{foodName}\u3063\u3066\u3001#{matchCat[0]} \u306e\u3053\u3068\uff1f\"\n  else\n    return \"#{foodName}\u3063\u3066\u3001#{matchCat.join(\"\u3001\")} \u306e\u3069\u308c\u306e\u3053\u3068\uff1f\"\n```\n\n### \u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u8ffd\u52a0\n\n\u4e0a\u8a18\u30bd\u30fc\u30b9\u3067\u5229\u7528\u3057\u3066\u3044\u308b\u30e9\u30a4\u30d6\u30e9\u30ea\u3092 package.json \u306b\u8ffd\u52a0\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ npm install --save underscore\n```\n\n### \u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u306e\u78ba\u8a8d\uff06\u8a2d\u5b9a\n\n[\u697d\u5929\u30a6\u30a7\u30d6\u30b5\u30fc\u30d3\u30b9: \u30a2\u30d7\u30ea\u4e00\u89a7](https://webservice.rakuten.co.jp/app/list) \u304b\u3089\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u3092\u30b3\u30d4\u30fc\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n![rakuten_webservice.png](https://qiita-image-store.s3.amazonaws.com/0/46167/952acb34-eae2-8521-6fc8-f2ea16ebbd18.png \"rakuten_webservice.png\")\n\n### Hubot \u306e\u30ed\u30fc\u30ab\u30eb\u30c6\u30b9\u30c8\n\n\u4e0a\u8a18\u5b9f\u88c5\u3067\u306f HUBOT_LINE_APPLICATION_ID \u3068\u3044\u3046\u74b0\u5883\u5909\u6570\u3092\u4f7f\u3063\u3066\u3044\u308b\u306e\u3067\u3001\u30b3\u30d4\u30fc\u3057\u305f\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3ID\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ export HUBOT_LINE_APPLICATION_ID=XXXXXXXXXXXXXXXXXXX\n$ bin/hubot\n> \u304d\u3087\u3046\u306f\u30b9\u30c6\u30fc\u30ad\u304b\u306a\n> \u30b9\u30c6\u30fc\u30ad\u3060\u3068\u3001\u30d0\u30eb\u30b5\u30df\u30b3\u91a4\u6cb9\u30bd\u30fc\u30b9 de \u7d76\u54c1\u30dd\u30fc\u30af\u30bd\u30c6\u30fc \u3068\u304b\u306f\u3069\u3046\uff1f\nhttp://recipe.rakuten.co.jp/recipe/1570007081/\n```\n\n### Heroku \u30c7\u30d7\u30ed\u30a4\uff06\u52d5\u4f5c\u78ba\u8a8d\n\nHeroku \u5074\u306b\u3082\u74b0\u5883\u5909\u6570\u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304d\u307e\u3059\u3002\n\n```\n$ heroku config:add HUBOT_LINE_APPLICATION_ID=\"XXXXXXXXXXXXXXXXXXX\"\n$ git add .\n$ git commit -m 'Change hubot logic to use Rakuten recipe API'\n$ git push heroku master\n```\n\n![IMG_2046.jpg](https://qiita-image-store.s3.amazonaws.com/0/46167/0cdd9df9-13f5-74c3-f7a6-2762bb92d77a.jpeg \"IMG_2046.jpg\")\n\n## \u611f\u60f3\n\nHeroku \u3082 Hubot \u3082 CoffeeScript \u3082\u6163\u308c\u3066\u306f\u3044\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001hubot-line \u3068 hubot-line-example \u306e\u304a\u304b\u3052\u3067\u7c21\u5358\u306b LINE BOT \u3092\u4f5c\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3057\u305f\u3002\uff08\u4f5c\u8005\u306e @umakoz \u3055\u3093\u3042\u308a\u304c\u3068\u3046\u3054\u3056\u3044\u307e\u3059\uff09\n\n\u73fe\u5728\u3001Trial Account \u3067\u3082[\u7533\u8acb](https://feedback.line.me/enquete/public/915-RRUi5HII)\u3059\u308c\u3070\u6700\u59275000\u4eba\u307e\u3067\u304a\u53cb\u9054\u767b\u9332\u304c\u3067\u304d\u308b\u3068\u3044\u3046\u3053\u3068\u306a\u306e\u3067\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\u306f50\u4eba\uff09\u3001\u500b\u4eba\u3067\u3082\u8272\u3005\u9762\u767d\u3044\u4f7f\u3044\u65b9\u304c\u3067\u304d\u308b\u3093\u3058\u3083\u306a\u3044\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u3061\u306a\u307f\u306b\u3001\u3082\u3068\u3082\u3068\u306f\u5bb6\u65cf\u306e\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b Bot \u3092\u4f4f\u307e\u308f\u305b\u3088\u3046\u3068\u3057\u305f\u306e\u3067\u3059\u304c\uff08\u7ffb\u8a33 Bot \u306e\u3088\u3046\u306b\uff09\u3001\u73fe\u5728\u516c\u958b\u3055\u308c\u3066\u3044\u308b LINE BOT API \u306e\u30a2\u30ab\u30a6\u30f3\u30c8\u3067\u306f\u30b0\u30eb\u30fc\u30d7\u30c1\u30e3\u30c3\u30c8\u306b\u8ffd\u52a0\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u3001\u5bb6\u65cf\u3067\u306e\u4f7f\u3044\u65b9\u306b\u3064\u3044\u3066\u306f\u3061\u3087\u3063\u3068\u8003\u3048\u4e2d\u3067\u3059\u3002\n\n\u307e\u305f\u3001\u672b\u5c3e\u306b URL \u3092\u66f8\u3044\u3066\u3044\u3066\u3082\u30b5\u30e0\u30cd\u30a4\u30eb\u304c\u52dd\u624b\u306b\u306f\u8868\u793a\u3055\u308c\u306a\u3044\u307f\u305f\u3044\u306a\u306e\u3067\u305d\u306e\u8fba\u308a\u306f\u6539\u826f\u3057\u3088\u3046\u304b\u306a\u3068\u601d\u3063\u3066\u3044\u307e\u3059\u3002\n\n\u306a\u304a\u3001\u672c\u30b5\u30f3\u30d7\u30eb\u30bd\u30fc\u30b9\u306f hubot-line-example \u3068\u540c\u3058\u304f\u5b9f\u904b\u7528\u3092\u60f3\u5b9a\u3057\u3066\u3044\u306a\u3044\u306e\u3067\u3001\u4e0d\u7279\u5b9a\u591a\u6570\u306b\u516c\u958b\u3059\u308b\u5834\u5408\u306b\u306f\u5225\u9014\u69cb\u6210\u3092\u3054\u691c\u8a0e\u304f\u3060\u3055\u3044\u3002\n\n\u53c2\u8003\uff1a[\u5927\u91cf\u30e1\u30c3\u30bb\u30fc\u30b8\u304c\u6765\u3066\u3082\u5b89\u5fc3\u306aLINE BOT\u30b5\u30fc\u30d0\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 - Qiita](http://qiita.com/yoichiro@github/items/6d4c7309210af20a5c8f)\n\n\u305d\u308c\u3067\u306f\u7d20\u6575\u306aBOT LIFE\u3092\uff01\n", "tags": ["linebot", "bot", "Hubot", "Heroku", "Line"]}