{"context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u30c6\u30b9\u30c8\u7d42\u4e86\u6642\u306b\u753b\u9762\u306b\u30b5\u30fc\u30d0\u6bce\u306e\u6210\u529f\u6570\uff0f\u5931\u6557\u6570\u3092\u8868\u793a\u3057\u305f\u304f\u306a\u3063\u305f\u306e\u3067\u5bfe\u5fdc\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nexample\u306e\u884c\u3092\u96c6\u8a08\u3059\u308b\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u6700\u5f8c\u306b\u8868\u793a\u3057\u307e\u3059\u3002\nPS C:\\serverspec\\sample> rake\n\n\uff08\u7701\u7565\uff1aServerspec\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u51fa\u529b\uff09\n\n##################################################\nSUMMARY\n##################################################\nDEV-WEB01 : CASE=132 / OK=132 / NG=0\nDEV-WEB02 : CASE=132 / OK=132 / NG=0\nSTG-WEB01 : CASE=128 / OK=128 / NG=0\nSTG-WEB02 : CASE=128 / OK=128 / NG=0\nDEV-DB01 : CASE=91 / OK=91 / NG=0\nDEV-DB02 : CASE=91 / OK=91 / NG=0\nSTG-DB01 : CASE=91 / OK=91 / NG=0\nSTG-DB02 : CASE=91 / OK=91 / NG=0\nTOTAL=884 / OK=884 / NG=0\n##################################################\n\nPS C:\\serverspec\\sample>\n\n\n\u96c6\u8a08\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n$TEST_HOME\\sample\\lib\\sum.awk\n# \u524d\u51e6\u7406\nBEGIN {\n    num_ng = 0\n    sum = 0\n    target = \"\"\n}\n# \u30db\u30b9\u30c8\u540d\u306e\u5224\u5b9a\n/^HOST: / {\n    target = $2\n}\n# \u30ab\u30a6\u30f3\u30c8\n/examples,.*failure/ {\n    num_ng += $3\n    sum += $1\n    printf(\"%s : CASE=%s / OK=%s / NG=%s\\n\", target, $1, $1 - $3, $3)\n}\n# \u5f8c\u51e6\u7406\nEND {\n    printf(\"TOTAL=%s / OK=%s / NG=%s\\n\", sum, sum - num_ng, num_ng)\n}\n\n\n\nspec_helper.rb\u306e\u4fee\u6b63\n\u4e0a\u8ff0\u306eawk\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30db\u30b9\u30c8\u540d\u3067\u96c6\u8a08\u3067\u304d\u308b\u3088\u3046\u306b\u300cspec_helper.rb\u300d\u3067\u300cHOST: \u30db\u30b9\u30c8\u540d\u300d\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\nC\uff1a\\serverspec\\sample\\spec\\spec_helper.rb\nrequire 'serverspec'\n#\uff08\u7701\u7565\uff09\nparams['hostname'] = ENV['TARGET_HOST']\nputs \"\"\nputs \"##################################################\"\nputs \"HOST: #{params['hostname']} : #{params['run_env']}\"\nputs \"##################################################\"\n#\uff08\u7701\u7565\uff09\n\n\n\nWindows\u306e\u5834\u5408\uff1a\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\u203b\u4e8b\u524d\u306blog\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u203bcat\u3084tee\u306a\u3069\u300cGow\u300d\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n$TEST_HOME\\sample\\ExecTest.cmd\n@ECHO OFF\n:: Serverspec\nSET PATH_D_SCR=%~dp0\nSET PATH_D_SCR=%PATH_D_SCR:~0,-1%\nSET YYYYMMDD=%DATE:~-10,4%%DATE:~-5,2%%DATE:~-2,2%\nSET TIME_HMMSS=%TIME: =0%\nSET HHMMSS=%TIME_HMMSS:~0,2%%TIME_HMMSS:~3,2%%TIME_HMMSS:~6,2%\nSET PATH_F_LOG=%PATH_D_SCR%\\log\\Result.%YYYYMMDD%.%HHMMSS%.log\nSET PATH_F_SUM=%PATH_D_SCR%\\log\\Summary.%YYYYMMDD%.%HHMMSS%.txt\nSET PATH_D_GOW=C:\\Tool\\Gow\\bin\nECHO.\nECHO PATH_D_SCR = %PATH_D_SCR%\nECHO YYYYMMDD   = %YYYYMMDD%\nECHO HHMMSS     = %HHMMSS%\nECHO PATH_F_LOG = %PATH_F_LOG%\nECHO.\ncd %PATH_D_SCR%\nruby -e \"puts Time.now.to_i\"  | %PATH_D_GOW%\\tee.exe %PATH_F_LOG%\nrake | %PATH_D_GOW%\\tee.exe -a %PATH_F_LOG%\nruby -e \"puts Time.now.to_i\"  | %PATH_D_GOW%\\tee.exe -a %PATH_F_LOG%\nECHO.\nECHO.\nECHO ############################################################\nECHO SUMMARY\nECHO ############################################################\n%PATH_D_GOW%\\cat.exe %PATH_F_LOG% | %PATH_D_GOW%\\awk.exe -f %PATH_D_SCR%\\lib\\sum.awk | %PATH_D_GOW%\\tee.exe %PATH_F_SUM%\nECHO.\nECHO ############################################################\n\n\n\nLinux\u306e\u5834\u5408\uff1a\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\u203b\u4e8b\u524d\u306blog\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n$TEST_HOME/sample/ExecTest.sh\n#!/bin/sh\nNOW=`date '+%Y%m%d.%H%M%S'`\nPATH_D_SH=\"$(cd $(dirname $0) && pwd)\"\nPATH_F_LOG=\"${PATH_D_SH}/log/serverspec.${NOW}.log\"\nPATH_F_SUM=\"${PATH_D_SH}/log/summry.${NOW}.txt\"\ncd \"${PATH_D_SH}\"\nNOW_UNIXTIME=`ruby -e \"puts Time.now.to_i\"`\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"# START : ${NOW} ${NOW_UNIXTIME}\" | tee -a ${PATH_F_LOG}\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\nrake | tee -a ${PATH_F_LOG}\ncd \"${PATH_D_SH}\"\nNOW_UNIXTIME=`ruby -e \"puts Time.now.to_i\"`\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"# E N D : ${NOW} ${NOW_UNIXTIME}\" | tee -a ${PATH_F_LOG}\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"\"\necho \"\"\necho \"#----------------------------------------------------------------------\"\necho \"# SUMMRY\"\necho \"#----------------------------------------------------------------------\"\ncat ${PATH_F_LOG} | awk -f ./lib/sum.awk | tee ${PATH_F_SUM}\necho \"#----------------------------------------------------------------------\"\nexit 0\n\n\n# \u306f\u3058\u3081\u306b\n\n\u30c6\u30b9\u30c8\u7d42\u4e86\u6642\u306b\u753b\u9762\u306b\u30b5\u30fc\u30d0\u6bce\u306e\u6210\u529f\u6570\uff0f\u5931\u6557\u6570\u3092\u8868\u793a\u3057\u305f\u304f\u306a\u3063\u305f\u306e\u3067\u5bfe\u5fdc\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\nexample\u306e\u884c\u3092\u96c6\u8a08\u3059\u308b\u3060\u3051\u3067\u3059\u304c\u3001\u3053\u3093\u306a\u611f\u3058\u3067\u6700\u5f8c\u306b\u8868\u793a\u3057\u307e\u3059\u3002\n\n```serverspec\nPS C:\\serverspec\\sample> rake\n\n\uff08\u7701\u7565\uff1aServerspec\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u51fa\u529b\uff09\n\n##################################################\nSUMMARY\n##################################################\nDEV-WEB01 : CASE=132 / OK=132 / NG=0\nDEV-WEB02 : CASE=132 / OK=132 / NG=0\nSTG-WEB01 : CASE=128 / OK=128 / NG=0\nSTG-WEB02 : CASE=128 / OK=128 / NG=0\nDEV-DB01 : CASE=91 / OK=91 / NG=0\nDEV-DB02 : CASE=91 / OK=91 / NG=0\nSTG-DB01 : CASE=91 / OK=91 / NG=0\nSTG-DB02 : CASE=91 / OK=91 / NG=0\nTOTAL=884 / OK=884 / NG=0\n##################################################\n\nPS C:\\serverspec\\sample>\n```\n\n# \u96c6\u8a08\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n```awk:$TEST_HOME\\sample\\lib\\sum.awk\n# \u524d\u51e6\u7406\nBEGIN {\n    num_ng = 0\n    sum = 0\n    target = \"\"\n}\n# \u30db\u30b9\u30c8\u540d\u306e\u5224\u5b9a\n/^HOST: / {\n    target = $2\n}\n# \u30ab\u30a6\u30f3\u30c8\n/examples,.*failure/ {\n    num_ng += $3\n    sum += $1\n    printf(\"%s : CASE=%s / OK=%s / NG=%s\\n\", target, $1, $1 - $3, $3)\n}\n# \u5f8c\u51e6\u7406\nEND {\n    printf(\"TOTAL=%s / OK=%s / NG=%s\\n\", sum, sum - num_ng, num_ng)\n}\n```\n\n# spec_helper.rb\u306e\u4fee\u6b63\n\n\u4e0a\u8ff0\u306eawk\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u30db\u30b9\u30c8\u540d\u3067\u96c6\u8a08\u3067\u304d\u308b\u3088\u3046\u306b\u300cspec_helper.rb\u300d\u3067\u300cHOST: \u30db\u30b9\u30c8\u540d\u300d\u3092\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\n\n```ruby:C\uff1a\\serverspec\\sample\\spec\\spec_helper.rb\nrequire 'serverspec'\n#\uff08\u7701\u7565\uff09\nparams['hostname'] = ENV['TARGET_HOST']\nputs \"\"\nputs \"##################################################\"\nputs \"HOST: #{params['hostname']} : #{params['run_env']}\"\nputs \"##################################################\"\n#\uff08\u7701\u7565\uff09\n```\n\n\n# Windows\u306e\u5834\u5408\uff1a\u30d0\u30c3\u30c1\u30d5\u30a1\u30a4\u30eb\u306e\u4f5c\u6210\n\n\u203b\u4e8b\u524d\u306blog\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u304c\u5fc5\u8981\u3067\u3059\u3002\n\u203bcat\u3084tee\u306a\u3069\u300cGow\u300d\u3092\u4f7f\u3063\u3066\u3044\u307e\u3059\u306e\u3067\u3042\u3089\u304b\u3058\u3081\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```bat:$TEST_HOME\\sample\\ExecTest.cmd\n@ECHO OFF\n:: Serverspec\nSET PATH_D_SCR=%~dp0\nSET PATH_D_SCR=%PATH_D_SCR:~0,-1%\nSET YYYYMMDD=%DATE:~-10,4%%DATE:~-5,2%%DATE:~-2,2%\nSET TIME_HMMSS=%TIME: =0%\nSET HHMMSS=%TIME_HMMSS:~0,2%%TIME_HMMSS:~3,2%%TIME_HMMSS:~6,2%\nSET PATH_F_LOG=%PATH_D_SCR%\\log\\Result.%YYYYMMDD%.%HHMMSS%.log\nSET PATH_F_SUM=%PATH_D_SCR%\\log\\Summary.%YYYYMMDD%.%HHMMSS%.txt\nSET PATH_D_GOW=C:\\Tool\\Gow\\bin\nECHO.\nECHO PATH_D_SCR = %PATH_D_SCR%\nECHO YYYYMMDD   = %YYYYMMDD%\nECHO HHMMSS     = %HHMMSS%\nECHO PATH_F_LOG = %PATH_F_LOG%\nECHO.\ncd %PATH_D_SCR%\nruby -e \"puts Time.now.to_i\"  | %PATH_D_GOW%\\tee.exe %PATH_F_LOG%\nrake | %PATH_D_GOW%\\tee.exe -a %PATH_F_LOG%\nruby -e \"puts Time.now.to_i\"  | %PATH_D_GOW%\\tee.exe -a %PATH_F_LOG%\nECHO.\nECHO.\nECHO ############################################################\nECHO SUMMARY\nECHO ############################################################\n%PATH_D_GOW%\\cat.exe %PATH_F_LOG% | %PATH_D_GOW%\\awk.exe -f %PATH_D_SCR%\\lib\\sum.awk | %PATH_D_GOW%\\tee.exe %PATH_F_SUM%\nECHO.\nECHO ############################################################\n```\n\n# Linux\u306e\u5834\u5408\uff1a\u30b7\u30a7\u30eb\u30b9\u30af\u30ea\u30d7\u30c8\u306e\u4f5c\u6210\n\n\u203b\u4e8b\u524d\u306blog\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u4f5c\u6210\u304c\u5fc5\u8981\u3067\u3059\u3002\n\n```bash:$TEST_HOME/sample/ExecTest.sh\n#!/bin/sh\nNOW=`date '+%Y%m%d.%H%M%S'`\nPATH_D_SH=\"$(cd $(dirname $0) && pwd)\"\nPATH_F_LOG=\"${PATH_D_SH}/log/serverspec.${NOW}.log\"\nPATH_F_SUM=\"${PATH_D_SH}/log/summry.${NOW}.txt\"\ncd \"${PATH_D_SH}\"\nNOW_UNIXTIME=`ruby -e \"puts Time.now.to_i\"`\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"# START : ${NOW} ${NOW_UNIXTIME}\" | tee -a ${PATH_F_LOG}\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\nrake | tee -a ${PATH_F_LOG}\ncd \"${PATH_D_SH}\"\nNOW_UNIXTIME=`ruby -e \"puts Time.now.to_i\"`\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"# E N D : ${NOW} ${NOW_UNIXTIME}\" | tee -a ${PATH_F_LOG}\necho \"#----------------------------------------------------------------------\" | tee -a ${PATH_F_LOG}\necho \"\"\necho \"\"\necho \"#----------------------------------------------------------------------\"\necho \"# SUMMRY\"\necho \"#----------------------------------------------------------------------\"\ncat ${PATH_F_LOG} | awk -f ./lib/sum.awk | tee ${PATH_F_SUM}\necho \"#----------------------------------------------------------------------\"\nexit 0\n```\n", "tags": ["serverspec", "Ruby", "bat", "Windows"]}