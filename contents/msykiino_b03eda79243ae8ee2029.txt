{"context": " More than 1 year has passed since last update.\n\nGoAccess\u3068\u306f\nGoAccess\u306f\u3001CLI\u3067\u52d5\u4f5c\u3059\u308b\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\u3067\u3059\u3002\nhtop\u3092\u773a\u3081\u308b\u611f\u899a\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30ed\u30b0\u89e3\u6790\u304c\u3067\u304d\u307e\u3059\u3002\n\nGoAccess\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u89e3\u6790\u3059\u308b \u3067\u3088\u308a\u5206\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u80cc\u666f\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u3068\u3044\u3048\u3070\u3001\u3044\u307e\u3069\u304d\u306f fluentd + elasticsearch + kibana3 \u306e\u3088\u3046\u306a\u69cb\u6210\u304c\u4e3b\u6d41\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u7c21\u5358\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3046\u3048\u3001\u898b\u305f\u76ee\u306b\u3082\u304d\u308c\u3044\u3067\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u304b\u3089\u306d\u3002\nfluentd + elasticsearch + kibana3 \u306e\u69cb\u6210\u3092\u7d44\u3080\u5834\u5408\u3001\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068 fluentd \u3067\u30d1\u30fc\u30b9\u3059\u308b\u3068\u304d\u306b\u96e3\u89e3\u306a\u6b63\u898f\u8868\u73fe\u3092\u66f8\u304f\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u3060\u3068GoAccess\u3067\u30d1\u30fc\u30b9\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067 fluentd + elasticsearch + kibana3 \u306e\u69cb\u6210\u3092\u7d44\u307f\u3064\u3064\u3001GoAccess\u3067\u3082\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n\u5c0e\u5165\n\u65e9\u901f\u3001GoAccess\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u3087\u3046\u3002\n\n\u74b0\u5883\n\nDigitalOcean\nCentOS6.5 x86_64\nnginx 1.4.3\ngoaccess 0.7.1\n\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08RHEL)\nGoAccess\u306f yum \u306b epel \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308c\u3070\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\nsudo yum --enablerepo=epel -y install goaccess\n\nsrc\u304b\u3089\u30d3\u30eb\u30c9\u3057\u305f\u3044\u5834\u5408\u306f \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n\n\u8a2d\u5b9a\n\nnginx\nnginx.conf\u306bLTSV\u5f62\u5f0f\u3067\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u305f\u3081\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n/etc/nginx/nginx.conf\n\nlog_format  ltsv  \"host:$remote_addr\"\n                  \"\\tuser:$remote_user\"\n                  \"\\ttime:$time_local\"\n                  \"\\treq:$request\"\n                  \"\\tstatus:$status\"\n                  \"\\tsize:$body_bytes_sent\"\n                  \"\\treferer:$http_referer\"\n                  \"\\tua:$http_user_agent\"\n                  \"\\tforwardedfor:$http_x_forwarded_for\"\n                  \"\\treqtime:$request_time\"\n                  \"\\tapptime:$upstream_response_time\";\n\n\n\nnginx.conf\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3089\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n/etc/nginx/conf.d/ap.conf\n\naccess_log  /var/log/nginx/ap.access.log  ltsv;\n\n\n\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089nginx\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nsudo /bin/bash -c \"service nginx configtest && service nginx reload\"\n\n\napache\napache\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092LogFormat\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\uff08\u6700\u5f8c\u306eapptime\u306e\u9805\u76ee\u306f\u4fbf\u5b9c\u4e0anginx\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u63c3\u3048\u308b\u305f\u3081\u306e\u30c0\u30df\u30fc\u3067\u3059\uff09\n\n/etc/httpd/conf/httpd.conf\n\nLogFormat \"\\\nhost:%h\\\n\\tuser:%u\\\n\\ttime:%t\\\n\\ttime:%{%d/%b/%Y:%T %z}t\\\n\\treq:%r\\\n\\tstatus:%>s\\\n\\tsize:%b\\\n\\treferer:%{Referer}i\\\n\\tua:%{User-Agent}i\\\n\\tforwardedfor:%{X-Forwarded-For}i\\\n\\treqtime:%D\\\n\\tapptime:%D\" ltsv\n\n\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3089\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n/etc/httpd/conf.d/ap.conf\n\nCustomLog logs/access_log ltsv\n\n\n\nnginx\u540c\u69d8\u3001\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089apache\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\nsudo /bin/bash -c \"service httpd configtest && service httpd reload\"\n\n\nGoAccess\nLTSV\u5f62\u5f0f\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nnginx\u7528\n\n/etc/goaccess/ltsv.nginx\n\ncolor_scheme 2\ndate_format %d/%b/%Y:%T %z\nlog_format host:%h\\tuser:%^\\ttime:%d\\treq:%r\\tstatus:%s\\tsize:%b\\treferer:%R\\tua:%u\\tforwardedfor:%^\\treqtime:%T\\tapptime:%^\n\n\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/var/log/nginx/ap.access.log\n\nhost:192.168.1.23     user:-     time:18/Mar/2014:04:46:39 +0000     req:GET /fonts/fontawesome-webfont.woff?v=4.0.3 HTTP/1.1     status:200     size:44432     referer:https://example.com/invitation     ua:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36     forwardedfor:192.168.1.23     reqtime:0.006     apptime:0.006\n\n\n\n\napache\u7528\n\n/etc/goaccess/ltsv.httpd\n\ncolor_scheme 2\ndate_format %d/%b/%Y:%T %z\nlog_format host:%h\\tuser:%^\\ttime:%d\\treq:%r\\tstatus:%s\\tsize:%b\\treferer:%R\\tua:%u\\tforwardedfor:%^\\treqtime:%D\\tapptime:%^\n\n\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/var/log/httpd/ap.access.log\n\nhost:192.168.1.23     user:-     time:18/Mar/2014:04:46:39 +0900    req:GET /fonts/fontawesome-webfont.woff?v=4.0.3 HTTP/1.1    status:200  size:7149   referer:-   ua:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)   forwardedfor:-  reqtime:435959  apptime:435965\n\n\n\n\n\u4f7f\u3044\u65b9\n\u4f7f\u3044\u65b9\u306f\u3068\u3066\u3082\u7c21\u5358\u3001\u89e3\u6790\u3057\u305f\u3044\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb \u3068 \u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u3092\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u3059\u3002\ngoaccess -f /var/log/nginx/ap.access.log -p /etc/goaccess/ltsv.nginx\n\n\n\u304a\u307e\u3051\n\u4e0a\u8a18\u306e\u4f7f\u3044\u65b9\u3067\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u6bce\u306e\u30a2\u30af\u30bb\u30b9\u89e3\u6790\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\n\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u304c\u8907\u6570\u53f0\u3042\u308c\u3070 fluentd \u3067\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u306b\u96c6\u7d04\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001fluentd \u304c\u96c6\u7d04\u3057\u3066\u3044\u308b\u6700\u4e2d\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3082\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\ntd-agent\n\n\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u8a2d\u5b9a\n\n/etc/td-agent/conf.d/nginx.conf\n\n# input\n<source>\n  type         tail\n  format       ltsv\n  path         /var/log/nginx/ap.access.log\n  pos_file     /var/log/td-agent/nginx.ap.access.log.pos\n  time_format  %d/%b/%Y:%H:%M:%S %z\n  tag          nginx.ap.access.log\n</source>\n\n# output\n<match nginx.ap.access.log>\n  type               forward\n  send_timeout       60s\n  recover_wait       60s\n  heartbeat_interval 1s\n  phi_threshold      8\n  hard_timeout       60s\n\n  <server>\n    name   logme\n    host   192.168.1.45\n    port   24224\n    weight 60\n  </server>\n</match>\n\n\n\n\n\u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u8a2d\u5b9a\nfluent-plugin-typecast\u3067\u7279\u5b9a\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6570\u5024\u306b\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\n/etc/td-agent/conf.d/nginx.conf\n\n# input\n<source>\n  type forward\n  port 24224\n  bind 0.0.0.0\n</source>\n\n# output\n<match nginx.ap.access.log>\n  type        typecast\n  item_types  time:time,status:integer,size:integer,reqtime:float,apptime:float\n  time_format %d/%b/%Y:%H:%M:%S %z\n  prefix      cast\n</match>\n\n<match cast.nginx.ap.access.log>\n  type              file\n  path              /var/log/td-agent/ap.access.log\n  time_slice_format %Y%m%d\n  time_slice_wait   5m\n  compress          gzip\n</match>\n\n\n\n\u5404\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u306b\u96c6\u7d04\u3055\u308c\u307e\u3059\u3002\n\n-rw-r--r-- 1 td-agent td-agent  8345  3\u6708 20 00:05 2014 ap.access.log.20140319_0.log.gz\n-rw-r--r-- 1 td-agent td-agent  5490  3\u6708 21 00:05 2014 ap.access.log.20140320_0.log.gz\n-rw-r--r-- 1 td-agent td-agent  5852  3\u6708 21 09:36 2014 ap.access.log.20140321.b4f51468d38e9c1d8\n\n\n\nGoAccess\nfluentd \u304c\u51fa\u529b\u3059\u308b\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\nnginx\u7528\n\n/etc/goaccess/ltsv.fluentd.nginx\n\ncolor_scheme 2\ndate_format %F\nlog_format %dT%^\\t%^\\t{\"host\":\"%h\",\"user\":\"%^\",\"req\":\"%r\",\"status\":%s,\"size\":%b,\"referer\":\"%R\",\"ua\":\"%u\",\"forwardedfor\":\"%^\",\"reqtime\":%T,\"apptime\":%^}\n\n\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/var/log/td-agent/ap.access.log\n\n2014-03-21T04:30:51+00:00     cast.nginx.ap.access.log     {\"host\":\"192.168.1.23\",\"user\":\"-\",\"req\":\"GET /test HTTP/1.1\",\"status\":302,\"size\":0,\"referer\":\"https://example.com/invitation\",\"ua\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\"forwardedfor\":\"192.168.1.23\",\"reqtime\":1.012,\"apptime\":1.012}\n\n\n\n\napache\u7528\n\n/etc/goaccess/ltsv.fluentd.httpd\n\ncolor_scheme 2\ndate_format %F\nlog_format %dT%^\\t%^\\t{\"host\":\"%h\",\"user\":\"%^\",\"req\":\"%r\",\"status\":%s,\"size\":%b,\"referer\":\"%R\",\"ua\":\"%u\",\"forwardedfor\":\"%^\",\"reqtime\":%D,\"apptime\":%^}\n\n\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n/var/log/td-agent/ap.access.log\n\n2014-03-21T04:30:51+00:00     cast.httpd.ap.access.log     {\"host\":\"192.168.1.23\",\"user\":\"-\",\"req\":\"GET /test HTTP/1.1\",\"status\":302,\"size\":0,\"referer\":\"https://example.com/invitation\",\"ua\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\"forwardedfor\":\"192.168.1.23\",\"reqtime\":435959,\"apptime\":435959}\n\n\n\n\n\u4f7f\u3044\u65b9\n\u4f7f\u3044\u65b9\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\ngoaccess -f /var/log/td-agent/ap.access.log.20140321.b4f51468d38e9c1d8 -p /etc/goaccess/ltsv.fluentd.nginx\n\nfluentd \u3067\u96c6\u7d04\u3057\u3066\u3044\u308b\u30ed\u30b0\u3092\u89e3\u6790\u3059\u308b\u5834\u5408\u3001\u89e3\u6790\u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306f fluentd \u306e buffer \u304b\u3089\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b flush \u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u3067\u76f4\u63a5\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u6790\u3057\u3066\u3044\u308b\u5834\u5408\u3068\u6bd4\u3079\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u6027\u306f\u304b\u306a\u308a\u843d\u3061\u307e\u3059\u3002\n\n\u307e\u3068\u3081\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u4f7f\u3044\u65b9\u3082\u3068\u3066\u3082\u7c21\u5358\u3067\u3059\u306d\u3002 tail \u3084 grep \u3067\u5730\u5473\u306b\u30ed\u30b0\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u3044\u3046\u4f5c\u696d\u306b GoAccess \u3067\u89e3\u6790\u3059\u308b\u3068\u3044\u3046\u4e00\u624b\u9593\u3092\u52a0\u3048\u3066\u307f\u308b\u3068\u3044\u3044\u3067\u3059\u3002\n404 \u306b\u306a\u3063\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u3084\u30ed\u30fc\u30c9\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3082\u4e00\u76ee\u77ad\u7136\u306a\u306e\u3067\u958b\u767a\u6642\u304b\u3089\u6d3b\u8e8d\u3057\u3066\u304f\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n\n# GoAccess\u3068\u306f\n\n[GoAccess](http://goaccess.prosoftcorp.com/ \"GoAccess\")\u306f\u3001CLI\u3067\u52d5\u4f5c\u3059\u308b\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u30c4\u30fc\u30eb\u3067\u3059\u3002\n[htop](http://hisham.hm/htop/ \"htop\")\u3092\u773a\u3081\u308b\u611f\u899a\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30ed\u30b0\u89e3\u6790\u304c\u3067\u304d\u307e\u3059\u3002\n\n![goaccess01](https://24.media.tumblr.com/2922d2b50299a8bc678a81b58480fba2/tumblr_n5hi4d6lu81tbcnimo1_500.png)\n\n[GoAccess\u3067\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306b\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u89e3\u6790\u3059\u308b](http://qiita.com/ariarijp/items/0a57996a93b4b4149a88) \u3067\u3088\u308a\u5206\u304b\u308a\u3084\u3059\u304f\u89e3\u8aac\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n# \u80cc\u666f\n\n\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u89e3\u6790\u3068\u3044\u3048\u3070\u3001\u3044\u307e\u3069\u304d\u306f ```fluentd + elasticsearch + kibana3``` \u306e\u3088\u3046\u306a\u69cb\u6210\u304c\u4e3b\u6d41\u3060\u3068\u601d\u3044\u307e\u3059\u3002\u7c21\u5358\u306b\u8a2d\u5b9a\u3067\u304d\u308b\u3046\u3048\u3001\u898b\u305f\u76ee\u306b\u3082\u304d\u308c\u3044\u3067\u5206\u304b\u308a\u3084\u3059\u3044\u3067\u3059\u304b\u3089\u306d\u3002\n\n```fluentd + elasticsearch + kibana3``` \u306e\u69cb\u6210\u3092\u7d44\u3080\u5834\u5408\u3001\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u306e\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u304a\u304f\u3068 ```fluentd``` \u3067\u30d1\u30fc\u30b9\u3059\u308b\u3068\u304d\u306b\u96e3\u89e3\u306a\u6b63\u898f\u8868\u73fe\u3092\u66f8\u304f\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u4fbf\u5229\u306a\u306e\u3067\u3059\u304c\u3001\u305d\u308c\u3060\u3068GoAccess\u3067\u30d1\u30fc\u30b9\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\n\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067 ```fluentd + elasticsearch + kibana3``` \u306e\u69cb\u6210\u3092\u7d44\u307f\u3064\u3064\u3001GoAccess\u3067\u3082\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u305f\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\n# \u5c0e\u5165\n\n\u65e9\u901f\u3001GoAccess\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u307e\u3057\u3087\u3046\u3002\n\n## \u74b0\u5883\n\n* [DigitalOcean](https://www.digitalocean.com/?refcode=1253632a31d5 \"DigitalOcean\")\n* CentOS6.5 x86_64\n* nginx 1.4.3\n* goaccess 0.7.1\n\n## \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\uff08RHEL)\n\nGoAccess\u306f ```yum``` \u306b ```epel``` \u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308c\u3070\u7c21\u5358\u306b\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3067\u304d\u307e\u3059\u3002\n\n```\nsudo yum --enablerepo=epel -y install goaccess\n```\n\nsrc\u304b\u3089\u30d3\u30eb\u30c9\u3057\u305f\u3044\u5834\u5408\u306f [\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8](http://goaccess.prosoftcorp.com/download#installation) \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\n\n# \u8a2d\u5b9a\n\n## nginx\n\nnginx.conf\u306bLTSV\u5f62\u5f0f\u3067\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u305f\u3081\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\n```/etc/nginx/nginx.conf\n\nlog_format  ltsv  \"host:$remote_addr\"\n                  \"\\tuser:$remote_user\"\n                  \"\\ttime:$time_local\"\n                  \"\\treq:$request\"\n                  \"\\tstatus:$status\"\n                  \"\\tsize:$body_bytes_sent\"\n                  \"\\treferer:$http_referer\"\n                  \"\\tua:$http_user_agent\"\n                  \"\\tforwardedfor:$http_x_forwarded_for\"\n                  \"\\treqtime:$request_time\"\n                  \"\\tapptime:$upstream_response_time\";\n\n```\n\nnginx.conf\u306b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3089\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```/etc/nginx/conf.d/ap.conf\n\naccess_log  /var/log/nginx/ap.access.log  ltsv;\n\n```\n\n\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089nginx\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```\nsudo /bin/bash -c \"service nginx configtest && service nginx reload\"\n```\n\n## apache\n\napache\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u306e\u8a2d\u5b9a\u3092LogFormat\u3068\u3057\u3066\u8ffd\u52a0\u3057\u307e\u3059\u3002\n\uff08\u6700\u5f8c\u306eapptime\u306e\u9805\u76ee\u306f\u4fbf\u5b9c\u4e0anginx\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u63c3\u3048\u308b\u305f\u3081\u306e\u30c0\u30df\u30fc\u3067\u3059\uff09\n\n```/etc/httpd/conf/httpd.conf\n\nLogFormat \"\\\nhost:%h\\\n\\tuser:%u\\\n\\ttime:%t\\\n\\ttime:%{%d/%b/%Y:%T %z}t\\\n\\treq:%r\\\n\\tstatus:%>s\\\n\\tsize:%b\\\n\\treferer:%{Referer}i\\\n\\tua:%{User-Agent}i\\\n\\tforwardedfor:%{X-Forwarded-For}i\\\n\\treqtime:%D\\\n\\tapptime:%D\" ltsv\n\n```\n\n\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u305f\u3089\u3001\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092LTSV\u5f62\u5f0f\u3067\u51fa\u529b\u3059\u308b\u3088\u3046\u306b\u5909\u66f4\u3057\u307e\u3059\u3002\n\n```/etc/httpd/conf.d/ap.conf\n\nCustomLog logs/access_log ltsv\n\n```\n\nnginx\u540c\u69d8\u3001\u8a2d\u5b9a\u304c\u7d42\u308f\u3063\u305f\u3089apache\u3092\u30ea\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002\n\n```\nsudo /bin/bash -c \"service httpd configtest && service httpd reload\"\n```\n\n## GoAccess\n\nLTSV\u5f62\u5f0f\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n### nginx\u7528\n\n```/etc/goaccess/ltsv.nginx\n\ncolor_scheme 2\ndate_format %d/%b/%Y:%T %z\nlog_format host:%h\\tuser:%^\\ttime:%d\\treq:%r\\tstatus:%s\\tsize:%b\\treferer:%R\\tua:%u\\tforwardedfor:%^\\treqtime:%T\\tapptime:%^\n\n```\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```/var/log/nginx/ap.access.log\n\nhost:192.168.1.23     user:-     time:18/Mar/2014:04:46:39 +0000     req:GET /fonts/fontawesome-webfont.woff?v=4.0.3 HTTP/1.1     status:200     size:44432     referer:https://example.com/invitation     ua:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36     forwardedfor:192.168.1.23     reqtime:0.006     apptime:0.006\n\n```\n\n### apache\u7528\n\n```/etc/goaccess/ltsv.httpd\n\ncolor_scheme 2\ndate_format %d/%b/%Y:%T %z\nlog_format host:%h\\tuser:%^\\ttime:%d\\treq:%r\\tstatus:%s\\tsize:%b\\treferer:%R\\tua:%u\\tforwardedfor:%^\\treqtime:%D\\tapptime:%^\n\n```\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```/var/log/httpd/ap.access.log\n\nhost:192.168.1.23     user:-     time:18/Mar/2014:04:46:39 +0900\treq:GET /fonts/fontawesome-webfont.woff?v=4.0.3\tHTTP/1.1\tstatus:200\tsize:7149\treferer:-\tua:Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\tforwardedfor:-\treqtime:435959\tapptime:435965\n\n```\n\n# \u4f7f\u3044\u65b9\n\n\u4f7f\u3044\u65b9\u306f\u3068\u3066\u3082\u7c21\u5358\u3001```\u89e3\u6790\u3057\u305f\u3044\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb``` \u3068 ```\u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8``` \u3092\u6307\u5b9a\u3059\u308b\u3060\u3051\u3067\u3059\u3002\n\n```usage\ngoaccess -f /var/log/nginx/ap.access.log -p /etc/goaccess/ltsv.nginx\n```\n\n# \u304a\u307e\u3051\n\n\u4e0a\u8a18\u306e\u4f7f\u3044\u65b9\u3067\u306f\u3001\u30b5\u30fc\u30d0\u30fc\u6bce\u306e\u30a2\u30af\u30bb\u30b9\u89e3\u6790\u3057\u304b\u3067\u304d\u307e\u305b\u3093\u3002\n\n\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u304c\u8907\u6570\u53f0\u3042\u308c\u3070 ```fluentd``` \u3067\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3092\u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u306b\u96c6\u7d04\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u591a\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u305b\u3063\u304b\u304f\u306a\u306e\u3067\u3001```fluentd``` \u304c\u96c6\u7d04\u3057\u3066\u3044\u308b\u6700\u4e2d\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u3082\u89e3\u6790\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## td-agent\n\n### \u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u8a2d\u5b9a\n\n```/etc/td-agent/conf.d/nginx.conf\n\n# input\n<source>\n  type         tail\n  format       ltsv\n  path         /var/log/nginx/ap.access.log\n  pos_file     /var/log/td-agent/nginx.ap.access.log.pos\n  time_format  %d/%b/%Y:%H:%M:%S %z\n  tag          nginx.ap.access.log\n</source>\n\n# output\n<match nginx.ap.access.log>\n  type               forward\n  send_timeout       60s\n  recover_wait       60s\n  heartbeat_interval 1s\n  phi_threshold      8\n  hard_timeout       60s\n\n  <server>\n    name   logme\n    host   192.168.1.45\n    port   24224\n    weight 60\n  </server>\n</match>\n\n```\n\n### \u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u5074\u306e\u8a2d\u5b9a\n\n[fluent-plugin-typecast](https://github.com/tarom/fluent-plugin-typecast)\u3067\u7279\u5b9a\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u6570\u5024\u306b\u5909\u63db\u3057\u3066\u3044\u307e\u3059\u3002\n\n```/etc/td-agent/conf.d/nginx.conf\n\n# input\n<source>\n  type forward\n  port 24224\n  bind 0.0.0.0\n</source>\n\n# output\n<match nginx.ap.access.log>\n  type        typecast\n  item_types  time:time,status:integer,size:integer,reqtime:float,apptime:float\n  time_format %d/%b/%Y:%H:%M:%S %z\n  prefix      cast\n</match>\n\n<match cast.nginx.ap.access.log>\n  type              file\n  path              /var/log/td-agent/ap.access.log\n  time_slice_format %Y%m%d\n  time_slice_wait   5m\n  compress          gzip\n</match>\n\n```\n\n\u5404\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u306e\u30a2\u30af\u30bb\u30b9\u30ed\u30b0\u304c\u30ed\u30b0\u30b5\u30fc\u30d0\u30fc\u306b\u96c6\u7d04\u3055\u308c\u307e\u3059\u3002\n\n```/var/log/td-agent\n\n-rw-r--r-- 1 td-agent td-agent  8345  3\u6708 20 00:05 2014 ap.access.log.20140319_0.log.gz\n-rw-r--r-- 1 td-agent td-agent  5490  3\u6708 21 00:05 2014 ap.access.log.20140320_0.log.gz\n-rw-r--r-- 1 td-agent td-agent  5852  3\u6708 21 09:36 2014 ap.access.log.20140321.b4f51468d38e9c1d8\n\n```\n\n## GoAccess\n\n```fluentd``` \u304c\u51fa\u529b\u3059\u308b\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3059\u308b\u305f\u3081\u306e\u30ab\u30b9\u30bf\u30e0\u30ed\u30b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\n\n### nginx\u7528\n\n```/etc/goaccess/ltsv.fluentd.nginx\n\ncolor_scheme 2\ndate_format %F\nlog_format %dT%^\\t%^\\t{\"host\":\"%h\",\"user\":\"%^\",\"req\":\"%r\",\"status\":%s,\"size\":%b,\"referer\":\"%R\",\"ua\":\"%u\",\"forwardedfor\":\"%^\",\"reqtime\":%T,\"apptime\":%^}\n\n```\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```/var/log/td-agent/ap.access.log\n\n2014-03-21T04:30:51+00:00     cast.nginx.ap.access.log     {\"host\":\"192.168.1.23\",\"user\":\"-\",\"req\":\"GET /test HTTP/1.1\",\"status\":302,\"size\":0,\"referer\":\"https://example.com/invitation\",\"ua\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\"forwardedfor\":\"192.168.1.23\",\"reqtime\":1.012,\"apptime\":1.012}\n\n```\n\n### apache\u7528\n\n```/etc/goaccess/ltsv.fluentd.httpd\n\ncolor_scheme 2\ndate_format %F\nlog_format %dT%^\\t%^\\t{\"host\":\"%h\",\"user\":\"%^\",\"req\":\"%r\",\"status\":%s,\"size\":%b,\"referer\":\"%R\",\"ua\":\"%u\",\"forwardedfor\":\"%^\",\"reqtime\":%D,\"apptime\":%^}\n\n```\n\n\u3053\u306e\u5b9a\u7fa9\u3067\u3001\u4e0b\u8a18\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u30ed\u30b0\u3092\u30d1\u30fc\u30b9\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n```/var/log/td-agent/ap.access.log\n\n2014-03-21T04:30:51+00:00     cast.httpd.ap.access.log     {\"host\":\"192.168.1.23\",\"user\":\"-\",\"req\":\"GET /test HTTP/1.1\",\"status\":302,\"size\":0,\"referer\":\"https://example.com/invitation\",\"ua\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/33.0.1750.152 Safari/537.36\",\"forwardedfor\":\"192.168.1.23\",\"reqtime\":435959,\"apptime\":435959}\n\n```\n\n## \u4f7f\u3044\u65b9\n\n\u4f7f\u3044\u65b9\u306f\u3053\u3046\u306a\u308a\u307e\u3059\u3002\n\n```usage\ngoaccess -f /var/log/td-agent/ap.access.log.20140321.b4f51468d38e9c1d8 -p /etc/goaccess/ltsv.fluentd.nginx\n```\n\n```fluentd``` \u3067\u96c6\u7d04\u3057\u3066\u3044\u308b\u30ed\u30b0\u3092\u89e3\u6790\u3059\u308b\u5834\u5408\u3001\u89e3\u6790\u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306f ```fluentd``` \u306e ```buffer``` \u304b\u3089\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u306b ```flush``` \u3055\u308c\u308b\u30bf\u30a4\u30df\u30f3\u30b0\u306b\u4f9d\u5b58\u3059\u308b\u305f\u3081\u3001\u30a6\u30a7\u30d6\u30b5\u30fc\u30d0\u30fc\u3067\u76f4\u63a5\u30ed\u30b0\u30d5\u30a1\u30a4\u30eb\u3092\u89e3\u6790\u3057\u3066\u3044\u308b\u5834\u5408\u3068\u6bd4\u3079\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u6027\u306f\u304b\u306a\u308a\u843d\u3061\u307e\u3059\u3002\n\n# \u307e\u3068\u3081\n\n\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3082\u4f7f\u3044\u65b9\u3082\u3068\u3066\u3082\u7c21\u5358\u3067\u3059\u306d\u3002 ```tail``` \u3084 ```grep``` \u3067\u5730\u5473\u306b\u30ed\u30b0\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3068\u3044\u3046\u4f5c\u696d\u306b ```GoAccess``` \u3067\u89e3\u6790\u3059\u308b\u3068\u3044\u3046\u4e00\u624b\u9593\u3092\u52a0\u3048\u3066\u307f\u308b\u3068\u3044\u3044\u3067\u3059\u3002\n\n```404``` \u306b\u306a\u3063\u3066\u3044\u308b\u30d5\u30a1\u30a4\u30eb\u3084\u30ed\u30fc\u30c9\u306b\u6642\u9593\u304c\u304b\u304b\u3063\u3066\u3044\u308b\u30ea\u30bd\u30fc\u30b9\u3082\u4e00\u76ee\u77ad\u7136\u306a\u306e\u3067\u958b\u767a\u6642\u304b\u3089\u6d3b\u8e8d\u3057\u3066\u304f\u308c\u308b\u3068\u601d\u3044\u307e\u3059\u3002\n", "tags": ["nginx", "LTSV", "GoAccess", "Apache", "fluentd"]}