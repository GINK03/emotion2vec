{"tags": ["Yii2.0", "PHP"], "context": " More than 1 year has passed since last update.Yii2\u306eauthclient\u3067Twitter\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u307f\u305f\u3068\u3053\u308d\u3001OAuth\u8a8d\u8a3c\u304c\u6210\u529f\u3057\u305f\u5f8c\u3001GET\u7cfb\u306eTwitter REST APIs\u306f\u666e\u901a\u306b\u52d5\u304f\u304c\u3001POST\u7cfb\u304c\u5168\u3066401\u30a8\u30e9\u30fc\u3092\u8fd4\u3059 \u3068\u3044\u3046\u554f\u984c\u306b\u906d\u9047\u3057\u307e\u3057\u305f\u3002\n\u4f8b\u3048\u3070\n$client->api('friendships/lookup.json', 'GET', ['screen_name' => 'kamicup']);\n\n\u306f\u3075\u3064\u30fc\u306b\u52d5\u304f\u3051\u3069\u3001\n$client->api('friendships/create.json', 'POST', ['screen_name' => 'kamicup']);\n\n\u306a\u3069\u306f\n{\"errors\":[{\"message\":\"Could not authenticate you\",\"code\":32}]}\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\u3067\u3001authclient\u306e\u30bd\u30fc\u30b9\u3092\u8ffd\u3063\u3066\u8abf\u3079\u307e\u3057\u305f\u304c\u3001\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u3001\nyii\\authclient\\clients\\Twitter \u306f\uff08\u4eca\u306e\u3068\u3053\u308d\uff09POST\u7cfb\u306eTwitter REST APIs\u304c\u52d5\u304f\u3088\u3046\u306b\u306f\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002POST\u7cfb\u3092\u4f7f\u3046\u306b\u306f\u4e0b\u8a18\u306e\u56de\u907f\u7b56\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u56de\u907f\u7b56\n\u89aa\u30af\u30e9\u30b9\u3067\u3042\u308b yii\\authclient\\OAuth1 \u306e\u51e6\u7406\u3092\u4e00\u90e8\u66f8\u304d\u63db\u3048\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u5177\u4f53\u7684\u306b\u306f\u3001\u3053\u3053\u3067\u3059\u3002\n\n.../vendor/yiisoft/yii2-authclient/clients/Twitter.php\nprotected function composeRequestCurlOptions($method, $url, array $params) {\n    ...\n    $curlOptions[CURLOPT_POSTFIELDS] = $params;\n    ...\n    $curlOptions[CURLOPT_HTTPHEADER] = ['Content-Type: application/atom+xml', $authorizationHeader];\n\n\nOAuth\u8a8d\u8a3c\u51e6\u7406\u306f\u3053\u308c\u3067\u3044\u3044\u306e\u3067\u3059\u304c\u3001Twitter REST APIs\u306ePOST\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u6642\u306b\u306f Content-Type\u3092application/x-www-form-urlencoded\u306b\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u307e\u305f\u3001curl_setopt()\u95a2\u6570\u306fCURLOPT_POSTFIELDS\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u914d\u5217\u3092\u6e21\u3059\u3068\u5f37\u5236\u7684\u306bmultipart/form-data\u306b\u306a\u308b\u4ed5\u69d8\u306a\u306e\u3067\u3001\u914d\u5217\u3067\u306f\u306a\u304f\u6587\u5b57\u5217\u3092\u6e21\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\u3053\u308c\u3092\u8e0f\u307e\u3048\u3066\u3001\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3092\u2193\u306b\u7f6e\u3044\u3066\u304a\u304f\u306e\u3067\u3001yii\\authclient\\clients\\Twitter \u306e\u4ee3\u308f\u308a\u306b\u3069\u3046\u305e\u3002\n\nTwitter.php\n<?php\nuse yii\\authclient\\OAuth1;\n\nclass Twitter extends OAuth1\n{\n    public $authUrl = 'https://api.twitter.com/oauth/authorize';\n    public $requestTokenUrl = 'https://api.twitter.com/oauth/request_token';\n    public $requestTokenMethod = 'POST';\n    public $accessTokenUrl = 'https://api.twitter.com/oauth/access_token';\n    public $accessTokenMethod = 'POST';\n    public $apiBaseUrl = 'https://api.twitter.com/1.1';\n\n    protected function initUserAttributes() {\n        return $this->api('account/verify_credentials.json', 'GET');\n    }\n    protected function defaultName() {\n        return 'twitter';\n    }\n    protected function defaultTitle() {\n        return 'Twitter';\n    }    \n\n    protected function composeRequestCurlOptions($method, $url, array $params) {\n        if ( $method === 'POST' && strpos($url, $this->apiBaseUrl) === 0 ) {\n            $curlOptions = [];\n            $curlOptions[CURLOPT_POST] = true;\n            if (!empty($params)) {\n                $curlOptions[CURLOPT_POSTFIELDS] = http_build_query($params);\n            }\n            $authorizationHeader = $this->composeAuthorizationHeader($params);\n            if (!empty($authorizationHeader)) {\n                $curlOptions[CURLOPT_HTTPHEADER] = ['Content-Type: application/x-www-form-urlencoded', $authorizationHeader];\n            }\n            return $curlOptions;\n        } else {\n            return parent::composeRequestCurlOptions($method, $url, $params);\n        }\n    }\n}\n\n\nYii2\u306eauthclient\u3067Twitter\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u4f7f\u3063\u3066\u307f\u305f\u3068\u3053\u308d\u3001**OAuth\u8a8d\u8a3c\u304c\u6210\u529f\u3057\u305f\u5f8c\u3001GET\u7cfb\u306eTwitter REST APIs\u306f\u666e\u901a\u306b\u52d5\u304f\u304c\u3001POST\u7cfb\u304c\u5168\u3066401\u30a8\u30e9\u30fc\u3092\u8fd4\u3059** \u3068\u3044\u3046\u554f\u984c\u306b\u906d\u9047\u3057\u307e\u3057\u305f\u3002\n\n\u4f8b\u3048\u3070\n\n```php:\n$client->api('friendships/lookup.json', 'GET', ['screen_name' => 'kamicup']);\n```\n\n\u306f\u3075\u3064\u30fc\u306b\u52d5\u304f\u3051\u3069\u3001\n\n```php:\n$client->api('friendships/create.json', 'POST', ['screen_name' => 'kamicup']);\n```\n\n\u306a\u3069\u306f\n\n```json:\n{\"errors\":[{\"message\":\"Could not authenticate you\",\"code\":32}]}\n```\n\n\u3068\u3044\u3046\u30a8\u30e9\u30fc\u30ec\u30b9\u30dd\u30f3\u30b9\u304c\u8fd4\u3063\u3066\u304d\u307e\u3059\u3002\n\n\u3067\u3001authclient\u306e\u30bd\u30fc\u30b9\u3092\u8ffd\u3063\u3066\u8abf\u3079\u307e\u3057\u305f\u304c\u3001\n\n\u7d50\u8ad6\u304b\u3089\u8a00\u3046\u3068\u3001\n\n**yii\\authclient\\clients\\Twitter \u306f\uff08\u4eca\u306e\u3068\u3053\u308d\uff09POST\u7cfb\u306eTwitter REST APIs\u304c\u52d5\u304f\u3088\u3046\u306b\u306f\u306a\u3063\u3066\u3044\u307e\u305b\u3093\u3002POST\u7cfb\u3092\u4f7f\u3046\u306b\u306f\u4e0b\u8a18\u306e\u56de\u907f\u7b56\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002**\n\n#\u56de\u907f\u7b56\n\n\u89aa\u30af\u30e9\u30b9\u3067\u3042\u308b yii\\authclient\\OAuth1 \u306e\u51e6\u7406\u3092\u4e00\u90e8\u66f8\u304d\u63db\u3048\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n\u5177\u4f53\u7684\u306b\u306f\u3001\u3053\u3053\u3067\u3059\u3002\n\n```php:.../vendor/yiisoft/yii2-authclient/clients/Twitter.php\nprotected function composeRequestCurlOptions($method, $url, array $params) {\n    ...\n    $curlOptions[CURLOPT_POSTFIELDS] = $params;\n    ...\n    $curlOptions[CURLOPT_HTTPHEADER] = ['Content-Type: application/atom+xml', $authorizationHeader];\n```\n\nOAuth\u8a8d\u8a3c\u51e6\u7406\u306f\u3053\u308c\u3067\u3044\u3044\u306e\u3067\u3059\u304c\u3001Twitter REST APIs\u306ePOST\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3076\u6642\u306b\u306f **Content-Type\u3092application/x-www-form-urlencoded\u306b\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002**\n\u307e\u305f\u3001**curl_setopt()\u95a2\u6570\u306fCURLOPT_POSTFIELDS\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u914d\u5217\u3092\u6e21\u3059\u3068\u5f37\u5236\u7684\u306bmultipart/form-data\u306b\u306a\u308b\u4ed5\u69d8\u306a\u306e\u3067\u3001\u914d\u5217\u3067\u306f\u306a\u304f\u6587\u5b57\u5217\u3092\u6e21\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002**\n\n\n\u3053\u308c\u3092\u8e0f\u307e\u3048\u3066\u3001\u4f7f\u3048\u308b\u3088\u3046\u306b\u3057\u305f\u3082\u306e\u3092\u2193\u306b\u7f6e\u3044\u3066\u304a\u304f\u306e\u3067\u3001yii\\authclient\\clients\\Twitter \u306e\u4ee3\u308f\u308a\u306b\u3069\u3046\u305e\u3002\n\n\n```php:Twitter.php\n<?php\nuse yii\\authclient\\OAuth1;\n\nclass Twitter extends OAuth1\n{\n    public $authUrl = 'https://api.twitter.com/oauth/authorize';\n    public $requestTokenUrl = 'https://api.twitter.com/oauth/request_token';\n    public $requestTokenMethod = 'POST';\n    public $accessTokenUrl = 'https://api.twitter.com/oauth/access_token';\n    public $accessTokenMethod = 'POST';\n    public $apiBaseUrl = 'https://api.twitter.com/1.1';\n\n    protected function initUserAttributes() {\n        return $this->api('account/verify_credentials.json', 'GET');\n    }\n    protected function defaultName() {\n        return 'twitter';\n    }\n    protected function defaultTitle() {\n        return 'Twitter';\n    }    \n    \n    protected function composeRequestCurlOptions($method, $url, array $params) {\n        if ( $method === 'POST' && strpos($url, $this->apiBaseUrl) === 0 ) {\n            $curlOptions = [];\n            $curlOptions[CURLOPT_POST] = true;\n            if (!empty($params)) {\n                $curlOptions[CURLOPT_POSTFIELDS] = http_build_query($params);\n            }\n            $authorizationHeader = $this->composeAuthorizationHeader($params);\n            if (!empty($authorizationHeader)) {\n                $curlOptions[CURLOPT_HTTPHEADER] = ['Content-Type: application/x-www-form-urlencoded', $authorizationHeader];\n            }\n            return $curlOptions;\n        } else {\n            return parent::composeRequestCurlOptions($method, $url, $params);\n        }\n    }\n}\n```\n"}