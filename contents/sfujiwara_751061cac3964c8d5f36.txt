{"context": "nginx\u3067 proxy_pass \u3059\u308b\u5148\u3092 SNI \u3067\u306f\u306a\u3044 HTTPS \u304b\u3089 SNI \u306a HTTPS (\u5177\u4f53\u7684\u306b\u306f CloudFront) \u3078\u5909\u66f4\u3057\u305f\u3089\u30cf\u30de\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\n\u3053\u3093\u306a\u30ed\u30b0\u304c\u3067\u3066\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3002\n[error] 21711#0: *32897 SSL_do_handshake() failed\n (SSL: error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure)\n while SSL handshaking to upstream,\n client: ****, server: ****, request: \"GET / HTTP/1.1\",\n upstream: \"https://****\", host: \"****\"\n\nnginx 1.7.0 \u4ee5\u964d\u3067 proxy \u5148\u3078\u306e SNI \u5bfe\u5fdc\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001proxy_ssl_server_name on \u3057\u3066\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\nresolver 127.0.0.1;\nset $server \"sni.example.com\";\nlocation / {\n    proxy_ssl_server_name on;\n    proxy_pass https://$server;\n}\n\nnginx\u3067 `proxy_pass` \u3059\u308b\u5148\u3092 SNI \u3067\u306f\u306a\u3044 HTTPS \u304b\u3089 SNI \u306a HTTPS (\u5177\u4f53\u7684\u306b\u306f CloudFront) \u3078\u5909\u66f4\u3057\u305f\u3089\u30cf\u30de\u3063\u305f\u306e\u3067\u30e1\u30e2\u3002\n\n\u3053\u3093\u306a\u30ed\u30b0\u304c\u3067\u3066\u63a5\u7d9a\u3067\u304d\u306a\u3044\u3002\n\n```\n[error] 21711#0: *32897 SSL_do_handshake() failed\n (SSL: error:14077410:SSL routines:SSL23_GET_SERVER_HELLO:sslv3 alert handshake failure)\n while SSL handshaking to upstream,\n client: ****, server: ****, request: \"GET / HTTP/1.1\",\n upstream: \"https://****\", host: \"****\"\n```\n\nnginx 1.7.0 \u4ee5\u964d\u3067 proxy \u5148\u3078\u306e SNI \u5bfe\u5fdc\u304c\u5165\u3063\u3066\u3044\u308b\u306e\u3067\u3001`proxy_ssl_server_name on` \u3057\u3066\u89e3\u6c7a\u3057\u307e\u3057\u305f\u3002\n\n```\nresolver 127.0.0.1;\nset $server \"sni.example.com\";\nlocation / {\n    proxy_ssl_server_name on;\n    proxy_pass https://$server;\n}\n```\n", "tags": ["nginx", "SSL", "sni"]}