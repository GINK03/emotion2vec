{"context": "#!/bin/bash\n###############################################################################\n##\n##  \u30d5\u30a1\u30a4\u30eb\u540d :   install_vmware-preseed_cfg.sh\n##\n##  \u6a5f\u80fd\u6982\u8981    :   Debian & Ubuntu Install\u7528\u30b7\u30a7\u30eb [VMware\u5bfe\u5fdc]\n##\n##  \u5165\u51fa\u529b I/F\n##      INPUT   :   \n##      OUTPUT  :   \n##\n##  \u4f5c\u6210\u8005       :   J.Itou\n##\n##  \u4f5c\u6210\u65e5\u4ed8    :   2014/11/02\n##\n##  \u6539\u8a02\u5c65\u6b74    :   \n##     \u65e5\u4ed8       \u7248         \u540d\u524d      \u6539\u8a02\u5185\u5bb9\n##  ---------- -------- -------------- ----------------------------------------\n##  2014/11/02 000.0000 J.Itou         \u65b0\u898f\u4f5c\u6210\n##  2016/10/12 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(preseed.cfg\u306b\u7279\u5316)\n##  2016/10/15 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u30d8\u30c3\u30c0\u30fc\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6761\u4ef6\u8ffd\u52a0)\n##  2016/10/16 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u5404\u7a2e\u6761\u4ef6\u8ffd\u52a0\u5909\u66f4)\n##  2016/10/17 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(smb.conf)\n##  2016/10/26 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(smb.conf)\n##  2016/10/30 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u5404\u7a2e\u8a2d\u5b9a\u5909\u66f4)\n##  2016/11/05 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(VMware-Tools)\n##  2016/11/06 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(vsftpd)\n##  YYYY/MM/DD 000.0000 xxxxxxxxxxxxxx \n###############################################################################\n#set -nvx\n\n# Pause\u51e6\u7406 -------------------------------------------------------------------\nfuncPause() {\n    RET_STS=$1\n\n    if [ ${RET_STS} -ne 0 ]; then\n        echo \"Enter\u30ad\u30fc\u3092\u62bc\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n        read DUMMY\n    fi\n}\n\n#------------------------------------------------------------------------------\n# Initialize\n#------------------------------------------------------------------------------\n    NOW_TIME=`date +\"%Y%m%d%H%M%S\"`\n    PGM_NAME=`basename $0 | sed -e 's/\\..*$//'`\n    DBG_FLAG=${DBG_FLAG:-0}\n    if [ ${DBG_FLAG} -ne 0 ]; then\n        set -vx\n    fi\n\n    WHO_AMI=`whoami`\n    if [ \"${WHO_AMI}\" != \"root\" ]; then\n        echo \"root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n        exit 1\n    fi\n\n#   WHO_USER=`who | awk '$1!=\"root\" {print $1;}'`\n#   if [ \"${WHO_USER}\" != \"\" ]; then\n#       echo \"${WHO_USER}\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u3002\"\n#       echo \"\u5168\u3066\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u304b\u3089\u3001\"\n#       echo \"root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n#       exit 1\n#   fi\n\n    # \u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u90e8\u5206 --------------------------------------\n    SVR_NAME=`hostname`                                                         # \u672c\u6a5f\u306e\u540d\u524d\n    GWR_NAME=gw-router                                                          # \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u540d\u524d\n    WGP_NAME=vmware                                                             # \u30ef\u30fc\u30af\u30b0\u30eb\u30fc\u30d7\u540d\n#   DEF_USER=master                                                             # \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u540d\n    NUM_HDDS=1                                                                  # \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306eHDD\u53f0\u6570\n    FLG_DHCP=0                                                                  # DHCP\u81ea\u52d5\u8d77\u52d5\u30d5\u30e9\u30b0(0\u4ee5\u5916\u3067\u81ea\u52d5\u8d77\u52d5)\n#   FLG_VMTL=1                                                                  # 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n#   FLG_SVER=1                                                                  # 0\u4ee5\u5916\u3067\u30b5\u30fc\u30d0\u30fc\u4ed5\u69d8\u3067\u30bb\u30c3\u30c6\u30a3\u30f3\u30b0\n#   VER_WMIN=1.820                                                              # webmin\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u767b\u9332\n#   VGA_RESO=1024x768x32                                                        # \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u89e3\u50cf\u5ea6\uff1a1024\u00d7768\uff1a1600\u4e07\u8272\n    VGA_RESO=1280x1024x32                                                       #   \u3003              \uff1a1280\u00d71024\uff1a1600\u4e07\u8272\n    IP6_ADDR=\"fe80::\"                                                           # \u63a5\u7d9a\u8a31\u53ef\u3059\u308bIPv6\u30a2\u30c9\u30ec\u30b9\n    IP6_MASK=\"64\"                                                               #   \u3003            \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n    SMB_USER=sambauser                                                          # smb.conf\u306eforce user\n    SMB_GRUP=sambashare                                                         # smb.conf\u306eforce group\n\n    # \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9 --------------------------------------------------\n    # \u30af\u30e9\u30b9  | \u4f7f\u7528\u3067\u304d\u308bIP\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2       | \u4f7f\u7528\u3067\u304d\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\u7bc4\u56f2\n    # \u30af\u30e9\u30b9A | 10.0.0.0 \uff5e 10.255.255.255     | 255.0.0.0 \uff5e 255.255.255.255\uff08\u6700\u592716,777,214\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n    # \u30af\u30e9\u30b9B | 172.16.0.0 \uff5e 172.31.255.255   | 255.255.0.0 \uff5e 255.255.255.255\uff08\u6700\u592765,534\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n    # \u30af\u30e9\u30b9C | 192.168.0.0 \uff5e 192.168.255.255 | 255.255.255.0 \uff5e 255.255.255.255\uff08\u6700\u5927254\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n    #\n    #  8 | 11111111.00000000.00000000.00000000 | 255.0.0.0\n    # 16 | 11111111.11111111.00000000.00000000 | 255.255.0.0\n    # 24 | 11111111.11111111.11111111.00000000 | 255.255.255.0\n\n    NWK_NAME=`awk '$4==\"static\" {print $2;}' /etc/network/interfaces`\n\n    NIC_NAME=`ip a show | awk -F \"[ :]\" '$1==\"2\" {print $3;}'`                  # NIC\u30c7\u30d0\u30a4\u30b9\u540d\n    NIC_INET=`ip a show dev ${NIC_NAME} | awk '$1==\"inet\" {print $2;}'`         # IP\u30a2\u30c9\u30ec\u30b9/\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n    NIC_ADDR=`echo ${NIC_INET} | awk -F / '{print $1;}'`                        # IP\u30a2\u30c9\u30ec\u30b9\n    NIC_BITS=`echo ${NIC_INET} | awk -F / '{print $2;}'`                        # \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n    NIC_IPAD=`echo ${NIC_ADDR} | awk -F . '{printf\"%s.%s.%s\", $1,$2,$3;}'`      # \u672c\u6a5f\u306e\u5c5e\u3059\u308b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30fb\u30a2\u30c9\u30ec\u30b9\n                                                                                # \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\n    case \"${NIC_BITS}\" in\n        24 ) NIC_MASK=\"255.255.255.0\" ;;\n        16 ) NIC_MASK=\"255.255.0.0\" ;;\n         8 ) NIC_MASK=\"255.0.0.0\" ;;\n         * ) echo \"\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\u304c\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\"\n             exit 1\n             ;;\n    esac\n\n    NIC_NTWK=${NIC_IPAD}.0                                                      # \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\n    NIC_BCST=`ip a show dev ${NIC_NAME} | awk '$1==\"inet\" {print $4;}'`         # \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\n    NIC_GATE=`route -n | awk '$1==\"0.0.0.0\" {print $2;}'`                       # \u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\n#   NIC_DADR=`awk '$1==\"nameserver\" {print $2;}' /etc/resolv.conf`              # DNS \u30b5\u30fc\u30d0\u306e\u30a2\u30c9\u30ec\u30b9\n#   NIC_DNAM=`awk '$1==\"search\" {print $2;}' /etc/resolv.conf`                  # DNS \u691c\u7d22\u3067\u512a\u5148\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\n\n    REV_IPAD=`echo ${NIC_ADDR} | awk -F . '{printf\"%s.%s.%s\", $3,$2,$1;}'`      # BIND\u7528\n    SVR_ADDR=`echo ${NIC_ADDR} | awk -F . '{print $4;}'`                        # \u672c\u6a5f\u306eIP\u30a2\u30c9\u30ec\u30b9\n    GWR_ADDR=`echo ${NIC_GATE} | awk -F . '{print $4;}'`                        # \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n    ADR_DHCP=\"${NIC_IPAD}.64 ${NIC_IPAD}.79\"                                    # DHCP\u306e\u63d0\u4f9b\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\n\n    # \u30ef\u30fc\u30af\u5909\u6570\u8a2d\u5b9a ----------------------------------------------------------\n    DST_NAME=`awk '/[A-Za-z]./ {print $1;}' /etc/issue | head -n 1 | tr '[A-Z]' '[a-z]'`\n\n    if [ \"${SVR_NAME}\" = \"\" ]; then\n        if [ ${FLG_SVER} -ne 0 ]; then\n            SVR_NAME=sv-${DST_NAME}\n        else\n            SVR_NAME=ws-${DST_NAME}\n        fi\n    fi\n\n    if [ \"`echo ${PGM_NAME} | grep -i vmware`\" = \"\" ]; then\n        FLG_VMTL=0                              # 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    else\n        FLG_VMTL=1                              # 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n    fi\n\n    if [ \"${VER_WMIN}\" = \"\" ]; then\n        SET_WMIN=\"webmin-current.deb\"\n    else\n        SET_WMIN=\"webmin_${VER_WMIN}_all.deb\"\n    fi\n\n#   MNT_FD=/media/floppy0\n#   MNT_CD=/media/cdrom0\n    MNT_CD=/media\n    DEV_CD=/dev/sr0\n\n    DIR_WK=/work\n    LST_USER=${DIR_WK}/addusers.txt\n#   LOG_FILE=${DIR_WK}/${PGM_NAME}.sh.${NOW_TIME}.log\n    TGZ_WORK=${DIR_WK}/${PGM_NAME}.sh.tgz\n    CRN_FILE=${DIR_WK}/${PGM_NAME}.sh.crn\n    USR_FILE=${DIR_WK}/${PGM_NAME}.sh.usr.list\n    SMB_FILE=${DIR_WK}/${PGM_NAME}.sh.smb.list\n    SMB_WORK=${DIR_WK}/${PGM_NAME}.sh.smb.work\n    SMB_CONF=/etc/samba/smb.conf\n    SMB_BACK=${SMB_CONF}.orig\n\n    DEV_NUM1=sda\n    DEV_NUM2=sdb\n    DEV_NUM3=sdc\n    DEV_NUM4=sdd\n    DEV_NUM5=sde\n    DEV_NUM6=sdf\n    DEV_NUM7=sdg\n    DEV_NUM8=sdh\n\n    case \"${NUM_HDDS}\" in\n        # HDD 1\u53f0 -------------------------------------------------------------\n        1 ) DEV_HDD1=/dev/${DEV_NUM1}\n            DEV_HDD2=\n            DEV_HDD3=\n            DEV_HDD4=\n\n            DEV_USB1=/dev/${DEV_NUM2}\n            DEV_USB2=/dev/${DEV_NUM3}\n            DEV_USB3=/dev/${DEV_NUM4}\n            DEV_USB4=/dev/${DEV_NUM5}\n            ;;\n        # HDD 2\u53f0 -------------------------------------------------------------\n        2 ) DEV_HDD1=/dev/${DEV_NUM1}\n            DEV_HDD2=/dev/${DEV_NUM2}\n            DEV_HDD3=\n            DEV_HDD4=\n\n            DEV_USB1=/dev/${DEV_NUM3}\n            DEV_USB2=/dev/${DEV_NUM4}\n            DEV_USB3=/dev/${DEV_NUM5}\n            DEV_USB4=/dev/${DEV_NUM6}\n            ;;\n        # HDD 4\u53f0 ~ -----------------------------------------------------------\n        * ) DEV_HDD1=/dev/${DEV_NUM1}\n            DEV_HDD2=/dev/${DEV_NUM2}\n            DEV_HDD3=/dev/${DEV_NUM3}\n            DEV_HDD4=/dev/${DEV_NUM4}\n\n            DEV_USB1=/dev/${DEV_NUM5}\n            DEV_USB2=/dev/${DEV_NUM6}\n            DEV_USB3=/dev/${DEV_NUM7}\n            DEV_USB4=/dev/${DEV_NUM8}\n            ;;\n    esac\n\n    DEV_RATE=\"${DEV_USB1} ${DEV_USB2} ${DEV_USB3} ${DEV_USB4}\"\n    DEV_TEMP=\"${DEV_HDD1} ${DEV_HDD2} ${DEV_HDD3} ${DEV_HDD4} ${DEV_RATE}\"\n\n    CMD_AGET=\"apt-get -y -q\"\n\n#------------------------------------------------------------------------------\n# Make work dir\n#------------------------------------------------------------------------------\n    mkdir -p ${DIR_WK}\n    chmod 700 ${DIR_WK}\n    pushd ${DIR_WK}\n\n#------------------------------------------------------------------------------\n# System Update\n#------------------------------------------------------------------------------\n    ${CMD_AGET} update\n    ${CMD_AGET} upgrade\n    ${CMD_AGET} dist-upgrade\n\n#------------------------------------------------------------------------------\n# UDEV Rules\n#------------------------------------------------------------------------------\n#   if [ ! -f /etc/udev/rules.d/11-media-auto-mount.rules ]; then\n#       cat <<- _EOT_ > /etc/udev/rules.d/11-media-auto-mount.rules\n#           KERNEL!=\"sd[b-z][0-9]\", GOTO=\"media_auto_mount_end\"\n#           ACTION==\"add\", RUN+=\"/bin/mkdir -p /media/usb-%k\"\n#\n#           # Global mount options\n#           ACTION==\"add\", ENV{mount_options}=\"relatime,users\"\n#           # Filesystem specific options\n#           ACTION==\"add\", PROGRAM==\"/lib/initcpio/udev/vol_id -t %N\", RESULT==\"vfat|ntfs\", ENV{mount_options}=\"$env{mount_options},utf8,gid=100,umask=002\"\n#\n#           ACTION==\"add\", RUN+=\"/bin/mount -o $env{mount_options} /dev/%k /media/usb-%k\"\n#           ACTION==\"remove\", RUN+=\"/bin/umount -l /media/usb-%k\", RUN+=\"/bin/rmdir /media/usb-%k\"\n#           LABEL=\"media_auto_mount_end\"\n#_EOT_\n#   fi\n#\n#   udevadm control --reload\n#   udevadm trigger\n#\n#------------------------------------------------------------------------------\n# Locale Setup\n#------------------------------------------------------------------------------\n    if [ ! -f ~/.vimrc ]; then\n        cat <<- _EOT_ > ~/.vimrc\n            set number\n            set tabstop=4\n            set list\n            set listchars=tab:>_\n_EOT_\n    fi\n\n    if [ ! -f ~/.bashrc.orig ]; then\n        locale | sed -e 's/LANG=C/LANG=ja_JP.UTF-8/' \\\n                     -e 's/LANGUAGE=$/LANGUAGE=ja:en/' \\\n                     -e 's/\"C\"/\"ja_JP.UTF-8\"/' > /etc/locale.conf\n        funcPause $?\n        #----------------------------------------------------------------------\n        cp -p ~/.bashrc ~/.bashrc.orig\n        cat <<- _EOT_ >> ~/.bashrc\n            #\n            case \"\\${TERM}\" in\n                \"linux\" )\n                    LANG=C\n                    ;;\n                * )\n                    LANG=ja_JP.UTF-8\n                    ;;\n            esac\n            export LANG\n_EOT_\n        . ~/.profile\n    fi\n\n#------------------------------------------------------------------------------\n# Network Setup\n#------------------------------------------------------------------------------\n    # hosts.allow -------------------------------------------------------------\n    if [ ! -f /etc/hosts.allow.orig ]; then\n        cp -p /etc/resolv.conf /etc/hosts.allow.orig\n        cat <<- _EOT_ >> /etc/hosts.allow\n            ALL: 127.0.0.1 ${NIC_IPAD}. [${IP6_ADDR}]/${IP6_MASK}\n_EOT_\n    fi\n    # hosts.deny --------------------------------------------------------------\n    if [ ! -f /etc/hosts.deny.orig ]; then\n        cp -p /etc/resolv.conf /etc/hosts.deny.orig\n        cat <<- _EOT_ >> /etc/hosts.deny\n            ALL: ALL\n_EOT_\n    fi\n\n#------------------------------------------------------------------------------\n# Make share dir\n#------------------------------------------------------------------------------\n    cat /etc/group | grep ${SMB_GRUP}\n    if [ $? -ne 0 ]; then\n        groupadd --system \"${SMB_GRUP}\"\n    fi\n\n    id ${SMB_USER}\n    if [ $? -ne 0 ]; then\n        useradd --system \"${SMB_USER}\" --groups \"${SMB_GRUP}\"\n    fi\n\n    usermod root -G ${SMB_GRUP}\n\n    mkdir -p /share\n    mkdir -p /share/data\n    mkdir -p /share/data/adm\n    mkdir -p /share/data/adm/netlogon\n    mkdir -p /share/data/adm/profiles\n    mkdir -p /share/data/bak\n    mkdir -p /share/data/pub\n    mkdir -p /share/data/usr\n    mkdir -p /share/dlna\n    mkdir -p /share/dlna/movies\n    mkdir -p /share/dlna/others\n    mkdir -p /share/dlna/photos\n    mkdir -p /share/dlna/sounds\n\n    touch -f /share/data/adm/netlogon/logon.bat\n\n    chown -R ${SMB_USER}:${SMB_GRUP} /share/.\n    chmod -R  770 /share/.\n    chmod    1777 /share/data/adm/profiles\n\n#------------------------------------------------------------------------------\n# Move home dir\n#------------------------------------------------------------------------------\n    useradd -D -b /share/data/usr\n#   usermod -d /share/data/usr/${DEF_USER} -m ${DEF_USER}\n#   usermod ${DEF_USER} -G ${SMB_GRUP}\n#   usermod -L ${DEF_USER}\n\n#------------------------------------------------------------------------------\n# Make shell dir\n#------------------------------------------------------------------------------\n    mkdir -p /usr/sh\n    mkdir -p /var/log/sh\n\n    cat <<- _EOT_ > /usr/sh/USRCOMMON.def\n        #!/bin/bash\n        ###############################################################################\n        ##\n        ##  \u30d5\u30a1\u30a4\u30eb\u540d :   USRCOMMON.def\n        ##\n        ##  \u6a5f\u80fd\u6982\u8981    :   \u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u5171\u901a\u51e6\u7406\n        ##\n        ##  \u5165\u51fa\u529b I/F\n        ##      INPUT   :   \n        ##      OUTPUT  :   \n        ##\n        ##  \u4f5c\u6210\u8005       :   J.Itou\n        ##\n        ##  \u4f5c\u6210\u65e5\u4ed8    :   2014/10/27\n        ##\n        ##  \u6539\u8a02\u5c65\u6b74    :   \n        ##     \u65e5\u4ed8       \u7248         \u540d\u524d      \u6539\u8a02\u5185\u5bb9\n        ##  ---------- -------- -------------- ----------------------------------------\n        ##  2013/10/27 000.0000 J.Itou         \u65b0\u898f\u4f5c\u6210\n        ##  2014/11/04 000.0000 J.Itou         4HDD\u7248\u4ed5\u69d8\u5909\u66f4\n        ##  2014/12/22 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057\n        ##  2016/10/30 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057\n        ##  `date +\"%Y/%m/%d\"` 000.0000 J.Itou         \u81ea\u52d5\u4f5c\u6210\n        ##  YYYY/MM/DD 000.0000 xxxxxxxxxxxxxx \n        ##  ---------- -------- -------------- ----------------------------------------\n        ###############################################################################\n\n        #------------------------------------------------------------------------------\n        # \u30e6\u30fc\u30b6\u30fc\u5909\u6570\u5b9a\u7fa9\n        #------------------------------------------------------------------------------\n\n        # USB\u30c7\u30d0\u30a4\u30b9\u5909\u6570\u5b9a\u7fa9\n        APL_MNT_DV1=\"${DEV_USB1}1\"\n        APL_MNT_DV2=\"${DEV_USB2}1\"\n        APL_MNT_DV3=\"${DEV_USB3}1\"\n        APL_MNT_DV4=\"${DEV_USB4}1\"\n\n        # USB\u30c7\u30d0\u30a4\u30b9\u5909\u6570\u5b9a\u7fa9\n        APL_MNT_LN1=\"/mnt/usb1\"\n        APL_MNT_LN2=\"/mnt/usb2\"\n        APL_MNT_LN3=\"/mnt/usb3\"\n        APL_MNT_LN4=\"/mnt/usb4\"\n\n        SYS_MNT_DV1=\"/sys/block/`echo ${DEV_USB1} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n        SYS_MNT_DV2=\"/sys/block/`echo ${DEV_USB2} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n        SYS_MNT_DV3=\"/sys/block/`echo ${DEV_USB3} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n        SYS_MNT_DV4=\"/sys/block/`echo ${DEV_USB4} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n_EOT_\n\n#------------------------------------------------------------------------------\n# Make floppy dir\n#------------------------------------------------------------------------------\n#   if [ ! -d /media/floppy0 ]; then\n#       pushd /media\n#       mkdir floppy0\n#       ln -s floppy0 floppy\n#       popd\n#   fi\n#\n#------------------------------------------------------------------------------\n# Make cd-rom dir\n#------------------------------------------------------------------------------\n#   if [ ! -d /media/cdrom0 ]; then\n#       pushd /media\n#       mkdir cdrom0\n#       ln -s cdrom0 cdrom\n#       popd\n#   fi\n#\n#------------------------------------------------------------------------------\n# Make usb dir\n#------------------------------------------------------------------------------\n#   mkdir -p /mnt/cdrom\n#   mkdir -p /mnt/floppy\n#   mkdir -p /mnt/usb1\n#   mkdir -p /mnt/usb2\n#   mkdir -p /mnt/usb3\n#   mkdir -p /mnt/usb4\n#   #--------------------------------------------------------------------------\n#   if [ ! -f /etc/fstab.orig ]; then\n#       cp -p /etc/fstab /etc/fstab.orig\n#       unexpand -a -t 4 /etc/fstab.orig > /etc/fstab\n#       cat <<- _EOT_ >> /etc/fstab\n#           # additional devices --------------------------------------------------------------------------------------------------\n#           # <file system>                                 <mount point>   <type>          <options>               <dump>  <pass>\n#           # /dev/sr0                                      /media/cdrom0   udf,iso9660     rw,user,noauto          0       0\n#           # /dev/fd0                                      /media/floppy0  auto            rw,user,noauto          0       0\n#           # /dev/sr0                                      /mnt/cdrom      udf,iso9660     rw,user,noauto          0       0\n#           # /dev/fd0                                      /mnt/floppy     auto            rw,user,noauto          0       0\n#           # ${DEV_USB1}1                                      /mnt/usb1       auto            rw,user,noauto          0       0\n#           # ${DEV_USB2}1                                      /mnt/usb2       auto            rw,user,noauto          0       0\n#           # ${DEV_USB3}1                                      /mnt/usb3       auto            rw,user,noauto          0       0\n#           # ${DEV_USB4}1                                      /mnt/usb4       auto            rw,user,noauto          0       0\n#_EOT_\n#       vi /etc/fstab\n#   fi\n#\n#------------------------------------------------------------------------------\n# Install clamav\n#------------------------------------------------------------------------------\n    if [ ! -f /etc/clamav/freshclam.conf.orig ]; then\n        sed -i.orig /etc/clamav/freshclam.conf \\\n            -e 's/# Check for new database 24 times a day/# Check for new database 4 times a day/' \\\n            -e 's/Checks 24/Checks 4/' \\\n            -e 's/^NotifyClamd/#&/'\n    fi\n\n#------------------------------------------------------------------------------\n# Install ssh\n#------------------------------------------------------------------------------\n    if [ ! -f /etc/ssh/sshd_config.orig ]; then\n        sed -i.orig /etc/ssh/sshd_config \\\n            -e 's/^PermitRootLogin .*/PermitRootLogin yes/' \\\n            -e '$a UseDNS no'\n    fi\n\n#   /etc/init.d/ssh restart\n    systemctl restart sshd\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Install apache2\n#------------------------------------------------------------------------------\n    if [ ! -f /etc/apache2/mods-available/userdir.conf.orig ]; then\n        cp -p /etc/apache2/mods-available/userdir.conf /etc/apache2/mods-available/userdir.conf.orig\n        cat <<- _EOT_ > /etc/apache2/mods-available/userdir.conf\n            <IfModule mod_userdir.c>\n                UserDir web/public_html\n                UserDir disabled root\n\n                <Directory /share/data/usr/*/web/public_html>\n                    AllowOverride FileInfo AuthConfig Limit Indexes\n                    Options MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n                    <Limit GET POST OPTIONS>\n                        Order allow,deny\n                        Allow from all\n                    </Limit>\n                    <LimitExcept GET POST OPTIONS>\n                        Order deny,allow\n                        Deny from all\n                    </LimitExcept>\n                </Directory>\n            </IfModule>\n_EOT_\n    fi\n\n    a2enmod userdir\n#   /etc/init.d/apache2 restart\n    systemctl restart apache2\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Install ftpd\n#------------------------------------------------------------------------------\n    which proftpd\n    if [ $? -eq 0 ]; then                   # Install proftpd\n        if [ ! -f /etc/proftpd/proftpd.conf.orig ]; then\n            cp -p /etc/proftpd/proftpd.conf /etc/proftpd/proftpd.conf.orig\n            cat <<- _EOT_ >> /etc/proftpd/proftpd.conf\n                TimesGMT off\n                <Global>\n                    RootLogin on\n                    UseFtpUsers on\n                </Global>\n_EOT_\n        fi\n        #----------------------------------------------------------------------\n        if [ ! -f /etc/ftpusers.orig ]; then\n            sed -i.orig /etc/ftpusers \\\n                -e 's/root/# &/' \\\n                -e '$a master'\n        fi\n        #----------------------------------------------------------------------\n        /etc/init.d/proftpd restart\n        systemctl restart proftpd\n        funcPause $?\n    else                                    # Install vsftpd\n        touch /etc/vsftpd.chroot_list       # chroot\u3092\u8a31\u53ef\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30b9\u30c8\n        touch /etc/vsftpd.user_list         # \u63a5\u7d9a\u62d2\u5426\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30b9\u30c8\n        touch /etc/vsftpd.banned_emails     # \u63a5\u7d9a\u62d2\u5426\u3059\u308b\u96fb\u5b50\u30e1\u30fc\u30eb\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30ea\u30b9\u30c8\n        touch /etc/vsftpd.email_passwords   # \u533f\u540d\u30ed\u30b0\u30a4\u30f3\u7528\u306e\u96fb\u5b50\u30e1\u30fc\u30eb\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30ea\u30b9\u30c8\n        #----------------------------------------------------------------------\n        chmod 0600 /etc/vsftpd.chroot_list \\\n                   /etc/vsftpd.user_list \\\n                   /etc/vsftpd.banned_emails \\\n                   /etc/vsftpd.email_passwords\n        #----------------------------------------------------------------------\n        if [ ! -f /etc/vsftpd.conf.orig ]; then\n            sed -i.orig /etc/vsftpd.conf \\\n                -e 's/^listen=.*$/listen=YES/' \\\n                -e 's/^listen_ipv6=.*$/listen_ipv6=NO/' \\\n                -e 's/^anonymous_enable=.*$/anonymous_enable=NO/' \\\n                -e 's/^local_enable=.*$/local_enable=YES/' \\\n                -e 's/^#write_enable=.*$/write_enable=YES/' \\\n                -e 's/^#local_umask=.*$/local_umask=022/' \\\n                -e 's/^dirmessage_enable=.*$/dirmessage_enable=NO/' \\\n                -e 's/^use_localtime=.*$/use_localtime=YES/' \\\n                -e 's/^xferlog_enable=.*$/xferlog_enable=YES/' \\\n                -e 's/^connect_from_port_20=.*$/connect_from_port_20=YES/' \\\n                -e 's/^#xferlog_std_format=.*$/xferlog_std_format=NO/' \\\n                -e 's/^#idle_session_timeout=.*$/idle_session_timeout=300/' \\\n                -e 's/^#data_connection_timeout=.*$/data_connection_timeout=30/' \\\n                -e 's/^#ascii_upload_enable=.*$/ascii_upload_enable=YES/' \\\n                -e 's/^#ascii_download_enable=.*$/ascii_download_enable=YES/' \\\n                -e 's/^#chroot_local_user=.*$/chroot_local_user=NO/' \\\n                -e 's/^#chroot_list_enable=.*$/chroot_list_enable=NO/' \\\n                -e 's/^#chroot_list_file=.*$/chroot_list_file=\\/etc\\/vsftpd.chroot_list/' \\\n                -e 's/^#ls_recurse_enable=.*$/ls_recurse_enable=YES/' \\\n                -e 's/^pam_service_name=.*$/pam_service_name=vsftpd/' \\\n                -e '$atcp_wrappers=YES' \\\n                -e '$auserlist_enable=YES' \\\n                -e '$auserlist_deny=YES' \\\n                -e '$auserlist_file=\\/etc\\/vsftpd.user_list' \\\n                -e '$achmod_enable=YES' \\\n                -e '$aforce_dot_files=YES' \\\n                -e '$adownload_enable=YES'\\\n                -e '$avsftpd_log_file=\\/var\\/log\\/vsftpd\\.log' \\\n                -e '$adual_log_enable=NO' \\\n                -e '$asyslog_enable=NO' \\\n                -e '$alog_ftp_protocol=NO' \\\n                -e '$aftp_data_port=20' \\\n                -e '$apasv_enable=YES'\n        fi\n        #----------------------------------------------------------------------\n#       /etc/init.d/vsftpd restart\n        systemctl restart vsftpd\n        funcPause $?\n    fi\n\n#------------------------------------------------------------------------------\n# Install bind9\n#------------------------------------------------------------------------------\n    cat <<- _EOT_ > /var/cache/bind/${WGP_NAME}.zone\n        \\$TTL 3600\n        \\$ORIGIN ${WGP_NAME}.\n        @                               IN      SOA     ${SVR_NAME}. root.${SVR_NAME}. (\n                                                1\n                                                1800\n                                                900\n                                                86400\n                                                1200 )\n                                        IN      NS      ${SVR_NAME}\n                                        IN      NS      ${GWR_NAME}\n        ${SVR_NAME}                     IN      A       ${NIC_ADDR}\n        ${GWR_NAME}                     IN      A       ${NIC_GATE}\n_EOT_\n    #--------------------------------------------------------------------------\n    cat <<- _EOT_ > /var/cache/bind/${WGP_NAME}.rev\n        \\$TTL 3600\n        \\$ORIGIN ${REV_IPAD}.in-addr.arpa.\n        @                               IN      SOA     ${SVR_NAME}.${WGP_NAME}. root.${SVR_NAME}.${WGP_NAME}. (\n                                                1\n                                                1800\n                                                900\n                                                86400\n                                                1200 )\n                                        IN      NS      ${SVR_NAME}.${WGP_NAME}.\n                                        IN      NS      ${GWR_NAME}.${WGP_NAME}.\n        ${SVR_ADDR}                             IN      PTR     ${SVR_NAME}.${WGP_NAME}.\n        ${GWR_ADDR}                             IN      PTR     ${GWR_NAME}.${WGP_NAME}.\n_EOT_\n    #--------------------------------------------------------------------------\n    cat <<- _EOT_ >> /etc/bind/named.conf.local\n        zone \"${WGP_NAME}\" {\n            type master;\n            file \"${WGP_NAME}.zone\";\n            allow-update { lan; };\n        };\n\n        zone \"${REV_IPAD}.in-addr.arpa\" {\n            type master;\n            file \"${WGP_NAME}.rev\";\n            allow-update { lan; };\n        };\n_EOT_\n    #--------------------------------------------------------------------------\n    cat <<- _EOT_ >> /etc/bind/named.conf.options\n        acl lan {\n            127.0.0.1;\n            ${NIC_NTWK}/${NIC_BITS};\n        };\n_EOT_\n    if [ \"${NWK_NAME}\" = \"\" ]; then\n        sed -i.orig /var/cache/bind/${WGP_NAME}.zone -e \"/NS\\t.${SVR_NAME}/d\" -e \"/^${SVR_NAME}/d\"\n        sed -i.orig /var/cache/bind/${WGP_NAME}.rev  -e \"/NS\\t.${SVR_NAME}/d\" -e \"/PTR\\t.${SVR_NAME}/d\"\n    fi\n\n#   /etc/init.d/bind9 restart\n    systemctl restart bind9\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Install dhcp\n#------------------------------------------------------------------------------\n    cat <<- _EOT_ > /etc/dhcp/dhcpd.conf\n        subnet ${NIC_NTWK} netmask ${NIC_MASK} {\n            option time-servers ntp.nict.jp;\n            option domain-name-servers ${NIC_ADDR}, ${NIC_GATE};\n            option domain-name \"${WGP_NAME}\";\n            range ${ADR_DHCP};\n            option routers ${NIC_GATE};\n            option subnet-mask ${NIC_MASK};\n            option broadcast-address ${NIC_BCST};\n            option netbios-dd-server ${NIC_ADDR};\n            default-lease-time 3600;\n            max-lease-time 86400;\n        }\n\n_EOT_\n\n    if [ ${FLG_DHCP} -ne 0 ]; then\n#       insserv -d isc-dhcp-server\n#       /etc/init.d/isc-dhcp-server start\n        systemctl enable isc-dhcp-server;   funcPause $?\n        systemctl enable isc-dhcp-server6;  funcPause $?\n        systemctl restart isc-dhcp-server;  funcPause $?\n        systemctl restart isc-dhcp-server6; funcPause $?\n    else\n#       /etc/init.d/isc-dhcp-server stop\n#       insserv -r isc-dhcp-server\n        systemctl disable isc-dhcp-server; #funcPause $?\n        systemctl disable isc-dhcp-server6;#funcPause $?\n        systemctl stop isc-dhcp-server;    #funcPause $?\n        systemctl stop isc-dhcp-server6;   #funcPause $?\n    fi\n\n#------------------------------------------------------------------------------\n# Install Webmin\n#------------------------------------------------------------------------------\n    while :\n    do\n        if [ -f \"${DIR_WK}/${SET_WMIN}\" ]; then\n            break\n        fi\n\n        if [ \"${SET_WMIN}\" = \"webmin-current.deb\" ]; then\n            wget \"http://www.webmin.com/download/deb/webmin-current.deb\"\n        else\n            wget \"http://prdownloads.sourceforge.net/webadmin/${SET_WMIN}\"\n        fi\n        sleep 1s\n    done\n\n    if [ \"${SET_WMIN}\" = \"webmin-current.deb\" ]; then\n        dpkg -i webmin-current.deb\n    else\n        dpkg -i webmin_${VER_WMIN}_all.deb\n    fi\n    #--------------------------------------------------------------------------\n    if [ ! -f /etc/webmin/config.orig ]; then\n        cp -p /etc/webmin/config /etc/webmin/config.orig\n        cat <<- _EOT_ >> /etc/webmin/config\n            webprefix=\n            lang_root=ja_JP.UTF-8\n_EOT_\n    fi\n    #--------------------------------------------------------------------------\n    if [ ! -f /etc/webmin/time/config.orig ]; then\n        cp -p /etc/webmin/time/config /etc/webmin/time/config.orig\n        cat <<- _EOT_ >> /etc/webmin/time/config\n            timeserver=ntp.nict.jp\n_EOT_\n    fi\n\n    /etc/init.d/webmin restart\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Add smb.conf\n#------------------------------------------------------------------------------\n    cat <<- _EOT_ > ${SMB_WORK}\n        # Samba config file created using SWAT\n        # from ${SVR_NAME} (${NIC_ADDR})\n        # Date: `date +\"%Y/%m/%d/ %H:%M:%S\"`\n\n        [global]\n            dos charset = CP932\n            workgroup = ${WGP_NAME}\n            security = USER\n            pam password change = Yes\n            unix password sync = Yes\n            load printers = No\n            printcap name = /dev/null\n            add user script = /usr/sbin/useradd %u\n            delete user script = /usr/sbin/userdel %u\n            add group script = /usr/sbin/groupadd %g\n            delete group script = /usr/sbin/groupdel %g\n            add user to group script = /usr/bin/gpasswd -a %u %g\n            delete user from group script = /usr/bin/gpasswd -d %u %g\n            add machine script = /usr/sbin/useradd -d /dev/null -s /bin/false %u\n            logon script = logon.bat\n            logon path = \\\\\\\\%L\\\\profiles\\\\%U\n            domain logons = Yes\n            os level = 35\n            preferred master = Yes\n            domain master = Yes\n            wins support = Yes\n            idmap config * : backend = tdb\n            admin users = administrator\n            printing = bsd\n\n        [homes]\n            comment = Home Directories\n            valid users = %S\n            write list = @sambashare\n            create mask = 0700\n            directory mask = 0700\n            browseable = No\n\n        [netlogon]\n            comment = Network Logon Service\n            path = /share/data/adm/netlogon\n            write list = @sambashare\n            force user = sambauser\n            force group = sambashare\n            create mask = 0770\n            directory mask = 0770\n            browseable = No\n\n        [profiles]\n            comment = Users profiles\n            path = /share/data/adm/profiles\n            write list = @sambashare\n            create mask = 0600\n            directory mask = 0700\n            profile acls = Yes\n            browseable = No\n\n        [share]\n            comment = Shared directories\n            path = /share\n            force user = sambauser\n            force group = sambashare\n            create mask = 0770\n            directory mask = 0770\n            browseable = No\n\n        [data]\n            comment = Data directories\n            path = /share/data\n            write list = @sambashare\n            force user = sambauser\n            force group = sambashare\n            create mask = 0770\n            directory mask = 0770\n            browseable = No\n\n        [dlna]\n            comment = DLNA directories\n            path = /share/dlna\n            write list = @sambashare\n            force user = sambauser\n            force group = sambashare\n            create mask = 0770\n            directory mask = 0770\n            browseable = No\n\n        [pub]\n            comment = Public directories\n            path = /share/data/pub\n            force user = sambauser\n            force group = sambashare\n            create mask = 0770\n            directory mask = 0770\n\n_EOT_\n\n    if [ ! -f ${SMB_BACK} ]; then\n        cp -p ${SMB_CONF} ${SMB_BACK}\n        cat ${SMB_WORK} > ${SMB_CONF}\n    fi\n\n#   testparm -s\n    /etc/init.d/samba restart\n#   systemctl restart samba\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Make User file (${DIR_WK}/addusers.txt\u304c\u6709\u308c\u3070\u305d\u308c\u3092\u4f7f\u3046)\n#------------------------------------------------------------------------------\n    rm -f ${USR_FILE}\n    rm -f ${SMB_FILE}\n    touch ${USR_FILE}\n    touch ${SMB_FILE}\n\n    if [ ! -f ${LST_USER} ]; then\n        # Make User List File -------------------------------------------------\n        cat <<- _EOT_ > ${USR_FILE}\n            Administrator:Administrator:1001:\n_EOT_\n\n        # Make Samba User List File (pdbedit -L -w \u306b\u3066\u51fa\u529b\u3055\u308c\u305f\u3082\u306e) --------\n        cat <<- _EOT_ > ${SMB_FILE}\n            administrator:1001:E52CAC67419A9A224A3B108F3FA6CB6D:8846F7EAEE8FB117AD06BDD830B7586C:[U          ]:LCT-56BC0BA1:\n_EOT_\n    else\n        while read LINE\n        do\n            USERNAME=`echo ${LINE} | awk -F : '{print $1;}' | tr '[A-Z]' '[a-z]'`\n            FULLNAME=`echo ${LINE} | awk -F : '{print $2;}'`\n            USERIDNO=`echo ${LINE} | awk -F : '{print $3;}'`\n            PASSWORD=`echo ${LINE} | awk -F : '{print $4;}'`\n            LMPASSWD=`echo ${LINE} | awk -F : '{print $5;}'`\n            NTPASSWD=`echo ${LINE} | awk -F : '{print $6;}'`\n            ACNTFLAG=`echo ${LINE} | awk -F : '{print $7;}'`\n            CHNGTIME=`echo ${LINE} | awk -F : '{print $8;}'`\n\n            echo \"${USERNAME}:${FULLNAME}:${USERIDNO}:${PASSWORD}\"                          >> ${USR_FILE}\n            echo \"${USERNAME}:${USERIDNO}:${LMPASSWD}:${NTPASSWD}:${ACNTFLAG}:${CHNGTIME}:\" >> ${SMB_FILE}\n        done < ${LST_USER}\n    fi\n\n#------------------------------------------------------------------------------\n# Setup Login User\n#------------------------------------------------------------------------------\n    while read LINE\n    do\n        USERNAME=`echo ${LINE} | awk -F : '{print $1;}' | tr '[A-Z]' '[a-z]'`\n        FULLNAME=`echo ${LINE} | awk -F : '{print $2;}'`\n        USERIDNO=`echo ${LINE} | awk -F : '{print $3;}'`\n        PASSWORD=`echo ${LINE} | awk -F : '{print $4;}'`\n        # Account name to be deleted ------------------------------------------\n        id ${USERNAME}\n        if [ $? -eq 0 ]; then\n            chown -R ${USERNAME}:${USERNAME} /share/data/usr/${USERNAME}\n            userdel -r ${USERNAME}\n            rm -Rf /share/data/usr/${USERNAME}\n        fi\n        # Add users -----------------------------------------------------------\n        useradd -b /share/data/usr -m -c \"${FULLNAME}\" -G ${SMB_GRUP} -u ${USERIDNO} ${USERNAME}\n        # Make user dir -------------------------------------------------------\n#       mkdir -p /share/data/usr/${USERNAME}\n        mkdir -p /share/data/usr/${USERNAME}/app\n        mkdir -p /share/data/usr/${USERNAME}/dat\n        mkdir -p /share/data/usr/${USERNAME}/web\n        mkdir -p /share/data/usr/${USERNAME}/web/public_html\n        touch -f /share/data/usr/${USERNAME}/web/public_html/index.html\n        # Change user dir mode ------------------------------------------------\n#       chmod -R 1777 /share/data/usr/${USERNAME}\n        chown -R ${USERNAME}:${USERNAME} /share/data/usr/${USERNAME}/.\n    done < ${USR_FILE}\n\n#------------------------------------------------------------------------------\n# Setup Samba User\n#------------------------------------------------------------------------------\n    SMB_PWDB=`find /var/lib/samba/ -name passdb.tdb -print`\n    USR_LIST=`pdbedit -L | awk -F : '{print $1;}'`\n    for USR_NAME in ${USR_LIST}\n    do\n        pdbedit -x -u ${USR_NAME}\n    done\n    pdbedit -i smbpasswd:${SMB_FILE} -e tdbsam:${SMB_PWDB}\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# Cron (tar -cz * | xxd -ps \u306b\u3066\u51fa\u529b\u3055\u308c\u305f\u3082\u306e)\n#------------------------------------------------------------------------------\n    cat <<- _EOT_ > ${TGZ_WORK}\n        1f8b0800b99a15580003ed1c6b73d3c696afd6afd88ae402651c3d2c272d\n        8cb913e24052a284899df63294318eadc41e123b63c92929d733c4be81f0\n        6ab92d84b6d0c7a510e8034a6f1f40a1f05f50e424ffe2eeea6549961c39\n        f891dcea0c43acf539bb678f76cf9e97b78f0d1feced3b3276b48b4fed68\n        1290107a1846fe0bc1f29722699ade41d14c301808f474d3b09da218b27b\n        07209bc59011f2bc10cf01b02397cd0ab5f036fa7e9bc2ce3788f1748618\n        8ff3296c67830193fff9c4d275b1f81fb178472cfd205dbde2dbe7eb332c\n        3a15a9fcddd76ba53fcbcbc5b5e5798821161f8bc5a762e99c58fac6482f\n        ce3f144b57c552492cfe24166fa30fa51b6a17d2c25de9fc1fd2c59b6090\n        38841a7c83c347c7a2b037f961642caa3fa186953f6f9517afae9d5df0c1\n        b677ba06856cdef44df9c6dd95679fc1ef68920a10e45b04cd68bc5e7bba\n        76bf28fd7cb7fce057b5770080820f1458bdb008348073962e5c513eaba4\n        e716a4874f119d5f0750f5c1f6b106a0fe2abc02b8b5bad0fe02cadc7476\n        ca4b8fd6963f56e6a892300445d62291ce2faf5e3db7b67c69f5e6afe2fc\n        0d13554ffd541441d63b5690202982724db55bba73a17cfd91f4f08bd517\n        dfe9ad7b5067c720102c4b84c395ce4e9b0034e1c5347863613bc1ab6b97\n        5f5d3bdbe27ff2b84569f1cbf2adafa5cb4b8ad4e5c66b6d6006eb022793\n        e95c263ecd810ef22401d54adf08cb8e0c23b53291cf240633690174506d\n        1697585294d72fed16d74ea0e8476961512c9d178bdf8aa51f911e2dc1c7\n        ef919692b70b0665180b0f8ec6908a0e111f6473a7888e33a8f19d9183b1\n        c170014ab74b69e81b1b8d1d63d8f0001b29a0eeab55b33a65f432588ee7\n        e3931cc05910018771803b61e318367d0abe57e09f01ca381a3705700010\n        496e96c8e4a7a6007de06f1436da1fed0b873afe8e61e909701ce2cb0d05\n        e0cfc03571263a3ad65f0027f60b292e83f94c5cf48351300ab9a8211245\n        47ae423df2e4c9ea6fc5953fceedd6fadf8363bedc34f04fa81c0ef51d89\n        1d1a1ceab7e1d0c79d46abf0cca1dea1487f019b4863d84c9e4f2501518d\n        0b655897a88ec3b3fb040ea9e4431c1932fec4871300b7888d183f158308\n        5dc2e487b8cf87c38ff00f1a10fc13081c07fc716d1a2387956960f5bdb2\n        e39c90807c6ccc05c453b9f0e1f0f3c66cd42b9054769a73291184aa3383\n        1e1acfcd547adc253310537b3df063e339c9ce082e3981981a27f063a317\n        0a32a35dad1484a8bf1df4d07899f0ee770f6fd83ebcabfd533733dc543a\n        933fed961f055b6109579ff086f3948ae7dcee26195717117a68828c72b3\n        6eb9c9cdeabce4669bc0c91cef9693395ee7648e6f3c27793ee7921388a9\n        71023f367a63c32e093ee56a6b4354b85c0cbc40c286afddd9b85bb9404c\n        8d17f87163b9cc6467923647b74bf61443026fb34daa70d16e831489ac3f\n        93c4540b49b6d6b0764744fe5a60f4999a35c606f13f8a62023ba8004906\n        0314d31d50e27f34e9c5ff5a01ed8aff551c75dbf89fb4f0f3fad92f34fd\n        d4ecf09e1affda26e1bddab13ac7f05ebd81bac685dc6067dd888500590f\n        0bff27813ad783bb6511a87bc320eec68f22c78ad02b59fded6af9ab5bea\n        30e8800e91981cc908d1c120421b188944877bd97ee9e325e9c50d3978a4\n        35854ea6b2bc80c2732795e8905dcca942868cb2c170c818d24364ef8c1c\n        048361039e12860a9d843a8b5311a1b5c67349e0e7c02e9e78bfabebcd0e\n        82d82553af7efc42ba751f6edef2e745a58fdd6861b16c383c30c0b291c8\n        1ecc12c9820cc40568c2eded3cd639dd99ec1ce8643b2378adced4553a30\n        b08f65f7197b0cf746fb63d1412409bd4fa2739ae84c82ce817d9dec3e4b\n        c7376fc1be5ffd6bc93059d4cd7bfdfd4762c323954e3ec0558142393e97\n        a5b97134efbd91d1232142989e4194bd4787c4d203d53235aae77ae28343\n        283c082d66622a9b38054df89a1d9ba8b56859c8608e0f216bbc2ace88ba\n        c60d1d171fd5c7e2c8618dc5493387c54735d8536d7d137b23876dd8ab0e\n        83428e2771e5e52ccb2fe777f8ffea278fa4db25d39966095d8f4546d513\n        31c94d34516bac2fdd6eaed640c16ef4f69fc9937fa2be2d79ceeef5b04d\n        d706ef6af71e7006f3c195119f026ce4702c128d843a28634bf41fd15007\n        8d613ebb2dabbe0015bdceadeae312a9ace6459ae80ac0b43ae458b4ca5d\n        019c00fbd447c85a0177762e6547d7925f791db999e487d22146e145868e\n        22d691f090a8d6972e49f72e595ea0256a1e89f68e46e5a839e24ca1c065\n        6a21179fd1448b3e835d4a7c1cb704c8f12ad7793f50fdc0fdc012a11f06\n        6134d6f3c7d2e2efaadfbc1f98c2e9bb000568100054506642baf3c5faf9\n        2b6bbf3d962e5d174bf362f19ea28a309f9c1db065e7c47ea0a4071cf203\n        862e35dfdd6789e9fb5050df8716bf8dea534d319f9ed3b028bd6a814001\n        66f389940bd161be4afec3b77102c47e8635b876cc7db84e7e6892524875\n        49292ba5f65ad36228ebf31f491f3d53b5ff858beb9fdfd1f344b0a79597\n        0fcb0fbe851b5c9cbf4cad9ffd797de9d3956777579e5c8446b95c2d6028\n        1e287ea2d0633e02459d90e33391ce248145cfe350784831e355fafe4d59\n        bd03ffb49086dfef0d428be3349750624c8a44ce14c0fbfb9bf39eaae5e0\n        f87a5429bf174f0bda9e9447853352373d9ce41b21803b2e7f4df8150268\n        6125a4170bd05143ef9f9fe238949ed3bee59d3a50c697ce5d81ca42e32c\n        c709f95c468ff8c84acf18916a84c653751e542b8aca73d89dda8270abac\n        944345e6b5f6ead5b5976a46ab513f485d5e7c26162f4a67efd80b82cde6\n        334203e5a01c9da853a3ee8766508c1d8ec6c2fdef1a0e4fad7568f88872\n        802a6a53de2186ef0ad09ee285bd13b0d3a48b1564a454a6577eb228cebf\n        84cb819be23948383e752a6d1a04b265abee8cfba8e646d25872c39338ff\n        93f4e033682640cf539c7f21cedf148b9f8a678b668da7b2ea7e92152de5\n        f34da30660c1b2999e697e6e348583aeb0e3c75999eb73733fb9ca5188b6\n        b4f29f796fab1adf0be86e69e863c38746fb23037d43bd6cb342c0b5e3bf\n        244377533b28ba9ba1292648534114ffed61bcfacf9640bbe2bfc645e754\n        027a5b2cfd225bf1cbb2a3ff03aa0885169d964943010078f296165b1120\n        26bb09f2eded102026df22c82041bfb555eb3f1b1c56869d9181bf6058b9\n        9dc963affeb32e716da1fa4ff73ab566e1669dbd401358f7b7d3d94c3ac1\n        017f020480dea8346500f576a56d22c7f1a9c4541cfa65fe649c9bce66fc\n        99ac909e9883cfd009af8475114e7cb6828f5c7450bb84e3b58b46ab67ea\n        645c2b96b5b318cd9da8463532a4bdf210af3ca4050075263b32361c6d62\n        f9c7c6f67f80b2fefe2be0d9ffad8176d9ffdaa2732cff28dfbaa066f8e0\n        d952fc490ee57e850e1c74f22cb6b43284eade0e86bfc6eb5635fc21154d\n        d0b4f7c3afd7d9519ee1ffca33fceb16975a052de7ae7709dcf44c3617cf\n        cd810f72698103422a97cd4fa6768103289d732ca2c4dfdfa50a9b22a337\n        4716d81c1963cd9854921da66c029c8d258e0d1b9c70692b2eed8c1bb0e2\n        069c71192b2e6cf0ec7ccfce6f2b40d5391a3936dcd746fbbf870a0650fc\n        9f0ed0540fa3d9ff5efd774ba05df6bfb6e85cd8ff860abff65cffa086d4\n        7bb68317b089f03ff9b692dd702451ce32b1f4a562cd20f70b5ad9377fd5\n        c99161efec0e38911362f1a55c3af15ff93dda15741a868163903d041574\n        1c465ec77c0af80f007d498bf33f98fa08102474439cf305cc4038bc7aed\n        be2d194d393b210e65676b2fff942e7e53e924b8595fab85577350ce4ba7\n        05099da07c3b886b1676e7f8b94c422cfd5b2c7d2797e3c0d5f4d273fb1a\n        6c257a6e5f5de2da426e9f5a786efca988b1f0cbea2261c6faaf2a77093d\n        a112c9c8685f0827949f78eb8de14834642d1253515ec343537ff4ebd247\n        73c4b6f5d21cb1edfd343953f486eb5a38dbb4d1cacb2f51a1d9c2a23caa\n        58bc2fabade7e0b8638f275eeb9e11541dab8e68634b959e2b5680fa5e2c\n        a57eea4b2d38cdc95c1ca661031655396be57d35925f766495823963adb4\n        9999a654d6da31b351e9b39be26cdbe267d7e2306703cd56f465a4906bde\n        ad638fbda954ac7cc8027f7c16f8075036969be20488e4e74e27a6f2492e\n        54f5920c5f193787010fea900251356fdc92b7c52d895bbc0199db2ac16c\n        26735bdd8997b9359e3c5e4467bb00b4a1c68ea21f31b5edf7ff2413ec41\n        f19f20d3d34d316afc870904bdf84f2ba05df11f7dd139157f3eaedcffd9\n        9e9acfa01c6f20b743d047e3d575d0c7738a5ffba0f59ce2bac4b5859ce2\n        0d754bedda4757c4463b3b3e23f8273901e467e45f16b7bc34f1b8998113\n        0d2955acead4600057cddc3f07d12673f1647b672f73d0f0e9abbd6e30ff\n        649a17fced1782918d064bc2dcb5e70f1995ced6f5874c174f34690c645e\n        743bdbff01b22758b9ff2b28dbffdddefd5fad8126daff8ee6bff9b2137b\n        fbbff6ed292dba116c6b677c4d178239e7faeccb3e6bdec12fa7412f2cae\n        3cbb5ebef7992913bab922ce4ddcfea5dcc2b217d76e61c14f3a52af9dff\n        5eba74bd9dce4dc3774ea3afe6b1dc47d4ccbbc3d0793f163928db0757d1\n        ae2f3eb5cf3fbd4b85703960ce27c729dcd04eebed09537b406f4f9ada19\n        bd9da370b7c30f0da3e1a7330234d68cc30f0dd39576dad81ea8b4078ced\n        4ca59d81c31b2a2851966c8e27c695fbb192e388cb748223f8049f8e4173\n        e914f126918827525c4c989be17003296d214db8270d584893ee49190b29\n        b71169bb0f2f0f3cf0c0030f3cf0c0030f3cf0c0030f3cf0c015fc0fdaff\n        b27500780000\n_EOT_\n\n    pushd /usr/sh\n    xxd -r -p ${TGZ_WORK} | tar -xz\n    funcPause $?\n    ls -al\n    popd\n\n#------------------------------------------------------------------------------\n# Cron\n#------------------------------------------------------------------------------\n    cat <<- _EOT_ > ${CRN_FILE}\n        SHELL = /bin/bash\n        PATH = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n        # @reboot /sbin/sysctl -p\n        0 0,3,6,9,12,15,18,21 * * * /usr/sbin/ntpdate -s ntp.nict.jp\n        # @reboot /usr/sh/CMDMOUNT.sh\n        # @reboot /usr/sh/CMDBACKUP.sh\n        # 0 1 * * * /usr/sh/CMDUPDATE.sh\n        # 0 2 * * * /usr/sh/CMDFRESHCLAM.sh\n        # 0 3 * * * /usr/sh/CMDRSYNC.sh\n_EOT_\n\n    crontab ${CRN_FILE}\n    funcPause $?\n\n#------------------------------------------------------------------------------\n# GRUB\n# \u6ce8)\u89e3\u50cf\u5ea6\u304c\u9ad8\u304f\u306a\u3089\u306a\u3044\u5834\u5408\u306f.vmx\u306bsvga.minVRAMSize = 8388608\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\u3002\n#------------------------------------------------------------------------------\n    if [ ! -f /etc/default/grub.orig ]; then\n        sed -i.orig /etc/default/grub \\\n            -e 's/^GRUB_CMDLINE_LINUX_DEFAULT/#&/' \\\n            -e \"s/#GRUB_GFXMODE=640x480/GRUB_GFXPAYLOAD_LINUX=${VGA_RESO}\\nGRUB_GFXMODE=${VGA_RESO}/\"\n\n        update-grub\n        funcPause $?\n    fi\n\n#------------------------------------------------------------------------------\n# Disable IPv6\n#------------------------------------------------------------------------------\n#   if [ ! -f /etc/sysctl.conf.orig ]; then\n#       cp -p /etc/sysctl.conf /etc/sysctl.conf.orig\n#       cat <<- _EOT_ >> /etc/sysctl.conf\n#           # -----------------------------------------------------------------------------\n#           # Disable IPv6\n#           net.ipv6.conf.all.disable_ipv6 = 1\n#           net.ipv6.conf.default.disable_ipv6 = 1\n#           net.ipv6.conf.lo.disable_ipv6 = 1\n#           # -----------------------------------------------------------------------------\n#_EOT_\n#   fi\n#\n#   sysctl -p\n#   ifconfig\n#   ip a show\n#\n#------------------------------------------------------------------------------\n# Install VMware Tools\n#------------------------------------------------------------------------------\n    if [ ${FLG_VMTL} -ne 0 ]; then\n#       KNL_VER=`uname -r | awk -F \".\" '{print $1;}'`\n#       if [ ${KNL_VER} -ge 4 ]; then\n            ${CMD_AGET} install open-vm-tools open-vm-tools-desktop\n            funcPause $?\n            mkdir -p /mnt/hgfs\n            if [ ! -f /etc/fstab.vmware ]; then\n                cp -p /etc/fstab /etc/fstab.vmware\n                which vmhgfs-fuse\n                if [ $? -eq 0 ]; then\n                    HGFS_FS=\"fuse.vmhgfs-fuse\"\n                else\n                    HGFS_FS=\"vmhgfs\"\n                fi\n                cat <<- _EOT_ >> /etc/fstab\n                    .host:/ /mnt/hgfs ${HGFS_FS} allow_other,auto_unmount,defaults 0 0\n_EOT_\n            fi\n#       else\n#           if [ ! -d /usr/src/linux-headers-`uname -r` ]; then\n#               ${CMD_AGET} install linux-headers-`uname -r`\n#               funcPause $?\n#           fi\n#           VMW_CD=${MNT_CD}/VMwareTools-*.tar.gz\n#           while :\n#           do\n#               if [ ! -f ${VMW_CD} ]; then\n#                   echo \"VMware Tools\u30c7\u30a3\u30b9\u30af\u3092\u633f\u5165\u3057Enter\u30ad\u30fc\u3092\u62bc\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n#                   read DUMMY\n#                   mount ${DEV_CD} ${MNT_CD}\n#               fi\n#\n#               tar -xzf ${VMW_CD}\n#               if [ $? -eq 0 ]; then\n#                   umount ${MNT_CD}\n#                   break\n#               fi\n#           done\n#\n#           ${DIR_WK}/vmware-tools-distrib/vmware-install.pl -d -f\n#           funcPause $?\n#       fi\n    fi\n\n#------------------------------------------------------------------------------\n# Backup\n#------------------------------------------------------------------------------\n    pushd /\n    tar -czf /work/bk_boot.tgz   boot\n    tar -czf /work/bk_etc.tgz    etc\n    tar -czf /work/bk_home.tgz   home\n    tar -czf /work/bk_share.tgz  share\n    tar -czf /work/bk_usr_sh.tgz usr/sh\n    tar -czf /work/bk_bind.tgz   var/cache/bind/\n    tar -czf /work/bk_cron.tgz   var/spool/cron/crontabs\n    popd\n\n#------------------------------------------------------------------------------\n# RAID Status\n#------------------------------------------------------------------------------\n    if [ -f /proc/mdstat ]; then\n        cat /proc/mdstat\n    fi\n\n#------------------------------------------------------------------------------\n# Termination\n#------------------------------------------------------------------------------\n    rm -f ${TGZ_WORK}\n    rm -f ${CRN_FILE}\n    rm -f ${USR_FILE}\n    rm -f ${SMB_FILE}\n    rm -f ${SMB_WORK}\n    popd\n\n#   systemctl list-unit-files -t service\n#   systemctl -t service\n\n#------------------------------------------------------------------------------\n# Exit\n#------------------------------------------------------------------------------\n    exit 0\n\n###############################################################################\n# memo                                                                        #\n###############################################################################\n# for %I in (*.*) do fc /b \"%~nxI\" \"V:\\Application\\FreeWare\\win32\\%~nxI\"\n# for /d %I in (\"r:\\My Documents\\Download\\dlc\\*.*\") do robocopy /l /mov /xo \"%~fI\" \"r:\\My Documents\\Download\\update\"\n# apt-get update && apt-get -y upgrade && apt-get -y dist-upgrade\n#==============================================================================\n# End of file                                                                 =\n#==============================================================================\n\n```\n#!/bin/bash\n###############################################################################\n##\n##\t\u30d5\u30a1\u30a4\u30eb\u540d\t:\tinstall_vmware-preseed_cfg.sh\n##\n##\t\u6a5f\u80fd\u6982\u8981\t:\tDebian & Ubuntu Install\u7528\u30b7\u30a7\u30eb [VMware\u5bfe\u5fdc]\n##\n##\t\u5165\u51fa\u529b I/F\n##\t\tINPUT\t:\t\n##\t\tOUTPUT\t:\t\n##\n##\t\u4f5c\u6210\u8005\t\t:\tJ.Itou\n##\n##\t\u4f5c\u6210\u65e5\u4ed8\t:\t2014/11/02\n##\n##\t\u6539\u8a02\u5c65\u6b74\t:\t\n##\t   \u65e5\u4ed8       \u7248         \u540d\u524d      \u6539\u8a02\u5185\u5bb9\n##\t---------- -------- -------------- ----------------------------------------\n##\t2014/11/02 000.0000 J.Itou         \u65b0\u898f\u4f5c\u6210\n##\t2016/10/12 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(preseed.cfg\u306b\u7279\u5316)\n##\t2016/10/15 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u30d8\u30c3\u30c0\u30fc\u306e\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6761\u4ef6\u8ffd\u52a0)\n##\t2016/10/16 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u5404\u7a2e\u6761\u4ef6\u8ffd\u52a0\u5909\u66f4)\n##\t2016/10/17 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(smb.conf)\n##\t2016/10/26 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(smb.conf)\n##\t2016/10/30 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(\u5404\u7a2e\u8a2d\u5b9a\u5909\u66f4)\n##\t2016/11/05 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(VMware-Tools)\n##\t2016/11/06 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057(vsftpd)\n##\tYYYY/MM/DD 000.0000 xxxxxxxxxxxxxx \n###############################################################################\n#set -nvx\n\n# Pause\u51e6\u7406 -------------------------------------------------------------------\nfuncPause() {\n\tRET_STS=$1\n\n\tif [ ${RET_STS} -ne 0 ]; then\n\t\techo \"Enter\u30ad\u30fc\u3092\u62bc\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n\t\tread DUMMY\n\tfi\n}\n\n#------------------------------------------------------------------------------\n# Initialize\n#------------------------------------------------------------------------------\n\tNOW_TIME=`date +\"%Y%m%d%H%M%S\"`\n\tPGM_NAME=`basename $0 | sed -e 's/\\..*$//'`\n\tDBG_FLAG=${DBG_FLAG:-0}\n\tif [ ${DBG_FLAG} -ne 0 ]; then\n\t\tset -vx\n\tfi\n\n\tWHO_AMI=`whoami`\n\tif [ \"${WHO_AMI}\" != \"root\" ]; then\n\t\techo \"root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n\t\texit 1\n\tfi\n\n#\tWHO_USER=`who | awk '$1!=\"root\" {print $1;}'`\n#\tif [ \"${WHO_USER}\" != \"\" ]; then\n#\t\techo \"${WHO_USER}\u304c\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u307e\u3059\u3002\"\n#\t\techo \"\u5168\u3066\u306e\u30e6\u30fc\u30b6\u30fc\u3092\u30ed\u30b0\u30a2\u30a6\u30c8\u3057\u3066\u304b\u3089\u3001\"\n#\t\techo \"root\u30e6\u30fc\u30b6\u30fc\u3067\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u5b9f\u884c\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n#\t\texit 1\n#\tfi\n\n\t# \u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u306b\u5408\u308f\u305b\u3066\u5909\u66f4\u3059\u308b\u90e8\u5206 --------------------------------------\n\tSVR_NAME=`hostname`\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u672c\u6a5f\u306e\u540d\u524d\n\tGWR_NAME=gw-router\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306e\u540d\u524d\n\tWGP_NAME=vmware\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30ef\u30fc\u30af\u30b0\u30eb\u30fc\u30d7\u540d\n#\tDEF_USER=master\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u6642\u306b\u4f5c\u6210\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u540d\n\tNUM_HDDS=1\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5148\u306eHDD\u53f0\u6570\n\tFLG_DHCP=0\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# DHCP\u81ea\u52d5\u8d77\u52d5\u30d5\u30e9\u30b0(0\u4ee5\u5916\u3067\u81ea\u52d5\u8d77\u52d5)\n#\tFLG_VMTL=1\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n#\tFLG_SVER=1\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# 0\u4ee5\u5916\u3067\u30b5\u30fc\u30d0\u30fc\u4ed5\u69d8\u3067\u30bb\u30c3\u30c6\u30a3\u30f3\u30b0\n#\tVER_WMIN=1.820\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# webmin\u306e\u6700\u65b0\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u767b\u9332\n#\tVGA_RESO=1024x768x32\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30b3\u30f3\u30bd\u30fc\u30eb\u306e\u89e3\u50cf\u5ea6\uff1a1024\u00d7768\uff1a1600\u4e07\u8272\n\tVGA_RESO=1280x1024x32\t\t\t\t\t\t\t\t\t\t\t\t\t\t#   \u3003              \uff1a1280\u00d71024\uff1a1600\u4e07\u8272\n\tIP6_ADDR=\"fe80::\"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u63a5\u7d9a\u8a31\u53ef\u3059\u308bIPv6\u30a2\u30c9\u30ec\u30b9\n\tIP6_MASK=\"64\"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t#   \u3003            \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n\tSMB_USER=sambauser\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# smb.conf\u306eforce user\n\tSMB_GRUP=sambashare\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# smb.conf\u306eforce group\n\n\t# \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8IP\u30a2\u30c9\u30ec\u30b9 --------------------------------------------------\n\t# \u30af\u30e9\u30b9  | \u4f7f\u7528\u3067\u304d\u308bIP\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2       | \u4f7f\u7528\u3067\u304d\u308b\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\u7bc4\u56f2\n\t# \u30af\u30e9\u30b9A | 10.0.0.0 \uff5e 10.255.255.255     | 255.0.0.0 \uff5e 255.255.255.255\uff08\u6700\u592716,777,214\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n\t# \u30af\u30e9\u30b9B | 172.16.0.0 \uff5e 172.31.255.255   | 255.255.0.0 \uff5e 255.255.255.255\uff08\u6700\u592765,534\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n\t# \u30af\u30e9\u30b9C | 192.168.0.0 \uff5e 192.168.255.255 | 255.255.255.0 \uff5e 255.255.255.255\uff08\u6700\u5927254\u53f0\u63a5\u7d9a\u304c\u53ef\u80fd\uff09\n\t#\n\t#  8 | 11111111.00000000.00000000.00000000 | 255.0.0.0\n\t# 16 | 11111111.11111111.00000000.00000000 | 255.255.0.0\n\t# 24 | 11111111.11111111.11111111.00000000 | 255.255.255.0\n\n\tNWK_NAME=`awk '$4==\"static\" {print $2;}' /etc/network/interfaces`\n\n\tNIC_NAME=`ip a show | awk -F \"[ :]\" '$1==\"2\" {print $3;}'`\t\t\t\t\t# NIC\u30c7\u30d0\u30a4\u30b9\u540d\n\tNIC_INET=`ip a show dev ${NIC_NAME} | awk '$1==\"inet\" {print $2;}'`\t\t\t# IP\u30a2\u30c9\u30ec\u30b9/\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n\tNIC_ADDR=`echo ${NIC_INET} | awk -F / '{print $1;}'`\t\t\t\t\t\t# IP\u30a2\u30c9\u30ec\u30b9\n\tNIC_BITS=`echo ${NIC_INET} | awk -F / '{print $2;}'`\t\t\t\t\t\t# \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af(bit)\n\tNIC_IPAD=`echo ${NIC_ADDR} | awk -F . '{printf\"%s.%s.%s\", $1,$2,$3;}'`\t\t# \u672c\u6a5f\u306e\u5c5e\u3059\u308b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30fb\u30a2\u30c9\u30ec\u30b9\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\n\tcase \"${NIC_BITS}\" in\n\t\t24 ) NIC_MASK=\"255.255.255.0\" ;;\n\t\t16 ) NIC_MASK=\"255.255.0.0\" ;;\n\t\t 8 ) NIC_MASK=\"255.0.0.0\" ;;\n\t\t * ) echo \"\u30b5\u30d6\u30cd\u30c3\u30c8\u30de\u30b9\u30af\u304c\u8a2d\u5b9a\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002\"\n\t\t\t exit 1\n\t\t\t ;;\n\tesac\n\n\tNIC_NTWK=${NIC_IPAD}.0\t\t\t\t\t\t\t\t\t\t\t\t\t\t# \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30a2\u30c9\u30ec\u30b9\n\tNIC_BCST=`ip a show dev ${NIC_NAME} | awk '$1==\"inet\" {print $4;}'`\t\t\t# \u30d6\u30ed\u30fc\u30c9\u30ad\u30e3\u30b9\u30c8\u30a2\u30c9\u30ec\u30b9\n\tNIC_GATE=`route -n | awk '$1==\"0.0.0.0\" {print $2;}'`\t\t\t\t\t\t# \u30c7\u30d5\u30a9\u30eb\u30c8\u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\n#\tNIC_DADR=`awk '$1==\"nameserver\" {print $2;}' /etc/resolv.conf`\t\t\t\t# DNS \u30b5\u30fc\u30d0\u306e\u30a2\u30c9\u30ec\u30b9\n#\tNIC_DNAM=`awk '$1==\"search\" {print $2;}' /etc/resolv.conf`\t\t\t\t\t# DNS \u691c\u7d22\u3067\u512a\u5148\u3059\u308b\u30c9\u30e1\u30a4\u30f3\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\n\n\tREV_IPAD=`echo ${NIC_ADDR} | awk -F . '{printf\"%s.%s.%s\", $3,$2,$1;}'`\t\t# BIND\u7528\n\tSVR_ADDR=`echo ${NIC_ADDR} | awk -F . '{print $4;}'`\t\t\t\t\t\t# \u672c\u6a5f\u306eIP\u30a2\u30c9\u30ec\u30b9\n\tGWR_ADDR=`echo ${NIC_GATE} | awk -F . '{print $4;}'`\t\t\t\t\t\t# \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u306eIP\u30a2\u30c9\u30ec\u30b9\n\n\tADR_DHCP=\"${NIC_IPAD}.64 ${NIC_IPAD}.79\"\t\t\t\t\t\t\t\t\t# DHCP\u306e\u63d0\u4f9b\u30a2\u30c9\u30ec\u30b9\u7bc4\u56f2\n\n\t# \u30ef\u30fc\u30af\u5909\u6570\u8a2d\u5b9a ----------------------------------------------------------\n\tDST_NAME=`awk '/[A-Za-z]./ {print $1;}' /etc/issue | head -n 1 | tr '[A-Z]' '[a-z]'`\n\n\tif [ \"${SVR_NAME}\" = \"\" ]; then\n\t\tif [ ${FLG_SVER} -ne 0 ]; then\n\t\t\tSVR_NAME=sv-${DST_NAME}\n\t\telse\n\t\t\tSVR_NAME=ws-${DST_NAME}\n\t\tfi\n\tfi\n\n\tif [ \"`echo ${PGM_NAME} | grep -i vmware`\" = \"\" ]; then\n\t\tFLG_VMTL=0\t\t\t\t\t\t\t\t# 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\telse\n\t\tFLG_VMTL=1\t\t\t\t\t\t\t\t# 0\u4ee5\u5916\u3067VMware Tools\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\tfi\n\n\tif [ \"${VER_WMIN}\" = \"\" ]; then\n\t\tSET_WMIN=\"webmin-current.deb\"\n\telse\n\t\tSET_WMIN=\"webmin_${VER_WMIN}_all.deb\"\n\tfi\n\n#\tMNT_FD=/media/floppy0\n#\tMNT_CD=/media/cdrom0\n\tMNT_CD=/media\n\tDEV_CD=/dev/sr0\n\n\tDIR_WK=/work\n\tLST_USER=${DIR_WK}/addusers.txt\n#\tLOG_FILE=${DIR_WK}/${PGM_NAME}.sh.${NOW_TIME}.log\n\tTGZ_WORK=${DIR_WK}/${PGM_NAME}.sh.tgz\n\tCRN_FILE=${DIR_WK}/${PGM_NAME}.sh.crn\n\tUSR_FILE=${DIR_WK}/${PGM_NAME}.sh.usr.list\n\tSMB_FILE=${DIR_WK}/${PGM_NAME}.sh.smb.list\n\tSMB_WORK=${DIR_WK}/${PGM_NAME}.sh.smb.work\n\tSMB_CONF=/etc/samba/smb.conf\n\tSMB_BACK=${SMB_CONF}.orig\n\n\tDEV_NUM1=sda\n\tDEV_NUM2=sdb\n\tDEV_NUM3=sdc\n\tDEV_NUM4=sdd\n\tDEV_NUM5=sde\n\tDEV_NUM6=sdf\n\tDEV_NUM7=sdg\n\tDEV_NUM8=sdh\n\n\tcase \"${NUM_HDDS}\" in\n\t\t# HDD 1\u53f0 -------------------------------------------------------------\n\t\t1 )\tDEV_HDD1=/dev/${DEV_NUM1}\n\t\t\tDEV_HDD2=\n\t\t\tDEV_HDD3=\n\t\t\tDEV_HDD4=\n\n\t\t\tDEV_USB1=/dev/${DEV_NUM2}\n\t\t\tDEV_USB2=/dev/${DEV_NUM3}\n\t\t\tDEV_USB3=/dev/${DEV_NUM4}\n\t\t\tDEV_USB4=/dev/${DEV_NUM5}\n\t\t\t;;\n\t\t# HDD 2\u53f0 -------------------------------------------------------------\n\t\t2 )\tDEV_HDD1=/dev/${DEV_NUM1}\n\t\t\tDEV_HDD2=/dev/${DEV_NUM2}\n\t\t\tDEV_HDD3=\n\t\t\tDEV_HDD4=\n\n\t\t\tDEV_USB1=/dev/${DEV_NUM3}\n\t\t\tDEV_USB2=/dev/${DEV_NUM4}\n\t\t\tDEV_USB3=/dev/${DEV_NUM5}\n\t\t\tDEV_USB4=/dev/${DEV_NUM6}\n\t\t\t;;\n\t\t# HDD 4\u53f0 ~ -----------------------------------------------------------\n\t\t* )\tDEV_HDD1=/dev/${DEV_NUM1}\n\t\t\tDEV_HDD2=/dev/${DEV_NUM2}\n\t\t\tDEV_HDD3=/dev/${DEV_NUM3}\n\t\t\tDEV_HDD4=/dev/${DEV_NUM4}\n\n\t\t\tDEV_USB1=/dev/${DEV_NUM5}\n\t\t\tDEV_USB2=/dev/${DEV_NUM6}\n\t\t\tDEV_USB3=/dev/${DEV_NUM7}\n\t\t\tDEV_USB4=/dev/${DEV_NUM8}\n\t\t\t;;\n\tesac\n\n\tDEV_RATE=\"${DEV_USB1} ${DEV_USB2} ${DEV_USB3} ${DEV_USB4}\"\n\tDEV_TEMP=\"${DEV_HDD1} ${DEV_HDD2} ${DEV_HDD3} ${DEV_HDD4} ${DEV_RATE}\"\n\n\tCMD_AGET=\"apt-get -y -q\"\n\n#------------------------------------------------------------------------------\n# Make work dir\n#------------------------------------------------------------------------------\n\tmkdir -p ${DIR_WK}\n\tchmod 700 ${DIR_WK}\n\tpushd ${DIR_WK}\n\n#------------------------------------------------------------------------------\n# System Update\n#------------------------------------------------------------------------------\n\t${CMD_AGET} update\n\t${CMD_AGET} upgrade\n\t${CMD_AGET} dist-upgrade\n\n#------------------------------------------------------------------------------\n# UDEV Rules\n#------------------------------------------------------------------------------\n#\tif [ ! -f /etc/udev/rules.d/11-media-auto-mount.rules ]; then\n#\t\tcat <<- _EOT_ > /etc/udev/rules.d/11-media-auto-mount.rules\n#\t\t\tKERNEL!=\"sd[b-z][0-9]\", GOTO=\"media_auto_mount_end\"\n#\t\t\tACTION==\"add\", RUN+=\"/bin/mkdir -p /media/usb-%k\"\n#\n#\t\t\t# Global mount options\n#\t\t\tACTION==\"add\", ENV{mount_options}=\"relatime,users\"\n#\t\t\t# Filesystem specific options\n#\t\t\tACTION==\"add\", PROGRAM==\"/lib/initcpio/udev/vol_id -t %N\", RESULT==\"vfat|ntfs\", ENV{mount_options}=\"$env{mount_options},utf8,gid=100,umask=002\"\n#\n#\t\t\tACTION==\"add\", RUN+=\"/bin/mount -o $env{mount_options} /dev/%k /media/usb-%k\"\n#\t\t\tACTION==\"remove\", RUN+=\"/bin/umount -l /media/usb-%k\", RUN+=\"/bin/rmdir /media/usb-%k\"\n#\t\t\tLABEL=\"media_auto_mount_end\"\n#_EOT_\n#\tfi\n#\n#\tudevadm control --reload\n#\tudevadm trigger\n#\n#------------------------------------------------------------------------------\n# Locale Setup\n#------------------------------------------------------------------------------\n\tif [ ! -f ~/.vimrc ]; then\n\t\tcat <<- _EOT_ > ~/.vimrc\n\t\t\tset number\n\t\t\tset tabstop=4\n\t\t\tset list\n\t\t\tset listchars=tab:>_\n_EOT_\n\tfi\n\n\tif [ ! -f ~/.bashrc.orig ]; then\n\t\tlocale | sed -e 's/LANG=C/LANG=ja_JP.UTF-8/' \\\n\t\t\t\t\t -e 's/LANGUAGE=$/LANGUAGE=ja:en/' \\\n\t\t\t\t\t -e 's/\"C\"/\"ja_JP.UTF-8\"/' > /etc/locale.conf\n\t\tfuncPause $?\n\t\t#----------------------------------------------------------------------\n\t\tcp -p ~/.bashrc ~/.bashrc.orig\n\t\tcat <<- _EOT_ >> ~/.bashrc\n\t\t\t#\n\t\t\tcase \"\\${TERM}\" in\n\t\t\t    \"linux\" )\n\t\t\t        LANG=C\n\t\t\t        ;;\n\t\t\t    * )\n\t\t\t        LANG=ja_JP.UTF-8\n\t\t\t        ;;\n\t\t\tesac\n\t\t\texport LANG\n_EOT_\n\t\t. ~/.profile\n\tfi\n\n#------------------------------------------------------------------------------\n# Network Setup\n#------------------------------------------------------------------------------\n\t# hosts.allow -------------------------------------------------------------\n\tif [ ! -f /etc/hosts.allow.orig ]; then\n\t\tcp -p /etc/resolv.conf /etc/hosts.allow.orig\n\t\tcat <<- _EOT_ >> /etc/hosts.allow\n\t\t\tALL: 127.0.0.1 ${NIC_IPAD}. [${IP6_ADDR}]/${IP6_MASK}\n_EOT_\n\tfi\n\t# hosts.deny --------------------------------------------------------------\n\tif [ ! -f /etc/hosts.deny.orig ]; then\n\t\tcp -p /etc/resolv.conf /etc/hosts.deny.orig\n\t\tcat <<- _EOT_ >> /etc/hosts.deny\n\t\t\tALL: ALL\n_EOT_\n\tfi\n\n#------------------------------------------------------------------------------\n# Make share dir\n#------------------------------------------------------------------------------\n\tcat /etc/group | grep ${SMB_GRUP}\n\tif [ $? -ne 0 ]; then\n\t\tgroupadd --system \"${SMB_GRUP}\"\n\tfi\n\n\tid ${SMB_USER}\n\tif [ $? -ne 0 ]; then\n\t\tuseradd --system \"${SMB_USER}\" --groups \"${SMB_GRUP}\"\n\tfi\n\n\tusermod root -G ${SMB_GRUP}\n\n\tmkdir -p /share\n\tmkdir -p /share/data\n\tmkdir -p /share/data/adm\n\tmkdir -p /share/data/adm/netlogon\n\tmkdir -p /share/data/adm/profiles\n\tmkdir -p /share/data/bak\n\tmkdir -p /share/data/pub\n\tmkdir -p /share/data/usr\n\tmkdir -p /share/dlna\n\tmkdir -p /share/dlna/movies\n\tmkdir -p /share/dlna/others\n\tmkdir -p /share/dlna/photos\n\tmkdir -p /share/dlna/sounds\n\n\ttouch -f /share/data/adm/netlogon/logon.bat\n\n\tchown -R ${SMB_USER}:${SMB_GRUP} /share/.\n\tchmod -R  770 /share/.\n\tchmod    1777 /share/data/adm/profiles\n\n#------------------------------------------------------------------------------\n# Move home dir\n#------------------------------------------------------------------------------\n\tuseradd -D -b /share/data/usr\n#\tusermod -d /share/data/usr/${DEF_USER} -m ${DEF_USER}\n#\tusermod ${DEF_USER} -G ${SMB_GRUP}\n#\tusermod -L ${DEF_USER}\n\n#------------------------------------------------------------------------------\n# Make shell dir\n#------------------------------------------------------------------------------\n\tmkdir -p /usr/sh\n\tmkdir -p /var/log/sh\n\n\tcat <<- _EOT_ > /usr/sh/USRCOMMON.def\n\t\t#!/bin/bash\n\t\t###############################################################################\n\t\t##\n\t\t##\t\u30d5\u30a1\u30a4\u30eb\u540d\t:\tUSRCOMMON.def\n\t\t##\n\t\t##\t\u6a5f\u80fd\u6982\u8981\t:\t\u30e6\u30fc\u30b6\u30fc\u74b0\u5883\u5171\u901a\u51e6\u7406\n\t\t##\n\t\t##\t\u5165\u51fa\u529b I/F\n\t\t##\t\tINPUT\t:\t\n\t\t##\t\tOUTPUT\t:\t\n\t\t##\n\t\t##\t\u4f5c\u6210\u8005\t\t:\tJ.Itou\n\t\t##\n\t\t##\t\u4f5c\u6210\u65e5\u4ed8\t:\t2014/10/27\n\t\t##\n\t\t##\t\u6539\u8a02\u5c65\u6b74\t:\t\n\t\t##\t   \u65e5\u4ed8       \u7248         \u540d\u524d      \u6539\u8a02\u5185\u5bb9\n\t\t##\t---------- -------- -------------- ----------------------------------------\n\t\t##\t2013/10/27 000.0000 J.Itou         \u65b0\u898f\u4f5c\u6210\n\t\t##\t2014/11/04 000.0000 J.Itou         4HDD\u7248\u4ed5\u69d8\u5909\u66f4\n\t\t##\t2014/12/22 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057\n\t\t##\t2016/10/30 000.0000 J.Itou         \u51e6\u7406\u898b\u76f4\u3057\n\t\t##\t`date +\"%Y/%m/%d\"` 000.0000 J.Itou         \u81ea\u52d5\u4f5c\u6210\n\t\t##\tYYYY/MM/DD 000.0000 xxxxxxxxxxxxxx \n\t\t##\t---------- -------- -------------- ----------------------------------------\n\t\t###############################################################################\n\n\t\t#------------------------------------------------------------------------------\n\t\t# \u30e6\u30fc\u30b6\u30fc\u5909\u6570\u5b9a\u7fa9\n\t\t#------------------------------------------------------------------------------\n\n\t\t# USB\u30c7\u30d0\u30a4\u30b9\u5909\u6570\u5b9a\u7fa9\n\t\tAPL_MNT_DV1=\"${DEV_USB1}1\"\n\t\tAPL_MNT_DV2=\"${DEV_USB2}1\"\n\t\tAPL_MNT_DV3=\"${DEV_USB3}1\"\n\t\tAPL_MNT_DV4=\"${DEV_USB4}1\"\n\n\t\t# USB\u30c7\u30d0\u30a4\u30b9\u5909\u6570\u5b9a\u7fa9\n\t\tAPL_MNT_LN1=\"/mnt/usb1\"\n\t\tAPL_MNT_LN2=\"/mnt/usb2\"\n\t\tAPL_MNT_LN3=\"/mnt/usb3\"\n\t\tAPL_MNT_LN4=\"/mnt/usb4\"\n\n\t\tSYS_MNT_DV1=\"/sys/block/`echo ${DEV_USB1} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n\t\tSYS_MNT_DV2=\"/sys/block/`echo ${DEV_USB2} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n\t\tSYS_MNT_DV3=\"/sys/block/`echo ${DEV_USB3} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n\t\tSYS_MNT_DV4=\"/sys/block/`echo ${DEV_USB4} | awk -F/ '{print $3}'`/device/scsi_disk/*/cache_type\"\n_EOT_\n\n#------------------------------------------------------------------------------\n# Make floppy dir\n#------------------------------------------------------------------------------\n#\tif [ ! -d /media/floppy0 ]; then\n#\t\tpushd /media\n#\t\tmkdir floppy0\n#\t\tln -s floppy0 floppy\n#\t\tpopd\n#\tfi\n#\n#------------------------------------------------------------------------------\n# Make cd-rom dir\n#------------------------------------------------------------------------------\n#\tif [ ! -d /media/cdrom0 ]; then\n#\t\tpushd /media\n#\t\tmkdir cdrom0\n#\t\tln -s cdrom0 cdrom\n#\t\tpopd\n#\tfi\n#\n#------------------------------------------------------------------------------\n# Make usb dir\n#------------------------------------------------------------------------------\n#\tmkdir -p /mnt/cdrom\n#\tmkdir -p /mnt/floppy\n#\tmkdir -p /mnt/usb1\n#\tmkdir -p /mnt/usb2\n#\tmkdir -p /mnt/usb3\n#\tmkdir -p /mnt/usb4\n#\t#--------------------------------------------------------------------------\n#\tif [ ! -f /etc/fstab.orig ]; then\n#\t\tcp -p /etc/fstab /etc/fstab.orig\n#\t\tunexpand -a -t 4 /etc/fstab.orig > /etc/fstab\n#\t\tcat <<- _EOT_ >> /etc/fstab\n#\t\t\t# additional devices --------------------------------------------------------------------------------------------------\n#\t\t\t# <file system>\t\t\t\t\t\t\t\t\t<mount point>\t<type>\t\t\t<options>\t\t\t\t<dump>\t<pass>\n#\t\t\t# /dev/sr0\t\t\t\t\t\t\t\t\t\t/media/cdrom0\tudf,iso9660\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# /dev/fd0\t\t\t\t\t\t\t\t\t\t/media/floppy0\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# /dev/sr0\t\t\t\t\t\t\t\t\t\t/mnt/cdrom\t\tudf,iso9660\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# /dev/fd0\t\t\t\t\t\t\t\t\t\t/mnt/floppy\t\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# ${DEV_USB1}1\t\t\t\t\t\t\t\t\t\t/mnt/usb1\t\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# ${DEV_USB2}1\t\t\t\t\t\t\t\t\t\t/mnt/usb2\t\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# ${DEV_USB3}1\t\t\t\t\t\t\t\t\t\t/mnt/usb3\t\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#\t\t\t# ${DEV_USB4}1\t\t\t\t\t\t\t\t\t\t/mnt/usb4\t\tauto\t\t\trw,user,noauto\t\t\t0\t\t0\n#_EOT_\n#\t\tvi /etc/fstab\n#\tfi\n#\n#------------------------------------------------------------------------------\n# Install clamav\n#------------------------------------------------------------------------------\n\tif [ ! -f /etc/clamav/freshclam.conf.orig ]; then\n\t\tsed -i.orig /etc/clamav/freshclam.conf \\\n\t\t\t-e 's/# Check for new database 24 times a day/# Check for new database 4 times a day/' \\\n\t\t\t-e 's/Checks 24/Checks 4/' \\\n\t\t\t-e 's/^NotifyClamd/#&/'\n\tfi\n\n#------------------------------------------------------------------------------\n# Install ssh\n#------------------------------------------------------------------------------\n\tif [ ! -f /etc/ssh/sshd_config.orig ]; then\n\t\tsed -i.orig /etc/ssh/sshd_config \\\n\t\t\t-e 's/^PermitRootLogin .*/PermitRootLogin yes/' \\\n\t\t\t-e '$a UseDNS no'\n\tfi\n\n#\t/etc/init.d/ssh restart\n\tsystemctl restart sshd\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Install apache2\n#------------------------------------------------------------------------------\n\tif [ ! -f /etc/apache2/mods-available/userdir.conf.orig ]; then\n\t\tcp -p /etc/apache2/mods-available/userdir.conf /etc/apache2/mods-available/userdir.conf.orig\n\t\tcat <<- _EOT_ > /etc/apache2/mods-available/userdir.conf\n\t\t\t<IfModule mod_userdir.c>\n\t\t\t \tUserDir web/public_html\n\t\t\t \tUserDir disabled root\n\n\t\t\t \t<Directory /share/data/usr/*/web/public_html>\n\t\t\t \t\tAllowOverride FileInfo AuthConfig Limit Indexes\n\t\t\t \t\tOptions MultiViews Indexes SymLinksIfOwnerMatch IncludesNoExec\n\t\t\t \t\t<Limit GET POST OPTIONS>\n\t\t\t \t\t\tOrder allow,deny\n\t\t\t \t\t\tAllow from all\n\t\t\t \t\t</Limit>\n\t\t\t \t\t<LimitExcept GET POST OPTIONS>\n\t\t\t \t\t\tOrder deny,allow\n\t\t\t \t\t\tDeny from all\n\t\t\t \t\t</LimitExcept>\n\t\t\t \t</Directory>\n\t\t\t</IfModule>\n_EOT_\n\tfi\n\n\ta2enmod userdir\n#\t/etc/init.d/apache2 restart\n\tsystemctl restart apache2\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Install ftpd\n#------------------------------------------------------------------------------\n\twhich proftpd\n\tif [ $? -eq 0 ]; then\t\t\t\t\t# Install proftpd\n\t\tif [ ! -f /etc/proftpd/proftpd.conf.orig ]; then\n\t\t\tcp -p /etc/proftpd/proftpd.conf /etc/proftpd/proftpd.conf.orig\n\t\t\tcat <<- _EOT_ >> /etc/proftpd/proftpd.conf\n\t\t\t\tTimesGMT off\n\t\t\t\t<Global>\n\t\t\t\t \tRootLogin on\n\t\t\t\t \tUseFtpUsers on\n\t\t\t\t</Global>\n_EOT_\n\t\tfi\n\t\t#----------------------------------------------------------------------\n\t\tif [ ! -f /etc/ftpusers.orig ]; then\n\t\t\tsed -i.orig /etc/ftpusers \\\n\t\t\t\t-e 's/root/# &/' \\\n\t\t\t\t-e '$a master'\n\t\tfi\n\t\t#----------------------------------------------------------------------\n\t\t/etc/init.d/proftpd restart\n\t\tsystemctl restart proftpd\n\t\tfuncPause $?\n\telse\t\t\t\t\t\t\t\t\t# Install vsftpd\n\t\ttouch /etc/vsftpd.chroot_list\t\t# chroot\u3092\u8a31\u53ef\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30b9\u30c8\n\t\ttouch /etc/vsftpd.user_list\t\t\t# \u63a5\u7d9a\u62d2\u5426\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u30ea\u30b9\u30c8\n\t\ttouch /etc/vsftpd.banned_emails\t\t# \u63a5\u7d9a\u62d2\u5426\u3059\u308b\u96fb\u5b50\u30e1\u30fc\u30eb\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30ea\u30b9\u30c8\n\t\ttouch /etc/vsftpd.email_passwords\t# \u533f\u540d\u30ed\u30b0\u30a4\u30f3\u7528\u306e\u96fb\u5b50\u30e1\u30fc\u30eb\u30fb\u30d1\u30b9\u30ef\u30fc\u30c9\u306e\u30ea\u30b9\u30c8\n\t\t#----------------------------------------------------------------------\n\t\tchmod 0600 /etc/vsftpd.chroot_list \\\n\t\t\t\t   /etc/vsftpd.user_list \\\n\t\t\t\t   /etc/vsftpd.banned_emails \\\n\t\t\t\t   /etc/vsftpd.email_passwords\n\t\t#----------------------------------------------------------------------\n\t\tif [ ! -f /etc/vsftpd.conf.orig ]; then\n\t\t\tsed -i.orig /etc/vsftpd.conf \\\n\t\t\t\t-e 's/^listen=.*$/listen=YES/' \\\n\t\t\t\t-e 's/^listen_ipv6=.*$/listen_ipv6=NO/' \\\n\t\t\t\t-e 's/^anonymous_enable=.*$/anonymous_enable=NO/' \\\n\t\t\t\t-e 's/^local_enable=.*$/local_enable=YES/' \\\n\t\t\t\t-e 's/^#write_enable=.*$/write_enable=YES/' \\\n\t\t\t\t-e 's/^#local_umask=.*$/local_umask=022/' \\\n\t\t\t\t-e 's/^dirmessage_enable=.*$/dirmessage_enable=NO/' \\\n\t\t\t\t-e 's/^use_localtime=.*$/use_localtime=YES/' \\\n\t\t\t\t-e 's/^xferlog_enable=.*$/xferlog_enable=YES/' \\\n\t\t\t\t-e 's/^connect_from_port_20=.*$/connect_from_port_20=YES/' \\\n\t\t\t\t-e 's/^#xferlog_std_format=.*$/xferlog_std_format=NO/' \\\n\t\t\t\t-e 's/^#idle_session_timeout=.*$/idle_session_timeout=300/' \\\n\t\t\t\t-e 's/^#data_connection_timeout=.*$/data_connection_timeout=30/' \\\n\t\t\t\t-e 's/^#ascii_upload_enable=.*$/ascii_upload_enable=YES/' \\\n\t\t\t\t-e 's/^#ascii_download_enable=.*$/ascii_download_enable=YES/' \\\n\t\t\t\t-e 's/^#chroot_local_user=.*$/chroot_local_user=NO/' \\\n\t\t\t\t-e 's/^#chroot_list_enable=.*$/chroot_list_enable=NO/' \\\n\t\t\t\t-e 's/^#chroot_list_file=.*$/chroot_list_file=\\/etc\\/vsftpd.chroot_list/' \\\n\t\t\t\t-e 's/^#ls_recurse_enable=.*$/ls_recurse_enable=YES/' \\\n\t\t\t\t-e 's/^pam_service_name=.*$/pam_service_name=vsftpd/' \\\n\t\t\t\t-e '$atcp_wrappers=YES' \\\n\t\t\t\t-e '$auserlist_enable=YES' \\\n\t\t\t\t-e '$auserlist_deny=YES' \\\n\t\t\t\t-e '$auserlist_file=\\/etc\\/vsftpd.user_list' \\\n\t\t\t\t-e '$achmod_enable=YES' \\\n\t\t\t\t-e '$aforce_dot_files=YES' \\\n\t\t\t\t-e '$adownload_enable=YES'\\\n\t\t\t\t-e '$avsftpd_log_file=\\/var\\/log\\/vsftpd\\.log' \\\n\t\t\t\t-e '$adual_log_enable=NO' \\\n\t\t\t\t-e '$asyslog_enable=NO' \\\n\t\t\t\t-e '$alog_ftp_protocol=NO' \\\n\t\t\t\t-e '$aftp_data_port=20' \\\n\t\t\t\t-e '$apasv_enable=YES'\n\t\tfi\n\t\t#----------------------------------------------------------------------\n#\t\t/etc/init.d/vsftpd restart\n\t\tsystemctl restart vsftpd\n\t\tfuncPause $?\n\tfi\n\n#------------------------------------------------------------------------------\n# Install bind9\n#------------------------------------------------------------------------------\n\tcat <<- _EOT_ > /var/cache/bind/${WGP_NAME}.zone\n\t\t\\$TTL 3600\n\t\t\\$ORIGIN ${WGP_NAME}.\n\t\t@\t\t\t\t\t\t\t\tIN\t\tSOA\t\t${SVR_NAME}. root.${SVR_NAME}. (\n\t\t \t\t\t\t\t\t\t\t\t\t1\n\t\t \t\t\t\t\t\t\t\t\t\t1800\n\t\t \t\t\t\t\t\t\t\t\t\t900\n\t\t \t\t\t\t\t\t\t\t\t\t86400\n\t\t \t\t\t\t\t\t\t\t\t\t1200 )\n\t\t \t\t\t\t\t\t\t\tIN\t\tNS\t\t${SVR_NAME}\n\t\t \t\t\t\t\t\t\t\tIN\t\tNS\t\t${GWR_NAME}\n\t\t${SVR_NAME}\t\t\t\t\t\tIN\t\tA\t\t${NIC_ADDR}\n\t\t${GWR_NAME}\t\t\t\t\t\tIN\t\tA\t\t${NIC_GATE}\n_EOT_\n\t#--------------------------------------------------------------------------\n\tcat <<- _EOT_ > /var/cache/bind/${WGP_NAME}.rev\n\t\t\\$TTL 3600\n\t\t\\$ORIGIN ${REV_IPAD}.in-addr.arpa.\n\t\t@\t\t\t\t\t\t\t\tIN\t\tSOA\t\t${SVR_NAME}.${WGP_NAME}. root.${SVR_NAME}.${WGP_NAME}. (\n\t\t \t\t\t\t\t\t\t\t\t\t1\n\t\t \t\t\t\t\t\t\t\t\t\t1800\n\t\t \t\t\t\t\t\t\t\t\t\t900\n\t\t \t\t\t\t\t\t\t\t\t\t86400\n\t\t \t\t\t\t\t\t\t\t\t\t1200 )\n\t\t \t\t\t\t\t\t\t\tIN\t\tNS\t\t${SVR_NAME}.${WGP_NAME}.\n\t\t \t\t\t\t\t\t\t\tIN\t\tNS\t\t${GWR_NAME}.${WGP_NAME}.\n\t\t${SVR_ADDR}\t\t\t\t\t\t\t\tIN\t\tPTR\t\t${SVR_NAME}.${WGP_NAME}.\n\t\t${GWR_ADDR}\t\t\t\t\t\t\t\tIN\t\tPTR\t\t${GWR_NAME}.${WGP_NAME}.\n_EOT_\n\t#--------------------------------------------------------------------------\n\tcat <<- _EOT_ >> /etc/bind/named.conf.local\n\t\tzone \"${WGP_NAME}\" {\n\t\t \ttype master;\n\t\t \tfile \"${WGP_NAME}.zone\";\n\t\t \tallow-update { lan; };\n\t\t};\n\n\t\tzone \"${REV_IPAD}.in-addr.arpa\" {\n\t\t \ttype master;\n\t\t \tfile \"${WGP_NAME}.rev\";\n\t\t \tallow-update { lan; };\n\t\t};\n_EOT_\n\t#--------------------------------------------------------------------------\n\tcat <<- _EOT_ >> /etc/bind/named.conf.options\n\t\tacl lan {\n\t\t \t127.0.0.1;\n\t\t \t${NIC_NTWK}/${NIC_BITS};\n\t\t};\n_EOT_\n\tif [ \"${NWK_NAME}\" = \"\" ]; then\n\t\tsed -i.orig /var/cache/bind/${WGP_NAME}.zone -e \"/NS\\t.${SVR_NAME}/d\" -e \"/^${SVR_NAME}/d\"\n\t\tsed -i.orig /var/cache/bind/${WGP_NAME}.rev  -e \"/NS\\t.${SVR_NAME}/d\" -e \"/PTR\\t.${SVR_NAME}/d\"\n\tfi\n\n#\t/etc/init.d/bind9 restart\n\tsystemctl restart bind9\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Install dhcp\n#------------------------------------------------------------------------------\n\tcat <<- _EOT_ > /etc/dhcp/dhcpd.conf\n\t\tsubnet ${NIC_NTWK} netmask ${NIC_MASK} {\n\t\t \toption time-servers ntp.nict.jp;\n\t\t \toption domain-name-servers ${NIC_ADDR}, ${NIC_GATE};\n\t\t \toption domain-name \"${WGP_NAME}\";\n\t\t \trange ${ADR_DHCP};\n\t\t \toption routers ${NIC_GATE};\n\t\t \toption subnet-mask ${NIC_MASK};\n\t\t \toption broadcast-address ${NIC_BCST};\n\t\t \toption netbios-dd-server ${NIC_ADDR};\n\t\t \tdefault-lease-time 3600;\n\t\t \tmax-lease-time 86400;\n\t\t}\n\n_EOT_\n\n\tif [ ${FLG_DHCP} -ne 0 ]; then\n#\t\tinsserv -d isc-dhcp-server\n#\t\t/etc/init.d/isc-dhcp-server start\n\t\tsystemctl enable isc-dhcp-server;   funcPause $?\n\t\tsystemctl enable isc-dhcp-server6;  funcPause $?\n\t\tsystemctl restart isc-dhcp-server;  funcPause $?\n\t\tsystemctl restart isc-dhcp-server6; funcPause $?\n\telse\n#\t\t/etc/init.d/isc-dhcp-server stop\n#\t\tinsserv -r isc-dhcp-server\n\t\tsystemctl disable isc-dhcp-server; #funcPause $?\n\t\tsystemctl disable isc-dhcp-server6;#funcPause $?\n\t\tsystemctl stop isc-dhcp-server;    #funcPause $?\n\t\tsystemctl stop isc-dhcp-server6;   #funcPause $?\n\tfi\n\n#------------------------------------------------------------------------------\n# Install Webmin\n#------------------------------------------------------------------------------\n\twhile :\n\tdo\n\t\tif [ -f \"${DIR_WK}/${SET_WMIN}\" ]; then\n\t\t\tbreak\n\t\tfi\n\n\t\tif [ \"${SET_WMIN}\" = \"webmin-current.deb\" ]; then\n\t\t\twget \"http://www.webmin.com/download/deb/webmin-current.deb\"\n\t\telse\n\t\t\twget \"http://prdownloads.sourceforge.net/webadmin/${SET_WMIN}\"\n\t\tfi\n\t\tsleep 1s\n\tdone\n\n\tif [ \"${SET_WMIN}\" = \"webmin-current.deb\" ]; then\n\t\tdpkg -i webmin-current.deb\n\telse\n\t\tdpkg -i webmin_${VER_WMIN}_all.deb\n\tfi\n\t#--------------------------------------------------------------------------\n\tif [ ! -f /etc/webmin/config.orig ]; then\n\t\tcp -p /etc/webmin/config /etc/webmin/config.orig\n\t\tcat <<- _EOT_ >> /etc/webmin/config\n\t\t\twebprefix=\n\t\t\tlang_root=ja_JP.UTF-8\n_EOT_\n\tfi\n\t#--------------------------------------------------------------------------\n\tif [ ! -f /etc/webmin/time/config.orig ]; then\n\t\tcp -p /etc/webmin/time/config /etc/webmin/time/config.orig\n\t\tcat <<- _EOT_ >> /etc/webmin/time/config\n\t\t\ttimeserver=ntp.nict.jp\n_EOT_\n\tfi\n\n\t/etc/init.d/webmin restart\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Add smb.conf\n#------------------------------------------------------------------------------\n\tcat <<- _EOT_ > ${SMB_WORK}\n\t\t# Samba config file created using SWAT\n\t\t# from ${SVR_NAME} (${NIC_ADDR})\n\t\t# Date: `date +\"%Y/%m/%d/ %H:%M:%S\"`\n\n\t\t[global]\n\t\t \tdos charset = CP932\n\t\t \tworkgroup = ${WGP_NAME}\n\t\t \tsecurity = USER\n\t\t \tpam password change = Yes\n\t\t \tunix password sync = Yes\n\t\t \tload printers = No\n\t\t \tprintcap name = /dev/null\n\t\t \tadd user script = /usr/sbin/useradd %u\n\t\t \tdelete user script = /usr/sbin/userdel %u\n\t\t \tadd group script = /usr/sbin/groupadd %g\n\t\t \tdelete group script = /usr/sbin/groupdel %g\n\t\t \tadd user to group script = /usr/bin/gpasswd -a %u %g\n\t\t \tdelete user from group script = /usr/bin/gpasswd -d %u %g\n\t\t \tadd machine script = /usr/sbin/useradd -d /dev/null -s /bin/false %u\n\t\t \tlogon script = logon.bat\n\t\t \tlogon path = \\\\\\\\%L\\\\profiles\\\\%U\n\t\t \tdomain logons = Yes\n\t\t \tos level = 35\n\t\t \tpreferred master = Yes\n\t\t \tdomain master = Yes\n\t\t \twins support = Yes\n\t\t \tidmap config * : backend = tdb\n\t\t \tadmin users = administrator\n\t\t \tprinting = bsd\n\n\t\t[homes]\n\t\t \tcomment = Home Directories\n\t\t \tvalid users = %S\n\t\t \twrite list = @sambashare\n\t\t \tcreate mask = 0700\n\t\t \tdirectory mask = 0700\n\t\t \tbrowseable = No\n\n\t\t[netlogon]\n\t\t \tcomment = Network Logon Service\n\t\t \tpath = /share/data/adm/netlogon\n\t\t \twrite list = @sambashare\n\t\t \tforce user = sambauser\n\t\t \tforce group = sambashare\n\t\t \tcreate mask = 0770\n\t\t \tdirectory mask = 0770\n\t\t \tbrowseable = No\n\n\t\t[profiles]\n\t\t \tcomment = Users profiles\n\t\t \tpath = /share/data/adm/profiles\n\t\t \twrite list = @sambashare\n\t\t \tcreate mask = 0600\n\t\t \tdirectory mask = 0700\n\t\t \tprofile acls = Yes\n\t\t \tbrowseable = No\n\n\t\t[share]\n\t\t \tcomment = Shared directories\n\t\t \tpath = /share\n\t\t \tforce user = sambauser\n\t\t \tforce group = sambashare\n\t\t \tcreate mask = 0770\n\t\t \tdirectory mask = 0770\n\t\t \tbrowseable = No\n\n\t\t[data]\n\t\t \tcomment = Data directories\n\t\t \tpath = /share/data\n\t\t \twrite list = @sambashare\n\t\t \tforce user = sambauser\n\t\t \tforce group = sambashare\n\t\t \tcreate mask = 0770\n\t\t \tdirectory mask = 0770\n\t\t \tbrowseable = No\n\n\t\t[dlna]\n\t\t \tcomment = DLNA directories\n\t\t \tpath = /share/dlna\n\t\t \twrite list = @sambashare\n\t\t \tforce user = sambauser\n\t\t \tforce group = sambashare\n\t\t \tcreate mask = 0770\n\t\t \tdirectory mask = 0770\n\t\t \tbrowseable = No\n\n\t\t[pub]\n\t\t \tcomment = Public directories\n\t\t \tpath = /share/data/pub\n\t\t \tforce user = sambauser\n\t\t \tforce group = sambashare\n\t\t \tcreate mask = 0770\n\t\t \tdirectory mask = 0770\n\n_EOT_\n\n\tif [ ! -f ${SMB_BACK} ]; then\n\t\tcp -p ${SMB_CONF} ${SMB_BACK}\n\t\tcat ${SMB_WORK} > ${SMB_CONF}\n\tfi\n\n#\ttestparm -s\n\t/etc/init.d/samba restart\n#\tsystemctl restart samba\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Make User file (${DIR_WK}/addusers.txt\u304c\u6709\u308c\u3070\u305d\u308c\u3092\u4f7f\u3046)\n#------------------------------------------------------------------------------\n\trm -f ${USR_FILE}\n\trm -f ${SMB_FILE}\n\ttouch ${USR_FILE}\n\ttouch ${SMB_FILE}\n\n\tif [ ! -f ${LST_USER} ]; then\n\t\t# Make User List File -------------------------------------------------\n\t\tcat <<- _EOT_ > ${USR_FILE}\n\t\t\tAdministrator:Administrator:1001:\n_EOT_\n\n\t\t# Make Samba User List File (pdbedit -L -w \u306b\u3066\u51fa\u529b\u3055\u308c\u305f\u3082\u306e) --------\n\t\tcat <<- _EOT_ > ${SMB_FILE}\n\t\t\tadministrator:1001:E52CAC67419A9A224A3B108F3FA6CB6D:8846F7EAEE8FB117AD06BDD830B7586C:[U          ]:LCT-56BC0BA1:\n_EOT_\n\telse\n\t\twhile read LINE\n\t\tdo\n\t\t\tUSERNAME=`echo ${LINE} | awk -F : '{print $1;}' | tr '[A-Z]' '[a-z]'`\n\t\t\tFULLNAME=`echo ${LINE} | awk -F : '{print $2;}'`\n\t\t\tUSERIDNO=`echo ${LINE} | awk -F : '{print $3;}'`\n\t\t\tPASSWORD=`echo ${LINE} | awk -F : '{print $4;}'`\n\t\t\tLMPASSWD=`echo ${LINE} | awk -F : '{print $5;}'`\n\t\t\tNTPASSWD=`echo ${LINE} | awk -F : '{print $6;}'`\n\t\t\tACNTFLAG=`echo ${LINE} | awk -F : '{print $7;}'`\n\t\t\tCHNGTIME=`echo ${LINE} | awk -F : '{print $8;}'`\n\n\t\t\techo \"${USERNAME}:${FULLNAME}:${USERIDNO}:${PASSWORD}\"                          >> ${USR_FILE}\n\t\t\techo \"${USERNAME}:${USERIDNO}:${LMPASSWD}:${NTPASSWD}:${ACNTFLAG}:${CHNGTIME}:\" >> ${SMB_FILE}\n\t\tdone < ${LST_USER}\n\tfi\n\n#------------------------------------------------------------------------------\n# Setup Login User\n#------------------------------------------------------------------------------\n\twhile read LINE\n\tdo\n\t\tUSERNAME=`echo ${LINE} | awk -F : '{print $1;}' | tr '[A-Z]' '[a-z]'`\n\t\tFULLNAME=`echo ${LINE} | awk -F : '{print $2;}'`\n\t\tUSERIDNO=`echo ${LINE} | awk -F : '{print $3;}'`\n\t\tPASSWORD=`echo ${LINE} | awk -F : '{print $4;}'`\n\t\t# Account name to be deleted ------------------------------------------\n\t\tid ${USERNAME}\n\t\tif [ $? -eq 0 ]; then\n\t\t\tchown -R ${USERNAME}:${USERNAME} /share/data/usr/${USERNAME}\n\t\t\tuserdel -r ${USERNAME}\n\t\t\trm -Rf /share/data/usr/${USERNAME}\n\t\tfi\n\t\t# Add users -----------------------------------------------------------\n\t\tuseradd -b /share/data/usr -m -c \"${FULLNAME}\" -G ${SMB_GRUP} -u ${USERIDNO} ${USERNAME}\n\t\t# Make user dir -------------------------------------------------------\n#\t\tmkdir -p /share/data/usr/${USERNAME}\n\t\tmkdir -p /share/data/usr/${USERNAME}/app\n\t\tmkdir -p /share/data/usr/${USERNAME}/dat\n\t\tmkdir -p /share/data/usr/${USERNAME}/web\n\t\tmkdir -p /share/data/usr/${USERNAME}/web/public_html\n\t\ttouch -f /share/data/usr/${USERNAME}/web/public_html/index.html\n\t\t# Change user dir mode ------------------------------------------------\n#\t\tchmod -R 1777 /share/data/usr/${USERNAME}\n\t\tchown -R ${USERNAME}:${USERNAME} /share/data/usr/${USERNAME}/.\n\tdone < ${USR_FILE}\n\n#------------------------------------------------------------------------------\n# Setup Samba User\n#------------------------------------------------------------------------------\n\tSMB_PWDB=`find /var/lib/samba/ -name passdb.tdb -print`\n\tUSR_LIST=`pdbedit -L | awk -F : '{print $1;}'`\n\tfor USR_NAME in ${USR_LIST}\n\tdo\n\t\tpdbedit -x -u ${USR_NAME}\n\tdone\n\tpdbedit -i smbpasswd:${SMB_FILE} -e tdbsam:${SMB_PWDB}\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# Cron (tar -cz * | xxd -ps \u306b\u3066\u51fa\u529b\u3055\u308c\u305f\u3082\u306e)\n#------------------------------------------------------------------------------\n\tcat <<- _EOT_ > ${TGZ_WORK}\n\t\t1f8b0800b99a15580003ed1c6b73d3c696afd6afd88ae402651c3d2c272d\n\t\t8cb913e24052a284899df63294318eadc41e123b63c92929d733c4be81f0\n\t\t6ab92d84b6d0c7a510e8034a6f1f40a1f05f50e424ffe2eeea6549961c39\n\t\tf891dcea0c43acf539bb678f76cf9e97b78f0d1feced3b3276b48b4fed68\n\t\t1290107a1846fe0bc1f29722699ade41d14c301808f474d3b09da218b27b\n\t\t07209bc59011f2bc10cf01b02397cd0ab5f036fa7e9bc2ce3788f1748618\n\t\t8ff3296c67830193fff9c4d275b1f81fb178472cfd205dbde2dbe7eb332c\n\t\t3a15a9fcddd76ba53fcbcbc5b5e5798821161f8bc5a762e99c58fac6482f\n\t\tce3f144b57c552492cfe24166fa30fa51b6a17d2c25de9fc1fd2c59b6090\n\t\t38841a7c83c347c7a2b037f961642caa3fa186953f6f9517afae9d5df0c1\n\t\tb677ba06856cdef44df9c6dd95679fc1ef68920a10e45b04cd68bc5e7bba\n\t\t76bf28fd7cb7fce057b5770080820f1458bdb008348073962e5c513eaba4\n\t\te716a4874f119d5f0750f5c1f6b106a0fe2abc02b8b5bad0fe02cadc7476\n\t\tca4b8fd6963f56e6a892300445d62291ce2faf5e3db7b67c69f5e6afe2fc\n\t\t0d13554ffd541441d63b5690202982724db55bba73a17cfd91f4f08bd517\n\t\tdfe9ad7b5067c720102c4b84c395ce4e9b0034e1c5347863613bc1ab6b97\n\t\t5f5d3bdbe27ff2b84569f1cbf2adafa5cb4b8ad4e5c66b6d6006eb022793\n\t\te95c263ecd810ef22401d54adf08cb8e0c23b53291cf240633690174506d\n\t\t1697585294d72fed16d74ea0e8476961512c9d178bdf8aa51f911e2dc1c7\n\t\tef919692b70b0665180b0f8ec6908a0e111f6473a7888e33a8f19d9183b1\n\t\tc170014ab74b69e81b1b8d1d63d8f0001b29a0eeab55b33a65f432588ee7\n\t\te3931cc05910018771803b61e318367d0abe57e09f01ca381a3705700010\n\t\t496e96c8e4a7a6007de06f1436da1fed0b873afe8e61e909701ce2cb0d05\n\t\te0cfc03571263a3ad65f0027f60b292e83f94c5cf48351300ab9a8211245\n\t\t47ae423df2e4c9ea6fc5953fceedd6fadf8363bedc34f04fa81c0ef51d89\n\t\t1d1a1ceab7e1d0c79d46abf0cca1dea1487f019b4863d84c9e4f2501518d\n\t\t0b655897a88ec3b3fb040ea9e4431c1932fec4871300b7888d183f158308\n\t\t5dc2e487b8cf87c38ff00f1a10fc13081c07fc716d1a2387956960f5bdb2\n\t\te39c90807c6ccc05c453b9f0e1f0f3c66cd42b9054769a73291184aa3383\n\t\t1e1acfcd547adc253310537b3df063e339c9ce082e3981981a27f063a317\n\t\t0a32a35dad1484a8bf1df4d07899f0ee770f6fd83ebcabfd533733dc543a\n\t\t933fed961f055b6109579ff086f3948ae7dcee26195717117a68828c72b3\n\t\t6eb9c9cdeabce4669bc0c91cef9693395ee7648e6f3c27793ee7921388a9\n\t\t71023f367a63c32e093ee56a6b4354b85c0cbc40c286afddd9b85bb9404c\n\t\t8d17f87163b9cc6467923647b74bf61443026fb34daa70d16e831489ac3f\n\t\t93c4540b49b6d6b0764744fe5a60f4999a35c606f13f8a62023ba8004906\n\t\t0314d31d50e27f34e9c5ff5a01ed8aff551c75dbf89fb4f0f3fad92f34fd\n\t\td4ecf09e1affda26e1bddab13ac7f05ebd81bac685dc6067dd888500590f\n\t\t0bff27813ad783bb6511a87bc320eec68f22c78ad02b59fded6af9ab5bea\n\t\t30e8800e91981cc908d1c120421b188944877bd97ee9e325e9c50d3978a4\n\t\t35854ea6b2bc80c2732795e8905dcca942868cb2c170c818d24364ef8c1c\n\t\t048361039e12860a9d843a8b5311a1b5c67349e0e7c02e9e78bfabebcd0e\n\t\t82d82553af7efc42ba751f6edef2e745a58fdd6861b16c383c30c0b291c8\n\t\t1ecc12c9820cc40568c2eded3cd639dd99ec1ce8643b2378adced4553a30\n\t\tb08f65f7197b0cf746fb63d1412409bd4fa2739ae84c82ce817d9dec3e4b\n\t\tc7376fc1be5ffd6bc93059d4cd7bfdfd4762c323954e3ec0558142393e97\n\t\ta5b97134efbd91d1232142989e4194bd4787c4d203d53235aae77ae28343\n\t\t283c082d66622a9b38054df89a1d9ba8b56859c8608e0f216bbc2ace88ba\n\t\tc60d1d171fd5c7e2c8618dc5493387c54735d8536d7d137b23876dd8ab0e\n\t\t83428e2771e5e52ccb2fe777f8ffea278fa4db25d39966095d8f4546d513\n\t\t31c94d34516bac2fdd6eaed640c16ef4f69fc9937fa2be2d79ceeef5b04d\n\t\td706ef6af71e7006f3c195119f026ce4702c128d843a28634bf41fd15007\n\t\t8d613ebb2dabbe0015bdceadeae312a9ace6459ae80ac0b43ae458b4ca5d\n\t\t019c00fbd447c85a0177762e6547d7925f791db999e487d22146e145868e\n\t\t22d691f090a8d6972e49f72e595ea0256a1e89f68e46e5a839e24ca1c065\n\t\t6a21179fd1448b3e835d4a7c1cb704c8f12ad7793f50fdc0fdc012a11f06\n\t\t6134d6f3c7d2e2efaadfbc1f98c2e9bb000568100054506642baf3c5faf9\n\t\t2b6bbf3d962e5d174bf362f19ea28a309f9c1db065e7c47ea0a4071cf203\n\t\t862e35dfdd6789e9fb5050df8716bf8dea534d319f9ed3b028bd6a814001\n\t\t66f389940bd161be4afec3b77102c47e8635b876cc7db84e7e6892524875\n\t\t49292ba5f65ad36228ebf31f491f3d53b5ff858beb9fdfd1f344b0a79597\n\t\t0fcb0fbe851b5c9cbf4cad9ffd797de9d3956777579e5c8446b95c2d6028\n\t\t1e287ea2d0633e02459d90e33391ce248145cfe350784831e355fafe4d59\n\t\tbd03ffb49086dfef0d428be3349750624c8a44ce14c0fbfb9bf39eaae5e0\n\t\tf87a5429bf174f0bda9e9447853352373d9ce41b21803b2e7f4df8150268\n\t\t6125a4170bd05143ef9f9fe238949ed3bee59d3a50c697ce5d81ca42e32c\n\t\tc709f95c468ff8c84acf18916a84c653751e542b8aca73d89dda8270abac\n\t\t944345e6b5f6ead5b5976a46ab513f485d5e7c26162f4a67efd80b82cde6\n\t\t334203e5a01c9da853a3ee8766508c1d8ec6c2fdef1a0e4fad7568f88872\n\t\t802a6a53de2186ef0ad09ee285bd13b0d3a48b1564a454a6577eb228cebf\n\t\t84cb819be23948383e752a6d1a04b265abee8cfba8e646d25872c39338ff\n\t\t93f4e033682640cf539c7f21cedf148b9f8a678b668da7b2ea7e92152de5\n\t\tf34da30660c1b2999e697e6e348583aeb0e3c75999eb73733fb9ca5188b6\n\t\tb4f29f796fab1adf0be86e69e863c38746fb23037d43bd6cb342c0b5e3bf\n\t\t244377533b28ba9ba1292648534114ffed61bcfacf9640bbe2bfc645e754\n\t\t027a5b2cfd225bf1cbb2a3ff03aa0885169d964943010078f296165b1120\n\t\t26bb09f2eded102026df22c82041bfb555eb3f1b1c56869d9181bf6058b9\n\t\t9dc963affeb32e716da1fa4ff73ab566e1669dbd401358f7b7d3d94c3ac1\n\t\t017f020480dea8346500f576a56d22c7f1a9c4541cfa65fe649c9bce66fc\n\t\t99ac909e9883cfd009af8475114e7cb6828f5c7450bb84e3b58b46ab67ea\n\t\t645c2b96b5b318cd9da8463532a4bdf210af3ca4050075263b32361c6d62\n\t\tf9c7c6f67f80b2fefe2be0d9ffad8176d9ffdaa2732cff28dfbaa066f8e0\n\t\td952fc490ee57e850e1c74f22cb6b43284eade0e86bfc6eb5635fc21154d\n\t\td0b4f7c3afd7d9519ee1ffca33fceb16975a052de7ae7709dcf44c3617cf\n\t\tcd810f72698103422a97cd4fa6768103289d732ca2c4dfdfa50a9b22a337\n\t\t4716d81c1963cd9854921da66c029c8d258e0d1b9c70692b2eed8c1bb0e2\n\t\t069c71192b2e6cf0ec7ccfce6f2b40d5391a3936dcd746fbbf870a0650fc\n\t\t9f0ed0540fa3d9ff5efd774ba05df6bfb6e85cd8ff860abff65cffa086d4\n\t\t7bb68317b089f03ff9b692dd702451ce32b1f4a562cd20f70b5ad9377fd5\n\t\tc99161efec0e38911362f1a55c3af15ff93dda15741a868163903d041574\n\t\t1c465ec77c0af80f007d498bf33f98fa08102474439cf305cc4038bc7aed\n\t\tbe2d194d393b210e65676b2fff942e7e53e924b8595fab85577350ce4ba7\n\t\t05099da07c3b886b1676e7f8b94c422cfd5b2c7d2797e3c0d5f4d273fb1a\n\t\t6c257a6e5f5de2da426e9f5a786efca988b1f0cbea2261c6faaf2a77093d\n\t\ta112c9c8685f0827949f78eb8de14834642d1253515ec343537ff4ebd247\n\t\t73c4b6f5d21cb1edfd343953f486eb5a38dbb4d1cacb2f51a1d9c2a23caa\n\t\t58bc2fabade7e0b8638f275eeb9e11541dab8e68634b959e2b5680fa5e2c\n\t\ta57eea4b2d38cdc95c1ca661031655396be57d35925f766495823963adb4\n\t\t9999a654d6da31b351e9b39be26cdbe267d7e2306703cd56f465a4906bde\n\t\tad638fbda954ac7cc8027f7c16f8075036969be20488e4e74e27a6f2492e\n\t\t54f5920c5f193787010fea900251356fdc92b7c52d895bbc0199db2ac16c\n\t\t26735bdd8997b9359e3c5e4467bb00b4a1c68ea21f31b5edf7ff2413ec41\n\t\tf19f20d3d34d316afc870904bdf84f2ba05df11f7dd139157f3eaedcffd9\n\t\t9e9acfa01c6f20b743d047e3d575d0c7738a5ffba0f59ce2bac4b5859ce2\n\t\t0d754bedda4757c4463b3b3e23f8273901e467e45f16b7bc34f1b8998113\n\t\t0d2955acead4600057cddc3f07d12673f1647b672f73d0f0e9abbd6e30ff\n\t\t649a17fced1782918d064bc2dcb5e70f1995ced6f5874c174f34690c645e\n\t\t743bdbff01b22758b9ff2b28dbffdddefd5fad8126daff8ee6bff9b2137b\n\t\tfbbff6ed292dba116c6b677c4d178239e7faeccb3e6bdec12fa7412f2cae\n\t\t3cbb5ebef7992913bab922ce4ddcfea5dcc2b217d76e61c14f3a52af9dff\n\t\t5eba74bd9dce4dc3774ea3afe6b1dc47d4ccbbc3d0793f163928db0757d1\n\t\tae2f3eb5cf3fbd4b85703960ce27c729dcd04eebed09537b406f4f9ada19\n\t\tbd9da370b7c30f0da3e1a7330234d68cc30f0dd39576dad81ea8b4078ced\n\t\t4ca59d81c31b2a2851966c8e27c695fbb192e388cb748223f8049f8e4173\n\t\te914f126918827525c4c989be17003296d214db8270d584893ee49190b29\n\t\tb71169bb0f2f0f3cf0c0030f3cf0c0030f3cf0c0030f3cf0c015fc0fdaff\n\t\tb27500780000\n_EOT_\n\n\tpushd /usr/sh\n\txxd -r -p ${TGZ_WORK} | tar -xz\n\tfuncPause $?\n\tls -al\n\tpopd\n\n#------------------------------------------------------------------------------\n# Cron\n#------------------------------------------------------------------------------\n\tcat <<- _EOT_ > ${CRN_FILE}\n\t\tSHELL = /bin/bash\n\t\tPATH = /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\t\t# @reboot /sbin/sysctl -p\n\t\t0 0,3,6,9,12,15,18,21 * * * /usr/sbin/ntpdate -s ntp.nict.jp\n\t\t# @reboot /usr/sh/CMDMOUNT.sh\n\t\t# @reboot /usr/sh/CMDBACKUP.sh\n\t\t# 0 1 * * * /usr/sh/CMDUPDATE.sh\n\t\t# 0 2 * * * /usr/sh/CMDFRESHCLAM.sh\n\t\t# 0 3 * * * /usr/sh/CMDRSYNC.sh\n_EOT_\n\n\tcrontab ${CRN_FILE}\n\tfuncPause $?\n\n#------------------------------------------------------------------------------\n# GRUB\n# \u6ce8)\u89e3\u50cf\u5ea6\u304c\u9ad8\u304f\u306a\u3089\u306a\u3044\u5834\u5408\u306f.vmx\u306bsvga.minVRAMSize = 8388608\u3092\u8ffd\u52a0\u3057\u3066\u307f\u308b\u3002\n#------------------------------------------------------------------------------\n\tif [ ! -f /etc/default/grub.orig ]; then\n\t\tsed -i.orig /etc/default/grub \\\n\t\t\t-e 's/^GRUB_CMDLINE_LINUX_DEFAULT/#&/' \\\n\t\t\t-e \"s/#GRUB_GFXMODE=640x480/GRUB_GFXPAYLOAD_LINUX=${VGA_RESO}\\nGRUB_GFXMODE=${VGA_RESO}/\"\n\n\t\tupdate-grub\n\t\tfuncPause $?\n\tfi\n\n#------------------------------------------------------------------------------\n# Disable IPv6\n#------------------------------------------------------------------------------\n#\tif [ ! -f /etc/sysctl.conf.orig ]; then\n#\t\tcp -p /etc/sysctl.conf /etc/sysctl.conf.orig\n#\t\tcat <<- _EOT_ >> /etc/sysctl.conf\n#\t\t\t# -----------------------------------------------------------------------------\n#\t\t\t# Disable IPv6\n#\t\t\tnet.ipv6.conf.all.disable_ipv6 = 1\n#\t\t\tnet.ipv6.conf.default.disable_ipv6 = 1\n#\t\t\tnet.ipv6.conf.lo.disable_ipv6 = 1\n#\t\t\t# -----------------------------------------------------------------------------\n#_EOT_\n#\tfi\n#\n#\tsysctl -p\n#\tifconfig\n#\tip a show\n#\n#------------------------------------------------------------------------------\n# Install VMware Tools\n#------------------------------------------------------------------------------\n\tif [ ${FLG_VMTL} -ne 0 ]; then\n#\t\tKNL_VER=`uname -r | awk -F \".\" '{print $1;}'`\n#\t\tif [ ${KNL_VER} -ge 4 ]; then\n\t\t\t${CMD_AGET} install open-vm-tools open-vm-tools-desktop\n\t\t\tfuncPause $?\n\t\t\tmkdir -p /mnt/hgfs\n\t\t\tif [ ! -f /etc/fstab.vmware ]; then\n\t\t\t\tcp -p /etc/fstab /etc/fstab.vmware\n\t\t\t\twhich vmhgfs-fuse\n\t\t\t\tif [ $? -eq 0 ]; then\n\t\t\t\t\tHGFS_FS=\"fuse.vmhgfs-fuse\"\n\t\t\t\telse\n\t\t\t\t\tHGFS_FS=\"vmhgfs\"\n\t\t\t\tfi\n\t\t\t\tcat <<- _EOT_ >> /etc/fstab\n\t\t\t\t\t.host:/ /mnt/hgfs ${HGFS_FS} allow_other,auto_unmount,defaults 0 0\n_EOT_\n\t\t\tfi\n#\t\telse\n#\t\t\tif [ ! -d /usr/src/linux-headers-`uname -r` ]; then\n#\t\t\t\t${CMD_AGET} install\tlinux-headers-`uname -r`\n#\t\t\t\tfuncPause $?\n#\t\t\tfi\n#\t\t\tVMW_CD=${MNT_CD}/VMwareTools-*.tar.gz\n#\t\t\twhile :\n#\t\t\tdo\n#\t\t\t\tif [ ! -f ${VMW_CD} ]; then\n#\t\t\t\t\techo \"VMware Tools\u30c7\u30a3\u30b9\u30af\u3092\u633f\u5165\u3057Enter\u30ad\u30fc\u3092\u62bc\u3057\u3066\u4e0b\u3055\u3044\u3002\"\n#\t\t\t\t\tread DUMMY\n#\t\t\t\t\tmount ${DEV_CD} ${MNT_CD}\n#\t\t\t\tfi\n#\n#\t\t\t\ttar -xzf ${VMW_CD}\n#\t\t\t\tif [ $? -eq 0 ]; then\n#\t\t\t\t\tumount ${MNT_CD}\n#\t\t\t\t\tbreak\n#\t\t\t\tfi\n#\t\t\tdone\n#\n#\t\t\t${DIR_WK}/vmware-tools-distrib/vmware-install.pl -d -f\n#\t\t\tfuncPause $?\n#\t\tfi\n\tfi\n\n#------------------------------------------------------------------------------\n# Backup\n#------------------------------------------------------------------------------\n\tpushd /\n\ttar -czf /work/bk_boot.tgz   boot\n\ttar -czf /work/bk_etc.tgz    etc\n\ttar -czf /work/bk_home.tgz   home\n\ttar -czf /work/bk_share.tgz  share\n\ttar -czf /work/bk_usr_sh.tgz usr/sh\n\ttar -czf /work/bk_bind.tgz   var/cache/bind/\n\ttar -czf /work/bk_cron.tgz   var/spool/cron/crontabs\n\tpopd\n\n#------------------------------------------------------------------------------\n# RAID Status\n#------------------------------------------------------------------------------\n\tif [ -f /proc/mdstat ]; then\n\t\tcat /proc/mdstat\n\tfi\n\n#------------------------------------------------------------------------------\n# Termination\n#------------------------------------------------------------------------------\n\trm -f ${TGZ_WORK}\n\trm -f ${CRN_FILE}\n\trm -f ${USR_FILE}\n\trm -f ${SMB_FILE}\n\trm -f ${SMB_WORK}\n\tpopd\n\n#\tsystemctl list-unit-files -t service\n#\tsystemctl -t service\n\n#------------------------------------------------------------------------------\n# Exit\n#------------------------------------------------------------------------------\n\texit 0\n\n###############################################################################\n# memo                                                                        #\n###############################################################################\n# for %I in (*.*) do fc /b \"%~nxI\" \"V:\\Application\\FreeWare\\win32\\%~nxI\"\n# for /d %I in (\"r:\\My Documents\\Download\\dlc\\*.*\") do robocopy /l /mov /xo \"%~fI\" \"r:\\My Documents\\Download\\update\"\n# apt-get update && apt-get -y upgrade && apt-get -y dist-upgrade\n#==============================================================================\n# End of file                                                                 =\n#==============================================================================\n", "tags": ["Debian", "Ubuntu", "\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u88dc\u52a9"]}