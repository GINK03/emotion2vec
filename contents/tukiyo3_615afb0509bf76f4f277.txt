{"context": "\n\n\u53c2\u8003\n\nSetup CoreOS with iptables on DigitalOcean \u00b7 Matt Carrier\nScheduling Tasks with systemd Timers\nCoreOS\u7528cloud-config.yml\u30e1\u30e2 - Qiita\n\n\n\u624b\u52d5\u3067\u53cd\u6620\u3057\u305f\u3044\u5834\u5408\n# \u66f8\u5f0f\u30c1\u30a7\u30c3\u30af\ncoreos-cloudinit -validate=true -from-file=./cloud-config.yml\n# \u9069\u7528\ncoreos-cloudinit \\\n  --from-file /usr/share/oem/cloud-config.yml\n\n\ncloud-config.yml\n\nuser,ssh\u9375\n\nuser\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u751f\u6210\n$ openssl passwd -salt coreos -1 fjpoaeifji\n$1$coreos$5tow1kTF0qjJ0qi.G8N9/1\n\n\n\ncloud-config.yml\nusers:\n  - name: core\n    passwd: $1$coreos$5tow1kTF0qjJ0qi.G8N9/1\n    ssh-authorized-keys: \n      - ssh-rsa ... osx/id_rsa\n  - groups:\n      - sudo\n      - docker\n\n\n\nhostname\n\nclod-config.yml\nhostname: core01\n\n\n\nreboot strategy\n\nclod-config.yml\ncoreos:\n  update:\n    reboot-strategy: off\n\n\n\n\u624b\u52d5\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u5834\u5408\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\nupdate_engine_client -update\n\n\n\n\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\n\nclod-config.yml\ncoreos:\n  units:\n\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n\n\n\nnetwork\n\nclod-config.yml\ncoreos:\n  units:\n\n    - name: systemd-networkd.service\n      command: restart\n\nwrite_files:\n  - path: /etc/systemd/network/10-static.network\n    permissions: 0644\n    content: |\n      [Match]\n      Name=eth0\n      [Network]\n      Address=172.16.2.2/24\n      Gateway=172.16.2.1\n      DNS=8.8.8.8\n      DNS=8.8.4.4\n\n\n\nsshd\n\nclod-config.yml\ncoreos:\n  units:\n\n    - name: sshd.socket\n      command: start\n      content: |\n        [Socket]\n        #ListenStream=22\n        ListenStream=2222\n        Accept=yes\n        #\n        PermitRootLogin no\n        PasswordAuthentication no\n        AllowUsers core\n\n\n\niptables\n\nclod-config.yml\ncoreos:\n  units:\n\n    - name: iptables-restore.service\n      enable: true\n      command: start\n\nwrite_files:\n  - path: /var/lib/iptables/rules-save\n    permissions: 0644\n    owner: 'root:root'\n    content: |\n      *filter\n      :INPUT DROP [0:0]\n      :FORWARD DROP [0:0]\n      :OUTPUT ACCEPT [0:0]\n      -A INPUT -i lo -j ACCEPT\n      -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n      -A INPUT -p tcp -m tcp --dport 2222 -j ACCEPT\n      -A INPUT -p tcp -m tcp --dport 8888 -j ACCEPT\n      COMMIT\n\n\n\nscreen\n\nclod-config.yml\nwrite_files:\n\n  - path: /home/core/install_screen.sh\n    permissions: 0700\n    owner: core:core\n    content: |\n      sudo wget -q https://raw.githubusercontent.com/tukiyo/coreos-screen.run/master/screen.run -O /usr/share/oem/screen.run\n      sudo sh /usr/share/oem/screen.run\n\n\n## \u53c2\u8003\n\n* [Setup CoreOS with iptables on DigitalOcean \u00b7 Matt Carrier](https://mattcarrier.com/post/core-os-iptables/)\n* [Scheduling Tasks with systemd Timers](https://coreos.com/os/docs/latest/scheduling-tasks-with-systemd-timers.html)\n* [CoreOS\u7528cloud-config.yml\u30e1\u30e2 - Qiita](http://qiita.com/tukiyo3/items/f49e51045b34c7f600ab)\n\n## \u624b\u52d5\u3067\u53cd\u6620\u3057\u305f\u3044\u5834\u5408\n\n```bash:\n# \u66f8\u5f0f\u30c1\u30a7\u30c3\u30af\ncoreos-cloudinit -validate=true -from-file=./cloud-config.yml\n# \u9069\u7528\ncoreos-cloudinit \\\n  --from-file /usr/share/oem/cloud-config.yml\n```\n\n# cloud-config.yml\n\n## user,ssh\u9375\n\n```bash:user\u306e\u30d1\u30b9\u30ef\u30fc\u30c9\u6587\u5b57\u5217\u751f\u6210\n$ openssl passwd -salt coreos -1 fjpoaeifji\n$1$coreos$5tow1kTF0qjJ0qi.G8N9/1\n```\n\n```rb:cloud-config.yml\nusers:\n  - name: core\n    passwd: $1$coreos$5tow1kTF0qjJ0qi.G8N9/1\n    ssh-authorized-keys: \n      - ssh-rsa ... osx/id_rsa\n  - groups:\n      - sudo\n      - docker\n```\n\n## hostname\n\n```rb:clod-config.yml\nhostname: core01\n```\n\n## reboot strategy\n\n```rb:clod-config.yml\ncoreos:\n  update:\n    reboot-strategy: off\n```\n\n```bash:\u624b\u52d5\u30a2\u30c3\u30d7\u30c7\u30fc\u30c8\u3059\u308b\u5834\u5408\u4ee5\u4e0b\u30b3\u30de\u30f3\u30c9\nupdate_engine_client -update\n```\n\n## \u30bf\u30a4\u30e0\u30be\u30fc\u30f3\n\n```rb:clod-config.yml\ncoreos:\n  units:\n\n    - name: timezone.service\n      command: start\n      content: |\n        [Unit]\n        Description=timezone\n        [Service]\n        Type=oneshot\n        RemainAfterExit=yes\n        ExecStart=/usr/bin/ln -sf ../usr/share/zoneinfo/Japan /etc/localtime\n```\n\n## network\n\n```rb:clod-config.yml\ncoreos:\n  units:\n\n    - name: systemd-networkd.service\n      command: restart\n\nwrite_files:\n  - path: /etc/systemd/network/10-static.network\n    permissions: 0644\n    content: |\n      [Match]\n      Name=eth0\n      [Network]\n      Address=172.16.2.2/24\n      Gateway=172.16.2.1\n      DNS=8.8.8.8\n      DNS=8.8.4.4\n```\n\n## sshd\n\n\n```rb:clod-config.yml\ncoreos:\n  units:\n\n    - name: sshd.socket\n      command: start\n      content: |\n        [Socket]\n        #ListenStream=22\n        ListenStream=2222\n        Accept=yes\n        #\n        PermitRootLogin no\n        PasswordAuthentication no\n        AllowUsers core\n```\n\n## iptables\n\n```rb:clod-config.yml\ncoreos:\n  units:\n\n    - name: iptables-restore.service\n      enable: true\n      command: start\n\nwrite_files:\n  - path: /var/lib/iptables/rules-save\n    permissions: 0644\n    owner: 'root:root'\n    content: |\n      *filter\n      :INPUT DROP [0:0]\n      :FORWARD DROP [0:0]\n      :OUTPUT ACCEPT [0:0]\n      -A INPUT -i lo -j ACCEPT\n      -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT\n      -A INPUT -p tcp -m tcp --dport 2222 -j ACCEPT\n      -A INPUT -p tcp -m tcp --dport 8888 -j ACCEPT\n      COMMIT\n```\n\n## screen\n\n```rb:clod-config.yml\nwrite_files:\n\n  - path: /home/core/install_screen.sh\n    permissions: 0700\n    owner: core:core\n    content: |\n      sudo wget -q https://raw.githubusercontent.com/tukiyo/coreos-screen.run/master/screen.run -O /usr/share/oem/screen.run\n      sudo sh /usr/share/oem/screen.run\n```\n", "tags": ["CoreOS", "iptables"]}