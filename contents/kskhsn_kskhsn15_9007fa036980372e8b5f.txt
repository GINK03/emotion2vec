{"context": "\n\n\u76ee\u7684\nLivet\u3092\u4f7f\u3063\u3066WPF\u3067\u30d5\u30a1\u30a4\u30eb\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3059\u3002\n\u4e00\u5fdcLivet\u306a\u306e\u3067MVVM\u3068\u3044\u3046\u3088\u308a\u30b3\u30fc\u30c9\u30d3\u30cf\u30a4\u30f3\u30c9\u306a\u3057\u3067\u3084\u308b\u3053\u3068\u3002\nlivet\u306e\u7d39\u4ecb\nhttp://ugaya40.hateblo.jp/entry/Livet\nBehavior\u3068\u306f\u4f55\uff1f\u3063\u3066\u4eba\u306b\u306f\u308f\u304b\u3089\u306a\u3044\u5185\u5bb9\u3067\u3059\u3002\nViewModel\u306fVM\u3068\u7701\u7565\u3057\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n\u7d50\u679c\n4\u3064\u306e\u65b9\u6cd5\u3067\u5b9f\u88c5\u3067\u304d\u305f\u3002\n1.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306e\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\n2.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fLivetCallMethodAction\u3067\u901a\u77e5\n3.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n4.\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n\u3059\u3079\u3066Drop\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092ListBox\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nListBox\u306eItemsSource\u306bObservableCollection\u306e\u5909\u6570\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u307e\u3059\u3002\n\n1.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306e\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\n\n\u7c21\u5358\u306a\u8aac\u660e\nVM\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u5909\u6570\u3092\u4f5c\u3063\u3066\nBehavior\u306e\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u30d0\u30a4\u30f3\u30c9\u3055\u305b\u308b\n\n\u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306fBehavior\nPreviewDragEnter\u3068Drop\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u8cfc\u8aad\u3057\u3066\n\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u53d7\u3051\u53d6\u308b&VM\u306b\u6e21\u3059\u7528\u306e\u5909\u6570\u3092\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u4f5c\u308b\u3002(DropFilesProperty)\n    class FileDropBehaviorA:Behavior<FrameworkElement>\n    {\n        protected override void OnAttached()\n        {\n            base.OnAttached();\n            this.AssociatedObject.PreviewDragEnter += AssociatedObject_PreviewDragEnter;\n            this.AssociatedObject.Drop += AssociatedObject_Drop;\n        }\n\n        protected override void OnDetaching()\n        {\n            base.OnDetaching();\n            this.AssociatedObject.PreviewDragEnter -= AssociatedObject_PreviewDragEnter;\n            this.AssociatedObject.Drop -= AssociatedObject_Drop;\n        }\n\n        private void AssociatedObject_PreviewDragEnter(object sender, DragEventArgs e)\n        {\n            //preview\u3067\u306e\u51e6\u7406\u3002\u304a\u307e\u3058\u306a\u3044w\u3002\n            e.Effects = DragDropEffects.All;\n            e.Handled = true;\n        }\n\n        private void AssociatedObject_Drop(object sender, DragEventArgs e)\n        {\n            //\u3053\u3093\u306a\u611f\u3058\u3067drop\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u53d6\u5f97\u53ef\u80fd\n            this.DropFiles = e.Data.GetData(DataFormats.FileDrop) as string[];\n        }\n\n        public string[] DropFiles\n        {\n            get { return (string[])this.GetValue(DropFilesProperty); }\n            set { this.SetValue(DropFilesProperty, value); }\n        }\n        /// <summary>\n        /// FrameworkPropertyMetadataOptions.BindsTwoWayByDefault\u306f\u4ed8\u3051\u306a\u304f\u3066\u3082\u53ef\n        /// \u305f\u3060\u3057\u305d\u306e\u5834\u5408\u306f,xaml\u306ebinding mode\u3092twoway\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n        /// FrameworkPropertyMetadataOptions.BindsTwoWayByDefault\u3092\u3053\u3053\u3067\u3064\u3051\u3066\u304a\u304f\u3068\u305d\u306e\u5fc5\u8981\u306f\u306a\u3044\u3002\n        /// </summary>\n        public static readonly DependencyProperty DropFilesProperty =\n        DependencyProperty.Register(nameof(DropFiles), typeof(string[]), typeof(FileDropBehaviorA), new FrameworkPropertyMetadata(default(string[]), FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));\n    }\n\n\n\u7d9a\u3044\u3066xaml\n\u30dd\u30a4\u30f3\u30c8\u306fDropFiles=\"{Binding DropFilesA1}\" \u3067\n\u3053\u3053\u3067VM\u306e\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u6301\u3059\u308b\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u3053\u3068\n<TabItem Header=\"FileDropA1\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorA DropFiles=\"{Binding DropFilesA1}\" />\n    </i:Interaction.Behaviors>\n    <ListBox ItemsSource=\"{Binding ItemsA1}\" />\n</TabItem>\n\nVM\u306f\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u53d7\u3051\u53d6\u308bstring[]\u3092\u6301\u305f\u305b\u3066\n\u5909\u66f4\u6642\u306bList\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u611f\u3058\u306b\u66f8\u304f\n\n#region ItemsA\u5909\u66f4\u901a\u77e5\u30d7\u30ed\u30d1\u30c6\u30a3\nprivate ObservableCollection<string> _ItemsA1;\n\npublic ObservableCollection<string> ItemsA1\n{\n    get\n    { return _ItemsA1; }\n    set\n    { \n        if (_ItemsA1 == value)\n            return;\n        _ItemsA1 = value;\n        RaisePropertyChanged();\n    }\n}\n#endregion\n\n#region DropFilesA1\u5909\u66f4\u901a\u77e5\u30d7\u30ed\u30d1\u30c6\u30a3\nprivate string[] _DropFilesA1;\n\npublic string[] DropFilesA1\n{\n    get\n    { return this._DropFilesA1; }\n    set\n    { \n        if (this._DropFilesA1 == value)\n            return;\n        this._DropFilesA1 = value;\n        foreach (var item in value)\n            this.ItemsA1.Add(item);\n        this.RaisePropertyChanged();\n    }\n}\n#endregion\n\n\n2.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fLivetCallMethodAction\u3067\u901a\u77e5\n\n\u7c21\u5358\u306a\u8aac\u660e\nBehavior\u81ea\u4f53\u306f1\u3068\u540c\u3058\u3067\u3059\u3002\nBehavior\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3061\nLivetCallMethodAction\u3067\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092VM\u306b\u901a\u77e5\u3059\u308b\n\n\u30b3\u30fc\u30c9\u3067\u8aac\u660e\nBehavior\u81ea\u4f53\u306f1\u3068\u540c\u3058\u306a\u306e\u3067\u7701\u7565\nxaml\n\u30dd\u30a4\u30f3\u30c8\u306fl:LivetCallMethodAction\u306eMethodParameter\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u3059\u3053\u3068\u3002\nMethodParameter=\"{Binding ElementName=FileDropBehaviorA, Path=DropFiles}\"\n\u2191\u3092\u66f8\u304f\u305f\u3081\u306b\u3068\n\u540d\u524d\u3092\u4ed8\u3051\u308b\n<TabItem Header=\"FileDropA2\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorA x:Name=\"FileDropBehaviorA\" />\n    </i:Interaction.Behaviors>\n    <i:Interaction.Triggers>\n        <i:EventTrigger EventName=\"Drop\">\n            <l:LivetCallMethodAction\n                MethodName=\"DropFilesA2\"\n                MethodParameter=\"{Binding ElementName=FileDropBehaviorA, Path=DropFiles}\"\n                MethodTarget=\"{Binding}\" />\n        </i:EventTrigger>\n    </i:Interaction.Triggers>\n    <ListBox ItemsSource=\"{Binding ItemsA2}\" />\n</TabItem>\n\nVM\nItemsA2\u306fObservableCollection\u30671.\u306e\u3084\u308a\u65b9\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\nl:LivetCallMethodAction\u3067\u5b9a\u7fa9\u3057\u305f\u540d\u524d\u306epublic\u95a2\u6570\u306e\u5f15\u6570\u306b(string[] files)\u3092\u5165\u308c\u308b\nxaml\u3067Behavior\u306b\u8ffd\u52a0\u3057\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u3092bind\u3059\u308b\npublic void DropFilesA2(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsA2.Add(file);\n}       \n\n\n3.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n\n\u7c21\u5358\u306a\u8aac\u660e\n\u30d5\u30a1\u30a4\u30eb\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u3068\u304d\u306e\u51e6\u7406\u7528\u306eInterface\u3092\u4f5c\u308a\n\u305d\u308c\u3092\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3082\u3063\u305fBehavior\u3092\u4f5c\u308b\n\n\u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306finterface\npublic interface IFileDropB\n{\n    void Drop(string[] files);\n}\n\nBehavior\n\u30dd\u30a4\u30f3\u30c8\u306fFileDropHandlerProperty\u3092\u4f5c\u308a\nDrop\u3055\u308c\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\nthis.FileDropHandler?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n\u3053\u308c\u306fxaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\nclass FileDropBehaviorB : Behavior<FrameworkElement>\n{\n    protected override void OnAttached()\n    {\n        base.OnAttached();\n        this.AssociatedObject.PreviewDragEnter += AssociatedObject_PreviewDragEnter;\n        this.AssociatedObject.Drop += AssociatedObject_Drop;\n    }\n\n    protected override void OnDetaching()\n    {\n        base.OnDetaching();\n        this.AssociatedObject.PreviewDragEnter -= AssociatedObject_PreviewDragEnter;\n        this.AssociatedObject.Drop -= AssociatedObject_Drop;\n    }\n\n    private void AssociatedObject_PreviewDragEnter(object sender, DragEventArgs e)\n    {\n        e.Effects = DragDropEffects.All;\n        e.Handled = true;\n    }\n\n    private void AssociatedObject_Drop(object sender, DragEventArgs e)\n    {\n        //\u3053\u3053\u3067interface\u306e\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3002xaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\n        this.FileDropHandler?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n    }\n\n    public IFileDropB FileDropHandler\n    {\n        get { return (IFileDropB)this.GetValue(FileDropHandlerProperty); }\n        set { this.SetValue(FileDropHandlerProperty, value); }\n    }\n\n    // Using a DependencyProperty as the backing store for FileDropHandler.  This enables animation, styling, binding, etc...\n    public static readonly DependencyProperty FileDropHandlerProperty =\n    DependencyProperty.Register(nameof(FileDropHandler), typeof(IFileDropB), typeof(FileDropBehaviorB));\n}\n\n\u7d9a\u3044\u3066xaml\nFileDropHandler=\"{Binding}\"\u304c\u30dd\u30a4\u30f3\u30c8\n<TabItem Header=\"FileDropB\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorB FileDropHandler=\"{Binding}\" />\n    </i:Interaction.Behaviors>\n    <ListBox ItemsSource=\"{Binding ItemsB}\" />\n</TabItem>\n\n\n\u6700\u5f8c\u306bVM\nVM\u306b\u4f5c\u3063\u305finterface\u3092\u7d99\u627f\u3055\u305b\u308b\n\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u6642\u306e\u95a2\u6570\u3092\u5b9f\u88c5\u3059\u308b\nItemsB\u306fObservableCollection\u30671.\u306e\u3084\u308a\u65b9\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\npublic class MainWindowViewModel : ViewModel,Views.IFileDropB\n\nvoid IFileDropB.Drop(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsB.Add(file);\n}   \n\n\n4.\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n\n\u7c21\u5358\u306a\u8aac\u660e\n3.\u306e\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u7248\n\n\u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306finterface\u5185\u5bb9\u306f3.\u306e\u3068\u4e00\u7dd2\npublic interface IFileDropC\n{\n    void Drop(string[] files);\n}\n\nBehavior\n\u30dd\u30a4\u30f3\u30c8\u306fFileDropHandlerProperty\u3092\u4f5c\u308a\nDrop\u3055\u308c\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\nGetFileDropHandler(sender as UIElement)?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n\u3053\u308c\u306fxaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\n\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u81ea\u4f53\u306f\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u4f5c\u6210\u6642\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u3066\u305d\u3053\u306e\u4e2d\u3067\u3084\u308b\u3053\u3068\u3002\n\u3064\u307e\u308aOnFileDropHandlerChanged\u5185\u3067\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u958b\u59cb\n\u3067\u3082\u3053\u308c\u3063\u3066\u30a4\u30d9\u30f3\u30c8\u8cfc\u8aad\u89e3\u9664\u306f\u3069\u3053\u306b\u66f8\u304f\u3093\u3060\uff1f\nclass FileDropBehaviorC//behaivor\u306e\u7d99\u627f\u8981\u3089\u306a\u3044\n{\n    public static IFileDropC GetFileDropHandler(UIElement target)\n    {\n        return (IFileDropC)target.GetValue(FileDropHandlerProperty);\n    }\n\n    public static void SetFileDropHandler(UIElement target, IFileDropC value)\n    {\n        target.SetValue(FileDropHandlerProperty, value);\n    }\n\n    /// <summary>\n    /// \u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u306e\u5b9a\u7fa9\n    /// </summary>\n    public static readonly DependencyProperty FileDropHandlerProperty =\n    DependencyProperty.RegisterAttached(\"FileDropHandler\", typeof(IFileDropC), typeof(FileDropBehaviorC), new PropertyMetadata(OnFileDropHandlerChanged));\n\n    private static void OnFileDropHandlerChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)\n    {\n        var element = obj as UIElement;\n        if (element != null)\n        {\n            //\u3053\u306e\u5834\u5408\u3001\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u89e3\u9664\u306f\u3069\u3053\u3067\u3084\u308b\u3093\u3060\uff1f\n            element.PreviewDragOver += Element_PreviewDragOver;\n            element.Drop += Element_Drop;\n        }\n    }\n    private static void Element_PreviewDragOver(object sender, DragEventArgs e)\n    {\n        e.Effects = DragDropEffects.All;\n        e.Handled = true;\n    }\n\n    private static void Element_Drop(object sender, DragEventArgs e)\n    {\n        GetFileDropHandler(sender as UIElement)?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n    }\n}\n\n\u7d9a\u3044\u3066xaml\n v:FileDropBehaviorC.FileDropHandler=\"{Binding}\" Header=\"FileDropC\"\u304c\u30dd\u30a4\u30f3\u30c8\n\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u306a\u306e\u3067\u4e2d\u306b\u66f8\u304f\n<TabItem \n    v:FileDropBehaviorC.FileDropHandler=\"{Binding}\" Header=\"FileDropC\">\n    <ListBox ItemsSource=\"{Binding ItemsC}\" />\n</TabItem>\n\n\n\u6700\u5f8c\u306bVM\n\u3053\u3053\u306f3.\u3068\u4e00\u7dd2\npublic class MainWindowViewModel : ViewModel,Views.IFileDropC\n\nvoid IFileDropC.Drop(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsC.Add(file);\n}   \n\n\n\u6700\u5f8c\u306b\n\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u304b\u308f\u3051\u308f\u304b\u3089\u3093\u3060\u3068\u30a4\u30df\u30d5\u3060\u3068\u601d\u3046\u3051\u3069\nBehavior\u306b\u5909\u6570\u3092\u30d0\u30a4\u30f3\u30c9\u3055\u305b\u308b\u306b\u306f\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5fc5\u8981\u3002\u307b\u304b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u306fNG\n\u72ec\u7acb\u3055\u305b\u3066\u4f5c\u308a\u305f\u3044\u5834\u5408\u306f\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3084\u308b\u3063\u3066\u611f\u3058\u306e\u611f\u899a\u3067\u4f7f\u3048\u3070\u6016\u304f\u306a\u3044\uff01\n\u4e00\u5fdc\u30bd\u30fc\u30b9\u306f\u2193\nhttps://github.com/kskhsn/BehaviorSample\n# \u76ee\u7684  \nLivet\u3092\u4f7f\u3063\u3066WPF\u3067\u30d5\u30a1\u30a4\u30eb\u30c9\u30ed\u30c3\u30d7\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3059\u3002\n\u4e00\u5fdcLivet\u306a\u306e\u3067MVVM\u3068\u3044\u3046\u3088\u308a\u30b3\u30fc\u30c9\u30d3\u30cf\u30a4\u30f3\u30c9\u306a\u3057\u3067\u3084\u308b\u3053\u3068\u3002\nlivet\u306e\u7d39\u4ecb\nhttp://ugaya40.hateblo.jp/entry/Livet\n\nBehavior\u3068\u306f\u4f55\uff1f\u3063\u3066\u4eba\u306b\u306f\u308f\u304b\u3089\u306a\u3044\u5185\u5bb9\u3067\u3059\u3002\nViewModel\u306fVM\u3068\u7701\u7565\u3057\u3066\u8a18\u8f09\u3057\u307e\u3059\u3002\n\n# \u7d50\u679c\n4\u3064\u306e\u65b9\u6cd5\u3067\u5b9f\u88c5\u3067\u304d\u305f\u3002\n1.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306e\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\n2.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fLivetCallMethodAction\u3067\u901a\u77e5\n3.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n4.\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n\n\u3059\u3079\u3066Drop\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u3092ListBox\u306b\u8868\u793a\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\nListBox\u306eItemsSource\u306bObservableCollection<string>\u306e\u5909\u6570\u3092\u30d0\u30a4\u30f3\u30c9\u3057\u3066\u307e\u3059\u3002\n\n\n# 1.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306e\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\n## \u7c21\u5358\u306a\u8aac\u660e\nVM\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u5909\u6570\u3092\u4f5c\u3063\u3066\nBehavior\u306e\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u30d0\u30a4\u30f3\u30c9\u3055\u305b\u308b\n\n## \u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306fBehavior\nPreviewDragEnter\u3068Drop\u306e\u30a4\u30d9\u30f3\u30c8\u3092\u8cfc\u8aad\u3057\u3066\n\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u53d7\u3051\u53d6\u308b&VM\u306b\u6e21\u3059\u7528\u306e\u5909\u6570\u3092\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u4f5c\u308b\u3002(DropFilesProperty)\n\n\n```csharp \n    class FileDropBehaviorA:Behavior<FrameworkElement>\n    {\n        protected override void OnAttached()\n        {\n            base.OnAttached();\n            this.AssociatedObject.PreviewDragEnter += AssociatedObject_PreviewDragEnter;\n            this.AssociatedObject.Drop += AssociatedObject_Drop;\n        }\n\n        protected override void OnDetaching()\n        {\n            base.OnDetaching();\n            this.AssociatedObject.PreviewDragEnter -= AssociatedObject_PreviewDragEnter;\n            this.AssociatedObject.Drop -= AssociatedObject_Drop;\n        }\n\n        private void AssociatedObject_PreviewDragEnter(object sender, DragEventArgs e)\n        {\n            //preview\u3067\u306e\u51e6\u7406\u3002\u304a\u307e\u3058\u306a\u3044w\u3002\n            e.Effects = DragDropEffects.All;\n            e.Handled = true;\n        }\n\n        private void AssociatedObject_Drop(object sender, DragEventArgs e)\n        {\n            //\u3053\u3093\u306a\u611f\u3058\u3067drop\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u540d\u304c\u53d6\u5f97\u53ef\u80fd\n            this.DropFiles = e.Data.GetData(DataFormats.FileDrop) as string[];\n        }\n                \n        public string[] DropFiles\n        {\n            get { return (string[])this.GetValue(DropFilesProperty); }\n            set { this.SetValue(DropFilesProperty, value); }\n        }\n        /// <summary>\n        /// FrameworkPropertyMetadataOptions.BindsTwoWayByDefault\u306f\u4ed8\u3051\u306a\u304f\u3066\u3082\u53ef\n        /// \u305f\u3060\u3057\u305d\u306e\u5834\u5408\u306f,xaml\u306ebinding mode\u3092twoway\u3092\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\n        /// FrameworkPropertyMetadataOptions.BindsTwoWayByDefault\u3092\u3053\u3053\u3067\u3064\u3051\u3066\u304a\u304f\u3068\u305d\u306e\u5fc5\u8981\u306f\u306a\u3044\u3002\n        /// </summary>\n        public static readonly DependencyProperty DropFilesProperty =\n        DependencyProperty.Register(nameof(DropFiles), typeof(string[]), typeof(FileDropBehaviorA), new FrameworkPropertyMetadata(default(string[]), FrameworkPropertyMetadataOptions.BindsTwoWayByDefault));\n    }\n\n``` \n\n\n\u7d9a\u3044\u3066xaml\n\u30dd\u30a4\u30f3\u30c8\u306fDropFiles=\"{Binding DropFilesA1}\" \u3067\n\u3053\u3053\u3067VM\u306e\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u4fdd\u6301\u3059\u308b\u5909\u6570\u3068\u30d0\u30a4\u30f3\u30c9\u3059\u308b\u3053\u3068\n\n``` csharp\n<TabItem Header=\"FileDropA1\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorA DropFiles=\"{Binding DropFilesA1}\" />\n    </i:Interaction.Behaviors>\n    <ListBox ItemsSource=\"{Binding ItemsA1}\" />\n</TabItem>\n```\n\nVM\u306f\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u53d7\u3051\u53d6\u308bstring[]\u3092\u6301\u305f\u305b\u3066\n\u5909\u66f4\u6642\u306bList\u306b\u30d5\u30a1\u30a4\u30eb\u3092\u8ffd\u52a0\u3059\u308b\u611f\u3058\u306b\u66f8\u304f\n\n```csharp\n\n#region ItemsA\u5909\u66f4\u901a\u77e5\u30d7\u30ed\u30d1\u30c6\u30a3\nprivate ObservableCollection<string> _ItemsA1;\n\npublic ObservableCollection<string> ItemsA1\n{\n    get\n    { return _ItemsA1; }\n    set\n    { \n        if (_ItemsA1 == value)\n            return;\n        _ItemsA1 = value;\n        RaisePropertyChanged();\n    }\n}\n#endregion\n\n#region DropFilesA1\u5909\u66f4\u901a\u77e5\u30d7\u30ed\u30d1\u30c6\u30a3\nprivate string[] _DropFilesA1;\n\npublic string[] DropFilesA1\n{\n    get\n    { return this._DropFilesA1; }\n    set\n    { \n        if (this._DropFilesA1 == value)\n            return;\n        this._DropFilesA1 = value;\n        foreach (var item in value)\n            this.ItemsA1.Add(item);\n        this.RaisePropertyChanged();\n    }\n}\n#endregion\n```\n\n# 2.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fLivetCallMethodAction\u3067\u901a\u77e5\n## \u7c21\u5358\u306a\u8aac\u660e\nBehavior\u81ea\u4f53\u306f1\u3068\u540c\u3058\u3067\u3059\u3002\nBehavior\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb(string[])\u306e\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u6301\u3061\nLivetCallMethodAction\u3067\u305d\u306e\u30d5\u30a1\u30a4\u30eb\u3092VM\u306b\u901a\u77e5\u3059\u308b\n\n## \u30b3\u30fc\u30c9\u3067\u8aac\u660e\nBehavior\u81ea\u4f53\u306f1\u3068\u540c\u3058\u306a\u306e\u3067\u7701\u7565\n\nxaml\n\u30dd\u30a4\u30f3\u30c8\u306fl:LivetCallMethodAction\u306eMethodParameter\u306b\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u30d5\u30a1\u30a4\u30eb\u3092\u6e21\u3059\u3053\u3068\u3002\nMethodParameter=\"{Binding ElementName=FileDropBehaviorA, Path=DropFiles}\"\n\u2191\u3092\u66f8\u304f\u305f\u3081\u306b<v:FileDropBehaviorA x:Name=\"FileDropBehaviorA\" />\u3068\n\u540d\u524d\u3092\u4ed8\u3051\u308b\n\n\n```csharp\n<TabItem Header=\"FileDropA2\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorA x:Name=\"FileDropBehaviorA\" />\n    </i:Interaction.Behaviors>\n    <i:Interaction.Triggers>\n        <i:EventTrigger EventName=\"Drop\">\n            <l:LivetCallMethodAction\n                MethodName=\"DropFilesA2\"\n                MethodParameter=\"{Binding ElementName=FileDropBehaviorA, Path=DropFiles}\"\n                MethodTarget=\"{Binding}\" />\n        </i:EventTrigger>\n    </i:Interaction.Triggers>\n    <ListBox ItemsSource=\"{Binding ItemsA2}\" />\n</TabItem>\n```\n\nVM\nItemsA2\u306fObservableCollection<string>\u30671.\u306e\u3084\u308a\u65b9\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\nl:LivetCallMethodAction\u3067\u5b9a\u7fa9\u3057\u305f\u540d\u524d\u306epublic\u95a2\u6570\u306e\u5f15\u6570\u306b(string[] files)\u3092\u5165\u308c\u308b\nxaml\u3067Behavior\u306b\u8ffd\u52a0\u3057\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u3092bind\u3059\u308b\n\n```csharp\npublic void DropFilesA2(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsA2.Add(file);\n}\t\t\n```\n\n# 3.Behavior\u306b\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n## \u7c21\u5358\u306a\u8aac\u660e\n\u30d5\u30a1\u30a4\u30eb\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u3068\u304d\u306e\u51e6\u7406\u7528\u306eInterface\u3092\u4f5c\u308a\n\u305d\u308c\u3092\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3082\u3063\u305fBehavior\u3092\u4f5c\u308b\n\n## \u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306finterface\n\n```csharp\npublic interface IFileDropB\n{\n    void Drop(string[] files);\n}\n```\n\nBehavior\n\u30dd\u30a4\u30f3\u30c8\u306fFileDropHandlerProperty\u3092\u4f5c\u308a\nDrop\u3055\u308c\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\nthis.FileDropHandler?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n\u3053\u308c\u306fxaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\n\n```csharp\nclass FileDropBehaviorB : Behavior<FrameworkElement>\n{\n    protected override void OnAttached()\n    {\n        base.OnAttached();\n        this.AssociatedObject.PreviewDragEnter += AssociatedObject_PreviewDragEnter;\n        this.AssociatedObject.Drop += AssociatedObject_Drop;\n    }\n\n    protected override void OnDetaching()\n    {\n        base.OnDetaching();\n        this.AssociatedObject.PreviewDragEnter -= AssociatedObject_PreviewDragEnter;\n        this.AssociatedObject.Drop -= AssociatedObject_Drop;\n    }\n\n    private void AssociatedObject_PreviewDragEnter(object sender, DragEventArgs e)\n    {\n        e.Effects = DragDropEffects.All;\n        e.Handled = true;\n    }\n\n    private void AssociatedObject_Drop(object sender, DragEventArgs e)\n    {\n        //\u3053\u3053\u3067interface\u306e\u95a2\u6570\u3092\u5b9f\u884c\u3059\u308b\u3002xaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\n        this.FileDropHandler?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n    }\n\n    public IFileDropB FileDropHandler\n    {\n        get { return (IFileDropB)this.GetValue(FileDropHandlerProperty); }\n        set { this.SetValue(FileDropHandlerProperty, value); }\n    }\n\n    // Using a DependencyProperty as the backing store for FileDropHandler.  This enables animation, styling, binding, etc...\n    public static readonly DependencyProperty FileDropHandlerProperty =\n    DependencyProperty.Register(nameof(FileDropHandler), typeof(IFileDropB), typeof(FileDropBehaviorB));\n}\n```\n\n\u7d9a\u3044\u3066xaml\nFileDropHandler=\"{Binding}\"\u304c\u30dd\u30a4\u30f3\u30c8\n\n```csharp\n<TabItem Header=\"FileDropB\">\n    <i:Interaction.Behaviors>\n        <v:FileDropBehaviorB FileDropHandler=\"{Binding}\" />\n    </i:Interaction.Behaviors>\n    <ListBox ItemsSource=\"{Binding ItemsB}\" />\n</TabItem>\n\n```\n\n\u6700\u5f8c\u306bVM\nVM\u306b\u4f5c\u3063\u305finterface\u3092\u7d99\u627f\u3055\u305b\u308b\n\u30c9\u30ed\u30c3\u30d7\u3055\u308c\u305f\u6642\u306e\u95a2\u6570\u3092\u5b9f\u88c5\u3059\u308b\nItemsB\u306fObservableCollection<string>\u30671.\u306e\u3084\u308a\u65b9\u3068\u4e00\u7dd2\u306a\u306e\u3067\u7701\u7565\n\n```csharp\npublic class MainWindowViewModel : ViewModel,Views.IFileDropB\n\nvoid IFileDropB.Drop(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsB.Add(file);\n}\t\n```\n\n# 4.\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u3064\u3051VM\u306b\u306fIntertface\u3092\u4f7f\u3046\n## \u7c21\u5358\u306a\u8aac\u660e\n3.\u306e\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u7248\n\n## \u30b3\u30fc\u30c9\u3067\u8aac\u660e\n\u307e\u305a\u306finterface\u5185\u5bb9\u306f3.\u306e\u3068\u4e00\u7dd2\n\n```csharp\npublic interface IFileDropC\n{\n    void Drop(string[] files);\n}\n```\n\nBehavior\n\u30dd\u30a4\u30f3\u30c8\u306fFileDropHandlerProperty\u3092\u4f5c\u308a\nDrop\u3055\u308c\u305f\u3068\u304d\u306b\u5b9f\u884c\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\nGetFileDropHandler(sender as UIElement)?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n\u3053\u308c\u306fxaml\u3067bind\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306fnull\u3067\u5b9f\u884c\u3055\u308c\u306a\u3044\n\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u81ea\u4f53\u306f\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u4f5c\u6210\u6642\u306b\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8ffd\u52a0\u3057\u3066\u305d\u3053\u306e\u4e2d\u3067\u3084\u308b\u3053\u3068\u3002\n\u3064\u307e\u308aOnFileDropHandlerChanged\u5185\u3067\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u958b\u59cb\n\u3067\u3082\u3053\u308c\u3063\u3066\u30a4\u30d9\u30f3\u30c8\u8cfc\u8aad\u89e3\u9664\u306f\u3069\u3053\u306b\u66f8\u304f\u3093\u3060\uff1f\n\n```csharp\nclass FileDropBehaviorC//behaivor\u306e\u7d99\u627f\u8981\u3089\u306a\u3044\n{\n    public static IFileDropC GetFileDropHandler(UIElement target)\n    {\n        return (IFileDropC)target.GetValue(FileDropHandlerProperty);\n    }\n\n    public static void SetFileDropHandler(UIElement target, IFileDropC value)\n    {\n        target.SetValue(FileDropHandlerProperty, value);\n    }\n\n    /// <summary>\n    /// \u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u306e\u5b9a\u7fa9\n    /// </summary>\n    public static readonly DependencyProperty FileDropHandlerProperty =\n    DependencyProperty.RegisterAttached(\"FileDropHandler\", typeof(IFileDropC), typeof(FileDropBehaviorC), new PropertyMetadata(OnFileDropHandlerChanged));\n\n    private static void OnFileDropHandlerChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)\n    {\n        var element = obj as UIElement;\n        if (element != null)\n        {\n            //\u3053\u306e\u5834\u5408\u3001\u30a4\u30d9\u30f3\u30c8\u306e\u8cfc\u8aad\u89e3\u9664\u306f\u3069\u3053\u3067\u3084\u308b\u3093\u3060\uff1f\n            element.PreviewDragOver += Element_PreviewDragOver;\n            element.Drop += Element_Drop;\n        }\n    }\n    private static void Element_PreviewDragOver(object sender, DragEventArgs e)\n    {\n        e.Effects = DragDropEffects.All;\n        e.Handled = true;\n    }\n\n    private static void Element_Drop(object sender, DragEventArgs e)\n    {\n        GetFileDropHandler(sender as UIElement)?.Drop(e.Data.GetData(DataFormats.FileDrop) as string[]);\n    }\n}\n```\n\n\u7d9a\u3044\u3066xaml\n v:FileDropBehaviorC.FileDropHandler=\"{Binding}\" Header=\"FileDropC\"\u304c\u30dd\u30a4\u30f3\u30c8\n\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u306a\u306e\u3067\u4e2d\u306b\u66f8\u304f\n\n```csharp\n<TabItem \n    v:FileDropBehaviorC.FileDropHandler=\"{Binding}\" Header=\"FileDropC\">\n    <ListBox ItemsSource=\"{Binding ItemsC}\" />\n</TabItem>\n\n```\n\n\u6700\u5f8c\u306bVM\n\u3053\u3053\u306f3.\u3068\u4e00\u7dd2\n\n```csharp\npublic class MainWindowViewModel : ViewModel,Views.IFileDropC\n\nvoid IFileDropC.Drop(string[] files)\n{\n    foreach (var file in files)\n        this.ItemsC.Add(file);\n}\t\n```\n\n\n# \u6700\u5f8c\u306b\n\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3068\u304b\u308f\u3051\u308f\u304b\u3089\u3093\u3060\u3068\u30a4\u30df\u30d5\u3060\u3068\u601d\u3046\u3051\u3069\nBehavior\u306b\u5909\u6570\u3092\u30d0\u30a4\u30f3\u30c9\u3055\u305b\u308b\u306b\u306f\u4f9d\u5b58\u30d7\u30ed\u30d1\u30c6\u30a3\u304c\u5fc5\u8981\u3002\u307b\u304b\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u306fNG\n\u72ec\u7acb\u3055\u305b\u3066\u4f5c\u308a\u305f\u3044\u5834\u5408\u306f\u6dfb\u4ed8\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3084\u308b\u3063\u3066\u611f\u3058\u306e\u611f\u899a\u3067\u4f7f\u3048\u3070\u6016\u304f\u306a\u3044\uff01\n\n\u4e00\u5fdc\u30bd\u30fc\u30b9\u306f\u2193\nhttps://github.com/kskhsn/BehaviorSample\n\n\n", "tags": ["C#", "WPF", "Livet"]}