{"context": "\n\n\u6982\u8981\nGoogle\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u3067\u8a08\u7b97\u5f0f\u304c\u6ca2\u5c71\u3042\u308b\u30b7\u30fc\u30c8\u3092\u958b\u304f\u3068\u3001\u305f\u307e\u306b\u8a08\u7b97\u304c\u6b63\u3057\u304f\u884c\u308f\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002\n\u8a08\u7b97\u5f0f\u3092\u4e00\u56de\u6d88\u3057\u3066\u518d\u5ea6\u8a2d\u5b9a\u3059\u308b\u3068\u6b63\u3057\u304f\u8a08\u7b97\u3057\u76f4\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u81ea\u52d5\u7684\u306b\u884c\u3046Apps Script\u3092\u66f8\u3044\u305f\u3002\n\u4ee5\u4e0b\u306eAppsScript\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u518d\u8a08\u7b97\u5bfe\u8c61\u306e\u30bb\u30eb\u3092\u9078\u629e\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cRe-calculate selected cells\u300d\u3092\u9078\u3076\u3068AppsScript\u304c\u518d\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u3002\n\n\n\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u306a\u306b\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u306e\u89e3\u8aac\nonOpen()\u3067Google Sheet\u306eAdd-ons\u30e1\u30cb\u30e5\u30fc\u306b\u300cRe-calculate selected cells\u300d\u3068\u3044\u3046\u30e1\u30cb\u30e5\u30fc\u9805\u76ee\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\u305d\u306e\u30e1\u30cb\u30e5\u30fc\u9805\u76ee\u304c\u62bc\u3055\u308c\u305f\u3089recalculate()\u3068\u3044\u3046\u95a2\u6570\u304c\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\nrecalculate()\u306e\u4e2d\u3067\u306f\u3001\u307e\u305aSpreadsheetApp.getActiveRange()\u3092\u547c\u3073\u51fa\u3057\u3001\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u4e0a\u3067\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u30bb\u30eb\u306e\u30ec\u30f3\u30b8\u3092activeRange\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\u3002\nactiveRange\u306b\u5bfe\u3057\u3066getFormulas()\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u3001\u9078\u629e\u3057\u305f\u30ec\u30f3\u30b8\u5185\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u6570\u5f0f\u7fa4\u3092\u4e8c\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\n\u305d\u306e\u5f8c\u3001\u6570\u5f0f\u3092\u524a\u9664\u3057activeRange.setValues(valuesToEraseFormula)\u3001\u518d\u5ea6\u6570\u5f0f\u3092\u8a2d\u5b9aactiveRange.setValues(valuesToRestoreFormula)\u3059\u308b\u3053\u3068\u3067\u3001Google\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u6570\u5f0f\u3092\u5f37\u5236\u7684\u306b\u518d\u8a08\u7b97\u3055\u305b\u3066\u3044\u308b\u3002\n\u306a\u304a\u3001\u5143\u3005\u6570\u5f0f\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u30bb\u30eb\u306fSpreadsheetApp.getActiveRange()\u3067\u306f\u7a7a\u6587\u5b57\u5217\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\u306a\u306e\u3067\u3001activeRange.getValues()\u3092\u5b9f\u884c\u3057\u3066\u3001\u30bb\u30eb\u306e\u5024\u3092\u6d88\u3055\u306a\u3044\u3088\u3046\u306a\u51e6\u7406\u3082\u884c\u3063\u3066\u3044\u308b\u3002\n\n\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\nGist: katz/RecalculateSellectedCells.gs\u3067\u516c\u958b\u3057\u3066\u3044\u308b\u3002\n/**\n * @OnlyCurrentDoc  Limits the script to only accessing the current spreadsheet.\n */\n\n\n/**\n * Adds a custom menu with items to show the sidebar and dialog.\n *\n * @param {Object} e The event parameter for a simple onOpen trigger.\n */\nfunction onOpen(e) {\n  SpreadsheetApp.getUi()\n      .createAddonMenu()\n      .addItem('Re-calculate selected cells', 'recalculate')\n      .addToUi();\n}\n\n\n/**\n * Force Spreadsheet to re-calculate selected cells\n */\nfunction recalculate(){\n  var activeRange = SpreadsheetApp.getActiveRange();\n  var originalFormulas = activeRange.getFormulas();\n  var originalValues = activeRange.getValues();\n\n  var valuesToEraseFormula = [];\n  var valuesToRestoreFormula = [];\n\n  originalFormulas.forEach(function(outerVal, outerIdx){\n    valuesToEraseFormula[outerIdx] = [];\n    valuesToRestoreFormula[outerIdx] = [];\n    outerVal.forEach(function(innerVal, innerIdx){\n      if('' === innerVal){\n        //The cell doesn't have formula\n        valuesToEraseFormula[outerIdx][innerIdx] = originalValues[outerIdx][innerIdx];\n        valuesToRestoreFormula[outerIdx][innerIdx] = originalValues[outerIdx][innerIdx];\n      }else{\n        //The cell has a formula.\n        valuesToEraseFormula[outerIdx][innerIdx] = '';\n        valuesToRestoreFormula[outerIdx][innerIdx] = originalFormulas[outerIdx][innerIdx];\n      }\n    })\n  })\n\n  activeRange.setValues(valuesToEraseFormula);\n  activeRange.setValues(valuesToRestoreFormula);\n}\n\n\n/**\n * Runs when the add-on is installed; calls onOpen() to ensure menu creation and\n * any other initializion work is done immediately.\n *\n * @param {Object} e The event parameter for a simple onInstall trigger.\n */\nfunction onInstall(e) {\n  onOpen(e);\n}\n\n\n\n#\u6982\u8981\n[Google\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8](https://www.google.com/intl/ja_jp/sheets/about/)\u3067\u8a08\u7b97\u5f0f\u304c\u6ca2\u5c71\u3042\u308b\u30b7\u30fc\u30c8\u3092\u958b\u304f\u3068\u3001\u305f\u307e\u306b\u8a08\u7b97\u304c\u6b63\u3057\u304f\u884c\u308f\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u304c\u3042\u308b\u3002\n\u8a08\u7b97\u5f0f\u3092\u4e00\u56de\u6d88\u3057\u3066\u518d\u5ea6\u8a2d\u5b9a\u3059\u308b\u3068\u6b63\u3057\u304f\u8a08\u7b97\u3057\u76f4\u3057\u3066\u304f\u308c\u308b\u306e\u3067\u3001\u305d\u308c\u3092\u81ea\u52d5\u7684\u306b\u884c\u3046Apps Script\u3092\u66f8\u3044\u305f\u3002\n\n\u4ee5\u4e0b\u306eAppsScript\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u5f8c\u3001\u518d\u8a08\u7b97\u5bfe\u8c61\u306e\u30bb\u30eb\u3092\u9078\u629e\u3057\u3001\u30e1\u30cb\u30e5\u30fc\u304b\u3089\u300cRe-calculate selected cells\u300d\u3092\u9078\u3076\u3068AppsScript\u304c\u518d\u8a08\u7b97\u3057\u3066\u304f\u308c\u308b\u3002\n![Google Sheet\u306eAdd-ons\u30e1\u30cb\u30e5\u30fc](https://qiita-image-store.s3.amazonaws.com/0/10682/8f142419-57f4-b93f-3bc2-dcaa44f51934.png)\n\n\n#\u4e0b\u8a18\u306e\u30b3\u30fc\u30c9\u3067\u306a\u306b\u3092\u3057\u3066\u3044\u308b\u306e\u304b\u306e\u89e3\u8aac\n\n`onOpen()`\u3067Google Sheet\u306eAdd-ons\u30e1\u30cb\u30e5\u30fc\u306b\u300cRe-calculate selected cells\u300d\u3068\u3044\u3046\u30e1\u30cb\u30e5\u30fc\u9805\u76ee\u3092\u8ffd\u52a0\u3057\u3066\u3044\u308b\u3002\u305d\u306e\u30e1\u30cb\u30e5\u30fc\u9805\u76ee\u304c\u62bc\u3055\u308c\u305f\u3089`recalculate()`\u3068\u3044\u3046\u95a2\u6570\u304c\u547c\u3073\u51fa\u3055\u308c\u308b\u3002\n\n`recalculate()`\u306e\u4e2d\u3067\u306f\u3001\u307e\u305a`SpreadsheetApp.getActiveRange()`\u3092\u547c\u3073\u51fa\u3057\u3001\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u4e0a\u3067\u9078\u629e\u3055\u308c\u3066\u3044\u308b\u30bb\u30eb\u306e\u30ec\u30f3\u30b8\u3092`activeRange`\u3068\u3057\u3066\u53d6\u5f97\u3059\u308b\u3002\n`activeRange`\u306b\u5bfe\u3057\u3066`getFormulas()`\u3092\u547c\u3073\u51fa\u3059\u3053\u3068\u3067\u3001\u9078\u629e\u3057\u305f\u30ec\u30f3\u30b8\u5185\u306b\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u308b\u6570\u5f0f\u7fa4\u3092\u4e8c\u6b21\u5143\u914d\u5217\u3068\u3057\u3066\u53d6\u5f97\u3057\u3066\u3044\u308b\u3002\n\n\u305d\u306e\u5f8c\u3001\u6570\u5f0f\u3092\u524a\u9664\u3057`activeRange.setValues(valuesToEraseFormula)`\u3001\u518d\u5ea6\u6570\u5f0f\u3092\u8a2d\u5b9a`activeRange.setValues(valuesToRestoreFormula)`\u3059\u308b\u3053\u3068\u3067\u3001Google\u30b9\u30d7\u30ec\u30c3\u30c9\u30b7\u30fc\u30c8\u306b\u6570\u5f0f\u3092\u5f37\u5236\u7684\u306b\u518d\u8a08\u7b97\u3055\u305b\u3066\u3044\u308b\u3002\n\n\u306a\u304a\u3001\u5143\u3005\u6570\u5f0f\u304c\u8a2d\u5b9a\u3055\u308c\u3066\u3044\u306a\u3044\u30bb\u30eb\u306f`SpreadsheetApp.getActiveRange()`\u3067\u306f\u7a7a\u6587\u5b57\u5217\u304c\u8fd4\u3063\u3066\u304f\u308b\u3002\u306a\u306e\u3067\u3001`activeRange.getValues()`\u3092\u5b9f\u884c\u3057\u3066\u3001\u30bb\u30eb\u306e\u5024\u3092\u6d88\u3055\u306a\u3044\u3088\u3046\u306a\u51e6\u7406\u3082\u884c\u3063\u3066\u3044\u308b\u3002\n\n#\u5b9f\u969b\u306e\u30b3\u30fc\u30c9\n[Gist: katz/RecalculateSellectedCells.gs](https://gist.github.com/katz/ab751588580469b35e08)\u3067\u516c\u958b\u3057\u3066\u3044\u308b\u3002\n\n```js\n/**\n * @OnlyCurrentDoc  Limits the script to only accessing the current spreadsheet.\n */\n\n\n/**\n * Adds a custom menu with items to show the sidebar and dialog.\n *\n * @param {Object} e The event parameter for a simple onOpen trigger.\n */\nfunction onOpen(e) {\n  SpreadsheetApp.getUi()\n      .createAddonMenu()\n      .addItem('Re-calculate selected cells', 'recalculate')\n      .addToUi();\n}\n\n\n/**\n * Force Spreadsheet to re-calculate selected cells\n */\nfunction recalculate(){\n  var activeRange = SpreadsheetApp.getActiveRange();\n  var originalFormulas = activeRange.getFormulas();\n  var originalValues = activeRange.getValues();\n  \n  var valuesToEraseFormula = [];\n  var valuesToRestoreFormula = [];\n  \n  originalFormulas.forEach(function(outerVal, outerIdx){\n    valuesToEraseFormula[outerIdx] = [];\n    valuesToRestoreFormula[outerIdx] = [];\n    outerVal.forEach(function(innerVal, innerIdx){\n      if('' === innerVal){\n        //The cell doesn't have formula\n        valuesToEraseFormula[outerIdx][innerIdx] = originalValues[outerIdx][innerIdx];\n        valuesToRestoreFormula[outerIdx][innerIdx] = originalValues[outerIdx][innerIdx];\n      }else{\n        //The cell has a formula.\n        valuesToEraseFormula[outerIdx][innerIdx] = '';\n        valuesToRestoreFormula[outerIdx][innerIdx] = originalFormulas[outerIdx][innerIdx];\n      }\n    })\n  })\n  \n  activeRange.setValues(valuesToEraseFormula);\n  activeRange.setValues(valuesToRestoreFormula);\n}\n\n\n/**\n * Runs when the add-on is installed; calls onOpen() to ensure menu creation and\n * any other initializion work is done immediately.\n *\n * @param {Object} e The event parameter for a simple onInstall trigger.\n */\nfunction onInstall(e) {\n  onOpen(e);\n}\n\n\n```\n", "tags": ["GoogleAppsScript"]}