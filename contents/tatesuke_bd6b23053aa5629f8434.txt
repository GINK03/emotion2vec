{"context": "\n\n\u521d\u3081\u306b\n\u30bf\u30a4\u30c8\u30eb\u901a\u308a\u3002JavaSE\u3067Jetty\u3092\u4f7f\u3063\u3066WebSocket(JSR-356\u4f7f\u7528)\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u305f\u306e\u3067\u6700\u5c0f\u69cb\u6210\u306e\u30e1\u30e2\u3002\n\n\u65b9\u6cd5\n\u5fc5\u8981\u306a\u3082\u306e\u306f\u305f\u3063\u305f\u4e8c\u3064\u3002\n\n\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u7528\u306e\u30af\u30e9\u30b9(JSR-356\u6e96\u62e0)\n\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308bMain\u30e1\u30bd\u30c3\u30c9\n\n\npom.xml\n\u6a19\u6e96\u306ejavax.websocket-api\u3068Jetty\u306ejavax-websocket-server-impl\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\u30fb\u30fb\u30fb\n<dependency>\n    <groupId>javax.websocket</groupId>\n    <artifactId>javax.websocket-api</artifactId>\n    <version>1.1</version>\n</dependency>\n<dependency>\n    <groupId>org.eclipse.jetty.websocket</groupId>\n    <artifactId>javax-websocket-server-impl</artifactId>\n    <version>9.3.8.v20160314</version>\n</dependency>\n\u30fb\u30fb\u30fb\n\n\nEndPoint\nJSR-356\u306b\u6e96\u62e0\u3057\u3066\u66f8\u304f\u3060\u3051\u3002\u6a19\u6e96\u4ed5\u69d8\u306a\u306e\u3067Jetty\u306f\u95a2\u4fc2\u306a\u3044\u3002\n\nEchoServer\npackage com.tatesuke.lab.jetty_standalone_websocket_server;\n\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n/**\n * \u8a00\u308f\u308c\u305f\u3053\u3068\u3092\u8fd4\u3059\u3060\u3051\u306e\u5358\u7d14\u306aWebScoketServerEndPoint\n */\n@ServerEndpoint(\"/echo\")\npublic class EchoServer {\n\n    @OnOpen\n    public void onOpen(Session session) {\n        /* \u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u6642\u306e\u51e6\u7406 */\n        System.out.println(\"onOpen\");\n    }\n\n    @OnMessage\n    public String onMessage(String message) {\n        System.out.println(\"onMessage \" + message);\n        return \"You said \\\"\" + message + \"\\\".\";\n    }\n\n    @OnError\n    public void onError(Throwable t) {\n        t.printStackTrace();\n    }\n\n    @OnClose\n    public void onClose(Session session) {\n        System.out.println(\"onClose\");\n    }\n}\n\n\n\nMain\u95a2\u6570\n\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30ed\u30b8\u30c3\u30af\u3092\u304b\u3044\u3066\u3084\u308b\u3002\n\nMain.java\npackage com.tatesuke.lab.jetty_standalone_websocket_server;\n\nimport javax.websocket.server.ServerContainer;\n\nimport org.eclipse.jetty.server.Server;\nimport org.eclipse.jetty.server.ServerConnector;\nimport org.eclipse.jetty.servlet.ServletContextHandler;\nimport org.eclipse.jetty.websocket.jsr356.server.deploy.WebSocketServerContainerInitializer;\n\n/**\n * Jetty\u306b\u3088\u308bStandalone Websocket Server\u306emain\u30e1\u30bd\u30c3\u30c9\n */\npublic class Main {\n\n    public static void main(String[] args) throws Exception {\n        Server server = null;\n        try {\n            // Server\u3092\u751f\u6210\n            server = new Server();\n            ServerConnector connector = new ServerConnector(server);\n            connector.setPort(8080);\n            connector.setHost(\"127.0.0.1\");\n            server.addConnector(connector);\n\n            // ServletContextHandler\u3092\u751f\u6210\n            ServletContextHandler context = new ServletContextHandler(\n                    ServletContextHandler.SESSIONS);\n            context.setContextPath(\"/lab\");\n            server.setHandler(context);\n\n            // ServerContainer\u3092\u751f\u6210\n            ServerContainer wscontainer = WebSocketServerContainerInitializer\n                    .configureContext(context);\n            wscontainer.addEndpoint(EchoServer.class);\n\n            // Server\u8d77\u52d5\n            server.start();\n            server.join();\n        } finally {\n            // Server\u7d42\u4e86\n            if (server != null) {\n                server.stop();\n            }\n        }\n    }\n}\n\n\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u4e0a\u8a18\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u305f\u3089\u3001\u4e0b\u8a18\u306eHTML\u3092\u4fdd\u5b58\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3002\n<!doctype html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>echo-websocket-client-sample</title>\n</head>\n<body>\n    <div>\n        <input placeholder=\"Type text and click button\" type=\"text\">\n        <button>send</button>\n    </div>\n    <div id=\"echoArea\"></div>\n    <script>\n        var button = document.querySelector(\"button\");\n        button.addEventListener(\"click\", function() {\n            var elem = document.querySelector(\"input[type=text]\");\n            var text = elem.value;\n            elem.value = \"\";\n\n            var ws = new WebSocket('ws://localhost:8080/lab/echo');\n            ws.onopen = function() {\n                ws.send(text);\n            }\n            ws.onmessage = function(event) {\n                var echoArea = document.querySelector(\"#echoArea\");\n                var msg = event.data;\n                echoArea.insertAdjacentHTML(\"afterbegin\", msg + \"<br>\");\n                ws.close();\n            }\n        });\n    </script>\n</body>\n</html>\n\n\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u6587\u5b57\u3092\u5165\u529b\u3057\u3066\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u8fd4\u3055\u308c\u305f\u6587\u5b57\u3092\u8868\u793a\u3059\u308b\u3002\n\n\u3055\u3059\u304c\u6a19\u6e96\u4ed5\u69d8\u3002\u3042\u3063\u3051\u306a\u304f\u52d5\u304f\u3002\n\u4eca\u56de\u306f\u4ee5\u4e0a\u3002\n## \u521d\u3081\u306b\n\u30bf\u30a4\u30c8\u30eb\u901a\u308a\u3002JavaSE\u3067Jetty\u3092\u4f7f\u3063\u3066WebSocket(JSR-356\u4f7f\u7528)\u30b5\u30fc\u30d0\u30fc\u3092\u7acb\u3066\u305f\u306e\u3067\u6700\u5c0f\u69cb\u6210\u306e\u30e1\u30e2\u3002\n\n\n## \u65b9\u6cd5\n\u5fc5\u8981\u306a\u3082\u306e\u306f\u305f\u3063\u305f\u4e8c\u3064\u3002\n\n* \u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u7528\u306e\u30af\u30e9\u30b9(JSR-356\u6e96\u62e0)\n* \u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308bMain\u30e1\u30bd\u30c3\u30c9\n\n### pom.xml\n\u6a19\u6e96\u306e``javax.websocket-api``\u3068Jetty\u306e``javax-websocket-server-impl``\u306b\u4f9d\u5b58\u3059\u308b\u3002\n\n```xml\n\u30fb\u30fb\u30fb\n<dependency>\n\t<groupId>javax.websocket</groupId>\n\t<artifactId>javax.websocket-api</artifactId>\n\t<version>1.1</version>\n</dependency>\n<dependency>\n\t<groupId>org.eclipse.jetty.websocket</groupId>\n\t<artifactId>javax-websocket-server-impl</artifactId>\n\t<version>9.3.8.v20160314</version>\n</dependency>\n\u30fb\u30fb\u30fb\n```\n\n### EndPoint\nJSR-356\u306b\u6e96\u62e0\u3057\u3066\u66f8\u304f\u3060\u3051\u3002\u6a19\u6e96\u4ed5\u69d8\u306a\u306e\u3067Jetty\u306f\u95a2\u4fc2\u306a\u3044\u3002\n\n```java:EchoServer \npackage com.tatesuke.lab.jetty_standalone_websocket_server;\n\nimport javax.websocket.OnClose;\nimport javax.websocket.OnError;\nimport javax.websocket.OnMessage;\nimport javax.websocket.OnOpen;\nimport javax.websocket.Session;\nimport javax.websocket.server.ServerEndpoint;\n\n/**\n * \u8a00\u308f\u308c\u305f\u3053\u3068\u3092\u8fd4\u3059\u3060\u3051\u306e\u5358\u7d14\u306aWebScoketServerEndPoint\n */\n@ServerEndpoint(\"/echo\")\npublic class EchoServer {\n\n\t@OnOpen\n\tpublic void onOpen(Session session) {\n\t\t/* \u30bb\u30c3\u30b7\u30e7\u30f3\u78ba\u7acb\u6642\u306e\u51e6\u7406 */\n\t\tSystem.out.println(\"onOpen\");\n\t}\n\n\t@OnMessage\n\tpublic String onMessage(String message) {\n\t\tSystem.out.println(\"onMessage \" + message);\n\t\treturn \"You said \\\"\" + message + \"\\\".\";\n\t}\n\n\t@OnError\n\tpublic void onError(Throwable t) {\n\t\tt.printStackTrace();\n\t}\n\n\t@OnClose\n\tpublic void onClose(Session session) {\n\t\tSystem.out.println(\"onClose\");\n\t}\n}\n```\n\n### Main\u95a2\u6570\n\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u3059\u308b\u30ed\u30b8\u30c3\u30af\u3092\u304b\u3044\u3066\u3084\u308b\u3002\n\n```java:Main.java\npackage com.tatesuke.lab.jetty_standalone_websocket_server;\n\nimport javax.websocket.server.ServerContainer;\n\nimport org.eclipse.jetty.server.Server;\nimport org.eclipse.jetty.server.ServerConnector;\nimport org.eclipse.jetty.servlet.ServletContextHandler;\nimport org.eclipse.jetty.websocket.jsr356.server.deploy.WebSocketServerContainerInitializer;\n\n/**\n * Jetty\u306b\u3088\u308bStandalone Websocket Server\u306emain\u30e1\u30bd\u30c3\u30c9\n */\npublic class Main {\n\n\tpublic static void main(String[] args) throws Exception {\n\t\tServer server = null;\n\t\ttry {\n\t\t\t// Server\u3092\u751f\u6210\n\t\t\tserver = new Server();\n\t\t\tServerConnector connector = new ServerConnector(server);\n\t\t\tconnector.setPort(8080);\n\t\t\tconnector.setHost(\"127.0.0.1\");\n\t\t\tserver.addConnector(connector);\n\n\t\t\t// ServletContextHandler\u3092\u751f\u6210\n\t\t\tServletContextHandler context = new ServletContextHandler(\n\t\t\t\t\tServletContextHandler.SESSIONS);\n\t\t\tcontext.setContextPath(\"/lab\");\n\t\t\tserver.setHandler(context);\n\n\t\t\t// ServerContainer\u3092\u751f\u6210\n\t\t\tServerContainer wscontainer = WebSocketServerContainerInitializer\n\t\t\t\t\t.configureContext(context);\n\t\t\twscontainer.addEndpoint(EchoServer.class);\n\n\t\t\t// Server\u8d77\u52d5\n\t\t\tserver.start();\n\t\t\tserver.join();\n\t\t} finally {\n\t\t\t// Server\u7d42\u4e86\n\t\t\tif (server != null) {\n\t\t\t\tserver.stop();\n\t\t\t}\n\t\t}\n\t}\n}\n\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n\u4e0a\u8a18\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u3092\u5b9f\u884c\u3057\u305f\u3089\u3001\u4e0b\u8a18\u306eHTML\u3092\u4fdd\u5b58\u3057\u3066\u30d6\u30e9\u30a6\u30b6\u3067\u5b9f\u884c\u3059\u308b\u3002\n\n```html\n<!doctype html>\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>echo-websocket-client-sample</title>\n</head>\n<body>\n\t<div>\n\t\t<input placeholder=\"Type text and click button\" type=\"text\">\n\t\t<button>send</button>\n\t</div>\n\t<div id=\"echoArea\"></div>\n\t<script>\n\t\tvar button = document.querySelector(\"button\");\n\t\tbutton.addEventListener(\"click\", function() {\n\t\t\tvar elem = document.querySelector(\"input[type=text]\");\n\t\t\tvar text = elem.value;\n\t\t\telem.value = \"\";\n\t\t\t\n\t\t\tvar ws = new WebSocket('ws://localhost:8080/lab/echo');\n\t\t\tws.onopen = function() {\n\t\t\t\tws.send(text);\n\t\t\t}\n\t\t\tws.onmessage = function(event) {\n\t\t\t\tvar echoArea = document.querySelector(\"#echoArea\");\n\t\t\t\tvar msg = event.data;\n\t\t\t\techoArea.insertAdjacentHTML(\"afterbegin\", msg + \"<br>\");\n\t\t\t\tws.close();\n\t\t\t}\n\t\t});\n\t</script>\n</body>\n</html>\n```\n\n\u30c6\u30ad\u30b9\u30c8\u30a8\u30ea\u30a2\u306b\u6587\u5b57\u3092\u5165\u529b\u3057\u3066\u30dc\u30bf\u30f3\u3092\u62bc\u3059\u3068\u3001\u30b5\u30fc\u30d0\u30fc\u304b\u3089\u8fd4\u3055\u308c\u305f\u6587\u5b57\u3092\u8868\u793a\u3059\u308b\u3002\n\n![](https://qiita-image-store.s3.amazonaws.com/0/29682/4cc63e10-796d-9877-eed2-e5ef67f1c1db.png)\n\n\u3055\u3059\u304c\u6a19\u6e96\u4ed5\u69d8\u3002\u3042\u3063\u3051\u306a\u304f\u52d5\u304f\u3002\n\n\u4eca\u56de\u306f\u4ee5\u4e0a\u3002\n", "tags": ["websocket", "jetty", "Java", "jsr356", "JavaSE"]}