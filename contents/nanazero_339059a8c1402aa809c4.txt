{"context": "\n\n\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u60c5\u5831\u306e\u9023\u643a\n\u6628\u65e5\u306fApache\u306bmod_auth_openidc\u3068\u3044\u3046Apache\u3092Relying Party\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u5c0e\u5165\u3057\u3001\u5b9f\u969b\u306bFederation\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u3053\u306e\u3068\u304d\u8981\u6c42\u3057\u305f\u60c5\u5831\u306e\u7bc4\u56f2(scope)\u306fopenid\u3068profile\u3067\u3057\u305f\u3002\n\u4ee5\u4e0b\u306f\u3001\u5b9f\u969b\u306bOpenID Provider\u304b\u3089\u9023\u643a\u3057\u305f\u60c5\u5831(profile)\u306b\u306a\u308a\u307e\u3059\u3002\n\n\u4e0a\u8ff0\u306e\u3088\u3046\u306b\u3001profile\u3063\u3066\u3044\u3046scope\u3092\u8981\u6c42\u3057\u305f\u6642\u306f\u3001\u300cFull name\u3001Family name\u3001Given name\u3092\u9023\u643a\u3059\u308b\u3088\uff5e\uff1f\u300d\u3063\u3066\u3044\u3046\u540c\u610f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3001\u5b9f\u969b\u306bRelying Party\u306b\u9023\u643a\u3055\u308c\u307e\u3059\u3002\n\u305f\u3060\u3001\u4f1a\u793e\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3001\u4ed6\u306b\u3082\u6b32\u3057\u3044\u60c5\u5831\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\n\n\u6240\u5c5e\n\u5f79\u8077\n\u6a29\u9650\u30b0\u30eb\u30fc\u30d7\uff08AD\u4e0a\u306eSecurity Group\u306e\u60c5\u5831\uff09\n\n\u3053\u3046\u3044\u3063\u305f\u60c5\u5831\u304c\u8a8d\u8a3c\u6642\u306b\u9023\u643a\u3055\u308c\u308b\u524d\u63d0\u304c\u3042\u308c\u3070\u3001\u696d\u52d9\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u306e\u304c\uff08\u4e3b\u306b\u6a29\u9650\u307e\u308f\u308a\uff09\u304c\u6357\u308b\u3068\u601d\u3044\u307e\u305b\u3093\u304b\uff1f\u304d\u3063\u3068\u6357\u308b\u306f\u305a\uff01^^\u306a\u306e\u3067\u3001\u4eca\u65e5\u306f\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u60c5\u5831\u3092\u5897\u3084\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n\u4f1a\u793e\u3063\u307d\u3044\u5c5e\u6027\u3092\u6301\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n\u4eca\u65e5\u306f\u3053\u308c\u307e\u3067\u4f7f\u3063\u3066\u3044\u305f\u691c\u8a3c\u7528\u30a2\u30ab\u30a6\u30f3\u30c8\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306fjohnd\uff09\u306f\u4f7f\u308f\u305a\u306b\u3001\u65b0\u305f\u306b\u4f1a\u793e\u3063\u307d\u3044\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u6301\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u3001\u305d\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3092\u9023\u643a\u3059\u308b\u3068\u3044\u3046\u65b9\u91dd\u3067\u884c\u304d\u307e\u3059\u3002\n\u307e\u305a\u3001\u4ee5\u4e0b\u306eLDIF\uff08\u30d5\u30a1\u30a4\u30eb\u540d\u306fsample.ldif\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u69cb\u6210\u306f\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n\nINFOSYS01\u3063\u3066\u7d44\u7e54\u304c\u3042\u308b\n\ngnanashi\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u308b\n\ngnanashi\u306fINFOSYS01\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\n\ngnanashi\u306fManager\u3067\u3042\u308b\n\ndn: cn=INFOSYS01,ou=groups,dc=openam,dc=forgerock,dc=org\nchangetype: add\nobjectClass: groupofuniquenames\nobjectClass: top\ncn: INFOSYS01\nuniqueMember: uid=nanashi,ou=people,dc=openam,dc=forgerock,dc=org\n\ndn: uid=gnanashi,ou=people,dc=openam,dc=forgerock,dc=org\nchangetype: add\nobjectClass: inetuser\nobjectClass: iplanet-am-managed-person\nobjectClass: kbaInfoContainer\nobjectClass: iplanet-am-auth-configuration-service\nobjectClass: devicePrintProfilesContainer\nobjectClass: sunFederationManagerDataStore\nobjectClass: inetorgperson\nobjectClass: forgerock-am-dashboard-service\nobjectClass: sunFMSAML2NameIdentifier\nobjectClass: sunIdentityServerLibertyPPService\nobjectClass: top\nobjectClass: iPlanetPreferences\nobjectClass: sunAMAuthAccountLockout\nobjectClass: pushDeviceProfilesContainer\nobjectClass: organizationalperson\nobjectClass: person\nobjectClass: iplanet-am-user-service\nobjectClass: oathDeviceProfilesContainer\ncn: gonbei nanashi\nsn: nanashi\ngivenName: gonbei\nmemberOf: cn=INFOSYS01,ou=groups,dc=openam,dc=forgerock,dc=org\ntitle: Manager\ndepartmentNumber: INFOSYS01\ninetUserStatus: Active\nuid: gnanashi\nuserPassword: password\n\nOpenAM\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u30b5\u30fc\u30d0\u30fc\u306b\u306fldap\u67d0\u7cfb\u306e\u30b3\u30de\u30f3\u30c9\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u305d\u306e\u4e2d\u306eldapmodify\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u4f5c\u6210\u3057\u305fLDIF\u3067\u30e6\u30fc\u30b6\u30fc\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n$ sudo /home/openam/openam/opends/bin/ldapmodify -D \"cn=Directory Manager\" -w password -h localhost -p 50389 -f ~/sample.ldif\n\n\n\u8ffd\u52a0\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3092OpenAM\u306e\u691c\u7d22\u5bfe\u8c61\u306b\u52a0\u3048\u308b\n\u672c\u9023\u8f09\u3067\u7528\u610f\u3057\u3066\u3044\u308bOpenAM\u306e\u30e6\u30fc\u30b6\u30fc\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u5185\u8535(embedded)\u306eLDAP\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001OpenAM\u306f\u3042\u3089\u304b\u3058\u3081\u8a2d\u5b9a\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3057\u304b\u691c\u7d22\u5bfe\u8c61\u306b\u52a0\u3048\u306a\u3044\u69cb\u6210\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3088\u3063\u3066\u3001\u660e\u793a\u7684\u306bdepartmentNumber\u3084title\u3092\u691c\u7d22\u5bfe\u8c61\u3068\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\nTop Realm Level => Data Stores => embedded\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\nLDAP\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306bdepartmentNumber\u3084title\u3092\u8ffd\u52a0\u3057\u3066\u3084\u308b\u3002\uff08memberOf\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u691c\u7d22\u5bfe\u8c61\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\uff09\n\n\nprofile\u306escope\u3067\u9023\u643a\u3059\u308b\u5c5e\u6027\u3092\u8ffd\u52a0\u3059\u308b\n\u6628\u65e5\u8a2d\u5b9a\u3057\u305fmod_auth_openidc\u306fscope=openid profile\u3068\u6307\u5b9a\u3057\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u60c5\u5831\u3092\u8981\u6c42\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3053\u3053\u306e\u8a2d\u5b9a\u306f\u5909\u66f4\u305b\u305a\u3001profile\u3068\u3044\u3046\u30b9\u30b3\u30fc\u30d7\u3092\u8981\u6c42\u3055\u308c\u305f\u3089\u3001\u5f79\u8077\u3084\u6240\u5c5e\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u9023\u643a\u3059\u308b\u3068\u3044\u3046\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\nTop Realm Level => Scripts => OIDC Claims Script\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\nGROOVY\u3067\u66f8\u304b\u308c\u305f\u30b3\u30fc\u30c9\u304c\u30d6\u30e9\u30a6\u30b6\u4e0a\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30b3\u30fc\u30c9\u306e64\u884c\u76ee\u4ee5\u964d\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\u5909\u66f4\u5185\u5bb9\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e2\u70b9\u3067\u3059\u3002\n\n\u9023\u643a\u3059\u308b\u5bfe\u8c61\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306bmemberOf\u3001departmentNumber\u3001title\u3092\u8ffd\u52a0\nprofile\u3068\u3044\u3046scope\u306b\u4e0a\u8ff0\u306e3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u542b\u3080\n\n// [ {claim}: {attribute retriever}, ... ]\nclaimAttributes = [\n        \"email\": attributeRetriever.curry(\"mail\"),\n        \"address\": { claim, identity, requested -> [ \"formatted\" : attributeRetriever(\"postaladdress\", claim, identity, requested) ] },\n        \"phone_number\": attributeRetriever.curry(\"telephonenumber\"),\n        \"given_name\": attributeRetriever.curry(\"givenname\"),\n        \"zoneinfo\": attributeRetriever.curry(\"preferredtimezone\"),\n        \"family_name\": attributeRetriever.curry(\"sn\"),\n        \"locale\": attributeRetriever.curry(\"preferredlocale\"),\n        \"name\": attributeRetriever.curry(\"cn\"),\n        \"memberOf\": attributeRetriever.curry(\"memberOf\"),\n        \"departmentNumber\": attributeRetriever.curry(\"departmentNumber\"),\n        \"title\": attributeRetriever.curry(\"title\")\n]\n\n// {scope}: [ {claim}, ... ]\nscopeClaimsMap = [\n        \"email\": [ \"email\" ],\n        \"address\": [ \"address\" ],\n        \"phone\": [ \"phone_number\" ],\n        \"profile\": [ \"given_name\", \"zoneinfo\", \"family_name\", \"locale\", \"name\", \"memberOf\", \"departmentNumber\", \"title\" ]\n]\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\u6628\u65e5\u3068\u540c\u69d8\u306b\u3001Federation\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u78ba\u8a8d\u3059\u308b\u306e\u3067\u3001Relying Party\u4e0a\u306b\u914d\u7f6e\u3057\u305fphpinfo()\u3092\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\uff08\u672c\u8a18\u4e8b\u3067\u306fhttps://rp.example.com/cgi-bin/phpinfo.php\uff09\n\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u4eca\u56deLDIF\u3067\u8ffd\u52a0\u3057\u305f\u30e6\u30fc\u30b6\u30fc\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306fgnanashi\uff09\u3067\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n\u8a8d\u8a3c\u5f8c\u3001Federation\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306e\u9023\u643a\u306e\u540c\u610f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4eca\u56de\u8ffd\u52a0\u3092\u884c\u3063\u305f3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\u540c\u610f\u5f8c\u3001Relying Party\u4e0a\u306ephpinfo()\u304c\u5b9f\u884c\u3055\u308c\u3001PHP\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9023\u643a\u3055\u308c\u3066\u3044\u308bHeader\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u3070\u3063\u3061\u308a\u3001\u8ffd\u52a0\u3092\u884c\u3063\u305f3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u304c\u9023\u643a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n\u307e\u3068\u3081\n\u4eca\u65e5\u306e\u307e\u3068\u3081(\u00b4\u03c1`)\n\n\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306f\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\n\u65e2\u5b58\u306escope\u306b\u8ffd\u52a0\u3067\u304d\u308b\n\uff08\u672c\u8a18\u4e8b\u3067\u306f\u3084\u3063\u3066\u306a\u3044\u3051\u3069\u3001\uff09\u65b0\u305f\u306b\u30aa\u30ea\u30b8\u30ca\u30eb\u306escope\u3092\u8ffd\u52a0\u3057\u3066\u3001\u305d\u3053\u306b\u65b0\u305f\u306b\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\n\n\u3061\u306a\u307f\u306b\u4e00\u756a\u6700\u5f8c\u306e\u3084\u3064\u3092\u3084\u308b\u3068\u304d\u306f\u3001Relying Party\u306e\u8a2d\u5b9a\u3067\u3001\u8981\u6c42\u53ef\u80fd\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u3082\u8ffd\u52a0\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\u305d\u308d\u305d\u308d\u6298\u308a\u8fd4\u3057\u304b\u306a\uff1f\uff1f\u5f8c\u534a\u6226\u3082\u304c\u3093\u3070\u308b\uff01\n\u3070\u3044\uff01\n## \u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u60c5\u5831\u306e\u9023\u643a\n\n\u6628\u65e5\u306fApache\u306bmod_auth_openidc\u3068\u3044\u3046**Apache\u3092Relying Party\u3068\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u30e2\u30b8\u30e5\u30fc\u30eb**\u3092\u5c0e\u5165\u3057\u3001\u5b9f\u969b\u306bFederation\u3092\u3084\u3063\u3066\u307f\u307e\u3057\u305f\u3002\u3053\u306e\u3068\u304d\u8981\u6c42\u3057\u305f\u60c5\u5831\u306e\u7bc4\u56f2(scope)\u306f`openid`\u3068`profile`\u3067\u3057\u305f\u3002\n\n\u4ee5\u4e0b\u306f\u3001\u5b9f\u969b\u306bOpenID Provider\u304b\u3089\u9023\u643a\u3057\u305f\u60c5\u5831(profile)\u306b\u306a\u308a\u307e\u3059\u3002\n\n<img width=\"550\" alt=\"001.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/1baba75a-e62c-c2d9-5f43-92b655c4a152.jpeg\">\n\n\u4e0a\u8ff0\u306e\u3088\u3046\u306b\u3001profile\u3063\u3066\u3044\u3046scope\u3092\u8981\u6c42\u3057\u305f\u6642\u306f\u3001**\u300c`Full name`\u3001`Family name`\u3001`Given name`\u3092\u9023\u643a\u3059\u308b\u3088\uff5e\uff1f\u300d**\u3063\u3066\u3044\u3046\u540c\u610f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u3001\u5b9f\u969b\u306bRelying Party\u306b\u9023\u643a\u3055\u308c\u307e\u3059\u3002\n\n\u305f\u3060\u3001\u4f1a\u793e\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u52d5\u4f5c\u3055\u305b\u308b\u306b\u306f\u3001\u4ed6\u306b\u3082\u6b32\u3057\u3044\u60c5\u5831\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059\u3002\u4f8b\u3048\u3070\u3001\n\n* \u6240\u5c5e\n* \u5f79\u8077\n* \u6a29\u9650\u30b0\u30eb\u30fc\u30d7\uff08AD\u4e0a\u306eSecurity Group\u306e\u60c5\u5831\uff09\n\n\u3053\u3046\u3044\u3063\u305f\u60c5\u5831\u304c\u8a8d\u8a3c\u6642\u306b\u9023\u643a\u3055\u308c\u308b\u524d\u63d0\u304c\u3042\u308c\u3070\u3001\u696d\u52d9\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u4f5c\u308b\u306e\u304c\uff08\u4e3b\u306b\u6a29\u9650\u307e\u308f\u308a\uff09\u304c\u6357\u308b\u3068\u601d\u3044\u307e\u305b\u3093\u304b\uff1f\u304d\u3063\u3068\u6357\u308b\u306f\u305a\uff01^^\u306a\u306e\u3067\u3001\u4eca\u65e5\u306f\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u60c5\u5831\u3092\u5897\u3084\u3057\u3066\u307f\u307e\u3057\u3087\u3046\u3002\n\n## \u4f1a\u793e\u3063\u307d\u3044\u5c5e\u6027\u3092\u6301\u3063\u305f\u30e6\u30fc\u30b6\u30fc\u3092\u8ffd\u52a0\n\n\u4eca\u65e5\u306f\u3053\u308c\u307e\u3067\u4f7f\u3063\u3066\u3044\u305f\u691c\u8a3c\u7528\u30a2\u30ab\u30a6\u30f3\u30c8\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306f`johnd`\uff09\u306f\u4f7f\u308f\u305a\u306b\u3001\u65b0\u305f\u306b**\u4f1a\u793e\u3063\u307d\u3044\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u6301\u3063\u305f\u30e6\u30fc\u30b6\u30fc**\u3092\u8ffd\u52a0\u3057\u3066\u3001\u305d\u306e\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3092\u9023\u643a\u3059\u308b\u3068\u3044\u3046\u65b9\u91dd\u3067\u884c\u304d\u307e\u3059\u3002\n\n\u307e\u305a\u3001\u4ee5\u4e0b\u306eLDIF\uff08\u30d5\u30a1\u30a4\u30eb\u540d\u306f`sample.ldif`\uff09\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u69cb\u6210\u306f\u30b7\u30f3\u30d7\u30eb\u3067\u3059\u3002\n\n* `INFOSYS01`\u3063\u3066\u7d44\u7e54\u304c\u3042\u308b\n* `gnanashi`\u3063\u3066\u30e6\u30fc\u30b6\u30fc\u304c\u3044\u308b\n* `gnanashi`\u306f`INFOSYS01`\u306b\u6240\u5c5e\u3057\u3066\u3044\u308b\n* `gnanashi`\u306f`Manager`\u3067\u3042\u308b\n\n```\ndn: cn=INFOSYS01,ou=groups,dc=openam,dc=forgerock,dc=org\nchangetype: add\nobjectClass: groupofuniquenames\nobjectClass: top\ncn: INFOSYS01\nuniqueMember: uid=nanashi,ou=people,dc=openam,dc=forgerock,dc=org\n\ndn: uid=gnanashi,ou=people,dc=openam,dc=forgerock,dc=org\nchangetype: add\nobjectClass: inetuser\nobjectClass: iplanet-am-managed-person\nobjectClass: kbaInfoContainer\nobjectClass: iplanet-am-auth-configuration-service\nobjectClass: devicePrintProfilesContainer\nobjectClass: sunFederationManagerDataStore\nobjectClass: inetorgperson\nobjectClass: forgerock-am-dashboard-service\nobjectClass: sunFMSAML2NameIdentifier\nobjectClass: sunIdentityServerLibertyPPService\nobjectClass: top\nobjectClass: iPlanetPreferences\nobjectClass: sunAMAuthAccountLockout\nobjectClass: pushDeviceProfilesContainer\nobjectClass: organizationalperson\nobjectClass: person\nobjectClass: iplanet-am-user-service\nobjectClass: oathDeviceProfilesContainer\ncn: gonbei nanashi\nsn: nanashi\ngivenName: gonbei\nmemberOf: cn=INFOSYS01,ou=groups,dc=openam,dc=forgerock,dc=org\ntitle: Manager\ndepartmentNumber: INFOSYS01\ninetUserStatus: Active\nuid: gnanashi\nuserPassword: password\n```\n\nOpenAM\u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u305f\u30b5\u30fc\u30d0\u30fc\u306b\u306f**ldap\u67d0\u7cfb\u306e\u30b3\u30de\u30f3\u30c9**\u304c\u914d\u7f6e\u3055\u308c\u307e\u3059\u306e\u3067\u3001\u305d\u306e\u4e2d\u306e**ldapmodify**\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u3001\u4f5c\u6210\u3057\u305fLDIF\u3067\u30e6\u30fc\u30b6\u30fc\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\n\n```bash\n$ sudo /home/openam/openam/opends/bin/ldapmodify -D \"cn=Directory Manager\" -w password -h localhost -p 50389 -f ~/sample.ldif\n```\n\n## \u8ffd\u52a0\u3057\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3092OpenAM\u306e\u691c\u7d22\u5bfe\u8c61\u306b\u52a0\u3048\u308b\n\n\u672c\u9023\u8f09\u3067\u7528\u610f\u3057\u3066\u3044\u308bOpenAM\u306e\u30e6\u30fc\u30b6\u30fc\u30ea\u30dd\u30b8\u30c8\u30ea\u306f\u5185\u8535(embedded)\u306eLDAP\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u5834\u5408\u3001OpenAM\u306f**\u3042\u3089\u304b\u3058\u3081\u8a2d\u5b9a\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u306e\u5c5e\u6027\u3057\u304b\u691c\u7d22\u5bfe\u8c61\u306b\u52a0\u3048\u306a\u3044\u69cb\u6210**\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3088\u3063\u3066\u3001\u660e\u793a\u7684\u306b`departmentNumber`\u3084`title`\u3092\u691c\u7d22\u5bfe\u8c61\u3068\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\n\n**Top Realm Level => Data Stores => embedded**\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3002\n\n**LDAP\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027**\u306b`departmentNumber`\u3084`title`\u3092\u8ffd\u52a0\u3057\u3066\u3084\u308b\u3002\uff08`memberOf`\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u691c\u7d22\u5bfe\u8c61\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\uff09\n\n<img width=\"796\" alt=\"002.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/649c17c3-f427-23b4-ce6b-42b3ef165df0.jpeg\">\n\n## profile\u306escope\u3067\u9023\u643a\u3059\u308b\u5c5e\u6027\u3092\u8ffd\u52a0\u3059\u308b\n\n\u6628\u65e5\u8a2d\u5b9a\u3057\u305fmod_auth_openidc\u306f`scope=openid profile`\u3068\u6307\u5b9a\u3057\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u60c5\u5831\u3092\u8981\u6c42\u3059\u308b\u8a2d\u5b9a\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3053\u3053\u306e\u8a2d\u5b9a\u306f\u5909\u66f4\u305b\u305a\u3001**profile\u3068\u3044\u3046\u30b9\u30b3\u30fc\u30d7\u3092\u8981\u6c42\u3055\u308c\u305f\u3089\u3001\u5f79\u8077\u3084\u6240\u5c5e\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u9023\u643a\u3059\u308b**\u3068\u3044\u3046\u8a2d\u5b9a\u3092\u3057\u307e\u3059\u3002\n\n**Top Realm Level => Scripts => OIDC Claims Script**\u3092\u30af\u30ea\u30c3\u30af\u3057\u307e\u3059\u3002\n\n<img width=\"898\" alt=\"003.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/02635f76-2ed5-d19c-e3ee-c581f1da542d.jpeg\">\n\nGROOVY\u3067\u66f8\u304b\u308c\u305f\u30b3\u30fc\u30c9\u304c\u30d6\u30e9\u30a6\u30b6\u4e0a\u306b\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30b3\u30fc\u30c9\u306e**64\u884c\u76ee\u4ee5\u964d**\u3092\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u7de8\u96c6\u3057\u307e\u3059\u3002\u5909\u66f4\u5185\u5bb9\u3068\u3057\u3066\u306f\u4ee5\u4e0b\u306e2\u70b9\u3067\u3059\u3002\n\n* \u9023\u643a\u3059\u308b\u5bfe\u8c61\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306b`memberOf`\u3001`departmentNumber`\u3001`title`\u3092\u8ffd\u52a0\n* profile\u3068\u3044\u3046scope\u306b\u4e0a\u8ff0\u306e3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u542b\u3080\n\n```groovy\n// [ {claim}: {attribute retriever}, ... ]\nclaimAttributes = [\n        \"email\": attributeRetriever.curry(\"mail\"),\n        \"address\": { claim, identity, requested -> [ \"formatted\" : attributeRetriever(\"postaladdress\", claim, identity, requested) ] },\n        \"phone_number\": attributeRetriever.curry(\"telephonenumber\"),\n        \"given_name\": attributeRetriever.curry(\"givenname\"),\n        \"zoneinfo\": attributeRetriever.curry(\"preferredtimezone\"),\n        \"family_name\": attributeRetriever.curry(\"sn\"),\n        \"locale\": attributeRetriever.curry(\"preferredlocale\"),\n        \"name\": attributeRetriever.curry(\"cn\"),\n        \"memberOf\": attributeRetriever.curry(\"memberOf\"),\n        \"departmentNumber\": attributeRetriever.curry(\"departmentNumber\"),\n        \"title\": attributeRetriever.curry(\"title\")\n]\n\n// {scope}: [ {claim}, ... ]\nscopeClaimsMap = [\n        \"email\": [ \"email\" ],\n        \"address\": [ \"address\" ],\n        \"phone\": [ \"phone_number\" ],\n        \"profile\": [ \"given_name\", \"zoneinfo\", \"family_name\", \"locale\", \"name\", \"memberOf\", \"departmentNumber\", \"title\" ]\n]\n```\n\n## \u52d5\u4f5c\u78ba\u8a8d\n\n\u6628\u65e5\u3068\u540c\u69d8\u306b\u3001Federation\u3055\u308c\u305f\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u78ba\u8a8d\u3059\u308b\u306e\u3067\u3001Relying Party\u4e0a\u306b\u914d\u7f6e\u3057\u305fphpinfo()\u3092\u5b9f\u884c\u3059\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\uff08\u672c\u8a18\u4e8b\u3067\u306f`https://rp.example.com/cgi-bin/phpinfo.php`\uff09\n\n\u30e6\u30fc\u30b6\u30fc\u8a8d\u8a3c\u306e\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u308b\u306e\u3067\u3001\u4eca\u56deLDIF\u3067\u8ffd\u52a0\u3057\u305f\u30e6\u30fc\u30b6\u30fc\uff08\u30e6\u30fc\u30b6\u30fc\u540d\u306f`gnanashi`\uff09\u3067\u30b5\u30a4\u30f3\u30a4\u30f3\u3057\u307e\u3059\u3002\n\n<img width=\"477\" alt=\"004.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/e9e84910-01e4-b282-4272-55fe4b8c8d8a.jpeg\">\n\n\u8a8d\u8a3c\u5f8c\u3001Federation\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306e\u9023\u643a\u306e\u540c\u610f\u753b\u9762\u304c\u8868\u793a\u3055\u308c\u307e\u3059\u3002\u3053\u3053\u3067\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u78ba\u8a8d\u3059\u308b\u3068\u3001\u4eca\u56de\u8ffd\u52a0\u3092\u884c\u3063\u305f**3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027**\u304c\u4ed8\u52a0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n<img width=\"445\" alt=\"005.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/17d073a0-7a95-0d5a-dfd7-9a5c99449a12.jpeg\">\n\n\u540c\u610f\u5f8c\u3001Relying Party\u4e0a\u306ephpinfo()\u304c\u5b9f\u884c\u3055\u308c\u3001PHP\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9023\u643a\u3055\u308c\u3066\u3044\u308bHeader\u60c5\u5831\u304c\u51fa\u529b\u3055\u308c\u307e\u3059\u3002\n\u3070\u3063\u3061\u308a\u3001\u8ffd\u52a0\u3092\u884c\u3063\u305f**3\u3064\u306e\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027**\u304c\u9023\u643a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\n\n\n<img width=\"742\" alt=\"006.JPG\" src=\"https://qiita-image-store.s3.amazonaws.com/0/148404/2fb23377-1b44-2b72-822b-8682ebdadfed.jpeg\">\n\n\n## \u307e\u3068\u3081\n\n\u4eca\u65e5\u306e\u307e\u3068\u3081(\u00b4\u03c1`)\n\n* \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u306f\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3067\u304d\u308b\n* \u65e2\u5b58\u306escope\u306b\u8ffd\u52a0\u3067\u304d\u308b\n* \uff08\u672c\u8a18\u4e8b\u3067\u306f\u3084\u3063\u3066\u306a\u3044\u3051\u3069\u3001\uff09\u65b0\u305f\u306b\u30aa\u30ea\u30b8\u30ca\u30eb\u306escope\u3092\u8ffd\u52a0\u3057\u3066\u3001\u305d\u3053\u306b\u65b0\u305f\u306b\u9023\u643a\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u5c5e\u6027\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u308b\n\n\u3061\u306a\u307f\u306b\u4e00\u756a\u6700\u5f8c\u306e\u3084\u3064\u3092\u3084\u308b\u3068\u304d\u306f\u3001Relying Party\u306e\u8a2d\u5b9a\u3067\u3001\u8981\u6c42\u53ef\u80fd\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u3082\u8ffd\u52a0\u3057\u3066\u3084\u308b\u5fc5\u8981\u304c\u3042\u3063\u305f\u308a\u3057\u307e\u3059\u3002\n\n\u305d\u308d\u305d\u308d\u6298\u308a\u8fd4\u3057\u304b\u306a\uff1f\uff1f\u5f8c\u534a\u6226\u3082\u304c\u3093\u3070\u308b\uff01\n\n\u3070\u3044\uff01\n", "tags": ["OpenAM"]}