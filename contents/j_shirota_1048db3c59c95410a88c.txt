{"context": "\u958b\u767a\u74b0\u5883\u3092 Vagrant + chef-zero \u3067\u4f5c\u6210\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u304c\u3001\nchef-solo \u306e\u6642\u3088\u308a\u3064\u307e\u3065\u304d\u30dd\u30a4\u30f3\u30c8\u304c\u591a\u304b\u3063\u305f\u306e\u3067\n\"\u5165\u9580\u4ee5\u524d\" \u3068\u3044\u3046\u3053\u3068\u3067\u624b\u9806\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n\u524d\u63d0\n\nMac \u3067\u884c\u3046\nVagrant \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\n\n\u4e8b\u524d\u6e96\u5099\n\nChefDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ curl -L https://www.chef.io/chef/install.sh | sudo bash -s -- -P chefdk\n\n\nknife-zero \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n$ sudo chef gem install knife-zero chef-zero --no-ri --no-rdoc\n\n\n\u74b0\u5883\u5909\u6570 EDITOR \u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n$ vi ~/.zshrc            # \u4f7f\u3063\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u5909\u66f4\n\nexport \"EDITOR=emacs\"    # \u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067\u8a2d\u5b9a\n\n\nVagrant\u8a2d\u5b9a\n\n\u4efb\u610f\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\n\n$ cd ~/Vagrant\n\n\n\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3068Vagrant Box\u540d\u3092\u5909\u6570\u306b\u5165\u308c\u3066\u304a\u304d\u307e\u3059\n\n$ PROJECT_NAME=development\n$ BOX_NAME=centos/7\n\n\n\u4eca\u56de\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u305d\u3053\u306b\u79fb\u52d5\u3057\u3066\u304a\u304f\n\n$ mkdir ${PROJECT_NAME}\n$ cd ${PROJECT_NAME}\n\n\nVagrantfile\u4f5c\u6210\n\n$ vagrant init ${BOX_NAME}\n\n$ vi Vagrantfile\n\n\nnetwork\u8a2d\u5b9a\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n\n\nVagrantfile\n# config.vm.network \"private_network\", ip: \"xxx.xxx.xxx.xxx\"\n\u2193\nconfig.vm.network \"private_network\", ip: \"xxx.xxx.xxx.xxx\"\n\n\n\nVagrant\u3092\u8d77\u52d5\n\n$ vagrant up --provider virtualbox\n\n\nSSH\u8a2d\u5b9a\u3092 .ssh/config \u306b\u8a18\u8f09\u3057\u3066\u304a\u304f\n\n$ vagrant ssh-config --host ${BOX_NAME} >> ~/.ssh/config\n\n\nknife-zero \u3067 chef \u3092\u8a2d\u5b9a\n\nknife.rb \u3092\u4f5c\u6210\n\n$ mkdir chef-repo\n$ cd chef-repo\n$ vi knife.rb\n\n\nknife.rb\nlocal_mode true\nchef_repo_path File.expand_path('../', __FILE__)\n\nknife[:use_sudo] = true\n\nknife[:automatic_attribute_whitelist] = %w[\n  os\n  os_version\n  hostname\n  ipaddress\n  roles\n  recipes\n  platform\n  platform_version\n  cloud\n  cloud_v2\n  chef_packages\n]\n\n\n\n\u30ce\u30fc\u30c9\u3092\u767b\u9332\n\n$ chef exec knife zero bootstrap ${BOX_NAME} --node-name ${PROJECT_NAME}\n\n\n\u30ce\u30fc\u30c9\u30ea\u30b9\u30c8\u3092\u8868\u793a\n\n$ chef exec knife node list\n\n\n\u30ce\u30fc\u30c9\u306e\u8a73\u7d30\u3092\u78ba\u8a8d\n\n$ chef exec knife node show ${PROJECT_NAME}\n\n\n\u30ce\u30fc\u30c9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n$ vi nodes/${PROJECT_NAME}.json\n\n\nnormal \u914d\u4e0b\u306b FQDN\u8a2d\u5b9a \u3092\u4ed8\u3051\u8db3\u3059\n\n\n${PROJECT_NAME}.json\n# \u5909\u66f4\u524d\n\"normal\": {\n    \"knife_zero\": {\n      \"host\": \"{\u30db\u30b9\u30c8\u540d}\"\n    },\n\n# \u5909\u66f4\u5f8c\n\"normal\": {\n    \"knife_zero\": {\n      \"host\": \"{\u30db\u30b9\u30c8\u540d}\"\n    },\n    \"fqdn\": \"{\u30db\u30b9\u30c8\u540d}\",  # <<<<< {\u30db\u30b9\u30c8\u540d}\u306f ${BOX_NAME} \u3068\u540c\u3058\n\n\n\n\u5171\u901acookbook\u3092\u4f5c\u6210\uff08\u4eca\u56de\u306f common \u3068\u3044\u3046\u540d\u79f0\u3067\u4f5c\u6210\uff09\n\n$ chef exec knife cookbook create common\n\n\n\u30ec\u30b7\u30d4\u306b net-tools \u3092\u8a2d\u5b9a\n\n$ vi cookbooks/common/recipes/default.rb\n\n\ncookbooks/common/recipes/default.rb\npackage \"net-tools\" do\n    action :install\nend\n\n\n\n\u30ce\u30fc\u30c9\u306b\u5bfe\u3059\u308b run_list \u306b common \u3092\u8a2d\u5b9a\n\n$ chef exec knife node run_list add ${PROJECT_NAME} common\n\n\nknife zero converge \u3092\u5b9f\u884c\n\n$ chef exec knife zero converge \"name:${PROJECT_NAME}\"\n\n\n\u52d5\u4f5c\u78ba\u8a8d\n\nVagrant\u306bSSH\u30ed\u30b0\u30a4\u30f3\n\n$ ssh ${BOX_NAME}\n\n# \u307e\u305f\u306f\n$ vagrant ssh\n\n\nifconfig \u3092\u5b9f\u884c\n\n$ sudo ifconfig\n\n\nifconfig \u304c\u5b9f\u884c\u3067\u304d\u308c\u3070 net-tools \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\n\u3053\u308c\u3067\u3001\u3042\u3068\u306f\u958b\u767a\u74b0\u5883\u7528\u306b\u30ec\u30b7\u30d4\u3092\u3082\u308a\u3082\u308a\u66f8\u3044\u3066\u884c\u3051\u3070\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n\u958b\u767a\u74b0\u5883\u3092 Vagrant + chef-zero \u3067\u4f5c\u6210\u3057\u3088\u3046\u3068\u601d\u3063\u305f\u304c\u3001\nchef-solo \u306e\u6642\u3088\u308a\u3064\u307e\u3065\u304d\u30dd\u30a4\u30f3\u30c8\u304c\u591a\u304b\u3063\u305f\u306e\u3067\n\"\u5165\u9580\u4ee5\u524d\" \u3068\u3044\u3046\u3053\u3068\u3067\u624b\u9806\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\n\n# \u524d\u63d0\n* Mac \u3067\u884c\u3046\n* Vagrant \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\n# \u4e8b\u524d\u6e96\u5099\n* ChefDK \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ curl -L https://www.chef.io/chef/install.sh | sudo bash -s -- -P chefdk\n```\n\n* knife-zero \u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\n\n```\n$ sudo chef gem install knife-zero chef-zero --no-ri --no-rdoc\n```\n\n* \u74b0\u5883\u5909\u6570 EDITOR \u3092\u8a2d\u5b9a\u3057\u3066\u304a\u304f\n\n```\n$ vi ~/.zshrc            # \u4f7f\u3063\u3066\u3044\u308b\u30b7\u30a7\u30eb\u306b\u5408\u308f\u305b\u3066\u9069\u5b9c\u5909\u66f4\n\nexport \"EDITOR=emacs\"    # \u597d\u304d\u306a\u30a8\u30c7\u30a3\u30bf\u3067\u8a2d\u5b9a\n```\n\n# Vagrant\u8a2d\u5b9a\n\n* \u4efb\u610f\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u79fb\u52d5\n\n```\n$ cd ~/Vagrant\n```\n\n* \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u540d\u3068Vagrant Box\u540d\u3092\u5909\u6570\u306b\u5165\u308c\u3066\u304a\u304d\u307e\u3059\n\n```\n$ PROJECT_NAME=development\n$ BOX_NAME=centos/7\n```\n\n* \u4eca\u56de\u306e\u4f5c\u696d\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u3092\u4f5c\u6210\u3057\u3066\u305d\u3053\u306b\u79fb\u52d5\u3057\u3066\u304a\u304f\n\n```\n$ mkdir ${PROJECT_NAME}\n$ cd ${PROJECT_NAME}\n```\n\n* Vagrantfile\u4f5c\u6210\n\n```\n$ vagrant init ${BOX_NAME}\n\n$ vi Vagrantfile\n```\n\n* network\u8a2d\u5b9a\u3092\u30b3\u30e1\u30f3\u30c8\u30a2\u30a6\u30c8\n\n```text:Vagrantfile\n# config.vm.network \"private_network\", ip: \"xxx.xxx.xxx.xxx\"\n\u2193\nconfig.vm.network \"private_network\", ip: \"xxx.xxx.xxx.xxx\"\n```\n\n* Vagrant\u3092\u8d77\u52d5\n\n```\n$ vagrant up --provider virtualbox\n```\n\n* SSH\u8a2d\u5b9a\u3092 .ssh/config \u306b\u8a18\u8f09\u3057\u3066\u304a\u304f\n\n```\n$ vagrant ssh-config --host ${BOX_NAME} >> ~/.ssh/config\n```\n\n# knife-zero \u3067 chef \u3092\u8a2d\u5b9a\n\n* knife.rb \u3092\u4f5c\u6210\n\n```\n$ mkdir chef-repo\n$ cd chef-repo\n$ vi knife.rb\n```\n\n```rb:knife.rb\nlocal_mode true\nchef_repo_path File.expand_path('../', __FILE__)\n\nknife[:use_sudo] = true\n\nknife[:automatic_attribute_whitelist] = %w[\n  os\n  os_version\n  hostname\n  ipaddress\n  roles\n  recipes\n  platform\n  platform_version\n  cloud\n  cloud_v2\n  chef_packages\n]\n```\n\n* \u30ce\u30fc\u30c9\u3092\u767b\u9332\n\n```\n$ chef exec knife zero bootstrap ${BOX_NAME} --node-name ${PROJECT_NAME}\n```\n\n* \u30ce\u30fc\u30c9\u30ea\u30b9\u30c8\u3092\u8868\u793a\n\n```\n$ chef exec knife node list\n```\n\n* \u30ce\u30fc\u30c9\u306e\u8a73\u7d30\u3092\u78ba\u8a8d\n\n```\n$ chef exec knife node show ${PROJECT_NAME}\n```\n\n* \u30ce\u30fc\u30c9\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\n\n```\n$ vi nodes/${PROJECT_NAME}.json\n```\n\n* normal \u914d\u4e0b\u306b FQDN\u8a2d\u5b9a \u3092\u4ed8\u3051\u8db3\u3059\n\n```json:${PROJECT_NAME}.json\n# \u5909\u66f4\u524d\n\"normal\": {\n    \"knife_zero\": {\n      \"host\": \"{\u30db\u30b9\u30c8\u540d}\"\n    },\n\n# \u5909\u66f4\u5f8c\n\"normal\": {\n    \"knife_zero\": {\n      \"host\": \"{\u30db\u30b9\u30c8\u540d}\"\n    },\n    \"fqdn\": \"{\u30db\u30b9\u30c8\u540d}\",  # <<<<< {\u30db\u30b9\u30c8\u540d}\u306f ${BOX_NAME} \u3068\u540c\u3058\n```\n\n* \u5171\u901acookbook\u3092\u4f5c\u6210\uff08\u4eca\u56de\u306f common \u3068\u3044\u3046\u540d\u79f0\u3067\u4f5c\u6210\uff09\n\n```\n$ chef exec knife cookbook create common\n```\n\n* \u30ec\u30b7\u30d4\u306b net-tools \u3092\u8a2d\u5b9a\n\n```\n$ vi cookbooks/common/recipes/default.rb\n```\n\n```rb:cookbooks/common/recipes/default.rb\npackage \"net-tools\" do\n    action :install\nend\n```\n\n* \u30ce\u30fc\u30c9\u306b\u5bfe\u3059\u308b run_list \u306b common \u3092\u8a2d\u5b9a\n\n```\n$ chef exec knife node run_list add ${PROJECT_NAME} common\n```\n\n* knife zero converge \u3092\u5b9f\u884c\n\n```\n$ chef exec knife zero converge \"name:${PROJECT_NAME}\"\n```\n\n# \u52d5\u4f5c\u78ba\u8a8d\n\n* Vagrant\u306bSSH\u30ed\u30b0\u30a4\u30f3\n\n```\n$ ssh ${BOX_NAME}\n\n# \u307e\u305f\u306f\n$ vagrant ssh\n```\n\n* ifconfig \u3092\u5b9f\u884c\n\n```\n$ sudo ifconfig\n```\n\n* ifconfig \u304c\u5b9f\u884c\u3067\u304d\u308c\u3070 net-tools \u304c\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3055\u308c\u3066\u3044\u308b\n\n\u3053\u308c\u3067\u3001\u3042\u3068\u306f\u958b\u767a\u74b0\u5883\u7528\u306b\u30ec\u30b7\u30d4\u3092\u3082\u308a\u3082\u308a\u66f8\u3044\u3066\u884c\u3051\u3070\u5927\u4e08\u592b\u305d\u3046\u3067\u3059\u3002\n", "tags": ["vagrant", "chef", "chef-zero"]}