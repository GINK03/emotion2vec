{"context": " More than 1 year has passed since last update.\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\n\u547c\u3070\u308c\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u691c\u77e5\u3057\u3066\u3001\u305d\u308c\u3092\u30e1\u30bd\u30c3\u30c9\u5185\u90e8\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306b\u5229\u7528\u3057\u305f\u3044\u3002\n\n\n\u30e1\u30bd\u30c3\u30c9\u540d\u691c\u77e5\n\n\n__method__: \u30e1\u30bd\u30c3\u30c9\u540d\u3092\u30b7\u30f3\u30dc\u30eb\u3068\u3057\u3066\u8fd4\u3059\u3002\n\n__callee__: \u30a8\u30a4\u30ea\u30a2\u30b9\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u30b7\u30f3\u30dc\u30eb\u3068\u3057\u3066\u8fd4\u3059\u3002\n\n\nRefactoring\u4f8b\n\n\u8907\u6570\u306e\u985e\u4f3c\u30e1\u30bd\u30c3\u30c9\u3092alias_method\u3092\u5229\u7528\u3057\u3066\u4e00\u3064\u306b\u307e\u3068\u3081\u308b\u3002\n\u547c\u3070\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u540d\u306b\u5fdc\u3058\u3066\u5185\u90e8\u306e\u51e6\u7406\u3092\u5fae\u8abf\u6574\u3059\u308b\u3002\n\nDevise+OmniAuth\u3067\u8907\u6570\u30d7\u30ed\u30d0\u30a4\u30c0\u8a8d\u8a3c(Qiita\u98a8)\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306b\u3046\u307e\u304f\u6d3b\u7528\u3067\u304d\u305f\u3002\n\n\nBefore\nclass OmniauthCallbacksController < Devise::OmniauthCallbacksController\n\n  def facebook\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      set_flash_message(:notice, :success, kind: \"Facebook\") if is_navigational_format?\n      sign_in_and_redirect user, event: :authentication\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\n\n  def twitter\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      set_flash_message(:notice, :success, kind: \"Twitter\") if is_navigational_format?\n      sign_in_and_redirect user, event: :authentication\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\nend\n\n\nAfter\n\nclass OmniauthCallbacksController < Devise::OmniauthCallbacksController\n\n  def callback_for_all_providers\n    provider = __callee__.to_s  # \u30a8\u30a4\u30ea\u30a2\u30b9\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u8aad\u307f\u3053\u307f\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u5229\u7528\u3002\n\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      sign_in_and_redirect user, event: :authentication\n      set_flash_message(:notice, :success, kind: provider.capitalize) if is_navigational_format?\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\n\n  alias_method :twitter, :callback_for_all_providers\n  alias_method :facebook, :callback_for_all_providers\nend\n\n#\u3084\u308a\u305f\u3044\u3053\u3068\n\n- \u547c\u3070\u308c\u3066\u3044\u308b\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u691c\u77e5\u3057\u3066\u3001\u305d\u308c\u3092\u30e1\u30bd\u30c3\u30c9\u5185\u90e8\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306b\u5229\u7528\u3057\u305f\u3044\u3002\n\n#\u30e1\u30bd\u30c3\u30c9\u540d\u691c\u77e5\n\n- [`__method__`](http://ruby-doc.org/core-2.2.2/Kernel.html#method-i-__method__): \u30e1\u30bd\u30c3\u30c9\u540d\u3092\u30b7\u30f3\u30dc\u30eb\u3068\u3057\u3066\u8fd4\u3059\u3002\n- [`__callee__`](http://ruby-doc.org/core-2.2.2/Kernel.html#method-i-__callee__): \u30a8\u30a4\u30ea\u30a2\u30b9\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u30b7\u30f3\u30dc\u30eb\u3068\u3057\u3066\u8fd4\u3059\u3002\n\n#Refactoring\u4f8b\n\n- \u8907\u6570\u306e\u985e\u4f3c\u30e1\u30bd\u30c3\u30c9\u3092[alias_method](http://apidock.com/ruby/Module/alias_method)\u3092\u5229\u7528\u3057\u3066\u4e00\u3064\u306b\u307e\u3068\u3081\u308b\u3002\n- \u547c\u3070\u308c\u305f\u30e1\u30bd\u30c3\u30c9\u540d\u306b\u5fdc\u3058\u3066\u5185\u90e8\u306e\u51e6\u7406\u3092\u5fae\u8abf\u6574\u3059\u308b\u3002\n- [Devise+OmniAuth\u3067\u8907\u6570\u30d7\u30ed\u30d0\u30a4\u30c0\u8a8d\u8a3c(Qiita\u98a8)](http://qiita.com/mnishiguchi/items/e15bbef61287f84b546e#omniauth_callbacks_controller)\u3092\u5b9f\u88c5\u3059\u308b\u969b\u306b\u3046\u307e\u304f\u6d3b\u7528\u3067\u304d\u305f\u3002\n\n## Before\n\n```rb\nclass OmniauthCallbacksController < Devise::OmniauthCallbacksController\n  \n  def facebook\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      set_flash_message(:notice, :success, kind: \"Facebook\") if is_navigational_format?\n      sign_in_and_redirect user, event: :authentication\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\n \n  def twitter\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      set_flash_message(:notice, :success, kind: \"Twitter\") if is_navigational_format?\n      sign_in_and_redirect user, event: :authentication\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\nend\n```\n\n## After\n\n```rb\n\nclass OmniauthCallbacksController < Devise::OmniauthCallbacksController\n\n  def callback_for_all_providers\n    provider = __callee__.to_s  # \u30a8\u30a4\u30ea\u30a2\u30b9\u30e1\u30bd\u30c3\u30c9\u540d\u3092\u8aad\u307f\u3053\u307f\u3001\u6587\u5b57\u5217\u3068\u3057\u3066\u5229\u7528\u3002\n\n    user = User.from_omniauth(request.env[\"omniauth.auth\"])\n    if user.persisted?\n      sign_in_and_redirect user, event: :authentication\n      set_flash_message(:notice, :success, kind: provider.capitalize) if is_navigational_format?\n    else\n      session[\"devise.user_attributes\"] = user.attributes\n      redirect_to new_user_registration_url\n    end\n  end\n\n  alias_method :twitter, :callback_for_all_providers\n  alias_method :facebook, :callback_for_all_providers\nend\n```\n", "tags": ["Ruby", "Rails", "Refactoring", "OmniAuth"]}