{"context": "\n\n\u3084\u308a\u305f\u3044\u3053\u3068\n\u666e\u901aRails\u3067\u306f\u30ed\u30b0\u306b\nI, [2016-07-15T10:03:39.554712 #7157]  INFO -- : Completed 200 OK in 18ms (Views: 6.1ms | ActiveRecord: 10.3ms)\n\n\u306e\u3088\u3046\u306b\u5b9f\u884c\u6642\u9593\u304c\u6b8b\u308b\u304c\u3001Grape\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3053\u308c\u304c\u51fa\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u3053\u308c\u3092\u51fa\u3059\u3088\u3046\u306b\u3057\u305f\u3044\u3002\u3064\u3044\u3067\u306bGET\u3084POST\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u6b8b\u3057\u305f\u3044\u3002\n\u672c\u8a18\u4e8b\u306e\u624b\u9806\u3067grape_logging\u3092\u5c0e\u5165\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n[INFO] {:status=>201, :time=>{:total=>8.21, :db=>0.0, :view=>8.21}, :method=>\"POST\", :path=>\"/api/moge\", :params=>{\"a\"=>\"123\"}, :response=>[\"143\"]}\n\n\u3061\u306a\u307f\u306b\u3001Rails+Grape\u3067\u306f\u666e\u901a\u306blogger.debug(\"hoge\")\u3068\u66f8\u304f\u3068\nundefined local variable or method `logger' \n\n\u3068\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u304c\u3001Rails.logger.debug(\"hoge\")\u3068\u66f8\u3051\u3070\u3088\u3044\u3002\n\n\u74b0\u5883\n\nRails 4.2.6\nGrape 0.16.2\n\n\n\u624b\u9806\nGemfile\u306b\u8ffd\u8a18\uff1a\ngem 'grape_logging'\n\nconfig/initializers/instrumentation.rb\u3092\u65b0\u898f\u4f5c\u6210\uff1a\n\nconfig/initializers/instrumentation.rb\n# Subscribe to grape request and log with Rails.logger\nActiveSupport::Notifications.subscribe('grape_key') do |name, starts, ends, notification_id, payload|\n  Rails.logger.info payload\nend\n\n\n\u81ea\u5206\u306eAPI\u30af\u30e9\u30b9\u306b\u8a18\u8ff0\uff1a\nrequire 'grape_logging'\n\nclass MyAPI < Grape::API\n  # https://github.com/aserafin/grape_logging#logging-via-rails-instrumentation\n  use GrapeLogging::Middleware::RequestLogger,\n      instrumentation_key: 'grape_key',\n      include: [ GrapeLogging::Loggers::Response.new,\n                GrapeLogging::Loggers::FilterParameters.new ]\n\n  format :json\n  content_type :json, \"application/json; charset=utf-8\"\n\n  # \u30c6\u30b9\u30c8\u7528API\n  params do\n    requires :a, type: Integer\n  end\n  post 'moge' do\n    20 + params[:a]\n  end\nend\n\n\n\u51fa\u529b\u9805\u76ee\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5168\u90e8\u30ed\u30ae\u30f3\u30b0\u3059\u308b\u306e\u306f\u3055\u3059\u304c\u306b\u904e\u5270\u306a\u306e\u3067\u51fa\u529b\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\u305d\u3093\u306a\u5834\u5408\u306f\u81ea\u5206\u306eAPI\u30af\u30e9\u30b9\u306b\u66f8\u3044\u305finclude:\u306e\u90e8\u5206\u304b\u3089GrapeLogging::Loggers::Response.new\u3092\u6d88\u305b\u3070\u826f\u3044\u3002\n\u4ed6\u306b\u3082ClientEnv\u3001RequestHeaders\u3068\u3044\u3063\u305f\u51fa\u529b\u9805\u76ee\u304c\u3042\u308b\u3002\n    include: [ GrapeLogging::Loggers::Response.new,\n               GrapeLogging::Loggers::FilterParameters.new,\n               GrapeLogging::Loggers::ClientEnv.new,\n               GrapeLogging::Loggers::RequestHeaders.new ]\n\n\n\u53c2\u8003\nhttps://github.com/aserafin/grape_logging#logging-via-rails-instrumentation\n# \u3084\u308a\u305f\u3044\u3053\u3068\n\n\u666e\u901aRails\u3067\u306f\u30ed\u30b0\u306b\n\n```\nI, [2016-07-15T10:03:39.554712 #7157]  INFO -- : Completed 200 OK in 18ms (Views: 6.1ms | ActiveRecord: 10.3ms)\n```\n\n\u306e\u3088\u3046\u306b\u5b9f\u884c\u6642\u9593\u304c\u6b8b\u308b\u304c\u3001Grape\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3053\u308c\u304c\u51fa\u306a\u304f\u306a\u3063\u3066\u3057\u307e\u3046\u3002\n\u3053\u308c\u3092\u51fa\u3059\u3088\u3046\u306b\u3057\u305f\u3044\u3002\u3064\u3044\u3067\u306bGET\u3084POST\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3082\u6b8b\u3057\u305f\u3044\u3002\n\n\u672c\u8a18\u4e8b\u306e\u624b\u9806\u3067grape_logging\u3092\u5c0e\u5165\u3059\u308b\u3068\u4e0b\u8a18\u306e\u3088\u3046\u306a\u30ed\u30b0\u304c\u51fa\u305b\u308b\u3088\u3046\u306b\u306a\u308b\u3002\n\n```\n[INFO] {:status=>201, :time=>{:total=>8.21, :db=>0.0, :view=>8.21}, :method=>\"POST\", :path=>\"/api/moge\", :params=>{\"a\"=>\"123\"}, :response=>[\"143\"]}\n```\n\n\u3061\u306a\u307f\u306b\u3001Rails+Grape\u3067\u306f\u666e\u901a\u306b`logger.debug(\"hoge\")`\u3068\u66f8\u304f\u3068\n\n```\nundefined local variable or method `logger' \n```\n\n\u3068\u30a8\u30e9\u30fc\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u304c\u3001`Rails.logger.debug(\"hoge\")`\u3068\u66f8\u3051\u3070\u3088\u3044\u3002\n\n# \u74b0\u5883\n\n- Rails 4.2.6\n- Grape 0.16.2\n\n# \u624b\u9806\n\nGemfile\u306b\u8ffd\u8a18\uff1a\n\n```\ngem 'grape_logging'\n```\n\nconfig/initializers/instrumentation.rb\u3092\u65b0\u898f\u4f5c\u6210\uff1a\n\n```config/initializers/instrumentation.rb\n# Subscribe to grape request and log with Rails.logger\nActiveSupport::Notifications.subscribe('grape_key') do |name, starts, ends, notification_id, payload|\n  Rails.logger.info payload\nend\n```\n\n\u81ea\u5206\u306eAPI\u30af\u30e9\u30b9\u306b\u8a18\u8ff0\uff1a\n\n```\nrequire 'grape_logging'\n\nclass MyAPI < Grape::API\n  # https://github.com/aserafin/grape_logging#logging-via-rails-instrumentation\n  use GrapeLogging::Middleware::RequestLogger,\n      instrumentation_key: 'grape_key',\n      include: [ GrapeLogging::Loggers::Response.new,\n                GrapeLogging::Loggers::FilterParameters.new ]\n\n  format :json\n  content_type :json, \"application/json; charset=utf-8\"\n\n  # \u30c6\u30b9\u30c8\u7528API\n  params do\n    requires :a, type: Integer\n  end\n  post 'moge' do\n    20 + params[:a]\n  end\nend\n```\n\n# \u51fa\u529b\u9805\u76ee\u3092\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3059\u308b\n\n\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5168\u90e8\u30ed\u30ae\u30f3\u30b0\u3059\u308b\u306e\u306f\u3055\u3059\u304c\u306b\u904e\u5270\u306a\u306e\u3067\u51fa\u529b\u3057\u306a\u3044\u3088\u3046\u306b\u3057\u305f\u3044\u3002\u305d\u3093\u306a\u5834\u5408\u306f\u81ea\u5206\u306eAPI\u30af\u30e9\u30b9\u306b\u66f8\u3044\u305f`include:`\u306e\u90e8\u5206\u304b\u3089`GrapeLogging::Loggers::Response.new`\u3092\u6d88\u305b\u3070\u826f\u3044\u3002\n\n\u4ed6\u306b\u3082`ClientEnv`\u3001`RequestHeaders`\u3068\u3044\u3063\u305f\u51fa\u529b\u9805\u76ee\u304c\u3042\u308b\u3002\n\n```\n    include: [ GrapeLogging::Loggers::Response.new,\n               GrapeLogging::Loggers::FilterParameters.new,\n               GrapeLogging::Loggers::ClientEnv.new,\n               GrapeLogging::Loggers::RequestHeaders.new ]\n```\n\n# \u53c2\u8003\nhttps://github.com/aserafin/grape_logging#logging-via-rails-instrumentation\n", "tags": ["Rails4", "grape"]}