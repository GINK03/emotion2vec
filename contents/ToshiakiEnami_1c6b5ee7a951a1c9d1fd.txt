{"tags": ["Kinesis", "kintone", "lambda"], "context": " More than 1 year has passed since last update.\n\n\u306f\u3058\u3081\u306b\n\u524d\u56de\u306e\u8a18\u4e8b\u3067Arduino\u306b\u4ed8\u3051\u305f\u6e29\u5ea6\u30bb\u30f3\u30b5\u304b\u3089Raspberry Pi\u7d4c\u7531\u3067AWS\u306b\u3042\u3052\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3084\u306f\u308a\u6e29\u5ea6\u5909\u5316\u3092\u30b0\u30e9\u30d5\u3067\u307f\u305f\u3044\u306a\u3068\u601d\u3044\u3001\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30c7\u30fc\u30bf\u3092Kinesis\u306bPut\u3057\u3001Lambda\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066kintone\u306b\u5165\u308c\u3066\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306b\u307f\u308b\u3053\u3068\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nkintone\u3092\u4f7f\u3063\u305f\u7406\u7531\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u305b\u305a\u306b\u30ea\u30c3\u30c1\u306a\u30a2\u30d7\u30ea\u304c\u7c21\u5358\u306b\u4f5c\u308c\u308b\u306e\u3068UI\u304c\u3068\u3066\u3082\u308f\u304b\u308a\u6613\u304f\u3001\u30b0\u30e9\u30d5\u96c6\u8a08\u306a\u3069\u3082\u7c21\u5358\u306b\u3067\u304d\u308b\u305f\u3081\u3067\u3059\u3002\n\n\u5168\u4f53\u69cb\u6210\n\n\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30c7\u30fc\u30bf\u3092Kinesis, Lambda\u3092\u4ecb\u3057\u3066kintone\u306b\u5165\u308c\u308b\u69cb\u6210\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nRaspberry Pi\u304b\u3089\u76f4\u63a5kintone\u306bAPI\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001Kinesis\u3068Lambda\u3092\u4ecb\u3059\u3053\u3068\u3067ETL\u51e6\u7406\u3001\u4ed6\u306e\u30c7\u30fc\u30bf\u3068\u306eJoin\u306a\u3069\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3001\u4e00\u5b9a\u9593\u9694\u3067\u4e00\u62ec\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u5e73\u5747\u3092Lambda\u5074\u3067\u96c6\u8a08\u3057\u3066kintone\u306b\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\nkintone\u306e\u8a2d\u5b9a\nKinetone\u306e30\u65e5\u9593\u7121\u6599\u304a\u8a66\u3057\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\uff01\uff08https://kintone.cybozu.com/jp/\uff09\n\u521d\u3081\u3066Kinetone\u3092\u89e6\u3063\u305f\u306e\u3067\u3059\u304c\u3001\u306f\u3058\u3081\u3066\u306ekintone\u30ac\u30a4\u30c9\u3092\u6700\u521d\u306b\u307f\u308b\u3068\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u624b\u9806\u7684\u306b\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u308a\u3001\u305d\u3053\u306bTemp\u3068\u3044\u3046\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n\n\u30d5\u30a9\u30fc\u30e0\u306f\u65e5\u6642\u3068\u6e29\u5ea6\u3060\u3051\u306e\u5358\u7d14\u306a\u30ab\u30e9\u30e0\u306b\u3057\u307e\u3057\u305f\u3002\n\n\u307e\u305f\u3001\u30c7\u30fc\u30bf\u3092\u5165\u308c\u6642\u306b\u30ab\u30e9\u30e0\u540d\u3092\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u30d5\u30a3\u30fc\u30c9\u540d\u3092room\u306b\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n\n\u3053\u308c\u3060\u3051\u3067\u683c\u7d0d\u5148\u306f\u3067\u304d\u307e\u3057\u305f\uff01\n\u307e\u305a\u306f\u3001Curl\u3092\u4f7f\u3063\u3066kintone API\u7d4c\u7531\u3067\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u307e\u3059\u3002\n\uff08Kinetone API\u306f\u3053\u3061\u3089)\n\u8a8d\u8a3c\u306f\u3001Basic\u8a8d\u8a3c\u3068\u72ec\u81ea\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306e2\u3064\u304c\u3042\u308a\u307e\u3059\u3002\u4e21\u65b9\u3068\u3082Base64.Encode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")\u3067\u3059\u3002\n\ncurl\n\ncurl -X POST -H 'Host: {\u81ea\u5206\u306e\u30db\u30b9\u30c8\u540d}.cybozu.com' -H 'Authorization: Basic {Base64.Enode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")}' -H 'X-Cybozu-Authorization: {Base64.Encode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")}' -H 'Content-Type: application/json' https://{\u81ea\u5206\u306e\u30db\u30b9\u30c8\u540d}.cybozu.com/k/guest/{\u30b9\u30da\u30fc\u30b9ID}/v1/record.json -d '{'app':\u30a2\u30d7\u30eaID,'record': {'room': {'value': '13'}}'\n\n\n\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u3092\u5165\u529b\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\uff01\n\nRaspberry PI\u306e\u5b9f\u88c5\nCognito\u3067\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u3001Kinesis\u306b\u5bfe\u3057\u3066Put\u3057\u3066\u307e\u3059\u3002\n\npostKinesis.py\n\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport sys,traceback\nimport serial\nimport datetime,time\nimport boto\nfrom boto import kinesis\n\nSTREAM = ''\nACCOUNT_ID = ''\nIDENTITY_POOL_ID = ''\nROLE_ARN = ''\n\nclass Auth:\n    def doAuth(self):\n        cognito = boto.connect_cognito_identity()\n        cognito_id = cognito.get_id(ACCOUNT_ID, IDENTITY_POOL_ID)\n        print str(cognito_id)\n        token = cognito.get_open_id_token(cognito_id['IdentityId'])\n        sts = boto.connect_sts()\n        assumedRoleObject = sts.assume_role_with_web_identity(ROLE_ARN, \"bototest\", token['Token'])\n        self.client = kinesis.connect_to_region(\n            \"us-east-1\",\n            aws_access_key_id=assumedRoleObject.credentials.access_key,\n            aws_secret_access_key=assumedRoleObject.credentials.secret_key,\n            security_token=assumedRoleObject.credentials.session_token)\n    def getClient(self):\n        return self.client\n\n\nif __name__ == '__main__':\n    auth = Auth()\n    auth.doAuth()\n    while True:\n        try:\n            s = serial.Serial('/dev/ttyACM0', 9600)\n            line = s.readline()\n            temp = line.strip()\n            if temp != '':\n                print temp\n                d = datetime.datetime.today()\n                partitionKey = d.strftime(\"%Y%m%d%H%M%S\")\n                client = auth.getClient()\n                client.put_record(STREAM, temp , partitionKey, b64_encode=True)\n                time.sleep(900)\n        except KeyboardInterrupt:\n            sys.exit()\n        except:\n            info = sys.exc_info()\n            tbinfo = traceback.format_tb( info[2] )\n            print \"Error:\", tbinfo\n            auth = Auth()\n            auth.doAuth()\n\n\n\n\n\nLambda Function\u306e\u5b9f\u88c5\n\u7279\u306b\u610f\u5473\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001@Keisuke69\u3055\u3093\u306eAWS Lambda\u306efunction\u3092Python\u3067\u66f8\u304f\u3092\u8a66\u3057\u305f\u304b\u3063\u305f\u306e\u3067Lambda Function\u306fPython\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u3060\u3057\u3066\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u3044\u3084\u3001\u8a66\u3057\u305f\u304b\u3063\u305f\u3060\u3051\u3067\u3059\u3002\n\nindex.js\nexports.handler = function(event, context) {\n    var exec = require('child_process').exec;\n    var temp = 0;\n    console.log(JSON.stringify(event, null, '  '));\n    for(i = 0; i < event.Records.length; ++i) {\n        encodedPayload = event.Records[i].kinesis.data;\n        payload = new Buffer(encodedPayload, 'base64').toString('ascii');\n        temp += parseFloat(payload);\n    }\n    temp = temp/event.Records.length;\n    var cmd = \"curl -s https://s3.amazonaws.com/{\u30d0\u30b1\u30c3\u30c8}/postkintone.py > /tmp/test.py;chmod 755 /tmp/test.py;/tmp/test.py \" + temp;\n    var child = exec(cmd, function(error, stdout, stderr) {\n        if (!error) {\n            context.done();\n        } else {\n            console.log(\"error code: \" + error.code + \", err: \" + error);\n            context.done(error,'lambda');\n        }\n    });\n};\n\n\n\nKinesis\u3067\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u7fa4\u306e\u5e73\u5747\u3092Python\u5074\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u6a19\u6e96\u5165\u529b\u3067\u6e21\u3057\u3066\u3001Python\u5074\u3067Kineton\u306bPOST\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\npostkintone.py\n\n#! /usr/bin/python\n\nimport urllib2,json,sys\nAUTH = ''\nX_CY_AUTH = ''\nENDPOINT = ''\n\ndef main(temp):\n        try:\n                postdata = {'app':00,'record': {'room': {'value': temp}}}\n                print postdata\n                req = urllib2.Request(ENDPOINT)\n                req.add_header('Content-Type','application/json')\n                req.add_header('Host', 'toshiake.cybozu.com')\n                req.add_header('Authorization',AUTH)\n                req.add_header('X-Cybozu-Authorization',X_CY_AUTH)\n                data = json.dumps(postdata)\n                response = urllib2.urlopen(req,data)\n                print response\n        except:\n                print \"Unexpected error:\", sys.exc_info()[0]\n\nif __name__ == '__main__':\n        argvs = sys.argv\n        argc = len(argvs)\n        if (argc != 2):\n                print 'Usage: # python %s temp' % argvs[0]\n                sys.exit()\n        temp = argvs[1]\n        main(temp)\n\n\n\nLambda Function\u3092Kinesis Application\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001Invocation Role\u3092\u4f5c\u6210\u3057\u3001Event Source\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\nInvocation Role\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\nInvocationRole\n\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"lambda:InvokeFunction\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"kinesis:*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n\n\nEvent Source\u306e\u767b\u9332\u306f\u3001CLI\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\n\nadd-event-source\n\n$ aws lambda add-event-source \\\n   --region us-east-1 \\\n   --function-name {Function\u540d}  \\\n   --role arn:aws:iam::{\u30a2\u30ab\u30a6\u30f3\u30c8ID}:{\u4e0a\u3067\u4f5c\u3063\u305f\u30ed\u30fc\u30eb\u540d} \\\n   --event-source {Kinesis Stream\u306eARN} \\\n   --batch-size 100 \\\n   --parameters '{\"InitialPositionInStream\": \"LATEST\"}'\n\n\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\"InitialPositionInStream\": \"LATEST\"\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u521d\u56de\u8d77\u52d5\u6642\u306b\u6700\u65b0\u30c7\u30fc\u30bf\u304b\u3089\u53d6\u5f97\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\nkintone\u306e\u30b0\u30e9\u30d5\u30d3\u30e5\u30fc\u3067\u78ba\u8a8d\n\u3053\u3093\u306a\u611f\u3058\u3067\u307f\u3048\u307e\u3057\u305f\u3002\u7570\u5e38\u306b\u81ea\u5206\u306e\u90e8\u5c4b\u304c\u30b5\u30e0\u30a4\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u3002\n\n\n\u6700\u5f8c\u306b\nkintone\u306f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3044\u3089\u305a\u306b\u30c7\u30fc\u30bf\u306e\u683c\u7d0d\u3084\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306aView\u306e\u4f5c\u6210\u306a\u3069\u7c21\u5358\u306b\u3067\u304d\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30bb\u30f3\u30b5\u30fc\u306e\u60c5\u5831\u3092\u4f7f\u3063\u305f\u306e\u3067\u3059\u304c\u3001AWS\u3068kintone\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3059\u3068\u3001\u4f8b\u3048\u3070\u3001\u55b6\u696d\u6240\u304b\u3089\u306e\u5831\u544a\u66f8\u304cS3\u306b\u4e0a\u304c\u3063\u3066\u304d\u3066\u3001S3 Event Nortification\u30c8\u30ea\u30ac\u30fc\u3067Lambda Function\u304c\u547c\u3070\u308c\u3066\u3001\u30c7\u30fc\u30bf\u306e\u7cbe\u67fb\u3001\u30de\u30b9\u30bf\u30c7\u30fc\u30bf\u3068\u306e\u9023\u7d50\u306a\u3069\u3092\u3057\u3066kintone\u306b\u3044\u308c\u308b\u3068\u3044\u3046\u4f7f\u3044\u9053\u3084S3,CloudFront,ELB\u306a\u3069\u306e\u30ed\u30b0\u3092\u53ef\u8996\u5316\u3059\u308b\u306e\u306bkintone\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u305d\u3046\u3067\u3059\u3002\u4f7f\u3044\u9053\u306f\u7121\u9650\u306b\u5e83\u304c\u308a\u305d\u3046\u3067\u3059\u306d\uff01\n\n\n\u514d\u8cac\n\u3053\u3061\u3089\u306f\u500b\u4eba\u306e\u610f\u898b\u3067\u3001\u6240\u5c5e\u3059\u308b\u4f01\u696d\u3084\u56e3\u4f53\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\n\n# \u306f\u3058\u3081\u306b\n\u524d\u56de\u306e[\u8a18\u4e8b](\"http://qiita.com/ToshiakiEnami/items/c3b5b87a148a2fcf5ee4\")\u3067Arduino\u306b\u4ed8\u3051\u305f\u6e29\u5ea6\u30bb\u30f3\u30b5\u304b\u3089Raspberry Pi\u7d4c\u7531\u3067AWS\u306b\u3042\u3052\u3066\u3044\u305f\u306e\u3067\u3059\u304c\u3001\u3084\u306f\u308a\u6e29\u5ea6\u5909\u5316\u3092\u30b0\u30e9\u30d5\u3067\u307f\u305f\u3044\u306a\u3068\u601d\u3044\u3001\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30c7\u30fc\u30bf\u3092Kinesis\u306bPut\u3057\u3001Lambda\u3067\u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3057\u3066kintone\u306b\u5165\u308c\u3066\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306b\u307f\u308b\u3053\u3068\u306b\u30c1\u30e3\u30ec\u30f3\u30b8\u3057\u3066\u307f\u307e\u3057\u305f\u3002\nkintone\u3092\u4f7f\u3063\u305f\u7406\u7531\u306f\u3001\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u305b\u305a\u306b\u30ea\u30c3\u30c1\u306a\u30a2\u30d7\u30ea\u304c\u7c21\u5358\u306b\u4f5c\u308c\u308b\u306e\u3068UI\u304c\u3068\u3066\u3082\u308f\u304b\u308a\u6613\u304f\u3001\u30b0\u30e9\u30d5\u96c6\u8a08\u306a\u3069\u3082\u7c21\u5358\u306b\u3067\u304d\u308b\u305f\u3081\u3067\u3059\u3002\n\n# \u5168\u4f53\u69cb\u6210\n\n![qiita1.png](https://qiita-image-store.s3.amazonaws.com/0/60724/225c6c6a-c5ac-e681-0bcb-85f5775c889f.png \"qiita1.png\")\n\n\n\n\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30c7\u30fc\u30bf\u3092Kinesis, Lambda\u3092\u4ecb\u3057\u3066kintone\u306b\u5165\u308c\u308b\u69cb\u6210\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\nRaspberry Pi\u304b\u3089\u76f4\u63a5kintone\u306bAPI\u30b3\u30fc\u30eb\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u304c\u3001Kinesis\u3068Lambda\u3092\u4ecb\u3059\u3053\u3068\u3067ETL\u51e6\u7406\u3001\u4ed6\u306e\u30c7\u30fc\u30bf\u3068\u306eJoin\u306a\u3069\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308b\u3068\u601d\u3044\u307e\u3059\u3002\u4eca\u56de\u306f\u3001\u4e00\u5b9a\u9593\u9694\u3067\u4e00\u62ec\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u306e\u5e73\u5747\u3092Lambda\u5074\u3067\u96c6\u8a08\u3057\u3066kintone\u306b\u5165\u308c\u308b\u3088\u3046\u306b\u3057\u3066\u3044\u307e\u3059\u3002\n\n# kintone\u306e\u8a2d\u5b9a\nKinetone\u306e30\u65e5\u9593\u7121\u6599\u304a\u8a66\u3057\u3092\u5229\u7528\u3055\u305b\u3066\u9802\u304d\u307e\u3057\u305f\uff01\uff08https://kintone.cybozu.com/jp/\uff09\n\u521d\u3081\u3066Kinetone\u3092\u89e6\u3063\u305f\u306e\u3067\u3059\u304c\u3001[\u306f\u3058\u3081\u3066\u306ekintone\u30ac\u30a4\u30c9](\"http://www.slideshare.net/cybozucommunity/kintone-36458110\")\u3092\u6700\u521d\u306b\u307f\u308b\u3068\u3088\u3044\u3068\u601d\u3044\u307e\u3059\u3002\n\u624b\u9806\u7684\u306b\u306f\u3001\u30b9\u30da\u30fc\u30b9\u3092\u4f5c\u308a\u3001\u305d\u3053\u306bTemp\u3068\u3044\u3046\u30a2\u30d7\u30ea\u3092\u4f5c\u308a\u307e\u3057\u305f\u3002\n\n![qiita2.png](https://qiita-image-store.s3.amazonaws.com/0/60724/ceb60a77-02cb-e7eb-3b09-e32f1f16690f.png \"qiita2.png\")\n\n![qiita3.png](https://qiita-image-store.s3.amazonaws.com/0/60724/ca97c226-fbd1-5a3a-6712-43627bc62ec4.png \"qiita3.png\")\n\n\u30d5\u30a9\u30fc\u30e0\u306f\u65e5\u6642\u3068\u6e29\u5ea6\u3060\u3051\u306e\u5358\u7d14\u306a\u30ab\u30e9\u30e0\u306b\u3057\u307e\u3057\u305f\u3002\n\n![qiita4.png](https://qiita-image-store.s3.amazonaws.com/0/60724/786082e8-7f58-82db-88e9-074c6e7e693c.png \"qiita4.png\")\n\n\u307e\u305f\u3001\u30c7\u30fc\u30bf\u3092\u5165\u308c\u6642\u306b\u30ab\u30e9\u30e0\u540d\u3092\u308f\u304b\u308a\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u30d5\u30a3\u30fc\u30c9\u540d\u3092room\u306b\u4fee\u6b63\u3057\u307e\u3057\u305f\u3002\n![qiita5.png](https://qiita-image-store.s3.amazonaws.com/0/60724/7b3e0b51-f8d6-087b-a00c-c15730762a8f.png \"qiita5.png\")\n\n\n\u3053\u308c\u3060\u3051\u3067\u683c\u7d0d\u5148\u306f\u3067\u304d\u307e\u3057\u305f\uff01\n\u307e\u305a\u306f\u3001Curl\u3092\u4f7f\u3063\u3066kintone API\u7d4c\u7531\u3067\u30c7\u30fc\u30bf\u3092\u5165\u308c\u3066\u307f\u307e\u3059\u3002\n\uff08Kinetone API\u306f[\u3053\u3061\u3089](\"https://cybozudev.zendesk.com/hc/ja/categories/200147600\"))\n\u8a8d\u8a3c\u306f\u3001Basic\u8a8d\u8a3c\u3068\u72ec\u81ea\u306e\u30e6\u30fc\u30b6\u8a8d\u8a3c\u306e2\u3064\u304c\u3042\u308a\u307e\u3059\u3002\u4e21\u65b9\u3068\u3082Base64.Encode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")\u3067\u3059\u3002\n\n```command:curl\n\ncurl -X POST -H 'Host: {\u81ea\u5206\u306e\u30db\u30b9\u30c8\u540d}.cybozu.com' -H 'Authorization: Basic {Base64.Enode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")}' -H 'X-Cybozu-Authorization: {Base64.Encode(\"\u30a2\u30ab\u30a6\u30f3\u30c8:\u30d1\u30b9\u30ef\u30fc\u30c9\")}' -H 'Content-Type: application/json' https://{\u81ea\u5206\u306e\u30db\u30b9\u30c8\u540d}.cybozu.com/k/guest/{\u30b9\u30da\u30fc\u30b9ID}/v1/record.json -d '{'app':\u30a2\u30d7\u30eaID,'record': {'room': {'value': '13'}}'\n\n```\n\n\u3053\u308c\u3067\u30c7\u30fc\u30bf\u3092\u5165\u529b\u3067\u304d\u308b\u3068\u601d\u3044\u307e\u3059\uff01\n\n# Raspberry PI\u306e\u5b9f\u88c5\nCognito\u3067\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3057\u3001Kinesis\u306b\u5bfe\u3057\u3066Put\u3057\u3066\u307e\u3059\u3002\n\n```python:postKinesis.py\n\n#!/usr/bin/env python\n# -*- coding:utf-8 -*-\nimport sys,traceback\nimport serial\nimport datetime,time\nimport boto\nfrom boto import kinesis\n\nSTREAM = ''\nACCOUNT_ID = ''\nIDENTITY_POOL_ID = ''\nROLE_ARN = ''\n\nclass Auth:\n\tdef doAuth(self):\n\t\tcognito = boto.connect_cognito_identity()\n\t\tcognito_id = cognito.get_id(ACCOUNT_ID, IDENTITY_POOL_ID)\n\t\tprint str(cognito_id)\n\t\ttoken = cognito.get_open_id_token(cognito_id['IdentityId'])\n\t\tsts = boto.connect_sts()\n\t\tassumedRoleObject = sts.assume_role_with_web_identity(ROLE_ARN, \"bototest\", token['Token'])\n\t\tself.client = kinesis.connect_to_region(\n\t\t\t\"us-east-1\",\n\t\t\taws_access_key_id=assumedRoleObject.credentials.access_key,\n\t\t\taws_secret_access_key=assumedRoleObject.credentials.secret_key,\n\t\t\tsecurity_token=assumedRoleObject.credentials.session_token)\n\tdef getClient(self):\n\t\treturn self.client\n\n\nif __name__ == '__main__':\n\tauth = Auth()\n\tauth.doAuth()\n\twhile True:\n\t\ttry:\n\t\t\ts = serial.Serial('/dev/ttyACM0', 9600)\n\t\t\tline = s.readline()\n\t\t\ttemp = line.strip()\n\t\t\tif temp != '':\n\t\t\t\tprint temp\n\t\t\t\td = datetime.datetime.today()\n\t\t\t\tpartitionKey = d.strftime(\"%Y%m%d%H%M%S\")\n\t\t\t\tclient = auth.getClient()\n\t\t\t\tclient.put_record(STREAM, temp , partitionKey, b64_encode=True)\n\t\t\t\ttime.sleep(900)\n\t\texcept KeyboardInterrupt:\n\t\t\tsys.exit()\n\t\texcept:\n\t\t\tinfo = sys.exc_info()\n\t\t\ttbinfo = traceback.format_tb( info[2] )\n\t\t\tprint \"Error:\", tbinfo\n\t\t\tauth = Auth()\n\t\t\tauth.doAuth()\n\n\n```\n\n\n\n\n# Lambda Function\u306e\u5b9f\u88c5\n\u7279\u306b\u610f\u5473\u306f\u306a\u3044\u306e\u3067\u3059\u304c\u3001@Keisuke69\u3055\u3093\u306e[AWS Lambda\u306efunction\u3092Python\u3067\u66f8\u304f](\"http://qiita.com/Keisuke69/items/5215f42b22553aad7066\")\u3092\u8a66\u3057\u305f\u304b\u3063\u305f\u306e\u3067Lambda Function\u306fPython\u30b3\u30fc\u30c9\u3092\u8aad\u307f\u3060\u3057\u3066\u5b9f\u884c\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u3044\u3084\u3001\u8a66\u3057\u305f\u304b\u3063\u305f\u3060\u3051\u3067\u3059\u3002\n\n\n```javascript:index.js\nexports.handler = function(event, context) {\n    var exec = require('child_process').exec;\n    var temp = 0;\n    console.log(JSON.stringify(event, null, '  '));\n    for(i = 0; i < event.Records.length; ++i) {\n        encodedPayload = event.Records[i].kinesis.data;\n        payload = new Buffer(encodedPayload, 'base64').toString('ascii');\n        temp += parseFloat(payload);\n    }\n    temp = temp/event.Records.length;\n    var cmd = \"curl -s https://s3.amazonaws.com/{\u30d0\u30b1\u30c3\u30c8}/postkintone.py > /tmp/test.py;chmod 755 /tmp/test.py;/tmp/test.py \" + temp;\n    var child = exec(cmd, function(error, stdout, stderr) {\n        if (!error) {\n            context.done();\n        } else {\n            console.log(\"error code: \" + error.code + \", err: \" + error);\n            context.done(error,'lambda');\n        }\n    });\n};\n\n```\n\nKinesis\u3067\u53d6\u5f97\u3057\u305f\u30c7\u30fc\u30bf\u7fa4\u306e\u5e73\u5747\u3092Python\u5074\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306b\u6a19\u6e96\u5165\u529b\u3067\u6e21\u3057\u3066\u3001Python\u5074\u3067Kineton\u306bPOST\u3059\u308b\u3088\u3046\u306b\u3057\u3066\u307f\u307e\u3057\u305f\u3002\n\n```python:postkintone.py\n\n#! /usr/bin/python\n\nimport urllib2,json,sys\nAUTH = ''\nX_CY_AUTH = ''\nENDPOINT = ''\n\ndef main(temp):\n        try:\n                postdata = {'app':00,'record': {'room': {'value': temp}}}\n                print postdata\n                req = urllib2.Request(ENDPOINT)\n                req.add_header('Content-Type','application/json')\n                req.add_header('Host', 'toshiake.cybozu.com')\n                req.add_header('Authorization',AUTH)\n                req.add_header('X-Cybozu-Authorization',X_CY_AUTH)\n                data = json.dumps(postdata)\n                response = urllib2.urlopen(req,data)\n                print response\n        except:\n                print \"Unexpected error:\", sys.exc_info()[0]\n\nif __name__ == '__main__':\n        argvs = sys.argv\n        argc = len(argvs)\n        if (argc != 2):\n                print 'Usage: # python %s temp' % argvs[0]\n                sys.exit()\n        temp = argvs[1]\n        main(temp)\n\n```\n\nLambda Function\u3092Kinesis Application\u3068\u3057\u3066\u5229\u7528\u3059\u308b\u5834\u5408\u306f\u3001Invocation Role\u3092\u4f5c\u6210\u3057\u3001Event Source\u306e\u8ffd\u52a0\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002\nInvocation Role\u306f\u3001\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u611f\u3058\u3067\u3059\u3002\n\n```JSON:InvocationRole\n\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"lambda:InvokeFunction\"\n      ],\n      \"Resource\": \"*\"\n    },\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"kinesis:*\"\n      ],\n      \"Resource\": \"*\"\n    }\n  ]\n}\n\n```\n\nEvent Source\u306e\u767b\u9332\u306f\u3001CLI\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\n\n```Command:add-event-source\n\n$ aws lambda add-event-source \\\n   --region us-east-1 \\\n   --function-name {Function\u540d}  \\\n   --role arn:aws:iam::{\u30a2\u30ab\u30a6\u30f3\u30c8ID}:{\u4e0a\u3067\u4f5c\u3063\u305f\u30ed\u30fc\u30eb\u540d} \\\n   --event-source {Kinesis Stream\u306eARN} \\\n   --batch-size 100 \\\n   --parameters '{\"InitialPositionInStream\": \"LATEST\"}'\n\n```\n\n\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\"InitialPositionInStream\": \"LATEST\"\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u3067\u521d\u56de\u8d77\u52d5\u6642\u306b\u6700\u65b0\u30c7\u30fc\u30bf\u304b\u3089\u53d6\u5f97\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\n\n# kintone\u306e\u30b0\u30e9\u30d5\u30d3\u30e5\u30fc\u3067\u78ba\u8a8d\n\n\u3053\u3093\u306a\u611f\u3058\u3067\u307f\u3048\u307e\u3057\u305f\u3002\u7570\u5e38\u306b\u81ea\u5206\u306e\u90e8\u5c4b\u304c\u30b5\u30e0\u30a4\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u3002\n\n![qiita6.png](https://qiita-image-store.s3.amazonaws.com/0/60724/504427ba-812a-3c2d-5336-908941992a61.png \"qiita6.png\")\n\n\n# \u6700\u5f8c\u306b\nkintone\u306f\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3044\u3089\u305a\u306b\u30c7\u30fc\u30bf\u306e\u683c\u7d0d\u3084\u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306aView\u306e\u4f5c\u6210\u306a\u3069\u7c21\u5358\u306b\u3067\u304d\u307e\u3057\u305f\u3002\n\u4eca\u56de\u306f\u3001\u6e29\u5ea6\u30bb\u30f3\u30b5\u30fc\u306e\u60c5\u5831\u3092\u4f7f\u3063\u305f\u306e\u3067\u3059\u304c\u3001AWS\u3068kintone\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3059\u3068\u3001\u4f8b\u3048\u3070\u3001\u55b6\u696d\u6240\u304b\u3089\u306e\u5831\u544a\u66f8\u304cS3\u306b\u4e0a\u304c\u3063\u3066\u304d\u3066\u3001S3 Event Nortification\u30c8\u30ea\u30ac\u30fc\u3067Lambda Function\u304c\u547c\u3070\u308c\u3066\u3001\u30c7\u30fc\u30bf\u306e\u7cbe\u67fb\u3001\u30de\u30b9\u30bf\u30c7\u30fc\u30bf\u3068\u306e\u9023\u7d50\u306a\u3069\u3092\u3057\u3066kintone\u306b\u3044\u308c\u308b\u3068\u3044\u3046\u4f7f\u3044\u9053\u3084S3,CloudFront,ELB\u306a\u3069\u306e\u30ed\u30b0\u3092\u53ef\u8996\u5316\u3059\u308b\u306e\u306bkintone\u3092\u5229\u7528\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u305d\u3046\u3067\u3059\u3002\u4f7f\u3044\u9053\u306f\u7121\u9650\u306b\u5e83\u304c\u308a\u305d\u3046\u3067\u3059\u306d\uff01\n\n![qiita7.png](https://qiita-image-store.s3.amazonaws.com/0/60724/d7352c4a-ce02-9daa-c6ba-db3d28c16cc5.png \"qiita7.png\")\n\n# \u514d\u8cac\n\u3053\u3061\u3089\u306f\u500b\u4eba\u306e\u610f\u898b\u3067\u3001\u6240\u5c5e\u3059\u308b\u4f01\u696d\u3084\u56e3\u4f53\u306f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\n\n\n\n\n\n\n"}