{"context": " More than 1 year has passed since last update.\u4ed5\u4e8b\u3067\u82e5\u5e72\u56f0\u3063\u305f\u306e\u3068\u3001\u6587\u5b57\u5316\u3051\u7cfb\u306e\u73fe\u8c61\u306a\u306e\u3060\u304c\u3001\u540c\u5185\u5bb9\u306e\u5bfe\u5fdc\u306b\u3064\u3044\u3066\u306e\u65e5\u672c\u8a9e\u30da\u30fc\u30b8\u304c\u307e\u3063\u305f\u304f\u5f15\u3063\u639b\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u30e1\u30e2\u3057\u3066\u304a\u304f.\n\n\u80cc\u666f\n\u3084\u308d\u3046\u3068\u3057\u3066\u3044\u305f\u3053\u3068\u306f\u3001\u2193.\n\n\nmultipart/form-data\u3067JAX-RS(JBoss EAP 6.2, RestEASY)\u306b\u30d5\u30a1\u30a4\u30eb\u3092Upload.\n\u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306b\u306f\u65e5\u672c\u8a9e\u3092\u8a31\u53ef.\n\n\u30b3\u30fc\u30c9\u306e\u30a4\u30e1\u30fc\u30b8\u306f\u4e0b\u8a18\u306a\u611f\u3058\u3060.\n\nFileResource.java\nimport javax.ws.rs.Consumes;\nimport javax.ws.rs.POST;\nimport javax.ws.rs.Path;\nimport javax.ws.rs.core.MediaType;\nimport javax.ws.rs.core.Response;\n\nimport org.jboss.resteasy.annotations.providers.multipart.MultipartForm;\n\n@Path(\"/file\")\npublic class FileResource {\n\n    @POST\n    @Consumes(MediaType.MULTIPART_FORM_DATA)\n    public Response create(@MultipartForm UploadData uploadData){\n\n        String fileName = uploadData.getFileName(); // \u2605 \u3053\u3044\u3064\u304c\u6587\u5b57\u5316!\n        // \u8272\u3005\u51e6\u7406...\n        return Response.ok().build();\n    }\n}\n\n\n\nUploadData.java\npublic class UploadData implements Serializable{\n    private String fileName;\n    private byte[] fileBody;\n    public String getFileName() {\n        return fileName;\n    }\n    public void setFileName(String fileName) {\n        this.fileName = fileName;\n    }\n    public byte[] getFileBody() {\n        return fileBody;\n    }\n    public void setFileBody(byte[] fileBody) {\n        this.fileBody = fileBody;\n    }\n\n\n}   \n\n\nRESTEasy\u306e\u62e1\u5f35\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3@MultipartForm\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3092\u3057\u3088\u3046\u3068\u3059\u308b\u3082\u3001\u65e5\u672c\u8a9e\u3092\u542b\u3080\u9805\u76ee\u304c\u6089\u304f\u6587\u5b57\u5316\u3051\u3059\u308b.\n\n\u539f\u56e0\n\u4ed5\u65b9\u306a\u304f\u3001multipart\u95a2\u9023\u306eProvider\u5b9f\u88c5(org.jboss.resteasy:resteasy-multipart-provider:2.3.6-final)\u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u307f\u305f\u3068\u3053\u308d\u3001org.jboss.resteasy.plugins.providers.multipart.InputPart \u306eJavadoc\u306b\u4e0b\u8a18\u304c\u66f8\u3044\u3066\u3042\u3063\u305f.\n    /**\n     * If there is a content-type header without a charset parameter, charset=US-ASCII\n     * is assumed.\n     * <p>\n    * This can be overwritten by setting a different String value in\n    * {@link org.jboss.resteasy.spi.HttpRequest#setAttribute(String, Object)}\n    * with this (\"resteasy.provider.multipart.inputpart.defaultCharset\")\n    * String as key. It should be done in a\n    * {@link org.jboss.resteasy.spi.interception.PreProcessInterceptor}.\n    * </p>\n     */\n    static final String DEFAULT_CHARSET_PROPERTY = \"resteasy.provider.multipart.inputpart.defaultCharset\";\n\n\u8981\u306f\u3001\u300cmultipart\u306e\u5404part\u306b\u3064\u3044\u3066\u3001content-type=\u25cb\u25cb; charset=... \u306e\u3088\u3046\u306a\u30d8\u30c3\u30c0\u304c\u7121\u3044\u5834\u5408, Provider\u306fUS-ASCII\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u5909\u63db\u3059\u308b\u3088\u300d\u3068\u3044\u3046\u5185\u5bb9\u3060.\n\n\u5bfe\u5fdc\u65b9\u6cd5\nJavaDoc\u306b\u3082\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3001org.jboss.resteasy.spi.HttpRequest#setAttribute\u306b \"resteasy.provider.multipart.inputpart.defaultCharset\"\u3092\u30bb\u30c3\u30c8\u3059\u308b\u65b9\u6cd5\u3067\u3084\u3063\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u7121\u4e8b\u89e3\u6c7a(\u306a\u304a\u3001\u5f8c\u304b\u3089\u3053\u306e\u30ad\u30fc\u540d\u3067\u30b0\u30b0\u3063\u3066\u307f\u305f\u3089\u3001JavaDoc\u3060\u3051\u3067\u306a\u304f\u3001RESTEasy\u672c\u5bb6\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3082\u8a18\u8f09\u304c\u3042\u308a\u307e\u3057\u305f...).\n\nContentTypeSetterPreProcessorInterceptor.java\nimport org.jboss.resteasy.plugins.providers.multipart.InputPart;\n\n@Provider\n@ServerInterceptor\npublic class ContentTypeSetterPreProcessorInterceptor implements\n        PreProcessInterceptor {\n\n    public ServerResponse preProcess(HttpRequest request,\n            ResourceMethod method) throws Failure, WebApplicationException {\n        request.setAttribute(InputPart.DEFAULT_CHARSET_PROPERTY, \"UTF-8\");\n        return null;\n    }\n\n}\n\n\nPreProcessInterceptor\u306f http://docs.jboss.org/resteasy/docs/2.3.6.Final/userguide/html_single/index.html#PreProcessInterceptors \u306b\u3082\u3042\u308b\u901a\u308a\u3001RESTEasy\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b HttpRequest\u3078\u306e\u62e1\u5f35\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b. @Provider\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u52dd\u624b\u306bJBoss\u304cInterceptor\u3068\u3057\u3066\u767b\u9332\u3057\u3066\u304f\u308c\u308b\u305f\u3081\u3001\u7279\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7b49\u306e\u8a18\u8f09\u306f\u4e0d\u8981. \n\n\u53c2\u8003\u30ea\u30f3\u30af\n\nRESTEasy\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 http://docs.jboss.org/resteasy/docs/2.3.6.Final/userguide/html_single/index.html#multipart_overwrite_default_charset\n\n\u95a2\u9023JavaDoc\nhttps://docs.jboss.org/resteasy/docs/2.3.6.Final/javadocs/org/jboss/resteasy/plugins/providers/multipart/InputPart.html\n\n\n\u4ed5\u4e8b\u3067\u82e5\u5e72\u56f0\u3063\u305f\u306e\u3068\u3001\u6587\u5b57\u5316\u3051\u7cfb\u306e\u73fe\u8c61\u306a\u306e\u3060\u304c\u3001\u540c\u5185\u5bb9\u306e\u5bfe\u5fdc\u306b\u3064\u3044\u3066\u306e\u65e5\u672c\u8a9e\u30da\u30fc\u30b8\u304c\u307e\u3063\u305f\u304f\u5f15\u3063\u639b\u304b\u3089\u306a\u304b\u3063\u305f\u306e\u3067\u3001\u30e1\u30e2\u3057\u3066\u304a\u304f.\n\n### \u80cc\u666f\n\n\u3084\u308d\u3046\u3068\u3057\u3066\u3044\u305f\u3053\u3068\u306f\u3001\u2193.\n\n+ `multipart/form-data`\u3067JAX-RS(JBoss EAP 6.2, RestEASY)\u306b\u30d5\u30a1\u30a4\u30eb\u3092Upload.\n+ \u30d5\u30a9\u30fc\u30e0\u30c7\u30fc\u30bf\u306b\u306f\u65e5\u672c\u8a9e\u3092\u8a31\u53ef.\n\n\u30b3\u30fc\u30c9\u306e\u30a4\u30e1\u30fc\u30b8\u306f\u4e0b\u8a18\u306a\u611f\u3058\u3060.\n\n```java:FileResource.java\nimport javax.ws.rs.Consumes;\nimport javax.ws.rs.POST;\nimport javax.ws.rs.Path;\nimport javax.ws.rs.core.MediaType;\nimport javax.ws.rs.core.Response;\n\nimport org.jboss.resteasy.annotations.providers.multipart.MultipartForm;\n\n@Path(\"/file\")\npublic class FileResource {\n\n\t@POST\n    @Consumes(MediaType.MULTIPART_FORM_DATA)\n\tpublic Response create(@MultipartForm UploadData uploadData){\n\t\t\n\t\tString fileName = uploadData.getFileName(); // \u2605 \u3053\u3044\u3064\u304c\u6587\u5b57\u5316!\n\t\t// \u8272\u3005\u51e6\u7406...\n\t\treturn Response.ok().build();\n\t}\n}\n```\n\n```java:UploadData.java\npublic class UploadData implements Serializable{\n\tprivate String fileName;\n\tprivate byte[] fileBody;\n\tpublic String getFileName() {\n\t\treturn fileName;\n\t}\n\tpublic void setFileName(String fileName) {\n\t\tthis.fileName = fileName;\n\t}\n\tpublic byte[] getFileBody() {\n\t\treturn fileBody;\n\t}\n\tpublic void setFileBody(byte[] fileBody) {\n\t\tthis.fileBody = fileBody;\n\t}\n\t\n\t\n}\t\n```\n\nRESTEasy\u306e\u62e1\u5f35\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3`@MultipartForm`\u3067\u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3092\u3057\u3088\u3046\u3068\u3059\u308b\u3082\u3001\u65e5\u672c\u8a9e\u3092\u542b\u3080\u9805\u76ee\u304c\u6089\u304f\u6587\u5b57\u5316\u3051\u3059\u308b.\n\n## \u539f\u56e0\n\n\u4ed5\u65b9\u306a\u304f\u3001multipart\u95a2\u9023\u306eProvider\u5b9f\u88c5(org.jboss.resteasy:resteasy-multipart-provider:2.3.6-final)\u306e\u30bd\u30fc\u30b9\u3092\u8aad\u3093\u3067\u307f\u305f\u3068\u3053\u308d\u3001`org.jboss.resteasy.plugins.providers.multipart.InputPart` \u306eJavadoc\u306b\u4e0b\u8a18\u304c\u66f8\u3044\u3066\u3042\u3063\u305f.\n\n```java\n\t/**\n\t * If there is a content-type header without a charset parameter, charset=US-ASCII\n\t * is assumed.\n\t * <p>\n    * This can be overwritten by setting a different String value in\n    * {@link org.jboss.resteasy.spi.HttpRequest#setAttribute(String, Object)}\n    * with this (\"resteasy.provider.multipart.inputpart.defaultCharset\")\n    * String as key. It should be done in a\n    * {@link org.jboss.resteasy.spi.interception.PreProcessInterceptor}.\n    * </p>\n\t */\n\tstatic final String DEFAULT_CHARSET_PROPERTY = \"resteasy.provider.multipart.inputpart.defaultCharset\";\n```\n\n\u8981\u306f\u3001\u300cmultipart\u306e\u5404part\u306b\u3064\u3044\u3066\u3001content-type=\u25cb\u25cb; charset=... \u306e\u3088\u3046\u306a\u30d8\u30c3\u30c0\u304c\u7121\u3044\u5834\u5408, Provider\u306fUS-ASCII\u3067\u6587\u5b57\u30b3\u30fc\u30c9\u5909\u63db\u3059\u308b\u3088\u300d\u3068\u3044\u3046\u5185\u5bb9\u3060.\n\n### \u5bfe\u5fdc\u65b9\u6cd5\nJavaDoc\u306b\u3082\u66f8\u3044\u3066\u3042\u308b\u901a\u308a\u3001`org.jboss.resteasy.spi.HttpRequest#setAttribute`\u306b `\"resteasy.provider.multipart.inputpart.defaultCharset\"`\u3092\u30bb\u30c3\u30c8\u3059\u308b\u65b9\u6cd5\u3067\u3084\u3063\u3066\u307f\u305f\u3068\u3053\u308d\u3001\u7121\u4e8b\u89e3\u6c7a(\u306a\u304a\u3001\u5f8c\u304b\u3089\u3053\u306e\u30ad\u30fc\u540d\u3067\u30b0\u30b0\u3063\u3066\u307f\u305f\u3089\u3001JavaDoc\u3060\u3051\u3067\u306a\u304f\u3001RESTEasy\u672c\u5bb6\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u3082\u8a18\u8f09\u304c\u3042\u308a\u307e\u3057\u305f...).\n\n```java:ContentTypeSetterPreProcessorInterceptor.java\nimport org.jboss.resteasy.plugins.providers.multipart.InputPart;\n\n@Provider\n@ServerInterceptor\npublic class ContentTypeSetterPreProcessorInterceptor implements\n\t\tPreProcessInterceptor {\n\n\tpublic ServerResponse preProcess(HttpRequest request,\n\t\t\tResourceMethod method) throws Failure, WebApplicationException {\n\t\trequest.setAttribute(InputPart.DEFAULT_CHARSET_PROPERTY, \"UTF-8\");\n\t\treturn null;\n\t}\n\n}\n```\n\n`PreProcessInterceptor`\u306f http://docs.jboss.org/resteasy/docs/2.3.6.Final/userguide/html_single/index.html#PreProcessInterceptors \u306b\u3082\u3042\u308b\u901a\u308a\u3001RESTEasy\u306e\u30ea\u30af\u30a8\u30b9\u30c8\u6642\u306b `HttpRequest`\u3078\u306e\u62e1\u5f35\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u5229\u7528\u3067\u304d\u308b. `@Provider`\u304c\u4ed8\u4e0e\u3055\u308c\u3066\u3044\u308c\u3070\u3001\u52dd\u624b\u306bJBoss\u304cInterceptor\u3068\u3057\u3066\u767b\u9332\u3057\u3066\u304f\u308c\u308b\u305f\u3081\u3001\u7279\u306b\u8a2d\u5b9a\u30d5\u30a1\u30a4\u30eb\u7b49\u306e\u8a18\u8f09\u306f\u4e0d\u8981. \n\n### \u53c2\u8003\u30ea\u30f3\u30af\n+ RESTEasy\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 http://docs.jboss.org/resteasy/docs/2.3.6.Final/userguide/html_single/index.html#multipart_overwrite_default_charset\n+ \u95a2\u9023JavaDoc\nhttps://docs.jboss.org/resteasy/docs/2.3.6.Final/javadocs/org/jboss/resteasy/plugins/providers/multipart/InputPart.html\n", "tags": ["Java", "jboss", "JAX-RS"]}